var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(A,fa,ya){A!=Array.prototype&&A!=Object.prototype&&(A[fa]=ya.value)};$jscomp.getGlobal=function(A){return"undefined"!=typeof window&&window===A?A:"undefined"!=typeof global&&null!=global?global:A};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var A=0;return function(fa){return $jscomp.SYMBOL_PREFIX+(fa||"")+A++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var A=$jscomp.global.Symbol.iterator;A||(A=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[A]&&$jscomp.defineProperty(Array.prototype,A,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(A){var fa=0;return $jscomp.iteratorPrototype(function(){return fa<A.length?{done:!1,value:A[fa++]}:{done:!0}})};$jscomp.iteratorPrototype=function(A){$jscomp.initSymbolIterator();A={next:A};A[$jscomp.global.Symbol.iterator]=function(){return this};return A};
$jscomp.iteratorFromArray=function(A,fa){$jscomp.initSymbolIterator();A instanceof String&&(A+="");var ya=0,Ea={next:function(){if(ya<A.length){var Xa=ya++;return{value:fa(Xa,A[Xa]),done:!1}}Ea.next=function(){return{done:!0,value:void 0}};return Ea.next()}};Ea[Symbol.iterator]=function(){return Ea};return Ea};
$jscomp.polyfill=function(A,fa,ya,Ea){if(fa){ya=$jscomp.global;A=A.split(".");for(Ea=0;Ea<A.length-1;Ea++){var Xa=A[Ea];Xa in ya||(ya[Xa]={});ya=ya[Xa]}A=A[A.length-1];Ea=ya[A];fa=fa(Ea);fa!=Ea&&null!=fa&&$jscomp.defineProperty(ya,A,{configurable:!0,writable:!0,value:fa})}};$jscomp.polyfill("Array.prototype.keys",function(A){return A?A:function(){return $jscomp.iteratorFromArray(this,function(A){return A})}},"es6","es3");
$jscomp.polyfill("Object.getOwnPropertySymbols",function(A){return A?A:function(){return[]}},"es6","es5");$jscomp.findInternal=function(A,fa,ya){A instanceof String&&(A=String(A));for(var Ea=A.length,Xa=0;Xa<Ea;Xa++){var V=A[Xa];if(fa.call(ya,V,Xa,A))return{i:Xa,v:V}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(A){return A?A:function(A,ya){return $jscomp.findInternal(this,A,ya).v}},"es6","es3");$jscomp.owns=function(A,fa){return Object.prototype.hasOwnProperty.call(A,fa)};
$jscomp.polyfill("Object.assign",function(A){return A?A:function(A,ya){for(var fa=1;fa<arguments.length;fa++){var Xa=arguments[fa];if(Xa)for(var V in Xa)$jscomp.owns(Xa,V)&&(A[V]=Xa[V])}return A}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(A){return A?A:function(){return $jscomp.iteratorFromArray(this,function(A,ya){return ya})}},"es8","es3");$jscomp.polyfill("Math.sign",function(A){return A?A:function(A){A=Number(A);return 0===A||isNaN(A)?A:0<A?1:-1}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(A){return A?A:function(A){return"number"!==typeof A?!1:!isNaN(A)&&Infinity!==A&&-Infinity!==A}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(A){return A?A:function(A){return Number.isFinite(A)?A===Math.floor(A):!1}},"es6","es3");
(function(){var A,fa,ya,Ea;function Xa(c,b){var e=G,f;for(f=2;60>=f;f+=2){c--;b--;for(var g=0;g<=f;){if(2<N[c+g+e*b]&&1==z[N[c+g+e*b]].res&&ha(c+g,b))return N[c+g+e*b];if(2<N[c+g+e*(b+f)]&&1==z[N[c+g+e*(b+f)]].res&&ha(c+g,b+f))return N[c+g+e*(b+f)];g++}for(g=0;g<f-1;){g++;if(2<N[c+e*(b+g)]&&1==z[N[c+e*(b+g)]].res&&ha(c,b+g))return N[c+e*(b+g)];if(2<N[c+f+e*(b+g)]&&1==z[N[c+f+e*(b+g)]].res&&ha(c+f,b+g))return N[c+f+e*(b+g)]}}return!1}function V(c,b){if(!qd(c)){var e=c.x32,f=c.y32,g=c.sight;c.build&&
(g=c.attDist);var d=G,l=2*g+1,q=l*l,t=c.id,n={};c.callList||(c.callList=[]);for(var B=0;B<q;B++){var F=B%l-g,w=~~(B/l)-g;if(Math.sqrt(Math.pow(F,2)+Math.pow(w,2))<=g){F+=e;w+=f;var Qa=F+w*d;ha(F,w)&&(oc[Qa]?(F=z[oc[Qa]],n[F.id]||b||(F.callList||J(F),F.callList.put(c.id),F.callList.put(c.x32+c.y32*d),n[F.id]=1)):oc[Qa]=t)}}}}function Ii(c){if(c.callList){for(var b=c.x32,e=c.y32,f=c.sight,g=G,d=2*f+1,l=d*d,q=c.id,t=0;t<l;t++){var n=t%d-f,B=~~(t/d)-f;Math.sqrt(Math.pow(n,2)+Math.pow(B,2))<=f&&(n+=b,
B+=e,n+=B*g,oc[n]==q&&(oc[n]=void 0))}b=c.callList;c.callList=void 0;t=0;for(l=b.length;t<l;t+=2)c=z[b[t]],c.x32+c.y32*g==b[t+1]&&c.callList&&V(c,!0);b.length=0}}function nl(){for(var c=0,b=Wa.length;c<b;Wa[c++].className="");}function ol(c){k.getError()==k.CONTEXT_LOST_WEBGL&&(k=document.getElementById("tzar").getContext("webgl2",{antialias:!1,alpha:!1}),J("restored"));fa=[];ya=[0,1,2,1,2,3];Ea=[];ya.changed=!0;if(!rd){var b=k.createShader(k.VERTEX_SHADER);k.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec4 a_kingdom;\nin vec4 a_physic;\nuniform float zoom;\nuniform mediump int miniMap;\nuniform float now;\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform sampler2D u_image1;\nuniform sampler2D delay;\nuniform float zMax;\nout highp vec2 vTextureCoord;\nout vec4 v_kcolor;\nout float height;\n\nvec4 superArray(in highp uint position) {\n     return(texelFetch(u_image1, ivec2(\t\t(position%uint(512))\t\t,\tposition/uint(512)\t), 0));\n}\n\n\n\nvoid main() {\n\n\n\n    highp float  x;\n    float t;\n\thighp uint pos;\n\n\nif(a_texCoord.y>-.5&&miniMap==0){\nt=(now-a_texCoord.y);\nif(a_texCoord.w>=0.0){\npos=uint(floor(t * a_texCoord.w));         \n}else{\n\n\nint index=int(-a_texCoord.w);\nint len=int(a_texCoord.z);\nint i;\n\nfloat spt= mod(t,texelFetch(delay, ivec2(len-1+index, 0), 0).r);\n\n for(i=0;i<len;i++){\n\n\nif(texelFetch(delay, ivec2(i+index, 0), 0).r>spt) {\n\nbreak;\n }\n\n\n }\n\n pos=uint(i);\n\n\t\t\t\t  \n //pos=uint(4);\n}\n\n\n\tpos=uint(a_texCoord.x)+uint(4)*(pos%uint(a_texCoord.z));\n\n\n}else{\n\npos=uint(a_texCoord.x);\n\n}\n\n\n\n    vec4 coord = superArray(pos);\n\n\tpos=pos-pos%uint(4);\n\n\theight = (superArray(pos+uint(3)).w-superArray(pos).w)/512.0;\n\n    vec2 mxy=vec2(coord.p,coord.q);\n\n\n\t\tfloat z=a_position.z;\n\n\tif(z<0.0){\n\tz*=-1.0;\n\tmxy*=0.0;\n\n\t}\n\n\n\n    t = (now - a_physic.w) * 0.001;\n    mxy.x+=a_physic.x * t;\n\n\tfloat physicY=a_physic.y * t + a_physic.z * .5 * t * t;\n\n    mxy.y+=physicY;\n\n\nif(miniMap==1){\n\tz=0.0;\n}else{\n\tz=(1.0 - (physicY+z)/ zMax)*.9;\n}\n\n   gl_Position = vec4((((a_position.xy+mxy) + u_translation) / u_resolution * 2.0 - 1.0) * vec2(zoom, -zoom), (z), 1.0);\n\n   vTextureCoord=vec2(coord.s,coord.t);\n\n\n    v_kcolor=a_kingdom;\n\n\n}\n");
k.compileShader(b);c=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(c,"#version 300 es\nprecision mediump float;\n\n\n\nuniform sampler2D lightmap;\nuniform vec2 u_resolution;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform mediump int miniMap;\nin vec4 v_kcolor;\nin highp vec2 vTextureCoord;\nin float height;\nout vec4 COLOR;\n\nvoid main() {\n\n\nif(miniMap==0){\n\n\n\n\nvec2 txtFinal=vTextureCoord;\n\nif(txtFinal.x>=1.0){\ntxtFinal.y+=height*floor(txtFinal.x);\n}\n\n\nvec4 color=texture(img_common, vec3(txtFinal, int(txtFinal.y)));\n \n\nif(color.a<0.5) discard;\n\n\n\n\nif(v_kcolor.a<1.0){\ncolor*=v_kcolor;\n}else if(v_kcolor.a!=1.0){\n\nif(color.r==color.g&&color.r==color.b){\ncolor.rgb*=v_kcolor.rgb;\n}\ncolor.a*=v_kcolor.a-1.0;\n}\nvec4 light=vec4(1.0);\n\n\nlight = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+vec4(1.0,1.0,1.0,0.0)*u_ambient;\n\nCOLOR=color*light;\n\n}else{\nCOLOR=v_kcolor;\n}\n\n}");
k.compileShader(c);Ba=k.createProgram();k.attachShader(Ba,b);k.attachShader(Ba,c);k.linkProgram(Ba);k.useProgram(Ba);b=k.getShaderInfoLog(b);console.log("Shader compiler log: "+b);b=k.getShaderInfoLog(c);console.log("Shader compiler log: "+b);b=k.createShader(k.VERTEX_SHADER);k.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\n\n\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform mediump int miniMap;\nuniform float zoom;\n\n\nvoid main() {\n\nfloat depth;\nif(miniMap==1){\ndepth=.03;\n}else{\ndepth=1.0;\n}\n\n   gl_Position = vec4(a_position.x, a_position.y, depth, 1.0);\n   \n\n}");
k.compileShader(b);c=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(c,"#version 300 es\nprecision mediump float;\n\nuniform float u_fps;\nuniform mediump int miniMap;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform vec2 borderCoords;\nuniform vec2 waterBorder;\nuniform vec2 u_translation;\nuniform vec2 u_resolution;\nuniform vec2 minimapMargin;\nuniform mediump isampler2D img_data;\nuniform sampler2D lightmap;\nout vec4 COLOR;\nuniform float zoom;\nuniform float mx;\nuniform float mapSize;\nuniform float terrainInfo[32];\nvec4 sptexture3D(in vec2 coords,in float height1) {\n \n\n \nif(coords.x>=1.0){\ncoords.y+=height1*floor(coords.x);\n}\n\n\n\n    return(\ttexture(img_common, vec3(coords,int(coords.y)))\t);\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\nvec4 color;\n\nvec2 xy =  vec2(gl_FragCoord.x,u_resolution.y-gl_FragCoord.y)/zoom;\n\nif(miniMap==1){\nxy+=minimapMargin/zoom;\n}else{\nxy+=-u_translation+vec2(mx,0.0)/zoom+0.5*(u_resolution-u_resolution/zoom);\n}\n\nvec2 xy32=xy/32.0;\n\nvec2 floorxy32=floor(xy32);\n\nvec2 xyr=xy32-floorxy32;\n\n\nvec2 xyb;\n\n\nfloat dx=0.0;\nfloat dy=0.0;\n\nif(xyr.x>0.5){dx=1.0;}\nif(xyr.y>0.5){dy=1.0;}\n\nvec2 oxy32=xy32;\n\n\nif(dx==1.0){\nxyb=vec2(borderCoords.x+floor(rand(floorxy32)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(-16.0,8.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.x+=dx;\n}\n}\n\nif(dy==1.0){\nxyb=vec2(borderCoords.x+floor(rand(1.5*floorxy32-3.0)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(8,-16.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.y+=dy;\n}\n}\n\n\nint type = texture(img_data,xy32/(mapSize)).r;\nint ntype = texture(img_data,oxy32/(mapSize)).r;\n\nif(type<0&&type!=ntype){\n\nif(ntype<0){\ntype=ntype;\n}else if(ntype==3){\ntype=ntype;\n}else{\ntype=1;\n}\n}\n\n\n\nfloat h;\nfloat w;\nvec2 xytxt;\nif(type<0){\n\ntype=-type-2;\nxytxt=waterBorder+vec2(float(type*8*32),0.0)/512.0;\nw=32.0;\nh=32.0;\ntype*=-1;\n}else{\nxytxt=vec2(terrainInfo[type*4],terrainInfo[type*4+1]);\nw=terrainInfo[type*4+2];\nh=terrainInfo[type*4+3];\n\nif(type==3) xytxt+=vec2(u_fps,0.0);\n}\n\n\nvec2 xyt=vec2(xytxt)+vec2(mod(xy.x,w),mod(xy.y,h))/512.0;\n\n\nif(type==3){ h=576.0; }\ncolor=sptexture3D(xyt,h/512.0);\n\nmediump vec4 light=vec4(1.0);\nif(miniMap==0) light = (texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+1.0)*u_ambient;\n\n\n\nCOLOR=color*light;\n\n\n\n}");
k.compileShader(c);za=k.createProgram();k.attachShader(za,b);k.attachShader(za,c);k.linkProgram(za);b=k.getShaderInfoLog(b);console.log("Shader1 compiler log T: "+b);b=k.getShaderInfoLog(c);console.log("Shader compiler log T: "+b)}c=k.getAttribLocation(Ba,"a_position");b=k.getAttribLocation(Ba,"a_texCoord");var e=k.getAttribLocation(Ba,"a_kingdom"),f=k.getAttribLocation(Ba,"a_physic"),g=m,d=pc.dir,l=[];l.length=4*d.length;for(var q=0,t=d.length;q<t;q++){var n=Ca[g[d[q]]],B=n[7]+n.deltaY,F=n[8],w=
n[9];l[4*q]=n[6]/512;l[4*q+1]=B/512;l[4*q+2]=F;l[4*q+3]=w}J(l);q=1/512;k.useProgram(za);t=k.getUniformLocation(za,"minimapMargin");Sd=k.getUniformLocation(za,"u_translation");Lg=k.getUniformLocation(za,"u_resolution");Mg=k.getUniformLocation(za,"u_fps");var Qa=k.getUniformLocation(za,"u_ambient");sd=k.getUniformLocation(za,"zoom");n=k.getUniformLocation(za,"mx");d=k.getUniformLocation(za,"mapSize");B=k.getUniformLocation(za,"borderCoords");F=k.getUniformLocation(za,"waterBorder");mf=k.getUniformLocation(za,
"miniMap");w=k.getUniformLocation(za,"terrainInfo");k.uniform2fv(B,[Ca[g.terrain_border][6]*q,q*(Ca[g.terrain_border].deltaY+Ca[g.terrain_border][7])]);k.uniform2fv(F,[Ca[g.waterborder][6]*q,q*(Ca[g.waterborder].deltaY+Ca[g.waterborder][7])]);k.uniform1i(mf,0);k.uniform2fv(Sd,[0,0]);k.uniform1f(Mg,-1);k.uniform1f(sd,1);k.uniform1f(n,-v.mx);k.uniform1f(d,G);k.uniform1fv(w,l);p.editor?k.uniform2fv(t,[0,-60]):k.uniform2fv(t,[-4,-31]);g=k.getAttribLocation(za,"a_position");Ng=k.createVertexArray();k.bindVertexArray(Ng);
l=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,l);k.bufferData(k.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,1,1,-1,1]),k.STATIC_DRAW);k.enableVertexAttribArray(g);k.vertexAttribPointer(g,2,k.FLOAT,!1,0,0);k.bindVertexArray(null);k.useProgram(Ba);k.bindBuffer(k.ARRAY_BUFFER,null);g=G*Da*3;Og=k.createVertexArray();k.bindVertexArray(Og);Ib=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Ib);k.enableVertexAttribArray(e);k.vertexAttribPointer(e,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,16*g,
k.DYNAMIC_DRAW);td=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,td);k.enableVertexAttribArray(b);k.vertexAttribPointer(b,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,16*g,k.DYNAMIC_DRAW);Fc=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Fc);k.enableVertexAttribArray(c);k.vertexAttribPointer(c,3,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,12*g,k.DYNAMIC_DRAW);Td=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Td);k.enableVertexAttribArray(f);k.vertexAttribPointer(f,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,
16*g,k.DYNAMIC_DRAW);k.bindVertexArray(null);nf=k.getUniformLocation(Ba,"u_resolution");var ec=k.getUniformLocation(Ba,"u_ambient");Ud=k.getUniformLocation(Ba,"u_translation");ud=k.getUniformLocation(Ba,"zoom");Ji=k.getUniformLocation(Ba,"now");of=k.getUniformLocation(Ba,"miniMap");c=k.getUniformLocation(Ba,"zMax");k.uniform1f(c,p.zMax);k.uniform1i(of,0);k.useProgram(Ba);m.delay=[100,250,400,550,650,750,850,1E3,1150,5150,7650,10150,13650,17150,21150,25150,100,200,300,400,500,600,700,800,900,1E3,1100,
1200,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6500,7700,8900,10100,13600,17100,22100,8E3,8080,8160,8240,8320,8400,8480,100,200,300,400,500,600,700,800,900,1E3,1100,2400,3600,4800,6E3,7200,8400,11900,15400,20400,8E3,8077,8154,8231,8308,8385,8462,8539,8616,8693,8770,8847,8923,5E3,5072,5143,5215,5286,5358,5429,5501,5572,5644,5715,5787,5858,5929,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,3700,4900,7100,9600,12600,17100,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,
8833,8916,9E3,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,8833,8916,9E3,9080,5E3,5100,5200,5300,5400,5500,5600,5700,5850,6E3,70,140,210,280,350,420,490,560,630,700,770,840,910,980,4980,8980,12980,16980,20980,26980,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,4100,6300,8500,11E3,13500,17E3,20500,5E3,5100,5200,5300,5400,5500,5600,5700,5800,5900,6E3,125,230,335,431,546,606,666,731,857,952,1045,1139,1238,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,3300,
5800,8800,12E3,15500,5500,5600,5700,5800,5900,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6800,9800,12800,16300,19800,23800,28300,5E3,5100,5200,5300,5400,5500,5600,210,420,654,864,1074,1284,1494,108,244,380,516,652,788,924,1060,1196,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4100,6100,8100,11100,14100,17100,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5200,9E3,11E3,13800,17600,23400,7E3,7100,
7200,7300,7400,8200,8300,8400,8500,8600,9600,9700,9800,9900,1E4,80,160,210,360,610,1010,1510,100,200,300,400,500,3500,7500,13500,40,80,120,160,200,240,280,320,360,400,440,480,520,2520,3520,4520,5520,6520,8520,11520,107,214,321,428,535,642,749,856,963,1070,1177,1284,1391,1498,7323,13148,18973,24798,30623,36448,7E3,7170,7340,7510,7680,7980,8150,8320,8490,8660,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,6400,8900,11400,14900,18400,7E3,7200,7400,7600,7800,8E3,8200,125,250,375,500,
2E3,2125,2250,100,200,300,400,500,4E3,10500,100,200,300,400,500,600,700,800,900,8900,15900,21400,27400,33900,38900,44900,51900,800,1E3,1200,1400,1600,1800,2E3,2200,2400,2600,NaN,80,160,240,320,400,480,560,640,720,800,880,960,1040,5040,9040,12790,16540,19290,22040,25790,7671,7771,7871,7971,8071,8171,8271,100,200,300,400,500,600,700,800,900,1E3,1100,1200,6200,9700,13200,17200,21200,25200,29200,35200,100,200,300,400,500,600,9600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,11300,17300,
27300,37300,49300,64300,8E3,8228,8457,8685,8914,9142,9371,80,160,240,320,400,480,560,640,720,800,880,960,4960,8460,11460,14460,18460,22460,28460,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5400,8900,12900,16900,22900,28900,5E3,5143,5286,5429,5572,5715,5857,121,232,361,508,629,758,879,1018,1165,1425,1445,1465,1536,1692,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8300,11300,14800,18800,23300,29300,6E3,6171,6343,6514,6685,6857,7028,125,
250,375,500,625,750,875,1E3,1125,1250,1375,1500,6500,10500,13500,16500,19500,23E3,27E3,31500,8E3,8185,8370,8555,8740,8925,9108,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4300,7800,11300,15300,19300,23800,29800,1E4,10107,10214,10321,10428,10535,10643,10750,10857,10964,11071,11178,11285,11393,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4900,8400,12900,17400,22400,27400,
8E3,8250,8500,8750,9E3,9250,9500,9750,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,8300,11800,15800,19800,24300,29300,5E3,5157,5314,5471,5628,5785,5943,125,250,375,500,625,3125,3250,3375,100,200,300,400,500,600,4600,8600,14600,15600,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14400,18400,
22400,28400,180,360,540,720,900,1080,10080,100,200,350,500,600,700,800,950,1100,1250,1400,1550,1700,6200,8700,11700,15200,18700,22700,27700,6E3,6120,6240,6360,6480,6600,6720,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14900,18900,23400,29400,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,7400,10900,14900,19900,5E3,5100,5200,5300,5400,5500,5600,116,232,348,464,522,580,638,696,812,928,1044,1160,1276,1392,100,200,300,400,
500,600,700,800,900,1E3,1100,1200,5200,8700,11700,14700,18700,22700,28700,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,6900,10900,14400,18400,22400,27400,7E3,7100,7200,7300,7400,7500,7600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8600,10800,13E3,15500,19500,24E3,8E3,8100,8200,8300,8400,8500,8600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8800,12300,16300,20300,24300,29300,6E3,6100,6200,6300,6400,6500,6600,100,200,
300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1630,1730,1830,1930,2030,2130,2230,2330,5330,8330,11330,7E3,7150,7300,7450,7600,7750,7900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,5200,8700,12200,15700,20200,24700,29700,34700,8E3,8080,8163,8246,8330,8413,8496,8580,8663,8746,8830,8913,8996,9080,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,5599,5684,5770,5855,5941,6026,6112,125,250,375,500,625,
750,875,1E3,1125,1250,1375,1500,1625,5625,8625,11625,14625,18125,22125,26625,8E3,8185,8370,8555,8740,8925,9108,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,6100,10600,14600,18100,21600,26100,30600,35600,40600,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1700,6700,10700,11300,6E3,6200,6400,6600,6800,7E3,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,10400,100,
200,300,400,500,600,8600];c=m.delay;var fc=c.length;Ca[m.expl_small_hole][1]=-fc;for(b=q=0;14>q;q++)b+=66,c[q+fc]=b;c.put(b+3E4);c=new Float32Array(c);Ki=function(c){k.useProgram(za);k.uniform4fv(Qa,c);k.useProgram(Ba);k.uniform4fv(ec,c)};Pg=function(c){if(!Vd&&(c.clientX>v.menumx||vd||!c.clientX)){c=.07*Math.sign(c.deltaY)*da;var b=(da+c)*tzar.height*.03125;(da+c)*tzar.width*.03125-(da+c)*v.mx/32>G||b>Da||(da+=c,.08>da&&(da=.08),Ab(),wd(-ub,-Ta),k.useProgram(za),k.uniform1f(sd,1/da),k.useProgram(Ba),
k.uniform1f(ud,1/da))}};window.addEventListener("wheel",Pg,!1);Li=function(){fc=[ub,Ta];k.useProgram(za);k.uniform2fv(Sd,fc);k.useProgram(Ba);k.uniform2fv(Ud,fc)};pl();Ki(new Float32Array([1,1,1,1]));k.uniform1f(ud,1);k.uniform2fv(Ud,[0,0]);var Ia=k.createFramebuffer(),r;Wd=function(){var c=window.innerWidth,b=window.innerHeight;tzar.width=c;tzar.height=b;k.useProgram(za);k.uniform2f(Lg,c,b);k.useProgram(Ba);Ia.width=c;Ia.height=b;k.activeTexture(k.TEXTURE2);r||(r=k.createTexture());k.bindTexture(k.TEXTURE_2D,
r);k.texImage2D(k.TEXTURE_2D,0,k.RGBA,c,b,0,k.RGBA,k.UNSIGNED_BYTE,null);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.bindFramebuffer(k.FRAMEBUFFER,Ia);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,r,0);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);k.bindFramebuffer(k.FRAMEBUFFER,
null);da=1;k.uniform1f(ud,1/da);k.uniform1i(k.getUniformLocation(Ba,"lightmap"),2);k.useProgram(za);k.uniform1i(k.getUniformLocation(za,"lightmap"),2);k.uniform1f(sd,1/da);k.useProgram(Ba);k.uniform2f(nf,c,b);k.viewport(v.mx,0,c,b);Wd.changed=1;wd(-ub,-Ta)};Wd.changed=0;window.addEventListener("resize",Wd,!1);Wd();k.blendEquation(k.FUNC_ADD);k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA);k.disable(k.DITHER);k.disable(k.BLEND);performance.now();b=k.createTexture();e=S.info;k.bindTexture(k.TEXTURE_2D,
b);k.texImage2D(k.TEXTURE_2D,0,k.RGBA32F,512,512,0,k.RGBA,k.FLOAT,e);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT);k.bindTexture(k.TEXTURE_2D,null);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,b);k.uniform1i(k.getUniformLocation(Ba,"u_image1"),0);k.activeTexture(k.TEXTURE1);b=k.createTexture();k.bindTexture(k.TEXTURE_2D_ARRAY,
b);k.texParameteri(k.TEXTURE_2D_ARRAY,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D_ARRAY,k.TEXTURE_MIN_FILTER,k.NEAREST);e=S.common;f=e.length;n=S.xtra;q=0;for(t=n.length;q<t;f+=n[q++].length);J(S);k.texImage3D(k.TEXTURE_2D_ARRAY,0,k.RGBA,S.size,S.size,f/(4*S.size*S.size),0,k.RGBA,k.UNSIGNED_BYTE,null);f=e.length;k.texSubImage3D(k.TEXTURE_2D_ARRAY,0,0,0,0,S.size,S.size,e.length/(4*S.size*S.size),k.RGBA,k.UNSIGNED_BYTE,e);q=0;for(t=n.length;q<t;q++)e=n[q],k.texSubImage3D(k.TEXTURE_2D_ARRAY,
0,0,0,f/1048576,S.size,S.size,e.length/(4*S.size*S.size),k.RGBA,k.UNSIGNED_BYTE,e),f+=e.length;J(f);k.activeTexture(k.TEXTURE1);k.bindTexture(k.TEXTURE_2D_ARRAY,b);k.uniform1i(k.getUniformLocation(Ba,"img_common"),1);k.useProgram(za);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D_ARRAY,b);k.uniform1i(k.getUniformLocation(za,"img_common"),0);Yc(1);rd||(J(c),k.activeTexture(k.TEXTURE3),b=k.createTexture(),k.bindTexture(k.TEXTURE_2D,b),k.texImage2D(k.TEXTURE_2D,0,k.R16F,c.length,1,0,k.RED,k.FLOAT,
c),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.bindTexture(k.TEXTURE_2D,null),k.bindTexture(k.TEXTURE_2D,b),k.uniform1i(k.getUniformLocation(Ba,"delay"),3),k.activeTexture(k.TEXTURE2),Rg=k.createTexture(),k.bindTexture(k.TEXTURE_2D,Rg),k.texImage2D(k.TEXTURE_2D,0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,new Uint8Array([255,
255,255,255])),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.clearColor(0,0,0,1));k.bindFramebuffer(k.FRAMEBUFFER,Ia);Ia.width=1;Ia.height=1;k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,r,0);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);k.bindFramebuffer(k.FRAMEBUFFER,null);new Float32Array(8);
Sg=k.createBuffer();Tg=k.createBuffer();Mi=k.createBuffer();q=0;for(t=Ug.length;q<t;q++)mb(Ug[q]);k.enable(k.DEPTH_TEST);k.depthFunc(k.LEQUAL);Eb.fp1000=1E3;Eb.delta=0;Eb.now=0;Eb.frameCount=0;k.bindTexture(k.TEXTURE_2D,r);rd=S.setup=!0}function xd(c,b){Vg();var e=b||xd,f=function(){e(c,b)};if(!Ni()){if("true"==localStorage.fullscreen){var g=document.documentElement;g.requestFullscreen?g.requestFullscreen():g.msRequestFullscreen?g.msRequestFullscreen():g.mozRequestFullScreen?g.mozRequestFullScreen():
g.webkitRequestFullscreen&&g.webkitRequestFullscreen()}p.editor?(v.marx=0,v.mary=60,r("saveGame").innerHTML=u.save,v.menumy=60,Lb=Vb=171,v.mx=171,v.menumx=171):(v.mx=151,Lb=Vb=128,v.menumx=151,v.menumy=0,r("saveGame").innerHTML=u.savegame,v.marx=4,v.mary=31);Zc.style.width=Vb+"px";Zc.style.height=Lb+"px";Zc.style.left=v.marx+"px";Zc.style.top=v.mary+"px";Tb();r("loading").style.display="block";origin=!1;J(S.load,S.images);if(S.load<S.images||!S.images)return S.started||(r("qdgraphics")&&(r("qdgraphics").style.display=
"none"),Oi()),r("loadingtext").innerHTML=u.waitImages,Wb=f,!1;void 0===p.arje&&Xd();if(Wg.last!==p.terrainType)return Wg.last=p.terrainType,Xg=!0,r("loadingtext").innerHTML="Downloading terrain",ql(),Wb=f,!1;rl();r("notifybottom").style.display="none";p.demo?r("saveGame").style.display="none":r("saveGame").style.display="block";if(p.custom){var d=0==p.cycle?p.kingdomStart||p.kingdoms:p.kingdoms;f=0;for(g=d.length;f<g;f++){p.online&&aa[f]&&!aa[f].name&&(d[f].IA=!1);var l=new Xb("",d[f].color,[0],!0);
Object.assign(l,d[f]);l.values.pop=0;null==l.resources[0]&&(l.resources[0]=Infinity);null==l.resources[1]&&(l.resources[1]=Infinity);null==l.resources[2]&&(l.resources[2]=Infinity);null==l.resources[3]&&(l.resources[3]=Infinity)}}else for(f=0,g=ra.length;f<g;f++){d=ra[f];l=[0];for(var q=0;q<g;q++)l[q+1]=ra[q].team==d.team?0:1;p.online&&d.id===v.onlineID&&(v.kingdom=f+1);new Xb(d.name,Yg(d.color),l,d.race,d.IA,[p.goldRes,p.woodRes,p.foodRes,p.stoneRes],d.team)}p.rules?sl(p.rules):Yd=void 0;v.kingdom||
(v.kingdom=1);Pi();return!0}}function Qi(){r("playingMenu").style.display="block";Tb()}function tl(c){J("setup:",c);c.toSend=[];c.orderList=[];var b=La.roomName;b=b.substr(0,b.length-1);c.id==b&&(c.admin=!0);c.sendDirectly("channelMessage","nehhof",{});J(c.channels.channelMessage);c.channels.channelMessage.onopen=function(){qa.put(c);va("attack");Zg(1);J("DATACHANNEL OPEN");setTimeout(function(){I(Zd,pf(),0,[c]);v.admin&&(I(qf,v.room.max,0,[c]),ea?Ri(ea.compressed):I($c,p,!1),aa.put(c.id),I(Fb,aa,
0))},500)};c.channels.channelMessage.onerror=function(c){J(c)}}function Si(){document.getElementById("buttons").innerHTML="";document.getElementById("gameName").innerHTML=""}function $g(){v.p2p?(wb(),v.p2p.emit("getRooms"),r("returnmenu").style.display="block"):(La||qc(),qc.func=$g)}function Ti(){var c=location,b=c.hash.substr(1);""==b&&(document.getElementById("returnmenu").style.display="none");if("MatchX"==b.substr(0,6))6<b.length&&ul(b.substr(6-b.length));else if("Room"==c.hash.substr(-4))c=c.hash.substr(1),
v.admin||Ui(c.substr(0,c.length-4));else if(Vi[b])Vi[b]();else c.hash=""}function Wi(c){c=document.getElementById(c);c.style.display="none"==c.style.display?"block":"none"}function ah(c){c.style.display="none"==c.style.display?"block":"none"}function Xi(c){U=function(){};Yb=!1;var b=L;b.d=c.d;na(b,c.img);b.active=!0;Ua=x[52];$d=c;document.addEventListener("mousemove",bh);document.addEventListener("mousedown",rf)}function vl(c,b){return c.innerHTML-b.innerHTML}var xl=function(){(function(c){"object"===
typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define([],c):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).SimpleWebRTC=c()})(function(){return function g(b,e,f){function d(h,q){if(!e[h]){if(!b[h]){var t="function"==typeof require&&require;if(!q&&t)return t(h,!0);if(l)return l(h,!0);q=Error("Cannot find module '"+h+"'");throw q.code="MODULE_NOT_FOUND",q;}q=e[h]={exports:{}};b[h][0].call(q.exports,
function(f){var g=b[h][1][f];return d(g?g:f)},q,q.exports,g,b,e,f)}return e[h].exports}for(var l="function"==typeof require&&require,q=0;q<f.length;q++)d(f[q]);return d}({1:[function(b,e,f){function g(){}e.exports=function(b,f,e){function d(b,g){if(0>=d.count)throw Error("after called too many times");--d.count;b?(h=!0,f(b),f=e):0!==d.count||h||f(null,g)}var h=!1;e=e||g;d.count=b;return 0===b?f():d}},{}],2:[function(b,e,f){e.exports=function(b,f,e){var g=b.byteLength;f=f||0;e=e||g;if(b.slice)return b.slice(f,
e);0>f&&(f+=g);0>e&&(e+=g);e>g&&(e=g);if(f>=g||f>=e||0===g)return new ArrayBuffer(0);b=new Uint8Array(b);g=new Uint8Array(e-f);for(var d=0;f<e;f++,d++)g[d]=b[f];return g.buffer}},{}],3:[function(b,e,f){e.exports=function(b,f,e){var g,d=f;f={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};if(e)for(g in e)f[g]=e[g];d?"audio"===d.tagName.toLowerCase()&&(f.audio=!0):d=document.createElement(f.audio?"audio":"video");f.disableContextMenu&&(d.oncontextmenu=function(b){b.preventDefault()});
f.autoplay&&(d.autoplay="autoplay");f.muted&&(d.muted=!0);!f.audio&&f.mirror&&["","moz","webkit","o","ms"].forEach(function(b){d.style[b?b+"Transform":"transform"]="scaleX(-1)"});d.srcObject=b;return d}},{}],4:[function(b,e,f){function g(b){b=b||{};this.ms=b.min||100;this.max=b.max||1E4;this.factor=b.factor||2;this.jitter=0<b.jitter&&1>=b.jitter?b.jitter:0;this.attempts=0}e.exports=g;g.prototype.duration=function(){var b=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var f=Math.random(),
e=Math.floor(f*this.jitter*b);b=0==(Math.floor(10*f)&1)?b-e:b+e}return Math.min(b,this.max)|0};g.prototype.reset=function(){this.attempts=0};g.prototype.setMin=function(b){this.ms=b};g.prototype.setMax=function(b){this.max=b};g.prototype.setJitter=function(b){this.jitter=b}},{}],5:[function(b,e,f){(function(b){f.encode=function(f){f=new Uint8Array(f);var e,g=f.length,d="";for(e=0;e<g;e+=3)d+=b[f[e]>>2],d+=b[(f[e]&3)<<4|f[e+1]>>4],d+=b[(f[e+1]&15)<<2|f[e+2]>>6],d+=b[f[e+2]&63];2===g%3?d=d.substring(0,
d.length-1)+"=":1===g%3&&(d=d.substring(0,d.length-2)+"==");return d};f.decode=function(f){var e=.75*f.length,g=f.length,d=0;"="===f[f.length-1]&&(e--,"="===f[f.length-2]&&e--);var h=new ArrayBuffer(e),B=new Uint8Array(h);for(e=0;e<g;e+=4){var F=b.indexOf(f[e]);var w=b.indexOf(f[e+1]);var Qa=b.indexOf(f[e+2]);var ec=b.indexOf(f[e+3]);B[d++]=F<<2|w>>4;B[d++]=(w&15)<<4|Qa>>2;B[d++]=(Qa&3)<<6|ec&63}return h}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],6:[function(b,e,f){(function(b){function f(b){for(var f=
0;f<b.length;f++){var e=b[f];if(e.buffer instanceof ArrayBuffer){var g=e.buffer;if(e.byteLength!==g.byteLength){var d=new Uint8Array(e.byteLength);d.set(new Uint8Array(g,e.byteOffset,e.byteLength));g=d.buffer}b[f]=g}}}function g(b,e){e=e||{};var g=new t;f(b);for(var d=0;d<b.length;d++)g.append(b[d]);return e.type?g.getBlob(e.type):g.getBlob()}function d(b,e){f(b);return new Blob(b,e||{})}var t=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder;try{var n=2===(new Blob(["hi"])).size}catch(w){n=
!1}var B;if(B=n)try{B=2===(new Blob([new Uint8Array([1,2])])).size}catch(w){B=!1}var F=t&&t.prototype.append&&t.prototype.getBlob;b=n?B?b.Blob:d:F?g:void 0;e.exports=b}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],7:[function(b,e,f){var g=[].slice;e.exports=function(b,f){"string"==typeof f&&(f=b[f]);if("function"!=typeof f)throw Error("bind() requires a function");var e=g.call(arguments,2);return function(){return f.apply(b,
e.concat(g.call(arguments)))}}},{}],8:[function(b,e,f){function g(b){if(b){for(var f in g.prototype)b[f]=g.prototype[f];return b}}e.exports=g;g.prototype.on=g.prototype.addEventListener=function(b,f){this._callbacks=this._callbacks||{};(this._callbacks[b]=this._callbacks[b]||[]).push(f);return this};g.prototype.once=function(b,f){function e(){g.off(b,e);f.apply(this,arguments)}var g=this;this._callbacks=this._callbacks||{};e.fn=f;this.on(b,e);return this};g.prototype.off=g.prototype.removeListener=
g.prototype.removeAllListeners=g.prototype.removeEventListener=function(b,f){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var e=this._callbacks[b];if(!e)return this;if(1==arguments.length)return delete this._callbacks[b],this;for(var g,d=0;d<e.length;d++)if(g=e[d],g===f||g.fn===f){e.splice(d,1);break}return this};g.prototype.emit=function(b){this._callbacks=this._callbacks||{};var f=[].slice.call(arguments,1),e=this._callbacks[b];if(e){e=e.slice(0);for(var g=
0,d=e.length;g<d;++g)e[g].apply(this,f)}return this};g.prototype.listeners=function(b){this._callbacks=this._callbacks||{};return this._callbacks[b]||[]};g.prototype.hasListeners=function(b){return!!this.listeners(b).length}},{}],9:[function(b,e,f){e.exports=function(b,f){var e=function(){};e.prototype=f.prototype;b.prototype=new e;b.prototype.constructor=b}},{}],10:[function(b,e,f){function g(b){return g.enabled(b)?function(f){f instanceof Error&&(f=f.stack||f.message);var e=new Date,d=e-(g[b]||
e);g[b]=e;f=b+" "+f+" +"+g.humanize(d);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}e.exports=g;g.names=[];g.skips=[];g.enable=function(b){try{localStorage.debug=b}catch(n){}for(var f=(b||"").split(/[\s,]+/),e=f.length,d=0;d<e;d++)b=f[d].replace("*",".*?"),"-"===b[0]?g.skips.push(new RegExp("^"+b.substr(1)+"$")):g.names.push(new RegExp("^"+b+"$"))};g.disable=function(){g.enable("")};g.humanize=function(b){return 36E5<=b?(b/36E5).toFixed(1)+
"h":6E4<=b?(b/6E4).toFixed(1)+"m":1E3<=b?(b/1E3|0)+"s":b+"ms"};g.enabled=function(b){for(var f=0,e=g.skips.length;f<e;f++)if(g.skips[f].test(b))return!1;f=0;for(e=g.names.length;f<e;f++)if(g.names[f].test(b))return!0;return!1};try{window.localStorage&&g.enable(localStorage.debug)}catch(h){}},{}],11:[function(b,e,f){e.exports=b("./lib/")},{"./lib/":12}],12:[function(b,e,f){e.exports=b("./socket");e.exports.parser=b("engine.io-parser")},{"./socket":13,"engine.io-parser":24}],13:[function(b,e,f){(function(f){function g(b,
e){if(!(this instanceof g))return new g(b,e);e=e||{};b&&"object"==typeof b&&(e=b,b=null);b&&(b=F(b),e.host=b.host,e.secure="https"==b.protocol||"wss"==b.protocol,e.port=b.port,b.query&&(e.query=b.query));this.secure=null!=e.secure?e.secure:f.location&&"https:"==location.protocol;e.host&&(b=e.host.split(":"),e.hostname=b.shift(),b.length?e.port=b.pop():e.port||(e.port=this.secure?"443":"80"));this.agent=e.agent||!1;this.hostname=e.hostname||(f.location?location.hostname:"localhost");this.port=e.port||
(f.location&&location.port?location.port:this.secure?443:80);this.query=e.query||{};"string"==typeof this.query&&(this.query=Qa.decode(this.query));this.upgrade=!1!==e.upgrade;this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!e.forceJSONP;this.jsonp=!1!==e.jsonp;this.forceBase64=!!e.forceBase64;this.enablesXDR=!!e.enablesXDR;this.timestampParam=e.timestampParam||"t";this.timestampRequests=e.timestampRequests;this.transports=e.transports||["polling","websocket"];this.readyState=
"";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=e.policyPort||843;this.rememberUpgrade=e.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=e.onlyBinaryUpgrades;this.pfx=e.pfx||null;this.key=e.key||null;this.passphrase=e.passphrase||null;this.cert=e.cert||null;this.ca=e.ca||null;this.ciphers=e.ciphers||null;this.rejectUnauthorized=e.rejectUnauthorized||null;this.open()}var d=b("./transports"),q=b("component-emitter"),t=b("debug")("engine.io-client:socket"),n=b("indexof"),
B=b("engine.io-parser"),F=b("parseuri"),w=b("parsejson"),Qa=b("parseqs");e.exports=g;g.priorWebsocketSuccess=!1;q(g.prototype);g.protocol=B.protocol;g.Socket=g;g.Transport=b("./transport");g.transports=b("./transports");g.parser=b("engine.io-parser");g.prototype.createTransport=function(b){t('creating transport "%s"',b);var e=this.query,f={},g;for(g in e)e.hasOwnProperty(g)&&(f[g]=e[g]);f.EIO=B.protocol;f.transport=b;this.id&&(f.sid=this.id);return new d[b]({agent:this.agent,hostname:this.hostname,
port:this.port,secure:this.secure,path:this.path,query:f,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})};g.prototype.open=function(){if(this.rememberUpgrade&&g.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))var b=
"websocket";else{if(0==this.transports.length){var e=this;setTimeout(function(){e.emit("error","No transports available")},0);return}b=this.transports[0]}this.readyState="opening";try{b=this.createTransport(b)}catch(Ia){this.transports.shift();this.open();return}b.open();this.setTransport(b)};g.prototype.setTransport=function(b){t("setting transport %s",b.name);var e=this;this.transport&&(t("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=b;
b.on("drain",function(){e.onDrain()}).on("packet",function(b){e.onPacket(b)}).on("error",function(b){e.onError(b)}).on("close",function(){e.onClose("transport close")})};g.prototype.probe=function(b){function e(){if(w.onlyBinaryUpgrades){var e=!this.supportsBinary&&w.transport.supportsBinary;F=F||e}F||(t('probe transport "%s" opened',b),B.send([{type:"ping",data:"probe"}]),B.once("packet",function(e){F||("pong"==e.type&&"probe"==e.data?(t('probe transport "%s" pong',b),w.upgrading=!0,w.emit("upgrading",
B),B&&(g.priorWebsocketSuccess="websocket"==B.name,t('pausing current transport "%s"',w.transport.name),w.transport.pause(function(){F||"closed"==w.readyState||(t("changing transport and sending upgrade packet"),n(),w.setTransport(B),B.send([{type:"upgrade"}]),w.emit("upgrade",B),B=null,w.upgrading=!1,w.flush())}))):(t('probe transport "%s" failed',b),e=Error("probe error"),e.transport=B.name,w.emit("upgradeError",e)))}))}function f(){F||(F=!0,n(),B.close(),B=null)}function d(e){var g=Error("probe error: "+
e);g.transport=B.name;f();t('probe transport "%s" failed because of error: %s',b,e);w.emit("upgradeError",g)}function h(){d("transport closed")}function l(){d("socket closed")}function q(b){B&&b.name!=B.name&&(t('"%s" works - aborting "%s"',b.name,B.name),f())}function n(){B.removeListener("open",e);B.removeListener("error",d);B.removeListener("close",h);w.removeListener("close",l);w.removeListener("upgrading",q)}t('probing transport "%s"',b);var B=this.createTransport(b,{probe:1}),F=!1,w=this;g.priorWebsocketSuccess=
!1;B.once("open",e);B.once("error",d);B.once("close",h);this.once("close",l);this.once("upgrading",q);B.open()};g.prototype.onOpen=function(){t("socket open");this.readyState="open";g.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){t("starting upgrade probes");for(var b=0,e=this.upgrades.length;b<e;b++)this.probe(this.upgrades[b])}};g.prototype.onPacket=function(b){if("opening"==this.readyState||
"open"==this.readyState)switch(t('socket receive: type "%s", data "%s"',b.type,b.data),this.emit("packet",b),this.emit("heartbeat"),b.type){case "open":this.onHandshake(w(b.data));break;case "pong":this.setPing();break;case "error":var e=Error("server error");e.code=b.data;this.emit("error",e);break;case "message":this.emit("data",b.data),this.emit("message",b.data)}else t('packet received with socket readyState "%s"',this.readyState)};g.prototype.onHandshake=function(b){this.emit("handshake",b);
this.id=b.sid;this.transport.query.sid=b.sid;this.upgrades=this.filterUpgrades(b.upgrades);this.pingInterval=b.pingInterval;this.pingTimeout=b.pingTimeout;this.onOpen();"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};g.prototype.onHeartbeat=function(b){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){if("closed"!=e.readyState)e.onClose("ping timeout")},b||e.pingInterval+e.pingTimeout)};
g.prototype.setPing=function(){var b=this;clearTimeout(b.pingIntervalTimer);b.pingIntervalTimer=setTimeout(function(){t("writing ping packet - expecting pong within %sms",b.pingTimeout);b.ping();b.onHeartbeat(b.pingTimeout)},b.pingInterval)};g.prototype.ping=function(){this.sendPacket("ping")};g.prototype.onDrain=function(){for(var b=0;b<this.prevBufferLen;b++)if(this.callbackBuffer[b])this.callbackBuffer[b]();this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);
this.prevBufferLen=0;0==this.writeBuffer.length?this.emit("drain"):this.flush()};g.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(t("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};g.prototype.write=g.prototype.send=function(b,e){this.sendPacket("message",b,e);return this};g.prototype.sendPacket=function(b,e,f){"closing"!=
this.readyState&&"closed"!=this.readyState&&(b={type:b,data:e},this.emit("packetCreate",b),this.writeBuffer.push(b),this.callbackBuffer.push(f),this.flush())};g.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){var b=function(){g.once("upgrade",e);g.once("upgradeError",e)},e=function(){g.removeListener("upgrade",e);g.removeListener("upgradeError",e);f()},f=function(){g.onClose("forced close");t("socket closing - telling transport to close");g.transport.close()};this.readyState=
"closing";var g=this;if(this.writeBuffer.length)this.once("drain",function(){this.upgrading?b():f()});else this.upgrading?b():f()}return this};g.prototype.onError=function(b){t("socket error %j",b);g.priorWebsocketSuccess=!1;this.emit("error",b);this.onClose("transport error",b)};g.prototype.onClose=function(b,e){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){t('socket close with reason: "%s"',b);var f=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);
setTimeout(function(){f.writeBuffer=[];f.callbackBuffer=[];f.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",b,e)}};g.prototype.filterUpgrades=function(b){for(var e=[],f=0,g=b.length;f<g;f++)~n(this.transports,b[f])&&e.push(b[f]);return e}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./transport":14,
"./transports":15,"component-emitter":8,debug:21,"engine.io-parser":24,indexof:32,parsejson:40,parseqs:41,parseuri:23}],14:[function(b,e,f){function g(b){this.path=b.path;this.hostname=b.hostname;this.port=b.port;this.secure=b.secure;this.query=b.query;this.timestampParam=b.timestampParam;this.timestampRequests=b.timestampRequests;this.readyState="";this.agent=b.agent||!1;this.socket=b.socket;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;
this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized}var d=b("engine.io-parser");b=b("component-emitter");e.exports=g;b(g.prototype);g.timestamps=0;g.prototype.onError=function(b,e){b=Error(b);b.type="TransportError";b.description=e;this.emit("error",b);return this};g.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this};g.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),
this.onClose();return this};g.prototype.send=function(b){if("open"==this.readyState)this.write(b);else throw Error("Transport not open");};g.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};g.prototype.onData=function(b){b=d.decodePacket(b,this.socket.binaryType);this.onPacket(b)};g.prototype.onPacket=function(b){this.emit("packet",b)};g.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,"engine.io-parser":24}],15:[function(b,
e,f){(function(e){var g=b("xmlhttprequest"),d=b("./polling-xhr"),q=b("./polling-jsonp"),t=b("./websocket");f.polling=function(b){var f=!1,h=!1,l=!1!==b.jsonp;e.location&&(h="https:"==location.protocol,(f=location.port)||(f=h?443:80),f=b.hostname!=location.hostname||f!=b.port,h=b.secure!=h);b.xdomain=f;b.xscheme=h;if("open"in new g(b)&&!b.forceJSONP)return new d(b);if(!l)throw Error("JSONP disabled");return new q(b)};f.websocket=t}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(b,e,f){(function(f){function g(){}function d(b){q.call(this,b);this.query=this.query||{};F||(f.___eio||(f.___eio=[]),F=f.___eio);this.index=F.length;var e=this;F.push(function(b){e.onData(b)});this.query.j=this.index;f.document&&f.addEventListener&&f.addEventListener("beforeunload",function(){e.script&&(e.script.onerror=g)},!1)}var q=b("./polling"),t=b("component-inherit");
e.exports=d;var n=/\n/g,B=/\\n/g,F;t(d,q);d.prototype.supportsBinary=!1;d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.iframe=this.form=null);q.prototype.doClose.call(this)};d.prototype.doPoll=function(){var b=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);e.async=!0;e.src=this.uri();e.onerror=function(e){b.onError("jsonp poll error",
e)};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(e,f);this.script=e;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var b=document.createElement("iframe");document.body.appendChild(b);document.body.removeChild(b)},100)};d.prototype.doWrite=function(b,e){function f(){g();e()}function g(){if(d.iframe)try{d.form.removeChild(d.iframe)}catch(ch){d.onError("jsonp polling iframe removal error",ch)}try{t=document.createElement('<iframe src="javascript:0" name="'+
d.iframeId+'">')}catch(ch){t=document.createElement("iframe"),t.name=d.iframeId,t.src="javascript:0"}t.id=d.iframeId;d.form.appendChild(t);d.iframe=t}var d=this;if(!this.form){var h=document.createElement("form"),l=document.createElement("textarea"),q=this.iframeId="eio_iframe_"+this.index,t;h.className="socketio";h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=q;h.method="POST";h.setAttribute("accept-charset","utf-8");l.name="d";h.appendChild(l);document.body.appendChild(h);
this.form=h;this.area=l}this.form.action=this.uri();g();b=b.replace(B,"\\\n");this.area.value=b.replace(n,"\\n");try{this.form.submit()}catch(ch){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==d.iframe.readyState&&f()}:this.iframe.onload=f}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-inherit":9}],17:[function(b,e,f){(function(f){function g(){}function d(b){B.call(this,
b);if(f.location){var e="https:"==location.protocol,g=location.port;g||(g=e?443:80);this.xd=b.hostname!=f.location.hostname||g!=b.port;this.xs=b.secure!=e}}function q(b){this.method=b.method||"GET";this.uri=b.uri;this.xd=!!b.xd;this.xs=!!b.xs;this.async=!1!==b.async;this.data=void 0!=b.data?b.data:null;this.agent=b.agent;this.isBinary=b.isBinary;this.supportsBinary=b.supportsBinary;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;
this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized;this.create()}function t(){for(var b in q.requests)q.requests.hasOwnProperty(b)&&q.requests[b].abort()}var n=b("xmlhttprequest"),B=b("./polling"),F=b("component-emitter"),w=b("component-inherit"),Qa=b("debug")("engine.io-client:polling-xhr");e.exports=d;e.exports.Request=q;w(d,B);d.prototype.supportsBinary=!0;d.prototype.request=function(b){b=b||{};b.uri=this.uri();b.xd=this.xd;b.xs=this.xs;b.agent=this.agent||!1;b.supportsBinary=
this.supportsBinary;b.enablesXDR=this.enablesXDR;b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;return new q(b)};d.prototype.doWrite=function(b,e){b=this.request({method:"POST",data:b,isBinary:"string"!==typeof b&&void 0!==b});var f=this;b.on("success",e);b.on("error",function(b){f.onError("xhr post error",b)});this.sendXhr=b};d.prototype.doPoll=function(){Qa("xhr poll");var b=this.request(),
e=this;b.on("data",function(b){e.onData(b)});b.on("error",function(b){e.onError("xhr poll error",b)});this.pollXhr=b};F(q.prototype);q.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new n(b),g=this;try{Qa("xhr open %s: %s",this.method,this.uri);e.open(this.method,
this.uri,this.async);this.supportsBinary&&(e.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Qg){}"withCredentials"in e&&(e.withCredentials=!0);this.hasXDR()?(e.onload=function(){g.onLoad()},e.onerror=function(){g.onError(e.responseText)}):e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status||1223==e.status)g.onLoad();else setTimeout(function(){g.onError(e.status)},
0)};Qa("xhr data %s",this.data);e.send(this.data)}catch(Qg){setTimeout(function(){g.onError(Qg)},0);return}f.document&&(this.index=q.requestsCount++,q.requests[this.index]=this)};q.prototype.onSuccess=function(){this.emit("success");this.cleanup()};q.prototype.onData=function(b){this.emit("data",b);this.onSuccess()};q.prototype.onError=function(b){this.emit("error",b);this.cleanup(!0)};q.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=
this.xhr.onerror=g:this.xhr.onreadystatechange=g;if(b)try{this.xhr.abort()}catch(fc){}f.document&&delete q.requests[this.index];this.xhr=null}};q.prototype.onLoad=function(){try{try{var b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(Ia){}var e="application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(Ia){this.onError(Ia)}if(null!=e)this.onData(e)};q.prototype.hasXDR=function(){return"undefined"!==typeof f.XDomainRequest&&!this.xs&&this.enablesXDR};
q.prototype.abort=function(){this.cleanup()};f.document&&(q.requestsCount=0,q.requests={},f.attachEvent?f.attachEvent("onunload",t):f.addEventListener&&f.addEventListener("beforeunload",t,!1))}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-emitter":8,"component-inherit":9,debug:21,xmlhttprequest:20}],18:[function(b,e,f){function g(b){var e=b&&b.forceBase64;if(!n||e)this.supportsBinary=!1;d.call(this,
b)}var d=b("../transport"),l=b("parseqs"),q=b("engine.io-parser");f=b("component-inherit");var t=b("debug")("engine.io-client:polling");e.exports=g;var n=null!=(new (b("xmlhttprequest"))({xdomain:!1})).responseType;f(g,d);g.prototype.name="polling";g.prototype.doOpen=function(){this.poll()};g.prototype.pause=function(b){function e(){t("paused");f.readyState="paused";b()}var f=this;this.readyState="pausing";if(this.polling||!this.writable){var g=0;this.polling&&(t("we are currently polling - waiting to pause"),
g++,this.once("pollComplete",function(){t("pre-pause polling complete");--g||e()}));this.writable||(t("we are currently writing - waiting to pause"),g++,this.once("drain",function(){t("pre-pause writing complete");--g||e()}))}else e()};g.prototype.poll=function(){t("polling");this.polling=!0;this.doPoll();this.emit("poll")};g.prototype.onData=function(b){var e=this;t("polling got data %s",b);q.decodePayload(b,this.socket.binaryType,function(b,f,g){if("opening"==e.readyState)e.onOpen();if("close"==
b.type)return e.onClose(),!1;e.onPacket(b)});"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():t('ignoring poll - transport state "%s"',this.readyState))};g.prototype.doClose=function(){function b(){t("writing close packet");e.write([{type:"close"}])}var e=this;"open"==this.readyState?(t("transport open - closing"),b()):(t("transport not open - deferring close"),this.once("open",b))};g.prototype.write=function(b){var e=this;this.writable=!1;
var f=function(){e.writable=!0;e.emit("drain")};e=this;q.encodePayload(b,this.supportsBinary,function(b){e.doWrite(b,f)})};g.prototype.uri=function(){var b=this.query||{},e=this.secure?"https":"http",f="";!1!==this.timestampRequests&&(b[this.timestampParam]=+new Date+"-"+d.timestamps++);this.supportsBinary||b.sid||(b.b64=1);b=l.encode(b);this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(f=":"+this.port);b.length&&(b="?"+b);return e+"://"+this.hostname+f+this.path+b}},{"../transport":14,
"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,xmlhttprequest:20}],19:[function(b,e,f){function g(b){b&&b.forceBase64&&(this.supportsBinary=!1);d.call(this,b)}var d=b("../transport"),l=b("engine.io-parser"),q=b("parseqs");f=b("component-inherit");var t=b("debug")("engine.io-client:websocket"),n=b("ws");e.exports=g;f(g,d);g.prototype.name="websocket";g.prototype.supportsBinary=!0;g.prototype.doOpen=function(){if(this.check()){var b=this.uri(),e={agent:this.agent};e.pfx=this.pfx;e.key=
this.key;e.passphrase=this.passphrase;e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;this.ws=new n(b,void 0,e);void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.binaryType="arraybuffer";this.addEventListeners()}};g.prototype.addEventListeners=function(){var b=this;this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(){b.onClose()};this.ws.onmessage=function(e){b.onData(e.data)};this.ws.onerror=function(e){b.onError("websocket error",
e)}};"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(g.prototype.onData=function(b){var e=this;setTimeout(function(){d.prototype.onData.call(e,b)},0)});g.prototype.write=function(b){var e=this;this.writable=!1;for(var f=0,g=b.length;f<g;f++)l.encodePacket(b[f],this.supportsBinary,function(b){try{e.ws.send(b)}catch(fc){t("websocket closed before onclose event")}});setTimeout(function(){e.writable=!0;e.emit("drain")},0)};g.prototype.onClose=function(){d.prototype.onClose.call(this)};
g.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()};g.prototype.uri=function(){var b=this.query||{},e=this.secure?"wss":"ws",f="";this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(f=":"+this.port);this.timestampRequests&&(b[this.timestampParam]=+new Date);this.supportsBinary||(b.b64=1);b=q.encode(b);b.length&&(b="?"+b);return e+"://"+this.hostname+f+this.path+b};g.prototype.check=function(){return!!n&&!("__initialize"in n&&this.name===g.prototype.name)}},{"../transport":14,
"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,ws:66}],20:[function(b,e,f){var g=b("has-cors");e.exports=function(b){var e=b.xdomain,f=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||g))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!f&&b)return new XDomainRequest}catch(t){}if(!e)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}},{"has-cors":31}],21:[function(b,e,f){function g(){try{var b=localStorage.debug}catch(l){}return b}
f=e.exports=b("./debug");f.log=function(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)};f.formatArgs=function(){var b=arguments,e=this.useColors;b[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+b[0]+(e?"%c ":" ")+"+"+f.humanize(this.diff);if(!e)return b;e="color: "+this.color;b=[b[0],e,"color: inherit"].concat(Array.prototype.slice.call(b,1));var g=0,d=0;b[0].replace(/%[a-z%]/g,function(b){"%%"!==b&&(g++,"%c"===b&&(d=g))});
b.splice(d,0,e);return b};f.save=function(b){try{null==b?localStorage.removeItem("debug"):localStorage.debug=b}catch(l){}};f.load=g;f.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)};f.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");f.formatters.j=function(b){return JSON.stringify(b)};
f.enable(g())},{"./debug":22}],22:[function(b,e,f){f=e.exports=function(b){function e(){}function h(){var b=+new Date;h.diff=b-(d||b);h.prev=d;d=h.curr=b;null==h.useColors&&(h.useColors=f.useColors());null==h.color&&h.useColors&&(h.color=f.colors[g++%f.colors.length]);var e=Array.prototype.slice.call(arguments);e[0]=f.coerce(e[0]);"string"!==typeof e[0]&&(e=["%o"].concat(e));var l=0;e[0]=e[0].replace(/%([a-z%])/g,function(b,g){if("%%"===b)return b;l++;g=f.formatters[g];"function"===typeof g&&(b=g.call(h,
e[l]),e.splice(l,1),l--);return b});"function"===typeof f.formatArgs&&(e=f.formatArgs.apply(h,e));(h.log||f.log||console.log.bind(console)).apply(h,e)}e.enabled=!1;h.enabled=!0;var l=f.enabled(b)?h:e;l.namespace=b;return l};f.coerce=function(b){return b instanceof Error?b.stack||b.message:b};f.disable=function(){f.enable("")};f.enable=function(b){f.save(b);for(var e=(b||"").split(/[\s,]+/),g=e.length,d=0;d<g;d++)e[d]&&(b=e[d].replace(/\*/g,".*?"),"-"===b[0]?f.skips.push(new RegExp("^"+b.substr(1)+
"$")):f.names.push(new RegExp("^"+b+"$")))};f.enabled=function(b){var e;var g=0;for(e=f.skips.length;g<e;g++)if(f.skips[g].test(b))return!1;g=0;for(e=f.names.length;g<e;g++)if(f.names[g].test(b))return!0;return!1};f.humanize=b("ms");f.names=[];f.skips=[];f.formatters={};var g=0,d},{ms:38}],23:[function(b,e,f){var g=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
d="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");e.exports=function(b){var e=b,f=b.indexOf("["),h=b.indexOf("]");-1!=f&&-1!=h&&(b=b.substring(0,f)+b.substring(f,h).replace(/:/g,";")+b.substring(h,b.length));b=g.exec(b||"");for(var l={},F=14;F--;)l[d[F]]=b[F]||"";-1!=f&&-1!=h&&(l.source=e,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=
!0);return l}},{}],24:[function(b,e,f){(function(e){function g(b,e,g){if(!e)return f.encodeBase64Packet(b,g);var d=new FileReader;d.onload=function(){b.data=d.result;f.encodePacket(b,e,!0,g)};return d.readAsArrayBuffer(b.data)}function d(b,e,f){var g=Array(b.length);f=F(b.length,f);for(var d=function(b,f,d){e(f,function(e,f){g[b]=f;d(e,g)})},h=0;h<b.length;h++)d(h,b[h],f)}var q=b("./keys"),t=b("has-binary"),n=b("arraybuffer.slice"),B=b("base64-arraybuffer"),F=b("after"),w=b("utf8"),Qa=navigator.userAgent.match(/Android/i),
k=/PhantomJS/i.test(navigator.userAgent),m=Qa||k;f.protocol=3;var p=f.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},r=q(p),ka={type:"error",data:"parser error"},H=b("blob");f.encodePacket=function(b,d,h,l){"function"==typeof d&&(l=d,d=!1);"function"==typeof h&&(l=h,h=null);var q=void 0===b.data?void 0:b.data.buffer||b.data;if(e.ArrayBuffer&&q instanceof ArrayBuffer){if(d){h=b.data;d=new Uint8Array(h);h=new Uint8Array(1+h.byteLength);h[0]=p[b.type];for(b=0;b<d.length;b++)h[b+1]=
d[b];b=l(h.buffer)}else b=f.encodeBase64Packet(b,l);return b}if(H&&q instanceof e.Blob)return d?m?b=g(b,d,l):(d=new Uint8Array(1),d[0]=p[b.type],b=new H([d.buffer,b.data]),b=l(b)):b=f.encodeBase64Packet(b,l),b;if(q&&q.base64)return l("b"+f.packets[b.type]+b.data.data);d=p[b.type];void 0!==b.data&&(d+=h?w.encode(String(b.data)):String(b.data));return l(""+d)};f.encodeBase64Packet=function(b,g){var d="b"+f.packets[b.type];if(H&&b.data instanceof H){var h=new FileReader;h.onload=function(){var b=h.result.split(",")[1];
g(d+b)};return h.readAsDataURL(b.data)}try{var l=String.fromCharCode.apply(null,new Uint8Array(b.data))}catch(Zm){b=new Uint8Array(b.data);l=Array(b.length);for(var q=0;q<b.length;q++)l[q]=b[q];l=String.fromCharCode.apply(null,l)}d+=e.btoa(l);return g(d)};f.decodePacket=function(b,e,g){if("string"==typeof b||void 0===b){if("b"==b.charAt(0))return f.decodeBase64Packet(b.substr(1),e);if(g)try{b=w.decode(b)}catch(Ym){return ka}g=b.charAt(0);return Number(g)==g&&r[g]?1<b.length?{type:r[g],data:b.substring(1)}:
{type:r[g]}:ka}g=(new Uint8Array(b))[0];b=n(b,1);H&&"blob"===e&&(b=new H([b]));return{type:r[g],data:b}};f.decodeBase64Packet=function(b,f){var g=r[b.charAt(0)];if(!e.ArrayBuffer)return{type:g,data:{base64:!0,data:b.substr(1)}};b=B.decode(b.substr(1));"blob"===f&&H&&(b=new H([b]));return{type:g,data:b}};f.encodePayload=function(b,e,g){"function"==typeof e&&(g=e,e=null);var h=t(b);if(e&&h)return H&&!m?f.encodePayloadAsBlob(b,g):f.encodePayloadAsArrayBuffer(b,g);if(!b.length)return g("0:");d(b,function(b,
g){f.encodePacket(b,h?e:!1,!0,function(b){g(null,b.length+":"+b)})},function(b,e){return g(e.join(""))})};f.decodePayload=function(b,e,g){if("string"!=typeof b)return f.decodePayloadAsBinary(b,e,g);"function"===typeof e&&(g=e,e=null);if(""==b)return g(ka,0,1);var d="";for(var h,l,q=0,n=b.length;q<n;q++)if(l=b.charAt(q),":"!=l)d+=l;else{if(""==d||d!=(h=Number(d)))return g(ka,0,1);l=b.substr(q+1,h);if(d!=l.length)return g(ka,0,1);if(l.length){d=f.decodePacket(l,e,!0);if(ka.type==d.type&&ka.data==d.data)return g(ka,
0,1);if(!1===g(d,q+h,n))return}q+=h;d=""}if(""!=d)return g(ka,0,1)};f.encodePayloadAsArrayBuffer=function(b,e){if(!b.length)return e(new ArrayBuffer(0));d(b,function(b,e){f.encodePacket(b,!0,!0,function(b){return e(null,b)})},function(b,f){b=f.reduce(function(b,e){e="string"===typeof e?e.length:e.byteLength;return b+e.toString().length+e+2},0);var g=new Uint8Array(b),d=0;f.forEach(function(b){var e="string"===typeof b,f=b;if(e){f=new Uint8Array(b.length);for(var h=0;h<b.length;h++)f[h]=b.charCodeAt(h);
f=f.buffer}e?g[d++]=0:g[d++]=1;b=f.byteLength.toString();for(h=0;h<b.length;h++)g[d++]=parseInt(b[h]);g[d++]=255;f=new Uint8Array(f);for(h=0;h<f.length;h++)g[d++]=f[h]});return e(g.buffer)})};f.encodePayloadAsBlob=function(b,e){d(b,function(b,e){f.encodePacket(b,!0,!0,function(b){var f=new Uint8Array(1);f[0]=1;if("string"===typeof b){for(var g=new Uint8Array(b.length),d=0;d<b.length;d++)g[d]=b.charCodeAt(d);b=g.buffer;f[0]=0}g=(b instanceof ArrayBuffer?b.byteLength:b.size).toString();var h=new Uint8Array(g.length+
1);for(d=0;d<g.length;d++)h[d]=parseInt(g[d]);h[g.length]=255;H&&(b=new H([f.buffer,h.buffer,b]),e(null,b))})},function(b,f){return e(new H(f))})};f.decodePayloadAsBinary=function(b,e,g){"function"===typeof e&&(g=e,e=null);for(var d=[],h=!1;0<b.byteLength;){for(var l=new Uint8Array(b),q=0===l[0],t="",B=1;255!=l[B];B++){if(310<t.length){h=!0;break}t+=l[B]}if(h)return g(ka,0,1);b=n(b,2+t.length);t=parseInt(t);l=n(b,0,t);if(q)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch($m){for(q=new Uint8Array(l),
l="",B=0;B<q.length;B++)l+=String.fromCharCode(q[B])}d.push(l);b=n(b,t)}var F=d.length;d.forEach(function(b,d){g(f.decodePacket(b,e,!0),d,F)})}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./keys":25,after:1,"arraybuffer.slice":2,"base64-arraybuffer":5,blob:6,"has-binary":30,utf8:60}],25:[function(b,e,f){e.exports=Object.keys||function(b){var e=[],f=Object.prototype.hasOwnProperty,g;for(g in b)f.call(b,g)&&e.push(g);return e}},
{}],26:[function(b,e,f){function g(b){l.call(this);b=b||{};this.config={chunksize:16384,pacing:0};for(var e in b)this.config[e]=b[e];this.channel=this.file=null}function d(){l.call(this);this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null}var l=b("wildemitter");b=b("util");b.inherits(g,l);g.prototype.send=function(b,e){var f=this;this.file=b;this.channel=e;var g="number"!==typeof e.bufferedAmountLowThreshold,d=0,h=function(){var l=new window.FileReader;l.onload=function(){return function(l){f.channel.send(l.target.result);
f.emit("progress",d,b.size,l.target.result);b.size>d+l.target.result.byteLength?g?window.setTimeout(h,f.config.pacing):e.bufferedAmount<=e.bufferedAmountLowThreshold&&window.setTimeout(h,0):(f.emit("progress",b.size,b.size,null),f.emit("sentFile"));d+=f.config.chunksize}}(b);var q=b.slice(d,d+f.config.chunksize);l.readAsArrayBuffer(q)};g||(e.bufferedAmountLowThreshold=8*this.config.chunksize,e.addEventListener("bufferedamountlow",h));window.setTimeout(h,0)};b.inherits(d,l);d.prototype.receive=function(b,
e){var f=this;b&&(this.metadata=b);this.channel=e;e.binaryType="arraybuffer";this.channel.onmessage=function(b){f.received+=b.data.byteLength;f.receiveBuffer.push(b.data);f.emit("progress",f.received,f.metadata.size,b.data);f.received===f.metadata.size?(f.emit("receivedFile",new window.Blob(f.receiveBuffer),f.metadata),f.receiveBuffer=[]):f.received>f.metadata.size&&(console.error("received more than expected, discarding..."),f.receiveBuffer=[])}};e.exports={};e.exports.support="undefined"!==typeof window&&
window&&window.File&&window.FileReader&&window.Blob;e.exports.Sender=g;e.exports.Receiver=d},{util:63,wildemitter:65}],27:[function(b,e,f){var g={};e.exports=function(b,e){var f=2===arguments.length,d=f?e:b;if("undefined"===typeof window||"http:"===window.location.protocol){var h=Error("NavigatorUserMediaError");h.name="HTTPS_REQUIRED";return d(h)}if(window.navigator.userAgent.match("Chrome")){var l=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),F=33,w=!window.chrome.webstore;window.navigator.userAgent.match("Linux")&&
(F=35);sessionStorage.getScreenMediaJSExtensionId?chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(e){e&&""!==e.sourceId?(b=f&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}},b.video.mandatory.chromeMediaSourceId=e.sourceId,window.navigator.mediaDevices.getUserMedia(b).then(function(b){d(null,b)}).catch(function(b){d(b)})):(e=Error("NavigatorUserMediaError"),
e.name="NotAllowedError",d(e))}):window.cefGetScreenMedia?window.cefGetScreenMedia(function(e){e?(b=f&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},b.video.mandatory.chromeMediaSourceId=e,window.navigator.mediaDevices.getUserMedia(b).then(function(b){d(null,b)}).catch(function(b){d(b)})):(e=Error("cefGetScreenMediaError"),e.name="CEF_GETSCREENMEDIA_CANCELED",
d(e))}):w||26<=l&&l<=F?(b=f&&b||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){d(null,b)}).catch(function(b){d(b)})):(l=window.setTimeout(function(){h=Error("NavigatorUserMediaError");h.name="EXTENSION_UNAVAILABLE";return d(h)},1E3),g[l]=[d,f?b:null],window.postMessage({type:"getScreen",id:l},"*"))}else window.navigator.userAgent.match("Firefox")&&
(33<=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)?(b=f&&b||{video:{mozMediaSource:"window",mediaSource:"window"}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){d(null,b);var e=b.currentTime,f=window.setInterval(function(){b||window.clearInterval(f);if(b.currentTime==e&&(window.clearInterval(f),b.onended))b.onended();e=b.currentTime},500)}).catch(function(b){d(b)})):(h=Error("NavigatorUserMediaError"),h.name="EXTENSION_UNAVAILABLE"))};"undefined"!==typeof window&&
window.addEventListener("message",function(b){if(b.origin==window.location.origin)if("gotScreen"==b.data.type&&g[b.data.id]){var e=g[b.data.id],f=e[1],d=e[0];delete g[b.data.id];""===b.data.sourceId?(b=Error("NavigatorUserMediaError"),b.name="NotAllowedError",d(b)):(f=f||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},f.video.mandatory.chromeMediaSourceId=
b.data.sourceId,window.navigator.mediaDevices.getUserMedia(f).then(function(b){d(null,b)}).catch(function(b){d(b)}))}else"getScreenPending"==b.data.type&&window.clearTimeout(b.data.id)})},{}],28:[function(b,e,f){e.exports=function(){return this}()},{}],29:[function(b,e,f){var d=b("wildemitter"),h;"undefined"!==typeof window&&(h=window.AudioContext||window.webkitAudioContext);var l=null;e.exports=function(b,e){var f=new d;if(!h)return f;e=e||{};var g=e.smoothing||.1,q=e.interval||50,t=e.threshold,
Qa=e.play;e=e.history||10;var k=!0;l||(l=new h);var m=l.createAnalyser();m.fftSize=512;m.smoothingTimeConstant=g;var p=new Float32Array(m.frequencyBinCount);b.jquery&&(b=b[0]);if(b instanceof HTMLAudioElement||b instanceof HTMLVideoElement){var r=l.createMediaElementSource(b);"undefined"===typeof Qa&&(Qa=!0)}else r=l.createMediaStreamSource(b);t=t||-50;r.connect(m);Qa&&m.connect(l.destination);f.speaking=!1;f.setThreshold=function(b){t=b};f.setInterval=function(b){q=b};f.stop=function(){k=!1;f.emit("volume_change",
-100,t);f.speaking&&(f.speaking=!1,f.emit("stopped_speaking"));m.disconnect();r.disconnect()};f.speakingHistory=[];for(b=0;b<e;b++)f.speakingHistory.push(0);var ka=function(){setTimeout(function(){if(k){var b=-Infinity;m.getFloatFrequencyData(p);for(var e=4,d=p.length;e<d;e++)p[e]>b&&0>p[e]&&(b=p[e]);f.emit("volume_change",b,t);e=0;if(b>t&&!f.speaking){for(d=f.speakingHistory.length-3;d<f.speakingHistory.length;d++)e+=f.speakingHistory[d];2<=e&&(f.speaking=!0,f.emit("speaking"))}else if(b<t&&f.speaking){for(d=
0;d<f.speakingHistory.length;d++)e+=f.speakingHistory[d];0==e&&(f.speaking=!1,f.emit("stopped_speaking"))}f.speakingHistory.shift();f.speakingHistory.push(0+(b>t));ka()}},q)};ka();return f}},{wildemitter:65}],30:[function(b,e,f){(function(f){var d=b("isarray");e.exports=function(b){function e(b){if(!b)return!1;if(f.Buffer&&f.Buffer.isBuffer(b)||f.ArrayBuffer&&b instanceof ArrayBuffer||f.Blob&&b instanceof Blob||f.File&&b instanceof File)return!0;if(d(b))for(var g=0;g<b.length;g++){if(e(b[g]))return!0}else if(b&&
"object"==typeof b)for(g in b.toJSON&&(b=b.toJSON()),b)if(Object.prototype.hasOwnProperty.call(b,g)&&e(b[g]))return!0;return!1}return e(b)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{isarray:33}],31:[function(b,e,f){b=b("global");try{e.exports="XMLHttpRequest"in b&&"withCredentials"in new b.XMLHttpRequest}catch(g){e.exports=!1}},{global:28}],32:[function(b,e,f){var d=[].indexOf;e.exports=function(b,e){if(d)return b.indexOf(e);
for(var f=0;f<b.length;++f)if(b[f]===e)return f;return-1}},{}],33:[function(b,e,f){e.exports=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)}},{}],34:[function(b,e,f){(function(b){function e(b){if(e[b]!==t)return e[b];if("bug-string-char-index"==b)var f=!1;else if("json"==b)f=e("json-stringify")&&e("json-parse");else{var g;if("json-stringify"==b){f=B.stringify;var h="function"==typeof f&&F;if(h){(g=function(){return 1}).toJSON=g;try{h="0"===f(0)&&"0"===f(new Number)&&
'""'==f(new String)&&f(d)===t&&f(t)===t&&f()===t&&"1"===f(g)&&"[1]"==f([g])&&"[null]"==f([t])&&"null"==f(null)&&"[null,null,null]"==f([t,d,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==f({a:[g,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===f(null,g)&&"[\n 1,\n 2\n]"==f([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==f(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==f(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==f(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==f(new Date(-1))}catch(sf){h=
!1}}f=h}if("json-parse"==b){f=B.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){g=f('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var l=5==g.a.length&&1===g.a[0];if(l){try{l=!f('"\t"')}catch(sf){}if(l)try{l=1!==f("01")}catch(sf){}if(l)try{l=1!==f("1.")}catch(sf){}}}}catch(sf){l=!1}f=l}}return e[b]=!!f}var d={}.toString,g,t,n="object"==typeof JSON&&JSON,B="object"==typeof f&&f&&!f.nodeType&&f;B&&n?(B.stringify=n.stringify,B.parse=n.parse):B=b.JSON=n||{};var F=new Date(-0xc782b5b800cec);
try{F=-109252==F.getUTCFullYear()&&0===F.getUTCMonth()&&1===F.getUTCDate()&&10==F.getUTCHours()&&37==F.getUTCMinutes()&&6==F.getUTCSeconds()&&708==F.getUTCMilliseconds()}catch(an){}if(!e("json")){var w=e("bug-string-char-index");if(!F)var Qa=Math.floor,k=[0,31,59,90,120,151,181,212,243,273,304,334],m=function(b,e){return k[e]+365*(b-1970)+Qa((b-1969+(e=+(1<e)))/4)-Qa((b-1901+e)/100)+Qa((b-1601+e)/400)};(g={}.hasOwnProperty)||(g=function(b){var e={};if((e.__proto__=null,e.__proto__={toString:1},e).toString!=
d)g=function(b){var e=this.__proto__;b=b in(this.__proto__=null,this);this.__proto__=e;return b};else{var f=e.constructor;g=function(b){var e=(this.constructor||f).prototype;return b in this&&!(b in e&&this[b]===e[b])}}e=null;return g.call(this,b)});var p={"boolean":1,number:1,string:1,undefined:1};var r=function(b,e){var f=0,h,l;(h=function(){this.valueOf=0}).prototype.valueOf=0;var q=new h;for(l in q)g.call(q,l)&&f++;h=q=null;f?r=2==f?function(b,e){var f={},h="[object Function]"==d.call(b),l;for(l in b)h&&
"prototype"==l||g.call(f,l)||!(f[l]=1)||!g.call(b,l)||e(l)}:function(b,e){var f="[object Function]"==d.call(b),h,l;for(h in b)f&&"prototype"==h||!g.call(b,h)||(l="constructor"===h)||e(h);(l||g.call(b,h="constructor"))&&e(h)}:(q="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),r=function(b,e){var f="[object Function]"==d.call(b),h,l;if(l=!f&&"function"!=typeof b.constructor)l=typeof b.hasOwnProperty,l="object"==l?!!b.hasOwnProperty:!p[l];l=
l?b.hasOwnProperty:g;for(h in b)f&&"prototype"==h||!l.call(b,h)||e(h);for(f=q.length;h=q[--f];l.call(b,h)&&e(h));});return r(b,e)};if(!e("json-stringify")){var ka={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},H=function(b,e){return("000000"+(e||0)).slice(-b)},u=function(b){var e='"',f=0,d=b.length,g=10<d&&w,h;for(g&&(h=b.split(""));f<d;f++){var l=b.charCodeAt(f);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=ka[l];break;default:e=32>l?e+("\\u00"+H(2,l.toString(16))):
e+(g?h[f]:w?b.charAt(f):b[f])}}return e+'"'},z=function(b,e,f,h,l,q,n){var B;try{var F=e[b]}catch(cn){}if("object"==typeof F&&F){var w=d.call(F);if("[object Date]"!=w||g.call(F,"toJSON"))"function"==typeof F.toJSON&&("[object Number]"!=w&&"[object String]"!=w&&"[object Array]"!=w||g.call(F,"toJSON"))&&(F=F.toJSON(b));else if(F>-1/0&&F<1/0){if(m){var k=Qa(F/864E5);for(w=Qa(k/365.2425)+1970-1;m(w+1,0)<=k;w++);for(B=Qa((k-m(w,0))/30.42);m(w,B+1)<=k;B++);k=1+k-m(w,B);var ec=(F%864E5+864E5)%864E5;var p=
Qa(ec/36E5)%24;var fc=Qa(ec/6E4)%60;var ka=Qa(ec/1E3)%60;ec%=1E3}else w=F.getUTCFullYear(),B=F.getUTCMonth(),k=F.getUTCDate(),p=F.getUTCHours(),fc=F.getUTCMinutes(),ka=F.getUTCSeconds(),ec=F.getUTCMilliseconds();F=(0>=w||1E4<=w?(0>w?"-":"+")+H(6,0>w?-w:w):H(4,w))+"-"+H(2,B+1)+"-"+H(2,k)+"T"+H(2,p)+":"+H(2,fc)+":"+H(2,ka)+"."+H(3,ec)+"Z"}else F=null}f&&(F=f.call(e,b,F));if(null===F)return"null";w=d.call(F);if("[object Boolean]"==w)return""+F;if("[object Number]"==w)return F>-1/0&&F<1/0?""+F:"null";
if("[object String]"==w)return u(""+F);if("object"==typeof F){for(b=n.length;b--;)if(n[b]===F)throw TypeError();n.push(F);var Ia=[];e=q;q+=l;if("[object Array]"==w){B=0;for(b=F.length;B<b;B++)w=z(B,F,f,h,l,q,n),Ia.push(w===t?"null":w);b=Ia.length?l?"[\n"+q+Ia.join(",\n"+q)+"\n"+e+"]":"["+Ia.join(",")+"]":"[]"}else r(h||F,function(b){var e=z(b,F,f,h,l,q,n);e!==t&&Ia.push(u(b)+":"+(l?" ":"")+e)}),b=Ia.length?l?"{\n"+q+Ia.join(",\n"+q)+"\n"+e+"}":"{"+Ia.join(",")+"}":"{}";n.pop();return b}};B.stringify=
function(b,e,f){var g;if("function"==typeof e||"object"==typeof e&&e)if("[object Function]"==(g=d.call(e)))var h=e;else if("[object Array]"==g){var l={};for(var q=0,n=e.length,t;q<n;t=e[q++],(g=d.call(t),"[object String]"==g||"[object Number]"==g)&&(l[t]=1));}if(f)if("[object Number]"==(g=d.call(f))){if(0<(f-=f%1)){var B="";for(10<f&&(f=10);B.length<f;B+=" ");}}else"[object String]"==g&&(B=10>=f.length?f:f.slice(0,10));return z("",(t={},t[""]=b,t),h,l,B,"",[])}}if(!e("json-parse")){var v=String.fromCharCode,
y={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},x,G,C=function(){x=G=null;throw SyntaxError();},E=function(){for(var b=G,e=b.length,f,d,g,h,l;x<e;)switch(l=b.charCodeAt(x),l){case 9:case 10:case 13:case 32:x++;break;case 123:case 125:case 91:case 93:case 58:case 44:return f=w?b.charAt(x):b[x],x++,f;case 34:f="@";for(x++;x<e;)if(l=b.charCodeAt(x),32>l)C();else if(92==l)switch(l=b.charCodeAt(++x),l){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:f+=y[l];x++;
break;case 117:d=++x;for(g=x+4;x<g;x++)l=b.charCodeAt(x),48<=l&&57>=l||97<=l&&102>=l||65<=l&&70>=l||C();f+=v("0x"+b.slice(d,x));break;default:C()}else{if(34==l)break;l=b.charCodeAt(x);for(d=x;32<=l&&92!=l&&34!=l;)l=b.charCodeAt(++x);f+=b.slice(d,x)}if(34==b.charCodeAt(x))return x++,f;C();default:d=x;45==l&&(h=!0,l=b.charCodeAt(++x));if(48<=l&&57>=l){for(48==l&&(l=b.charCodeAt(x+1),48<=l&&57>=l)&&C();x<e&&(l=b.charCodeAt(x),48<=l&&57>=l);x++);if(46==b.charCodeAt(x)){for(g=++x;g<e&&(l=b.charCodeAt(g),
48<=l&&57>=l);g++);g==x&&C();x=g}l=b.charCodeAt(x);if(101==l||69==l){l=b.charCodeAt(++x);43!=l&&45!=l||x++;for(g=x;g<e&&(l=b.charCodeAt(g),48<=l&&57>=l);g++);g==x&&C();x=g}return+b.slice(d,x)}h&&C();if("true"==b.slice(x,x+4))return x+=4,!0;if("false"==b.slice(x,x+5))return x+=5,!1;if("null"==b.slice(x,x+4))return x+=4,null;C()}return"$"},A=function(b){var e,f;"$"==b&&C();if("string"==typeof b){if("@"==(w?b.charAt(0):b[0]))return b.slice(1);if("["==b){for(e=[];;f||(f=!0)){b=E();if("]"==b)break;f&&
(","==b?(b=E(),"]"==b&&C()):C());","==b&&C();e.push(A(b))}return e}if("{"==b){for(e={};;f||(f=!0)){b=E();if("}"==b)break;f&&(","==b?(b=E(),"}"==b&&C()):C());","!=b&&"string"==typeof b&&"@"==(w?b.charAt(0):b[0])&&":"==E()||C();e[b.slice(1)]=A(E())}return e}C()}return b},D=function(b,e,f){f=K(b,e,f);f===t?delete b[e]:b[e]=f},K=function(b,e,f){var g=b[e],h;if("object"==typeof g&&g)if("[object Array]"==d.call(g))for(h=g.length;h--;)D(g,h,f);else r(g,function(b){D(g,b,f)});return f.call(b,e,g)};B.parse=
function(b,e){var f;x=0;G=""+b;b=A(E());"$"!=E()&&C();x=G=null;return e&&"[object Function]"==d.call(e)?K((f={},f[""]=b,f),"",e):b}}}})(this)},{}],35:[function(b,e,f){function g(b){var e=!0;b.getTracks().forEach(function(b){e="ended"===b.readyState&&e});return e}function d(){if("undefined"===typeof window||!window.navigator.mozGetUserMedia)return!1;var b=window.navigator.userAgent.match(/Firefox\/(\d+)\./);return 50>(b&&1<=b.length&&parseInt(b[1],10))}function l(b){n.call(this);var e=this.config=
{detectSpeakingEvents:!1,audioFallback:!1,media:{audio:!0,video:!0},harkOptions:null,logger:B},f;for(f in b)b.hasOwnProperty(f)&&(this.config[f]=b[f]);this.logger=e.logger;this._log=this.logger.log.bind(this.logger,"LocalMedia:");this._logerror=this.logger.error.bind(this.logger,"LocalMedia:");this.localStreams=[];this.localScreens=[];navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||this._logerror("Your browser does not support local media capture.");this._audioMonitors=[];this.on("localStreamStopped",
this._stopAudioMonitor.bind(this));this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}f=b("util");var q=b("hark"),t=b("getscreenmedia"),n=b("wildemitter"),B=b("mockconsole");f.inherits(l,n);l.prototype.start=function(b,e){var f=this,d=b||this.config.media;this.emit("localStreamRequested",d);navigator.mediaDevices.getUserMedia(d).then(function(b){d.audio&&f.config.detectSpeakingEvents&&f._setupAudioMonitor(b,f.config.harkOptions);f.localStreams.push(b);b.getTracks().forEach(function(e){e.addEventListener("ended",
function(){g(b)&&f._removeStream(b)})});f.emit("localStream",b);if(e)return e(null,b)}).catch(function(b){if(f.config.audioFallback&&"NotFoundError"===b.name&&!1!==d.video)d.video=!1,f.start(d,e);else if(f.emit("localStreamRequestFailed",d),e)return e(b,null)})};l.prototype.stop=function(b){this.stopStream(b);this.stopScreenShare(b)};l.prototype.stopStream=function(b){var e=this;b?-1<this.localStreams.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),d()&&this._removeStream(b)):this.localStreams.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});
d()&&e._removeStream(b)})};l.prototype.startScreenShare=function(b,e){var f=this;this.emit("localScreenRequested");"function"!==typeof b||e||(e=b,b=null);t(b,function(b,d){b?f.emit("localScreenRequestFailed"):(f.localScreens.push(d),d.getTracks().forEach(function(b){b.addEventListener("ended",function(){var b=!0;d.getTracks().forEach(function(e){b="ended"===e.readyState&&b});b&&f._removeStream(d)})}),f.emit("localScreen",d));if(e)return e(b,d)})};l.prototype.stopScreenShare=function(b){var e=this;
b?-1<this.localScreens.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),d()&&this._removeStream(b)):this.localScreens.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});d()&&e._removeStream(b)})};l.prototype.mute=function(){this._audioEnabled(!1);this.emit("audioOff")};l.prototype.unmute=function(){this._audioEnabled(!0);this.emit("audioOn")};l.prototype.pauseVideo=function(){this._videoEnabled(!1);this.emit("videoOff")};l.prototype.resumeVideo=function(){this._videoEnabled(!0);
this.emit("videoOn")};l.prototype.pause=function(){this.mute();this.pauseVideo()};l.prototype.resume=function(){this.unmute();this.resumeVideo()};l.prototype._audioEnabled=function(b){this.localStreams.forEach(function(e){e.getAudioTracks().forEach(function(e){e.enabled=!!b})})};l.prototype._videoEnabled=function(b){this.localStreams.forEach(function(e){e.getVideoTracks().forEach(function(e){e.enabled=!!b})})};l.prototype.isAudioEnabled=function(){var b=!0;this.localStreams.forEach(function(e){e.getAudioTracks().forEach(function(e){b=
b&&e.enabled})});return b};l.prototype.isVideoEnabled=function(){var b=!0;this.localStreams.forEach(function(e){e.getVideoTracks().forEach(function(e){b=b&&e.enabled})});return b};l.prototype._removeStream=function(b){var e=this.localStreams.indexOf(b);-1<e?(this.localStreams.splice(e,1),this.emit("localStreamStopped",b)):(e=this.localScreens.indexOf(b),-1<e&&(this.localScreens.splice(e,1),this.emit("localScreenStopped",b)))};l.prototype._setupAudioMonitor=function(b,e){this._log("Setup audio");e=
q(b,e);var f=this,d;e.on("speaking",function(){f.emit("speaking")});e.on("stopped_speaking",function(){d&&clearTimeout(d);d=setTimeout(function(){f.emit("stoppedSpeaking")},1E3)});e.on("volume_change",function(b,e){f.emit("volumeChange",b,e)});this._audioMonitors.push({audio:e,stream:b})};l.prototype._stopAudioMonitor=function(b){var e=-1;this._audioMonitors.forEach(function(f,d){f.stream===b&&(e=d)});-1<e&&(this._audioMonitors[e].audio.stop(),this._audioMonitors.splice(e,1))};e.exports=l},{getscreenmedia:27,
hark:29,mockconsole:37,util:63,wildemitter:65}],36:[function(b,e,f){(function(b){function d(b,e){b.set(e[0],e[1]);return b}function g(b,e){b.add(e);return b}function q(b,e){for(var f=-1,d=b?b.length:0;++f<d&&!1!==e(b[f],f,b););return b}function t(b,e,f,d){var g=-1,h=b?b.length:0;for(d&&h&&(f=b[++g]);++g<h;)f=e(f,b[g],g,b);return f}function n(b){var e=!1;if(null!=b&&"function"!=typeof b.toString)try{e=!!(b+"")}catch(rc){}return e}function B(b){var e=-1,f=Array(b.size);b.forEach(function(b,d){f[++e]=
[d,b]});return f}function F(b,e){return function(f){return b(e(f))}}function w(b){var e=-1,f=Array(b.size);b.forEach(function(b){f[++e]=b});return f}function k(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var d=b[e];this.set(d[0],d[1])}}function m(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var d=b[e];this.set(d[0],d[1])}}function p(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var d=b[e];this.set(d[0],d[1])}}function Ia(b){this.__data__=new m(b)}function r(b,e,f){var d=b[e];
X.call(b,e)&&(d===f||d!==d&&f!==f)&&(void 0!==f||e in b)||(b[e]=f)}function ka(b,e){for(var f=b.length;f--;){var d=b[f][0];if(d===e||d!==d&&e!==e)return f}return-1}function H(b,e){return b&&G(e,P(e),b)}function u(b,e,f,d,g,h,l){var t;d&&(t=h?d(b,g,h,l):d(b));if(void 0!==t)return t;if(!O(b))return b;if(g=Aa(b)){if(t=D(b),!e)return y(b,t)}else{var B=ua(b),F="[object Function]"==B||"[object GeneratorFunction]"==B;if(Sa(b))return x(b,e);if("[object Object]"==B||"[object Arguments]"==B||F&&!h){if(n(b))return h?
b:{};t=K(F?{}:b);if(!e)return C(b,H(t,b))}else{if(!L[B])return h?b:{};t=J(b,B,u,e)}}l||(l=new Ia);if(h=l.get(b))return h;l.set(b,t);if(!g)var w=f?z(b,P,Ja):P(b);q(w||b,function(g,h){w&&(h=g,g=b[h]);r(t,h,u(g,e,f,d,h,b,l))});return t}function z(b,e,f){e=e(b);if(!Aa(b)){b=f(b);f=-1;for(var d=b.length,g=e.length;++f<d;)e[g+f]=b[f]}return e}function x(b,e){if(e)return b.slice();e=new b.constructor(b.length);b.copy(e);return e}function v(b){var e=new b.constructor(b.byteLength);(new ha(e)).set(new ha(b));
return e}function y(b,e){var f=-1,d=b.length;for(e||(e=Array(d));++f<d;)e[f]=b[f];return e}function G(b,e,f,d){f||(f={});for(var g=-1,h=e.length;++g<h;){var l=e[g],q=d?d(f[l],b[l],l,f,b):void 0;r(f,l,void 0===q?b[l]:q)}return f}function C(b,e){return G(b,Ja(b),e)}function E(b,e){b=b.__data__;var f=typeof e;return("string"==f||"number"==f||"symbol"==f||"boolean"==f?"__proto__"!==e:null===e)?b["string"==typeof e?"string":"hash"]:b.map}function A(b,e){b=null==b?void 0:b[e];e=!O(b)||ba&&ba in b?!1:(I(b)||
n(b)?ja:N).test(ad(b));return e?b:void 0}function D(b){var e=b.length,f=b.constructor(e);e&&"string"==typeof b[0]&&X.call(b,"index")&&(f.index=b.index,f.input=b.input);return f}function K(b){"function"!=typeof b.constructor||Yi(b)?b={}:(b=la(b),b=O(b)?aa(b):{});return b}function J(b,e,f,h){var l=b.constructor;switch(e){case "[object ArrayBuffer]":return v(b);case "[object Boolean]":case "[object Date]":return new l(+b);case "[object DataView]":return e=h?v(b.buffer):b.buffer,new b.constructor(e,b.byteOffset,
b.byteLength);case "[object Float32Array]":case "[object Float64Array]":case "[object Int8Array]":case "[object Int16Array]":case "[object Int32Array]":case "[object Uint8Array]":case "[object Uint8ClampedArray]":case "[object Uint16Array]":case "[object Uint32Array]":return e=h?v(b.buffer):b.buffer,new b.constructor(e,b.byteOffset,b.length);case "[object Map]":return e=h?f(B(b),!0):B(b),t(e,d,new b.constructor);case "[object Number]":case "[object String]":return new l(b);case "[object RegExp]":return e=
new b.constructor(b.source,V.exec(b)),e.lastIndex=b.lastIndex,e;case "[object Set]":return e=h?f(w(b),!0):w(b),t(e,g,new b.constructor);case "[object Symbol]":return va?Object(va.call(b)):{}}}function Yi(b){var e=b&&b.constructor;return b===("function"==typeof e&&e.prototype||Q)}function ad(b){if(null!=b){try{return ca.call(b)}catch(Ra){}return b+""}return""}function Zi(b){var e;if(e=null!=b)e=b.length,e="number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e;return e&&!I(b)}function I(b){b=O(b)?da.call(b):
"";return"[object Function]"==b||"[object GeneratorFunction]"==b}function O(b){var e=typeof b;return!!b&&("object"==e||"function"==e)}function P(b){if(Zi(b)){var e;(e=Aa(b))||(e=!!b&&"object"==typeof b&&Zi(b)&&X.call(b,"callee")&&(!pa.call(b,"callee")||"[object Arguments]"==da.call(b)));if(e){e=b.length;for(var f=String,d=-1,g=Array(e);++d<e;)g[d]=f(d);e=g}else e=[];f=e.length;d=!!f;for(var h in b){if(!(g=!X.call(b,h))&&(g=d)&&!(g="length"==h)){g=h;var l=f;l=null==l?9007199254740991:l;g=!!l&&("number"==
typeof g||U.test(g))&&-1<g&&0==g%1&&g<l}g||e.push(h)}b=e}else if(Yi(b)){h=[];for(e in Object(b))X.call(b,e)&&"constructor"!=e&&h.push(e);b=h}else b=ea(b);return b}function R(){return[]}function M(){return!1}var V=/\w*$/,N=/^\[object .+?Constructor\]$/,U=/^(?:0|[1-9]\d*)$/,L={};L["[object Arguments]"]=L["[object Array]"]=L["[object ArrayBuffer]"]=L["[object DataView]"]=L["[object Boolean]"]=L["[object Date]"]=L["[object Float32Array]"]=L["[object Float64Array]"]=L["[object Int8Array]"]=L["[object Int16Array]"]=
L["[object Int32Array]"]=L["[object Map]"]=L["[object Number]"]=L["[object Object]"]=L["[object RegExp]"]=L["[object Set]"]=L["[object String]"]=L["[object Symbol]"]=L["[object Uint8Array]"]=L["[object Uint8ClampedArray]"]=L["[object Uint16Array]"]=L["[object Uint32Array]"]=!0;L["[object Error]"]=L["[object Function]"]=L["[object WeakMap]"]=!1;var W="object"==typeof self&&self&&self.Object===Object&&self;b="object"==typeof b&&b&&b.Object===Object&&b||W||Function("return this")();var S=(W="object"==
typeof f&&f&&!f.nodeType&&f)&&"object"==typeof e&&e&&!e.nodeType&&e;W=S&&S.exports===W;S=Array.prototype;var T=Function.prototype,Q=Object.prototype,Z=b["__core-js_shared__"],ba=function(){var b=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),ca=T.toString,X=Q.hasOwnProperty,da=Q.toString,ja=RegExp("^"+ca.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");T=W?b.Buffer:void 0;W=b.Symbol;var ha=
b.Uint8Array,la=F(Object.getPrototypeOf,Object),aa=Object.create,pa=Q.propertyIsEnumerable,Y=S.splice;S=Object.getOwnPropertySymbols;T=T?T.isBuffer:void 0;var ea=F(Object.keys,Object),na=A(b,"DataView"),oa=A(b,"Map"),ma=A(b,"Promise"),fa=A(b,"Set");b=A(b,"WeakMap");var ya=A(Object,"create"),Ba=ad(na),za=ad(oa),Ca=ad(ma),Da=ad(fa),ra=ad(b),va=(W=W?W.prototype:void 0)?W.valueOf:void 0;k.prototype.clear=function(){this.__data__=ya?ya(null):{}};k.prototype["delete"]=function(b){return this.has(b)&&delete this.__data__[b]};
k.prototype.get=function(b){var e=this.__data__;return ya?(b=e[b],"__lodash_hash_undefined__"===b?void 0:b):X.call(e,b)?e[b]:void 0};k.prototype.has=function(b){var e=this.__data__;return ya?void 0!==e[b]:X.call(e,b)};k.prototype.set=function(b,e){this.__data__[b]=ya&&void 0===e?"__lodash_hash_undefined__":e;return this};m.prototype.clear=function(){this.__data__=[]};m.prototype["delete"]=function(b){var e=this.__data__;b=ka(e,b);if(0>b)return!1;b==e.length-1?e.pop():Y.call(e,b,1);return!0};m.prototype.get=
function(b){var e=this.__data__;b=ka(e,b);return 0>b?void 0:e[b][1]};m.prototype.has=function(b){return-1<ka(this.__data__,b)};m.prototype.set=function(b,e){var f=this.__data__,d=ka(f,b);0>d?f.push([b,e]):f[d][1]=e;return this};p.prototype.clear=function(){this.__data__={hash:new k,map:new (oa||m),string:new k}};p.prototype["delete"]=function(b){return E(this,b)["delete"](b)};p.prototype.get=function(b){return E(this,b).get(b)};p.prototype.has=function(b){return E(this,b).has(b)};p.prototype.set=
function(b,e){E(this,b).set(b,e);return this};Ia.prototype.clear=function(){this.__data__=new m};Ia.prototype["delete"]=function(b){return this.__data__["delete"](b)};Ia.prototype.get=function(b){return this.__data__.get(b)};Ia.prototype.has=function(b){return this.__data__.has(b)};Ia.prototype.set=function(b,e){var f=this.__data__;if(f instanceof m){f=f.__data__;if(!oa||199>f.length)return f.push([b,e]),this;f=this.__data__=new p(f)}f.set(b,e);return this};var Ja=S?F(S,Object):R,ua=function(b){return da.call(b)};
if(na&&"[object DataView]"!=ua(new na(new ArrayBuffer(1)))||oa&&"[object Map]"!=ua(new oa)||ma&&"[object Promise]"!=ua(ma.resolve())||fa&&"[object Set]"!=ua(new fa)||b&&"[object WeakMap]"!=ua(new b))ua=function(b){var e=da.call(b);if(b=(b="[object Object]"==e?b.constructor:void 0)?ad(b):void 0)switch(b){case Ba:return"[object DataView]";case za:return"[object Map]";case Ca:return"[object Promise]";case Da:return"[object Set]";case ra:return"[object WeakMap]"}return e};var Aa=Array.isArray,Sa=T||M;
e.exports=function(b){return u(b,!0,!0)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],37:[function(b,e,f){b="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profileEnd time timeEnd trace warn".split(" ");f=b.length;for(var d=function(){},h={};f--;)h[b[f]]=d;e.exports=h},{}],38:[function(b,e,f){function d(b){if(b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(b)){var e=
parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case "years":case "year":case "y":return e*l;case "days":case "day":case "d":return 864E5*e;case "hours":case "hour":case "h":return 36E5*e;case "minutes":case "minute":case "m":return 6E4*e;case "seconds":case "second":case "s":return 1E3*e;case "ms":return e}}}function h(b,e,f){if(!(b<e))return b<1.5*e?Math.floor(b/e)+" "+f:Math.ceil(b/e)+" "+f+"s"}var l=315576E5;e.exports=function(b,e){e=e||{};return"string"==typeof b?d(b):e.long?h(b,864E5,"day")||
h(b,36E5,"hour")||h(b,6E4,"minute")||h(b,1E3,"second")||b+" ms":864E5<=b?Math.round(b/864E5)+"d":36E5<=b?Math.round(b/36E5)+"h":6E4<=b?Math.round(b/6E4)+"m":1E3<=b?Math.round(b/1E3)+"s":b+"ms"}},{}],39:[function(b,e,f){var d=Object.prototype.hasOwnProperty;f.keys=Object.keys||function(b){var e=[],f;for(f in b)d.call(b,f)&&e.push(f);return e};f.values=function(b){var e=[],f;for(f in b)d.call(b,f)&&e.push(b[f]);return e};f.merge=function(b,e){for(var f in e)d.call(e,f)&&(b[f]=e[f]);return b};f.length=
function(b){return f.keys(b).length};f.isEmpty=function(b){return 0==f.length(b)}},{}],40:[function(b,e,f){(function(b){var f=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,g=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,t=/(?:^|:|,)(?:\s*\[)+/g,n=/^\s+/,B=/\s+$/;e.exports=function(e){if("string"!=typeof e||!e)return null;e=e.replace(n,"").replace(B,"");if(b.JSON&&JSON.parse)return JSON.parse(e);if(f.test(e.replace(d,"@").replace(g,"]").replace(t,"")))return(new Function("return "+
e))()}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],41:[function(b,e,f){f.encode=function(b){var e="",f;for(f in b)b.hasOwnProperty(f)&&(e.length&&(e+="&"),e+=encodeURIComponent(f)+"="+encodeURIComponent(b[f]));return e};f.decode=function(b){var e={};b=b.split("&");for(var f=0,d=b.length;f<d;f++){var g=b[f].split("=");e[decodeURIComponent(g[0])]=decodeURIComponent(g[1])}return e}},{}],42:[function(b,e,f){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
h="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");e.exports=function(b){b=d.exec(b||"");for(var e={},f=14;f--;)e[h[f]]=b[f]||"";return e}},{}],43:[function(b,e,f){function d(){throw Error("setTimeout has not been defined");}function h(){throw Error("clearTimeout has not been defined");}function l(b){if(w===setTimeout)return setTimeout(b,0);if((w===d||!w)&&setTimeout)return w=setTimeout,setTimeout(b,0);try{return w(b,0)}catch(H){try{return w.call(null,
b,0)}catch(wl){return w.call(this,b,0)}}}function q(b){if(k===clearTimeout)return clearTimeout(b);if((k===h||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(b);try{return k(b)}catch(H){try{return k.call(null,b)}catch(wl){return k.call(this,b)}}}function t(){p&&Ia&&(p=!1,Ia.length?m=Ia.concat(m):r=-1,m.length&&n())}function n(){if(!p){var b=l(t);p=!0;for(var e=m.length;e;){Ia=m;for(m=[];++r<e;)Ia&&Ia[r].run();r=-1;e=m.length}Ia=null;p=!1;q(b)}}function B(b,e){this.fun=b;this.array=e}function F(){}
b=e.exports={};try{var w="function"===typeof setTimeout?setTimeout:d}catch(ka){w=d}try{var k="function"===typeof clearTimeout?clearTimeout:h}catch(ka){k=h}var m=[],p=!1,Ia,r=-1;b.nextTick=function(b){var e=Array(arguments.length-1);if(1<arguments.length)for(var f=1;f<arguments.length;f++)e[f-1]=arguments[f];m.push(new B(b,e));1!==m.length||p||l(n)};B.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=F;b.addListener=
F;b.once=F;b.off=F;b.removeListener=F;b.removeAllListeners=F;b.emit=F;b.prependListener=F;b.prependOnceListener=F;b.listeners=function(b){return[]};b.binding=function(b){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(b){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}],44:[function(b,e,f){function d(b,e){var f=this,d;l.call(this);b=b||{};b.iceServers=b.iceServers||[];this.enableChromeNativeSimulcast=!1;e&&e.optional&&
window.chrome&&null===navigator.appVersion.match(/Chromium\//)&&e.optional.forEach(function(b){b.enableChromeNativeSimulcast&&(f.enableChromeNativeSimulcast=!0)});this.enableMultiStreamHacks=!1;e&&e.optional&&window.chrome&&e.optional.forEach(function(b){b.enableMultiStreamHacks&&(f.enableMultiStreamHacks=!0)});this.restrictBandwidth=0;e&&e.optional&&e.optional.forEach(function(b){b.andyetRestrictBandwidth&&(f.restrictBandwidth=b.andyetRestrictBandwidth)});this.batchIceCandidates=0;e&&e.optional&&
e.optional.forEach(function(b){b.andyetBatchIce&&(f.batchIceCandidates=b.andyetBatchIce)});this.batchedIceCandidates=[];e&&e.optional&&window.chrome&&e.optional.forEach(function(b){b.andyetFasterICE&&(f.eliminateDuplicateCandidates=b.andyetFasterICE)});e&&e.optional&&e.optional.forEach(function(b){b.andyetDontSignalCandidates&&(f.dontSignalCandidates=b.andyetDontSignalCandidates)});this.assumeSetLocalSuccess=!1;e&&e.optional&&e.optional.forEach(function(b){b.andyetAssumeSetLocalSuccess&&(f.assumeSetLocalSuccess=
b.andyetAssumeSetLocalSuccess)});window.navigator.mozGetUserMedia&&e&&e.optional&&(this.wtFirefox=0,e.optional.forEach(function(b){b.andyetFirefoxMakesMeSad&&(f.wtFirefox=b.andyetFirefoxMakesMeSad,0<f.wtFirefox&&(f.firefoxcandidatebuffer=[]))}));this.pc=new RTCPeerConnection(b,e);this.getLocalStreams="function"===typeof this.pc.getLocalStreams?this.pc.getLocalStreams.bind(this.pc):function(){return[]};this.getSenders="function"===typeof this.pc.getSenders?this.pc.getSenders.bind(this.pc):function(){return[]};
this.getRemoteStreams="function"===typeof this.pc.getRemoteStreams?this.pc.getRemoteStreams.bind(this.pc):function(){return[]};this.getReceivers="function"===typeof this.pc.getReceivers?this.pc.getReceivers.bind(this.pc):function(){return[]};this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=function(b){"function"===typeof f.pc.removeStream?f.pc.removeStream.apply(f.pc,arguments):"function"===typeof f.pc.removeTrack&&b.getTracks().forEach(function(b){f.pc.removeTrack(b)})};"function"===
typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc));this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onremovetrack=this.emit.bind(this,"removeTrack");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);
this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:!1,sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};this.iceCredentials={local:{},remote:{}};for(d in b)this.config[d]=b[d];if(this.config.debug)this.on("*",function(){(b.logger||console).log("PeerConnection event:",arguments)});this.hadRemoteIPv6Candidate=this.hadLocalIPv6Candidate=this.hadRemoteRelayCandidate=this.hadLocalRelayCandidate=this.hadRemoteStunCandidate=
this.hadLocalStunCandidate=!1;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}f=b("util");var h=b("sdp-jingle-json"),l=b("wildemitter"),q=b("lodash.clonedeep");f.inherits(d,l);Object.defineProperty(d.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(d.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});d.prototype._role=function(){return this.isInitiator?"initiator":"responder"};d.prototype.addStream=
function(b){this.localStream=b;this.pc.addStream(b)};d.prototype._checkLocalCandidate=function(b){b=h.toCandidateJSON(b);"srflx"==b.type?this.hadLocalStunCandidate=!0:"relay"==b.type&&(this.hadLocalRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)};d.prototype._checkRemoteCandidate=function(b){b=h.toCandidateJSON(b);"srflx"==b.type?this.hadRemoteStunCandidate=!0:"relay"==b.type&&(this.hadRemoteRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)};d.prototype.processIce=
function(b,e){e=e||function(){};var f=this;if("closed"===this.pc.signalingState)return e();if(b.contents||b.jingle&&b.jingle.contents){var d=this.remoteDescription.contents.map(function(b){return b.name});(b.contents||b.jingle.contents).forEach(function(b){var g=b.transport||{},l=g.candidates||[],q=d.indexOf(b.name),n=b.name,t=f.remoteDescription.contents.find(function(e){return e.name===b.name}),B=function(){l.forEach(function(b){b=h.toCandidateSDP(b);f.pc.addIceCandidate(new RTCIceCandidate({candidate:b,
sdpMLineIndex:q,sdpMid:n}),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b)});e()};f.iceCredentials.remote[b.name]&&g.ufrag&&f.iceCredentials.remote[b.name].ufrag!==g.ufrag?t?(t.transport.ufrag=g.ufrag,t.transport.pwd=g.pwd,g={type:"offer",jingle:f.remoteDescription},g.sdp=h.toSessionSDP(g.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"}),f.pc.setRemoteDescription(new RTCSessionDescription(g),function(){B()},function(b){f.emit("error",b)})):f.emit("error",
"ice restart failed to find matching content"):B()})}else{b.candidate&&0!==b.candidate.candidate.indexOf("a=")&&(b.candidate.candidate="a="+b.candidate.candidate);if(this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(b.candidate),e();f.pc.addIceCandidate(new RTCIceCandidate(b.candidate),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b.candidate.candidate);e()}};d.prototype.offer=
function(b,e){var f=this,d=2===arguments.length,g=d&&b?b:{offerToReceiveAudio:1,offerToReceiveVideo:1};e=(e=d?e:b)||function(){};if("closed"===this.pc.signalingState)return e("Already closed");this.pc.createOffer(function(b){var d={type:"offer",sdp:b.sdp};f.assumeSetLocalSuccess&&(f.emit("offer",d),e(null,d));f._candidateBuffer=[];f.pc.setLocalDescription(b,function(){if(f.config.useJingle){var g=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"});g.sid=f.config.sid;f.localDescription=g;
g.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.local[b.name]={ufrag:e.ufrag,pwd:e.pwd})});d.jingle=g}d.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkLocalCandidate(b)});f.assumeSetLocalSuccess||(f.emit("offer",d),e(null,d))},function(b){f.emit("error",b);e(b)})},function(b){f.emit("error",b);e(b)},g)};d.prototype.handleOffer=function(b,e){e=e||function(){};var f=this;b.type="offer";if(b.jingle){this.enableChromeNativeSimulcast&&b.jingle.contents.forEach(function(b){"video"===
b.name&&(b.application.googConferenceFlag=!0)});this.enableMultiStreamHacks&&b.jingle.contents.forEach(function(b){if("video"===b.name){var e=b.application.sources||[];if(0===e.length||"3735928559"!==e[0].ssrc)e.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),b.application.sources=e}});if(0<f.restrictBandwidth&&2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name){var d=b.jingle.contents[1];d.application&&d.application.bandwidth&&
d.application.bandwidth.bandwidth||(b.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:f.restrictBandwidth.toString()},b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"outgoing"}))}b.jingle.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.remote[b.name]={ufrag:e.ufrag,pwd:e.pwd})});b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"});f.remoteDescription=b.jingle}b.sdp.split("\r\n").forEach(function(b){0===
b.indexOf("a=candidate:")&&f._checkRemoteCandidate(b)});f.pc.setRemoteDescription(new RTCSessionDescription(b),function(){e()},e)};d.prototype.answerAudioOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},b)};d.prototype.answerBroadcastOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},b)};d.prototype.answer=function(b,e){var f=2===arguments.length;this._answer(f&&b?b:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},
f?e:b)};d.prototype.handleAnswer=function(b,e){e=e||function(){};var f=this;b.jingle&&(b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"}),f.remoteDescription=b.jingle,b.jingle.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.remote[b.name]={ufrag:e.ufrag,pwd:e.pwd})}));b.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkRemoteCandidate(b)});f.pc.setRemoteDescription(new RTCSessionDescription(b),function(){f.wtFirefox&&
window.setTimeout(function(){f.firefoxcandidatebuffer.forEach(function(b){f.pc.addIceCandidate(new RTCIceCandidate(b),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b.candidate)});f.firefoxcandidatebuffer=null},f.wtFirefox);e(null)},e)};d.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};d.prototype._answer=function(b,e){e=e||function(){};var f=this;if(!this.pc.remoteDescription)throw Error("remoteDescription not set");
if("closed"===this.pc.signalingState)return e("Already closed");f.pc.createAnswer(function(b){var d=[];if(f.enableChromeNativeSimulcast&&(b.jingle=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"}),2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name)){var g=b.jingle.contents[1].application.sourceGroups||[],l=!1;g.forEach(function(b){"SIM"==b.semantics&&(l=!0)});if(!l&&b.jingle.contents[1].application.sources.length){var n=JSON.parse(JSON.stringify(b.jingle.contents[1].application.sources[0]));
n.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(n);d.push(b.jingle.contents[1].application.sources[0].ssrc);d.push(n.ssrc);g.push({semantics:"SIM",sources:d});d=JSON.parse(JSON.stringify(n));d.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(d);g.push({semantics:"FID",sources:[n.ssrc,d.ssrc]});b.jingle.contents[1].application.sourceGroups=g;b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),
direction:"outgoing"})}}var t={type:"answer",sdp:b.sdp};f.assumeSetLocalSuccess&&(g=q(t),f.emit("answer",g),e(null,g));f._candidateBuffer=[];f.pc.setLocalDescription(b,function(){if(f.config.useJingle){var d=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"});d.sid=f.config.sid;f.localDescription=d;t.jingle=d}f.enableChromeNativeSimulcast&&(t.jingle||(t.jingle=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"})),t.jingle.contents[1].application.sources.forEach(function(b,e){b.parameters=
b.parameters.map(function(b){"msid"===b.key&&(b.value+="-"+Math.floor(e/2));return b})}),t.sdp=h.toSessionSDP(t.jingle,{sid:f.sdpSessionID,role:f._role(),direction:"outgoing"}));t.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkLocalCandidate(b)});f.assumeSetLocalSuccess||(d=q(t),f.emit("answer",d),e(null,d))},function(b){f.emit("error",b);e(b)})},function(b){f.emit("error",b);e(b)},b)};d.prototype._onIce=function(b){var e=this;if(b.candidate){if(!this.dontSignalCandidates){b=
b.candidate;var f={candidate:{candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex}};this._checkLocalCandidate(b.candidate);var d=h.toCandidateJSON(b.candidate);if(this.eliminateDuplicateCandidates&&"relay"===d.type){var g=this._candidateBuffer.filter(function(b){return"relay"===b.type}).map(function(b){return b.foundation+":"+b.component});var l=g.indexOf(d.foundation+":"+d.component);if(-1<l&&d.priority>>24>=g[l].priority>>24)return}if("max-bundle"===this.config.bundlePolicy&&(g=
this._candidateBuffer.filter(function(b){return d.type===b.type}).map(function(b){return b.address+":"+b.port}),l=g.indexOf(d.address+":"+d.port),-1<l))return;if("require"!==this.config.rtcpMuxPolicy||"2"!==d.component){this._candidateBuffer.push(d);if(e.config.useJingle&&(b.sdpMid||(b.sdpMid=e.pc.remoteDescription&&"offer"===e.pc.remoteDescription.type?e.remoteDescription.contents[b.sdpMLineIndex].name:e.localDescription.contents[b.sdpMLineIndex].name),e.iceCredentials.local[b.sdpMid]||h.toSessionJSON(e.pc.localDescription.sdp,
{role:e._role(),direction:"outgoing"}).contents.forEach(function(b){var f=b.transport||{};f.ufrag&&(e.iceCredentials.local[b.name]={ufrag:f.ufrag,pwd:f.pwd})}),f.jingle={contents:[{name:b.sdpMid,creator:e._role(),transport:{transportType:"iceUdp",ufrag:e.iceCredentials.local[b.sdpMid].ufrag,pwd:e.iceCredentials.local[b.sdpMid].pwd,candidates:[d]}}]},0<e.batchIceCandidates)){0===e.batchedIceCandidates.length&&window.setTimeout(function(){var b={};e.batchedIceCandidates.forEach(function(e){e=e.contents[0];
b[e.name]||(b[e.name]=e);b[e.name].transport.candidates.push(e.transport.candidates[0])});var f={jingle:{contents:[]}};Object.keys(b).forEach(function(e){f.jingle.contents.push(b[e])});e.batchedIceCandidates=[];e.emit("ice",f)},e.batchIceCandidates);e.batchedIceCandidates.push(f.jingle);return}this.emit("ice",f)}}}else this.emit("endOfCandidates")};d.prototype._onDataChannel=function(b){b=b.channel;this._remoteDataChannels.push(b);this.emit("addChannel",b)};d.prototype.createDataChannel=function(b,
e){b=this.pc.createDataChannel(b,e);this._localDataChannels.push(b);return b};d.prototype.getStats=function(){if("function"===typeof arguments[0]){var b=arguments[0];this.pc.getStats().then(function(e){b(null,e)},function(e){b(e)})}else return this.pc.getStats.apply(this.pc,arguments)};e.exports=d},{"lodash.clonedeep":36,"sdp-jingle-json":45,util:63,wildemitter:65}],45:[function(b,e,f){var d=b("./lib/tosdp"),h=b("./lib/tojson");f.toIncomingSDPOffer=function(b){return d.toSessionSDP(b,{role:"responder",
direction:"incoming"})};f.toOutgoingSDPOffer=function(b){return d.toSessionSDP(b,{role:"initiator",direction:"outgoing"})};f.toIncomingSDPAnswer=function(b){return d.toSessionSDP(b,{role:"initiator",direction:"incoming"})};f.toOutgoingSDPAnswer=function(b){return d.toSessionSDP(b,{role:"responder",direction:"outgoing"})};f.toIncomingMediaSDPOffer=function(b){return d.toMediaSDP(b,{role:"responder",direction:"incoming"})};f.toOutgoingMediaSDPOffer=function(b){return d.toMediaSDP(b,{role:"initiator",
direction:"outgoing"})};f.toIncomingMediaSDPAnswer=function(b){return d.toMediaSDP(b,{role:"initiator",direction:"incoming"})};f.toOutgoingMediaSDPAnswer=function(b){return d.toMediaSDP(b,{role:"responder",direction:"outgoing"})};f.toCandidateSDP=d.toCandidateSDP;f.toMediaSDP=d.toMediaSDP;f.toSessionSDP=d.toSessionSDP;f.toIncomingJSONOffer=function(b,e){return h.toSessionJSON(b,{role:"responder",direction:"incoming",creators:e})};f.toOutgoingJSONOffer=function(b,e){return h.toSessionJSON(b,{role:"initiator",
direction:"outgoing",creators:e})};f.toIncomingJSONAnswer=function(b,e){return h.toSessionJSON(b,{role:"initiator",direction:"incoming",creators:e})};f.toOutgoingJSONAnswer=function(b,e){return h.toSessionJSON(b,{role:"responder",direction:"outgoing",creators:e})};f.toIncomingMediaJSONOffer=function(b,e){return h.toMediaJSON(b,{role:"responder",direction:"incoming",creator:e})};f.toOutgoingMediaJSONOffer=function(b,e){return h.toMediaJSON(b,{role:"initiator",direction:"outgoing",creator:e})};f.toIncomingMediaJSONAnswer=
function(b,e){return h.toMediaJSON(b,{role:"initiator",direction:"incoming",creator:e})};f.toOutgoingMediaJSONAnswer=function(b,e){return h.toMediaJSON(b,{role:"responder",direction:"outgoing",creator:e})};f.toCandidateJSON=h.toCandidateJSON;f.toMediaJSON=h.toMediaJSON;f.toSessionJSON=h.toSessionJSON},{"./lib/tojson":48,"./lib/tosdp":49}],46:[function(b,e,f){f.lines=function(b){return b.split("\r\n").filter(function(b){return 0<b.length})};f.findLine=function(b,e,f){for(var d=b.length,g=0;g<e.length;g++)if(e[g].substr(0,
d)===b)return e[g];if(!f)return!1;for(e=0;e<f.length;e++)if(f[e].substr(0,d)===b)return f[e];return!1};f.findLines=function(b,e,f){for(var d=[],g=b.length,h=0;h<e.length;h++)e[h].substr(0,g)===b&&d.push(e[h]);if(d.length||!f)return d;for(e=0;e<f.length;e++)f[e].substr(0,g)===b&&d.push(f[e]);return d};f.mline=function(b){b=b.substr(2).split(" ");for(var e={media:b[0],port:b[1],proto:b[2],formats:[]},f=3;f<b.length;f++)b[f]&&e.formats.push(b[f]);return e};f.rtpmap=function(b){b=b.substr(9).split(" ");
var e={id:b.shift()};b=b[0].split("/");e.name=b[0];e.clockrate=b[1];e.channels=3==b.length?b[2]:"1";return e};f.sctpmap=function(b){b=b.substr(10).split(" ");return{number:b.shift(),protocol:b.shift(),streams:b.shift()}};f.fmtp=function(b){for(var e,f=b.substr(b.indexOf(" ")+1).split(";"),d=[],g=0;g<f.length;g++)e=f[g].split("="),b=e[0].trim(),e=e[1],b&&e?d.push({key:b,value:e}):b&&d.push({key:"",value:b});return d};f.crypto=function(b){b=b.substr(9).split(" ");return{tag:b[0],cipherSuite:b[1],keyParams:b[2],
sessionParams:b.slice(3).join(" ")}};f.fingerprint=function(b){b=b.substr(14).split(" ");return{hash:b[0],value:b[1]}};f.extmap=function(b){b=b.substr(9).split(" ");var e={},f=b.shift(),d=f.indexOf("/");0<=d?(e.id=f.substr(0,d),e.senders=f.substr(d+1)):(e.id=f,e.senders="sendrecv");e.uri=b.shift()||"";return e};f.rtcpfb=function(b){b=b.substr(10).split(" ");var e={};e.id=b.shift();e.type=b.shift();"trr-int"===e.type?e.value=b.shift():e.subtype=b.shift()||"";e.parameters=b;return e};f.candidate=function(b){b=
0===b.indexOf("a=candidate:")?b.substring(12).split(" "):b.substring(10).split(" ");for(var e={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:b[3],ip:b[4],port:b[5],type:b[7],generation:"0"},f=8;f<b.length;f+=2)"raddr"===b[f]?e.relAddr=b[f+1]:"rport"===b[f]?e.relPort=b[f+1]:"generation"===b[f]?e.generation=b[f+1]:"tcptype"===b[f]&&(e.tcpType=b[f+1]);e.network="1";return e};f.sourceGroups=function(b){for(var e=[],f=0;f<b.length;f++){var d=b[f].substr(13).split(" ");e.push({semantics:d.shift(),
sources:d})}return e};f.sources=function(b){for(var e=[],f={},d=0;d<b.length;d++){var g=b[d].substr(7).split(" "),n=g.shift();if(!f[n]){var B={ssrc:n,parameters:[]};e.push(B);f[n]=B}g=g.join(" ").split(":");B=g.shift();g=g.join(":")||null;f[n].parameters.push({key:B,value:g})}return e};f.groups=function(b){for(var e=[],f,d=0;d<b.length;d++)f=b[d].substr(8).split(" "),e.push({semantics:f.shift(),contents:f});return e};f.bandwidth=function(b){b=b.substr(2).split(":");var e={};e.type=b.shift();e.bandwidth=
b.shift();return e};f.msid=function(b){b=b.substr(7);var e=b.split(" ");return{msid:b,mslabel:e[0],label:e[1]}}},{}],47:[function(b,e,f){e.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",
responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],48:[function(b,e,f){var d=b("./senders"),h=b("./parsers"),l=Math.random();f._setIdCounter=function(b){l=b};f.toSessionJSON=function(b,e){var d,g=e.creators||[],l=e.role||"initiator";e=e.direction||"outgoing";
var q=b.split("\r\nm=");for(d=1;d<q.length;d++)q[d]="m="+q[d],d!==q.length-1&&(q[d]+="\r\n");var t=q.shift()+"\r\n",k=h.lines(t);b={};var m=[];for(d=0;d<q.length;d++)m.push(f.toMediaJSON(q[d],t,{role:l,direction:e,creator:g[d]||"initiator"}));b.contents=m;g=h.findLines("a=group:",k);g.length&&(b.groups=h.groups(g));return b};f.toMediaJSON=function(b,e,g){var l=g.creator||"initiator",q=g.role||"initiator",n=g.direction||"outgoing",t=h.lines(b);b=h.lines(e);e=h.mline(t[0]);l={creator:l,name:e.media,
application:{applicationType:"rtp",media:e.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==e.media&&(l.application={applicationType:"datachannel"},l.transport.sctp=[]);var k=l.application,m=l.transport;if(e=h.findLine("a=mid:",t))l.name=e.substr(6);h.findLine("a=sendrecv",t,b)?l.senders="both":h.findLine("a=sendonly",t,b)?l.senders=d[q][n].sendonly:h.findLine("a=recvonly",t,b)?l.senders=d[q][n].recvonly:
h.findLine("a=inactive",t,b)&&(l.senders="none");if("rtp"==k.applicationType){if(e=h.findLine("b=",t))k.bandwidth=h.bandwidth(e);if(e=h.findLine("a=ssrc:",t))k.ssrc=e.substr(7).split(" ")[0];h.findLines("a=rtpmap:",t).forEach(function(b){var e=h.rtpmap(b);e.parameters=[];e.feedback=[];h.findLines("a=fmtp:"+e.id,t).forEach(function(b){e.parameters=h.fmtp(b)});h.findLines("a=rtcp-fb:"+e.id,t).forEach(function(b){e.feedback.push(h.rtcpfb(b))});k.payloads.push(e)});h.findLines("a=crypto:",t,b).forEach(function(b){k.encryption.push(h.crypto(b))});
h.findLine("a=rtcp-mux",t)&&(k.mux=!0);h.findLines("a=rtcp-fb:*",t).forEach(function(b){k.feedback.push(h.rtcpfb(b))});h.findLines("a=extmap:",t).forEach(function(b){b=h.extmap(b);b.senders=d[q][n][b.senders];k.headerExtensions.push(b)});e=h.findLines("a=ssrc-group:",t);k.sourceGroups=h.sourceGroups(e||[]);e=h.findLines("a=ssrc:",t);var p=k.sources=h.sources(e||[]);if(e=h.findLine("a=msid:",t)){var r=h.msid(e);["msid","mslabel","label"].forEach(function(b){for(var e=0;e<p.length;e++){for(var f=!1,
d=0;d<p[e].parameters.length;d++)p[e].parameters[d].key===b&&(f=!0);f||p[e].parameters.push({key:b,value:r[b]})}})}h.findLine("a=x-google-flag:conference",t,b)&&(k.googConferenceFlag=!0)}e=h.findLines("a=fingerprint:",t,b);var ka=h.findLine("a=setup:",t,b);e.forEach(function(b){b=h.fingerprint(b);ka&&(b.setup=ka.substr(8));m.fingerprints.push(b)});e=h.findLine("a=ice-ufrag:",t,b);g=h.findLine("a=ice-pwd:",t,b);e&&g&&(m.ufrag=e.substr(12),m.pwd=g.substr(10),m.candidates=[],h.findLines("a=candidate:",
t,b).forEach(function(b){m.candidates.push(f.toCandidateJSON(b))}));"datachannel"==k.applicationType&&h.findLines("a=sctpmap:",t).forEach(function(b){b=h.sctpmap(b);m.sctp.push(b)});return l};f.toCandidateJSON=function(b){b=h.candidate(b.split("\r\n")[0]);b.id=(l++).toString(36).substr(0,12);return b}},{"./parsers":46,"./senders":47}],49:[function(b,e,f){var d=b("./senders");f.toSessionSDP=function(b,e){var d=e.sid||b.sid||Date.now(),g=e.time||Date.now(),h=["v=0","o=- "+d+" "+g+" IN IP4 0.0.0.0",
"s=-","t=0 0"];d=b.contents||[];var l=!1;d.forEach(function(b){b.application.sources&&b.application.sources.length&&(l=!0)});l&&h.push("a=msid-semantic: WMS *");(b.groups||[]).forEach(function(b){h.push("a=group:"+b.semantics+" "+b.contents.join(" "))});d.forEach(function(b){h.push(f.toMediaSDP(b,e))});return h.join("\r\n")+"\r\n"};f.toMediaSDP=function(b,e){var g=[],h=e.role||"initiator",l=e.direction||"outgoing",B=b.application;e=b.transport;var F=B.payloads||[],k=e&&e.fingerprints||[],m=[];"datachannel"==
B.applicationType?(m.push("application"),m.push("1"),m.push("DTLS/SCTP"),e.sctp&&e.sctp.forEach(function(b){m.push(b.number)})):(m.push(B.media),m.push("1"),0<k.length?m.push("UDP/TLS/RTP/SAVPF"):B.encryption&&0<B.encryption.length?m.push("RTP/SAVPF"):m.push("RTP/AVPF"),F.forEach(function(b){m.push(b.id)}));g.push("m="+m.join(" "));g.push("c=IN IP4 0.0.0.0");B.bandwidth&&B.bandwidth.type&&B.bandwidth.bandwidth&&g.push("b="+B.bandwidth.type+":"+B.bandwidth.bandwidth);"rtp"==B.applicationType&&g.push("a=rtcp:1 IN IP4 0.0.0.0");
e&&(e.ufrag&&g.push("a=ice-ufrag:"+e.ufrag),e.pwd&&g.push("a=ice-pwd:"+e.pwd),k.forEach(function(b){g.push("a=fingerprint:"+b.hash+" "+b.value);b.setup&&g.push("a=setup:"+b.setup)}),e.sctp&&e.sctp.forEach(function(b){g.push("a=sctpmap:"+b.number+" "+b.protocol+" "+b.streams)}));"rtp"==B.applicationType&&g.push("a="+(d[h][l][b.senders]||"sendrecv"));g.push("a=mid:"+b.name);B.sources&&B.sources.length&&(B.sources[0].parameters||[]).forEach(function(b){"msid"===b.key&&g.push("a=msid:"+b.value)});B.mux&&
g.push("a=rtcp-mux");(B.encryption||[]).forEach(function(b){g.push("a=crypto:"+b.tag+" "+b.cipherSuite+" "+b.keyParams+(b.sessionParams?" "+b.sessionParams:""))});B.googConferenceFlag&&g.push("a=x-google-flag:conference");F.forEach(function(b){var e="a=rtpmap:"+b.id+" "+b.name+"/"+b.clockrate;b.channels&&"1"!=b.channels&&(e+="/"+b.channels);g.push(e);if(b.parameters&&b.parameters.length){e=["a=fmtp:"+b.id];var f=[];b.parameters.forEach(function(b){f.push((b.key?b.key+"=":"")+b.value)});e.push(f.join(";"));
g.push(e.join(" "))}b.feedback&&b.feedback.forEach(function(e){"trr-int"===e.type?g.push("a=rtcp-fb:"+b.id+" trr-int "+(e.value?e.value:"0")):g.push("a=rtcp-fb:"+b.id+" "+e.type+(e.subtype?" "+e.subtype:""))})});B.feedback&&B.feedback.forEach(function(b){"trr-int"===b.type?g.push("a=rtcp-fb:* trr-int "+(b.value?b.value:"0")):g.push("a=rtcp-fb:* "+b.type+(b.subtype?" "+b.subtype:""))});(B.headerExtensions||[]).forEach(function(b){g.push("a=extmap:"+b.id+(b.senders?"/"+d[h][l][b.senders]:"")+" "+b.uri)});
(B.sourceGroups||[]).forEach(function(b){g.push("a=ssrc-group:"+b.semantics+" "+b.sources.join(" "))});(B.sources||[]).forEach(function(b){for(var e=0;e<b.parameters.length;e++){var f=b.parameters[e];g.push("a=ssrc:"+(b.ssrc||B.ssrc)+" "+f.key+(f.value?":"+f.value:""))}});(e.candidates||[]).forEach(function(b){g.push(f.toCandidateSDP(b))});return g.join("\r\n")};f.toCandidateSDP=function(b){var e=[];e.push(b.foundation);e.push(b.component);e.push(b.protocol.toUpperCase());e.push(b.priority);e.push(b.ip);
e.push(b.port);var f=b.type;e.push("typ");e.push(f);("srflx"===f||"prflx"===f||"relay"===f)&&b.relAddr&&b.relPort&&(e.push("raddr"),e.push(b.relAddr),e.push("rport"),e.push(b.relPort));b.tcpType&&"TCP"==b.protocol.toUpperCase()&&(e.push("tcptype"),e.push(b.tcpType));e.push("generation");e.push(b.generation||"0");return"a=candidate:"+e.join(" ")}},{"./senders":47}],50:[function(b,e,f){e.exports=b("./lib/")},{"./lib/":51}],51:[function(b,e,f){function d(b,e){"object"==typeof b&&(e=b,b=void 0);e=e||
{};b=h(b);var f=b.source,d=b.id;e.forceNew||e["force new connection"]||!1===e.multiplex?(t("ignoring socket cache for %s",f),e=q(f,e)):(n[d]||(t("new io instance for %s",f),n[d]=q(f,e)),e=n[d]);return e.socket(b.path)}var h=b("./url"),l=b("socket.io-parser"),q=b("./manager"),t=b("debug")("socket.io-client");e.exports=f=d;var n=f.managers={};f.protocol=l.protocol;f.connect=d;f.Manager=b("./manager");f.Socket=b("./socket")},{"./manager":52,"./socket":54,"./url":55,debug:10,"socket.io-parser":57}],52:[function(b,
e,f){function d(b,e){if(!(this instanceof d))return new d(b,e);b&&"object"==typeof b&&(e=b,b=void 0);e=e||{};e.path=e.path||"/socket.io";this.nsps={};this.subs=[];this.opts=e;this.reconnection(!1!==e.reconnection);this.reconnectionAttempts(e.reconnectionAttempts||Infinity);this.reconnectionDelay(e.reconnectionDelay||1E3);this.reconnectionDelayMax(e.reconnectionDelayMax||5E3);this.randomizationFactor(e.randomizationFactor||.5);this.backoff=new k({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==e.timeout?2E4:e.timeout);this.readyState="closed";this.uri=b;this.connected=[];this.encoding=!1;this.packetBuffer=[];this.encoder=new q.Encoder;this.decoder=new q.Decoder;(this.autoConnect=!1!==e.autoConnect)&&this.open()}b("./url");var h=b("engine.io-client"),l=b("./socket");f=b("component-emitter");var q=b("socket.io-parser"),t=b("./on"),n=b("component-bind");b("object-component");var B=b("debug")("socket.io-client:manager"),F=b("indexof"),
k=b("backo2");e.exports=d;d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var b in this.nsps)this.nsps[b].emit.apply(this.nsps[b],arguments)};d.prototype.updateSocketIds=function(){for(var b in this.nsps)this.nsps[b].id=this.engine.id};f(d.prototype);d.prototype.reconnection=function(b){if(!arguments.length)return this._reconnection;this._reconnection=!!b;return this};d.prototype.reconnectionAttempts=function(b){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=
b;return this};d.prototype.reconnectionDelay=function(b){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=b;this.backoff&&this.backoff.setMin(b);return this};d.prototype.randomizationFactor=function(b){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=b;this.backoff&&this.backoff.setJitter(b);return this};d.prototype.reconnectionDelayMax=function(b){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=b;this.backoff&&
this.backoff.setMax(b);return this};d.prototype.timeout=function(b){if(!arguments.length)return this._timeout;this._timeout=b;return this};d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};d.prototype.open=d.prototype.connect=function(b){B("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;B("opening %s",this.uri);var e=this.engine=h(this.uri,this.opts),f=this;this.readyState="opening";this.skipReconnect=
!1;var d=t(e,"open",function(){f.onopen();b&&b()}),g=t(e,"error",function(e){B("connect_error");f.cleanup();f.readyState="closed";f.emitAll("connect_error",e);if(b){var d=Error("Connection error");d.data=e;b(d)}else f.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;B("connect attempt will timeout after %d",l);var q=setTimeout(function(){B("connect attempt timed out after %d",l);d.destroy();e.close();e.emit("error","timeout");f.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(q)}})}this.subs.push(d);
this.subs.push(g);return this};d.prototype.onopen=function(){B("open");this.cleanup();this.readyState="open";this.emit("open");var b=this.engine;this.subs.push(t(b,"data",n(this,"ondata")));this.subs.push(t(this.decoder,"decoded",n(this,"ondecoded")));this.subs.push(t(b,"error",n(this,"onerror")));this.subs.push(t(b,"close",n(this,"onclose")))};d.prototype.ondata=function(b){this.decoder.add(b)};d.prototype.ondecoded=function(b){this.emit("packet",b)};d.prototype.onerror=function(b){B("error",b);
this.emitAll("error",b)};d.prototype.socket=function(b){var e=this.nsps[b];if(!e){e=new l(this,b);this.nsps[b]=e;var f=this;e.on("connect",function(){e.id=f.engine.id;~F(f.connected,e)||f.connected.push(e)})}return e};d.prototype.destroy=function(b){b=F(this.connected,b);~b&&this.connected.splice(b,1);this.connected.length||this.close()};d.prototype.packet=function(b){B("writing packet %j",b);var e=this;e.encoding?e.packetBuffer.push(b):(e.encoding=!0,this.encoder.encode(b,function(b){for(var f=0;f<
b.length;f++)e.engine.write(b[f]);e.encoding=!1;e.processPacketQueue()}))};d.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var b=this.packetBuffer.shift();this.packet(b)}};d.prototype.cleanup=function(){for(var b;b=this.subs.shift();)b.destroy();this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};d.prototype.close=d.prototype.disconnect=function(){this.skipReconnect=!0;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};
d.prototype.onclose=function(b){B("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",b);this._reconnection&&!this.skipReconnect&&this.reconnect()};d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var b=this;if(this.backoff.attempts>=this._reconnectionAttempts)B("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();B("will wait %dms before reconnect attempt",
e);this.reconnecting=!0;var f=setTimeout(function(){b.skipReconnect||(B("attempting reconnect"),b.emitAll("reconnect_attempt",b.backoff.attempts),b.emitAll("reconnecting",b.backoff.attempts),b.skipReconnect||b.open(function(e){e?(B("reconnect attempt error"),b.reconnecting=!1,b.reconnect(),b.emitAll("reconnect_error",e.data)):(B("reconnect success"),b.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(f)}})}};d.prototype.onreconnect=function(){var b=this.backoff.attempts;this.reconnecting=
!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",b)}},{"./on":53,"./socket":54,"./url":55,backo2:4,"component-bind":7,"component-emitter":8,debug:10,"engine.io-client":11,indexof:32,"object-component":39,"socket.io-parser":57}],53:[function(b,e,f){e.exports=function(b,e,f){b.on(e,f);return{destroy:function(){b.removeListener(e,f)}}}},{}],54:[function(b,e,f){function d(b,e){this.io=b;this.nsp=e;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&this.open();this.receiveBuffer=
[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0}var h=b("socket.io-parser");f=b("component-emitter");var l=b("to-array"),q=b("./on"),t=b("component-bind"),n=b("debug")("socket.io-client:socket"),B=b("has-binary");e.exports=d;var F={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},k=f.prototype.emit;f(d.prototype);d.prototype.subEvents=function(){if(!this.subs){var b=this.io;this.subs=
[q(b,"open",t(this,"onopen")),q(b,"packet",t(this,"onpacket")),q(b,"close",t(this,"onclose"))]}};d.prototype.open=d.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};d.prototype.send=function(){var b=l(arguments);b.unshift("message");this.emit.apply(this,b);return this};d.prototype.emit=function(b){if(F.hasOwnProperty(b))return k.apply(this,arguments),this;var e=l(arguments),f=h.EVENT;B(e)&&(f=h.BINARY_EVENT);
f={type:f,data:e};"function"==typeof e[e.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),f.id=this.ids++);this.connected?this.packet(f):this.sendBuffer.push(f);return this};d.prototype.packet=function(b){b.nsp=this.nsp;this.io.packet(b)};d.prototype.onopen=function(){n("transport is open - connecting");"/"!=this.nsp&&this.packet({type:h.CONNECT})};d.prototype.onclose=function(b){n("close (%s)",b);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",
b)};d.prototype.onpacket=function(b){if(b.nsp==this.nsp)switch(b.type){case h.CONNECT:this.onconnect();break;case h.EVENT:this.onevent(b);break;case h.BINARY_EVENT:this.onevent(b);break;case h.ACK:this.onack(b);break;case h.BINARY_ACK:this.onack(b);break;case h.DISCONNECT:this.ondisconnect();break;case h.ERROR:this.emit("error",b.data)}};d.prototype.onevent=function(b){var e=b.data||[];n("emitting event %j",e);null!=b.id&&(n("attaching ack callback to event"),e.push(this.ack(b.id)));this.connected?
k.apply(this,e):this.receiveBuffer.push(e)};d.prototype.ack=function(b){var e=this,f=!1;return function(){if(!f){f=!0;var d=l(arguments);n("sending ack %j",d);var g=B(d)?h.BINARY_ACK:h.ACK;e.packet({type:g,id:b,data:d})}}};d.prototype.onack=function(b){n("calling ack %s with %j",b.id,b.data);this.acks[b.id].apply(this,b.data);delete this.acks[b.id]};d.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};d.prototype.emitBuffered=function(){var b;
for(b=0;b<this.receiveBuffer.length;b++)k.apply(this,this.receiveBuffer[b]);this.receiveBuffer=[];for(b=0;b<this.sendBuffer.length;b++)this.packet(this.sendBuffer[b]);this.sendBuffer=[]};d.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};d.prototype.destroy=function(){if(this.subs){for(var b=0;b<this.subs.length;b++)this.subs[b].destroy();this.subs=null}this.io.destroy(this)};d.prototype.close=d.prototype.disconnect=function(){this.connected&&
(n("performing disconnect (%s)",this.nsp),this.packet({type:h.DISCONNECT}));this.destroy();if(this.connected)this.onclose("io client disconnect");return this}},{"./on":53,"component-bind":7,"component-emitter":8,debug:10,"has-binary":30,"socket.io-parser":57,"to-array":59}],55:[function(b,e,f){(function(f){var d=b("parseuri"),g=b("debug")("socket.io-client:url");e.exports=function(b,e){var h=b;e=e||f.location;null==b&&(b=e.protocol+"//"+e.host);"string"==typeof b&&("/"==b.charAt(0)&&(b="/"==b.charAt(1)?
e.protocol+b:e.hostname+b),/^(https?|wss?):\/\//.test(b)||(g("protocol-less url %s",b),b="undefined"!=typeof e?e.protocol+"//"+b:"https://"+b),g("parse %s",b),h=d(b));h.port||(/^(http|ws)$/.test(h.protocol)?h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443"));h.path=h.path||"/";h.id=h.protocol+"://"+h.host+":"+h.port;h.href=h.protocol+"://"+h.host+(e&&e.port==h.port?"":":"+h.port);return h}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?
window:{})},{debug:10,parseuri:42}],56:[function(b,e,f){(function(e){var d=b("isarray"),g=b("./is-buffer");f.deconstructPacket=function(b){function e(b){if(!b)return b;if(g(b)){var h={_placeholder:!0,num:f.length};f.push(b);return h}if(d(b)){h=Array(b.length);for(var l=0;l<b.length;l++)h[l]=e(b[l]);return h}if("object"==typeof b&&!(b instanceof Date)){h={};for(l in b)h[l]=e(b[l]);return h}return b}var f=[];b.data=e(b.data);b.attachments=f.length;return{packet:b,buffers:f}};f.reconstructPacket=function(b,
e){function f(b){if(b&&b._placeholder)return e[b.num];if(d(b))for(var g=0;g<b.length;g++)b[g]=f(b[g]);else if(b&&"object"==typeof b)for(g in b)b[g]=f(b[g]);return b}b.data=f(b.data);b.attachments=void 0;return b};f.removeBlobs=function(b,f){function h(b,n,t){if(!b)return b;if(e.Blob&&b instanceof Blob||e.File&&b instanceof File){l++;var B=new FileReader;B.onload=function(){t?t[n]=this.result:q=this.result;--l||f(q)};B.readAsArrayBuffer(b)}else if(d(b))for(B=0;B<b.length;B++)h(b[B],B,b);else if(b&&
"object"==typeof b&&!g(b))for(B in b)h(b[B],B,b)}var l=0,q=b;h(q);l||f(q)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./is-buffer":58,isarray:33}],57:[function(b,e,f){function d(){}function h(b){var e=!1;var d=""+b.type;if(f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type)d+=b.attachments,d+="-";b.nsp&&"/"!=b.nsp&&(e=!0,d+=b.nsp);null!=b.id&&(e&&(d+=",",e=!1),d+=b.id);null!=b.data&&(e&&(d+=","),d+=B.stringify(b.data));n("encoded %j as %s",
b,d);return d}function l(b,e){F.removeBlobs(b,function(b){var f=F.deconstructPacket(b);b=h(f.packet);f=f.buffers;f.unshift(b);e(f)})}function q(){this.reconstructor=null}function t(b){this.reconPack=b;this.buffers=[]}var n=b("debug")("socket.io-parser"),B=b("json3");b("isarray");e=b("component-emitter");var F=b("./binary"),k=b("./is-buffer");f.protocol=4;f.types="CONNECT DISCONNECT EVENT BINARY_EVENT ACK BINARY_ACK ERROR".split(" ");f.CONNECT=0;f.DISCONNECT=1;f.EVENT=2;f.ACK=3;f.ERROR=4;f.BINARY_EVENT=
5;f.BINARY_ACK=6;f.Encoder=d;f.Decoder=q;d.prototype.encode=function(b,e){n("encoding packet %j",b);f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type?l(b,e):(b=h(b),e([b]))};e(q.prototype);q.prototype.add=function(b){if("string"==typeof b){a:{var e={},d=0;e.type=Number(b.charAt(0));if(null==f.types[e.type])b={type:f.ERROR,data:"parser error"};else{if(f.BINARY_EVENT==e.type||f.BINARY_ACK==e.type){for(var g="";"-"!=b.charAt(++d)&&(g+=b.charAt(d),d!=b.length););if(g!=Number(g)||"-"!=b.charAt(d))throw Error("Illegal attachments");
e.attachments=Number(g)}if("/"==b.charAt(d+1))for(e.nsp="";++d;){g=b.charAt(d);if(","==g)break;e.nsp+=g;if(d==b.length)break}else e.nsp="/";g=b.charAt(d+1);if(""!==g&&Number(g)==g){for(e.id="";++d;){g=b.charAt(d);if(null==g||Number(g)!=g){--d;break}e.id+=b.charAt(d);if(d==b.length)break}e.id=Number(e.id)}if(b.charAt(++d))try{e.data=B.parse(b.substr(d))}catch(Qg){b={type:f.ERROR,data:"parser error"};break a}n("decoded %s as %j",b,e);b=e}}f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type?(this.reconstructor=
new t(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else if(k(b)||b.base64)if(this.reconstructor){if(b=this.reconstructor.takeBinaryData(b))this.reconstructor=null,this.emit("decoded",b)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+b);};q.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};t.prototype.takeBinaryData=function(b){this.buffers.push(b);
return this.buffers.length==this.reconPack.attachments?(b=F.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),b):null};t.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},{"./binary":56,"./is-buffer":58,"component-emitter":8,debug:10,isarray:33,json3:34}],58:[function(b,e,f){(function(b){e.exports=function(e){return b.Buffer&&b.Buffer.isBuffer(e)||b.ArrayBuffer&&e instanceof ArrayBuffer}}).call(this,"undefined"!==typeof global?global:"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{}],59:[function(b,e,f){e.exports=function(b,e){for(var f=[],d=(e=e||0)||0;d<b.length;d++)f[d-e]=b[d];return f}},{}],60:[function(b,e,f){(function(b){(function(d){function g(b){for(var e=[],f=0,d=b.length,g,h;f<d;)g=b.charCodeAt(f++),55296<=g&&56319>=g&&f<d?(h=b.charCodeAt(f++),56320==(h&64512)?e.push(((g&1023)<<10)+(h&1023)+65536):(e.push(g),f--)):e.push(g);return e}function h(b){if(55296<=b&&57343>=b)throw Error("Lone surrogate U+"+b.toString(16).toUpperCase()+
" is not a scalar value");}function t(){if(u>=r)throw Error("Invalid byte index");var b=p[u]&255;u++;if(128==(b&192))return b&63;throw Error("Invalid continuation byte");}function n(){if(u>r)throw Error("Invalid byte index");if(u==r)return!1;var b=p[u]&255;u++;if(0==(b&128))return b;if(192==(b&224)){var e=t();b=(b&31)<<6|e;if(128<=b)return b;throw Error("Invalid continuation byte");}if(224==(b&240)){e=t();var f=t();b=(b&15)<<12|e<<6|f;if(2048<=b)return h(b),b;throw Error("Invalid continuation byte");
}if(240==(b&248)){e=t();f=t();var d=t();b=(b&15)<<18|e<<12|f<<6|d;if(65536<=b&&1114111>=b)return b}throw Error("Invalid UTF-8 detected");}var B="object"==typeof f&&f,F="object"==typeof e&&e&&e.exports==B&&e,k="object"==typeof b&&b;if(k.global===k||k.window===k)d=k;var m=String.fromCharCode,p,r,u;k={version:"2.0.0",encode:function(b){b=g(b);for(var e=b.length,f=-1,d,l="";++f<e;){d=b[f];if(0==(d&4294967168))d=m(d);else{var q="";0==(d&4294965248)?q=m(d>>6&31|192):0==(d&4294901760)?(h(d),q=m(d>>12&15|
224),q+=m(d>>6&63|128)):0==(d&4292870144)&&(q=m(d>>18&7|240),q+=m(d>>12&63|128),q+=m(d>>6&63|128));d=q+=m(d&63|128)}l+=d}return l},decode:function(b){p=g(b);r=p.length;u=0;b=[];for(var e;!1!==(e=n());)b.push(e);e=b.length;for(var f=-1,d,h="";++f<e;)d=b[f],65535<d&&(d-=65536,h+=m(d>>>10&1023|55296),d=56320|d&1023),h+=m(d);return h}};if(B&&!B.nodeType)if(F)F.exports=k;else{d={}.hasOwnProperty;for(var z in k)d.call(k,z)&&(B[z]=k[z])}else d.utf8=k})(this)}).call(this,"undefined"!==typeof global?global:
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],61:[function(b,e,f){e.exports="function"===typeof Object.create?function(b,e){b.super_=e;b.prototype=Object.create(e.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,e){b.super_=e;var f=function(){};f.prototype=e.prototype;b.prototype=new f;b.prototype.constructor=b}},{}],62:[function(b,e,f){e.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===
typeof b.fill&&"function"===typeof b.readUInt8}},{}],63:[function(b,e,f){(function(e,d){function g(b,e){var d={seen:[],stylize:t};3<=arguments.length&&(d.depth=arguments[2]);4<=arguments.length&&(d.colors=arguments[3]);z(e)?d.showHidden=e:e&&f._extend(d,e);y(d.showHidden)&&(d.showHidden=!1);y(d.depth)&&(d.depth=2);y(d.colors)&&(d.colors=!1);y(d.customInspect)&&(d.customInspect=!0);d.colors&&(d.stylize=h);return B(d,b,d.depth)}function h(b,e){return(e=g.styles[e])?"\u001b["+g.colors[e][0]+"m"+b+"\u001b["+
g.colors[e][1]+"m":b}function t(b,e){return b}function n(b){var e={};b.forEach(function(b,f){e[b]=!0});return e}function B(b,e,d){if(b.customInspect&&e&&D(e.inspect)&&e.inspect!==f.inspect&&(!e.constructor||e.constructor.prototype!==e)){var g=e.inspect(d,b);v(g)||(g=B(b,g,d));return g}if(g=F(b,e))return g;var h=Object.keys(e),l=n(h);b.showHidden&&(h=Object.getOwnPropertyNames(e));if(A(e)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return k(e);if(0===h.length){if(D(e))return b.stylize("[Function"+
(e.name?": "+e.name:"")+"]","special");if(G(e))return b.stylize(RegExp.prototype.toString.call(e),"regexp");if(E(e))return b.stylize(Date.prototype.toString.call(e),"date");if(A(e))return k(e)}g="";var q=!1,t=["{","}"];u(e)&&(q=!0,t=["[","]"]);D(e)&&(g=" [Function"+(e.name?": "+e.name:"")+"]");G(e)&&(g=" "+RegExp.prototype.toString.call(e));E(e)&&(g=" "+Date.prototype.toUTCString.call(e));A(e)&&(g=" "+k(e));if(0===h.length&&(!q||0==e.length))return t[0]+g+t[1];if(0>d)return G(e)?b.stylize(RegExp.prototype.toString.call(e),
"regexp"):b.stylize("[Object]","special");b.seen.push(e);h=q?m(b,e,d,l,h):h.map(function(f){return p(b,e,d,l,f,q)});b.seen.pop();return r(h,g,t)}function F(b,e){if(y(e))return b.stylize("undefined","undefined");if(v(e))return e="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",b.stylize(e,"string");if(x(e))return b.stylize(""+e,"number");if(z(e))return b.stylize(""+e,"boolean");if(null===e)return b.stylize("null","null")}function k(b){return"["+Error.prototype.toString.call(b)+
"]"}function m(b,e,f,d,g){for(var h=[],l=0,q=e.length;l<q;++l)Object.prototype.hasOwnProperty.call(e,String(l))?h.push(p(b,e,f,d,String(l),!0)):h.push("");g.forEach(function(g){g.match(/^\d+$/)||h.push(p(b,e,f,d,g,!0))});return h}function p(b,e,f,d,g,h){var l,q;e=Object.getOwnPropertyDescriptor(e,g)||{value:e[g]};e.get?q=e.set?b.stylize("[Getter/Setter]","special"):b.stylize("[Getter]","special"):e.set&&(q=b.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(d,g)||(l="["+g+"]");q||
(0>b.seen.indexOf(e.value)?(q=null===f?B(b,e.value,null):B(b,e.value,f-1),-1<q.indexOf("\n")&&(q=h?q.split("\n").map(function(b){return"  "+b}).join("\n").substr(2):"\n"+q.split("\n").map(function(b){return"   "+b}).join("\n"))):q=b.stylize("[Circular]","special"));if(y(l)){if(h&&g.match(/^\d+$/))return q;l=JSON.stringify(""+g);l.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(l=l.substr(1,l.length-2),l=b.stylize(l,"name")):(l=l.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),l=b.stylize(l,
"string"))}return l+": "+q}function r(b,e,f){var d=0;return 60<b.reduce(function(b,e){d++;0<=e.indexOf("\n")&&d++;return b+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?f[0]+(""===e?"":e+"\n ")+" "+b.join(",\n  ")+" "+f[1]:f[0]+e+" "+b.join(", ")+" "+f[1]}function u(b){return Array.isArray(b)}function z(b){return"boolean"===typeof b}function x(b){return"number"===typeof b}function v(b){return"string"===typeof b}function y(b){return void 0===b}function G(b){return C(b)&&"[object RegExp]"===Object.prototype.toString.call(b)}
function C(b){return"object"===typeof b&&null!==b}function E(b){return C(b)&&"[object Date]"===Object.prototype.toString.call(b)}function A(b){return C(b)&&("[object Error]"===Object.prototype.toString.call(b)||b instanceof Error)}function D(b){return"function"===typeof b}function K(b){return 10>b?"0"+b.toString(10):b.toString(10)}function L(){var b=new Date,e=[K(b.getHours()),K(b.getMinutes()),K(b.getSeconds())].join(":");return[b.getDate(),P[b.getMonth()],e].join(" ")}var J=/%[sdj%]/g;f.format=
function(b){if(!v(b)){for(var e=[],f=0;f<arguments.length;f++)e.push(g(arguments[f]));return e.join(" ")}f=1;var d=arguments,h=d.length;e=String(b).replace(J,function(b){if("%%"===b)return"%";if(f>=h)return b;switch(b){case "%s":return String(d[f++]);case "%d":return Number(d[f++]);case "%j":try{return JSON.stringify(d[f++])}catch(bn){return"[Circular]"}default:return b}});for(var l=d[f];f<h;l=d[++f])e=null!==l&&C(l)?e+(" "+g(l)):e+(" "+l);return e};f.deprecate=function(b,g){if(y(d.process))return function(){return f.deprecate(b,
g).apply(this,arguments)};if(!0===e.noDeprecation)return b;var h=!1;return function(){if(!h){if(e.throwDeprecation)throw Error(g);e.traceDeprecation?console.trace(g):console.error(g);h=!0}return b.apply(this,arguments)}};var I={},O;f.debuglog=function(b){y(O)&&(O=e.env.NODE_DEBUG||"");b=b.toUpperCase();if(!I[b])if((new RegExp("\\b"+b+"\\b","i")).test(O)){var d=e.pid;I[b]=function(){var e=f.format.apply(f,arguments);console.error("%s %d: %s",b,d,e)}}else I[b]=function(){};return I[b]};f.inspect=g;
g.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};g.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};f.isArray=u;f.isBoolean=z;f.isNull=function(b){return null===b};f.isNullOrUndefined=function(b){return null==b};f.isNumber=x;f.isString=v;f.isSymbol=function(b){return"symbol"===
typeof b};f.isUndefined=y;f.isRegExp=G;f.isObject=C;f.isDate=E;f.isError=A;f.isFunction=D;f.isPrimitive=function(b){return null===b||"boolean"===typeof b||"number"===typeof b||"string"===typeof b||"symbol"===typeof b||"undefined"===typeof b};f.isBuffer=b("./support/isBuffer");var P="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");f.log=function(){console.log("%s - %s",L(),f.format.apply(f,arguments))};f.inherits=b("inherits");f._extend=function(b,e){if(!e||!C(e))return b;for(var f=Object.keys(e),
d=f.length;d--;)b[f[d]]=e[f[d]];return b}}).call(this,b("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":62,_process:43,inherits:61}],64:[function(b,e,f){if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){var d="moz";var h=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)d="webkit",h=navigator.userAgent.match(/Chrom(e|ium)/)&&
parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10);b=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;f=window.mozRTCIceCandidate||window.RTCIceCandidate;var l=window.mozRTCSessionDescription||window.RTCSessionDescription,q=window.webkitMediaStream||window.MediaStream,t="https:"===window.location.protocol&&("webkit"===d&&26<=h||"moz"===d&&33<=h),n=window.AudioContext||window.webkitAudioContext,B=document.createElement("video");B=B&&B.canPlayType&&
"probably"===B.canPlayType('video/webm; codecs="vp8", vorbis');var F=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;e.exports={prefix:d,browserVersion:h,support:!!b&&!!F,supportRTCPeerConnection:!!b,supportVp8:B,supportGetUserMedia:!!F,supportDataChannel:!!(b&&b.prototype&&b.prototype.createDataChannel),supportWebAudio:!(!n||!n.prototype.createMediaStreamSource),supportMediaStream:!(!q||!q.prototype.removeTrack),supportScreenSharing:!!t,AudioContext:n,
PeerConnection:b,SessionDescription:l,IceCandidate:f,MediaStream:q,getUserMedia:F}},{}],65:[function(b,e,f){function d(){}e.exports=d;d.mixin=function(b){b=b.prototype||b;b.isWildEmitter=!0;b.on=function(b,e,f){this.callbacks=this.callbacks||{};var d=3===arguments.length,g=d?arguments[2]:arguments[1];g._groupName=d?arguments[1]:void 0;(this.callbacks[b]=this.callbacks[b]||[]).push(g);return this};b.once=function(b,e,f){function d(){g.off(b,d);l.apply(this,arguments)}var g=this,h=3===arguments.length,
l=h?arguments[2]:arguments[1];this.on(b,h?arguments[1]:void 0,d);return this};b.releaseGroup=function(b){this.callbacks=this.callbacks||{};var e,f;for(e in this.callbacks){var d=this.callbacks[e];var g=0;for(f=d.length;g<f;g++)d[g]._groupName===b&&(d.splice(g,1),g--,f--)}return this};b.off=function(b,e){this.callbacks=this.callbacks||{};var f=this.callbacks[b];if(!f)return this;if(1===arguments.length)return delete this.callbacks[b],this;var d=f.indexOf(e);f.splice(d,1);0===f.length&&delete this.callbacks[b];
return this};b.emit=function(b){this.callbacks=this.callbacks||{};var e=[].slice.call(arguments,1),f=this.callbacks[b],d=this.getWildcardCallbacks(b),g;if(f){var h=f.slice();f=0;for(g=h.length;f<g&&h[f];++f)h[f].apply(this,e)}if(d)for(h=d.slice(),f=0,g=h.length;f<g&&h[f];++f)h[f].apply(this,[b].concat(e));return this};b.getWildcardCallbacks=function(b){this.callbacks=this.callbacks||{};var e,f=[];for(e in this.callbacks){var d=e.split("*");if("*"===e||2===d.length&&b.slice(0,d[0].length)===d[0])f=
f.concat(this.callbacks[e])}return f}};d.mixin(d)},{}],66:[function(b,e,f){function d(b,e,f){return e?new h(b,e):new h(b)}b=window;var h=b.WebSocket||b.MozWebSocket;e.exports=h?d:null;h&&(d.prototype=h.prototype)},{}],67:[function(b,e,f){function d(b){var e=!0;b.getTracks().forEach(function(b){e="ended"===b.readyState&&e});return e}function h(b){var e=this;t.call(this);this.id=b.id;this.parent=b.parent;this.type=b.type||"video";this.oneway=b.oneway||!1;this.sharemyscreen=b.sharemyscreen||!1;this.browserPrefix=
b.prefix;this.stream=b.stream;this.enableDataChannels=void 0===b.enableDataChannels?this.parent.config.enableDataChannels:b.enableDataChannels;this.receiveMedia=b.receiveMedia||this.parent.config.receiveMedia;this.channels={};this.sid=b.sid||Date.now().toString();this.pc=new q(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints);this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("endOfCandidates",function(b){e.send("endOfCandidates",b)});this.pc.on("offer",
function(b){e.parent.config.nick&&(b.nick=e.parent.config.nick);e.send("offer",b)});this.pc.on("answer",function(b){e.parent.config.nick&&(b.nick=e.parent.config.nick);e.send("answer",b)});this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this));this.pc.on("addChannel",this.handleDataChannelAdded.bind(this));this.pc.on("removeStream",this.handleStreamRemoved.bind(this));this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded"));this.pc.on("iceConnectionStateChange",this.emit.bind(this,
"iceConnectionStateChange"));this.pc.on("iceConnectionStateChange",function(){switch(e.pc.iceConnectionState){case "failed":"offer"===e.pc.pc.localDescription.type&&(e.parent.emit("iceFailed",e),e.send("connectivityError"))}});this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange"));this.logger=this.parent.logger;"screen"===b.type?this.parent.localScreens&&this.parent.localScreens[0]&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),this.pc.addStream(this.parent.localScreens[0]),
this.broadcaster=b.broadcaster):this.parent.localStreams.forEach(function(b){e.pc.addStream(b)});this.on("channelOpen",function(b){"https://simplewebrtc.com/protocol/filetransfer#inband-v1"===b.protocol&&(b.onmessage=function(f){f=JSON.parse(f.data);var d=new n.Receiver;d.receive(f,b);e.emit("fileTransfer",f,d);d.on("receivedFile",function(b,e){d.channel.close()})})});this.on("*",function(){e.parent.emit.apply(e.parent,arguments)})}f=b("util");var l=b("webrtcsupport"),q=b("rtcpeerconnection"),t=b("wildemitter"),
n=b("filetransfer");f.inherits(h,t);h.prototype.handleMessage=function(b){var e=this;this.logger.log("getting",b.type,b);b.prefix&&(this.browserPrefix=b.prefix);"offer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleOffer(b.payload,function(b){b||e.pc.answer(function(b,e){})})):"answer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleAnswer(b.payload)):"candidate"===b.type?this.pc.processIce(b.payload):"connectivityError"===
b.type?this.parent.emit("connectivityError",e):"mute"===b.type?this.parent.emit("mute",{id:b.from,name:b.payload.name}):"unmute"===b.type&&this.parent.emit("unmute",{id:b.from,name:b.payload.name})};h.prototype.send=function(b,e){e={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:b,payload:e,prefix:l.prefix};this.logger.log("sending",b,e);this.parent.emit("message",e)};h.prototype.sendDirectly=function(b,e,f){var d={type:e,payload:f};this.logger.log("sending via datachannel",
b,e,d);b=this.getDataChannel(b);if("open"!=b.readyState)return!1;f.func!==kb.location?b.send(JSON.stringify(d)):b.send(f[1].buffer);return!0};h.prototype._observeDataChannel=function(b){var e=this;b.binaryType="arraybuffer";b.onclose=this.emit.bind(this,"channelClose",b);b.onerror=this.emit.bind(this,"channelError",b);b.onmessage=function(f){var d=f.data;d=d.byteLength?{type:"nehhof",payload:{1:new Uint8Array(d),func:kb.location}}:JSON.parse(d);e.emit("channelMessage",e,b.label,d,b,f)};b.onopen=this.emit.bind(this,
"channelOpen",b)};h.prototype.getDataChannel=function(b,e){if(!l.supportDataChannel)return this.emit("error",Error("createDataChannel not supported"));var f=this.channels[b];e||(e={});if(f)return f;f=this.channels[b]=this.pc.createDataChannel(b,e);f.binaryType="arraybuffer";this._observeDataChannel(f);return f};h.prototype.onIceCandidate=function(b){if(!this.closed)if(b){var e=this.parent.config.peerConnectionConfig;"moz"===l.prefix&&e&&e.iceTransports&&b.candidate&&b.candidate.candidate&&0>b.candidate.candidate.indexOf(e.iceTransports)?
this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",e.iceTransports):this.send("candidate",b)}else this.logger.log("End of candidates.")};h.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc");this.pc.offer(this.receiveMedia,function(b,e){})};h.prototype.icerestart=function(){var b=this.receiveMedia;b.mandatory.IceRestart=!0;this.pc.offer(b,function(b,e){})};h.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())};
h.prototype.handleRemoteStreamAdded=function(b){var e=this;this.stream?this.logger.warn("Already have a remote stream"):(this.stream=b.stream,this.stream.getTracks().forEach(function(b){b.addEventListener("ended",function(){d(e.stream)&&e.end()})}),this.parent.emit("peerStreamAdded",this))};h.prototype.handleStreamRemoved=function(){var b=this.parent.peers.indexOf(this);-1<b&&(this.parent.peers.splice(b,1),this.closed=!0,this.parent.emit("peerStreamRemoved",this))};h.prototype.handleDataChannelAdded=
function(b){this.channels[b.label]=b;this._observeDataChannel(b)};h.prototype.sendFile=function(b){var e=new n.Sender,f=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:"https://simplewebrtc.com/protocol/filetransfer#inband-v1"});f.onopen=function(){f.send(JSON.stringify({size:b.size,name:b.name}));e.send(b,f)};f.onclose=function(){console.log("sender received transfer");e.emit("complete")};return e};e.exports=h},{filetransfer:26,rtcpeerconnection:44,util:63,webrtcsupport:64,wildemitter:65}],
68:[function(b,e,f){function d(b){var e=this,f=b||{},d=this.config={url:"https://sandbox.simplewebrtc.com:443/",socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}},g;var B=b.debug?b.logger||console:b.logger||n;this.logger=B;for(g in f)f.hasOwnProperty(g)&&
(this.config[g]=f[g]);this.capabilities=q;l.call(this);var F=null===this.config.connection?this.connection=new k(this.config):this.connection=this.config.connection;F.on("connect",function(){e.emit("connectionReady",F.getSessionid());e.sessionReady=!0;e.testReadiness()});F.on("message",function(b){var f=e.webrtc.getPeers(b.from,b.roomType);if("offer"===b.type){f.length&&f.forEach(function(e){e.sid==b.sid&&(d=e)});if(!d){var d=e.webrtc.createPeer({id:b.from,sid:b.sid,type:b.roomType,enableDataChannels:e.config.enableDataChannels&&
"screen"!==b.roomType,sharemyscreen:"screen"===b.roomType&&!b.broadcaster,broadcaster:"screen"!==b.roomType||b.broadcaster?null:e.connection.getSessionid()});e.emit("createdPeer",d)}d.handleMessage(b)}else f.length&&f.forEach(function(e){b.sid?e.sid===b.sid&&e.handleMessage(b):e.handleMessage(b)})});F.on("remove",function(b){b.id!==e.connection.getSessionid()&&e.webrtc.removePeers(b.id,b.type)});b.logger=this.logger;b.debug=!1;this.webrtc=new h(b);"mute unmute pauseVideo resumeVideo pause resume sendToAll sendDirectlyToAll getPeers".split(" ").forEach(function(b){e[b]=
e.webrtc[b].bind(e.webrtc)});this.webrtc.on("*",function(){e.emit.apply(e,arguments)});if(d.debug)this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:"));this.webrtc.on("localStream",function(){e.testReadiness()});this.webrtc.on("message",function(b){e.connection.emit("message",b)});this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this));this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this));this.config.adjustPeerVolume&&(this.webrtc.on("speaking",
this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1)));F.on("stunservers",function(b){e.webrtc.config.peerConnectionConfig.iceServers=b;e.emit("stunservers",b)});F.on("turnservers",function(b){e.webrtc.config.peerConnectionConfig.iceServers=e.webrtc.config.peerConnectionConfig.iceServers.concat(b);e.emit("turnservers",b)});this.webrtc.on("iceFailed",function(b){});this.webrtc.on("connectivityError",function(b){});this.webrtc.on("audioOn",
function(){e.webrtc.sendToAll("unmute",{name:"audio"})});this.webrtc.on("audioOff",function(){e.webrtc.sendToAll("mute",{name:"audio"})});this.webrtc.on("videoOn",function(){e.webrtc.sendToAll("unmute",{name:"video"})});this.webrtc.on("videoOff",function(){e.webrtc.sendToAll("mute",{name:"video"})});this.webrtc.on("localScreen",function(b){var f=document.createElement("video"),d=e.getRemoteVideoContainer();f.oncontextmenu=function(){return!1};f.id="localScreen";t(b,f);d&&d.appendChild(f);e.emit("localScreenAdded",
f);e.connection.emit("shareScreen");e.webrtc.peers.forEach(function(b){"video"===b.type&&(b=e.webrtc.createPeer({id:b.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:e.connection.getSessionid()}),e.emit("createdPeer",b),b.start())})});this.webrtc.on("localScreenStopped",function(b){e.getLocalScreen()&&e.stopScreenShare()});this.webrtc.on("channelMessage",function(b,f,d){"volume"==d.type&&e.emit("remoteVolumeChange",b,d.volume)});
this.config.autoRequestMedia&&this.startLocalVideo()}var h=b("./webrtc"),l=b("wildemitter"),q=b("webrtcsupport"),t=b("attachmediastream"),n=b("mockconsole"),k=b("./socketioconnection");d.prototype=Object.create(l.prototype,{constructor:{value:d}});d.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare();this.emit("leftRoom",this.roomName);this.roomName=void 0}};d.prototype.disconnect=
function(){this.connection.disconnect();delete this.connection};d.prototype.handlePeerStreamAdded=function(b){var e=this,f=this.getRemoteVideoContainer(),d=t(b.stream);b.videoEl=d;d.id=this.getDomId(b);f&&f.appendChild(d);this.emit("videoAdded",d,b);window.setTimeout(function(){e.webrtc.isAudioEnabled()||b.send("mute",{name:"audio"});e.webrtc.isVideoEnabled()||b.send("mute",{name:"video"})},250)};d.prototype.handlePeerStreamRemoved=function(b){var e=this.getRemoteVideoContainer(),f=b.videoEl;this.config.autoRemoveVideos&&
e&&f&&e.removeChild(f);f&&this.emit("videoRemoved",f,b)};d.prototype.getDomId=function(b){return[b.id,b.type,b.broadcaster?"broadcasting":"incoming"].join("_")};d.prototype.setVolumeForAll=function(b){this.webrtc.peers.forEach(function(e){e.videoEl&&(e.videoEl.volume=b)})};d.prototype.joinRoom=function(b,e){var f=this;this.roomName=b;this.connection.emit("join",b,function(d,g){console.log("join CB",d);if(d)f.emit("error",d);else{if(!g.xtra){wb();Za();ae(u.errorLoading,"#ff0000");return}v.room=g.xtra;
var h,l;for(h in g.clients){var q=g.clients[h];for(l in q)if(q[l]){var n=f.webrtc.createPeer({id:h,type:l,enableDataChannels:f.config.enableDataChannels&&"screen"!==l,receiveMedia:{offerToReceiveAudio:"screen"!==l&&f.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:f.config.receiveMedia.offerToReceiveVideo}});f.emit("createdPeer",n);n.start()}}}e&&e(d,g);f.emit("joinedRoom",b)})};d.prototype.getEl=function(b){return"string"===typeof b?document.getElementById(b):b};d.prototype.startLocalVideo=
function(){var b=this;this.webrtc.start(this.config.media,function(e,f){e?b.emit("localMediaError",e):t(f,b.getLocalVideoContainer(),b.config.localVideo)})};d.prototype.stopLocalVideo=function(){this.webrtc.stop()};d.prototype.getLocalVideoContainer=function(){var b=this.getEl(this.config.localVideoEl);if(b&&"VIDEO"===b.tagName)return b.oncontextmenu=function(){return!1},b;if(b){var e=document.createElement("video");e.oncontextmenu=function(){return!1};b.appendChild(e);return e}};d.prototype.getRemoteVideoContainer=
function(){return this.getEl(this.config.remoteVideosEl)};d.prototype.shareScreen=function(b){this.webrtc.startScreenShare(b)};d.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]};d.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var b=document.getElementById("localScreen"),e=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&e&&b&&e.removeChild(b);b&&this.emit("videoRemoved",b);this.getLocalScreen()&&this.webrtc.stopScreenShare();
this.webrtc.peers.forEach(function(b){b.broadcaster&&b.end()})};d.prototype.testReadiness=function(){this.sessionReady&&(this.config.media.video||this.config.media.audio?0<this.webrtc.localStreams.length&&this.emit("readyToCall",this.connection.getSessionid()):this.emit("readyToCall",this.connection.getSessionid()))};d.prototype.createRoom=function(b,e){this.roomName=b;this.connection.emit("create",v.room,e)};d.prototype.sendFile=function(){if(!q.dataChannel)return this.emit("error",Error("DataChannelNotSupported"))};
e.exports=d},{"./socketioconnection":69,"./webrtc":70,attachmediastream:3,mockconsole:37,webrtcsupport:64,wildemitter:65}],69:[function(b,e,f){function d(b){this.connection=h.connect(b.url,b.socketio)}var h=b("socket.io-client");d.prototype.on=function(b,e){this.connection.on(b,e)};d.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};d.prototype.getSessionid=function(){return this.connection.id};d.prototype.disconnect=function(){return this.connection.disconnect()};e.exports=
d},{"socket.io-client":50}],70:[function(b,e,f){function d(b){var e=this,f=b||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:!0};var d;b=b.debug?b.logger||console:b.logger||l;this.logger=b;for(d in f)f.hasOwnProperty(d)&&(this.config[d]=f[d]);h.support||this.logger.error("Your browser doesn't seem to support WebRTC");this.peers=[];
q.call(this,this.config);this.on("speaking",function(){e.hardMuted||e.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"speaking"})))})});this.on("stoppedSpeaking",function(){e.hardMuted||e.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"stoppedSpeaking"})))})});this.on("volumeChange",function(b,f){e.hardMuted||e.peers.forEach(function(e){e.enableDataChannels&&
(e=e.getDataChannel("hark"),"open"==e.readyState&&e.send(JSON.stringify({type:"volume",volume:b})))})});if(this.config.debug)this.on("*",function(b,f,d){(e.config.logger===l?console:e.logger).log("event:",b,f,d)})}f=b("util");var h=b("webrtcsupport"),l=b("mockconsole"),q=b("localmedia"),t=b("./peer");f.inherits(d,q);d.prototype.createPeer=function(b){b.parent=this;b=new t(b);this.peers.push(b);return b};d.prototype.removePeers=function(b,e){this.getPeers(b,e).forEach(function(b){b.end()})};d.prototype.getPeers=
function(b,e){return this.peers.filter(function(f){return(!b||f.id===b)&&(!e||f.type===e)})};d.prototype.sendToAll=function(b,e){this.peers.forEach(function(f){f.send(b,e)})};d.prototype.sendDirectlyToAll=function(b,e,f){this.peers.forEach(function(d){d.enableDataChannels&&d.sendDirectly(b,e,f)})};e.exports=d},{"./peer":67,localmedia:35,mockconsole:37,util:63,webrtcsupport:64}]},{},[68])(68)})},G,Da,u={},v={name:localStorage.name,color:localStorage.color||"#ff0000"},Gc=function(){};console.log("%c nehhon %c POWER ",
"background: #00ffd4; color: #000; font-size:20px","background: #000; color: #00ffd4; font-size:20px");console.log("%c Author: Ruben ","background: #000; color: #00ffd4; font-size:20px");console.log("%c webmaster@nehhon.com ","background: #00ffd4; color: #000; font-size:20px");console.log("%c @nehhon ","background: #000; color: #00ffd4; font-size:20px");var r=function(c){return document.getElementById(c)},cb=function(c,b,e){void 0===localStorage[c]&&(localStorage[c]=b);e&&(r(e).value=localStorage[c])};
void 0===localStorage.fullscreen&&(localStorage.fullscreen=!0);cb("musicRange",80,"musicRange");cb("soundRange",45,"soundRange");cb("gold",400);cb("food",400);cb("stone",400);cb("wood",400);cb("infinity","true");cb("mapSize",256);cb("terrainType","grass");cb("water","0");cb("items","10");cb("peons","3");cb("gateways","1");console.log=Gc;console.error=Gc;console.warn=Gc;console.info=Gc;"tza.red"!==location.hostname&&(location.href="https://tza.red");window.onbeforeunload=function(){return"Are you sure you want to quit?"};
var yl=function(c){c.parentNode.removeChild(c)},ae=function(c,b){var e=document.getElementById("notifybar"),f=document.createElement("div");f.innerHTML=c;b&&(f.style.background=b);e.appendChild(f);setTimeout(yl,11E3,f)},Yg=function(c){c=parseInt(c.substr(1),16);return[c>>16&255,c>>8&255,c&255]},zl=location;(function(){var c=!!window.opr||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),b="undefined"!==typeof InstallTrigger,e=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),
f=!!document.documentMode,d=!f&&!!window.StyleMedia,h=!!window.chrome&&!!window.chrome.webstore,l;c?l="Opera":b?l="Firefox":e?l="Safari":f?l="IE":d?l="Edge":h&&(l="Chrome");v.navLang=localStorage.language||navigator.language||navigator.userLanguage;c=v.navLang.substr(0,2);b={es:["Tzared","Juego de estrategia en tiempo real para navegadores web, juega solo o con amigos","tzared,jugar,multijugador,juego,online,navegador web,tzar"],it:["Tzared","Gioco di strategia in tempo reale per browser web, giocare da soli o con gli amici",
"tzared,giocare,multigiocatore,gioco,online,navigatore,tzar,web"],pl:["Tzared","Gra strategiczna w czasie rzeczywistym dla przegl\u0105darek internetowych, bawi\u0107 si\u0119 samotnie lub z przyjaci\u00f3\u0142mi","tzared,gra,multiplayer,online,tzar,przegl\u0105darka internetowa"],ru:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u043b\u044f \u0432\u0435\u0431-\u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u0432, \u0438\u0433\u0440\u0430\u0442\u044c \u0432 \u043e\u0434\u0438\u043d\u043e\u0447\u043a\u0443 \u0438\u043b\u0438 \u0441 \u0434\u0440\u0443\u0437\u044c\u044f\u043c\u0438",
"\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u044c\u0442\u0438\u043f\u043b\u0435\u0435\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u0435\u0440,\u043e\u0433\u043d\u0451\u043c \u0438 \u043c\u0435\u0447\u043e\u043c"],pt:["Tzared","Jogo de estrat\u00e9gia em tempo real para navegadores da web, jogar sozinho ou com amigos","tzared,jogar,multiplayer,jogo,online,navegador web,tzar"],bg:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0447\u0435\u0441\u043a\u0430 \u0438\u0433\u0440\u0430 \u0432 \u0440\u0435\u0430\u043b\u043d\u043e \u0432\u0440\u0435\u043c\u0435 \u0437\u0430 \u0443\u0435\u0431 \u0431\u0440\u0430\u0443\u0437\u044a\u0440\u0438, \u0438\u0433\u0440\u0430\u0439\u0442\u0435 \u0441\u0430\u043c\u0438 \u0438\u043b\u0438 \u0441 \u043f\u0440\u0438\u044f\u0442\u0435\u043b\u0438",
"\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u0442\u0438\u043f\u043b\u0435\u0439\u044a\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u044a\u0440"],de:["Tzared","Echtzeit-Strategiespiel f\u00fcr Webbrowser, alleine oder mit Freunden spielen","tzared,multiplayer,spiel,online,Webbrowser,tzar"],en:["Tzared","Real-time strategy game for web browsers, play alone or with friends","tzared,play,multiplayer,game,online,browser,tzar,web"]};b[c]||(c=
"en");document.getElementsByTagName("html")[0].lang=c;b=b[location.search.split("lang=")[1]||"en"];document.title=b[0];v.title=b[0];document.getElementsByTagName("meta").description=b[1];document.getElementsByTagName("meta").keywords=b[2];v.version="v31.6";v.versionDate=Date.now()-1532627032398;localStorage.version!==v.version&&(localStorage.version=v.version,ae("Updated to "+v.version));r("info").innerHTML="Work in progress - Beta "+v.version+" - Updated "+~~(v.versionDate/864E5)+" days ago";v.lang=
"en es it pt ru pl bg de".split(" ").indexOf(c);0>v.lang&&(v.lang=0);v.langstr=c;v.team=0;v.race=0;v.navigator=l;v.mx=151;v.onlineID=null;v.temperature=0;v.cdn="/nehhon/"})();u={open:"Open",loading:"Loading...",systemAlert:"System Message",notEnough:"Not enough %s",ok:"OK",yes:"Yes",no:"No",secure:"Are you sure?",gold:"Gold",stone:"Stone",wood:"Wood",food:"Food",mana:"Manna",warning:"Warning",play:"PLAY",grass:"Grass",snow:"Snow",close:"CLOSE",gameClosed:"The game was canceled by the server.",loadgraphics:"Downloading graphics...",
waitImages:"Downloading graphics",wait:"Wait",audioproblem:"Your browser is not compatible with Web Audio",defeated:"DEFEATED",victorious:"VICTORIOUS",options:"OPTIONS",refresh:"Refresh",back:"BACK",paused:"PAUSED",chatMsg:"CHAT MESSAGE",disconnect:"Disconnect",playerDisconnected:"%s has disconnected!",connectionError:"Connection error",noP2P:"Engine not loaded",startingResources:"Starting Resources",mapSize:"Map Size",menu:"MENU",quit:"QUIT",downloadAll:"Download all",continue:"Continue",backToGame:"BACK TO GAME",
initializing:"Initializing...",requires:"Requires",stop:"Stop",pickItems:"Pick items",move:"Move",stand:"Stand ground",explore:"Explore",patrol:"Patrol",guard:"Guard",errorLoading:"Error loading game.",waitingPlayers:"Waiting for players to connect",musicVolume:"Music Volume",soundVolume:"Sound Volume",common:"Common",popLimit:"Population limit reached",houseLimit:"Not enough houses",lightning:"Lightning",freeze:"Freeze",bless:"Bless",heal:"Heal",invisibility:"Invisibility",dcm:"Dig, chop or mine",
repair:"Repair building",menuBuild:"See what you can build",units:"Units",infinite:"Infinite",gameFull:"Sorry, the game is full.",terrainOption:"Terrain",playerDefeated:"%s has been defeated!",savegame:"SAVE GAME",loadRecord:"Recording",stats:"Stats",builds:"Builds",items:"Items",nature:"Nature",trees:"Trees",delete:"Delete",create:"Create",username:"Player Name",gameOptions:"GAME OPTIONS",nplayers:"Number of Players",gameName:"Enter Game Name",gamesFound:"Games Found",strSearch:"SEARCH| Search for existing games",
strCreate:"CREATE| Create a game",randomMap:"RANDOM MAP",strcusMap:"CUSTOM MAP",strSettings:"SETTINGS",mapMaking:"Map Making",terrain:"Terrain",save:"SAVE",accept:"ACCEPT",team:"Team",color:"Colour",offlinePlay:"For playing offline",AI:"AI Assist",kingdom:"Kingdom",attack:"Attack",defence:"Defence",health:"Health",maxHealth:"Max health",playing:"Playing",waiting:"Waiting",joining:"Joining...",random:"Random",cancel:"CANCEL",rules:"Rules",events:"Events",actions:"Actions",objAction:"Object action",
destroyObj:"Destroy object",defined:"Defined",undefined:"Undefined",destroy:"Destroy",capture:"Capture",moving:"Moving",add:"Add",objOrder:"Order",objZone:"Object in zone",zone:"Zone",editMap:"Edit",mapName:"Map name",water:"Water",description:"Map Description",author:"Author",fullscreen:"Automatic full screen",versionError:"Incorrect game version.",language:"Language",english:"English",spanish:"Espa\u00f1ol",italian:"Italiano",portuguese:"Portugu\u00eas",russian:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",
polish:"Polski",bulgarian:"\u0431\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",german:"Deutsch",up:"Up",down:"Down",kick:"Kick",kicked:"You were kicked off by the server.",nospace:"Not enought space",peons:"Peasants",gateways:"Magic Gateways",computer:"Computer",addAI:"Add AI"};var $i=Gc,bj=function(c){c--;var b=new XMLHttpRequest;b.open("GET","/nehhon/"+v.langstr+".json",!0);b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onreadystatechange=function(){if(4==
b.readyState&&200==b.status){var c=JSON.parse(b.response);$i=function(){for(var b=x,e=0;e<b.length;e++){var f=b[e].name;c[f]&&(b[e].name=c[f])}for(e=0;e<E.length;e++)b=E[e],c[b.name[0]]&&c[b.name[1]]&&(b.name[0]=c[b.name[0]],b.name[1]=c[b.name[1]]);c=null};for(var f=[],g=0;0>g;g++)"undefined"!=typeof d[g]&&null!=d[g].tech&&(f.push(d[g].tech.name),Object.freeze(d[g].tech));for(g=0;g<f.length;g++)f[g][0]=c[f[g][0]],f[g][1]=c[f[g][1]];f=Object.keys(u);for(g=0;g<f.length;g++){var h=f[g];void 0!=c[u[h]]&&
(u[h]=c[u[h]])}Object.freeze(u);for(g=0;g<Ha.length;g++)Ha[g]=c[Ha[g]];for(g=0;g<0*dh.length;g++)dh[g]=c[dh[g]];Object.freeze(Ha);aj()}};b.send()},aj=function(){for(var c=["refreshButton",u.refresh,"optionsButton",u.options,"startButton",u.play,"backButton",u.back,"closeButton",u.close,"quitButton",u.quit,"continueButton",u.continue],b=0,e=c.length;b<e;b+=2)for(var f=document.getElementsByClassName(c[b]),d=0,h=f.length;d<h;d++)f[d].innerHTML=c[b+1];c=["alertok",u.ok,"sendMessageH2",u.chatMsg,"backToGame",
u.backToGame,"backToGameS",u.backToGame,"musicVolume",u.musicVolume,"soundVolume",u.soundVolume,"menueditor",u.menu,"saveGame",u.savegame,"playrecord",u.loadRecord,"seeStats",u.stats,"gameMenu",u.menu,"selectBuilds",u.builds,"selectUnits",u.units,"selectItems",u.items,"selectNature",u.nature,"gamesFound",u.gamesFound,"strSearch",u.strSearch.split("| ")[1],"strCreate",u.strCreate.split("| ")[1],"strRandomMap",u.randomMap,"strcusMap",u.strcusMap,"strMapEditor",u.mapMaking,"h2cusmap",u.strcusMap,"h2rndMap",
u.randomMap,"mapProps",u.options,"mapRules",u.rules,"editCustom",u.editMap,"strSettings",u.strSettings];b=0;for(e=c.length;b<e;b+=2)document.getElementById(c[b]).innerHTML=c[b+1]};0<v.lang?(bj(v.lang),bj.translated=!0):aj();var J=console.log,Al=document.getElementById("alerttitle"),Bl=document.getElementById("alerttext"),Cl=document.getElementById("alert"),Hc=function(c,b,e){Cl.style.display="block";Al.innerHTML=b||u.warning;Bl.innerHTML=c;e?document.getElementById("alertok").style.display="none":
document.getElementById("alertok").style.display="block";r("basic").style.filter="blur(94px)"},Dl=[1E3,0,2E3,0],Oi,dj=function(c,b,e){var f=new XMLHttpRequest;f.open("GET",c,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");f.onload=function(){b.length?S[b]=cj(f.response):S.xtra[b]=cj(f.response);S.load++;Wb&&S.load===S.images&&Wb()};e&&(f.onprogress=function(b){e(b)});f.send("")},cj=function(c){performance.now();c=new Uint16Array(c);
var b=c.length,e=c[b-4]+65536*c[b-3],f=c[b-2]+65536*c[b-1];b-=2;var d=-1;f=new Uint8Array(4*f);for(var h=0;e<b;e++){var l=c[e];if(65533<l){65535==l?(l=c[e+1],e+=1):(l=c[e+1]+65536*c[e+2],e+=2);for(var q=0;q<l;q++)f[h++]=d&255,f[h++]=d>>8&255,f[h++]=d>>16&255,f[h++]=d>>24&255}else l=c[2*l]+65536*c[2*l+1],f[h++]=l&255,f[h++]=l>>8&255,f[h++]=l>>16&255,f[h++]=l>>24&255,d=l}return f},Ic=function(){var c=["icons.png","images.json","graphics.nh17","terrainDataGrass.json","grass.nh17"];c=c.concat(eh);var b=
c.length;Ic.max=b;for(var e=0;e<b;e++)El(v.cdn+c[e]);this.innerHTML="0%";this.disabled=!0;Ic.button=this};Ic.loaded=0;var El=function(c){var b=new XMLHttpRequest;b.open("GET",c,!0);b.responseType="arraybuffer";b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onload=function(){Ic.loaded++;Ic.button.innerHTML=~~(100*Ic.loaded/Ic.max+.5)+"%"};b.send("")},S={size:512,load:0,xtra:[]},Wb;S.xtraRes=[];var Q={page:0,length:8,leftButton:document.getElementById("aleft"),
rightButton:document.getElementById("aright"),stock:document.getElementById("stock")},m;(function(){var c=0,b=0,e=function(e){e.target.loadedSize||(b+=e.total,e.target.lastLoaded=0,e.target.loadedSize=!0);c+=e.loaded-e.target.lastLoaded;e.target.lastLoaded=e.loaded;r("loadingtext").innerHTML=u.loadgraphics+~~(100*c/b)+"%"},f=function(b){var c=!!b.icons;S.images=Object.keys(b).length;if(c){var f=new XMLHttpRequest;f.open("GET",b.icons,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type",
" text / plain; charset = dropbox - cors - hack");f.onreadystatechange=function(){if(4===f.readyState&&200===f.status){var b=new Uint8Array(f.response);b=new Blob([b],{type:"image/png"});var c=new Image;c.src=URL.createObjectURL(b);S.load++;Q.icons=c;Wb&&S.load===S.images&&Wb();Date.now()}};f.onprogress=function(b){e(b)};f.send("")}Date.now();var d=new XMLHttpRequest;d.open("GET",b.imageJSON,!0);c&&d.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");d.onreadystatechange=
function(){4==this.readyState&&200==this.status&&(S.load++,Wb&&S.load===S.images&&Wb(),m=JSON.parse(d.response))};d.onprogress=function(b){e(b)};d.send(!0);dj(b.common,"common",e)};(function(){var b=!1;"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/sworker.js").then(function(b){console.log("CLIENT: service worker registration complete.")},function(b){J(b);console.log("CLIENT: service worker registration failure.")}),
navigator.serviceWorker.oncontrollerchange=function(){console.log("page controlled by:",navigator.serviceWorker.controller);location.reload(!0)}):console.log("CLIENT: service worker is not supported.");Oi=function(){S.started=!0;if(!b){b=!0;var c=v.cdn;f({icons:c+"icons.png",imageJSON:c+"images.json",common:c+"graphics.nh17"})}}})()})();var Wg={grass:{json:"terrainDataGrass.json",main:"grass.nh17"},snow:{json:"terrainDataSnow.json",main:"snow.nh17"},last:""},tf,ql=function(){var c=v.cdn;S.images+=
2;r("terrainSelect")&&(localStorage.terrain=r("terrainSelect").value);var b=Wg[p.terrainType],e=new XMLHttpRequest;e.open("GET",c+b.json,!0);e.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){S.xtraRes[0]=JSON.parse(e.response);pc=S.xtraRes[0];var b=pc.specialColor;tf=new Float32Array(db(b[0]/255,b[1]/255,b[2]/255,.9));S.load++;b="rgb("+b[0]+","+b[1]+","+b[2]+")";r("msgs1").style.color=b;r("playersinfo").style.color=
b;r("topinfo").style.color=b;Wb&&S.load===S.images&&Wb()}};e.send(!0);dj(c+b.main,0,!1)},sc,yd,uf,Jc,vf,fh,be,ej,ce,fj,gj,O,wf,de,vb,gh,sa,va,xf={},eh="ts1.mp3 ts2.mp3 ts3.mp3 ts4.mp3 ts5.mp3 ts6.mp3 ts7.mp3 ts8.mp3 ts9.mp3 ts10.mp3 sr1.mp3 sr2.mp3 sr3.mp3 sr4.mp3 sr5.mp3 sr6.mp3 sr7.mp3 sr8.mp3 sr9.mp3 sr10.mp3 1.mp3 2.mp3 3.mp3 4.mp3 5.mp3 6.mp3 7.mp3 8.mp3 9.mp3 10.mp3 INTRO.mp3 OUTRO.mp3 WIN1.mp3 WIN2.mp3 ATTACK.WAV BALLISTA.WAV BLDGDONE.WAV CHAT%20LOCATION.WAV TECHDONE.WAV UNITDONE.WAV CHAT.WAV E_CASTLE1.WAV E_CATHEDRAL1.WAV E_CATHEDRAL2.WAV E_FARM1.WAV E_CHURCH1.WAV E_FARM2.WAV E_HARBOR1.WAV E_LUMBER1.WAV E_MAGETOWER1.WAV E_MAGETOWER2.WAV E_MAGETOWER3.WAV E_MARKET1.WAV E_SHIPYARD1.WAV E_STABLES1.WAV E_STORAGE1.WAV E_OUTPOST1.WAV E_STORAGE2.WAV E_TAVERN1.WAV E_WARACADEMY1.WAV E_WORKSHOP1.WAV EVILCASTLE.WAV GATE1.WAV GATE2.WAV GATE3.WAV GATE4.WAV GATE5.WAV GATE6.WAV GATEWAY.WAV HOUSE1.WAV HOUSE2.WAV HOUSE3.WAV HOUSE4.WAV HOUSE5.WAV MERCHANT.WAV MINE1.WAV MONASTERY1.WAV MONASTERY2.WAV R_CATHEDRAL1.WAV R_CHURCH1.WAV SHAOLIN2.WAV SHAOLIN.WAV CHOP%201.WAV CHOP%202.WAV CHOP%203.WAV CHOP%204.WAV CHOP%205.WAV CHOP%206.WAV CHOP%207.WAV CHOP%208.WAV CHOP%209.WAV CHOP%2010.WAV CHOP%2011.WAV DIG%201.WAV DIG%202.WAV DIG%203.WAV MINE%201.WAV MINE%202.WAV MINE%203.WAV HIT%201.WAV HIT%202.WAV HIT%203.WAV HIT%204.WAV HIT%205.WAV HIT%206.WAV HIT%207.WAV GHOST1.WAV GHOST2.WAV GOLEM1.WAV GOLEM2.WAV H%20SWORD%201.WAV H%20SWORD%202.WAV H%20SWORD%203.WAV H%20SWORD%204.WAV H%20SWORD%205.WAV H%20SWORD%206.WAV H%20SWORD%207.WAV H%20SWORD%207.WAV H%20SWORD%208.WAV H%20SWORD%209.WAV H%20SWORD%2010.WAV H%20SWORD%2011.WAV H%20SWORD%2012.WAV HAND1.WAV HAND2.WAV HAND3.WAV HAND4.WAV MAGE%20ATTACK.WAV MESSIAH.WAV ORC%20SWORD%201.WAV ORC%20SWORD%202.WAV ORC%20SWORD%203.WAV ORC%20SWORD%204.WAV ORC%20SWORD%205.WAV ORC%20SWORD%206.WAV ORC%20SWORD%20V1.WAV ORC%20SWORD%20V2.WAV ORC%20SWORD%20V3.WAV SHIP%20CANNON%201.WAV SHIP%20CANNON%202.WAV SHIP%20CANNON%203.WAV SHIP%20CANNON%204.WAV SHIP%20CANNON%205.WAV SHIP%20CANNON%206.WAV SHIP%20CANNON%207.WAV SIEGE.WAV SWORD%201.WAV SWORD%202.WAV SWORD%203.WAV SWORD%204.WAV SWORD%205.WAV SWORD%206.WAV SWORD%207.WAV SWORD%208.WAV SWORD%209.WAV SWORD%2010.WAV SWORD%2011.WAV SWORD%2012.WAV SWORD%2013.WAV SWORD%2014.WAV SWORD%2015.WAV SWORD%2016.WAV V%20SWORD%201.WAV V%20SWORD%202.WAV V%20SWORD%203.WAV V%20SWORD%204.WAV V%20SWORD%205.WAV V%20SWORD%206.WAV V%20SWORD%207.WAV ADRAGON2.WAV ADRAGON3.WAV ARROW%201.WAV ARROW%202.WAV ARROW%203.WAV ARROW%204.WAV ARROW%205.WAV ARROW%206.WAV ARROW%20V1.WAV ARROW%20V2.WAV ARROW%20V3.WAV ARROW%20V4.WAV BEAR1.WAV BEAR2.WAV BEAR3.WAV BEAR4.WAV BEAR5.WAV MWORKSHOP.WAV DESTROY%20BUILDING.WAV DESTROY%20MINE.WAV LIGHTING2.WAV LIGHTING.WAV METEOR.WAV SMALL%20EXPLOSION.WAV WATER%20BLOP.WAV SPY%20KILL%201.WAV SPY%20KILL%203.WAV SPY%20KILL%202.WAV PRIEST%20ATTACK.WAV LIGHTNING.WAV INVISIBLE.WAV HEAL.WAV FREEZE.WAV FLAME%20BALL.WAV CURSE.WAV CRUSADE.WAV CONFUSION.WAV BLESS.WAV WHIRLPOOL.WAV TURN%20TO%20STONE.WAV TEACH.WAV SUMMON10.WAV SUMMON9.WAV SUMMON8.WAV SUMMON7.WAV SUMMON6.WAV SUMMON5.WAV SUMMON4.WAV SUMMON3.WAV SUMMON2.WAV SUMMON1.WAV REVEAL.WAV RESSURECT.WAV COWDIE1.WAV COWDIE2.WAV COWDIE1.WAV COWDIE3.WAV COWDIE4.WAV DIE%201.WAV DIE%202.WAV DIE%203.WAV DIE%204.WAV DIE%205.WAV DIE%206.WAV DIE%207.WAV DIE%208.WAV DIE%209.WAV DIE%2010.WAV DRAGON%20DIE%201.WAV DRAGON%20DIE%202.WAV GHOST1.WAV GHOST2.WAV GOLEM.WAV H%20DIE%201.WAV H%20DIE%202.WAV H%20DIE%203.WAV H%20DIE%204.WAV H%20DIE%205.WAV H%20DIE%206.WAV H%20DIE%207.WAV H%20DIE%208.WAV H%20DIE%209.WAV H%20DIE%2010.WAV MAGE.WAV ORC%20DIE%201.WAV ORC%20DIE%202.WAV SHIP%20SINK.WAV SIEGE%20DIE%201.WAV SIEGE%20DIE%202.WAV SIEGE%20DIE%203.WAV SIEGE%20DIE%204.WAV SKELETON%20DIE%201.WAV SKELETON%20DIE%202.WAV SKELETON%20DIE%203.WAV SKELETON%20DIE%204.WAV MESSIAH_ATTACK.WAV C%20DIE%201.WAV C%20DIE%202.WAV C%20DIE%203.WAV C%20DIE%204.WAV C%20DIE%205.WAV CAMELDIE1.WAV CAMELDIE2.WAV CAMELDIE3.WAV BAT%20ATTACK.WAV BAT%20CMD.WAV BAT%20DIE.WAV".split(" "),
Vg=function(){if(!sc){var c=function(b,c,e){c=c.split(".")[0].toLowerCase();xf[c]=b;!e||e.music&&e.mid!=sa.id||(va(c,e.x,e.y,e.k,e.music,e.date),e.date=0)},b=function(b,c,e){this.context=b;this.urlList=c;this.onload=e;this.loadCount=0};b.prototype.loadBuffer=function(b,e){var f=new XMLHttpRequest;f.open("GET",h+b,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");var d=this;f.onreadystatechange=function(){4===f.readyState&&200===f.status&&
d.context.decodeAudioData(f.response).then(function(f){f&&c(f,b,e)})};f.send()};for(var e=0,f=eh.length;e<f;e++){var d=eh[e];xf[d.split(".")[0].toLowerCase()]=d}yd="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206 arrow%20v1 arrow%20v2 arrow%20v3 arrow%20v4".split(" ");uf="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206".split(" ");Jc="sword%201 sword%202 sword%203 sword%204 sword%205 sword%206 sword%207 sword%208 sword%209 sword%2010 sword%2011 sword%2012 sword%2013 sword%2014 sword%2015 sword%2016 v%20sword%201 v%20sword%202 v%20sword%203 v%20sword%204 v%20sword%205 v%20sword%206 v%20sword%207".split(" ");
vf=["siege"];fh=["hand1","hand2","hand3","hand4"];be="h%20sword%201 h%20sword%202 h%20sword%203 h%20sword%204 h%20sword%205 h%20sword%206 h%20sword%207 h%20sword%208 h%20sword%209 h%20sword%2010 h%20sword%2011 h%20sword%2012".split(" ");ej=["ork%20sword%20v1","ork%20sword%20v2","ork%20sword%20v3"];ce="ship%20cannon%201 ship%20cannon%202 ship%20cannon%203 ship%20cannon%204 ship%20cannon%205 ship%20cannon%206 ship%20cannon%207".split(" ");fj=["ghost%201","ghost%202"];gj=["mage%20attack"];O=["destroy%20building"];
wf=["siege%20die%201","siege%20die%202","siege%20die%203","siege%20die%204"];de="h%20die%201 h%20die%202 h%20die%203 h%20die%204 h%20die%205 h%20die%206 h%20die%207 h%20die%208 h%20die%209 h%20die%2010".split(" ");vb="die%201 die%202 die%203 die%204 die%205 die%206 die%207 die%208 die%209 die%2010".split(" ");gh=["e_barrack1"];var h=v.cdn;if("undefined"!==typeof AudioContext){window.AudioContext=window.AudioContext||window.webkitAudioContext;sc=new AudioContext;var l=sc.createGain();var q=sc.createGain();
var t=new b(sc,void 0,c);J("Sound: OK");l.gain.value=parseInt(document.getElementById("musicRange").value)/100;q.gain.value=parseInt(document.getElementById("soundRange").value)/100}sa=function(){if(!p.editor){sa.id++;localStorage.setItem("favMusic",musicSelect.mversion.value);var b=sa.list[musicSelect.mversion.value];b&&va(b[~~(b.length*Math.random())],0,0,void 0,1,0,sa.id)}};document.getElementById("musicRange").oninput=function(){l.gain.value=parseInt(document.getElementById("musicRange").value)/
100;localStorage.musicRange=document.getElementById("musicRange").value};document.getElementById("soundRange").oninput=function(){q.gain.value=parseInt(document.getElementById("soundRange").value)/100;localStorage.soundRange=document.getElementById("soundRange").value};sa.reset=function(){sa.stop();sa()};sa.stop=function(){sa.active&&(sa.active.stop(),clearTimeout(sa.intv))};sa.id=0;sa.list={originalMusic1:[1,2,3,4,5,6,7,8,9,10,"outro"],originalMusic:"ts1 ts2 ts3 ts4 ts5 ts6 ts7 ts8 ts9 ts10".split(" "),
sharpRain:"sr1 sr2 sr3 sr4 sr5 sr6 sr7 sr8 sr9 sr10".split(" ")};va=function(b,c,e,f,d,g,h){var n=b;if((b=xf[b])&&"loading"!==b&&!p.canceled){var k=-ub+(window.innerWidth-v.mx)/2,m=-Ta+window.innerHeight/2;if(b.duration){if(p.started)if(64<p.now()-b.lastPlayed||!b.lastPlayed)b.lastPlayed=p.now();else return;if(!(!d&&"attack"!=n&&g&&600<Date.now()-g)){if(c){c=-k+32*c;e=-m+32*e;m=da;if(c*c+e*e>Math.pow(2E3,2))return!1;c/=80;e/=80;m/=8}else m=e=c=0;void 0!==f&&f!==v.kingdom||p.mute||(f=sc.createBufferSource(),
f.buffer=b,d?(f.connect(l),l.connect(sc.destination),sa.active=f,sa.intv=setTimeout(sa,~~(1E3*b.duration)+1E3)):(b=sc.createPanner(),b.panningModel="HRTF",b.setPosition(c,e,m),f.connect(b),b.connect(q),q.connect(sc.destination)),f.start(0))}}else xf[n]="loading",d={x:c,y:e,k:f,music:d,date:Date.now(),mid:h},t.loadBuffer(b,d)}};b=document.getElementById("musicSelect").getElementsByTagName("input");e=0;for(f=b.length;e<f;e++)b[e].onchange=sa.reset}},ee=function(c,b,e,f){c.img===f.url&&(va(b+~~(Math.random()*
e+1),c.x32,c.y32),setTimeout(ee,eb(f),c,b,e,f))};"use strict";var Fl=function(c){for(var b=[],e=0,f=[c.icons],d=0,h=f.length;d<h;d++)for(var l=f[d],q=0,t=l.length;q<t;q++)if(l[q]){var n=l[q];n.doneBy||(n.doneBy=[]);n.doneBy.put(c);b[e++]=n;n.xtra&&(f.put(n.xtra),h++)}c.habilities=b},Gl=function(c,b){return b.balanceTotal-c.balanceTotal},hh=function(c,b){return b.priority-c.priority},yf=function(c,b){if(!c.url.attack||c.attackOnly&&!c.attackOnly[b.type])return 0;var e=25*~~(eb(c.url.attack)/25);c=
c.attack*((zd[c.type][b.type]||0)+1);c-=b.defence;1>c&&(c=1);return~~(b.health/c)*e},Bb=function(c){this.kingdom=c.k;this.aggressive=this.perfection=1;this.cantBuild={};this.houseLoading=0;this.mineGroup={};c.IAD=Bb.arr.length;Bb.arr.put(this)};Bb.prototype.valorateLost=function(c){this.script&&this.script.put({order:c.nu,obj:c,priority:1})};var ih=function(c,b,e,f,d){var g=e.obj.cost;f[0]+=g[0];f[1]+=g[1];f[2]+=g[2];f[3]+=g[3];c[c.length]={order:e,priority:b.priority,name:e.obj.name,obj:e.obj,pTime:b.obj.time,
required:1,doner:d};c.changed=!0},jh=function(c,b,e,f){var d=[c],h=[],l={},q=f.target;h.put(c);for(var t=0;t<d.length;t++){var n=d[t];n.availables&&(n.availables=void 0);if((c=n.order)&&!l[n.order.id]){l[n.order.id]=1;var k=c.requireObj;if(k)for(var m=0,w=k.length;m<w;m++)if(c=k[m],c.tech)b[c.nu.id]||ih(d,n,c.nu,q);else{var p=e[c.type];p.length||ih(d,n,c.nu,q)}if(k=c.doneBy)for(m=0,w=k.length;m<w;m++)c=k[m],p=e[c.type],p.length||c.race!=f.racestr||ih(d,n,c.nu,q,1);t&&!n.doner&&h.put(n)}}return h},
kh={food:2,wood:1,gold:0,stone:3},tc=function(c,b){c=c.order;var e=c.obj,f=tc.tech;e.build?f=tc.build:e.tech||(f=tc.unit);return f(c,b)};tc.unit=function(c,b){c=c.doneBy;if(b.pop<b.popMax)for(var e=0,f=c.length;e<f;e++)for(var d=b[c[e].type],h=0,l=d.length;h<l;h++){var q=d[h];if(q.free)return[q]}return!1};tc.tech=function(c,b){c=c.doneBy;for(var e=0,f=c.length;e<f;e++)for(var d=b[c[e].type],h=0,l=d.length;h<l;h++){var q=d[h];if(q.free)return[q]}return!1};tc.build=function(c,b,e){c=c.doneBy;e=0;for(var f=
c.length;e<f;e++)for(var d=b[c[e].type],h=0,l=d.length;h<l;h++){var q=d[h];if(q.free)return[q]}return!1};tc.sPeasant=function(c){for(var b=[10,79,64],e=[],f=0,d=0,h=b.length;d<h;d++)for(var l=c[b[d]],q=0,t=l.length;q<t;q++)l[q].free&&(e[f++]=l[q]);return e};var Kc=function(c,b,e){if(c){c=c.order;var f=c.obj,d=Kc.unit;f.tech?d=Kc.tech:f.build&&(d=Kc.build);return d(c,b,e)}};Kc.build=function(c,b,e){var f=Bb.arr[b.IAD];if(4<=f.cantBuild[c.obj.type]&&b.stats.buildsLosed==f.buildsLosed)return!1;for(var d=
[],h=c.doneBy,l=Ja[b.k],q=0,t=h.length;q<t;q++)for(var n=l[h[q].type],k=0,m=n.length;k<m;k++){var w=z[n[k]];if(!w.func&&!w.in||e){d.put(w.id);break}}if(!d.length)return!1;w=c.obj;c=b.origin[0];e=b.origin[1];c=lh(c,e,80,e-1,c-1,b,w,900);if(0>c)return f.cantBuild[w.type]||(f.cantBuild[w.type]=0),f.cantBuild[w.type]++,f.buildsLosed=b.stats.buildsLosed,!1;f.cantBuild[w.type]&&(f.cantBuild[w.type]=0);I(uc,[c,w.type],d);return!0};var lh=function(c,b,e,f,d,h,l,q){var g=G,n=l.space;l=l.validator.check;if(!l)return-1;
for(var k=-1,m=e/2*(e/2),w=1,p=c,r=b;0>k&&c-p<e/2;){--p;--r;for(var u=2*w+1,z=2*w+1,x=0,v=u*z;x<v;x++){var y=x%u,C=~~(x/u);if(!y||!C||y==u-1||C==z-1){y+=p;C+=r;var E=(y-c)*(y-c)+(C-b)*(C-b);if(E<m&&l(y,C,n,f,d,E<q,h.k)){k=y+C*g;break}}}w++}return k};Kc.tech=function(c,b,e){e=c.doneBy;b=Ja[b.k];for(var f=[],d=0,h=e.length;d<h;d++)for(var l=b[e[d].type],q=0,t=l.length;q<t;q++){var n=z[l[q]];n.working||n.techStart||!n.built||f.put(n.id)}if(!f.length)return!1;I(zf,[c.obj.id,c.id],f[0]);return!0};Kc.unit=
function(c,b,e){e=c.doneBy;b=Ja[b.k];for(var f=[],d=0,h=e.length;d<h;d++)for(var l=b[e[d].type],q=0,t=l.length;q<t;q++){var n=z[l[q]];n.working||n.techStart||!1===n.built||f.put(n.id)}if(!f.length)return!1;I(Af,[c.obj.type,1,0],f[0]);return!0};Bb.prototype.leaveMeAloneIKnowWhatToDo=function(){performance.now();var c=C[this.kingdom],b=c.resources,e=Ja[this.kingdom],f=G;if(c.origin){for(var d=c.origin[0],h=c.origin[1],l=h-1,q=d-1,t=d-40,n=h-40,k=0,m=6400,w=0;w<m;w++){var r=w%80+t,u=~~(w/80)+n;1600>
(d-r)*(d-r)+(h-u)*(h-u)&&(!(r>=q&&r<=q+2)||u>=l&&u<=l+2)&&0===N[r+u*f]&&ha(r,u)&&k++}var y=[];performance.now();for(var v=0,A=0,ka=x.length;A<ka;A++){var H=x[A];if(!H.build&&!H.item&&!H.boat&&H.url.attack&&H.race==c.racestr&&8!=H.type&&void 0==H.res){y.put(H);H.balanceSum=0;H.bestBalance=-1;H.balanceDefence={};for(var D=Infinity,K=H.attDist,L=0;L<ka;L++){var I=x[L];if(!I.build&&!I.item&&!I.boat&&I.race==c.racestr&&I.url.attack&&8!=I.type&&void 0==H.res&&(v=yf(I,H))){var O=yf(H,I);O&&(v-=O,v+=2E3*
K,v<D&&(D=v,H.bestBalance=I),H.balanceSum+=v)}}H.balanceTotal=H.balanceSum}}y.sort(Gl);H=y[0];for(var P=1E3,R={},bc=[],M=0,W=P;!R[H.type];)R[H.type]=1,bc[M++]=H,bc[M++]=P,I=H.bestBalance,P=~~(P*yf(I,H)/yf(H,I)+.5),W+=P,H=I;bc.nu=W-P;J(bc);for(var V=c.target,U=E,S=U.length,T=[],X=0;X<S;X++){var Q=U[X],da;if(!(da=!Q.type||Q.upgrade||Q.type==Z||void 0!==kh[Q.value]&&c.resources[Q.value]>=V[Q.value])){a:{for(var ba=Q.nu.doneBy,ca=0,ja=ba.length;ca<ja;ca++)if(ba[ca].race==c.racestr){var la=!0;break a}la=
!1}da=!la}da||T.put({order:Q.nu,obj:Q,original:1,priority:1E-10})}var aa=[];w=0;m=bc.length;for(var pa=bc.nu;w<m;w+=2){var oa=~~(.5+bc[w+1]/pa*250)-e[bc[w].type].length,Y=bc[w];Y=Y.nu;for(var ea=0;ea<oa;ea++)T.put({order:Y,priority:1-ea/oa,obj:Y.obj,original:1})}var na=0,ya=0,ma=c.target,fa={};ya++;ma[0]=0;ma[1]=0;ma[2]=0;ma[3]=0;w=na=aa.length=0;for(m=T.length;w<m;w++){var ua=T[w].priority,Ba=jh(T[w],c.technology.investigated,e,c);ea=0;for(var za=Ba.length;ea<za;ea++){Y=Ba[ea];Y.original||(Y.priority=
ua);var Ca=1;void 0!==Y.priority&&(Ca=Y.priority);var Da=Y.obj;Da.increase&&void 0!==kh[Da.value]&&(Ca=Da.increase*Ca/b[kh[Da.value]]);Ca/=Da.time;Y.priority=Ca;if(!(0>=Y.priority)){var va=Y.order.id;!fa[va]||Y.original?(fa[va]=na,aa[na++]=Y):aa[fa[va]].priority+=Y.priority}}}var ra=!1;aa.sort(hh);var Aa={},Sa={},xa={},qa=[],hb=x.length;for(w=0;w<hb;xa[w++]=0);for(w=0;w<aa.length;w++){var Ya=aa[w];Y=Ya.order;var Na=Ya.obj;if(Ya.original||Ya.required)Ya.obj.tech||xa[Ya.obj.type]++,qa.put(Ya);var Xa=
Y.doneBy,Ea=Na.time;ea=0;for(m=Xa.length;ea<m;ea++){var nb=Xa[ea],sa=nb.time;if(nb.race===c.racestr){if(Na){for(var jb=nb,rb=e[nb.type],Wa=Bb.process,Ha=Ea,ob=rb.length,Ma=!1,Fa=Infinity,Va=0;Va<ob;Va++){var Ra=z[rb[Va]],rc=0;Ra.build&&(Ra.working||Ra.techStart||!Ra.built)&&(Ra.built?(rc=(Ra.c-p.cycle)*Lc.speed,rc/=1E3):(rc=Ra.time*(Ra.maxHealth-Ra.health)/Ra.maxHealth,Ra.workers&&Ra.workers.length&&(rc/=Ra.workers.length)));Ra.build||!Ra.func&&!Ra.in||(rc=Infinity);Ra.nato!=Wa?(Ra.nato=Wa,Ra.natoTime=
0):rc+=Ra.natoTime;rc<Fa&&(Fa=rc,Ma=Ra)}Ma&&Fa<=jb.time?(Ma.natoTime+=Ha,ra=Ma):ra=!1}if(!ra){Aa[nb.type]||(Aa[nb.type]=[],Sa[nb.type]=[]);var La=Aa[nb.type],kb=Sa[nb.type];xa[nb.type]||(xa[nb.type]=0);var xb=!1,ia=0;for(za=La.length+1;ia<za;ia++){if(void 0==La[ia]){var Pa={order:nb.nu,priority:0,obj:nb};aa.put(Pa);qa.put(Pa);La[ia]=0;kb[ia]=Pa;xa[nb.type]++;xb=!0}if(La[ia]+Ea<=sa||xb){La[ia]+=Ea;kb[ia].priority+=Ya.priority;break}}}}}}qa.sort(hh);var qb=0;w=0;for(m=qa.length;w<m;w++)if(Ya=qa[w].obj,
Ya.build){var tb=Ya.space[Ya.space.length-1]+2;qb+=tb*((Ya.space.length-1)/tb+2)}J(qb,k);if(qb>k){var wb=k/qb*.7;w=0;for(m=x.length;w<m;w++)x[w].build&&(Ya=xa[w])&&((Ya=~~(Ya*wb))||(Ya=1),xa[w]=Ya)}w=0;for(m=qa.length;w<m;w++)Ya=qa[w].obj,Ya.build&&(xa[Ya.type]?xa[Ya.type]--:qa[w]=0);J(qa);hj(qa);for(var wa=qa,ab=new Uint32Array(14),mb=new Uint32Array(7),eb=new Uint32Array(7),gb=new Uint32Array(7),zb=6.25,sb=c.resources,Ib=[mb,gb,ab,eb],ta=0,Ua=0,vb=0;3>vb;vb++){var ub=sb[0],Ka=sb[1],Ta=sb[2],pb=
sb[3];Infinity==ub&&Infinity==Ka&&Infinity==Ta&&Infinity==pb&&(zb=-1);var Pb=0,Cb=0,bb=0,Eb=0;ta=0;for(Ua=wa.length;ta<Ua;ta++)if(wa[ta]){var cb=wa[ta].obj.cost;Pb+=cb[0];Cb+=cb[1];bb+=cb[2];Eb+=cb[3]}if(vb){for(ta=0;ta<ab.length;ab[ta++]=0);for(ta=0;ta<mb.length;mb[ta++]=0);for(ta=0;ta<eb.length;eb[ta++]=0);for(ta=0;ta<gb.length;gb[ta++]=0);}var yb=[],Gb={},Hb={},Ga={pop:0,popMax:2E3},Ab=[[]];ta=0;for(Ua=e.length;ta<Ua;ta++){lb=e[ta];var Lb=[];Ga[ta]=Lb;for(var $a=0,Jb=lb.length;$a<Jb;$a++)Lb[$a]=
{free:1,type:ta}}for(var ib=0;9E3>ib;){var Qb=10*Bf(mb)/7,Rb=10*Bf(gb)/7,Sb=10*Bf(ab)/14,Tb=10*Bf(eb)/7;ub+=10*mb[ib%mb.length];Ka+=10*gb[ib%gb.length];Ta+=10*ab[ib%ab.length];pb+=10*eb[ib%eb.length];var Fb=Ab[ib];if(Fb)for(ta=0,Ua=Fb.length;ta<Ua;ta++){var Za=Fb[ta],db=Za.list;$a=0;for(Jb=db.length;$a<Jb;$a++){var lb=db[$a];lb.used||(lb.used=!0,yb.put(lb.action));lb.free=1}var Mb=Za.action&&(Za.action.original||Za.action.required)?!0:!1;if(Za.obj.tech){Gb[Za.obj.nu.id]=1;var Nb=Za.obj;"popLimit"==
Nb.value&&(Ga.popMax+=Nb.increase)}else Za.obj.build||Ga.pop++,Ga[Za.obj.type].put({free:1,type:Za.obj.type,action:Za.action,used:Mb})}ta=0;for(Ua=wa.length;ta<Ua;ta++)if(lb=wa[ta]){var $b=lb.obj;if($b.peon||!(Sb<zb)){var Oa=$b.cost;if(!(Oa[0]>ub||Oa[1]>Ka||Oa[2]>Ta||Oa[3]>pb)&&1===jh(lb,Gb,Ga,c).length&&(db=tc(lb,Ga))){var Ob=lb.obj.time+ib;Ab[Ob]||(Ab[Ob]=[]);if(lb.obj.tech){if(Hb[lb.order.id])continue;Hb[lb.order.id]=1}wa[ta]=void 0;(lb.original||lb.required)&&yb.put(lb);for(var ac=0;ac<db.length;db[ac++].free=
0);Ab[Ob].put({list:db,obj:lb.obj,action:lb});ub-=Oa[0];Ka-=Oa[1];Ta-=Oa[2];pb-=Oa[3]}}}db=tc.sPeasant(Ga);ta=0;for(Ua=db.length;ta<Ua;ta++){var Db=ij(Qb,Rb,Sb,Tb,ub,Ka,Ta,pb,Pb,Cb,bb,Eb);if(0>Db)break;2===Db&&(Ka-=200);Ib[Db][ib%Ib[Db].length]++;lb=db[ta];lb.free=0;lb.used||(lb.used=!0,yb.put(lb.action))}ib++}wa=yb;wa.sort(hh);hj(wa)}this.script=qa=wa}};var Bf=function(c){for(var b=0,e=c.length,f=0;f<e;b+=c[f++]);return b},ij=function(c,b,e,f,d,h,l,q,t,n,k,m){if(Infinity==d&&Infinity==h&&Infinity==
l&&Infinity==q)return-1;if(6.25>e)return 200>h?1:2;d=t+m+k+n;h=c+b+e+f;c/=t/d*h;b/=n/d*h;e/=k/d*h;f/=m/d*h;return c<b&&c<e&&c<f?0:b<e&&b<f?1:e<f?2:3},mh=function(){for(var c=0,b=Bb.arr,e=b.length;c<e;b[c++].maintenance());ob({func:mh},Bb.time,1);Bb.process++},jj=function(c,b,e){for(var f=c.length,d=Infinity,h=0,l=0;l<f;l++){var q=z[c[l]],t=Math.pow(b-q.x32,2)+Math.pow(e-q.y32,2);t<d&&(d=t,h=q.id)}return h};Bb.prototype.maintenance=function(){var c=this.script;if(c){var b=C[this.kingdom];if(b.origin){p.blocked=
!0;var e=b.technology.investigated,f=Ja[b.k],g=G,h={};if(b.values.pop+b.unitLoading+5>b.values.popMax&&b.values.popMax<=b.values.popLimit){for(var l=gb[b.race].house.nu,q=0,t=0,n=b.building,k=n.length;t<k;t++){var m=z[n[t]];m.population&&(q+=m.population)}b.values.pop+b.unitLoading+5>b.values.popMax+q&&Kc({order:l,priority:1,obj:l.obj},b,!0)}n=b.resources;l=n[0];q=n[1];var w=n[2],r=n[3],u=[];if(Infinity!=l||Infinity!=q||Infinity!=w||Infinity!=r){m=0==b.race?d.createPeon.obj:1==b.race?d.createPeon2.obj:
d.createPeon1.obj;var v=0,y=0,E=0,ka=0;t=0;for(k=c.length;t<k;t++)if(c[t]){var H=c[t].obj.cost;v+=H[0];y+=H[1];E+=H[2];ka+=H[3]}var A=H=0,D=0,K=0,L=f[m.type];t=0;for(k=L.length;t<k;t++)if(m=z[L[t]],40==m.func)21==z[m.funcObj.u].type?H+=10/7:K+=10/7;else if(43==m.func)D+=10/14;else if(42==m.func)A+=10/7;else{if(19==m.func&&m.stock){var J=m.stock[1];0==J?H+=10/7:1==J?A+=10/7:2==J?D+=10/14:K+=10/7}(19!=m.func||m.action)&&m.func||u.put(m)}}t=0;for(k=c.length;t<k;t++)!(m=c[t])||!m.order||h[m.order.id]||
6.25>D&&!m.obj.peon||(L=jh(m,e,f,b).length,J=m.obj.cost,J[0]>n[0]||J[1]>n[1]||J[2]>n[2]||J[3]>n[3]||1===L&&(Kc(m,b)?c[t]=0:h[m.order.id]=1));if(u.length)for(c=-Infinity,t=0,n=b.building,k=n.length;t<k;t++){m=z[n[t]];if(m.population)break;m=m.time*(1-m.health/m.maxHealth);m>c&&(c=m)}t=0;for(k=u.length;t<k;t++)if(m=u[t],n=ij(H,A,D,K,l,q,w,r,v,y,E,ka),0==n)(n=jj(Ja[0][21],m.x32,m.y32))&&kj(n,m,this,b);else if(1==n)lj(m);else if(2==n){a:{n=f[20];c=n.length;for(e=0;e<c;e++)if(h=z[n[e]],!h.workers.length&&
14E3<25*(p.cycle-h.lastUse)){h.lastUse=p.cycle+100;n=h;break a}n=void 0}if(n)I(vc,n.id,[m.id]);else{L=Ja[b.k];n=G;J=Mb[2];c=[];c.length=J.length;e=0;for(h=J.length;e<h;c[e]=L[J[e++]]);L=Infinity;J=x[20].space;var O=-1;e=0;for(h=c.length;e<h;e++)for(var P=c[e],bc=0,R=P.length;bc<R;bc++){var M=z[P[bc]],W=M.x32-10,U=M.y32-10,Q=M.space[M.space.length-1],T=M.x32+.5*Q;M=M.y32+.5*(M.space.length-1)/Q;for(Q=0;400>Q;Q++){var N=Q%20,S=~~(Q/20);N+=W;S+=U;var X=(N+1-T)*(N+1-T)+(S+1-M)*(S+1-M);X<L&&nh(N,S,J)[1]&&
(O=N+S*n,L=X)}}n=O;-1<n&&(I(uc,[n,20],[m.id]),q-=200)}}else 3==n&&(n=jj(Ja[0][22],m.x32,m.y32))&&kj(n,m,this,b);f=!1;ka=Infinity;D=b.diplomacy;y=b.origin[0];E=b.origin[1];v=Ja[b.k];t=1;for(k=C.length;t<k;t++)D[t]&&!C[t].death&&C[t].origin&&(m=C[t],H=m.origin[0]-y,A=m.origin[1]-E,b=H*H+A*A,b<ka&&(ka=b,f=m));if(f){b=[];t=H=0;for(k=v.length;t<k;t++)for(A=v[t],ka=0,D=A.length;ka<D;ka++)m=z[A[ka]],void 0!=m.func||m.standardFunc!=V||m.death||m.build||(b[H++]=m.id);if(60<b.length){m=f.origin[0];v=f.origin[1];
n=[40,0,-40,0,0,40,0,-40];ka=Infinity;t=0;for(k=n.length;t<k;t+=2)if(H=n[t],A=n[t+1],H+=y+10*Math.sign(H),A+=E+10*Math.sign(A),(H-m)*(H-m)+(v-A)*(v-A)<ka&&ha(H,A)){ka=(H-m)*(H-m)+(v-A)*(v-A);var Y=H+A*g}k=Y%g;y=~~(Y/g);E=-1;H=Infinity;v=Ja[f.k];t=0;for(length=v.length;t<length;t++)for(f=v[t],ka=0,A=f.length;ka<A;ka++)m=z[f[ka]],D=(m.x32-k)*(m.x32-k)+(m.y32-y)*(m.y32-y),D<H&&(H=D,E=m.x32+m.y32*g);-1<E&&I(oh,[Y,E],b)}}p.blocked=!1}}};var kj=function(c,b,e,f){var d=gb[b.race].storage,h=z[c],l=z[e.mineGroup[c]];
!l&&f.paypalTest(d.cost)?(h=lh(h.x32+2,h.y32+2,20,0,0,f,d,0),-1<h&&I(uc,[h,d.type],[b.id]),e.mineGroup[c]=f.building[f.building.length-1]):l&&!1===l.built?I(wc,l.id,[b.id]):I(vc,c,[b.id])},lj=function(c){for(var b=C[c.kingdom],e=Ja[b.k],f=Mb[1],d=0,h=f.length;d<h;d++)for(var l=e[f[d]],q=0,t=l.length;q<t;q++){var n=z[l[q]];if(!n.castle){if(!1===n.built)return I(wc,n.id,[c.id]);if(n=mj(n.x32,n.y32,.075))return I(vc,n,[c.id])}}l=b.building;d=0;for(h=l.length;d<h;d++)if(n=z[l[d]],1===n.storage)return I(wc,
n.id,[c.id]);e=gb[c.race].lumbermill;f=b.origin[0];l=b.origin[1];d=1;h=b.resources;q=e.cost;if(q[0]<h[0]&&q[1]<h[1]&&q[2]<h[2]&&q[3]<h[3])for(;80>d;){--f;--l;t=2*d+1;n=2*d+1;q=0;for(h=t*n;q<h;q++){var k=q%t,m=~~(q/t);if(!k||!m||k==t-1||m==n-1)if(k+=f,m+=l,-1<mj(k,m,.15,!0)&&(k=lh(k,m,8,0,0,b,e,0),-1<k))return I(uc,[k,e.type],[c.id])}d++}b=Ja[0][7];d=b.length;h=Infinity;for(e=q=0;e<d;e++)f=z[b[e]],l=Math.pow(c.x32-f.x32,2)+Math.pow(c.y32-f.y32,2),l<h&&(h=l,q=f.id);(b=q)&&I(vc,b,[c.id])},mj=function(c,
b,e,f){var d=G,h=c,l=b;c-=5;b-=5;for(var q=0,t=-1,n=Infinity,k=0;100>k;k++){var m=k%10,w=~~(k/10);m+=c;w+=b;if(ha(m,w)){var p=z[N[m+w*d]];if(f&&1==p.storage)return-1;7===p.type&&(q++,m=Math.pow(m-h,2)+Math.pow(w-l,2),m<n&&(n=m,t=p.id))}}if(q/100>=e)return t},oh=function(c,b){var e=G,f=c[0];c=c[1];var d=c%e;e=~~(c/e);for(var h=0,l=b.length;h<l;h++){var q=z[b[h]];6400<(q.x32-d)*(q.x32-d)+(q.y32-e)*(q.y32-e)?oa(-f,q,fe,q.url.move):oa(-c,q,fe,q.url.move)}Cf(!1,b);ob({func:nj,data:{list:b,xy:-c}},3E4,
1)},nj=function(c){var b=c.list;c=c.xy;for(var e=0,f=b.length;e<f;e++){var d=z[b[e]];d.death||oa(c,d,fe,d.url.move)}},hj=function(c){for(var b={},e=0;e<c.length;e++)c[e]&&!c[e].obj.tech&&(b[c[e].obj.name]||(b[c[e].obj.name]=0),b[c[e].obj.name]++,"Blacksmith"==c[e].obj.name&&J(c[e]));J(b)},ph=function(c){var b=c.x32+c.y32*G,e=C[c.kingdom].diplomacy;!c.invisible&&oc[b]&&(b=z[oc[b]],!b.freezed&&e[b.kingdom]&&xc(c.id,[b.id],0,Ad))},qd=function(c){var b=qh(c.id);return b?(xc(b,[c.id],0,Ad),!0):!1},qh=
function(c,b){c=z[c];if(!c.freezed&&!c.invisible&&!1!==c.built){var e=c.x32,f=c.y32,d=C[c.kingdom].diplomacy,h=c.sight;c.build&&(h=c.attDist);var l=G,q=2*h+1,t=!!c.confused,n=0;b&&(n=h-b);for(var k=Infinity,m=!1,w=0,p=q*q;w<p;w++){var r=w%q-h,u=~~(w/q)-h,v=Math.sqrt(r*r+u*u);if(v<=h&&v>=n&&(r+=e,u+=f,ha(r,u)))for(var y=0;3>y;y++){b=xb[y][r+l*u];var x=z[b];if((x&&x.kingdom&&(d[x.kingdom]||x.confused)||t)&&!(x.death||x.invisible||c.attackOnly&&!c.attackOnly[x.type]||b==c.id||x.item||x.field)){var H=
zd[c.type][x.type];H||(H=0);x=v*v+.05*x.health-(H+1)*c.attack;x<k&&(m=b,k=x)}}}return m}},Hl=function(c){c.setupINTV(oj,c.id,1E3)},oj=function(c){c=z[c];var b=c.free;b||(b=pj);var e=G,f=c.x32,d=c.y32,h=[];h.length=C.length;for(var l=h.length,q=0;q<l;h[q++]=0);q=0;for(var t=b.length;q<t;q+=2){var n=b[q]+f,k=b[q+1]+d;ha(n,k)&&(n=z[N[n+k*e]],n.nocapture||n.build||h[n.kingdom]++)}e=b=0;for(q=1;q<l;q++)h[q]>b&&(e=q,b=h[q]);b&&c.kingdom!=e&&c.changeKingdom(e);Nb(c,1E3)},Df,Il=[1,1],qj=function(){return 25*
(Date.now()-p.loadDate+p.pausedTime+p.deltaTime)/Lc.speed},$b=function(c){if(!(c&&p.online||$b.bySystem&&c))if(0===p.paused){p.paused=1;void 0!=Df&&clearInterval(Df);var b=p.now();p.pausedTime+=Date.now();c||($b.bySystem=1);p.now=function(){return b}}else p.pausedTime-=Date.now(),p.paused=0,$b.bySystem=0,c&&(document.getElementById("alert").style.display="none"),Df=setInterval(Lc,Lc.speed),p.now=qj};$b.bySystem=0;var Oa=function(c,b){var e=!1;if(1>c){c*=-1;var f=~~(c/Da),d=c%Da}else e=c;c=0;for(var h=
b.length;c<h;c++){var l=z[b[c]];l.build||l.cow&&l.workers.length||e==l.id||l.freezed||l.in||l.stoned||(l.action=null,l.distance=0,l.mv&&null!=l.xf?(e?(l.xf=e,l.yf=!0):(l.xf=d,l.yf=f),l.nodes=void 0):l.x32==d&&l.y32==f?l.stay():(l.dix=(d-l.x32)/Math.abs(d-l.x32),l.diy=(f-l.y32)/Math.abs(f-l.y32),e?(l.xf=e,l.yf=!0):(l.xf=d,l.yf=f),l.mv=!0,l.setupINTV(ge,l.id,0),rh(l),l.action=null))}},rh=function(c){c.stock&&0!==c.stock[0]?(c.mimg=c.url[c.stock[4].url],c.stock[3]===Mc&&(c.mimg=c.url.milk)):c.mimg=c.url.move};
Oa.cursor=7;Oa.allowPos=1;var Nb=function(c,b,e){b=~~(b/25)+p.cycle;e=bd[b];e||(e=[],bd[b]=e);var f=e.length;c.c=b;e[f]=c.id;c.timestamp=p.now()},bd={},Ef=function(c){var b=z[c[0]];if(!b.death){var e=c[1],f=c[2],d=c[3];b.cow&&"milk"==e&&b.workers&&b.workers.length||(b[e]+=C[b.kingdom].values[f],f=b[e+"Max"],b[e]>f&&2!==b.blocked&&(b[e]=f));"mana"==e&&(f=b.manaTask)&&f[2]<=b[e]&&(J(f),oa(f[1],b,Ob[f[0]],b.url.move),b.manaTask=void 0,b.blockedAction(1));ba(b.id,1);ob({func:Ef,data:c},d,1)}},ob=function(c,
b,e){c.func.url||J(c.func);c.func=c.func.url;e&&(b=~~(b/25)+p.cycle);e=cd[b];e||(e=[],cd[b]=e);e.put(c)},cd={},ge=function(c){c=z[c];var b=G,e=!1;c.waiting&&rh(c);var f=c.y32,d=c.x32;sh(1,c,"zone");var h=Ob[c.action];pb(c,32*f);var l=xb[c.zLevel],q=d+f*b;ph(c);if(c.id===l[q]){var t=c.size;if(2>t)l[q]=c.radix;else for(var n=t*t,k=-b,m=0;m<n;m++){var w=m%t;0===w&&(k+=b);l[q+w+k]=0}}if(c.stop)return l[q]=c.id,c.stay(),c.stop=void 0,0;if(c.kx||c.ky){var p=c.kx||0,r=c.ky||0;n=!1;if(0!==l[p+d+(r+f)*b])return c.aspettare()}else{h&&
h.rev&&(n=h.rev(c))&&(c.action=n[0],h=Ob[c.action],c.xf=n[1],c.yf=!0);if(!0===c.yf){n=c.xf;var u=z[n];if(!u||u.death&&(!h||!h.available))return l[q]=c.id,c.stay();m=!0;k=!1;if(h&&h.available){k=h.available(c,u);if(!1===k)return c.aspettare();if("kill"===k)return l[q]=c.id,c.stay();if(55===k)return l[q]=c.id;m=k[2]}else u.death||(k=Nc(u,c,50,c.radix));c.xf!==n&&(u=z[c.xf]);if(!u||u.death||u.in)return l[q]=c.id,c.stay();if(!m&&(x+v*b===q||h))return c.aspettare();var x=k[0],v=k[1];if(h&&h.distance){var y=
h.distance;y=0>y?c.attDist:C[c.kingdom].values[y];k=th(u,d,f);he(d,f,k%G,~~(k/G),y)&&(e=2)}c==u&&(e=2)}else{x=c.xf;v=c.yf;n=l[x+v*b];if(2<n&&(!h||h&&h.rev)){n=z[n];k=Nc(n,c,50,c.radix);if(!1===k)return l[q]=c.id,c.stay();x=k[0];v=k[1]}h&&h.distance&&(y=h.distance,y=0>y?c.attDist:C[c.kingdom].values[y],he(d,f,x,v,y)&&(e=2))}n=x+v*b;k=x;m=v;if(c.nodes){var H=c.nodes;20<H.length&&(H.length=2);m=H[H.length-2];k=m%b;m=~~(m/b);w=H[H.length-1];if(d+f*b==k+m*b||l[w]==c.radix||l[k+m*b]!==c.radix)H.length-=
2,H.length?(m=H[H.length-2],k=m%b,m=~~(m/b)):(k=x,m=v,c.nodes=void 0)}if(!e){p=k;r=m;w=c.radix;H=G;var A=d+f*H,E=p+r*H,D,L=p-d,J=r-f,K=Math.sqrt(L*L+J*J);for(D=0;16>D;D++){var I=~~(8*uh(A%H-p,~~(A/H)-r)+.5)%8;if(A===E)break;var O=l[A+ac[I]];if(O===w||Ff(O))A+=ac[I];else if(O=l[A+ac[(I+1)%8]],O===w||Ff(O))A+=ac[(I+1)%8];else{var P=I-1;-1===P&&(P=7);O=l[A+ac[P]];if(O===w||Ff(O))A+=ac[P];else{A+=ac[I];break}}if(!D)var M=A;ie&&Bd(A%H,~~(A/H),"stone")}I=0;O=-1;if(l[A]>w){2<l[A]&&(O=A);var Q=[A],R=1,N=
0,W={};W[A]=2;for(var S=Infinity,U=-Infinity,T=0;void 0!==(P=Q[N++]);){ie&&Bd(P%H,~~(P/H),"food");D=P%H;var V=~~(P/H);D=((D-p)*J-(V-r)*L)/K;D<S?(S=D,I=P):D>U&&(U=D,T=P);for(D=0;4>D;D++)if(A=P+rj[D],ha(A%H,~~(A/H))&&!W[A]&&l[A]!==w&&!Ff(l[A]))for(E=0;8>E;E++)if(l[A+ac[E]]===w){Q[R++]=A;W[A]=2;break}}ie&&Bd(I%H,~~(I/H),"gold");ie&&Bd(T%H,~~(T/H),"gold");P=Math.pow(S,2)<=Math.pow(U,2)?I:T;S=-Infinity;for(E=0;8>E;E++){A=P+ac[E];if(D=l[A]===w)D=G,Q=P+ac[E],D=1<Math.abs(P%D-Q%D)||1<Math.abs(~~(P/D)-~~(Q/
D))?!1:!0;D&&(D=A%H,V=~~(A/H),D=((D-p)*J-(V-r)*L)/K,Math.pow(D,2)>S&&(I=A,S=Math.pow(D,2)))}ie&&Bd(I%H,~~(I/H),"wood")}r=[M,I,O];M=r[0];p=r[1];w=r[2];p&&(c.nodes?(c.nodes.put(p),c.nodes.put(w)):c.nodes=[p,w]);void 0!==M?(p=-d+M%b,r=-f+~~(M/b)):r=p=1;if(1<Math.abs(p)||1<Math.abs(r))return c.aspettare();if(l[d+p+(f+r)*b]!==c.radix||!ha(d+p,f+r)){M=[d+1,f,d-1,f,d+1,f+1,d+1,f-1,d,f-1,d-1,f+1,d,f+1,d-1,f-1];p=G;r=Infinity;for(w=0;w<M.length;w+=2)if(0===l[M[w]+M[w+1]*p]&&ha(M[w],M[w+1])&&r>=(M[w]-k)*(M[w]-
k)+(M[w+1]-m)*(M[w+1]-m)){r=(M[w]-k)*(M[w]-k)+(M[w+1]-m)*(M[w+1]-m);var X=w}k=[M[X],M[X+1]];p=k[0]-d;r=k[1]-f;p=0<p?1:0>p?-1:0;r=0<r?1:0>r?-1:0;if(l[d+p+(f+r)*b]!==c.radix||!ha(d+p,f+r))return c.aspettare()}}}if(q==n||e)if(l[d+f*b]=c.id,c.x32=d,c.y32=f,h){if(h.distance&&2!==e)return c.aspettare();c.stay(1);u||(u=x+v*b);c.action=void 0;h(u,c,y)}else c.stay();else{if(0===p&&0===r)return c.aspettare();c.setupDir(p,r);e=c.spd;na(c,c.mimg,-1,c.spd/c.__proto__.spd);c.dix=p*e;c.diy=r*e;f+=r;d+=p;c.x32=d;
c.y32=f;c.distance++;Nb(c,~~(32E3/e));Oc(c,p*e,r*e,0);q=d+f*b;if(2>t)l[q]=c.id;else for(n=t*t,k=-b,m=0;m<n;m++)w=m%t,0===w&&(k+=b),l[q+w+k]=c.id}},Lc=function(){if(!p.editor){var c=p.cycle;p.now();var b=Date.now();if(p.demo){var e=p.record[c];if(e)for(var f=0;f<e.length;f+=3)Gf[e[f]](e[f+1],e[f+2])}if(e=cd[c]){for(f=0;f<e.length;f++){var d=e[f];Ob[d.func](d.data)}delete cd[c]}if(e=bd[c]){for(f=0;f<e.length;f++)d=z[e[f]],d.c===c&&(d.death?J("anti stall:",Ob[d.func].name,d.func,d):(d.c=void 0,Ob[d.func](d.funcObj)));
delete bd[c]}p.cycle++;if(p.online&&0===p.cycle%8)var h=vh();wh+=Date.now()-b;0===p.cycle%40&&(c=p.now()/1E3,b=~~(c/60)%60,e=~~(c/3600),c=~~(c%60),1===(c+"").length&&(c="0"+c),0!=e?(e+=":",10>b&&(b="0"+b)):e="",r("topinfo").innerHTML="<span>CPU:"+(wh/10).toFixed(2)+"%</span> <span>"+~~(xh/yh+.5)+"FPS</span> <span>"+e+b+":"+c+"</span>",xh=yh=wh=0);!h&&!p.automatic&&p.now()-(p.cycle-1)*Lc.speed>=Lc.speed&&Lc()}};Lc.speed=25;var wh=0,yh=0,xh=0,ac,rj,Bd=function(c,b,e){e=Object.assign({},gc[e]);e.x32=
c;e.y32=b;e.z32=2;mb(e);hc.new(e,500)},Ff=function(c){return(c=z[c])&&19===c.func&&!c.waiting?!0:!1},ie,uh=function(c,b){c=.5-Math.atan2(b,c)/(2*Math.PI);1==c&&(c=0);return c},db=function(c,b,e,f){return[c,b,e,f,c,b,e,f,c,b,e,f,c,b,e,f]},Hf=new Float32Array(db(1,0,0,.75)),Jl=new Float32Array(db(1,1,1,.5)),sj=new Float32Array(db(0,1,0,.75)),Kl=new Float32Array(db(0,1,0,.9)),Ll=new Float32Array(db(.3515625,.29296875,.21875,.9)),tj=new Float32Array(db(0,1,1,.9)),zh=new Float32Array(db(1,1,1,.5)),uj=
new Float32Array(db(.3,.3,.3,.9)),vj=new Float32Array(db(.7,.2,.2,.9));tj.noAlpha=1;uj.noAlpha=1;vj.noAlpha=1;var ca=function(c){I(Af,[c,4*$a.shift+1,Jb],K[0])},Af=function(c,b){var e=c[0],f=c[1],d=c[2];c=x[e];b=z[b];var h=b.icons.indexOf(c.nu);if(!(0>h)){performance.now();if(0==d)for(d=0;d<f;d++){var l=C[b.kingdom],q=l.mod[e].cost||c.cost;if(l.paypal(q))break;b.waitlist||(b.waitlist=[]);b.waitlist.push(e,-h-1);b.work||(b.work={});b.work[h]||(b.work[h]=0);b.work[h]++;b.working=1;l.unitLoading++;2==
b.waitlist.length&&(q=1E3*c.time,b.setupINTV(je,b.id,q))}else{if(!b.work||!b.waitlist.length)return;var t=b.waitlist;l=C[b.kingdom];for(d=0;d<f;d++){q=l.mod[e].cost||c.cost;l.setupResources(q,-1);q=t.lastIndexOf(e);if(0>q)break;t.splice(q,2);b.work[h]--;if(0==t.length){b.c=-1;b.working=0;break}l.unitLoading--;0===q&&(q=1E3*x[t[0]].time,b.setupINTV(je,b.id,q))}}ba(b.id)}},wj=0,je=function(c){c=z[c];if(c.death||c.waitlist&&!c.waitlist.length)return!1;var b=c.kingdom;b=C[b];var e=b.values.pop>=b.values.popMax?
u.houseLimit:u.popLimit;if(b.values.pop>=b.values.popMax||b.values.pop>=b.values.popLimit)return document.getElementById("msgs1").getElementsByTagName("li"),3E4<Date.now()-wj&&b.k==v.kingdom&&Pc(e,0,5),wj=Date.now(),b.onFreePop.put(c.id),!0;b.unitLoading--;b=c.waitlist[0];e=x[b];c.work[-c.waitlist[1]-1]--;c.waitlist.splice(0,2);0<c.waitlist.length?c.setupINTV(je,c.id,1E3*e.time):c.working=0;ke(b,c);ba(c.id);return!0},Ma=function(){if(0==Jb){var c=z[K[0]];I(If,[c.mlistID[wa.nu],!0],c.id)}},Fa=function(){if(0==
Jb){var c=z[K[0]];I(If,[c.hlistID[wa.nu],!1],c.id)}},xj=function(c,b,e){var f=1.6,d=0;1===b&&(e=0,f=3.6,d=620);return[d+~~(f*c[0]*b+.5)+120*e,~~(f*c[1]*b+.5),~~(f*c[2]*b+.5),~~(f*c[3]*b+.5)]},If=function(c,b){var e=c[0];c=c[1];b=z[b];var f=C[b.kingdom],d=C[b.kingdom];if(d.values.pop>=d.values.popMax&&b.kingdom==v.kingdom)return Pc(u.popLimit,0,5);if(c)var h=d.values.fameTech;d=4;var l=9*c;l||(l=1);if(c)var q=b.mlist,t=b.mlistID;else q=b.hlist,t=b.hlistID;var n=t.indexOf(e);if(!(0>n)){e=q[n].unit;
var k=xj(x[e].cost,l,h);if(f.paypal(k))return 0;q.splice(n,1);t.splice(n,1);Q.active==q&&pa(q);for(f=0;f<l;f++)t=ke(e,b),h?t.level=d:c||(d=16,t.level=d,q=yj[t.race],t.name=q[t.id%q.length],zj(t))}},ke=function(c,b,e,f){var d=G,h=b.kingdom;b.rnd||Ah(b);var l=-1,q=-1;if(b.point&&!b.disallowPoint){var t=b.point[0],n=b.point[1];l=Aj(b,t,n,x[c].radix,x[c].rbase())[0]}else l=Aj(b,l,q,x[c].radix,x[c].rbase())[1],l=l[Bj(b,l.length)];q=~~(l/d);c=new dd(c,h,l%d,q,0,!1,f);le(h);e||va("unitdone",0,0,c.kingdom);
if(b.point&&(b=Bh(t,n,c,!0),e=b[1],b[0]))b[0](e,[c.id]);return c},Jf=0,Kf=0,Yb,Ua,$d,R=function(c){U=function(){};c=x[c];Yb=!1;var b=L;na(b,c.img);b.active=!0;Ua=c;$d=!1;document.addEventListener("mousemove",bh);document.addEventListener("mousedown",rf)},rf=function(c){var b=Ua.validator,e=Ua.space,f=Ca[Ua.img];if(0==c.button&&151<c.pageX){f=ic(c.pageX-v.mx-.5*f[8]/da,c.pageY-.5*f[9]/da);var d=~~(.03125*f[1]);f=~~(.03125*f[0]);b(f,d,e,v.kingdom)[1]&&(Yb=!0,L.active=!0,L.x=-9999,L.y=-9999,U=151<c.pageX?
0:Pb,document.removeEventListener("mousedown",rf),I(uc,[f+G*d,Ua.type,$d],K),$a.shift&&($d?Xi($d):R(Ua.type)));U=function(){}}else L.active=!0,L.x=-9999,L.y=-9999,Yb=!0,U=Pb,document.removeEventListener("mousedown",rf)},bh=function(c){var b=Ua.validator,e=Ua.space,f=Ca[Ua.img];if(Yb)document.removeEventListener("mousemove",bh);else{var d=c.pageX,h=c.pageY;if(d!=Jf||h!=Kf)L.active=!0,Jf=d,Kf=h,d=ic(c.pageX-v.mx-.5*f[8]/da,c.pageY-.5*f[9]/da),h=~~(.03125*d[1]),d=~~(.03125*d[0]),c=32*d,f=32*h,(b=!b(d,
h,e,yb.k)[1])?b!=Qc&&(Qc=b,k.bindBuffer(k.ARRAY_BUFFER,Ib),k.bufferSubData(k.ARRAY_BUFFER,16*L.bufferID,Hf)):b!=Qc&&(Qc=b,k.bindBuffer(k.ARRAY_BUFFER,Ib),k.bufferSubData(k.ARRAY_BUFFER,16*L.bufferID,sj)),L.x=c,L.y=f}},uc=function(c,b){var e=c[0],f=e%Da,d=~~(e/Da),h=p.editor?v.kingdom:z[b[0]].kingdom;e=c[1];var l=x[e],q=l.cost,t=C[h];if(!l.validator(f,d,l.space,h)[1]||!p.editor&&t.paypal(q))return!1;c=new dd(e,h,f,d,0,!p.editor,c[2]);if(!0===c.invalid||p.editor)return!1;c.waitlist=[];if(20===e)c.built=
1,f=z[b[0]],oa(c.id,f,ed,f.url.move);else for(c.health=1,na(c,c.bimg),c=c.id,e=0,d=b.length;e<d;e++)f=z[b[e]],f.buildList?(f.buildList.put(c),f.func!==Lf.url&&(h=Mf(f.buildList,f.x32,f.y32))&&oa(h,f,fd,f.url.move)):(f.buildList=[c],f.func!==Lf.url&&oa(c,f,fd,f.url.move))},Qc=null,Dh=function(c){U=function(){};c=x[c];Yb=!1;var b=L;Ua=c;na(b,c.img);document.addEventListener("mousemove",Cj);document.addEventListener("mousedown",Ch)},Ch=function(c){var b=G,e=Ca[Ua.img];if(0==c.button&&151<c.pageX){c=
ic(c.pageX-v.mx-.5*e[8]/da,c.pageY-.5*e[9]/da);var d=~~(.03125*c[1]);c=~~(.03125*c[0]);k.bindBuffer(k.ARRAY_BUFFER,Ib);k.bufferSubData(k.ARRAY_BUFFER,0,Ll);var g=X[2];X[2]=32;X[5]=32;X[8]=32;X[11]=32;L.wall=c+d*b;var h=c;document.addEventListener("mouseup",function t(c){Ab.forced=!1;c=Sa[3*v.kingdom];var e=Sa[3*v.kingdom+1],f=Sa[3*v.kingdom+2];y[0]=c;y[1]=e;y[2]=f;y[3]=.5;y[4]=c;y[5]=e;y[6]=f;y[7]=.5;y[8]=c;y[9]=e;y[10]=f;y[11]=.5;y[12]=c;y[13]=e;y[14]=f;y[15]=.5;k.bindBuffer(k.ARRAY_BUFFER,Ib);k.bufferSubData(k.ARRAY_BUFFER,
0,y);X[2]=g;X[5]=g;X[8]=g;X[11]=g;var q=~~(X[9]/32),m=~~(X[10]/32);e=Math.abs(h-q);f=Math.abs(d-m);e&&--e;f&&--f;c=1;q=q<h?q:h;var p=m<d?m:d;m=[q+p*b];for(var r=0;r<e+1;r++)m[c++]=q+r+p*b,f&&(m[c++]=q+r+(p+f)*b);for(r=1;r<f;r++)m[c++]=q+(p+r)*b,e&&(m[c++]=q+(p+r)*b+e);for(r=1;r<c;r++)e=m[r],Yb=!0,U=function(){U=Pb},Rc(2),I(uc,[e,Ua.type],K);L.active=!0;L.x=-9999;L.y=-9999;$a.shift&&Dh(Ua.type);document.removeEventListener("mouseup",t)});document.removeEventListener("mousedown",Ch);Yb=!0}else L.active=
!0,L.x=-9999,L.y=-9999,Yb=!0,U=151<c.pageX?0:Pb,document.removeEventListener("mousedown",Ch)},Cj=function(c){var b=G,e=Ca[Ua.img];if(Yb)document.removeEventListener("mousemove",Cj);else{var d=c.pageX,g=c.pageY;if(d!=Jf||g!=Kf){var h=!0;Jf=d;Kf=g;L.active=!0;c=ic(c.pageX-v.mx-.5*e[8]/da,c.pageY-.5*e[9]/da);e=~~(c[1]/32);c=~~(c[0]/32);d=32*c;g=32*e;0==N[c+e*b]&&(h=!1);h?h!=Qc&&(Qc=h,k.bindBuffer(k.ARRAY_BUFFER,Ib),k.bufferSubData(k.ARRAY_BUFFER,16*L.bufferID,Hf)):h!=Qc&&(Qc=h,k.bindBuffer(k.ARRAY_BUFFER,
Ib),k.bufferSubData(k.ARRAY_BUFFER,16*L.bufferID,sj));L.x=d;L.y=g}}},Eh=function(c,b){c=0;for(var e=b.length;c<e;c++){var d=z[b[c]];d.xf?d.stop=1:d.stay()}},Nf=function(c,b){c=z[b[0]];c.techStart=0;c.c=void 0;b=c.techID;c.techID=void 0;if(b){var e=C[c.kingdom].technology.hidden;-1<b&&(e[b]=0);C[c.kingdom].setupResources(E[c.activeTech].cost,-1)}else if(c.lcost)C[c.kingdom].setupResources(c.lcost,-1);else return;ba(c.id)},D=function(c){I(zf,[c,wa.lastFunc.id],z[K[0]].id)},zf=function(c,b){var e=c[0];
c=c[1];var d=E[e],g=z[b];d.upgrade&&(c=-1);if(C[g.kingdom].paypal(d.cost))return!1;g.activeTech=e;g.techID=c;g.setupINTV(d.type,[e,c,b],1E3*d.time);g.techStart=g.c-p.cycle;e=C[z[b].kingdom].technology.hidden;-1<c&&(e[c]=1);ba(b)},Z=function(c){var b=c[1],e=z[c[2]];c=E[c[0]];yc(e,c,b)},Of=function(c){var b=c[1],e=z[c[2]];c=E[c[0]];var d=x[c.obj],g=C[e.kingdom].mod[d.type];Fh(e);e.img=d.img;e.attack=g.attack||d.attack;e.health=e.health/e.maxHealth*d.health;e.maxHealth=d.health;e.__proto__=d;mb(e);yc(e,
c,b)},Pf=function(c){var b=c[1],e=z[c[2]];c=E[c[0]];if(c.actvintv)for(var d=c.actvintv,g=0,h=d.length;g<h;g++){var l=d[g];C[e.kingdom].technology.disabled[l.id]=0;for(var q=l.builds,t=Ja[e.kingdom],n=0,k=q.length;n<k;n++)for(var m=t[q[n]],p=0,r=m.length;p<r;p++)l(z[m[p]])}yc(e,c,b)},ia=function(c,b){var e=c[1];b=z[c[2]];c=E[c[0]];C[b.kingdom].values[c.value]+=c.increase;"popMax"==c.value&&le(b.kingdom);yc(b,c,e)},Dj=function(c,b){var e=c[1];b=z[c[2]];c=E[c[0]];var d=c.group,g=C[b.kingdom],h=Ja[g.k];
g=g.mod;for(var l=0,q=d.length;l<q;l++)for(var t=g[d[l].type],n=h[d[l].type],k=0,m=c.values,p=m.length;k<p;k+=2){var r=m[k],u=m[k+1];t[r]||(t[r]=d[l][r]||0);for(var x=0,v=n.length;x<v;x++)z[n[x]][r]+=u;t[r]+=u}yc(b,c,e)},Cb=function(c,b){var e=c[1];b=z[c[2]];c=E[c[0]];var d=c.group,g=C[b.kingdom],h=g.mod;g=Ja[g.k];for(var l=0,q=d.length;l<q;l++){var t=h[d[l].type];t[c.value]||(t[c.value]=d[l][c.value]||0);t[c.value]+=c.increase;t=g[d[l].type];for(var n=0,k=t.length;n<k;n++)z[t[n]][c.value]+=c.increase}yc(b,
c,e)},Gh=function(c,b){var e=c[1];b=z[c[2]];c=E[c[0]];for(var d=C[b.kingdom].mod,g=c.mulp,h=0,l=c.group.length;h<l;h++){var q=c.group[h],t=d[q.type].cost||q.cost;d[q.type].cost=g?[~~(t[0]*g),~~(t[1]*g),~~(t[2]*g),~~(t[3]*g)]:[t[0]-c.decrease[0],t[1]-c.decrease[1],t[2]-c.decrease[2],t[3]-c.decrease[3]]}yc(b,c,e)},Hh=function(c,b){var e=c[1];b=z[c[2]];c=E[c[0]];for(var d=C[b.kingdom].mod,g=0,h=c.decrease,l=h.length;g<l;g+=2){var q=h[g],t=h[g+1],n=d[q.type].cost||q.cost;d[q.type].cost=[n[0]-t[0],n[1]-
t[1],n[2]-t[2],n[3]-t[3]]}yc(b,c,e)},yc=function(c,b,e){c.techStart=void 0;c.activeTech=void 0;c.techID=void 0;c.func=void 0;var d=C[c.kingdom].technology,g=d.disabled;d.investigated[e]=1;va("techdone",0,0,c.kingdom);if(b=b.next){e=!1;d=0;for(var h=b.length;d<h;d++){var l=b[d].id;g[l]--;pa.actv[l]&&(e=!0)}e&&pa(Q.active)}c.standardFunc&&c.standardFunc(c);ba(c.id)};"use strict";var Mb,Ml={icon:"food",img:"item_meat",url:"meat"},Nl={icon:"milk",img:"milk",url:"milk"},Ol={icon:"gold",img:"item_gold",
url:"gold"},Pl={icon:"stone",img:"item_stone",url:"stone"},Ej={icon:"wood",img:"item_tree",url:"tree"},Ql={icon:"food",img:"item_food",url:"food"},me=function(c,b,e,d){c=Ja[c];var f=Mb[b];b=[];b.length=f.length;for(var h=0,l=f.length;h<l;b[h]=c[f[h++]]);c=Infinity;f=-1;for(h=0;h<b.length;h++){l=b[h];for(var q=l.length,t=0;t<q;t++){var n=z[l[t]];if(!1!==n.built){var k=n.x32,m=n.y32,p=n.space;n=p[p.length-1];p=(p.length-1)/n;n*=.5;p*=.5;k+=n;m+=p;n=.5*(n+p);k=Math.sqrt((k-e)*(k-e)+(m-d)*(m-d))-n;c>=
k&&(c=k,f=l[t])}}}return f},la,Rl=function(c){if("string"==typeof c){for(var b=1,e=0,d=c.length;e<d;e++)b+=b*(c.charCodeAt(e)/65535)*(e+1);c=b+d}var g=4294967295-c,h=4294967295+c;e=0;la=function(){h+=e;g-=e++;h=36969*(h&65535)+(h>>16)&4294967295;g=18E3*(g&65535)+(g>>16)&4294967295;return((h<<16)+g&4294967295)/4294967295+.5}},Bj=function(c,b){c=c.rnd;var e=c[0],d=c[1],g=c[2];e+=g;d-=g;e=36969*(e&65535)+(e>>16)&4294967295;d=18E3*(d&65535)+(d>>16)&4294967295;c[0]=e;c[1]=d;c[2]++;return~~((((e<<16)+d&
4294967295)/4294967295+.5)*b)},Rc=function(c){c!=Sl&&(document.body.className="ncursor"+c)},Sl=-1,Cd=function(c,b){for(var e=0,d=b.length;e<d;e++){var g=z[b[e]];oa(c,g,ne,g.url.move)}};Cd.spLevel=function(c){var b=0;2<hb[c]&&(b=hb[c]);return b};var ne=function(c,b){b.stay55();if(b.inventory&&b.invMax===b.inventory.length||!c.item)return 1;hb[c.x32+c.y32*G]=c.radix;pb(c,NaN);if(b.peon&&c.contain){var e=c.contain[1],d=c.contain[0];b.stock&&Fj(b);var g=Gj(b.x32,b.y32)||!1,h=c.contain[2];c.die(1);b.stock=
[d,e,g,ne.url,h];c=me(b.kingdom,e,b.x32,b.y32);oa(c,b,zc,b.url[h.url]);ba(b.id);return 1}b.addItem(c);ba(b.id)},Fj=function(c){var b=Hj(c.x32,c.y32),e=~~(b/G);b%=G;b=new dd(52,c.kingdom,b,e,0);na(b,m[c.stock[4].img]);b.contain=[c.stock[0],2,c.stock[4]]},Ih=function(c,b){c=0;for(var e=b.length;c<e;c++){var d=z[b[c]];d.xf?d.stop=2:(d.stop=2,d.stay(),d.stop=void 0)}},Dd=function(c,b){var e=G;c=z[c];for(var d=0,g=b.length;d<g;d++){var h=z[b[d]];if(h.in){var l=xb[h.zLevel],q=h.x32+h.y32*e;if(0!==l[q]||
!c.build){q=c.build?Jh(h,h.x32,h.y32):Jh(h,c.x32,c.y32);if(!1===q)continue;h.x32=q%G;h.y32=~~(q/G)}h.item&&(c.attack-=h.attack||0,c.defence-=h.defence||0);h.url.idle&&na(h,h.url.idle,1);l[q]=h.id;h.in=0;c.inventory.quit(h.id);l=1;h.z32&&(l=h.z32);pb(h,32*h.y32*l)}}ba(c.id,1)},oe=function(c,b){c=z[c];if(1===c.invType)for(var e=0,d=b.length;e<d;e++){var g=z[b[e]];g==c||g.in||oa(c.id,g,Kh,g.url.move)}},Kh=function(c,b){var e=c.inventory;if(e.length<c.invMax){var d=b.x32,g=b.y32;b.stay55();b.rbase()[d+
g*G]=b.radix;e.put(b.id);pb(b,NaN);b.in=c.id;pe(b.id);ba(c.id)}else b.stay55()},wc=function(c,b){for(var e=b.length,d=0;d<e;d++){var g=z[b[d]];g.buildList=!1;oa(c,g,fd,g.url.move)}},fd=function(c,b){if(c.dummy&&c.dummy.built)return b.stay55();if(c.health<c.maxHealth)b.dix=0,b.diy=0,b.mv=!0,b.setupDirBuild(c),na(b,b.url.build,1),b.setupINTV(Lf,{u:c.id,a:b.id},eb(b.img)),ee(b,"hit%20",7,b.img);else{if(b.buildList&&(c=Mf(b.buildList,b.x32,b.y32)))return oa(c,b,fd,b.url.move),0;b.stay55()}},Qf=function(c,
b){return b[c]&&13==z[b[c]].type||13==z[N[c]].type?!0:!1},Lf=function(c){var b=z[c.u];c=z[c.a];var e=c.x32,d=c.y32,g=b.x32+b.y32*G;if(b.death)return c.stay();var h=b.maxHealth,l=h/b.time*C[c.kingdom].values.buildSpeed;if(1===b.health){for(var q=b.validator(b.x32,b.y32,b.space,b.kingdom)[0],t=b.id,k=b.validator.dimension,B=0,p=q.length;B<p;B++)if(2<k[q[B]]){Nb(c,eb(c.img));return}var w=ib[b.kingdom];B=0;for(p=q.length;B<p;B++)k[q[B]]=t,w[q[B]]=void 0;Ja[b.kingdom][b.type].put(b.id);Ac(b)}b.health+=
l;l=b.health;0==b.built&&(w=~~(4*l/h),w>b.d&&(b.d=w,na(b,b.img)));if(l>=h){l=b.health=h;ba(b.id);if(!1===b.built){b.d=0;q=b.url;w=ib[b.kingdom];13===b.type&&(Qf(g-1,w)&&Qf(g+1,w)?(q=m.wood_horz,b.child=void 0):Qf(g+G,w)&&Qf(g-G,w)&&(q=m.wood_vert,b.child=void 0));b.built=1;b.img=q;mb(b);if(b.valid2)for(q=b.validator(b.x32,b.y32,b.space,b.kingdom)[2],k=b.validator.dimension,B=0,p=q.length;B<p;k[q[B++]]=0);Ij(b);va("bldgdone",0,0,b.kingdom);C[b.kingdom].building.quit(b.id);ba(b.id);b.standardFunc&&
b.standardFunc(b)}b.action=void 0;(g=c.buildList)&&g.quit(b.id);if(!g||c.buildList&&0===c.buildList.length)c.buildList=Jj(c),g=c.buildList;if(e=Mf(g,e,d))return oa(e,c,fd,c.url.move),0;c.buildList.length=0;c.stay();c.stock&&c.stock[0]&&na(c,c.url[c.stock[4].url])}else ba(b.id),Nb(c,eb(c.img));K[0]==b&&(Sc.innerHTML=l+"/"+h,jb.value=l)},Rf=function(c,b){if(2<c)for(var e=0,d=b.length;e<d;e++){var g=z[b[e]];oa(c,g,ed,g.url.move)}},vc=function(c,b){var e=c;c=z[c];if(c.field)for(d=0,c=b.length;d<c;d++)g=
z[b[d]],oa(e,g,ed,g.url.move);else if(0===c.res||3===c.res){var d=0;for(c=b.length;d<c;d++){var g=z[b[d]];oa(e,g,Sf,g.url.move)}}else if(1===c.res)for(d=0,c=b.length;d<c;d++)g=z[b[d]],oa(e,g,gd,g.url.move);else if(2===c.res)for(d=0,c=b.length;d<c;d++)g=z[b[d]],oa(e,g,Mc,g.url.move)},Lh=function(c,b){var e=x[c],d=b.length;c=C[z[b[0]].kingdom].mod[c];for(var g=0;g<d;g++){var h=z[b[g]];h.stay();Fh(h);h.img=e.img;h.attack=c.attack||e.attack;h.health=h.health/h.maxHealth*e.health;h.maxHealth=e.health;
h.defence=c.defence||e.defence;h.__proto__=e;mb(h);ba(h.id)}},xc=function(c,b,e,d){e=d||Ed;if(!(3>c||(c=z[c],void 0!=c.res||c.magicGateway))){d=0;for(var f=b.length;d<f;d++){var h=z[b[d]];h==c||h.attackOnly&&!h.attackOnly[c.type]||h.bat&&c.build||c.stoned||(h.build?e(c,h):oa(c.id,h,e,h.url.move))}}},gd=function(c,b){if(0<c.health){var e=b.x32,d=b.y32;b.mv=!0;b.setupDir(c.x32-e,c.y32-d);na(b,b.url.cut,1);b.dix=0;b.diy=0;ee(b,"chop%20",11,b.img);b.setupINTV(Kj,{u:c.id,a:b.id},7E3);c.addWorker(b)}else b.stay55()},
Kj=function(c){var b=G,e=z[c.u];c=z[c.a];var d=C[c.kingdom].values.wood;e.workers.quit(c.id);var g=me(c.kingdom,1,c.x32,c.y32),h=z[g];e.health-=d;c.mv=!1;ba(e.id);if(1>e.health){d+=e.health;N[e.x32+e.y32*b]=0;b=Xa(h.x32,h.y32);h=e.health=0;for(var l=e.workers.slice(0),q=l.length;h<q;h++){var t=z[l[h]];b?oa(b,t,gd,c.url.move):t.stay()}c.stock=[d,1,b,gd.url,Ej];c.mv=!1;oa(g,c,zc,c.url.tree);ba(c.id,1);e.workers.length=0;e.die()}else c.stock=[d,1,e.id,gd.url,Ej],oa(g,c,zc,c.url.tree),ba(c.id,1);if(0>
g)return c.stay()},ed=function(c,b){b.mv=!0;b.setupDir(c.x32-b.x32,c.y32-b.y32);na(b,b.url.dig,1);ee(b,"dig%20",3,b.img);b.setupINTV(Lj,{u:c.id,a:b.id},14E3);c.addWorker(b)},Lj=function(c){var b=z[c.u];c=z[c.a];var e=C[c.kingdom].values.food,d=c.x32,g=c.y32;b.lastUse=p.cycle;d=me(c.kingdom,2,d,g);c.mv=!1;c.stock=[e,2,b.id,ed.url,Ql];oa(d,c,zc,c.url.food);ba(c.id,1);if(0>d)return c.stay()},Mc=function(c,b){b.mv=!0;b.setupDir(c.x32-b.x32,c.y32-b.y32);na(b,b.url.milk1,1);b.stock=[0,2,c.id,Mc.url,Nl];
b.setupINTV(Mh,{u:c.id,a:b.id},1E3);c.addWorker(b);c.d=(8-b.d)%8;c.stay()},Mh=function(c){var b=z[c.u];c=z[c.a];b.milk-=3;var e=c.x32,d=c.y32;c.stock[0]+=3;ba(c.id,1);if(0>=b.milk||b.death){if(50<c.stock[0]&&(c.stock[0]=50),c.mv=!1,b=me(c.kingdom,2,e,d),oa(b,c,zc,c.url.milk),0>b)return c.stay()}else Nb(c,1E3)},fe=function(c,b){b.stay55()},Ad=function(c,b){Ed(c,b)},Ed=function(c,b){if(1!==c.death&&c!=b){if(c.dummy&&!C[b.kingdom].values.experience)return b.stay55();b.invisible&&Fd(b.id);if(!0!==b.build){b.mv=
1;var e=c.x32-b.x32,d=c.y32-b.y32;c.space&&(d=th(c,b.x32,b.y32),e=d%G-b.x32,d=~~(d/G)-b.y32);b.setupDir(e,d,b.d2attack);b.url.attack&&na(b,b.url.attack,1)}b.setupINTV(Tf,{u:c.id,a:b.id},b.attackTime||eb(b.img),c);c.addWorker(b)}else b.stay55()};Ed.distance=-1;Ad.distance=-1;var Nh=function(c,b){var e=C[c.kingdom];if(e.values.experience&&(!b||0!=e.diplomacy[b.kingdom]||b.dummy)){if(0==c.level||null==c.level)c.level=0,c.levelProgress=0;c.levelProgress++;c.levelProgress>=~~(c.level/e.values.experience)&&
c.level<e.values.maxLevel&&(c.level++,c.health+=e.values.healthJump,c.maxHealth+=e.values.healthJump,c.levelProgress=0,c.attack+=c.level,c.defence+=c.level%2,ba(c.id,1))}},zj=function(c){var b=c.level;c.attack+=b;c.defence+=~~(.5*b)},Tf=function(c){var b=z[c.u];c=z[c.a];var e=c.attDist,d=b.x32-c.x32,g=b.y32-c.y32,h=b.x32,l=b.y32,q=!c.build;if(c.attackSound){var t=c.attackSound;va(t[~~(t.length*Math.random())],c.x32,c.y32)}q&&!b.build&&c.setupDir(d,g,c.d2attack);na(c,c.img,1);if(b.death||c.level&&
8<=c.level&&b.dummy||b.dummy&&c.level&&c.level>=C[c.kingdom].values.maxLevel)return c.stay();if(1<e&&!c.dragon){q=!0;var k=Ca[c.attimg]}else q=!1;if(b.build||he(b.x32,b.y32,c.x32,c.y32,e)){b.onattack(c);e=c.attack*((zd[c.type][b.type]||0)+1);if(q){b.space&&(d=th(b,c.x32,c.y32),h=d%G,l=~~(d/G),d=h-c.x32,g=l-c.y32);q=0;if(c.arrow||c.ball){t=Mj;var m=uh(-d,-g);var F=d;var w=g;var r=411/Math.sqrt(F*F+w*w);F*=r;w*=r;var u=Math.sqrt(1024*d*d+g*g*1024)/Math.sqrt(F*F+w*w);c.ball&&(k[1]=k[0]/u)}else{var x=
2;t=Uf;q=F=p.gravity;m=Math.PI/180*60;r=Math.cos(m);m=c.attackDeg;m*=Math.PI/180;w=Math.sin(m);u=Math.cos(m);m=32*Math.sqrt(d*d+g*g);F=u*Math.sqrt(F*m/(w*u*2));u=m/F;w=-Math.sin(Math.atan2(-d,-g));m=uh(-d,-g);F*=w;q=Math.abs(q*r*w);w=(32*g-q*u*u*.5)/u}u=Math.round(1E3*u);r={x32:c.x32+.5,y32:c.y32+.5,img:k.url,mv:c.ball,d:0,rotation:-m+1.5,xf:h,yf:l,obj:b.id,attack:e,range:x};mb(r);Oc(r,F,w,q);ob({func:t,data:r},u,1)}r||b.damage(e,c);if(b.dummy){if(50<=c.dummyDamage||!c.dummyDamage)c.dummyDamage=0;
c.dummyDamage+=e;50<=c.dummyDamage&&Nh(c,b)}b.death?(c.action=null,b.build||c.build||Nh(c,b),qd(c)||c.stay()):Nb(c,c.attackTime||eb(c.img))}else c.build&&(qd(c)||c.stay()),c.mv=!1,0!==c.state&&oa(b.id,c,Ed,c.url.move)},Sf=function(c,b){0<c.health?(b.dix=0,b.diy=0,b.mv=1,b.setupDirBuild(c),na(b,b.url.kirka,1),ee(b,"mine%20",3,b.img),b.setupINTV(Nj,{u:c.id,a:b.id},7E3),c.addWorker(b)):b.stay()},Nj=function(c){var b=z[c.u];c=z[c.a];var e=b.res,d=C[c.kingdom].values[0==e?"gold":"stone"],g=c.x32,h=c.y32;
b.health-=d/C[c.kingdom].values.miningPerf;ba(b.id);1>b.health&&(d=b.health+d,b.health=0,b.d=3,b.die());c.mv=!1;g=me(c.kingdom,e,g,h);0==e?(c.stock=[d,e,b.id,Sf.url,Ol],oa(g,c,zc,c.url.gold)):(c.stock=[d,e,b.id,Sf.url,Pl],oa(g,c,zc,c.url.stone));ba(c.id,1);if(0>g)return c.stay()},oa=function(c,b,e,d){b.cow&&b.workers.length||b.freezed||b.in||b.stoned||(b.action=e.url,b.distance=0,b.nodes=void 0,0<c?(b.xf=c,b.yf=!0):(c*=-1,b.xf=c%G,b.yf=~~(c/G)),b.func!=ge.url&&(d==b.url.move?rh(b):b.mimg=d,b.dix=
0,b.diy=0,b.mv=!0,b.setupINTV(ge,b.id,0)))},qe=function(c,b){J(c);Vf(b,c,Oj)};qe.allowPos=1;var Oj=function(c,b){J(c);Dd(b.id,b.inventory.slice(0));b.stay55()},th=function(c,b,e){var d=c.space||Il,g=d.length-1,h=d[g],l=c.x32;c=c.y32-1;for(var q=Infinity,t=0,k=0;k<g;k++){var m=k%h;m||c++;var p=(l+m-b)*(l+m-b)+(c-e)*(c-e);p<q&&d[k]&&(t=l+m+c*G,q=p)}return t},Jh=function(c,b,e){var d=G,g=c.radix,h=xb[c.zLevel];for(c=2;60>=c;c+=2){b--;e--;for(var l=0;l<=c;){var q=b+l+d*e;if(h[q]===g)return q;q=b+l+d*
(e+c);if(h[q]===g)return q;l++}for(l=0;l<c-1;){l++;q=b+d*(e+l);if(h[q]===g)return q;q=b+c+d*(e+l);if(h[q]===g)return q}}return!1},Hj=function(c,b){var e=G,d,g=hb;for(d=2;60>=d;d+=2){c--;b--;for(var h=0;h<=d;){var l=c+h+e*b;if(0===g[l]&&0===N[l])return l;l=c+h+e*(b+d);if(0===g[l]&&0===N[l])return l;h++}for(h=0;h<d-1;){h++;l=c+e*(b+h);if(0===g[l]&&0===N[l])return l;l=c+d+e*(b+h);if(0===g[l]&&0===N[l])return l}}return!1},Nc=function(c,b,e,d){var f=b.x32,h=b.y32,l=G,q=f+h*l,t=c.x32,k=c.y32,m=c.space;
if(m){var p=m[m.length-1];m=(m.length-1)/p;c=c.free}else m=p=1,c=pj;b=b.rbase();for(var w,r=Infinity,u=-1,x=!1,v=0;v<e&&-1==u;){if(0==v&&c){for(var y=[],z=0,A=c.length;z<A;z+=2){var C=c[z]+t;w=c[z+1]+k;if(ha(C,w)&&(b[C+w*l]===d||C+w*l==q))a:{var E=y;C+=w*l;w=f;for(var D=h,I=G,L=Math.pow(C%I-w,2)+Math.pow(~~(C/I)-D,2),J=0,K=E.length;J<K;J++)if(Math.pow(E[J]%I-w,2)+Math.pow(~~(E[J]/I)-D,2)>L){E.splice(J,0,C);break a}E.put(C)}}y[0]&&(u=y[0]);if(-1<u){x=!0;break}if(1==e)break}v++;--t;--k;y=p+2*v;E=m+
2*v;z=0;for(A=y*E;z<A;z++)w=z%y,D=~~(z/y),w&&D&&w!=y-1&&D!=E-1||(w+=t,D+=k,C=w+D*l,b[C]==d&&ha(w,D)&&(w=(w-f)*(w-f)+(D-h)*(D-h),r>w&&(r=w,u=C)))}return-1<u?[u%l,~~(u/l),x]:!1},Aj=function(c,b,e,d,g){performance.now();var f=G,l=c.x32,q=c.y32,t=c.space,k=[],m=0;if(t){var p=t[t.length-1];t=(t.length-1)/p;var w=c.free}else t=p=1;c=-1==b?-Infinity:Infinity;for(var r=-1,u=0,x=0;0==k.length;){if(w&&0==x){for(var v=0,y=w.length;v<y;v+=2){var z=w[v]+l,A=w[v+1]+q;ha(z,A)&&g[z+A*f]===d&&(k[m++]=z+A*f,u=(z-b)*
(z-b)+(A-e)*(A-e),c>u&&(c=u,r=z+A*f))}if(k.length)break}x++;--l;--q;for(v=0;v<p+2*x;v++)g[l+q*f+v]==d&&ha(l+v,q)&&(k[m++]=l+v+q*f,u=(l+v-b)*(l+v-b)+(q-e)*(q-e),c>u&&(c=u,r=l+v+q*f)),g[l+(q+t+2*x-1)*f+v]==d&&ha(l+v,q+t+2*x-1)&&(k[m++]=l+(q+t+2*x-1)*f+v,u=(l+v-b)*(l+v-b)+(q+t+2*x-1-e)*(q+t+2*x-1-e),c>u&&(c=u,r=l+(q+t+2*x-1)*f+v));for(v=1;v<t+2*x-1;v++)g[l+(q+v)*f]==d&&ha(l,q+v)&&(k[m++]=l+(q+v)*f,u=(l-b)*(l-b)+(q+v-e)*(q+v-e),c>u&&(c=u,r=l+(q+v)*f)),g[l+p+2*x-1+(q+v)*f]==d&&ha(l+p+2*x-1,q+v)&&(k[m++]=
l+p+2*x-1+(q+v)*f,c>u&&(c=u,r=l+p+2*x-1+(q+v)*f))}return[r,k]},pj=[-1,0,-1,-1,0,-1,1,-1,1,0,1,1,0,1,-1,1],Mf=function(c,b,e){for(var d=Infinity,g=!1,h=0,l=c.length;h<l;h++){var q=c[h],t=z[c[h]];if(0!=t.built||t.death)h--,l--,c.quit(q);else{var k=t.x32;t=t.y32;t=(k-b)*(k-b)+(t-e)*(t-e);d>=t&&(d=t,g=q)}}return g},Oh=function(c,b){c=0;for(var e=b.length;c<e;c++){var d=z[b[c]];d.spd=d.__proto__.spd}},Cf=function(c,b){c=Infinity;for(var e=0,d=b.length;e<d;e++){var g=z[b[e]];g.spd<c&&(c=g.spd)}Wf(c,b)},
Gj=function(c,b){for(var e=G,d,g=Infinity,h=0,l=0;121>l;l++){var q=l%11-5,k=~~(l/11)-5,m=q*q+k*k;q+=c;k+=b;m<g&&(d=hb[q+e*k],0<d&&0==N[q+e*k]&&(d=z[d],d.contain&&(g=m,h=d.id)))}return h},Xf=function(c,b){Vf(b,c,zc)},zc=function(c,b){c=C[b.kingdom];var e=b.stock;c.resources[e[1]]+=e[0];c.stats.resources[e[1]]+=e[0];Yf(b.kingdom);b.func=1;var d=Ob[e[3]],g=z[e[2]];if(d==Mc){var h=G;for(var l,q=Infinity,k=!1,m=0;961>m;m++){var B=m%31-15,r=~~(m/31)-15,w=B*B+r*r;B+=b.x32;r+=b.y32;w<q&&(l=hb[B+h*r],0<l&&
0===N[B+h*r]&&(l=z[l],l.contain&&"meat"==l.contain[2].url&&(q=w,k=l)))}if(h=k)d=ne,g=h}else"meat"==e[4].url&&!1===e[2]&&(h=Ph(b.x32,b.y32,!0))&&(d=Mc,g=h,e[2]=1);b.stock=void 0;if(!1===e[2])return b.stay();if(h=100<Math.pow(g.x32-b.x32,2)+Math.pow(g.y32-b.y32,2))a:{h=Mb[1];q=Ja[b.kingdom];k=0;for(m=h.length;k<m;k++)if(w=h[k],1==x[w].storage&&q[w].length){h=!0;break a}h=!1}h&&void 0!==c.IAD&&1==e[1]?(p.blocked=!0,lj(b),p.blocked=!1):(oa(g.id,b,d,b.url.move),ba(b.id,1))};vc.cursor=6;xc.cursor=1;wc.cursor=
9;Cd.cursor=5;oe.cursor=7;qe.cursor=7;Rf.cursor=6;Xf.cursor=6;var Jj=function(c){var b=G,e=c.kingdom,d=c.x32,g=c.y32;d-=16;g-=16;for(var h={},l=[],q=0,k=ib[e],m=0;1024>m;m++){c=m%32+d;var p=~~(m/32)+g;ha(c,p)&&(c=k[c+p*b],void 0!==c&&(c=z[c],c.kingdom!=e||!1!==c.built||h[c.id]||(l[q++]=c.id,h[c.id]=1)))}return l};gd.available=function(c,b){var e=C[c.kingdom].values.wood;if(b.death||1>b.health-e&&b.workers.length)b=Xa(b.x32,b.y32),c.xf=b,b=z[b];return Nc(b,c,1,c.radix)};ed.available=function(c,b){if(b.death)return"kill";
c=b.x32+1;b=b.y32+1;return 0===N[c+b*G]?[c,b,1]:!1};fd.available=function(c,b){var e=c.x32,d=c.y32;if(!b.death&&b.health<b.maxHealth){var g=Nc(b,c,1,c.radix);if(g[2])return g}c.buildList?(g=c.buildList,g.quit(b.id)):(c.buildList=Jj(c),g=c.buildList);b=Mf(g,e,d);if(!b)return"kill";c.xf=b;b=z[b];return Nc(b,c,1,c.radix)};fe.rev=function(c){return 0===c.distance%3&&(c=qh(c.id,1))?[Ad.url,c]:!1};Ad.available=function(c,b){if(0===c.distance%3){var e=qh(c.id);e&&(c.xf=e,b=z[e])}return Nc(b,c,5,c.radix)};
ne.available=function(c,b){if(b.death||b.in)if(b.contain)if(b=Gj(b.x32,b.y32))c.xf=b,b=z[b];else return(b=Ph(c.x32,c.y32,!0))?(c.stay(),oa(b.id,c,Mc,c.url.move),55):"kill";else return"kill";c=b.x32;b=b.y32;return 0===N[c+b*G]?[c,b,1]:!1};Mc.available=function(c,b){if(b.workers.length||10>b.milk||b.death){b=Ph(c.x32,c.y32);if(!b)return!1;c.xf=b.id}return b.xf?!1:Nc(b,c,5,c.radix)};Kh.available=function(c,b){if(b.death)return"kill";var e=1;b.boat&&(e=2);return(c=Nc(b,c,e,c.radix))?(c[2]=1,c):!1};var Ph=
function(c,b,e){for(var d=G,g,h=Infinity,l=!1,q=0;441>q;q++){g=q%21-10;var k=~~(q/21)-10,m=g*g+k*k;g+=c;k+=b;m<h&&(g=N[g+d*k],0<g&&(g=z[g],g.cow&&(!g.workers.length&&g.milk>=50/1.5||e)&&(h=m,l=g)))}return l},Vf=function(c,b,e){for(var d=0,g=c.length;d<g;d++){var h=z[c[d]];oa(b,h,e,h.url.move)}},re=function(c,b){Pa(b,c,Zf)};re.noObj=1;var Zf=function(c,b){se(b,-c,77,Zf)},te=function(c,b){Pa(b,c,$f)};te.noObj=1;var $f=function(c,b){se(b,-c,130,$f)},ue=function(c,b){Pa(b,c,ag)};ue.noObj=1;var ag=function(c,
b){se(b,-c,78,ag)},ve=function(c,b){Pa(b,c,bg)};ve.noObj=1;ve.cursor=10;var bg=function(c,b){se(b,-c,132,bg)},we=function(c,b){Pa(b,c,cg)};we.cursor=10;we.noObj=1;var cg=function(c,b){se(b,-c,131,cg)},se=function(c,b,e,d){var f=G,h=C[c.kingdom],l=x[e],q=x[e].cost,k=c.mana>c.manaMax;if(Gb(c)||c.checkMana(q[4],b,d,q)){k||h.paypal(q);d=e;b*=-1;k=b%f;var m=~~(b/f),p=k,r=m,w=xb[l.zLevel],u=~~(c.mana/q[4])+1;1<u&&(h.resources[0]-=q[0]*(u-1),c.mana-=q[4]*(u-1));for(h=0;h<u;h++)0!==w[b]&&(e=Jh(l,k,m),p=e%
f,r=~~(e/f)),va("summon"+~~(10*Math.random()+1),p,r),e=new dd(d,c.kingdom,p,r,0),e.setupChild(Db.spawn);c.setupDir(-c.x32+e.x32,-c.y32+e.y32);c.setupSpellIMG()}else h.paypal(q);ba(c.id)},he=function(c,b,e,d,g){return~~Math.sqrt((c-e)*(c-e)+(b-d)*(b-d))<=g},eg=function(c,b){Pa(b,c,dg)};eg.cursor=0;var dg=function(c,b){c.build||c.terrain||c.nofreeze||!Gb(b)&&!b.checkMana(50,c.id,dg)||(c.freezed=1,c.stoned=1,pb(c,32*c.y32),c.stay(),na(c,c.img,0),c.setupChild(Db.turnStone),Gd(c,uj),pe(c.id),b.setupDir(-b.x32+
c.x32,-b.y32+c.y32),b.setupSpellIMG(),va("turn%20to%20stone",b.x32,b.y32),ob({func:Pj,data:c.id},24E4,1))},Pj=function(c){c=z[c];c.freezed=0;Ac(c);c.stoned=0},fg=function(c,b){Pa(b,c,xe)},xe=function(c,b){c.health<c.maxHealth&&!c.build?(b.setupDir(c.x32-b.x32,c.y32-b.y32),J("heal",eb(b.img)),b.setupSpellIMG(!0),b.setupINTV(Qj,{u:c.id,a:b.id},0),c.addWorker(b)):b.stay()},Qh=function(){Pa(list,obj,Rj)},Rj=function(){},Qj=function(c){var b=z[c.a];c=z[c.u];var e=C[b.kingdom].values.healingRange;va("heal",
b.x32,b.y32);if(!he(c.x32,c.y32,b.x32,b.y32,e))return oa(c.id,b,xe,b.url.move);if(Gb(b)||b.checkMana(4,c.id,xe)){b.setupDir(c.x32-b.x32,c.y32-b.y32);c.health+=6;c.setupChild(Db.heal);if(c.health>=c.maxHealth)return c.health=c.maxHealth,ba(c.id,1),ba(b.id,1),b.stay();ba(c.id,1);ba(b.id,1);Nb(b,eb(b.url.spell))}},ye=function(c,b){Pa(b,c,gg)};ye.cursor=10;var Rh=function(c,b){c=z[c];b=z[b];if(c.inventory.quit(b.id)){b=d[b.spell];c.icons==c.__proto__.icons&&(c.icons=c.icons.slice(0));c.icons.put(b);var e=
c.icons;e.olegal||(e.olegal={});e.olegal[b.id]=1;ba(c.id)}},Hd=function(c,b){var e=b[1];b=z[b[0]];z[c].nopotion||z[c].build||(oa(c,b,Sj,b.url.move),b.actionItem=e)};Hd.item=1;var Sj=function(c,b){var e=z[b.actionItem];b.actionItem=void 0;e.attack&&(c.attack+=e.attack);e.defence&&(c.defence+=e.defence);e.mana&&(c.mana||(c.mana=0,c.manaMax=0,c.update?c.update.push("mana","manaSpeed",1E3):c.update=["mana","manaSpeed",1E3],ob({func:Ef,data:[c.id,"mana","manaSpeed",1E3]},1E3,1)),c.manaMax+=e.mana,c.mana+=
e.mana);e.level&&(c.level||(c.level=0),c.level+=e.level,c.attack+=e.level,c.defence+=~~e.level);va("bless",c.x32,c.y32);b.inventory.quit(e.id);b.stay55();ba(b.id)};Hd.cursor=10;fg.cursor=10;re.cursor=10;te.cursor=10;ue.cursor=10;var hg=function(c,b){Pa(b,c,Sh)};hg.cursor=1;var Sh=function(c,b){if(c.isSpy&&c==b)b.stay55();else if(Gb(b)||b.checkMana(90,c.id,Sh))b.setupDir(-b.x32+c.x32,-b.y32+c.y32),na(b,b.url.attack,1),ob({func:Tj,data:[c,b]},eb(b.img)-25,1)},Tj=function(c){var b=c[1];c=c[0];c.die(1);
var e=c.getRadix();e[b.x32+b.y32*G]=b.radix;b.x32=c.x32;b.y32=c.y32;b.d=c.d;b.name=b.name;b.attack=c.attack;b.defence=c.defence;b.update=b.update;b.mana=0;b.manaMax=b.manaMax;e[b.x32+b.y32*G]=b.id;pb(b,32*b.y32);b.__proto__=c.__proto__;na(b,b.url.idle);e=c.icons.slice(0);e.quit(d.menuBuilds);e.quit(d.menuBuilds1);e.quit(d.menuBuilds2);e.put(d.impersonate);e.put(d.revealSelf);b.icons=e;b.spy||(b.spy=b.kingdom);b.kingdom!==c.kingdom&&b.changeKingdom(c.kingdom);b.setupChild(Db.impersonate);ba(b.id)},
Th=function(c){c=z[c];if(c.spy){var b=x[2];c.attack=b.attack;c.defence=b.defence;c.__proto__=b;c.icons=b.icons;c.kingdom!==c.spy?c.changeKingdom(c.spy):c.stay();na(c,c.url.idle);ba(c.id);c.spy=void 0}};ye.allowPos=1;var gg=function(c,b){if(c.id){var e=c.id,d=c.x32;c=c.y32}else e=-c,d=c%G,c=~~(c/G);if(Gb(b)||b.checkMana(60,e,gg)){b.setupDir(-b.x32+d,-b.y32+c);b.setupSpellIMG();e=8;d-=.5*e;c-=.5*e;var g=[];e+=1;var h=e*e;va("bless",b.x32,b.y32);for(b=0;b<h;b++)for(var l=1;3>l;l++){var q=z[xb[l][b%e+
d+(~~(b/e)+c)*G]];q.build||q.terrain||(q.setupChild(Db.bless),q.blessed||(q.blessed=1,q.attack+=5,ba(q.id,1),g.put(q)))}ob({func:Uj,data:g},3E4,1)}},Pa=function(c,b,e){if(c[1]&&z[c[1]].item){var d=c[1];c.length--;Vf(c,b,e);z[c[0]].actionItem=d}else Vf(c,b,e)},Gb=function(c){var b=c.actionItem;if(!b)return!1;b=z[b];b.attack&&(b.attack--,0===b.attack&&(c.inventory.quit(b.id),ba(c.id)));return!0},Uj=function(c){for(var b=0,e=c.length;b<e;b++){var d=c[b];d.blessed=void 0;d.attack-=5;ba(d.id,1)}},ze=function(c,
b){Pa(b,c,ig)};ze.cursor=10;var ig=function(c,b){c.freezed||!Gb(b)&&!b.checkMana(50,c.id,ig)?b.stay55():(b.setupDir(-b.x32+c.x32,-b.y32+c.y32),b.setupSpellIMG(),va("invisible",c.x32,c.y32),c.invisible||(Gd(c,zh),c.invisible=1,c.stay()),ba(c.id),ob({func:Fd,data:c.id},5E4,1))},Fd=function(c){c=z[c];c.death||(c.invisible=void 0,Ac(c),ph(c))},kg=function(c,b){Pa(b,c,jg)};kg.cursor=0;var jg=function(c,b){if(Gb(b)||b.checkMana(50,c.id,jg))b.setupDir(-b.x32+c.x32,-b.y32+c.y32),b.setupSpellIMG(),va("lightning",
b.x32,b.y32),c.damage(50,b)},Ae=function(c,b){Pa(b,c,lg)};Ae.cursor=0;Ae.noObj=1;var lg=function(c,b){var e=G;if(c.id){var d=c.id,g=c.x32;c=c.y32}else d=-c,g=c%e,c=~~(c/e);if(Gb(b)||b.checkMana(50,d,lg)){b.setupDir(-b.x32+g,-b.y32+c);b.setupSpellIMG();va("flame%20ball",g,c);d=g-b.x32;g=c-b.y32;c=Math.sqrt(d*d+g*g);d/=c;g/=c;for(var h=b.x32+.5,l=b.y32+.5,q=[],k=[],m=0,p,r,w=0;w<c;w++)p=h+d*w,r=l+g*w,k.put(p),k.put(r),p=~~p,r=~~r,q[m++]=p+r*e,q[m++]=~~(p+g)+~~(r+d)*e,q[m++]=~~(p-g)+~~(r-d)*e;for(w=
0;w<0*q.length;w++)Bd(q[w]%e,~~(q[w]/e),"food");ob({func:Uh,data:{list:q,anim:k,i:2,a:b}},1E3,1)}},mg=function(c,b){Pa(b,c,Be)};mg.cursor=10;var Be=function(c,b){b.setupDir(-b.x32+c.x32,-b.y32+c.y32);b.setupSpellIMG(!0);b.setupINTV(Tl,{u:c.id,a:b.id},0);c.addWorker(b)},Tl=function(c){var b=z[c.a];c=z[c.u];if(!he(c.x32,c.y32,b.x32,b.y32,C[b.kingdom].values.teachDistance))return oa(c.id,b,Be,b.url.move);if(c.level>=b.level)return b.stay();if(Gb(b)||b.checkMana(10,c.id,Be))va("teach",b.x32,b.y32),b.setupDir(c.x32-
b.x32,c.y32-b.y32),c.setupChild(Db.curse,!1,Kl),Nh(c,!1),ba(c.id,1),ba(b.id,1),Nb(b,eb(b.url.spell))},Ce=function(c,b){Pa(b,c,ng)};Ce.cursor=0;Ce.noObj=1;var ng=function(c,b){var e=G;if(c.id){var d=c.id,g=c.x32;c=c.y32}else d=-c,g=c%e,c=~~(c/e);if(Gb(b)||b.checkMana(70,d,ng)){b.setupDir(-b.x32+g,-b.y32+c);b.setupSpellIMG();d=g;var h=c;g-=8;c-=8;for(var l=0;256>l;l++){var q=g+l%16,k=~~(l/16)+c,m=q+k*e;ha(q,k)&&64>=Math.pow(q-d,2)+Math.pow(k-h,2)&&og[m]&&0===N[m]&&(J(q,k),new dd(60,b.kingdom,q,k,0))}}},
Uh=function(c){var b=c.list,e=c.anim,d=c.i,g=c.a,h={x32:e[2*d],y32:e[2*d+1],d:0,img:m.flame_trail,mv:1,z32:2,alpha:!0};mb(h);hc.new(h,eb(h.img));for(h=0;3>h;h++){var l=z[N[b[h+3*d]]];l.health&&l.damage(96,g)}c.i++;c.i<.5*e.length&&ob({func:Uh,data:c},50,1)},De=function(c,b){Pa(b,c,pg)};De.cursor=0;De.noObj=1;var pg=function(c,b){if(c.id){var e=c.id,d=c.x32;c=c.y32}else e=-c,d=c%G,c=~~(c/G);if(Gb(b)||b.checkMana(60,e,pg))b.setupDir(-b.x32+d,-b.y32+c),b.setupSpellIMG(),va("freeze",d,c),ob({func:Vj,
data:[d,c]},1E3,1)},Ee=function(c,b){Pa(b,c,qg)};Ee.cursor=0;Ee.noObj=1;var qg=function(c,b){if(c.id){var e=c.id,d=c.x32;c=c.y32}else e=-c,d=c%G,c=~~(c/G);if(Gb(b)||b.checkMana(70,e,qg)){b.setupDir(-b.x32+d,-b.y32+c);b.setupSpellIMG();va("confusion",d,c);b=4;d-=.5*b;c-=.5*b;e=G;var g=[];b+=1;for(var h=b*b,l=0;l<h;l++)for(var q=1;3>q;q++){var k=z[xb[q][l%b+d+(~~(l/b)+c)*e]];k.build||k.terrain||k.stoned||(k.confused=1,k.invisible&&Fd(k),Gd(k,vj),k.stay(),g.put(k),pe(k.id))}h&&1===K.length&&ba(K[0]);
g.length&&ob({func:Wj,data:g},2E4,1)}},Wj=function(c){for(var b=0,e=c.length;b<e;b++){var d=c[b];d.confused=void 0;d.death||(na(d,d.img,1),Ac(d),d.stay(),zb==d&&(zb=void 0,K[0]=d.id,ba(d.id)))}},Vj=function(c){var b=6,e=c[0]-.5*b,d=c[1]-.5*b,g=G,h=[];b+=1;var l=b*b;c={img:m.freeze_expl,d:0,mv:1,x32:c[0],y32:c[1]};mb(c);hc.new(c,eb(c.img));for(var q=0;q<l;q++)for(var k=1;3>k;k++)c=z[xb[k][q%b+e+(~~(q/b)+d)*g]],c.build||c.terrain||c.nofreeze||c.stoned||(c.freezed=1,pb(c,32*c.y32),c.stay(),na(c,c.img,
0),c.invisible&&Fd(c),Gd(c,tj),c.health-=40,1>c.health&&(c.health=1),h.put(c),pe(c.id));l&&1===K.length&&ba(K[0]);ob({func:Xj,data:h},2E4,1)},Xj=function(c){for(var b=0,e=c.length;b<e;b++){var d=c[b];d.freezed=void 0;d.death||(na(d,d.img,1),Ac(d),zb==d&&(zb=void 0,K[0]=d.id,ba(d.id)))}},Fe=function(c,b){J(b);Pa(b,c,rg)};Fe.cursor=0;Fe.noObj=1;var rg=function(c,b){J(c,b);if(c.id){var e=c.id,d=c.x32;c=c.y32}else e=-c,d=c%G,c=~~(c/G);if(Gb(b)||b.checkMana(100,e,rg))b.setupDir(-b.x32+d,-b.y32+c),b.setupSpellIMG(),
Vh(d,c,3,20,4500,b.id)},Vh=function(c,b,e,d,g,h){for(var f=m.fire_rain,q=p.gravity,k=Date.now(),n=Vh.rnd,B=Math.PI,r=performance.now(),w=0;w<d;w++){var u=2*n()*B,v=e*n(),x=c+v*Math.cos(u);u=b+v*Math.sin(u);v=~~(w/d*g);ha(x,u)&&ob({func:Yj,data:{x32:x,y32:u-6,dix:0,diy:140,img:f,mv:1,d:0,timestamp:k,finnish:Infinity,aceleration:q,attack:40,xf:x,yf:u,range:2,kingdom:0,obj:h,crashTime:(Math.sqrt(19600+384*q)-140)/q*1E3}},v,1)}J(performance.now()-r)},Yj=function(c){ob({func:Uf,data:c},c.crashTime,1);
mb(c,0,c.diy,p.gravity)};Vh.rnd=function(){var c=4096,b=2048;return function(){b=36969*(b&65535)+(b>>16)&4294967295;c=18E3*(c&65535)+(c>>16)&4294967295;return((b<<16)+c&4294967295)/4294967296+.5}}();var Mj=function(c){z[c.obj].damage(c.attack,z[c.obj]);Qb(c);jc.put(c.bufferID)},Zj=function(c){c=z[c];c.bufferID&&(Qb(c),jc.put(c.bufferID));og[c.x32+c.y32*G]=void 0},Uf=function(c){var b=G,e=c.xf,d=c.yf,g=c.attack;c.mv=1;c.func=void 0;c.x32=e;c.y32=d;Oc(c,0,0,0);pb(c,2);e=~~e;d=~~d;var h=e+d*b,l=N[h];
Ub[h]?(c.img=m.expl_small_water,va("water%blop",c.x32,c.y32)):(c.img=m.expl_small_hole,va("small%20explosion",c.x32,c.y32));na(c,c.img,1);hc.new(c,ak(Ca[c.img]));if(Ub[h]){if(l=hb[h],2<l){var q=z[l];q.damage(g,z[c.obj])}}else{2<l&&(q=z[l],q.damage(g,z[c.obj]));h=c.range;l=2*h+1;for(var k=0,n=l*l;k<n;k++){q=k%l-h;var p=~~(k/l)-h,r=~~Math.sqrt(q*q+p*p);r<h&&(q+=e,p+=d,q=N[q+p*b],2<q&&(q=z[q],q.damage(g*(1-r/h),z[c.obj])))}}},Ul=function(c){if(0<K.length){var b=z[K[0]],e=0,d=0,g=0,h=0;void 0!==b.dix&&
(c=.001*(c-b.timestamp),h=b.dix,g=b.diy,e=h*c,d=g*c);if(b.space){var l=b.space;c=l[l.length-1];l=(l.length-1)/c}else l=c=1;e+=32*(b.x32+.5*c-Math.sign(h))+.5*-tzar.width+.5;d+=32*(b.y32+.5*l-Math.sign(g))+.5*-tzar.height+.5;ub=~~-e;Ta=~~-d;wd(-ub,-Ta)}},bk=function(){};xe.distance="healingRange";Zf.distance="createGolemRange";gg.distance="blessDistance";pg.distance="freezeDistance";qg.distance="confusionDistance";ig.distance="invisibilityDistance";jg.distance="lightningDistance";ag.distance="createBatDistance";
$f.distance="createDragonDistance";cg.distance="createCarpetDistance";bg.distance="createJinnDistance";dg.distance="turnToStoneDistance";lg.distance="flameBoltDistance";rg.distance="fireRainDistance";ng.distance="freezeDistance";Be.distance="teachDistance";var C=[];var Xb=function(c,b,e,d,g,h,l){this.name=c;this.k=C.length;this.color=b;this.status="";this.stats={dmgInflicted:0,dmgTaken:0,resources:[0,0,0,0],score:0,unitsKilled:0,unitsLosed:0,buildsLosed:0,buildsDestroyed:0,unitCount:new Uint32Array(x.length),
unitCountMax:new Uint32Array(x.length),unitCountDeath:new Uint32Array(x.length),goldTraded:0,goldConverted:0,stoneTraded:0};this.team=l;this.resources=h||[5E4,5E4,5E4,5E4];this.values={gold:10,wood:10,food:10,stone:10,buildSpeed:1,experience:0,healthJump:0,maxLevel:4,pop:0,popMax:1,popLimit:200,healingRange:1,blessDistance:9,createGolemRange:5,freezeDistance:13,invisibilityDistance:9,createBatDistance:16,lightningDistance:12,createDragonDistance:4,turnToStoneDistance:21,flameBoltDistance:19,fameTech:0,
confusionDistance:13,manaSpeed:2,milkSpeed:2,cowSpeed:2,stealCow:0,miningPerf:1,fireRainDistance:15,createCarpetDistance:3,createJinnDistance:3,teachDistance:2};this.race=d;this.racestr=sg[d];this.IA=g||0;this.building=[];this.diplomacy=e;this.control={};this.control[this.k]=1;this.onFreePop=[];c=[];c.length0function=Vl;this.unitLoading=0;this.target=[0,0,0,0];this.crusade={number:0,list:c};this.technology={hidden:{},disabled:{},actived:{},investigated:{}};this.mod=b=[];ck[this.racestr]++;c=0;for(e=
x.length;c<e;b[c++]={});C[C.length]=this;c=this.k;b=[];ib[c]={};Ja[c]=b;for(e=0;e<x.length;e++)b[e]=[];b=this.color;Sa[3*c]=b[0]/255;Sa[3*c+1]=b[1]/255;Sa[3*c+2]=b[2]/255};Xb.prototype.setupResources=function(c,b){var e=this.resources;b||(b=1);e[0]-=c[0]*b;e[1]-=c[1]*b;e[2]-=c[2]*b;e[3]-=c[3]*b;Yf(this.k)};var Ja=[];var ib=[];var Sa=[];Xb.prototype.check=function(){if(this.values.pop)return!0;for(var c=Wl,b=Ja[this.k],e=0,d=x.length;e<d;e++)if(!c[e]&&0<b[e].length)return!0;this.die()};Xb.prototype.checkPopArray=
function(){if(this.onFreePop.length)for(;!je(this.onFreePop.shift())&&this.onFreePop.length;);};Xb.prototype.die=function(){this.death||(this.death=1,this.status="defeated",dk(),Pc(Wh(u.playerDefeated,this.name),0,5))};Xb.prototype.paypal=function(c){var b=this.resources,e=!1,d=this.k;b[0]<c[0]&&(tg(d,u.gold),e=!0);b[1]<c[1]&&(tg(d,u.wood),e=!0);b[2]<c[2]&&(tg(d,u.food),e=!0);b[3]<c[3]&&(tg(d,u.stone),e=!0);if(e)return e;b[0]-=c[0];b[1]-=c[1];b[2]-=c[2];b[3]-=c[3];Yf(this.k)};Xb.prototype.paypalTest=
function(c){var b=this.resources;return c[0]>b[0]||c[1]>b[1]||c[2]>b[2]||c[3]>b[3]?!1:!0};var tg=function(c,b){c==v.kingdom&&Pc(Wh(u.notEnough,b),0,5)},Yf=function(c){if(c==v.kingdom){var b=C[c].resources;c=b[0];var e=b[1],d=b[2];b=b[3];Infinity==c&&(c="***");Infinity==e&&(e="***");Infinity==d&&(d="***");Infinity==b&&(b="***");Xl.innerHTML=c;Yl.innerHTML=e;Zl.innerHTML=d;$l.innerHTML=b}},Wl={13:1,20:1,21:1,22:1,27:1,32:1,35:1,36:1,43:1,44:1,55:1,56:1,57:1},yb;var ek=[];(function(){var c="",b=new Image;
b.src="data:image/gif;base64,R0lGODlhIQB2AfcAAAAAABAIAAgAABEhACE6ABkbChAQAAgIABAQCO/vlN7epf/6hZSQUv76n721a//rY/XmhnNjECklEP7oecW1Y+7ZeP/rhvvrljEpCCgiB+/Wa97OjP/WSu3YhyEZAIhzLf/WWOnHWv7baL2lVt3Db/vsvUo3BGtSCGhVIdq1SnhjKdy4V62USuvIaPzad/felO/XlzopAGtaMe3Kd/zbiOjMhv/9+JxzGWNKECEZCP/JSuu5Sc6lSMynV4tzPdSyaK2UWjEhADopCNacKWNKGVdCGf/IVuu4VruUSPzJZ7qYU0IqABkQAGdFB2tKEFI6D5tzKMqVN9unSNyrVlRDI/nLd7JwACkZAOaUEDEhCMSMMZRrKYlkJ/u3SJt0M8yYRquDQO66Zu3MlrWcc5haAItSAf+lGUIqCGNCEJdjGXpTGJxrIfisOGtKGcSNOtacQruHOfu6VsiYVOm6dPvLh/rZqTohAHdHB3NKEFo6D0kxEJRjIc6MMalzKYRaIZxrKXlTIuCcP6x5M+umR1I6GX5aKdacSuqqVdedUollNK2HVUopAFQxBXtKEGtCEMmBJ7h2J3NKGdeNNMOCMWNBGZRjKf2rR86MOtaUQpdpMt6cSrqFQkk0GnVWL9OjZolVGeeQLJ5jIKdqJ4xaIeCTObd6NembRt6UQsWEPGlHIf+tUsuMQ9aUSppyRzEZAGU1BkopCHNCEDohCFIxECkZCPeXM3tKGdKDMIRSIZxjKlo6Gc6EOoxaKahwNt6USjUkE/zLmUIgACEQAIZLEtZ2H5ZUF2Y6ELlpIN9/KGtBGUUpEHVKIRkQCNaMRntCEHNCGZdZI86MUjoZAFQoBs5qIF0xECUZEE8hAHQ0CIQ9C5RHD65TFb5cGXY6EDEZCHtCGYRKIVIxGSkQAEohCEIfCVIpEKJEEUUpGWgnBzoZCEIzKzEQABkIAHMpCIw0CyEQCFsZAlEZBikQCDQZECEHAD4PATEQCGshEDEIAPNGKRkAABAAABkICBAICAgICP///yH5BAEAAP8ALAAAAAAhAHYBAAj/AP8JHEiwIEEBBhMqXPiP3QGEAwVAZKgQYoBwLAIMpIUCwESKE5lI/CeA0woU+wTSIvHk40IBD/9x+vHrnYB9+358EbdPwDsavfi5NMiEChcA/5i0QIKrzTsANeQoC+DzAhJvKYcK3AeoAheqAlbo0XNGlpIKR5axEyChwwo/U7UK+EWiAxRdgH5RGnWpD6ArwpCUWlaES40WX0pRompQwIcXLbR8ObKi1BdUcXatMsZuFCUuUtxKidLr11ABT5Ag+tIHjK5MYb5UilPqlK0rVwKkmiJFyyVBpgsyCRCAEpIvyubJC4CkCq9Rh3JhqiRSAJQvcPgIUgaTIIofMvL8/5hCKwfEHmEiDcq0CtosdklHjeoDaSpSgQKoWGjRowMYWh4JlEgYm4wyhR+buaKLAEwoQ4gfs9CikUBM/OBWCytEAuBESIThhyZbVGILOU+QJEAOhFBCyy/44QDDDFKsgJwwqRA0oBejiBJJMmecYSIAOSxjjzf4jeLCFNi9ocxugAyk3hSVhIILGmd4U6KJ77yTAzu/cMIOZXBQ4gcsRXyRhB4CPXEJHT2U4kUyeggzS0QCABAAHD0koUIP/HkjzwH/+ODCFz7qUQoNM3zBVB5X+GjQLGBQtkIHSTxDXAB5wGFBGEUUcUsVF8SWSzJZyJLQTZUc0cIMK7ghhAAZ/P9DySAWuBCHKYdcMMMUgkQSZxGnyiPFF27wIAUX9hgQQBu4DOKCrVLQUMURboySBxNonurFCmn4UYoWfsiT0l6TDBLHIWGEgeQfaAQhREXhrADHLLrgIsgswgiURySiuCEFK4dg4oYoz5yhlUDiRCEFJfZk0UYeNgkkizGfiCJKKajAkYstswTQpEKzVsIOO+Rk4Y1IAglzRh7OQFOKIKF8wmgWClHVhyRFBOARLbRMxI4wsDgSSh99jJKMLKfNxY4abgiii851fiQAO64Yc4woebiCckE5qFCFEnB8IcUWv2zdmDDDSCMRg40RIkgILVAmxRPvTJjQPuwA4FG+pzL/w8UkYGCXzC8BJkSVnSBloYssnMxSsgEHU2RQFjoH4I0wkUuuEAB4Z655RZ8rVAIgzIQeehx0RMKE6Z9XkcQspbNOESZ0xAG77BQFAoztseOukO6WlNO77waZUocls+RAvEKHHJ/88gk1X4sxtEBvUBh1sGGM8tYTNIgNtXzC/T9kVA99IOA/f0cJtYxPPB82gHLHP03QYAU93fOBzDE5bGLKK90byB1I4Q3zdS8PjGhCCaxgQOjdwQZWMAMtzIAFmlmPBmzIAiX+8YohlKEM81teGXg2kDLYgAZkCOBAmlCLWtxHhf/4IAxnSMMa2vCGOMyhDnfIwx768B82QEMN/2dgg3fN0BNhsAERZtgKRMDABsaYISvCAIMSPINIAczEEeRQhxK8woLWe8UOLrGCElzAFukIIB+O8IgpXGAOr0hHH6yXiyQkRgwwSMIdvGGx5anBCFNYhSjmMIcj3MAbgIDE8jQRBkQIYg3j2YEUZBELLRAPCUk4hBy4kAs5wEFh8nDEG6KAuyZkcgpwaEQvFCGIK3jjDIx4xA5wd4QjBPITjviDMITBjiysCAMvDF0f4iCFUkBDDx6QhTVmIY/CyY4eSZACKi5BjgA0QgtbkEUDZReFHexAHOKoRAPC0IZXLm8ZIBCHzvTgiVKlwhrLO4cx9oEUAGSAFnKYAhf6of9CABxAEDtIhCxMAMMA7OEMPSiGGmDIiDF0AAnQgOEBQFEDRgSzeyYoBqZ+yNGOevSjIA2pSAVygic0gXVLkFwT3BGPeIQOHYx4wkUL0gRzcCMe2KiH5tCBDnfo7R/kUIg79hcPdLhUcuiwqUvrwQiDtJQatQiEOdxBAKQO9RgR6GlCpsENZOgAGdxoRzAo8tSoTpUA7RhIPYo6VB3ooAuSaCpFuOpVsLZDrsFohzt4So0u6MAIICjGWBligra+Na7uYEQw3OGOf5iAG2z46wOksA10UAQdff1rYBlbD3MU4x/40EYtACuCB1SWIo+NrBEmy9MMcIMa7sAHPh6hAxD/GIEDoOAGNggrWtKaFh3C2AYoGCvbY7CBDaAgRjF2S9ha1Pa2oMgGPhhRC9hqY6/aSC4xZMHchZgAG9g4bnKLEQ/hgsIc1KCGOeqhjW6wFJwUwYY7skuM7b5iG1A9BlSJgQ5yoMMY2CiA5kyAjm24Nx5LcAc12BAIZBx3G8HARgbEEVTJYWMc4/gvNmiBDmKAQge1YEMXkGEOciDucxgex4QZUY/6dsEIx60FMnA3DmwwIwCMYIQ5zEGMOOiADSGuMOsC8F1s5HjHo+1CLUABCuIFYLc7tikpunAL4Q4Deozdhja2wQ1zwOMRw7gy8eABj20Uoxxchgc5lKGM5cGj/7NnCEA3wgqAJaQUeu2gypPRUY9pbMN6AchCBhAQjAybo3tkzkA83lEAIXcvB9gQRwGkMdJKW/rSBlHGDFhHAxZRJAdV2PTnfhCGbSbkHZqgQRg0hwgXaMLTDBEGL1ywK4qsIgxJyISpDSKMZEBCD0VIxEIooQxvbCMZuy6IN6YSgGQPJAuY24ezB+IndsDCCFFUSB6mAIt3sAOLmnsGJXRBhSIAQhB9EIUXEkGIZETI0Zr7hS5IMYELXKABF6hAC5JwhC+0wZes08UXBpEEC1igAQ2oVRICAYdKKAPeklvGwI0wgYM3YAJJiMMb4MALPUw7Ictwg7lEgHFTTCEJYf9wQy9SUZOA/yEQcQDBD/KRD3f4AA598MMTaPEO1inDW4OwRCvu4Y56qAMQe2iDMnIgD9Z5IxJ9MIUlOsGJeajj6J/QxS+Y8XGD0IISezhFF7rwB3VQAQqTiESEEADuz3ljFkDvgghEYIRBKGbpzADj52ThsJfL3QVGOAIXnpAFZuRddjl4Ai5IYQkjiICYfvA4M3ouO1n8IhKCGIQRkmCJLwBi6c32nTcI0Qdz1V0QRaBc1xkiC13AwQinJwQz2o67TCjDGKUwRR+MUQ0JWO8Qn3+HhNjxiVNA7xBfqIaQx5EHTKyCeGCYAiXSSJB08IIUgsBdKwyBC9oLRBm5sLv/7MCQiDYrJBWtyASm189+9tvBDq4QBwyfMApW9CEZ7EhJ98Cwik3EYRKrYFHdkwhV8AW4kASiYAqRMDLWIwc0gAu2cAi4oAm84DmjVgV5IIHNMApnMFOy4zWbAAiH8AyowAj0MCfQowRzEAmHUAi84AhXQFCycyUCUgWZgAu5gAbGcAWuIDtEcAjAIhDJcAg/wAuVoAbV4ArsIIOh8wRy4AJBIBBnsAoX8AOb4AXGEAz7YCqs4wMQgAhX8A9nUAoXQANToARqwAhUIzsmsAoJEAZjsQs00AAFWAnGsEu4kwdxkAATcASkEAYNoGqCEAvBIADZYjqUoAaHAAEYlyuq/2aAsCAAjsI6eTAKbnAIKFcFVRAGhvAHeSAMYYg7JuAIorAKU4AIYcAKXyAKO+iBnyMOjKAGfyAKvVAKm5ALjhAMAPAxuLMP0jANxjAMgiAI0OAIsPAzy+MRrjANwwAN0MB74uCKoaM3+jANxVAMdrAW0mg6nPMK9KA3zgQ9HgGOdmM94LiN7ZeO6riO7HhpvdALgJAKNdI9QFAKq7AKqggGhQBrvvMDM2AKvsAK94gKm5AJ50A8PwADdBAGAMkKqECQmyAInOA7JFACM3AIhzAIlXBurLAJBTmRsvMDJVADh7ADEPACiZAKuXePnYA7P2ADdRAGgzAHNqAA35AKnP+QCJ1ABbjDRSUQBhipATZwBLkAADc2ALgDBh1AA3FzBKkQAhuwCalQjrKDCPl2BILgD9TQC60QDa0gYL6TCj/QAodwDgDACZsADK3ADAiwPKmQCVQQO5nQCe/Qb9XglsFEBb9QBz8gCLYAQ79ABXy5ChukQr/QCTDgCaUQDoBJBWLgCZkAkgH0C4nwmJnAmIbZCmIgB51AldDzC62gCOqQAZ65PL/wCwdAHDN0Ke3Ymq75mrAZm7ApmbhDmwSRCqdQmOFgfp9DCKigC5kGCKUADsogAnCFmQwRB3GgBxeDC6aWBctwBtzwAA1gCZFAEV0wAQ1wDNWQDJRnEAeQBZD/YAkuUJ28aRCWUHGWgAzCoHeZJgi7kJ4NcAsKUQsNIAKmIAmiAJwMkQOUwC+3cAQQkAwGkQsL0AWQMArQoCGSkwM8MwvVMAu+QhCzoAbdMA16oE3uwzq4EAeqcJ7W06ElIALQAKLLE4E0cAvpUJq+MwtWMw4BsDoq9A4ZyqIU8XV/UAqScJ9GwIsDMQopQAKBMAkv0waHyDX+VApJUAITEAi8gJwDoQzHcAQlQAeDwAVTYaL/ACBMcABwMAinIApQShCyAAldkACJEAAHACQJoQx/gAzKcABuUApaOhDGIAnHAADdoA0kVBCzIAmWwAbcAADLkAx1+n1/wAS/wAeg/0ANBaEMcKAKpoAJnZAFAKAHhzoQyaAzlPAFpkAKkGBBunEJojALT2GUR6oQlKM3utALl0CnysMMB7AM5sMzY7oQv2A+DqML72B+zMCPxMMJB7B6slmsxnqsyNqO+0AfvoMOxcANxIAMknALx9AHoHgEgzAIxxA6jNAIj0AKRxCI0hIGkjAM7JAG5UmHpvA5mNMIXeAGaeAIS3AF4tAEWfMIoGAEFjcDbyA5IoEbxMEOTMAEAssEwuAEofAIjyAJSfAsUyA5+ReF//AJgjAJdwaKrrAIefAKd3AHogAH/fo5dyAGJWAJ1BAD/yAM4mAHMWAHgLFLBksRFisQV0ADSf8wCKGwCLgzCW/AB4GABsPxD3aQbq/wCnbwOVwABsYyAzRgK4MQBIUDGOIgo/8AB1uABqJAgwQhDksjBWFQBS5QBVGAOaIACYvwBGcQA4wgCF57CHFACqJwZwkBAMGwDccACX2xD0EgCpJgBC5gAWVYBdIyGsVAD/LHEPtwDdjwCX2wFsWQBpCgsNN6CZOQBp8QC9JwBVTLEAHADoygM0zgCuswDdfAU9LQE5wTDD34OewQAK6gfzPEN8k6u7Rbu7Z7u7ibu5rTB+LAhSr0LNPAN4VgqbuoBJ+FOyKwAq9gCAYXBqUwAxVAAz8wDdhwvKxTDCFgAUlwb67TAmEwA47/kA2LKzsNsABJAHtx0AWB0AMkQAl5EwvOwDoJB3tG0AWDQApTAAaYQxw/FTrl6wIZ1wWgQAqIsARrozcWWBAAbARxMAiSgAibsL/nKDthgK2kgAmIYAwSoY11gjtTsAluoAmlQBX0cAYqEBO+AwdKoASMIBH0Cgap4AqhiDtKoAiuQBUHgAcqsAAO0AEMQDxMIA514hEBIAwU8ASfcAUJ/DlXUAFPYLfXsBYBdAbbUAWmEAoC2D2u8AoAPAmfIMXdIwClUAWaAA0trEKycAhVAAmOgDkBZAe4EAY/8AmRqEJnAAdzIAiOcMMqxAhfMAqzQDl2nMRqaqO4kxtLrLuK/7zIjBxSsLAIROIEgMkCUqAOUDANAbQFH8ACK+ACbfAJAqEGLLBQvpMBbbACK9AFXOAov7ADR+s7A5ACPAACg2ALRiQNtHANy+MNn5AMsMAEJ2UQetAGbcAIsAAFn0MLJsAOdiBXBgEASAAIPdAK5ODMC+EIjjANWSACSDEWZSEQX0ACYcADK2AIMkIR2VAEKwA0D8AEe9EXfyEMAGAMSRACIdArM7wQAXAEI8AFM9AGXnAZmbEZ7JC8UoAEUfAJqWo4gGABSqABI6AHmyAbtGEbuNEHe4AHdWYQd2DCjKAJLoAEIr0CUiAFhFAERQgd0kEd7CAPApBsDDABLSAA5P/gLCtAGVPwB0TgA+mxHu3xHuxwDbsGAJsQAl2gN8swCFMgKVJgDHpAIAaCIMagIAshDVzQBVpwAFywADCCylOQCZSgB53gISAiIiTCEOGgN1CgBUUbBVGgDFygBt7wDlwQBjiiIzwyiQnxCgLACK7gCrvIBYSwCUXwBHP9JFEyJVWitQzRD81w0mYyFkygJmziJnAiJ5rzCrLwDD4hKIQyD4aCKIqCC4yi1wvxCvQkDrSQKZvSKZ8SKl8wKqXCOgbgDbNSK7eSK7vSK7/CED4ABipQEMziLNAiLdRiLdiyEMxwBF1gouRiLuiiLl/ALu6yENOQCG0ACwmxL/3yLwFJMzAFkzmguBATUzEXkzEb0zE+yjoqwzIuAzMycwXuyTo/EzRDUzRHk8gVQTVWgzVao98vgTZqIxGbuzx4g8CyC2h1YsiN/DkBAQA7";
var e=document.createElement("canvas"),d=e.getContext("2d");b.onload=function(){e.width=33;e.height=34;for(var f=0;11>f;f++)d.drawImage(b,0,34*f,33,34,0,0,33,34),ek[f]=e.toDataURL("image/png"),c+=".ncursor"+f+"{cursor:url('"+ek[f]+"'), default}",d.clearRect(0,0,33,34);document.getElementsByTagName("style")[0].innerHTML=c};Rc(2)})();var Ge=function(c,b){r(c).style.display="block";Ge.actived=c;b.actual="potion";b.id=0;b.amount=100;b.func()};Ge.actived="";var ja={potion:{bak:1,max:4,ord:["level","mana",
"attack","defence"]},sword:{bak:5,max:3,ord:["attack","attackBow","defence"]},book:{bak:8,max:18,ord:"fireRain lightning healing createCarpet createBat bless freeze confusion invisibility createGolem magicVision raiseDead turnToStone whirlpool createDragon flameBolt teach createJinn".split(" ")}};r("mgbook").onclick=function(){ja.actual="book";ja.id=0;ja.amount=d[ja.book.ord[ja.id]].obj.spcost[0];ja.func()};r("mgpotion").onclick=function(){ja.actual="potion";ja.id=0;ja.amount=100;ja.func()};r("mgsword").onclick=
function(){ja.actual="sword";ja.id=0;ja.amount=100;ja.func()};r("mgdecline").onclick=function(){r("magicworkshopmenu").style.display="none"};r("mgitem").onmousedown=function(c){var b=1;c.button&&(b*=-1);c=ja[ja.actual].max;0>ja.id+b&&(ja.id=c);ja.id=(ja.id+b)%c;"book"==ja.actual&&(ja.amount=d[ja.book.ord[ja.id]].obj.spcost[0]);ja.func()};r("mgaccept").onclick=function(){I(Xh,[ja.actual,ja.id,parseInt(r("mgamount").innerHTML)],K[0])};var Xh=function(c,b){b=z[b];var e=c[2],d=[e,0,0,0];yb.paypal(d)||
(e=~~(250*e),"book"==c[0]&&(e*=2),b.setupINTV(fk,[c,b.id],e),b.lcost=d,b.techStart=b.c-p.cycle,ba(b.id)&&(r("magicworkshopmenu").style.display="none"))},am={defence:6,mana:0,level:2,health:1,attack:5},bm={attack:"sword",attackBow:"bow",defence:"shield"},cm={attack:.5,mana:1,defence:.5,level:.2},fk=function(c){var b=z[c[1]],e=c[0][0],f=ja[e].ord[c[0][1]];c=c[0][2];b.lcost=void 0;"sword"==e&&(e=bm[f]);"attackBow"==f&&(f="attack");e=Object.assign({},gc[e]);if(e.potion)e.d=am[f],e[f]=~~(c*cm[f]);else if(e.book){var g=
d[f],h=g.obj;e.spell=f;e.attack=~~(c/h.spcost[0]);e.name=h.name;e.iconID=g.iconIDbook}else e[f]=~~(.25*c),250<e[f]&&(e[f]=250);J(e);ke(52,b,!0,e);b.techStart=void 0;ba(b.id)};r("mgamount").onmousedown=function(c){var b=10;"book"==ja.actual&&(b=d[ja.book.ord[ja.id]].obj.spcost[0]);var e=b;c.button&&(b*=-1);$a.shift&&(b*=5);ja.amount+=b;0>=ja.amount&&(ja.amount=e);r("mgamount").innerHTML=ja.amount};ja.func=function(){r("mgitem").style.backgroundPositionY=-48*(ja.id+ja[ja.actual].bak)+"px";r("mgamount").innerHTML=
ja.amount};var ug=[0,0,0,0,0,0,0,0],Jb,vd,Wa=[document.getElementById("order1"),document.getElementById("order2"),document.getElementById("order3"),document.getElementById("order4"),document.getElementById("order5"),document.getElementById("order6"),document.getElementById("order7"),document.getElementById("order8")],gk=document.getElementById("bottominfo"),He=Wa[0],Ie=Wa[1],Je=Wa[2],Ke=Wa[3],Le=Wa[4],Me=Wa[5],Ne=Wa[6],Oe=Wa[7];He.addEventListener("mousedown",function(){He.style.transform="translate(2px,2px)"});
Ie.addEventListener("mousedown",function(){Ie.style.transform="translate(2px,2px)"});Je.addEventListener("mousedown",function(){Je.style.transform="translate(2px,2px)"});Ke.addEventListener("mousedown",function(){Ke.style.transform="translate(2px,2px)"});Le.addEventListener("mousedown",function(){Le.style.transform="translate(2px,2px)"});Me.addEventListener("mousedown",function(){Me.style.transform="translate(2px,2px)"});Ne.addEventListener("mousedown",function(){Ne.style.transform="translate(2px,2px)"});
Oe.addEventListener("mousedown",function(){Oe.style.transform="translate(2px,2px)"});He.addEventListener("mouseup",function(c){Jb=c.button;wa(0)});Ie.addEventListener("mouseup",function(c){Jb=c.button;wa(1)});Je.addEventListener("mouseup",function(c){Jb=c.button;wa(2)});Ke.addEventListener("mouseup",function(c){Jb=c.button;wa(3)});Le.addEventListener("mouseup",function(c){Jb=c.button;wa(4)});Me.addEventListener("mouseup",function(c){Jb=c.button;wa(5)});Ne.addEventListener("mouseup",function(c){Jb=
c.button;wa(6)});Oe.addEventListener("mouseup",function(c){Jb=c.button;wa(7)});document.getElementById("stock").addEventListener("click",function(c){(c=z[K[0]])&&hk(c)});var hk=function(c,b){if(0==Q.stockActive||b){if(b=c.inventory,b.length){var e=[];e.length=b.length;for(var d=0,g=b.length;d<g;e[d]=z[b[d++]]);pa(e,c,1)}}else pa(c.icons,c)};(function(){for(var c={},b=0,e=Wa.length;b<e;c={l:c.l},b++)c.l=b,Wa[b].addEventListener("mouseenter",function(b){return function(){var c=Q.displayed[b.l],e=z[K[0]];
if(e&&e.kingdom)var d=C[e.kingdom];if(c&&(void 0!==c.unit?(e=x[c.unit],e={name:e.name,cost:xj(e.cost,c.hero||c.merc,d.values.fameTech)}):e=c.obj,Q.stockActive&&hd(Q.active[b.l].id,1,1),e&&e.name)){var f=e.name,k="<span>";k=2==f.length?k+(f[0]+" - "+f[1]):k+f;if(f=e.cost){!e.tech&&d.mod[e.type]&&d.mod[e.type].cost&&(f=d.mod[e.type].cost);k+=" - (";for(var m=0;5>m;m++)f[m]&&(k+=f[m]+"<img class='resource' src='"+dm[m]+"' /> ");k=k.substring(0,k.length-1);k+=")"}k+="</span>";if(K.length){d=C[z[K[0]].kingdom];
if(d.technology.disabled[c.id]){f="<span class='red'>"+u.requires+": ";m=Ja[d.k];var p=d.technology.investigated,r="",w=c.requireObj;if(w)for(var v=0,y=w.length;v<y;v++)d=w[v],d.tech?p[d.nu.id]||(r+=d.name[0]+", "):m[d.type].length||(r+=d.name+", ");r.length&&(r=r.substr(0,r.length-2));k+=f+r+"</span>"}e.type==Cb&&(k+="<span class='increase'>+"+e.increase+"</span>");(e=Q.active.cut)&&e[c.objName]&&(k+="<span class='shotcut'>"+e[c.objName].toLocaleUpperCase()+"</span>");gk.innerHTML=k}}}}(c)),Wa[b].addEventListener("mouseout",
function(){Q.stockActive&&hd(K[0],1,1);gk.innerHTML=""})})();var Yh=function(){history.pushState("",document.title,window.location.pathname)},Za=function(){p.online=0;location.hash="";r("MatchX").style.display="none";document.getElementById("index").style.display="block";document.getElementById("returnmenu").style.display="none";document.getElementById("game").style.display="none";document.getElementById("gameFinish").style.display="none";setTimeout(Yh,200)},wa=function(c){var b=ug[c];wa.lastFunc=
b;wa.nu=c;if(Q.stockActive){b=z[K[0]];var e=z[b.inventory[c]];e&&(e.potion?$a.control?I(Hd,b.id,[b.id,e.id]):(U=Hd,U.item=e.id):e.spell?$a.control&&b.mana?I(Rh,b.id,e.id):(d[e.spell](),U.item=e.id):(I(Dd,b.id,[e.id]),ba(b.id)))}else b&&b();wa.lastFunc=void 0;wa.nu=void 0;Wa[c].style.transform=""},pl=function(c){var b=[.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.27,.3,1,.5,.5,.5,1,.62,.62,.62,1,.74,.74,.74,1,.3+.58,.3+.58,.3+.58,1,.94,.94,.94,1,1,1,1,1,1.06,1.06,1.06,1,.3+.82,.3+
.82,.3+.82,1,1.08,1.08,1.08,1,1.04,1.04,1.04,1,1,1,1,1,.95,.95,.95,1,.3+.58,.8,.7,1,.3+.54,.72,.6,1,.7,.62,.5,1,.6,.55,.3+.15,1,.5,.44,.42,1,.4,.37,.35,1],e=new Date;null!=c&&(e=c);c=e.getMinutes()/60;e=e.getHours();document.getElementById("daynighticon").style.backgroundPosition="0 -"+36*e+"px";var d=[b[4*e],b[4*e+1],b[4*e+2],b[4*e+3]];e=(e+1)%24*4;d[0]+=(-d[0]+b[e])*c;d[1]+=(-d[1]+b[e+1])*c;d[2]+=(-d[2]+b[e+2])*c;d[3]+=(-d[3]+b[e+3])*c;return d},ub=0,Ta=0,id=0,jd=0,wd=function(c,b){var e=tzar.width,
d=tzar.height,g=v.mx/32;c/=32;b/=32;var h=da*e*.03125,l=da*d*.03125,q=.03125*e,k=.03125*d,m=c+.5*(q-h),p=b+.5*(k-l);0>m?c=.5*-(q-h):m+h-g*da>G&&(c=G-h-.5*(q-h)+g*da);0>p?b=.5*-(k-l):p+l>Da&&(b=Da-l-.5*(k-l));h-v.mx>G&&(da=G/(.03125*e),J(da));l>Da&&(da=Da/(.03125*d),J(da));ub=32*-c;Ta=32*-b},Zc=document.getElementById("minimap"),vg=function(c){var b=c.pageX-parseInt(Zc.style.left);c=c.pageY-parseInt(Zc.style.top);var e=tzar.height*Lb/(32*Da);b=~~(.5+(b-tzar.width*Vb/(32*G)*.5)*G/Vb);c=~~(.5+(c-.5*
e)*Da/Lb);wd(32*b,32*c);0==vd&&document.removeEventListener("mousemove",vg)};Zc.addEventListener("mousedown",function(c){var b=c.pageX-4,e=c.pageY-31;0==c.button?(document.addEventListener("mouseup",function h(b){document.removeEventListener("mouseup",h);document.removeEventListener("mousemove",vg)}),vd=!0,vg(c),document.addEventListener("mousemove",vg)):2==c.button&&(b=~~(G*(c.pageX-4)/Vb),e=~~(Da*(c.pageY-31)/Lb),I(Oa,b+e*G,K))});var $a={control:0,shift:0,esc:0},Aa=function(c,b){c&&!p.editor&&(c=
Q.active,b=em[b],c&&c.cut&&(b=d[c.cut[b]]))&&(c=yb.technology,Jb=0,c.disabled[b.id]||c.hidden[b.id]||(wa.lastFunc=b,b(),wa.lastFunc=void 0))},Kb={37:function(c){id=c},40:function(c){jd=-c},39:function(c){id=-c},38:function(c){jd=c},32:function(c){bk=c?Ul:function(){}},46:function(c){c||I(Pe,$a.shift,K.slice(0))},16:function(c){$a.shift=c},17:function(c){$a.control=c},27:function(c){$a.esc=c},13:function(c){c&&!p.editor&&("displaynone"==Zh.className?(Zh.className="displayblock",$h.focus(),Kb.blocked=
13):(ai(),Zh.className="displaynone",Kb.blocked=null))},19:function(c){c||p.online||$b(1)},48:function(c){c&&$a.control&&(da=1,Pg({deltaY:0}))},176:function(c){c&&(p.deltaTime+=3E4)},65:Aa,66:Aa,67:Aa,68:Aa,69:Aa,70:Aa,71:Aa,72:Aa,73:Aa,74:Aa,75:Aa,76:Aa,77:Aa,78:Aa,79:Aa,80:Aa,81:Aa,82:Aa,83:Aa,84:Aa,85:Aa,86:Aa,87:Aa,88:Aa,89:Aa,90:Aa,219:function(c){c&&ik(-1)},221:function(c){c&&ik(1)}},em={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",
80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};Kb.blocked=null;(function(){for(var c=[65,37,40,83,39,68,38,87],b=c.length=0,e=c.length;b<e;b+=2)Kb[c[b]]=Kb[c[b+1]]})();document.oncontextmenu=function(){return!1};var kc=document.getElementById("attackmenu"),kd=document.getElementById("defencemenu"),ld=document.getElementById("levelmenu"),Id=document.getElementById("kingdom"),jb=document.getElementById("progressone"),wg=document.getElementById("unitname"),Sc=document.getElementById("progressvalue");
document.getElementById("selectedobject");var Pe=function(c,b){if(b.length){c=c||p.editor?b.length:1;for(var e=0;e<c;e++)z[b[e]].die()}},Va=function(c,b){c.sound&&!b&&(b=c.sound,va(b[~~(b.length*Math.random())]));ld.style.display="none";Qe.style.display="none";Id.style.display="block";jb.style.display="block";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";kd.style.display="none";wg.innerHTML=c.name;Re(c);Id.innerHTML=C[c.kingdom].name;c.attack?(kc.style.display=
"block",kc.innerHTML=c.attack):kc.style.display="none";b=c.health;var e=c.maxHealth;Infinity==b?(jb.value=100,jb.max=100,Sc.innerHTML=b):jb.value=b;Infinity==e&&Infinity!=b?(jb.max=100,jb.value=1):Infinity!==e&&(jb.max=e);c.inventory&&c.inventory.length&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=c.inventory.length);Sc.innerHTML=~~b+"/"+e;if(!Bc(c,v))return pa([]);c.point&&(b=c.point,qb.x32=b[0],qb.y32=b[1],pb(qb,96*(Da-1)),qb.show=1);if(!1===
c.built)pa([d.stopBuilding]),Re(c);else if(c.techStart)pa([d.stopTech]),Re(c),manamenu.style.display="block",manamenu.style.backgroundPosition="0px -200px",manamenu.innerHTML=100-~~(100*(c.c-p.cycle)/c.techStart)+"%",Va.intv&&clearInterval(Va.intv),Va.intv=setInterval(function(){K[0]==c.id?manamenu.innerHTML=100-~~(100*(c.c-p.cycle)/c.techStart)+"%":clearInterval(Va.intv)},400);else{nl();if(c.working){e=c.work;var f=Q.page*Q.length;b=0;for(var g=Q.length;b<g;b++){var h=e[b+f];Wa[b].innerHTML=h?h:
""}manamenu.style.display="block";manamenu.style.backgroundPosition="0px -200px";var l=1E3*x[c.waitlist[0]].time;b=~~(100*(p.now()-c.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%";Va.intv&&clearInterval(Va.intv);Va.intv=setInterval(function(){if(K[0]==c.id&&c.working){var b=~~(100*(p.now()-c.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%"}else clearInterval(Va.intv)},400)}else for(b=0,e=Q.length;b<e;Wa[b++].innerHTML="");pa(c.icons,c)}};Va.intv=!1;var Se=function(){kc.style.display="none";
kd.style.display="none";ld.style.display="none";jb.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";wg.innerHTML="";kc.innerHTML="";kd.innerHTML="";manamenu.innerHTML="";ld.innerHTML="";Id.innerHTML="";Sc.innerHTML="";jb.value="";Sc.maxLength="";Qe.style.display="none";He.innerHTML="";Ie.innerHTML="";Je.innerHTML="";Ke.innerHTML="";Le.innerHTML="";Me.innerHTML="";Ne.innerHTML="";Oe.innerHTML="";pa([d.origin]);jk()},U,zb,lc,Pg,Cc={},
Bh=function(c,b,e,d){var f=e||z[K[0]],h=d?C[f.kingdom]:yb;if("peon"==(e?f.clss:lc))var l=!0;if(p.editor)return[Pb,q];var q=c+b*G;if(!d&&U!=Pb)return[U,q];c=N[q];b=0;if(!f)return[b,q];if(2<c||(c=md[q])&&2<c){var k=z[c];k.invisible||(l&&k.storage&&f.stock?b=Xf:l&&void 0!=k.res?b=vc:l&&k.health<k.maxHealth&&!h.diplomacy[k.kingdom]&&k.build&&!k.dummy||k.dummy&&!k.built?b=wc:h.diplomacy[k.kingdom]||k.dummy&&h.values.experience||k.confused?b=xc:1===k.invType&&!f.build&&!f.boat&&0<k.invMax&&Bc(f,k)&&(b=
oe))}else c=hb[q],2<c&&!f.build&&!f.boat&&(k=z[c],k.item?b=Cd:k.field&&l?b=Rf:1===k.invType&&!f.build&&!f.boat&&0<k.invMax&&Bc(f,k)&&(b=oe));0===b&&(f=ib[f.kingdom],f[q]&&l?(c=f[q],b=wc):(k||(c=-q),b=Oa,Oa.cursor=2));return[b,c]},K=[];K.change=1;var kk,Xl=document.getElementById("gold"),Yl=document.getElementById("wood"),Zl=document.getElementById("food"),$l=document.getElementById("stone"),X,bi;var ci=!1;var ic=function(c,b){var e=da,d=tzar.width,g=tzar.height;c=c*e-ub+.5*(d-e*d);b=b*e-Ta+.5*(g-
e*g);return[c,b]},Ab=function(c){if(c){var b=c.pageX;c=c.pageY;Ab.lastX=b;Ab.lastY=c}else b=Ab.lastX,c=Ab.lastY;b=ic(b-v.mx,c);c=b[1];b=b[0];0==ci?(window.removeEventListener("mousemove",Ab),bi=!1):bi=!0;if(1===X[2]||Ab.forced)c=32*~~(c/32),b=32*~~(b/32);X[4]=c;X[6]=b;X[9]=b;X[10]=c},di=function(c,b){b=z[b];N[c[0]+c[1]*G]==b.id?(b.point=void 0,K[0]==b.id&&(qb.x32=2*G,pb(qb,128*G),qb.show=0)):(b.point=c,qb.x32=c[0],qb.y32=c[1],K[0]==b.id&&(pb(qb,96*(Da-1)),qb.show=1))};document.onkeydown=function(c){return c.ctrlKey&&
c.shiftKey?!1:{116:1,115:1,123:1}[c.keyCode]?!1:!0};var lk=function(c){if(null==Kb.blocked||Kb.blocked==c.keyCode){var b=Kb[c.keyCode];b&&b(1,c.keyCode)}},mk=function(c){if(null==Kb.blocked||Kb.blocked==c.keyCode){var b=Kb[c.keyCode];b&&b(0,c.keyCode)}},nk=function(c){var b=window.innerWidth,e=window.innerHeight,d=c.pageX,g=c.pageY;if(screen.height-10<=e){if(1.2==Math.abs(id)||0==id)id=1.2*((10>d)-(d>b-10));if(1.2==Math.abs(jd)||0==jd)jd=1.2*((10>g)-(g>e-10))}d=ic(d-v.mx,g);g=~~(.03125*d[1]);d=~~(.03125*
d[0]);c.pageX<v.mx?Rc(2):(c=Bh(d,g)[0],0==c||void 0==c.cursor?Rc(2):Rc(c.cursor))},ok=function(c){if(!Vd)if(c.pageX>v.menumx){if(0==c.button){window.addEventListener("mousemove",Ab);c=ic(c.pageX-v.mx,c.pageY);var b=c[1];c=c[0];void 0!=L.wall&&(c=L.wall,b=32*~~(c/G),c=c%G*32,Ab.forced=!0,L.wall=void 0);ci=!0;X[0]=c;X[1]=b;X[9]=X[0];X[10]=X[1];X[3]=X[0];X[7]=X[1];xg=!1}}else xg=!0},xg=!1,fm=function(c){if(c.pageX>v.menumx&&c.pageY>v.menumy&&!vd&&0==xg){ci=!1;var b=ic(c.pageX-v.mx,c.pageY),e=~~(b[1]/
32);b=~~(b[0]/32);J(b,e);var d=Da;if(2==c.button&&!p.editor){if(U!=Pb){U=Pb;return}if(0<K.length)if(d=z[K[0]],1!=d.build||d.arrow){if(0===U){U=Pb;return}d=Bh(b,e);c=d[1];d=d[0];d==Oa&&(b={x32:b,y32:e,d:0,mv:1,img:m.cursor},mb(b),hc.new(b,eb(b.img)));I(d,c,K)}else I(di,[b,e],K[0]);return!1}if(0==c.button){if(U==Pb)return Pb();c=b+e*d;if(U.spLevel)c=U.spLevel(c);else{var g=0;2<md[c]?g=md[c]:2<N[c]?g=N[c]:2<hb[c]&&(g=hb[c]);c=g}if(c)U.allowPos&&z[c].build&&(c=-(b+e*d));else if(U.allowPos||U.noObj)c=
-(b+e*d);else return U=Pb;U.noObj&&3<=c&&(c=-(b+e*d));U.item?(I(U,c,[K[0],U.item]),U.item=void 0):I(U,c,K);$a.shift||(U=Pb)}}xg=!1},pk=function(c){Vd||(fm(c),Jd.actived&&Jd(),X[0]=NaN,X[1]=NaN,X[9]=NaN,X[10]=NaN,X[3]=NaN,X[7]=NaN,k.bindBuffer(k.ARRAY_BUFFER,Fc),k.bufferSubData(k.ARRAY_BUFFER,0,X),Hb.actived&&Hb(),vd&&(vd=!1))},fi=function(c){c=z[c];c.tempChild.quit(c.selectAnim);Qb(c.selectAnim);ei(c.selectAnim);c.selectAnim=void 0},Pb=function(){for(var c=0,b=K.length;c<b;fi(K[c++]));Ge.actived&&
(r(Ge.actived).style.display="none");zb&&(fi(zb.id),zb=void 0);K.length=0;lc=-1;Cc={};Qe.style.display="none";He.innerHTML="";Ie.innerHTML="";Je.innerHTML="";Ke.innerHTML="";Le.innerHTML="";Me.innerHTML="";Ne.innerHTML="";Oe.innerHTML="";kc.className="";Q.page=0;qb.show&&(qb.x32=2*G,pb(qb,128*G),qb.show=0);var e=G,d=X[0],g=X[1];c=X[9];var h=X[10];if(10>=Math.abs(g-h)&&10>=Math.abs(d-c)){h=~~(d/32);var l=~~(g/32),k=g,m=d,n=0;for(c=0;3>c;c++){b=xb[c];var B=h,u=l;d=m;g=k;2<b[B+u*e]?(d=B,g=u,n=z[b[d+
g*e]]):(.5<=g/32-u?u++:u--,2<b[B+u*e]?(d=B,g=u,n=z[b[d+g*e]]):(.5<=d/32-B?B++:B--,2<b[B+u*e]?(d=B,g=u,n=z[b[d+g*e]]):(u=~~(g/32),2<b[B+u*e]&&(d=B,g=u,n=z[b[d+g*e]]))))}n.id||(n=ib[v.kingdom][h+l*e])&&(n=z[n]);if(n&&2<n.id&&(!n.invisible||Bc(n,v)))if(Cc[n.id]=1,K.length=0,n.setupChild(Db.select,1,tf),Bc(n,v)&&!p.demo){K[0]=n.id;lc=null!=n.defence?n.clss:-2;if(256>Date.now()-kk){if(p.editor){gm(z[K[0]]);return}if(!n.build)for(e=~~(da*tzar.width*.03125),d=~~(da*tzar.height*.03125),h=~~(.03125*-ub+.5*
(~~(.03125*tzar.width)-e)),k=~~(.03125*-Ta+.5*(~~(.03125*tzar.height)-d)),d*=e,h+=k*G,c=0;c<d;c++)for(g=h+c%e+~~(c/e)*G,l=0;3>l;l++)k=xb[l][g],2<k&&(m=z[k],m.clss!=n.clss||Cc[k]||!Bc(m,n)||m.item||(m.setupChild(Db.select,1,tf),Cc[k]=1,K.put(k)))}kk=Date.now();if(n.build)return Va(n)}else return zb=n,hd(n.id),!1}else if(!p.demo)for(d=~~(d/32),c=~~(c/32),g=~~(g/32),h=~~(h/32),d>=c&&(n=d,d=c,c=n),g>=h&&(n=g,g=h,h=n),c++,n=[1,1,1],m=c-d,c=0,b=m*(h-g+1);c<b;c++)for(h=c%m+d,k=~~(c/m)+g,l=0;3>l;l++)if(B=
xb[l][h+k*e],u=z[B])u.selected=1,n[B]||(n[B]=1,u.build||!Bc(u,v)||u.item||(K[K.length]=B,u.setupChild(Db.select,1,tf),Cc[B]=1));1<K.length?gi(K):1==K.length?hd(K[0]):(pa([]),Se(),lc=-1,K.length=0)},qk=[manamenu,manamenu1],rk={mana:{background:"0px -120px",progress:progressmana},food:{background:"0px -240px"},milk:{background:"0px -280px"},gold:{background:"0px -260px"},stone:{background:"0px -320px"},wood:{background:"0px -340px"}},dm=["https://i.imgur.com/toj2Nv3.gif","https://i.imgur.com/TwImKWn.gif",
"https://i.imgur.com/wFIu276.gif","https://i.imgur.com/kIWwIhG.gif","https://i.imgur.com/JBGA2KM.gif"],Qe=document.getElementById("unitSpeed"),hd=function(c,b,e){manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";c=z[c];c.sound&&!e&&(e=c.sound,va(e[~~(e.length*Math.random())]));lc=c.clss;c.inventory&&c.inventory.length&&Bc(c,v)&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=c.inventory.length);b||(Bc(c,
v)&&!p.demo?pa(c.icons,c):hi());Id.style.display="block";wg.innerHTML=c.name;c.attack&&c.item||void 0!==c.attack?(kc.innerHTML=c.attack,kc.style.display="block"):kc.style.display="none";c.defence&&c.item||void 0!==c.defence?(kd.innerHTML=c.defence,kd.style.display="block"):kd.style.display="none";c.mana&&!c.manaTarget&&(manamenu.style.display="block",manamenu.innerHTML=c.mana,manamenu.style.backgroundPosition="0px -120px");b=0;var d=c.update;if(d){b=0;for(var g=d.length;b<g;b+=3){var h=d[b],l=rk[h];
e=qk[b/3];e.innerHTML=c[h];e.style.display="block";e.style.backgroundPosition=l.background;"mana"==h&&c.manaTarget&&(e.innerHTML=~~(100*c.mana/c.manaTarget+.5)+"%",e.style.backgroundPosition="0px -200px");l.progress&&(l.progress.style.display="block",l.progress.value=c[h],l.progress.max=c[h+"Max"])}}c.stock&&(d=c.stock,e=qk[b/3],e.style.display="block",e.style.backgroundPosition=rk[d[4].icon].background,e.innerHTML=d[0]);b=c.level?c.level:0;ld.innerHTML=b;ld.style.display="block";0===b&&(c.item||
c.build)&&(ld.style.display="none");Id.innerHTML=C[c.kingdom].name;jb.style.display="block";sk(c);Re(c)},sk=function(c){var b=c.health;c=c.maxHealth;Infinity==b?(jb.value=100,jb.max=100,Sc.innerHTML=b):(jb.value=b,Infinity==c?(jb.max=100,jb.value=1):jb.max=c,Sc.innerHTML=~~b+"/"+c)},gi=function(c,b){var e=z[c[0]],d=0,g=0,h=e.clss,l=c.length,k={},m=[];m.cut={};for(var n=0;n<l;n++){e=z[c[n]];d+=e.maxHealth;g+=e.health;lc=h!=e.clss?-1:!0;for(var p=e.icons,r=p.length,w=0;w<r;w++){var v=p[w].id;void 0===
k[v]?k[v]=1:k[v]++;if(k[v]===l){if(p.cut){v=p.cut;var x=p[w].objName;v[x]&&(m.cut[x]=v[x],m.cut[v[x]]=x)}m.put(p[w])}}}!0===lc&&(lc=e.clss);g=Infinity==g?100:~~(g/d*100);Sc.innerHTML=g+"/100(%)";tk();wg.innerHTML="";kc.style.display="none";kd.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";ld.style.display="none";Id.innerHTML=l+" "+u.units;jb.style.display="block";jb.value=g;jb.max=100;b||(!0!==lc?pa(m):pa(e.icons))},Li=function(){};
new Float32Array(8);var Ib,td,Fc,Wd,Td,da=1,uk={1:2560,101001:2048,101E3:2048,1001:2048,1E3:2048,100:1536,10010100:1280,10100:1280,1001E4:1280,1E4:1280,10010010:256,10010110:256,10110:256,10111:256,10010111:256,110:512,111:512,11:512,10:512,111E5:2816,11E5:2816,11E6:2816,1E6:2816,1101E4:768,11110100:768,11010100:768,1111E4:768,1E7:3360,1E5:3072,1101E3:1792,1101001:1792,11101E3:1792,11101001:1792,101111:0,1011:0,1111:0,101011:0},hm=function(c){Qb(c);jc.put(c.bufferID)},hc={table:{},dates:[],new:function(c,
b,e){b=Math.floor(b)+p.now();var d=this.table;e||(e=hm);d[b]||(d[b]=[]);c.animFunc=e;d[b].put(c);this.dates.add(b);this.needOrder=!0}},eb=function(c){c=Ca[c];return 0>c[1]?m.delay[c[0]-c[1]-1]:~~(c[0]/c[1]*1E3)},Ga=new Float32Array(12),Ah=function(c){var b=c.id+p.arje+c.x32+c.y32;c.rnd=[4294967295+b,4294967295-b,0]},ii=function(c){c=z[c];c.mlist&&vk(c,!0);c.hlist&&vk(c,!1)},vk=function(c,b){if(b)var e=c.mlist,d=c.mlistID,g=Kd.mercenaries;else e=c.hlist,d=c.hlistID,g=Kd.heroes;e.unshift(g[Bj(c,g.length)]);
b?d.unshift(c.mercID++):d.unshift(c.heroID++);8<e.length&&(e.length=8,d.length=8);Q.active==e&&pa(e);Nb(c,5E4)},ji=function(c){c=z[c];if(!C[c.kingdom].paypal(Dl)){var b=C[c.kingdom],e=16+4*b.crusade.number;b.crusade.number++;32<e&&(e=32);var f=b.crusade.list;f.length=e;for(var g=0;g<e;g++)(f[g]=ke(8,c,1)).deleteFromList=f;va("crusade",c.x32,c.y32);b.technology.disabled[d.createCrusaders.id]=1;ba(c.id)}},Vl=function(c){C[c.kingdom].technology.disabled[d.createCrusaders.id]=0},ud,N=[],hb=[],md=[],oc=
{},xb=[];xb.length=3;var hi=function(){for(var c=Q.displayed.length=0,b=Q.length;c<b;c++){var e=Wa[c];e.className="blocked";e.style.backgroundPosition="48px 96px";ug[c]=Gc}Q.rightButton.className="blocked";Q.leftButton.className="blocked";Q.stock.className="blocked";Q.rightBlocked=1};Q.leftButton.onclick=function(){Q.page&&(Q.page--,pa(Q.active,0,Q.stockActive))};Q.rightButton.onclick=function(){Q.rightBlocked||(Q.page++,pa(Q.active,0,Q.stockActive))};Q.displayed=[];var pa=function(c,b,e){e=!!e;b||
(b=NaN);var d=c.olegal||NaN;if(b.working&&!e)var g=1;Q.active=c;Q.displayed.length=0;var h=yb.technology,l=Q.page,k=Q.length;hi();!1!==e&&b?Q.stockActive=b:!1===e&&(Q.stockActive=!1);pa.actv={};c.length<=l*k&&c.length&&(Q.page--,l--);for(var m=0,n=0,p;m<k;m++){p=c[m+l*k];if(!p)break;var r=Wa[n];if(!e&&(pa.actv[p.id]=1,h.hidden[p.id]||p.obj.tech&&g)){k++;continue}r.style.backgroundPosition=48*e+"px "+(-e||1)*p.iconID*48+"px";e||!h.disabled[p.id]||d[p.id]?(r.className="",ug[n]=p):r.className="blocked";
Q.displayed[n]=p;n++}c[m+l*k]&&(Q.rightButton.className="",Q.rightBlocked=0);0<l&&(Q.leftButton.className="");1===K.length&&(b=z[K[0]]);b.inventory&&0<b.inventory.length&&(Q.stock.className="")};pa.actv={};var Ki,Ba,za,Rg;var k=r("tzar").getContext("webgl2",{antialias:!0,alpha:!1});v.gl=!!k;if(k){var im=k.getExtension("WEBGL_lose_context");k.canvas.addEventListener("webglcontextlost",function(c){setTimeout(function(){im.restoreContext()},2E3);c.preventDefault()},!1);k.canvas.addEventListener("webglcontextrestored",
function(c){J("restored 2")},!1)}var Ji,Sg,Tg,Mi,nf,Mg,Lg,mf,of,Ud,Sd,sd,Ng,Og,Eb=function(){if(p.canceled)return 0;requestAnimationFrame(Eb);var c=Eb.fp1000,b=Eb.delta,e=Eb.now;performance.now();var d=e;Eb.frameCount++;e=p.now();Eb.now=e;b=(b+(e-d))/1E3;Eb.delta=b;yh+=b;xh++;Eb.fp1000=c+b;c=hc.table;d=hc.dates;hc.needOrder&&(d.sort(function(b,c){return b-c}),hc.needOrder=0);for(var g=0;d[g]<=e+17;g++){for(var h=c[d[g]],l=0,q=h.length;l<q;l++){var m=h[l];m.animFunc(m)}delete c[d[g]];g--;d.shift()}if(0!=
id||0!=jd)ub+=id*b*640*da,Ta+=jd*b*640*da,wd(-ub,-Ta),Ab();bk(e);Li();k.uniform1f(Ji,e);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);if(c=Ea.length)k.bindFramebuffer(k.FRAMEBUFFER,fb),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Mi),b=Ea,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.enable(k.BLEND),k.blendEquation(k.MAX),k.blendFunc(k.SRC_COLOR,k.SRC_COLOR),k.bindTexture(k.TEXTURE_2D,Rg),k.drawElements(k.TRIANGLES,c,k.UNSIGNED_INT,0),k.bindTexture(k.TEXTURE_2D,
Lighttexture),k.disable(k.BLEND),k.bindFramebuffer(k.FRAMEBUFFER,null);wk(Sg);d=window.innerWidth;g=window.innerHeight;k.viewport(v.marx,g-Lb-v.mary,Vb,Lb);k.uniform2f(nf,32*G,32*Da);k.uniform2fv(Ud,[0,0]);k.uniform1i(of,1);k.uniform1f(ud,1);wk(Sg);k.viewport(v.mx,0,d,g);performance.now();k.useProgram(za);k.bindVertexArray(Ng);k.uniform1f(Mg,~~((.01*e+.5)%5));k.drawArrays(k.TRIANGLES,0,6);k.viewport(v.marx,g-Lb-v.mary,Vb,Lb);k.uniform1i(mf,1);k.uniform2fv(Sd,[0,0]);k.uniform1f(sd,Vb/32/G);k.drawArrays(k.TRIANGLES,
0,6);k.uniform1i(mf,0);k.uniform2f(Lg,d,g);k.uniform2fv(Sd,[ub,Ta]);k.uniform1f(sd,1/da);k.viewport(v.mx,0,d,g);k.useProgram(Ba);k.bindVertexArray(Og);if(c=ya.length)k.enable(k.BLEND),k.blendEquation(k.FUNC_ADD),k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA),k.bindBuffer(k.ARRAY_BUFFER,Fc),d=tzar.width,g=tzar.height,e=-ub+.5*(d-da*d),b=-Ta+.5*(g-da*g),h=da*(d-v.mx),l=da*g,k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([e,b,24576,e+h,b,24576,e,b+l,24576,e+h,b+l,24576])),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,
Tg),b=ya,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.viewport(v.marx,g-Lb-v.mary,Vb,Lb),k.drawElements(k.TRIANGLES,12,k.UNSIGNED_INT,0),k.uniform1i(of,0),k.uniform2f(nf,d,g),k.uniform2fv(Ud,[ub,Ta]),k.uniform1f(ud,1/da),k.viewport(v.mx,0,d,g),k.bindBuffer(k.ARRAY_BUFFER,Fc),bi&&!ki?k.bufferSubData(k.ARRAY_BUFFER,0,X):k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([NaN,NaN,24576,NaN,4347,24576,5551,NaN,24576,NaN,NaN,24576])),
k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Tg),b=ya,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.drawElements(k.TRIANGLES,c,k.UNSIGNED_INT,0),k.disable(k.BLEND);L.active&&(e=L.x,b=L.y,c=96*G,L.wh?(d=L.wh[0]-Ca[L.img][8],g=L.wh[1]-Ca[L.img][9]):g=d=0,li(e,b,c,d,g,L.bufferID),L.active=!1);Yc.update&&Yc(1)},wk=function(c){var b=fa.length;b&&(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,c),c=fa,c.changed&&(c.typed=new Uint32Array(c),c.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,
c.typed,k.STATIC_DRAW)),k.drawElements(k.TRIANGLES,b,k.UNSIGNED_INT,0))},rd=!1;"use strict";var ha=function(c,b){return c<G&&0<=c&&0<=b&&b<Da?!0:!1};Array.prototype.put=function(c){this[this.length]=c};var Db,Te,gc,mi,nd=function(c,b,e,d){d&&0==nd.cols[d]&&(nd.list.push(d,c),nd.cols[d]=1)};nd.cols={};nd.list=[];var M=function(c){for(var b=Object.keys(c),e=0;e<b.length;e++)c[c[b[e]]]=b[e];return c};window.onerror=nd;var p={},Ca=[],jm=function(c,b,e,d){for(var f=0,h=Object.keys(c),l=0,k=h.length;l<
k;l++){var m=h[l],n=c[m];if(Array.isArray(n)){c[m]=f;n.url=f;m=Ca[f++]=n;var p=n.deltaY?n.deltaY:0;m.id=d/4;for(var r=6,w=m.length;r<w;r+=6){var u=m[r-2],v=m[r-1],x=m[r+2],y=m[r+3];b[d++]=m[r]/e;b[d++]=(p+m[r+1])/e;b[d++]=u;b[d++]=v;b[d++]=(m[r]+x)/e;b[d++]=(m[r+1]+p)/e;b[d++]=u+x;b[d++]=v;b[d++]=m[r]/e;b[d++]=(m[r+1]+y+p)/e;b[d++]=u;b[d++]=v+y;b[d++]=(m[r]+x)/e;b[d++]=(m[r+1]+y+p)/e;b[d++]=u+x;b[d++]=v+y}}else for(var z=Object.keys(n),A=0,C=z.length;A<C;A++)for(m=n[z[A]],m.id=d/4,m.url=f,n[z[A]]=
f,Ca[f++]=m,p=m.deltaY?m.deltaY:0,r=6,w=m.length;r<w;r+=6)u=m[r-2],v=m[r-1],x=m[r+2],y=m[r+3],b[d++]=m[r]/e,b[d++]=(p+m[r+1])/e,b[d++]=u,b[d++]=v,b[d++]=(m[r]+x)/e,b[d++]=(m[r+1]+p)/e,b[d++]=u+x,b[d++]=v,b[d++]=m[r]/e,b[d++]=(m[r+1]+y+p)/e,b[d++]=u,b[d++]=v+y,b[d++]=(m[r]+x)/e,b[d++]=(m[r+1]+y+p)/e,b[d++]=u+x,b[d++]=v+y}return d},P=function(c,b,e,d){var f=0,h=e.length-1,l=e[h];d=ib[d];var k=[],m=0,n=!0;ha(c,b)&&ha(c+l-1,b+h/l-1)||(n=!1);for(var p=G,r=0;r<h;r++){f==l&&(f=0,b++);if(e[r]){var w=c+f+
p*b;d[w]&&(n=!1);if(0<N[w]||Ub[w])n=!1;k[m++]=w}f++}return[k,n]};P.check=function(c,b,e,d,g,h,l){var f=e.length-1;e=e[f];var k=f/e;f=G;l=ib[l];e+=2;--c;--b;k=e*(k+2);for(var m=0;m<k;m++){var p=c+m%e,r=b+~~(m/e),w=p+r*f;if(0<N[w]||Ub[w]||h&&(p>=g&&p<=g+2||r>=d&&r<=d+2)||!ha(p,r)||l[w]||z[hb[w]].field)return!1}return!0};var xk=function(c,b,e){var d=0,g=e.length-1,h=e[g],l=[],k=[],m=0,n=!0;ha(c,b)&&ha(c+h-1,b+g/h-1)||(n=!1);for(var p=0,r=0;r<g;r++){d==h&&(d=0,b++);var w=c+d+G*b;e[r]?(2<N[w]&&(n=!1),
l[m++]=w):(k[p++]=w,2<N[w]&&(n=!1));d++}return[l,n,k]},nh=function(c,b,e){var d=0,g=e.length-1,h=e[g],l=[],k=0,m=!0;ha(c,b)&&ha(c+h-1,b+g/h-1)||(m=!1);for(var n=0;n<g;n++){d==h&&(d=0,b++);var p=c+d+b*G;if(e[n]&&2<N[p]&&1==z[N[p]].build||0<hb[p])m=!1;l[k++]=p;d++}return[l,m]},yg=function(c,b,e){var d=!1,g=0,h=[],l=0,k=e.length-1,m=e[k],n=0,p=!0;ha(c,b)&&ha(c+m-1,b+k/m-1)||(p=!1);for(var r=0;r<k;r++){n==m&&(n=0,b++);if(e[r]){var w=c+n+G*b,u=N[w];2<u&&(p=!1);0<u?g++:d=!0;h[l++]=w}n++}g>.5*(k-1)&&d||
(p=!1);return[h,p]},Ue=function(c,b,e){e=!0;ha(c,b)||(e=!1);1!==hb[c+b*G]&&(e=!1);return[[c+b*G],e]},W=function(c,b,e){e=!0;ha(c,b)||(e=!1);0<N[c+b*G]&&(e=!1);return[[c+b*G],e]},zg=function(c,b,e){e=!0;ha(c,b)||(e=!1);0<md[c+b*G]&&(e=!1);return[[c+b*G],e]},cc=function(c,b,e){e=!0;ha(c,b)||(e=!1);if(0<hb[c+b*G]||2==N[c+b*G]||1==N[c+b*G])e=!1;return[[c+b*G],e]},km=function(c){for(var b=Object.keys(c),e=S.common.length/1048576,d=0,g=b.length;d<g;d++)c[b[d]].deltaY=512*e},L,E,ab,gb,rl=function(){L={img:0,
x32:-1E3,y32:-1E3,rgb:[0,0,0,.5],d:0,active:!1};var c=8,b=9;if(!rd){lm();var e=[d.move,d.attack,d.guard,d.patrol,d.pickUp,d.explore,d.stop,d.stand,d.sameSpeed,d.restoreSpeed];Te={magic_creatures:[58,40,59,5,78,77,60,130,131,132,89,129]};for(var f=Object.keys(Te),g=0,h=f.length;g<h;g++){var l=Te[f[g]],k={};l.obj=k;for(var t=0,n=l.length;t<n;k[l[t++]]=1);}Kd.mercenaries=[d.mercArcher,d.mercFootman,d.mercMaceman,d.mercLongbowman,d.mercPikeman,d.mercKnight,d.mercArcherAsian,d.mercSamurai,d.mercHourseSamurai,
d.mercRonin,d.mercHorseArcher,d.mercChariot,d.mercFootmanArab,d.mercArcherArab,d.mercMacemanArab,d.mercPikemanArab,d.mercCavalry,d.mercEnichar,d.mercJihad];Kd.heroes=[d.mercArcher6,d.mercFootman6,d.mercMaceman6,d.mercLongbowman6,d.mercPikeman6,d.mercKnight6,d.mercArcherAsian6,d.mercSamurai6,d.mercHourseSamurai6,d.mercRonin6,d.mercHorseArcher6,d.mercChariot6,d.mercFootmanArab6,d.mercArcherArab6,d.mercMacemanArab6,d.mercPikemanArab6,d.mercCavalry6,d.mercEnichar6,d.mercJihad6];f=Kd.mercenaries;g=0;for(h=
f.length;g<h;f[g++].merc=9);f=Kd.heroes;g=0;for(h=f.length;g<h;f[g++].hero=1);n=m;n.build2x2[2]=1;n.build3x3[2]=1;n.build4x4[2]=1;n.build5x5[2]=1;n.build6x6[2]=1;n.items1[2]=1;n.build_harbor[2]=1;n.bridge_horz_build[2]=1;n.bridge_vert_build[2]=1;n.fields[0]=9;n.fields[2]=1;n.sexplosion[0]=13;n.sexplosion[1]=25;n.flame_trail[0]=16;n.flame_trail[1]=25;g=0;for(l=n.asian_charriot.idle.length;g<l;g+=6)n.asian_charriot.idle[4+g]-=17;g=0;for(l=n.asian_charriot.attack.length;g<l;g+=6)n.asian_charriot.attack[4+
g]-=17;g=0;for(l=n.asian_charriot.move.length;g<l;g+=6)n.asian_charriot.move[4+g]-=17;g=0;for(l=n.asian_charriot.die.length;g<l;g+=6)n.asian_charriot.die[4+g]-=17;g=0;for(l=n.flame_trail.length;g<l;g+=6)n.flame_trail[4+g]-=32,n.flame_trail[5+g]-=32;g=0;for(l=n.sexplosion.length;g<l;g+=6)n.sexplosion[4+g]-=48,n.sexplosion[5+g]-=48;n.items1[1]=0;n.books[1]=0;n.potions[1]=0;n.troll.attack[1]=14;n.ork.attack[1]=14;n.dwarf.attack[1]=14;n.asian_mage.move[1]=14;n.arab_priest.attack=n.arab_priest.spell;n.asian_mage.spell=
n.asian_mage.castspell;n.asian_mage.attack=n.asian_mage.castspell;n.asian_mage.spell[1]=13;n.arab_horse_archer.move=n.arab_horse.archer;n.arab_jwarrior.attack[1]=14;n.arab_peasant.attack=n.arab_peasant.attack1;n.arab_peasant.tree=n.arab_peasant.wood;n.asian_peasant.attack=n.asian_peasant.attack1;n.asian_peasant.cut=n.asian_peasant.chop;n.asian_peasant.tree=n.asian_peasant.wood;n.asian_peasant.dig[1]=10;n.asian_peasant.dig[0]=11;n.asian_archer.die[1]=14;n.asian_ronin.attack=n.asian_ronin.attack1;g=
0;for(l=n.asian_peasant.dig.length;g<l;g+=6)n.asian_peasant.dig[4+g]-=16,n.asian_peasant.dig[5+g]-=16;g=0;for(l=n.turn_to_stone.length;g<l;g+=6)n.turn_to_stone[4+g]-=56,n.turn_to_stone[5+g]-=64;n.arab_tcguild_c[4]=31;n.arab_tcguild_c[5]=85;n.dragon.idle=n.dragon.move;n.asian_samurai.attack=n.asian_samurai.attack1;n.asian_horsamurai.idle=n.asian_horsamurai.idle1;n.asian_horsarcher.idle=n.asian_horsarcher.idle2;n.asian_priest.attack=n.asian_priest.attack1;n.asian_priest.spell=n.asian_priest.pray;n.asian_monk.attack[1]=
12;n.euro_mage.attack=n.euro_mage.spell;n.euro_ghost.idle=n.euro_ghost.move;n.euro_priest.attack=n.euro_priest.spell;n.arab_mage.spell=n.arab_mage.attack;n.cursor[1]=15;n.star[1]=15;n.select[4]+=3;n.select[5]+=3;n.arab_houses_c[c]=96;n.asia_houses_c[c]=96;n.asia_houses_c[4]-=9;n.asia_houses_c[5]-=15;n.wood_build[2]=1;n.res_gold[2]=1;n.res_gold_s[2]=1;n.res_stone[2]=1;n.res_stone_s[2]=1;n.bridge_horz1[4]=-9;n.bridge_horz1[5]=132;n.bridge_horz1[4]=-9;n.bridge_horz1[5]=132;n.euro_stable_c[4]+=18;n.euro_stable_c[5]-=
10;n.euro_lumbermill_s[4]-=19;n.euro_lumbermill_s[5]-=17;n.wood_tower_c[4]=0;n.wood_tower_c[5]*=1;n.bat.idle=n.bat.move;n.galleon.idle[1]=7;n.galleon.die[1]=8;n.expl_small_water[1]=11;g=0;for(l=n.curse.length;g<l;g+=6)n.curse[5+g]-=48;g=0;for(l=n.impersonate.length;g<l;g+=6)n.impersonate[5+g]-=48;g=0;for(l=n.bless.length;g<l;g+=6)n.bless[5+g]-=48;g=0;for(l=n.euro_barracks_c.length;g<l;g+=6)n.euro_barracks_c[4+g]+=50;g=0;for(l=n.healing.length;g<l;g+=6)n.healing[5+g]-=48;g=0;for(l=n.expl_small_hole.length;g<
l;g+=6)n.expl_small_hole[4+g]-=4,n.expl_small_hole[5+g]-=34;Date.now();f=[d.createKnight,d.createHorseArcher1,d.createHorseArcher2,d.createHorseSamurai,d.createChariot,d.createEnichar,d.createCavalry]}if(Xg){Xg=!1;J("TErrain changed");g=0;for(h=S.xtra.length;g<h;g++){n=S.xtraRes[g].coords;km(n);n.terrain_water[c]=512;n.terrain_water[b]=512;n.terrain_water[6]+=32;n.terrain_water[7]+=32;t=0;for(l=n.terrain_tree.length;t<l;t+=6)n.terrain_tree[4+t]-=32,n.terrain_tree[5+t]-=96;t=0;for(l=n.terrain_tree_s.length;t<
l;t+=6)n.terrain_tree_s[5+t]-=32;n.terrain_tree[2]=1;Object.assign(m,n)}c=S.size;h=new Float32Array(1048576);n=jm(m,h,c,0);S.info=h;S.ids=n/16}if(!rd){gc={sword:{name:"Sword",iconID:16,img:m.items1,d:0,dMax:7,attack:1,type:52,sword:1},bow:{name:"Bow",iconID:4,img:m.items1,d:15,dMax:4,attack:1,type:52,sword:1},shield:{name:"Shield",iconID:1,img:m.items1,d:8,dMax:6,defence:1,type:52,shield:1},potion:{name:"Potion",iconID:11,img:m.potions,d:0,dMax:7,type:52,potion:1},book:{name:"Book",iconID:9,img:m.books,
d:0,dMax:4,type:52,book:1},gold:{name:"Gold",iconID:20,img:m.item_gold,d:0,dMax:0,type:52},stone:{name:"Stone",iconID:22,img:m.item_stone,d:0,dMax:0,type:52},food:{name:"Food",iconID:14,img:m.item_food,d:0,dMax:0,type:52},wood:{name:"Wood",iconID:15,img:m.item_tree,d:0,dMax:0,type:52},iron:{name:"Iron",iconID:21,img:m.item_iron,d:0,dMax:0,type:52}};mi=[gc.sword,gc.potion,gc.book,gc.bow,gc.shield];h=[d.move,d.attack,d.stop,d.stand,d.pickUp,d.explore,d.healing,d.bless];c=[d.attack,d.guard,d.patrol,
d.explore,d.stop,d.stand,d.attackGround,d.steady,d.move];b=[d.buildAcademy,d.buildWorkshop,d.buildWorkshop1,d.buildAcademy1,d.buildWorkshop2,d.buildAcademy2];g=[d.buildMerchands1,d.buildMerchands2,d.buildMerchands];gb={euro:{},asia:{},arab:{},common:{}};x=[{name:"Footman",attack:6,defence:3,health:65,maxHealth:65,img:m.euro_footman.idle,attackSound:Jc,invType:0,invMax:8,validator:W,human:12,iconID:36,time:12,sight:5,url:m.euro_footman,icons:e,cost:[0,0,50,0],attDist:1,spd:50,dieSound:vb,clss:"footman",
size:1,standardFunc:V,radix:0,zLevel:1,strID:"e_footman",race:"euro"},{name:"Pikeman",radix:0,attackSound:Jc,attack:8,defence:4,health:75,maxHealth:75,img:m.euro_pikeman.idle,invType:0,dieSound:vb,invMax:8,validator:W,human:1,iconID:39,time:18,sight:5,url:m.euro_pikeman,icons:e,cost:[40,0,60,0],attDist:1,spd:50,standardFunc:V,clss:"e_pikeman",zLevel:1,size:1,strID:"e_pikeman",nu:d.createPikeman,race:"euro"},{name:"Spy",radix:0,attack:20,defence:0,mana:100,manaMax:100,health:50,maxHealth:50,img:m.euro_spy.idle,
attackSound:["spy%20kill%201","spy%20kill%202","spy%20kill%203"],invType:0,invMax:8,validator:W,human:1,dieSound:vb,iconID:41,time:30,sight:12,url:m.euro_spy,icons:[d.move,d.attack,d.guard,d.patrol,d.pickUp,d.explore,d.stop,d.stand,d.impersonate,d.revealSelf],zLevel:1,cost:[120,0,0,0],attDist:1,spd:50,clss:"spy",standardFunc:V,size:1,update:["mana","manaSpeed",1E3],isSpy:1,strID:"spy",nu:d.createSpy,race:"common"},{name:"Maceman",radix:0,attack:8,defence:0,health:120,maxHealth:120,img:m.euro_maceman.idle,
attackSound:Jc,invType:0,invMax:8,validator:W,human:1,iconID:37,time:14,dieSound:vb,sight:5,zLevel:1,url:m.euro_maceman,icons:e,cost:[0,0,120,0],attDist:1,spd:50,clss:"maceman",standardFunc:V,size:1,strID:"e_maceman",nu:d.createMaceman,race:"euro"},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:m.euro_archer1.idle,invType:0,invMax:8,validator:W,human:1,sight:10,dieSound:vb,arrow:!0,iconID:38,zLevel:1,time:12,url:m.euro_archer1,icons:e,cost:[0,20,40,0],attDist:7,spd:50,clss:"archer",
standardFunc:V,attimg:m.arrow1,attackSound:yd,size:1,strID:"e_archer",nu:d.createArcher,race:"euro"},{radix:0,name:"Wizard",attackSound:gj,dieSound:["mage"],attack:5,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:m.euro_mage.idle,zLevel:1,invType:0,invMax:8,validator:W,human:1,iconID:42,time:30,sight:15,url:m.euro_mage,icons:[d.stop,d.pickUp,d.explore,d.lightning,d.createBat,d.freeze,d.createGolem,d.invisibility,d.stand,d.attack,d.move],cost:[150,0,0,0],attDist:10,attimg:m.flame_bolt,ball:1,
spd:50,clss:"mage",standardFunc:V,size:1,update:["mana","manaSpeed",1E3],strID:"e_mage",nu:d.createMage,race:"euro"},{radix:0,name:"Longbowman",attack:6,defence:2,health:50,maxHealth:50,img:m.euro_longbowman.idle,zLevel:1,invType:0,invMax:8,dieSound:vb,attackSound:yd,arrow:!0,validator:W,race:"euro",human:1,iconID:35,time:18,sight:18,url:m.euro_longbowman,icons:e,cost:[50,0,90,0],attDist:12,spd:50,standardFunc:V,clss:"longbowman",size:1,d2attack:2,strID:"e_longbowman",attimg:m.arrow1,nu:d.createLongbowman},
{radix:0,clss:"tree",name:"Tree",health:100,maxHealth:100,img:m.terrain_tree,invType:0,invMax:8,zLevel:1,mMapcolor:[11,131,11],validator:W,child:[{img:m.terrain_tree_s,rgb:[0,0,0,.5],alpha:1,x:0,y:0}],iconID:23,url:m.terrain_tree,dimgInfinity:m.terrain_tree,dimgRND:3,icons:[],res:1,race:"common",build:!0,size:1,zolotoy:1,strID:"tree"},{radix:0,name:"Crusader",zLevel:1,dieSound:de,attackSound:be,attack:14,defence:8,health:180,maxHealth:180,img:m.crus.idle,invType:0,invMax:8,validator:W,human:1,race:"euro",
iconID:100,time:19,sight:5,url:m.crus,icons:e,cost:[0,0,0,0],attDist:1,spd:85,standardFunc:V,clss:"crusader",size:1,strID:"crusader"},{radix:0,name:"Priest",attack:20,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:m.euro_priest.idle,invType:0,zLevel:1,invMax:8,validator:W,human:1,iconID:40,time:30,ball:1,sight:21,dieSound:vb,url:m.euro_priest,icons:h,attackOnly:Te.magic_creatures.obj,cost:[150,0,0,0],attDist:18,race:"euro",spd:50,standardFunc:V,clss:"priest",size:1,update:["mana","manaSpeed",
1E3],strID:"e_priest",nu:d.createPriest,attimg:m.flame_bolt},{radix:0,name:"Peasant",attackSound:fh,attack:5,defence:0,health:50,maxHealth:50,img:m.euro_peasant.idle,invType:0,invMax:8,dieSound:vb,zLevel:1,validator:W,human:1,race:"euro",iconID:33,time:8,sight:5,url:m.euro_peasant,icons:[d.move,d.menuBuilds,d.repair,d.conquest,d.dcm,d.pickUp,d.explore,d.stop,d.stand,d.attack,d.bribe,d.sameSpeed,d.restoreSpeed],cost:[0,0,50,0],attDist:1,spd:50,clss:"peon",size:1,peon:1,strID:"e_peon",nu:d.createPeon,
nocapture:1},{radix:0,clss:"cathedral",name:"Cathedral",dieSound:O,sound:["e_cathedral1","e_cathedral2"],resistance:700,health:5E3,maxHealth:5E3,img:m.euro_cathedral,invType:0,invMax:8,race:"euro",zLevel:1,validator:P,bimg:m.build5x5,dimg:m.des_5x5,iconID:60,icons:[d.createCrusaders,d.techFanaticism,d.techEspionage,d.techInquisition,d.techHealing,d.techBless,d.techCrusade,d.techMedicine],time:90,sight:8,child:[{img:m.euro_cathedral_c,x:0,y:0},{img:m.euro_cathedral_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],
space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,5]),url:m.euro_cathedral,build:!0,cost:[2E3,0,0,2E3],onbuild:[d.buildChurch],size:1,strID:"cathedral"},{radix:0,name:"Castle",clss:"castle",dieSound:O,sound:["e_castle1"],resistance:700,health:8E3,maxHealth:8E3,img:m.euro_castle,invType:1,invMax:50,race:"euro",zLevel:1,validator:P,bimg:m.build6x6,dimg:m.des_6x6,iconID:59,time:120,sight:12,child:[{img:m.euro_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:m.euro_castle_s,x:0,y:0,rgb:[0,
0,0,.5]}],icons:[d.createPeon,d.createSpy,d.emergeAllUnits,d.techFeudalism,d.techArchitecture,d.techLearning],space:new Uint8Array([0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,7]),menu:Va,url:m.euro_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1,strID:"e_castle"},{radix:0,name:"Wooden Wall",clss:"wall_wood",resistance:700,health:2E3,maxHealth:2E3,img:m.wood_tower,time:6,sight:1,zLevel:1,dieSound:O,validator:W,bimg:m.wood_build,
dimgInfinity:m.wood_debris,iconID:49,icons:[],mx:0,race:"common",my:0,hframe:71,menu:Va,url:m.wood_tower,space:new Uint8Array([1,1]),wall:1,build:!0,cost:[0,0,20,0],size:1,strID:"woodwall",child:[{img:m.wood_tower_c,x:0,y:0}]},{radix:0,name:"Barracks",clss:"barracks",strID:"e_barrack",sound:gh,generator:1,resistance:500,health:1400,maxHealth:1400,img:m.euro_barrack,invType:1,invMax:0,dieSound:O,time:60,sight:6,zLevel:1,race:"euro",validator:P,bimg:m.build5x5,dimg:m.des_5x5,child:[{img:m.euro_barracks_c,
mv:!0},{img:m.euro_barrack_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:57,icons:[d.createFootman,d.createArcher,d.createMaceman,d.createPikeman,d.createLongbowman,d.createKnight],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:m.euro_barrack,build:!0,cost:[0,200,0,200],size:1},{radix:0,strID:"e_lumber",name:"Lumber Mill",sound:["e_lumber1"],clss:"lumber_mill",resistance:500,health:800,maxHealth:800,img:m.euro_lumbermill,invType:1,invMax:0,time:30,race:"euro",sight:4,
dieSound:O,zLevel:1,validator:P,bimg:m.build2x2,dimg:m.des_2x2,iconID:64,child:[{img:m.euro_lumbermill_c,x:0,y:0},{alpha:!0,img:m.euro_lumbermill_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[d.techLongbow,d.techWoodCutting,d.techCrossbow],space:new Uint8Array([1,1,1,1,2]),hframe:98,url:m.euro_lumbermill,build:!0,cost:[0,100,0,0],storage:1,size:1},{radix:0,name:"Mage Tower",strID:"e_magetower",sound:["e_magetower1","e_magetower2","e_magetower3"],clss:"magictower",resistance:700,health:5E3,maxHealth:5E3,img:m.euro_magetower,
invType:1,invMax:0,time:90,race:"euro",dieSound:O,sight:8,validator:P,bimg:m.build5x5,dimg:m.des_5x5,zLevel:1,child:[{img:m.euro_magetower_c,x:0,y:0},{img:m.euro_magetower_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:71,icons:[d.createMage,d.techBat,d.techInvisibility,d.techLightning,d.techFreeze,d.techGolem],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.euro_magetower,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,strID:"e_waracademy",name:"Warriors Guild",sound:["e_waracademy1"],clss:"academy",
resistance:700,health:5E3,maxHealth:5E3,img:m.euro_waracademy,invType:1,invMax:0,race:"euro",time:90,sight:8,dieSound:O,zLevel:1,validator:P,bimg:m.build6x6,dimg:m.des_6x6,iconID:56,child:[{img:m.euro_waracademy_c,x:0,y:0,mv:!0},{img:m.euro_waracademy_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],icons:[d.techHeroism,d.techWarfare,d.techMercenaries,d.techSiegeTactics,d.techBodyBuilding,d.techLeadership,d.techTactics,d.techHeroes,d.techHonor,d.techFame],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,0,1,1,0,0,5]),url:m.euro_waracademy,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,name:"Storage",strID:"e_storage",sound:["e_storage1","e_storage2"],clss:"storage",resistance:80,health:800,maxHealth:800,img:m.euro_storage,invType:1,invMax:0,time:30,dieSound:O,zLevel:1,sight:5,validator:P,bimg:m.build4x4,dimg:m.des_4x4,iconID:69,race:"euro",icons:[d.techGoldMining,d.techStoneMining],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:m.euro_storage,storage:0,build:!0,cost:[0,200,0,
0],size:1,child:[{img:m.euro_storage_c,x:0,y:0},{img:m.euro_storage_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Knight",strID:"e_knight",dieSound:de,clss:"knight",attackSound:be,attack:12,defence:6,health:120,maxHealth:120,img:m.euro_knight.idle,invType:0,zLevel:1,race:"euro",invMax:8,validator:W,human:1,iconID:43,d2attack:2,time:22,sight:5,url:m.euro_knight,icons:e,cost:[120,0,70,0],attDist:1,spd:85,nu:d.createKnight,standardFunc:V,size:1},{radix:0,name:"Field",clss:"field",strID:"field",
instantBuild:1,resistance:80,health:100,maxHealth:100,img:m.fields,invMax:0,validator:nh,zLevel:1,iconID:104,race:"common",icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:m.fields,build:!0,field:1,res:2,cost:[0,200,0,0],rndDirection:9,time:0,sight:1,z32:.5,size:1},{radix:0,name:"Golden rocks",mMapcolor:[148,148,0],strID:"gold",sound:["mine1"],clss:"golden_rocks",resistance:0,health:8E3,maxHealth:8E3,img:m.res_gold,invMax:0,validator:P,iconID:20,icons:[],space:new Uint8Array([1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,4]),url:m.res_gold,build:!0,zLevel:1,race:"common",res:0,cost:[0,0,0,0],time:0,sight:2,dieSound:["destroy%20mine"],size:1,zolotoy:1,child:[{img:m.res_gold_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:m.res_gold},{radix:0,name:"Rocks",strID:"stone",mMapcolor:[132,132,132],sound:["mine1"],clss:"rocks",dieSound:["destroy%20mine"],resistance:0,health:8E3,maxHealth:8E3,img:m.res_stone,invMax:0,validator:P,zLevel:1,iconID:22,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,4]),url:m.res_stone,build:!0,res:3,cost:[0,0,0,0],race:"common",time:0,sight:2,size:1,zolotoy:1,child:[{img:m.res_stone_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:m.res_stone},{radix:0,name:"Farm",strID:"e_farm",sound:["e_farm1","e_farm2"],clss:"farm",resistance:0,health:800,maxHealth:800,img:m.euro_farm,invType:1,invMax:0,zLevel:1,validator:P,bimg:m.build4x4,dimg:m.des_4x4,iconID:61,dieSound:O,race:"euro",icons:[d.createCow,d.techCropRotation,d.techDomestication],space:new Uint8Array([1,
1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Va,url:m.euro_farm,build:!0,cost:[0,200,0,0],time:30,sight:5,storage:2,size:1,child:[{img:m.euro_farm_c,x:0,y:0}]},{radix:0,name:"Merchants Guild",strID:"e_merchant",sound:["merchant"],clss:"merchants_guild",resistance:0,health:5E3,maxHealth:5E3,img:m.euro_tcguild,invType:1,invMax:0,validator:P,bimg:m.build6x6,zLevel:1,dimg:m.des_6x6,race:"euro",iconID:62,dieSound:O,icons:[d.techMapMaking,d.techTradeRoutes,d.techUsury,d.techSupplyStorage,d.techBribery,d.techTradeTaxes],
space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),menu:Va,url:m.euro_tcguild,build:!0,time:90,sight:8,cost:[2E3,0,0,2E3],onbuild:[d.buildMarket],size:1,child:[{img:m.euro_tcguild_c,x:0,y:0},{img:m.euro_tcguild_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Church",clss:"church",strID:"e_church",sound:["e_church1"],resistance:0,health:800,maxHealth:800,img:m.euro_church,invType:1,invMax:0,dieSound:O,validator:P,bimg:m.build3x3,race:"euro",zLevel:1,dimg:m.des_3x3,iconID:139,
icons:[d.createPriest],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),menu:Va,url:m.euro_church,build:!0,cost:[0,0,200,200],time:40,sight:6,size:1,child:[{img:m.euro_church_c,x:0,y:0},{img:m.euro_church_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Blacksmith",clss:"blacksmith",strID:"e_blacksmith",resistance:0,health:800,maxHealth:800,img:m.euro_blacksmith,invType:1,invMax:0,time:40,zLevel:1,sight:5,dieSound:O,validator:P,bimg:m.build4x4,race:"euro",dimg:m.des_4x4,child:[{img:m.euro_blacksmith_c,
x:0,y:0}],iconID:58,icons:[d.techPlateArmor,d.techTemperIron,d.techScaleArmor,d.techHalberd,d.techChainMail],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Va,url:m.euro_blacksmith,build:!0,cost:[0,0,200,200],onbuild:b,size:1},{radix:0,name:"Cow",clss:"cow",nu:d.createCow,race:"common",strID:"cow",attack:0,defence:3,health:50,maxHealth:50,img:m.cow.idle,invType:0,invMax:8,zLevel:1,validator:W,iconID:99,time:20,dieSound:["cowdie1","cowdie2","cowdie3","cowdie4"],url:m.cow,icons:[d.move,
d.stop],sight:3,cost:[0,0,300,0],attDist:0,spd:32,res:2,food:300,milk:50,milkMax:50,foodMax:600,size:1,cow:1,update:["milk","milkSpeed",1E3,"food","cowSpeed",1E3]},{radix:0,name:"Stable",sound:["e_stables1"],clss:"stable",strID:"e_stable",onlyRequired:1,resistance:0,health:800,maxHealth:800,invType:1,invMax:0,race:"euro",zLevel:1,validator:P,bimg:m.build4x4,dimg:m.des_4x4,iconID:68,dieSound:O,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.euro_stables,build:!0,cost:[0,200,0,0],onbuild:f,
size:1,time:40,sight:5,img:m.euro_stables,nu:d.createCow,child:[{img:m.euro_stable_c,x:0,y:0}]},{radix:0,name:"Workshop",sound:["e_workshop1"],clss:"workshop",strID:"e_workshop",zLevel:1,resistance:0,health:800,maxHealth:800,img:m.euro_workshop,invType:1,invMax:0,dieSound:O,validator:P,bimg:m.build4x4,race:"euro",dimg:m.des_4x4,iconID:75,icons:[d.createCatapult,d.createHeavyCatapult,d.createBallist,d.techEngineering,d.techCannonTower],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:m.euro_workshop,
build:!0,cost:[0,200,200,0],size:1,time:40,sight:5,child:[{img:m.euro_workshop_c,x:0,y:0}]},{radix:0,name:"Tavern",sound:["e_tavern1"],clss:"tavern",strID:"e_tavern",dieSound:O,resistance:0,health:1E3,maxHealth:1E3,img:m.euro_tavern,invType:1,invMax:0,validator:P,race:"euro",bimg:m.build4x4,dimg:m.des_4x4,zLevel:1,iconID:70,icons:[d.createMercenaries,d.createHeroes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4]),url:m.euro_tavern,build:1,cost:[0,200,200,0],onbuild:g,actvintv:[d.iniMercenaries,
d.iniHeroes],size:1,time:40,sight:5,child:[{img:m.euro_tavern_c,x:0,y:0}]},{name:"House",sound:["house1","house2","house3","house4","house5"],clss:"house",strID:"e_house",resistance:0,health:500,maxHealth:500,img:m.euro_houses,invType:1,invMax:0,validator:P,bimg:m.build3x3,dimg:m.des_3x3,race:"euro",iconID:73,zLevel:1,dieSound:O,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:m.euro_houses,build:!0,cost:[0,75,0,0],population:10,size:1,time:20,sight:4,child:[{img:m.euro_houses_c,x:0,y:0}]},
{name:"Watch Tower",attackSound:uf,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),clss:"watch_tower",strID:"watch_tower",attack:7,health:400,maxHealth:400,img:m.euro_tower_wood_2,state:0,invType:1,race:"common",invMax:0,zLevel:1,dieSound:O,level:0,validator:P,child:[{img:m.euro_tower_wood_2_c,x:0,y:0},{alpha:!0,img:m.euro_tower_wood_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attimg:m.arrow1,attDist:8,bimg:m.build2x2,dimg:m.des_2x2,iconID:53,icons:[d.attack,d.stop,d.upgradeGuildTower],space:new Uint8Array([1,
1,1,1,2]),url:m.euro_tower_wood_2,build:!0,cost:[0,300,0,0],size:1,arrow:!0,time:10,sight:15,standardFunc:V},{name:"Market",sound:["e_market1"],clss:"market",strID:"e_market",resistance:0,health:1400,maxHealth:1400,img:m.euro_market,invType:1,invMax:0,dieSound:O,zLevel:1,validator:P,bimg:m.build4x4,dimg:m.des_4x4,iconID:65,race:"euro",icons:[d.createCaravan],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,4]),url:m.euro_market,build:!0,cost:[0,200,200,0],size:1,time:60,sight:8,child:[{img:m.euro_market_c,
x:0,y:0}]},{name:"Outpost",sound:["e_outpost1"],clss:"outpost",strID:"e_outpost",zLevel:1,resistance:0,health:2E3,maxHealth:2E3,img:m.euro_outpost,invType:1,dieSound:O,invMax:50,validator:P,race:"euro",bimg:m.build4x4,dimg:m.des_4x4,iconID:66,icons:[d.emergeAllUnits],space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,4]),url:m.euro_outpost,build:!0,cost:[0,200,0,400],size:1,child:[{img:m.euro_outpost_c,x:0,y:0},{img:m.euro_outpost_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{name:"Bridge",
clss:"bridge",strID:"bridge",resistance:0,health:1E4,maxHealth:1E4,img:m.bridge_horz,invMax:0,valid2:!0,validator:xk,bimg:m.bridge_horz_build,race:"common",zLevel:1,dieSound:O,child:[{alpha:!0,img:m.bridge_horz_s,x:0,y:0,rgb:[0,0,0,.5]},{img:m.bridge_horz1,x:0,y:0,z:6}],time:22,sight:1,dimg:m.bridge_horz_demol,iconID:44,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,
1,1,1,11]),url:m.bridge_horz,build:!0,cost:[0,200,0,400],size:1},{name:"Dummy",clss:"dummy",strID:"dummy",resistance:0,health:5E3,maxHealth:5E3,img:m.dummy1,invMax:0,validator:W,bimg:m.dummy1_b,iconID:165,icons:[],mx:0,zLevel:1,my:16,hframe:65,race:"common",url:m.dummy1,dimg:m.dummy1_d,build:!0,cost:[0,300,0,0],dummy:!0,child:[{img:m.dummy1_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:10,sight:1},{name:"Catapult",strID:"catapult",dieSound:wf,clss:"catapult",attackSound:vf,defence:0,attack:10,health:110,
maxHealth:110,img:m.catapult.idle,invMax:0,radix:0,validator:W,iconID:30,time:30,sight:20,race:"common",url:m.catapult,level:0,zLevel:1,icons:c,cost:[0,600,0,0],nofreeze:1,arrow:!1,attDist:17,spd:40,standardFunc:V,size:1,attimg:m.cat_stone,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:d.createCatapult},{name:"Ballista",radix:0,strID:"ballista",attackSound:vf,dieSound:wf,clss:"ballista",defence:0,attack:60,health:75,maxHealth:75,img:m.ballista.idle,invMax:0,validator:W,iconID:31,time:30,sight:16,
nofreeze:1,race:"common",zLevel:1,url:m.ballista,icons:c,cost:[0,800,0,0],attDist:13,spd:40,standardFunc:V,size:1,attimg:m.arrow_ballista1,space:new Uint8Array([1,1,1,1,2]),attackDeg:30,nu:d.createBallist},{name:"Heavy Catapult",strID:"heavy_catapult",attackSound:vf,defence:0,attack:25,health:250,maxHealth:250,img:m.h_catapult.idle,invMax:0,radix:0,validator:W,iconID:45,time:60,dieSound:wf,sight:26,race:"common",url:m.h_catapult,zLevel:1,icons:c,standardFunc:V,cost:[0,1200,0,0],attDist:22,spd:40,
nofreeze:1,clss:"heavy_catapult",size:1,attimg:m.cb_metal,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:d.createHeavyCatapult},{radix:0,name:"Ghost",strID:"ghost",defence:0,attack:8,health:60,maxHealth:60,img:m.euro_ghost.idle,invType:0,invMax:8,dieSound:["ghost1","ghost2"],validator:W,iconID:178,zLevel:1,race:"common",time:15,attackSound:fj,sight:5,standardFunc:V,url:m.euro_ghost,icons:e,w:1,cost:[40,0,0,0],attDist:1,spd:80,clss:"ghost",size:1,nu:d.createGhost},{name:"Harbor",strID:"e_harbor",
resistance:80,health:800,maxHealth:800,img:m.euro_harbor,invType:1,invMax:0,validator:yg,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:m.build_harbor,dimg:m.des_harbor,zLevel:1,race:"euro",dieSound:O,iconID:63,icons:[d.createFishingBoat,d.createXebec,d.createHulk,d.createGalleon,d.techLandingTactics],clss:"harbor",url:m.euro_harbor,storage:4,build:!0,cost:[0,200,200,0],child:[{img:m.euro_harbor_c,x:0,y:0},{img:m.euro_harbor_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{radix:0,name:"Messiah",
strID:"messiah",attack:50,defence:10,mana:1E3,manaMax:1E3,health:1E3,maxHealth:1E3,img:m.messiah.idle,invType:0,invMax:0,race:"common",validator:W,human:1,iconID:169,zLevel:1,attackSound:["messiah_attack"],dieSound:["messiah"],time:300,sight:26,url:m.messiah,standardFunc:V,icons:e,cost:[2E3,0,0,0],attDist:10,spd:50,clss:"messiah",size:1,update:["mana","manaSpeed",1E3]},{name:"Magic Gateway",sound:["gateway"],strID:"gateway",magicGateway:1,resistance:0,health:Infinity,maxHealth:Infinity,img:m.teleport,
invMax:0,validator:P,bimg:m.build4x4,zLevel:1,dieSound:O,race:"common",iconID:180,clss:"magic_gateway",icons:[d.createOrk,d.createDwarf,d.createGhost,d.createSkeleton],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,5]),url:m.teleport,build:!0,cost:[0,0,0,0],size:1,time:10,sight:10,zolotoy:1,child:[{img:m.teleport_c,x:0,y:0},{alpha:!0,img:m.teleport_s,x:0,y:0,rgb:[0,0,0,.5]}],standardFunc:Hl},{name:"Guard Tower",strID:"guard_tower",race:"common",clss:"guard_tower",attackSound:uf,
sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:12,health:1E3,maxHealth:1E3,img:m.euro_tower_wood,state:0,invType:1,invMax:0,dieSound:O,zLevel:1,validator:P,child:[{img:m.euro_tower_wood_c,x:0,y:0},{alpha:!0,img:m.euro_tower_wood_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:12,bimg:m.build2x2,dimg:m.des_2x2,iconID:52,icons:[d.attack,d.stop,d.upgradeStoneTower,d.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_wood,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:m.arrow1,
time:35,sight:16,standardFunc:V},{name:"Sword",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:cc,iconID:16,url:m.items1,icons:[],cost:[0,0,0,0],size:1,zLevel:0,z32:.5,radix:0,race:"common",item:1},{name:"Bow",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:cc,iconID:4,url:m.items1,icons:[],cost:[0,0,0,0],size:1,z32:.5,zLevel:0,radix:0,race:"common",item:1},{name:"Shield",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,
invMax:0,validator:cc,iconID:1,url:m.items1,icons:[],cost:[0,0,0,0],zLevel:0,race:"common",radix:0,size:1,z32:.5,item:1},{name:"Potion",attack:0,defence:0,health:25,maxHealth:25,img:m.potions,state:0,invMax:0,validator:cc,iconID:11,url:m.potions,icons:[],radix:0,race:"common",zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Book",attack:0,defence:0,health:25,maxHealth:25,img:m.book1,state:0,invMax:0,validator:cc,iconID:9,zLevel:0,race:"common",radix:0,url:m.books,icons:[],cost:[0,0,0,0],size:1,
z32:.5,item:1},{name:"Gold",health:1,maxHealth:1,img:m.item_gold,invMax:0,validator:cc,iconID:20,radix:0,race:"common",zLevel:0,url:m.item_gold,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Stone",health:1,maxHealth:1,img:m.item_stone,invMax:0,validator:cc,iconID:22,race:"common",radix:0,url:m.item_stone,zLevel:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Food",health:15,maxHealth:15,img:m.item_food,invMax:0,mMapcolor:[0,255,255],validator:cc,iconID:14,url:m.item_food,radix:0,race:"common",
icons:[],zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{ignore:1,name:"Wood",health:1,maxHealth:1,img:m.item_wood,invMax:0,validator:cc,iconID:15,url:m.item_wood,icons:[],race:"common",radix:0,zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Iron",health:1,maxHealth:1,img:m.item_iron,invMax:0,validator:cc,iconID:21,zLevel:0,race:"common",url:m.item_iron,radix:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Keep Tower",strID:"keep_tower",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),
attack:16,health:2E3,maxHealth:2E3,img:m.euro_tower_stone,state:0,invType:1,zLevel:1,attackSound:uf,invMax:0,dieSound:O,validator:P,clss:"keep_tower",race:"common",child:[{alpha:!0,img:m.euro_tower_stone_s,x:0,y:0,rgb:[0,0,0,.5]},{img:m.euro_tower_stone_c,x:0,y:0}],attDist:14,bimg:m.build2x2,dimg:m.des_2x2,standardFunc:V,iconID:54,icons:[d.attack,d.stop,d.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_stone,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:m.arrow_big1,time:40,
sight:18},{name:"Cannon Tower",clss:"tower_stone2",strID:"tower_stone2",attackSound:ce,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:40,health:2500,maxHealth:2500,img:m.euro_tower_stone_2,state:0,invType:1,invMax:0,dieSound:O,race:"common",validator:P,zLevel:1,child:[{img:m.euro_tower_stone_2_c,x:0,y:0},{alpha:!0,img:m.euro_tower_stone_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:10,bimg:m.build2x2,dimg:m.des_2x2,iconID:54,icons:[d.attack,d.stop],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_stone_2,
build:!0,cost:[0,600,0,0],standardFunc:V,size:1,arrow:!1,attimg:m.hot_cannon,time:45,sight:18,attackDeg:30},{name:"Rocket Tower",strID:"tower_rocket",race:"asia",clss:"tower_rocket",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),zLevel:1,attack:30,health:1400,maxHealth:1400,img:m.rocket_tower,state:0,invType:1,invMax:0,dieSound:O,validator:P,child:[{img:m.rocket_tower_c},{alpha:!0,img:m.rocket_tower_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:20,bimg:m.build2x2,dimg:m.des_2x2,iconID:186,icons:[],space:new Uint8Array([1,
1,1,1,2]),url:m.rocket_tower,build:!0,cost:[0,600,0,0],standardFunc:V,size:1,arrow:!0,attimg:m.arrow_big1,time:60,sight:26},{radix:0,name:"Ork",race:"common",strID:"ork",dieSound:["orc%20die%201","orc%20die%202"],attackSound:ej,attack:18,defence:2,health:75,maxHealth:75,img:m.ork.idle,invType:0,invMax:8,validator:W,zLevel:1,iconID:143,time:12,sight:5,url:m.ork,standardFunc:V,icons:e,cost:[60,0,0,0],attDist:1,spd:50,clss:"ork",size:1,nu:d.createOrk},{radix:0,name:"Dwarf",race:"common",attack:7,defence:7,
health:120,maxHealth:120,img:m.dwarf.idle,invType:0,strID:"dwarf",invMax:8,zLevel:1,dieSound:vb,validator:W,iconID:185,time:12,sight:3,url:m.dwarf,standardFunc:V,icons:e,cost:[80,0,0,0],attDist:1,spd:50,clss:"dwarf",size:1,nu:d.createDwarf},{radix:0,name:"Skeleton",strID:"skeleton",race:"common",dieSound:["skeleton%20die%201","skeleton%20die%202","skeleton%20die%203","skeleton%20die%204"],attack:4,defence:0,health:40,maxHealth:40,img:m.skeleton.idle,invType:0,zLevel:1,attackSound:Jc,invMax:8,nofreeze:1,
validator:W,iconID:167,time:12,sight:3,url:m.skeleton,standardFunc:V,icons:e,cost:[0,0,30,0],attDist:1,spd:50,clss:"skeleton",size:1,nu:d.createSkeleton},{radix:0,name:"Caravan",race:"euro",strID:"e_caravan",attack:0,defence:0,health:350,maxHealth:350,img:m.caravan.idle,invType:1,invMax:8,validator:W,iconID:34,zLevel:1,time:50,sight:7,url:m.caravan,icons:[d.move,d.trade,d.explore,d.stop,d.stand,d.unload],cost:[0,200,400,0],attDist:1,spd:75,clss:"caravan",size:1,nu:d.createCaravan},{name:"Castle",
health:8E3,maxHealth:8E3,img:m.asia_castle,invType:1,strID:"a_castle",zLevel:1,race:"asia",invMax:50,validator:P,bimg:m.build6x6,dimg:m.des_6x6,iconID:164,time:120,sight:12,dieSound:O,clss:"castle",child:[{img:m.asia_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:m.asia_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[d.createPeon1,d.createNinja,d.emergeAllUnits,d.techFeudalism,d.techArchitecture,d.techLearning,d.techBuddhism,d.techGreatWall],space:new Uint8Array([0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,8]),menu:Va,url:m.asia_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{name:"Castle",dieSound:O,clss:"castle",strID:"r_castle",race:"arab",health:8E3,maxHealth:8E3,img:m.arab_castle,invType:1,invMax:50,validator:P,bimg:m.build6x6,dimg:m.des_6x6,zLevel:1,iconID:97,time:120,sight:12,child:[{img:m.arab_castle_c}],icons:[d.createPeon2,d.createSpy,d.emergeAllUnits,d.techFeudalism,d.techArchitecture,
d.techLearning,d.techSlavery],space:new Uint8Array([0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,,8]),menu:Va,url:m.arab_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{radix:0,name:"Peasant",attack:5,defence:0,health:50,maxHealth:50,img:m.asian_peasant.idle,invType:0,invMax:8,attackSound:fh,race:"asia",validator:W,human:1,strID:"a_peon",iconID:132,dieSound:vb,zLevel:1,time:8,peon:1,
sight:5,url:m.asian_peasant,icons:[d.move,d.menuBuilds1,d.repair,d.conquest,d.dcm,d.pickUp,d.explore,d.stop,d.stand,d.attack,d.sameSpeed,d.restoreSpeed],cost:[0,0,40,0],attDist:1,spd:50,clss:"peon",nocapture:1,size:1},{radix:0,name:"Ninja",race:"asia",attack:12,defence:5,mana:100,manaMax:100,health:90,maxHealth:90,img:m.asian_ninja.idle,invType:0,invMax:8,attackSound:Jc,validator:W,human:1,iconID:133,strID:"ninja",dieSound:vb,zLevel:1,time:20,standardFunc:V,sight:10,url:m.asian_ninja,icons:[d.guard,
d.patrol,d.pickUp,d.explore,d.stop,d.stand,d.invisibility,d.murder,d.move,d.attack,d.sameSpeed,d.restoreSpeed],cost:[120,0,0,0],attDist:1,spd:85,clss:"ninja",size:1,update:["mana","manaSpeed",1E3]},{radix:0,name:"Ronin",attack:7,defence:0,health:45,maxHealth:45,img:m.asian_ronin.idle,invType:0,invMax:8,race:"asia",validator:W,human:1,standardFunc:V,iconID:141,strID:"ronin",dieSound:vb,zLevel:1,time:8,sight:5,url:m.asian_ronin,icons:e,cost:[0,0,40,0],attDist:1,spd:50,attackSound:Jc,clss:"a_footman",
size:1},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:m.asian_archer.idle,invType:0,invMax:8,race:"asia",validator:W,human:1,strID:"a_archer",dieSound:vb,zLevel:1,attimg:m.arrow1,iconID:136,arrow:1,attackSound:yd,time:12,sight:10,url:m.asian_archer,icons:e,cost:[0,20,40,0],standardFunc:V,spd:50,clss:"archer",size:1,attDist:6},{radix:0,name:"Samurai",attack:10,defence:4,health:90,maxHealth:90,img:m.asian_samurai.idle,invType:0,race:"asia",strID:"samurai",invMax:8,attackSound:Jc,
validator:W,human:1,iconID:142,time:20,standardFunc:V,zLevel:1,dieSound:vb,sight:6,url:m.asian_samurai,icons:e,cost:[50,0,150,0],attDist:1,spd:50,clss:"a_maceman",size:1},{radix:0,name:"Horse Archer",attack:7,defence:0,health:75,maxHealth:75,img:m.asian_horsarcher.idle,invType:0,race:"asia",invMax:8,validator:W,human:1,attackSound:yd,iconID:183,strID:"a_horse_archer",dieSound:de,time:20,standardFunc:V,sight:12,url:m.asian_horsarcher,zLevel:1,icons:e,arrow:1,attimg:m.arrow1,cost:[40,0,120,0],spd:85,
clss:"horse_archer",size:1,attDist:7},{radix:0,name:"Horse Samurai",attack:14,defence:4,health:160,maxHealth:160,img:m.asian_horsamurai.idle,invType:0,invMax:8,validator:W,human:1,iconID:135,race:"asia",standardFunc:V,attackSound:be,time:22,zLevel:1,strID:"horse_samurai",dieSound:de,sight:5,url:m.asian_horsamurai,icons:e,cost:[75,0,120,0],attDist:1,spd:85,clss:"horse_samurai",size:1},{name:"Barracks",resistance:500,health:1400,maxHealth:1400,img:m.asia_barracks,invType:1,sound:gh,invMax:0,time:60,
dieSound:O,radix:0,sight:6,race:"asia",strID:"a_barrack",validator:P,zLevel:1,bimg:m.build5x5,dimg:m.des_5x5,child:[{img:m.asia_barracks_c,x:0,y:0,mv:!0},{img:m.asia_barracks_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:146,icons:[d.createRonin,d.createArcher1,d.createSamurai,d.createHorseArcher1,d.createHorseSamurai,d.createChariot],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:m.asia_barracks,build:!0,cost:[0,200,0,200],size:1,clss:"barracks"},{name:"Chariot",attack:4,
defence:3,health:180,maxHealth:180,img:m.asian_charriot.idle,invType:0,radix:0,race:"asia",invMax:8,strID:"chariot",dieSound:["c%20die%201","c%20die%202","c%20die%203","c%20die%204","c%20die%205"],attackSound:be,validator:W,human:1,zLevel:1,iconID:175,standardFunc:V,time:8,sight:5,url:m.asian_charriot,icons:e,cost:[0,200,150,0],attDist:1,spd:85,clss:"chariot",size:1},{radix:1,name:"Galleon",attackSound:ce,attack:35,attDist:12,race:"common",defence:0,health:1200,attackTime:2E3,maxHealth:1200,strID:"galleon",
nu:d.createGalleon,img:m.galleon.idle,invType:1,invMax:24,dieSound:["ship%20sink"],zLevel:0,validator:Ue,iconID:32,time:50,boat:!0,attimg:m.cb_metal,attackDeg:20,sight:16,url:m.galleon,icons:[d.move,d.explore,d.unload,d.attack,d.attackGround,d.stop,d.stand,d.stop,d.stand,d.attack,d.steady,d.upgradeShip],cost:[0,1200,800,0],spd:50,nofreeze:1,clss:"galleon",standardFunc:V,size:1,peon:1},{radix:1,name:"Fishing Boat",attackSound:ce,attack:0,attDist:8,race:"common",defence:0,health:50,boat:!0,nu:d.createFishingBoat,
maxHealth:50,img:m.boat.idle,invType:1,invMax:0,strID:"fishing_boat",dieSound:["ship%20sink"],zLevel:0,validator:Ue,iconID:184,nofreeze:1,time:50,sight:16,url:m.boat,icons:[d.move,d.explore,d.stop,d.stand,d.fishing],cost:[0,200,100,0],spd:65,clss:"fishing_boat",size:1},{radix:1,name:"Hulk",attackSound:ce,attack:18,attDist:10,race:"common",defence:0,health:700,maxHealth:700,strID:"hulk",img:m.hulk.idle,invType:1,attackTime:2E3,boat:!0,nu:d.createHulk,attackDeg:20,invMax:16,dieSound:["ship%20sink"],
zLevel:0,validator:Ue,iconID:128,time:30,sight:14,attimg:m.cb_metal,url:m.hulk,icons:[d.move,d.explore,d.unload,d.attack,d.attackGround,d.stop,d.stand,d.stop,d.stand,d.attack,d.steady,d.upgradeShip],cost:[0,500,300,0],spd:65,nofreeze:1,clss:"hulk",standardFunc:V,size:1},{radix:1,name:"Pinque",attackSound:yd,attack:10,race:"common",attDist:8,defence:0,health:300,boat:!0,maxHealth:300,img:m.xebec.idle,attimg:m.arrow1,arrow:!0,strID:"pinque",invType:1,invMax:8,dieSound:["ship%20sink"],zLevel:0,validator:Ue,
iconID:129,time:20,nofreeze:1,sight:12,url:m.xebec,icons:[d.move,d.explore,d.unload,d.attack,d.attackGround,d.stop,d.stand,d.stop,d.stand,d.attack,d.steady,d.upgradeShip],cost:[0,300,200,0],spd:80,clss:"xebec",size:1,standardFunc:V,nu:d.createXebec},{radix:0,name:"Stone Golem",strID:"troll",defence:3,attack:25,health:400,maxHealth:400,img:m.troll.idle,invType:0,invMax:0,dieSound:["golem"],validator:W,iconID:144,race:"common",zLevel:1,nofreeze:1,attackSound:["golem1","golem2"],sight:10,standardFunc:V,
url:m.troll,icons:e,w:1,cost:[120,0,0,0,600],attDist:1,spd:56,clss:"troll",size:1},{radix:0,name:"Bat",strID:"bat",defence:0,attack:3,health:20,maxHealth:20,img:m.bat.move,invType:0,invMax:0,race:"common",bat:1,dieSound:["bat%20die"],validator:zg,iconID:105,zLevel:2,attackSound:["bat%20attack"],sight:10,standardFunc:V,url:m.bat,icons:e,w:1,cost:[0,0,0,0,25],attDist:1,spd:128,clss:"bat",size:1,z32:1.5},{race:"arab",invType:0,invMax:8,iconID:138,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_peasant,
img:m.arab_peasant.idle,spd:50,validator:W,human:1,icons:[d.move,d.menuBuilds2,d.repair,d.conquest,d.dcm,d.pickUp,d.explore,d.stop,d.stand,d.attack,d.convertJihad,d.bribe,d.sameSpeed,d.restoreSpeed],name:"Peasant",clss:"peon",cost:[0,0,50,0],attDist:1,time:8,nocapture:1,peon:1,sight:5,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:172,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_footman,img:m.arab_footman.idle,standardFunc:V,spd:50,validator:W,human:1,attDist:1,
icons:e,name:"Footman",clss:"footman",cost:[0,0,50,0],time:12,sight:5,health:50,attack:6,defence:1},{race:"arab",invType:0,invMax:8,iconID:170,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_archer,img:m.arab_archer.idle,spd:50,validator:W,standardFunc:V,human:1,attimg:m.arrow1,arrow:1,icons:e,name:"Archer",clss:"archer",cost:[0,20,40,0],time:12,sight:10,attDist:6,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:173,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,
url:m.arab_spearman,img:m.arab_spearman.idle,spd:50,validator:W,standardFunc:V,human:1,icons:e,name:"Spearman",clss:"pikeman",attDist:1,cost:[40,0,60,0],time:14,sight:5,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:174,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,standardFunc:V,url:m.arab_satrap,img:m.arab_satrap.idle,spd:50,validator:W,human:1,icons:e,name:"Satrap",attDist:1,clss:"maceman",cost:[0,0,120,0],time:14,sight:5,health:120,attack:8,defence:0},{race:"arab",invType:0,
invMax:8,iconID:171,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_cavalry,standardFunc:V,img:m.arab_cavalry.idle,spd:85,validator:W,human:1,attDist:1,icons:e,name:"Cavalry",clss:"heavy_cavalry",cost:[60,0,100,0],time:14,sight:5,health:90,attack:10,defence:4},{race:"arab",invType:0,invMax:8,iconID:168,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_horse_archer,img:m.arab_horse_archer.idle,spd:85,validator:W,human:1,standardFunc:V,icons:e,name:"Horse Archer",clss:"horse_archer",
cost:[50,0,100,0],time:14,attimg:m.arrow1,arrow:1,sight:12,attDist:7,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:179,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_jwarrior,img:m.arab_jwarrior.idle,spd:50,validator:W,human:1,standardFunc:V,icons:e,name:"Jihad warrior",attDist:1,clss:"jihad_warrior",cost:[0,0,100,0],time:8,sight:5,health:75,attack:10,defence:2},{race:"arab",invType:0,invMax:8,iconID:176,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_priest,
img:m.arab_priest.idle,standardFunc:V,spd:50,mana:100,validator:W,human:1,icons:h,name:"Priest",clss:"priest",cost:[150,0,0,0],time:30,sight:21,attDist:18,health:60,attack:20,update:["mana","manaSpeed",1E3],manaMax:100,defence:0,attimg:m.flame_bolt,ball:1,attackOnly:Te.magic_creatures.obj},{race:"arab",invType:0,invMax:0,iconID:105,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:0,img:0,testing:1,illegal:1,spd:50,validator:W,human:1,icons:[],name:"Spy",clss:"spy",cost:150,time:30,sight:12,
health:50,attack:20,defence:0},{race:"arab",invType:0,invMax:8,iconID:188,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,attimg:m.flame_bolt,url:m.arab_mage,img:m.arab_mage.idle,spd:50,validator:W,human:1,icons:[d.stop,d.pickUp,d.explore,d.createCarpet,d.createJinn,d.fireRain,d.magicVision,d.raiseDead,d.attack,d.stand,d.move],standardFunc:V,name:"Mage",clss:"mage",ball:1,mana:100,manaMax:100,update:["mana","manaSpeed",1E3],cost:[150,0,0,0],time:30,sight:15,attDist:10,health:60,attack:8,defence:0},
{race:"arab",invType:1,invMax:8,iconID:126,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_caravan,img:m.arab_caravan.idle,spd:75,validator:W,human:1,icons:[],name:"Caravan",clss:"trader",cost:[0,0,500,0],time:30,sight:5,health:150},{race:"arab",invType:0,invMax:8,iconID:177,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_enichar,img:m.arab_enichar.idle,spd:85,validator:W,human:1,standardFunc:V,icons:e,name:"Enichar",attDist:1,clss:"enichar",cost:[80,0,120,0],time:25,sight:5,
health:130,attack:18,defence:4},{race:"arab",invType:1,invMax:0,iconID:82,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,population:10,url:m.arab_houses,validator:P,build:1,icons:[],child:[{img:m.arab_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],time:20,sight:4,resistance:50,health:500},{race:"arab",invType:1,invMax:0,iconID:85,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_lumbermill,
validator:P,build:1,icons:[d.techWoodCutting,d.techCrossbow],child:[{img:m.arab_lumbermill_c}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],storage:1,time:30,sight:4,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:96,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_storage,validator:P,build:1,storage:0,icons:[d.techGoldMining,d.techStoneMining],child:[{img:m.arab_storage_c},{alpha:!0,img:m.arab_storage_s,
rgb:[0,0,0,.5]}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:80,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_farm,validator:P,build:1,icons:[d.createCow,d.techCropRotation,d.techDomestication,d.techCowPoaching,d.ridingHorses,d.techHorseManShip],child:[{img:m.arab_farm_c}],name:"Farm",storage:2,clss:"farm",cost:[0,200,0,0],time:30,sight:5,
resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:81,zLevel:1,dieSound:O,validator:yg,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:m.build_harbor,dimg:m.des_harbor,radix:0,url:m.arab_harbour,build:1,icons:[d.createFishingBoat,d.createXebec,d.createHulk,d.techLandingTactics],child:[{img:m.arab_harbour_c},{alpha:!0,img:m.arab_harbour_s,rgb:[0,0,0,.5]}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,
iconID:79,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_blacksmith,validator:P,build:1,icons:[d.techTemperIron,d.techScaleArmor,d.techScimitar,d.techChainMail,d.techHalberd],child:[{img:m.arab_blacksmith_c},{alpha:!0,img:m.arab_blacksmith_s,rgb:[0,0,0,.5]}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],onbuild:b,time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:95,zLevel:1,dieSound:O,space:new Uint8Array([1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_workshop,validator:P,build:1,icons:[d.createCatapult,d.createBallist,d.techEngineering,d.techCannonTower],child:[{img:m.arab_workshop_c},{alpha:!0,img:m.arab_workshop_s,rgb:[0,0,0,.5]}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:140,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,
radix:0,url:m.arab_church,validator:P,build:1,icons:[d.createPriest2],child:[{img:m.arab_church_c},{alpha:!0,img:m.arab_church_s,rgb:[0,0,0,.5]}],name:"Church",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"arab",invType:1,invMax:0,iconID:92,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_tavern,validator:P,build:1,icons:[d.createMercenaries,d.createHeroes],child:[{img:m.arab_tavern_c}],
name:"Tavern",clss:"tavern",cost:[0,200,200,0],onbuild:g,actvintv:[d.iniMercenaries,d.iniHeroes],time:40,sight:5,resistance:150,health:1E3},{race:"arab",invType:1,invMax:0,iconID:87,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_market,validator:P,build:1,icons:[d.createCaravan2],child:[{img:m.arab_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,
invMax:0,iconID:98,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_barracks,validator:P,build:1,icons:[d.createFootman2,d.createArcher2,d.createSatrap,d.createPikeman2,d.createHorseArcher2,d.createCavalry,d.createEnichar,d.createJihad],child:[{img:m.arab_barracks_c},{alpha:!0,img:m.arab_barracks_s,rgb:[0,0,0,.5]}],name:"Barracks",clss:"barrack",cost:[0,0,200,200],time:60,sight:6,resistance:500,health:1400},
{race:"arab",invType:1,invMax:0,iconID:91,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_stables,validator:P,build:1,icons:[],child:[{img:m.arab_stables_c}],name:"Stable",clss:"stable",cost:[0,200,200,0],time:40,onbuild:f,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:50,iconID:89,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_outpost,
validator:P,build:1,icons:[d.emergeAllUnits],child:[{img:m.arab_outpost_c,mv:1},{alpha:!0,img:m.arab_outpost_s,rgb:[0,0,0,.5]}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"arab",invType:1,invMax:0,iconID:105,zLevel:1,dieSound:O,space:23213123,bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:0,img:0,validator:P,build:1,icons:[],child:[{img:3213123}],name:"NULL",testing:1,clss:"castle",cost:[0,1500,0,1500],time:120,sight:12,resistance:1E3,health:8E3},
{race:"arab",invType:1,invMax:0,iconID:88,zLevel:1,dieSound:O,space:new Uint8Array([0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,6]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_mosque,validator:P,build:1,icons:[d.techFanaticism,d.techEspionage,d.techHealing,d.techBless,d.techJihad],child:[{img:m.arab_mosque_c},{alpha:!0,img:m.arab_mosque_s,rgb:[0,0,0,.5]}],name:"Mosque",onbuild:[d.buildChurch2],clss:"mosque",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},
{race:"arab",invType:1,invMax:0,iconID:86,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_magetower,validator:P,build:1,icons:[d.createMage2,d.techCarpet,d.techMagicWorkshop,d.techFireRain,d.techMagicVision,d.techNecromancy,d.techJinn],child:[{img:m.arab_magetower_c},{alpha:!0,img:m.arab_magetower_s,rgb:[0,0,0,.5]}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",
invType:1,invMax:0,iconID:93,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_tc_guild,validator:P,build:1,icons:[d.techUsury,d.techTradeRoutes,d.techSupplyStorage,d.techBribery,d.techOreFloatation],child:[{img:m.arab_tcguild_c},{alpha:!0,img:m.arab_tc_guild_s,rgb:[0,0,0,.5]}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[d.buildMarket2],sight:8,resistance:700,health:5E3},{race:"arab",
invType:1,invMax:0,iconID:94,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_waracademy,validator:P,build:1,icons:[d.techHeroism,d.techWarfare,d.techMercenaries,d.techRiddingHorses,d.techBodyBuilding,d.techLeadership,d.techHeroes,d.techJanissary,d.techHonor,d.techFame],child:[{img:m.arab_waracademy_c},{alpha:!0,img:m.arab_waracademy_s,rgb:[0,0,0,.5]}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,
0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:158,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_magicworkshop,validator:P,build:1,icons:[d.createObjects],child:[{img:m.arab_magicworkshop_c},{alpha:!0,img:m.arab_magicworkshop_s,rgb:[0,0,0,.5]}],name:"Magic Workshop",disallowPoint:!0,clss:"magicworkshop",cost:[0,0,0,300],time:20,sight:5,resistance:200,health:1200},{race:"asia",invType:1,invMax:0,
iconID:161,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,0,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.asia_houses,validator:P,build:1,icons:[],child:[{img:m.asia_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],population:10,time:20,sight:4,resistance:50,health:500},{race:"asia",invType:1,invMax:0,iconID:149,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,storage:1,url:m.asia_lumbermill,validator:P,build:1,icons:[d.techWoodCutting,
d.techCrossbow],child:[{img:m.asia_lumbermill_c},{img:m.asia_lumbermill_s,rgb:[0,0,0,.5],alpha:!0}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],time:30,sight:4,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:154,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_storage,storage:0,validator:P,build:1,icons:[d.techGoldMining,d.techStoneMining],child:[{img:m.asia_storage_s,rgb:[0,0,0,.5],alpha:!0},{img:m.asia_storage_c}],
name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:147,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,storage:2,url:m.asia_farm,validator:P,build:1,icons:[d.techCropRotation,d.ridingHorses,d.irrigation],child:[{img:m.asia_farm_c}],name:"Farm",clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:148,
zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),validator:yg,bimg:m.build_harbor,dimg:m.des_harbor,radix:0,url:m.asia_harbor,build:1,icons:[d.createFishingBoat,d.createXebec,d.createHulk,d.techLandingTactics],child:[{img:m.asia_harbor_c},{img:m.asia_harbor_s,rgb:[0,0,0,.5],alpha:!0}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:145,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,0,0,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_blacksmith,validator:P,build:1,icons:[d.techTemperIron,d.techScaleArmor,d.techArmoredChariot,d.techChainMail],child:[{img:m.asia_blacksmith_c},{img:m.asia_blacksmith_s,rgb:[0,0,0,.5],alpha:!0}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],time:40,sight:5,onbuild:b,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:157,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),
bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_workshop,validator:P,build:1,icons:[d.createCatapult,d.createBallist,d.techEngineering,d.techCannonTower],child:[{img:m.asia_workshop_c,x:0,y:0},{img:m.asia_workshop_s,rgb:[0,0,0,.5],alpha:!0}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:162,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,
radix:0,url:m.asian_monastery,validator:P,build:1,icons:[d.createMonk,d.createPriest1],child:[{img:m.asian_monastery_c},{img:m.asian_monastery_s,rgb:[0,0,0,.5],alpha:!0}],name:"Monastery",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"asia",invType:1,invMax:0,iconID:155,zLevel:1,dieSound:O,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_tavern,validator:P,build:1,icons:[d.createMercenaries,d.createHeroes],
child:[{img:m.asia_tavern_c},{img:m.asia_tavern_s,rgb:[0,0,0,.5],alpha:!0}],onbuild:g,name:"Tavern",clss:"tavern",actvintv:[d.iniMercenaries,d.iniHeroes],cost:[0,200,200,0],time:40,sight:5,resistance:150,health:1E3},{race:"asia",invType:1,invMax:0,iconID:150,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_market,validator:P,build:1,icons:[],child:[{img:m.asia_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,
sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:153,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_stables,validator:P,build:1,icons:[],child:[{img:m.asia_stables_c,mv:!0},{img:m.asia_stables_s,rgb:[0,0,0,.5],alpha:!0}],name:"Stable",clss:"stable",onbuild:f,cost:[0,200,200,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:151,zLevel:1,dieSound:O,space:new Uint8Array([1,
1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.asia_outpost,validator:P,build:1,icons:[d.emergeAllUnits],child:[{img:m.asia_outpost_c,mv:1},{img:m.asia_outpost_s,rgb:[0,0,0,.5],alpha:!0}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"asia",invType:1,invMax:0,iconID:163,zLevel:1,dieSound:O,space:new Uint8Array([0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,6]),bimg:m.build6x6,dimg:m.des_6x6,radix:0,url:m.asia_shao_lin,
validator:P,build:1,icons:[d.techMeditation,d.techKungFu,d.techHealing,d.techPhilosophy,d.techNinjas,d.techMastery,d.techTournaments,d.techMedicine],child:[{img:m.asia_shao_lin_c},{img:m.asia_shao_lin_s,rgb:[0,0,0,.5],alpha:!0}],name:"Shao Linn",onbuild:[d.buildChurch1],clss:"shaolinn",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:152,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:m.build5x5,
dimg:m.des_5x5,radix:0,url:m.asia_wizardguild,validator:P,build:1,icons:[d.createMage1,d.techConcentration,d.techWhirlpool,d.techFlameBolt,d.techTurnToStone,d.techConfusion,d.techDragon],child:[{img:m.asia_wizardguild_c},{img:m.asia_wizardguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:159,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,
1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_tcguild,validator:P,build:1,icons:[d.techTradeRoutes,d.techUsury,d.techJewelry,d.techSupplyStorage,d.techBanking,d.techChemistry,d.techSeaFood,d.techGunPowder,d.techRocketArrow],child:[{img:m.asia_tcguild_c,mv:!0},{img:m.asia_tcguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[d.buildMarket1],sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:156,zLevel:1,dieSound:O,
space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_warguild,validator:P,build:1,icons:[d.techBushido,d.techHeroism,d.techWarfare,d.techMercenaries,d.techLeadership,d.techTactics,d.techHeroes,d.techHonor,d.techSunTzu],child:[{img:m.asia_warguild_c,mv:!0},{img:m.asia_warguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:0,invMax:0,
iconID:166,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_priest,img:m.asian_priest.idle,spd:50,validator:W,human:1,icons:[d.attack,d.stop,d.stand,d.pickUp,d.explore,d.healing,d.teach,d.move],name:"Priest",clss:"priest",cost:[170,0,0,0],time:30,sight:21,health:120,standardFunc:V,attDist:1,attack:10,defence:10,mana:100,update:["mana","manaSpeed",1E3],manaMax:100},{race:"asia",invType:0,invMax:0,iconID:187,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_monk,img:m.asian_monk.idle,
spd:50,validator:W,human:1,icons:e,name:"Monk",standardFunc:V,clss:"monk",cost:[0,0,200,0],time:20,sight:5,health:90,attack:6,defence:6,attDist:1},{race:"asia",invType:0,invMax:0,iconID:134,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_mage,img:m.asian_mage.idle,spd:50,attimg:m.flame_bolt,validator:W,standardFunc:V,human:1,icons:[d.stop,d.pickUp,d.explore,d.confusion,d.turnToStone,d.whirlpool,d.flameBolt,d.createDragon,d.attack,d.stand,d.move],name:"Mage",clss:"mage",cost:[150,0,
0,0],ball:1,time:30,sight:15,mana:100,attDist:10,health:60,attack:8,defence:0,update:["mana","manaSpeed",1E3],manaMax:100},{radix:0,name:"Dragon",strID:"dragon",defence:0,attack:25,health:300,maxHealth:300,img:m.dragon.idle,invType:0,invMax:0,dieSound:[],sSizex:2,sSizey:2,dragon:1,iconID:160,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:12,standardFunc:V,url:m.dragon,icons:e,cost:[80,0,0,0,800],attDist:2,spd:128,clss:"drg",size:1,z32:1.5,validator:zg},{radix:0,name:"Carpet",strID:"carpet",
defence:0,attack:0,health:90,maxHealth:90,img:m.carpet.idle,invType:1,invMax:8,dieSound:[],iconID:131,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:8,url:m.carpet,icons:[d.move,d.unload,d.explore,d.stop,d.stand],cost:[80,0,0,0,500],attDist:2,spd:120,clss:"carpet",size:1,z32:1.5,validator:zg},{radix:0,name:"Jinn",strID:"jinn",defence:5,attack:20,health:300,maxHealth:300,img:m.arab_jinn.idle,invType:0,invMax:0,dieSound:[],validator:W,iconID:182,race:"common",zLevel:1,nofreeze:1,attackSound:[],
sight:8,standardFunc:V,url:m.arab_jinn,icons:e,w:1,cost:[80,0,0,0,300],attDist:1,spd:85,clss:"jinn",size:1}];zd={};ni={arr:[]};ab={euro:[],asia:[],arab:[],common:[]};yk=[];Mb=[[],[],[],[],[],[]];n=0;for(k=x.length;n<k;n++){l=x[n];x[n].type=n;var p=l.space;l.name.split(" ").join("");l.population&&yk.put(l);zd[n]={};void 0!==l.storage&&(-1<l.storage?(0===l.storage&&Mb[3].put(n),Mb[l.storage].put(n)):(Mb[0].put(n),Mb[1].put(n),Mb[2].put(n),Mb[3].put(n)));gb[l.race][l.name.toLowerCase().split(" ").join("")]=
l;l.icons.menuName=l.strID;ni[l.name]=n;ni.arr.put(n);l.img||(l.img=l.url);l.maxHealth=l.health;l.race&&ab[l.race].put(l);g=0;f=l.icons;for(h=f.length;g<h;g++)(c=f[g])&&c.obj&&(c.orderOrigin=l);if(p){g=[];l.free=g;c=p[p.length-1];b=(p.length-1)/c;l=c+2;h=b+2;f=new Uint8Array(l*h);for(t=0;t<b;t++)for(var r=0;r<c;r++)f[(t+1)*l+r+1]=p[r+t*c];t=0;for(h*=l;t<h;t++)!f[t]&&(f[t+1]||f[t-1]||f[t+1+l]||f[t+1-l]||f[t-1+l]||f[t-1-l]||f[t+l]||f[t-l])&&(g.put(t%l-1),g.put(~~(t/l)-1))}}ab.euro=ab.euro.concat(ab.common);
ab.asia=ab.asia.concat(ab.common);ab.arab=ab.arab.concat(ab.common);ab[0]=ab.euro;ab[1]=ab.arab;ab[2]=ab.asian;f=gb.euro;h=gb.asia;c=gb.arab;b=gb.common;gb[0]=gb.euro;gb[1]=gb.arab;gb[2]=gb.asia;rd||(e.cut=M({a:"attack",g:"guard",r:"patrol",p:"pickUp",e:"explore",s:"stop",n:"stand"}),f.tavern.icons.cut=M({t:"trade1",g:"gamble",m:"createMercenaries",h:"createHeroes",l:"loan"}),f.castle.icons.cut=M({p:"createPeon",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning"}),
h.castle.icons.cut=M({p:"createPeon1",n:"createNina",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",b:"techBudhism",w:"techGreatwall"}),c.castle.icons.cut=M({p:"createPeon2",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",y:"techSlavery"}),f.barracks.icons.cut=M({f:"createFootman",a:"createArcher",m:"createMaceman",p:"createPikeman",l:"createLongbowman",k:"createKnight"}),h.barracks.icons.cut=M({r:"createRonin",a:"createArcher1",
s:"createSamurai",h:"createHorseArcher1",o:"createHorseSamurai",c:"createChariot"}),c.barracks.icons.cut=M({f:"createFootman2",a:"createArcher2",s:"createSatrap",p:"createPikeman2",h:"createHorseArcher2",c:"createCavalry",j:"createEnichar",d:"createJihad"}),f.magetower.icons.cut=M({m:"createMage"}),h.mageguild.icons.cut=M({m:"createMage1"}),c.mageguild.icons.cut=M({m:"createMage2"}),f.peasant.icons.cut=M({b:"menuBuilds",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",
i:"bribe"}),c.peasant.icons.cut=M({b:"menuBuilds2",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",j:"become_jihadw",i:"bribe"}),h.peasant.icons.cut=M({b:"menuBuilds1",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",t:"trade"}),f.priest.icons.cut=M({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),c.priest.icons.cut=M({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),h.priest.icons.cut=
M({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",r:"raiseexp"}),f.wizard.icons.cut=M({m:"move",a:"attack",s:"stop",n:"stand",l:"lightning",b:"createBat",f:"freeze",t:"createGolem",i:"invisibility"}),c.mage.icons.cut=M({m:"move",a:"attack",s:"stop",n:"stand",c:"spell_spawncarpet",j:"spell_spawnjin",r:"spell_firerain",v:"spell_magicvision",d:"raisedead"}),h.mage.icons.cut=M({m:"move",a:"attack",s:"stop",n:"stand",h:"spell_hypnotize",t:"spell_turntostone",w:"spell_whirlpool",f:"spell_flamebolt",
d:"spell_spawndragon"}),b.spy.icons.cut=M({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",n:"stand",s:"stop"}),h.monk.icons.cut=M({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"}),h.ninja.icons.cut=M({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand",c:"cloak",u:"murder"}),b.catapult.icons.cut=M({a:"attack",g:"guard",p:"patrol",e:"explore",s:"stop",n:"stand",r:"attack_ground",h:"hold_steady"}),f.market.icons.cut=M({c:"createCaravan"}),
c.market.icons.cut=M({c:"createCaravan2"}),h.market.icons.cut=M({b:"market_items",s:"market_sell"}),f.workshop.icons.cut=M({c:"createCatapult",h:"createHeavyCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),c.workshop.icons.cut=M({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),h.workshop.icons.cut=M({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),f.church.icons.cut=M({p:"createPriest"}),c.church.icons.cut=M({p:"createPriest2"}),
h.monastery.icons.cut=M({m:"createMonk",p:"createPriest1"}),c.magicworkshop.icons.cut=M({i:"build_item"}),e=M({c:"buildCastle",s:"buildStorage",b:"buildBarrack",k:"buildBlacksmith",f:"buildFarm",l:"buildLumbermill",p:"buildWorkshop",e:"buildCathedral",u:"buildChurch",n:"buildTavern",m:"buildMageTower",a:"buildStable",r:"buildHarbor",o:"buildOutpost",i:"buildFields",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse",g:"buildGateWood",y:"buildDummy"}),g=M({c:"buildCastle2",k:"buildBlacksmith2",
f:"buildFarm2",n:"buildTavern2",b:"buildBarrack2",p:"buildWorkshop2",s:"buildStorage2",a:"buildStable2",l:"buildLumbermill2",r:"buildHarbor2",o:"buildOutpost2",u:"buildChurch2",e:"buildMosque",i:"buildFields",m:"buildMageTower2",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse2",g:"buildGateWood"}),n=M({c:"buildCastle1",f:"buildFarm1",e:"buildShaolinn",n:"buildTavern1",b:"buildBarrack1",p:"buildWorkshop1",s:"buildStorage1",k:"buildBlacksmith1",a:"buildStable1",l:"buildLumbermill1",r:"buildHarbor1",
o:"buildOutpost1",u:"buildChurch1",i:"buildFields",m:"buildMageTower1",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse1",g:"buildGateWood"}),Ve.cut=n,We.cut=n,Xe.cut=e,Ye.cut=e,Ze.cut=e,$e.cut=n,af.cut=e,bf.cut=n,cf.cut=g,df.cut=g,ef.cut=g,ff.cut=g,f.lumbermill.icons.cut=M({b:"techLongbow",w:"techWoodCutting",c:"techCrossbow"}),c.lumbermill.icons.cut=M({w:"techWoodCutting",c:"techCrossbow"}),h.lumbermill.icons.cut=M({w:"techWoodCutting",c:"techCrossbow"}),f.blacksmith.icons.cut=M({p:"techPlateArmor",
t:"techTemperIron",s:"techScaleArmor",h:"techHalberd",c:"techChainMail"}),c.blacksmith.icons.cut=M({t:"techTemperIron",a:"techScaleArmor",s:"techScimitar",c:"techChainMail",h:"techHalberd"}),h.blacksmith.icons.cut=M({t:"techTemperIron",a:"techScaleArmor",r:"techArmoredChariot",c:"techChainMail"}),f.outpost.icons.cut=M({e:"emergeAllUnits"}),c.outpost.icons.cut=M({e:"emergeAllUnits"}),h.outpost.icons.cut=M({e:"emergeAllUnits"}),b.watchtower.icons.cut=M({a:"attack",s:"stop",g:"upgradeGuildTower"}),b.guardtower.icons.cut=
M({a:"attack",s:"stop",g:"upgradeStoneTower",c:"upgradeCannonTower"}),b.keeptower.icons.cut=M({a:"attack",s:"stop",c:"upgradeCannonTower"}),b.cannontower.icons.cut=M({a:"attack",r:"attack_ground",s:"stop",h:"holdfire"}),h.rockettower.icons.cut=M({a:"attack",r:"attack_ground",s:"stop",f:"fireatwill"}),f.harbor.icons.cut=M({f:"createFishingBoat",x:"createXebec",h:"createHulk",g:"createGalleon",t:"te_landingtactics"}),c.harbor.icons.cut=M({f:"createFishingBoat",h:"createHulk",x:"createXebec",t:"te_landingtactics"}),
h.harbor.icons.cut=M({f:"createFishingBoat",h:"createHulk",x:"createXebec"}),f.farm.icons.cut=M({c:"createCow",f:"techCropRotation",d:"techDomestication"}),c.farm.icons.cut=M({c:"createCow",f:"techDomestication",d:"techDomestication",p:"techCowPoaching",r:"ridingHorses",h:"techHorseManShip"}),h.farm.icons.cut=M({f:"techDomestication",a:"ridingHorses",i:"irrigation"}),f.storage.icons.cut=M({g:"techGoldMining",s:"techStoneMining"}),c.storage.icons.cut=M({g:"techGoldMining",s:"techStoneMining"}),h.storage.icons.cut=
M({g:"techGoldMining",s:"techStoneMining"}),f.cathedral.icons.cut=M({c:"createCrusaders"}),b.magicgateway.icons.cut=M({o:"createOrk",d:"createDwarf",g:"createGhost",s:"createSkeleton"}));e=[f.knight,h.horsesamurai,c.cavalry,c.enichar,f.crusader,h.chariot,h.horsearcher,c.horsearcher];g=[h.horsesamurai,f.crusader,c.enichar];n=[f.knight,c.cavalry,h.chariot,h.horsearcher,c.horsearcher];l=[f.longbowman,c.archer,h.archer,f.archer];t=[b.catapult,b.ballista,b.heavycatapult];k=[b.galleon,b.hulk,b.pinque,b.fishingboat];
p=[b.galleon,b.hulk,b.pinque];r=[c.satrap,f.maceman];var w=[f.longbowman,c.archer,h.archer,f.archer,h.horsearcher,c.horsearcher,b.pinque,b.watchtower,b.keeptower,b.guardtower],u=[b.stonegolem,b.ork,b.dwarf,b.skeleton,b.ghost,b.dragon,b.jinn,b.bat,f.wizard,c.mage,h.mage],v=[f.peasant,h.peasant,c.peasant,f.footman,c.footman,h.ronin,f.pikeman,c.spearman,c.satrap,f.maceman,c.cavalry,c.jihadwarrior,b.spy,c.enichar,h.horsesamurai,h.monk,h.chariot,h.ninja,b.stonegolem,b.ork,b.dwarf,b.jinn,b.skeleton,b.ghost,
f.knight,f.crusader],y=[b.watchtower,b.keeptower,b.guardtower,b.cannontower],z=[b.cannontower,h.rockettower],A=[f.cathedral,f.castle,b.woodenwall,f.barracks,f.lumbermill,f.magetower,f.warriorsguild,f.storage,f.farm,f.merchantsguild,f.church,f.blacksmith,f.stable,f.workshop,f.tavern,f.house,b.watchtower,f.market,f.outpost,b.bridge,f.harbor,b.guardtower,b.keeptower,b.cannontower,h.rockettower,h.castle,c.castle,h.barracks,c.house,c.lumbermill,c.storage,c.farm,c.harbor,c.blacksmith,c.workshop,c.church,
c.tavern,c.market,c.barracks,c.stable,c.outpost,c.mosque,c.mageguild,c.merchantsguild,c.warriorsguild,c.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],C=[f.cathedral,f.castle,b.woodenwall,f.barracks,f.lumbermill,f.magetower,f.warriorsguild,f.storage,f.farm,f.merchantsguild,f.church,f.blacksmith,f.stable,f.workshop,f.tavern,f.house,b.watchtower,f.market,f.outpost,
b.bridge,f.harbor,h.castle,c.castle,h.barracks,c.house,c.lumbermill,c.storage,c.farm,c.harbor,c.blacksmith,c.workshop,c.church,c.tavern,c.market,c.barracks,c.stable,c.outpost,c.mosque,c.mageguild,c.merchantsguild,c.warriorsguild,c.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],D=[b.catapult,b.heavycatapult],G=[f.pikeman,c.spearman],I=[h.monk,h.priest],K=[b.woodenwall],
Q=[f.peasant,h.peasant,c.peasant],R=[f.wizard,c.mage,h.mage],T=[f.footman,c.footman,h.ronin],U=[f.priest,c.priest,h.priest];Db={bless:{img:m.bless,d:0,mv:1},star:{img:m.star,d:0,mv:1},heal:{img:m.healing,d:0,mv:1},impersonate:{img:m.impersonate,d:0,mv:1},select:{img:m.select,d:0,mv:0,select:1,z32:.8},spawn:{img:m.spawn,d:0,mv:1},curse:{img:m.curse,d:0,mv:1},turnStone:{img:m.turn_to_stone,d:0,mv:1}};var N=function(b,c,e){for(var d=b.length,f=0,g=c.length;f<g;f++)for(var h=0;h<d;h++)zd[b[h].type][c[f].type]=
e};N(z,p,4);N(p,p,3);N(p,C,3);N(p,y,3);N(p,K,5);N(p,t,2);N(D,C,4);N(D,k,4);N(D,y,6);N(D,t,4);N(D,K,9);N([h.samurai],g,.5);N([h.samurai],n,.3);N([h.ronin],Q,1);N(G,e,6);N(T,G,1.5);N(T,l,1.5);N(T,[c.jihadwarrior],1);N([c.satrap],Q,2);N(r,t,1.5);N(w,[b.dragon],.75);N(w,[b.bat],1);N(w,[f.pikeman],-.75);N(w,r,1);N(w,[h.chariot],-.3);N(w,I,.5);N(R,U,4);N(U,R,3);N(U,u,3);N(v,[b.bat],-.2);N(v,[b.dragon],-.5);N([b.stonegolem],A,1);N([b.dwarf],A,4);N(u,[h.priest],-.5);qb={img:m.gath_point,x32:-10,y32:-10,d:0,
mv:!0};Ug=[qb];l=xa;e=Object.keys(l);for(g=0;g<x.length;g++)for(t=x[g],n=0;n<e.length;n++)t[e[n]]=l[e[n]];e=[f.archer,f.longbowman,h.archer,h.horsearcher,c.archer,c.horsearcher];g=[f.footman,f.maceman,f.knight,f.crusader,f.pikeman,c.jihadwarrior,c.cavalry,c.footman,c.enichar,f.peasant,c.peasant,c.satrap,c.spearman,b.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,b.skeleton,b.ghost,b.ork,b.dwarf];n=[f.footman,f.maceman,f.knight,f.crusader,f.pikeman,c.jihadwarrior,c.cavalry,
c.footman,c.enichar,f.peasant,c.peasant,c.satrap,c.spearman,b.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,f.archer,f.longbowman,h.archer,h.horsearcher,c.archer,c.horsearcher,f.wizard,c.mage,h.mage,f.priest,c.priest,h.priest,b.skeleton,b.ghost,b.ork,b.dwarf];E=[{name:["Longbow","Allows the production of longbowmen"],next:[d.createLongbowman],cost:[400,0,0,0],time:45,type:Z},{name:["Gold Mining","Increases gold production"],increase:2,value:"gold",cost:[400,0,0,0],time:20,
type:ia},{name:["Stone Mining","Increases stone production"],increase:2,value:"stone",cost:[400,0,0,0],time:20,type:ia},{name:["Wood Cutting","Increases wood production"],increase:2,value:"wood",cost:[400,0,0,0],time:20,type:ia},{name:["Temper Iron","Increases hand-to-hand units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:g,next:[d.techHalberd],type:Cb},{name:["Scale Armor","Increases unit's defense"],increase:1,value:"defence",cost:[400,0,0,0],time:30,group:n,next:[d.techChainMail],
type:Cb},{name:["Halberd","Allows the production of spear units"],next:[d.createPikeman,d.createPikeman2],cost:[400,0,0,0],time:30,type:Z},{name:["Domestication","Allows the production of cows"],next:[d.createCow],cost:[300,0,0,0],time:20,type:Z},{name:["Crop Rotation","Increases the production of fields"],increase:2,value:"food",cost:[400,0,0,0],time:20,type:ia,next:[d.irrigation]},{name:["Chain Mail","Increases unit's defense"],increase:2,value:"defence",cost:[400,0,0,0],time:30,group:n,type:Cb},
{name:["Plate Armor","Allows the production of knights"],next:[d.createKnight],cost:[400,0,0,0],time:60,type:Z},{name:["Crossbow","Increases arrow units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:e,type:Cb},{name:["Feudalism","Makes peasants cheaper"],cost:[300,0,0,0],time:30,decrease:[h.peasant,[0,0,8,0],f.peasant,[0,0,10,0],c.peasant,[0,0,10,0]],type:Hh,next:[d.techSlavery]},{name:["Architecture","Peasants build faster, and allows stone wall, gate and towers"],increase:.5,
value:"buildSpeed",cost:[300,0,0,0],time:30,type:ia,next:[d.upgradeStoneTower,d.techGreatWall,d.buildBridge]},{name:["Learning","Allows units to gather experience"],increase:1,value:"experience",cost:[400,0,0,0],time:30,type:ia,next:[d.buildAcademy,d.buildAcademy1,d.buildAcademy2]},{name:["Convert Resources",""],cost:[400,0,0,0],time:30},{name:["Map Making","Allows the production of galleons"],cost:[800,0,0,0],time:30,type:Z},{name:["Trade Routes","Allows trading"],cost:[400,0,0,0],time:30,type:Z,
next:[d.techTradeTaxes]},{name:["Trade Taxes","Increases trade profit"],cost:[400,0,0,0],time:30},{name:["Usury","Allows the obtaining of loans in taverns"],cost:[300,0,0,0],time:30,type:Pf,next:[d.techBanking]},{name:["Supply Storage","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:ia,value:"popLimit",next:[d.techSeaFood]},{name:["Bribery","Allows the bribing of enemy units"],cost:[600,0,0,0],time:60,type:Z,next:[d.bribe]},{name:["Heroism","Allows unlimited experience"],
cost:[500,0,0,0],time:30,increase:Infinity,value:"maxLevel",type:ia,next:[d.techLeadership]},{name:["Warfare","Gain experience faster"],cost:[400,0,0,0],time:30,type:ia,increase:1,value:"experience",next:[d.techTactics]},{name:["Tactics","Gain experience faster"],cost:[800,0,0,0],time:30,type:Z,next:[d.buildDummy,d.techSunTzu]},{name:["Mercenaries","Allows the recruitment of units in taverns"],cost:[600,0,0,0],time:30,type:Pf,next:[d.techHeroes,d.createMercenaries],actvintv:[d.iniMercenaries]},{name:["Heroes' Quest",
"Allows the recruitment of heroes in taverns"],cost:[800,0,0,0],time:30,type:Pf,next:[d.techFame,d.createHeroes],actvintv:[d.iniHeroes]},{name:["Fame","Recruit better units from taverns"],cost:[500,0,0,0],time:30,value:"fameTech",increase:1,type:ia},{name:["Siege Tactics","Allows the production of heavy catapults"],cost:[1200,0,0,0],time:60,type:Z,next:[d.createHeavyCatapult]},{name:["Body Building","Increases unit's hit points at every new level"],cost:[800,0,0,0],time:60,value:"healthJump",increase:5,
type:ia},{name:["Espionage","Allows the production of a spy"],cost:[400,0,0,0],time:30,type:Z,next:[d.createSpy]},{name:["Fanaticism","Increases the building's resistance"],cost:[400,0,0,0],time:30,type:Cb,group:[],increase:5,value:"resistance",next:[d.techCrusade,d.techJihad]},{name:["Crusade","Allows the preaching of a crusade"],cost:[1200,0,0,0],time:180,type:Z,next:[d.createCrusaders]},{name:["Inquisition","Increases priest attack"],cost:[400,0,0,0],time:30,type:Cb,group:[f.priest,c.priest,h.priest],
increase:5,value:"attack"},{name:["Healing","Allows healing of units"],cost:[400,0,0,0],time:30,next:[d.techMedicine,d.healing],type:Z},{name:["Medicine","Allows remote healing of units"],cost:[500,0,0,0],time:30,value:"healingRange",increase:5,type:ia},{name:["Bless","Temporarily increases unit attack skill"],cost:[400,0,0,0],time:30,type:Z,next:[d.bless]},{name:["Invisibility","Invisibility spell"],cost:[500,0,0,0],time:30,type:Z,next:[d.invisibility]},{name:["Bat","Researches bat summoning"],cost:[400,
0,0,0],time:240,type:Z,next:[d.createBat]},{name:["Freeze","Freeze spell"],cost:[800,0,0,0],time:30,type:Z,next:[d.freeze]},{name:["Lightning","Lightning spell"],cost:[400,0,0,0],time:30,type:Z,next:[d.lightning]},{name:["Stone Golem","Researches stone golem summoning"],cost:[800,0,0,0],time:120,type:Z,next:[d.createGolem]},{name:"Upgrade to Guard Tower",cost:[0,600,0,0],time:20,type:Of,obj:44,upgrade:1},{name:"Upgrade to Stone Tower",cost:[0,0,0,500],time:30,type:Of,obj:55,upgrade:1},{name:"Upgrade to Cannon Tower",
cost:[0,0,0,500],time:30,type:Of,obj:56,upgrade:1},{name:["Buddhism"],cost:[400,0,0,0],time:30,type:Z,next:[d.buildCathedral1]},{name:["Cannon Tower","Allows the building of cannon towers"],next:[d.upgradeCannonTower],cost:[400,0,0,0],time:30,type:Z},{name:["Engineering","Increases siege weapon's attack"],increase:5,value:"attack",cost:[400,0,0,0],time:30,group:[b.ballista,b.catapult,b.heavycatapult],type:Cb},{name:["Great Wall","Makes stone walls, towers and gates stronger"],cost:[600,0,0,0],time:30,
type:Z},{name:["Art of Riding","Allows the production of horse archers"],cost:[500,0,0,0],time:30,type:Z,next:[d.createHorseArcher1,d.createHorseArcher2,d.techHorseManShip]},{name:["Irrigation","Increases field production"],increase:4,value:"food",cost:[400,0,0,0],time:30,type:ia},{name:["Armored Chariot","Allows the production of armored chariots"],cost:[500,0,0,0],time:60,type:Z,next:[d.createChariot]},{name:["Meditation","Makes monks cheaper"],cost:[300,0,0,0],time:30,decrease:[0,0,50,0],type:Gh,
next:[d.techPhilosophy],group:[h.monk]},{name:["Kung-Fu","Increases the attack of all kung-fu units"],cost:[400,0,0,0],time:30,type:Cb,increase:1,value:"attack",group:[h.peasant,h.ninja,h.monk,h.priest],next:[d.techMastery,d.techNinjas,d.techTournaments]},{name:["Tournaments","Allows sharing of experience between kung-fu units"],cost:[800,0,0,0],time:30,type:Z,next:[]},{name:["Philosophy","Allows the production of more experienced monks"],cost:[400,0,0,0],time:30,type:Cb,increase:2,value:"level",
group:[h.monk,h.priest],next:[d.createPriest1]},{name:["Ninjas","Allows the production of ninjas"],cost:[500,0,0,0],time:30,type:Z,next:[d.createNinja]},{name:["Mastery","Allows priests to teach kung-fu units"],cost:[500,0,0,0],time:30,type:Z,next:[d.teach]},{name:["Concentration","Allows faster manna restoration"],cost:[600,0,0,0],time:80,type:Z,next:[d.techConfusion]},{name:["Confusion","Researches the Confusion spell"],cost:[400,0,0,0],time:30,type:Z,next:[d.confusion]},{name:["Whirlpool","Researches the Whirlpool spell"],
cost:[300,0,0,0],time:30,type:Z,next:[d.whirlpool]},{name:["Dragon","Researches Dragon summoning"],cost:[800,0,0,0],time:300,type:Z,next:[d.createDragon]},{name:["Turn to Stone","Researches the Turn to Stone spell"],cost:[300,0,0,0],time:30,type:Z,next:[d.turnToStone]},{name:["Flame Bolt","Researches the Flame Bolt spell"],cost:[400,0,0,0],time:30,type:Z,next:[d.techDragon,d.flameBolt]},{name:["Jewelry","Allows trading of items"],cost:[400,0,0,0],time:30,type:Z,next:[d.sellItems,d.buyItems]},{name:["Banking",
"Increases trade profit"],cost:[600,0,0,0],time:30,type:Z},{name:["Chemistry","Increases arrow units' attack power"],cost:[500,0,0,0],time:30,type:Cb,group:e,increase:1,value:"attack",next:[d.techGunPowder]},{name:["Sea Food","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:ia,value:"popLimit"},{name:["Gun Powder","Increases cannon tower's attack power"],cost:[500,0,0,0],time:30,type:Cb,increase:10,value:"attack",group:[b.cannontower],next:[d.techRocketArrow]},{name:["Rocket Arrow",
"Allows the building of rocket tower"],cost:[800,0,0,0],time:30,type:Z,next:[d.buildRocketTower]},{name:["Bushido","Allows the production of horse samurai"],cost:[800,0,0,0],time:120,type:Z,next:[d.createHorseSamurai]},{name:["Leadership","Units around a hero gain experience"],cost:[600,0,0,0],time:30,type:Z,next:[d.techHonor]},{name:["Honor","Hero vs. hero attack bonus"],cost:[500,0,0,0],time:30,type:Z},{name:["Sun Tzu's Book","Increases the speed of learning"],cost:[800,0,0,0],time:30,type:ia,increase:1,
value:"experience"},{name:["Cow Poaching","Allows peasants to steal cows"],cost:[200,0,0,0],time:30,type:ia,increase:1,value:"stealCows"},{name:["Horsemanship","Makes mounted units cheaper"],cost:[500,0,0,0],time:30,type:Gh,mulp:.75,group:[h.horsearcher,c.cavalry,c.horsearcher]},{name:["Scimitar","Increases sword attack power and allows the production of satraps"],cost:[400,0,0,0],time:30,type:Cb,increase:1,value:"attack",group:g,next:[d.createSatrap]},{name:["Jihad","Allows the production of Jihad Warriors"],
cost:[1200,0,0,0],time:30,type:Z,next:[d.createJihad,d.convertJihad]},{name:["Magic Carpet","Researches Magic Carpet summoning"],cost:[300,0,0,0],time:30,type:Z,next:[d.createCarpet,d.techJinn]},{name:["Magic Workshop","Allows the building of a magic workshop"],cost:[1200,0,0,0],time:180,type:Z,next:[d.buildMagicWorkshop]},{name:["Rain of Fire",""],cost:[800,0,0,0],time:60,type:Z,next:[d.fireRain]},{name:["Magic Vision","Researches the Magic Vision spell"],cost:[400,0,0,0],time:30,type:Z,next:[d.magicVision]},
{name:["Necromancy","Researches the Raise the Dead spell"],cost:[400,0,0,0],time:30,type:Z,next:[d.raiseDead]},{name:["Jinn","Researches Jinn summoning"],cost:[600,0,0,0],time:300,type:Z,next:[d.createJinn]},{name:["Ore Enrichment","Increases mine production"],cost:[800,0,0,0],time:30,type:ia,increase:1,value:"miningPerf"},{name:["Riding Horses","Increases the mounted units' attack and defense power"],cost:[500,0,0,0],time:30,type:Dj,values:["attack",2,"defence",1],group:[h.horsearcher,c.cavalry,
c.horsearcher],next:[d.techJanissary]},{name:["Janissary","Allows the production of Janissaries"],cost:[1200,0,0,0],time:120,type:Z,next:[d.createEnichar]},{name:["Slavery","Makes peasants cheaper"],cost:[200,0,0,0],time:30,decrease:[h.peasant,[0,0,7,0],f.peasant,[0,0,8,0],c.peasant,[0,0,8,0]],type:Hh}];$i();d.buildMarket.disabled=1;zk();n=0;for(k=x.length;n<k;n++)if(l=x[n],l.onbuild)for(f=l.onbuild,g=0,h=f.length;g<h;g++)c=f[g],c.obj.race==l.race&&(c.disabled=1,c.requireObj||(c.requireObj=[]),c.requireObj.put(l));
g=0;for(h=E.length;g<h;g++)if(c=E[g],c.tech=1,c.id=g,c.next)for(f=c.next,t=0,n=f.length;t<n;t++)l=f[t],l.disabled?(l.disabled++,l.requireObj.put(c)):(l.requireObj=[c],l.disabled=1);g=0;f=x;for(h=f.length;g<h;Fl(f[g++]));}new Xb("",[255,255,255],[0],!0)},x,zd,ni,qb,Ug,yk,oi=8,y=new Float32Array(16),dd=function(c,b,e,d,g,h,l){var f=x[c];if(f.ignore)return f.invalid=!0,!1;if(h=h&&!f.instantBuild)this.built=!1;var k=C[b],m=k.mod[c],r=Object.keys(m);this.__proto__=f;this.kingdom=b;this.d=g;this.x32=e;
this.y32=d;this.taskList=[];g=0;for(var u=r.length;g<u;this[r[g]]=m[r[g++]]);if(l)for(m=Object.keys(l),g=0,u=m.length;g<u;this[m[g]]=l[m[g++]]);0<f.invMax&&(this.inventory=[]);20==f.type&&(this.lastUse=p.cycle);f.build||(this.mv=1);l=k.technology.disabled;m=f.actvintv;this.workers=[];this.id=u=z.length;f.rndDirection&&(this.d=u*e%f.rndDirection);this.build||this.item||this.cow||k.values.pop++;e=f.validator(e,d,f.space,b);if(e[1]||h){d=f.validator.dimension;r=e[0];if(h){var w=ib[b];g=0;for(f=r.length;g<
f;g++)w[r[g]]=u;k.building.put(u)}else for(g=0,f=r.length;g<f;d[r[g++]]=u);if(e[2]&&(r=e[2],!h))for(g=0,f=r.length;g<f;d[r[g++]]=0);}else return this.invalid=!0,!1;z[u]=this;h||Ja[b][c].put(u);if(this.update&&!p.custom)for(c=this.update,g=0,u=c.length;g<u;g+=3)ob({func:Ef,data:[this.id,c[g],c[g+1],c[g+2]]},c[g+2],1);if(m)for(c=0,f=m.length;c<f;c++)b=m[c],l[b.id]||b(this);h?(mb(this),v.kingdom==this.kingdom?Gd(this,Jl):Gd(this,zh)):(mb(this),ph(this));this.level&&!this.potion&&zj(this);!this.standardFunc||
this.func||p.editor||h||this.standardFunc(this);h=k.stats;h.unitCount[this.type]++;k=h.unitCount[this.type]-h.unitCountDeath[this.type];k>h.unitCountMax[this.type]&&(h.unitCountMax[this.type]=k)},Ij=function(c){var b=C[c.kingdom];if(c.population){var e=c.population;b.values.popMax+=e;le(c.kingdom);for(var d=0;d<e;d++)b.checkPopArray()}if(c.onbuild)for(c=c.onbuild,e=b.technology,b=e.disabled,e=e.actived,d=0;d<c.length;d++){var g=c[d].id;e[g]||(e[g]=0);e[g]++;e[g]-1||(b[g]--,!b[g]&&pa.actv[g]&&pa(Q.active))}},
jc=[],T=new Float32Array(12),pi=function(c,b,e){var d=c.length;c[d]=b;c[d+1]=b+1;c[d+2]=b+2;c[d+3]=b+1;c[d+4]=b+2;c[d+5]=b+3;c.changed=!0;e.typeBuffer=c;e.elemtId=d},Gd=function(c,b){var e=b[3];if(b.noAlpha)d=fa;else{c.alpha=!0;var d=ya}if(c.typeBuffer!==d){if(b==zh){if(yb.diplomacy[c.kingdom]){Qb(c);return}b=new Float32Array(db(Sa[3*c.kingdom],Sa[3*c.kingdom+1],Sa[3*c.kingdom+2],e+1))}Qb(c);pi(d,c.bufferID,c)}k.bindBuffer(k.ARRAY_BUFFER,Ib);k.bufferSubData(k.ARRAY_BUFFER,16*c.bufferID,b)},Ac=function(c){var b=
Ag(c,c.kingdom),e=b[0],d=b[1],g=b[2];b=b[3];var h=c.bufferID;Ak(e,d,g,b,c.bufferID);1>b?(c.alpha=!0,e=ya):e=fa;c.typeBuffer!==e&&(Qb(c),pi(e,h,c));if(c.child&&(!1!==c.built||!c.build))for(var l=c.child,k=0,m=l.length;k<m;k++)h+=4,b=Ag(l[k],c.kingdom),e=b[0],d=b[1],g=b[2],b=b[3],Ak(e,d,g,b,h)},Ag=function(c,b){if(null!=c.rgb){var e=c.rgb;c=e[0];var d=e[1];b=e[2];e=e[3]}else Ca[c.img][3]?(c=Sa[3*b],d=Sa[3*b+1],b=Sa[3*b+2],e=2):(c.mMapcolor?(b=c.mMapcolor,c=b[0]/255,d=b[1]/255,b=b[2]/255):(c=Sa[3*b],
d=Sa[3*b+1],b=Sa[3*b+2]),e=1);return[c,d,b,e]},Bk=function(){if(jc.length){var c=jc[jc.length-1];jc.length--}else c=oi,oi+=4;return c},mb=function(c,b,e,d){void 0==b&&(d=e=b=0);var f=Ca[c.img],h=1;if(c.bufferID){var l=c.bufferID;h=0}else l=Bk();c.bufferID=l;f||J(c);var m=f[2]*c.d*6+4,t=f[4+m],n=f[5+m];m=f[0];var r=f[1];0<=r&&(r*=.001);var u=f.id+4*c.d*f[2],w=-1;c.mv&&(w=p.now());y[0]=u;y[1]=w;y[2]=m;y[3]=r;y[4]=u+1;y[5]=w;y[6]=m;y[7]=r;y[8]=u+2;y[9]=w;y[10]=m;y[11]=r;y[12]=u+3;y[13]=w;y[14]=m;y[15]=
r;var v=32*c.x32,x=32*c.y32;m=32*c.y32;null!=c&&null!=c.z32&&(m*=c.z32);var z=fa;k.bindBuffer(k.ARRAY_BUFFER,td);k.bufferSubData(k.ARRAY_BUFFER,16*l,y);k.bindBuffer(k.ARRAY_BUFFER,Fc);if(c.rotation){var A=c.rotation;A*=2*Math.PI;var C=.5*f[8];r=.5*f[9];f=-1*m;u=-C;w=-r;var D=0*T.length;T[D]=u*Math.cos(A)-r*Math.sin(A)+v;T[D+1]=r*Math.cos(A)+u*Math.sin(A)+x;T[D+2]=f;T[D+3]=u*Math.cos(A)-w*Math.sin(A)+v;T[D+4]=w*Math.cos(A)+u*Math.sin(A)+x;T[D+5]=f;T[D+6]=C*Math.cos(A)-r*Math.sin(A)+v;T[D+7]=r*Math.cos(A)+
C*Math.sin(A)+x;T[D+8]=f;T[D+9]=C*Math.cos(A)-w*Math.sin(A)+v;T[D+10]=w*Math.cos(A)+C*Math.sin(A)+x;T[D+11]=f}else c.wh?(A=c.wh[0],C=c.wh[1],A-=t,C-=n,T[0]=v,T[1]=x,T[2]=m,T[3]=v+A,T[4]=x,T[5]=m,T[6]=v,T[7]=x+C,T[8]=m,T[9]=v+A,T[10]=x+C):(T[0]=v,T[1]=x,T[2]=m,T[3]=v,T[4]=x,T[5]=m,T[6]=v,T[7]=x,T[8]=m,T[9]=v,T[10]=x),T[11]=m;k.bufferSubData(k.ARRAY_BUFFER,12*l,T);w=Ag(c,c.kingdom);f=w[0];r=w[1];u=w[2];w=w[3];if(1>w||c.alpha)c.alpha=!0,z=ya;k.bindBuffer(k.ARRAY_BUFFER,Ib);y[0]=f;y[1]=r;y[2]=u;y[3]=
w;y[4]=f;y[5]=r;y[6]=u;y[7]=w;y[8]=f;y[9]=r;y[10]=u;y[11]=w;y[12]=f;y[13]=r;y[14]=u;y[15]=w;k.bufferSubData(k.ARRAY_BUFFER,16*l,y);k.bindBuffer(k.ARRAY_BUFFER,Td);A=p.now();y[0]=b;y[1]=e;y[2]=d;y[3]=A;y[4]=b;y[5]=e;y[6]=d;y[7]=A;y[8]=b;y[9]=e;y[10]=d;y[11]=A;y[12]=b;y[13]=e;y[14]=d;y[15]=A;k.bufferSubData(k.ARRAY_BUFFER,16*l,y);h&&pi(z,l,c);if(c.child&&!1!==c.built)for(b=m,e=c.child.length,d=[],c.childLoc=d,h=0;h<e;h++){z=c.child[h];f=Ca[z.img];m=f[2]*c.d*6+4;A=f[4+m];C=f[5+m];m=f[0];r=f[1];0<=r&&
(r*=.001);u=f.id+4*c.d;w=-1;z.mv&&(w=1);y[0]=u;y[1]=w;y[2]=m;y[3]=r;y[4]=u+1;y[5]=w;y[6]=m;y[7]=r;y[8]=u+2;y[9]=w;y[10]=m;y[11]=r;y[12]=u+3;y[13]=w;y[14]=m;y[15]=r;w=Ag(z,c.kingdom);f=w[0];r=w[1];u=w[2];w=w[3];D=v;var E=x;z.wh1&&(A=z.wh[0],C=z.wh[1]);z.center&&(D-=.5*~~(A-t),E-=.5*~~(C-n));l=Bk();k.bindBuffer(k.ARRAY_BUFFER,td);k.bufferSubData(k.ARRAY_BUFFER,16*l,y);k.bindBuffer(k.ARRAY_BUFFER,Ib);y[0]=f;y[1]=r;y[2]=u;y[3]=w;y[4]=f;y[5]=r;y[6]=u;y[7]=w;y[8]=f;y[9]=r;y[10]=u;y[11]=w;y[12]=f;y[13]=
r;y[14]=u;y[15]=w;k.bufferSubData(k.ARRAY_BUFFER,16*l,y);m=z.z?32*z.z+b:b;k.bindBuffer(k.ARRAY_BUFFER,Fc);T[0]=D;T[1]=E;T[2]=m;T[3]=D;T[4]=E;T[5]=m;T[6]=D;T[7]=E;T[8]=m;T[9]=D;T[10]=E;T[11]=m;k.bufferSubData(k.ARRAY_BUFFER,12*l,T);k.bindBuffer(k.ARRAY_BUFFER,Td);y[0]=0;y[1]=0;y[2]=0;y[3]=0;y[4]=0;y[5]=0;y[6]=0;y[7]=0;y[8]=0;y[9]=0;y[10]=0;y[11]=0;y[12]=0;y[13]=0;y[14]=0;y[15]=0;k.bufferSubData(k.ARRAY_BUFFER,16*l,y);m=1>w?ya:z.light?Ea:fa;d.put(m);A=m.length;d.put(A);m[A]=l;m[A+1]=l+1;m[A+2]=l+2;
m[A+3]=l+1;m[A+4]=l+2;m[A+5]=l+3;m.changed=!0}},Oc=function(c,b,e,d){var f=p.now(),h=c.bufferID;y[0]=b;y[1]=e;y[2]=d;y[3]=f;y[4]=b;y[5]=e;y[6]=d;y[7]=f;y[8]=b;y[9]=e;y[10]=d;y[11]=f;y[12]=b;y[13]=e;y[14]=d;y[15]=f;k.bindBuffer(k.ARRAY_BUFFER,Td);k.bufferSubData(k.ARRAY_BUFFER,16*h,y);k.bindBuffer(k.ARRAY_BUFFER,null);if(c.tempChild)for(f=0,c=c.tempChild,h=c.length;f<h;Oc(c[f++],b,e,d));},li=function(c,b,e,d,g,h){Ga[0]=c;Ga[1]=b;Ga[2]=e;Ga[3]=c+d;Ga[4]=b;Ga[5]=e;Ga[6]=c;Ga[7]=b+g;Ga[8]=e;Ga[9]=c+d;
Ga[10]=b+g;Ga[11]=e;k.bindBuffer(k.ARRAY_BUFFER,Fc);k.bufferSubData(k.ARRAY_BUFFER,12*h,Ga);k.bindBuffer(k.ARRAY_BUFFER,null)},Ak=function(c,b,e,d,g){y[0]=c;y[1]=b;y[2]=e;y[3]=d;y[4]=c;y[5]=b;y[6]=e;y[7]=d;y[8]=c;y[9]=b;y[10]=e;y[11]=d;y[12]=c;y[13]=b;y[14]=e;y[15]=d;k.bindBuffer(k.ARRAY_BUFFER,Ib);k.bufferSubData(k.ARRAY_BUFFER,16*g,y);k.bindBuffer(k.ARRAY_BUFFER,null)},pb=function(c,b,e){void 0==e&&(e=32);c.z32&&(b*=c.z32);var d=c.x32*e;e*=c.y32;c.wh?li(d,e,b,c.wh[0]-Ca[c.img][8],c.wh[1]-Ca[c.img][9],
c.bufferID):li(d,e,b,0,0,c.bufferID);if(c.tempChild)for(b=c.tempChild,d=0,e=b.length;d<e;d++){var g=b[d];g.x32=c.x32;g.y32=c.y32;pb(g,32*c.y32)}},xa={getRadix:function(){return xb[this.zLevel]},checkMana:function(c,b,e,d){if(!this.mana)return!1;if(0>this.mana-c)return this.manaTask=[e.url,b,c],this.stay55(),c>this.manaMax&&d&&(this.blockedCost=d,b=this.setupChild(Db.curse,1),this.blocked=2,this.blockedimg=b,this.manaTarget=c,k.bindBuffer(k.ARRAY_BUFFER,Ib),k.bufferSubData(k.ARRAY_BUFFER,16*this.bufferID,
Hf),k.bufferSubData(k.ARRAY_BUFFER,16*b.bufferID,Hf)),!1;this.mana-=c;return!0}},Bc=function(c,b){return p.editor?!0:c.freezed||c.confused?!1:C[c.spy||c.kingdom].control[b.spy||b.kingdom]};xa.changeKingdom=function(c){Ja[this.kingdom][this.type].quit(this.id);Cc[this.id]&&(Cc[this.id]=0,K.quit(this.id),0==K.length&&(pa([]),Se(),lc=-1),fi(this.id));this.kingdom=c;Ac(this);this.childBuild&&(this.childBuild=0);if(!this.build||this.arrow)p.editor||this.stay();Ja[c][this.type].put(this.id)};xa.aspettare=
function(){this.nodes=void 0;this.getRadix()[this.x32+this.y32*G]=this.id;this.waiting=!0;na(this,this.url.idle);Oc(this,0,0,0);Nb(this,~~(32E3/this.spd))};xa.addItem=function(c){var b=this.inventory;b&&(b[b.length]=c.id,c.in=this.id,c.sword||c.shield)&&(c.attack&&(this.attack+=c.attack),c.defence&&(this.defence+=c.defence))};xa.showInventory=function(){hi();for(var c=this.inventory,b=0;8>b;b++){var e=c[b];if(!e)break;var d=Wa[b];d.style.backgroundPosition="0px "+48*e.iconID+"px";d.className="";ug[b]=
null}};xa.deleteItem=function(c){this.inventory.quit(c.id);this.attack-=c.attack;this.defence-=c.defence};xa.useItem=function(c){48==c.type&&(this.health+=c.lives,this.health>this.maxHealth&&(this.maxHealth=this.health),this.inventory.quit(c.id))};xa.onattack=function(c){!this.attack||this.freezed||this.death||this.func!=qd.url&&this.func||xc(c.id,[this.id],1)};xa.setupINTV=function(c,b,e,d){this.funcObj=b;c.url||J(c,c.url);Ii(this);this.changeFunc(c.url,d);this.deleteWorker();Nb(this,e);return e};
xa.damage=function(c,b){if(!(this.zolotoy||this.death||this.stoned)){this.defence&&(c-=this.defence);1>c&&(c=1);this.health-=c;b=C[b.kingdom].stats;b.dmgInflicted+=c;var e=C[this.kingdom].stats;e.dmgTaken+=c;1>this.health?(this.build?(e.buildsLosed++,b.buildsKilled++):(e.unitsLosed++,b.unitsKilled++),this.die()):ba(this.id,1)}};var ba=function(c,b){if(Cc[c]||!1===c)return c=K.length,1===c?(c=z[K[0]],Q.stockActive==c&&c.inventory.length?(hd(c.id,1,1),hk(c,1)):c.build?Va(c,1):hd(c.id,b)):1<c?gi(K,b):
sk(zb),!0};xa.setupSpellIMG=function(c){this.invisible&&Fd(this.id);this.url.spell?(na(this,this.url.spell,1),c||ob({func:Ck,data:this.id},eb(this.img),1)):this.stay()};var Ck=function(c){c=z[c];c.death||c.stay()};xa.setupChild=function(c,b,e){var d={x32:this.x32,y32:this.y32,d:c.d,img:c.img,mv:c.mv,parent:this.id,z32:c.z32};if((this.dix||this.diy)&&!this.waiting){var g=.001*(p.now()-this.timestamp);d.x32+=this.dix*g/32-Math.sign(this.dix);d.y32+=this.diy*g/32-Math.sign(this.diy)}if(c.select){if(this.space)c=
this.space[this.space.length-1],h=(this.space.length-1)/c;else{c=this.sSizex||1;var h=this.sSizey||1}this.z32&&(d.z32=this.z32);d.wh=[32*c-3,32*h-3];this.selectAnim=d}mb(d);g&&Oc(d,this.dix,this.diy,0);e&&(k.bindBuffer(k.ARRAY_BUFFER,Ib),k.bufferSubData(k.ARRAY_BUFFER,16*d.bufferID,e));this.tempChild||(this.tempChild=[]);this.tempChild.put(d);b||hc.new(d,eb(d.img),Dk);return d};var Dk=function(c){z[c.parent].tempChild.quit(c);Qb(c)};xa.distance=0;var na=function(c,b,e,d){c.img=b;Ca[b]||J(b);(b=Ca[b])||
J(c);var f=b[0],h=b[1];0<=h&&(h*=.001);d&&(h*=d);b=b.id+4*c.d*b[2];d=-1;1===e?d=p.now():0>e&&(d=1);e=d;c=c.bufferID;y[0]=b;y[1]=e;y[2]=f;y[3]=h;y[4]=b+1;y[5]=e;y[6]=f;y[7]=h;y[8]=b+2;y[9]=e;y[10]=f;y[11]=h;y[12]=b+3;y[13]=e;y[14]=f;y[15]=h;k.bindBuffer(k.ARRAY_BUFFER,td);k.bufferSubData(k.ARRAY_BUFFER,16*c,y);k.bindBuffer(k.ARRAY_BUFFER,null)};xa.setupDir=function(c,b,e){c=Math.sign(c);b=Math.sign(b);c=3*(b-1)+(c+1);2==c?this.d=1:-6==c?this.d=5:0==c?this.d=7:-4==c?this.d=3:-1==c?this.d=2:1==c?this.d=
0:-5==c?this.d=4:-3==c&&(this.d=6);e&&(this.d=(this.d+e)%8)};xa.setupDirBuild=function(c){var b=N;1==c.health&&0==c.built&&(b=ib[c.kingdom]);c=c.id;var e=G,d=this.x32+this.y32*e;b[d+e]==c?this.d=0:b[d-e]==c?this.d=4:b[d+1]==c?this.d=2:b[d-1]==c?this.d=6:b[d+e+1]==c?this.d=1:b[d-e+1]==c?this.d=3:b[d+e-1]==c?this.d=7:b[d-e-1]==c&&(this.d=5)};xa.spdMod=0;var Wf=function(c,b){for(var e=b.length,d=0;d<e;d++){var g=z[b[d]];g.build||(g.spd=c)}};xa.changeFunc=function(c,b){var d=this.func;this.func=c;if(Yd){if(void 0!==
this.workingOn)var f=z[this.workingOn];(d=Ob[d])&&d.rule&&sh(-1,this,d.rule,f);(c=Ob[c])&&c.rule&&sh(1,this,c.rule,b)}};xa.stay=function(c){this.mv=1;this.time=void 0;this.diy=this.dix=0;this.nodes=this.c=void 0;this.xf=null;Oc(this,0,0,0);if(!c){c=this.action==Ed.url||this.func==Tf.url;this.changeFunc(void 0);this.stock&&0!==this.stock[0]?na(this,this.img,NaN):na(this,this.__proto__.img,1);this.buildList&&(this.buildList=void 0);this.deleteWorker();if(this.standardFunc&&2!==this.stop&&void 0==this.spy)return this.standardFunc(this);
c&&qd(this)}};xa.stay55=function(){this.changeFunc(void 0);this.stock&&0!==this.stock[0]?na(this,this.img,NaN):na(this,this.__proto__.img,1);this.deleteWorker();this.standardFunc&&2!==this.stop&&void 0==this.spy&&this.standardFunc(this)};var mm=[],Qb=function(c){c.elemtId&&(Ek(c.elemtId,c.typeBuffer),c.elemtId=void 0,c.typeBuffer=void 0)},Fh=function(c){if(c.childLoc){c=c.childLoc;for(var b=0,d=c.length;b<d;b+=2)Ek(c[b+1],c[b])}},Ek=function(c,b){b[c]=NaN;b[c+1]=NaN;b[c+2]=NaN;b[c+3]=NaN;b[c+4]=NaN;
b[c+5]=NaN;b.changed=!0;mm.put(c)};xa.addWorker=function(c){this.workers.put(c.id);c.workingOn=this.id};xa.deleteWorker=function(){this.workingOn&&(z[this.workingOn].workers.quit(this.id),this.workingOn=0);this.actionItem&&(this.actionItem=void 0);this.blockedAction()};xa.blockedAction=function(c){var b=this.blocked;if(Fk[b])Fk[b](this,c)};var Fk={2:function(c,b){c.blocked=void 0;Ac(c);Dk(c.blockedimg);c.blockedimg=void 0;c.manaTarget=void 0;b||(C[c.kingdom].setupResources(c.blockedCost,-1),c.blockedCost=
void 0)}},ak=function(c){return m.delay[-c[1]+c[0]-1]},pe=function(c){var b=K.length;K.quit(c);if(b!=K.length){var d=z[c];d.selectAnim=void 0;b=0;for(d=d.tempChild;b<d.length;b++){var f=d[b];Qb(f);var g=d.length;d.quit(f);g!=d.length&&b--}Cc[c]=void 0;0==K.length?Se():1==K.length?hd(c):gi(K)}zb&&zb.id===c&&(Se(),zb.selectAnim&&(Qb(zb.selectAnim),zb.selectAnim=void 0),zb=void 0)};xa.base=function(c){return xb[this.zLevel][c]};xa.rbase=function(){return xb[this.zLevel]};var og,ei=function(c){jc.put(c.bufferID);
if(c.child){var b=0;c=c.childLoc;for(var d=c.length;b<d;b+=2)jc.put(c[b][c[b+1]])}};xa.die=function(c){if(!this.death){var b=G,d=this.id,f=this.kingdom,g=C[f];this.waitlist&&(g.unitLoading-=.5*this.waitlist.length);if(this.dieSound&&!p.editor){var h=this.dieSound;va(h[~~(h.length*Math.random())],this.x32,this.y32)}pe(this.id);(this.freezed||this.invisible)&&Ac(this);var l=this.x32,k=this.y32;this.death=1;1==this.zLevel&&(og[l+k*b]=1);this.c=void 0;var t=this.url.die||this.dimg;!1===this.built&&g.building.quit(this.id);
void 0!=g.IAD&&g.k&&!this.item&&Bb.arr[g.IAD].valorateLost(this);if(this.food&&!p.editor){var n=100,r=this.food/n,u=~~r,w=~~((r-u)*n);for(h=0;h<r;h++){h==u&&w&&(n=w);var v=Hj(l,k),x=~~(v/b);v%=b;v=new dd(52,f,v,x,0);na(v,m.item_meat);v.contain=[n,2,Ml]}}g.stats.unitCountDeath[this.type]++;h=this.x32;b=this.y32;c||p.editor?(Qb(this),ei(this)):t?(this.mv=!0,na(this,t,1),c=Ca[this.img],t=c[1],t=0>t?ak(c):1E3*c[0]/t,ob({func:Zj,data:this.id},t-25,1),Oc(this,0,0,0),void 0!==this.dix&&(c=.001*(p.now()-
this.timestamp),this.x32+=this.dix*c/32-Math.sign(this.dix),this.y32+=this.diy*c/32-Math.sign(this.diy))):this.dimgInfinity?(this.dimgRND&&(this.d=this.id%this.dimgRND),na(this,this.dimgInfinity)):(Qb(this),ei(this));Fh(this);this.techStart&&Nf(0,[this.id]);pb(this,32*this.y32-36);this.x32=h;this.y32=b;this.build||this.item||this.cow||g.values.pop--;this.population&&this.built&&(g.values.popMax-=this.population);k=this.validator(l,k,this.space,this.kingdom);c=k[0];if(this.onbuild&&!p.editor)for(l=
this.onbuild,t=g.technology,h=t.disabled,t=t.actived,b=0;b<l.length;b++)f=l[b].id,t[f]--,0===t[f]&&h[f]++;l=this.validator.dimension;h=0;for(t=c.length;h<t;h++)b=c[h],l[b]=Ub[b]?Ub[b]:0;if(1==this.health&&!this.built)for(b=ib[this.kingdom],h=0,t=c.length;h<t;b[c[h++]]=void 0);if(k[2])for(c=k[2],h=0,t=c.length;h<t;h++)b=c[h],Ub[b]?(2<l[b]&&z[l[b]].die(1),l[b]=Ub[b]):(2<l[b]&&z[l[b]].die(),l[b]=0);Ja[this.kingdom][this.type].quit(this.id);Ii(this);if(this.workers){h=0;l=this.workers.slice(0);for(t=
l.length;h<t;h++)k=z[l[h]],k.workingOn===d&&(k.workingOn=0,k.func!==Mh.url&&k.stay());this.workers.length=0}this.deleteFromList&&(l=this.deleteFromList,l.quit(this),l.length||l.length0function(this));this.time=void 0;this.changeFunc(void 0);this.diy=this.dix=0;this.inventory&&0<this.inventory.length&&Dd(this.id,this.inventory.slice(0));this.stock&&Fj(this);p.editor||(g.check(),le(this.kingdom),g.checkPopArray());this.deleteWorker()}};Array.prototype.quit=function(c){c=this.indexOf(c);return-1<c?(this.splice(c,
1),!0):!1};Array.prototype.add=function(c){0>this.indexOf(c)&&(this[this.length]=c)};var Ha=["European","Arab","Asian"],yj={euro:"Lancelot Arthur Guivain Merlin Blackthorn Morin Golstuck Karambol Kelerick Rockmore Bridport Casevil Stirm Tonis Pelegrim Peresohn Pirk Pharn Gork".split(" "),arab:"Ibn Fadlan;Mohammad;Al Ferissa;Harun Al Rashid;Sindbad;Mellemad;Moarrac;Sakhavan;Bellefars;Mokhac;Norahz;Kerhetin;Maham;Dushesh;Direkh".split(";"),asia:"Ishida Toranaga Ichinzen Haiako Mozuki Hitachi Tosheba Harachiko Marasuma Korodzum Ishinghen Genghis Musa Echibo Ichikahr Yotokan Maraga".split(" "),
common:"Fistantilus Skenderbeg Raislin Tenis Morok Sokob Baras Haram Billihz Ynte Orgh Savael Birgos Savator Gandeh Gordor Fessh Gilmi Phergas".split(" ")},dh=[u.gold,u.wood,u.food,u.stone,u.mana],Wh=function(c,b,d){d&&(c=c.replace("%d",d));return c.replace("%s",b)},Kd={},qi,Tc,dc={},Xd=function(c){p.infinity=void 0;if(""!=r("mapconfiguration").innerHTML){c="mapx mapwidth goldRes goldValue woodRes woodValue foodRes foodValue stoneRes stoneValue infinity infiniteValue water waterValue terrainType terrainSelect items itemsValue peons peonValue gateways gatewaysValue".split(" ");
for(var b=0,d=c.length;b<d;b+=2){var f=document.getElementById(c[b+1]).value;"infinity"==c[b]?(f=document.getElementById(c[b+1]).checked,p[c[b]]=f):parseInt(f)?p[c[b]]=parseInt(f):p[c[b]]=f;localStorage[c[b]]=f}}else"true"==localStorage.infinity&&(p.infinity=!0),p.goldRes=parseInt(localStorage.gold),p.foodRes=parseInt(localStorage.food),p.woodRes=parseInt(localStorage.wood),p.stoneRes=parseInt(localStorage.stone),p.mapx=parseInt(localStorage.mapSize),p.water=parseInt(localStorage.water),p.terrainType=
localStorage.terrainType,p.items=parseInt(localStorage.items),p.peons=parseInt(localStorage.peons),p.gateways=parseInt(localStorage.gateways);p.infinity&&(p.goldRes=Infinity,p.foodRes=Infinity,p.woodRes=Infinity,p.stoneRes=Infinity);p.infinity=void 0;p.goldRes||(p.goldRes=Infinity);p.foodRes||(p.foodRes=Infinity);p.woodRes||(p.woodRes=Infinity);p.stoneRes||(p.stoneRes=Infinity);p.mapy=p.mapx;p.gravity=580.9/9.8*9.8;p.name="";p.arje=555555*Math.random()+1;Gk(p);return p},Pi=function(){p.online&&(nm(u.initializing),
p.editor=0);p.mapx||Xd();p.pausedTime=0;p.canceled=0;for(var c=Object.keys(d),b=C.length,e=0,f=c.length;e<f;e++){var g=d[c[e]];g.id=e;if(g.disabled)for(var h=0;h<b;C[h++].technology.disabled[e]=g.disabled);if(g.hidden)for(h=0;h<b;C[h++].technology.hidden[e]=1);}var l=performance.now();Dc=document.getElementById("msgs1");p.online||(location.hash="");ma("playermenu");ma("index");rb("menu");rb("statButton");ma("mapeditorinfo");ma("mapeditorinfotop");rb("resources");yb=C[v.kingdom];Yf(v.kingdom);qi||
(qi=JSON.parse(JSON.stringify(C.slice(1))));setTimeout(function(){p.cycle?p.deltaTime=25*p.cycle:(p.players=C.length-1,p.date=Date.now(),p.cycle=0,p.kingdoms=C,p.deltaTime=0);p.loadDate=Date.now();p.online||Yh();p.now=qj;p.paused=0;p.pausedTime=0;p.zMax=96*p.mapy;$b();var b=performance.now();p.allow14=!0;G=p.mapx;Da=p.mapy;p.temperature=25;var c=p.temperature;0==v.temperature&&(c+="&deg;C");document.getElementById("temperature").innerHTML=c;da=1;om();Se();og={};var e=G,f=-e,g=+e;ac=[1,1+f,f,-1+f,
-1,-1+g,g,g+1];rj=[f,-1,1,g];p.online&&rb("content");for(var h=["loading","playermenu","index"],D=h.length,E=0;E<D;document.getElementById(h[E++]).style.display="none");r("loadingtext").innerHTML="Loading terrain";b=performance.now();if(!1!==p.arje){var K=performance.now(),M=G,O=M*Da,Q=Math.sqrt(O),H=0,T=0,R=0,S=0,V=0,Y=0,ba=0,ca=0,Z=0,aa=0,ea=0,ja=0,ha=0,na=100,oa=255,pa=0,ma=0,fa=0,ua=new Int8Array(new ArrayBuffer(O)),qa=new Uint32Array([2,3,0,1,1,1,0,1,0,1,0,1,3,p.water,1,0,1,1,1,0,0,15,0,1]);
for(Rl(p.arje);Z<O;ua[Z++]=0);var va=qa.length;for(Z=0;Z<va;Z+=4)qa[Z+3]&&(qa[Z+1]=~~(Q/qa[Z+1]));for(aa=0;aa<va;aa+=4)for(na=qa[aa+1],oa=qa[aa],pa=qa[aa+2],Z=0;Z<na;Z++)for(ja=~~(la()*O+.5),V=6*la()-3,Y=6*la()-3,pa?(ca=la()*Q,fa=~~(la()*(Q/15))+4,ba=~~(100*la())/4,ma=fa/12):(ca=128*la(),fa=~~(2.56*la())+4,ba=~~(100*la())/2,ma=1),H=ja%M,T=~~(ja/M),ea=0;ea<ca;ea++)for(100*la()>ba&&(V=(6*la()-3)*ma,Y=(6*la()-3)*ma),H+=V,T+=Y,R=0;R<fa;R++)for(S=0;S<fa;S++)(R-fa/2)*(R-fa/2)+(S-fa/2)*(S-fa/2)<fa*fa/4&&
(ha=~~H+R+(S+~~T)*M,ha>=O?ha%=O:0>ha&&(ha+=O),ua[ha]=oa);var za=performance.now();J("randomtxt1",za-K);J("drawTerrain: ",performance.now()-za);Tc=ua}else Tc=p.terrain?new Int8Array(p.terrain):new Int8Array(G*Da);dc.randomtxt=performance.now()-b;J("randomtxt: ",dc.randomtxt);b=performance.now();r("loadingtext").innerHTML="Creating map";var xa=G*Da*4;N=new Uint32Array(new ArrayBuffer(xa));hb=new Uint32Array(new ArrayBuffer(xa));md=new Uint32Array(new ArrayBuffer(xa));oc={};P.dimension=N;Ue.dimension=
hb;xk.dimension=N;nh.dimension=hb;W.dimension=N;zg.dimension=md;cc.dimension=hb;yg.dimension=N;xb[0]=hb;xb[1]=N;xb[2]=md;dc.createMap=performance.now()-b;J("createMap: ",dc.createMap);r("content").style.display="block";b=performance.now();if(!1===p.arje||p.allunits)A=p.allunits;else{var Ba=Tc,ra=p.mapx,Aa=p.mapy,Ja=performance.now(),ia=0,wa=0,Ua=0,La=0,Ma=0,Ea=ra*Aa,ab=Math.sqrt(Ea);wa=Ea;A=[];Ld={};var Na=pm,Xa=qm,Za=Ld,eb=rm,gb=[12,63,62],Fa=[];wa=C.length;for(ia=1;ia<wa;ia++){for(var Va=!0,Wa=
C[ia],kb=gb[Wa.race],Ya=0;Va&&25>Ya;){Ya++;La=~~(la()*(ra-15)+.5)+4;Ma=~~(la()*(Aa-15)+.5)+4;Va=!1;Ua=Fa.length;for(var sa=0;sa<Ua;sa+=2)60>Math.sqrt((La-Fa[sa])*(La-Fa[sa])+(Ma-Fa[sa+1])*(Ma-Fa[sa+1]))&&(Va=!0);Va||(Fa.push(La+4,Ma+3),Na(La+Ma*ra,{type:kb,kingdom:ia}))}if(25==Ya){C.length=ia;break}}var ib=2*(wa-1);for(sa=0;sa<ib;sa+=2){var jb=2*Math.round(la())-1;var nb=Fa[sa]+10*(2*Math.round(la())-1)+~~(3*la());var Pa=Fa[sa+1]+10*jb+~~(3*la());var Ga=Fa[sa]+10*(2*Math.round(la())-1)+~~(3*la());
var Ha=Fa[sa+1]+10*-jb+~~(3*la());0>nb?nb=0:nb+4>G&&(nb-=(nb+4)%Ea);0>Pa?Pa=0:Pa+4>Da&&(Pa-=(Pa+4)%Ea);0>Ga?Ga=0:Ga+4>G&&(Ga-=(Ga+4)%Ea);0>Ha?Ha=0:Ha+4>Da&&(Ha-=(Ha+4)%Ea);J(Ga,Ha);Infinity!==p.goldRes&&Na(nb+Pa*ra,{type:21});Infinity!==p.stoneRes&&Na(Ga+Ha*ra,{type:22})}if(Infinity!==p.goldRes){ia=0;for(var db=10*G*Da/65536;ia<db;ia++)Na(~~(la()*Ea),{type:21})}if(Infinity!==p.stoneRes)for(ia=0,db=10*G*Da/65536;ia<db;ia++)Na(~~(la()*Ea),{type:22});wa=1*~~(ab/3.2);for(ia=0;ia<wa;ia++){var ob=~~(la()*
ra+.5);var sb=~~(la()*Aa+.5);var tb=~~(25*la())+10;var ub=~~(25*la())+10;for(Wa=0;55>Wa;Wa++){La=~~(la()*tb+~~(ob+18*la()-9)+.5);Ma=~~(la()*ub+~~(sb+18*la()-9)+.5);var Ta=La+Ma*ra;Xa(Ta)&&Ta<=Ea&&Na(Ta,{type:7,d:~~(28*la()+3)})}}wa=parseInt(p.items);for(ia=0;ia<wa;ia++){Ta=~~(la()*Ea+.5);var Ra=mi[~~(la()*mi.length)],Oa=Object.assign({},Ra);Oa.d+=~~(Ra.dMax*la());if(Ra.sword||Ra.potion)Oa.attack=~~(6*la())+1;if(Ra.shield||Ra.potion)Oa.defence=~~(6*la())+1;if(Ra.book){var pb=~~(la()*Bg.length);Oa.spell=
Bg[pb];Oa.iconID=d[Bg[pb]].iconIDbook;Oa.name=u[Oa.spell];Oa.attack=~~(6*la())+1}Na(Ta,Oa)}wa=parseInt(p.gateways);for(ia=0;ia<wa;ia++)Ta=~~(la()*Ea),Xa(Ta)&&Na(Ta,{type:43});for(sa=0;sa<ib;sa+=2)for(nb=Fa[sa]-25,Pa=Fa[sa+1]-25,Ga=0;50>Ga;Ga++)for(Ha=0;50>Ha;Ha++)if(625>(Ga-25)*(Ga-25)+(Ha-25)*(Ha-25)){var $a=Ga+nb+(Ha+Pa)*ra;7===eb($a).type&&(A.quit(Za[$a]),Za[$a]=void 0);1===pc.type[Ba[$a]]&&(Ba[$a]=0)}J("random:",performance.now()-Ja);dc.random=performance.now()-Ja}p.movtable&&!p.demo&&(bd=p.movtable,
cd=p.movtable2);var wb=performance.now();r("loadingtext").innerHTML="Loading textures";ol(Tc);dc.setupGL=performance.now()-wb;J("setupGL: ",dc.setupGL);var vb=performance.now(),zb=p.tr,cb=A;if(!p.custom&&cb){for(var Bb=p,yb=cb,Ab="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy".split(" "),
Cb={},bb=0;bb<Ab.length;bb++)Cb[Ab[bb]]=bb;var Eb=[],Jb=yb.length;for(bb=0;bb<Jb;bb++){var Gb=yb[bb],Db=Object.keys(Gb),Hb={};Eb.put(Hb);for(var ta=0,Lb=Db.length;ta<Lb;ta++)Hb[Cb[Db[ta]]]=Gb[Db[ta]]}Bb.ini=Eb}p.demo&&(cb=p.ini);if(cb)for(var Fb=0,Ob=cb.length;Fb<Ob;Fb++){var Ka=cb[Fb];if(void 0!==Ka.race){Ka.type=sm[Ka.type+256*Ka.race];Ka.kingdom=zb[Ka.kingdom];if(void 0==Ka.type)continue;var Sb=x[Ka.type];if(13==Ka.type||Sb.build)Ka.d=0;Ka.resource&&(Ka.health=Ka.resource,Ka.maxHealth=Ka.resource);
if(!Ka.health||void 0==Ka.kingdom)continue}if(Ka.death)z.put(Ka);else if(!Ka.cancell){var Nb=Ka.x32,Qb=Ka.y32,Rb=!1===Ka.built&&1===Ka.health?!0:!1,Tb=Ka.kingdom||0,Mb=new dd(Ka.type,Tb,Nb,Qb,0,Rb,Ka);Mb.invalid||(Rb||Ij(Mb),Mb.castle&&(C[Tb].origin=[Nb+4,Qb+3]))}}Ld=A=null;J("positioned:",performance.now()-vb);dc.positioned=performance.now()-vb;dc.setupGL=performance.now()-b;J("setupGL: ",dc.setupGL);mb(qb);mb(L);le(v.kingdom);dk();Hk();window.addEventListener("keydown",lk);window.addEventListener("keyup",
mk);window.addEventListener("mousemove",nk);U=Pb;X=new Float32Array(12);var Ub=Ca[m.blank].id;y[0]=Ub;y[1]=0;y[2]=1;y[3]=0;y[4]=Ub;y[5]=0;y[6]=1;y[7]=0;y[8]=Ub;y[9]=0;y[10]=1;y[11]=0;y[12]=Ub;y[13]=0;y[14]=1;y[15]=0;var Kb=ya;Kb[0]=0;Kb[1]=1;Kb[2]=2;Kb[3]=1;Kb[4]=2;Kb[5]=3;k.bindBuffer(k.ARRAY_BUFFER,td);k.bufferSubData(k.ARRAY_BUFFER,0,y);k.bindBuffer(k.ARRAY_BUFFER,Ib);var Zb=3*v.kingdom,Vb=Sa[Zb],Wb=Sa[Zb+1],Xb=Sa[Zb+2];k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([Vb,Wb,Xb,.5,Vb,Wb,Xb,.5,
Vb,Wb,Xb,.5,Vb,Wb,Xb,.5]));var Yb=96*G;X[2]=Yb;X[5]=Yb;X[8]=Yb;X[11]=Yb;window.addEventListener("mousedown",ok);window.addEventListener("mouseup",pk);J("FULL: ",performance.now()-l);p.record||(p.record={});p.online?(Hc(od(),u.waitingPlayers,1),v.admin?Uc():(J("live ready"),I(Uc,0,0))):gf();p.allow14=!1;nd.list.push(0,JSON.stringify(dc))},300)},od=function(){for(var c=qa.length,b=qa,d="",f=0;f<c;f++){var g=b[f];od.obj[g.id]||g.id==v.onlineID||(d+="<br>"+g.nhinfo.name)}return d};od.obj={};var Ni=function(){return v.gl?
!1:(Hc("You can't run WEBGL 2<br>More info <a href='http://webglreport.com/?v=2'>here</a>","Error"),Za(),!0)},Xg=!1,Yd,sl=function(c){var b={};Yd={events:{defined:b,nodefined:{}}};for(var d={moving:1},f=0,g=0,h=c.length;g<h;g++){var l=c[g];l.activeEvents=0;for(var k=l.events,m=0,n=k.length;m<n;m++){var p=k[m];p.id=f++;var r=p.list,u=p.to,v=p.type,x=p.zone;p.rule=l;for(var y=p.activeEvents=0,z=r.length;y<z;y++){var A=r[y];b[A]||(b[A]={});A=b[A];if(d[v])A[v]||(A[v]=[]),A[v].put(p);else if("zone"==v){A[v]||
(A[v]=[]);for(var C=0;C<x.length;C++)A[v].push(p,x[C][0],x[C][1],x[C][2],x[C][3])}else{A[v]||(A[v]={defined:{}});A=A[v].defined;C=0;for(var D=u.length;C<D;C++)A[u[y]]||(A[u[y]]=[]),A[u[y]].put(p)}}}}},dk=function(){var c=document.getElementById("playersinfo");c.innerHTML="";if(!p.editor)for(var b=1,d=C.length;b<d;b++){var f=C[b],g=f.death?f.name.strike():f.name;c.innerHTML+=g+"<span id='score"+b+"'> 0/0</span><div class='playercolor' style='background:rgb("+f.color[0]+","+f.color[1]+","+f.color[2]+
")'></div><br>"}},Hk=function(){var c=window.innerWidth-v.mx,b=window.innerHeight,d=C[v.kingdom].origin;d?(c=32*d[0]-.5*c,b=32*d[1]-.5*b):b=c=0;wd(~~c,~~b)},Re,tk,jk,om=function(){var c=document.getElementById("selectedobject").getContext("webgl",{antialias:!1,depth:!1}),b=c.createShader(c.VERTEX_SHADER);c.shaderSource(b,"void main() {\ngl_Position = vec4(0 ,0, 0, 1);\ngl_PointSize=48.0;\n}");c.compileShader(b);var d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,"precision mediump float;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nuniform float txtCoord;\nvoid main() {\ngl_FragColor = texture2D(u_image, (vec2(\tmod(txtCoord,21.0) ,floor(txtCoord/21.0) ) + gl_PointCoord)*(0.046875));\nif(gl_FragColor.r==gl_FragColor.g&&gl_FragColor.r==gl_FragColor.b) gl_FragColor*=u_color;\n}");
c.compileShader(d);var f=c.createProgram();c.attachShader(f,b);c.attachShader(f,d);c.linkProgram(f);c.useProgram(f);b=c.createTexture();c.bindTexture(c.TEXTURE_2D,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texImage2D(c.TEXTURE_2D,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,Q.icons);var g=c.getUniformLocation(f,"u_color"),
h=c.getUniformLocation(f,"txtCoord");Re=function(b){if(Ca[b.img][3]){var d=b.kingdom;c.uniform4f(g,Sa[3*d],Sa[3*d+1],Sa[3*d+2],1)}else c.uniform4f(g,1,1,1,1);c.uniform1f(h,b.iconID);c.drawArrays(c.POINTS,0,1)};tk=function(){c.uniform4f(g,1,1,1,1);c.uniform1f(h,189);c.drawArrays(c.POINTS,0,1)};jk=function(){c.uniform1f(h,0);c.uniform4f(g,0,0,0,0);c.drawArrays(c.POINTS,0,1)}},Vb=128,Lb=128,z=[{terrain:1},{terrain:1},{terrain:1}],Ub={},le=function(c){c===v.kingdom&&(c=yb.values.popMax<yb.values.popLimit?
yb.values.popMax:yb.values.popLimit,document.getElementById("pop").innerHTML=yb.values.pop+"/"+c)};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(c){window.setTimeout(c,1E3/60)}}();var Ld=A=void 0;var pm=function(c,b){Ld[c]||(b.x32=c%G,b.y32=~~(c/Da),A.put(b),Ld[c]=b)},qm=function(c){return!A[c]},rm=function(c){return Ld[c]||NaN},qa=[];window.addEventListener("offline",function(c){ae("Offline",
"#ff0000")});window.addEventListener("online",function(c){ae("Online","#00ff00")});var ri=function(){La.leaveRoom();qa.length=0},Md={};(function(){for(var c=["returnmenu","index","Account","accountIframe"],b=0,d=c.length;b<d;Md[c[b]]=document.getElementById(c[b++]));})();var tm=function(){location.replace("#"+this.gameID+"Room")},Ui=function(c){qa=[];J("connecting to",c,u.loading);r("game").style.display="block";r("gameName").innerHTML=u.loading;r("returnmenu").style.display="none";r("index").style.display=
"none";Vc.innerHTML="";Dc.innerHTML="";aa=[];v.p2p?(La.joinRoom(c,Zg),Vg()):(La||qc(),qc.func=function(){Ui(c)})},um={6400900:".",28462225:"a",29052100:"b",29648025:"c",3025E4:"d",30858025:"e",31472100:"f",32092225:"g",32718400:"h",33350625:"i",33988900:"j",34633225:"k",35283600:"l",35940025:"m",36602500:"n",37271025:"o",37945600:"p",38626225:"q",39312900:"r",40005625:"s",40704400:"t",41409225:"u",42120100:"v",42837025:"w",4356E4:"x",44289025:"y",45024100:"z"},vm=function(c){r("game").style.display=
"none";ra.length=0;p.online=0;ea=p.id=void 0;ri();Za();c.constructor==String&&Hc(c)},ck={euro:0,arab:0,asia:0},Zd=function(c,b,d){if(!p.started&&d){J("peerInfo",c);c.name=Na(c.name);c.team=parseInt(c.team);0>c.team&&(c.team=0);c.team%=6;c.race=parseInt(c.race);if(0>c.race||2<c.race)c.race=0;b=c.version;d&&d.admin&&b!=v.version&&(Za(),La.leaveRoom(),Hc(u.versionError+"<p> Admin version: "+parseFloat(b.substr(1))+"<br> Your version: "+parseFloat(v.version.substr(1))));d.nhinfo=c;d.username=c.name;Nd()}},
aa,Fb=function(c,b,d){aa=c;Nd()},pf=function(){return{version:v.version,color:v.color,team:v.team,race:v.race,name:v.name}},sb=function(c,b){if(b.resend)if(c.destinatary)(b=Od(c.destinatary))&&b.id!=v.onlineID&&(c.bridge=h.id,b.send(c));else{b=b.resend;for(var d=0,f=b.length;d<f;d++){var g=b[d];c.bridge=h.id;g.send(c)}}else{var h=b;void 0===c.length?void 0!==c.func&&(b=Gf[c.func],Ik(b,c[1],c[2],h)||b(c[1],c[2],h)):(b=c[0],h.orderList[b]=c,sb.done[b]||(sb.done[b]=0),sb.done[b]++,sb.done[b]==qa.length&&
sb.func&&(sb.func=!1,vh(),$b()))}};sb.done=[];var Od=function(c){for(var b=0,d=qa.length;b<d;b++){var f=qa[b];if(f.id==c)return f}},La,Kk=function(c){if(!r("usernameForm")){Tb();var b=localStorage.name||"Guest",d=localStorage.color||"#"+Math.floor(16777215*Math.random()).toString(16),f=document.createElement("div");f.id="usernameForm";f.innerHTML="\n            <div>\n            <h2>"+u.username+'</h2>\n            <div>\n<input type="color" id=\'usernameColor\' value="'+d+'" /><input id=\'usernameVal\' type="text" value="'+
Jk(b)+'" />\n</div>\n<br />\n</div>';b=document.createElement("button");b.innerHTML=u.continue;b.onclick=function(){v.name=Na(r("usernameVal").value);v.color=r("usernameColor").value;localStorage.color=v.color;localStorage.name=v.name;document.body.removeChild(r("usernameForm"));c();wb()};f.children[0].appendChild(b);document.body.appendChild(f)}},qc=function(){Ni()||(v.name?(xl(),La=new SimpleWebRTC({localVideoEl:"",remoteVideosEl:"",autoRequestMedia:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},
url:"https://solar.tza.red/"}),La.on("channelMessage",function(c,b,d){"nehhof"==d.type&&sb(d.payload,c)}),La.on("error",function(c){"full"==c&&(Za(),ae(u.gameFull,"#ff0000"))}),La.on("connectionReady",function(c){var b=La.connection.connection;v.p2p=b;b.username=v.name;b.color=v.color;b.on("getRooms",function(b){var c=b.date,d=Object.keys(b),e=r("gameList");if(1<d.length){e.innerHTML="";for(var l=0,k=d.length;l<k;l++){var m=d[l],n=b[m];if("date"!=m){var p=n.len;if(p){var v=document.createElement("tr"),
w="";w=n.playing?w+("<td><div class='redCircle'></div>"+u.playing+"</td>"):w+("<td><div class='redCircle' style=\"background:rgba(0,255,0,.8); box-shadow:0px 0px 20px rgba(0,255,0,.8)\"></div>"+u.waiting+"</td></td>");w+="<td>"+Na(n.description)+"</td><td>"+~~((c-n.date)/6E4)+" min ago</td><td>"+Na(p)+"/"+Na(n.max)+"</td>";v.innerHTML=w;v.gameID=m;n.playing||(v.onclick=tm);e.appendChild(v)}}}}else e.innerHTML="<tr><td>No games found</td></tr>"});v.onlineID=c;qc.func&&qc.func()}),La.on("createdPeer",
function(c){p.started||tl(c)})):Kk(qc))},wm=function(){Vg();wb();r("game").style.display="block";r("gameName").innerHTML=u.loading;r("returnmenu").style.display="none";r("index").style.display="none";Vc.innerHTML="";Dc.innerHTML="";qa=[];Si();v.admin=1;v.room={description:r("gameFormName").value,max:parseInt(r("gameMax").value),public:!0};2>v.room.max&&(v.room.max=2);14<v.room.max&&(v.room.max=14);localStorage.gameDescription=v.room.description;La.createRoom(v.onlineID+"b",Zg);p.online=1;$c(Xd());
document.body.removeChild(r("gameForm"));aa=[v.onlineID];Nd()},Lk=function(){La||qc();if(v.onlineID){Tb();var c=localStorage.gameDescription||v.name+"'s room",b=document.createElement("div");b.id="gameForm";b.innerHTML="\n<div>\n            <h2>"+u.gameOptions+"</h2>\n            "+u.gameName+': <input id=\'gameFormName\' type="text" value="'+c+'" maxlength="29" /><br />\n'+u.nplayers+': <input id="gameMax" type="number" value="6" max="14" min="2"/><br />\n            </div>';c=document.createElement("button");
c.innerHTML=u.continue;c.onclick=wm;b.children[0].appendChild(c);document.body.appendChild(b)}else setTimeout(function(){location.hash=""},200),qc.func=Lk},Mk=function(c){for(var b="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy stock".split(" "),d=[],f=c.length,g=
0;g<f;g++){var h=c[g],l=Object.keys(h),k={};d.put(k);for(var m=0,n=l.length;m<n;m++)k[b[l[m]]]=h[l[m]]}return d},xm=function(c){for(var b=c.length,d=new Uint8Array(b),f=0,g=-1,h=0,l=0;l<b;l++){var k=c[l];if(g===k)h||(d[f++]=255),h++;else{if(h){if(4>h){f--;for(var m=0;m<h;m++)d[f++]=g}else d[f++]=h>>8&255,d[f++]=h&255;h=0}d[f++]=k}g=k}if(h)if(4>h)for(f--,m=0;m<h;m++)d[f++]=g;else d[f++]=h>>8&255,d[f++]=h&255;return d.slice(0,f)},hf=[],I=function(c,b,d,f,g){var e;if(!0===g&&p.online&&qa.length)d.change&&
(d=d.slice(0)),tb(function(){I(c,b,d,f,55)});else if(void 0===c.location)c();else{if(p.started&&!p.editor){var l=p.record;l[p.cycle]||(l[p.cycle]=[]);var k=l[p.cycle];l=k.length;k[l]=c.location;k[l+1]=b;d.length&&(d=d.slice(0));k[l+2]=d}if(!p.blocked&&p.online&&qa.length)if(55===g&&(e=!1),k={func:c.location,1:b,2:d,active:e,rnd:4294967296*Math.random()},p.started&&c!=$b&&c!=gf&&c!=Pc)if(f)for(l=0,e=f.length;l<e;l++)g=f[l],k.destinatary=g.id,g.bridge?g.bridge.sendDirectly("channelMessage","nehhof",
k):g.sendDirectly("channelMessage","nehhof",k);else hf.put(k);else si(k),c(b,d);else c(b,d)}},ym=function(){qa.length&&(Xd(),Uc.i=0,v.p2p.emit("gameStarted"),I(ti,ea?!1:p,0,0,0))},Uc=function(c,b,d){if(d){if(od.obj[d.id])return;od.obj[d.id]=1;c=od();""==c?Hc(c,u.loading,1):Hc(c,u.waitingPlayers,1)}v.admin&&(Uc.i++,J(Uc.i,ra.length,d),Uc.i==ra.length-p.bots&&setTimeout(function(){I(gf,0,0,0,!0)},100))};Uc.i=0;var si=function(c){for(var b=0,d=qa.length;b<d;b++)qa[b].sendDirectly("channelMessage","nehhof",
c)},Ik=function(c,b,d,f){if(!f)return!1;(b=c.secureNH&&!c.secureNH(b,d,f))&&J(c,f);return b},pd,ui,vh=function(){if(!sb.done[pd]||sb.done[pd]<qa.length)return sb.func=!0,$b(),!0;for(var c=aa,b=0,d=c.length;b<d;b++){if(c[b]==v.onlineID)var f=void 0,g=ui;else{f=Od(c[b]);if(!f)continue;g=f.orderList[pd]}for(var h=1,l=g.length;h<l;h++){var k=g[h],m=Gf[k.func];Ik(m,k[1],k[2],f)||m(k[1],k[2],f)}}sb.func=!1;si(hf);ui=hf;pd++;hf=[pd+1];return!1},gf=function(){document.getElementById("alert").style.display=
"none";p.started=1;p.date=Date.now();$b();sa();wb();pd=0;if(!p.custom||p.demo)for(var c=1,b=C.length;c<b;c++){var d=gb[sg[C[c].race]],f=d.peasant.type;if(d=z[Ja[c][d.castle.type][0]])for(var g=0,h=p.peons;g<h;g++)ke(f,d,1)}Bb.arr=[];Bb.units=[];Bb.time=500;Bb.steps=0;Bb.process=0;if(!p.editor&&!p.demo){for(c=0;c<C.length;c++)C[c].IA&&new Bb(C[c]);c=0;b=Bb.arr;for(f=b.length;c<f;b[c++].leaveMeAloneIKnowWhatToDo());mh()}p.online&&(si([0]),hf=[1],ui=[0]);Eb()},ti=function(c,b,d){b=[];d=aa;p=!1!==c?c:
ea;for(c=p.bots=0;c<d.length;c++){var e=d[c];e==v.onlineID?(b[c]=v,v.kingdom=c+1):(J(e),e.name?(p.bots++,b[c]=e,e.IA=1):(e=Od(e),b[c]=e.nhinfo,e.kingdom=c+1));ra=b}va("bless");p.infinity&&(p.goldRes=Infinity,p.foodRes=Infinity,p.woodRes=Infinity,p.stoneRes=Infinity);p.infinity=void 0;p.goldRes||(p.goldRes=Infinity);p.foodRes||(p.foodRes=Infinity);p.woodRes||(p.woodRes=Infinity);p.stoneRes||(p.stoneRes=Infinity);xd()},Vd=!1,wb=function(){Vd=!1;r("basic").style.filter=""},Tb=function(){Vd=!0;r("basic").style.filter=
"blur(94px)"};var Nk=function(){rb("game");ra.length=0;p.id=void 0;p.online=0;ea=void 0;p.compressed=void 0;p.arje=void 0;ri();Za();v.admin=0};var vi=function(c,b,d){d&&(kb.arr=new Uint8Array(parseInt(c)),kb.i=0,r("showGameInfo").innerHTML="<table><tr><td>Downloading custom map</td><td id='cmappr'></td></tr></table>")},kb=function(c,b,d){d&&(kb.arr.set(c,kb.i),kb.i+=c.length,r("cmappr").innerHTML=~~(100*kb.i/kb.arr.length+.5)+"%",kb.i==kb.arr.length&&Ok(kb.arr))};kb.step=1E4;var Ok=function(c){var b=
Pk(c);b.custom=!0;ea=b;ea.online=!0;ea.started=!1;ea.editor=!1;v.admin&&(ea.compressed=c);J("newmap",b);$c(b);Nd()},Qk=function(c){c=parseInt(c);if(2>c||!c)c=2;14<c&&(c=14);c!==v.room.max&&(v.p2p.emit("maxPlayers",c-(aa.length-qa.length-1)),I(qf,c))},qf=function(c){v.room.max=c;Nd()},zm=function(){I($c,p,!1);r("optionbutton").style.display="inline-table";ma("deleteCusMap")},Zg=function(c){if((v.admin||c)&&!p.id)if(c=La.roomName,c+="Room",J("login"),wb(),0!==La.getPeers().length||v.admin){var b=v.room||
NaN;p.id=c;p.online=1;Si();v.admin&&(r("onlineTopInfo").innerHTML=' <button id="addAI" style="padding: 6px;">'+u.addAI+'</button><span style="float:right">'+u.nplayers+'<input id="nplayersO" min="2" type="number" max="14" value="'+v.room.max+'" /></span>',r("nplayersO").onchange=function(){var b=this.value;b<aa.length&&(b=aa.length);J(aa.length,b);aa.length!=b||qa.length||b++;Qk(b);this.value=v.room.max},r("addAI").onclick=function(){aa.length<v.room.max&&(aa.length+1!==v.room.max||qa.length)&&(aa.put({name:"AI",
race:0,team:5,color:"#"+(~~(16777216*Math.random())).toString(16)}),v.p2p.emit("maxPlayers",v.room.max-(aa.length-qa.length-1)),I(Fb,aa,0))});r("copyButton")&&(r("copyButton").onclick=function(){document.getElementById("onlineID").select();document.execCommand("Copy")},r("onlineID").value=location.origin+"/#"+p.id);r("gameName").innerHTML=Na(b.description)||"Online Game";ma("returnmenu");v.admin?(location.replace("#"+p.id),r("buttons").innerHTML='<button id="startbutton">'+u.play+'</button><button id="optionbutton">'+
u.options+'</button><button id="closebutton">'+u.close+'</button><br><input id="maploadOnline" type="file" /> <label for= "maploadOnline">'+u.strcusMap+'</label> <button id="deleteCusMap">'+u.randomMap+"</button>",r("startbutton").onclick=ym,r("optionbutton").onclick=Rk,r("closebutton").onclick=Nk,r("maploadOnline").accept=".tzared",r("maploadOnline").onchange=Am,ma("deleteCusMap"),r("deleteCusMap").onclick=zm):(r("buttons").innerHTML='<button id="quitbutton">'+u.disconnect+"</button>",r("quitbutton").onclick=
vm);La.connection.on("remove",Sk)}else location.hash="",Za()},Sk=function(c){if(c=Od(c.id))if(Pc(Wh(u.playerDisconnected,c.nhinfo&&c.nhinfo.name),0,5),p.online){if(p.started)for(var b=0;b<ra.length;b++)if(ra[b].id==c.id){C[b+1].die();break}qa.quit(c);p.started?sb.done[pd]==qa.length&&sb.func&&(sb.func=!1,vh(),$b()):(v.admin&&(aa.quit(c.id),I(Fb,aa,0)),c.admin&&(Za(),La.leaveRoom(),Hc(u.gameClosed)))}},tb=function(c){tb.func.put(c);0===tb.active&&(I(Tk,0,0,0,0),tb.date=Date.now(),tb.received=0,tb.max=
-Infinity,tb.active=1)};tb.func=[];tb.active=0;var Tk=function(c,b,d){d&&I(Uk,0,0,[d],0)},wi={},Uk=function(c,b,d){if(d&&(d.ping=~~(.5*(Date.now()-tb.date)+.5),wi[d.id]?wi[d.id].put(d.ping):wi[d.id]=[d.ping],d.ping>tb.max&&(tb.max=d.ping),tb.received++,tb.received==qa.length)){c=performance.now();b=0;for(d=tb.func.length;b<d;tb.func[b++]());J(-c+performance.now());tb.func.length=0;tb.active=0}},xi=function(c){var b=c.id;if(v.onlineID==b)return Hc(c.sp&&u.nospace||u.kicked),Nk();if(c=Od(b))c.end(),
Sk(b)},yi=document.getElementsByClassName("ucolor"),zi=document.getElementsByClassName("username"),Vk=document.getElementsByClassName("race"),Cg=document.getElementsByClassName("team"),Zb=function(c){if(v.admin){Zb.div&&(document.body.removeChild(Zb.div),Zb.div=void 0);var b=c.pageX;c=c.pageY;var d=this.i2,f=document.createElement("div");f.style.top=c+"px";f.style.left=b+"px";f.className="onlPlayer";Zb.div=f;if(this.peer.name)b=document.createElement("button"),b.onclick=function(){aa.splice(d,1);
v.p2p.emit("maxPlayers",v.room.max-(aa.length-qa.length-1));I(Fb,aa,0);document.body.removeChild(f);Zb.div=void 0},b.innerHTML=u.kick,f.appendChild(b);else{var g=this.peer&&this.peer.id;b=document.createElement("button");b.onclick=function(){var b=aa.indexOf(g);aa[b-1]&&(aa[b]=aa[b-1],aa[b-1]=g,I(Fb,aa,0),document.body.removeChild(f),Zb.div=void 0)};b.innerHTML=u.up;f.appendChild(b);b=document.createElement("button");b.onclick=function(){var b=aa.indexOf(g);aa[b+1]&&(aa[b]=aa[b+1],aa[b+1]=g,I(Fb,
aa,0),document.body.removeChild(f),Zb.div=void 0)};b.innerHTML=u.down;f.appendChild(b);v.onlineID!=g&&(b=document.createElement("button"),b.onclick=function(){I(xi,{id:g});document.body.removeChild(f);Zb.div=void 0},b.innerHTML=u.kick,f.appendChild(b))}b=document.createElement("button");b.onclick=function(){document.body.removeChild(f);Zb.div=void 0};b.innerHTML=u.close;f.appendChild(b);document.body.appendChild(f)}},Nd=function(){var c=document.getElementById("multiplayertable"),b="",d=aa,f=v.room&&
v.room.max||14;d&&f<d.length&&(f=d.length);for(var g=0;g<f;g++)b+='<tr><td class="ucolor"></td><td class="username">'+u.open+'</td><td class="race"></td><td class="team"></td></tr>';6>f&&(b+='<tr style="height: '+(260-46*f)+'px"></tr>');c.innerHTML=b;b=c.getElementsByTagName("tr");g=ea&&ea.kingdoms;var h=0;for(f=d.length;h<f;h++){if(d[h].name)l=d[h],k=v.admin,b[h].onclick=Zb,b[h].peer=l,b[h].i2=h,J(l);else if(d[h]==v.onlineID)var l=v,k=!0;else{var m=Od(d[h])||NaN;l=m.nhinfo;if(!l)return zi[h].innerHTML=
"...";k=!1}if(g&&g[h]){k=g[h];var n=k.color;yi[h].style.background="rgb("+n[0]+","+n[1]+","+n[2]+")";zi[h].innerHTML=l.name;k.team&&(Cg[h].innerHTML=k.team)}else n=Yg(l.color),yi[h].style.background="rgb("+n[0]+","+n[1]+","+n[2]+")",zi[h].innerHTML=l.name,k?(Cg[h].innerHTML="",n=document.createElement("button"),n.onmousedown=Wk,n.iteam=l,n.innerHTML=l.team,Cg[h].appendChild(n),n=document.createElement("button"),n.onmousedown=Xk,n.iteam=l,n.innerHTML=Ha[l.race],Vk[h].appendChild(n),k=document.createElement("input"),
k.type="color",n=l.color,k.iteam=l,k.value="#"+(16777216+(n[0]<<16)+(n[1]<<8)+n[2]).toString(16).slice(1),yi[h].appendChild(k),k.onchange=Yk):(v.admin&&(b[h].onclick=Zb,b[h].peer=m),Cg[h].innerHTML=l.team,Vk[h].innerHTML=Ha[l.race])}r("msgs").style.height=c.clientHeight-87+"px"},Gk=function(c){c.goldRes=parseInt(c.goldRes);c.foodRes=parseInt(c.foodRes);c.woodRes=parseInt(c.woodRes);c.stoneRes=parseInt(c.stoneRes);c.goldRes||(c.goldRes=Infinity);c.foodRes||(c.foodRes=Infinity);c.woodRes||(c.woodRes=
Infinity);c.stoneRes||(c.stoneRes=Infinity);c.mapx=parseInt(c.mapx);(!c.mapx||32>c.mapx)&&(c.mapx=32);c.items=parseInt(c.items)||0;0>c.items&&(c.items=0);c.peons=parseInt(c.peons)||0;0>c.peons&&(c.peons=0);c.gateways=parseInt(c.gateways)||0;0>c.gateways&&(c.gateways=0);c.water=parseInt(c.water)||0;0>c.water&&(c.water=0);c.terrainType=Na(c.terrainType);c.description=Na(c.description);c.author=Na(c.author);c.name=Na(c.name)},$c=function(c,b,d){Gk(c);c.goldRes||(c.goldRes=Infinity);c.foodRes||(c.foodRes=
Infinity);c.woodRes||(c.woodRes=Infinity);c.stoneRes||(c.stoneRes=Infinity);b="<table><tbody>";c.custom?(c=[u.mapName,c.name,u.mapSize,c.mapx,u.description,c.description,u.terrainOption,c.terrainType,u.author,c.author],d=4):(ea&&(ea=void 0,Nd()),c=[u.gold,c.goldRes,u.mapSize,c.mapx,u.items,c.items,u.wood,c.woodRes,u.terrainOption,c.terrainType,u.peons,c.peons,u.food,c.foodRes,u.water,c.water,u.gateways,c.gateways,u.stone,c.stoneRes],d=6);for(var e=c.length,g=0;g<e;g+=2)g%d||(g&&(b+="</tr>"),b+="<tr>"),
b+="<td>"+c[g]+":</td><td>"+c[g+1]+"</td>";b+="</tbody></table>";return r("showGameInfo").innerHTML=b},ra=[];window.onhashchange=Ti;var Dc=document.getElementById("msgs"),Vc=document.getElementById("msgs1"),Dg=document.getElementById("msginput"),$h=document.getElementById("msginputGame"),Zh=document.getElementById("enterwindow");Dg.addEventListener("keyup",function(c){13==c.keyCode&&ai()});var Pc=function(c,b,d){va("chat");d&&(b=p.started?Vc:Dc,b.innerHTML=5!==d?b.innerHTML+("<li><span>"+d.username+
" \u2014</span> "+Na(c)+"</li>"):b.innerHTML+("<li>"+c+"</li>"),b.scrollTop=b.scrollHeight,p.started&&Pd())},Pd=function(){11==Dc.children.length&&Vc.removeChild(Vc.children[0]);1==Dc.children.length&&(Pd.intv=setInterval(Bm,16E3))},Bm=function(){Vc.removeChild(Vc.children[0]);0==Dc.children.length&&clearInterval(Pd.intv)},Na=function(c){return String(c).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Jk=function(c){return String(c).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,
'"')},ai=function(){if(p.started){var c=Vc,b=$h.value;$h.value=""}else c=Dc,b=Dg.value,Dg.value="";""!=b&&(b=Na(b),c.innerHTML+="<li><span>"+v.name+" \u2014</span> "+b+"</li>",I(Pc,b,0,0,0),c.scrollTop=c.scrollHeight,p.started&&Pd())},Gf=[ti,Oa,vc,xc,Rf,wc,uc,Pc,Af,oe,Cd,ji,Dd,Pe,Eh,Nf,If,Uc,Tk,Uk,di,gf,zf,fg,ye,hg,Th,Xf,qe,re,De,ze,kg,ue,Ih,Hd,Wf,Oh,Cf,te,eg,Ee,Ae,Qh,Fe,we,ve,Ce,mg,Xh,Rh,Lh,$c,Zd,Fb,kb,xi,qf,oh,vi],Zk=function(c,b,d){return d&&d.admin},jf=function(c,b,d){return(d&&d.admin||!d)&&
!p.started},Y=function(c,b,d){c=b.length;d=C[d.kingdom].control;for(var e=0;e<c;e++)if(!d[z[b[e]].kingdom])return!1;return!0},Qd=function(c,b,d){c=C[d.kingdom].control;b=z[b];return c[b.kingdom]?!0:!1},Ai=function(c,b,d){b=C[d.kingdom].control;c=z[c];return b[c.kingdom]?!0:!1};ti.secureNH=jf;Oa.secureNH=Y;vc.secureNH=Y;xc.secureNH=Y;Rf.secureNH=Y;wc.secureNH=Y;uc.secureNH=Y;Af.secureNH=Qd;oe.secureNH=Y;Cd.secureNH=Y;ji.secureNH=Ai;Dd.secureNH=Y;Pe.secureNH=Y;Eh.secureNH=Y;Nf.secureNH=Y;If.secureNH=
Qd;di.secureNH=Qd;gf.secureNH=function(c,b,d){return d&&d.admin||!d};zf.secureNH=Qd;fg.secureNH=Y;ye.secureNH=Y;hg.secureNH=Y;Th.secureNH=Ai;Xf.secureNH=Y;qe.secureNH=Y;re.secureNH=Y;De.secureNH=Y;ze.secureNH=Y;kg.secureNH=Y;ue.secureNH=Y;Ih.secureNH=Y;Hd.secureNH=Ai;Wf.secureNH=Y;Oh.secureNH=Y;Cf.secureNH=Y;te.secureNH=Y;eg.secureNH=Y;Ee.secureNH=Y;Ae.secureNH=Y;Qh.secureNH=Y;Fe.secureNH=Y;we.secureNH=Y;ve.secureNH=Y;Ce.secureNH=Y;mg.secureNH=Y;Xh.secureNH=Qd;Rh.secureNH=Qd;Lh.secureNH=Y;$c.secureNH=
jf;Fb.secureNH=jf;xi.secureNH=jf;qf.secureNH=jf;vi.secureNH=Zk;kb.secureNH=Zk;oh.secureNH=function(c,b,d){return!d};localStorage.favMusic&&(musicSelect.mversion.value=localStorage.favMusic);(function(){for(var c=Gf,b=0,d=c.length;b<d;b++)c[b].location=b})();var $k=document.getElementsByClassName("ucolor1"),Cm=document.getElementsByClassName("username1"),Dm=document.getElementsByClassName("race1"),Em=document.getElementsByClassName("team1"),Wk=function(c){var b=1;2==c.button&&(b=-1);if(p.online){c=
this.iteam;c.team+=b;0>c.team&&(c.team=0);c.team%=6;this.innerHTML=c.team;if(c==v){I(Zd,pf());return}return I(Fb,aa,0)}c=this.iteam;ra[c].team+=b;0>ra[c].team&&(ra[c].team=0);this.innerHTML=ra[c].team},Xk=function(c){if(p.online){c=this.iteam;c.race=(c.race+1)%3;this.innerHTML=Ha[c.race];if(c==v){I(Zd,pf());return}return I(Fb,aa,0)}c=ra[this.iteam];c.race=(c.race+1)%3;this.innerHTML=Ha[c.race]},Yk=function(){J(this.value);this.parentElement.style.background=this.value;var c=Yg(this.value);if(p.online){c=
this.iteam;c.color=this.value;if(c==v){I(Zd,pf());return}return I(Fb,aa,0)}v.color=this.value;ra[this.iteam].color=c},Fm=function(){mc.nu++;mc()},Gm=function(){mc.nu--;0>=mc.nu?mc.nu=1:ra.length--;mc()},sg={0:"euro",1:"arab",2:"asia"},al=[["a","e","i","o","u"],"bcdfghjklmnpqrstvwxyz".split("")],mc=function(){if(v.name){document.getElementById("returnmenu").style.display="block";document.getElementById("oneplayertbody").innerHTML="";document.getElementById("oneplayertbody").innerHTML+='<tr><td></td><td id="addremove"><button id="addPlayer">+</button><button id="removePlayer">-</button></td><td></td><td></td></tr>';
for(var c=mc.nu,b=0;b<c;b++)if(document.getElementById("oneplayertbody").innerHTML+='<tr><td class="ucolor1"></td><td class="username1"></td><td class="race1"><button></button></td><td class="team1"><button></button></td></tr>',!ra[b]){var d={color:"#"+(~~(16777216*Math.random())).toString(16),IA:1,race:~~(3*Math.random()),team:b};ra[b]=d}document.getElementById("addPlayer").onclick=Fm;document.getElementById("removePlayer").onclick=Gm;ra[0].color=v.color;ra[0].name=v.name;for(b=d=ra[0].IA=0;b<c;b++){var f=
ra[b],g=yj[sg[f.race]];if(f.IA)if(d<g.length)f.name=g[d++];else{g=f;var h=~~(9*Math.random())+2,l=al[1],k=l[~~(Math.random()*l.length)].toUpperCase();.85<Math.random()&&(k+=l[~~(Math.random()*l.length)]);for(l=0;l<h;l++){var m=al[l%2];k+=m[~~(Math.random()*m.length)];.8<Math.random()&&(k+=m[~~(Math.random()*m.length)])}g.name=k}$k[b].style.background=f.color;Cm[b].innerHTML=f.name;g=Em[b].getElementsByTagName("button")[0];g.iteam=b;g.onmousedown=Wk;g.innerHTML=b;g=Dm[b].getElementsByTagName("button")[0];
g.iteam=b;g.onmousedown=Xk;g.innerHTML=Ha[f.race];g=document.createElement("input");g.type="color";g.iteam=b;g.value=f.color;$k[b].appendChild(g);g.onchange=Yk}}else Kk(mc)};mc.nu=4;var nm=function(c,b,d){"granted"!=Notification.permission&&Notification.requestPermission(function(b){});var e=new Notification(c,{icon:"/nehhon/807.png",body:b,requireInteraction:!1});d||(d=7550);setTimeout(function(){e.close()},d)},pc,Wc=function(c){if(ha(c%G,~~(c/G))&&(c=Tc[c],0<=c&&!pc.type[c]))return!0},bl=function(c){for(var b=
"",d=0,f=c.length;d<f;d++)b+=um[c[d]];return b};zl[bl([32718400,37271025,40005625,40704400,36602500,28462225,35940025,30858025])]!==bl([40704400,45024100,28462225,6400900,39312900,30858025,3025E4])&&(J("edge chrome firefox - compt"),Pi=Gc);var Yc=function(c){if(c){Yc.update=!1;c=Tc;for(var b=1*G,d=[],f={},g=0,h=G*Da;g<h;g++){var l=c[g];if(pc.type[l]||0>l){var m=0;Wc(g-1-b)&&(m+=1E7);Wc(g-b)&&(m+=1E6);Wc(g-b+1)&&(m+=1E5);Wc(g-1)&&(m+=1E4);Wc(g+1)&&(m+=1E3);Wc(g-1+b)&&(m+=100);Wc(g+b)&&(m+=10);Wc(g+
1+b)&&(m+=1);pc.type[l]&&(Ub[g]=1,hb[g]=1,N[g]=1);m?void 0!==uk[m]&&(d.put(g),f[d.length-1]=-uk[m]/256-2):0>l&&(c[g]=3)}}g=0;for(b=d.length;g<b;g++)h=d[g],c[h]=f[g],Ub[h]=2,hb[h]=2,N[h]=2;k.useProgram(za);k.activeTexture(k.TEXTURE1);d=k.createTexture();k.bindTexture(k.TEXTURE_2D,d);k.texImage2D(k.TEXTURE_2D,0,k.R8I,G,Da,0,k.RED_INTEGER,k.BYTE,c);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,
k.REPEAT);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT);k.bindTexture(k.TEXTURE_2D,null);k.bindTexture(k.TEXTURE_2D,d);k.uniform1i(k.getUniformLocation(za,"img_data"),1);k.useProgram(Ba);k.activeTexture(k.TEXTURE2)}else Yc.update=!0};Yc.update=!1;var d,zk,Bg,Ve,We,Xe,Ye,Ze,$e,af,bf,cf,df,ef,ff,lm=function(){var c={};d={move:function(){U=Oa;Oa.cursor=7}};d.move.iconID=262;d.move.obj={name:u.move};d.attack=function(){U=xc};d.attack.iconID=250;d.attack.obj={name:u.attack};d.guard=function(){Rc(4)};
d.guard.iconID=237;d.guard.obj={name:u.guard};d.patrol=function(){Rc(8)};d.patrol.iconID=238;d.patrol.obj={name:u.patrol};d.pickUp=function(){U=Cd};d.pickUp.iconID=240;d.pickUp.obj={name:u.pickItems};d.explore=function(){Rc(7)};d.explore.iconID=40;d.explore.obj={name:u.explore};d.stop=function(){I(Eh,0,K)};d.stop.iconID=160;d.stop.obj={name:u.stop};d.stand=function(){I(Ih,0,K)};d.stand.iconID=27;d.stand.obj={name:u.stand};d.attackGround=function(){};d.attackGround.iconID=100;d.steady=function(){};
d.steady.iconID=21;d.createOrk=function(){ca(58)};d.createOrk.iconID=120;d.createDwarf=function(){ca(59)};d.createDwarf.iconID=117;d.createSkeleton=function(){ca(60)};d.createSkeleton.iconID=87;d.createGhost=function(){ca(40)};d.createGhost.iconID=222;d.createFootman=function(){ca(0)};d.createFootman.iconID=182;d.createArcher=function(){ca(4)};d.createArcher.iconID=185;d.createMaceman=function(){ca(3)};d.createMaceman.iconID=186;d.createPikeman=function(){ca(1)};d.createPikeman.iconID=183;d.createLongbowman=
function(){ca(6)};d.createLongbowman.iconID=184;d.createKnight=function(){ca(19)};d.createKnight.iconID=180;d.iniMercenaries=function(b){b.mlist=[];b.mlistID=[];b.mercID=0;Ah(b);b.setupINTV(ii,b.id,2E3)};d.iniMercenaries.builds=[30];d.iniHeroes=function(b){b.hlist=[];b.hlistID=[];b.heroID=0;Ah(b);b.setupINTV(ii,b.id,2E3)};d.iniHeroes.builds=[30];d.mercFootmanArab=function(){Ma()};d.mercFootmanArab.iconID=49;d.mercFootmanArab.unit=80;d.mercFootmanArab.obj={};d.mercArcherArab=function(){Ma()};d.mercArcherArab.iconID=
52;d.mercArcherArab.unit=85;d.mercArcherArab.obj={};d.mercMacemanArab=function(){Ma()};d.mercMacemanArab.iconID=116;d.mercMacemanArab.obj={};d.mercMacemanArab.unit=83;d.mercPikemanArab=function(){Ma()};d.mercPikemanArab.iconID=52;d.mercPikemanArab.unit=82;d.mercPikemanArab.obj={};d.mercCavalry=function(){Ma()};d.mercCavalry.iconID=133;d.mercCavalry.unit=84;d.mercCavalry.obj={};d.mercEnichar=function(){Ma()};d.mercEnichar.iconID=123;d.mercEnichar.unit=91;d.mercEnichar.obj={};d.mercJihad=function(){Ma()};
d.mercJihad.iconID=236;d.mercJihad.unit=86;d.mercJihad.obj={};d.mercFootmanArab6=function(){Fa()};d.mercFootmanArab6.iconID=49;d.mercFootmanArab6.unit=80;d.mercFootmanArab6.obj={};d.mercArcherArab6=function(){Fa()};d.mercArcherArab6.iconID=52;d.mercArcherArab6.unit=85;d.mercArcherArab6.obj={};d.mercMacemanArab6=function(){Fa()};d.mercMacemanArab6.iconID=116;d.mercMacemanArab6.unit=83;d.mercMacemanArab6.obj={};d.mercPikemanArab6=function(){Fa()};d.mercPikemanArab6.iconID=52;d.mercPikemanArab6.unit=
82;d.mercPikemanArab6.obj={};d.mercCavalry6=function(){Fa()};d.mercCavalry6.iconID=133;d.mercCavalry6.unit=84;d.mercCavalry6.obj={};d.mercEnichar6=function(){Fa()};d.mercEnichar6.iconID=123;d.mercEnichar6.unit=91;d.mercEnichar6.obj={};d.mercJihad6=function(){Fa()};d.mercJihad6.iconID=236;d.mercJihad6.unit=86;d.mercJihad6.obj={};d.mercFootman=function(){Ma()};d.mercFootman.iconID=182;d.mercFootman.unit=0;d.mercArcher=function(){Ma()};d.mercArcher.iconID=185;d.mercArcher.unit=4;d.mercMaceman=function(){Ma()};
d.mercMaceman.iconID=186;d.mercMaceman.unit=3;d.mercPikeman=function(){Ma()};d.mercPikeman.iconID=183;d.mercPikeman.unit=1;d.mercLongbowman=function(){Ma()};d.mercLongbowman.iconID=184;d.mercLongbowman.unit=6;d.mercKnight=function(){Ma()};d.mercKnight.iconID=180;d.mercKnight.unit=19;d.mercFootman6=function(){Fa()};d.mercFootman6.iconID=182;d.mercFootman6.unit=0;d.mercFootman6.obj={};d.mercArcher6=function(){Fa()};d.mercArcher6.iconID=185;d.mercArcher6.unit=4;d.mercArcher6.obj={};d.mercMaceman6=function(){Fa()};
d.mercMaceman6.iconID=186;d.mercMaceman6.unit=3;d.mercMaceman6.obj={};d.mercPikeman6=function(){Fa()};d.mercPikeman6.iconID=183;d.mercPikeman6.unit=1;d.mercPikeman6.obj={};d.mercLongbowman6=function(){Fa()};d.mercLongbowman6.iconID=184;d.mercLongbowman6.unit=6;d.mercLongbowman6.obj={};d.mercKnight6=function(){Fa()};d.mercKnight6.iconID=180;d.mercKnight6.unit=19;d.mercKnight6.obj={};d.mercArcherAsian6=function(){Fa()};d.mercArcherAsian6.iconID=53;d.mercArcherAsian6.unit=67;d.mercArcherAsian6.obj={};
d.mercSamurai6=function(){Fa()};d.mercSamurai6.iconID=122;d.mercSamurai6.unit=68;d.mercSamurai6.obj={};d.mercHourseSamurai6=function(){Fa()};d.mercHourseSamurai6.iconID=121;d.mercHourseSamurai6.unit=70;d.mercHourseSamurai6.obj={};d.mercRonin6=function(){Fa()};d.mercRonin6.iconID=54;d.mercRonin6.unit=66;d.mercRonin6.obj={};d.mercHorseArcher6=function(){Fa()};d.mercHorseArcher6.iconID=52;d.mercHorseArcher6.unit=69;d.mercHorseArcher6.obj={};d.mercChariot6=function(){Fa()};d.mercChariot6.iconID=79;d.mercChariot6.unit=
72;d.mercChariot6.obj={};d.mercArcherAsian=function(){Ma()};d.mercArcherAsian.iconID=53;d.mercArcherAsian.unit=67;d.mercArcherAsian.obj={};d.mercSamurai=function(){Ma()};d.mercSamurai.iconID=122;d.mercSamurai.unit=68;d.mercSamurai.obj={};d.mercHourseSamurai=function(){Ma()};d.mercHourseSamurai.iconID=121;d.mercHourseSamurai.unit=70;d.mercHourseSamurai.obj={};d.mercRonin=function(){Ma()};d.mercRonin.iconID=54;d.mercRonin.unit=66;d.mercRonin.obj={};d.mercHorseArcher=function(){Ma()};d.mercHorseArcher.iconID=
52;d.mercHorseArcher.unit=69;d.mercHorseArcher.obj={};d.mercChariot=function(){Ma()};d.mercChariot.iconID=79;d.mercChariot.unit=72;d.mercChariot.obj={};d.createPeon=function(){ca(10)};d.createPeon.iconID=187;d.sameSpeed=function(){I(Cf,0,K)};d.sameSpeed.iconID=82;d.restoreSpeed=function(){I(Oh,0,K)};d.restoreSpeed.iconID=88;d.createSpy=function(){ca(2)};d.createSpy.iconID=162;d.emergeAllUnits=function(){var b=K[0];I(Dd,b,z[b].inventory.slice(0))};d.emergeAllUnits.iconID=261;d.techFeudalism=function(){D(12)};
d.techFeudalism.iconID=233;d.techArchitecture=function(){D(13)};d.techArchitecture.iconID=226;d.techLearning=function(){D(14)};d.techLearning.iconID=129;d.createPeon1=function(){ca(64)};d.createPeon1.iconID=55;d.createPeon2=function(){ca(79)};d.createPeon2.iconID=132;d.createNinja=function(){ca(65)};d.createNinja.iconID=51;d.techArmoredChariot=function(){D(51)};d.techArmoredChariot.iconID=79;d.techBuddhism=function(){D(45)};d.techBuddhism.iconID=127;d.techGreatWall=function(){D(48)};d.techGreatWall.iconID=
80;d.ridingHorses=function(){D(49)};d.ridingHorses.iconID=64;d.irrigation=function(){D(50)};d.irrigation.iconID=72;d.createHorseArcher2=function(){ca(85)};d.createHorseArcher2.iconID=52;d.techMeditation=function(){D(52)};d.techMeditation.iconID=71;d.techKungFu=function(){D(53)};d.techKungFu.iconID=228;d.techTournaments=function(){D(54)};d.techTournaments.iconID=73;d.techPhilosophy=function(){D(55)};d.techPhilosophy.iconID=68;d.techNinjas=function(){D(56)};d.techNinjas.iconID=56;d.techMastery=function(){D(57)};
d.techMastery.iconID=69;d.techGoldMining=function(){D(1)};d.techGoldMining.iconID=58;d.techStoneMining=function(){D(2)};d.techStoneMining.iconID=57;d.createCrusaders=function(){I(ji,K[0],0)};d.createCrusaders.iconID=221;d.techFanaticism=function(){D(31)};d.techFanaticism.iconID=235;d.techCrusade=function(){D(32)};d.techCrusade.iconID=93;d.techEspionage=function(){D(30)};d.techEspionage.iconID=215;d.techInquisition=function(){D(33)};d.techInquisition.iconID=97;d.techHealing=function(){D(34)};d.techHealing.iconID=
219;d.healing=function(){U=fg};d.healing.iconID=219;d.healing.iconIDbook=201;d.teach=function(){U=mg};d.teach.iconID=23;d.teach.iconIDbook=217;d.techBless=function(){D(36)};d.techBless.iconID=159;d.bless=function(){U=ye};d.bless.iconID=159;d.bless.iconIDbook=204;d.techMedicine=function(){D(35)};d.techMedicine.iconID=220;d.createMage=function(){ca(5)};d.createMage.iconID=156;d.techBat=function(){D(38)};d.techBat.iconID=168;d.techGolem=function(){D(41)};d.techGolem.iconID=119;d.techInvisibility=function(){D(37)};
d.techInvisibility.iconID=217;d.techLightning=function(){D(40)};d.techLightning.iconID=143;d.techFreeze=function(){D(39)};d.techFreeze.iconID=130;d.techHeroism=function(){D(22)};d.techHeroism.iconID=136;d.techWarfare=function(){D(23)};d.techWarfare.iconID=108;d.techTactics=function(){D(24)};d.techTactics.iconID=257;d.techMercenaries=function(){D(25)};d.techMercenaries.iconID=95;d.techHeroes=function(){D(26)};d.techHeroes.iconID=96;d.techFame=function(){D(27)};d.techFame.iconID=111;d.techSiegeTactics=
function(){D(28)};d.techSiegeTactics.iconID=258;d.techBodyBuilding=function(){D(29)};d.techBodyBuilding.iconID=101;d.createPriest=function(){ca(9)};d.createPriest.iconID=155;d.createCow=function(){ca(27)};d.createCow.iconID=163;d.techCropRotation=function(){D(8)};d.techCropRotation.iconID=227;d.techDomestication=function(){D(7)};d.techDomestication.iconID=157;d.techMapMaking=function(){D(16)};d.techMapMaking.iconID=89;d.techTradeRoutes=function(){D(17)};d.techTradeRoutes.iconID=102;d.techTradeTaxes=
function(){D(18)};d.techTradeTaxes.iconID=110;d.techUsury=function(){D(19)};d.techUsury.iconID=105;d.techSupplyStorage=function(){D(20)};d.techSupplyStorage.iconID=62;d.techBribery=function(){D(21)};d.techBribery.iconID=109;d.bribe=function(){};d.bribe.iconID=128;d.createCaravan=function(){ca(61)};d.createCaravan.iconID=169;d.createCaravan2=function(){ca(90)};d.createCaravan2.iconID=134;d.createFootman2=function(){ca(80)};d.createFootman2.iconID=49;d.createArcher2=function(){ca(81)};d.createArcher2.iconID=
43;d.createSatrap=function(){ca(83)};d.createSatrap.iconID=116;d.createPikeman2=function(){ca(82)};d.createPikeman2.iconID=42;d.createHorseArcher2=function(){ca(85)};d.createHorseArcher2.iconID=124;d.createCavalry=function(){ca(84)};d.createCavalry.iconID=133;d.createEnichar=function(){ca(91)};d.createEnichar.iconID=123;d.createJihad=function(){ca(86)};d.createJihad.iconID=236;d.trade=function(){};d.trade.iconID=161;d.unload=function(){U=qe};d.unload.iconID=148;d.createMercenaries=function(){pa(z[K[0]].mlist)};
d.createMercenaries.iconID=95;d.createHeroes=function(){pa(z[K[0]].hlist)};d.createHeroes.iconID=96;d.upgradeGuildTower=function(){D(42)};d.upgradeGuildTower.iconID=171;d.upgradeStoneTower=function(){D(43)};d.upgradeStoneTower.iconID=178;d.upgradeCannonTower=function(){D(44)};d.upgradeCannonTower.iconID=178;d.createCatapult=function(){ca(37)};d.createCatapult.iconID=152;d.createHeavyCatapult=function(){ca(39)};d.createHeavyCatapult.iconID=153;d.createBallist=function(){ca(38)};d.createBallist.iconID=
154;d.techEngineering=function(){D(47)};d.techEngineering.iconID=92;d.techCannonTower=function(){D(46)};d.techCannonTower.iconID=178;d.techPlateArmor=function(){D(10)};d.techPlateArmor.iconID=131;d.techTemperIron=function(){D(4)};d.techTemperIron.iconID=266;d.techHalberd=function(){D(6)};d.techHalberd.iconID=113;d.techScaleArmor=function(){D(5)};d.techScaleArmor.iconID=251;d.techChainMail=function(){D(9)};d.techChainMail.iconID=252;d.techLongbow=function(){D(0)};d.techLongbow.iconID=259;d.techWoodCutting=
function(){D(3)};d.techWoodCutting.iconID=107;d.techCrossbow=function(){D(11)};d.techCrossbow.iconID=112;d.createFishingBoat=function(){ca(74)};d.createFishingBoat.iconID=48;d.createXebec=function(){ca(76)};d.createXebec.iconID=166;d.upgradeShip=function(){};d.upgradeShip.iconID=268;d.fishing=function(){};d.fishing.iconID=41;d.createHulk=function(){ca(75)};d.createHulk.iconID=165;d.createGalleon=function(){ca(73)};d.createGalleon.iconID=164;d.techLandingTactics=function(){};d.techLandingTactics.iconID=
98;d.techConcentration=function(){D(58)};d.techConcentration.iconID=75;d.techConfusion=function(){D(59)};d.techConfusion.iconID=76;d.techWhirlpool=function(){D(60)};d.techWhirlpool.iconID=78;d.techDragon=function(){D(61)};d.techDragon.iconID=115;d.techTurnToStone=function(){D(62)};d.techTurnToStone.iconID=77;d.techFlameBolt=function(){D(63)};d.techFlameBolt.iconID=25;d.techJewelry=function(){D(64)};d.techJewelry.iconID=230;d.techBanking=function(){D(65)};d.techBanking.iconID=74;d.techChemistry=function(){D(66)};
d.techChemistry.iconID=225;d.techSeaFood=function(){D(67)};d.techSeaFood.iconID=67;d.techGunPowder=function(){D(68)};d.techGunPowder.iconID=212;d.techRocketArrow=function(){D(69)};d.techRocketArrow.iconID=47;d.techBushido=function(){D(70)};d.techBushido.iconID=60;d.techLeadership=function(){D(71)};d.techLeadership.iconID=114;d.techHonor=function(){D(72)};d.techHonor.iconID=94;d.techSunTzu=function(){D(73)};d.techSunTzu.iconID=66;d.createRonin=function(){ca(66)};d.createRonin.iconID=54;d.createArcher1=
function(){ca(67)};d.createArcher1.iconID=53;d.createSamurai=function(){ca(68)};d.createSamurai.iconID=122;d.createHorseArcher1=function(){ca(69)};d.createHorseArcher1.iconID=52;d.createMonk=function(){ca(128)};d.createMonk.iconID=45;d.createMage1=function(){ca(129)};d.createMage1.iconID=50;d.createPriest1=function(){ca(127)};d.createPriest1.iconID=44;d.createPriest2=function(){ca(87)};d.createPriest2.iconID=125;d.buyItems=function(){};d.buyItems.iconID=31;d.sellItems=function(){};d.sellItems.iconID=
30;d.createHorseSamurai=function(){ca(70)};d.createHorseSamurai.iconID=121;d.createChariot=function(){ca(72)};d.createChariot.iconID=79;d.stopTech=function(){I(Nf,0,K)};d.stopTech.iconID=160;d.repair=function(){U=wc};d.repair.iconID=145;d.conquest=function(){};d.conquest.iconID=249;d.dcm=function(){U=vc};d.dcm.iconID=260;d.buildBarrack=function(){R(14)};d.buildBarrack.iconID=205;d.buildBarrack1=function(){R(71)};d.buildBarrack1.iconID=205;d.buildBarrack2=function(){R(102)};d.buildBarrack2.iconID=
205;d.buildTower=function(){R(32)};d.buildTower.iconID=170;d.buildStorage=function(){R(18)};d.buildStorage.iconID=200;d.buildLumbermill=function(){R(15)};d.buildLumbermill.iconID=199;d.buildLumbermill2=function(){R(93)};d.buildLumbermill2.iconID=199;d.buildFields=function(){R(20)};d.buildFields.iconID=265;d.buildCastle=function(){R(12)};d.buildCastle.iconID=206;d.buildCastle1=function(){R(62)};d.buildCastle1.iconID=206;d.buildCastle2=function(){R(63)};d.buildCastle2.iconID=206;d.buildAcademy=function(){R(17)};
d.buildAcademy.iconID=204;d.buildCathedral=function(){R(11)};d.buildCathedral.iconID=191;d.buildCathedral2=function(){R(106)};d.buildCathedral2.iconID=189;d.buildMerchands=function(){R(24)};d.buildMerchands.iconID=198;d.buildMerchands2=function(){R(108)};d.buildMerchands2.iconID=198;d.buildChurch=function(){R(25)};d.buildChurch.iconID=197;d.buildMarket=function(){R(33)};d.buildMarket.iconID=194;d.buildMageTower=function(){R(16)};d.buildMageTower.iconID=192;d.buildMageTower2=function(){R(107)};d.buildMageTower2.iconID=
192;d.buildDummy=function(){R(36)};d.buildDummy.iconID=65;d.buildFarm=function(){R(23)};d.buildFarm.iconID=193;d.buildBlacksmith=function(){R(26)};d.buildBlacksmith.iconID=202;d.buildWorkshop=function(){R(29)};d.buildWorkshop.iconID=201;d.buildWorkshop2=function(){R(98)};d.buildWorkshop2.iconID=201;d.buildStable=function(){R(28)};d.buildStable.iconID=196;d.buildStable2=function(){R(103)};d.buildStable2.iconID=196;d.buildTavern=function(){R(30)};d.buildTavern.iconID=208;d.buildHouse=function(){R(31)};
d.buildHouse.iconID=195;d.buildHarbor=function(){R(41)};d.buildHarbor.iconID=188;d.buildOutpost=function(){R(34)};d.buildOutpost.iconID=158;d.buildWoodWall=function(){Dh(13)};d.buildWoodWall.iconID=210;d.buildWoodGate=function(){};d.buildWoodGate.iconID=209;d.buildWoodGate.disabled=2;d.buildBridge=function(){R(35)};d.buildBridge.iconID=176;Bg="freeze invisibility lightning turnToStone bless healing".split(" ");d.freeze=function(){U=De};d.freeze.iconID=99;d.freeze.obj={name:u.freeze};d.freeze.iconIDbook=
205;d.confusion=function(){U=Ee};d.confusion.iconID=76;d.confusion.obj={name:"Confusion",spcost:[120,0,0,0]};d.confusion.iconIDbook=206;d.turnToStone=function(){U=eg};d.turnToStone.iconID=77;d.turnToStone.iconIDbook=213;d.turnToStone.obj={name:"Turn to Stone",spcost:[40,0,0,0]};d.whirlpool=function(){U=Qh};d.whirlpool.iconID=78;d.whirlpool.iconIDbook=214;d.whirlpool.obj={name:"Whirlpool",spcost:[80,0,0,0]};d.flameBolt=function(){U=Ae};d.flameBolt.iconID=25;d.flameBolt.obj={name:"Flame Bolt",spcost:[120,
0,0,0]};d.flameBolt.iconIDbook=216;d.createDragon=function(){U=te};d.createDragon.iconID=115;d.createDragon.obj={name:"Spawn Dragon",spcost:[320,0,0,0]};d.createDragon.iconIDbook=215;d.lightning=function(){U=kg};d.lightning.iconID=263;d.lightning.obj={name:u.lightning,spcost:[80,0,0,0]};d.lightning.iconIDbook=200;d.createBat=function(){U=ue};d.createBat.iconID=168;d.createBat.iconIDbook=203;d.createGolem=function(){U=re};d.createGolem.iconID=119;d.createGolem.iconIDbook=209;d.autoInvisibility=function(){U=
ze};d.autoInvisibility.iconID=217;d.autoInvisibility.obj={name:u.invisibility};d.invisibility=function(){U=ze};d.invisibility.iconID=217;d.invisibility.iconIDbook=208;d.impersonate=function(){U=hg};d.impersonate.iconID=32;d.impersonate.obj={name:"Impersonate"};d.revealSelf=function(){I(Th,K[0],0)};d.revealSelf.iconID=33;d.revealSelf.obj={name:"Reveal your true self"};d.buildHouse1=function(){R(111)};d.buildHouse1.iconID=195;d.buildHouse2=function(){R(92)};d.buildHouse2.iconID=195;d.buildLumbermill1=
function(){R(112)};d.buildLumbermill1.iconID=199;d.buildStorage1=function(){R(113)};d.buildStorage1.iconID=200;d.buildStorage2=function(){R(94)};d.buildStorage2.iconID=200;d.buildFarm1=function(){R(114)};d.buildFarm1.iconID=193;d.buildFarm2=function(){R(95)};d.buildFarm2.iconID=193;d.buildHarbor1=function(){R(115)};d.buildHarbor1.iconID=188;d.buildHarbor2=function(){R(96)};d.buildHarbor2.iconID=188;d.buildBlacksmith1=function(){R(116)};d.buildBlacksmith1.iconID=202;d.buildBlacksmith2=function(){R(97)};
d.buildBlacksmith2.iconID=202;d.buildWorkshop1=function(){R(117)};d.buildWorkshop1.iconID=201;d.buildChurch1=function(){R(118)};d.buildChurch1.iconID=197;d.buildChurch2=function(){R(99)};d.buildChurch2.iconID=197;d.buildTavern1=function(){R(119)};d.buildTavern1.iconID=208;d.buildTavern2=function(){R(100)};d.buildTavern2.iconID=208;d.buildMarket1=function(){R(120)};d.buildMarket1.iconID=194;d.buildMarket2=function(){R(101)};d.buildMarket2.iconID=194;d.buildStable1=function(){R(121)};d.buildStable1.iconID=
196;d.buildOutpost1=function(){R(122)};d.buildOutpost1.iconID=158;d.buildOutpost2=function(){R(104)};d.buildOutpost2.iconID=158;d.buildCathedral1=function(){R(123)};d.buildCathedral1.iconID=190;d.buildMageTower1=function(){R(124)};d.buildMageTower1.iconID=192;d.createObjects=function(){Ge("magicworkshopmenu",ja)};d.createObjects.iconID=20;d.createObjects.obj={};d.buildMagicWorkshop=function(){R(110)};d.buildMagicWorkshop.iconID=46;d.buildMerchands1=function(){R(125)};d.buildMerchands1.iconID=198;
d.buildAcademy1=function(){R(126)};d.buildAcademy1.iconID=204;d.buildAcademy2=function(){R(109)};d.buildAcademy2.iconID=204;d.buildRocketTower=function(){R(57)};d.buildRocketTower.iconID=47;d.murder=function(){};d.murder.iconID=28;d.convertJihad=function(){I(Lh,86,K)};d.convertJihad.iconID=236;d.convertJihad.obj={};d.menuCommonBuild2=function(){pa(cf)};d.menuCommonBuild2.iconID=17;cf=[d.buildFarm2,d.buildBlacksmith2,d.buildWorkshop2,d.buildStable2,d.buildTavern2,d.buildHouse2];cf.menuName="a_build";
d.menuCommonBuild2.xtra=cf;d.menuSpecialBuild2=function(){pa(df)};d.menuSpecialBuild2.iconID=15;df=[d.buildCastle2,d.buildAcademy2,d.buildCathedral2,d.buildMerchands2,d.buildChurch2,d.buildMarket2,d.buildMageTower2,d.buildMagicWorkshop];df.menuName="a_build";d.menuSpecialBuild2.xtra=df;d.menuOtherBuild2=function(){pa(ef)};d.menuOtherBuild2.iconID=16;ef=[d.buildHarbor2,d.buildOutpost2,d.buildWoodWall,d.buildWoodGate,d.buildBridge];ef.menuName="e_build";d.menuOtherBuild2.xtra=ef;d.menuBuilds2=function(){pa(ff)};
d.menuBuilds2.iconID=245;ff=[d.menuSpecialBuild2,d.menuCommonBuild2,d.menuOtherBuild2,d.buildBarrack2,d.buildTower,d.buildStorage2,d.buildLumbermill2,d.buildFields];ff.menuName="a_build";d.menuBuilds2.xtra=ff;d.origin=Hk;d.origin.iconID=255;d.createCarpet=function(){U=we};d.createCarpet.iconID=146;d.createCarpet.iconIDbook=202;d.createJinn=function(){U=ve};d.createJinn.iconID=118;d.createJinn.iconIDbook=218;d.magicVision=function(){};d.magicVision.iconID=223;d.magicVision.iconIDbook=210;d.fireRain=
function(){U=Fe};d.fireRain.iconID=264;d.fireRain.iconIDbook=199;d.raiseDead=function(){U=Ce};d.raiseDead.iconID=87;d.raiseDead.iconIDbook=211;d.createMage2=function(){ca(89)};d.createMage2.iconID=126;d.techCowPoaching=function(){D(74)};d.techCowPoaching.iconID=85;d.techHorseManShip=function(){D(75)};d.techHorseManShip.iconID=231;d.techScimitar=function(){D(76)};d.techScimitar.iconID=84;d.techJihad=function(){D(77)};d.techJihad.iconID=236;d.techCarpet=function(){D(78)};d.techCarpet.iconID=146;d.techMagicWorkshop=
function(){D(79)};d.techMagicWorkshop.iconID=86;d.techFireRain=function(){D(80)};d.techFireRain.iconID=264;d.techMagicVision=function(){D(81)};d.techMagicVision.iconID=224;d.techNecromancy=function(){D(82)};d.techNecromancy.iconID=87;d.techJinn=function(){D(83)};d.techJinn.iconID=118;d.techOreFloatation=function(){D(84)};d.techOreFloatation.iconID=106;d.techRiddingHorses=function(){D(85)};d.techRiddingHorses.iconID=232;d.techJanissary=function(){D(86)};d.techJanissary.iconID=81;d.buildMagicItems=
function(){};d.buildMagicItems.iconID=20;d.techSlavery=function(){D(87)};d.techSlavery.iconID=135;d.stopBuilding=function(){I(Pe,0,K)};d.stopBuilding.iconID=160;d.menuSpecialBuild1=function(){pa(Ve)};d.menuSpecialBuild1.iconID=15;Ve=[d.buildCastle1,d.buildAcademy1,d.buildCathedral1,d.buildMerchands1,d.buildChurch1,d.buildMarket1,d.buildMageTower1,d.buildRocketTower,d.buildDummy];Ve.menuName="a_build";d.menuSpecialBuild1.xtra=Ve;d.menuCommonBuild1=function(){pa(We)};d.menuCommonBuild1.iconID=17;We=
[d.buildFarm1,d.buildBlacksmith1,d.buildWorkshop1,d.buildStable1,d.buildTavern1,d.buildHouse1];We.menuName="a_build";d.menuCommonBuild1.xtra=We;d.menuSpecialBuild=function(){pa(Xe)};d.menuSpecialBuild.iconID=15;Xe=[d.buildCastle,d.buildAcademy,d.buildCathedral,d.buildMerchands,d.buildChurch,d.buildMarket,d.buildMageTower,d.buildDummy];Xe.menuName="e_build";d.menuSpecialBuild.xtra=Xe;d.menuCommonBuild=function(){pa(Ye)};d.menuCommonBuild.iconID=17;Ye=[d.buildFarm,d.buildBlacksmith,d.buildWorkshop,
d.buildStable,d.buildTavern,d.buildHouse];Ye.menuName="e_build";d.menuCommonBuild.xtra=Ye;d.menuOtherBuild=function(){pa(Ze)};d.menuOtherBuild.iconID=16;Ze=[d.buildHarbor,d.buildOutpost,d.buildWoodWall,d.buildWoodGate,d.buildBridge];Ze.menuName="e_build";d.menuOtherBuild.xtra=Ze;d.menuOtherBuild1=function(){pa($e)};d.menuOtherBuild1.iconID=16;$e=[d.buildHarbor1,d.buildOutpost1,d.buildWoodWall,d.buildWoodGate,d.buildBridge];$e.menuName="e_build";d.menuOtherBuild1.xtra=$e;d.menuBuilds=function(){pa(af)};
af=[d.menuSpecialBuild,d.menuCommonBuild,d.menuOtherBuild,d.buildBarrack,d.buildTower,d.buildStorage,d.buildLumbermill,d.buildFields];af.menuName="e_build";d.menuBuilds.iconID=245;d.menuBuilds.xtra=af;d.menuBuilds1=function(){pa(bf)};d.menuBuilds1.iconID=245;bf=[d.menuSpecialBuild1,d.menuCommonBuild1,d.menuOtherBuild1,d.buildBarrack1,d.buildTower,d.buildStorage1,d.buildLumbermill1,d.buildFields];bf.menuName="a_build";d.menuBuilds1.xtra=bf;zk=function(){d.fishing.obj={};d.impersonate.obj={};d.techGreatWall.obj=
E[48];d.revealSelf.obj={};d.trade.obj={};d.unload.obj={};d.mercFootman6.obj={};d.murder.obj={};d.mercArcher6.obj={};d.mercMaceman6.obj={};d.mercPikeman6.obj={};d.mercLongbowman6.obj={};d.sameSpeed.obj={name:"Same speed"};d.restoreSpeed.obj={name:"Restore speed"};d.mercKnight6.obj={};d.attackGround.obj={};d.steady.obj={};d.bribe.obj={};d.createPriest1.obj=x[127];d.createPriest2.obj=x[87];d.createFootman2.obj=x[80];d.createArcher2.obj=x[81];d.createSatrap.obj=x[83];d.createPikeman2.obj=x[82];d.createHorseArcher2.obj=
x[85];d.createCavalry.obj=x[84];d.createEnichar.obj=x[91];d.createJihad.obj=x[86];d.createMonk.obj=x[128];d.healing.obj={name:u.heal,spcost:[20,0,0,0]};d.bless.obj={name:u.bless,spcost:[20,0,0,0]};d.stopTech.obj={};d.conquest.obj={};d.dcm.obj={name:u.dcm};d.repair.obj={name:u.repair};d.menuOtherBuild.obj={};d.menuOtherBuild1.obj={};d.menuOtherBuild2.obj={};d.sellItems.obj={};d.buyItems.obj={};d.menuBuilds.obj={name:u.menuBuild};d.menuCommonBuild.obj={};d.menuSpecialBuild.obj={};d.techMastery.obj=
E[57];d.techNinjas.obj=E[56];d.teach.obj={name:"Teach",spcost:[20,0,0,0]};d.techPhilosophy.obj=E[55];d.techKungFu.obj=E[53];d.techTournaments.obj=E[54];d.techMeditation.obj=E[52];d.menuCommonBuild1.obj={};d.menuCommonBuild2.obj={};d.createMage1.obj=x[129];d.menuSpecialBuild1.obj={};d.menuSpecialBuild2.obj={};d.menuBuilds1.obj={name:u.menuBuild};d.menuBuilds2.obj={name:u.menuBuild};d.stopBuilding.obj={};d.freeze.obj={name:u.freeze,spcost:[200,0,0,0]};d.invisibility.obj={name:u.invisibility,spcost:[40,
0,0,0]};d.autoInvisibility.obj={name:u.invisibility};d.createHeroes.obj={};d.createMercenaries.obj={};d.upgradeShip.obj={};d.techMedicine.obj=E[35];d.techBless.obj=E[36];d.buildHouse1.obj=x[111];d.techHealing.obj=E[34];d.techInquisition.obj=E[33];d.techArmoredChariot.obj=E[51];d.techRocketArrow.obj=E[69];d.techJewelry.obj=E[64];d.techGunPowder.obj=E[68];d.techSeaFood.obj=E[67];d.techChemistry.obj=E[66];d.techBanking.obj=E[65];d.createMage.obj=x[5];d.techBat.obj=E[38];d.techGolem.obj=E[41];d.techInvisibility.obj=
E[37];d.techLightning.obj=E[40];d.techFreeze.obj=E[39];d.techHeroism.obj=E[22];d.createHorseSamurai.obj=x[70];d.createChariot.obj=x[72];d.createHorseArcher1.obj=x[69];d.createHorseArcher2.obj=x[85];d.createSamurai.obj=x[68];d.createArcher1.obj=x[67];d.techConfusion.obj=E[59];d.techConcentration.obj=E[58];d.techWhirlpool.obj=E[60];d.techDragon.obj=E[61];d.techTurnToStone.obj=E[62];d.techFlameBolt.obj=E[63];d.createRonin.obj=x[66];d.buildStorage.obj=x[18];d.buildStorage1.obj=x[113];d.buildStorage2.obj=
x[94];d.buildFields.obj=x[20];d.buildLumbermill.obj=x[15];d.buildLumbermill1.obj=x[112];d.buildLumbermill2.obj=x[93];d.buildTower.obj=x[32];d.buildBarrack1.obj=x[71];d.buildBarrack.obj=x[14];d.buildBarrack2.obj=x[102];d.buildDummy.obj=x[36];d.buildRocketTower.obj=x[57];d.buildMageTower.obj=x[16];d.buildMageTower1.obj=x[124];d.buildMageTower2.obj=x[107];d.buildMarket.obj=x[33];d.buildMarket1.obj=x[120];d.buildMarket2.obj=x[101];d.buildChurch.obj=x[25];d.buildChurch1.obj=x[118];d.buildChurch2.obj=x[99];
d.buildMerchands.obj=x[24];d.irrigation.obj=E[50];d.ridingHorses.obj=E[49];d.buildMerchands1.obj=x[125];d.buildMerchands2.obj=x[108];d.buildCathedral.obj=x[11];d.buildCathedral1.obj=x[123];d.buildCathedral2.obj=x[106];d.buildAcademy.obj=x[17];d.buildAcademy1.obj=x[126];d.buildAcademy2.obj=x[109];d.buildCastle.obj=x[12];d.magicVision.obj={name:"Magic Vision",spcost:[20,0,0,0]};d.fireRain.obj={name:"Fire Rain",spcost:[200,0,0,0]};d.raiseDead.obj={name:"Raise the Dead",spcost:[40,0,0,0]};d.createJinn.obj=
{name:"Spawn Jinn",spcost:[320,0,0,0]};d.createCarpet.obj={name:"Spawn Magic Carpet",spcost:[320,0,0,0]};d.buildCastle1.obj=x[62];d.buildCastle2.obj=x[63];d.buildHouse.obj=x[31];d.buildHouse2.obj=x[92];d.buildTavern.obj=x[30];d.buildTavern1.obj=x[119];d.buildTavern2.obj=x[100];d.buildStable.obj=x[28];d.buildStable1.obj=x[121];d.buildStable2.obj=x[103];d.buildFarm.obj=x[23];d.buildFarm1.obj=x[114];d.buildFarm2.obj=x[95];d.buildWorkshop.obj=x[29];d.buildWorkshop1.obj=x[117];d.buildWorkshop2.obj=x[98];
d.buildBlacksmith.obj=x[26];d.buildBlacksmith1.obj=x[116];d.buildBlacksmith2.obj=x[97];d.buildBridge.obj=x[35];d.buildHarbor.obj=x[41];d.buildHarbor1.obj=x[115];d.buildHarbor2.obj=x[96];d.createMage2.obj=x[89];d.buildMagicItems.obj={};d.techJanissary.obj=E[86];d.techRiddingHorses.obj=E[85];d.techOreFloatation.obj=E[84];d.techJinn.obj=E[83];d.techNecromancy.obj=E[82];d.techMagicVision.obj=E[81];d.techFireRain.obj=E[80];d.techMagicWorkshop.obj=E[79];d.techCarpet.obj=E[78];d.techJihad.obj=E[77];d.techScimitar.obj=
E[76];d.techHorseManShip.obj=E[75];d.techCowPoaching.obj=E[74];d.buildWoodGate.obj={};d.buildWoodWall.obj=x[13];d.buildOutpost.obj=x[34];d.buildOutpost1.obj=x[122];d.buildOutpost2.obj=x[104];d.createGolem.obj={name:"Spawn Stone Golem",spcost:[480,0,0,0]};d.techSunTzu.obj=E[73];d.techBushido.obj=E[70];d.techLeadership.obj=E[71];d.techHonor.obj=E[72];d.createBat.obj={name:"Spawn Bat",spcost:[40,0,0,0]};d.techGoldMining.obj=E[1];d.techStoneMining.obj=E[2];d.emergeAllUnits.obj={};d.origin.obj={name:"Origin"};
d.createOrk.obj=x[58];d.createDwarf.obj=x[59];d.createSkeleton.obj=x[60];d.createGhost.obj=x[40];d.createFootman.obj=x[0];d.createArcher.obj=x[4];d.techSlavery.obj=E[87];d.createMaceman.obj=x[3];d.createPikeman.obj=x[1];d.createLongbowman.obj=x[6];d.createKnight.obj=x[19];d.mercFootman.obj=c;d.mercArcher.obj=c;d.mercMaceman.obj=c;d.mercPikeman.obj=c;d.mercLongbowman.obj=c;d.mercKnight.obj=c;d.createPeon.obj=x[10];d.createSpy.obj=x[2];d.techFeudalism.obj=E[12];d.techArchitecture.obj=E[13];d.techLearning.obj=
E[14];d.createPeon1.obj=x[64];d.createPeon2.obj=x[79];d.createNinja.obj=x[65];d.techBuddhism.obj=E[45];d.createCrusaders.obj={name:"Preach a crusade",cost:[1E3,0,2E3,0]};d.buildMagicWorkshop.obj=x[110];d.techFanaticism.obj=E[31];d.techCrusade.obj=E[32];d.techEspionage.obj=E[30];d.techChainMail.obj=E[9];d.techHalberd.obj=E[6];d.techLongbow.obj=E[0];d.techScaleArmor.obj=E[5];d.techTemperIron.obj=E[4];d.techPlateArmor.obj=E[10];d.techLandingTactics.obj={};d.createGalleon.obj=x[73];d.createHulk.obj=x[75];
d.createXebec.obj=x[76];d.createFishingBoat.obj=x[74];d.techCrossbow.obj=E[11];d.techWoodCutting.obj=E[3];d.techCannonTower.obj=E[46];d.techEngineering.obj=E[47];d.createBallist.obj=x[38];d.createHeavyCatapult.obj=x[39];d.createCatapult.obj=x[37];d.upgradeCannonTower.obj=E[44];d.upgradeStoneTower.obj=E[43];d.upgradeGuildTower.obj=E[42];d.createCaravan.obj=x[61];d.createCaravan2.obj=x[90];d.techBribery.obj=E[21];d.techSupplyStorage.obj=E[20];d.techUsury.obj=E[19];d.techCropRotation.obj=E[8];d.createCow.obj=
x[27];d.techDomestication.obj=E[7];d.techTradeTaxes.obj=E[18];d.techTradeRoutes.obj=E[17];d.techMapMaking.obj=E[16];d.createPriest.obj=x[9];d.techBodyBuilding.obj=E[29];d.techSiegeTactics.obj=E[28];d.techFame.obj=E[27];d.techHeroes.obj=E[26];d.techMercenaries.obj=E[25];d.techTactics.obj=E[24];d.techWarfare.obj=E[23];for(var b=Object.keys(d),e=0,f=b.length;e<f;e++){var g=d[b[e]];g.objName=b[e];g.obj&&(g.obj.nu=g)}}},Eg=function(c,b){var d=b.length,f=c.length,g=0;a:for(;g<d;g++){for(var h=0;h<f;h++)if(b[g+
h]!==c[h])continue a;return g}return!1},cl=function(c){for(var b=c.length,d=new Uint16Array(c.length),f=0;f<b;f++)d[f]=c.charCodeAt(f);return d},Ec=function(c,b){return Eg(cl(c),b)+c.length},Fg=function(c,b){c+=String.fromCharCode(0);return Eg(cl(c),b)},Bi=function(c,b,d){var e="";for(b+=c;c<b&&d[c];c++)e+=String.fromCharCode(d[c]);return e},kf=function(c){c=new Uint8Array(c);var b=Eg([50,109,122,116],c)+6,d=c[b]+256*c[b+1],f=c[b+2]+(c[b+3]<<8)+(c[b+4]<<16);J("mapx:",d,"units",f);J("header",c[Ec(".header",
c)],"description",c[Ec(".description",c)],"kingdominfo",c[Ec(".kingdominfo",c)],"diplomacy",c[Ec(".diplomacy",c)],"forbidden.upgrades",c[Ec(".forbidden.upgrades",c)],"tiles",c[Ec(".tiles",c)]);J(c);b=2*d;d={mapx:d,mapy:d,arje:!1};var g="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12".split(" "),h="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12 xx13 xx14 xx15 xx16 xx17 xx18 xx19 xx20 xx21 resource".split(" "),
l=b/2,k=20480+2*l*l,m={};l=0;for(var n=c.length;l<n;l++){var p=c[l];m[p]||(m[p]=[]);m[p].push(l)}m=[];var r={56:!0,58:!0,88:!0,72:!0};l=k+1;for(n=c.length;l<n;l++)if(p=c[l],r[p]&&r[c[l+4]]){k={};p=72!==p?g:h;for(var u=l-2,v=0,x=p.length;v<x;v++){var y=p[v];"kingdom"==y||"race"==y?(k[y]=c[u],u++):(k[y]=c[u]+256*c[u+1],u+=2)}l+=2*x-3;m.push(k)}d.allunits=m;d.allunits.length>f&&(d.allunits.length=f);f=d.allunits;b/=2;m=[];g=0;r=[];p=k=c[Ec(".forbidden.upgrades",c)]+1;l=k*=512;for(h=c.length;l<h;l+=2){v=
c[l];u=~~(l/512);for(n=8;n<b&&c[n+l]===(v+n/4)%256;n+=4);20<n&&(l=512*u,1==m.length&&(l=512*(u-(2-(u-p)%2))),n=c.slice(k,l),k-l&&(m[g++]=[k,l],r.push(n)),l+=512,2==m.length&&(l-=512),k=l)}m[g++]=[k,c.length];r={64:[m[0]],96:[m[0]],128:[m[0]],192:[m[1],m[0],m[2],m[3]],256:[m[1],m[0],m[2],m[3]],384:[m[1],m[0],m[2],m[3],m[4],m[5],m[6]],512:[m[1],m[0],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9]]}[b];J(m);m=new Uint8Array(b*b);k=new Uint8Array(b*b);n=g=0;for(p=r.length;n<p;n++)if(h=r[n],g<b*b)for(l=h[0],h=
h[1];l<h;l+=2)m[g]=Hm[c[l]]||0,k[g]=c[l+1],10<k[g]&&f.push({type:7,d:k[g]%31,x32:g%b,y32:~~(g/b)}),g++;d.terrain=m;f=(b="grass",Fg("grass",c))||(b="summer",Fg("summer",c))||(b="desert",Fg("desert",c))||(b="snow",Fg("snow",c));if("summer"==b||b)if("summer"==b||"desert"==b)b="grass";g=Bi(512*(c[Ec(".description",c)]-1),512,c);d.description=g;d.author=Bi(f-64,64,c);d.name=Bi(f-128,64,c);d.terrainType=b;d.kingdoms=kf.getKingdoms(c,d);kf.getDiplomacy(c,d.kingdoms);J(d);return d};kf.getKingdoms=function(c,
b){for(var d=Eg([192,4],c)+50;!c[d];)d++;var f="name tzar active resGold resStone resFood resWood x6 race x8 x9 x10 x11 x12 x13 x14 AI x16 x17 x18 x19 x20".split(" "),g=f.length,h=[],l,k=[[0,0,189],[206,25,25],[49,181,0],[173,0,197],[255,222,0],[0,181,181],[255,156,33],[90,90,90]];J("kingdoms:",d);b.tr={0:0,9:0,10:0};for(var m=0;8>m;m++){for(var n={color:k[m]},p=!0,r=0;r<g;r++){var u=f[r];if("name"==u||"tzar"==u){for(n[u]="";!c[d];)d++;for(l=d+32;c[d];)n[u]+=String.fromCharCode(c[d]),d++;d=l}else n[u]=
c[d]+(c[d+1]<<8)+(c[d+2]<<16)+(c[d+3]<<24),"race"==u&&(n[u]=c[d],n.racestr=sg[c[d]-1]),2!=r||c[d]||(p=!1),d+=4}p&&(h.push(n),b.tr[m+1]=h.length);1<h.length&&(n.IA=1);n.resources=[n.resGold,n.resWood,n.resFood,n.resStone];n.race--}J(h);return h};kf.getDiplomacy=function(c,b){for(var d=512*(c[Ec(".diplomacy",c)]-1),f=b.length,g=0;g<f;g++){var h=[0];if(b[g]){b[g].diplomacy=h;for(var l=1;9>l;l++){if(b[l-1]){var k=c[d];k=60>k&&l-1!=g?1:0;h.push(k)}d+=4}}else d+=32}};var Hm={0:3,32:0,144:1,240:2,64:2},
sm={15:78,16:77,19:37,20:39,21:38,22:131,23:73,24:75,25:76,27:59,28:58,30:132,31:40,32:130,36:60,38:42,39:55,40:32,41:44,42:56,43:57,61:13,62:13,63:20,64:35,72:43,110:27,133:36,136:74,257:10,258:61,259:0,260:4,261:3,262:6,263:1,264:19,267:8,270:2,273:5,274:9,300:12,301:14,302:15,303:23,304:30,305:25,306:28,307:18,308:34,309:33,310:41,311:11,312:17,314:26,315:29,316:16,321:24,322:31,513:79,514:90,515:80,516:81,517:83,519:82,522:85,529:89,530:87,541:91,545:86,547:84,556:63,557:102,558:93,559:95,560:100,
561:99,562:103,563:94,564:104,565:101,566:96,568:109,570:97,571:98,572:107,577:108,578:92,581:110,583:106,769:64,771:66,772:67,773:68,778:69,780:128,781:65,785:129,786:127,802:70,805:72,812:62,813:71,814:112,815:114,816:119,817:118,818:121,819:113,820:122,821:120,822:115,824:126,826:116,827:117,828:124,833:125,834:111,838:123,76:21,78:22},sh=function(c,b,d,f){if(Yd&&!p.editor){var e=Yd.events.defined[b.id];if(e&&e[d])if(e=e[d],"zone"==d)for(c=0,f=e.length;c<f;c+=5){d=e[c];var h=e[c+2],l=e[c+3],k=
e[c+4];b.x32>=e[c+1]&&b.x32<=l&&b.y32>=h&&b.y32<=k?(b.inZone||(b.inZone={}),b.inZone[d.id]||Gg([e[c]],1),b.inZone[d.id]=1):b.inZone&&b.inZone[d.id]&&(b.inZone[d.id]=0,Gg([e[c]],-1))}else{if(!f)return Gg(e,c);J(f.name);b=e.defined;b[f.id]&&Gg(b[f.id],c)}}},Gg=function(c,b){for(var d=c.length,f=0;f<d;f++){var g=c[f],h=g.rule,l=g.activeEvents;g.activeEvents+=b;0===l?h.activeEvents++:0===g.activeEvents&&h.activeEvents--;if(1==b&&h.activeEvents==h.events.length)for(g=0,h=h.actions,l=h.length;g<l;g++){var k=
h[g];J("action:",k.type);if(dl[k.type])dl[k.type](k.to[0],k.list)}}},dl={attack:xc,move:Oa},Xc={};r("selectUnits").onclick=function(){r("mapeditorinfoUnits").style.display="block";r("mapeditorinfoBuilds").style.display="none";r("mapeditorinfoItems").style.display="none";r("mapeditorinfoNature").style.display="none"};r("selectBuilds").onclick=function(){r("mapeditorinfoUnits").style.display="none";r("mapeditorinfoBuilds").style.display="block";r("mapeditorinfoItems").style.display="none";r("mapeditorinfoNature").style.display=
"none"};r("selectItems").onclick=function(){r("mapeditorinfoUnits").style.display="none";r("mapeditorinfoBuilds").style.display="none";r("mapeditorinfoItems").style.display="block";r("mapeditorinfoNature").style.display="none"};r("selectNature").onclick=function(){r("mapeditorinfoUnits").style.display="none";r("mapeditorinfoBuilds").style.display="none";r("mapeditorinfoItems").style.display="none";r("mapeditorinfoNature").style.display="block"};Xc.start=function(){Tb();var c=document.createElement("div");
c.id="mapForm";c.innerHTML="\n            <div>\n            <h2>"+u.gameOptions+"</h2>\n            <table>\n<tr><td>"+u.mapSize+': </td><td><input type="number" id=\'editorSize\' min="10" value="256" /></td></tr>\n<tr><td>'+u.random+' </td><td>\n<label class="container">\n  <input type="checkbox" id="editorRandom">\n  <span class="checkmark"></span>\n</label>\n</td></tr>\n<tr><td>'+u.nplayers+': </td><td><input id="editorPlayers" type="number" min="1" value="3"></td></tr>\n</table>\n</div>';var b=
document.createElement("button");b.innerHTML=u.continue;b.onclick=Xc.func;c.children[0].appendChild(b);b=document.createElement("button");b.innerHTML=u.cancel;b.onclick=Im;c.children[0].appendChild(b);document.body.appendChild(c)};var Im=function(){location.hash="";setTimeout(Yh,200);document.body.removeChild(this.parentElement.parentElement);wb()};Xc.func=function(){J(p.arje);if(void 0==p.arje){wb();r("editorRandom").checked?p.arje=555555*Math.random()+1:p.arje=!1;p.mapx=parseInt(r("editorSize").value);
p.mapy=p.mapx;p.goldRes=Infinity;p.foodRes=Infinity;p.woodRes=Infinity;p.stoneRes=Infinity;p.gravity=580.9/9.8*9.8;p.terrainType="grass";ra=[];for(var c=0,b=parseInt(r("editorPlayers").value);c<b;c++)ra[c]={color:"#"+(~~(16777216*Math.random())).toString(16),IA:!1,name:"Tzar "+(c+1),race:0,team:0};document.body.removeChild(r("mapForm"))}p.editor=1;if(xd(0,Xc.func)){r("statButton").style.display="none";r("menu").style.display="none";r("resources").style.display="none";r("mapeditorinfotop").style.display=
"block";r("mapeditorinfo").style.display="block";var d=document.getElementById("mapeditorinfoUnits");d.style.display="block";Hg();if(!Xc.preload){Xc.preload=!0;var f={},g={},h=x,l={euro:Ha[0],arab:Ha[1],asia:Ha[2],common:u.common};f[Ha[0]]=[];f[Ha[1]]=[];f[Ha[2]]=[];f[u.common]=[];g[Ha[0]]=[];g[Ha[1]]=[];g[Ha[2]]=[];g[u.common]=[];c=0;for(b=h.length;c<b;c++){var k=h[c];!k.race||k.illegal||7==k.type||k.item||(k.build?g[l[k.race]].put(c):f[l[k.race]].put(c))}for(k=0;2>k;k++){h=Object.keys(f);var m=
{};c=0;for(b=h.length;c<b;m={ul$17:m.ul$17},c++){var n=document.createElement("h1");n.innerHTML=h[c];m.ul$17=document.createElement("ul");n.onclick=function(b){return function(){ah(b.ul$17)}}(m);m.ul$17.style.display="none";for(var v=f[h[c]],y=Object.keys(v),w={},z=0,A=y.length;z<A;w={tcreate:w.tcreate},z++)l=document.createElement("li"),l.innerHTML=x[v[y[z]]].name,w.tcreate=v[y[z]],l.onclick=function(b){return function(){var c=b.tcreate;x[c].wall?Dh(c):R(c)}}(w),m.ul$17.appendChild(l);d.appendChild(n);
d.appendChild(m.ul$17)}f=g;d=r("mapeditorinfoBuilds")}h=Object.keys(gc);d=r("mapeditorinfoItems");var C=document.createElement("ul");f={};c=0;for(b=h.length;c<b;f={u$18:f.u$18},c++)l=document.createElement("li"),f.u$18=gc[h[c]],l.onclick=function(b){return function(){Xi(b.u$18)}}(f),l.innerHTML=f.u$18.name,C.appendChild(l);d.appendChild(C);d=r("mapeditorinfoNature");n=document.createElement("h1");n.innerHTML=u.trees;C=document.createElement("ul");n.onclick=function(){ah(C)};C.style.display="none";
l=document.createElement("li");C.appendChild(l);d.appendChild(n);d.appendChild(C);l.onclick=function(){Ci(Jm)};l.innerHTML=u.delete;l=document.createElement("li");C.appendChild(l);l.onclick=function(){Ci(Km)};l.innerHTML=u.create;n=document.createElement("h1");n.innerHTML=u.terrain;var D=document.createElement("ul");n.onclick=function(){ah(D)};D.style.display="none";d.appendChild(n);d.appendChild(D);b=pc.texturesRandomMap;d={};c=0;for(b=b.length;c<b;d={l:d.l},c++)l=document.createElement("li"),D.appendChild(l),
l.innerHTML=c,d.l=c,l.onclick=function(b){return function(){Ci(Di);Di.active=b.l}}(d)}}};var Hg=function(){var c=r("selectKingdom");c.innerHTML="";for(var b=1,d=C.length;b<d;b++){var f=C[b];1===b&&(c.style.background="rgba("+f.color[0]+","+f.color[1]+","+f.color[2]+",1)");c.innerHTML+='<option value="'+b+'" style="background:rgba('+f.color[0]+","+f.color[1]+","+f.color[2]+',1)">'+f.name+"</option>"}};r("selectKingdom").onchange=function(){v.kingdom=parseInt(this.value);var c=C[v.kingdom].color;this.style.background=
"rgba("+c[0]+","+c[1]+","+c[2]+",.8)"};var gm=function(c){Tb();var b=document.createElement("div"),d=document.createElement("div");b.id="unitProps";var f="<table>"+('\n<tr><td>Name </td><td><input data-prop="name" type="text" value="'+c.name+'" /></td></tr>\n<tr><td>'+u.health+' </td><td><input data-prop="health" type="number" value="'+c.health+'" /></td></tr>\n<tr><td>'+u.maxHealth+'</td> <td><input data-prop="maxHealth" type="number" value="'+c.maxHealth+'" /></td></tr>\n');if(c.build||c.item)if(c.item){if(c.sword||
c.shield)f+="\n<tr><td>"+u.attack+'</td><td><input data-prop="attack" type="number" value="'+(c.attack||0)+'" /></td></tr>\n<tr><td>'+u.defence+'</td> <td><input data-prop="defence" type="number" value="'+(c.defence||0)+'" /></td></tr>\n'}else c.kingdom&&(f+="<tr><td>"+u.kingdom+' </td><td><select id="selectKingdom2">'+r("selectKingdom").innerHTML+"</select></td></tr>");else f+="\n<tr><td>"+u.attack+'</td><td><input data-prop="attack" type="number" value="'+(c.attack||0)+'" /></td></tr>\n<tr><td>'+
u.defence+'</td> <td><input data-prop="defence" type="number" value="'+(c.defence||0)+'" /></td></tr>\n<tr><td>'+u.mana+' <td><input data-prop="mana" type="number" value="'+(c.mana||0)+'" /></td></tr>\n<tr><td>'+u.kingdom+' </td><td><select id="selectKingdom2">'+r("selectKingdom").innerHTML+"</select></td></tr>\n";d.innerHTML=f+"</table>";f=document.createElement("button");f.innerHTML=u.ok;f.onclick=function(){for(var b=r("unitProps").getElementsByTagName("input"),d=0,e=b.length;d<e;d++)if(b[d]){var f=
b[d].value;"number"==b[d].type&&(f=parseInt(f));var k=b[d].dataset.prop;c.__proto__[k]!=f&&(c[k]=f)}c.kingdom&&(b=parseInt(r("selectKingdom2").value),b!=c.kingdom&&c.changeKingdom(b));document.body.removeChild(r("unitProps"));wb()};d.appendChild(f);b.appendChild(d);document.body.appendChild(b);J(c.kingdom);r("selectKingdom2")&&(r("selectKingdom2").value=c.kingdom)},ma=function(c){document.getElementById(c).style.display="none"},rb=function(c){document.getElementById(c).style.display="block"},ki,Ci=
function(c){ki=!0;U=function(){};var b=L;b.img=m.blank;var d=32*Rd();b.wh=[d,d];mb(b);b.active=!0;document.addEventListener("mousemove",nc);document.addEventListener("mousedown",el);nc.active=c},el=function(c){if(2==c.buttons||c.pageX<v.menumx||c.pageY<v.menumy)return fl();nc(c)},ik=function(c){if(p.editor){var b=parseInt(r("brushSize").value)+c;b>r("brushSize").max?r("brushSize").value=r("brushSize").max:1>b?r("brushSize").value=1:(r("brushSize").value=b,L.wh&&(L.wh[0]+=32*c,L.wh[1]+=32*c,L.active=
!0))}},Rd=function(){return parseInt(r("brushSize").value)},Di=function(c,b,d){c=Rd();for(var e=c*c,g=G,h=Tc,l=Di.active,k=pc.type,m=0;m<e;m++){var n=b+m%c,p=d+~~(m/c);ha(n,p)&&(n+=p*g,h[n]=l,k[l]&&(2<N[n]&&z[N[n]].die(),2<hb[n]&&z[hb[n]].die()))}Yc()},Km=function(c,b,d){c=Rd();for(var e=c*c,g=G,h=0;h<e;h++){var l=b+h%c,k=d+~~(h/c);ha(l,k)&&(0===N[l+k*g]?.2>Math.random()&&uc([l+k*g,7,{d:3+~~(28*Math.random())}]):(l=z[N[l+k*g]],7==l.type&&l.die()))}},Jm=function(c,b,d){c=Rd();for(var e=c*c,g=G,h=0;h<
e;h++){var l=b+h%c,k=d+~~(h/c);ha(l,k)&&(l=z[N[l+k*g]],7==l.type&&l.die())}},nc=function(c){var b=32*Rd();b=ic(c.pageX-v.mx-.5*b/da,c.pageY-.5*b/da);var d=~~(.03125*b[1]);b=~~(.03125*b[0]);L.x=32*b;L.y=32*d;L.active=!0;if(0!==c.buttons){if(2==c.buttons)return fl();nc.last!==b+d*G&&nc.active&&nc.active(c,b,d);nc.last=b+d*G}},fl=function(){L.active=!0;L.x=-9999;L.y=-9999;ki=!1;if(nc.active){var c=32*Rd();ic(event.pageX-v.mx-.5*c/da,event.pageY-.5*c/da);nc.active=!1}L.wh=void 0;document.removeEventListener("mousedown",
el);document.removeEventListener("mousemove",nc)};r("mapProps").onclick=function(){r("mapPropsWindow").style.display="block";Tb();if(""==r("mapPropsWindow").innerHTML){var c=document.createElement("div");r("mapPropsWindow").appendChild(c);var b=document.createElement("table");c.appendChild(b);b=document.createElement("div");b.innerHTML=u.mapName;var d=document.createElement("input");d.value=p.name||u.strcusMap;d.id="mapName";d.type="text";c.appendChild(b);c.appendChild(d);b=document.createElement("div");
b.innerHTML=u.description;d=document.createElement("textarea");d.type="text";d.value=p.description||"";d.id="mapDescription";c.appendChild(b);c.appendChild(d);b=document.createElement("div");b.innerHTML=u.author;d=document.createElement("input");d.id="mapAuthor";d.value=p.author||"";d.type="text";c.appendChild(b);c.appendChild(d);c.appendChild(document.createElement("p"));b=document.createElement("button");b.onclick=gl;b.innerHTML=u.close;c.appendChild(b)}Ei()};var gl=function(){J(this);this.parentElement.parentElement.style.display=
"none";wb()},il={objAction:{id:"edobjAction",msg:u.objAction,func:function(){ua.active.type="attack";rb("selectionEvents");ma("eventZone");rb("unitListDiv2");r("byButton2").style.display="inline-block";r("byButton1").style.display="inline-block";ua.active.zone=void 0}},objZone:{id:"edobjAction",msg:u.objZone,func:function(){ua.active.type="zone";ua.active.to.length=0;ma("selectionEvents");r("eventZone").style.display="inline-block";ma("byButton2");ma("byButton1");ma("unitListDiv2");hl()}}},Jd=function(c){if(c)ma("mapRulesWindow"),
wb(),Jd.actived=!0;else if(Jd.actived){rb("mapRulesWindow");Tb();c=~~(X[0]/32);var b=~~(X[1]/32),d=~~(X[9]/32),f=~~(X[10]/32);if(c<d)var g=c,h=d;else g=d,h=c;if(b<f)var l=b,k=f;else l=f,k=b;ua.active.zone||(ua.active.zone=[]);ua.active.zone.put([g,l,h,k]);J(c,b,d,f);hl();Jd.actived=!1}},hl=function(){var c=r("zoneList");c.innerHTML="";var b=ua.active.zone;if(b)for(var d=b.length,f=0;f<d;f++){var g=b[f],h=document.createElement("div"),l=document.createElement("button");l.innerHTML="x";l.obj=g;l.pObj=
b;l.spObj=!0;l.onclick=Fi;h.innerHTML=g[0]+"x "+g[1]+"y -> "+g[2]+"x "+g[3]+"y";h.appendChild(l);c.appendChild(h)}};r("mapRules").onclick=function(){r("mapRulesWindow").style.display="block";Tb();if(""==r("mapRulesWindow").innerHTML){var c=document.createElement("div");c.innerHTML='\n<div id="mapEvent">\n<h4>'+u.events+'</h4>\n<select id="eventOptions" style="display:none">\n<option value="objAction">'+u.objAction+'</option>\n<option value="objZone">'+u.objZone+'</option>\n</select>\n<div id="eventScreen">\n</div>\n<div id="eventLayout">\n</div>\n<button id="addEvent">+</button>\n</div>\n<div id="mapActions">\n<h4>'+
u.actions+'</h4>\n<select id="actionOptions" style="display:none">\n<option value="objOrder">'+u.objOrder+'</option>\n</select>\n<div id="actionScreen">\n</div>\n<div id="actionLayout">\n</div>\n<button id="addAction">+</button>\n</div>\n<h4>'+u.rules+"</h4>\n";var b=document.createElement("div");b.id="rulist";c.appendChild(b);b=document.createElement("button");b.onclick=Lm;b.innerHTML="+";c.appendChild(b);b.id="addRule";c.appendChild(document.createElement("p"));b=document.createElement("button");
b.onclick=gl;b.innerHTML=u.close;c.appendChild(b);r("mapRulesWindow").appendChild(c);r("addEvent").onclick=Mm;r("addAction").onclick=Nm;r("eventOptions").onchange=function(){var b=il[this.value];ua.div=b.id;rb(ua.div);ua.active.name=this.value;b.func&&b.func();b=r("eventScreen").getElementsByTagName("button");for(var c=!1,d=0,e=b.length;d<e;d++){var f=b[d];if(f.sdiv)if("none"==f.style.display)f.sdiv.style.display="none";else{if(!c)f.onclick();c=!0}}Ig(Rb.active,"eventLayout")};r("actionOptions").onchange=
function(){bb.active.name=this.value;Ig(Rb.active,"actionLayout")};c=document.createElement("div");c.id="edobjAction";var d=document.createElement("select");d.innerHTML='\n<option value="attack">'+u.attack+'</option>\n<option value="destroy">'+u.destroy+'</option>\n<option value="moving">'+u.moving+'</option>\n<option value="capture">'+u.capture+"</option>\n";d.value="attack";d.id="selectionEvents";d.onchange=Om;var f=document.createElement("section"),g=document.createElement("section"),h=document.createElement("section"),
l=document.createElement("section"),k=document.createElement("section");b=document.createElement("button");b.innerHTML=u.add;b.onclick=Jd;var m=document.createElement("div");m.className="unitList";m.id="zoneList";h.appendChild(b);h.appendChild(m);m=document.createElement("div");m.className="unitList";m.id="unitListDiv";m.spType=ua;b=document.createElement("button");b.innerHTML=u.add;b.onclick=function(){Hb(this)};b.button=m;b.style.margin="10px";f.appendChild(b);b=document.createElement("button");
b.innerHTML=u.defined;b.onclick=Sb;b.sdiv=f;c.appendChild(b);b.onclick();b=document.createElement("button");b.innerHTML=u.undefined;b.onclick=Sb;b.sdiv=g;c.appendChild(b);f.appendChild(m);c.appendChild(f);c.appendChild(g);c.appendChild(document.createElement("p"));c.appendChild(d);c.appendChild(document.createElement("p"));m=document.createElement("div");m.className="unitList";m.id="unitListDiv2";m.spType=ua;b=document.createElement("button");b.innerHTML=u.add;b.onclick=function(){Hb(this)};b.button=
m;b.style.margin="10px";l.appendChild(b);b=document.createElement("button");b.innerHTML=u.defined;b.onclick=Sb;b.sdiv=l;b.id="byButton1";c.appendChild(b);b=document.createElement("button");b.innerHTML=u.undefined;b.onclick=Sb;b.id="byButton2";b.sdiv=k;c.appendChild(b);l.appendChild(m);b=document.createElement("button");b.innerHTML=u.zone;b.onclick=Sb;b.sdiv=h;b.id="eventZone";b.style.display="none";c.appendChild(b);c.appendChild(h);c.appendChild(l);c.appendChild(k);r("eventScreen").appendChild(c);
ma("mapEvent");ma("mapActions");c=document.createElement("div");c.id="edobjOrder";d=document.createElement("select");d.innerHTML='\n<option value="move">'+u.move+'</option>\n<option value="attack">'+u.attack+"</option>\n";d.value="move";d.id="selectionActions";d.onchange=Pm;f=document.createElement("section");g=document.createElement("section");l=document.createElement("section");k=document.createElement("section");m=document.createElement("div");m.className="unitList";m.id="unitListDivAction";m.spType=
bb;b=document.createElement("button");b.innerHTML=u.add;b.onclick=function(){Hb(this)};b.button=m;b.style.margin="10px";f.appendChild(b);b=document.createElement("button");b.innerHTML=u.defined;b.onclick=Sb;b.sdiv=f;c.appendChild(b);b=document.createElement("button");b.innerHTML=u.undefined;b.onclick=Sb;b.sdiv=g;c.appendChild(b);f.appendChild(m);c.appendChild(f);c.appendChild(g);b.onclick();c.appendChild(document.createElement("p"));c.appendChild(d);c.appendChild(document.createElement("p"));m=document.createElement("div");
m.className="unitList";m.id="unitListDivAction2";m.spType=bb;b=document.createElement("button");b.innerHTML=u.add;b.onclick=function(){Hb(this)};b.button=m;b.style.margin="10px";l.appendChild(b);b=document.createElement("button");b.innerHTML=u.defined;b.onclick=Sb;b.sdiv=l;b.id="toButton1";c.appendChild(b);b=document.createElement("button");b.innerHTML=u.undefined;b.onclick=Sb;b.id="toButton2";b.sdiv=k;c.appendChild(b);l.appendChild(m);c.appendChild(l);c.appendChild(k);b.onclick();r("actionScreen").appendChild(c);
ma("mapEvent");ma("mapActions")}};var jl={moving:1},Om=function(){jl[this.value]?(ma("byButton2"),ma("byButton1"),ma("unitListDiv2")):(rb("unitListDiv2"),r("byButton2").style.display="inline-block",r("byButton1").style.display="inline-block");ua.active.type=this.value},Pm=function(){jl[this.value]?(ma("toButton2"),ma("toButton1"),ma("unitListDivAction2")):(rb("unitListDivAction2"),r("toButton2").style.display="inline-block",r("toButton1").style.display="inline-block");bb.active.type=this.value},Hb=
function(c){if(c)ma("mapRulesWindow"),wb(),Hb.actived=c.button;else if(Hb.actived){rb("mapRulesWindow");Tb();c=Hb.actived.spType.active;c="unitListDiv2"==Hb.actived.id||"unitListDivAction2"==Hb.actived.id?c.to:c.list;for(var b={},d=0,f=c.length;d<f;d++)b[c[d]]=1;d=0;for(f=K.length;d<f;d++)b[K[d]]||c.put(K[d]);lf(Hb.actived,c);Hb.actived=!1}},lf=function(c,b){c.innerHTML="";for(var d=0,f=b.length;d<f;d++){var g=document.createElement("div");g.innerHTML=z[b[d]].name;var h=document.createElement("button");
h.onclick=Fi;h.innerHTML="x";h.pObj=b;h.spObj=!0;h.obj=b[d];g.appendChild(h);c.appendChild(g)}},Sb=function(){Sb.active&&(Sb.active.className="");Sb.active=this;this.className="spSelect";for(var c=this.parentElement.getElementsByTagName("section"),b=0,d=c.length;b<d;b++)c[b].style.display="none";this.sdiv.style.display="block"},Rb=function(){var c=this.editorRule;c.deleted||(rb("mapEvent"),rb("mapActions"),ma("eventOptions"),Rb.active&&(Rb.div.className=""),this.className="spSelect",Rb.active=c,Rb.div=
this,Ig(c,"eventLayout"),Ig(c,"actionLayout"),ua.div&&ma(ua.div),ua.div1=void 0)},ua=function(){var c=this.editorRule;c.deleted||(rb("eventOptions"),ua.div1&&(ua.div1.className=""),this.className="spSelect",ua.active=c,r("selectionEvents").value=c.type,ua.div1=this,r("eventOptions").value=c.name,ua.div=il[c.name].id,rb(ua.div),lf(r("unitListDiv"),c.list),lf(r("unitListDiv2"),c.to))},bb=function(){var c=this.editorRule;c.deleted||(rb("actionOptions"),bb.div1&&(bb.div1.className=""),this.className=
"spSelect",bb.active=c,r("selectionActions").value=c.type,bb.div1=this,r("actionOptions").value=c.name,bb.div="ed"+c.name,rb(bb.div),lf(r("unitListDivAction"),c.list),lf(r("unitListDivAction2"),c.to))},Ig=function(c,b){r(b).innerHTML="";if("eventLayout"==b){c=c.events;var d=ua,f=Rb.active.events}else c=c.actions,d=bb,f=Rb.active.actions;for(var g=0,h=c.length;g<h;g++){var l=document.createElement("div");Jg(l,c[g],d,f);r(b).appendChild(l)}},Mm=function(){var c=Rb.active,b={name:"objAction",list:[],
to:[],type:"attack"};c.events.put(b);var d=document.createElement("div");Jg(d,b,ua,c.events);r("eventLayout").appendChild(d);if(ua.div1)ua.div1.onclick()},Nm=function(){var c=Rb.active,b={name:"objOrder",list:[],to:[],type:"move"};c.actions.put(b);var d=document.createElement("div");Jg(d,b,bb,c.actions);r("actionLayout").appendChild(d);if(bb.div1)bb.div1.onclick()},Jg=function(c,b,d,f){c.innerHTML=b.events?b.name:u[b.name];c.onclick=d;c.editorRule=b;d=document.createElement("button");d.innerHTML=
"x";d.obj=b;d.pObj=f;d.onclick=Fi;c.appendChild(d)},Lm=function(){p.rules||(p.rules=[]);var c={name:"Rule"+p.rules.length,events:[],actions:[]};p.rules.put(c);var b=document.createElement("div");Jg(b,c,Rb,p.rules);r("rulist").appendChild(b)},Fi=function(){this.pObj.quit(this.obj);this.obj.deleted=!0;this.parentElement.parentElement.removeChild(this.parentElement);if(!this.spObj)if(this.pObj!==p.rules)Rb.div.onclick();else ma("mapEvent"),ma("mapActions")},Ei=function(){var c=r("mapPropsWindow").getElementsByTagName("table")[0];
c.innerHTML="";c.innerHTML+="<tr><td>"+u.color+"</td><td>"+u.username+"</td><td>"+u.gold+"</td><td>"+u.wood+"</td><td>"+u.food+"</td><td>"+u.stone+"</td><td>"+u.AI+"</td><td>"+u.team+"</td></tr>";for(var b=1,d=C.length;b<d;b++){var f=C[b],g=f.color,h=f.resources;g="#"+(16777216+(g[0]<<16)+(g[1]<<8)+g[2]).toString(16).slice(1);c.innerHTML+='<tr><td><input style="background:'+g+'" type="color" value="'+g+'" /></td><td><input type="text" value="'+f.name+'"></td>\n\n<td><input type="text" class="res" value="'+
(parseInt(h[0])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[1])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[2])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[3])||"\u221e")+'"></td>\n<td><label class="container">\n  <input type="checkbox">\n  <span class="checkmark"></span>\n</label></td><td><input type="number" min="0" value="'+f.team+'"></td></tr>'}c.innerHTML+="<tr><td><button id='editorAdd'>+</button><button id='editorDelete'>-</button></td></tr>";
r("editorAdd").onclick=Qm;r("editorDelete").onclick=Rm;c=c.getElementsByTagName("input");b=0;for(d=C.length-1;b<d;b++)h=8*b,f=C[b+1],c[h].onchange=Sm,c[h+1].onchange=Tm,c[h+2].onchange=Kg,c[h+3].onchange=Kg,c[h+4].onchange=Kg,c[h+5].onchange=Kg,c[h+2].res=0,c[h+3].res=1,c[h+4].res=2,c[h+5].res=3,c[h+6].onchange=Um,c[h+6].checked=f.IA,c[h+7].onchange=Vm,c[h].team=b+1,c[h+1].team=b+1,c[h+2].team=b+1,c[h+3].team=b+1,c[h+4].team=b+1,c[h+5].team=b+1,c[h+6].team=b+1,c[h+7].team=b+1},Kg=function(){var c=
parseInt(this.value);c||(c=Infinity,this.value="\u221e");C[this.team].resources[this.res]=c},Qm=function(){new Xb("Tzar "+C.length,[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],[0],0,!0,[p.goldRes,p.woodRes,p.foodRes,p.stoneRes],2);Hg();Ei()},Rm=function(){if(2<C.length){for(var c=C.length-1,b=3,d=z.length;b<d;b++){var f=z[b];f.kingdom==c&&f.die()}C.length--;Hg();Ei()}},Sm=function(){var c=C[this.team],b=parseInt(this.value.substr(1),16),d=b>>16&255,f=b>>8&255;b&=255;c.color=
[d,f,b];var g=this.team;c=Ja[g];C[g].color=[d,f,b];g*=3;Sa[g]=d/255;Sa[g+1]=f/255;Sa[g+2]=b/255;d=0;for(f=c.length;d<f;d++){b=c[d];g=0;for(var h=b.length;g<h;g++)Ac(z[b[g]])}Hg()},Tm=function(){C[this.team].name=this.value},Um=function(){C[this.team].IA=this.checked?!0:!1},Vm=function(){var c=C[this.team];c.team=parseInt(this.value);for(var b=C.length,d=1;d<b;d++){var f=C[d];f.team!==c.team&&(f.diplomacy[c.k]=1,c.diplomacy[f.k]=1)}};Qe.onchange=function(c){I(Wf,parseInt(Qe.value)/100,K)};var Ri=function(c){var b=
c.length;I(vi,b);for(var d=kb.step,f=0;f<b;f+=d)I(kb,c.slice(f,f+d))},Am=function(c){if(c=document.getElementById("maploadOnline").files[0]){c.name.split(".");var b=new FileReader;b.onload=function(){var b=new Uint8Array(this.result);v.admin&&(ma("optionbutton"),Ri(b),Ok(b),J(ea),Qk(ea.kingdoms.length),r("nplayersO").value=v.room.max,r("deleteCusMap").style.display="inline-table")};b.readAsArrayBuffer(c)}},Pk=function(c,b){if(b&&"wmp"==b)return kf(c);J(c[0]);var d=c[1]+(c[2]<<8)+(c[3]<<16)+(c[4]<<
24);b=new TextDecoder("utf-8");b=JSON.parse(b.decode(c.slice(5,d+5)));if(!1===b.arje){c=c.slice(d+5,d+5+Math.pow(b.mapx,2));var f=Math.pow(b.mapx,2);d=c.length;f=f?new Uint8Array(f):[];for(var g=0,h=0;h<d;h++){var l=c[h];if(255!==l)f[g++]=l;else{l=c[h-1];for(var k=(c[h+1]<<8)+c[h+2],m=0;m<k;m++)f[g++]=l;h+=2}}b.terrain=f}b.allunits&&(b.allunits=Mk(b.allunits));b.ini&&(b.ini=Mk(b.ini));return b};r("mapload").accept=".tzared,.wmp";r("mapload").onchange=function(c){c=document.getElementById("mapload").files[0];
var b=c.name.split(".");b=b[b.length-1];var d=new FileReader;d.onload=function(){var c=new Uint8Array(this.result);c=Pk(c,b);rb("customMapcont");r("editCustom").style.display="inline-table";ea=c;ea.kingdomStart?(r("seeStats").style.display="inline-table",r("playrecord").style.display="inline-table"):(r("seeStats").style.display="none",r("playrecord").style.display="none");null===ea.goldRes&&(ea.goldRes=Infinity);null===ea.stoneRes&&(ea.stoneRes=Infinity);null===ea.foodRes&&(ea.foodRes=Infinity);null===
ea.woodRes&&(ea.woodRes=Infinity);c=document.getElementById("custombody");c.innerHTML="";for(var d=ea.kingdoms,e=0,l=d.length;e<l;e++){var k=d[e],m=k.color,n=k.team;void 0==n&&(n="");c.innerHTML+="<tr><td style='background:rgb("+m[0]+","+m[1]+","+m[2]+')\' class="ucolor1"></td><td class="username1">'+k.name+'</td><td style="display:none" class="race1">'+k.race+'</td><td class="team1">'+n+"</td></tr>"}};d.readAsArrayBuffer(c)};var ea,Wm=function(c){var b={Blue:189,Red:13506841,Green:3257600,Purple:11337925,
Yellow:16768512,Cyan:46517,Orange:16751649,Gray:5921370},d=c.split(["[Player"]),f=c.split("GameDuration =")[1].split("[")[0].split(" min")[0].split(" ")[1],g=[];c=[];for(var h=1,l=d.length;h<l;h++){var k=d[h].split("\n"),m={};g[h-1]=m;for(var n=0,p=k.length;n<p;n++){var r=k[n];r=r.split(" = ");if(r[1]&&n){r[1]=r[1].trim();"Color"==r[0]&&(r[1]=b[r[1]]);"Type"==u&&"Status"!==r[0]&&c.put("N");r[1]=encodeURIComponent(r[1]);c.put(r[1]);m[r[0]]=r[1];var u=r[0]}}}b=g[0].Name+"'s Game";var v=new XMLHttpRequest;
v.open("POST",baseUrl+"php/stats.php",!0);v.setRequestHeader("Content-type","application/x-www-form-urlencoded");v.onreadystatechange=function(){200===v.status&&4===v.readyState&&(location.hash="MatchX"+v.responseText)};c=c.join("<");v.send("arr="+c+"&time="+6E4*f+"&name="+b+"&players="+g.length)},Gi=function(c,b){for(var d=0,f=0,g=c.length;f<g;f++)d+=b[c[f]];return d},Hi=function(c,b,d){var e=["",d];performance.now();for(var g=0,h=c.length;g<h;g++){var l=c[g],k=l.stats,m=k.resources,n=k.unitCountMax,
p=24*g+2,u=l.color,v=l.IA;v=v?"IA":"Human";e[p]=(u[0]<<16)+(u[1]<<8)+u[2];e[p+1]=l.name;e[p+1]=l.name;e[p+2]=v;e[p+3]=l.status;e[p+4]=l.team;e[p+5]=Ha[l.race];e[p+6]=k.score;e[p+7]=m[0];e[p+8]=m[1];e[p+9]=m[2];e[p+10]=m[3];e[p+11]=k.dmgInflicted;e[p+12]=k.dmgTaken;e[p+13]=k.unitsKilled;e[p+14]=k.unitsLosed;e[p+15]=k.buildsDestroyed;e[p+16]=k.buildsLosed;e[p+17]=Gi([10,79,64],n);e[p+18]=Gi([32,44],n);e[p+19]=Gi([55,56],n);e[p+20]=0;e[p+21]=0;e[p+22]=0;e[p+23]=0}kl(e,b);b&&setTimeout(function(){"block"==
r("ingameStats").style.display&&Hi(c,b,d)},500)},kl=function(c,b){for(var d="<tr style='background:#000;'><td style='    padding-right: 150px;'>Name</td><td>Type</td><td>Status</td><td>Team</td><td>Race</td><td>Score</td><td>Gold</td><td>Wood</td><td>Food</td><td>Stone</td><td title='Damage Inflicted'>D.I</td><td title='Damage Taken'>D.T</td><td title='Units Killed'>U.K</td><td title='Units Losed'>U.L</td><td title='Buildings Destroyed'>B.D</td><td title='Buildings Losed'>B.L</td><td title='Maximum Peasants'>M.P</td><td title='Maximum Towers'>M.T</td><td title='Maximum Stone Towers'>M.S.T</td><td title='Gold Traded'>G.T</td><td title='Stone Traded'>S.T</td><td title='Gold Converted'>G.C</td><td title='Stone Converted'>S.C</td></tr>",
f=2,g=c.length;f<g;f++)if((f-2)%24)0!==(f-3)%24&&(h=~~((f-2)/24)%2?"style = 'background:rgba(0,0,0,0.45)'":"style = 'background:rgba(0,0,0,0.65)'"),d+="<td "+h+">"+Na(decodeURIComponent(c[f]))+"</td>";else{f-2&&(d+="</tr>");h=parseInt(Na(decodeURIComponent(c[f])));var h="style = 'background:rgba("+Math.floor(h/65536)+","+Math.floor(h/256)%256+","+h%256+",0.45)'";d+="<tr>"}d+="</tr>";b?(r("ingameStats").style.display="block",r("statsGame").innerHTML="<tbody>"+d+"</tbody>",b=r("statsGame").getElementsByTagName("td")):
(r("MatchX").style.display="block",r("returnmenu").style.display="block",r("statsTable").innerHTML="<tbody>"+d+"</tbody>",b=r("statsTable").getElementsByTagName("td"));c=[];f=0;for(g=b.length;f<g;f++)d=f%23,4<d&&23<f&&(c[d-5]||(c[d-5]=[]),c[d-5].put(b[f]));f=0;for(g=c.length;f<g;f++){b=c[f];b.sort(vl);d=b.length;if(!b[1])break;b[0].innerHTML!=b[1].innerHTML&&(b[0].style.background="rgba(127,0,0,0.45)");b[d-1].innerHTML!=b[d-2].innerHTML&&(b[d-1].style.background="rgba(0,127,0,0.45)")}};r("statsLoad").onchange=
function(){var c=document.getElementById("statsLoad").files[0],b=new FileReader;b.onloadend=function(b){Wm(b.target.result)};c&&b.readAsText(c,"ascii")};var ul=function(c){var b=new XMLHttpRequest;b.open("POST",baseUrl+"php/loadstat.php",!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");ll(b,function(b){kl(b.responseText.split("<"))});J(c);b.send("id="+c)},ll=function(c,b){c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b(c):alert("Error: "+c.status))}},
Rk=function(){r("mapconfiguration").style.display="block";r("basic").style.filter="blur(94px)";if(""==r("mapconfiguration").innerHTML){for(var c="",b=["grass","snow"],d=0,f=b.length;d<f;d++)c+='<option value="'+b[d]+'" '+(b[d]==localStorage.terrain?"selected":"")+">"+u[b[d]]+"</option>";b="";"true"==localStorage.infinity&&(b="checked");r("mapconfiguration").innerHTML="<table>\n<tbody>\n<tr><td>"+u.mapSize+'</td><td><input id="mapwidth" type="number" value="'+localStorage.mapSize+'" step="32" min="32" /></td></tr>\n<tr><td><hr></td></tr>\n<tr><td>'+
u.startingResources+"</td></tr>\n<tr><td><hr></td></tr>\n<tr><td>"+u.infinite+'</td><td><label class="container">\n  <input id="infiniteValue" type="checkbox" '+b+'>\n  <span class="checkmark"></span>\n</label></td></tr>\n<tr><td>'+u.gold+'</td><td><input id="goldValue" type="number" value="'+localStorage.gold+'" step="250" /></td></tr>\n<tr><td>'+u.wood+'</td><td><input id="woodValue" type="number" value="'+localStorage.wood+'" step="250" /></td></tr>\n<tr><td>'+u.food+'</td><td><input id="foodValue" type="number" value="'+
localStorage.food+'" step="250" /></td></tr>\n<tr><td>'+u.stone+'</td><td><input id="stoneValue" type="number" value="'+localStorage.stone+'" step="250" /></td></tr>\n<tr><td><hr></td></tr>\n<tr><td>'+u.terrainOption+'</td></tr>\n<tr><td><select name="terrain" id="terrainSelect">\n'+c+"\n<tr><td>"+u.water+'</td><td><input type="number" value="'+localStorage.water+'" id="waterValue" min="0"/></td></tr>\n<tr><td>'+u.items+'</td><td><input type="number" value="'+localStorage.items+'" id="itemsValue" min="0"/></td></tr>\n<tr><td>'+
u.peons+'</td><td><input type="number" value="'+localStorage.peons+'" id="peonValue" min="0"/></td></tr>\n<tr><td>'+u.gateways+'</td><td><input type="number" value="'+localStorage.gateways+'" id="gatewaysValue" min="0" /></td></tr>\n</select>\n</td>\n</tr>\n<tr><td></td></tr>\n<tr><td><button id="closeButton1" class="start">'+u.close+"</button></td></tr>\n</tbody>\n</table>";r("infiniteValue").onchange=function(){var b=this.checked;r("goldValue").disabled=b;r("stoneValue").disabled=b;r("woodValue").disabled=
b;r("foodValue").disabled=b};r("infiniteValue").onchange();r("closeButton1").onclick=function(){p.online&&I($c,Xd());r("mapconfiguration").style.display="none";wb()}}};r("deleteUnit").onclick=function(){I(Pe,1,K.slice(0))};r("rotatebutton").onclick=function(){for(var c=K,b=0,d=c.length;b<d;b++){var f=z[c[b]];f.build||(f.d=(f.d+1)%8,na(f,f.img))}};r("gameMenu").onclick=Qi;r("menueditor").onclick=Qi;r("quitButton1").onclick=function(){Wi("playingMenu");p.online&&ri();ra.length=0;K=[];zb=void 0;od.obj=
{};sb.done.length=0;clearInterval(Df);C=[];oc={};oi=8;wb();p={canceled:!0};ra.length=0;z=[{terrain:1},{terrain:1},{terrain:1}];cd={};bd={};Ub={};jc.length=0;Ja=[];ib=[];Sa=[];v.admin=!1;yb=v.kingdom=void 0;Pd.intv&&clearInterval(Pd.intv);ck={euro:0,arab:0,asia:0};sa.stop();Dc=document.getElementById("msgs");Dg=document.getElementById("msginput");window.removeEventListener("mousemove",Ab);window.removeEventListener("keydown",lk);window.removeEventListener("keyup",mk);window.removeEventListener("mousemove",
nk);window.removeEventListener("mousedown",ok);window.removeEventListener("mouseup",pk);Za();document.getElementById("playermenu").style.display="block";document.getElementById("playingMenu").style.display="none"};r("backToGame").onclick=function(){r("playingMenu").style.display="none";wb()};r("backToGameS").onclick=function(){Wi("ingameStats");wb()};r("statButton").onclick=function(){Hi(C.slice(1),!0,p.now());Tb()};r("returnmenu1").onclick=Za;r("returnmenu").onclick=Za;r("refreshButton1").onclick=
$g;r("sendmsg").onclick=ai;r("start1").onclick=Rk;r("start2").onclick=xd;r("alertok").onclick=function(){r("alert").style.display="none";wb()};r("saveGame").onclick=function(){p.editor&&(p.arje=!1,r("mapDescription")&&(p.description=r("mapDescription").value,p.name=r("mapName").value,p.author=r("mapAuthor").value));delete p.terrain;var c=p,b=z,d=[];d.length=b.length-3;for(var f=3,g=b.length;f<g;f++){var h=b[f],l=x[h.type],k={0:h.kingdom,1:h.d,2:h.type,3:h.img,4:h.x32,5:h.y32};h.name!==l.name&&(k[6]=
h.name);h.iconID!==l.iconID&&(k[7]=h.iconID);h.attack!==l.attack&&(k[8]=h.attack);h.defence!==l.defence&&(k[9]=h.defence);h.level!==l.level&&(k[10]=h.level);h.health!==l.health&&(k[11]=h.health);h.maxHealth!==l.maxHealth&&(k[12]=h.maxHealth);h.func&&(k[13]=h.func);h.funcObj&&(k[14]=h.funcObj);h.workers&&h.workers.length&&(k[15]=h.workers);h.workingOn&&(k[16]=h.workingOn);h.inventory&&h.inventory.length&&(k[17]=h.inventory);h.dix&&(k[18]=h.dix);h.diy&&(k[19]=h.diy);h.timestamp&&(k[20]=h.timestamp);
h.working&&(k[21]=h.working);h.rnd&&(k[22]=h.rnd);h.techID&&(k[23]=h.techID);h.techStart&&(k[24]=h.techStart);h.activeTech&&(k[25]=h.activeTech);h.levelProgress&&(k[26]=h.levelProgress);h.c&&(k[27]=h.c);h.mimg&&(k[28]=h.mimg);void 0!==h.built&&(k[29]=h.built);void 0!==h.xf&&(k[30]=h.xf);void 0!==h.yf&&(k[31]=h.yf);void 0!==h.action&&(k[32]=h.action);h.point&&(k[33]=h.point);h.waitlist&&(k[34]=h.waitlist);h.mv&&(k[35]=h.mv);h.work&&(k[36]=h.work);h.death&&(k[37]=h.death);h.freezed&&(k[38]=h.freezed);
h.confused&&(k[39]=h.confused);h.sword&&(k[40]=h.sword);h.shield&&(k[41]=h.shield);h.book&&(k[42]=h.book);h.spy&&(k[43]=h.spy);h.stock&&(k[44]=h.stock);d[f-3]=k}c.allunits=d;p.movtable=bd;p.movtable2=cd;p.kingdomStart||p.editor||(p.kingdomStart=qi);p.kingdoms=C.slice(1);c=p;c=JSON.stringify(c);c=(new TextEncoder("utf-8")).encode(c);c=[new Uint8Array([55]),new Uint8Array((new Uint32Array([c.length])).buffer),c];0==p.arje&&c.put(xm(Tc));c=new Blob(c,{type:"application/octet-binary"});c=URL.createObjectURL(c);
b=document.createElement("a");document.body.appendChild(b);b.style="display: none";b.href=c;b.download="savegame.tzared";b.click();p.allunits=void 0};r("createGame1").onclick=Lk;r("startCustom").onclick=function(){p=Object.assign({},ea);p.editor=!1;p.custom=!0;p.online=!1;ea=void 0;ma("customMapcont");xd(!1,!1)};r("editCustom").onclick=function(){p=Object.assign({},ea);p.custom=!0;p.online=!1;p.editor=!0;Xc.func();ea=void 0;ma("customMapcont")};r("playrecord").onclick=function(){p=Object.assign({},
ea);p.online=!1;p.custom=!0;p.demo=!0;p.cycle=0;p.editor=!1;ea=void 0;ma("customMapcont");xd(!1,!1)};r("seeStats").onclick=function(){Hi(ea.kingdoms,!1,25*ea.cycle);location.hash="MatchX"};var Xm=function(){J(this,this.checked);localStorage[this.localProp]=this.checked},ml=function(){var c=this.value;"color"==this.type?this.style.backgroundColor=c:"name"==this.localProp&&(c=Na(c));v[this.localProp]=c;localStorage[this.localProp]=c},Vi={MatchHistory:function(){document.getElementById("returnmenu").style.display=
"block";var c=new XMLHttpRequest;c.open("GET",baseUrl+"php/latest.php",!0);ll(c,function(b){b=b.responseText.split("|");for(var c=b.length-1,d="",g=0;g<c;g+=5)d+="<tr id='statList"+Na(decodeURIComponent(b[g]))+"'><td>"+Na(decodeURIComponent(b[g+1]))+"</td><td>"+Na(decodeURIComponent(b[g+2]))+"</td><td>"+Na(decodeURIComponent(b[g+3]))+"</td><td>"+parseInt(Na(decodeURIComponent(b[g+4])))/6E4+" min</td></tr>";document.getElementById("matchtable").innerHTML="<tbody>"+d+"</tbody>";d={};for(g=0;g<c;d={l:d.l},
g+=5)d.l=Na(decodeURIComponent(b[g])),r("statList"+d.l).onclick=function(b){return function(){location.hash="MatchX"+b.l}}(d)});c.send(null)},GameList:$g,RandomMap:mc,Twitter:function(){document.getElementById("returnmenu").style.display="block"},Account:function(){Md.returnmenu.style.display="block";""==Md.Account.innerHTML&&(Md.Account.innerHTML='<iframe id="accountIframe"></iframe>',Md.accountIframe=document.getElementById("accountIframe"));Md.accountIframe.src=baseUrl+v.langCodeUrl+"account/?iframe=1"},
MapEditor:Xc.start,CustomMap:function(){document.getElementById("returnmenu").style.display="block"},Settings:function(){var c=r("Settings");if(""==c.innerHTML){var b=document.createElement("h2");b.innerHTML=u.strSettings;c.appendChild(b);b=document.createElement("div");var d=document.createElement("span");d.innerHTML=u.color;b.appendChild(d);var f=document.createElement("input");f.type="color";f.value=localStorage.color;f.onchange=ml;f.localProp="color";f.style.backgroundColor=localStorage.color;
b.appendChild(f);d=document.createElement("span");d.innerHTML=u.username;b.appendChild(d);f=document.createElement("input");f.type="text";f.value=Jk(localStorage.name);f.onchange=ml;f.localProp="name";b.appendChild(f);d=document.createElement("span");d.innerHTML=u.language;b.appendChild(d);d=document.createElement("select");d.innerHTML='<option value="en">'+u.english+'</option>\n<option value="es">'+u.spanish+'</option>\n<option value="it">'+u.italian+'</option>\n<option value="pt">'+u.portuguese+
'</option>\n<option value="ru">'+u.russian+'</option>\n<option value="pl">'+u.polish+'</option>\n<option value="bg">'+u.bulgarian+'</option>\n<option value="de">'+u.german+"</option>\n";d.value=v.langstr;d.onchange=function(){localStorage.language=this.value;location.href=""};b.appendChild(d);d=document.createElement("span");d.innerHTML=u.offlinePlay;b.appendChild(d);d=document.createElement("button");d.innerHTML=u.downloadAll;d.onclick=Ic;b.appendChild(d);d=document.createElement("span");d.innerHTML=
u.fullscreen;b.appendChild(d);var g=document.createElement("label");g.className="container";d=document.createElement("span");d.className="checkmark";f=document.createElement("input");f.type="checkbox";f.checked="true"==localStorage.fullscreen?!0:!1;f.onchange=Xm;f.localProp="fullscreen";g.appendChild(f);g.appendChild(d);b.appendChild(g);c.appendChild(b)}rb("returnmenu")}};Ti();var Ob=[Gc,gg,gd,ed,xe,Zf,pg,ig,ag,$f,dg,qg,lg,Rj,rg,bg,cg,ng,Be,ge,qd,oj,Ef,mh,nj,Pj,Uf,Tj,Uj,Fd,Uh,Vj,Wj,Xj,Yj,Uf,Ck,Mj,
Zj,je,Nj,Lf,Kj,Lj,Mh,Tf,ne,zc,Kh,fd,ed,Sf,gd,Mc,Ad,Ed,Z,function(c){var b=c[1],d=z[c[2]];c=E[c[0]];C[d.kingdom].technology.hidden[c.id.id]=0;yc(d,c,b);pa.actv[c.id.id]&&ba(!1)},Of,Pf,ia,Dj,Cb,Gh,Hh,fe,ii,fk,Sj,Sh,jg,Qj,Oj];(function(){for(var c=0,b=Ob.length;c<b;c++)Ob[c].url=c})();ge.rule="moving";Tf.rule="attack"})();
