var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(D,ia,ta){D!=Array.prototype&&D!=Object.prototype&&(D[ia]=ta.value)};$jscomp.getGlobal=function(D){return"undefined"!=typeof window&&window===D?D:"undefined"!=typeof global&&null!=global?global:D};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var D=0;return function(ia){return $jscomp.SYMBOL_PREFIX+(ia||"")+D++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var D=$jscomp.global.Symbol.iterator;D||(D=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[D]&&$jscomp.defineProperty(Array.prototype,D,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(D){var ia=0;return $jscomp.iteratorPrototype(function(){return ia<D.length?{done:!1,value:D[ia++]}:{done:!0}})};$jscomp.iteratorPrototype=function(D){$jscomp.initSymbolIterator();D={next:D};D[$jscomp.global.Symbol.iterator]=function(){return this};return D};
$jscomp.iteratorFromArray=function(D,ia){$jscomp.initSymbolIterator();D instanceof String&&(D+="");var ta=0,ka={next:function(){if(ta<D.length){var Da=ta++;return{value:ia(Da,D[Da]),done:!1}}ka.next=function(){return{done:!0,value:void 0}};return ka.next()}};ka[Symbol.iterator]=function(){return ka};return ka};
$jscomp.polyfill=function(D,ia,ta,ka){if(ia){ta=$jscomp.global;D=D.split(".");for(ka=0;ka<D.length-1;ka++){var Da=D[ka];Da in ta||(ta[Da]={});ta=ta[Da]}D=D[D.length-1];ka=ta[D];ia=ia(ka);ia!=ka&&null!=ia&&$jscomp.defineProperty(ta,D,{configurable:!0,writable:!0,value:ia})}};$jscomp.polyfill("Array.prototype.keys",function(D){return D?D:function(){return $jscomp.iteratorFromArray(this,function(D){return D})}},"es6","es3");
$jscomp.polyfill("Object.getOwnPropertySymbols",function(D){return D?D:function(){return[]}},"es6","es5");$jscomp.findInternal=function(D,ia,ta){D instanceof String&&(D=String(D));for(var ka=D.length,Da=0;Da<ka;Da++){var S=D[Da];if(ia.call(ta,S,Da,D))return{i:Da,v:S}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(D){return D?D:function(D,ta){return $jscomp.findInternal(this,D,ta).v}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(D){return D?D:function(){return $jscomp.iteratorFromArray(this,function(D,ta){return ta})}},"es8","es3");$jscomp.polyfill("Math.sign",function(D){return D?D:function(D){D=Number(D);return 0===D||isNaN(D)?D:0<D?1:-1}},"es6","es3");$jscomp.polyfill("Number.isFinite",function(D){return D?D:function(D){return"number"!==typeof D?!1:!isNaN(D)&&Infinity!==D&&-Infinity!==D}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(D){return D?D:function(D){return Number.isFinite(D)?D===Math.floor(D):!1}},"es6","es3");$jscomp.owns=function(D,ia){return Object.prototype.hasOwnProperty.call(D,ia)};$jscomp.polyfill("Object.assign",function(D){return D?D:function(D,ta){for(var ia=1;ia<arguments.length;ia++){var Da=arguments[ia];if(Da)for(var S in Da)$jscomp.owns(Da,S)&&(D[S]=Da[S])}return D}},"es6","es3");
(function(){var D,ia,ta,ka;function Da(e,b){var d=F,f;for(f=2;60>=f;f+=2){e--;b--;for(var g=0;g<=f;){if(2<O[e+g+d*b]&&1==y[O[e+g+d*b]].res)return O[e+g+d*b];if(2<O[e+g+d*(b+f)]&&1==y[O[e+g+d*(b+f)]].res)return O[e+g+d*(b+f)];g++}for(g=0;g<f-1;){g++;if(2<O[e+d*(b+g)]&&1==y[O[e+d*(b+g)]].res)return O[e+d*(b+g)];if(2<O[e+f+d*(b+g)]&&1==y[O[e+f+d*(b+g)]].res)return O[e+f+d*(b+g)]}}return!1}function S(e,b){if(!Hd(e)){var d=e.x32,f=e.y32,g=e.sight;e.build&&(g=e.attDist);var c=F,l=2*g+1,p=l*l,t=e.id,n={};
e.callList||(e.callList=[]);for(var v=0;v<p;v++){var C=v%l-g,u=~~(v/l)-g;if(Math.sqrt(Math.pow(C,2)+Math.pow(u,2))<=g){C+=d;u+=f;var Ga=C+u*c;pa(C,u)&&(jc[Ga]?(C=y[jc[Ga]],n[C.id]||b||(C.callList||P(C),C.callList.put(e.id),C.callList.put(e.x32+e.y32*c),n[C.id]=1)):jc[Ga]=t)}}}}function mi(e){if(e.callList){for(var b=e.x32,d=e.y32,f=e.sight,g=F,c=2*f+1,l=c*c,p=e.id,t=0;t<l;t++){var n=t%c-f,v=~~(t/c)-f;Math.sqrt(Math.pow(n,2)+Math.pow(v,2))<=f&&(n+=b,v+=d,n+=v*g,jc[n]==p&&(jc[n]=void 0))}b=e.callList;
e.callList=void 0;t=0;for(l=b.length;t<l;t+=2)e=y[b[t]],e.x32+e.y32*g==b[t+1]&&e.callList&&S(e,!0);b.length=0}}function Rk(){for(var e=0,b=za.length;e<b;za[e++].className="");}function Sk(e){m.getError()==m.CONTEXT_LOST_WEBGL&&(m=document.getElementById("tzar").getContext("webgl2",{antialias:!1,alpha:!1}),P("restored"));ia=[];ta=[0,1,2,1,2,3];ka=[];ta.changed=!0;if(!id){var b=m.createShader(m.VERTEX_SHADER);m.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec4 a_kingdom;\nin vec4 a_physic;\nuniform float zoom;\nuniform mediump int miniMap;\nuniform float now;\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform sampler2D u_image1;\nuniform sampler2D delay;\nuniform float zMax;\nout highp vec2 vTextureCoord;\nout vec4 v_kcolor;\nout float height;\n\nvec4 superArray(in highp uint position) {\n     return(texelFetch(u_image1, ivec2(\t\t(position%uint(512))\t\t,\tposition/uint(512)\t), 0));\n}\n\n\n\nvoid main() {\n\n\n\n    highp float  x;\n    float t;\n\thighp uint pos;\n\n\nif(a_texCoord.y>-.5&&miniMap==0){\nt=(now-a_texCoord.y);\nif(a_texCoord.w>=0.0){\npos=uint(floor(t * a_texCoord.w));         \n}else{\n\n\nint index=int(-a_texCoord.w);\nint len=int(a_texCoord.z);\nint i;\n\nfloat spt= mod(t,texelFetch(delay, ivec2(len-1+index, 0), 0).r);\n\n for(i=0;i<len;i++){\n\n\nif(texelFetch(delay, ivec2(i+index, 0), 0).r>spt) {\n\nbreak;\n }\n\n\n }\n\n pos=uint(i);\n\n\t\t\t\t  \n //pos=uint(4);\n}\n\n\n\tpos=uint(a_texCoord.x)+uint(4)*(pos%uint(a_texCoord.z));\n\n\n}else{\n\npos=uint(a_texCoord.x);\n\n}\n\n\n\n    vec4 coord = superArray(pos);\n\n\tpos=pos-pos%uint(4);\n\n\theight = (superArray(pos+uint(3)).w-superArray(pos).w)/512.0;\n\n    vec2 mxy=vec2(coord.p,coord.q);\n\n\n\t\tfloat z=a_position.z;\n\n\tif(z<0.0){\n\tz*=-1.0;\n\tmxy*=0.0;\n\n\t}\n\n\n\n    t = (now - a_physic.w) * 0.001;\n    mxy.x+=a_physic.x * t;\n\n\tfloat physicY=a_physic.y * t + a_physic.z * .5 * t * t;\n\n    mxy.y+=physicY;\n\n\nif(miniMap==1){\n\tz=0.0;\n}else{\n\tz=(1.0 - (physicY+z)/ zMax)*.9;\n}\n\n   gl_Position = vec4((((a_position.xy+mxy) + u_translation) / u_resolution * 2.0 - 1.0) * vec2(zoom, -zoom), (z), 1.0);\n\n   vTextureCoord=vec2(coord.s,coord.t);\n\n\n    v_kcolor=a_kingdom;\n\n\n}\n");
m.compileShader(b);var d=m.createShader(m.FRAGMENT_SHADER);m.shaderSource(d,"#version 300 es\nprecision mediump float;\n\n\n\nuniform sampler2D lightmap;\nuniform vec2 u_resolution;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform mediump int miniMap;\nin vec4 v_kcolor;\nin highp vec2 vTextureCoord;\nin float height;\nout vec4 COLOR;\n\nvoid main() {\n\n\nif(miniMap==0){\n\n\n\n\nvec2 txtFinal=vTextureCoord;\n\nif(txtFinal.x>=1.0){\ntxtFinal.y+=height*floor(txtFinal.x);\n}\n\n\nvec4 color=texture(img_common, vec3(txtFinal, int(txtFinal.y)));\n \n\nif(color.a<0.5) discard;\n\n\n\n\nif(v_kcolor.a<1.0){\ncolor*=v_kcolor;\n}else if(v_kcolor.a!=1.0){\n\nif(color.r==color.g&&color.r==color.b){\ncolor.rgb*=v_kcolor.rgb;\n}\ncolor.a*=v_kcolor.a-1.0;\n}\nvec4 light=vec4(1.0);\n\n\nlight = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+vec4(1.0,1.0,1.0,0.0)*u_ambient;\n\nCOLOR=color*light;\n\n}else{\nCOLOR=v_kcolor;\n}\n\n}");
m.compileShader(d);la=m.createProgram();m.attachShader(la,b);m.attachShader(la,d);m.linkProgram(la);m.useProgram(la);b=m.getShaderInfoLog(b);console.log("Shader compiler log: "+b);b=m.getShaderInfoLog(d);console.log("Shader compiler log: "+b);b=m.createShader(m.VERTEX_SHADER);m.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\n\n\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform mediump int miniMap;\nuniform float zoom;\n\n\nvoid main() {\n\nfloat depth;\nif(miniMap==1){\ndepth=.03;\n}else{\ndepth=1.0;\n}\n\n   gl_Position = vec4(a_position.x, a_position.y, depth, 1.0);\n   \n\n}");
m.compileShader(b);d=m.createShader(m.FRAGMENT_SHADER);m.shaderSource(d,"#version 300 es\nprecision mediump float;\n\nuniform float u_fps;\nuniform mediump int miniMap;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform vec2 borderCoords;\nuniform vec2 waterBorder;\nuniform vec2 u_translation;\nuniform vec2 u_resolution;\nuniform vec2 minimapMargin;\nuniform mediump isampler2D img_data;\nuniform sampler2D lightmap;\nout vec4 COLOR;\nuniform float zoom;\nuniform float mx;\nuniform float mapSize;\nuniform float terrainInfo[32];\nvec4 sptexture3D(in vec2 coords,in float height1) {\n \n\n \nif(coords.x>=1.0){\ncoords.y+=height1*floor(coords.x);\n}\n\n\n\n    return(\ttexture(img_common, vec3(coords,int(coords.y)))\t);\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\nvec4 color;\n\nvec2 xy =  vec2(gl_FragCoord.x,u_resolution.y-gl_FragCoord.y)/zoom;\n\nif(miniMap==1){\nxy+=minimapMargin/zoom;\n}else{\nxy+=-u_translation+vec2(mx,0.0)/zoom+0.5*(u_resolution-u_resolution/zoom);\n}\n\nvec2 xy32=xy/32.0;\n\nvec2 floorxy32=floor(xy32);\n\nvec2 xyr=xy32-floorxy32;\n\n\nvec2 xyb;\n\n\nfloat dx=0.0;\nfloat dy=0.0;\n\nif(xyr.x>0.5){dx=1.0;}\nif(xyr.y>0.5){dy=1.0;}\n\nvec2 oxy32=xy32;\n\n\nif(dx==1.0){\nxyb=vec2(borderCoords.x+floor(rand(floorxy32)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(-16.0,8.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.x+=dx;\n}\n}\n\nif(dy==1.0){\nxyb=vec2(borderCoords.x+floor(rand(1.5*floorxy32-3.0)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(8,-16.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.y+=dy;\n}\n}\n\n\nint type = texture(img_data,xy32/(mapSize)).r;\nint ntype = texture(img_data,oxy32/(mapSize)).r;\n\nif(type<0&&type!=ntype){\n\nif(ntype<0){\ntype=ntype;\n}else if(ntype==3){\ntype=ntype;\n}else{\ntype=1;\n}\n}\n\n\n\nfloat h;\nfloat w;\nvec2 xytxt;\nif(type<0){\n\ntype=-type-2;\nxytxt=waterBorder+vec2(float(type*8*32),0.0)/512.0;\nw=32.0;\nh=32.0;\ntype*=-1;\n}else{\nxytxt=vec2(terrainInfo[type*4],terrainInfo[type*4+1]);\nw=terrainInfo[type*4+2];\nh=terrainInfo[type*4+3];\n\nif(type==3) xytxt+=vec2(u_fps,0.0);\n}\n\n\nvec2 xyt=vec2(xytxt)+vec2(mod(xy.x,w),mod(xy.y,h))/512.0;\n\n\nif(type==3){ h=576.0; }\ncolor=sptexture3D(xyt,h/512.0);\n\nmediump vec4 light=vec4(1.0);\nif(miniMap==0) light = (texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+1.0)*u_ambient;\n\n\n\nCOLOR=color*light;\n\n\n\n}");
m.compileShader(d);xa=m.createProgram();m.attachShader(xa,b);m.attachShader(xa,d);m.linkProgram(xa);b=m.getShaderInfoLog(b);console.log("Shader1 compiler log T: "+b);b=m.getShaderInfoLog(d);console.log("Shader compiler log T: "+b)}d=m.getAttribLocation(la,"a_position");b=m.getAttribLocation(la,"a_texCoord");var f=m.getAttribLocation(la,"a_kingdom"),g=m.getAttribLocation(la,"a_physic"),c=k,l=kc.dir,p=[];p.length=4*l.length;for(var t=0,n=l.length;t<n;t++){var v=wa[c[l[t]]],C=v[7]+v.deltaY,u=v[8],Ga=
v[9];p[4*t]=v[6]/512;p[4*t+1]=C/512;p[4*t+2]=u;p[4*t+3]=Ga}P(p);t=1/512;m.useProgram(xa);n=m.getUniformLocation(xa,"minimapMargin");Id=m.getUniformLocation(xa,"u_translation");qg=m.getUniformLocation(xa,"u_resolution");rg=m.getUniformLocation(xa,"u_fps");var gc=m.getUniformLocation(xa,"u_ambient");jd=m.getUniformLocation(xa,"zoom");v=m.getUniformLocation(xa,"mx");l=m.getUniformLocation(xa,"mapSize");C=m.getUniformLocation(xa,"borderCoords");u=m.getUniformLocation(xa,"waterBorder");Qe=m.getUniformLocation(xa,
"miniMap");Ga=m.getUniformLocation(xa,"terrainInfo");m.uniform2fv(C,[wa[c.terrain_border][6]*t,t*(wa[c.terrain_border].deltaY+wa[c.terrain_border][7])]);m.uniform2fv(u,[wa[c.waterborder][6]*t,t*(wa[c.waterborder].deltaY+wa[c.waterborder][7])]);m.uniform1i(Qe,0);m.uniform2fv(Id,[0,0]);m.uniform1f(rg,-1);m.uniform1f(jd,1);m.uniform1f(v,-w.mx);m.uniform1f(l,F);m.uniform1fv(Ga,p);q.editor?m.uniform2fv(n,[0,-60]):m.uniform2fv(n,[-4,-31]);c=m.getAttribLocation(xa,"a_position");sg=m.createVertexArray();
m.bindVertexArray(sg);p=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,p);m.bufferData(m.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,1,1,-1,1]),m.STATIC_DRAW);m.enableVertexAttribArray(c);m.vertexAttribPointer(c,2,m.FLOAT,!1,0,0);m.bindVertexArray(null);m.useProgram(la);m.bindBuffer(m.ARRAY_BUFFER,null);c=F*ua*3;tg=m.createVertexArray();m.bindVertexArray(tg);ub=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,ub);m.enableVertexAttribArray(f);m.vertexAttribPointer(f,4,m.FLOAT,!1,0,0);m.bufferData(m.ARRAY_BUFFER,
16*c,m.DYNAMIC_DRAW);kd=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,kd);m.enableVertexAttribArray(b);m.vertexAttribPointer(b,4,m.FLOAT,!1,0,0);m.bufferData(m.ARRAY_BUFFER,16*c,m.DYNAMIC_DRAW);xc=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,xc);m.enableVertexAttribArray(d);m.vertexAttribPointer(d,3,m.FLOAT,!1,0,0);m.bufferData(m.ARRAY_BUFFER,12*c,m.DYNAMIC_DRAW);Jd=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,Jd);m.enableVertexAttribArray(g);m.vertexAttribPointer(g,4,m.FLOAT,!1,0,0);m.bufferData(m.ARRAY_BUFFER,
16*c,m.DYNAMIC_DRAW);m.bindVertexArray(null);Re=m.getUniformLocation(la,"u_resolution");var ld=m.getUniformLocation(la,"u_ambient");Kd=m.getUniformLocation(la,"u_translation");md=m.getUniformLocation(la,"zoom");ni=m.getUniformLocation(la,"now");Se=m.getUniformLocation(la,"miniMap");d=m.getUniformLocation(la,"zMax");m.uniform1f(d,q.zMax);m.uniform1i(Se,0);m.useProgram(la);k.delay=[100,250,400,550,650,750,850,1E3,1150,5150,7650,10150,13650,17150,21150,25150,100,200,300,400,500,600,700,800,900,1E3,1100,
1200,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6500,7700,8900,10100,13600,17100,22100,8E3,8080,8160,8240,8320,8400,8480,100,200,300,400,500,600,700,800,900,1E3,1100,2400,3600,4800,6E3,7200,8400,11900,15400,20400,8E3,8077,8154,8231,8308,8385,8462,8539,8616,8693,8770,8847,8923,5E3,5072,5143,5215,5286,5358,5429,5501,5572,5644,5715,5787,5858,5929,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,3700,4900,7100,9600,12600,17100,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,
8833,8916,9E3,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,8833,8916,9E3,9080,5E3,5100,5200,5300,5400,5500,5600,5700,5850,6E3,70,140,210,280,350,420,490,560,630,700,770,840,910,980,4980,8980,12980,16980,20980,26980,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,4100,6300,8500,11E3,13500,17E3,20500,5E3,5100,5200,5300,5400,5500,5600,5700,5800,5900,6E3,125,230,335,431,546,606,666,731,857,952,1045,1139,1238,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,3300,
5800,8800,12E3,15500,5500,5600,5700,5800,5900,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6800,9800,12800,16300,19800,23800,28300,5E3,5100,5200,5300,5400,5500,5600,210,420,654,864,1074,1284,1494,108,244,380,516,652,788,924,1060,1196,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4100,6100,8100,11100,14100,17100,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5200,9E3,11E3,13800,17600,23400,7E3,7100,
7200,7300,7400,8200,8300,8400,8500,8600,9600,9700,9800,9900,1E4,80,160,210,360,610,1010,1510,100,200,300,400,500,3500,7500,13500,40,80,120,160,200,240,280,320,360,400,440,480,520,2520,3520,4520,5520,6520,8520,11520,107,214,321,428,535,642,749,856,963,1070,1177,1284,1391,1498,7323,13148,18973,24798,30623,36448,7E3,7170,7340,7510,7680,7980,8150,8320,8490,8660,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,6400,8900,11400,14900,18400,7E3,7200,7400,7600,7800,8E3,8200,125,250,375,500,
2E3,2125,2250,100,200,300,400,500,4E3,10500,100,200,300,400,500,600,700,800,900,8900,15900,21400,27400,33900,38900,44900,51900,800,1E3,1200,1400,1600,1800,2E3,2200,2400,2600,NaN,80,160,240,320,400,480,560,640,720,800,880,960,1040,5040,9040,12790,16540,19290,22040,25790,7671,7771,7871,7971,8071,8171,8271,100,200,300,400,500,600,700,800,900,1E3,1100,1200,6200,9700,13200,17200,21200,25200,29200,35200,100,200,300,400,500,600,9600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,11300,17300,
27300,37300,49300,64300,8E3,8228,8457,8685,8914,9142,9371,80,160,240,320,400,480,560,640,720,800,880,960,4960,8460,11460,14460,18460,22460,28460,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5400,8900,12900,16900,22900,28900,5E3,5143,5286,5429,5572,5715,5857,121,232,361,508,629,758,879,1018,1165,1425,1445,1465,1536,1692,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8300,11300,14800,18800,23300,29300,6E3,6171,6343,6514,6685,6857,7028,125,
250,375,500,625,750,875,1E3,1125,1250,1375,1500,6500,10500,13500,16500,19500,23E3,27E3,31500,8E3,8185,8370,8555,8740,8925,9108,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4300,7800,11300,15300,19300,23800,29800,1E4,10107,10214,10321,10428,10535,10643,10750,10857,10964,11071,11178,11285,11393,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4900,8400,12900,17400,22400,27400,
8E3,8250,8500,8750,9E3,9250,9500,9750,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,8300,11800,15800,19800,24300,29300,5E3,5157,5314,5471,5628,5785,5943,125,250,375,500,625,3125,3250,3375,100,200,300,400,500,600,4600,8600,14600,15600,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14400,18400,
22400,28400,180,360,540,720,900,1080,10080,100,200,350,500,600,700,800,950,1100,1250,1400,1550,1700,6200,8700,11700,15200,18700,22700,27700,6E3,6120,6240,6360,6480,6600,6720,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14900,18900,23400,29400,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,7400,10900,14900,19900,5E3,5100,5200,5300,5400,5500,5600,116,232,348,464,522,580,638,696,812,928,1044,1160,1276,1392,100,200,300,400,
500,600,700,800,900,1E3,1100,1200,5200,8700,11700,14700,18700,22700,28700,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,6900,10900,14400,18400,22400,27400,7E3,7100,7200,7300,7400,7500,7600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8600,10800,13E3,15500,19500,24E3,8E3,8100,8200,8300,8400,8500,8600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8800,12300,16300,20300,24300,29300,6E3,6100,6200,6300,6400,6500,6600,100,200,
300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1630,1730,1830,1930,2030,2130,2230,2330,5330,8330,11330,7E3,7150,7300,7450,7600,7750,7900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,5200,8700,12200,15700,20200,24700,29700,34700,8E3,8080,8163,8246,8330,8413,8496,8580,8663,8746,8830,8913,8996,9080,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,5599,5684,5770,5855,5941,6026,6112,125,250,375,500,625,
750,875,1E3,1125,1250,1375,1500,1625,5625,8625,11625,14625,18125,22125,26625,8E3,8185,8370,8555,8740,8925,9108,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,6100,10600,14600,18100,21600,26100,30600,35600,40600,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1700,6700,10700,11300,6E3,6200,6400,6600,6800,7E3,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,10400,100,
200,300,400,500,600,8600];d=k.delay;var Pa=d.length;wa[k.expl_small_hole][1]=-Pa;for(b=t=0;14>t;t++)b+=66,d[t+Pa]=b;d.put(b+3E4);d=new Float32Array(d);oi=function(e){m.useProgram(xa);m.uniform4fv(gc,e);m.useProgram(la);m.uniform4fv(ld,e)};ug=function(e){if(!Ld&&(e.clientX>w.menumx||nd||!e.clientX)){e=.07*Math.sign(e.deltaY)*ba;var b=(ba+e)*tzar.height*.03125;(ba+e)*tzar.width*.03125-(ba+e)*w.mx/32>F||b>ua||(ba+=e,.08>ba&&(ba=.08),Kb(),od(-pb,-ma),m.useProgram(xa),m.uniform1f(jd,1/ba),m.useProgram(la),
m.uniform1f(md,1/ba))}};window.addEventListener("wheel",ug,!1);pi=function(){Pa=[pb,ma];m.useProgram(xa);m.uniform2fv(Id,Pa);m.useProgram(la);m.uniform2fv(Kd,Pa)};oi(qi());P(qi());m.uniform1f(md,1);m.uniform2fv(Kd,[0,0]);var hc=m.createFramebuffer(),na;Md=function(){var e=window.innerWidth,b=window.innerHeight;tzar.width=e;tzar.height=b;m.useProgram(xa);m.uniform2f(qg,e,b);m.useProgram(la);hc.width=e;hc.height=b;m.activeTexture(m.TEXTURE2);na||(na=m.createTexture());m.bindTexture(m.TEXTURE_2D,na);
m.texImage2D(m.TEXTURE_2D,0,m.RGBA,e,b,0,m.RGBA,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.bindFramebuffer(m.FRAMEBUFFER,hc);m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,na,0);m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT);m.bindFramebuffer(m.FRAMEBUFFER,
null);ba=1;m.uniform1f(md,1/ba);m.uniform1i(m.getUniformLocation(la,"lightmap"),2);m.useProgram(xa);m.uniform1i(m.getUniformLocation(xa,"lightmap"),2);m.uniform1f(jd,1/ba);m.useProgram(la);m.uniform2f(Re,e,b);m.viewport(w.mx,0,e,b);Md.changed=1;od(-pb,-ma)};Md.changed=0;window.addEventListener("resize",Md,!1);Md();m.blendEquation(m.FUNC_ADD);m.blendFunc(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA);m.disable(m.DITHER);m.disable(m.BLEND);performance.now();b=m.createTexture();f=T.info;m.bindTexture(m.TEXTURE_2D,
b);m.texImage2D(m.TEXTURE_2D,0,m.RGBA32F,512,512,0,m.RGBA,m.FLOAT,f);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.REPEAT);m.bindTexture(m.TEXTURE_2D,null);m.activeTexture(m.TEXTURE0);m.bindTexture(m.TEXTURE_2D,b);m.uniform1i(m.getUniformLocation(la,"u_image1"),0);m.activeTexture(m.TEXTURE1);b=m.createTexture();m.bindTexture(m.TEXTURE_2D_ARRAY,
b);m.texParameteri(m.TEXTURE_2D_ARRAY,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D_ARRAY,m.TEXTURE_MIN_FILTER,m.NEAREST);f=T.common;g=f.length;v=T.xtra;t=0;for(n=v.length;t<n;g+=v[t++].length);P(T);m.texImage3D(m.TEXTURE_2D_ARRAY,0,m.RGBA,T.size,T.size,g/(4*T.size*T.size),0,m.RGBA,m.UNSIGNED_BYTE,null);g=f.length;m.texSubImage3D(m.TEXTURE_2D_ARRAY,0,0,0,0,T.size,T.size,f.length/(4*T.size*T.size),m.RGBA,m.UNSIGNED_BYTE,f);t=0;for(n=v.length;t<n;t++)f=v[t],m.texSubImage3D(m.TEXTURE_2D_ARRAY,
0,0,0,g/1048576,T.size,T.size,f.length/(4*T.size*T.size),m.RGBA,m.UNSIGNED_BYTE,f),g+=f.length;P(g);m.activeTexture(m.TEXTURE1);m.bindTexture(m.TEXTURE_2D_ARRAY,b);m.uniform1i(m.getUniformLocation(la,"img_common"),1);m.useProgram(xa);m.activeTexture(m.TEXTURE0);m.bindTexture(m.TEXTURE_2D_ARRAY,b);m.uniform1i(m.getUniformLocation(xa,"img_common"),0);Lc(e);id||(P(d),m.activeTexture(m.TEXTURE3),b=m.createTexture(),m.bindTexture(m.TEXTURE_2D,b),m.texImage2D(m.TEXTURE_2D,0,m.R16F,d.length,1,0,m.RED,m.FLOAT,
d),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.REPEAT),m.bindTexture(m.TEXTURE_2D,null),m.bindTexture(m.TEXTURE_2D,b),m.uniform1i(m.getUniformLocation(la,"delay"),3),m.activeTexture(m.TEXTURE2),vg=m.createTexture(),m.bindTexture(m.TEXTURE_2D,vg),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,1,1,0,m.RGBA,m.UNSIGNED_BYTE,new Uint8Array([255,
255,255,255])),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.REPEAT),m.clearColor(0,0,0,1));m.bindFramebuffer(m.FRAMEBUFFER,hc);hc.width=1;hc.height=1;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,na,0);m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT);m.bindFramebuffer(m.FRAMEBUFFER,null);new Float32Array(8);
wg=m.createBuffer();xg=m.createBuffer();ri=m.createBuffer();t=0;for(n=yg.length;t<n;t++)$a(yg[t]);m.enable(m.DEPTH_TEST);m.depthFunc(m.LEQUAL);eb.fp1000=1E3;eb.delta=0;eb.now=0;eb.frameCount=0;m.bindTexture(m.TEXTURE_2D,na);id=T.setup=!0}function pd(e,b){zg();var d=b||pd,f=function(){d(e,b)};if(!si()){if("true"==localStorage.fullscreen){var c=document.documentElement;c.requestFullscreen?c.requestFullscreen():c.msRequestFullscreen?c.msRequestFullscreen():c.mozRequestFullScreen?c.mozRequestFullScreen():
c.webkitRequestFullscreen&&c.webkitRequestFullscreen()}q.editor?(w.marx=0,w.mary=60,r("saveGame").innerHTML=x.save,w.menumy=60,Lb=Bb=171,w.mx=171,w.menumx=171):(w.mx=151,Lb=Bb=128,w.menumx=151,w.menumy=0,r("saveGame").innerHTML=x.savegame,w.marx=4,w.mary=31);Mc.style.width=Bb+"px";Mc.style.height=Lb+"px";Mc.style.left=w.marx+"px";Mc.style.top=w.mary+"px";Mb();r("loading").style.display="block";origin=!1;P(T.load,T.images);if(T.load<T.images||!T.images)return T.started||(r("qdgraphics")&&(r("qdgraphics").style.display=
"none"),ti()),r("loadingtext").innerHTML=x.waitImages,$b=f,!1;if(Te.last!==q.terrainType)return Ag=!0,r("loadingtext").innerHTML="Downloading terrain",Uk(),$b=f,!1;Vk();r("notifybottom").style.display="none";void 0===q.arje&&Bg();q.demo?r("saveGame").style.display="none":r("saveGame").style.display="block";if(q.custom){var h=0==q.cycle?q.kingdomStart||q.kingdoms:q.kingdoms;f=0;for(c=h.length;f<c;f++){var l=new Nb("",h[f].color,[0],!0);Object.assign(l,h[f]);l.values.pop=0;null==l.resources[0]&&(l.resources[0]=
Infinity);null==l.resources[1]&&(l.resources[1]=Infinity);null==l.resources[2]&&(l.resources[2]=Infinity);null==l.resources[3]&&(l.resources[3]=Infinity)}}else for(f=0,c=J.length;f<c;f++){h=J[f];l=[0];for(var p=0;p<c;p++)l[p+1]=J[p].team==h.team?0:1;q.online&&h.id===w.onlineID&&(w.kingdom=f+1);new Nb(h.name,h.color,l,h.race,h.IA,[q.goldRes,q.woodRes,q.foodRes,q.stoneRes],h.team)}q.rules?Wk(q.rules):Nd=void 0;w.kingdom||(w.kingdom=1);Xk();return!0}}function ui(){r("playingMenu").style.display="block";
Mb()}function Yk(e){P("setup:",e);e.toSend=[];e.orderList=[];e.sendDirectly("channelMessage","nehhof",{});e.channels.channelMessage.onopen=function(){Ja.put(e);qa("attack");Cg();Dg(1);P("DATACHANNEL OPEN");for(var b=0,d=J.length;b<d;b++)if(J[b].id==e.id)e.username=J[b].name,Ob[b]&&(Ob[b].style.background="#00ff00",Ob[b].style.boxShadow="0px 0px 30px 0px #00ff00");else if(J[b].id==w.onlineID){var c=J[b],g=w.color;P("sending");fa(Eg,g,0,[e],2);fa(Fg,c.team,0,[e],2);fa(Gg,c.race,0,[e],2);fa(vi,w.name,
0,[e],2)}};e.channels.channelMessage.onerror=function(e){P(e)}}function wi(){document.getElementById("buttons").innerHTML="";document.getElementById("onlineID").value="";document.getElementById("gameName").innerHTML=""}function Hg(){w.p2p?(Ea(),w.p2p.emit("getRooms"),r("returnmenu").style.display="block"):(ab||lc(),lc.func=Hg)}function xi(){var e=location,b=e.hash.substr(1);""==b&&(document.getElementById("returnmenu").style.display="none");if("MatchX"==b.substr(0,6))6<b.length&&Zk(b.substr(6-b.length));
else if("Room"==e.hash.substr(-4))e=e.hash.substr(1),w.admin||yi(e.substr(0,e.length-4));else if(zi[b])zi[b]();else e.hash=""}function Ai(e){var b=new Date;e=new Uint32Array(e);for(var d,c=F,g=0;g<O.length;g++)O[g]!=e[g]&&(d=e[g],O[g]=d,d=y[d],d.x32=g%c,d.y32=~~(g/c));console.log(new Date-b)}function Bi(e){e=new Uint32Array(e);console.log(e)}function Ci(e){e=document.getElementById(e);e.style.display="none"==e.style.display?"block":"none"}function Ig(e){e.style.display="none"==e.style.display?"block":
"none"}function Di(e){Q=function(){};ac=!1;var b=W;b.d=e.d;Z(b,e.img);b.active=!0;qb=A[52];Od=e;document.addEventListener("mousemove",Jg);document.addEventListener("mousedown",Ue)}function $k(e,b){return e.innerHTML-b.innerHTML}var al=function(){(function(e){"object"===typeof exports&&"undefined"!==typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).SimpleWebRTC=
e()})(function(){return function g(b,d,c){function f(h,p){if(!d[h]){if(!b[h]){var t="function"==typeof require&&require;if(!p&&t)return t(h,!0);if(l)return l(h,!0);p=Error("Cannot find module '"+h+"'");throw p.code="MODULE_NOT_FOUND",p;}p=d[h]={exports:{}};b[h][0].call(p.exports,function(d){var c=b[h][1][d];return f(c?c:d)},p,p.exports,g,b,d,c)}return d[h].exports}for(var l="function"==typeof require&&require,p=0;p<c.length;p++)f(c[p]);return f}({1:[function(b,d,c){function f(){}d.exports=function(b,
d,c){function g(b,f){if(0>=g.count)throw Error("after called too many times");--g.count;b?(h=!0,d(b),d=c):0!==g.count||h||d(null,f)}var h=!1;c=c||f;g.count=b;return 0===b?d():g}},{}],2:[function(b,d,c){d.exports=function(b,d,c){var f=b.byteLength;d=d||0;c=c||f;if(b.slice)return b.slice(d,c);0>d&&(d+=f);0>c&&(c+=f);c>f&&(c=f);if(d>=f||d>=c||0===f)return new ArrayBuffer(0);b=new Uint8Array(b);f=new Uint8Array(c-d);for(var g=0;d<c;d++,g++)f[g]=b[d];return f.buffer}},{}],3:[function(b,d,c){d.exports=
function(b,d,c){var f,g=d;d={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};if(c)for(f in c)d[f]=c[f];g?"audio"===g.tagName.toLowerCase()&&(d.audio=!0):g=document.createElement(d.audio?"audio":"video");d.disableContextMenu&&(g.oncontextmenu=function(b){b.preventDefault()});d.autoplay&&(g.autoplay="autoplay");d.muted&&(g.muted=!0);!d.audio&&d.mirror&&["","moz","webkit","o","ms"].forEach(function(b){g.style[b?b+"Transform":"transform"]="scaleX(-1)"});g.srcObject=b;return g}},{}],4:[function(b,
d,c){function f(b){b=b||{};this.ms=b.min||100;this.max=b.max||1E4;this.factor=b.factor||2;this.jitter=0<b.jitter&&1>=b.jitter?b.jitter:0;this.attempts=0}d.exports=f;f.prototype.duration=function(){var b=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var d=Math.random(),c=Math.floor(d*this.jitter*b);b=0==(Math.floor(10*d)&1)?b-c:b+c}return Math.min(b,this.max)|0};f.prototype.reset=function(){this.attempts=0};f.prototype.setMin=function(b){this.ms=b};f.prototype.setMax=function(b){this.max=
b};f.prototype.setJitter=function(b){this.jitter=b}},{}],5:[function(b,d,c){(function(b){c.encode=function(d){d=new Uint8Array(d);var c,f=d.length,g="";for(c=0;c<f;c+=3)g+=b[d[c]>>2],g+=b[(d[c]&3)<<4|d[c+1]>>4],g+=b[(d[c+1]&15)<<2|d[c+2]>>6],g+=b[d[c+2]&63];2===f%3?g=g.substring(0,g.length-1)+"=":1===f%3&&(g=g.substring(0,g.length-2)+"==");return g};c.decode=function(d){var c=.75*d.length,f=d.length,g=0;"="===d[d.length-1]&&(c--,"="===d[d.length-2]&&c--);var h=new ArrayBuffer(c),v=new Uint8Array(h);
for(c=0;c<f;c+=4){var C=b.indexOf(d[c]);var u=b.indexOf(d[c+1]);var Ga=b.indexOf(d[c+2]);var gc=b.indexOf(d[c+3]);v[g++]=C<<2|u>>4;v[g++]=(u&15)<<4|Ga>>2;v[g++]=(Ga&3)<<6|gc&63}return h}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],6:[function(b,d,c){(function(b){function c(b){for(var d=0;d<b.length;d++){var c=b[d];if(c.buffer instanceof ArrayBuffer){var f=c.buffer;if(c.byteLength!==f.byteLength){var g=new Uint8Array(c.byteLength);g.set(new Uint8Array(f,c.byteOffset,
c.byteLength));f=g.buffer}b[d]=f}}}function f(b,d){d=d||{};var f=new t;c(b);for(var g=0;g<b.length;g++)f.append(b[g]);return d.type?f.getBlob(d.type):f.getBlob()}function g(b,d){c(b);return new Blob(b,d||{})}var t=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder;try{var n=2===(new Blob(["hi"])).size}catch(u){n=!1}var v;if(v=n)try{v=2===(new Blob([new Uint8Array([1,2])])).size}catch(u){v=!1}var C=t&&t.prototype.append&&t.prototype.getBlob;b=n?v?b.Blob:g:C?f:void 0;d.exports=b}).call(this,
"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],7:[function(b,d,c){var f=[].slice;d.exports=function(b,d){"string"==typeof d&&(d=b[d]);if("function"!=typeof d)throw Error("bind() requires a function");var c=f.call(arguments,2);return function(){return d.apply(b,c.concat(f.call(arguments)))}}},{}],8:[function(b,d,c){function f(b){if(b){for(var d in f.prototype)b[d]=f.prototype[d];return b}}d.exports=f;f.prototype.on=f.prototype.addEventListener=
function(b,d){this._callbacks=this._callbacks||{};(this._callbacks[b]=this._callbacks[b]||[]).push(d);return this};f.prototype.once=function(b,d){function c(){f.off(b,c);d.apply(this,arguments)}var f=this;this._callbacks=this._callbacks||{};c.fn=d;this.on(b,c);return this};f.prototype.off=f.prototype.removeListener=f.prototype.removeAllListeners=f.prototype.removeEventListener=function(b,d){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var c=this._callbacks[b];
if(!c)return this;if(1==arguments.length)return delete this._callbacks[b],this;for(var f,g=0;g<c.length;g++)if(f=c[g],f===d||f.fn===d){c.splice(g,1);break}return this};f.prototype.emit=function(b){this._callbacks=this._callbacks||{};var d=[].slice.call(arguments,1),c=this._callbacks[b];if(c){c=c.slice(0);for(var f=0,g=c.length;f<g;++f)c[f].apply(this,d)}return this};f.prototype.listeners=function(b){this._callbacks=this._callbacks||{};return this._callbacks[b]||[]};f.prototype.hasListeners=function(b){return!!this.listeners(b).length}},
{}],9:[function(b,d,c){d.exports=function(b,d){var c=function(){};c.prototype=d.prototype;b.prototype=new c;b.prototype.constructor=b}},{}],10:[function(b,d,c){function f(b){return f.enabled(b)?function(d){d instanceof Error&&(d=d.stack||d.message);var c=new Date,g=c-(f[b]||c);f[b]=c;d=b+" "+d+" +"+f.humanize(g);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}d.exports=f;f.names=[];f.skips=[];f.enable=function(b){try{localStorage.debug=b}catch(n){}for(var d=
(b||"").split(/[\s,]+/),c=d.length,g=0;g<c;g++)b=d[g].replace("*",".*?"),"-"===b[0]?f.skips.push(new RegExp("^"+b.substr(1)+"$")):f.names.push(new RegExp("^"+b+"$"))};f.disable=function(){f.enable("")};f.humanize=function(b){return 36E5<=b?(b/36E5).toFixed(1)+"h":6E4<=b?(b/6E4).toFixed(1)+"m":1E3<=b?(b/1E3|0)+"s":b+"ms"};f.enabled=function(b){for(var d=0,c=f.skips.length;d<c;d++)if(f.skips[d].test(b))return!1;d=0;for(c=f.names.length;d<c;d++)if(f.names[d].test(b))return!0;return!1};try{window.localStorage&&
f.enable(localStorage.debug)}catch(h){}},{}],11:[function(b,d,c){d.exports=b("./lib/")},{"./lib/":12}],12:[function(b,d,c){d.exports=b("./socket");d.exports.parser=b("engine.io-parser")},{"./socket":13,"engine.io-parser":24}],13:[function(b,d,c){(function(c){function f(b,d){if(!(this instanceof f))return new f(b,d);d=d||{};b&&"object"==typeof b&&(d=b,b=null);b&&(b=C(b),d.host=b.host,d.secure="https"==b.protocol||"wss"==b.protocol,d.port=b.port,b.query&&(d.query=b.query));this.secure=null!=d.secure?
d.secure:c.location&&"https:"==location.protocol;d.host&&(b=d.host.split(":"),d.hostname=b.shift(),b.length?d.port=b.pop():d.port||(d.port=this.secure?"443":"80"));this.agent=d.agent||!1;this.hostname=d.hostname||(c.location?location.hostname:"localhost");this.port=d.port||(c.location&&location.port?location.port:this.secure?443:80);this.query=d.query||{};"string"==typeof this.query&&(this.query=Ga.decode(this.query));this.upgrade=!1!==d.upgrade;this.path=(d.path||"/engine.io").replace(/\/$/,"")+
"/";this.forceJSONP=!!d.forceJSONP;this.jsonp=!1!==d.jsonp;this.forceBase64=!!d.forceBase64;this.enablesXDR=!!d.enablesXDR;this.timestampParam=d.timestampParam||"t";this.timestampRequests=d.timestampRequests;this.transports=d.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=d.policyPort||843;this.rememberUpgrade=d.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=d.onlyBinaryUpgrades;this.pfx=d.pfx||null;this.key=d.key||
null;this.passphrase=d.passphrase||null;this.cert=d.cert||null;this.ca=d.ca||null;this.ciphers=d.ciphers||null;this.rejectUnauthorized=d.rejectUnauthorized||null;this.open()}var g=b("./transports"),p=b("component-emitter"),t=b("debug")("engine.io-client:socket"),n=b("indexof"),v=b("engine.io-parser"),C=b("parseuri"),u=b("parsejson"),Ga=b("parseqs");d.exports=f;f.priorWebsocketSuccess=!1;p(f.prototype);f.protocol=v.protocol;f.Socket=f;f.Transport=b("./transport");f.transports=b("./transports");f.parser=
b("engine.io-parser");f.prototype.createTransport=function(b){t('creating transport "%s"',b);var d=this.query,c={},f;for(f in d)d.hasOwnProperty(f)&&(c[f]=d[f]);c.EIO=v.protocol;c.transport=b;this.id&&(c.sid=this.id);return new g[b]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:c,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,
policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})};f.prototype.open=function(){if(this.rememberUpgrade&&f.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))var b="websocket";else{if(0==this.transports.length){var d=this;setTimeout(function(){d.emit("error","No transports available")},0);return}b=this.transports[0]}this.readyState="opening";try{b=this.createTransport(b)}catch(Pa){this.transports.shift();
this.open();return}b.open();this.setTransport(b)};f.prototype.setTransport=function(b){t("setting transport %s",b.name);var d=this;this.transport&&(t("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=b;b.on("drain",function(){d.onDrain()}).on("packet",function(b){d.onPacket(b)}).on("error",function(b){d.onError(b)}).on("close",function(){d.onClose("transport close")})};f.prototype.probe=function(b){function d(){if(u.onlyBinaryUpgrades){var d=
!this.supportsBinary&&u.transport.supportsBinary;C=C||d}C||(t('probe transport "%s" opened',b),v.send([{type:"ping",data:"probe"}]),v.once("packet",function(d){C||("pong"==d.type&&"probe"==d.data?(t('probe transport "%s" pong',b),u.upgrading=!0,u.emit("upgrading",v),v&&(f.priorWebsocketSuccess="websocket"==v.name,t('pausing current transport "%s"',u.transport.name),u.transport.pause(function(){C||"closed"==u.readyState||(t("changing transport and sending upgrade packet"),n(),u.setTransport(v),v.send([{type:"upgrade"}]),
u.emit("upgrade",v),v=null,u.upgrading=!1,u.flush())}))):(t('probe transport "%s" failed',b),d=Error("probe error"),d.transport=v.name,u.emit("upgradeError",d)))}))}function c(){C||(C=!0,n(),v.close(),v=null)}function g(d){var f=Error("probe error: "+d);f.transport=v.name;c();t('probe transport "%s" failed because of error: %s',b,d);u.emit("upgradeError",f)}function h(){g("transport closed")}function l(){g("socket closed")}function p(b){v&&b.name!=v.name&&(t('"%s" works - aborting "%s"',b.name,v.name),
c())}function n(){v.removeListener("open",d);v.removeListener("error",g);v.removeListener("close",h);u.removeListener("close",l);u.removeListener("upgrading",p)}t('probing transport "%s"',b);var v=this.createTransport(b,{probe:1}),C=!1,u=this;f.priorWebsocketSuccess=!1;v.once("open",d);v.once("error",g);v.once("close",h);this.once("close",l);this.once("upgrading",p);v.open()};f.prototype.onOpen=function(){t("socket open");this.readyState="open";f.priorWebsocketSuccess="websocket"==this.transport.name;
this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){t("starting upgrade probes");for(var b=0,d=this.upgrades.length;b<d;b++)this.probe(this.upgrades[b])}};f.prototype.onPacket=function(b){if("opening"==this.readyState||"open"==this.readyState)switch(t('socket receive: type "%s", data "%s"',b.type,b.data),this.emit("packet",b),this.emit("heartbeat"),b.type){case "open":this.onHandshake(u(b.data));break;case "pong":this.setPing();break;case "error":var d=Error("server error");
d.code=b.data;this.emit("error",d);break;case "message":this.emit("data",b.data),this.emit("message",b.data)}else t('packet received with socket readyState "%s"',this.readyState)};f.prototype.onHandshake=function(b){this.emit("handshake",b);this.id=b.sid;this.transport.query.sid=b.sid;this.upgrades=this.filterUpgrades(b.upgrades);this.pingInterval=b.pingInterval;this.pingTimeout=b.pingTimeout;this.onOpen();"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),
this.on("heartbeat",this.onHeartbeat))};f.prototype.onHeartbeat=function(b){clearTimeout(this.pingTimeoutTimer);var d=this;d.pingTimeoutTimer=setTimeout(function(){if("closed"!=d.readyState)d.onClose("ping timeout")},b||d.pingInterval+d.pingTimeout)};f.prototype.setPing=function(){var b=this;clearTimeout(b.pingIntervalTimer);b.pingIntervalTimer=setTimeout(function(){t("writing ping packet - expecting pong within %sms",b.pingTimeout);b.ping();b.onHeartbeat(b.pingTimeout)},b.pingInterval)};f.prototype.ping=
function(){this.sendPacket("ping")};f.prototype.onDrain=function(){for(var b=0;b<this.prevBufferLen;b++)if(this.callbackBuffer[b])this.callbackBuffer[b]();this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0==this.writeBuffer.length?this.emit("drain"):this.flush()};f.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(t("flushing %d packets in socket",this.writeBuffer.length),
this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};f.prototype.write=f.prototype.send=function(b,d){this.sendPacket("message",b,d);return this};f.prototype.sendPacket=function(b,d,c){"closing"!=this.readyState&&"closed"!=this.readyState&&(b={type:b,data:d},this.emit("packetCreate",b),this.writeBuffer.push(b),this.callbackBuffer.push(c),this.flush())};f.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){var b=function(){f.once("upgrade",
d);f.once("upgradeError",d)},d=function(){f.removeListener("upgrade",d);f.removeListener("upgradeError",d);c()},c=function(){f.onClose("forced close");t("socket closing - telling transport to close");f.transport.close()};this.readyState="closing";var f=this;if(this.writeBuffer.length)this.once("drain",function(){this.upgrading?b():c()});else this.upgrading?b():c()}return this};f.prototype.onError=function(b){t("socket error %j",b);f.priorWebsocketSuccess=!1;this.emit("error",b);this.onClose("transport error",
b)};f.prototype.onClose=function(b,d){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){t('socket close with reason: "%s"',b);var c=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){c.writeBuffer=[];c.callbackBuffer=[];c.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",b,d)}};f.prototype.filterUpgrades=
function(b){for(var d=[],c=0,f=b.length;c<f;c++)~n(this.transports,b[c])&&d.push(b[c]);return d}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./transport":14,"./transports":15,"component-emitter":8,debug:21,"engine.io-parser":24,indexof:32,parsejson:40,parseqs:41,parseuri:23}],14:[function(b,d,c){function f(b){this.path=b.path;this.hostname=b.hostname;this.port=b.port;this.secure=b.secure;this.query=b.query;this.timestampParam=
b.timestampParam;this.timestampRequests=b.timestampRequests;this.readyState="";this.agent=b.agent||!1;this.socket=b.socket;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized}var h=b("engine.io-parser");b=b("component-emitter");d.exports=f;b(f.prototype);f.timestamps=0;f.prototype.onError=function(b,d){b=Error(b);b.type="TransportError";b.description=d;this.emit("error",
b);return this};f.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this};f.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),this.onClose();return this};f.prototype.send=function(b){if("open"==this.readyState)this.write(b);else throw Error("Transport not open");};f.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};f.prototype.onData=function(b){b=
h.decodePacket(b,this.socket.binaryType);this.onPacket(b)};f.prototype.onPacket=function(b){this.emit("packet",b)};f.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,"engine.io-parser":24}],15:[function(b,d,c){(function(d){var f=b("xmlhttprequest"),g=b("./polling-xhr"),p=b("./polling-jsonp"),t=b("./websocket");c.polling=function(b){var c=!1,h=!1,l=!1!==b.jsonp;d.location&&(h="https:"==location.protocol,(c=location.port)||(c=h?443:80),c=b.hostname!=
location.hostname||c!=b.port,h=b.secure!=h);b.xdomain=c;b.xscheme=h;if("open"in new f(b)&&!b.forceJSONP)return new g(b);if(!l)throw Error("JSONP disabled");return new p(b)};c.websocket=t}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(b,d,c){(function(c){function f(){}function g(b){p.call(this,b);this.query=this.query||{};C||(c.___eio||(c.___eio=
[]),C=c.___eio);this.index=C.length;var d=this;C.push(function(b){d.onData(b)});this.query.j=this.index;c.document&&c.addEventListener&&c.addEventListener("beforeunload",function(){d.script&&(d.script.onerror=f)},!1)}var p=b("./polling"),t=b("component-inherit");d.exports=g;var n=/\n/g,v=/\\n/g,C;t(g,p);g.prototype.supportsBinary=!1;g.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),
this.iframe=this.form=null);p.prototype.doClose.call(this)};g.prototype.doPoll=function(){var b=this,d=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);d.async=!0;d.src=this.uri();d.onerror=function(d){b.onError("jsonp poll error",d)};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(d,c);this.script=d;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var b=document.createElement("iframe");
document.body.appendChild(b);document.body.removeChild(b)},100)};g.prototype.doWrite=function(b,d){function c(){f();d()}function f(){if(g.iframe)try{g.form.removeChild(g.iframe)}catch(Kg){g.onError("jsonp polling iframe removal error",Kg)}try{t=document.createElement('<iframe src="javascript:0" name="'+g.iframeId+'">')}catch(Kg){t=document.createElement("iframe"),t.name=g.iframeId,t.src="javascript:0"}t.id=g.iframeId;g.form.appendChild(t);g.iframe=t}var g=this;if(!this.form){var h=document.createElement("form"),
l=document.createElement("textarea"),p=this.iframeId="eio_iframe_"+this.index,t;h.className="socketio";h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=p;h.method="POST";h.setAttribute("accept-charset","utf-8");l.name="d";h.appendChild(l);document.body.appendChild(h);this.form=h;this.area=l}this.form.action=this.uri();f();b=b.replace(v,"\\\n");this.area.value=b.replace(n,"\\n");try{this.form.submit()}catch(Kg){}this.iframe.attachEvent?this.iframe.onreadystatechange=
function(){"complete"==g.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-inherit":9}],17:[function(b,d,c){(function(c){function f(){}function g(b){v.call(this,b);if(c.location){var d="https:"==location.protocol,f=location.port;f||(f=d?443:80);this.xd=b.hostname!=c.location.hostname||f!=b.port;this.xs=b.secure!=d}}function p(b){this.method=b.method||"GET";this.uri=
b.uri;this.xd=!!b.xd;this.xs=!!b.xs;this.async=!1!==b.async;this.data=void 0!=b.data?b.data:null;this.agent=b.agent;this.isBinary=b.isBinary;this.supportsBinary=b.supportsBinary;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized;this.create()}function t(){for(var b in p.requests)p.requests.hasOwnProperty(b)&&p.requests[b].abort()}var n=b("xmlhttprequest"),v=b("./polling"),
C=b("component-emitter"),u=b("component-inherit"),Ga=b("debug")("engine.io-client:polling-xhr");d.exports=g;d.exports.Request=p;u(g,v);g.prototype.supportsBinary=!0;g.prototype.request=function(b){b=b||{};b.uri=this.uri();b.xd=this.xd;b.xs=this.xs;b.agent=this.agent||!1;b.supportsBinary=this.supportsBinary;b.enablesXDR=this.enablesXDR;b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;return new p(b)};
g.prototype.doWrite=function(b,d){b=this.request({method:"POST",data:b,isBinary:"string"!==typeof b&&void 0!==b});var c=this;b.on("success",d);b.on("error",function(b){c.onError("xhr post error",b)});this.sendXhr=b};g.prototype.doPoll=function(){Ga("xhr poll");var b=this.request(),d=this;b.on("data",function(b){d.onData(b)});b.on("error",function(b){d.onError("xhr poll error",b)});this.pollXhr=b};C(p.prototype);p.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,
enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var d=this.xhr=new n(b),f=this;try{Ga("xhr open %s: %s",this.method,this.uri);d.open(this.method,this.uri,this.async);this.supportsBinary&&(d.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?d.setRequestHeader("Content-type","application/octet-stream"):d.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(hc){}"withCredentials"in
d&&(d.withCredentials=!0);this.hasXDR()?(d.onload=function(){f.onLoad()},d.onerror=function(){f.onError(d.responseText)}):d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status||1223==d.status)f.onLoad();else setTimeout(function(){f.onError(d.status)},0)};Ga("xhr data %s",this.data);d.send(this.data)}catch(hc){setTimeout(function(){f.onError(hc)},0);return}c.document&&(this.index=p.requestsCount++,p.requests[this.index]=this)};p.prototype.onSuccess=function(){this.emit("success");this.cleanup()};
p.prototype.onData=function(b){this.emit("data",b);this.onSuccess()};p.prototype.onError=function(b){this.emit("error",b);this.cleanup(!0)};p.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=this.xhr.onerror=f:this.xhr.onreadystatechange=f;if(b)try{this.xhr.abort()}catch(ld){}c.document&&delete p.requests[this.index];this.xhr=null}};p.prototype.onLoad=function(){try{try{var b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(Pa){}var d=
"application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(Pa){this.onError(Pa)}if(null!=d)this.onData(d)};p.prototype.hasXDR=function(){return"undefined"!==typeof c.XDomainRequest&&!this.xs&&this.enablesXDR};p.prototype.abort=function(){this.cleanup()};c.document&&(p.requestsCount=0,p.requests={},c.attachEvent?c.attachEvent("onunload",t):c.addEventListener&&c.addEventListener("beforeunload",t,!1))}).call(this,"undefined"!==typeof global?global:"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-emitter":8,"component-inherit":9,debug:21,xmlhttprequest:20}],18:[function(b,d,c){function f(b){var d=b&&b.forceBase64;if(!n||d)this.supportsBinary=!1;h.call(this,b)}var h=b("../transport"),l=b("parseqs"),p=b("engine.io-parser");c=b("component-inherit");var t=b("debug")("engine.io-client:polling");d.exports=f;var n=null!=(new (b("xmlhttprequest"))({xdomain:!1})).responseType;c(f,h);f.prototype.name="polling";f.prototype.doOpen=
function(){this.poll()};f.prototype.pause=function(b){function d(){t("paused");c.readyState="paused";b()}var c=this;this.readyState="pausing";if(this.polling||!this.writable){var f=0;this.polling&&(t("we are currently polling - waiting to pause"),f++,this.once("pollComplete",function(){t("pre-pause polling complete");--f||d()}));this.writable||(t("we are currently writing - waiting to pause"),f++,this.once("drain",function(){t("pre-pause writing complete");--f||d()}))}else d()};f.prototype.poll=function(){t("polling");
this.polling=!0;this.doPoll();this.emit("poll")};f.prototype.onData=function(b){var d=this;t("polling got data %s",b);p.decodePayload(b,this.socket.binaryType,function(b,c,f){if("opening"==d.readyState)d.onOpen();if("close"==b.type)return d.onClose(),!1;d.onPacket(b)});"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():t('ignoring poll - transport state "%s"',this.readyState))};f.prototype.doClose=function(){function b(){t("writing close packet");
d.write([{type:"close"}])}var d=this;"open"==this.readyState?(t("transport open - closing"),b()):(t("transport not open - deferring close"),this.once("open",b))};f.prototype.write=function(b){var d=this;this.writable=!1;var c=function(){d.writable=!0;d.emit("drain")};d=this;p.encodePayload(b,this.supportsBinary,function(b){d.doWrite(b,c)})};f.prototype.uri=function(){var b=this.query||{},d=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(b[this.timestampParam]=+new Date+"-"+h.timestamps++);
this.supportsBinary||b.sid||(b.b64=1);b=l.encode(b);this.port&&("https"==d&&443!=this.port||"http"==d&&80!=this.port)&&(c=":"+this.port);b.length&&(b="?"+b);return d+"://"+this.hostname+c+this.path+b}},{"../transport":14,"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,xmlhttprequest:20}],19:[function(b,d,c){function f(b){b&&b.forceBase64&&(this.supportsBinary=!1);h.call(this,b)}var h=b("../transport"),l=b("engine.io-parser"),p=b("parseqs");c=b("component-inherit");var t=b("debug")("engine.io-client:websocket"),
n=b("ws");d.exports=f;c(f,h);f.prototype.name="websocket";f.prototype.supportsBinary=!0;f.prototype.doOpen=function(){if(this.check()){var b=this.uri(),d={agent:this.agent};d.pfx=this.pfx;d.key=this.key;d.passphrase=this.passphrase;d.cert=this.cert;d.ca=this.ca;d.ciphers=this.ciphers;d.rejectUnauthorized=this.rejectUnauthorized;this.ws=new n(b,void 0,d);void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.binaryType="arraybuffer";this.addEventListeners()}};f.prototype.addEventListeners=function(){var b=
this;this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(){b.onClose()};this.ws.onmessage=function(d){b.onData(d.data)};this.ws.onerror=function(d){b.onError("websocket error",d)}};"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(f.prototype.onData=function(b){var d=this;setTimeout(function(){h.prototype.onData.call(d,b)},0)});f.prototype.write=function(b){var d=this;this.writable=!1;for(var c=0,f=b.length;c<f;c++)l.encodePacket(b[c],this.supportsBinary,function(b){try{d.ws.send(b)}catch(ld){t("websocket closed before onclose event")}});
setTimeout(function(){d.writable=!0;d.emit("drain")},0)};f.prototype.onClose=function(){h.prototype.onClose.call(this)};f.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()};f.prototype.uri=function(){var b=this.query||{},d=this.secure?"wss":"ws",c="";this.port&&("wss"==d&&443!=this.port||"ws"==d&&80!=this.port)&&(c=":"+this.port);this.timestampRequests&&(b[this.timestampParam]=+new Date);this.supportsBinary||(b.b64=1);b=p.encode(b);b.length&&(b="?"+b);return d+"://"+this.hostname+
c+this.path+b};f.prototype.check=function(){return!!n&&!("__initialize"in n&&this.name===f.prototype.name)}},{"../transport":14,"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,ws:66}],20:[function(b,d,c){var f=b("has-cors");d.exports=function(b){var d=b.xdomain,c=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!d||f))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!c&&b)return new XDomainRequest}catch(t){}if(!d)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}},
{"has-cors":31}],21:[function(b,d,c){function f(){try{var b=localStorage.debug}catch(l){}return b}c=d.exports=b("./debug");c.log=function(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)};c.formatArgs=function(){var b=arguments,d=this.useColors;b[0]=(d?"%c":"")+this.namespace+(d?" %c":" ")+b[0]+(d?"%c ":" ")+"+"+c.humanize(this.diff);if(!d)return b;d="color: "+this.color;b=[b[0],d,"color: inherit"].concat(Array.prototype.slice.call(b,
1));var f=0,g=0;b[0].replace(/%[a-z%]/g,function(b){"%%"!==b&&(f++,"%c"===b&&(g=f))});b.splice(g,0,d);return b};c.save=function(b){try{null==b?localStorage.removeItem("debug"):localStorage.debug=b}catch(l){}};c.load=f;c.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)};c.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");
c.formatters.j=function(b){return JSON.stringify(b)};c.enable(f())},{"./debug":22}],22:[function(b,d,c){c=d.exports=function(b){function d(){}function g(){var b=+new Date;g.diff=b-(h||b);g.prev=h;h=g.curr=b;null==g.useColors&&(g.useColors=c.useColors());null==g.color&&g.useColors&&(g.color=c.colors[f++%c.colors.length]);var d=Array.prototype.slice.call(arguments);d[0]=c.coerce(d[0]);"string"!==typeof d[0]&&(d=["%o"].concat(d));var l=0;d[0]=d[0].replace(/%([a-z%])/g,function(b,f){if("%%"===b)return b;
l++;f=c.formatters[f];"function"===typeof f&&(b=f.call(g,d[l]),d.splice(l,1),l--);return b});"function"===typeof c.formatArgs&&(d=c.formatArgs.apply(g,d));(g.log||c.log||console.log.bind(console)).apply(g,d)}d.enabled=!1;g.enabled=!0;var l=c.enabled(b)?g:d;l.namespace=b;return l};c.coerce=function(b){return b instanceof Error?b.stack||b.message:b};c.disable=function(){c.enable("")};c.enable=function(b){c.save(b);for(var d=(b||"").split(/[\s,]+/),f=d.length,g=0;g<f;g++)d[g]&&(b=d[g].replace(/\*/g,
".*?"),"-"===b[0]?c.skips.push(new RegExp("^"+b.substr(1)+"$")):c.names.push(new RegExp("^"+b+"$")))};c.enabled=function(b){var d;var f=0;for(d=c.skips.length;f<d;f++)if(c.skips[f].test(b))return!1;f=0;for(d=c.names.length;f<d;f++)if(c.names[f].test(b))return!0;return!1};c.humanize=b("ms");c.names=[];c.skips=[];c.formatters={};var f=0,h},{ms:38}],23:[function(b,d,c){var f=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
h="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");d.exports=function(b){var d=b,c=b.indexOf("["),g=b.indexOf("]");-1!=c&&-1!=g&&(b=b.substring(0,c)+b.substring(c,g).replace(/:/g,";")+b.substring(g,b.length));b=f.exec(b||"");for(var l={},C=14;C--;)l[h[C]]=b[C]||"";-1!=c&&-1!=g&&(l.source=d,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=
!0);return l}},{}],24:[function(b,d,c){(function(d){function f(b,d,f){if(!d)return c.encodeBase64Packet(b,f);var g=new FileReader;g.onload=function(){b.data=g.result;c.encodePacket(b,d,!0,f)};return g.readAsArrayBuffer(b.data)}function g(b,d,c){var f=Array(b.length);c=C(b.length,c);for(var g=function(b,c,g){d(c,function(d,c){f[b]=c;g(d,f)})},h=0;h<b.length;h++)g(h,b[h],c)}var p=b("./keys"),t=b("has-binary"),n=b("arraybuffer.slice"),v=b("base64-arraybuffer"),C=b("after"),u=b("utf8"),Ga=navigator.userAgent.match(/Android/i),
m=/PhantomJS/i.test(navigator.userAgent),k=Ga||m;c.protocol=3;var q=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},r=p(q),na={type:"error",data:"parser error"},ea=b("blob");c.encodePacket=function(b,g,h,l){"function"==typeof g&&(l=g,g=!1);"function"==typeof h&&(l=h,h=null);var p=void 0===b.data?void 0:b.data.buffer||b.data;if(d.ArrayBuffer&&p instanceof ArrayBuffer){if(g){h=b.data;g=new Uint8Array(h);h=new Uint8Array(1+h.byteLength);h[0]=q[b.type];for(b=0;b<g.length;b++)h[b+1]=
g[b];b=l(h.buffer)}else b=c.encodeBase64Packet(b,l);return b}if(ea&&p instanceof d.Blob)return g?k?b=f(b,g,l):(g=new Uint8Array(1),g[0]=q[b.type],b=new ea([g.buffer,b.data]),b=l(b)):b=c.encodeBase64Packet(b,l),b;if(p&&p.base64)return l("b"+c.packets[b.type]+b.data.data);g=q[b.type];void 0!==b.data&&(g+=h?u.encode(String(b.data)):String(b.data));return l(""+g)};c.encodeBase64Packet=function(b,f){var g="b"+c.packets[b.type];if(ea&&b.data instanceof ea){var h=new FileReader;h.onload=function(){var b=
h.result.split(",")[1];f(g+b)};return h.readAsDataURL(b.data)}try{var l=String.fromCharCode.apply(null,new Uint8Array(b.data))}catch(Bm){b=new Uint8Array(b.data);l=Array(b.length);for(var p=0;p<b.length;p++)l[p]=b[p];l=String.fromCharCode.apply(null,l)}g+=d.btoa(l);return f(g)};c.decodePacket=function(b,d,f){if("string"==typeof b||void 0===b){if("b"==b.charAt(0))return c.decodeBase64Packet(b.substr(1),d);if(f)try{b=u.decode(b)}catch(Am){return na}f=b.charAt(0);return Number(f)==f&&r[f]?1<b.length?
{type:r[f],data:b.substring(1)}:{type:r[f]}:na}f=(new Uint8Array(b))[0];b=n(b,1);ea&&"blob"===d&&(b=new ea([b]));return{type:r[f],data:b}};c.decodeBase64Packet=function(b,c){var f=r[b.charAt(0)];if(!d.ArrayBuffer)return{type:f,data:{base64:!0,data:b.substr(1)}};b=v.decode(b.substr(1));"blob"===c&&ea&&(b=new ea([b]));return{type:f,data:b}};c.encodePayload=function(b,d,f){"function"==typeof d&&(f=d,d=null);var h=t(b);if(d&&h)return ea&&!k?c.encodePayloadAsBlob(b,f):c.encodePayloadAsArrayBuffer(b,f);
if(!b.length)return f("0:");g(b,function(b,f){c.encodePacket(b,h?d:!1,!0,function(b){f(null,b.length+":"+b)})},function(b,d){return f(d.join(""))})};c.decodePayload=function(b,d,f){if("string"!=typeof b)return c.decodePayloadAsBinary(b,d,f);"function"===typeof d&&(f=d,d=null);if(""==b)return f(na,0,1);var g="";for(var h,l,p=0,t=b.length;p<t;p++)if(l=b.charAt(p),":"!=l)g+=l;else{if(""==g||g!=(h=Number(g)))return f(na,0,1);l=b.substr(p+1,h);if(g!=l.length)return f(na,0,1);if(l.length){g=c.decodePacket(l,
d,!0);if(na.type==g.type&&na.data==g.data)return f(na,0,1);if(!1===f(g,p+h,t))return}p+=h;g=""}if(""!=g)return f(na,0,1)};c.encodePayloadAsArrayBuffer=function(b,d){if(!b.length)return d(new ArrayBuffer(0));g(b,function(b,d){c.encodePacket(b,!0,!0,function(b){return d(null,b)})},function(b,c){b=c.reduce(function(b,d){d="string"===typeof d?d.length:d.byteLength;return b+d.toString().length+d+2},0);var f=new Uint8Array(b),g=0;c.forEach(function(b){var d="string"===typeof b,c=b;if(d){c=new Uint8Array(b.length);
for(var h=0;h<b.length;h++)c[h]=b.charCodeAt(h);c=c.buffer}d?f[g++]=0:f[g++]=1;b=c.byteLength.toString();for(h=0;h<b.length;h++)f[g++]=parseInt(b[h]);f[g++]=255;c=new Uint8Array(c);for(h=0;h<c.length;h++)f[g++]=c[h]});return d(f.buffer)})};c.encodePayloadAsBlob=function(b,d){g(b,function(b,d){c.encodePacket(b,!0,!0,function(b){var c=new Uint8Array(1);c[0]=1;if("string"===typeof b){for(var f=new Uint8Array(b.length),g=0;g<b.length;g++)f[g]=b.charCodeAt(g);b=f.buffer;c[0]=0}f=(b instanceof ArrayBuffer?
b.byteLength:b.size).toString();var h=new Uint8Array(f.length+1);for(g=0;g<f.length;g++)h[g]=parseInt(f[g]);h[f.length]=255;ea&&(b=new ea([c.buffer,h.buffer,b]),d(null,b))})},function(b,c){return d(new ea(c))})};c.decodePayloadAsBinary=function(b,d,f){"function"===typeof d&&(f=d,d=null);for(var g=[],h=!1;0<b.byteLength;){for(var l=new Uint8Array(b),p=0===l[0],t="",v=1;255!=l[v];v++){if(310<t.length){h=!0;break}t+=l[v]}if(h)return f(na,0,1);b=n(b,2+t.length);t=parseInt(t);l=n(b,0,t);if(p)try{l=String.fromCharCode.apply(null,
new Uint8Array(l))}catch(Cm){for(p=new Uint8Array(l),l="",v=0;v<p.length;v++)l+=String.fromCharCode(p[v])}g.push(l);b=n(b,t)}var C=g.length;g.forEach(function(b,g){f(c.decodePacket(b,d,!0),g,C)})}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./keys":25,after:1,"arraybuffer.slice":2,"base64-arraybuffer":5,blob:6,"has-binary":30,utf8:60}],25:[function(b,d,c){d.exports=Object.keys||function(b){var d=[],c=Object.prototype.hasOwnProperty,
f;for(f in b)c.call(b,f)&&d.push(f);return d}},{}],26:[function(b,d,c){function f(b){l.call(this);b=b||{};this.config={chunksize:16384,pacing:0};for(var d in b)this.config[d]=b[d];this.channel=this.file=null}function h(){l.call(this);this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null}var l=b("wildemitter");b=b("util");b.inherits(f,l);f.prototype.send=function(b,d){var c=this;this.file=b;this.channel=d;var f="number"!==typeof d.bufferedAmountLowThreshold,g=0,h=function(){var l=
new window.FileReader;l.onload=function(){return function(l){c.channel.send(l.target.result);c.emit("progress",g,b.size,l.target.result);b.size>g+l.target.result.byteLength?f?window.setTimeout(h,c.config.pacing):d.bufferedAmount<=d.bufferedAmountLowThreshold&&window.setTimeout(h,0):(c.emit("progress",b.size,b.size,null),c.emit("sentFile"));g+=c.config.chunksize}}(b);var p=b.slice(g,g+c.config.chunksize);l.readAsArrayBuffer(p)};f||(d.bufferedAmountLowThreshold=8*this.config.chunksize,d.addEventListener("bufferedamountlow",
h));window.setTimeout(h,0)};b.inherits(h,l);h.prototype.receive=function(b,d){var c=this;b&&(this.metadata=b);this.channel=d;d.binaryType="arraybuffer";this.channel.onmessage=function(b){c.received+=b.data.byteLength;c.receiveBuffer.push(b.data);c.emit("progress",c.received,c.metadata.size,b.data);c.received===c.metadata.size?(c.emit("receivedFile",new window.Blob(c.receiveBuffer),c.metadata),c.receiveBuffer=[]):c.received>c.metadata.size&&(console.error("received more than expected, discarding..."),
c.receiveBuffer=[])}};d.exports={};d.exports.support="undefined"!==typeof window&&window&&window.File&&window.FileReader&&window.Blob;d.exports.Sender=f;d.exports.Receiver=h},{util:63,wildemitter:65}],27:[function(b,d,c){var f={};d.exports=function(b,d){var c=2===arguments.length,g=c?d:b;if("undefined"===typeof window||"http:"===window.location.protocol){var h=Error("NavigatorUserMediaError");h.name="HTTPS_REQUIRED";return g(h)}if(window.navigator.userAgent.match("Chrome")){var l=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],
10),C=33,u=!window.chrome.webstore;window.navigator.userAgent.match("Linux")&&(C=35);sessionStorage.getScreenMediaJSExtensionId?chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(d){d&&""!==d.sourceId?(b=c&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}},b.video.mandatory.chromeMediaSourceId=d.sourceId,window.navigator.mediaDevices.getUserMedia(b).then(function(b){g(null,
b)}).catch(function(b){g(b)})):(d=Error("NavigatorUserMediaError"),d.name="NotAllowedError",g(d))}):window.cefGetScreenMedia?window.cefGetScreenMedia(function(d){d?(b=c&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},b.video.mandatory.chromeMediaSourceId=d,window.navigator.mediaDevices.getUserMedia(b).then(function(b){g(null,b)}).catch(function(b){g(b)})):
(d=Error("cefGetScreenMediaError"),d.name="CEF_GETSCREENMEDIA_CANCELED",g(d))}):u||26<=l&&l<=C?(b=c&&b||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){g(null,b)}).catch(function(b){g(b)})):(l=window.setTimeout(function(){h=Error("NavigatorUserMediaError");h.name="EXTENSION_UNAVAILABLE";return g(h)},1E3),f[l]=[g,c?b:null],window.postMessage({type:"getScreen",
id:l},"*"))}else window.navigator.userAgent.match("Firefox")&&(33<=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)?(b=c&&b||{video:{mozMediaSource:"window",mediaSource:"window"}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){g(null,b);var d=b.currentTime,c=window.setInterval(function(){b||window.clearInterval(c);if(b.currentTime==d&&(window.clearInterval(c),b.onended))b.onended();d=b.currentTime},500)}).catch(function(b){g(b)})):(h=Error("NavigatorUserMediaError"),
h.name="EXTENSION_UNAVAILABLE"))};"undefined"!==typeof window&&window.addEventListener("message",function(b){if(b.origin==window.location.origin)if("gotScreen"==b.data.type&&f[b.data.id]){var d=f[b.data.id],c=d[1],g=d[0];delete f[b.data.id];""===b.data.sourceId?(b=Error("NavigatorUserMediaError"),b.name="NotAllowedError",g(b)):(c=c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},
c.video.mandatory.chromeMediaSourceId=b.data.sourceId,window.navigator.mediaDevices.getUserMedia(c).then(function(b){g(null,b)}).catch(function(b){g(b)}))}else"getScreenPending"==b.data.type&&window.clearTimeout(b.data.id)})},{}],28:[function(b,d,c){d.exports=function(){return this}()},{}],29:[function(b,d,c){var f=b("wildemitter"),h;"undefined"!==typeof window&&(h=window.AudioContext||window.webkitAudioContext);var l=null;d.exports=function(b,d){var c=new f;if(!h)return c;d=d||{};var g=d.smoothing||
.1,p=d.interval||50,t=d.threshold,Ga=d.play;d=d.history||10;var m=!0;l||(l=new h);var k=l.createAnalyser();k.fftSize=512;k.smoothingTimeConstant=g;var q=new Float32Array(k.frequencyBinCount);b.jquery&&(b=b[0]);if(b instanceof HTMLAudioElement||b instanceof HTMLVideoElement){var r=l.createMediaElementSource(b);"undefined"===typeof Ga&&(Ga=!0)}else r=l.createMediaStreamSource(b);t=t||-50;r.connect(k);Ga&&k.connect(l.destination);c.speaking=!1;c.setThreshold=function(b){t=b};c.setInterval=function(b){p=
b};c.stop=function(){m=!1;c.emit("volume_change",-100,t);c.speaking&&(c.speaking=!1,c.emit("stopped_speaking"));k.disconnect();r.disconnect()};c.speakingHistory=[];for(b=0;b<d;b++)c.speakingHistory.push(0);var na=function(){setTimeout(function(){if(m){var b=-Infinity;k.getFloatFrequencyData(q);for(var d=4,f=q.length;d<f;d++)q[d]>b&&0>q[d]&&(b=q[d]);c.emit("volume_change",b,t);d=0;if(b>t&&!c.speaking){for(f=c.speakingHistory.length-3;f<c.speakingHistory.length;f++)d+=c.speakingHistory[f];2<=d&&(c.speaking=
!0,c.emit("speaking"))}else if(b<t&&c.speaking){for(f=0;f<c.speakingHistory.length;f++)d+=c.speakingHistory[f];0==d&&(c.speaking=!1,c.emit("stopped_speaking"))}c.speakingHistory.shift();c.speakingHistory.push(0+(b>t));na()}},p)};na();return c}},{wildemitter:65}],30:[function(b,d,c){(function(c){var f=b("isarray");d.exports=function(b){function d(b){if(!b)return!1;if(c.Buffer&&c.Buffer.isBuffer(b)||c.ArrayBuffer&&b instanceof ArrayBuffer||c.Blob&&b instanceof Blob||c.File&&b instanceof File)return!0;
if(f(b))for(var g=0;g<b.length;g++){if(d(b[g]))return!0}else if(b&&"object"==typeof b)for(g in b.toJSON&&(b=b.toJSON()),b)if(Object.prototype.hasOwnProperty.call(b,g)&&d(b[g]))return!0;return!1}return d(b)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{isarray:33}],31:[function(b,d,c){b=b("global");try{d.exports="XMLHttpRequest"in b&&"withCredentials"in new b.XMLHttpRequest}catch(g){d.exports=!1}},{global:28}],32:[function(b,
d,c){var f=[].indexOf;d.exports=function(b,d){if(f)return b.indexOf(d);for(var c=0;c<b.length;++c)if(b[c]===d)return c;return-1}},{}],33:[function(b,d,c){d.exports=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)}},{}],34:[function(b,d,c){(function(b){function d(b){if(d[b]!==t)return d[b];if("bug-string-char-index"==b)var c=!1;else if("json"==b)c=d("json-stringify")&&d("json-parse");else{var g;if("json-stringify"==b){c=v.stringify;var h="function"==typeof c&&C;
if(h){(g=function(){return 1}).toJSON=g;try{h="0"===c(0)&&"0"===c(new Number)&&'""'==c(new String)&&c(f)===t&&c(t)===t&&c()===t&&"1"===c(g)&&"[1]"==c([g])&&"[null]"==c([t])&&"null"==c(null)&&"[null,null,null]"==c([t,f,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==c({a:[g,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===c(null,g)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==c(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==
c(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==c(new Date(-1))}catch(Ve){h=!1}}c=h}if("json-parse"==b){c=v.parse;if("function"==typeof c)try{if(0===c("0")&&!c(!1)){g=c('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var l=5==g.a.length&&1===g.a[0];if(l){try{l=!c('"\t"')}catch(Ve){}if(l)try{l=1!==c("01")}catch(Ve){}if(l)try{l=1!==c("1.")}catch(Ve){}}}}catch(Ve){l=!1}c=l}}return d[b]=!!c}var f={}.toString,g,t,n="object"==typeof JSON&&JSON,v="object"==typeof c&&c&&!c.nodeType&&c;v&&n?
(v.stringify=n.stringify,v.parse=n.parse):v=b.JSON=n||{};var C=new Date(-0xc782b5b800cec);try{C=-109252==C.getUTCFullYear()&&0===C.getUTCMonth()&&1===C.getUTCDate()&&10==C.getUTCHours()&&37==C.getUTCMinutes()&&6==C.getUTCSeconds()&&708==C.getUTCMilliseconds()}catch(Dm){}if(!d("json")){var u=d("bug-string-char-index");if(!C)var Ga=Math.floor,m=[0,31,59,90,120,151,181,212,243,273,304,334],k=function(b,d){return m[d]+365*(b-1970)+Ga((b-1969+(d=+(1<d)))/4)-Ga((b-1901+d)/100)+Ga((b-1601+d)/400)};(g={}.hasOwnProperty)||
(g=function(b){var d={};if((d.__proto__=null,d.__proto__={toString:1},d).toString!=f)g=function(b){var d=this.__proto__;b=b in(this.__proto__=null,this);this.__proto__=d;return b};else{var c=d.constructor;g=function(b){var d=(this.constructor||c).prototype;return b in this&&!(b in d&&this[b]===d[b])}}d=null;return g.call(this,b)});var q={"boolean":1,number:1,string:1,undefined:1};var r=function(b,d){var c=0,h,l;(h=function(){this.valueOf=0}).prototype.valueOf=0;var p=new h;for(l in p)g.call(p,l)&&
c++;h=p=null;c?r=2==c?function(b,d){var c={},h="[object Function]"==f.call(b),l;for(l in b)h&&"prototype"==l||g.call(c,l)||!(c[l]=1)||!g.call(b,l)||d(l)}:function(b,d){var c="[object Function]"==f.call(b),h,l;for(h in b)c&&"prototype"==h||!g.call(b,h)||(l="constructor"===h)||d(h);(l||g.call(b,h="constructor"))&&d(h)}:(p="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),r=function(b,d){var c="[object Function]"==f.call(b),h,l;if(l=!c&&"function"!=
typeof b.constructor)l=typeof b.hasOwnProperty,l="object"==l?!!b.hasOwnProperty:!q[l];l=l?b.hasOwnProperty:g;for(h in b)c&&"prototype"==h||!l.call(b,h)||d(h);for(c=p.length;h=p[--c];l.call(b,h)&&d(h));});return r(b,d)};if(!d("json-stringify")){var na={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},ea=function(b,d){return("000000"+(d||0)).slice(-b)},y=function(b){var d='"',c=0,f=b.length,g=10<f&&u,h;for(g&&(h=b.split(""));c<f;c++){var l=b.charCodeAt(c);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:d+=
na[l];break;default:d=32>l?d+("\\u00"+ea(2,l.toString(16))):d+(g?h[c]:u?b.charAt(c):b[c])}}return d+'"'},x=function(b,d,c,h,l,p,n){var v;try{var C=d[b]}catch(Fm){}if("object"==typeof C&&C){var u=f.call(C);if("[object Date]"!=u||g.call(C,"toJSON"))"function"==typeof C.toJSON&&("[object Number]"!=u&&"[object String]"!=u&&"[object Array]"!=u||g.call(C,"toJSON"))&&(C=C.toJSON(b));else if(C>-1/0&&C<1/0){if(k){var m=Ga(C/864E5);for(u=Ga(m/365.2425)+1970-1;k(u+1,0)<=m;u++);for(v=Ga((m-k(u,0))/30.42);k(u,
v+1)<=m;v++);m=1+m-k(u,v);var gc=(C%864E5+864E5)%864E5;var q=Ga(gc/36E5)%24;var ld=Ga(gc/6E4)%60;var Pa=Ga(gc/1E3)%60;gc%=1E3}else u=C.getUTCFullYear(),v=C.getUTCMonth(),m=C.getUTCDate(),q=C.getUTCHours(),ld=C.getUTCMinutes(),Pa=C.getUTCSeconds(),gc=C.getUTCMilliseconds();C=(0>=u||1E4<=u?(0>u?"-":"+")+ea(6,0>u?-u:u):ea(4,u))+"-"+ea(2,v+1)+"-"+ea(2,m)+"T"+ea(2,q)+":"+ea(2,ld)+":"+ea(2,Pa)+"."+ea(3,gc)+"Z"}else C=null}c&&(C=c.call(d,b,C));if(null===C)return"null";u=f.call(C);if("[object Boolean]"==
u)return""+C;if("[object Number]"==u)return C>-1/0&&C<1/0?""+C:"null";if("[object String]"==u)return y(""+C);if("object"==typeof C){for(b=n.length;b--;)if(n[b]===C)throw TypeError();n.push(C);var na=[];d=p;p+=l;if("[object Array]"==u){v=0;for(b=C.length;v<b;v++)u=x(v,C,c,h,l,p,n),na.push(u===t?"null":u);b=na.length?l?"[\n"+p+na.join(",\n"+p)+"\n"+d+"]":"["+na.join(",")+"]":"[]"}else r(h||C,function(b){var d=x(b,C,c,h,l,p,n);d!==t&&na.push(y(b)+":"+(l?" ":"")+d)}),b=na.length?l?"{\n"+p+na.join(",\n"+
p)+"\n"+d+"}":"{"+na.join(",")+"}":"{}";n.pop();return b}};v.stringify=function(b,d,c){var g;if("function"==typeof d||"object"==typeof d&&d)if("[object Function]"==(g=f.call(d)))var h=d;else if("[object Array]"==g){var l={};for(var p=0,t=d.length,n;p<t;n=d[p++],(g=f.call(n),"[object String]"==g||"[object Number]"==g)&&(l[n]=1));}if(c)if("[object Number]"==(g=f.call(c))){if(0<(c-=c%1)){var v="";for(10<c&&(c=10);v.length<c;v+=" ");}}else"[object String]"==g&&(v=10>=c.length?c:c.slice(0,10));return x("",
(n={},n[""]=b,n),h,l,v,"",[])}}if(!d("json-parse")){var z=String.fromCharCode,A={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},w,F,E=function(){w=F=null;throw SyntaxError();},B=function(){for(var b=F,d=b.length,c,f,g,h,l;w<d;)switch(l=b.charCodeAt(w),l){case 9:case 10:case 13:case 32:w++;break;case 123:case 125:case 91:case 93:case 58:case 44:return c=u?b.charAt(w):b[w],w++,c;case 34:c="@";for(w++;w<d;)if(l=b.charCodeAt(w),32>l)E();else if(92==l)switch(l=b.charCodeAt(++w),l){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:c+=
A[l];w++;break;case 117:f=++w;for(g=w+4;w<g;w++)l=b.charCodeAt(w),48<=l&&57>=l||97<=l&&102>=l||65<=l&&70>=l||E();c+=z("0x"+b.slice(f,w));break;default:E()}else{if(34==l)break;l=b.charCodeAt(w);for(f=w;32<=l&&92!=l&&34!=l;)l=b.charCodeAt(++w);c+=b.slice(f,w)}if(34==b.charCodeAt(w))return w++,c;E();default:f=w;45==l&&(h=!0,l=b.charCodeAt(++w));if(48<=l&&57>=l){for(48==l&&(l=b.charCodeAt(w+1),48<=l&&57>=l)&&E();w<d&&(l=b.charCodeAt(w),48<=l&&57>=l);w++);if(46==b.charCodeAt(w)){for(g=++w;g<d&&(l=b.charCodeAt(g),
48<=l&&57>=l);g++);g==w&&E();w=g}l=b.charCodeAt(w);if(101==l||69==l){l=b.charCodeAt(++w);43!=l&&45!=l||w++;for(g=w;g<d&&(l=b.charCodeAt(g),48<=l&&57>=l);g++);g==w&&E();w=g}return+b.slice(f,w)}h&&E();if("true"==b.slice(w,w+4))return w+=4,!0;if("false"==b.slice(w,w+5))return w+=5,!1;if("null"==b.slice(w,w+4))return w+=4,null;E()}return"$"},D=function(b){var d,c;"$"==b&&E();if("string"==typeof b){if("@"==(u?b.charAt(0):b[0]))return b.slice(1);if("["==b){for(d=[];;c||(c=!0)){b=B();if("]"==b)break;c&&
(","==b?(b=B(),"]"==b&&E()):E());","==b&&E();d.push(D(b))}return d}if("{"==b){for(d={};;c||(c=!0)){b=B();if("}"==b)break;c&&(","==b?(b=B(),"}"==b&&E()):E());","!=b&&"string"==typeof b&&"@"==(u?b.charAt(0):b[0])&&":"==B()||E();d[b.slice(1)]=D(B())}return d}E()}return b},H=function(b,d,c){c=G(b,d,c);c===t?delete b[d]:b[d]=c},G=function(b,d,c){var g=b[d],h;if("object"==typeof g&&g)if("[object Array]"==f.call(g))for(h=g.length;h--;)H(g,h,c);else r(g,function(b){H(g,b,c)});return c.call(b,d,g)};v.parse=
function(b,d){var c;w=0;F=""+b;b=D(B());"$"!=B()&&E();w=F=null;return d&&"[object Function]"==f.call(d)?G((c={},c[""]=b,c),"",d):b}}}})(this)},{}],35:[function(b,d,c){function f(b){var d=!0;b.getTracks().forEach(function(b){d="ended"===b.readyState&&d});return d}function h(){if("undefined"===typeof window||!window.navigator.mozGetUserMedia)return!1;var b=window.navigator.userAgent.match(/Firefox\/(\d+)\./);return 50>(b&&1<=b.length&&parseInt(b[1],10))}function l(b){n.call(this);var d=this.config=
{detectSpeakingEvents:!1,audioFallback:!1,media:{audio:!0,video:!0},harkOptions:null,logger:v},c;for(c in b)b.hasOwnProperty(c)&&(this.config[c]=b[c]);this.logger=d.logger;this._log=this.logger.log.bind(this.logger,"LocalMedia:");this._logerror=this.logger.error.bind(this.logger,"LocalMedia:");this.localStreams=[];this.localScreens=[];navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||this._logerror("Your browser does not support local media capture.");this._audioMonitors=[];this.on("localStreamStopped",
this._stopAudioMonitor.bind(this));this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}c=b("util");var p=b("hark"),t=b("getscreenmedia"),n=b("wildemitter"),v=b("mockconsole");c.inherits(l,n);l.prototype.start=function(b,d){var c=this,g=b||this.config.media;this.emit("localStreamRequested",g);navigator.mediaDevices.getUserMedia(g).then(function(b){g.audio&&c.config.detectSpeakingEvents&&c._setupAudioMonitor(b,c.config.harkOptions);c.localStreams.push(b);b.getTracks().forEach(function(d){d.addEventListener("ended",
function(){f(b)&&c._removeStream(b)})});c.emit("localStream",b);if(d)return d(null,b)}).catch(function(b){if(c.config.audioFallback&&"NotFoundError"===b.name&&!1!==g.video)g.video=!1,c.start(g,d);else if(c.emit("localStreamRequestFailed",g),d)return d(b,null)})};l.prototype.stop=function(b){this.stopStream(b);this.stopScreenShare(b)};l.prototype.stopStream=function(b){var d=this;b?-1<this.localStreams.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),h()&&this._removeStream(b)):this.localStreams.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});
h()&&d._removeStream(b)})};l.prototype.startScreenShare=function(b,d){var c=this;this.emit("localScreenRequested");"function"!==typeof b||d||(d=b,b=null);t(b,function(b,f){b?c.emit("localScreenRequestFailed"):(c.localScreens.push(f),f.getTracks().forEach(function(b){b.addEventListener("ended",function(){var b=!0;f.getTracks().forEach(function(d){b="ended"===d.readyState&&b});b&&c._removeStream(f)})}),c.emit("localScreen",f));if(d)return d(b,f)})};l.prototype.stopScreenShare=function(b){var d=this;
b?-1<this.localScreens.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),h()&&this._removeStream(b)):this.localScreens.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});h()&&d._removeStream(b)})};l.prototype.mute=function(){this._audioEnabled(!1);this.emit("audioOff")};l.prototype.unmute=function(){this._audioEnabled(!0);this.emit("audioOn")};l.prototype.pauseVideo=function(){this._videoEnabled(!1);this.emit("videoOff")};l.prototype.resumeVideo=function(){this._videoEnabled(!0);
this.emit("videoOn")};l.prototype.pause=function(){this.mute();this.pauseVideo()};l.prototype.resume=function(){this.unmute();this.resumeVideo()};l.prototype._audioEnabled=function(b){this.localStreams.forEach(function(d){d.getAudioTracks().forEach(function(d){d.enabled=!!b})})};l.prototype._videoEnabled=function(b){this.localStreams.forEach(function(d){d.getVideoTracks().forEach(function(d){d.enabled=!!b})})};l.prototype.isAudioEnabled=function(){var b=!0;this.localStreams.forEach(function(d){d.getAudioTracks().forEach(function(d){b=
b&&d.enabled})});return b};l.prototype.isVideoEnabled=function(){var b=!0;this.localStreams.forEach(function(d){d.getVideoTracks().forEach(function(d){b=b&&d.enabled})});return b};l.prototype._removeStream=function(b){var d=this.localStreams.indexOf(b);-1<d?(this.localStreams.splice(d,1),this.emit("localStreamStopped",b)):(d=this.localScreens.indexOf(b),-1<d&&(this.localScreens.splice(d,1),this.emit("localScreenStopped",b)))};l.prototype._setupAudioMonitor=function(b,d){this._log("Setup audio");d=
p(b,d);var c=this,f;d.on("speaking",function(){c.emit("speaking")});d.on("stopped_speaking",function(){f&&clearTimeout(f);f=setTimeout(function(){c.emit("stoppedSpeaking")},1E3)});d.on("volume_change",function(b,d){c.emit("volumeChange",b,d)});this._audioMonitors.push({audio:d,stream:b})};l.prototype._stopAudioMonitor=function(b){var d=-1;this._audioMonitors.forEach(function(c,f){c.stream===b&&(d=f)});-1<d&&(this._audioMonitors[d].audio.stop(),this._audioMonitors.splice(d,1))};d.exports=l},{getscreenmedia:27,
hark:29,mockconsole:37,util:63,wildemitter:65}],36:[function(b,d,c){(function(b){function f(b,d){b.set(d[0],d[1]);return b}function g(b,d){b.add(d);return b}function p(b,d){for(var c=-1,f=b?b.length:0;++c<f&&!1!==d(b[c],c,b););return b}function t(b,d,c,f){var g=-1,h=b?b.length:0;for(f&&h&&(c=b[++g]);++g<h;)c=d(c,b[g],g,b);return c}function n(b){var d=!1;if(null!=b&&"function"!=typeof b.toString)try{d=!!(b+"")}catch(gb){}return d}function v(b){var d=-1,c=Array(b.size);b.forEach(function(b,f){c[++d]=
[f,b]});return c}function C(b,d){return function(c){return b(d(c))}}function u(b){var d=-1,c=Array(b.size);b.forEach(function(b){c[++d]=b});return c}function m(b){var d=-1,c=b?b.length:0;for(this.clear();++d<c;){var f=b[d];this.set(f[0],f[1])}}function k(b){var d=-1,c=b?b.length:0;for(this.clear();++d<c;){var f=b[d];this.set(f[0],f[1])}}function q(b){var d=-1,c=b?b.length:0;for(this.clear();++d<c;){var f=b[d];this.set(f[0],f[1])}}function Pa(b){this.__data__=new k(b)}function r(b,d,c){var f=b[d];
R.call(b,d)&&(f===c||f!==f&&c!==c)&&(void 0!==c||d in b)||(b[d]=c)}function na(b,d){for(var c=b.length;c--;){var f=b[c][0];if(f===d||f!==f&&d!==d)return c}return-1}function ea(b,d){return b&&F(d,N(d),b)}function w(b,d,c,f,g,h,l){var t;f&&(t=h?f(b,g,h,l):f(b));if(void 0!==t)return t;if(!L(b))return b;if(g=Ma(b)){if(t=H(b),!d)return A(b,t)}else{var v=ra(b),C="[object Function]"==v||"[object GeneratorFunction]"==v;if(Ta(b))return x(b,d);if("[object Object]"==v||"[object Arguments]"==v||C&&!h){if(n(b))return h?
b:{};t=G(C?{}:b);if(!d)return E(b,ea(t,b))}else{if(!J[v])return h?b:{};t=P(b,v,w,d)}}l||(l=new Pa);if(h=l.get(b))return h;l.set(b,t);if(!g)var u=c?y(b,N,Ia):N(b);p(u||b,function(g,h){u&&(h=g,g=b[h]);r(t,h,w(g,d,c,f,h,b,l))});return t}function y(b,d,c){d=d(b);if(!Ma(b)){b=c(b);c=-1;for(var f=b.length,g=d.length;++c<f;)d[g+c]=b[c]}return d}function x(b,d){if(d)return b.slice();d=new b.constructor(b.length);b.copy(d);return d}function z(b){var d=new b.constructor(b.byteLength);(new ca(d)).set(new ca(b));
return d}function A(b,d){var c=-1,f=b.length;for(d||(d=Array(f));++c<f;)d[c]=b[c];return d}function F(b,d,c,f){c||(c={});for(var g=-1,h=d.length;++g<h;){var l=d[g],p=f?f(c[l],b[l],l,c,b):void 0;r(c,l,void 0===p?b[l]:p)}return c}function E(b,d){return F(b,Ia(b),d)}function B(b,d){b=b.__data__;var c=typeof d;return("string"==c||"number"==c||"symbol"==c||"boolean"==c?"__proto__"!==d:null===d)?b["string"==typeof d?"string":"hash"]:b.map}function D(b,d){b=null==b?void 0:b[d];d=!L(b)||fa&&fa in b?!1:(O(b)||
n(b)?Y:S).test(Nc(b));return d?b:void 0}function H(b){var d=b.length,c=b.constructor(d);d&&"string"==typeof b[0]&&R.call(b,"index")&&(c.index=b.index,c.input=b.input);return c}function G(b){"function"!=typeof b.constructor||Ei(b)?b={}:(b=ha(b),b=L(b)?ja(b):{});return b}function P(b,d,c,h){var l=b.constructor;switch(d){case "[object ArrayBuffer]":return z(b);case "[object Boolean]":case "[object Date]":return new l(+b);case "[object DataView]":return d=h?z(b.buffer):b.buffer,new b.constructor(d,b.byteOffset,
b.byteLength);case "[object Float32Array]":case "[object Float64Array]":case "[object Int8Array]":case "[object Int16Array]":case "[object Int32Array]":case "[object Uint8Array]":case "[object Uint8ClampedArray]":case "[object Uint16Array]":case "[object Uint32Array]":return d=h?z(b.buffer):b.buffer,new b.constructor(d,b.byteOffset,b.length);case "[object Map]":return d=h?c(v(b),!0):v(b),t(d,f,new b.constructor);case "[object Number]":case "[object String]":return new l(b);case "[object RegExp]":return d=
new b.constructor(b.source,Q.exec(b)),d.lastIndex=b.lastIndex,d;case "[object Set]":return d=h?c(u(b),!0):u(b),t(d,g,new b.constructor);case "[object Symbol]":return va?Object(va.call(b)):{}}}function Ei(b){var d=b&&b.constructor;return b===("function"==typeof d&&d.prototype||V)}function Nc(b){if(null!=b){try{return aa.call(b)}catch(Aa){}return b+""}return""}function Fi(b){var d;if(d=null!=b)d=b.length,d="number"==typeof d&&-1<d&&0==d%1&&9007199254740991>=d;return d&&!O(b)}function O(b){b=L(b)?ba.call(b):
"";return"[object Function]"==b||"[object GeneratorFunction]"==b}function L(b){var d=typeof b;return!!b&&("object"==d||"function"==d)}function N(b){if(Fi(b)){var d;(d=Ma(b))||(d=!!b&&"object"==typeof b&&Fi(b)&&R.call(b,"callee")&&(!pa.call(b,"callee")||"[object Arguments]"==ba.call(b)));if(d){d=b.length;for(var c=String,f=-1,g=Array(d);++f<d;)g[f]=c(f);d=g}else d=[];c=d.length;f=!!c;for(var h in b){if(!(g=!R.call(b,h))&&(g=f)&&!(g="length"==h)){g=h;var l=c;l=null==l?9007199254740991:l;g=!!l&&("number"==
typeof g||W.test(g))&&-1<g&&0==g%1&&g<l}g||d.push(h)}b=d}else if(Ei(b)){h=[];for(d in Object(b))R.call(b,d)&&"constructor"!=d&&h.push(d);b=h}else b=sa(b);return b}function K(){return[]}function M(){return!1}var Q=/\w*$/,S=/^\[object .+?Constructor\]$/,W=/^(?:0|[1-9]\d*)$/,J={};J["[object Arguments]"]=J["[object Array]"]=J["[object ArrayBuffer]"]=J["[object DataView]"]=J["[object Boolean]"]=J["[object Date]"]=J["[object Float32Array]"]=J["[object Float64Array]"]=J["[object Int8Array]"]=J["[object Int16Array]"]=
J["[object Int32Array]"]=J["[object Map]"]=J["[object Number]"]=J["[object Object]"]=J["[object RegExp]"]=J["[object Set]"]=J["[object String]"]=J["[object Symbol]"]=J["[object Uint8Array]"]=J["[object Uint8ClampedArray]"]=J["[object Uint16Array]"]=J["[object Uint32Array]"]=!0;J["[object Error]"]=J["[object Function]"]=J["[object WeakMap]"]=!1;var U="object"==typeof self&&self&&self.Object===Object&&self;b="object"==typeof b&&b&&b.Object===Object&&b||U||Function("return this")();var T=(U="object"==
typeof c&&c&&!c.nodeType&&c)&&"object"==typeof d&&d&&!d.nodeType&&d;U=T&&T.exports===U;T=Array.prototype;var X=Function.prototype,V=Object.prototype,I=b["__core-js_shared__"],fa=function(){var b=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),aa=X.toString,R=V.hasOwnProperty,ba=V.toString,Y=RegExp("^"+aa.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");X=U?b.Buffer:void 0;U=b.Symbol;var ca=
b.Uint8Array,ha=C(Object.getPrototypeOf,Object),ja=Object.create,pa=V.propertyIsEnumerable,Z=T.splice;T=Object.getOwnPropertySymbols;X=X?X.isBuffer:void 0;var sa=C(Object.keys,Object),ia=D(b,"DataView"),ta=D(b,"Map"),da=D(b,"Promise"),ua=D(b,"Set");b=D(b,"WeakMap");var la=D(Object,"create"),xa=Nc(ia),oa=Nc(ta),wa=Nc(da),qa=Nc(ua),ya=Nc(b),va=(U=U?U.prototype:void 0)?U.valueOf:void 0;m.prototype.clear=function(){this.__data__=la?la(null):{}};m.prototype["delete"]=function(b){return this.has(b)&&delete this.__data__[b]};
m.prototype.get=function(b){var d=this.__data__;return la?(b=d[b],"__lodash_hash_undefined__"===b?void 0:b):R.call(d,b)?d[b]:void 0};m.prototype.has=function(b){var d=this.__data__;return la?void 0!==d[b]:R.call(d,b)};m.prototype.set=function(b,d){this.__data__[b]=la&&void 0===d?"__lodash_hash_undefined__":d;return this};k.prototype.clear=function(){this.__data__=[]};k.prototype["delete"]=function(b){var d=this.__data__;b=na(d,b);if(0>b)return!1;b==d.length-1?d.pop():Z.call(d,b,1);return!0};k.prototype.get=
function(b){var d=this.__data__;b=na(d,b);return 0>b?void 0:d[b][1]};k.prototype.has=function(b){return-1<na(this.__data__,b)};k.prototype.set=function(b,d){var c=this.__data__,f=na(c,b);0>f?c.push([b,d]):c[f][1]=d;return this};q.prototype.clear=function(){this.__data__={hash:new m,map:new (ta||k),string:new m}};q.prototype["delete"]=function(b){return B(this,b)["delete"](b)};q.prototype.get=function(b){return B(this,b).get(b)};q.prototype.has=function(b){return B(this,b).has(b)};q.prototype.set=
function(b,d){B(this,b).set(b,d);return this};Pa.prototype.clear=function(){this.__data__=new k};Pa.prototype["delete"]=function(b){return this.__data__["delete"](b)};Pa.prototype.get=function(b){return this.__data__.get(b)};Pa.prototype.has=function(b){return this.__data__.has(b)};Pa.prototype.set=function(b,d){var c=this.__data__;if(c instanceof k){c=c.__data__;if(!ta||199>c.length)return c.push([b,d]),this;c=this.__data__=new q(c)}c.set(b,d);return this};var Ia=T?C(T,Object):K,ra=function(b){return ba.call(b)};
if(ia&&"[object DataView]"!=ra(new ia(new ArrayBuffer(1)))||ta&&"[object Map]"!=ra(new ta)||da&&"[object Promise]"!=ra(da.resolve())||ua&&"[object Set]"!=ra(new ua)||b&&"[object WeakMap]"!=ra(new b))ra=function(b){var d=ba.call(b);if(b=(b="[object Object]"==d?b.constructor:void 0)?Nc(b):void 0)switch(b){case xa:return"[object DataView]";case oa:return"[object Map]";case wa:return"[object Promise]";case qa:return"[object Set]";case ya:return"[object WeakMap]"}return d};var Ma=Array.isArray,Ta=X||M;
d.exports=function(b){return w(b,!0,!0)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],37:[function(b,d,c){b="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profileEnd time timeEnd trace warn".split(" ");c=b.length;for(var f=function(){},h={};c--;)h[b[c]]=f;d.exports=h},{}],38:[function(b,d,c){function f(b){if(b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(b)){var d=
parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case "years":case "year":case "y":return d*l;case "days":case "day":case "d":return 864E5*d;case "hours":case "hour":case "h":return 36E5*d;case "minutes":case "minute":case "m":return 6E4*d;case "seconds":case "second":case "s":return 1E3*d;case "ms":return d}}}function h(b,d,c){if(!(b<d))return b<1.5*d?Math.floor(b/d)+" "+c:Math.ceil(b/d)+" "+c+"s"}var l=315576E5;d.exports=function(b,d){d=d||{};return"string"==typeof b?f(b):d.long?h(b,864E5,"day")||
h(b,36E5,"hour")||h(b,6E4,"minute")||h(b,1E3,"second")||b+" ms":864E5<=b?Math.round(b/864E5)+"d":36E5<=b?Math.round(b/36E5)+"h":6E4<=b?Math.round(b/6E4)+"m":1E3<=b?Math.round(b/1E3)+"s":b+"ms"}},{}],39:[function(b,d,c){var f=Object.prototype.hasOwnProperty;c.keys=Object.keys||function(b){var d=[],c;for(c in b)f.call(b,c)&&d.push(c);return d};c.values=function(b){var d=[],c;for(c in b)f.call(b,c)&&d.push(b[c]);return d};c.merge=function(b,d){for(var c in d)f.call(d,c)&&(b[c]=d[c]);return b};c.length=
function(b){return c.keys(b).length};c.isEmpty=function(b){return 0==c.length(b)}},{}],40:[function(b,d,c){(function(b){var c=/^[\],:{}\s]*$/,f=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,g=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,t=/(?:^|:|,)(?:\s*\[)+/g,n=/^\s+/,v=/\s+$/;d.exports=function(d){if("string"!=typeof d||!d)return null;d=d.replace(n,"").replace(v,"");if(b.JSON&&JSON.parse)return JSON.parse(d);if(c.test(d.replace(f,"@").replace(g,"]").replace(t,"")))return(new Function("return "+
d))()}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],41:[function(b,d,c){c.encode=function(b){var d="",c;for(c in b)b.hasOwnProperty(c)&&(d.length&&(d+="&"),d+=encodeURIComponent(c)+"="+encodeURIComponent(b[c]));return d};c.decode=function(b){var d={};b=b.split("&");for(var c=0,f=b.length;c<f;c++){var g=b[c].split("=");d[decodeURIComponent(g[0])]=decodeURIComponent(g[1])}return d}},{}],42:[function(b,d,c){var f=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
h="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");d.exports=function(b){b=f.exec(b||"");for(var d={},c=14;c--;)d[h[c]]=b[c]||"";return d}},{}],43:[function(b,d,c){function f(){throw Error("setTimeout has not been defined");}function h(){throw Error("clearTimeout has not been defined");}function l(b){if(u===setTimeout)return setTimeout(b,0);if((u===f||!u)&&setTimeout)return u=setTimeout,setTimeout(b,0);try{return u(b,0)}catch(ea){try{return u.call(null,
b,0)}catch(Tk){return u.call(this,b,0)}}}function p(b){if(m===clearTimeout)return clearTimeout(b);if((m===h||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(b);try{return m(b)}catch(ea){try{return m.call(null,b)}catch(Tk){return m.call(this,b)}}}function t(){q&&Pa&&(q=!1,Pa.length?k=Pa.concat(k):r=-1,k.length&&n())}function n(){if(!q){var b=l(t);q=!0;for(var d=k.length;d;){Pa=k;for(k=[];++r<d;)Pa&&Pa[r].run();r=-1;d=k.length}Pa=null;q=!1;p(b)}}function v(b,d){this.fun=b;this.array=d}function C(){}
b=d.exports={};try{var u="function"===typeof setTimeout?setTimeout:f}catch(na){u=f}try{var m="function"===typeof clearTimeout?clearTimeout:h}catch(na){m=h}var k=[],q=!1,Pa,r=-1;b.nextTick=function(b){var d=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)d[c-1]=arguments[c];k.push(new v(b,d));1!==k.length||q||l(n)};v.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=C;b.addListener=
C;b.once=C;b.off=C;b.removeListener=C;b.removeAllListeners=C;b.emit=C;b.prependListener=C;b.prependOnceListener=C;b.listeners=function(b){return[]};b.binding=function(b){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(b){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}],44:[function(b,d,c){function f(b,d){var c=this,f;l.call(this);b=b||{};b.iceServers=b.iceServers||[];this.enableChromeNativeSimulcast=!1;d&&d.optional&&
window.chrome&&null===navigator.appVersion.match(/Chromium\//)&&d.optional.forEach(function(b){b.enableChromeNativeSimulcast&&(c.enableChromeNativeSimulcast=!0)});this.enableMultiStreamHacks=!1;d&&d.optional&&window.chrome&&d.optional.forEach(function(b){b.enableMultiStreamHacks&&(c.enableMultiStreamHacks=!0)});this.restrictBandwidth=0;d&&d.optional&&d.optional.forEach(function(b){b.andyetRestrictBandwidth&&(c.restrictBandwidth=b.andyetRestrictBandwidth)});this.batchIceCandidates=0;d&&d.optional&&
d.optional.forEach(function(b){b.andyetBatchIce&&(c.batchIceCandidates=b.andyetBatchIce)});this.batchedIceCandidates=[];d&&d.optional&&window.chrome&&d.optional.forEach(function(b){b.andyetFasterICE&&(c.eliminateDuplicateCandidates=b.andyetFasterICE)});d&&d.optional&&d.optional.forEach(function(b){b.andyetDontSignalCandidates&&(c.dontSignalCandidates=b.andyetDontSignalCandidates)});this.assumeSetLocalSuccess=!1;d&&d.optional&&d.optional.forEach(function(b){b.andyetAssumeSetLocalSuccess&&(c.assumeSetLocalSuccess=
b.andyetAssumeSetLocalSuccess)});window.navigator.mozGetUserMedia&&d&&d.optional&&(this.wtFirefox=0,d.optional.forEach(function(b){b.andyetFirefoxMakesMeSad&&(c.wtFirefox=b.andyetFirefoxMakesMeSad,0<c.wtFirefox&&(c.firefoxcandidatebuffer=[]))}));this.pc=new RTCPeerConnection(b,d);this.getLocalStreams="function"===typeof this.pc.getLocalStreams?this.pc.getLocalStreams.bind(this.pc):function(){return[]};this.getSenders="function"===typeof this.pc.getSenders?this.pc.getSenders.bind(this.pc):function(){return[]};
this.getRemoteStreams="function"===typeof this.pc.getRemoteStreams?this.pc.getRemoteStreams.bind(this.pc):function(){return[]};this.getReceivers="function"===typeof this.pc.getReceivers?this.pc.getReceivers.bind(this.pc):function(){return[]};this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=function(b){"function"===typeof c.pc.removeStream?c.pc.removeStream.apply(c.pc,arguments):"function"===typeof c.pc.removeTrack&&b.getTracks().forEach(function(b){c.pc.removeTrack(b)})};"function"===
typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc));this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onremovetrack=this.emit.bind(this,"removeTrack");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);
this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:!1,sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};this.iceCredentials={local:{},remote:{}};for(f in b)this.config[f]=b[f];if(this.config.debug)this.on("*",function(){(b.logger||console).log("PeerConnection event:",arguments)});this.hadRemoteIPv6Candidate=this.hadLocalIPv6Candidate=this.hadRemoteRelayCandidate=this.hadLocalRelayCandidate=this.hadRemoteStunCandidate=
this.hadLocalStunCandidate=!1;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}c=b("util");var h=b("sdp-jingle-json"),l=b("wildemitter"),p=b("lodash.clonedeep");c.inherits(f,l);Object.defineProperty(f.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(f.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});f.prototype._role=function(){return this.isInitiator?"initiator":"responder"};f.prototype.addStream=
function(b){this.localStream=b;this.pc.addStream(b)};f.prototype._checkLocalCandidate=function(b){b=h.toCandidateJSON(b);"srflx"==b.type?this.hadLocalStunCandidate=!0:"relay"==b.type&&(this.hadLocalRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)};f.prototype._checkRemoteCandidate=function(b){b=h.toCandidateJSON(b);"srflx"==b.type?this.hadRemoteStunCandidate=!0:"relay"==b.type&&(this.hadRemoteRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)};f.prototype.processIce=
function(b,d){d=d||function(){};var c=this;if("closed"===this.pc.signalingState)return d();if(b.contents||b.jingle&&b.jingle.contents){var f=this.remoteDescription.contents.map(function(b){return b.name});(b.contents||b.jingle.contents).forEach(function(b){var g=b.transport||{},l=g.candidates||[],p=f.indexOf(b.name),t=b.name,n=c.remoteDescription.contents.find(function(d){return d.name===b.name}),v=function(){l.forEach(function(b){b=h.toCandidateSDP(b);c.pc.addIceCandidate(new RTCIceCandidate({candidate:b,
sdpMLineIndex:p,sdpMid:t}),function(){},function(b){c.emit("error",b)});c._checkRemoteCandidate(b)});d()};c.iceCredentials.remote[b.name]&&g.ufrag&&c.iceCredentials.remote[b.name].ufrag!==g.ufrag?n?(n.transport.ufrag=g.ufrag,n.transport.pwd=g.pwd,g={type:"offer",jingle:c.remoteDescription},g.sdp=h.toSessionSDP(g.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"}),c.pc.setRemoteDescription(new RTCSessionDescription(g),function(){v()},function(b){c.emit("error",b)})):c.emit("error",
"ice restart failed to find matching content"):v()})}else{b.candidate&&0!==b.candidate.candidate.indexOf("a=")&&(b.candidate.candidate="a="+b.candidate.candidate);if(this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(b.candidate),d();c.pc.addIceCandidate(new RTCIceCandidate(b.candidate),function(){},function(b){c.emit("error",b)});c._checkRemoteCandidate(b.candidate.candidate);d()}};f.prototype.offer=
function(b,d){var c=this,f=2===arguments.length,g=f&&b?b:{offerToReceiveAudio:1,offerToReceiveVideo:1};d=(d=f?d:b)||function(){};if("closed"===this.pc.signalingState)return d("Already closed");this.pc.createOffer(function(b){var f={type:"offer",sdp:b.sdp};c.assumeSetLocalSuccess&&(c.emit("offer",f),d(null,f));c._candidateBuffer=[];c.pc.setLocalDescription(b,function(){if(c.config.useJingle){var g=h.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"});g.sid=c.config.sid;c.localDescription=g;
g.contents.forEach(function(b){var d=b.transport||{};d.ufrag&&(c.iceCredentials.local[b.name]={ufrag:d.ufrag,pwd:d.pwd})});f.jingle=g}f.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&c._checkLocalCandidate(b)});c.assumeSetLocalSuccess||(c.emit("offer",f),d(null,f))},function(b){c.emit("error",b);d(b)})},function(b){c.emit("error",b);d(b)},g)};f.prototype.handleOffer=function(b,d){d=d||function(){};var c=this;b.type="offer";if(b.jingle){this.enableChromeNativeSimulcast&&b.jingle.contents.forEach(function(b){"video"===
b.name&&(b.application.googConferenceFlag=!0)});this.enableMultiStreamHacks&&b.jingle.contents.forEach(function(b){if("video"===b.name){var d=b.application.sources||[];if(0===d.length||"3735928559"!==d[0].ssrc)d.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),b.application.sources=d}});if(0<c.restrictBandwidth&&2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name){var f=b.jingle.contents[1];f.application&&f.application.bandwidth&&
f.application.bandwidth.bandwidth||(b.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:c.restrictBandwidth.toString()},b.sdp=h.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"outgoing"}))}b.jingle.contents.forEach(function(b){var d=b.transport||{};d.ufrag&&(c.iceCredentials.remote[b.name]={ufrag:d.ufrag,pwd:d.pwd})});b.sdp=h.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"});c.remoteDescription=b.jingle}b.sdp.split("\r\n").forEach(function(b){0===
b.indexOf("a=candidate:")&&c._checkRemoteCandidate(b)});c.pc.setRemoteDescription(new RTCSessionDescription(b),function(){d()},d)};f.prototype.answerAudioOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},b)};f.prototype.answerBroadcastOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},b)};f.prototype.answer=function(b,d){var c=2===arguments.length;this._answer(c&&b?b:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},
c?d:b)};f.prototype.handleAnswer=function(b,d){d=d||function(){};var c=this;b.jingle&&(b.sdp=h.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"}),c.remoteDescription=b.jingle,b.jingle.contents.forEach(function(b){var d=b.transport||{};d.ufrag&&(c.iceCredentials.remote[b.name]={ufrag:d.ufrag,pwd:d.pwd})}));b.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&c._checkRemoteCandidate(b)});c.pc.setRemoteDescription(new RTCSessionDescription(b),function(){c.wtFirefox&&
window.setTimeout(function(){c.firefoxcandidatebuffer.forEach(function(b){c.pc.addIceCandidate(new RTCIceCandidate(b),function(){},function(b){c.emit("error",b)});c._checkRemoteCandidate(b.candidate)});c.firefoxcandidatebuffer=null},c.wtFirefox);d(null)},d)};f.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};f.prototype._answer=function(b,d){d=d||function(){};var c=this;if(!this.pc.remoteDescription)throw Error("remoteDescription not set");
if("closed"===this.pc.signalingState)return d("Already closed");c.pc.createAnswer(function(b){var f=[];if(c.enableChromeNativeSimulcast&&(b.jingle=h.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"}),2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name)){var g=b.jingle.contents[1].application.sourceGroups||[],l=!1;g.forEach(function(b){"SIM"==b.semantics&&(l=!0)});if(!l&&b.jingle.contents[1].application.sources.length){var t=JSON.parse(JSON.stringify(b.jingle.contents[1].application.sources[0]));
t.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(t);f.push(b.jingle.contents[1].application.sources[0].ssrc);f.push(t.ssrc);g.push({semantics:"SIM",sources:f});f=JSON.parse(JSON.stringify(t));f.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(f);g.push({semantics:"FID",sources:[t.ssrc,f.ssrc]});b.jingle.contents[1].application.sourceGroups=g;b.sdp=h.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),
direction:"outgoing"})}}var n={type:"answer",sdp:b.sdp};c.assumeSetLocalSuccess&&(g=p(n),c.emit("answer",g),d(null,g));c._candidateBuffer=[];c.pc.setLocalDescription(b,function(){if(c.config.useJingle){var f=h.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"});f.sid=c.config.sid;c.localDescription=f;n.jingle=f}c.enableChromeNativeSimulcast&&(n.jingle||(n.jingle=h.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"})),n.jingle.contents[1].application.sources.forEach(function(b,d){b.parameters=
b.parameters.map(function(b){"msid"===b.key&&(b.value+="-"+Math.floor(d/2));return b})}),n.sdp=h.toSessionSDP(n.jingle,{sid:c.sdpSessionID,role:c._role(),direction:"outgoing"}));n.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&c._checkLocalCandidate(b)});c.assumeSetLocalSuccess||(f=p(n),c.emit("answer",f),d(null,f))},function(b){c.emit("error",b);d(b)})},function(b){c.emit("error",b);d(b)},b)};f.prototype._onIce=function(b){var d=this;if(b.candidate){if(!this.dontSignalCandidates){b=
b.candidate;var c={candidate:{candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex}};this._checkLocalCandidate(b.candidate);var f=h.toCandidateJSON(b.candidate);if(this.eliminateDuplicateCandidates&&"relay"===f.type){var g=this._candidateBuffer.filter(function(b){return"relay"===b.type}).map(function(b){return b.foundation+":"+b.component});var l=g.indexOf(f.foundation+":"+f.component);if(-1<l&&f.priority>>24>=g[l].priority>>24)return}if("max-bundle"===this.config.bundlePolicy&&(g=
this._candidateBuffer.filter(function(b){return f.type===b.type}).map(function(b){return b.address+":"+b.port}),l=g.indexOf(f.address+":"+f.port),-1<l))return;if("require"!==this.config.rtcpMuxPolicy||"2"!==f.component){this._candidateBuffer.push(f);if(d.config.useJingle&&(b.sdpMid||(b.sdpMid=d.pc.remoteDescription&&"offer"===d.pc.remoteDescription.type?d.remoteDescription.contents[b.sdpMLineIndex].name:d.localDescription.contents[b.sdpMLineIndex].name),d.iceCredentials.local[b.sdpMid]||h.toSessionJSON(d.pc.localDescription.sdp,
{role:d._role(),direction:"outgoing"}).contents.forEach(function(b){var c=b.transport||{};c.ufrag&&(d.iceCredentials.local[b.name]={ufrag:c.ufrag,pwd:c.pwd})}),c.jingle={contents:[{name:b.sdpMid,creator:d._role(),transport:{transportType:"iceUdp",ufrag:d.iceCredentials.local[b.sdpMid].ufrag,pwd:d.iceCredentials.local[b.sdpMid].pwd,candidates:[f]}}]},0<d.batchIceCandidates)){0===d.batchedIceCandidates.length&&window.setTimeout(function(){var b={};d.batchedIceCandidates.forEach(function(d){d=d.contents[0];
b[d.name]||(b[d.name]=d);b[d.name].transport.candidates.push(d.transport.candidates[0])});var c={jingle:{contents:[]}};Object.keys(b).forEach(function(d){c.jingle.contents.push(b[d])});d.batchedIceCandidates=[];d.emit("ice",c)},d.batchIceCandidates);d.batchedIceCandidates.push(c.jingle);return}this.emit("ice",c)}}}else this.emit("endOfCandidates")};f.prototype._onDataChannel=function(b){b=b.channel;this._remoteDataChannels.push(b);this.emit("addChannel",b)};f.prototype.createDataChannel=function(b,
d){b=this.pc.createDataChannel(b,d);this._localDataChannels.push(b);return b};f.prototype.getStats=function(){if("function"===typeof arguments[0]){var b=arguments[0];this.pc.getStats().then(function(d){b(null,d)},function(d){b(d)})}else return this.pc.getStats.apply(this.pc,arguments)};d.exports=f},{"lodash.clonedeep":36,"sdp-jingle-json":45,util:63,wildemitter:65}],45:[function(b,d,c){var f=b("./lib/tosdp"),h=b("./lib/tojson");c.toIncomingSDPOffer=function(b){return f.toSessionSDP(b,{role:"responder",
direction:"incoming"})};c.toOutgoingSDPOffer=function(b){return f.toSessionSDP(b,{role:"initiator",direction:"outgoing"})};c.toIncomingSDPAnswer=function(b){return f.toSessionSDP(b,{role:"initiator",direction:"incoming"})};c.toOutgoingSDPAnswer=function(b){return f.toSessionSDP(b,{role:"responder",direction:"outgoing"})};c.toIncomingMediaSDPOffer=function(b){return f.toMediaSDP(b,{role:"responder",direction:"incoming"})};c.toOutgoingMediaSDPOffer=function(b){return f.toMediaSDP(b,{role:"initiator",
direction:"outgoing"})};c.toIncomingMediaSDPAnswer=function(b){return f.toMediaSDP(b,{role:"initiator",direction:"incoming"})};c.toOutgoingMediaSDPAnswer=function(b){return f.toMediaSDP(b,{role:"responder",direction:"outgoing"})};c.toCandidateSDP=f.toCandidateSDP;c.toMediaSDP=f.toMediaSDP;c.toSessionSDP=f.toSessionSDP;c.toIncomingJSONOffer=function(b,d){return h.toSessionJSON(b,{role:"responder",direction:"incoming",creators:d})};c.toOutgoingJSONOffer=function(b,d){return h.toSessionJSON(b,{role:"initiator",
direction:"outgoing",creators:d})};c.toIncomingJSONAnswer=function(b,d){return h.toSessionJSON(b,{role:"initiator",direction:"incoming",creators:d})};c.toOutgoingJSONAnswer=function(b,d){return h.toSessionJSON(b,{role:"responder",direction:"outgoing",creators:d})};c.toIncomingMediaJSONOffer=function(b,d){return h.toMediaJSON(b,{role:"responder",direction:"incoming",creator:d})};c.toOutgoingMediaJSONOffer=function(b,d){return h.toMediaJSON(b,{role:"initiator",direction:"outgoing",creator:d})};c.toIncomingMediaJSONAnswer=
function(b,d){return h.toMediaJSON(b,{role:"initiator",direction:"incoming",creator:d})};c.toOutgoingMediaJSONAnswer=function(b,d){return h.toMediaJSON(b,{role:"responder",direction:"outgoing",creator:d})};c.toCandidateJSON=h.toCandidateJSON;c.toMediaJSON=h.toMediaJSON;c.toSessionJSON=h.toSessionJSON},{"./lib/tojson":48,"./lib/tosdp":49}],46:[function(b,d,c){c.lines=function(b){return b.split("\r\n").filter(function(b){return 0<b.length})};c.findLine=function(b,d,c){for(var f=b.length,g=0;g<d.length;g++)if(d[g].substr(0,
f)===b)return d[g];if(!c)return!1;for(d=0;d<c.length;d++)if(c[d].substr(0,f)===b)return c[d];return!1};c.findLines=function(b,d,c){for(var f=[],g=b.length,h=0;h<d.length;h++)d[h].substr(0,g)===b&&f.push(d[h]);if(f.length||!c)return f;for(d=0;d<c.length;d++)c[d].substr(0,g)===b&&f.push(c[d]);return f};c.mline=function(b){b=b.substr(2).split(" ");for(var d={media:b[0],port:b[1],proto:b[2],formats:[]},c=3;c<b.length;c++)b[c]&&d.formats.push(b[c]);return d};c.rtpmap=function(b){b=b.substr(9).split(" ");
var d={id:b.shift()};b=b[0].split("/");d.name=b[0];d.clockrate=b[1];d.channels=3==b.length?b[2]:"1";return d};c.sctpmap=function(b){b=b.substr(10).split(" ");return{number:b.shift(),protocol:b.shift(),streams:b.shift()}};c.fmtp=function(b){for(var d,c=b.substr(b.indexOf(" ")+1).split(";"),f=[],g=0;g<c.length;g++)d=c[g].split("="),b=d[0].trim(),d=d[1],b&&d?f.push({key:b,value:d}):b&&f.push({key:"",value:b});return f};c.crypto=function(b){b=b.substr(9).split(" ");return{tag:b[0],cipherSuite:b[1],keyParams:b[2],
sessionParams:b.slice(3).join(" ")}};c.fingerprint=function(b){b=b.substr(14).split(" ");return{hash:b[0],value:b[1]}};c.extmap=function(b){b=b.substr(9).split(" ");var d={},c=b.shift(),f=c.indexOf("/");0<=f?(d.id=c.substr(0,f),d.senders=c.substr(f+1)):(d.id=c,d.senders="sendrecv");d.uri=b.shift()||"";return d};c.rtcpfb=function(b){b=b.substr(10).split(" ");var d={};d.id=b.shift();d.type=b.shift();"trr-int"===d.type?d.value=b.shift():d.subtype=b.shift()||"";d.parameters=b;return d};c.candidate=function(b){b=
0===b.indexOf("a=candidate:")?b.substring(12).split(" "):b.substring(10).split(" ");for(var d={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:b[3],ip:b[4],port:b[5],type:b[7],generation:"0"},c=8;c<b.length;c+=2)"raddr"===b[c]?d.relAddr=b[c+1]:"rport"===b[c]?d.relPort=b[c+1]:"generation"===b[c]?d.generation=b[c+1]:"tcptype"===b[c]&&(d.tcpType=b[c+1]);d.network="1";return d};c.sourceGroups=function(b){for(var d=[],c=0;c<b.length;c++){var f=b[c].substr(13).split(" ");d.push({semantics:f.shift(),
sources:f})}return d};c.sources=function(b){for(var d=[],c={},f=0;f<b.length;f++){var g=b[f].substr(7).split(" "),n=g.shift();if(!c[n]){var v={ssrc:n,parameters:[]};d.push(v);c[n]=v}g=g.join(" ").split(":");v=g.shift();g=g.join(":")||null;c[n].parameters.push({key:v,value:g})}return d};c.groups=function(b){for(var d=[],c,f=0;f<b.length;f++)c=b[f].substr(8).split(" "),d.push({semantics:c.shift(),contents:c});return d};c.bandwidth=function(b){b=b.substr(2).split(":");var d={};d.type=b.shift();d.bandwidth=
b.shift();return d};c.msid=function(b){b=b.substr(7);var d=b.split(" ");return{msid:b,mslabel:d[0],label:d[1]}}},{}],47:[function(b,d,c){d.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",
responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],48:[function(b,d,c){var f=b("./senders"),h=b("./parsers"),l=Math.random();c._setIdCounter=function(b){l=b};c.toSessionJSON=function(b,d){var f,g=d.creators||[],l=d.role||"initiator";d=d.direction||"outgoing";
var p=b.split("\r\nm=");for(f=1;f<p.length;f++)p[f]="m="+p[f],f!==p.length-1&&(p[f]+="\r\n");var t=p.shift()+"\r\n",m=h.lines(t);b={};var k=[];for(f=0;f<p.length;f++)k.push(c.toMediaJSON(p[f],t,{role:l,direction:d,creator:g[f]||"initiator"}));b.contents=k;g=h.findLines("a=group:",m);g.length&&(b.groups=h.groups(g));return b};c.toMediaJSON=function(b,d,g){var l=g.creator||"initiator",p=g.role||"initiator",n=g.direction||"outgoing",t=h.lines(b);b=h.lines(d);d=h.mline(t[0]);l={creator:l,name:d.media,
application:{applicationType:"rtp",media:d.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==d.media&&(l.application={applicationType:"datachannel"},l.transport.sctp=[]);var m=l.application,k=l.transport;if(d=h.findLine("a=mid:",t))l.name=d.substr(6);h.findLine("a=sendrecv",t,b)?l.senders="both":h.findLine("a=sendonly",t,b)?l.senders=f[p][n].sendonly:h.findLine("a=recvonly",t,b)?l.senders=f[p][n].recvonly:
h.findLine("a=inactive",t,b)&&(l.senders="none");if("rtp"==m.applicationType){if(d=h.findLine("b=",t))m.bandwidth=h.bandwidth(d);if(d=h.findLine("a=ssrc:",t))m.ssrc=d.substr(7).split(" ")[0];h.findLines("a=rtpmap:",t).forEach(function(b){var d=h.rtpmap(b);d.parameters=[];d.feedback=[];h.findLines("a=fmtp:"+d.id,t).forEach(function(b){d.parameters=h.fmtp(b)});h.findLines("a=rtcp-fb:"+d.id,t).forEach(function(b){d.feedback.push(h.rtcpfb(b))});m.payloads.push(d)});h.findLines("a=crypto:",t,b).forEach(function(b){m.encryption.push(h.crypto(b))});
h.findLine("a=rtcp-mux",t)&&(m.mux=!0);h.findLines("a=rtcp-fb:*",t).forEach(function(b){m.feedback.push(h.rtcpfb(b))});h.findLines("a=extmap:",t).forEach(function(b){b=h.extmap(b);b.senders=f[p][n][b.senders];m.headerExtensions.push(b)});d=h.findLines("a=ssrc-group:",t);m.sourceGroups=h.sourceGroups(d||[]);d=h.findLines("a=ssrc:",t);var q=m.sources=h.sources(d||[]);if(d=h.findLine("a=msid:",t)){var r=h.msid(d);["msid","mslabel","label"].forEach(function(b){for(var d=0;d<q.length;d++){for(var c=!1,
f=0;f<q[d].parameters.length;f++)q[d].parameters[f].key===b&&(c=!0);c||q[d].parameters.push({key:b,value:r[b]})}})}h.findLine("a=x-google-flag:conference",t,b)&&(m.googConferenceFlag=!0)}d=h.findLines("a=fingerprint:",t,b);var na=h.findLine("a=setup:",t,b);d.forEach(function(b){b=h.fingerprint(b);na&&(b.setup=na.substr(8));k.fingerprints.push(b)});d=h.findLine("a=ice-ufrag:",t,b);g=h.findLine("a=ice-pwd:",t,b);d&&g&&(k.ufrag=d.substr(12),k.pwd=g.substr(10),k.candidates=[],h.findLines("a=candidate:",
t,b).forEach(function(b){k.candidates.push(c.toCandidateJSON(b))}));"datachannel"==m.applicationType&&h.findLines("a=sctpmap:",t).forEach(function(b){b=h.sctpmap(b);k.sctp.push(b)});return l};c.toCandidateJSON=function(b){b=h.candidate(b.split("\r\n")[0]);b.id=(l++).toString(36).substr(0,12);return b}},{"./parsers":46,"./senders":47}],49:[function(b,d,c){var f=b("./senders");c.toSessionSDP=function(b,d){var f=d.sid||b.sid||Date.now(),g=d.time||Date.now(),h=["v=0","o=- "+f+" "+g+" IN IP4 0.0.0.0",
"s=-","t=0 0"];f=b.contents||[];var l=!1;f.forEach(function(b){b.application.sources&&b.application.sources.length&&(l=!0)});l&&h.push("a=msid-semantic: WMS *");(b.groups||[]).forEach(function(b){h.push("a=group:"+b.semantics+" "+b.contents.join(" "))});f.forEach(function(b){h.push(c.toMediaSDP(b,d))});return h.join("\r\n")+"\r\n"};c.toMediaSDP=function(b,d){var g=[],h=d.role||"initiator",l=d.direction||"outgoing",v=b.application;d=b.transport;var C=v.payloads||[],m=d&&d.fingerprints||[],k=[];"datachannel"==
v.applicationType?(k.push("application"),k.push("1"),k.push("DTLS/SCTP"),d.sctp&&d.sctp.forEach(function(b){k.push(b.number)})):(k.push(v.media),k.push("1"),0<m.length?k.push("UDP/TLS/RTP/SAVPF"):v.encryption&&0<v.encryption.length?k.push("RTP/SAVPF"):k.push("RTP/AVPF"),C.forEach(function(b){k.push(b.id)}));g.push("m="+k.join(" "));g.push("c=IN IP4 0.0.0.0");v.bandwidth&&v.bandwidth.type&&v.bandwidth.bandwidth&&g.push("b="+v.bandwidth.type+":"+v.bandwidth.bandwidth);"rtp"==v.applicationType&&g.push("a=rtcp:1 IN IP4 0.0.0.0");
d&&(d.ufrag&&g.push("a=ice-ufrag:"+d.ufrag),d.pwd&&g.push("a=ice-pwd:"+d.pwd),m.forEach(function(b){g.push("a=fingerprint:"+b.hash+" "+b.value);b.setup&&g.push("a=setup:"+b.setup)}),d.sctp&&d.sctp.forEach(function(b){g.push("a=sctpmap:"+b.number+" "+b.protocol+" "+b.streams)}));"rtp"==v.applicationType&&g.push("a="+(f[h][l][b.senders]||"sendrecv"));g.push("a=mid:"+b.name);v.sources&&v.sources.length&&(v.sources[0].parameters||[]).forEach(function(b){"msid"===b.key&&g.push("a=msid:"+b.value)});v.mux&&
g.push("a=rtcp-mux");(v.encryption||[]).forEach(function(b){g.push("a=crypto:"+b.tag+" "+b.cipherSuite+" "+b.keyParams+(b.sessionParams?" "+b.sessionParams:""))});v.googConferenceFlag&&g.push("a=x-google-flag:conference");C.forEach(function(b){var d="a=rtpmap:"+b.id+" "+b.name+"/"+b.clockrate;b.channels&&"1"!=b.channels&&(d+="/"+b.channels);g.push(d);if(b.parameters&&b.parameters.length){d=["a=fmtp:"+b.id];var c=[];b.parameters.forEach(function(b){c.push((b.key?b.key+"=":"")+b.value)});d.push(c.join(";"));
g.push(d.join(" "))}b.feedback&&b.feedback.forEach(function(d){"trr-int"===d.type?g.push("a=rtcp-fb:"+b.id+" trr-int "+(d.value?d.value:"0")):g.push("a=rtcp-fb:"+b.id+" "+d.type+(d.subtype?" "+d.subtype:""))})});v.feedback&&v.feedback.forEach(function(b){"trr-int"===b.type?g.push("a=rtcp-fb:* trr-int "+(b.value?b.value:"0")):g.push("a=rtcp-fb:* "+b.type+(b.subtype?" "+b.subtype:""))});(v.headerExtensions||[]).forEach(function(b){g.push("a=extmap:"+b.id+(b.senders?"/"+f[h][l][b.senders]:"")+" "+b.uri)});
(v.sourceGroups||[]).forEach(function(b){g.push("a=ssrc-group:"+b.semantics+" "+b.sources.join(" "))});(v.sources||[]).forEach(function(b){for(var d=0;d<b.parameters.length;d++){var c=b.parameters[d];g.push("a=ssrc:"+(b.ssrc||v.ssrc)+" "+c.key+(c.value?":"+c.value:""))}});(d.candidates||[]).forEach(function(b){g.push(c.toCandidateSDP(b))});return g.join("\r\n")};c.toCandidateSDP=function(b){var d=[];d.push(b.foundation);d.push(b.component);d.push(b.protocol.toUpperCase());d.push(b.priority);d.push(b.ip);
d.push(b.port);var c=b.type;d.push("typ");d.push(c);("srflx"===c||"prflx"===c||"relay"===c)&&b.relAddr&&b.relPort&&(d.push("raddr"),d.push(b.relAddr),d.push("rport"),d.push(b.relPort));b.tcpType&&"TCP"==b.protocol.toUpperCase()&&(d.push("tcptype"),d.push(b.tcpType));d.push("generation");d.push(b.generation||"0");return"a=candidate:"+d.join(" ")}},{"./senders":47}],50:[function(b,d,c){d.exports=b("./lib/")},{"./lib/":51}],51:[function(b,d,c){function f(b,d){"object"==typeof b&&(d=b,b=void 0);d=d||
{};b=h(b);var c=b.source,f=b.id;d.forceNew||d["force new connection"]||!1===d.multiplex?(t("ignoring socket cache for %s",c),d=p(c,d)):(n[f]||(t("new io instance for %s",c),n[f]=p(c,d)),d=n[f]);return d.socket(b.path)}var h=b("./url"),l=b("socket.io-parser"),p=b("./manager"),t=b("debug")("socket.io-client");d.exports=c=f;var n=c.managers={};c.protocol=l.protocol;c.connect=f;c.Manager=b("./manager");c.Socket=b("./socket")},{"./manager":52,"./socket":54,"./url":55,debug:10,"socket.io-parser":57}],52:[function(b,
d,c){function f(b,d){if(!(this instanceof f))return new f(b,d);b&&"object"==typeof b&&(d=b,b=void 0);d=d||{};d.path=d.path||"/socket.io";this.nsps={};this.subs=[];this.opts=d;this.reconnection(!1!==d.reconnection);this.reconnectionAttempts(d.reconnectionAttempts||Infinity);this.reconnectionDelay(d.reconnectionDelay||1E3);this.reconnectionDelayMax(d.reconnectionDelayMax||5E3);this.randomizationFactor(d.randomizationFactor||.5);this.backoff=new k({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==d.timeout?2E4:d.timeout);this.readyState="closed";this.uri=b;this.connected=[];this.encoding=!1;this.packetBuffer=[];this.encoder=new p.Encoder;this.decoder=new p.Decoder;(this.autoConnect=!1!==d.autoConnect)&&this.open()}b("./url");var h=b("engine.io-client"),l=b("./socket");c=b("component-emitter");var p=b("socket.io-parser"),t=b("./on"),n=b("component-bind");b("object-component");var v=b("debug")("socket.io-client:manager"),m=b("indexof"),
k=b("backo2");d.exports=f;f.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var b in this.nsps)this.nsps[b].emit.apply(this.nsps[b],arguments)};f.prototype.updateSocketIds=function(){for(var b in this.nsps)this.nsps[b].id=this.engine.id};c(f.prototype);f.prototype.reconnection=function(b){if(!arguments.length)return this._reconnection;this._reconnection=!!b;return this};f.prototype.reconnectionAttempts=function(b){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=
b;return this};f.prototype.reconnectionDelay=function(b){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=b;this.backoff&&this.backoff.setMin(b);return this};f.prototype.randomizationFactor=function(b){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=b;this.backoff&&this.backoff.setJitter(b);return this};f.prototype.reconnectionDelayMax=function(b){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=b;this.backoff&&
this.backoff.setMax(b);return this};f.prototype.timeout=function(b){if(!arguments.length)return this._timeout;this._timeout=b;return this};f.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};f.prototype.open=f.prototype.connect=function(b){v("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;v("opening %s",this.uri);var d=this.engine=h(this.uri,this.opts),c=this;this.readyState="opening";this.skipReconnect=
!1;var f=t(d,"open",function(){c.onopen();b&&b()}),g=t(d,"error",function(d){v("connect_error");c.cleanup();c.readyState="closed";c.emitAll("connect_error",d);if(b){var f=Error("Connection error");f.data=d;b(f)}else c.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;v("connect attempt will timeout after %d",l);var p=setTimeout(function(){v("connect attempt timed out after %d",l);f.destroy();d.close();d.emit("error","timeout");c.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(p)}})}this.subs.push(f);
this.subs.push(g);return this};f.prototype.onopen=function(){v("open");this.cleanup();this.readyState="open";this.emit("open");var b=this.engine;this.subs.push(t(b,"data",n(this,"ondata")));this.subs.push(t(this.decoder,"decoded",n(this,"ondecoded")));this.subs.push(t(b,"error",n(this,"onerror")));this.subs.push(t(b,"close",n(this,"onclose")))};f.prototype.ondata=function(b){this.decoder.add(b)};f.prototype.ondecoded=function(b){this.emit("packet",b)};f.prototype.onerror=function(b){v("error",b);
this.emitAll("error",b)};f.prototype.socket=function(b){var d=this.nsps[b];if(!d){d=new l(this,b);this.nsps[b]=d;var c=this;d.on("connect",function(){d.id=c.engine.id;~m(c.connected,d)||c.connected.push(d)})}return d};f.prototype.destroy=function(b){b=m(this.connected,b);~b&&this.connected.splice(b,1);this.connected.length||this.close()};f.prototype.packet=function(b){v("writing packet %j",b);var d=this;d.encoding?d.packetBuffer.push(b):(d.encoding=!0,this.encoder.encode(b,function(b){for(var c=0;c<
b.length;c++)d.engine.write(b[c]);d.encoding=!1;d.processPacketQueue()}))};f.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var b=this.packetBuffer.shift();this.packet(b)}};f.prototype.cleanup=function(){for(var b;b=this.subs.shift();)b.destroy();this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};f.prototype.close=f.prototype.disconnect=function(){this.skipReconnect=!0;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};
f.prototype.onclose=function(b){v("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",b);this._reconnection&&!this.skipReconnect&&this.reconnect()};f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var b=this;if(this.backoff.attempts>=this._reconnectionAttempts)v("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var d=this.backoff.duration();v("will wait %dms before reconnect attempt",
d);this.reconnecting=!0;var c=setTimeout(function(){b.skipReconnect||(v("attempting reconnect"),b.emitAll("reconnect_attempt",b.backoff.attempts),b.emitAll("reconnecting",b.backoff.attempts),b.skipReconnect||b.open(function(d){d?(v("reconnect attempt error"),b.reconnecting=!1,b.reconnect(),b.emitAll("reconnect_error",d.data)):(v("reconnect success"),b.onreconnect())}))},d);this.subs.push({destroy:function(){clearTimeout(c)}})}};f.prototype.onreconnect=function(){var b=this.backoff.attempts;this.reconnecting=
!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",b)}},{"./on":53,"./socket":54,"./url":55,backo2:4,"component-bind":7,"component-emitter":8,debug:10,"engine.io-client":11,indexof:32,"object-component":39,"socket.io-parser":57}],53:[function(b,d,c){d.exports=function(b,d,c){b.on(d,c);return{destroy:function(){b.removeListener(d,c)}}}},{}],54:[function(b,d,c){function f(b,d){this.io=b;this.nsp=d;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&this.open();this.receiveBuffer=
[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0}var h=b("socket.io-parser");c=b("component-emitter");var l=b("to-array"),p=b("./on"),t=b("component-bind"),n=b("debug")("socket.io-client:socket"),v=b("has-binary");d.exports=f;var m={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},k=c.prototype.emit;c(f.prototype);f.prototype.subEvents=function(){if(!this.subs){var b=this.io;this.subs=
[p(b,"open",t(this,"onopen")),p(b,"packet",t(this,"onpacket")),p(b,"close",t(this,"onclose"))]}};f.prototype.open=f.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};f.prototype.send=function(){var b=l(arguments);b.unshift("message");this.emit.apply(this,b);return this};f.prototype.emit=function(b){if(m.hasOwnProperty(b))return k.apply(this,arguments),this;var d=l(arguments),c=h.EVENT;v(d)&&(c=h.BINARY_EVENT);
c={type:c,data:d};"function"==typeof d[d.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=d.pop(),c.id=this.ids++);this.connected?this.packet(c):this.sendBuffer.push(c);return this};f.prototype.packet=function(b){b.nsp=this.nsp;this.io.packet(b)};f.prototype.onopen=function(){n("transport is open - connecting");"/"!=this.nsp&&this.packet({type:h.CONNECT})};f.prototype.onclose=function(b){n("close (%s)",b);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",
b)};f.prototype.onpacket=function(b){if(b.nsp==this.nsp)switch(b.type){case h.CONNECT:this.onconnect();break;case h.EVENT:this.onevent(b);break;case h.BINARY_EVENT:this.onevent(b);break;case h.ACK:this.onack(b);break;case h.BINARY_ACK:this.onack(b);break;case h.DISCONNECT:this.ondisconnect();break;case h.ERROR:this.emit("error",b.data)}};f.prototype.onevent=function(b){var d=b.data||[];n("emitting event %j",d);null!=b.id&&(n("attaching ack callback to event"),d.push(this.ack(b.id)));this.connected?
k.apply(this,d):this.receiveBuffer.push(d)};f.prototype.ack=function(b){var d=this,c=!1;return function(){if(!c){c=!0;var f=l(arguments);n("sending ack %j",f);var g=v(f)?h.BINARY_ACK:h.ACK;d.packet({type:g,id:b,data:f})}}};f.prototype.onack=function(b){n("calling ack %s with %j",b.id,b.data);this.acks[b.id].apply(this,b.data);delete this.acks[b.id]};f.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};f.prototype.emitBuffered=function(){var b;
for(b=0;b<this.receiveBuffer.length;b++)k.apply(this,this.receiveBuffer[b]);this.receiveBuffer=[];for(b=0;b<this.sendBuffer.length;b++)this.packet(this.sendBuffer[b]);this.sendBuffer=[]};f.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};f.prototype.destroy=function(){if(this.subs){for(var b=0;b<this.subs.length;b++)this.subs[b].destroy();this.subs=null}this.io.destroy(this)};f.prototype.close=f.prototype.disconnect=function(){this.connected&&
(n("performing disconnect (%s)",this.nsp),this.packet({type:h.DISCONNECT}));this.destroy();if(this.connected)this.onclose("io client disconnect");return this}},{"./on":53,"component-bind":7,"component-emitter":8,debug:10,"has-binary":30,"socket.io-parser":57,"to-array":59}],55:[function(b,d,c){(function(c){var f=b("parseuri"),g=b("debug")("socket.io-client:url");d.exports=function(b,d){var h=b;d=d||c.location;null==b&&(b=d.protocol+"//"+d.host);"string"==typeof b&&("/"==b.charAt(0)&&(b="/"==b.charAt(1)?
d.protocol+b:d.hostname+b),/^(https?|wss?):\/\//.test(b)||(g("protocol-less url %s",b),b="undefined"!=typeof d?d.protocol+"//"+b:"https://"+b),g("parse %s",b),h=f(b));h.port||(/^(http|ws)$/.test(h.protocol)?h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443"));h.path=h.path||"/";h.id=h.protocol+"://"+h.host+":"+h.port;h.href=h.protocol+"://"+h.host+(d&&d.port==h.port?"":":"+h.port);return h}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?
window:{})},{debug:10,parseuri:42}],56:[function(b,d,c){(function(d){var f=b("isarray"),g=b("./is-buffer");c.deconstructPacket=function(b){function d(b){if(!b)return b;if(g(b)){var h={_placeholder:!0,num:c.length};c.push(b);return h}if(f(b)){h=Array(b.length);for(var l=0;l<b.length;l++)h[l]=d(b[l]);return h}if("object"==typeof b&&!(b instanceof Date)){h={};for(l in b)h[l]=d(b[l]);return h}return b}var c=[];b.data=d(b.data);b.attachments=c.length;return{packet:b,buffers:c}};c.reconstructPacket=function(b,
d){function c(b){if(b&&b._placeholder)return d[b.num];if(f(b))for(var g=0;g<b.length;g++)b[g]=c(b[g]);else if(b&&"object"==typeof b)for(g in b)b[g]=c(b[g]);return b}b.data=c(b.data);b.attachments=void 0;return b};c.removeBlobs=function(b,c){function h(b,t,n){if(!b)return b;if(d.Blob&&b instanceof Blob||d.File&&b instanceof File){l++;var v=new FileReader;v.onload=function(){n?n[t]=this.result:p=this.result;--l||c(p)};v.readAsArrayBuffer(b)}else if(f(b))for(v=0;v<b.length;v++)h(b[v],v,b);else if(b&&
"object"==typeof b&&!g(b))for(v in b)h(b[v],v,b)}var l=0,p=b;h(p);l||c(p)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./is-buffer":58,isarray:33}],57:[function(b,d,c){function f(){}function h(b){var d=!1;var f=""+b.type;if(c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type)f+=b.attachments,f+="-";b.nsp&&"/"!=b.nsp&&(d=!0,f+=b.nsp);null!=b.id&&(d&&(f+=",",d=!1),f+=b.id);null!=b.data&&(d&&(f+=","),f+=v.stringify(b.data));n("encoded %j as %s",
b,f);return f}function l(b,d){m.removeBlobs(b,function(b){var c=m.deconstructPacket(b);b=h(c.packet);c=c.buffers;c.unshift(b);d(c)})}function p(){this.reconstructor=null}function t(b){this.reconPack=b;this.buffers=[]}var n=b("debug")("socket.io-parser"),v=b("json3");b("isarray");d=b("component-emitter");var m=b("./binary"),k=b("./is-buffer");c.protocol=4;c.types="CONNECT DISCONNECT EVENT BINARY_EVENT ACK BINARY_ACK ERROR".split(" ");c.CONNECT=0;c.DISCONNECT=1;c.EVENT=2;c.ACK=3;c.ERROR=4;c.BINARY_EVENT=
5;c.BINARY_ACK=6;c.Encoder=f;c.Decoder=p;f.prototype.encode=function(b,d){n("encoding packet %j",b);c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?l(b,d):(b=h(b),d([b]))};d(p.prototype);p.prototype.add=function(b){if("string"==typeof b){a:{var d={},f=0;d.type=Number(b.charAt(0));if(null==c.types[d.type])b={type:c.ERROR,data:"parser error"};else{if(c.BINARY_EVENT==d.type||c.BINARY_ACK==d.type){for(var g="";"-"!=b.charAt(++f)&&(g+=b.charAt(f),f!=b.length););if(g!=Number(g)||"-"!=b.charAt(f))throw Error("Illegal attachments");
d.attachments=Number(g)}if("/"==b.charAt(f+1))for(d.nsp="";++f;){g=b.charAt(f);if(","==g)break;d.nsp+=g;if(f==b.length)break}else d.nsp="/";g=b.charAt(f+1);if(""!==g&&Number(g)==g){for(d.id="";++f;){g=b.charAt(f);if(null==g||Number(g)!=g){--f;break}d.id+=b.charAt(f);if(f==b.length)break}d.id=Number(d.id)}if(b.charAt(++f))try{d.data=v.parse(b.substr(f))}catch(hc){b={type:c.ERROR,data:"parser error"};break a}n("decoded %s as %j",b,d);b=d}}c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?(this.reconstructor=
new t(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else if(k(b)||b.base64)if(this.reconstructor){if(b=this.reconstructor.takeBinaryData(b))this.reconstructor=null,this.emit("decoded",b)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+b);};p.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};t.prototype.takeBinaryData=function(b){this.buffers.push(b);
return this.buffers.length==this.reconPack.attachments?(b=m.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),b):null};t.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},{"./binary":56,"./is-buffer":58,"component-emitter":8,debug:10,isarray:33,json3:34}],58:[function(b,d,c){(function(b){d.exports=function(d){return b.Buffer&&b.Buffer.isBuffer(d)||b.ArrayBuffer&&d instanceof ArrayBuffer}}).call(this,"undefined"!==typeof global?global:"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{}],59:[function(b,d,c){d.exports=function(b,d){for(var c=[],f=(d=d||0)||0;f<b.length;f++)c[f-d]=b[f];return c}},{}],60:[function(b,d,c){(function(b){(function(f){function g(b){for(var d=[],c=0,f=b.length,g,h;c<f;)g=b.charCodeAt(c++),55296<=g&&56319>=g&&c<f?(h=b.charCodeAt(c++),56320==(h&64512)?d.push(((g&1023)<<10)+(h&1023)+65536):(d.push(g),c--)):d.push(g);return d}function h(b){if(55296<=b&&57343>=b)throw Error("Lone surrogate U+"+b.toString(16).toUpperCase()+
" is not a scalar value");}function t(){if(y>=w)throw Error("Invalid byte index");var b=r[y]&255;y++;if(128==(b&192))return b&63;throw Error("Invalid continuation byte");}function n(){if(y>w)throw Error("Invalid byte index");if(y==w)return!1;var b=r[y]&255;y++;if(0==(b&128))return b;if(192==(b&224)){var d=t();b=(b&31)<<6|d;if(128<=b)return b;throw Error("Invalid continuation byte");}if(224==(b&240)){d=t();var c=t();b=(b&15)<<12|d<<6|c;if(2048<=b)return h(b),b;throw Error("Invalid continuation byte");
}if(240==(b&248)){d=t();c=t();var f=t();b=(b&15)<<18|d<<12|c<<6|f;if(65536<=b&&1114111>=b)return b}throw Error("Invalid UTF-8 detected");}var v="object"==typeof c&&c,m="object"==typeof d&&d&&d.exports==v&&d,k="object"==typeof b&&b;if(k.global===k||k.window===k)f=k;var q=String.fromCharCode,r,w,y;k={version:"2.0.0",encode:function(b){b=g(b);for(var d=b.length,c=-1,f,l="";++c<d;){f=b[c];if(0==(f&4294967168))f=q(f);else{var p="";0==(f&4294965248)?p=q(f>>6&31|192):0==(f&4294901760)?(h(f),p=q(f>>12&15|
224),p+=q(f>>6&63|128)):0==(f&4292870144)&&(p=q(f>>18&7|240),p+=q(f>>12&63|128),p+=q(f>>6&63|128));f=p+=q(f&63|128)}l+=f}return l},decode:function(b){r=g(b);w=r.length;y=0;b=[];for(var d;!1!==(d=n());)b.push(d);d=b.length;for(var c=-1,f,h="";++c<d;)f=b[c],65535<f&&(f-=65536,h+=q(f>>>10&1023|55296),f=56320|f&1023),h+=q(f);return h}};if(v&&!v.nodeType)if(m)m.exports=k;else{f={}.hasOwnProperty;for(var x in k)f.call(k,x)&&(v[x]=k[x])}else f.utf8=k})(this)}).call(this,"undefined"!==typeof global?global:
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],61:[function(b,d,c){d.exports="function"===typeof Object.create?function(b,d){b.super_=d;b.prototype=Object.create(d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,d){b.super_=d;var c=function(){};c.prototype=d.prototype;b.prototype=new c;b.prototype.constructor=b}},{}],62:[function(b,d,c){d.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===
typeof b.fill&&"function"===typeof b.readUInt8}},{}],63:[function(b,d,c){(function(d,f){function g(b,d){var f={seen:[],stylize:t};3<=arguments.length&&(f.depth=arguments[2]);4<=arguments.length&&(f.colors=arguments[3]);x(d)?f.showHidden=d:d&&c._extend(f,d);F(f.showHidden)&&(f.showHidden=!1);F(f.depth)&&(f.depth=2);F(f.colors)&&(f.colors=!1);F(f.customInspect)&&(f.customInspect=!0);f.colors&&(f.stylize=h);return v(f,b,f.depth)}function h(b,d){return(d=g.styles[d])?"\u001b["+g.colors[d][0]+"m"+b+"\u001b["+
g.colors[d][1]+"m":b}function t(b,d){return b}function n(b){var d={};b.forEach(function(b,c){d[b]=!0});return d}function v(b,d,f){if(b.customInspect&&d&&G(d.inspect)&&d.inspect!==c.inspect&&(!d.constructor||d.constructor.prototype!==d)){var g=d.inspect(f,b);A(g)||(g=v(b,g,f));return g}if(g=m(b,d))return g;var h=Object.keys(d),l=n(h);b.showHidden&&(h=Object.getOwnPropertyNames(d));if(H(d)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return k(d);if(0===h.length){if(G(d))return b.stylize("[Function"+
(d.name?": "+d.name:"")+"]","special");if(E(d))return b.stylize(RegExp.prototype.toString.call(d),"regexp");if(D(d))return b.stylize(Date.prototype.toString.call(d),"date");if(H(d))return k(d)}g="";var p=!1,t=["{","}"];y(d)&&(p=!0,t=["[","]"]);G(d)&&(g=" [Function"+(d.name?": "+d.name:"")+"]");E(d)&&(g=" "+RegExp.prototype.toString.call(d));D(d)&&(g=" "+Date.prototype.toUTCString.call(d));H(d)&&(g=" "+k(d));if(0===h.length&&(!p||0==d.length))return t[0]+g+t[1];if(0>f)return E(d)?b.stylize(RegExp.prototype.toString.call(d),
"regexp"):b.stylize("[Object]","special");b.seen.push(d);h=p?q(b,d,f,l,h):h.map(function(c){return r(b,d,f,l,c,p)});b.seen.pop();return w(h,g,t)}function m(b,d){if(F(d))return b.stylize("undefined","undefined");if(A(d))return d="'"+JSON.stringify(d).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",b.stylize(d,"string");if(z(d))return b.stylize(""+d,"number");if(x(d))return b.stylize(""+d,"boolean");if(null===d)return b.stylize("null","null")}function k(b){return"["+Error.prototype.toString.call(b)+
"]"}function q(b,d,c,f,g){for(var h=[],l=0,p=d.length;l<p;++l)Object.prototype.hasOwnProperty.call(d,String(l))?h.push(r(b,d,c,f,String(l),!0)):h.push("");g.forEach(function(g){g.match(/^\d+$/)||h.push(r(b,d,c,f,g,!0))});return h}function r(b,d,c,f,g,h){var l,p;d=Object.getOwnPropertyDescriptor(d,g)||{value:d[g]};d.get?p=d.set?b.stylize("[Getter/Setter]","special"):b.stylize("[Getter]","special"):d.set&&(p=b.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(f,g)||(l="["+g+"]");p||
(0>b.seen.indexOf(d.value)?(p=null===c?v(b,d.value,null):v(b,d.value,c-1),-1<p.indexOf("\n")&&(p=h?p.split("\n").map(function(b){return"  "+b}).join("\n").substr(2):"\n"+p.split("\n").map(function(b){return"   "+b}).join("\n"))):p=b.stylize("[Circular]","special"));if(F(l)){if(h&&g.match(/^\d+$/))return p;l=JSON.stringify(""+g);l.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(l=l.substr(1,l.length-2),l=b.stylize(l,"name")):(l=l.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),l=b.stylize(l,
"string"))}return l+": "+p}function w(b,d,c){var f=0;return 60<b.reduce(function(b,d){f++;0<=d.indexOf("\n")&&f++;return b+d.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===d?"":d+"\n ")+" "+b.join(",\n  ")+" "+c[1]:c[0]+d+" "+b.join(", ")+" "+c[1]}function y(b){return Array.isArray(b)}function x(b){return"boolean"===typeof b}function z(b){return"number"===typeof b}function A(b){return"string"===typeof b}function F(b){return void 0===b}function E(b){return B(b)&&"[object RegExp]"===Object.prototype.toString.call(b)}
function B(b){return"object"===typeof b&&null!==b}function D(b){return B(b)&&"[object Date]"===Object.prototype.toString.call(b)}function H(b){return B(b)&&("[object Error]"===Object.prototype.toString.call(b)||b instanceof Error)}function G(b){return"function"===typeof b}function J(b){return 10>b?"0"+b.toString(10):b.toString(10)}function P(){var b=new Date,d=[J(b.getHours()),J(b.getMinutes()),J(b.getSeconds())].join(":");return[b.getDate(),K[b.getMonth()],d].join(" ")}var L=/%[sdj%]/g;c.format=
function(b){if(!A(b)){for(var d=[],c=0;c<arguments.length;c++)d.push(g(arguments[c]));return d.join(" ")}c=1;var f=arguments,h=f.length;d=String(b).replace(L,function(b){if("%%"===b)return"%";if(c>=h)return b;switch(b){case "%s":return String(f[c++]);case "%d":return Number(f[c++]);case "%j":try{return JSON.stringify(f[c++])}catch(Em){return"[Circular]"}default:return b}});for(var l=f[c];c<h;l=f[++c])d=null!==l&&B(l)?d+(" "+g(l)):d+(" "+l);return d};c.deprecate=function(b,g){if(F(f.process))return function(){return c.deprecate(b,
g).apply(this,arguments)};if(!0===d.noDeprecation)return b;var h=!1;return function(){if(!h){if(d.throwDeprecation)throw Error(g);d.traceDeprecation?console.trace(g):console.error(g);h=!0}return b.apply(this,arguments)}};var O={},N;c.debuglog=function(b){F(N)&&(N=d.env.NODE_DEBUG||"");b=b.toUpperCase();if(!O[b])if((new RegExp("\\b"+b+"\\b","i")).test(N)){var f=d.pid;O[b]=function(){var d=c.format.apply(c,arguments);console.error("%s %d: %s",b,f,d)}}else O[b]=function(){};return O[b]};c.inspect=g;
g.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};g.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};c.isArray=y;c.isBoolean=x;c.isNull=function(b){return null===b};c.isNullOrUndefined=function(b){return null==b};c.isNumber=z;c.isString=A;c.isSymbol=function(b){return"symbol"===
typeof b};c.isUndefined=F;c.isRegExp=E;c.isObject=B;c.isDate=D;c.isError=H;c.isFunction=G;c.isPrimitive=function(b){return null===b||"boolean"===typeof b||"number"===typeof b||"string"===typeof b||"symbol"===typeof b||"undefined"===typeof b};c.isBuffer=b("./support/isBuffer");var K="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");c.log=function(){console.log("%s - %s",P(),c.format.apply(c,arguments))};c.inherits=b("inherits");c._extend=function(b,d){if(!d||!B(d))return b;for(var c=Object.keys(d),
f=c.length;f--;)b[c[f]]=d[c[f]];return b}}).call(this,b("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":62,_process:43,inherits:61}],64:[function(b,d,c){if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){var f="moz";var h=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)f="webkit",h=navigator.userAgent.match(/Chrom(e|ium)/)&&
parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10);b=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;c=window.mozRTCIceCandidate||window.RTCIceCandidate;var l=window.mozRTCSessionDescription||window.RTCSessionDescription,p=window.webkitMediaStream||window.MediaStream,t="https:"===window.location.protocol&&("webkit"===f&&26<=h||"moz"===f&&33<=h),n=window.AudioContext||window.webkitAudioContext,v=document.createElement("video");v=v&&v.canPlayType&&
"probably"===v.canPlayType('video/webm; codecs="vp8", vorbis');var m=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;d.exports={prefix:f,browserVersion:h,support:!!b&&!!m,supportRTCPeerConnection:!!b,supportVp8:v,supportGetUserMedia:!!m,supportDataChannel:!!(b&&b.prototype&&b.prototype.createDataChannel),supportWebAudio:!(!n||!n.prototype.createMediaStreamSource),supportMediaStream:!(!p||!p.prototype.removeTrack),supportScreenSharing:!!t,AudioContext:n,
PeerConnection:b,SessionDescription:l,IceCandidate:c,MediaStream:p,getUserMedia:m}},{}],65:[function(b,d,c){function f(){}d.exports=f;f.mixin=function(b){b=b.prototype||b;b.isWildEmitter=!0;b.on=function(b,d,c){this.callbacks=this.callbacks||{};var f=3===arguments.length,g=f?arguments[2]:arguments[1];g._groupName=f?arguments[1]:void 0;(this.callbacks[b]=this.callbacks[b]||[]).push(g);return this};b.once=function(b,d,c){function f(){g.off(b,f);l.apply(this,arguments)}var g=this,h=3===arguments.length,
l=h?arguments[2]:arguments[1];this.on(b,h?arguments[1]:void 0,f);return this};b.releaseGroup=function(b){this.callbacks=this.callbacks||{};var d,c;for(d in this.callbacks){var f=this.callbacks[d];var g=0;for(c=f.length;g<c;g++)f[g]._groupName===b&&(f.splice(g,1),g--,c--)}return this};b.off=function(b,d){this.callbacks=this.callbacks||{};var c=this.callbacks[b];if(!c)return this;if(1===arguments.length)return delete this.callbacks[b],this;var f=c.indexOf(d);c.splice(f,1);0===c.length&&delete this.callbacks[b];
return this};b.emit=function(b){this.callbacks=this.callbacks||{};var d=[].slice.call(arguments,1),c=this.callbacks[b],f=this.getWildcardCallbacks(b),g;if(c){var h=c.slice();c=0;for(g=h.length;c<g&&h[c];++c)h[c].apply(this,d)}if(f)for(h=f.slice(),c=0,g=h.length;c<g&&h[c];++c)h[c].apply(this,[b].concat(d));return this};b.getWildcardCallbacks=function(b){this.callbacks=this.callbacks||{};var d,c=[];for(d in this.callbacks){var f=d.split("*");if("*"===d||2===f.length&&b.slice(0,f[0].length)===f[0])c=
c.concat(this.callbacks[d])}return c}};f.mixin(f)},{}],66:[function(b,d,c){function f(b,d,c){return d?new h(b,d):new h(b)}b=function(){return this}();var h=b.WebSocket||b.MozWebSocket;d.exports=h?f:null;h&&(f.prototype=h.prototype)},{}],67:[function(b,d,c){function f(b){var d=!0;b.getTracks().forEach(function(b){d="ended"===b.readyState&&d});return d}function h(b){var d=this;t.call(this);this.id=b.id;this.parent=b.parent;this.type=b.type||"video";this.oneway=b.oneway||!1;this.sharemyscreen=b.sharemyscreen||
!1;this.browserPrefix=b.prefix;this.stream=b.stream;this.enableDataChannels=void 0===b.enableDataChannels?this.parent.config.enableDataChannels:b.enableDataChannels;this.receiveMedia=b.receiveMedia||this.parent.config.receiveMedia;this.channels={};this.sid=b.sid||Date.now().toString();this.pc=new p(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints);this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("endOfCandidates",function(b){d.send("endOfCandidates",
b)});this.pc.on("offer",function(b){d.parent.config.nick&&(b.nick=d.parent.config.nick);d.send("offer",b)});this.pc.on("answer",function(b){d.parent.config.nick&&(b.nick=d.parent.config.nick);d.send("answer",b)});this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this));this.pc.on("addChannel",this.handleDataChannelAdded.bind(this));this.pc.on("removeStream",this.handleStreamRemoved.bind(this));this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded"));this.pc.on("iceConnectionStateChange",
this.emit.bind(this,"iceConnectionStateChange"));this.pc.on("iceConnectionStateChange",function(){switch(d.pc.iceConnectionState){case "failed":"offer"===d.pc.pc.localDescription.type&&(d.parent.emit("iceFailed",d),d.send("connectivityError"))}});this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange"));this.logger=this.parent.logger;"screen"===b.type?this.parent.localScreens&&this.parent.localScreens[0]&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),
this.pc.addStream(this.parent.localScreens[0]),this.broadcaster=b.broadcaster):this.parent.localStreams.forEach(function(b){d.pc.addStream(b)});this.on("channelOpen",function(b){"https://simplewebrtc.com/protocol/filetransfer#inband-v1"===b.protocol&&(b.onmessage=function(c){c=JSON.parse(c.data);var f=new n.Receiver;f.receive(c,b);d.emit("fileTransfer",c,f);f.on("receivedFile",function(b,d){f.channel.close()})})});this.on("*",function(){d.parent.emit.apply(d.parent,arguments)})}c=b("util");var l=
b("webrtcsupport"),p=b("rtcpeerconnection"),t=b("wildemitter"),n=b("filetransfer");c.inherits(h,t);h.prototype.handleMessage=function(b){var d=this;this.logger.log("getting",b.type,b);b.prefix&&(this.browserPrefix=b.prefix);"offer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleOffer(b.payload,function(b){b||d.pc.answer(function(b,d){})})):"answer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleAnswer(b.payload)):"candidate"===
b.type?this.pc.processIce(b.payload):"connectivityError"===b.type?this.parent.emit("connectivityError",d):"mute"===b.type?this.parent.emit("mute",{id:b.from,name:b.payload.name}):"unmute"===b.type&&this.parent.emit("unmute",{id:b.from,name:b.payload.name})};h.prototype.send=function(b,d){d={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:b,payload:d,prefix:l.prefix};this.logger.log("sending",b,d);this.parent.emit("message",d)};h.prototype.sendDirectly=function(b,d,c){c=
{type:d,payload:c};this.logger.log("sending via datachannel",b,d,c);b=this.getDataChannel(b);if("open"!=b.readyState)return!1;b.send(JSON.stringify(c));return!0};h.prototype._observeDataChannel=function(b){var d=this;b.onclose=this.emit.bind(this,"channelClose",b);b.onerror=this.emit.bind(this,"channelError",b);b.onmessage=function(c){d.emit("channelMessage",d,b.label,JSON.parse(c.data),b,c)};b.onopen=this.emit.bind(this,"channelOpen",b)};h.prototype.getDataChannel=function(b,d){if(!l.supportDataChannel)return this.emit("error",
Error("createDataChannel not supported"));var c=this.channels[b];d||(d={});if(c)return c;c=this.channels[b]=this.pc.createDataChannel(b,d);this._observeDataChannel(c);return c};h.prototype.onIceCandidate=function(b){if(!this.closed)if(b){var d=this.parent.config.peerConnectionConfig;"moz"===l.prefix&&d&&d.iceTransports&&b.candidate&&b.candidate.candidate&&0>b.candidate.candidate.indexOf(d.iceTransports)?this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",d.iceTransports):
this.send("candidate",b)}else this.logger.log("End of candidates.")};h.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc");this.pc.offer(this.receiveMedia,function(b,d){})};h.prototype.icerestart=function(){var b=this.receiveMedia;b.mandatory.IceRestart=!0;this.pc.offer(b,function(b,d){})};h.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())};h.prototype.handleRemoteStreamAdded=function(b){var d=this;this.stream?this.logger.warn("Already have a remote stream"):
(this.stream=b.stream,this.stream.getTracks().forEach(function(b){b.addEventListener("ended",function(){f(d.stream)&&d.end()})}),this.parent.emit("peerStreamAdded",this))};h.prototype.handleStreamRemoved=function(){var b=this.parent.peers.indexOf(this);-1<b&&(this.parent.peers.splice(b,1),this.closed=!0,this.parent.emit("peerStreamRemoved",this))};h.prototype.handleDataChannelAdded=function(b){this.channels[b.label]=b;this._observeDataChannel(b)};h.prototype.sendFile=function(b){var d=new n.Sender,
c=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:"https://simplewebrtc.com/protocol/filetransfer#inband-v1"});c.onopen=function(){c.send(JSON.stringify({size:b.size,name:b.name}));d.send(b,c)};c.onclose=function(){console.log("sender received transfer");d.emit("complete")};return d};d.exports=h},{filetransfer:26,rtcpeerconnection:44,util:63,webrtcsupport:64,wildemitter:65}],68:[function(b,d,c){function f(b){var d=this,c=b||{},f=this.config={url:"https://sandbox.simplewebrtc.com:443/",
socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}},g;var k=b.debug?b.logger||console:b.logger||n;this.logger=k;for(g in c)c.hasOwnProperty(g)&&(this.config[g]=c[g]);this.capabilities=p;l.call(this);var v=null===this.config.connection?this.connection=
new m(this.config):this.connection=this.config.connection;v.on("connect",function(){d.emit("connectionReady",v.getSessionid());d.sessionReady=!0;d.testReadiness()});v.on("message",function(b){var c=d.webrtc.getPeers(b.from,b.roomType);if("offer"===b.type){c.length&&c.forEach(function(d){d.sid==b.sid&&(f=d)});if(!f){var f=d.webrtc.createPeer({id:b.from,sid:b.sid,type:b.roomType,enableDataChannels:d.config.enableDataChannels&&"screen"!==b.roomType,sharemyscreen:"screen"===b.roomType&&!b.broadcaster,
broadcaster:"screen"!==b.roomType||b.broadcaster?null:d.connection.getSessionid()});d.emit("createdPeer",f)}f.handleMessage(b)}else c.length&&c.forEach(function(d){b.sid?d.sid===b.sid&&d.handleMessage(b):d.handleMessage(b)})});v.on("remove",function(b){b.id!==d.connection.getSessionid()&&d.webrtc.removePeers(b.id,b.type)});b.logger=this.logger;b.debug=!1;this.webrtc=new h(b);"mute unmute pauseVideo resumeVideo pause resume sendToAll sendDirectlyToAll getPeers".split(" ").forEach(function(b){d[b]=
d.webrtc[b].bind(d.webrtc)});this.webrtc.on("*",function(){d.emit.apply(d,arguments)});if(f.debug)this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:"));this.webrtc.on("localStream",function(){d.testReadiness()});this.webrtc.on("message",function(b){d.connection.emit("message",b)});this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this));this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this));this.config.adjustPeerVolume&&(this.webrtc.on("speaking",
this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1)));v.on("stunservers",function(b){d.webrtc.config.peerConnectionConfig.iceServers=b;d.emit("stunservers",b)});v.on("turnservers",function(b){d.webrtc.config.peerConnectionConfig.iceServers=d.webrtc.config.peerConnectionConfig.iceServers.concat(b);d.emit("turnservers",b)});this.webrtc.on("iceFailed",function(b){});this.webrtc.on("connectivityError",function(b){});this.webrtc.on("audioOn",
function(){d.webrtc.sendToAll("unmute",{name:"audio"})});this.webrtc.on("audioOff",function(){d.webrtc.sendToAll("mute",{name:"audio"})});this.webrtc.on("videoOn",function(){d.webrtc.sendToAll("unmute",{name:"video"})});this.webrtc.on("videoOff",function(){d.webrtc.sendToAll("mute",{name:"video"})});this.webrtc.on("localScreen",function(b){var c=document.createElement("video"),f=d.getRemoteVideoContainer();c.oncontextmenu=function(){return!1};c.id="localScreen";t(b,c);f&&f.appendChild(c);d.emit("localScreenAdded",
c);d.connection.emit("shareScreen");d.webrtc.peers.forEach(function(b){"video"===b.type&&(b=d.webrtc.createPeer({id:b.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:d.connection.getSessionid()}),d.emit("createdPeer",b),b.start())})});this.webrtc.on("localScreenStopped",function(b){d.getLocalScreen()&&d.stopScreenShare()});this.webrtc.on("channelMessage",function(b,c,f){"volume"==f.type&&d.emit("remoteVolumeChange",b,f.volume)});
this.config.autoRequestMedia&&this.startLocalVideo()}var h=b("./webrtc"),l=b("wildemitter"),p=b("webrtcsupport"),t=b("attachmediastream"),n=b("mockconsole"),m=b("./socketioconnection");f.prototype=Object.create(l.prototype,{constructor:{value:f}});f.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare();this.emit("leftRoom",this.roomName);this.roomName=void 0}};f.prototype.disconnect=
function(){this.connection.disconnect();delete this.connection};f.prototype.handlePeerStreamAdded=function(b){var d=this,c=this.getRemoteVideoContainer(),f=t(b.stream);b.videoEl=f;f.id=this.getDomId(b);c&&c.appendChild(f);this.emit("videoAdded",f,b);window.setTimeout(function(){d.webrtc.isAudioEnabled()||b.send("mute",{name:"audio"});d.webrtc.isVideoEnabled()||b.send("mute",{name:"video"})},250)};f.prototype.handlePeerStreamRemoved=function(b){var d=this.getRemoteVideoContainer(),c=b.videoEl;this.config.autoRemoveVideos&&
d&&c&&d.removeChild(c);c&&this.emit("videoRemoved",c,b)};f.prototype.getDomId=function(b){return[b.id,b.type,b.broadcaster?"broadcasting":"incoming"].join("_")};f.prototype.setVolumeForAll=function(b){this.webrtc.peers.forEach(function(d){d.videoEl&&(d.videoEl.volume=b)})};f.prototype.joinRoom=function(b,d){var c=this;this.roomName=b;this.connection.emit("join",b,function(f,g){console.log("join CB",f);P(g);if(f)c.emit("error",f);else{if(!g.xtra){Ea();bc();We(x.errorLoading,"#ff0000");return}w.room=
g.xtra;var h,l;for(h in g.clients){var p=g.clients[h];for(l in p)if(p[l]){var t=c.webrtc.createPeer({id:h,type:l,enableDataChannels:c.config.enableDataChannels&&"screen"!==l,receiveMedia:{offerToReceiveAudio:"screen"!==l&&c.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:c.config.receiveMedia.offerToReceiveVideo}});c.emit("createdPeer",t);t.start()}}}d&&d(f,g);c.emit("joinedRoom",b)})};f.prototype.getEl=function(b){return"string"===typeof b?document.getElementById(b):b};f.prototype.startLocalVideo=
function(){var b=this;this.webrtc.start(this.config.media,function(d,c){d?b.emit("localMediaError",d):t(c,b.getLocalVideoContainer(),b.config.localVideo)})};f.prototype.stopLocalVideo=function(){this.webrtc.stop()};f.prototype.getLocalVideoContainer=function(){var b=this.getEl(this.config.localVideoEl);if(b&&"VIDEO"===b.tagName)return b.oncontextmenu=function(){return!1},b;if(b){var d=document.createElement("video");d.oncontextmenu=function(){return!1};b.appendChild(d);return d}};f.prototype.getRemoteVideoContainer=
function(){return this.getEl(this.config.remoteVideosEl)};f.prototype.shareScreen=function(b){this.webrtc.startScreenShare(b)};f.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]};f.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var b=document.getElementById("localScreen"),d=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&d&&b&&d.removeChild(b);b&&this.emit("videoRemoved",b);this.getLocalScreen()&&this.webrtc.stopScreenShare();
this.webrtc.peers.forEach(function(b){b.broadcaster&&b.end()})};f.prototype.testReadiness=function(){this.sessionReady&&(this.config.media.video||this.config.media.audio?0<this.webrtc.localStreams.length&&this.emit("readyToCall",this.connection.getSessionid()):this.emit("readyToCall",this.connection.getSessionid()))};f.prototype.createRoom=function(b,d){this.roomName=b;this.connection.emit("create",w.room,d)};f.prototype.sendFile=function(){if(!p.dataChannel)return this.emit("error",Error("DataChannelNotSupported"))};
d.exports=f},{"./socketioconnection":69,"./webrtc":70,attachmediastream:3,mockconsole:37,webrtcsupport:64,wildemitter:65}],69:[function(b,d,c){function f(b){this.connection=h.connect(b.url,b.socketio)}var h=b("socket.io-client");f.prototype.on=function(b,d){this.connection.on(b,d)};f.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};f.prototype.getSessionid=function(){return this.connection.id};f.prototype.disconnect=function(){return this.connection.disconnect()};d.exports=
f},{"socket.io-client":50}],70:[function(b,d,c){function f(b){var d=this,c=b||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:!0};var f;b=b.debug?b.logger||console:b.logger||l;this.logger=b;for(f in c)c.hasOwnProperty(f)&&(this.config[f]=c[f]);h.support||this.logger.error("Your browser doesn't seem to support WebRTC");this.peers=[];
p.call(this,this.config);this.on("speaking",function(){d.hardMuted||d.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"speaking"})))})});this.on("stoppedSpeaking",function(){d.hardMuted||d.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"stoppedSpeaking"})))})});this.on("volumeChange",function(b,c){d.hardMuted||d.peers.forEach(function(d){d.enableDataChannels&&
(d=d.getDataChannel("hark"),"open"==d.readyState&&d.send(JSON.stringify({type:"volume",volume:b})))})});if(this.config.debug)this.on("*",function(b,c,f){(d.config.logger===l?console:d.logger).log("event:",b,c,f)})}c=b("util");var h=b("webrtcsupport"),l=b("mockconsole"),p=b("localmedia"),t=b("./peer");c.inherits(f,p);f.prototype.createPeer=function(b){b.parent=this;b=new t(b);this.peers.push(b);return b};f.prototype.removePeers=function(b,d){this.getPeers(b,d).forEach(function(b){b.end()})};f.prototype.getPeers=
function(b,d){return this.peers.filter(function(c){return(!b||c.id===b)&&(!d||c.type===d)})};f.prototype.sendToAll=function(b,d){this.peers.forEach(function(c){c.send(b,d)})};f.prototype.sendDirectlyToAll=function(b,d,c){this.peers.forEach(function(f){f.enableDataChannels&&f.sendDirectly(b,d,c)})};d.exports=f},{"./peer":67,localmedia:35,mockconsole:37,util:63,webrtcsupport:64}]},{},[68])(68)})},F,ua,x={},w={name:localStorage.name,color:localStorage.color||"#ff0000"},Oc=function(){};console.log("%c nehhon %c POWER ",
"background: #00ffd4; color: #000; font-size:20px","background: #000; color: #00ffd4; font-size:20px");console.log("%c Author: Ruben ","background: #000; color: #00ffd4; font-size:20px");console.log("%c webmaster@nehhon.com ","background: #00ffd4; color: #000; font-size:20px");console.log("%c @nehhon ","background: #000; color: #00ffd4; font-size:20px");void 0===localStorage.fullscreen&&(localStorage.fullscreen=!0);console.log=Oc;console.error=Oc;console.warn=Oc;console.info=Oc;var r=function(e){return document.getElementById(e)};
(function(){var e=!!window.opr||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),b="undefined"!==typeof InstallTrigger,d=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),c=!!document.documentMode,g=!c&&!!window.StyleMedia,h=!!window.chrome&&!!window.chrome.webstore,l;e?l="Opera":b?l="Firefox":d?l="Safari":c?l="IE":g?l="Edge":h&&(l="Chrome");w.navLang=navigator.language||navigator.userLanguage;e=w.navLang.substr(0,2);b={es:["Tzared","Juego de estrategia en tiempo real para navegadores web, juega solo o con amigos",
"tzared,jugar,multijugador,juego,online,navegador web,tzar"],it:["Tzared","Gioco di strategia in tempo reale per browser web, giocare da soli o con gli amici","tzared,giocare,multigiocatore,gioco,online,navigatore,tzar,web"],pl:["Tzared","Gra strategiczna w czasie rzeczywistym dla przegl\u0105darek internetowych, bawi\u0107 si\u0119 samotnie lub z przyjaci\u00f3\u0142mi","tzared,gra,multiplayer,online,tzar,przegl\u0105darka internetowa"],ru:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u043b\u044f \u0432\u0435\u0431-\u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u0432, \u0438\u0433\u0440\u0430\u0442\u044c \u0432 \u043e\u0434\u0438\u043d\u043e\u0447\u043a\u0443 \u0438\u043b\u0438 \u0441 \u0434\u0440\u0443\u0437\u044c\u044f\u043c\u0438",
"\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u044c\u0442\u0438\u043f\u043b\u0435\u0435\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u0435\u0440,\u043e\u0433\u043d\u0451\u043c \u0438 \u043c\u0435\u0447\u043e\u043c"],pt:["Tzared","Jogo de estrat\u00e9gia em tempo real para navegadores da web, jogar sozinho ou com amigos","tzared,jogar,multiplayer,jogo,online,navegador web,tzar"],bg:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0447\u0435\u0441\u043a\u0430 \u0438\u0433\u0440\u0430 \u0432 \u0440\u0435\u0430\u043b\u043d\u043e \u0432\u0440\u0435\u043c\u0435 \u0437\u0430 \u0443\u0435\u0431 \u0431\u0440\u0430\u0443\u0437\u044a\u0440\u0438, \u0438\u0433\u0440\u0430\u0439\u0442\u0435 \u0441\u0430\u043c\u0438 \u0438\u043b\u0438 \u0441 \u043f\u0440\u0438\u044f\u0442\u0435\u043b\u0438",
"\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u0442\u0438\u043f\u043b\u0435\u0439\u044a\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u044a\u0440"],de:["Tzared","Echtzeit-Strategiespiel f\u00fcr Webbrowser, alleine oder mit Freunden spielen","tzared,multiplayer,spiel,online,Webbrowser,tzar"],en:["Tzared","Real-time strategy game for web browsers, play alone or with friends","tzared,play,multiplayer,game,online,browser,tzar,web"]};b[e]||(e=
"en");document.getElementsByTagName("html")[0].lang=e;b=b[location.search.split("lang=")[1]||"en"];document.getElementsByTagName("title")[0].innerHTML=b[0];document.getElementsByTagName("meta").description=b[1];document.getElementsByTagName("meta").keywords=b[2];w.lang="en es it pt ru pl bg de".split(" ").indexOf(e);0>w.lang&&(w.lang=0);w.langstr=e;w.race=0;w.navigator=l;w.mx=151;w.onlineID=null;w.temperature=0})();x={open:"Open",loading:"Loading...",systemAlert:"System Message",notEnough:"Not enough %s",
ok:"OK",yes:"Yes",no:"No",secure:"Are you sure?",gold:"Gold",stone:"Stone",wood:"Wood",food:"Food",mana:"Manna",warning:"Warning",play:"PLAY",close:"CLOSE",gameClosed:"The game was canceled by the server.",loadgraphics:"Downloading graphics...",waitImages:"Downloading graphics",wait:"Wait",audioproblem:"Your browser is not compatible with Web Audio",defeated:"DEFEATED",victorious:"VICTORIOUS",options:"OPTIONS",refresh:"Refresh",back:"BACK",paused:"PAUSED",chatMsg:"CHAT MESSAGE",disconnect:"Disconnect",
playerDisconnected:"%s has disconnected!",connectionError:"Connection error",noP2P:"Engine not loaded",startingResources:"Starting Resources",mapSize:"Map Size",menu:"MENU",quit:"QUIT",downloadAll:"Download all",continue:"Continue",backToGame:"BACK TO GAME",initializing:"Initializing...",requires:"Requires",stop:"Stop",pickItems:"Pick items",move:"Move",stand:"Stand ground",explore:"Explore",patrol:"Patrol",guard:"Guard",errorLoading:"Error loading game.",waitingPlayers:"Waiting for players to connect",
musicVolume:"Music Volume",soundVolume:"Sound Volume",common:"Common",popLimit:"Population limit reached",houseLimit:"Not enough houses",lightning:"Lightning",freeze:"Freeze",bless:"Bless",heal:"Heal",invisibility:"Invisibility",dcm:"Dig, chop or mine",repair:"Repair building",menuBuild:"See what you can build",units:"Units",infinite:"Infinite",gameFull:"Sorry, the game is full.",terrainOption:"Terrain",playerDefeated:"%s has been defeated!",savegame:"SAVE GAME",loadRecord:"Recording",stats:"Stats",
builds:"Builds",items:"Items",nature:"Nature",trees:"Trees",delete:"Delete",create:"Create",username:"Player Name",gameOptions:"GAME OPTIONS",nplayers:"Number of Players",gameName:"Enter Game Name",gamesFound:"Games Found",strSearch:"SEARCH| Search for existing games",strCreate:"CREATE| Create a game",randomMap:"RANDOM MAP",strcusMap:"CUSTOM MAP",strSettings:"SETTINGS",mapMaking:"Map Making",terrain:"Terrain",save:"SAVE",accept:"ACCEPT",team:"Team",color:"Colour",offlinePlay:"For playing offline",
AI:"AI Assist",kingdom:"Kingdom",attack:"Attack",defence:"Defence",health:"Health",maxHealth:"Max health",playing:"Playing",waiting:"Waiting",joining:"Joining...",random:"Random",cancel:"CANCEL",rules:"Rules",events:"Events",actions:"Actions",objAction:"Object action",destroyObj:"Destroy object",defined:"Defined",undefined:"Undefined",destroy:"Destroy",capture:"Capture",moving:"Moving",add:"Add",objOrder:"Order",objZone:"Object in zone",zone:"Zone",editMap:"Edit",mapName:"Map name",description:"Map Description",
author:"Author",fullscreen:"Automatic full screen"};var Gi=Oc,Ii=function(e){e--;var b=new XMLHttpRequest;b.open("GET","/nehhon/"+w.langstr+".json",!0);b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var e=JSON.parse(b.response);Gi=function(){for(var b=A,d=0;d<b.length;d++){var c=b[d].name;e[c]&&(b[d].name=e[c])}for(d=0;d<B.length;d++)b=B[d],e[b.name[0]]&&e[b.name[1]]&&(b.name[0]=e[b.name[0]],b.name[1]=
e[b.name[1]]);e=null};for(var f=[],g=0;0>g;g++)"undefined"!=typeof c[g]&&null!=c[g].tech&&(f.push(c[g].tech.name),Object.freeze(c[g].tech));for(g=0;g<f.length;g++)f[g][0]=e[f[g][0]],f[g][1]=e[f[g][1]];f=Object.keys(x);for(g=0;g<f.length;g++){var h=f[g];void 0!=e[x[h]]&&(x[h]=e[x[h]])}Object.freeze(x);for(g=0;g<bb.length;g++)bb[g]=e[bb[g]];for(g=0;g<0*Lg.length;g++)Lg[g]=e[Lg[g]];Object.freeze(bb);Hi()}};b.send()},Hi=function(){for(var e=["refreshButton",x.refresh,"optionsButton",x.options,"startButton",
x.play,"backButton",x.back,"closeButton",x.close,"quitButton",x.quit,"continueButton",x.continue],b=0,d=e.length;b<d;b+=2)for(var c=document.getElementsByClassName(e[b]),g=0,h=c.length;g<h;g++)c[g].innerHTML=e[b+1];e=["alertok",x.ok,"sendMessageH2",x.chatMsg,"mapsizeOption",x.mapSize,"startingResourcesOption",x.startingResources,"goldWord",x.gold,"stoneWord",x.stone,"foodWord",x.food,"woodWord",x.wood,"gameMenu",x.menu,"infiniteWord",x.infinite,"backToGame",x.backToGame,"backToGameS",x.backToGame,
"musicVolume",x.musicVolume,"soundVolume",x.soundVolume,"menueditor",x.menu,"terrainOption",x.terrainOption,"saveGame",x.savegame,"playrecord",x.loadRecord,"seeStats",x.stats,"selectBuilds",x.builds,"selectUnits",x.units,"selectItems",x.items,"selectNature",x.nature,"gamesFound",x.gamesFound,"strSearch",x.strSearch.split("| ")[1],"strCreate",x.strCreate.split("| ")[1],"strRandomMap",x.randomMap,"strcusMap",x.strcusMap,"strMapEditor",x.mapMaking,"h2cusmap",x.strcusMap,"h2rndMap",x.randomMap,"mapProps",
x.options,"mapRules",x.rules,"editCustom",x.editMap,"strSettings",x.strSettings];b=0;for(d=e.length;b<d;b+=2)document.getElementById(e[b]).innerHTML=e[b+1]};0<w.lang?(Ii(w.lang),Ii.translated=!0):Hi();var P=console.log,bl=document.getElementById("alerttitle"),cl=document.getElementById("alerttext"),dl=document.getElementById("alert"),qd=function(e,b,d){dl.style.display="block";bl.innerHTML=b||x.warning;cl.innerHTML=e;d?document.getElementById("alertok").style.display="none":document.getElementById("alertok").style.display=
"block";r("basic").style.filter="blur(94px)"},el=[1E3,0,2E3,0],ti,Ki=function(e,b,d){var c=new XMLHttpRequest;c.open("GET",e,!0);c.responseType="arraybuffer";c.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");c.onload=function(){b.length?T[b]=Ji(c.response):T.xtra[b]=Ji(c.response);T.load++;$b&&T.load===T.images&&$b()};d&&(c.onprogress=function(b){d(b)});c.send("")},Ji=function(e){performance.now();e=new Uint16Array(e);var b=e.length,d=e[b-4]+65536*e[b-3],c=e[b-2]+
65536*e[b-1];b-=2;var g=-1;c=new Uint8Array(4*c);for(var h=0;d<b;d++){var l=e[d];if(65533<l){65535==l?(l=e[d+1],d+=1):(l=e[d+1]+65536*e[d+2],d+=2);for(var p=0;p<l;p++)c[h++]=g&255,c[h++]=g>>8&255,c[h++]=g>>16&255,c[h++]=g>>24&255}else l=e[2*l]+65536*e[2*l+1],c[h++]=l&255,c[h++]=l>>8&255,c[h++]=l>>16&255,c[h++]=l>>24&255,g=l}return c},zc=function(){var e=["mpc0k7ep2l0v0j2/icons.png","iea7wlmxml6pus0/images.json","avpm3elzmphq5b1/graphics.nh17","agjeb95idjel2dr/terrainData.json?v5","xg1qh97bjrm61x0/grass.nh17"];
e=e.concat(Mg);var b=e.length;zc.max=b;for(var d=0;d<b;d++)fl("https://dl.dropboxusercontent.com/s/"+e[d]);this.innerHTML="0%";this.disabled=!0;zc.button=this};zc.loaded=0;var fl=function(e){var b=new XMLHttpRequest;b.open("GET",e,!0);b.responseType="arraybuffer";b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onload=function(){zc.loaded++;zc.button.innerHTML=~~(100*zc.loaded/zc.max+.5)+"%"};b.send("")},T={size:512,load:0,xtra:[]},$b;T.xtraRes=[];var I={page:0,
length:8,leftButton:document.getElementById("aleft"),rightButton:document.getElementById("aright"),stock:document.getElementById("stock")},k;(function(){var e=0,b=0,d=function(d){d.target.loadedSize||(b+=d.total,d.target.lastLoaded=0,d.target.loadedSize=!0);e+=d.loaded-d.target.lastLoaded;d.target.lastLoaded=d.loaded;r("loadingtext").innerHTML=x.loadgraphics+~~(100*e/b)+"%"},c=function(b){var e=!!b.icons;T.images=Object.keys(b).length;if(e){var c=new XMLHttpRequest;c.open("GET",b.icons,!0);c.responseType=
"arraybuffer";c.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var b=new Uint8Array(c.response);b=new Blob([b],{type:"image/png"});var e=new Image;e.src=URL.createObjectURL(b);T.load++;I.icons=e;$b&&T.load===T.images&&$b();Date.now()}};c.onprogress=function(b){d(b)};c.send("")}Date.now();var f=new XMLHttpRequest;f.open("GET",b.imageJSON,!0);e&&f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");
f.onreadystatechange=function(){4==this.readyState&&200==this.status&&(T.load++,$b&&T.load===T.images&&$b(),k=JSON.parse(f.response))};f.onprogress=function(b){d(b)};f.send(!0);Ki(b.common,"common",d)};(function(){var b=!1;"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/sworker.js").then(function(b){console.log("CLIENT: service worker registration complete.")},function(b){P(b);console.log("CLIENT: service worker registration failure.")}),
navigator.serviceWorker.oncontrollerchange=function(){console.log("page controlled by:",navigator.serviceWorker.controller);location.reload(!0)}):console.log("CLIENT: service worker is not supported.");ti=function(){T.started=!0;b||(b=!0,c({icons:"https://dl.dropboxusercontent.com/s/mpc0k7ep2l0v0j2/icons.png",imageJSON:"https://dl.dropboxusercontent.com/s/iea7wlmxml6pus0/images.json",common:"https://dl.dropboxusercontent.com/s/avpm3elzmphq5b1/graphics.nh17"}))}})()})();var Te={grass:{json:"agjeb95idjel2dr/terrainData.json?v5",
main:"xg1qh97bjrm61x0/grass.nh17"},snow:{json:"hwja6mugluokbkh/terrainData.json?v3",main:"1x2cwzm0i7v2sz8/terrain.nh17?v1"},last:""},Xe,Uk=function(){T.images+=2;var e=Te[q.terrainType||r("terrainSelect").value];Te.last=q.terrainType||r("terrainSelect").value;q.terrainType=Te.last;var b=new XMLHttpRequest;b.open("GET","https://dl.dropboxusercontent.com/s/"+e.json,!0);b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onreadystatechange=function(){if(4==this.readyState&&
200==this.status){T.xtraRes[0]=JSON.parse(b.response);kc=T.xtraRes[0];var e=kc.specialColor;Xe=new Float32Array(Vb(e[0]/255,e[1]/255,e[2]/255,.9));T.load++;e="rgb("+e[0]+","+e[1]+","+e[2]+")";r("msgs1").style.color=e;r("playersinfo").style.color=e;r("topinfo").style.color=e;$b&&T.load===T.images&&$b()}};b.send(!0);Ki("https://dl.dropboxusercontent.com/s/"+e.main,0,!1)},mc,rd,Ye,Ac,Ze,Ng,Pd,Li,Qd,Mi,Ni,L,$e,Rd,Wa,Og,Fa,qa,af={},Mg="kwf09yi8p5vq1px/Tzar%20Soundtrack%201.mp3 0d7r5b6yq8rvzxa/Tzar%20Soundtrack%202.mp3 6sc2lejtpq5hn1p/Tzar%20Soundtrack%203.mp3 0r454nszfs18sk8/Tzar%20Soundtrack%204.mp3 2qza05mvhvojepw/Tzar%20Soundtrack%205.mp3 55yuwxmo3ebav3v/Tzar%20Soundtrack%206.mp3 d9ifze8utu7b1d4/Tzar%20Soundtrack%207.mp3 ewnlwat5mpm3a6i/Tzar%20Soundtrack%208.mp3 emy8tmk7wrbxqik/Tzar%20Soundtrack%209.mp3 0ryt8t85pu140ys/Tzar%20Soundtrack%2010.mp3 ux3nmflf1efo0si/sr1.mp3 mb8leyhrlx3a8ep/sr2.mp3 uepj5sz037fs6jm/sr3.mp3 aqgug89aiyh78ym/sr4.mp3 v4mnk06t1cm5g2x/sr5.mp3 nnkkl7jddynbbg8/sr6.mp3 0foqk5c3t91c0ll/sr7.mp3 cacamdny4wwisyj/sr8.mp3 m8mbt8r1vlj2i9l/sr9.mp3 ubig3no0l96pnxp/sr10.mp3 jajip2pw72hwz5q/1.mp3 eub8hy6mtuw12vk/2.mp3 mml4nqhhj0ph30d/3.mp3 p72cdqjbjc7oa6v/4.mp3 m895z5a7e1stzg1/5.mp3 ya1yue1ti1ehyo8/6.mp3 lfq7ac9jvtcb8tr/7.mp3 onxh886y06v9c1m/8.mp3 u01v2nu5u1mooma/9.mp3 hfvvah4t7ngs942/10.mp3 zghe44ohag94non/INTRO.mp3 bjdukzb5x2d148f/OUTRO.mp3 m335ymfbydtah6n/WIN1.mp3 j0nl2nra3633p0m/WIN2.mp3 9igi2qh7ixqej07/ATTACK.WAV d48c9woeedsefpq/BALLISTA.WAV toc4s5nzofcrl7a/BLDGDONE.WAV c8k3wd0wmlgxzbj/CHAT%20LOCATION.WAV ser4l9wo87txp9k/TECHDONE.WAV 9f37sjm7co5ccuj/UNITDONE.WAV 6xn0s3j79267158/CHAT.WAV v39gv0xmfobxhm6/E_CASTLE1.WAV 2d9cjalgge5ig3g/E_CATHEDRAL1.WAV xmfkvzft63m3ivi/E_CATHEDRAL2.WAV vzzhxrrqftezh2b/E_FARM1.WAV ftrazbogpf8foip/E_CHURCH1.WAV 961xangoq096ta1/E_FARM2.WAV 5927kzdwz5znu6o/E_HARBOR1.WAV wwjtlgwpm230rqx/E_LUMBER1.WAV a4buxao1lfo5txs/E_MAGETOWER1.WAV mgcz1j57ijivnrx/E_MAGETOWER2.WAV mlqr06rsg0ebg5c/E_MAGETOWER3.WAV jcut9rj4pedruuf/E_MARKET1.WAV m7rpubt227a2mqm/E_SHIPYARD1.WAV dtlikm0f72bqts6/E_STABLES1.WAV 189t8l14j3gfbcd/E_STORAGE1.WAV 6u92t20jjl2ibax/E_OUTPOST1.WAV o6psq5jg611te7h/E_STORAGE2.WAV jpnp0pwsjfajpqh/E_TAVERN1.WAV omdobwnv6ijrdk6/E_WARACADEMY1.WAV xfph6w0wl72iy14/E_WORKSHOP1.WAV m9nzrabgjly054c/EVILCASTLE.WAV o1vdoiexa6q41kd/GATE1.WAV 0i8okhmc24fie1i/GATE2.WAV gcic4rgv7th76g5/GATE3.WAV 1gcczjnk6800a0w/GATE4.WAV s35f76gtwm27r2t/GATE5.WAV jkkktkeqcinw0qk/GATE6.WAV 0qsz059kx5x0fna/GATEWAY.WAV dx4ykguy0c2gkec/HOUSE1.WAV 0bu3c206awygol8/HOUSE2.WAV ixuujwh5i34jqyn/HOUSE3.WAV gtsdx7aq1qo1af9/HOUSE4.WAV y89q2pti77rnl62/HOUSE5.WAV slzdb82f2pq9efh/MERCHANT.WAV hxb9ppcht4b1agh/MINE1.WAV kmvph19wybjvtk3/MONASTERY1.WAV trjbjumhpdq2r6c/MONASTERY2.WAV xdzl5qyez51vp0i/R_CATHEDRAL1.WAV 0jfe5axwda2zy9m/R_CHURCH1.WAV jp0ya01e6lovbpv/SHAOLIN2.WAV sa97rwaqc4bczzg/SHAOLIN.WAV ba9yor9562k8rmk/CHOP%201.WAV 0yq403uktwmaskq/CHOP%202.WAV oumccxj3ppx74lb/CHOP%203.WAV zjlmh6oyt9z80vn/CHOP%204.WAV 8q3x45ooavhgdxf/CHOP%205.WAV tyyuf0ai2b7td9d/CHOP%206.WAV mxk7ilq612mco8y/CHOP%207.WAV vi1nql8csgxue0d/CHOP%208.WAV ptkzwv8er5r250q/CHOP%209.WAV e47rp6twlz7cvor/CHOP%2010.WAV swpbug0t56ool1r/CHOP%2011.WAV 2ddruqf84gi974h/DIG%201.WAV mdv1kf8bb7e6bwj/DIG%202.WAV u7h8iw95x8ufogy/DIG%203.WAV myb354s27trhsgb/MINE%201.WAV 3jca7grtu2uphde/MINE%202.WAV 0sgl0kc77mryj1j/MINE%203.WAV ry9mlisv1lqqp9d/HIT%201.WAV 2ufyfcq4wu9bk1i/HIT%202.WAV cqzlr7gy6mj0k66/HIT%203.WAV i86tqxj1sz91cru/HIT%204.WAV vf604r6t01qe6zd/HIT%205.WAV mnslicm4wy9wdj0/HIT%206.WAV p1ta2wlhfse37db/HIT%207.WAV emwp2hib6msgj22/GHOST1.WAV lrsl9rbxku5cjg7/GHOST2.WAV txbl2bb91s38dqx/GOLEM1.WAV pcfkaldpd7hfrjp/GOLEM2.WAV ivfai5ayu6q99yx/H%20SWORD%201.WAV gedtsneew008x4h/H%20SWORD%202.WAV 57xjkhtc93001et/H%20SWORD%203.WAV ni97b3dbi91yr8b/H%20SWORD%204.WAV 0ls1kz4but9zl51/H%20SWORD%205.WAV ks9mme9djnvdyi5/H%20SWORD%206.WAV hlinmaxi6xj6mv2/H%20SWORD%207.WAV hlinmaxi6xj6mv2/H%20SWORD%207.WAV dt4o378w3100sfu/H%20SWORD%208.WAV ks909spplow4fjz/H%20SWORD%209.WAV w2xfv47ffd7sb72/H%20SWORD%2010.WAV ypapwgz03m7utmq/H%20SWORD%2011.WAV zdcr00adm5qc6hs/H%20SWORD%2012.WAV y90qo1djcx5bzxa/HAND1.WAV 56vhwy7iiu9cpzy/HAND2.WAV 6zhms0m94qg4mvt/HAND3.WAV 41wm4r3cpgjaxly/HAND4.WAV tt4q17tzh6i7u1g/MAGE%20ATTACK.WAV ldhx6mr9upxefci/MESSIAH.WAV 07mie3az1eg1xxh/ORC%20SWORD%201.WAV 9v7spriyxf9szgh/ORC%20SWORD%202.WAV gcfojobbzl2drpn/ORC%20SWORD%203.WAV x0wz0zwpye9i5y3/ORC%20SWORD%204.WAV 2300jmtwppvm452/ORC%20SWORD%205.WAV 3yz2rottu8o8ggt/ORC%20SWORD%206.WAV x5s65vpufpj8t06/ORC%20SWORD%20V1.WAV 0nrb17mzbu3lxtc/ORC%20SWORD%20V2.WAV cypkkpihc1w1hcq/ORC%20SWORD%20V3.WAV y8umilh5cud7jih/SHIP%20CANNON%201.WAV 09kjxvpfn9bdprd/SHIP%20CANNON%202.WAV atj8b8w1k24aqfm/SHIP%20CANNON%203.WAV 6ju34h2pw3nhg7s/SHIP%20CANNON%204.WAV l18s2fbq9q6nzpm/SHIP%20CANNON%205.WAV vrgh4puvgdbpwae/SHIP%20CANNON%206.WAV tmbpku710qnx85q/SHIP%20CANNON%207.WAV 2nomenens1x41lf/SIEGE.WAV 8t9zd51oee3n6vw/SWORD%201.WAV gmwu6lxjaf4mxvv/SWORD%202.WAV tfjzh0u37b60xfc/SWORD%203.WAV s0w71lijsebscys/SWORD%204.WAV 63xcxvtf6fz4nmv/SWORD%205.WAV qpqihts3djiavqd/SWORD%206.WAV zw2cqwnqq5bo3aw/SWORD%207.WAV ub1hntg5qh5h58k/SWORD%208.WAV r4viyma73vblsf5/SWORD%209.WAV 8lxp86hri1yejyt/SWORD%2010.WAV r63199ryslobulc/SWORD%2011.WAV ph48z41qbgbaina/SWORD%2012.WAV o87veypm8qensdd/SWORD%2013.WAV fwapbo29d97mer1/SWORD%2014.WAV tyzv9eybfmt378i/SWORD%2015.WAV 0164fmqamf7yr9s/SWORD%2016.WAV c9renf4qsr56ab4/V%20SWORD%201.WAV gge4f1nb5o7m9qd/V%20SWORD%202.WAV wo0f0ul88unnh01/V%20SWORD%203.WAV q48z5txon4bv76v/V%20SWORD%204.WAV kibmb5mtp1oasan/V%20SWORD%205.WAV 360bl44ii251dus/V%20SWORD%206.WAV oya931j5cn584vn/V%20SWORD%207.WAV rgh3xwlvihecsur/ADRAGON2.WAV jafi9t4hdx4gjnu/ADRAGON3.WAV p7yau58i9x9tznf/ARROW%201.WAV 16jf0mu2c4902ad/ARROW%202.WAV 3gf1vmhszlzsvp6/ARROW%203.WAV hastp290kjpatul/ARROW%204.WAV rzf63kcptscqqb6/ARROW%205.WAV ueysrsca11dznn1/ARROW%206.WAV 2l7ncb4kro91hjp/ARROW%20V1.WAV 6z1zfcuve202wlt/ARROW%20V2.WAV 4al06dvukghp9p8/ARROW%20V3.WAV y3cj0obmsklz7kb/ARROW%20V4.WAV zopzovz1zdos9qn/BEAR1.WAV glbc40fzxrz7x4u/BEAR2.WAV mq7830e9lsw539i/BEAR3.WAV s5h4p53936jqf0m/BEAR4.WAV at4kj0gz88632rt/BEAR5.WAV uq2u4sgg8g6tmou/MWORKSHOP.WAV 09hjcqjlhkgwjsi/DESTROY%20BUILDING.WAV rxan7ebabmxn77z/DESTROY%20MINE.WAV pcwbjrjklna7q57/LIGHTING2.WAV uv2jv59kstujpap/LIGHTING.WAV 6omy17asgyyvcdg/METEOR.WAV r193yz5l7k7yb2i/SMALL%20EXPLOSION.WAV os6jelw7rx49obm/WATER%20BLOP.WAV tjdz2vmlil8c8ud/SPY%20KILL%201.WAV z9tqra8z2pj8fto/SPY%20KILL%203.WAV l85d5424o8s1tq3/SPY%20KILL%202.WAV 97k844atrp03l71/PRIEST%20ATTACK.WAV 2rs81eunjj79t8m/LIGHTNING.WAV i16vdcztiiyd9pl/INVISIBLE.WAV 01a581w494e6nc3/HEAL.WAV v0f62hdvhy2vhiw/FREEZE.WAV e9xkwqnmq1h3xii/FLAME%20BALL.WAV yn1958raqi2el4a/CURSE.WAV 455t0hvitbn4nns/CRUSADE.WAV 1wl7qmtar3y1j2v/CONFUSION.WAV fz21lqeozbq043o/BLESS.WAV xyq2n7ixn80pyn5/WHIRLPOOL.WAV 1t99pip34fvthkq/TURN%20TO%20STONE.WAV jdclsge6rjo7vgo/TEACH.WAV xt7pqtetzsvtgai/SUMMON10.WAV yxcdbheu9s6sqbp/SUMMON9.WAV oum26s9h0mkg6ya/SUMMON8.WAV 46cvrb8px83r1ze/SUMMON7.WAV of68oo8ne7cgdtw/SUMMON6.WAV 3awiprcaujqvohu/SUMMON5.WAV 5kq2b6q3d8ncpww/SUMMON4.WAV avx69olt3m6rrnr/SUMMON3.WAV m08n1qafeiyqe05/SUMMON2.WAV ui2kvbd47bfmx2b/SUMMON1.WAV k8qekk7sutmpcot/REVEAL.WAV 0q9fghfa9qhq5qw/RESSURECT.WAV cb1pq0ssnmj4jic/COWDIE1.WAV f7wgvizjaklyf7n/COWDIE2.WAV cb1pq0ssnmj4jic/COWDIE1.WAV y5zib4fpfywsurg/COWDIE3.WAV oy9j73ss27gix5z/COWDIE4.WAV 1eyn0em70qu0f2i/DIE%201.WAV 27kh2wyo2o9znoz/DIE%202.WAV u572ytnhxy4km3h/DIE%203.WAV 182gaz77ml2mei7/DIE%204.WAV wpvdhtxbe6yy29z/DIE%205.WAV un94l6ebn0l9y2p/DIE%206.WAV 3k2ph5z9vm6ytvz/DIE%207.WAV hjnvqvyet103hf7/DIE%208.WAV umjfyhfxku3dwvp/DIE%209.WAV x1evcyyuhwy2vd3/DIE%2010.WAV xzk59hp6c4wdk3t/DRAGON%20DIE%201.WAV ar7eck4ow8r5w3s/DRAGON%20DIE%202.WAV emwp2hib6msgj22/GHOST1.WAV lrsl9rbxku5cjg7/GHOST2.WAV 6at0jqhx4dza704/GOLEM.WAV h5ydq4j2zdpkiu8/H%20DIE%201.WAV 1bp2u30m504f314/H%20DIE%202.WAV r5kdxiuj8chfl55/H%20DIE%203.WAV 0gubmigjng965ss/H%20DIE%204.WAV 4xzstnrfwevpx21/H%20DIE%205.WAV pnrvg1i5b0jf50i/H%20DIE%206.WAV wkzig2jil3z2hgi/H%20DIE%207.WAV ue13nwsyc6t5ox9/H%20DIE%208.WAV dxk8rptrddombo8/H%20DIE%209.WAV tsdk3uma1x5rz2v/H%20DIE%2010.WAV i3x6klg1g1tx9xx/MAGE.WAV t7c9h3ntknga8i7/ORC%20DIE%201.WAV zwf40uvu5rdu1wy/ORC%20DIE%202.WAV p9gga0rk3ftkkdf/SHIP%20SINK.WAV 5ihoed06p5cm26r/SIEGE%20DIE%201.WAV tahsd6hynfrv1qg/SIEGE%20DIE%202.WAV xboh1sh4rbvx88r/SIEGE%20DIE%203.WAV 4chclvk26ech3mz/SIEGE%20DIE%204.WAV w401vbbvvj99msr/SKELETON%20DIE%201.WAV 0ff119o39785ttm/SKELETON%20DIE%202.WAV 6lxfa75vtxfl2bb/SKELETON%20DIE%203.WAV f3aokr2ngvqpfit/SKELETON%20DIE%204.WAV omfzz21cazinkkm/MESSIAH_ATTACK.WAV 1w2vexiw5aqtrw4/C%20DIE%201.WAV h32280ztxrrz5aa/C%20DIE%202.WAV rq5rgbwaynrdtfc/C%20DIE%203.WAV usywc7awecnolh0/C%20DIE%204.WAV x33opiu95eb78ie/C%20DIE%205.WAV 4lo6hly2n52aq5b/CAMELDIE1.WAV gwsglwtm1fg2eqf/CAMELDIE2.WAV u3mxrmlb10sje2u/CAMELDIE3.WAV nw0ipg198lvq519/BAT%20ATTACK.WAV hukqtscgut9xic7/BAT%20CMD.WAV 77915sxy83vzump/BAT%20DIE.WAV".split(" "),
zg=function(){if(!mc){var e=function(b,e,d){e=e.split("/")[1].split(".")[0].toLowerCase();af[e]=b;!d||d.music&&d.mid!=Fa.id||(qa(e,d.x,d.y,d.k,d.music,d.date),d.date=0)},b=function(b,e,d){this.context=b;this.urlList=e;this.onload=d;this.loadCount=0};b.prototype.loadBuffer=function(b,d){var c=new XMLHttpRequest;c.open("GET",h+b,!0);c.responseType="arraybuffer";c.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");var f=this;c.onreadystatechange=function(){4===c.readyState&&
200===c.status&&f.context.decodeAudioData(c.response).then(function(c){c&&e(c,b,d)})};c.send()};for(var d=0,c=Mg.length;d<c;d++){var g=Mg[d];af[g.split("/")[1].split(".")[0].toLowerCase()]=g}rd="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206 arrow%20v1 arrow%20v2 arrow%20v3 arrow%20v4".split(" ");Ye="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206".split(" ");Ac="sword%201 sword%202 sword%203 sword%204 sword%205 sword%206 sword%207 sword%208 sword%209 sword%2010 sword%2011 sword%2012 sword%2013 sword%2014 sword%2015 sword%2016 v%20sword%201 v%20sword%202 v%20sword%203 v%20sword%204 v%20sword%205 v%20sword%206 v%20sword%207".split(" ");
Ze=["siege"];Ng=["hand1","hand2","hand3","hand4"];Pd="h%20sword%201 h%20sword%202 h%20sword%203 h%20sword%204 h%20sword%205 h%20sword%206 h%20sword%207 h%20sword%208 h%20sword%209 h%20sword%2010 h%20sword%2011 h%20sword%2012".split(" ");Li=["ork%20sword%20v1","ork%20sword%20v2","ork%20sword%20v3"];Qd="ship%20cannon%201 ship%20cannon%202 ship%20cannon%203 ship%20cannon%204 ship%20cannon%205 ship%20cannon%206 ship%20cannon%207".split(" ");Mi=["ghost%201","ghost%202"];Ni=["mage%20attack"];L=["destroy%20building"];
$e=["siege%20die%201","siege%20die%202","siege%20die%203","siege%20die%204"];Rd="h%20die%201 h%20die%202 h%20die%203 h%20die%204 h%20die%205 h%20die%206 h%20die%207 h%20die%208 h%20die%209 h%20die%2010".split(" ");Wa="die%201 die%202 die%203 die%204 die%205 die%206 die%207 die%208 die%209 die%2010".split(" ");Og=["e_barrack1"];var h="https://dl.dropboxusercontent.com/s/";if("undefined"!==typeof AudioContext){window.AudioContext=window.AudioContext||window.webkitAudioContext;mc=new AudioContext;var l=
mc.createGain();var p=mc.createGain();var t=new b(mc,void 0,e);P("Sound: OK");l.gain.value=parseInt(document.getElementById("musicRange").value)/100;p.gain.value=parseInt(document.getElementById("soundRange").value)/100}Fa=function(){if(!q.editor){Fa.id++;localStorage.setItem("favMusic",musicSelect.mversion.value);var b=Fa.list[musicSelect.mversion.value];b&&qa(b[~~(b.length*Math.random())],0,0,void 0,1,0,Fa.id)}};document.getElementById("musicRange").oninput=function(){l.gain.value=parseInt(document.getElementById("musicRange").value)/
100};document.getElementById("soundRange").oninput=function(){p.gain.value=parseInt(document.getElementById("soundRange").value)/100};Fa.reset=function(){Fa.stop();Fa()};Fa.stop=function(){Fa.active&&(Fa.active.stop(),clearTimeout(Fa.intv))};Fa.id=0;Fa.list={originalMusic1:[1,2,3,4,5,6,7,8,9,10,"outro"],originalMusic:"tzar%20soundtrack%201 tzar%20soundtrack%202 tzar%20soundtrack%203 tzar%20soundtrack%204 tzar%20soundtrack%205 tzar%20soundtrack%206 tzar%20soundtrack%207 tzar%20soundtrack%208 tzar%20soundtrack%209 tzar%20soundtrack%2010".split(" "),
sharpRain:"sr1 sr2 sr3 sr4 sr5 sr6 sr7 sr8 sr9 sr10".split(" ")};qa=function(b,e,d,c,f,g,h){var n=b;if((b=af[b])&&"loading"!==b&&!q.canceled){var m=-pb+(window.innerWidth-w.mx)/2,k=-ma+window.innerHeight/2;if(b.duration){if(q.started)if(64<q.now()-b.lastPlayed||!b.lastPlayed)b.lastPlayed=q.now();else return;if(!(!f&&"attack"!=n&&g&&600<Date.now()-g)){if(e){e=-m+32*e;d=-k+32*d;k=ba;if(e*e+d*d>Math.pow(2E3,2))return!1;e/=80;d/=80;k/=8}else k=d=e=0;void 0!==c&&c!==w.kingdom||q.mute||(c=mc.createBufferSource(),
c.buffer=b,f?(c.connect(l),l.connect(mc.destination),Fa.active=c,Fa.intv=setTimeout(Fa,~~(1E3*b.duration)+1E3)):(b=mc.createPanner(),b.panningModel="HRTF",b.setPosition(e,d,k),c.connect(b),b.connect(p),p.connect(mc.destination)),c.start(0))}}else af[n]="loading",f={x:e,y:d,k:c,music:f,date:Date.now(),mid:h},t.loadBuffer(b,f)}};b=document.getElementById("musicSelect").getElementsByTagName("input");d=0;for(c=b.length;d<c;d++)b[d].onchange=Fa.reset}},Sd=function(e,b,d,c){e.img===c.url&&(qa(b+~~(Math.random()*
d+1),e.x32,e.y32),setTimeout(Sd,rb(c),e,b,d,c))};"use strict";var gl=function(e){for(var b=[],d=0,c=[e.icons],g=0,h=c.length;g<h;g++)for(var l=c[g],p=0,t=l.length;p<t;p++)if(l[p]){var n=l[p];n.doneBy||(n.doneBy=[]);n.doneBy.put(e);b[d++]=n;n.xtra&&(c.put(n.xtra),h++)}e.habilities=b},hl=function(e,b){return b.balanceTotal-e.balanceTotal},Pg=function(e,b){return b.priority-e.priority},il=function(e,b){return e-b},bf=function(e,b){if(!e.url.attack||e.attackOnly&&!e.attackOnly[b.type])return 0;var d=
25*~~(rb(e.url.attack)/25);e=e.attack*((sd[e.type][b.type]||0)+1);e-=b.defence;1>e&&(e=1);return~~(b.health/e)*d},Qa=function(e){this.kingdom=e.k;this.aggressive=this.perfection=1;this.cantBuild={};e.IAD=Qa.arr.length;Qa.arr.put(this)};Qa.prototype.valorateLost=function(e){this.script.put({order:e.nu,obj:e,priority:1})};var Qg=function(){},Rg=function(e,b,d,c,g){var f=d.obj.cost;c[0]+=f[0];c[1]+=f[1];c[2]+=f[2];c[3]+=f[3];e[e.length]={order:d,priority:b.priority,name:d.obj.name,obj:d.obj,pTime:b.obj.time,
required:1,doner:g};e.changed=!0},Sg=function(e,b,d,c,g){var f=[e],l=[],p={},t=g.target;l.put(e);for(var n=0;n<f.length;n++){var m=f[n];m.availables&&(m.availables=void 0);if((e=m.order)&&!p[m.order.id]&&(p[m.order.id]=1,!d[e.id])){var k=e.requireObj;if(k)for(var u=0,q=k.length;u<q;u++)if(e=k[u],e.tech)b[e.nu.id]||d[e.nu.id]||Rg(f,m,e.nu,t);else{var r=c[e.type];r.length||Rg(f,m,e.nu,t)}if(k=e.doneBy)for(u=0,q=k.length;u<q;u++)e=k[u],r=c[e.type],r.length||e.race!=g.racestr||Rg(f,m,e.nu,t,1);n&&!m.doner&&
l.put(m)}}return l},Tg={food:2,wood:1,gold:0,stone:3},Pc=function(e,b){e=e.order;var d=e.obj,c=Pc.tech;d.build?c=Pc.build:d.tech||(c=Pc.unit);return c(e,b)};Pc.unit=function(e,b){e=e.doneBy;if(b.pop<b.popMax)for(var d=0,c=e.length;d<c;d++)for(var g=b[e[d].type],h=0,l=g.length;h<l;h++)if(g[h].free)return g[h].free=0,[g[h]];return!1};Pc.tech=function(e,b){e=e.doneBy;for(var d=0,c=e.length;d<c;d++)for(var g=b[e[d].type],h=0,l=g.length;h<l;h++)if(g[h].free)return g[h].free=0,[g[h]];return!1};Pc.build=
function(e,b){e=e.doneBy;for(var d=0,c=e.length;d<c;d++)for(var g=b[e[d].type],h=0,l=g.length;h<l;h++)if(g[h].free)return g[h].free=0,[g[h]];return!1};var Bc=function(e,b){if(e){var d=e.order,c=d.obj,g=Bc.unit;c.tech?g=Bc.tech:c.build&&(g=Bc.build);return g(d,b,e)}};Bc.build=function(e,b){var d=Qa.arr[b.IAD];if(4<=d.cantBuild[e.obj.type]&&b.stats.buildsLosed==d.buildsLosed)return!1;for(var c=[],g=e.doneBy,h=hb[b.k],l=0,p=g.length;l<p;l++)for(var t=h[g[l].type],n=0,m=t.length;n<m;n++){var k=y[t[n]];
if(!k.func&&!k.in){c.put(k.id);break}}if(!c.length)return!1;g=F;k=e.obj;e=k.space;h=k.validator.check;t=b.origin[0];m=b.origin[1];var u=m-1,q=t-1,r=-1;l=1;for(var w=t,x=m;0>r&&40>t-w;){--w;--x;var z=2*l+1,A=2*l+1;n=0;for(p=z*A;n<p;n++){var E=n%z,B=~~(n/z);if(!E||!B||E==z-1||B==A-1){E+=w;B+=x;var D=(E-t)*(E-t)+(B-m)*(B-m);if(1600>D&&h(E,B,e,u,q,900>D,b.k)){r=E+B*g;break}}}l++}if(0>r)return d.cantBuild[k.type]||(d.cantBuild[k.type]=0),d.cantBuild[k.type]++,d.buildsLosed=b.stats.buildsLosed,!1;d.cantBuild[k.type]&&
(d.cantBuild[k.type]=0);fa(td,[r,k.type],c);return!0};Bc.tech=function(e,b){var d=e.doneBy;b=hb[b.k];for(var c=[],g=0,h=d.length;g<h;g++)for(var l=b[d[g].type],p=0,t=l.length;p<t;p++){var n=y[l[p]];n.working||n.techStart||!n.built||c.put(n.id)}if(!c.length)return!1;fa(Ug,[e.obj.id,e.id],c[0]);return!0};Bc.unit=function(e,b,d){d=e.doneBy;b=hb[b.k];for(var c=[],g=0,h=d.length;g<h;g++)for(var l=b[d[g].type],p=0,t=l.length;p<t;p++){var n=y[l[p]];n.working||n.techStart||!n.built||c.put(n.id)}if(!c.length)return!1;
fa(cf,[e.obj.type,1,0],c[0]);return!0};Qa.prototype.leaveMeAloneIKnowWhatToDo=function(){performance.now();var e=E[this.kingdom],b=e.resources,d=hb[this.kingdom],c=F;if(e.origin){for(var g=e.origin[0],h=e.origin[1],l=h-1,p=g-1,t=g-40,n=h-40,m=0,k=6400,u=0;u<k;u++){var r=u%80+t,w=~~(u/80)+n;1600>(g-r)*(g-r)+(h-w)*(h-w)&&(!(r>=p&&r<=p+2)||w>=l&&w<=l+2)&&0===O[r+w*c]&&pa(r,w)&&m++}var x=[];performance.now();for(var z=0,D=0,na=A.length;D<na;D++){var ea=A[D];if(!ea.build&&!ea.item&&!ea.boat&&ea.url.attack&&
ea.race==e.racestr&&8!=ea.type){x.put(ea);ea.balanceSum=0;ea.bestBalance=-1;ea.balanceDefence={};for(var H=Infinity,G=ea.attDist,J=0;J<na;J++){var L=A[J];if(!L.build&&!L.item&&!L.boat&&L.race==e.racestr&&L.url.attack&&8!=L.type&&(z=bf(L,ea))){var N=bf(ea,L);N&&(z-=N,z+=2E3*G,z<H&&(H=z,ea.bestBalance=L),ea.balanceSum+=z)}}}ea.balanceTotal=ea.balanceSum}x.sort(hl);ea=x[0];for(var K=1E3,M={},yc=[],Q=0,U=K;!M[ea.type];)M[ea.type]=1,yc[Q++]=ea,yc[Q++]=K,L=ea.bestBalance,K=~~(K*bf(L,ea)/bf(ea,L)+.5),U+=
K,ea=L;yc.nu=U-K;for(var S=e.target,T=B,W=T.length,R=[],V=0;V<W;V++){var I=T[V],ba;if(!(ba=!I.type||I.upgrade||I.type==X||void 0!==Tg[I.value]&&e.resources[I.value]>=S[I.value])){a:{for(var fa=I.nu.doneBy,aa=0,Y=fa.length;aa<Y;aa++)if(fa[aa].race==e.racestr){var ca=!0;break a}ca=!1}ba=!ca}ba||R.put({order:I.nu,obj:I,original:1,priority:1E-10})}var ha=[];u=0;k=yc.length;for(var ja=yc.nu;u<k;u+=2){var ta=~~(.5+yc[u+1]/ja*250)-d[yc[u].type].length,Z=yc[u];Z=Z.nu;for(var ia=0;ia<ta;ia++)R.put({order:Z,
priority:1-ia/ta,obj:Z.obj,original:1})}var la=0,sa=0,ua=e.target,ra={};sa++;ua[0]=0;ua[1]=0;ua[2]=0;ua[3]=0;u=la=ha.length=0;for(k=R.length;u<k;u++){var xa=R[u].priority,oa=Sg(R[u],e.technology.actived,e.technology.hidden,d,e);ia=0;for(var wa=oa.length;ia<wa;ia++){Z=oa[ia];Z.original||(Z.priority=xa);var qa=1;void 0!==Z.priority&&(qa=Z.priority);var va=Z.obj;va.increase&&void 0!==Tg[va.value]&&(qa=va.increase*qa/b[Tg[va.value]]);qa/=va.time;Z.priority=qa;if(!(0>=Z.priority)){var ya=Z.order.id;!ra[ya]||
Z.original?(ra[ya]=la,ha[la++]=Z):ha[ra[ya]].priority+=Z.priority}}}var Ia=!1;ha.sort(Pg);var Ma={},Ta={},Da={},ka=[],Fa=A.length;for(u=0;u<Fa;Da[u++]=0);for(u=0;u<ha.length;u++){var da=ha[u];Z=da.order;var lb=da.obj;if(da.original||da.required)da.obj.tech||Da[da.obj.type]++,ka.put(da);var Sa=Z.doneBy,Oa=lb.time;ia=0;for(k=Sa.length;1>ia;ia++){var za=Sa[ia],Ja=za.time;if(lb){for(var bb=za,Xa=d[za.type],La=Qa.process,cb=Oa,db=Xa.length,Ca=!1,ib=Infinity,Ba=0;Ba<db;Ba++){var Aa=y[Xa[Ba]],gb=0;Aa.build&&
(Aa.working||Aa.techStart||!Aa.built)&&(Aa.built?(gb=(Aa.c-q.cycle)*Cc.speed,gb/=1E3):(gb=Aa.time*(Aa.maxHealth-Aa.health)/Aa.maxHealth,Aa.workers&&Aa.workers.length&&(gb/=Aa.workers.length)));Aa.build||!Aa.func&&!Aa.in||(gb=Infinity);Aa.nato!=La?(Aa.nato=La,Aa.natoTime=0):gb+=Aa.natoTime;gb<ib&&(ib=gb,Ca=Aa)}Ca&&ib<=bb.time?(Ca.natoTime+=cb,Ia=Ca):Ia=!1}if(!Ia){Ma[za.type]||(Ma[za.type]=[],Ta[za.type]=[]);var Za=Ma[za.type],Ua=Ta[za.type];Da[za.type]||(Da[za.type]=0);var Ea=!1,kb=0;for(wa=Za.length+
1;kb<wa;kb++){if(void 0==Za[kb]){var ab={order:za.nu,priority:0,obj:za};ha.put(ab);ka.put(ab);Za[kb]=0;Ua[kb]=ab;Da[za.type]++;Ea=!0}if(Za[kb]+Oa<=Ja||Ea){Za[kb]+=Oa;Ua[kb].priority+=da.priority;break}}}}}ka.sort(Pg);var Ka=0;u=0;for(k=ka.length;u<k;u++)if(da=ka[u].obj,da.build){var jb=da.space[da.space.length-1]+2;Ka+=jb*((da.space.length-1)/jb+2)}P(Ka,m);if(Ka>m){var rb=m/Ka*.7;u=0;for(k=A.length;u<k;u++)A[u].build&&(da=Da[u])&&((da=~~(da*rb))||(da=1),Da[u]=da)}u=0;for(k=ka.length;u<k;u++)da=ka[u].obj,
da.build&&(Da[da.type]?Da[da.type]--:ka[u]=0);for(var xb=0;1>xb;xb++){var Ya=[],nb={},ub={},$a={pop:0,popMax:200},qb={},Wa=[[]],tb=[0];u=0;for(k=d.length;u<k;u++){qb[u]=0;da=d[u];var Ra=[];$a[u]=Ra;kb=0;for(wa=da.length;kb<wa;kb++)Ra[kb]={free:1,type:u}}for(la=0;la<tb.length;la++){var Na=tb[la],pb=Wa[Na];u=0;for(k=pb.length;u<k;u++){var ma=pb[u],mb=ma.list;kb=0;for(wa=mb.length;kb<wa;kb++)da=mb[kb],da.used||(qb[da.type]++,da.used=1,Ya.put(da.action),!da.action||da.action.obj.build||da.action.obj.tech||
$a.pop++),da.free=1;if(ma.obj.tech){nb[ma.obj.nu.id]=1;var sb=ma.obj;"popLimit"==sb.value&&($a.popMax+=sb.increase)}else $a[ma.obj.type].put({free:1,type:ma.obj.type,action:ma.action})}u=0;for(k=ka.length;u<k;u++)if(da=ka[u]){var Va=da.obj;if(1===Sg(da,nb,ub,$a,e).length&&(mb=Pc(da,$a))){var Ha=da.obj.time+Na;Wa[Ha]||(Wa[Ha]=[],tb.put(Ha));if(da.obj.tech){if(ub[da.order.id])continue;ub[da.order.id]=1}if(da.original||da.required)Ya.put(da),Va.build||Va.tech||$a.pop++;Wa[Ha].put({list:mb,obj:da.obj,
action:da});ka[u]=void 0}}tb.sort(il)}ka=Ya;ka.sort(Pg)}this.script=ka}};var Vg=function(){for(var e=0,b=Qa.arr,d=b.length;e<d;b[e++].maintenance());Xa({func:Vg},Qa.time,1);Qa.process++};Qa.prototype.maintenance=function(){var e=this.script;if(e){var b=E[this.kingdom];if(b.origin){var d=b.technology,c=d.actived,g=d.hidden,h=hb[b.k];d=F;var l={};if(b.values.pop+b.unitLoading>b.values.popMax&&b.values.popMax<=b.values.popLimit){for(var p=mb[b.race].house.nu,t=1,n=0,m=Td.length;n<m;n++)t+=h[Td[n].type].length*
Td[n].population;t+b.unitLoading>b.values.popMax&&t<=b.values.popLimit&&Bc({order:p,priority:1,obj:p.obj},b)}n=0;for(m=e.length;n<m;n++)(p=e[n])&&!l[p.order.id]&&1===Sg(p,c,g,h,b).length&&(Bc(p,b)?e[n]=0:l[p.order.id]=1);e=!1;l=Infinity;var k=b.diplomacy;g=b.origin[0];h=b.origin[1];c=hb[b.k];n=1;for(m=E.length;n<m;n++)if(k[n]&&!E[n].death&&E[n].origin){p=E[n];t=p.origin[0]-g;var u=p.origin[1]-h;b=t*t+u*u;b<l&&(l=b,e=p)}if(e){b=[];n=t=0;for(m=c.length;n<m;n++)for(u=c[n],l=0,k=u.length;l<k;l++)p=y[u[l]],
void 0!=p.func||p.standardFunc!=S||p.death||(b[t++]=p.id);if(60<b.length){c=e.origin[0];k=e.origin[1];p=[40,0,-40,0,0,40,0,-40];l=Infinity;n=0;for(m=p.length;n<m;n+=2)if(t=p[n],u=p[n+1],t+=g+10*Math.sign(t),u+=h+10*Math.sign(u),(t-c)*(t-c)+(k-u)*(k-u)<l&&pa(t,u)){l=(t-c)*(t-c)+(k-u)*(k-u);var q=t+u*d}m=q%d;g=~~(q/d);h=-1;t=Infinity;c=hb[e.k];n=0;for(length=c.length;n<length;n++)for(e=c[n],l=0,u=e.length;l<u;l++)p=y[e[l]],k=(p.x32-m)*(p.x32-m)+(p.y32-g)*(p.y32-g),k<t&&(t=k,h=p.x32+p.y32*d);-1<h&&fa(Oi,
[q,h],b)}}}}};var Oi=function(e,b){var d=F,c=e[0];e=e[1];var g=e%d;d=~~(e/d);for(var h=0,l=b.length;h<l;h++){var p=y[b[h]];6400<(p.x32-g)*(p.x32-g)+(p.y32-d)*(p.y32-d)?sa(-c,p,Ud,p.url.move):sa(-e,p,Ud,p.url.move)}Wg(b);Xa({func:Pi,data:{list:b,xy:-e}},3E4,1)},Pi=function(e){var b=e.list;e=e.xy;for(var d=0,c=b.length;d<c;d++){var g=y[b[d]];g.death||sa(e,g,Ud,g.url.move)}},jl=function(e,b,d,c){var f=F,h;for(h=2;60>=h;h+=2){e--;b--;for(var l=0;l<=h;){var p=O[e+l+f*b];if(2<p&&p!=c&&y[p].type==d)return p;
p=O[e+l+f*(b+h)];if(2<p&&p!=c&&y[p].type==d)return p;l++}for(l=0;l<h-1;){l++;p=O[e+f*(b+l)];if(2<p&&p!=c&&y[p].type==d)return p;p=O[e+h+f*(b+l)];if(2<p&&p!=c&&y[p].type==d)return p}}return!1},Qi=function(e){var b=e.x32+e.y32*F,d=E[e.kingdom].diplomacy;!e.invisible&&jc[b]&&(b=y[jc[b]],d[b.kingdom]&&nc(e.id,[b.id],0,ud))},Hd=function(e){var b=Xg(e.id);return b?(nc(b,[e.id],0,ud),!0):!1},Xg=function(e,b){e=y[e];if(!e.freezed&&!e.invisible&&!1!==e.built){var d=e.x32,c=e.y32,g=E[e.kingdom].diplomacy,h=
e.sight;e.build&&(h=e.attDist);var l=F,p=2*h+1,t=!!e.confused,n=0;b&&(n=h-b);for(var m=Infinity,k=!1,u=0,q=p*p;u<q;u++){var r=u%p-h,w=~~(u/p)-h,x=Math.sqrt(r*r+w*w);if(x<=h&&x>=n&&(r+=d,w+=c,pa(r,w)))for(var z=0;3>z;z++){b=ib[z][r+l*w];var A=y[b];if((A&&A.kingdom&&(g[A.kingdom]||A.confused)||t)&&!(A.death||A.invisible||e.attackOnly&&!e.attackOnly[A.type]||b==e.id||A.item)){var B=sd[e.type][A.type];B||(B=0);A=x*x+.05*A.health-(B+1)*e.attack;A<m&&(k=b,m=A)}}}return k}},kl=function(e){e.setupINTV(Ri,
e.id,1E3)},Ri=function(e){e=y[e];var b=e.free;b||(b=Si);var d=F,c=e.x32,g=e.y32,h=[];h.length=E.length;for(var l=h.length,p=0;p<l;h[p++]=0);p=0;for(var t=b.length;p<t;p+=2){var m=b[p]+c,k=b[p+1]+g;pa(m,k)&&(m=y[O[m+k*d]],m.nocapture||m.build||h[m.kingdom]++)}d=b=0;for(p=1;p<l;p++)h[p]>b&&(d=p,b=h[p]);b&&e.kingdom!=d&&e.changeKingdom(d);Pb(e,1E3)},df,ll=[1,1],Ti=function(){return 25*(Date.now()-q.loadDate+q.pausedTime+q.deltaTime)/Cc.speed},cc=function(e){if(!(e&&q.online||cc.bySystem&&e))if(0===q.paused){q.paused=
1;void 0!=df&&clearInterval(df);var b=q.now();q.pausedTime+=Date.now();e||(cc.bySystem=1);q.now=function(){return b}}else q.pausedTime-=Date.now(),q.paused=0,cc.bySystem=0,e&&(document.getElementById("alert").style.display="none"),df=setInterval(Cc,Cc.speed),q.now=Ti};cc.bySystem=0;var Qb=function(e,b){var d=!1;if(1>e){e*=-1;var c=~~(e/ua),g=e%ua}else d=e;e=0;for(var h=b.length;e<h;e++){var l=y[b[e]];l.build||l.cow&&l.workers.length||d==l.id||(l.action=null,l.distance=0,l.mv&&null!=l.xf?(d?(l.xf=
d,l.yf=!0):(l.xf=g,l.yf=c),l.nodes=void 0):l.x32==g&&l.y32==c?l.stay():(l.dix=(g-l.x32)/Math.abs(g-l.x32),l.diy=(c-l.y32)/Math.abs(c-l.y32),d?(l.xf=d,l.yf=!0):(l.xf=g,l.yf=c),l.mv=!0,l.setupINTV(Vd,l.id,0),Yg(l),l.action=null))}},Yg=function(e){e.stock&&0!==e.stock[0]?(e.mimg=e.url[e.stock[4].url],e.stock[3]===Dc&&(e.mimg=e.url.milk)):e.mimg=e.url.move};Qb.cursor=7;Qb.allowPos=1;var Pb=function(e,b,d){b=~~(b/25)+q.cycle;d=Qc[b];d||(d=[],Qc[b]=d);var c=d.length;e.c=b;d[c]=e.id;e.timestamp=q.now()},
Qc={},ef=function(e){var b=y[e[0]];if(!b.death){var d=e[1],c=e[2],g=e[3];b.cow&&"milk"==d&&b.workers&&b.workers.length||(b[d]+=E[b.kingdom].values[c],c=b[d+"Max"],b[d]>c&&2!==b.blocked&&(b[d]=c));"mana"==d&&(c=b.manaTask)&&c[2]<=b[d]&&(P(c),sa(c[1],b,Wb[c[0]],b.url.move),b.manaTask=void 0,b.blockedAction(1));Y(b.id,1);Xa({func:ef,data:e},g,1)}},Xa=function(e,b,d){e.func.url||P(e.func);e.func=e.func.url;d&&(b=~~(b/25)+q.cycle);d=Rc[b];d||(d=[],Rc[b]=d);d.put(e)},Rc={},Vd=function(e){e=y[e];var b=F,
d=!1;e.waiting&&Yg(e);var c=e.y32,g=e.x32;Zg(1,e,"zone");var h=Wb[e.action];sb(e,32*c);var l=ib[e.zLevel],p=g+c*b;Qi(e);if(e.id===l[p]){var t=e.size;if(2>t)l[p]=e.radix;else for(var m=t*t,k=-b,C=0;C<m;C++){var u=C%t;0===u&&(k+=b);l[p+u+k]=0}}if(e.stop)return l[p]=e.id,e.stay(),e.stop=void 0,0;if(e.kx||e.ky){var q=e.kx||0,r=e.ky||0;m=!1;if(0!==l[q+g+(r+c)*b])return e.aspettare()}else{h&&h.rev&&(m=h.rev(e))&&(e.action=m[0],h=Wb[e.action],e.xf=m[1],e.yf=!0);if(!0===e.yf){m=e.xf;var w=y[m];if(!w||w.death&&
(!h||!h.available))return l[p]=e.id,e.stay();C=!0;k=!1;if(h&&h.available){k=h.available(e,w);if(!1===k)return e.aspettare();if("kill"===k)return l[p]=e.id,e.stay();if(55===k)return l[p]=e.id;C=k[2]}else w.death||(k=Xb(w,e,50,e.radix));e.xf!==m&&(w=y[e.xf]);if(!w||w.death||w.in)return l[p]=e.id,e.stay();if(!C&&(x+z*b===p||h))return e.aspettare();var x=k[0],z=k[1];if(h&&h.distance){var A=h.distance;A=0>A?e.attDist:E[e.kingdom].values[A];k=$g(w,g,c);Wd(g,c,k%F,~~(k/F),A)&&(d=2)}e==w&&(d=2)}else{x=e.xf;
z=e.yf;m=l[x+z*b];if(2<m&&(!h||h&&h.rev)){m=y[m];k=Xb(m,e,50,e.radix);if(!1===k)return l[p]=e.id,e.stay();x=k[0];z=k[1]}h&&h.distance&&(A=h.distance,A=0>A?e.attDist:E[e.kingdom].values[A],Wd(g,c,x,z,A)&&(d=2))}m=x+z*b;k=x;C=z;if(e.nodes){var B=e.nodes;20<B.length&&(B.length=2);C=B[B.length-2];k=C%b;C=~~(C/b);u=B[B.length-1];if(g+c*b==k+C*b||l[u]==e.radix||l[k+C*b]!==e.radix)B.length-=2,B.length?(C=B[B.length-2],k=C%b,C=~~(C/b)):(k=x,C=z,e.nodes=void 0)}if(!d){q=k;r=C;u=e.radix;B=F;var D=g+c*B,H=q+
r*B,G,J=q-g,L=r-c,P=Math.sqrt(J*J+L*L);for(G=0;16>G;G++){var N=~~(8*ah(D%B-q,~~(D/B)-r)+.5)%8;if(D===H)break;var O=l[D+dc[N]];if(O===u||ff(O))D+=dc[N];else if(O=l[D+dc[(N+1)%8]],O===u||ff(O))D+=dc[(N+1)%8];else{var K=N-1;-1===K&&(K=7);O=l[D+dc[K]];if(O===u||ff(O))D+=dc[K];else{D+=dc[N];break}}if(!G)var M=D;Xd&&vd(D%B,~~(D/B),"stone")}N=0;O=-1;if(l[D]>u){2<l[D]&&(O=D);var Q=[D],U=1,S=0,I={};I[D]=2;for(var R=Infinity,T=-Infinity,W=0;void 0!==(K=Q[S++]);){Xd&&vd(K%B,~~(K/B),"food");G=K%B;var V=~~(K/
B);G=((G-q)*L-(V-r)*J)/P;G<R?(R=G,N=K):G>T&&(T=G,W=K);for(G=0;4>G;G++)if(D=K+Ui[G],pa(D%B,~~(D/B))&&!I[D]&&l[D]!==u&&!ff(l[D]))for(H=0;8>H;H++)if(l[D+dc[H]]===u){Q[U++]=D;I[D]=2;break}}Xd&&vd(N%B,~~(N/B),"gold");Xd&&vd(W%B,~~(W/B),"gold");K=Math.pow(R,2)<=Math.pow(T,2)?N:W;R=-Infinity;for(H=0;8>H;H++){D=K+dc[H];if(G=l[D]===u)G=F,Q=K+dc[H],G=1<Math.abs(K%G-Q%G)||1<Math.abs(~~(K/G)-~~(Q/G))?!1:!0;G&&(G=D%B,V=~~(D/B),G=((G-q)*L-(V-r)*J)/P,Math.pow(G,2)>R&&(N=D,R=Math.pow(G,2)))}Xd&&vd(N%B,~~(N/B),"wood")}r=
[M,N,O];M=r[0];q=r[1];u=r[2];q&&(e.nodes?(e.nodes.put(q),e.nodes.put(u)):e.nodes=[q,u]);void 0!==M?(q=-g+M%b,r=-c+~~(M/b)):r=q=1;if(1<Math.abs(q)||1<Math.abs(r))return e.aspettare();if(l[g+q+(c+r)*b]!==e.radix||!pa(g+q,c+r)){M=[g+1,c,g-1,c,g+1,c+1,g+1,c-1,g,c-1,g-1,c+1,g,c+1,g-1,c-1];q=F;r=Infinity;for(u=0;u<M.length;u+=2)if(0===l[M[u]+M[u+1]*q]&&pa(M[u],M[u+1])&&r>=(M[u]-k)*(M[u]-k)+(M[u+1]-C)*(M[u+1]-C)){r=(M[u]-k)*(M[u]-k)+(M[u+1]-C)*(M[u+1]-C);var X=u}k=[M[X],M[X+1]];q=k[0]-g;r=k[1]-c;q=0<q?1:
0>q?-1:0;r=0<r?1:0>r?-1:0;if(l[g+q+(c+r)*b]!==e.radix||!pa(g+q,c+r))return e.aspettare()}}}if(p==m||d)if(l[g+c*b]=e.id,e.x32=g,e.y32=c,h){if(h.distance&&2!==d)return e.aspettare();e.stay(1);w||(w=x+z*b);e.action=void 0;h(w,e,A)}else e.stay();else{if(0===q&&0===r)return e.aspettare();e.setupDir(q,r);d=e.spd;Z(e,e.mimg,-1,e.spd/e.__proto__.spd);e.dix=q*d;e.diy=r*d;c+=r;g+=q;e.x32=g;e.y32=c;e.distance++;Pb(e,~~(32E3/d));Ec(e,q*d,r*d,0);p=g+c*b;if(2>t)l[p]=e.id;else for(m=t*t,k=-b,C=0;C<m;C++)u=C%t,0===
u&&(k+=b),l[p+u+k]=e.id}},Cc=function(){if(!q.editor){var e=q.cycle;q.now();var b=Date.now();if(q.demo){var d=q.record[e];if(d)for(var c=0;c<d.length;c+=3)gf[d[c]](d[c+1],d[c+2])}if(d=Rc[e]){for(c=0;c<d.length;c++){var g=d[c];Wb[g.func](g.data)}delete Rc[e]}if(d=Qc[e]){for(c=0;c<d.length;c++)g=y[d[c]],g.c===e&&(g.death?P("anti stall:",Wb[g.func].name,g.func,g):(g.c=void 0,Wb[g.func](g.funcObj)));delete Qc[e]}q.cycle++;if(q.online&&0===q.cycle%8)var h=bh();ch+=Date.now()-b;0===q.cycle%40&&(e=q.now()/
1E3,b=~~(e/60)%60,d=~~(e/3600),e=~~(e%60),1===(e+"").length&&(e="0"+e),d=0!=d?d+":":"",r("topinfo").innerHTML="<span>CPU:"+(ch/10).toFixed(2)+"%</span> <span>"+~~(dh/eh+.5)+"FPS</span> <span>"+d+b+":"+e+"</span>",dh=eh=ch=0);!h&&!q.automatic&&q.now()-(q.cycle-1)*Cc.speed>=Cc.speed&&Cc()}};Cc.speed=25;var ch=0,eh=0,dh=0,dc,Ui,vd=function(e,b,d){d=Object.assign({},Yb[d]);d.x32=e;d.y32=b;d.z32=2;$a(d);Zb.new(d,500)},ff=function(e){return(e=y[e])&&19===e.func&&!e.waiting?!0:!1},Xd,ah=function(e,b){e=
.5-Math.atan2(b,e)/(2*Math.PI);1==e&&(e=0);return e},Vb=function(e,b,d,c){return[e,b,d,c,e,b,d,c,e,b,d,c,e,b,d,c]},hf=new Float32Array(Vb(1,0,0,.75)),ml=new Float32Array(Vb(1,1,1,.5)),Vi=new Float32Array(Vb(0,1,0,.75)),nl=new Float32Array(Vb(0,1,0,.9)),ol=new Float32Array(Vb(.3515625,.29296875,.21875,.9)),Wi=new Float32Array(Vb(0,1,1,.9)),fh=new Float32Array(Vb(1,1,1,.5)),Xi=new Float32Array(Vb(.3,.3,.3,.9)),Yi=new Float32Array(Vb(.7,.2,.2,.9));Wi.noAlpha=1;Xi.noAlpha=1;Yi.noAlpha=1;var aa=function(e){fa(cf,
[e,4*vb.shift+1,Rb],G[0])},cf=function(e,b){var d=e[0],c=e[1],g=e[2];e=A[d];b=y[b];var h=b.icons.indexOf(e.nu);if(!(0>h)){performance.now();if(0==g)for(g=0;g<c;g++){var l=E[b.kingdom],p=l.mod[d].cost||e.cost;if(l.paypal(p))return!1;b.waitlist||(b.waitlist=[]);b.waitlist.push(d,-h-1);b.work||(b.work={});b.work[h]||(b.work[h]=0);b.work[h]++;b.working=1;l.unitLoading++;2==b.waitlist.length&&(p=1E3*e.time,b.setupINTV(Yd,b.id,p))}else{if(!b.work)return;var t=b.waitlist;l=E[b.kingdom];for(g=0;g<c;g++){p=
l.mod[d].cost||e.cost;l.setupResources(p,-1);p=t.lastIndexOf(d);if(0>p)break;t.splice(p,2);P(b.work[h]);b.work[h]--;if(0==t.length){b.c=-1;b.working=0;break}l.unitLoading--;0===p&&(p=1E3*A[t[0]].time,b.setupINTV(Yd,b.id,p))}}Y(b.id)}},Zi=0,Yd=function(e){e=y[e];var b=e.kingdom;b=E[b];var d=b.values.pop>=b.values.popMax?x.houseLimit:x.popLimit;if(b.values.pop>=b.values.popMax||b.values.pop>=b.values.popLimit)return document.getElementById("msgs1").getElementsByTagName("li"),3E4<Date.now()-Zi&&b.k==
w.kingdom&&oc(d,0,5),Zi=Date.now(),b.onFreePop.put(e.id);b.unitLoading--;b=e.waitlist[0];d=A[b];e.work[-e.waitlist[1]-1]--;e.waitlist.splice(0,2);0<e.waitlist.length?e.setupINTV(Yd,e.id,1E3*d.time):e.working=0;Sc(b,e);Y(e.id)},La=function(){if(0==Rb){var e=y[G[0]];fa(gh,[e.mlistID[Ka.nu],!0],e.id)}},cb=function(){if(0==Rb){var e=y[G[0]];fa(gh,[e.hlistID[Ka.nu],!1],e.id)}},$i=function(e,b,d){var c=1.6,g=0;1===b&&(d=0,c=3.6,g=620);return[g+~~(c*e[0]*b+.5)+120*d,~~(c*e[1]*b+.5),~~(c*e[2]*b+.5),~~(c*
e[3]*b+.5)]},gh=function(e,b){var d=e[0];e=e[1];b=y[b];var c=E[b.kingdom];if(c.values.pop>=c.values.popMax)return oc(x.popLimit,0,5);if(e)var g=c.values.fameTech;c=4;var h=9*e;h||(h=1);if(e)var l=b.mlist,p=b.mlistID;else l=b.hlist,p=b.hlistID;var t=p.indexOf(d);if(!(0>t)){d=l[t].unit;l.splice(t,1);p.splice(t,1);p=$i(A[d].cost,h,g);if(E[b.kingdom].paypal(p))return 0;I.active==l&&ja(l);for(p=0;p<h;p++)t=Sc(d,b),g?t.level=c:e||(c=16,t.level=c,l=aj[t.race],t.name=l[t.id%l.length],bj(t))}},Sc=function(e,
b,d,c){var f=F,h=b.kingdom;b.rnd||hh(b);var l=-1,p=-1;if(b.point&&!b.disallowPoint){var t=b.point[0],m=b.point[1];l=cj(b,t,m,A[e].radix,A[e].rbase())[0]}else l=cj(b,l,p,A[e].radix,A[e].rbase())[1],l=l[dj(b,l.length)];p=~~(l/f);e=new Tc(e,h,l%f,p,0,!1,c);Zd(h);d||qa("unitdone",0,0,e.kingdom);if(b.point&&(b=ih(t,m,e,!0),d=b[1],b[0]))b[0](d,[e.id]);return e},jf=0,kf=0,ac,qb,Od,K=function(e){Q=function(){};e=A[e];ac=!1;var b=W;Z(b,e.img);b.active=!0;qb=e;Od=!1;document.addEventListener("mousemove",Jg);
document.addEventListener("mousedown",Ue)},Ue=function(e){var b=qb.validator,d=qb.space,c=wa[qb.img];if(0==e.button&&151<e.pageX){c=Sb(e.pageX-w.mx-.5*c[8]/ba,e.pageY-.5*c[9]/ba);var g=~~(.03125*c[1]);c=~~(.03125*c[0]);b(c,g,d,w.kingdom)[1]&&(ac=!0,W.active=!0,W.x=-9999,W.y=-9999,Q=151<e.pageX?0:tb,document.removeEventListener("mousedown",Ue),fa(td,[c+F*g,qb.type,Od],G),vb.shift&&(Od?Di(Od):K(qb.type)));Q=function(){}}else W.active=!0,W.x=-9999,W.y=-9999,ac=!0,Q=151<e.pageX?0:tb,document.removeEventListener("mousedown",
Ue)},Jg=function(e){var b=qb.validator,d=qb.space,c=wa[qb.img];if(ac)document.removeEventListener("mousemove",Jg);else{var g=e.pageX,h=e.pageY;if(g!=jf||h!=kf)W.active=!0,jf=g,kf=h,g=Sb(e.pageX-w.mx-.5*c[8]/ba,e.pageY-.5*c[9]/ba),h=~~(.03125*g[1]),g=~~(.03125*g[0]),e=32*g,c=32*h,(b=!b(g,h,d,yb.k)[1])?b!=Fc&&(Fc=b,m.bindBuffer(m.ARRAY_BUFFER,ub),m.bufferSubData(m.ARRAY_BUFFER,16*W.bufferID,hf)):b!=Fc&&(Fc=b,m.bindBuffer(m.ARRAY_BUFFER,ub),m.bufferSubData(m.ARRAY_BUFFER,16*W.bufferID,Vi)),W.x=e,W.y=
c}},td=function(e,b){var d=e[0],c=d%ua,g=~~(d/ua),h=q.editor?w.kingdom:y[b[0]].kingdom;d=e[1];var l=A[d].cost,p=E[h];if(!q.editor&&p.paypal(l))return!1;e=new Tc(d,h,c,g,0,!q.editor,e[2]);if(!0===e.invalid||q.editor)return!1;e.waitlist=[];if(20===d)e.built=1,c=y[b[0]],sa(e.id,c,Uc,c.url.move),Q=function(){Q=tb};else for(e.health=1,Z(e,e.bimg),e=e.id,d=0,g=b.length;d<g;d++)c=y[b[d]],c.buildList?(c.buildList.put(e),c.func!==lf.url&&(h=mf(c.buildList,c.x32,c.y32))&&sa(h,c,Vc,c.url.move)):(c.buildList=
[e],c.func!==lf.url&&sa(e,c,Vc,c.url.move))},Fc=null,kh=function(e){Q=function(){};e=A[e];ac=!1;var b=W;qb=e;Z(b,e.img);document.addEventListener("mousemove",ej);document.addEventListener("mousedown",jh)},jh=function(e){var b=F,d=wa[qb.img];if(0==e.button&&151<e.pageX){e=Sb(e.pageX-w.mx-.5*d[8]/ba,e.pageY-.5*d[9]/ba);var c=~~(.03125*e[1]);e=~~(.03125*e[0]);m.bindBuffer(m.ARRAY_BUFFER,ub);m.bufferSubData(m.ARRAY_BUFFER,0,ol);var g=R[2];R[2]=32;R[5]=32;R[8]=32;R[11]=32;W.wall=e+c*b;var h=e;document.addEventListener("mouseup",
function t(e){Kb.forced=!1;e=Ia[3*w.kingdom];var d=Ia[3*w.kingdom+1],f=Ia[3*w.kingdom+2];z[0]=e;z[1]=d;z[2]=f;z[3]=.5;z[4]=e;z[5]=d;z[6]=f;z[7]=.5;z[8]=e;z[9]=d;z[10]=f;z[11]=.5;z[12]=e;z[13]=d;z[14]=f;z[15]=.5;m.bindBuffer(m.ARRAY_BUFFER,ub);m.bufferSubData(m.ARRAY_BUFFER,0,z);R[2]=g;R[5]=g;R[8]=g;R[11]=g;var p=~~(R[9]/32),k=~~(R[10]/32);d=Math.abs(h-p);f=Math.abs(c-k);d&&--d;f&&--f;e=1;p=p<h?p:h;var q=k<c?k:c;k=[p+q*b];for(var r=0;r<d+1;r++)k[e++]=p+r+q*b,f&&(k[e++]=p+r+(q+f)*b);for(r=1;r<f;r++)k[e++]=
p+(q+r)*b,d&&(k[e++]=p+(q+r)*b+d);for(r=1;r<e;r++)d=k[r],ac=!0,Q=function(){Q=tb},Gc(2),fa(td,[d,qb.type],G);W.active=!0;W.x=-9999;W.y=-9999;vb.shift&&kh(qb.type);document.removeEventListener("mouseup",t)});document.removeEventListener("mousedown",jh);ac=!0}else W.active=!0,W.x=-9999,W.y=-9999,ac=!0,Q=151<e.pageX?0:tb,document.removeEventListener("mousedown",jh)},ej=function(e){var b=F,d=wa[qb.img];if(ac)document.removeEventListener("mousemove",ej);else{var c=e.pageX,g=e.pageY;if(c!=jf||g!=kf){var h=
!0;jf=c;kf=g;W.active=!0;e=Sb(e.pageX-w.mx-.5*d[8]/ba,e.pageY-.5*d[9]/ba);d=~~(e[1]/32);e=~~(e[0]/32);c=32*e;g=32*d;0==O[e+d*b]&&(h=!1);h?h!=Fc&&(Fc=h,m.bindBuffer(m.ARRAY_BUFFER,ub),m.bufferSubData(m.ARRAY_BUFFER,16*W.bufferID,hf)):h!=Fc&&(Fc=h,m.bindBuffer(m.ARRAY_BUFFER,ub),m.bufferSubData(m.ARRAY_BUFFER,16*W.bufferID,Vi));W.x=c;W.y=g}}},lh=function(e,b){e=0;for(var d=b.length;e<d;e++){var c=y[b[e]];c.xf?c.stop=1:c.stay()}},nf=function(e,b){e=y[b[0]];e.techStart=0;e.c=void 0;if(b=e.techID){var d=
E[e.kingdom].technology.hidden;-1<b&&(d[b]=0);E[e.kingdom].setupResources(B[e.activeTech].cost,-1)}else E[e.kingdom].setupResources(e.lcost,-1)},H=function(e){fa(Ug,[e,Ka.lastFunc.id],y[G[0]].id)},Ug=function(e,b){var d=e[0];e=e[1];var c=B[d],g=y[b];c.upgrade&&(e=-1);if(E[g.kingdom].paypal(c.cost))return!1;g.activeTech=d;g.techID=e;g.setupINTV(c.type,[d,e,b],1E3*c.time);g.techStart=g.c-q.cycle;d=E[y[b].kingdom].technology.hidden;-1<e&&(d[e]=1);Y(b)},X=function(e){var b=e[1],d=y[e[2]];e=B[e[0]];pc(d,
e,b)},$d=function(e){var b=e[1],d=y[e[2]];e=B[e[0]];var c=A[e.obj],g=E[d.kingdom].mod[c.type];fj(d);d.img=c.img;d.attack=g.attack||c.attack;d.health=d.health/d.maxHealth*c.health;d.maxHealth=c.health;d.__proto__=c;$a(d);pc(d,e,b)},of=function(e){var b=e[1],d=y[e[2]];e=B[e[0]];if(e.actvintv)for(var c=e.actvintv,g=0,h=c.length;g<h;g++){var l=c[g];E[d.kingdom].technology.disabled[l.id]=0;for(var p=l.builds,t=hb[d.kingdom],m=0,k=p.length;m<k;m++)for(var C=t[p[m]],u=0,q=C.length;u<q;u++)l(y[C[u]])}pc(d,
e,b)},db=function(e,b){var d=e[1];b=y[e[2]];e=B[e[0]];E[b.kingdom].values[e.value]+=e.increase;"popMax"==e.value&&Zd(b.kingdom);pc(b,e,d)},gj=function(e,b){var d=e[1];b=y[e[2]];e=B[e[0]];for(var c=e.group,g=E[b.kingdom].mod,h=0,l=c.length;h<l;h++)for(var p=g[c[h].type],t=0,m=e.values,k=m.length;t<k;t+=2){var C=m[t],u=m[t+1];p[C]||(p[C]=c[h][C]||0);p[C]+=u}pc(b,e,d)},Ra=function(e,b){var d=e[1];b=y[e[2]];e=B[e[0]];for(var c=e.group,g=E[b.kingdom].mod,h=0,l=c.length;h<l;h++){var p=g[c[h].type];p[e.value]||
(p[e.value]=c[h][e.value]||0);p[e.value]+=e.increase}pc(b,e,d)},pf=function(e,b){var d=e[1];b=y[e[2]];e=B[e[0]];for(var c=E[b.kingdom].mod,g=e.mulp,h=0,l=e.group.length;h<l;h++){var p=e.group[h],t=c[p.type].cost||p.cost;c[p.type].cost=g?[~~(t[0]*g),~~(t[1]*g),~~(t[2]*g),~~(t[3]*g)]:[t[0]-e.decrease[0],t[1]-e.decrease[1],t[2]-e.decrease[2],t[3]-e.decrease[3]]}pc(b,e,d)},mh=function(e,b){var d=e[1];b=y[e[2]];e=B[e[0]];for(var c=E[b.kingdom].mod,g=0,h=e.decrease,l=h.length;g<l;g+=2){var p=h[g],t=h[g+
1],m=c[p.type].cost||p.cost;c[p.type].cost=[m[0]-t[0],m[1]-t[1],m[2]-t[2],m[3]-t[3]]}pc(b,e,d)},pc=function(e,b,d){e.techStart=void 0;e.activeTech=void 0;e.techID=void 0;e.func=void 0;var c=E[e.kingdom].technology,g=c.disabled;c.investigated[d]=1;qa("techdone",0,0,e.kingdom);if(b=b.next){d=!1;c=0;for(var h=b.length;c<h;c++){var l=b[c].id;g[l]--;ja.actv[l]&&(d=!0)}d&&ja(I.active)}Y(e.id)};"use strict";var Hc,pl={icon:"food",img:"item_meat",url:"meat"},ql={icon:"milk",img:"milk",url:"milk"},rl={icon:"gold",
img:"item_gold",url:"gold"},sl={icon:"stone",img:"item_stone",url:"stone"},hj={icon:"wood",img:"item_tree",url:"tree"},tl={icon:"food",img:"item_food",url:"food"},ae=function(e,b,d,c){e=hb[e];var f=Hc[b];b=[];b.length=f.length;for(var h=0,l=f.length;h<l;b[h]=e[f[h++]]);e=Infinity;f=-1;for(h=0;h<b.length;h++){l=b[h];for(var p=l.length,t=0;t<p;t++){var m=y[l[t]],k=m.x32,C=m.y32,u=m.space;m=u[u.length-1];u=(u.length-1)/m;m*=.5;u*=.5;k+=m;C+=u;m=.5*(m+u);k=Math.sqrt((k-d)*(k-d)+(C-c)*(C-c))-m;e>=k&&(e=
k,f=l[t])}}return f},ha,vl=function(e){if("string"==typeof e){for(var b=1,d=0,c=e.length;d<c;d++)b+=b*(e.charCodeAt(d)/65535)*(d+1);e=b+c}var g=4294967295-e,h=4294967295+e;d=0;ha=function(){h+=d;g-=d++;h=36969*(h&65535)+(h>>16)&4294967295;g=18E3*(g&65535)+(g>>16)&4294967295;return((h<<16)+g&4294967295)/4294967295+.5}},dj=function(e,b){e=e.rnd;var d=e[0],c=e[1],g=e[2];d+=g;c-=g;d=36969*(d&65535)+(d>>16)&4294967295;c=18E3*(c&65535)+(c>>16)&4294967295;e[0]=d;e[1]=c;e[2]++;return~~((((d<<16)+c&4294967295)/
4294967295+.5)*b)},Gc=function(e){e!=wl&&(document.body.className="ncursor"+e)},wl=-1,wd=function(e,b){for(var d=0,c=b.length;d<c;d++){var g=y[b[d]];sa(e,g,be,g.url.move)}};wd.spLevel=function(e){var b=0;2<Ma[e]&&(b=Ma[e]);return b};var be=function(e,b){b.stay55();if(b.inventory&&b.invMax===b.inventory.length||!e.item)return 1;Ma[e.x32+e.y32*F]=e.radix;sb(e,NaN);if(b.peon&&e.contain){var d=e.contain[1],c=e.contain[0];b.stock&&ij(b);var g=jj(b.x32,b.y32)||!1,h=e.contain[2];e.die(1);b.stock=[c,d,g,
be,h];e=ae(b.kingdom,d,b.x32,b.y32);sa(e,b,qc,b.url[h.url]);Y(b.id);return 1}b.addItem(e);Y(b.id)},ij=function(e){var b=kj(e.x32,e.y32),d=~~(b/F);b%=F;b=new Tc(52,e.kingdom,b,d,0);Z(b,k[e.stock[4].img]);b.contain=[e.stock[0],2,e.stock[4]]},lj=function(e,b){e=0;for(var d=b.length;e<d;e++){var c=y[b[e]];c.xf?c.stop=2:(c.stop=2,c.stay(),c.stop=void 0)}},xd=function(e,b){var d=F;e=y[e];for(var c=0,g=b.length;c<g;c++){var h=y[b[c]],l=ib[h.zLevel],p=h.x32+h.y32*d;if(0!==l[p]||!e.build){p=e.build?nh(h,h.x32,
h.y32):nh(h,e.x32,e.y32);if(!1===p)continue;h.x32=p%F;h.y32=~~(p/F)}h.item&&(e.attack-=h.attack||0,e.defence-=h.defence||0);h.url.idle&&Z(h,h.url.idle,1);l[p]=h.id;h.in=0;e.inventory.quit(h.id);l=1;h.z32&&(l=h.z32);sb(h,32*h.y32*l)}Y(e.id,1)},ce=function(e,b){e=y[e];if(1===e.invType)for(var d=0,c=b.length;d<c;d++){var g=y[b[d]];g!=e&&sa(e.id,g,oh,g.url.move)}},oh=function(e,b){var d=e.inventory;if(d.length<e.invMax){var c=b.x32,g=b.y32;b.stay55();b.rbase()[c+g*F]=b.radix;d.put(b.id);sb(b,NaN);b.in=
e.id;de(b.id);Y(e.id)}else b.stay55()},yd=function(e,b){for(var d=b.length,c=0;c<d;c++){var g=y[b[c]];g.buildList=!1;sa(e,g,Vc,g.url.move)}},Vc=function(e,b){if(e.dummy&&e.dummy.built)return b.stay55();if(e.health<e.maxHealth)b.dix=0,b.diy=0,b.mv=!0,b.setupDirBuild(e),Z(b,b.url.build,1),b.setupINTV(lf,{u:e.id,a:b.id},rb(b.img)),Sd(b,"hit%20",7,b.img);else{if(b.buildList&&(e=mf(b.buildList,b.x32,b.y32)))return sa(e,b,Vc,b.url.move),0;b.stay55()}},qf=function(e,b){return b[e]&&13==y[b[e]].type||13==
y[O[e]].type?!0:!1},lf=function(e){var b=y[e.u];e=y[e.a];var d=e.x32,c=e.y32,g=b.x32+b.y32*F;if(b.death)return e.stay();var h=b.maxHealth,l=h/b.time*E[e.kingdom].values.buildSpeed;if(1===b.health){for(var p=b.onbuild1,t=b.id,m=b.getRadix(),v=0,C=p.length;v<C;v++)if(2<m[p[v]]){Pb(e,rb(e.img));return}var u=Cb[b.kingdom];v=0;for(C=p.length;v<C;v++)m[p[v]]=t,u[p[v]]=void 0;hb[b.kingdom][b.type].put(b.id);rc(b)}b.health+=l;l=b.health;0==b.built&&(u=~~(4*l/h),u>b.d&&(b.d=u,Z(b,b.img)));if(l>=h){l=b.health=
h;Y(b.id);if(!b.built){b.d=0;p=b.url;u=Cb[b.kingdom];13===b.type&&(qf(g-1,u)&&qf(g+1,u)?(p=k.wood_horz,b.child=void 0):qf(g+F,u)&&qf(g-F,u)&&(p=k.wood_vert,b.child=void 0));b.built=1;b.img=p;$a(b);if(p=b.onbuildValid)for(m=b.validator.dimension,v=0,C=p.length;v<C;m[p[v++]]=0);mj(b);qa("bldgdone",0,0,b.kingdom);Y(b.id)}b.action=void 0;(g=e.buildList)&&g.quit(b.id);if(!g||e.buildList&&0===e.buildList.length)e.buildList=nj(e),g=e.buildList;if(d=mf(g,d,c))return sa(d,e,Vc,e.url.move),0;e.buildList.length=
0;e.stay();e.stock&&e.stock[0]&&Z(e,e.url[e.stock[4].url])}else Y(b.id),Pb(e,rb(e.img));G[0]==b&&(Ic.innerHTML=l+"/"+h,Sa.value=l)},rf=function(e,b){if(2<e)for(var d=0,c=b.length;d<c;d++){var g=y[b[d]];sa(e,g,Uc,g.url.move)}},fe=function(e,b){var d=e;e=y[e];if(e.field)for(c=0,e=b.length;c<e;c++)g=y[b[c]],sa(d,g,Uc,g.url.move);else if(0===e.res||3===e.res){var c=0;for(e=b.length;c<e;c++){var g=y[b[c]];sa(d,g,ee,g.url.move)}}else if(1===e.res)for(c=0,e=b.length;c<e;c++)g=y[b[c]],sa(d,g,Wc,g.url.move);
else if(2===e.res)for(c=0,e=b.length;c<e;c++)g=y[b[c]],sa(d,g,Dc,g.url.move)},nc=function(e,b,d,c){d=c||ge;if(!(3>e||(e=y[e],void 0!=e.res||e.magicGateway))){c=0;for(var f=b.length;c<f;c++){var h=y[b[c]];h==e||h.attackOnly&&!h.attackOnly[e.type]||h.bat&&e.build||e.stoned||(h.build?d(e,h):sa(e.id,h,d,h.url.move))}}},Wc=function(e,b){if(0<e.health){var d=b.x32,c=b.y32;b.mv=!0;b.setupDir(e.x32-d,e.y32-c);Z(b,b.url.cut,1);b.dix=0;b.diy=0;Sd(b,"chop%20",11,b.img);b.setupINTV(oj,{u:e.id,a:b.id},7E3);e.addWorker(b)}else b.stay55()},
oj=function(e){var b=F,d=y[e.u];e=y[e.a];var c=E[e.kingdom].values.wood;d.workers.quit(e.id);var g=ae(e.kingdom,1,e.x32,e.y32);d.health-=c;e.mv=!1;Y(d.id);if(1>d.health){c+=d.health;O[d.x32+d.y32*b]=0;b=y[g];b=Da(b.x32,b.y32);for(var h=d.health=0,l=d.workers.slice(0),p=l.length;h<p;h++){var t=y[l[h]];b?sa(b,t,Wc,e.url.move):t.stay()}e.stock=[c,1,b,Wc,hj];e.mv=!1;sa(g,e,qc,e.url.tree);Y(e.id,1);d.workers.length=0;d.die()}else e.stock=[c,1,d.id,Wc,hj],sa(g,e,qc,e.url.tree),Y(e.id,1);if(0>g)return e.stay()},
Uc=function(e,b){b.mv=!0;b.setupDir(e.x32-b.x32,e.y32-b.y32);Z(b,b.url.dig,1);Sd(b,"dig%20",3,b.img);b.setupINTV(pj,{u:e.id,a:b.id},7E3)},pj=function(e){var b=y[e.u];e=y[e.a];var d=E[e.kingdom].values.food,c=ae(e.kingdom,2,e.x32,e.y32);e.mv=!1;e.stock=[d,2,b.id,Uc,tl];sa(c,e,qc,e.url.food);Y(e.id,1);if(0>c)return e.stay()},Dc=function(e,b){b.mv=!0;b.setupDir(e.x32-b.x32,e.y32-b.y32);Z(b,b.url.milk1,1);b.stock=[0,2,e.id,Dc,ql];b.setupINTV(ph,{u:e.id,a:b.id},1E3);e.addWorker(b);e.d=(8-b.d)%8;e.stay()},
ph=function(e){var b=y[e.u];e=y[e.a];b.milk-=3;var d=e.x32,c=e.y32;e.stock[0]+=3;Y(e.id,1);if(0>=b.milk||b.death){if(50<e.stock[0]&&(e.stock[0]=50),e.mv=!1,b=ae(e.kingdom,2,d,c),sa(b,e,qc,e.url.milk),0>b)return e.stay()}else Pb(e,1E3)},Ud=function(e,b){b.stay55()},ud=function(e,b){ge(e,b)},ge=function(e,b){if(1!==e.death&&e!=b){if(e.dummy&&!E[b.kingdom].values.experience)return b.stay55();b.invisible&&zd(b.id);if(!0!==b.build){b.mv=1;var d=e.x32-b.x32,c=e.y32-b.y32;e.space&&(c=$g(e,b.x32,b.y32),d=
c%F-b.x32,c=~~(c/F)-b.y32);b.setupDir(d,c,b.d2attack);b.url.attack&&Z(b,b.url.attack,1)}b.setupINTV(qh,{u:e.id,a:b.id},rb(b.img),e);e.addWorker(b)}else b.stay55()};ge.distance=-1;ud.distance=-1;var rh=function(e,b){var c=E[e.kingdom];if(c.values.experience&&(!b||0!=c.diplomacy[b.kingdom]||b.dummy)){if(0==e.level||null==e.level)e.level=0,e.levelProgress=0;e.levelProgress++;e.levelProgress>=~~(e.level/c.values.experience)&&e.level<c.values.maxLevel&&(e.level++,e.health+=c.values.healthJump,e.maxHealth+=
c.values.healthJump,e.levelProgress=0,e.attack+=e.level,e.defence+=e.level%2,Y(e.id,1))}},bj=function(e){var b=e.level;e.attack+=b;e.defence+=~~(.5*b)},qh=function(e){var b=y[e.u];e=y[e.a];var c=e.attDist,f=b.x32-e.x32,g=b.y32-e.y32,h=b.x32,l=b.y32,p=!e.build;if(e.attackSound){var t=e.attackSound;qa(t[~~(t.length*Math.random())],e.x32,e.y32)}p&&!b.build&&e.setupDir(f,g,e.d2attack);Z(e,e.img,1);if(b.death||e.level&&8<=e.level&&b.dummy||b.dummy&&e.level&&e.level>=E[e.kingdom].values.maxLevel)return e.stay();
if(1<c&&!e.dragon){p=!0;var m=wa[e.attimg]}else p=!1;if(b.build||Wd(b.x32,b.y32,e.x32,e.y32,c)){b.onattack(e);c=e.attack*((sd[e.type][b.type]||0)+1);if(p){b.space&&(f=$g(b,e.x32,e.y32),h=f%F,l=~~(f/F),f=h-e.x32,g=l-e.y32);p=0;if(e.arrow||e.ball){t=qj;var k=ah(-f,-g);var C=f;var u=g;var r=411/Math.sqrt(C*C+u*u);C*=r;u*=r;var w=Math.sqrt(1024*f*f+g*g*1024)/Math.sqrt(C*C+u*u);e.ball&&(m[1]=m[0]/w)}else{var x=2;t=sf;p=C=q.gravity;k=Math.PI/180*60;r=Math.cos(k);k=e.attackDeg;k*=Math.PI/180;u=Math.sin(k);
w=Math.cos(k);k=32*Math.sqrt(f*f+g*g);C=w*Math.sqrt(C*k/(u*w*2));w=k/C;u=-Math.sin(Math.atan2(-f,-g));k=ah(-f,-g);C*=u;p=Math.abs(p*r*u);u=(32*g-p*w*w*.5)/w}w=Math.round(1E3*w);r={x32:e.x32+.5,y32:e.y32+.5,img:m.url,mv:e.ball,d:0,rotation:-k+1.5,xf:h,yf:l,obj:b.id,attack:c,range:x};$a(r);Ec(r,C,u,p);Xa({func:t,data:r},w,1)}r||b.damage(c,e);if(b.dummy){if(50<=e.dummyDamage||!e.dummyDamage)e.dummyDamage=0;e.dummyDamage+=c;50<=e.dummyDamage&&rh(e,b)}b.death?(e.action=null,b.build||e.build||rh(e,b),Hd(e)||
e.stay()):Pb(e,rb(e.img))}else e.build&&(Hd(e)||e.stay()),e.mv=!1,0!==e.state&&sa(b.id,e,ge,e.url.move)},ee=function(e,b){0<e.health?(b.dix=0,b.diy=0,b.mv=1,b.setupDirBuild(e),Z(b,b.url.kirka,1),Sd(b,"mine%20",3,b.img),b.setupINTV(rj,{u:e.id,a:b.id},7E3),e.addWorker(b)):b.stay()},rj=function(e){var b=y[e.u];e=y[e.a];var c=b.res,f=E[e.kingdom].values[0==c?"gold":"stone"],g=e.x32,h=e.y32;b.health-=f/E[e.kingdom].values.miningPerf;Y(b.id);1>b.health&&(f=b.health+f,b.health=0,b.d=3,b.die());e.mv=!1;g=
ae(e.kingdom,c,g,h);0==c?(e.stock=[f,c,b.id,ee,rl],sa(g,e,qc,e.url.gold)):(e.stock=[f,c,b.id,ee,sl],sa(g,e,qc,e.url.stone));Y(e.id,1);if(0>g)return e.stay()},sa=function(e,b,c,f){b.cow&&b.workers.length||(b.action=c.url,b.distance=0,b.nodes=void 0,0<e?(b.xf=e,b.yf=!0):(e*=-1,b.xf=e%F,b.yf=~~(e/F)),b.func!=Vd.url&&(f==b.url.move?Yg(b):b.mimg=f,b.dix=0,b.diy=0,b.mv=!0,b.setupINTV(Vd,b.id,0)))},uf=function(e,b){P(e);tf(b,e,xl)};uf.allowPos=1;var xl=function(e,b){xd(b.id,b.inventory.slice(0));b.stay55()},
$g=function(e,b,c){var d=e.space||ll,g=d.length-1,h=d[g],l=e.x32;e=e.y32-1;for(var p=Infinity,t=0,m=0;m<g;m++){var k=m%h;k||e++;var C=(l+k-b)*(l+k-b)+(e-c)*(e-c);C<p&&d[m]&&(t=l+k+e*F,p=C)}return t},nh=function(e,b,c){var d=F,g=e.radix,h=ib[e.zLevel];for(e=2;60>=e;e+=2){b--;c--;for(var l=0;l<=e;){var p=b+l+d*c;if(h[p]===g)return p;p=b+l+d*(c+e);if(h[p]===g)return p;l++}for(l=0;l<e-1;){l++;p=b+d*(c+l);if(h[p]===g)return p;p=b+e+d*(c+l);if(h[p]===g)return p}}return!1},kj=function(e,b){var c=F,f,g=Ma;
for(f=2;60>=f;f+=2){e--;b--;for(var h=0;h<=f;){var l=e+h+c*b;if(0===g[l]&&0===O[l])return l;l=e+h+c*(b+f);if(0===g[l]&&0===O[l])return l;h++}for(h=0;h<f-1;){h++;l=e+c*(b+h);if(0===g[l]&&0===O[l])return l;l=e+f+c*(b+h);if(0===g[l]&&0===O[l])return l}}return!1},Xb=function(e,b,c,f){var d=b.x32,h=b.y32,l=F,p=d+h*l,t=e.x32,m=e.y32,k=e.space;if(k){var C=k[k.length-1];k=(k.length-1)/C;e=e.free}else k=C=1,e=Si;b=b.rbase();for(var u,q=Infinity,r=-1,w=!1,x=0;x<c&&-1==r;){if(0==x&&e){for(var z=[],y=0,A=e.length;y<
A;y+=2){var B=e[y]+t;u=e[y+1]+m;if(pa(B,u)&&(b[B+u*l]===f||B+u*l==p))a:{var D=z;B+=u*l;u=d;for(var E=h,G=F,H=Math.pow(B%G-u,2)+Math.pow(~~(B/G)-E,2),J=0,L=D.length;J<L;J++)if(Math.pow(D[J]%G-u,2)+Math.pow(~~(D[J]/G)-E,2)>H){D.splice(J,0,B);break a}D.put(B)}}z[0]&&(r=z[0]);if(-1<r){w=!0;break}if(1==c)break}x++;--t;--m;z=C+2*x;D=k+2*x;y=0;for(A=z*D;y<A;y++)u=y%z,E=~~(y/z),u&&E&&u!=z-1&&E!=D-1||(u+=t,E+=m,B=u+E*l,b[B]==f&&pa(u,E)&&(u=(u-d)*(u-d)+(E-h)*(E-h),q>u&&(q=u,r=B)))}return-1<r?[r%l,~~(r/l),w]:
!1},cj=function(e,b,c,f,g){performance.now();var d=F,l=e.x32,p=e.y32,m=e.space,k=[],v=0;if(m){var C=m[m.length-1];m=(m.length-1)/C;var u=e.free}else m=C=1;e=-1==b?-Infinity:Infinity;for(var q=-1,r=0,w=0;0==k.length;){if(u&&0==w){for(var x=0,z=u.length;x<z;x+=2){var y=u[x]+l,A=u[x+1]+p;pa(y,A)&&g[y+A*d]===f&&(k[v++]=y+A*d,r=(y-b)*(y-b)+(A-c)*(A-c),e>r&&(e=r,q=y+A*d))}if(k.length)break}w++;--l;--p;for(x=0;x<C+2*w;x++)g[l+p*d+x]==f&&pa(l+x,p)&&(k[v++]=l+x+p*d,r=(l+x-b)*(l+x-b)+(p-c)*(p-c),e>r&&(e=r,
q=l+x+p*d)),g[l+(p+m+2*w-1)*d+x]==f&&pa(l+x,p+m+2*w-1)&&(k[v++]=l+(p+m+2*w-1)*d+x,r=(l+x-b)*(l+x-b)+(p+m+2*w-1-c)*(p+m+2*w-1-c),e>r&&(e=r,q=l+(p+m+2*w-1)*d+x));for(x=1;x<m+2*w-1;x++)g[l+(p+x)*d]==f&&pa(l,p+x)&&(k[v++]=l+(p+x)*d,r=(l-b)*(l-b)+(p+x-c)*(p+x-c),e>r&&(e=r,q=l+(p+x)*d)),g[l+C+2*w-1+(p+x)*d]==f&&pa(l+C+2*w-1,p+x)&&(k[v++]=l+C+2*w-1+(p+x)*d,e>r&&(e=r,q=l+C+2*w-1+(p+x)*d))}return[q,k]},Si=[-1,0,-1,-1,0,-1,1,-1,1,0,1,1,0,1,-1,1],mf=function(e,b,c){for(var d=Infinity,g=!1,h=0,l=e.length;h<l;h++){var p=
e[h],m=y[e[h]];if(0!=m.built||m.death)h--,l--,e.quit(p);else{var k=m.x32;m=m.y32;m=(k-b)*(k-b)+(m-c)*(m-c);d>=m&&(d=m,g=p)}}return g},sj=function(e){for(var b=0,c=e.length;b<c;b++){var f=y[e[b]];f.spd=f.__proto__.spd}},Wg=function(e){for(var b=Infinity,c=0,f=e.length;c<f;c++){var g=y[e[c]];g.spd<b&&(b=g.spd)}sh(b,e)},jj=function(e,b){for(var c=F,f,g=Infinity,h=0,l=0;121>l;l++){var p=l%11-5,m=~~(l/11)-5,k=p*p+m*m;p+=e;m+=b;k<g&&(f=Ma[p+c*m],0<f&&0==O[p+c*m]&&(f=y[f],f.contain&&(g=k,h=f.id)))}return h},
th=function(e,b){tf(b,e,qc)},qc=function(e,b){e=E[b.kingdom];e.resources[b.stock[1]]+=b.stock[0];e.stats.resources[b.stock[1]]+=b.stock[0];vf(b.kingdom);b.func=1;var c=b.stock[3];e=y[b.stock[2]];if(c==Dc){var f=F;for(var g,h=Infinity,l=!1,p=0;961>p;p++){var m=p%31-15,k=~~(p/31)-15,v=m*m+k*k;m+=b.x32;k+=b.y32;v<h&&(g=Ma[m+f*k],0<g&&0===O[m+f*k]&&(g=y[g],g.contain&&"meat"==g.contain[2].url&&(h=v,l=g)))}if(f=l)c=be,e=f}else"meat"==b.stock[4].url&&!1===b.stock[2]&&(f=uh(b.x32,b.y32,!0))&&(c=Dc,e=f,b.stock[2]=
1);if(!1===b.stock[2])return b.stock=void 0,b.stay();b.stock=void 0;sa(e.id,b,c,b.url.move);Y(b.id,1)};fe.cursor=6;nc.cursor=1;yd.cursor=9;wd.cursor=5;ce.cursor=7;uf.cursor=7;rf.cursor=6;th.cursor=6;var nj=function(e){var b=F,c=e.kingdom,f=e.x32,g=e.y32;f-=16;g-=16;for(var h={},l=[],p=0,m=Cb[c],k=0;1024>k;k++){e=k%32+f;var v=~~(k/32)+g;pa(e,v)&&(e=m[e+v*b],void 0!==e&&(e=y[e],e.kingdom!=c||!1!==e.built||h[e.id]||(l[p++]=e.id,h[e.id]=1)))}return l};Wc.available=function(e,b){var c=E[e.kingdom].values.wood;
if(b.death||1>b.health-c&&b.workers.length)b=Da(b.x32,b.y32),e.xf=b,b=y[b];return Xb(b,e,1,e.radix)};ee.available=function(e,b){if(!b.death){var c=Xb(b,e,1,e.radix);if(c[2])return c}for(var f=b.x32,g=b.y32,h=0;5>h;){b=jl(f,g,b.type,b.id);if(!1===b)break;b=y[b];c=Xb(b,e,1,e.radix);if(c[2])return e.xf=b.id,c;h++}return!1};Uc.available=function(e,b){if(b.death)return!1;e=b.x32+1;b=b.y32+1;return 0===O[e+b*F]?[e,b,1]:!1};Vc.available=function(e,b){var c=e.x32,f=e.y32;if(!b.death&&b.health<b.maxHealth){var g=
Xb(b,e,1,e.radix);if(g[2])return g}e.buildList?(g=e.buildList,g.quit(b.id)):(e.buildList=nj(e),g=e.buildList);b=mf(g,c,f);if(!b)return"kill";e.xf=b;b=y[b];return Xb(b,e,1,e.radix)};Ud.rev=function(e){return 0===e.distance%3&&(e=Xg(e.id,1))?[ud.url,e]:!1};ud.available=function(e,b){if(0===e.distance%3){var c=Xg(e.id);c&&(e.xf=c,b=y[c])}return Xb(b,e,5,e.radix)};be.available=function(e,b){if(b.death||b.in)if(b.contain)if(b=jj(b.x32,b.y32))e.xf=b,b=y[b];else return(b=uh(e.x32,e.y32,!0))?(e.stay(),sa(b.id,
e,Dc,e.url.move),55):"kill";else return"kill";e=b.x32;b=b.y32;return 0===O[e+b*F]?[e,b,1]:!1};Dc.available=function(e,b){if(b.workers.length||b.milk<50/1.5||b.death){b=uh(e.x32,e.y32);if(!b)return!1;e.xf=b.id}return b.xf?!1:Xb(b,e,5,e.radix)};oh.available=function(e,b){if(b.death)return e.stay(),!1;var c=1;b.boat&&(c=2);return(e=Xb(b,e,c,e.radix))?(e[2]=1,e):!1};var uh=function(e,b,c){for(var d=F,g,h=Infinity,l=!1,p=0;441>p;p++){g=p%21-10;var m=~~(p/21)-10,k=g*g+m*m;g+=e;m+=b;k<h&&(g=O[g+d*m],0<g&&
(g=y[g],g.cow&&(!g.workers.length&&g.milk>=50/1.5||c)&&(h=k,l=g)))}return l},tf=function(e,b,c){for(var d=0,g=e.length;d<g;d++){var h=y[e[d]];sa(b,h,c,h.url.move)}},xf=function(e,b){Ba(b,e,wf)};xf.noObj=1;var wf=function(e,b){he(b,-e,77,wf)},zf=function(e,b){Ba(b,e,yf)};zf.noObj=1;var yf=function(e,b){he(b,-e,130,yf)},Bf=function(e,b){Ba(b,e,Af)};Bf.noObj=1;var Af=function(e,b){he(b,-e,78,Af)},Df=function(e,b){Ba(b,e,Cf)};Df.noObj=1;Df.cursor=10;var Cf=function(e,b){he(b,-e,132,Cf)},Ff=function(e,
b){Ba(b,e,Ef)};Ff.cursor=10;Ff.noObj=1;var Ef=function(e,b){he(b,-e,131,Ef)},he=function(e,b,c,f){var d=F,h=E[e.kingdom],l=A[c],p=A[c].cost,m=e.mana>e.manaMax;if(wb(e)||e.checkMana(p[4],b,f,p)){m||h.paypal(p);f=c;b*=-1;m=b%d;var k=~~(b/d),v=m,q=k,u=ib[l.zLevel],r=~~(e.mana/p[4])+1;1<r&&(h.resources[0]-=p[0]*(r-1),e.mana-=p[4]*(r-1));for(h=0;h<r;h++)0!==u[b]&&(c=nh(l,m,k),v=c%d,q=~~(c/d)),qa("summon"+~~(10*Math.random()+1),v,q),c=new Tc(f,e.kingdom,v,q,0),c.setupChild(Db.spawn);e.setupDir(-e.x32+c.x32,
-e.y32+c.y32);e.setupSpellIMG()}else h.paypal(p);Y(e.id)},Wd=function(e,b,c,f,g){return~~Math.sqrt((e-c)*(e-c)+(b-f)*(b-f))<=g},vh=function(e,b){Ba(b,e,Gf)};vh.cursor=0;var Gf=function(e,b){e.build||e.terrain||e.nofreeze||!wb(b)&&!b.checkMana(50,e.id,Gf)||(e.freezed=1,e.stoned=1,sb(e,32*e.y32),e.stay(),Z(e,e.img,0),e.setupChild(Db.turnStone),Ad(e,Xi),de(e.id),b.setupDir(-b.x32+e.x32,-b.y32+e.y32),b.setupSpellIMG(),qa("turn%20to%20stone",b.x32,b.y32),Xa({func:tj,data:e.id},24E4,1))},tj=function(e){e=
y[e];e.freezed=0;rc(e);e.stoned=0},wh=function(e,b){Ba(b,e,ie)},ie=function(e,b){e.health<e.maxHealth&&!e.build?(b.setupDir(e.x32-b.x32,e.y32-b.y32),P("heal",rb(b.img)),b.setupSpellIMG(!0),b.setupINTV(uj,{u:e.id,a:b.id},0),e.addWorker(b)):b.stay()},wj=function(){Ba(list,obj,vj)},vj=function(){},uj=function(e){var b=y[e.a];e=y[e.u];var c=E[b.kingdom].values.healingRange;qa("heal",b.x32,b.y32);if(!Wd(e.x32,e.y32,b.x32,b.y32,c))return sa(e.id,b,ie,b.url.move);if(wb(b)||b.checkMana(4,e.id,ie)){b.setupDir(e.x32-
b.x32,e.y32-b.y32);e.health+=6;e.setupChild(Db.heal);if(e.health>=e.maxHealth)return e.health=e.maxHealth,Y(e.id,1),Y(b.id,1),b.stay();Y(e.id,1);Y(b.id,1);Pb(b,rb(b.url.spell))}},If=function(e,b){Ba(b,e,Hf)};If.cursor=10;var xj=function(e,b){e=y[e];b=y[b];if(e.inventory.quit(b.id)){b=c[b.spell];e.icons==e.__proto__.icons&&(e.icons=e.icons.slice(0));e.icons.put(b);var d=e.icons;d.olegal||(d.olegal={});d.olegal[b.id]=1;Y(e.id)}},je=function(e,b){var c=b[1];b=y[b[0]];y[e].nopotion||y[e].build||(sa(e,
b,yj,b.url.move),b.actionItem=c)};je.item=1;var yj=function(e,b){var c=y[b.actionItem];b.actionItem=void 0;c.attack&&(e.attack+=c.attack);c.defence&&(e.defence+=c.defence);c.mana&&(e.mana||(e.mana=0,e.manaMax=0,e.update?e.update.push("mana","manaSpeed",1E3):e.update=["mana","manaSpeed",1E3],Xa({func:ef,data:[e.id,"mana","manaSpeed",1E3]},1E3,1)),e.manaMax+=c.mana,e.mana+=c.mana);c.level&&(e.level||(e.level=0),e.level+=c.level,e.attack+=c.level,e.defence+=~~c.level);qa("bless",e.x32,e.y32);b.inventory.quit(c.id);
b.stay55();Y(b.id)};je.cursor=10;wh.cursor=10;xf.cursor=10;zf.cursor=10;Bf.cursor=10;var yh=function(e,b){Ba(b,e,xh)};yh.cursor=1;var xh=function(e,b){if(e.isSpy&&e==b)b.stay55();else if(wb(b)||b.checkMana(90,e.id,xh))b.setupDir(-b.x32+e.x32,-b.y32+e.y32),Z(b,b.url.attack,1),Xa({func:zj,data:[e,b]},rb(b.img)-25,1)},zj=function(e){var b=e[1];e=e[0];e.die(1);var d=e.getRadix();d[b.x32+b.y32*F]=b.radix;b.x32=e.x32;b.y32=e.y32;b.d=e.d;b.name=b.name;b.attack=e.attack;b.defence=e.defence;b.update=b.update;
b.mana=0;b.manaMax=b.manaMax;d[b.x32+b.y32*F]=b.id;sb(b,32*b.y32);b.__proto__=e.__proto__;Z(b,b.url.idle);d=e.icons.slice(0);d.quit(c.menuBuilds);d.quit(c.menuBuilds1);d.quit(c.menuBuilds2);d.put(c.impersonate);d.put(c.revealSelf);b.icons=d;b.spy||(b.spy=b.kingdom);b.kingdom!==e.kingdom&&b.changeKingdom(e.kingdom);b.setupChild(Db.impersonate);Y(b.id)},Aj=function(e){e=y[e];if(e.spy){var b=A[2];e.attack=b.attack;e.defence=b.defence;e.__proto__=b;e.icons=b.icons;e.kingdom!==e.spy?e.changeKingdom(e.spy):
e.stay();Z(e,e.url.idle);Y(e.id);e.spy=void 0}};If.allowPos=1;var Hf=function(e,b){if(e.id){var c=e.id,f=e.x32;e=e.y32}else c=-e,f=e%F,e=~~(e/F);if(wb(b)||b.checkMana(60,c,Hf)){b.setupDir(-b.x32+f,-b.y32+e);b.setupSpellIMG();c=8;f-=.5*c;e-=.5*c;var g=[];c+=1;var h=c*c;qa("bless",b.x32,b.y32);for(b=0;b<h;b++)for(var l=1;3>l;l++){var p=y[ib[l][b%c+f+(~~(b/c)+e)*F]];p.build||p.terrain||(p.setupChild(Db.bless),p.blessed||(p.blessed=1,p.attack+=5,Y(p.id,1),g.put(p)))}Xa({func:Bj,data:g},3E4,1)}},Ba=function(e,
b,c){if(e[1]&&y[e[1]].item){var d=e[1];e.length--;tf(e,b,c);y[e[0]].actionItem=d}else tf(e,b,c)},wb=function(e){var b=e.actionItem;if(!b)return!1;b=y[b];b.attack&&(b.attack--,0===b.attack&&(e.inventory.quit(b.id),Y(e.id)));return!0},Bj=function(e){for(var b=0,c=e.length;b<c;b++){var f=e[b];f.blessed=void 0;f.attack-=5;Y(f.id,1)}},Kf=function(e,b){Ba(b,e,Jf)};Kf.cursor=10;var Jf=function(e,b){e.freezed||!wb(b)&&!b.checkMana(50,e.id,Jf)?b.stay55():(b.setupDir(-b.x32+e.x32,-b.y32+e.y32),b.setupSpellIMG(),
qa("invisible",e.x32,e.y32),e.invisible||(Ad(e,fh),e.invisible=1,e.stay()),Y(e.id),Xa({func:zd,data:e.id},5E4,1))},zd=function(e){e=y[e];e.death||(e.invisible=void 0,rc(e))},zh=function(e,b){Ba(b,e,Lf)};zh.cursor=0;var Lf=function(e,b){if(wb(b)||b.checkMana(50,e.id,Lf))b.setupDir(-b.x32+e.x32,-b.y32+e.y32),b.setupSpellIMG(),qa("lightning",b.x32,b.y32),e.damage(50,b)},Nf=function(e,b){Ba(b,e,Mf)};Nf.cursor=0;Nf.noObj=1;var Mf=function(e,b){var c=F;if(e.id){var f=e.id,g=e.x32;e=e.y32}else f=-e,g=e%
c,e=~~(e/c);if(wb(b)||b.checkMana(50,f,Mf)){b.setupDir(-b.x32+g,-b.y32+e);b.setupSpellIMG();qa("flame%20ball",g,e);f=g-b.x32;g=e-b.y32;e=Math.sqrt(f*f+g*g);f/=e;g/=e;for(var h=b.x32+.5,l=b.y32+.5,p=[],m=[],k=0,v,q,u=0;u<e;u++)v=h+f*u,q=l+g*u,m.put(v),m.put(q),v=~~v,q=~~q,p[k++]=v+q*c,p[k++]=~~(v+g)+~~(q+f)*c,p[k++]=~~(v-g)+~~(q-f)*c;for(u=0;u<0*p.length;u++)vd(p[u]%c,~~(p[u]/c),"food");Xa({func:Ah,data:{list:p,anim:m,i:2,a:b}},1E3,1)}},Bh=function(e,b){Ba(b,e,ke)};Bh.cursor=10;var ke=function(e,b){b.setupDir(-b.x32+
e.x32,-b.y32+e.y32);b.setupSpellIMG(!0);b.setupINTV(yl,{u:e.id,a:b.id},0);e.addWorker(b)},yl=function(e){var b=y[e.a];e=y[e.u];if(!Wd(e.x32,e.y32,b.x32,b.y32,E[b.kingdom].values.teachDistance))return sa(e.id,b,ke,b.url.move);if(e.level>=b.level)return b.stay();if(wb(b)||b.checkMana(10,e.id,ke))qa("teach",b.x32,b.y32),b.setupDir(e.x32-b.x32,e.y32-b.y32),e.setupChild(Db.curse,!1,nl),rh(e,!1),Y(e.id,1),Y(b.id,1),Pb(b,rb(b.url.spell))},Pf=function(e,b){Ba(b,e,Of)};Pf.cursor=0;Pf.noObj=1;var Of=function(e,
b){var c=F;if(e.id){var f=e.id,g=e.x32;e=e.y32}else f=-e,g=e%c,e=~~(e/c);if(wb(b)||b.checkMana(70,f,Of)){b.setupDir(-b.x32+g,-b.y32+e);b.setupSpellIMG();f=g;var h=e;g-=8;e-=8;for(var l=0;256>l;l++){var p=g+l%16,m=~~(l/16)+e,k=p+m*c;pa(p,m)&&64>=Math.pow(p-f,2)+Math.pow(m-h,2)&&Qf[k]&&0===O[k]&&(P(p,m),new Tc(60,b.kingdom,p,m,0))}}},Ah=function(e){var b=e.list,c=e.anim,f=e.i,g=e.a,h={x32:c[2*f],y32:c[2*f+1],d:0,img:k.flame_trail,mv:1,z32:2,alpha:!0};$a(h);Zb.new(h,rb(h.img));for(h=0;3>h;h++){var l=
y[O[b[h+3*f]]];l.health&&l.damage(96,g)}e.i++;e.i<.5*c.length&&Xa({func:Ah,data:e},50,1)},Sf=function(e,b){Ba(b,e,Rf)};Sf.cursor=0;Sf.noObj=1;var Rf=function(e,b){if(e.id){var c=e.id,f=e.x32;e=e.y32}else c=-e,f=e%F,e=~~(e/F);if(wb(b)||b.checkMana(60,c,Rf))b.setupDir(-b.x32+f,-b.y32+e),b.setupSpellIMG(),qa("freeze",f,e),Xa({func:Cj,data:[f,e]},1E3,1)},Uf=function(e,b){Ba(b,e,Tf)};Uf.cursor=0;Uf.noObj=1;var Tf=function(e,b){if(e.id){var c=e.id,f=e.x32;e=e.y32}else c=-e,f=e%F,e=~~(e/F);if(wb(b)||b.checkMana(70,
c,Tf)){b.setupDir(-b.x32+f,-b.y32+e);b.setupSpellIMG();qa("confusion",f,e);b=4;f-=.5*b;e-=.5*b;c=F;var g=[];b+=1;for(var h=b*b,l=0;l<h;l++)for(var p=1;3>p;p++){var m=y[ib[p][l%b+f+(~~(l/b)+e)*c]];m.build||m.terrain||m.stoned||(m.confused=1,m.invisible&&zd(m),Ad(m,Yi),m.stay(),g.put(m),de(m.id))}h&&1===G.length&&Y(G[0]);g.length&&Xa({func:Dj,data:g},2E4,1)}},Dj=function(e){for(var b=0,c=e.length;b<c;b++){var f=e[b];f.confused=void 0;f.death||(Z(f,f.img,1),rc(f),f.stay(),Ya==f&&(Ya=void 0,G[0]=f.id,
Y(f.id)))}},Cj=function(e){var b=6,c=e[0]-.5*b,f=e[1]-.5*b,g=F,h=[];b+=1;var l=b*b;e={img:k.freeze_expl,d:0,mv:1,x32:e[0],y32:e[1]};$a(e);Zb.new(e,rb(e.img));for(var p=0;p<l;p++)for(var m=1;3>m;m++)e=y[ib[m][p%b+c+(~~(p/b)+f)*g]],e.build||e.terrain||e.nofreeze||e.stoned||(e.freezed=1,sb(e,32*e.y32),e.stay(),Z(e,e.img,0),e.invisible&&zd(e),Ad(e,Wi),e.health-=40,1>e.health&&(e.health=1),h.put(e),de(e.id));l&&1===G.length&&Y(G[0]);Xa({func:Ej,data:h},2E4,1)},Ej=function(e){for(var b=0,c=e.length;b<c;b++){var f=
e[b];f.freezed=void 0;f.death||(Z(f,f.img,1),rc(f),Ya==f&&(Ya=void 0,G[0]=f.id,Y(f.id)))}},Wf=function(e,b){P(b);Ba(b,e,Vf)};Wf.cursor=0;Wf.noObj=1;var Vf=function(e,b){P(e,b);if(e.id){var c=e.id,f=e.x32;e=e.y32}else c=-e,f=e%F,e=~~(e/F);if(wb(b)||b.checkMana(100,c,Vf))b.setupDir(-b.x32+f,-b.y32+e),b.setupSpellIMG(),Ch(f,e,3,20,4500,b.id)},Ch=function(e,b,c,f,g,h){for(var d=k.fire_rain,p=q.gravity,m=Date.now(),n=Ch.rnd,v=Math.PI,C=performance.now(),u=0;u<f;u++){var r=2*n()*v,w=c*n(),x=e+w*Math.cos(r);
r=b+w*Math.sin(r);w=~~(u/f*g);pa(x,r)&&Xa({func:Fj,data:{x32:x,y32:r-6,dix:0,diy:140,img:d,mv:1,d:0,timestamp:m,finnish:Infinity,aceleration:p,attack:40,xf:x,yf:r,range:2,kingdom:0,obj:h,crashTime:(Math.sqrt(19600+384*p)-140)/p*1E3}},w,1)}P(performance.now()-C)},Fj=function(e){Xa({func:sf,data:e},e.crashTime,1);$a(e,0,e.diy,q.gravity)};Ch.rnd=function(){var e=4096,b=2048;return function(){b=36969*(b&65535)+(b>>16)&4294967295;e=18E3*(e&65535)+(e>>16)&4294967295;return((b<<16)+e&4294967295)/4294967296+
.5}}();var qj=function(e){y[e.obj].damage(e.attack,y[e.obj]);Eb(e);Fb.put(e.bufferID)},Gj=function(e){e=y[e];e.bufferID&&(Eb(e),Fb.put(e.bufferID));Qf[e.x32+e.y32*F]=void 0},sf=function(e){var b=F,c=e.xf,f=e.yf,g=e.attack;e.mv=1;e.func=void 0;e.x32=c;e.y32=f;Ec(e,0,0,0);sb(e,2);c=~~c;f=~~f;var h=c+f*b,l=O[h];ic[h]?(e.img=k.expl_small_water,qa("water%blop",e.x32,e.y32)):(e.img=k.expl_small_hole,qa("small%20explosion",e.x32,e.y32));Z(e,e.img,1);Zb.new(e,Hj(wa[e.img]));if(2<l){var p=y[l];p.damage(g,
y[e.obj])}h=e.range;l=2*h+1;for(var m=0,n=l*l;m<n;m++){p=m%l-h;var v=~~(m/l)-h,q=~~Math.sqrt(p*p+v*v);q<h&&(p+=c,v+=f,p=O[p+v*b],2<p&&(p=y[p],p.damage(g*(1-q/h),y[e.obj])))}},zl=function(e){if(0<G.length){var b=y[G[0]],c=0,f=0,g=0,h=0;void 0!==b.dix&&(e=.001*(e-b.timestamp),h=b.dix,g=b.diy,c=h*e,f=g*e);if(b.space){var l=b.space;e=l[l.length-1];l=(l.length-1)/e}else l=e=1;c+=32*(b.x32+.5*e-Math.sign(h))+.5*-tzar.width+.5;f+=32*(b.y32+.5*l-Math.sign(g))+.5*-tzar.height+.5;pb=~~-c;ma=~~-f;od(-pb,-ma)}},
Ij=function(){};ie.distance="healingRange";wf.distance="createGolemRange";Hf.distance="blessDistance";Rf.distance="freezeDistance";Tf.distance="confusionDistance";Jf.distance="invisibilityDistance";Lf.distance="lightningDistance";Af.distance="createBatDistance";yf.distance="createDragonDistance";Ef.distance="createCarpetDistance";Cf.distance="createJinnDistance";Gf.distance="turnToStoneDistance";Mf.distance="flameBoltDistance";Vf.distance="fireRainDistance";Of.distance="freezeDistance";ke.distance=
"teachDistance";var E=[];var Nb=function(e,b,c,f,g,h,l){this.name=e;this.k=E.length;this.color=b;this.status="";this.stats={dmgInflicted:0,dmgTaken:0,resources:[0,0,0,0],score:0,unitsKilled:0,unitsLosed:0,buildsLosed:0,buildsDestroyed:0,unitCount:new Uint32Array(A.length),unitCountMax:new Uint32Array(A.length),unitCountDeath:new Uint32Array(A.length),goldTraded:0,goldConverted:0,stoneTraded:0};this.team=l;this.resources=h||[5E4,5E4,5E4,5E4];this.values={gold:10,wood:10,food:10,stone:10,buildSpeed:1,
experience:0,healthJump:0,maxLevel:4,pop:0,popMax:1,popLimit:200,healingRange:1,blessDistance:9,createGolemRange:5,freezeDistance:13,invisibilityDistance:9,createBatDistance:16,lightningDistance:12,createDragonDistance:4,turnToStoneDistance:21,flameBoltDistance:19,fameTech:0,confusionDistance:13,manaSpeed:2,milkSpeed:2,cowSpeed:2,stealCow:0,miningPerf:1,fireRainDistance:15,createCarpetDistance:3,createJinnDistance:3,teachDistance:2};this.race=f;this.racestr=Xf[f];this.IA=g||0;this.diplomacy=c;this.control=
{};this.control[this.k]=1;this.onFreePop=[];e=[];e.length0function=Al;this.unitLoading=0;this.target=[0,0,0,0];this.crusade={number:0,list:e};this.technology={hidden:{},disabled:{},actived:{},investigated:{}};this.mod=b=[];Jj[this.racestr]++;e=0;for(c=A.length;e<c;b[e++]={});E[E.length]=this;e=this.k;b=[];Cb[e]={};hb[e]=b;for(c=0;c<A.length;c++)b[c]=[];b=this.color;Ia[3*e]=b[0]/255;Ia[3*e+1]=b[1]/255;Ia[3*e+2]=b[2]/255};Nb.prototype.setupResources=function(e,b){var c=this.resources;b||(b=1);c[0]-=
e[0]*b;c[1]-=e[1]*b;c[2]-=e[2]*b;c[3]-=e[3]*b;vf(this.k)};var hb=[];var Cb=[];var Ia=[];Nb.prototype.check=function(){if(this.values.pop)return!0;for(var e=Bl,b=hb[this.k],c=0,f=A.length;c<f;c++)if(!e[c]&&0<b[c].length)return!0;this.die()};Nb.prototype.checkPopArray=function(){this.onFreePop.length&&Yd(this.onFreePop.shift())};Nb.prototype.die=function(){this.death||(this.death=1,this.status="defeated",Kj(),oc(Dh(x.playerDefeated,this.name),0,5))};Nb.prototype.paypal=function(e){var b=this.resources,
c=!1,f=this.k;b[0]<e[0]&&(Yf(f,x.gold),c=!0);b[1]<e[1]&&(Yf(f,x.wood),c=!0);b[2]<e[2]&&(Yf(f,x.food),c=!0);b[3]<e[3]&&(Yf(f,x.stone),c=!0);if(c)return c;b[0]-=e[0];b[1]-=e[1];b[2]-=e[2];b[3]-=e[3];vf(this.k)};var Yf=function(e,b){e==w.kingdom&&oc(Dh(x.notEnough,b),0,5)},vf=function(e){if(e==w.kingdom){var b=E[e].resources;e=b[0];var c=b[1],f=b[2];b=b[3];Infinity==e&&(e="***");Infinity==c&&(c="***");Infinity==f&&(f="***");Infinity==b&&(b="***");Cl.innerHTML=e;Dl.innerHTML=c;El.innerHTML=f;Fl.innerHTML=
b}},Bl={13:1,20:1,21:1,22:1,27:1,32:1,35:1,36:1,43:1,44:1,55:1,56:1,57:1},yb;var Lj=[];(function(){var e="",b=new Image;b.src="data:image/gif;base64,R0lGODlhIQB2AfcAAAAAABAIAAgAABEhACE6ABkbChAQAAgIABAQCO/vlN7epf/6hZSQUv76n721a//rY/XmhnNjECklEP7oecW1Y+7ZeP/rhvvrljEpCCgiB+/Wa97OjP/WSu3YhyEZAIhzLf/WWOnHWv7baL2lVt3Db/vsvUo3BGtSCGhVIdq1SnhjKdy4V62USuvIaPzad/felO/XlzopAGtaMe3Kd/zbiOjMhv/9+JxzGWNKECEZCP/JSuu5Sc6lSMynV4tzPdSyaK2UWjEhADopCNacKWNKGVdCGf/IVuu4VruUSPzJZ7qYU0IqABkQAGdFB2tKEFI6D5tzKMqVN9unSNyrVlRDI/nLd7JwACkZAOaUEDEhCMSMMZRrKYlkJ/u3SJt0M8yYRquDQO66Zu3MlrWcc5haAItSAf+lGUIqCGNCEJdjGXpTGJxrIfisOGtKGcSNOtacQruHOfu6VsiYVOm6dPvLh/rZqTohAHdHB3NKEFo6D0kxEJRjIc6MMalzKYRaIZxrKXlTIuCcP6x5M+umR1I6GX5aKdacSuqqVdedUollNK2HVUopAFQxBXtKEGtCEMmBJ7h2J3NKGdeNNMOCMWNBGZRjKf2rR86MOtaUQpdpMt6cSrqFQkk0GnVWL9OjZolVGeeQLJ5jIKdqJ4xaIeCTObd6NembRt6UQsWEPGlHIf+tUsuMQ9aUSppyRzEZAGU1BkopCHNCEDohCFIxECkZCPeXM3tKGdKDMIRSIZxjKlo6Gc6EOoxaKahwNt6USjUkE/zLmUIgACEQAIZLEtZ2H5ZUF2Y6ELlpIN9/KGtBGUUpEHVKIRkQCNaMRntCEHNCGZdZI86MUjoZAFQoBs5qIF0xECUZEE8hAHQ0CIQ9C5RHD65TFb5cGXY6EDEZCHtCGYRKIVIxGSkQAEohCEIfCVIpEKJEEUUpGWgnBzoZCEIzKzEQABkIAHMpCIw0CyEQCFsZAlEZBikQCDQZECEHAD4PATEQCGshEDEIAPNGKRkAABAAABkICBAICAgICP///yH5BAEAAP8ALAAAAAAhAHYBAAj/AP8JHEiwIEEBBhMqXPiP3QGEAwVAZKgQYoBwLAIMpIUCwESKE5lI/CeA0woU+wTSIvHk40IBD/9x+vHrnYB9+358EbdPwDsavfi5NMiEChcA/5i0QIKrzTsANeQoC+DzAhJvKYcK3AeoAheqAlbo0XNGlpIKR5axEyChwwo/U7UK+EWiAxRdgH5RGnWpD6ArwpCUWlaES40WX0pRompQwIcXLbR8ObKi1BdUcXatMsZuFCUuUtxKidLr11ABT5Ag+tIHjK5MYb5UilPqlK0rVwKkmiJFyyVBpgsyCRCAEpIvyubJC4CkCq9Rh3JhqiRSAJQvcPgIUgaTIIofMvL8/5hCKwfEHmEiDcq0CtosdklHjeoDaSpSgQKoWGjRowMYWh4JlEgYm4wyhR+buaKLAEwoQ4gfs9CikUBM/OBWCytEAuBESIThhyZbVGILOU+QJEAOhFBCyy/44QDDDFKsgJwwqRA0oBejiBJJMmecYSIAOSxjjzf4jeLCFNi9ocxugAyk3hSVhIILGmd4U6KJ77yTAzu/cMIOZXBQ4gcsRXyRhB4CPXEJHT2U4kUyeggzS0QCABAAHD0koUIP/HkjzwH/+ODCFz7qUQoNM3zBVB5X+GjQLGBQtkIHSTxDXAB5wGFBGEUUcUsVF8SWSzJZyJLQTZUc0cIMK7ghhAAZ/P9DySAWuBCHKYdcMMMUgkQSZxGnyiPFF27wIAUX9hgQQBu4DOKCrVLQUMURboySBxNonurFCmn4UYoWfsiT0l6TDBLHIWGEgeQfaAQhREXhrADHLLrgIsgswgiURySiuCEFK4dg4oYoz5yhlUDiRCEFJfZk0UYeNgkkizGfiCJKKajAkYstswTQpEKzVsIOO+Rk4Y1IAglzRh7OQFOKIKF8wmgWClHVhyRFBOARLbRMxI4wsDgSSh99jJKMLKfNxY4abgiii851fiQAO64Yc4woebiCckE5qFCFEnB8IcUWv2zdmDDDSCMRg40RIkgILVAmxRPvTJjQPuwA4FG+pzL/w8UkYGCXzC8BJkSVnSBloYssnMxSsgEHU2RQFjoH4I0wkUuuEAB4Z655RZ8rVAIgzIQeehx0RMKE6Z9XkcQspbNOESZ0xAG77BQFAoztseOukO6WlNO77waZUocls+RAvEKHHJ/88gk1X4sxtEBvUBh1sGGM8tYTNIgNtXzC/T9kVA99IOA/f0cJtYxPPB82gHLHP03QYAU93fOBzDE5bGLKK90byB1I4Q3zdS8PjGhCCaxgQOjdwQZWMAMtzIAFmlmPBmzIAiX+8YohlKEM81teGXg2kDLYgAZkCOBAmlCLWtxHhf/4IAxnSMMa2vCGOMyhDnfIwx768B82QEMN/2dgg3fN0BNhsAERZtgKRMDABsaYISvCAIMSPINIAczEEeRQhxK8woLWe8UOLrGCElzAFukIIB+O8IgpXGAOr0hHH6yXiyQkRgwwSMIdvGGx5anBCFNYhSjmMIcj3MAbgIDE8jQRBkQIYg3j2YEUZBELLRAPCUk4hBy4kAs5wEFh8nDEG6KAuyZkcgpwaEQvFCGIK3jjDIx4xA5wd4QjBPITjviDMITBjiysCAMvDF0f4iCFUkBDDx6QhTVmIY/CyY4eSZACKi5BjgA0QgtbkEUDZReFHexAHOKoRAPC0IZXLm8ZIBCHzvTgiVKlwhrLO4cx9oEUAGSAFnKYAhf6of9CABxAEDtIhCxMAMMA7OEMPSiGGmDIiDF0AAnQgOEBQFEDRgSzeyYoBqZ+yNGOevSjIA2pSAVygic0gXVLkFwT3BGPeIQOHYx4wkUL0gRzcCMe2KiH5tCBDnfo7R/kUIg79hcPdLhUcuiwqUvrwQiDtJQatQiEOdxBAKQO9RgR6GlCpsENZOgAGdxoRzAo8tSoTpUA7RhIPYo6VB3ooAuSaCpFuOpVsLZDrsFohzt4So0u6MAIICjGWBligra+Na7uYEQw3OGOf5iAG2z46wOksA10UAQdff1rYBlbD3MU4x/40EYtACuCB1SWIo+NrBEmy9MMcIMa7sAHPh6hAxD/GIEDoOAGNggrWtKaFh3C2AYoGCvbY7CBDaAgRjF2S9ha1Pa2oMgGPhhRC9hqY6/aSC4xZMHchZgAG9g4bnKLEQ/hgsIc1KCGOeqhjW6wFJwUwYY7skuM7b5iG1A9BlSJgQ5yoMMY2CiA5kyAjm24Nx5LcAc12BAIZBx3G8HARgbEEVTJYWMc4/gvNmiBDmKAQge1YEMXkGEOciDucxgex4QZUY/6dsEIx60FMnA3DmwwIwCMYIQ5zEGMOOiADSGuMOsC8F1s5HjHo+1CLUABCuIFYLc7tikpunAL4Q4Deozdhja2wQ1zwOMRw7gy8eABj20Uoxxchgc5lKGM5cGj/7NnCEA3wgqAJaQUeu2gypPRUY9pbMN6AchCBhAQjAybo3tkzkA83lEAIXcvB9gQRwGkMdJKW/rSBlHGDFhHAxZRJAdV2PTnfhCGbSbkHZqgQRg0hwgXaMLTDBEGL1ywK4qsIgxJyISpDSKMZEBCD0VIxEIooQxvbCMZuy6IN6YSgGQPJAuY24ezB+IndsDCCFFUSB6mAIt3sAOLmnsGJXRBhSIAQhB9EIUXEkGIZETI0Zr7hS5IMYELXKABF6hAC5JwhC+0wZes08UXBpEEC1igAQ2oVRICAYdKKAPeklvGwI0wgYM3YAJJiMMb4MALPUw7Ictwg7lEgHFTTCEJYf9wQy9SUZOA/yEQcQDBD/KRD3f4AA598MMTaPEO1inDW4OwRCvu4Y56qAMQe2iDMnIgD9Z5IxJ9MIUlOsGJeajj6J/QxS+Y8XGD0IISezhFF7rwB3VQAQqTiESEEADuz3ljFkDvgghEYIRBKGbpzADj52ThsJfL3QVGOAIXnpAFZuRddjl4Ai5IYQkjiICYfvA4M3ouO1n8IhKCGIQRkmCJLwBi6c32nTcI0Qdz1V0QRaBc1xkiC13AwQinJwQz2o67TCjDGKUwRR+MUQ0JWO8Qn3+HhNjxiVNA7xBfqIaQx5EHTKyCeGCYAiXSSJB08IIUgsBdKwyBC9oLRBm5sLv/7MCQiDYrJBWtyASm189+9tvBDq4QBwyfMApW9CEZ7EhJ98Cwik3EYRKrYFHdkwhV8AW4kASiYAqRMDLWIwc0gAu2cAi4oAm84DmjVgV5IIHNMApnMFOy4zWbAAiH8AyowAj0MCfQowRzEAmHUAi84AhXQFCycyUCUgWZgAu5gAbGcAWuIDtEcAjAIhDJcAg/wAuVoAbV4ArsIIOh8wRy4AJBIBBnsAoX8AOb4AXGEAz7YCqs4wMQgAhX8A9nUAoXQANToARqwAhUIzsmsAoJEAZjsQs00AAFWAnGsEu4kwdxkAATcASkEAYNoGqCEAvBIADZYjqUoAaHAAEYlyuq/2aAsCAAjsI6eTAKbnAIKFcFVRAGhvAHeSAMYYg7JuAIorAKU4AIYcAKXyAKO+iBnyMOjKAGfyAKvVAKm5ALjhAMAPAxuLMP0jANxjAMgiAI0OAIsPAzy+MRrjANwwAN0MB74uCKoaM3+jANxVAMdrAW0mg6nPMK9KA3zgQ9HgGOdmM94LiN7ZeO6riO7HhpvdALgJAKNdI9QFAKq7AKqggGhQBrvvMDM2AKvsAK94gKm5AJ50A8PwADdBAGAMkKqECQmyAInOA7JFACM3AIhzAIlXBurLAJBTmRsvMDJVADh7ADEPACiZAKuXePnYA7P2ADdRAGgzAHNqAA35AKnP+QCJ1ABbjDRSUQBhipATZwBLkAADc2ALgDBh1AA3FzBKkQAhuwCalQjrKDCPl2BILgD9TQC60QDa0gYL6TCj/QAodwDgDACZsADK3ADAiwPKmQCVQQO5nQCe/Qb9XglsFEBb9QBz8gCLYAQ79ABXy5ChukQr/QCTDgCaUQDoBJBWLgCZkAkgH0C4nwmJnAmIbZCmIgB51AldDzC62gCOqQAZ65PL/wCwdAHDN0Ke3Ymq75mrAZm7ApmbhDmwSRCqdQmOFgfp9DCKigC5kGCKUADsogAnCFmQwRB3GgBxeDC6aWBctwBtzwAA1gCZFAEV0wAQ1wDNWQDJRnEAeQBZD/YAkuUJ28aRCWUHGWgAzCoHeZJgi7kJ4NcAsKUQsNIAKmIAmiAJwMkQOUwC+3cAQQkAwGkQsL0AWQMArQoCGSkwM8MwvVMAu+QhCzoAbdMA16oE3uwzq4EAeqcJ7W06ElIALQAKLLE4E0cAvpUJq+MwtWMw4BsDoq9A4ZyqIU8XV/UAqScJ9GwIsDMQopQAKBMAkv0waHyDX+VApJUAITEAi8gJwDoQzHcAQlQAeDwAVTYaL/ACBMcABwMAinIApQShCyAAldkACJEAAHACQJoQx/gAzKcABuUApaOhDGIAnHAADdoA0kVBCzIAmWwAbcAADLkAx1+n1/wAS/wAeg/0ANBaEMcKAKpoAJnZAFAKAHhzoQyaAzlPAFpkAKkGBBunEJojALT2GUR6oQlKM3utALl0CnysMMB7AM5sMzY7oQv2A+DqML72B+zMCPxMMJB7B6slmsxnqsyNqO+0AfvoMOxcANxIAMknALx9AHoHgEgzAIxxA6jNAIj0AKRxCI0hIGkjAM7JAG5UmHpvA5mNMIXeAGaeAIS3AF4tAEWfMIoGAEFjcDbyA5IoEbxMEOTMAEAssEwuAEofAIjyAJSfAsUyA5+ReF//AJgjAJdwaKrrAIefAKd3AHogAH/fo5dyAGJWAJ1BAD/yAM4mAHMWAHgLFLBksRFisQV0ADSf8wCKGwCLgzCW/AB4GABsPxD3aQbq/wCnbwOVwABsYyAzRgK4MQBIUDGOIgo/8AB1uABqJAgwQhDksjBWFQBS5QBVGAOaIACYvwBGcQA4wgCF57CHFACqJwZwkBAMGwDccACX2xD0EgCpJgBC5gAWVYBdIyGsVAD/LHEPtwDdjwCX2wFsWQBpCgsNN6CZOQBp8QC9JwBVTLEAHADoygM0zgCuswDdfAU9LQE5wTDD34OewQAK6gfzPEN8k6u7Rbu7Z7u7ibu5rTB+LAhSr0LNPAN4VgqbuoBJ+FOyKwAq9gCAYXBqUwAxVAAz8wDdhwvKxTDCFgAUlwb67TAmEwA47/kA2LKzsNsABJAHtx0AWB0AMkQAl5EwvOwDoJB3tG0AWDQApTAAaYQxw/FTrl6wIZ1wWgQAqIsARrozcWWBAAbARxMAiSgAibsL/nKDthgK2kgAmIYAwSoY11gjtTsAluoAmlQBX0cAYqEBO+AwdKoASMIBH0Cgap4AqhiDtKoAiuQBUHgAcqsAAO0AEMQDxMIA514hEBIAwU8ASfcAUJ/DlXUAFPYLfXsBYBdAbbUAWmEAoC2D2u8AoAPAmfIMXdIwClUAWaAA0trEKycAhVAAmOgDkBZAe4EAY/8AmRqEJnAAdzIAiOcMMqxAhfMAqzQDl2nMRqaqO4kxtLrLuK/7zIjBxSsLAIROIEgMkCUqAOUDANAbQFH8ACK+ACbfAJAqEGLLBQvpMBbbACK9AFXOAov7ADR+s7A5ACPAACg2ALRiQNtHANy+MNn5AMsMAEJ2UQetAGbcAIsAAFn0MLJsAOdiBXBgEASAAIPdAK5ODMC+EIjjANWSACSDEWZSEQX0ACYcADK2AIMkIR2VAEKwA0D8AEe9EXfyEMAGAMSRACIdArM7wQAXAEI8AFM9AGXnAZmbEZ7JC8UoAEUfAJqWo4gGABSqABI6AHmyAbtGEbuNEHe4AHdWYQd2DCjKAJLoAEIr0CUiAFhFAERQgd0kEd7CAPApBsDDABLSAA5P/gLCtAGVPwB0TgA+mxHu3xHuxwDbsGAJsQAl2gN8swCFMgKVJgDHpAIAaCIMagIAshDVzQBVpwAFywADCCylOQCZSgB53gISAiIiTCEOGgN1CgBUUbBVGgDFygBt7wDlwQBjiiIzwyiQnxCgLACK7gCrvIBYSwCUXwBHP9JFEyJVWitQzRD81w0mYyFkygJmziJnAiJ5rzCrLwDD4hKIQyD4aCKIqCC4yi1wvxCvQkDrSQKZvSKZ8SKl8wKqXCOgbgDbNSK7eSK7vSK7/CED4ABipQEMziLNAiLdRiLdiyEMxwBF1gouRiLuiiLl/ALu6yENOQCG0ACwmxL/3yLwFJMzAFkzmguBATUzEXkzEb0zE+yjoqwzIuAzMycwXuyTo/EzRDUzRHk8gVQTVWgzVao98vgTZqIxGbuzx4g8CyC2h1YsiN/DkBAQA7";
var c=document.createElement("canvas"),f=c.getContext("2d");b.onload=function(){c.width=33;c.height=34;for(var d=0;11>d;d++)f.drawImage(b,0,34*d,33,34,0,0,33,34),Lj[d]=c.toDataURL("image/png"),e+=".ncursor"+d+"{cursor:url('"+Lj[d]+"'), default}",f.clearRect(0,0,33,34);document.getElementsByTagName("style")[0].innerHTML=e};Gc(2)})();var le=function(e,b){r(e).style.display="block";le.actived=e;b.actual="potion";b.id=0;b.amount=100;b.func()};le.actived="";var ca={potion:{bak:1,max:4,ord:["level","mana",
"attack","defence"]},sword:{bak:5,max:3,ord:["attack","attackBow","defence"]},book:{bak:8,max:18,ord:"fireRain lightning healing createCarpet createBat bless freeze confusion invisibility createGolem magicVision raiseDead turnToStone whirlpool createDragon flameBolt teach createJinn".split(" ")}};r("mgbook").onclick=function(){ca.actual="book";ca.id=0;ca.amount=c[ca.book.ord[ca.id]].obj.spcost[0];ca.func()};r("mgpotion").onclick=function(){ca.actual="potion";ca.id=0;ca.amount=100;ca.func()};r("mgsword").onclick=
function(){ca.actual="sword";ca.id=0;ca.amount=100;ca.func()};r("mgdecline").onclick=function(){r("magicworkshopmenu").style.display="none"};r("mgitem").onmousedown=function(e){var b=1;e.button&&(b*=-1);e=ca[ca.actual].max;0>ca.id+b&&(ca.id=e);ca.id=(ca.id+b)%e;"book"==ca.actual&&(ca.amount=c[ca.book.ord[ca.id]].obj.spcost[0]);ca.func()};r("mgaccept").onclick=function(){fa(Mj,[ca.actual,ca.id,parseInt(r("mgamount").innerHTML)],G[0])};var Mj=function(e,b){b=y[b];var c=e[2],f=[c,0,0,0];yb.paypal(f)||
(c=~~(250*c),"book"==e[0]&&(c*=2),b.setupINTV(Nj,[e,b.id],c),b.lcost=f,b.techStart=b.c-q.cycle,Y(b.id)&&(r("magicworkshopmenu").style.display="none"))},Gl={defence:6,mana:0,level:2,health:1,attack:5},Hl={attack:"sword",attackBow:"bow",defence:"shield"},Il={attack:.5,mana:1,defence:.5,level:.2},Nj=function(e){var b=y[e[1]],d=e[0][0],f=ca[d].ord[e[0][1]];e=e[0][2];b.lcost=void 0;"sword"==d&&(d=Hl[f]);"attackBow"==f&&(f="attack");d=Object.assign({},Yb[d]);if(d.potion)d.d=Gl[f],d[f]=~~(e*Il[f]);else if(d.book){var g=
c[f],h=g.obj;d.spell=f;d.attack=~~(e/h.spcost[0]);d.name=h.name;d.iconID=g.iconIDbook}else d[f]=~~(.25*e),250<d[f]&&(d[f]=250);P(d);Sc(52,b,!0,d);b.techStart=void 0;Y(b.id)};r("mgamount").onmousedown=function(e){var b=10;"book"==ca.actual&&(b=c[ca.book.ord[ca.id]].obj.spcost[0]);var d=b;e.button&&(b*=-1);vb.shift&&(b*=5);ca.amount+=b;0>=ca.amount&&(ca.amount=d);r("mgamount").innerHTML=ca.amount};ca.func=function(){r("mgitem").style.backgroundPositionY=-48*(ca.id+ca[ca.actual].bak)+"px";r("mgamount").innerHTML=
ca.amount};var Zf=[0,0,0,0,0,0,0,0],Rb,nd,za=[document.getElementById("order1"),document.getElementById("order2"),document.getElementById("order3"),document.getElementById("order4"),document.getElementById("order5"),document.getElementById("order6"),document.getElementById("order7"),document.getElementById("order8")],Oj=document.getElementById("bottominfo"),me=za[0],ne=za[1],oe=za[2],pe=za[3],qe=za[4],re=za[5],se=za[6],te=za[7];me.addEventListener("mousedown",function(){me.style.transform="translate(2px,2px)"});
ne.addEventListener("mousedown",function(){ne.style.transform="translate(2px,2px)"});oe.addEventListener("mousedown",function(){oe.style.transform="translate(2px,2px)"});pe.addEventListener("mousedown",function(){pe.style.transform="translate(2px,2px)"});qe.addEventListener("mousedown",function(){qe.style.transform="translate(2px,2px)"});re.addEventListener("mousedown",function(){re.style.transform="translate(2px,2px)"});se.addEventListener("mousedown",function(){se.style.transform="translate(2px,2px)"});
te.addEventListener("mousedown",function(){te.style.transform="translate(2px,2px)"});me.addEventListener("mouseup",function(e){Rb=e.button;Ka(0)});ne.addEventListener("mouseup",function(e){Rb=e.button;Ka(1)});oe.addEventListener("mouseup",function(e){Rb=e.button;Ka(2)});pe.addEventListener("mouseup",function(e){Rb=e.button;Ka(3)});qe.addEventListener("mouseup",function(e){Rb=e.button;Ka(4)});re.addEventListener("mouseup",function(e){Rb=e.button;Ka(5)});se.addEventListener("mouseup",function(e){Rb=
e.button;Ka(6)});te.addEventListener("mouseup",function(e){Rb=e.button;Ka(7)});document.getElementById("stock").addEventListener("click",function(e){Pj(y[G[0]])});var Pj=function(e,b){if(0==I.stockActive||b){if(b=e.inventory,b.length){var c=[];c.length=b.length;for(var f=0,g=b.length;f<g;c[f]=y[b[f++]]);ja(c,e,1)}}else ja(e.icons,e)};(function(){for(var e={},b=0,c=za.length;b<c;e={l:e.l},b++)e.l=b,za[b].addEventListener("mouseenter",function(b){return function(){var e=I.displayed[b.l],c=y[G[0]];if(c&&
c.kingdom)var d=E[c.kingdom];if(e){if(void 0!==e.unit){c=A[e.unit];var f={name:c.name,cost:$i(c.cost,e.hero||e.merc,d.values.fameTech)}}else f=e.obj;I.stockActive&&Xc(I.active[b.l].id,1,1);if(f&&f.name){var m=f.name;c="<span>";c=2==m.length?c+(m[0]+" - "+m[1]):c+m;if(m=f.cost||f.spcost){!f.tech&&d.mod[f.type]&&d.mod[f.type].cost&&(m=d.mod[f.type].cost);c+=" - (";for(d=0;5>d;d++)m[d]&&(c+=m[d]+"<img class='resource' src='"+Jl[d]+"' /> ");c=c.substring(0,c.length-1);c+=")"}c+="</span>";G.length&&(E[y[G[0]].kingdom].technology.disabled[e.id]&&
(c+="<span class='red'>"+x.requires+": "+e.require+"</span>"),f.type==Ra&&(c+="<span class='increase'>+"+f.increase+"</span>"),(d=I.active.cut)&&d[e.objName]&&(c+="<span class='shotcut'>"+d[e.objName].toLocaleUpperCase()+"</span>"),Oj.innerHTML=c)}}}}(e)),za[b].addEventListener("mouseout",function(){I.stockActive&&Xc(G[0],1,1);Oj.innerHTML=""})})();var Eh=function(){history.pushState("",document.title,window.location.pathname)},bc=function(){q.online=0;location.hash="";r("MatchX").style.display="none";
document.getElementById("index").style.display="block";document.getElementById("returnmenu").style.display="none";document.getElementById("game").style.display="none";document.getElementById("chat").style.display="none";document.getElementById("gameFinish").style.display="none";setTimeout(Eh,200)},Ka=function(e){var b=Zf[e];Ka.lastFunc=b;Ka.nu=e;if(I.stockActive){b=y[G[0]];var d=y[b.inventory[e]];d&&(d.potion?vb.control?fa(je,b.id,[b.id,d.id]):(Q=je,Q.item=d.id):d.spell?vb.control&&b.mana?fa(xj,b.id,
d.id):(c[d.spell](),Q.item=d.id):(fa(xd,b.id,[d.id]),Y(b.id)))}else b&&b();Ka.lastFunc=void 0;Ka.nu=void 0;za[e].style.transform=""},qi=function(e){var b=[.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.27,.3,1,.5,.5,.5,1,.62,.62,.62,1,.74,.74,.74,1,.3+.58,.3+.58,.3+.58,1,.94,.94,.94,1,1,1,1,1,1.06,1.06,1.06,1,.3+.82,.3+.82,.3+.82,1,1.08,1.08,1.08,1,1.04,1.04,1.04,1,1,1,1,1,.95,.95,.95,1,.3+.58,.8,.7,1,.3+.54,.72,.6,1,.7,.62,.5,1,.6,.55,.3+.15,1,.5,.44,.42,1,.4,.37,.35,1],c=new Date;
null!=e&&(c=e);e=c.getMinutes()/60;c=c.getHours();document.getElementById("daynighticon").style.backgroundPosition="0 -"+36*c+"px";var f=[b[4*c],b[4*c+1],b[4*c+2],b[4*c+3]];c=(c+1)%24*4;f[0]+=(-f[0]+b[c])*e;f[1]+=(-f[1]+b[c+1])*e;f[2]+=(-f[2]+b[c+2])*e;f[3]+=(-f[3]+b[c+3])*e;return f},pb=0,ma=0,Yc=0,Zc=0,od=function(e,b){var c=tzar.width,f=tzar.height,g=w.mx/32;e/=32;b/=32;var h=ba*c*.03125,l=ba*f*.03125,p=.03125*c,m=.03125*f,k=e+.5*(p-h),v=b+.5*(m-l);0>k?e=.5*-(p-h):k+h-g*ba>F&&(e=F-h-.5*(p-h)+g*
ba);0>v?b=.5*-(m-l):v+l>ua&&(b=ua-l-.5*(m-l));h-w.mx>F&&(ba=F/(.03125*c),P(ba));l>ua&&(ba=ua/(.03125*f),P(ba));pb=32*-e;ma=32*-b},Mc=document.getElementById("minimap"),$f=function(e){var b=e.pageX-parseInt(Mc.style.left);e=e.pageY-parseInt(Mc.style.top);var c=tzar.height*Lb/(32*ua);b=~~(.5+(b-tzar.width*Bb/(32*F)*.5)*F/Bb);e=~~(.5+(e-.5*c)*ua/Lb);od(32*b,32*e);0==nd&&document.removeEventListener("mousemove",$f)};Mc.addEventListener("mousedown",function(e){var b=e.pageX-4,c=e.pageY-31;0==e.button?
(document.addEventListener("mouseup",function h(b){document.removeEventListener("mouseup",h);document.removeEventListener("mousemove",$f)}),nd=!0,$f(e),document.addEventListener("mousemove",$f)):2==e.button&&(b=~~(F*(e.pageX-4)/Bb),c=~~(ua*(e.pageY-31)/Lb),fa(Qb,b+c*F,G))});var vb={control:0,shift:0,esc:0},va=function(e,b){e&&!q.editor&&(e=I.active,b=Kl[b],e&&e.cut&&(b=c[e.cut[b]]))&&(e=yb.technology,Rb=0,e.disabled[b.id]||e.hidden[b.id]||(Ka.lastFunc=b,b(),Ka.lastFunc=void 0))},We=function(e,b){var c=
document.getElementById("notifybar"),f=document.createElement("div");f.innerHTML=e;b&&(f.style.background=b);c.appendChild(f);setTimeout(Ll,11E3,f)},Ll=function(e){e.parentNode.removeChild(e)},Tb={37:function(e){Yc=e},40:function(e){Zc=-e},39:function(e){Yc=-e},38:function(e){Zc=e},32:function(e){Ij=e?zl:function(){}},46:function(e){e||fa(ue,vb.shift,G.slice(0))},16:function(e){vb.shift=e},17:function(e){vb.control=e},27:function(e){vb.esc=e},13:function(e){e&&!q.editor&&("displaynone"==Fh.className?
(Fh.className="displayblock",Gh.focus(),Tb.blocked=13):(Hh(),Fh.className="displaynone",Tb.blocked=null))},19:function(e){e||q.online||cc(1)},48:function(e){e&&vb.control&&(ba=1,ug({deltaY:0}))},176:function(e){e&&(q.deltaTime+=3E4)},65:va,66:va,67:va,68:va,69:va,70:va,71:va,72:va,73:va,74:va,75:va,76:va,77:va,78:va,79:va,80:va,81:va,82:va,83:va,84:va,85:va,86:va,87:va,88:va,89:va,90:va,219:function(e){e&&Qj(-1)},221:function(e){e&&Qj(1)}},Kl={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",
73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};Tb.blocked=null;(function(){for(var e=[65,37,40,83,39,68,38,87],b=e.length=0,c=e.length;b<c;b+=2)Tb[e[b]]=Tb[e[b+1]]})();document.oncontextmenu=function(){return!1};var zb=document.getElementById("attackmenu"),$c=document.getElementById("defencemenu"),ad=document.getElementById("levelmenu"),Bd=document.getElementById("kingdom"),Sa=document.getElementById("progressone"),ag=
document.getElementById("unitname"),Ic=document.getElementById("progressvalue");document.getElementById("selectedobject");var ue=function(e,b){if(b.length){e=e||q.editor?b.length:1;for(var c=0;c<e;c++)y[b[c]].die()}},Oa=function(e,b){e.sound&&!b&&(b=e.sound,qa(b[~~(b.length*Math.random())]));ad.style.display="none";ve.style.display="none";Bd.style.display="block";Sa.style.display="block";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";$c.style.display=
"none";ag.innerHTML=e.name;we(e);Bd.innerHTML=E[e.kingdom].name;e.attack?(zb.style.display="block",zb.innerHTML=e.attack):zb.style.display="none";b=e.health;var d=e.maxHealth;Infinity==b?(Sa.value=100,Sa.max=100,Ic.innerHTML=b):Sa.value=b;Infinity==d&&Infinity!=b?(Sa.max=100,Sa.value=1):Infinity!==d&&(Sa.max=d);e.inventory&&e.inventory.length&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=e.inventory.length);Ic.innerHTML=~~b+"/"+d;if(!sc(e,w))return ja([]);
e.point&&(b=e.point,Za.x32=b[0],Za.y32=b[1],sb(Za,96*(ua-1)),Za.show=1);if(!1===e.built)ja([c.stopBuilding]),we(e);else if(e.techStart)ja([c.stopTech]),we(e),manamenu.style.display="block",manamenu.style.backgroundPosition="0px -200px",manamenu.innerHTML=100-~~(100*(e.c-q.cycle)/e.techStart)+"%",Oa.intv&&clearInterval(Oa.intv),Oa.intv=setInterval(function(){G[0]==e.id?manamenu.innerHTML=100-~~(100*(e.c-q.cycle)/e.techStart)+"%":clearInterval(Oa.intv)},400);else{Rk();if(e.working){d=e.work;var f=I.page*
I.length;b=0;for(var g=I.length;b<g;b++){var h=d[b+f];za[b].innerHTML=h?h:""}manamenu.style.display="block";manamenu.style.backgroundPosition="0px -200px";var l=1E3*A[e.waitlist[0]].time;b=~~(100*(q.now()-e.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%";Oa.intv&&clearInterval(Oa.intv);Oa.intv=setInterval(function(){if(G[0]==e.id&&e.working){var b=~~(100*(q.now()-e.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%"}else clearInterval(Oa.intv)},400)}else for(b=0,d=I.length;b<d;za[b++].innerHTML=
"");ja(e.icons,e)}};Oa.intv=!1;var xe=function(){zb.style.display="none";$c.style.display="none";ad.style.display="none";Sa.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";ag.innerHTML="";zb.innerHTML="";$c.innerHTML="";manamenu.innerHTML="";ad.innerHTML="";Bd.innerHTML="";Ic.innerHTML="";Sa.value="";Ic.maxLength="";ve.style.display="none";me.innerHTML="";ne.innerHTML="";oe.innerHTML="";pe.innerHTML="";qe.innerHTML="";re.innerHTML=
"";se.innerHTML="";te.innerHTML="";ja([c.origin]);Rj()},Q,Ya,Ub,ug,tc={},ih=function(e,b,c,f){var d=c||y[G[0]],h=f?E[d.kingdom]:yb;if("peon"==(c?d.clss:Ub))var l=!0;if(q.editor)return[tb,m];var m=e+b*F;if(!f&&Q!=tb)return[Q,m];e=O[m];b=0;if(!d)return[b,m];if(2<e||(e=bd[m])&&2<e){var k=y[e];k.invisible||(l&&k.storage&&d.stock?b=th:l&&void 0!=k.res?b=fe:l&&k.health<k.maxHealth&&!h.diplomacy[k.kingdom]&&k.build&&!k.dummy||k.dummy&&!k.built?b=yd:h.diplomacy[k.kingdom]||k.dummy&&h.values.experience||k.confused?
b=nc:1===k.invType&&!d.build&&!d.boat&&0<k.invMax&&sc(d,k)&&(b=ce))}else e=Ma[m],2<e&&!d.build&&!d.boat&&(k=y[e],k.item?b=wd:k.field&&l?b=rf:1===k.invType&&!d.build&&!d.boat&&0<k.invMax&&sc(d,k)&&(b=ce));0===b&&(d=Cb[d.kingdom],d[m]&&l?(e=d[m],b=yd):(k||(e=-m),b=Qb,Qb.cursor=2));return[b,e]},G=[];G.change=1;var Sj,Cl=document.getElementById("gold"),Dl=document.getElementById("wood"),El=document.getElementById("food"),Fl=document.getElementById("stone"),R,Ih;var Jh=!1;var Sb=function(e,b){var c=ba,
f=tzar.width,g=tzar.height;e=e*c-pb+.5*(f-c*f);b=b*c-ma+.5*(g-c*g);return[e,b]},Kb=function(c){if(c){var b=c.pageX;c=c.pageY;Kb.lastX=b;Kb.lastY=c}else b=Kb.lastX,c=Kb.lastY;b=Sb(b-w.mx,c);c=b[1];b=b[0];0==Jh?(window.removeEventListener("mousemove",Kb),Ih=!1):Ih=!0;if(1===R[2]||Kb.forced)c=32*~~(c/32),b=32*~~(b/32);R[4]=c;R[6]=b;R[9]=b;R[10]=c},Tj=function(c,b){b=y[b];O[c[0]+c[1]*F]==b.id?(b.point=void 0,G[0]==b.id&&(Za.x32=2*F,sb(Za,128*F),Za.show=0)):(b.point=c,Za.x32=c[0],Za.y32=c[1],G[0]==b.id&&
(sb(Za,96*(ua-1)),Za.show=1))};document.onkeydown=function(c){return c.ctrlKey&&c.shiftKey?!1:{116:1,115:1,123:1}[c.keyCode]?!1:!0};var Uj=function(c){if(null==Tb.blocked||Tb.blocked==c.keyCode){var b=Tb[c.keyCode];b&&b(1,c.keyCode)}},Vj=function(c){if(null==Tb.blocked||Tb.blocked==c.keyCode){var b=Tb[c.keyCode];b&&b(0,c.keyCode)}},Wj=function(c){var b=window.innerWidth,e=window.innerHeight,f=c.pageX,g=c.pageY;if(screen.height-10<=e){if(1.2==Math.abs(Yc)||0==Yc)Yc=1.2*((10>f)-(f>b-10));if(1.2==Math.abs(Zc)||
0==Zc)Zc=1.2*((10>g)-(g>e-10))}f=Sb(f-w.mx,g);g=~~(.03125*f[1]);f=~~(.03125*f[0]);c.pageX<w.mx?Gc(2):(c=ih(f,g)[0],0==c||void 0==c.cursor?Gc(2):Gc(c.cursor))},Xj=function(c){if(!Ld)if(c.pageX>w.menumx){if(0==c.button){window.addEventListener("mousemove",Kb);c=Sb(c.pageX-w.mx,c.pageY);var b=c[1];c=c[0];void 0!=W.wall&&(c=W.wall,b=32*~~(c/F),c=c%F*32,Kb.forced=!0,W.wall=void 0);Jh=!0;R[0]=c;R[1]=b;R[9]=R[0];R[10]=R[1];R[3]=R[0];R[7]=R[1];bg=!1}}else bg=!0},bg=!1,Ml=function(c){if(c.pageX>w.menumx&&
c.pageY>w.menumy&&!nd&&0==bg){Jh=!1;var b=Sb(c.pageX-w.mx,c.pageY),e=~~(b[1]/32);b=~~(b[0]/32);P(b,e);var f=ua;if(2==c.button&&!q.editor){if(Q!=tb){Q=tb;return}if(0<G.length)if(f=y[G[0]],1!=f.build||f.arrow){if(0===Q){Q=tb;return}f=ih(b,e);c=f[1];f=f[0];f==Qb&&(b={x32:b,y32:e,d:0,mv:1,img:k.cursor},$a(b),Zb.new(b,rb(b.img)));fa(f,c,G)}else fa(Tj,[b,e],G[0]);return!1}if(0==c.button){if(Q==tb)return tb();c=b+e*f;if(Q.spLevel)c=Q.spLevel(c);else{var g=0;2<bd[c]?g=bd[c]:2<O[c]?g=O[c]:2<Ma[c]&&(g=Ma[c]);
c=g}if(c)Q.allowPos&&y[c].build&&(c=-(b+e*f));else if(Q.allowPos||Q.noObj)c=-(b+e*f);else return Q=tb;Q.noObj&&3<=c&&(c=-(b+e*f));Q.item?(fa(Q,c,[G[0],Q.item]),Q.item=void 0):fa(Q,c,G);vb.shift||(Q=tb)}}bg=!1},Yj=function(c){Ld||(Ml(c),Cd.actived&&Cd(),R[0]=NaN,R[1]=NaN,R[9]=NaN,R[10]=NaN,R[3]=NaN,R[7]=NaN,m.bindBuffer(m.ARRAY_BUFFER,xc),m.bufferSubData(m.ARRAY_BUFFER,0,R),Gb.actived&&Gb(),nd&&(nd=!1))},Lh=function(c){c=y[c];c.tempChild.quit(c.selectAnim);Eb(c.selectAnim);Kh(c.selectAnim);c.selectAnim=
void 0},tb=function(){for(var c=0,b=G.length;c<b;Lh(G[c++]));le.actived&&(r(le.actived).style.display="none");Ya&&(Lh(Ya.id),Ya=void 0);G.length=0;Ub=-1;tc={};ve.style.display="none";me.innerHTML="";ne.innerHTML="";oe.innerHTML="";pe.innerHTML="";qe.innerHTML="";re.innerHTML="";se.innerHTML="";te.innerHTML="";zb.className="";I.page=0;Za.show&&(Za.x32=2*F,sb(Za,128*F),Za.show=0);var d=F,f=R[0],g=R[1];c=R[9];var h=R[10];if(10>=Math.abs(g-h)&&10>=Math.abs(f-c)){h=~~(f/32);var l=~~(g/32),m=g,k=f,n=0;
for(c=0;3>c;c++){b=ib[c];var v=h,C=l;f=k;g=m;2<b[v+C*d]?(f=v,g=C,n=y[b[f+g*d]]):(.5<=g/32-C?C++:C--,2<b[v+C*d]?(f=v,g=C,n=y[b[f+g*d]]):(.5<=f/32-v?v++:v--,2<b[v+C*d]?(f=v,g=C,n=y[b[f+g*d]]):(C=~~(g/32),2<b[v+C*d]&&(f=v,g=C,n=y[b[f+g*d]]))))}n.id||(n=Cb[w.kingdom][h+l*d])&&(n=y[n]);if(n&&2<n.id&&(!n.invisible||sc(n,w)))if(tc[n.id]=1,G.length=0,n.setupChild(Db.select,1,Xe),sc(n,w)&&!q.demo){G[0]=n.id;Ub=null!=n.defence?n.clss:-2;if(256>Date.now()-Sj){if(q.editor){Nl(y[G[0]]);return}if(!n.build)for(d=
~~(ba*tzar.width*.03125),f=~~(ba*tzar.height*.03125),h=~~(.03125*-pb+.5*(~~(.03125*tzar.width)-d)),m=~~(.03125*-ma+.5*(~~(.03125*tzar.height)-f)),f*=d,h+=m*F,c=0;c<f;c++)for(g=h+c%d+~~(c/d)*F,l=0;3>l;l++)m=ib[l][g],2<m&&(k=y[m],k.clss!=n.clss||tc[m]||!sc(k,n)||k.item||(k.setupChild(Db.select,1,Xe),tc[m]=1,G.put(m)))}Sj=Date.now();if(n.build)return Oa(n)}else return Ya=n,Xc(n.id),!1}else if(!q.demo)for(f=~~(f/32),c=~~(c/32),g=~~(g/32),h=~~(h/32),f>=c&&(n=f,f=c,c=n),g>=h&&(n=g,g=h,h=n),c++,n=[1,1,1],
k=c-f,c=0,b=k*(h-g+1);c<b;c++)for(h=c%k+f,m=~~(c/k)+g,l=0;3>l;l++)if(v=ib[l][h+m*d],C=y[v])C.selected=1,n[v]||(n[v]=1,C.build||!sc(C,w)||C.item||(G[G.length]=v,C.setupChild(Db.select,1,Xe),tc[v]=1));1<G.length?Mh(G):1==G.length?Xc(G[0]):(ja([]),xe(),Ub=-1,G.length=0)},Zj=[manamenu,manamenu1],ak={mana:{background:"0px -120px",progress:progressmana},food:{background:"0px -240px"},milk:{background:"0px -280px"},gold:{background:"0px -260px"},stone:{background:"0px -320px"},wood:{background:"0px -340px"}},
Jl=["https://i.imgur.com/toj2Nv3.gif","https://i.imgur.com/TwImKWn.gif","https://i.imgur.com/wFIu276.gif","https://i.imgur.com/kIWwIhG.gif","https://i.imgur.com/JBGA2KM.gif"],ve=document.getElementById("unitSpeed"),Xc=function(c,b,d){manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";c=y[c];c.sound&&!d&&(d=c.sound,qa(d[~~(d.length*Math.random())]));Ub=c.clss;c.inventory&&c.inventory.length&&sc(c,w)&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition=
"0px -80px",manamenu1.innerHTML=c.inventory.length);b||(sc(c,w)&&!q.demo?ja(c.icons,c):Nh());Bd.style.display="block";ag.innerHTML=c.name;c.attack&&c.item||void 0!==c.attack?(zb.innerHTML=c.attack,zb.style.display="block"):zb.style.display="none";c.defence&&c.item||void 0!==c.defence?($c.innerHTML=c.defence,$c.style.display="block"):$c.style.display="none";c.mana&&!c.manaTarget&&(manamenu.style.display="block",manamenu.innerHTML=c.mana,manamenu.style.backgroundPosition="0px -120px");b=0;var e=c.update;
if(e){b=0;for(var g=e.length;b<g;b+=3){var h=e[b],l=ak[h];d=Zj[b/3];d.innerHTML=c[h];d.style.display="block";d.style.backgroundPosition=l.background;"mana"==h&&c.manaTarget&&(d.innerHTML=~~(100*c.mana/c.manaTarget+.5)+"%",d.style.backgroundPosition="0px -200px");l.progress&&(l.progress.style.display="block",l.progress.value=c[h],l.progress.max=c[h+"Max"])}}c.stock&&(e=c.stock,d=Zj[b/3],d.style.display="block",d.style.backgroundPosition=ak[e[4].icon].background,d.innerHTML=e[0]);b=c.level?c.level:
0;ad.innerHTML=b;ad.style.display="block";0===b&&(c.item||c.build)&&(ad.style.display="none");Bd.innerHTML=E[c.kingdom].name;Sa.style.display="block";bk(c);we(c)},bk=function(c){var b=c.health;c=c.maxHealth;Infinity==b?(Sa.value=100,Sa.max=100,Ic.innerHTML=b):(Sa.value=b,Infinity==c?(Sa.max=100,Sa.value=1):Sa.max=c,Ic.innerHTML=~~b+"/"+c)},Mh=function(c,b){var e=y[c[0]],f=0,g=0,h=e.clss,l=c.length,m={},k=[];k.cut={};for(var n=0;n<l;n++){e=y[c[n]];f+=e.maxHealth;g+=e.health;Ub=h!=e.clss?-1:!0;for(var v=
e.icons,q=v.length,u=0;u<q;u++){var r=v[u].id;void 0===m[r]?m[r]=1:m[r]++;if(m[r]===l){if(v.cut){r=v.cut;var w=v[u].objName;r[w]&&(k.cut[w]=r[w],k.cut[r[w]]=w)}k.put(v[u])}}}!0===Ub&&(Ub=e.clss);g=Infinity==g?100:~~(g/f*100);Ic.innerHTML=g+"/100(%)";ck();ag.innerHTML="";zb.style.display="none";$c.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";ad.style.display="none";Bd.innerHTML=l+" "+x.units;Sa.style.display="block";Sa.value=g;
Sa.max=100;b||(!0!==Ub?ja(k):ja(e.icons))},pi=function(){};new Float32Array(8);var ub,kd,xc,Md,Jd,ba=1,dk={1:2560,101001:2048,101E3:2048,1001:2048,1E3:2048,100:1536,10010100:1280,10100:1280,1001E4:1280,1E4:1280,10010010:256,10010110:256,10110:256,10111:256,10010111:256,110:512,111:512,11:512,10:512,111E5:2816,11E5:2816,11E6:2816,1E6:2816,1101E4:768,11110100:768,11010100:768,1111E4:768,1E7:3360,1E5:3072,1101E3:1792,1101001:1792,11101E3:1792,11101001:1792,101111:0,1011:0,1111:0,101011:0},Ol=function(c){Eb(c);
Fb.put(c.bufferID)},Zb={table:{},dates:[],new:function(c,b,d){b=Math.floor(b)+q.now();var e=this.table;d||(d=Ol);e[b]||(e[b]=[]);c.animFunc=d;e[b].put(c);this.dates.add(b);this.needOrder=!0}},rb=function(c){c=wa[c];return 0>c[1]?k.delay[c[0]-c[1]-1]:~~(c[0]/c[1]*1E3)},Ab=new Float32Array(12),hh=function(c){var b=c.id+q.arje+c.x32+c.y32;c.rnd=[4294967295+b,4294967295-b,0]},Oh=function(c){c=y[c];c.mlist&&ek(c,!0);c.hlist&&ek(c,!1)},ek=function(c,b){if(b)var e=c.mlist,f=c.mlistID,g=Dd.mercenaries;else e=
c.hlist,f=c.hlistID,g=Dd.heroes;e.unshift(g[dj(c,g.length)]);b?f.unshift(c.mercID++):f.unshift(c.heroID++);8<e.length&&(e.length=8,f.length=8);I.active==e&&ja(e);Pb(c,5E4)},Ph=function(e){e=y[e];if(!E[e.kingdom].paypal(el)){var b=E[e.kingdom],d=16+4*b.crusade.number;b.crusade.number++;32<d&&(d=32);var f=b.crusade.list;f.length=d;for(var g=0;g<d;g++)(f[g]=Sc(8,e,1)).deleteFromList=f;qa("crusade",e.x32,e.y32);b.technology.disabled[c.createCrusaders.id]=1;Y(e.id)}},Al=function(e){E[e.kingdom].technology.disabled[c.createCrusaders.id]=
0},md,O=[],Ma=[],bd=[],jc={},ib=[];ib.length=3;var Nh=function(){for(var c=I.displayed.length=0,b=I.length;c<b;c++){var d=za[c];d.className="blocked";d.style.backgroundPosition="48px 96px";Zf[c]=Oc}I.rightButton.className="blocked";I.leftButton.className="blocked";I.stock.className="blocked";I.rightBlocked=1};I.leftButton.onclick=function(){I.page&&(I.page--,ja(I.active,0,I.stockActive))};I.rightButton.onclick=function(){I.rightBlocked||(I.page++,ja(I.active,0,I.stockActive))};I.displayed=[];var ja=
function(c,b,d){d=!!d;b||(b=NaN);var e=c.olegal||NaN;if(b.working&&!d)var g=1;I.active=c;I.displayed.length=0;var h=yb.technology,l=I.page,m=I.length;Nh();!1!==d&&b?I.stockActive=b:!1===d&&(I.stockActive=!1);ja.actv={};c.length<=l*m&&c.length&&(I.page--,l--);for(var k=0,n=0,v;k<m;k++){v=c[k+l*m];if(!v)break;var q=za[n];if(!d&&(ja.actv[v.id]=1,h.hidden[v.id]||v.obj.tech&&g)){m++;continue}q.style.backgroundPosition=48*d+"px "+(-d||1)*v.iconID*48+"px";d||!h.disabled[v.id]||e[v.id]?(q.className="",Zf[n]=
v):q.className="blocked";I.displayed[n]=v;n++}c[k+l*m]&&(I.rightButton.className="",I.rightBlocked=0);0<l&&(I.leftButton.className="");1===G.length&&(b=y[G[0]]);b.inventory&&0<b.inventory.length&&(I.stock.className="")};ja.actv={};var oi,la,xa,vg;var m=r("tzar").getContext("webgl2",{antialias:!0,alpha:!1});w.gl=!!m;if(m){var Pl=m.getExtension("WEBGL_lose_context");m.canvas.addEventListener("webglcontextlost",function(c){setTimeout(function(){Pl.restoreContext()},2E3);c.preventDefault()},!1);m.canvas.addEventListener("webglcontextrestored",
function(c){P("restored 2")},!1)}var ni,wg,xg,ri,Re,rg,qg,Qe,Se,Kd,Id,jd,sg,tg,eb=function(){if(q.canceled)return 0;requestAnimationFrame(eb);var c=eb.fp1000,b=eb.delta,d=eb.now;performance.now();var f=d;eb.frameCount++;d=q.now();eb.now=d;b=(b+(d-f))/1E3;eb.delta=b;eh+=b;dh++;eb.fp1000=c+b;c=Zb.table;f=Zb.dates;Zb.needOrder&&(f.sort(function(b,c){return b-c}),Zb.needOrder=0);for(var g=0;f[g]<=d+17;g++){for(var h=c[f[g]],l=0,k=h.length;l<k;l++){var t=h[l];t.animFunc(t)}delete c[f[g]];g--;f.shift()}if(0!=
Yc||0!=Zc)pb+=Yc*b*640*ba,ma+=Zc*b*640*ba,od(-pb,-ma),Kb();Ij(d);pi();m.uniform1f(ni,d);m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT);if(c=ka.length)m.bindFramebuffer(m.FRAMEBUFFER,fb),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,ri),b=ka,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,m.bufferData(m.ELEMENT_ARRAY_BUFFER,b.typed,m.STATIC_DRAW)),m.enable(m.BLEND),m.blendEquation(m.MAX),m.blendFunc(m.SRC_COLOR,m.SRC_COLOR),m.bindTexture(m.TEXTURE_2D,vg),m.drawElements(m.TRIANGLES,c,m.UNSIGNED_INT,0),m.bindTexture(m.TEXTURE_2D,
Lighttexture),m.disable(m.BLEND),m.bindFramebuffer(m.FRAMEBUFFER,null);fk(wg);f=window.innerWidth;g=window.innerHeight;m.viewport(w.marx,g-Lb-w.mary,Bb,Lb);m.uniform2f(Re,32*F,32*ua);m.uniform2fv(Kd,[0,0]);m.uniform1i(Se,1);m.uniform1f(md,1);fk(wg);m.viewport(w.mx,0,f,g);performance.now();m.useProgram(xa);m.bindVertexArray(sg);m.uniform1f(rg,~~((.01*d+.5)%5));m.drawArrays(m.TRIANGLES,0,6);m.viewport(w.marx,g-Lb-w.mary,Bb,Lb);m.uniform1i(Qe,1);m.uniform2fv(Id,[0,0]);m.uniform1f(jd,Bb/32/F);m.drawArrays(m.TRIANGLES,
0,6);m.uniform1i(Qe,0);m.uniform2f(qg,f,g);m.uniform2fv(Id,[pb,ma]);m.uniform1f(jd,1/ba);m.viewport(w.mx,0,f,g);m.useProgram(la);m.bindVertexArray(tg);if(c=ta.length)m.enable(m.BLEND),m.blendEquation(m.FUNC_ADD),m.blendFunc(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA),m.bindBuffer(m.ARRAY_BUFFER,xc),f=tzar.width,g=tzar.height,d=-pb+.5*(f-ba*f),b=-ma+.5*(g-ba*g),h=ba*(f-w.mx),l=ba*g,m.bufferSubData(m.ARRAY_BUFFER,0,new Float32Array([d,b,24576,d+h,b,24576,d,b+l,24576,d+h,b+l,24576])),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,
xg),b=ta,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,m.bufferData(m.ELEMENT_ARRAY_BUFFER,b.typed,m.STATIC_DRAW)),m.viewport(w.marx,g-Lb-w.mary,Bb,Lb),m.drawElements(m.TRIANGLES,12,m.UNSIGNED_INT,0),m.uniform1i(Se,0),m.uniform2f(Re,f,g),m.uniform2fv(Kd,[pb,ma]),m.uniform1f(md,1/ba),m.viewport(w.mx,0,f,g),m.bindBuffer(m.ARRAY_BUFFER,xc),Ih&&!Qh?m.bufferSubData(m.ARRAY_BUFFER,0,R):m.bufferSubData(m.ARRAY_BUFFER,0,new Float32Array([NaN,NaN,24576,NaN,4347,24576,5551,NaN,24576,NaN,NaN,24576])),
m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,xg),b=ta,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,m.bufferData(m.ELEMENT_ARRAY_BUFFER,b.typed,m.STATIC_DRAW)),m.drawElements(m.TRIANGLES,c,m.UNSIGNED_INT,0),m.disable(m.BLEND);W.active&&(d=W.x,b=W.y,c=96*F,W.wh?(f=W.wh[0]-wa[W.img][8],g=W.wh[1]-wa[W.img][9]):g=f=0,Rh(d,b,c,f,g,W.bufferID),W.active=!1);Lc.update&&Lc(1)},fk=function(c){var b=ia.length;b&&(m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,c),c=ia,c.changed&&(c.typed=new Uint32Array(c),c.changed=!1,m.bufferData(m.ELEMENT_ARRAY_BUFFER,
c.typed,m.STATIC_DRAW)),m.drawElements(m.TRIANGLES,b,m.UNSIGNED_INT,0))},id=!1;"use strict";var pa=function(c,b){return c<F&&0<=c&&0<=b&&b<ua?!0:!1};Array.prototype.put=function(c){this[this.length]=c};var Db,ye,Yb,Sh,cd=function(c,b,d,f){f&&0==cd.cols[f]&&(cd.list.push(f,c),cd.cols[f]=1)};cd.cols={};cd.list=[];var M=function(c){for(var b=Object.keys(c),e=0;e<b.length;e++)c[c[b[e]]]=b[e];return c};window.onerror=cd;var q={},wa=[],Ql=function(c,b,d,f){for(var e=0,h=Object.keys(c),l=0,m=h.length;l<
m;l++){var k=h[l],n=c[k];if(Array.isArray(n)){c[k]=e;n.url=e;k=wa[e++]=n;var v=n.deltaY?n.deltaY:0;k.id=f/4;for(var q=6,u=k.length;q<u;q+=6){var r=k[q-2],w=k[q-1],x=k[q+2],z=k[q+3];b[f++]=k[q]/d;b[f++]=(v+k[q+1])/d;b[f++]=r;b[f++]=w;b[f++]=(k[q]+x)/d;b[f++]=(k[q+1]+v)/d;b[f++]=r+x;b[f++]=w;b[f++]=k[q]/d;b[f++]=(k[q+1]+z+v)/d;b[f++]=r;b[f++]=w+z;b[f++]=(k[q]+x)/d;b[f++]=(k[q+1]+z+v)/d;b[f++]=r+x;b[f++]=w+z}}else for(var y=Object.keys(n),A=0,B=y.length;A<B;A++)for(k=n[y[A]],k.id=f/4,k.url=e,n[y[A]]=
e,wa[e++]=k,v=k.deltaY?k.deltaY:0,q=6,u=k.length;q<u;q+=6)r=k[q-2],w=k[q-1],x=k[q+2],z=k[q+3],b[f++]=k[q]/d,b[f++]=(v+k[q+1])/d,b[f++]=r,b[f++]=w,b[f++]=(k[q]+x)/d,b[f++]=(k[q+1]+v)/d,b[f++]=r+x,b[f++]=w,b[f++]=k[q]/d,b[f++]=(k[q+1]+z+v)/d,b[f++]=r,b[f++]=w+z,b[f++]=(k[q]+x)/d,b[f++]=(k[q+1]+z+v)/d,b[f++]=r+x,b[f++]=w+z}return f},N=function(c,b,d,f){var e=0,h=d.length-1,l=d[h];f=Cb[f];var m=[],k=0,n=!0;pa(c,b)&&pa(c+l-1,b+h/l-1)||(n=!1);for(var v=F,q=0;q<h;q++){e==l&&(e=0,b++);if(d[q]){var u=c+e+
v*b;f[u]&&(n=!1);if(0<O[u]||ic[u])n=!1;m[k++]=u}e++}return[m,n]};N.check=function(c,b,d,f,g,h,l){var e=d.length-1;d=d[e];var m=e/d;e=F;l=Cb[l];d+=2;--c;--b;m=d*(m+2);for(var k=0;k<m;k++){var v=c+k%d,q=b+~~(k/d),u=v+q*e;if(0<O[u]||ic[u]||h&&(v>=g&&v<=g+2||q>=f&&q<=f+2)||!pa(v,q)||l[u])return!1}return!0};var gk=function(c,b,d){var e=0,g=d.length-1,h=d[g],l=[],m=[],k=0,n=!0;pa(c,b)&&pa(c+h-1,b+g/h-1)||(n=!1);for(var v=0,q=0;q<g;q++){e==h&&(e=0,b++);var u=c+e+F*b;d[q]?(2<O[u]&&(n=!1),l[k++]=u):(m[v++]=
u,2<O[u]&&(n=!1));e++}return[l,n,m]},hk=function(c,b,d){var e=0,g=d.length-1,h=d[g],l=[],m=0,k=!0;pa(c,b)&&pa(c+h-1,b+g/h-1)||(k=!1);for(var n=0;n<g;n++){e==h&&(e=0,b++);var v=c+e+b*F;if(d[n]&&2<O[v]&&1==y[O[v]].build||0<Ma[v])k=!1;l[m++]=v;e++}return[l,k]},cg=function(c,b,d){var e=!1,g=0,h=[],l=0,m=d.length-1,k=d[m],n=0,v=!0;pa(c,b)&&pa(c+k-1,b+m/k-1)||(v=!1);for(var q=0;q<m;q++){n==k&&(n=0,b++);if(d[q]){var u=c+n+F*b,r=O[u];2<r&&(v=!1);0<r?g++:e=!0;h[l++]=u}n++}g>.5*(m-1)&&e||(v=!1);return[h,v]},
ze=function(c,b,d){d=!0;pa(c,b)||(d=!1);1!==Ma[c+b*F]&&(d=!1);return[[c+b*F],d]},U=function(c,b,d){d=!0;pa(c,b)||(d=!1);0<O[c+b*F]&&(d=!1);return[[c+b*F],d]},dg=function(c,b,d){d=!0;pa(c,b)||(d=!1);0<bd[c+b*F]&&(d=!1);return[[c+b*F],d]},ec=function(c,b,d){d=!0;pa(c,b)||(d=!1);if(0<Ma[c+b*F]||2==O[c+b*F]||1==O[c+b*F])d=!1;return[[c+b*F],d]},Rl=function(c){for(var b=Object.keys(c),e=T.common.length/1048576,f=0,g=b.length;f<g;f++)c[b[f]].deltaY=512*e},W,B,jb,mb,Vk=function(){W={img:0,x32:-1E3,y32:-1E3,
rgb:[0,0,0,.5],d:0,active:!1};var e=8,b=9;if(!id){Sl();var d=[c.move,c.attack,c.guard,c.patrol,c.pickUp,c.explore,c.stop,c.stand,c.sameSpeed,c.restoreSpeed];ye={magic_creatures:[58,40,59,5,78,77,60,130,131,132,89,129]};for(var f=Object.keys(ye),g=0,h=f.length;g<h;g++){var l=ye[f[g]],m={};l.obj=m;for(var t=0,n=l.length;t<n;m[l[t++]]=1);}Dd.mercenaries=[c.mercArcher,c.mercFootman,c.mercMaceman,c.mercLongbowman,c.mercPikeman,c.mercKnight,c.mercArcherAsian,c.mercSamurai,c.mercHourseSamurai,c.mercRonin,
c.mercHorseArcher,c.mercChariot,c.mercFootmanArab,c.mercArcherArab,c.mercMacemanArab,c.mercPikemanArab,c.mercCavalry,c.mercEnichar,c.mercJihad];Dd.heroes=[c.mercArcher6,c.mercFootman6,c.mercMaceman6,c.mercLongbowman6,c.mercPikeman6,c.mercKnight6,c.mercArcherAsian6,c.mercSamurai6,c.mercHourseSamurai6,c.mercRonin6,c.mercHorseArcher6,c.mercChariot6,c.mercFootmanArab6,c.mercArcherArab6,c.mercMacemanArab6,c.mercPikemanArab6,c.mercCavalry6,c.mercEnichar6,c.mercJihad6];f=Dd.mercenaries;g=0;for(h=f.length;g<
h;f[g++].merc=9);f=Dd.heroes;g=0;for(h=f.length;g<h;f[g++].hero=1);n=k;n.build2x2[2]=1;n.build3x3[2]=1;n.build4x4[2]=1;n.build5x5[2]=1;n.build6x6[2]=1;n.items1[2]=1;n.build_harbor[2]=1;n.bridge_horz_build[2]=1;n.bridge_vert_build[2]=1;n.sexplosion[0]=13;n.sexplosion[1]=25;n.flame_trail[0]=16;n.flame_trail[1]=25;g=0;for(l=n.flame_trail.length;g<l;g+=6)n.flame_trail[4+g]-=32,n.flame_trail[5+g]-=32;g=0;for(l=n.sexplosion.length;g<l;g+=6)n.sexplosion[4+g]-=48,n.sexplosion[5+g]-=48;n.items1[1]=0;n.books[1]=
0;n.potions[1]=0;n.troll.attack[1]=14;n.ork.attack[1]=14;n.dwarf.attack[1]=14;n.asian_mage.move[1]=14;n.arab_priest.attack=n.arab_priest.spell;n.asian_mage.spell=n.asian_mage.castspell;n.asian_mage.attack=n.asian_mage.castspell;n.asian_mage.spell[1]=13;n.arab_horse_archer.move=n.arab_horse.archer;n.arab_jwarrior.attack[1]=14;n.arab_peasant.attack=n.arab_peasant.attack1;n.arab_peasant.tree=n.arab_peasant.wood;n.asian_peasant.attack=n.asian_peasant.attack1;n.asian_peasant.cut=n.asian_peasant.chop;n.asian_peasant.tree=
n.asian_peasant.wood;n.asian_peasant.dig[1]=14;n.asian_archer.die[1]=14;n.asian_ronin.attack=n.asian_ronin.attack1;g=0;for(l=n.turn_to_stone.length;g<l;g+=6)n.turn_to_stone[4+g]-=56,n.turn_to_stone[5+g]-=64;n.arab_tcguild_c[4]=31;n.arab_tcguild_c[5]=85;n.dragon.idle=n.dragon.move;n.asian_samurai.attack=n.asian_samurai.attack1;n.asian_horsamurai.idle=n.asian_horsamurai.idle1;n.asian_horsarcher.idle=n.asian_horsarcher.idle2;n.asian_priest.attack=n.asian_priest.attack1;n.asian_priest.spell=n.asian_priest.pray;
n.asian_monk.attack[1]=12;n.euro_mage.attack=n.euro_mage.spell;n.euro_ghost.idle=n.euro_ghost.move;n.euro_priest.attack=n.euro_priest.spell;n.arab_mage.spell=n.arab_mage.attack;n.cursor[1]=15;n.star[1]=15;n.select[4]+=3;n.select[5]+=3;n.arab_houses_c[e]=96;n.asia_houses_c[e]=96;n.asia_houses_c[4]-=9;n.asia_houses_c[5]-=15;n.wood_build[2]=1;n.res_gold[2]=1;n.res_gold_s[2]=1;n.res_stone[2]=1;n.res_stone_s[2]=1;n.bridge_horz1[4]=-9;n.bridge_horz1[5]=132;n.bridge_horz1[4]=-9;n.bridge_horz1[5]=132;n.euro_stable_c[4]+=
18;n.euro_stable_c[5]-=10;n.euro_lumbermill_s[4]-=19;n.euro_lumbermill_s[5]-=17;n.wood_tower_c[4]=0;n.wood_tower_c[5]*=1;n.bat.idle=n.bat.move;g=0;for(l=n.curse.length;g<l;g+=6)n.curse[5+g]-=48;g=0;for(l=n.impersonate.length;g<l;g+=6)n.impersonate[5+g]-=48;g=0;for(l=n.bless.length;g<l;g+=6)n.bless[5+g]-=48;g=0;for(l=n.euro_barracks_c.length;g<l;g+=6)n.euro_barracks_c[4+g]+=50;g=0;for(l=n.healing.length;g<l;g+=6)n.healing[5+g]-=48;g=0;for(l=n.expl_small_hole.length;g<l;g+=6)n.expl_small_hole[4+g]-=
4,n.expl_small_hole[5+g]-=34;Date.now();f=[c.createKnight,c.createHorseArcher1,c.createHorseArcher2,c.createHorseSamurai,c.createChariot,c.createEnichar,c.createCavalry]}if(Ag){Ag=!1;P("TErrain changed");g=0;for(h=T.xtra.length;g<h;g++){n=T.xtraRes[g].coords;Rl(n);n.terrain_water[e]=512;n.terrain_water[b]=512;n.terrain_water[6]+=32;n.terrain_water[7]+=32;t=0;for(l=n.terrain_tree.length;t<l;t+=6)n.terrain_tree[4+t]-=32,n.terrain_tree[5+t]-=96;t=0;for(l=n.terrain_tree_s.length;t<l;t+=6)n.terrain_tree_s[5+
t]-=32;n.terrain_tree[2]=1;Object.assign(k,n)}e=T.size;h=new Float32Array(1048576);n=Ql(k,h,e,0);T.info=h;T.ids=n/16}if(!id){Yb={sword:{name:"Sword",iconID:16,img:k.items1,d:0,dMax:7,attack:1,type:52,sword:1},bow:{name:"Bow",iconID:4,img:k.items1,d:15,dMax:4,attack:1,type:52,sword:1},shield:{name:"Shield",iconID:1,img:k.items1,d:8,dMax:6,defence:1,type:52,shield:1},potion:{name:"Potion",iconID:11,img:k.potions,d:0,dMax:7,type:52,potion:1},book:{name:"Book",iconID:9,img:k.books,d:0,dMax:4,type:52,
book:1},gold:{name:"Gold",iconID:20,img:k.item_gold,d:0,dMax:0,type:52},stone:{name:"Stone",iconID:22,img:k.item_stone,d:0,dMax:0,type:52},food:{name:"Food",iconID:14,img:k.item_food,d:0,dMax:0,type:52},wood:{name:"Wood",iconID:15,img:k.item_tree,d:0,dMax:0,type:52},iron:{name:"Iron",iconID:21,img:k.item_iron,d:0,dMax:0,type:52}};Sh=[Yb.sword,Yb.potion,Yb.book,Yb.bow,Yb.shield];h=[c.move,c.attack,c.stop,c.stand,c.pickUp,c.explore,c.healing,c.bless];e=[c.attack,c.guard,c.patrol,c.explore,c.stop,c.stand,
c.attackGround,c.steady,c.move];b=[c.buildAcademy,c.buildWorkshop,c.buildWorkshop1,c.buildAcademy1,c.buildWorkshop2,c.buildAcademy2];g=[c.buildMerchands1,c.buildMerchands2,c.buildMerchands];mb={euro:{},asia:{},arab:{},common:{}};A=[{name:"Footman",attack:6,defence:3,health:65,maxHealth:65,img:k.euro_footman.idle,attackSound:Ac,invType:0,invMax:8,validator:U,human:12,iconID:36,time:12,sight:5,url:k.euro_footman,icons:d,cost:[0,0,50,0],attDist:1,spd:50,dieSound:Wa,clss:"footman",size:1,standardFunc:S,
radix:0,zLevel:1,strID:"e_footman",race:"euro"},{name:"Pikeman",radix:0,attackSound:Ac,attack:8,defence:4,health:75,maxHealth:75,img:k.euro_pikeman.idle,invType:0,dieSound:Wa,invMax:8,validator:U,human:1,iconID:39,time:18,sight:5,url:k.euro_pikeman,icons:d,cost:[40,0,60,0],attDist:1,spd:50,standardFunc:S,clss:"e_pikeman",zLevel:1,size:1,strID:"e_pikeman",nu:c.createPikeman,race:"euro"},{name:"Spy",radix:0,attack:20,defence:0,mana:100,manaMax:100,health:50,maxHealth:50,img:k.euro_spy.idle,attackSound:["spy%20kill%201",
"spy%20kill%202","spy%20kill%203"],invType:0,invMax:8,validator:U,human:1,dieSound:Wa,iconID:41,time:30,sight:12,url:k.euro_spy,icons:[c.move,c.attack,c.guard,c.patrol,c.pickUp,c.explore,c.stop,c.stand,c.impersonate,c.revealSelf],zLevel:1,cost:[120,0,0,0],attDist:1,spd:50,clss:"spy",standardFunc:S,size:1,update:["mana","manaSpeed",1E3],isSpy:1,strID:"spy",nu:c.createSpy,race:"common"},{name:"Maceman",radix:0,attack:8,defence:0,health:120,maxHealth:120,img:k.euro_maceman.idle,attackSound:Ac,invType:0,
invMax:8,validator:U,human:1,iconID:37,time:14,dieSound:Wa,sight:5,zLevel:1,url:k.euro_maceman,icons:d,cost:[0,0,120,0],attDist:1,spd:50,clss:"maceman",standardFunc:S,size:1,strID:"e_maceman",nu:c.createMaceman,race:"euro"},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:k.euro_archer1.idle,invType:0,invMax:8,validator:U,human:1,sight:10,dieSound:Wa,arrow:!0,iconID:38,zLevel:1,time:12,url:k.euro_archer1,icons:d,cost:[0,20,40,0],attDist:7,spd:50,clss:"archer",standardFunc:S,attimg:k.arrow1,
attackSound:rd,size:1,strID:"e_archer",nu:c.createArcher,race:"euro"},{radix:0,name:"Wizard",attackSound:Ni,dieSound:["mage"],attack:5,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:k.euro_mage.idle,zLevel:1,invType:0,invMax:8,validator:U,human:1,iconID:42,time:30,sight:15,url:k.euro_mage,icons:[c.stop,c.pickUp,c.explore,c.lightning,c.createBat,c.freeze,c.createGolem,c.invisibility,c.stand,c.attack,c.move],cost:[150,0,0,0],attDist:10,attimg:k.flame_bolt,ball:1,spd:50,clss:"mage",standardFunc:S,
size:1,update:["mana","manaSpeed",1E3],strID:"e_mage",nu:c.createMage,race:"euro"},{radix:0,name:"Longbowman",attack:6,defence:2,health:50,maxHealth:50,img:k.euro_longbowman.idle,zLevel:1,invType:0,invMax:8,dieSound:Wa,attackSound:rd,arrow:!0,validator:U,race:"euro",human:1,iconID:35,time:18,sight:18,url:k.euro_longbowman,icons:d,cost:[50,0,90,0],attDist:12,spd:50,standardFunc:S,clss:"longbowman",size:1,d2attack:2,strID:"e_longbowman",attimg:k.arrow1,nu:c.createLongbowman},{radix:0,clss:"tree",name:"Tree",
health:100,maxHealth:100,img:k.terrain_tree,invType:0,invMax:8,zLevel:1,mMapcolor:[11,131,11],validator:U,child:[{img:k.terrain_tree_s,rgb:[0,0,0,.5],alpha:1,x:0,y:0}],iconID:23,url:k.terrain_tree,dimgInfinity:k.terrain_tree,dimgRND:3,icons:[],res:1,race:"common",build:!0,size:1,zolotoy:1,strID:"tree"},{radix:0,name:"Crusader",zLevel:1,dieSound:Rd,attackSound:Pd,attack:14,defence:8,health:180,maxHealth:180,img:k.crus.idle,invType:0,invMax:8,validator:U,human:1,race:"euro",iconID:100,time:19,sight:5,
url:k.crus,icons:d,cost:[0,0,0,0],attDist:1,spd:85,standardFunc:S,clss:"crusader",size:1,strID:"crusader"},{radix:0,name:"Priest",attack:20,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:k.euro_priest.idle,invType:0,zLevel:1,invMax:8,validator:U,human:1,iconID:40,time:30,ball:1,sight:21,dieSound:Wa,url:k.euro_priest,icons:h,attackOnly:ye.magic_creatures.obj,cost:[150,0,0,0],attDist:18,race:"euro",spd:50,standardFunc:S,clss:"priest",size:1,update:["mana","manaSpeed",1E3],strID:"e_priest",
nu:c.createPriest,attimg:k.flame_bolt},{radix:0,name:"Peasant",attackSound:Ng,attack:5,defence:0,health:50,maxHealth:50,img:k.euro_peasant.idle,invType:0,invMax:8,dieSound:Wa,zLevel:1,validator:U,human:1,race:"euro",iconID:33,time:8,sight:5,url:k.euro_peasant,icons:[c.move,c.menuBuilds,c.repair,c.conquest,c.dcm,c.pickUp,c.explore,c.stop,c.stand,c.attack,c.bribe,c.sameSpeed,c.restoreSpeed],cost:[0,0,50,0],attDist:1,spd:50,clss:"peon",size:1,peon:1,strID:"e_peon",nu:c.createPeon,nocapture:1,standardFunc:Qg},
{radix:0,clss:"cathedral",name:"Cathedral",dieSound:L,sound:["e_cathedral1","e_cathedral2"],resistance:700,health:5E3,maxHealth:5E3,img:k.euro_cathedral,invType:0,invMax:8,race:"euro",zLevel:1,validator:N,bimg:k.build5x5,dimg:k.des_5x5,iconID:60,icons:[c.createCrusaders,c.techFanaticism,c.techEspionage,c.techInquisition,c.techHealing,c.techBless,c.techCrusade,c.techMedicine],time:90,sight:8,child:[{img:k.euro_cathedral_c,x:0,y:0},{img:k.euro_cathedral_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],space:new Uint8Array([1,
1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,5]),url:k.euro_cathedral,build:!0,cost:[2E3,0,0,2E3],onbuild:[c.buildChurch],size:1,strID:"cathedral"},{radix:0,name:"Castle",clss:"castle",dieSound:L,sound:["e_castle1"],resistance:700,health:8E3,maxHealth:8E3,img:k.euro_castle,invType:1,invMax:50,race:"euro",zLevel:1,validator:N,bimg:k.build6x6,dimg:k.des_6x6,iconID:59,time:120,sight:12,child:[{img:k.euro_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:k.euro_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[c.createPeon,
c.createSpy,c.emergeAllUnits,c.techFeudalism,c.techArchitecture,c.techLearning],space:new Uint8Array([0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,7]),menu:Oa,url:k.euro_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1,strID:"e_castle"},{radix:0,name:"Wooden Wall",clss:"wall_wood",resistance:700,health:2E3,maxHealth:2E3,img:k.wood_tower,time:6,sight:1,zLevel:1,dieSound:L,validator:U,bimg:k.wood_build,dimgInfinity:k.wood_debris,
iconID:49,icons:[],mx:0,race:"common",my:0,hframe:71,menu:Oa,url:k.wood_tower,wall:1,build:!0,cost:[0,0,20,0],size:1,strID:"woodwall",child:[{img:k.wood_tower_c,x:0,y:0}]},{radix:0,name:"Barracks",clss:"barracks",strID:"e_barrack",sound:Og,generator:1,resistance:500,health:1400,maxHealth:1400,img:k.euro_barrack,invType:1,invMax:0,dieSound:L,time:60,sight:6,zLevel:1,race:"euro",validator:N,bimg:k.build5x5,dimg:k.des_5x5,child:[{img:k.euro_barracks_c,mv:!0},{img:k.euro_barrack_s,x:0,y:0,rgb:[0,0,0,
.5],alpha:!0}],iconID:57,icons:[c.createFootman,c.createArcher,c.createMaceman,c.createPikeman,c.createLongbowman,c.createKnight],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:k.euro_barrack,build:!0,cost:[0,200,0,200],size:1},{radix:0,strID:"e_lumber",name:"Lumber Mill",sound:["e_lumber1"],clss:"lumber_mill",resistance:500,health:800,maxHealth:800,img:k.euro_lumbermill,invType:1,invMax:0,time:30,race:"euro",sight:4,dieSound:L,zLevel:1,validator:N,bimg:k.build2x2,
dimg:k.des_2x2,iconID:64,child:[{img:k.euro_lumbermill_c,x:0,y:0},{alpha:!0,img:k.euro_lumbermill_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[c.techLongbow,c.techWoodCutting,c.techCrossbow],space:new Uint8Array([1,1,1,1,2]),hframe:98,url:k.euro_lumbermill,build:!0,cost:[0,100,0,0],storage:1,size:1},{radix:0,name:"Mage Tower",strID:"e_magetower",sound:["e_magetower1","e_magetower2","e_magetower3"],clss:"magictower",resistance:700,health:5E3,maxHealth:5E3,img:k.euro_magetower,invType:1,invMax:0,time:90,race:"euro",
dieSound:L,sight:8,validator:N,bimg:k.build5x5,dimg:k.des_5x5,zLevel:1,child:[{img:k.euro_magetower_c,x:0,y:0},{img:k.euro_magetower_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:71,icons:[c.createMage,c.techBat,c.techInvisibility,c.techLightning,c.techFreeze,c.techGolem],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.euro_magetower,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,strID:"e_waracademy",name:"Warriors Guild",sound:["e_waracademy1"],clss:"academy",resistance:700,health:5E3,
maxHealth:5E3,img:k.euro_waracademy,invType:1,invMax:0,race:"euro",time:90,sight:8,dieSound:L,zLevel:1,validator:N,bimg:k.build6x6,dimg:k.des_6x6,iconID:56,child:[{img:k.euro_waracademy_c,x:0,y:0,mv:!0},{img:k.euro_waracademy_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],icons:[c.techHeroism,c.techWarfare,c.techMercenaries,c.techSiegeTactics,c.techBodyBuilding,c.techLeadership,c.techTactics,c.techHeroes,c.techHonor,c.techFame],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,5]),url:k.euro_waracademy,
build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,name:"Storage",strID:"e_storage",sound:["e_storage1","e_storage2"],clss:"storage",resistance:80,health:800,maxHealth:800,img:k.euro_storage,invType:1,invMax:0,time:30,dieSound:L,zLevel:1,sight:5,validator:N,bimg:k.build4x4,dimg:k.des_4x4,iconID:69,race:"euro",icons:[c.techGoldMining,c.techStoneMining],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:k.euro_storage,storage:0,build:!0,cost:[0,200,0,0],size:1,child:[{img:k.euro_storage_c,x:0,
y:0},{img:k.euro_storage_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Knight",strID:"e_knight",dieSound:Rd,clss:"knight",attackSound:Pd,attack:12,defence:6,health:120,maxHealth:120,img:k.euro_knight.idle,invType:0,zLevel:1,race:"euro",invMax:8,validator:U,human:1,iconID:43,d2attack:2,time:22,sight:5,url:k.euro_knight,icons:d,cost:[120,0,70,0],attDist:1,spd:85,nu:c.createKnight,standardFunc:S,size:1},{radix:0,name:"Field",clss:"field",strID:"field",instantBuild:1,resistance:80,health:100,maxHealth:100,
img:k.fields,invMax:0,validator:hk,zLevel:1,iconID:104,race:"common",icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:k.fields,build:!0,field:1,res:2,cost:[0,200,0,0],rndDirection:9,time:0,sight:1,z32:.5,size:1},{radix:0,name:"Golden rocks",mMapcolor:[148,148,0],strID:"gold",sound:["mine1"],clss:"golden_rocks",resistance:0,health:6E3,maxHealth:6E3,img:k.res_gold,invMax:0,validator:N,iconID:20,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.res_gold,build:!0,zLevel:1,
race:"common",res:0,cost:[0,0,0,0],time:0,sight:2,dieSound:["destroy%20mine"],size:1,zolotoy:1,child:[{img:k.res_gold_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:k.res_gold},{radix:0,name:"Rocks",strID:"stone",mMapcolor:[132,132,132],sound:["mine1"],clss:"rocks",dieSound:["destroy%20mine"],resistance:0,health:6E3,maxHealth:6E3,img:k.res_stone,invMax:0,validator:N,zLevel:1,iconID:22,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.res_stone,build:!0,res:3,cost:[0,0,0,0],
race:"common",time:0,sight:2,size:1,zolotoy:1,child:[{img:k.res_stone_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:k.res_stone},{radix:0,name:"Farm",strID:"e_farm",sound:["e_farm1","e_farm2"],clss:"farm",resistance:0,health:800,maxHealth:800,img:k.euro_farm,invType:1,invMax:0,zLevel:1,validator:N,bimg:k.build4x4,dimg:k.des_4x4,iconID:61,dieSound:L,race:"euro",icons:[c.createCow,c.techCropRotation,c.techDomestication],space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Oa,url:k.euro_farm,
build:!0,cost:[0,200,0,0],time:30,sight:5,storage:2,size:1,child:[{img:k.euro_farm_c,x:0,y:0}]},{radix:0,name:"Merchants Guild",strID:"e_merchant",sound:["merchant"],clss:"merchants_guild",resistance:0,health:5E3,maxHealth:5E3,img:k.euro_tcguild,invType:1,invMax:0,validator:N,bimg:k.build6x6,zLevel:1,dimg:k.des_6x6,race:"euro",iconID:62,dieSound:L,icons:[c.techMapMaking,c.techTradeRoutes,c.techUsury,c.techSupplyStorage,c.techBribery,c.techTradeTaxes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,0,1,1,1,0,5]),menu:Oa,url:k.euro_tcguild,build:!0,time:90,sight:8,cost:[2E3,0,0,2E3],onbuild:[c.buildMarket],size:1,child:[{img:k.euro_tcguild_c,x:0,y:0},{img:k.euro_tcguild_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Church",clss:"church",strID:"e_church",sound:["e_church1"],resistance:0,health:800,maxHealth:800,img:k.euro_church,invType:1,invMax:0,dieSound:L,validator:N,bimg:k.build3x3,race:"euro",zLevel:1,dimg:k.des_3x3,iconID:139,icons:[c.createPriest],space:new Uint8Array([1,
1,1,1,1,1,1,1,1,3]),menu:Oa,url:k.euro_church,build:!0,cost:[0,0,200,200],time:40,sight:6,size:1,child:[{img:k.euro_church_c,x:0,y:0},{img:k.euro_church_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Blacksmith",clss:"blacksmith",strID:"e_blacksmith",resistance:0,health:800,maxHealth:800,img:k.euro_blacksmith,invType:1,invMax:0,time:40,zLevel:1,sight:5,dieSound:L,validator:N,bimg:k.build4x4,race:"euro",dimg:k.des_4x4,child:[{img:k.euro_blacksmith_c,x:0,y:0}],iconID:58,icons:[c.techPlateArmor,
c.techTemperIron,c.techScaleArmor,c.techHalberd,c.techChainMail],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Oa,url:k.euro_blacksmith,build:!0,cost:[0,0,200,200],onbuild:b,size:1},{radix:0,name:"Cow",clss:"cow",nu:c.createCow,race:"common",strID:"cow",attack:0,defence:3,health:50,maxHealth:50,img:k.cow.idle,invType:0,invMax:8,zLevel:1,validator:U,iconID:99,time:20,dieSound:["cowdie1","cowdie2","cowdie3","cowdie4"],url:k.cow,icons:[c.move,c.stop],sight:3,cost:[0,0,300,0],attDist:0,
spd:32,res:2,food:300,milk:50,milkMax:50,foodMax:600,size:1,cow:1,update:["milk","milkSpeed",1E3,"food","cowSpeed",1E3]},{radix:0,name:"Stable",sound:["e_stables1"],clss:"stable",strID:"e_stable",onlyRequired:1,resistance:0,health:800,maxHealth:800,invType:1,invMax:0,race:"euro",zLevel:1,validator:N,bimg:k.build4x4,dimg:k.des_4x4,iconID:68,dieSound:L,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.euro_stables,build:!0,cost:[0,200,0,0],onbuild:f,size:1,time:40,sight:5,img:k.euro_stables,
nu:c.createCow,child:[{img:k.euro_stable_c,x:0,y:0}]},{radix:0,name:"Workshop",sound:["e_workshop1"],clss:"workshop",strID:"e_workshop",zLevel:1,resistance:0,health:800,maxHealth:800,img:k.euro_workshop,invType:1,invMax:0,dieSound:L,validator:N,bimg:k.build4x4,race:"euro",dimg:k.des_4x4,iconID:75,icons:[c.createCatapult,c.createHeavyCatapult,c.createBallist,c.techEngineering,c.techCannonTower],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:k.euro_workshop,build:!0,cost:[0,200,200,0],
size:1,time:40,sight:5,child:[{img:k.euro_workshop_c,x:0,y:0}]},{radix:0,name:"Tavern",sound:["e_tavern1"],clss:"tavern",strID:"e_tavern",dieSound:L,resistance:0,health:1E3,maxHealth:1E3,img:k.euro_tavern,invType:1,invMax:0,validator:N,race:"euro",bimg:k.build4x4,dimg:k.des_4x4,zLevel:1,iconID:70,icons:[c.createMercenaries,c.createHeroes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4]),url:k.euro_tavern,build:1,cost:[0,200,200,0],onbuild:g,actvintv:[c.iniMercenaries,c.iniHeroes],size:1,
time:40,sight:5,child:[{img:k.euro_tavern_c,x:0,y:0}]},{name:"House",sound:["house1","house2","house3","house4","house5"],clss:"house",strID:"e_house",resistance:0,health:500,maxHealth:500,img:k.euro_houses,invType:1,invMax:0,validator:N,bimg:k.build3x3,dimg:k.des_3x3,race:"euro",iconID:73,zLevel:1,dieSound:L,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:k.euro_houses,build:!0,cost:[0,75,0,0],population:10,size:1,time:20,sight:4,child:[{img:k.euro_houses_c,x:0,y:0}]},{name:"Watch Tower",
attackSound:Ye,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),clss:"watch_tower",strID:"watch_tower",attack:7,health:400,maxHealth:400,img:k.euro_tower_wood_2,state:0,invType:1,race:"common",invMax:0,zLevel:1,dieSound:L,level:0,validator:N,child:[{img:k.euro_tower_wood_2_c,x:0,y:0},{alpha:!0,img:k.euro_tower_wood_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attimg:k.arrow1,attDist:8,bimg:k.build2x2,dimg:k.des_2x2,iconID:53,icons:[c.attack,c.stop,c.upgradeGuildTower],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_wood_2,
build:!0,cost:[0,300,0,0],size:1,arrow:!0,time:10,sight:15,standardFunc:S},{name:"Market",sound:["e_market1"],clss:"market",strID:"e_market",resistance:0,health:1400,maxHealth:1400,img:k.euro_market,invType:1,invMax:0,dieSound:L,zLevel:1,validator:N,bimg:k.build4x4,dimg:k.des_4x4,iconID:65,race:"euro",icons:[c.createCaravan],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,4]),url:k.euro_market,build:!0,cost:[0,200,200,0],size:1,time:60,sight:8,child:[{img:k.euro_market_c,x:0,y:0}]},{name:"Outpost",
sound:["e_outpost1"],clss:"outpost",strID:"e_outpost",zLevel:1,resistance:0,health:2E3,maxHealth:2E3,img:k.euro_outpost,invType:1,dieSound:L,invMax:50,validator:N,race:"euro",bimg:k.build4x4,dimg:k.des_4x4,iconID:66,icons:[c.emergeAllUnits],space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,4]),url:k.euro_outpost,build:!0,cost:[0,200,0,400],size:1,child:[{img:k.euro_outpost_c,x:0,y:0},{img:k.euro_outpost_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{name:"Bridge",clss:"bridge",strID:"bridge",
resistance:0,health:1E4,maxHealth:1E4,img:k.bridge_horz,invMax:0,validator:gk,bimg:k.bridge_horz_build,race:"common",zLevel:1,dieSound:L,child:[{alpha:!0,img:k.bridge_horz_s,x:0,y:0,rgb:[0,0,0,.5]},{img:k.bridge_horz1,x:0,y:0,z:6}],time:22,sight:1,dimg:k.bridge_horz_demol,iconID:44,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,11]),url:k.bridge_horz,build:!0,cost:[0,
200,0,400],size:1},{name:"Dummy",clss:"dummy",strID:"dummy",resistance:0,health:5E3,maxHealth:5E3,img:k.dummy1,invMax:0,validator:U,bimg:k.dummy1_b,iconID:165,icons:[],mx:0,zLevel:1,my:16,hframe:65,race:"common",url:k.dummy1,dimg:k.dummy1_d,build:!0,cost:[0,300,0,0],dummy:!0,child:[{img:k.dummy1_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:10,sight:1},{name:"Catapult",strID:"catapult",dieSound:$e,clss:"catapult",attackSound:Ze,defence:0,attack:10,health:110,maxHealth:110,img:k.catapult.idle,invMax:0,
radix:0,validator:U,iconID:30,time:30,sight:20,race:"common",url:k.catapult,level:0,zLevel:1,icons:e,cost:[0,600,0,0],nofreeze:1,arrow:!1,attDist:17,spd:40,standardFunc:S,size:1,attimg:k.cat_stone,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:c.createCatapult},{name:"Ballista",radix:0,strID:"ballista",attackSound:Ze,dieSound:$e,clss:"ballista",defence:0,attack:60,health:75,maxHealth:75,img:k.ballista.idle,invMax:0,validator:U,iconID:31,time:30,sight:16,nofreeze:1,race:"common",zLevel:1,url:k.ballista,
icons:e,cost:[0,800,0,0],attDist:13,spd:40,standardFunc:S,size:1,attimg:k.arrow_ballista1,space:new Uint8Array([1,1,1,1,2]),attackDeg:30,nu:c.createBallist},{name:"Heavy Catapult",strID:"heavy_catapult",attackSound:Ze,defence:0,attack:25,health:250,maxHealth:250,img:k.h_catapult.idle,invMax:0,radix:0,validator:U,iconID:45,time:60,dieSound:$e,sight:26,race:"common",url:k.h_catapult,zLevel:1,icons:e,standardFunc:S,cost:[0,1200,0,0],attDist:22,spd:40,nofreeze:1,clss:"heavy_catapult",size:1,attimg:k.cb_metal,
space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:c.createHeavyCatapult},{radix:0,name:"Ghost",strID:"ghost",defence:0,attack:8,health:60,maxHealth:60,img:k.euro_ghost.idle,invType:0,invMax:8,dieSound:["ghost1","ghost2"],validator:U,iconID:178,zLevel:1,race:"common",time:15,attackSound:Mi,sight:5,standardFunc:S,url:k.euro_ghost,icons:d,w:1,cost:[40,0,0,0],attDist:1,spd:80,clss:"ghost",size:1,nu:c.createGhost},{name:"Harbor",strID:"e_harbor",resistance:80,health:800,maxHealth:800,img:k.euro_harbor,
invType:1,invMax:0,validator:cg,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:k.build_harbor,dimg:k.des_harbor,zLevel:1,race:"euro",dieSound:L,iconID:63,icons:[c.createFishingBoat,c.createXebec,c.createHulk,c.createGalleon,c.techLandingTactics],clss:"harbor",url:k.euro_harbor,storage:4,build:!0,cost:[0,200,200,0],child:[{img:k.euro_harbor_c,x:0,y:0},{img:k.euro_harbor_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{radix:0,name:"Messiah",strID:"messiah",attack:50,defence:10,mana:1E3,
manaMax:1E3,health:1E3,maxHealth:1E3,img:k.messiah.idle,invType:0,invMax:0,race:"common",validator:U,human:1,iconID:169,zLevel:1,attackSound:["messiah_attack"],dieSound:["messiah"],time:300,sight:26,url:k.messiah,standardFunc:S,icons:d,cost:[2E3,0,0,0],attDist:10,spd:50,clss:"messiah",size:1,update:["mana","manaSpeed",1E3]},{name:"Magic Gateway",sound:["gateway"],strID:"gateway",magicGateway:1,resistance:0,health:Infinity,maxHealth:Infinity,img:k.teleport,invMax:0,validator:N,bimg:k.build4x4,zLevel:1,
dieSound:L,race:"common",iconID:180,clss:"magic_gateway",icons:[c.createOrk,c.createDwarf,c.createGhost,c.createSkeleton],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,5]),url:k.teleport,build:!0,cost:[0,0,0,0],size:1,time:10,sight:10,zolotoy:1,child:[{img:k.teleport_c,x:0,y:0},{alpha:!0,img:k.teleport_s,x:0,y:0,rgb:[0,0,0,.5]}],standardFunc:kl},{name:"Guard Tower",strID:"guard_tower",race:"common",clss:"guard_tower",attackSound:Ye,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),
attack:12,health:1E3,maxHealth:1E3,img:k.euro_tower_wood,state:0,invType:1,invMax:0,dieSound:L,zLevel:1,validator:N,child:[{img:k.euro_tower_wood_c,x:0,y:0},{alpha:!0,img:k.euro_tower_wood_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:12,bimg:k.build2x2,dimg:k.des_2x2,iconID:52,icons:[c.attack,c.stop,c.upgradeStoneTower,c.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_wood,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:k.arrow1,time:35,sight:16,standardFunc:S},{name:"Sword",attack:0,
defence:0,health:25,maxHealth:25,img:k.items1,state:0,invMax:0,validator:ec,iconID:16,url:k.items1,icons:[],cost:[0,0,0,0],size:1,zLevel:0,z32:.5,radix:0,race:"common",item:1},{name:"Bow",attack:0,defence:0,health:25,maxHealth:25,img:k.items1,state:0,invMax:0,validator:ec,iconID:4,url:k.items1,icons:[],cost:[0,0,0,0],size:1,z32:.5,zLevel:0,radix:0,race:"common",item:1},{name:"Shield",attack:0,defence:0,health:25,maxHealth:25,img:k.items1,state:0,invMax:0,validator:ec,iconID:1,url:k.items1,icons:[],
cost:[0,0,0,0],zLevel:0,race:"common",radix:0,size:1,z32:.5,item:1},{name:"Potion",attack:0,defence:0,health:25,maxHealth:25,img:k.potions,state:0,invMax:0,validator:ec,iconID:11,url:k.potions,icons:[],radix:0,race:"common",zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Book",attack:0,defence:0,health:25,maxHealth:25,img:k.book1,state:0,invMax:0,validator:ec,iconID:9,zLevel:0,race:"common",radix:0,url:k.books,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Gold",health:1,maxHealth:1,img:k.item_gold,
invMax:0,validator:ec,iconID:20,radix:0,race:"common",zLevel:0,url:k.item_gold,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Stone",health:1,maxHealth:1,img:k.item_stone,invMax:0,validator:ec,iconID:22,race:"common",radix:0,url:k.item_stone,zLevel:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Food",health:15,maxHealth:15,img:k.item_food,invMax:0,mMapcolor:[0,255,255],validator:ec,iconID:14,url:k.item_food,radix:0,race:"common",icons:[],zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},
{ignore:1,name:"Wood",health:1,maxHealth:1,img:k.item_wood,invMax:0,validator:ec,iconID:15,url:k.item_wood,icons:[],race:"common",radix:0,zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Iron",health:1,maxHealth:1,img:k.item_iron,invMax:0,validator:ec,iconID:21,zLevel:0,race:"common",url:k.item_iron,radix:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Keep Tower",strID:"keep_tower",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:16,health:2E3,maxHealth:2E3,img:k.euro_tower_stone,
state:0,invType:1,zLevel:1,attackSound:Ye,invMax:0,dieSound:L,validator:N,clss:"keep_tower",race:"common",child:[{alpha:!0,img:k.euro_tower_stone_s,x:0,y:0,rgb:[0,0,0,.5]},{img:k.euro_tower_stone_c,x:0,y:0}],attDist:14,bimg:k.build2x2,dimg:k.des_2x2,standardFunc:S,iconID:54,icons:[c.attack,c.stop,c.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_stone,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:k.arrow_big1,time:40,sight:18},{name:"Cannon Tower",clss:"tower_stone2",strID:"tower_stone2",
attackSound:Qd,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:40,health:2500,maxHealth:2500,img:k.euro_tower_stone_2,state:0,invType:1,invMax:0,dieSound:L,race:"common",validator:N,zLevel:1,child:[{img:k.euro_tower_stone_2_c,x:0,y:0},{alpha:!0,img:k.euro_tower_stone_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:10,bimg:k.build2x2,dimg:k.des_2x2,iconID:54,icons:[c.attack,c.stop],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_stone_2,build:!0,cost:[0,600,0,0],standardFunc:S,size:1,arrow:!1,
attimg:k.hot_cannon,time:45,sight:18,attackDeg:30},{name:"Rocket Tower",strID:"tower_rocket",race:"asia",clss:"tower_rocket",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),zLevel:1,attack:30,health:1400,maxHealth:1400,img:k.rocket_tower,state:0,invType:1,invMax:0,dieSound:L,validator:N,child:[{img:k.rocket_tower_c},{alpha:!0,img:k.rocket_tower_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:20,bimg:k.build2x2,dimg:k.des_2x2,iconID:186,icons:[],space:new Uint8Array([1,1,1,1,2]),url:k.rocket_tower,build:!0,
cost:[0,600,0,0],standardFunc:S,size:1,arrow:!0,attimg:k.arrow_big1,time:60,sight:26},{radix:0,name:"Ork",race:"common",strID:"ork",dieSound:["orc%20die%201","orc%20die%202"],attackSound:Li,attack:18,defence:2,health:75,maxHealth:75,img:k.ork.idle,invType:0,invMax:8,validator:U,zLevel:1,iconID:143,time:12,sight:5,url:k.ork,standardFunc:S,icons:d,cost:[60,0,0,0],attDist:1,spd:50,clss:"ork",size:1,nu:c.createOrk},{radix:0,name:"Dwarf",race:"common",attack:7,defence:7,health:120,maxHealth:120,img:k.dwarf.idle,
invType:0,strID:"dwarf",invMax:8,zLevel:1,dieSound:Wa,validator:U,iconID:185,time:12,sight:3,url:k.dwarf,standardFunc:S,icons:d,cost:[80,0,0,0],attDist:1,spd:50,clss:"dwarf",size:1,nu:c.createDwarf},{radix:0,name:"Skeleton",strID:"skeleton",race:"common",dieSound:["skeleton%20die%201","skeleton%20die%202","skeleton%20die%203","skeleton%20die%204"],attack:4,defence:0,health:40,maxHealth:40,img:k.skeleton.idle,invType:0,zLevel:1,attackSound:Ac,invMax:8,nofreeze:1,validator:U,iconID:167,time:12,sight:3,
url:k.skeleton,standardFunc:S,icons:d,cost:[0,0,30,0],attDist:1,spd:50,clss:"skeleton",size:1,nu:c.createSkeleton},{radix:0,name:"Caravan",race:"euro",strID:"e_caravan",attack:0,defence:0,health:350,maxHealth:350,img:k.caravan.idle,invType:1,invMax:8,validator:U,iconID:34,zLevel:1,time:50,sight:7,url:k.caravan,icons:[c.move,c.trade,c.explore,c.stop,c.stand,c.unload],cost:[0,200,400,0],attDist:1,spd:75,clss:"caravan",size:1,nu:c.createCaravan},{name:"Castle",health:8E3,maxHealth:8E3,img:k.asia_castle,
invType:1,strID:"a_castle",zLevel:1,race:"asia",invMax:50,validator:N,bimg:k.build6x6,dimg:k.des_6x6,iconID:164,time:120,sight:12,dieSound:L,clss:"castle",child:[{img:k.asia_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:k.asia_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[c.createPeon1,c.createNinja,c.emergeAllUnits,c.techFeudalism,c.techArchitecture,c.techLearning,c.techBuddhism,c.techGreatWall],space:new Uint8Array([0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,
1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,8]),menu:Oa,url:k.asia_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{name:"Castle",dieSound:L,clss:"castle",strID:"r_castle",race:"arab",health:8E3,maxHealth:8E3,img:k.arab_castle,invType:1,invMax:50,validator:N,bimg:k.build6x6,dimg:k.des_6x6,zLevel:1,iconID:97,time:120,sight:12,child:[{img:k.arab_castle_c}],icons:[c.createPeon2,c.createSpy,c.emergeAllUnits,c.techFeudalism,c.techArchitecture,c.techLearning,c.techSlavery],space:new Uint8Array([0,
0,0,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,,8]),menu:Oa,url:k.arab_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{radix:0,name:"Peasant",attack:5,defence:0,health:50,maxHealth:50,img:k.asian_peasant.idle,invType:0,invMax:8,attackSound:Ng,race:"asia",validator:U,human:1,strID:"a_peon",iconID:132,standardFunc:Qg,dieSound:Wa,zLevel:1,time:8,peon:1,sight:5,url:k.asian_peasant,icons:[c.move,
c.menuBuilds1,c.repair,c.conquest,c.dcm,c.pickUp,c.explore,c.stop,c.stand,c.attack,c.sameSpeed,c.restoreSpeed],cost:[0,0,40,0],attDist:1,spd:50,clss:"peon",nocapture:1,size:1},{radix:0,name:"Ninja",race:"asia",attack:12,defence:5,mana:100,manaMax:100,health:90,maxHealth:90,img:k.asian_ninja.idle,invType:0,invMax:8,attackSound:Ac,validator:U,human:1,iconID:133,strID:"ninja",dieSound:Wa,zLevel:1,time:20,standardFunc:S,sight:10,url:k.asian_ninja,icons:[c.guard,c.patrol,c.pickUp,c.explore,c.stop,c.stand,
c.invisibility,c.murder,c.move,c.attack,c.sameSpeed,c.restoreSpeed],cost:[120,0,0,0],attDist:1,spd:85,clss:"ninja",size:1,update:["mana","manaSpeed",1E3]},{radix:0,name:"Ronin",attack:7,defence:0,health:45,maxHealth:45,img:k.asian_ronin.idle,invType:0,invMax:8,race:"asia",validator:U,human:1,standardFunc:S,iconID:141,strID:"ronin",dieSound:Wa,zLevel:1,time:8,sight:5,url:k.asian_ronin,icons:d,cost:[0,0,40,0],attDist:1,spd:50,attackSound:Ac,clss:"a_footman",size:1},{radix:0,name:"Archer",attack:5,defence:0,
health:50,maxHealth:50,img:k.asian_archer.idle,invType:0,invMax:8,race:"asia",validator:U,human:1,strID:"a_archer",dieSound:Wa,zLevel:1,attimg:k.arrow1,iconID:136,arrow:1,attackSound:rd,time:12,sight:10,url:k.asian_archer,icons:d,cost:[0,20,40,0],standardFunc:S,spd:50,clss:"archer",size:1,attDist:6},{radix:0,name:"Samurai",attack:10,defence:4,health:90,maxHealth:90,img:k.asian_samurai.idle,invType:0,race:"asia",strID:"samurai",invMax:8,attackSound:Ac,validator:U,human:1,iconID:142,time:20,standardFunc:S,
zLevel:1,dieSound:Wa,sight:6,url:k.asian_samurai,icons:d,cost:[50,0,150,0],attDist:1,spd:50,clss:"a_maceman",size:1},{radix:0,name:"Horse Archer",attack:7,defence:0,health:75,maxHealth:75,img:k.asian_horsarcher.idle,invType:0,race:"asia",invMax:8,validator:U,human:1,attackSound:rd,iconID:183,strID:"a_horse_archer",dieSound:Rd,time:20,standardFunc:S,sight:12,url:k.asian_horsarcher,zLevel:1,icons:d,arrow:1,attimg:k.arrow1,cost:[40,0,120,0],spd:85,clss:"horse_archer",size:1,attDist:7},{radix:0,name:"Horse Samurai",
attack:14,defence:4,health:160,maxHealth:160,img:k.asian_horsamurai.idle,invType:0,invMax:8,validator:U,human:1,iconID:135,race:"asia",standardFunc:S,attackSound:Pd,time:22,zLevel:1,strID:"horse_samurai",dieSound:Rd,sight:5,url:k.asian_horsamurai,icons:d,cost:[75,0,120,0],attDist:1,spd:85,clss:"horse_samurai",size:1},{name:"Barracks",resistance:500,health:1400,maxHealth:1400,img:k.asia_barracks,invType:1,sound:Og,invMax:0,time:60,dieSound:L,radix:0,sight:6,race:"asia",strID:"a_barrack",validator:N,
zLevel:1,bimg:k.build5x5,dimg:k.des_5x5,child:[{img:k.asia_barracks_c,x:0,y:0,mv:!0},{img:k.asia_barracks_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:146,icons:[c.createRonin,c.createArcher1,c.createSamurai,c.createHorseArcher1,c.createHorseSamurai,c.createChariot],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:k.asia_barracks,build:!0,cost:[0,200,0,200],size:1,clss:"barracks"},{name:"Chariot",attack:4,defence:3,health:180,maxHealth:180,img:k.asian_charriot.idle,invType:0,
radix:0,race:"asia",invMax:8,strID:"chariot",dieSound:["c%20die%201","c%20die%202","c%20die%203","c%20die%204","c%20die%205"],attackSound:Pd,validator:U,human:1,zLevel:1,iconID:175,standardFunc:S,time:8,sight:5,url:k.asian_charriot,icons:d,cost:[0,200,150,0],attDist:1,spd:85,clss:"chariot",size:1},{radix:1,name:"Galleon",attackSound:Qd,attack:35,attDist:12,race:"common",defence:0,health:1200,maxHealth:1200,strID:"galleon",nu:c.createGalleon,img:k.galleon.idle,invType:1,invMax:24,dieSound:["ship%20sink"],
zLevel:0,validator:ze,iconID:32,time:50,boat:!0,attimg:k.cb_metal,attackDeg:20,sight:16,url:k.galleon,icons:[c.move,c.explore,c.unload,c.attack,c.attackGround,c.stop,c.stand,c.stop,c.stand,c.attack,c.steady,c.upgradeShip],cost:[0,1200,800,0],spd:50,nofreeze:1,clss:"galleon",standardFunc:S,size:1,peon:1},{radix:1,name:"Fishing Boat",attackSound:Qd,attack:1,attDist:8,race:"common",defence:0,health:50,boat:!0,nu:c.createFishingBoat,maxHealth:50,img:k.boat.idle,invType:1,invMax:0,strID:"fishing_boat",
dieSound:["ship%20sink"],zLevel:0,validator:ze,iconID:184,nofreeze:1,time:50,sight:16,url:k.boat,icons:[c.move,c.explore,c.stop,c.stand,c.fishing],cost:[0,200,100,0],spd:65,clss:"fishing_boat",size:1},{radix:1,name:"Hulk",attackSound:Qd,attack:18,attDist:10,race:"common",defence:0,health:700,maxHealth:700,strID:"hulk",img:k.hulk.idle,invType:1,boat:!0,nu:c.createHulk,attackDeg:20,invMax:16,dieSound:["ship%20sink"],zLevel:0,validator:ze,iconID:128,time:30,sight:14,attimg:k.cb_metal,url:k.hulk,icons:[c.move,
c.explore,c.unload,c.attack,c.attackGround,c.stop,c.stand,c.stop,c.stand,c.attack,c.steady,c.upgradeShip],cost:[0,500,300,0],spd:65,nofreeze:1,clss:"hulk",standardFunc:S,size:1},{radix:1,name:"Pinque",attackSound:rd,attack:10,race:"common",attDist:8,defence:0,health:300,boat:!0,maxHealth:300,img:k.xebec.idle,attimg:k.arrow1,arrow:!0,strID:"pinque",invType:1,invMax:8,dieSound:["ship%20sink"],zLevel:0,validator:ze,iconID:129,time:20,nofreeze:1,sight:12,url:k.xebec,icons:[c.move,c.explore,c.unload,c.attack,
c.attackGround,c.stop,c.stand,c.stop,c.stand,c.attack,c.steady,c.upgradeShip],cost:[0,300,200,0],spd:80,clss:"xebec",size:1,standardFunc:S,nu:c.createXebec},{radix:0,name:"Stone Golem",strID:"troll",defence:3,attack:25,health:400,maxHealth:400,img:k.troll.idle,invType:0,invMax:0,dieSound:["golem"],validator:U,iconID:144,race:"common",zLevel:1,nofreeze:1,attackSound:["golem1","golem2"],sight:10,standardFunc:S,url:k.troll,icons:d,w:1,cost:[120,0,0,0,600],attDist:1,spd:56,clss:"troll",size:1},{radix:0,
name:"Bat",strID:"bat",defence:0,attack:3,health:20,maxHealth:20,img:k.bat.move,invType:0,invMax:0,race:"common",bat:1,dieSound:["bat%20die"],validator:dg,iconID:105,zLevel:2,attackSound:["bat%20attack"],sight:10,standardFunc:S,url:k.bat,icons:d,w:1,cost:[0,0,0,0,25],attDist:1,spd:128,clss:"bat",size:1,z32:1.5},{race:"arab",invType:0,invMax:8,iconID:138,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_peasant,img:k.arab_peasant.idle,spd:50,validator:U,human:1,icons:[c.move,c.menuBuilds2,
c.repair,c.conquest,c.dcm,c.pickUp,c.explore,c.stop,c.stand,c.attack,c.convertJihad,c.bribe,c.sameSpeed,c.restoreSpeed],name:"Peasant",clss:"peon",cost:[0,0,50,0],attDist:1,time:8,nocapture:1,standardFunc:Qg,peon:1,sight:5,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:172,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_footman,img:k.arab_footman.idle,standardFunc:S,spd:50,validator:U,human:1,attDist:1,icons:d,name:"Footman",clss:"footman",cost:[0,0,50,0],time:12,
sight:5,health:50,attack:6,defence:1},{race:"arab",invType:0,invMax:8,iconID:170,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_archer,img:k.arab_archer.idle,spd:50,validator:U,standardFunc:S,human:1,attimg:k.arrow1,arrow:1,icons:d,name:"Archer",clss:"archer",cost:[0,20,40,0],time:12,sight:10,attDist:6,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:173,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_spearman,img:k.arab_spearman.idle,spd:50,validator:U,
standardFunc:S,human:1,icons:d,name:"Spearman",clss:"pikeman",attDist:1,cost:[40,0,60,0],time:14,sight:5,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:174,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,standardFunc:S,url:k.arab_satrap,img:k.arab_satrap.idle,spd:50,validator:U,human:1,icons:d,name:"Satrap",attDist:1,clss:"maceman",cost:[0,0,120,0],time:14,sight:5,health:120,attack:8,defence:0},{race:"arab",invType:0,invMax:8,iconID:171,zLevel:1,dieSound:[],attackSound:[],
size:1,radix:0,url:k.arab_cavalry,standardFunc:S,img:k.arab_cavalry.idle,spd:85,validator:U,human:1,attDist:1,icons:d,name:"Cavalry",clss:"heavy_cavalry",cost:[60,0,100,0],time:14,sight:5,health:90,attack:10,defence:4},{race:"arab",invType:0,invMax:8,iconID:168,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_horse_archer,img:k.arab_horse_archer.idle,spd:85,validator:U,human:1,standardFunc:S,icons:d,name:"Horse Archer",clss:"horse_archer",cost:[50,0,100,0],time:14,attimg:k.arrow1,arrow:1,
sight:12,attDist:7,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:179,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_jwarrior,img:k.arab_jwarrior.idle,spd:50,validator:U,human:1,standardFunc:S,icons:d,name:"Jihad warrior",attDist:1,clss:"jihad_warrior",cost:[0,0,100,0],time:8,sight:5,health:75,attack:10,defence:2},{race:"arab",invType:0,invMax:8,iconID:176,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_priest,img:k.arab_priest.idle,standardFunc:S,
spd:50,mana:100,validator:U,human:1,icons:h,name:"Priest",clss:"priest",cost:[150,0,0,0],time:30,sight:21,attDist:18,health:60,attack:20,update:["mana","manaSpeed",1E3],manaMax:100,defence:0,attimg:k.flame_bolt,ball:1,attackOnly:ye.magic_creatures.obj},{race:"arab",invType:0,invMax:0,iconID:105,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:0,img:0,testing:1,illegal:1,spd:50,validator:U,human:1,icons:[],name:"Spy",clss:"spy",cost:150,time:30,sight:12,health:50,attack:20,defence:0},{race:"arab",
invType:0,invMax:8,iconID:188,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,attimg:k.flame_bolt,url:k.arab_mage,img:k.arab_mage.idle,spd:50,validator:U,human:1,icons:[c.stop,c.pickUp,c.explore,c.createCarpet,c.createJinn,c.fireRain,c.magicVision,c.raiseDead,c.attack,c.stand,c.move],standardFunc:S,name:"Mage",clss:"mage",ball:1,mana:100,manaMax:100,update:["mana","manaSpeed",1E3],cost:[150,0,0,0],time:30,sight:15,attDist:10,health:60,attack:8,defence:0},{race:"arab",invType:1,invMax:8,iconID:126,
zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_caravan,img:k.arab_caravan.idle,spd:75,validator:U,human:1,icons:[],name:"Caravan",clss:"trader",cost:[0,0,500,0],time:30,sight:5,health:150},{race:"arab",invType:0,invMax:8,iconID:177,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_enichar,img:k.arab_enichar.idle,spd:85,validator:U,human:1,standardFunc:S,icons:d,name:"Enichar",attDist:1,clss:"enichar",cost:[80,0,120,0],time:25,sight:5,health:130,attack:18,defence:4},{race:"arab",
invType:1,invMax:0,iconID:82,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,population:10,url:k.arab_houses,validator:N,build:1,icons:[],child:[{img:k.arab_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],time:20,sight:4,resistance:50,health:500},{race:"arab",invType:1,invMax:0,iconID:85,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_lumbermill,validator:N,build:1,icons:[c.techWoodCutting,
c.techCrossbow],child:[{img:k.arab_lumbermill_c}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],storage:1,time:30,sight:4,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:96,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_storage,validator:N,build:1,storage:0,icons:[c.techGoldMining,c.techStoneMining],child:[{img:k.arab_storage_c},{alpha:!0,img:k.arab_storage_s,rgb:[0,0,0,.5]}],name:"Storage",clss:"storage",
cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:80,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_farm,validator:N,build:1,icons:[c.createCow,c.techCropRotation,c.techDomestication,c.techCowPoaching,c.ridingHorses,c.techHorseManShip],child:[{img:k.arab_farm_c}],name:"Farm",storage:2,clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,
invMax:0,iconID:81,zLevel:1,dieSound:L,validator:cg,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:k.build_harbor,dimg:k.des_harbor,radix:0,url:k.arab_harbour,build:1,icons:[c.createFishingBoat,c.createXebec,c.createHulk,c.techLandingTactics],child:[{img:k.arab_harbour_c},{alpha:!0,img:k.arab_harbour_s,rgb:[0,0,0,.5]}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:79,zLevel:1,dieSound:L,space:new Uint8Array([1,
1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_blacksmith,validator:N,build:1,icons:[c.techTemperIron,c.techScaleArmor,c.techScimitar,c.techChainMail,c.techHalberd],child:[{img:k.arab_blacksmith_c},{alpha:!0,img:k.arab_blacksmith_s,rgb:[0,0,0,.5]}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],onbuild:b,time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:95,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,
dimg:k.des_4x4,radix:0,url:k.arab_workshop,validator:N,build:1,icons:[c.createCatapult,c.createBallist,c.techEngineering,c.techCannonTower],child:[{img:k.arab_workshop_c},{alpha:!0,img:k.arab_workshop_s,rgb:[0,0,0,.5]}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:140,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_church,validator:N,build:1,icons:[c.createPriest2],
child:[{img:k.arab_church_c},{alpha:!0,img:k.arab_church_s,rgb:[0,0,0,.5]}],name:"Church",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"arab",invType:1,invMax:0,iconID:92,zLevel:1,dieSound:L,space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_tavern,validator:N,build:1,icons:[c.createMercenaries,c.createHeroes],child:[{img:k.arab_tavern_c}],name:"Tavern",clss:"tavern",cost:[0,200,200,0],onbuild:g,actvintv:[c.iniMercenaries,
c.iniHeroes],time:40,sight:5,resistance:150,health:1E3},{race:"arab",invType:1,invMax:0,iconID:87,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_market,validator:N,build:1,icons:[c.createCaravan2],child:[{img:k.arab_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:98,zLevel:1,dieSound:L,space:new Uint8Array([0,1,1,1,0,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_barracks,validator:N,build:1,icons:[c.createFootman2,c.createArcher2,c.createSatrap,c.createPikeman2,c.createHorseArcher2,c.createCavalry,c.createEnichar,c.createJihad],child:[{img:k.arab_barracks_c},{alpha:!0,img:k.arab_barracks_s,rgb:[0,0,0,.5]}],name:"Barracks",clss:"barrack",cost:[0,0,200,200],time:60,sight:6,resistance:500,health:1400},{race:"arab",invType:1,invMax:0,iconID:91,zLevel:1,dieSound:L,space:new Uint8Array([1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_stables,validator:N,build:1,icons:[],child:[{img:k.arab_stables_c}],name:"Stable",clss:"stable",cost:[0,200,200,0],time:40,onbuild:f,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:50,iconID:89,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_outpost,validator:N,build:1,icons:[c.emergeAllUnits],child:[{img:k.arab_outpost_c,
mv:1},{alpha:!0,img:k.arab_outpost_s,rgb:[0,0,0,.5]}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"arab",invType:1,invMax:0,iconID:105,zLevel:1,dieSound:L,space:23213123,bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:0,img:0,validator:N,build:1,icons:[],child:[{img:3213123}],name:"NULL",testing:1,clss:"castle",cost:[0,1500,0,1500],time:120,sight:12,resistance:1E3,health:8E3},{race:"arab",invType:1,invMax:0,iconID:88,zLevel:1,dieSound:L,space:new Uint8Array([0,
0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,6]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_mosque,validator:N,build:1,icons:[c.techFanaticism,c.techEspionage,c.techHealing,c.techBless,c.techJihad],child:[{img:k.arab_mosque_c},{alpha:!0,img:k.arab_mosque_s,rgb:[0,0,0,.5]}],name:"Mosque",onbuild:[c.buildChurch2],clss:"mosque",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:86,zLevel:1,dieSound:L,space:new Uint8Array([0,
1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_magetower,validator:N,build:1,icons:[c.createMage2,c.techCarpet,c.techMagicWorkshop,c.techFireRain,c.techMagicVision,c.techNecromancy,c.techJinn],child:[{img:k.arab_magetower_c},{alpha:!0,img:k.arab_magetower_s,rgb:[0,0,0,.5]}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:93,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_tc_guild,validator:N,build:1,icons:[c.techUsury,c.techTradeRoutes,c.techSupplyStorage,c.techBribery,c.techOreFloatation],child:[{img:k.arab_tcguild_c},{alpha:!0,img:k.arab_tc_guild_s,rgb:[0,0,0,.5]}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[c.buildMarket2],sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:94,zLevel:1,dieSound:L,space:new Uint8Array([1,
1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_waracademy,validator:N,build:1,icons:[c.techHeroism,c.techWarfare,c.techMercenaries,c.techRiddingHorses,c.techBodyBuilding,c.techLeadership,c.techHeroes,c.techJanissary,c.techHonor,c.techFame],child:[{img:k.arab_waracademy_c},{alpha:!0,img:k.arab_waracademy_s,rgb:[0,0,0,.5]}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,
invMax:0,iconID:158,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_magicworkshop,validator:N,build:1,icons:[c.createObjects],child:[{img:k.arab_magicworkshop_c},{alpha:!0,img:k.arab_magicworkshop_s,rgb:[0,0,0,.5]}],name:"Magic Workshop",disallowPoint:!0,clss:"magicworkshop",cost:[0,0,0,300],time:20,sight:5,resistance:200,health:1200},{race:"asia",invType:1,invMax:0,iconID:161,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,
0,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.asia_houses,validator:N,build:1,icons:[],child:[{img:k.asia_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],population:10,time:20,sight:4,resistance:50,health:500},{race:"asia",invType:1,invMax:0,iconID:149,zLevel:1,dieSound:L,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,storage:1,url:k.asia_lumbermill,validator:N,build:1,icons:[c.techWoodCutting,c.techCrossbow],child:[{img:k.asia_lumbermill_c},{img:k.asia_lumbermill_s,
rgb:[0,0,0,.5],alpha:!0}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],time:30,sight:4,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:154,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_storage,storage:0,validator:N,build:1,icons:[c.techGoldMining,c.techStoneMining],child:[{img:k.asia_storage_s,rgb:[0,0,0,.5],alpha:!0},{img:k.asia_storage_c}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,
sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:147,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,storage:2,url:k.asia_farm,validator:N,build:1,icons:[c.techCropRotation,c.ridingHorses,c.irrigation],child:[{img:k.asia_farm_c}],name:"Farm",clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:148,zLevel:1,dieSound:L,space:new Uint8Array([0,1,1,1,1,
1,1,1,1,3]),validator:cg,bimg:k.build_harbor,dimg:k.des_harbor,radix:0,url:k.asia_harbor,build:1,icons:[c.createFishingBoat,c.createXebec,c.createHulk,c.techLandingTactics],child:[{img:k.asia_harbor_c},{img:k.asia_harbor_s,rgb:[0,0,0,.5],alpha:!0}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:145,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,
radix:0,url:k.asia_blacksmith,validator:N,build:1,icons:[c.techTemperIron,c.techScaleArmor,c.techArmoredChariot,c.techChainMail],child:[{img:k.asia_blacksmith_c},{img:k.asia_blacksmith_s,rgb:[0,0,0,.5],alpha:!0}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],time:40,sight:5,onbuild:b,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:157,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_workshop,validator:N,
build:1,icons:[c.createCatapult,c.createBallist,c.techEngineering,c.techCannonTower],child:[{img:k.asia_workshop_c,x:0,y:0},{img:k.asia_workshop_s,rgb:[0,0,0,.5],alpha:!0}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:162,zLevel:1,dieSound:L,space:new Uint8Array([0,1,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asian_monastery,validator:N,build:1,icons:[c.createMonk,
c.createPriest1],child:[{img:k.asian_monastery_c},{img:k.asian_monastery_s,rgb:[0,0,0,.5],alpha:!0}],name:"Monastery",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"asia",invType:1,invMax:0,iconID:155,zLevel:1,dieSound:L,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_tavern,validator:N,build:1,icons:[c.createMercenaries,c.createHeroes],child:[{img:k.asia_tavern_c},{img:k.asia_tavern_s,rgb:[0,0,0,.5],alpha:!0}],
onbuild:g,name:"Tavern",clss:"tavern",actvintv:[c.iniMercenaries,c.iniHeroes],cost:[0,200,200,0],time:40,sight:5,resistance:150,health:1E3},{race:"asia",invType:1,invMax:0,iconID:150,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_market,validator:N,build:1,icons:[],child:[{img:k.asia_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:153,
zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_stables,validator:N,build:1,icons:[],child:[{img:k.asia_stables_c,mv:!0},{img:k.asia_stables_s,rgb:[0,0,0,.5],alpha:!0}],name:"Stable",clss:"stable",onbuild:f,cost:[0,200,200,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:151,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.asia_outpost,
validator:N,build:1,icons:[c.emergeAllUnits],child:[{img:k.asia_outpost_c,mv:1},{img:k.asia_outpost_s,rgb:[0,0,0,.5],alpha:!0}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"asia",invType:1,invMax:0,iconID:163,zLevel:1,dieSound:L,space:new Uint8Array([0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,6]),bimg:k.build6x6,dimg:k.des_6x6,radix:0,url:k.asia_shao_lin,validator:N,build:1,icons:[c.techMeditation,c.techKungFu,c.techHealing,
c.techPhilosophy,c.techNinjas,c.techMastery,c.techTournaments,c.techMedicine],child:[{img:k.asia_shao_lin_c},{img:k.asia_shao_lin_s,rgb:[0,0,0,.5],alpha:!0}],name:"Shao Linn",onbuild:[c.buildChurch1],clss:"shaolinn",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:152,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_wizardguild,validator:N,build:1,icons:[c.createMage1,
c.techConcentration,c.techWhirlpool,c.techFlameBolt,c.techTurnToStone,c.techConfusion,c.techDragon],child:[{img:k.asia_wizardguild_c},{img:k.asia_wizardguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:159,zLevel:1,dieSound:L,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_tcguild,validator:N,build:1,icons:[c.techTradeRoutes,
c.techUsury,c.techJewelry,c.techSupplyStorage,c.techBanking,c.techChemistry,c.techSeaFood,c.techGunPowder,c.techRocketArrow],child:[{img:k.asia_tcguild_c,mv:!0},{img:k.asia_tcguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[c.buildMarket1],sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:156,zLevel:1,dieSound:L,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,
radix:0,url:k.asia_warguild,validator:N,build:1,icons:[c.techBushido,c.techHeroism,c.techWarfare,c.techMercenaries,c.techLeadership,c.techTactics,c.techHeroes,c.techHonor,c.techSunTzu],child:[{img:k.asia_warguild_c,mv:!0},{img:k.asia_warguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:0,invMax:0,iconID:166,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.asian_priest,img:k.asian_priest.idle,
spd:50,validator:U,human:1,icons:[c.attack,c.stop,c.stand,c.pickUp,c.explore,c.healing,c.teach,c.move],name:"Priest",clss:"priest",cost:[170,0,0,0],time:30,sight:21,health:120,standardFunc:S,attDist:1,attack:10,defence:10,mana:100,update:["mana","manaSpeed",1E3],manaMax:100},{race:"asia",invType:0,invMax:0,iconID:187,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.asian_monk,img:k.asian_monk.idle,spd:50,validator:U,human:1,icons:d,name:"Monk",standardFunc:S,clss:"monk",cost:[0,0,200,0],time:20,
sight:5,health:90,attack:6,defence:6,attDist:1},{race:"asia",invType:0,invMax:0,iconID:134,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.asian_mage,img:k.asian_mage.idle,spd:50,attimg:k.flame_bolt,validator:U,standardFunc:S,human:1,icons:[c.stop,c.pickUp,c.explore,c.confusion,c.turnToStone,c.whirlpool,c.flameBolt,c.createDragon,c.attack,c.stand,c.move],name:"Mage",clss:"mage",cost:[150,0,0,0],ball:1,time:30,sight:15,mana:100,attDist:10,health:60,attack:8,defence:0,update:["mana","manaSpeed",
1E3],manaMax:100},{radix:0,name:"Dragon",strID:"dragon",defence:0,attack:25,health:300,maxHealth:300,img:k.dragon.idle,invType:0,invMax:0,dieSound:[],sSizex:2,sSizey:2,dragon:1,iconID:160,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:12,standardFunc:S,url:k.dragon,icons:d,cost:[80,0,0,0,800],attDist:2,spd:128,clss:"drg",size:1,z32:1.5,validator:dg},{radix:0,name:"Carpet",strID:"carpet",defence:0,attack:0,health:90,maxHealth:90,img:k.carpet.idle,invType:1,invMax:8,dieSound:[],iconID:131,race:"common",
zLevel:2,nofreeze:1,attackSound:[],sight:8,url:k.carpet,icons:[c.move,c.unload,c.explore,c.stop,c.stand],cost:[80,0,0,0,500],attDist:2,spd:120,clss:"carpet",size:1,z32:1.5,validator:dg},{radix:0,name:"Jinn",strID:"jinn",defence:5,attack:20,health:300,maxHealth:300,img:k.arab_jinn.idle,invType:0,invMax:0,dieSound:[],validator:U,iconID:182,race:"common",zLevel:1,nofreeze:1,attackSound:[],sight:8,standardFunc:S,url:k.arab_jinn,icons:d,w:1,cost:[80,0,0,0,300],attDist:1,spd:85,clss:"jinn",size:1}];sd=
{};Th={arr:[]};jb={euro:[],asia:[],arab:[],common:[]};Td=[];Hc=[[],[],[],[],[],[]];n=0;for(m=A.length;n<m;n++){l=A[n];A[n].type=n;var q=l.space;l.name.split(" ").join("");l.population&&Td.put(l);sd[n]={};void 0!==l.storage&&(-1<l.storage?(0===l.storage&&Hc[3].put(n),Hc[l.storage].put(n)):(Hc[0].put(n),Hc[1].put(n),Hc[2].put(n),Hc[3].put(n)));mb[l.race][l.name.toLowerCase().split(" ").join("")]=l;l.icons.menuName=l.strID;Th[l.name]=n;Th.arr.put(n);l.img||(l.img=l.url);l.maxHealth=l.health;l.race&&
jb[l.race].put(l);g=0;f=l.icons;for(h=f.length;g<h;g++)(e=f[g])&&e.obj&&(e.orderOrigin=l);if(q){g=[];l.free=g;e=q[q.length-1];b=(q.length-1)/e;l=e+2;h=b+2;f=new Uint8Array(l*h);for(t=0;t<b;t++)for(var r=0;r<e;r++)f[(t+1)*l+r+1]=q[r+t*e];t=0;for(h*=l;t<h;t++)!f[t]&&(f[t+1]||f[t-1]||f[t+1+l]||f[t+1-l]||f[t-1+l]||f[t-1-l]||f[t+l]||f[t-l])&&(g.put(t%l-1),g.put(~~(t/l)-1))}}jb.euro=jb.euro.concat(jb.common);jb.asia=jb.asia.concat(jb.common);jb.arab=jb.arab.concat(jb.common);jb[0]=jb.euro;jb[1]=jb.arab;
jb[2]=jb.asian;f=mb.euro;h=mb.asia;e=mb.arab;b=mb.common;mb[0]=mb.euro;mb[1]=mb.arab;mb[2]=mb.asia;id||(d.cut=M({a:"attack",g:"guard",r:"patrol",p:"pickUp",e:"explore",s:"stop",n:"stand"}),f.tavern.icons.cut=M({t:"trade1",g:"gamble",m:"createMercenaries",h:"createHeroes",l:"loan"}),f.castle.icons.cut=M({p:"createPeon",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning"}),h.castle.icons.cut=M({p:"createPeon1",n:"createNina",e:"emergeAllUnits",d:"techFeudalism",
a:"techArchitecture",l:"techLearning",b:"techBudhism",w:"techGreatwall"}),e.castle.icons.cut=M({p:"createPeon2",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",y:"techSlavery"}),f.barracks.icons.cut=M({f:"createFootman",a:"createArcher",m:"createMaceman",p:"createPikeman",l:"createLongbowman",k:"createKnight"}),h.barracks.icons.cut=M({r:"createRonin",a:"createArcher1",s:"createSamurai",h:"createHorseArcher1",o:"createHorseSamurai",c:"createChariot"}),e.barracks.icons.cut=
M({f:"createFootman2",a:"createArcher2",s:"createSatrap",p:"createPikeman2",h:"createHorseArcher2",c:"createCavalry",j:"createEnichar",d:"createJihad"}),f.magetower.icons.cut=M({m:"createMage"}),h.mageguild.icons.cut=M({m:"createMage1"}),e.mageguild.icons.cut=M({m:"createMage2"}),f.peasant.icons.cut=M({b:"menuBuilds",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",i:"bribe"}),e.peasant.icons.cut=M({b:"menuBuilds2",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",
s:"stop",n:"stand",a:"attack",j:"become_jihadw",i:"bribe"}),h.peasant.icons.cut=M({b:"menuBuilds1",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",t:"trade"}),f.priest.icons.cut=M({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),e.priest.icons.cut=M({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),h.priest.icons.cut=M({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",r:"raiseexp"}),f.wizard.icons.cut=
M({m:"move",a:"attack",s:"stop",n:"stand",l:"lightning",b:"createBat",f:"freeze",t:"createGolem",i:"invisibility"}),e.mage.icons.cut=M({m:"move",a:"attack",s:"stop",n:"stand",c:"spell_spawncarpet",j:"spell_spawnjin",r:"spell_firerain",v:"spell_magicvision",d:"raisedead"}),h.mage.icons.cut=M({m:"move",a:"attack",s:"stop",n:"stand",h:"spell_hypnotize",t:"spell_turntostone",w:"spell_whirlpool",f:"spell_flamebolt",d:"spell_spawndragon"}),b.spy.icons.cut=M({a:"attack",g:"guard",r:"patrol",p:"pick_item",
e:"explore",n:"stand",s:"stop"}),h.monk.icons.cut=M({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"}),h.ninja.icons.cut=M({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand",c:"cloak",u:"murder"}),b.catapult.icons.cut=M({a:"attack",g:"guard",p:"patrol",e:"explore",s:"stop",n:"stand",r:"attack_ground",h:"hold_steady"}),f.market.icons.cut=M({c:"createCaravan"}),e.market.icons.cut=M({c:"createCaravan2"}),h.market.icons.cut=M({b:"market_items",s:"market_sell"}),
f.workshop.icons.cut=M({c:"createCatapult",h:"createHeavyCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),e.workshop.icons.cut=M({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),h.workshop.icons.cut=M({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),f.church.icons.cut=M({p:"createPriest"}),e.church.icons.cut=M({p:"createPriest2"}),h.monastery.icons.cut=M({m:"createMonk",p:"createPriest1"}),e.magicworkshop.icons.cut=
M({i:"build_item"}),d=M({c:"buildCastle",s:"buildStorage",b:"buildBarrack",k:"buildBlacksmith",f:"buildFarm",l:"buildLumbermill",p:"buildWorkshop",e:"buildCathedral",u:"buildChurch",n:"buildTavern",m:"buildMageTower",a:"buildStable",r:"buildHarbor",o:"buildOutpost",i:"buildFields",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse",g:"buildGateWood",y:"buildDummy"}),g=M({c:"buildCastle2",k:"buildBlacksmith2",f:"buildFarm2",n:"buildTavern2",b:"buildBarrack2",p:"buildWorkshop2",s:"buildStorage2",
a:"buildStable2",l:"buildLumbermill2",r:"buildHarbor2",o:"buildOutpost2",u:"buildChurch2",e:"buildMosque",i:"buildFields",m:"buildMageTower2",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse2",g:"buildGateWood"}),n=M({c:"buildCastle1",f:"buildFarm1",e:"buildShaolinn",n:"buildTavern1",b:"buildBarrack1",p:"buildWorkshop1",s:"buildStorage1",k:"buildBlacksmith1",a:"buildStable1",l:"buildLumbermill1",r:"buildHarbor1",o:"buildOutpost1",u:"buildChurch1",i:"buildFields",m:"buildMageTower1",
w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse1",g:"buildGateWood"}),Ae.cut=n,Be.cut=n,Ce.cut=d,De.cut=d,Ee.cut=d,Fe.cut=n,Ge.cut=d,He.cut=n,Ie.cut=g,Je.cut=g,Ke.cut=g,Le.cut=g,f.lumbermill.icons.cut=M({b:"techLongbow",w:"techWoodCutting",c:"techCrossbow"}),e.lumbermill.icons.cut=M({w:"techWoodCutting",c:"techCrossbow"}),h.lumbermill.icons.cut=M({w:"techWoodCutting",c:"techCrossbow"}),f.blacksmith.icons.cut=M({p:"techPlateArmor",t:"techTemperIron",s:"techScaleArmor",h:"techHalberd",
c:"techChainMail"}),e.blacksmith.icons.cut=M({t:"techTemperIron",a:"techScaleArmor",s:"techScimitar",c:"techChainMail",h:"techHalberd"}),h.blacksmith.icons.cut=M({t:"techTemperIron",a:"techScaleArmor",r:"techArmoredChariot",c:"techChainMail"}),f.outpost.icons.cut=M({e:"emergeAllUnits"}),e.outpost.icons.cut=M({e:"emergeAllUnits"}),h.outpost.icons.cut=M({e:"emergeAllUnits"}),b.watchtower.icons.cut=M({a:"attack",s:"stop",g:"upgradeGuildTower"}),b.guardtower.icons.cut=M({a:"attack",s:"stop",g:"upgradeStoneTower",
c:"upgradeCannonTower"}),b.keeptower.icons.cut=M({a:"attack",s:"stop",c:"upgradeCannonTower"}),b.cannontower.icons.cut=M({a:"attack",r:"attack_ground",s:"stop",h:"holdfire"}),h.rockettower.icons.cut=M({a:"attack",r:"attack_ground",s:"stop",f:"fireatwill"}),f.harbor.icons.cut=M({f:"createFishingBoat",x:"createXebec",h:"createHulk",g:"createGalleon",t:"te_landingtactics"}),e.harbor.icons.cut=M({f:"createFishingBoat",h:"createHulk",x:"createXebec",t:"te_landingtactics"}),h.harbor.icons.cut=M({f:"createFishingBoat",
h:"createHulk",x:"createXebec"}),f.farm.icons.cut=M({c:"createCow",f:"techCropRotation",d:"techDomestication"}),e.farm.icons.cut=M({c:"createCow",f:"techDomestication",d:"techDomestication",p:"techCowPoaching",r:"ridingHorses",h:"techHorseManShip"}),h.farm.icons.cut=M({f:"techDomestication",a:"ridingHorses",i:"irrigation"}),f.storage.icons.cut=M({g:"techGoldMining",s:"techStoneMining"}),e.storage.icons.cut=M({g:"techGoldMining",s:"techStoneMining"}),h.storage.icons.cut=M({g:"techGoldMining",s:"techStoneMining"}),
f.cathedral.icons.cut=M({c:"createCrusaders"}),b.magicgateway.icons.cut=M({o:"createOrk",d:"createDwarf",g:"createGhost",s:"createSkeleton"}));d=[f.knight,h.horsesamurai,e.cavalry,e.enichar,f.crusader,h.chariot,h.horsearcher,e.horsearcher];g=[h.horsesamurai,f.crusader,e.enichar];n=[f.knight,e.cavalry,h.chariot,h.horsearcher,e.horsearcher];l=[f.longbowman,e.archer,h.archer,f.archer];t=[b.catapult,b.ballista,b.heavycatapult];m=[b.galleon,b.hulk,b.pinque,b.fishingboat];q=[b.galleon,b.hulk,b.pinque];
r=[e.satrap,f.maceman];var u=[f.longbowman,e.archer,h.archer,f.archer,h.horsearcher,e.horsearcher,b.pinque,b.watchtower,b.keeptower,b.guardtower],w=[b.stonegolem,b.ork,b.dwarf,b.skeleton,b.ghost,b.dragon,b.jinn,b.bat,f.wizard,e.mage,h.mage],x=[f.peasant,h.peasant,e.peasant,f.footman,e.footman,h.ronin,f.pikeman,e.spearman,e.satrap,f.maceman,e.cavalry,e.jihadwarrior,b.spy,e.enichar,h.horsesamurai,h.monk,h.chariot,h.ninja,b.stonegolem,b.ork,b.dwarf,b.jinn,b.skeleton,b.ghost,f.knight,f.crusader],z=[b.watchtower,
b.keeptower,b.guardtower,b.cannontower],y=[b.cannontower,h.rockettower],D=[f.cathedral,f.castle,b.woodenwall,f.barracks,f.lumbermill,f.magetower,f.warriorsguild,f.storage,f.farm,f.merchantsguild,f.church,f.blacksmith,f.stable,f.workshop,f.tavern,f.house,b.watchtower,f.market,f.outpost,b.bridge,f.harbor,b.guardtower,b.keeptower,b.cannontower,h.rockettower,h.castle,e.castle,h.barracks,e.house,e.lumbermill,e.storage,e.farm,e.harbor,e.blacksmith,e.workshop,e.church,e.tavern,e.market,e.barracks,e.stable,
e.outpost,e.mosque,e.mageguild,e.merchantsguild,e.warriorsguild,e.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],F=[f.cathedral,f.castle,b.woodenwall,f.barracks,f.lumbermill,f.magetower,f.warriorsguild,f.storage,f.farm,f.merchantsguild,f.church,f.blacksmith,f.stable,f.workshop,f.tavern,f.house,b.watchtower,f.market,f.outpost,b.bridge,f.harbor,h.castle,e.castle,
h.barracks,e.house,e.lumbermill,e.storage,e.farm,e.harbor,e.blacksmith,e.workshop,e.church,e.tavern,e.market,e.barracks,e.stable,e.outpost,e.mosque,e.mageguild,e.merchantsguild,e.warriorsguild,e.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],E=[b.catapult,b.heavycatapult],G=[f.pikeman,e.spearman],H=[h.monk,h.priest],J=[b.woodenwall],K=[f.peasant,h.peasant,
e.peasant],O=[f.wizard,e.mage,h.mage],Q=[f.footman,e.footman,h.ronin],R=[f.priest,e.priest,h.priest];Db={bless:{img:k.bless,d:0,mv:1},star:{img:k.star,d:0,mv:1},heal:{img:k.healing,d:0,mv:1},impersonate:{img:k.impersonate,d:0,mv:1},select:{img:k.select,d:0,mv:0,select:1,z32:.8},spawn:{img:k.spawn,d:0,mv:1},curse:{img:k.curse,d:0,mv:1},turnStone:{img:k.turn_to_stone,d:0,mv:1}};var I=function(b,c,e){for(var d=b.length,f=0,g=c.length;f<g;f++)for(var h=0;h<d;h++)sd[b[h].type][c[f].type]=e};I(y,q,4);I(q,
q,3);I(q,F,3);I(q,z,3);I(q,J,5);I(q,t,2);I(E,F,4);I(E,m,4);I(E,z,6);I(E,t,4);I(E,J,9);I([h.samurai],g,.5);I([h.samurai],n,.3);I([h.ronin],K,1);I(G,d,6);I(Q,G,1.5);I(Q,l,1.5);I(Q,[e.jihadwarrior],1);I([e.satrap],K,2);I(r,t,1.5);I(u,[b.dragon],.75);I(u,[b.bat],1);I(u,[f.pikeman],-.75);I(u,r,1);I(u,[h.chariot],-.3);I(u,H,.5);I(O,R,4);I(R,O,3);I(R,w,3);I(x,[b.bat],-.2);I(x,[b.dragon],-.5);I([b.stonegolem],D,1);I([b.dwarf],D,4);I(w,[h.priest],-.5);Za={img:k.gath_point,x32:-10,y32:-10,d:0,mv:!0};yg=[Za];
l=ra;d=Object.keys(l);for(g=0;g<A.length;g++)for(t=A[g],n=0;n<d.length;n++)t[d[n]]=l[d[n]];d=[f.archer,f.longbowman,h.archer,h.horsearcher,e.archer,e.horsearcher];g=[f.footman,f.maceman,f.knight,f.crusader,f.pikeman,e.jihadwarrior,e.cavalry,e.footman,e.enichar,f.peasant,e.peasant,e.satrap,e.spearman,b.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,b.skeleton,b.ghost,b.ork,b.dwarf];n=[f.footman,f.maceman,f.knight,f.crusader,f.pikeman,e.jihadwarrior,e.cavalry,e.footman,e.enichar,
f.peasant,e.peasant,e.satrap,e.spearman,b.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,f.archer,f.longbowman,h.archer,h.horsearcher,e.archer,e.horsearcher,f.wizard,e.mage,h.mage,f.priest,e.priest,h.priest,b.skeleton,b.ghost,b.ork,b.dwarf];B=[{name:["Longbow","Allows the production of longbowmen"],next:[c.createLongbowman],cost:[400,0,0,0],time:45,type:X},{name:["Gold Mining","Increases gold production"],increase:2,value:"gold",cost:[400,0,0,0],time:20,type:db},{name:["Stone Mining",
"Increases stone production"],increase:2,value:"stone",cost:[400,0,0,0],time:20,type:db},{name:["Wood Cutting","Increases wood production"],increase:2,value:"wood",cost:[400,0,0,0],time:20,type:db},{name:["Temper Iron","Increases hand-to-hand units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:g,next:[c.techHalberd],type:Ra},{name:["Scale Armor","Increases unit's defense"],increase:1,value:"defence",cost:[400,0,0,0],time:30,group:n,next:[c.techChainMail],type:Ra},{name:["Halberd",
"Allows the production of spear units"],next:[c.createPikeman,c.createPikeman2],cost:[400,0,0,0],time:30,type:X},{name:["Domestication","Allows the production of cows"],next:[c.createCow],cost:[300,0,0,0],time:20,type:X},{name:["Crop Rotation","Increases the production of fields"],increase:2,value:"food",cost:[400,0,0,0],time:20,type:db,next:[c.irrigation]},{name:["Chain Mail","Increases unit's defense"],increase:2,value:"defence",cost:[400,0,0,0],time:30,group:n,type:Ra},{name:["Plate Armor","Allows the production of knights"],
next:[c.createKnight],cost:[400,0,0,0],time:60,type:X},{name:["Crossbow","Increases arrow units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:d,type:Ra},{name:["Feudalism","Makes peasants cheaper"],cost:[300,0,0,0],time:30,decrease:[h.peasant,[0,0,8,0],f.peasant,[0,0,10,0],e.peasant,[0,0,10,0]],type:mh,next:[c.techSlavery]},{name:["Architecture","Peasants build faster, and allows stone wall, gate and towers"],increase:.5,value:"buildSpeed",cost:[300,0,0,0],time:30,type:db,
next:[c.upgradeStoneTower,c.techGreatWall,c.buildBridge]},{name:["Learning","Allows units to gather experience"],increase:1,value:"experience",cost:[400,0,0,0],time:30,type:db,next:[c.buildAcademy,c.buildAcademy1,c.buildAcademy2]},{name:["Convert Resources",""],cost:[400,0,0,0],time:30},{name:["Map Making","Allows the production of galleons"],cost:[800,0,0,0],time:30,type:X},{name:["Trade Routes","Allows trading"],cost:[400,0,0,0],time:30,type:X,next:[c.techTradeTaxes]},{name:["Trade Taxes","Increases trade profit"],
cost:[400,0,0,0],time:30},{name:["Usury","Allows the obtaining of loans in taverns"],cost:[300,0,0,0],time:30,type:of,changeicon:38,next:[c.techBanking]},{name:["Supply Storage","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:db,value:"popLimit",next:[c.techSeaFood]},{name:["Bribery","Allows the bribing of enemy units"],cost:[600,0,0,0],time:60,type:X,next:[c.bribe]},{name:["Heroism","Allows unlimited experience"],cost:[500,0,0,0],time:30,increase:Infinity,value:"maxLevel",
type:db,next:[c.techLeadership]},{name:["Warfare","Gain experience faster"],cost:[400,0,0,0],time:30,type:db,increase:1,value:"experience",next:[c.techTactics]},{name:["Tactics","Gain experience faster"],cost:[800,0,0,0],time:30,type:X,next:[c.buildDummy,c.techSunTzu]},{name:["Mercenaries","Allows the recruitment of units in taverns"],cost:[600,0,0,0],time:30,type:of,next:[c.techHeroes,c.createMercenaries],actvintv:[c.iniMercenaries]},{name:["Heroes' Quest","Allows the recruitment of heroes in taverns"],
cost:[800,0,0,0],time:30,type:of,next:[c.techFame,c.createHeroes],actvintv:[c.iniHeroes]},{name:["Fame","Recruit better units from taverns"],cost:[500,0,0,0],time:30,value:"fameTech",increase:1,type:db},{name:["Siege Tactics","Allows the production of heavy catapults"],cost:[1200,0,0,0],time:60,type:X,next:[c.createHeavyCatapult]},{name:["Body Building","Increases unit's hit points at every new level"],cost:[800,0,0,0],time:60,value:"healthJump",increase:5,type:db},{name:["Espionage","Allows the production of a spy"],
cost:[400,0,0,0],time:30,type:X,next:[c.createSpy]},{name:["Fanaticism","Increases the building's resistance"],cost:[400,0,0,0],time:30,type:Ra,group:[],increase:5,value:"resistance",next:[c.techCrusade,c.techJihad]},{name:["Crusade","Allows the preaching of a crusade"],cost:[1200,0,0,0],time:180,type:X,next:[c.createCrusaders]},{name:["Inquisition","Increases priest attack"],cost:[400,0,0,0],time:30,type:Ra,group:[f.priest,e.priest,h.priest],increase:5,value:"attack"},{name:["Healing","Allows healing of units"],
cost:[400,0,0,0],time:30,next:[c.techMedicine,c.healing],type:X},{name:["Medicine","Allows remote healing of units"],cost:[500,0,0,0],time:30,value:"healingRange",increase:5,type:db},{name:["Bless","Temporarily increases unit attack skill"],cost:[400,0,0,0],time:30,type:X,next:[c.bless]},{name:["Invisibility","Invisibility spell"],cost:[500,0,0,0],time:30,type:X,next:[c.invisibility]},{name:["Bat","Researches bat summoning"],cost:[400,0,0,0],time:240,type:X,next:[c.createBat]},{name:["Freeze","Freeze spell"],
cost:[800,0,0,0],time:30,type:X,next:[c.freeze]},{name:["Lightning","Lightning spell"],cost:[400,0,0,0],time:30,type:X,next:[c.lightning]},{name:["Stone Golem","Researches stone golem summoning"],cost:[800,0,0,0],time:120,type:X,next:[c.createGolem]},{name:"Upgrade to Guard Tower",cost:[0,600,0,0],time:20,type:$d,obj:44,upgrade:1},{name:"Upgrade to Stone Tower",cost:[0,0,0,500],time:30,type:$d,obj:55,upgrade:1},{name:"Upgrade to Cannon Tower",cost:[0,0,0,500],time:30,type:$d,obj:56,upgrade:1},{name:["Buddhism"],
cost:[400,0,0,0],time:30,type:X,next:[c.buildCathedral1]},{name:["Cannon Tower","Allows the building of cannon towers"],next:[c.upgradeCannonTower],cost:[400,0,0,0],time:30,type:X},{name:["Engineering","Increases siege weapon's attack"],increase:5,value:"attack",cost:[400,0,0,0],time:30,group:[b.ballista,b.catapult,b.heavycatapult],type:Ra},{name:["Great Wall","Makes stone walls, towers and gates stronger"],cost:[600,0,0,0],time:30,type:X},{name:["Art of Riding","Allows the production of horse archers"],
cost:[500,0,0,0],time:30,type:X,next:[c.createHorseArcher1,c.createHorseArcher2,c.techHorseManShip]},{name:["Irrigation","Increases field production"],increase:4,value:"food",cost:[400,0,0,0],time:30,type:db},{name:["Armored Chariot","Allows the production of armored chariots"],cost:[500,0,0,0],time:60,type:X,next:[c.createChariot]},{name:["Meditation","Makes monks cheaper"],cost:[300,0,0,0],time:30,decrease:[0,0,50,0],type:pf,next:[c.techPhilosophy],group:[h.monk]},{name:["Kung-Fu","Increases the attack of all kung-fu units"],
cost:[400,0,0,0],time:30,type:Ra,increase:1,value:"attack",group:[h.peasant,h.ninja,h.monk,h.priest],next:[c.techMastery,c.techNinjas,c.techTournaments]},{name:["Tournaments","Allows sharing of experience between kung-fu units"],cost:[800,0,0,0],time:30,type:X,next:[]},{name:["Philosophy","Allows the production of more experienced monks"],cost:[400,0,0,0],time:30,type:Ra,increase:2,value:"level",group:[h.monk,h.priest],next:[c.createPriest1]},{name:["Ninjas","Allows the production of ninjas"],cost:[500,
0,0,0],time:30,type:X,next:[c.createNinja]},{name:["Mastery","Allows priests to teach kung-fu units"],cost:[500,0,0,0],time:30,type:X,next:[c.teach]},{name:["Concentration","Allows faster manna restoration"],cost:[600,0,0,0],time:80,type:X,next:[c.techConfusion]},{name:["Confusion","Researches the Confusion spell"],cost:[400,0,0,0],time:30,type:X,next:[c.confusion]},{name:["Whirlpool","Researches the Whirlpool spell"],cost:[300,0,0,0],time:30,type:X,next:[c.whirlpool]},{name:["Dragon","Researches Dragon summoning"],
cost:[800,0,0,0],time:300,type:X,next:[c.createDragon]},{name:["Turn to Stone","Researches the Turn to Stone spell"],cost:[300,0,0,0],time:30,type:X,next:[c.turnToStone]},{name:["Flame Bolt","Researches the Flame Bolt spell"],cost:[400,0,0,0],time:30,type:X,next:[c.techDragon,c.flameBolt]},{name:["Jewelry","Allows trading of items"],cost:[400,0,0,0],time:30,type:X,next:[c.sellItems,c.buyItems]},{name:["Banking","Increases trade profit"],cost:[600,0,0,0],time:30,type:X},{name:["Chemistry","Increases arrow units' attack power"],
cost:[500,0,0,0],time:30,type:Ra,group:d,increase:1,value:"attack",next:[c.techGunPowder]},{name:["Sea Food","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:db,value:"popLimit"},{name:["Gun Powder","Increases cannon tower's attack power"],cost:[500,0,0,0],time:30,type:Ra,increase:10,value:"attack",group:[b.cannontower],next:[c.techRocketArrow]},{name:["Rocket Arrow","Allows the building of rocket tower"],cost:[800,0,0,0],time:30,type:X,next:[c.buildRocketTower]},{name:["Bushido",
"Allows the production of horse samurai"],cost:[800,0,0,0],time:120,type:X,next:[c.createHorseSamurai]},{name:["Leadership","Units around a hero gain experience"],cost:[600,0,0,0],time:30,type:X,next:[c.techHonor]},{name:["Honor","Hero vs. hero attack bonus"],cost:[500,0,0,0],time:30,type:X},{name:["Sun Tzu's Book","Increases the speed of learning"],cost:[800,0,0,0],time:30,type:db,increase:1,value:"experience"},{name:["Cow Poaching","Allows peasants to steal cows"],cost:[200,0,0,0],time:30,type:db,
increase:1,value:"stealCows"},{name:["Horsemanship","Makes mounted units cheaper"],cost:[500,0,0,0],time:30,type:pf,mulp:.75,group:[h.horsearcher,e.cavalry,e.horsearcher]},{name:["Scimitar","Increases sword attack power and allows the production of satraps"],cost:[400,0,0,0],time:30,type:Ra,increase:1,value:"attack",group:g,next:[c.createSatrap]},{name:["Jihad","Allows the production of Jihad Warriors"],cost:[1200,0,0,0],time:30,type:X,next:[c.createJihad,c.convertJihad]},{name:["Magic Carpet","Researches Magic Carpet summoning"],
cost:[300,0,0,0],time:30,type:X,next:[c.createCarpet,c.techJinn]},{name:["Magic Workshop","Allows the building of a magic workshop"],cost:[1200,0,0,0],time:180,type:X,next:[c.buildMagicWorkshop]},{name:["Rain of Fire",""],cost:[800,0,0,0],time:60,type:X,next:[c.fireRain]},{name:["Magic Vision","Researches the Magic Vision spell"],cost:[400,0,0,0],time:30,type:X,next:[c.magicVision]},{name:["Necromancy","Researches the Raise the Dead spell"],cost:[400,0,0,0],time:30,type:X,next:[c.raiseDead]},{name:["Jinn",
"Researches Jinn summoning"],cost:[600,0,0,0],time:300,type:X,next:[c.createJinn]},{name:["Ore Enrichment","Increases mine production"],cost:[800,0,0,0],time:30,type:db,increase:1,value:"miningPerf"},{name:["Riding Horses","Increases the mounted units' attack and defense power"],cost:[500,0,0,0],time:30,type:gj,values:["attack",2,"defence",1],group:[h.horsearcher,e.cavalry,e.horsearcher],next:[c.techJanissary]},{name:["Janissary","Allows the production of Janissaries"],cost:[1200,0,0,0],time:120,
type:X,next:[c.createEnichar]},{name:["Slavery","Makes peasants cheaper"],cost:[200,0,0,0],time:30,decrease:[h.peasant,[0,0,7,0],f.peasant,[0,0,8,0],e.peasant,[0,0,8,0]],type:mh}];Gi();c.buildMarket.disabled=1;ik();n=0;for(m=A.length;n<m;n++)if(l=A[n],l.onbuild)for(f=l.onbuild,g=0,h=f.length;g<h;g++)e=f[g],e.obj.race==l.race&&(e.disabled=1,e.require=l.name,e.requireObj||(e.requireObj=[]),e.requireObj.put(l));g=0;for(h=B.length;g<h;g++)if(e=B[g],e.tech=1,e.id=g,e.next)for(f=e.next,t=0,n=f.length;t<
n;t++)l=f[t],l.disabled?(l.disabled++,l.require+=", "+e.name[0],l.requireObj.put(e)):(l.requireObj=[e],l.disabled=1,l.require=e.name[0]);g=0;f=A;for(h=f.length;g<h;gl(f[g++]));}new Nb("",[255,255,255],[0],!0)},A,sd,Th,Za,yg,Td,Uh=8,z=new Float32Array(16),Tc=function(c,b,d,f,g,h,l){var e=A[c];if(e.ignore)return e.invalid=!0,!1;if(h=h&&!e.instantBuild)this.built=!1;var m=E[b],k=m.mod[c],v=Object.keys(k);this.__proto__=e;this.kingdom=b;this.d=g;this.x32=d;this.y32=f;this.taskList=[];g=0;for(var r=v.length;g<
r;this[v[g]]=k[v[g++]]);if(l)for(k=Object.keys(l),g=0,r=k.length;g<r;this[k[g]]=l[k[g++]]);0<e.invMax&&(this.inventory=[]);e.build||(this.mv=1);l=m.technology.disabled;k=e.actvintv;this.workers=[];this.id=r=y.length;e.rndDirection&&(this.d=r*d%e.rndDirection);this.build||m.values.pop++;d=e.validator(d,f,e.space,b);if(d[1]||h){f=e.validator.dimension;v=d[0];if(h){f=Ma;this.onbuild1=v;var u=Cb[b];g=0;for(e=v.length;g<e;g++)u[v[g]]=r}else for(g=0,e=v.length;g<e;f[v[g++]]=r);if(d[2])if(v=d[2],h){P(v);
g=0;for(e=v.length;g<e;f[v[g++]]=r);this.onbuildValid=v}else for(g=0,e=v.length;g<e;f[v[g++]]=0);}else return this.invalid=!0,!1;y[r]=this;h||hb[b][c].put(r);if(this.update&&!q.custom)for(c=this.update,g=0,r=c.length;g<r;g+=3)Xa({func:ef,data:[this.id,c[g],c[g+1],c[g+2]]},c[g+2],1);if(k)for(c=0,e=k.length;c<e;c++)b=k[c],l[b.id]||b(this);h?($a(this),w.kingdom==this.kingdom?Ad(this,ml):Ad(this,fh)):$a(this);this.level&&!this.potion&&bj(this);!this.standardFunc||this.func||q.editor||this.standardFunc(this);
Qi(this);h=m.stats;h.unitCount[this.type]++;m=h.unitCount[this.type]-h.unitCountDeath[this.type];m>h.unitCountMax[this.type]&&(h.unitCountMax[this.type]=m)},mj=function(c){var b=E[c.kingdom];if(c.population){var e=c.population;b.values.popMax+=e;Zd(c.kingdom);for(var f=0;f<e;f++)b.checkPopArray()}if(c.onbuild)for(c=c.onbuild,e=b.technology,b=e.disabled,e=e.actived,f=0;f<c.length;f++){var g=c[f].id;e[g]||(e[g]=0);e[g]++;e[g]-1||(b[g]--,!b[g]&&ja.actv[g]&&ja(I.active))}},Fb=[],V=new Float32Array(12),
Vh=function(c,b,d){var e=c.length;c[e]=b;c[e+1]=b+1;c[e+2]=b+2;c[e+3]=b+1;c[e+4]=b+2;c[e+5]=b+3;c.changed=!0;d.typeBuffer=c;d.elemtId=e},Ad=function(c,b){var e=b[3];if(b.noAlpha)f=ia;else{c.alpha=!0;var f=ta}if(c.typeBuffer!==f){if(b==fh){if(yb.diplomacy[c.kingdom]){Eb(c);return}b=new Float32Array(Vb(Ia[3*c.kingdom],Ia[3*c.kingdom+1],Ia[3*c.kingdom+2],e+1))}Eb(c);Vh(f,c.bufferID,c)}m.bindBuffer(m.ARRAY_BUFFER,ub);m.bufferSubData(m.ARRAY_BUFFER,16*c.bufferID,b)},rc=function(c){var b=eg(c,c.kingdom),
e=b[0],f=b[1],g=b[2];b=b[3];var h=c.bufferID;jk(e,f,g,b,c.bufferID);1>b?(c.alpha=!0,e=ta):e=ia;c.typeBuffer!==e&&(Eb(c),Vh(e,h,c));if(c.child&&(!1!==c.built||!c.build))for(var l=c.child,m=0,k=l.length;m<k;m++)h+=4,b=eg(l[m],c.kingdom),e=b[0],f=b[1],g=b[2],b=b[3],jk(e,f,g,b,h)},eg=function(c,b){if(null!=c.rgb){var e=c.rgb;c=e[0];var f=e[1];b=e[2];e=e[3]}else wa[c.img][3]?(c=Ia[3*b],f=Ia[3*b+1],b=Ia[3*b+2],e=2):(c.mMapcolor?(b=c.mMapcolor,c=b[0]/255,f=b[1]/255,b=b[2]/255):(c=Ia[3*b],f=Ia[3*b+1],b=Ia[3*
b+2]),e=1);return[c,f,b,e]},kk=function(){if(Fb.length){var c=Fb[Fb.length-1];Fb.length--}else c=Uh,Uh+=4;return c},$a=function(c,b,d,f){void 0==b&&(f=d=b=0);var e=wa[c.img],h=1;if(c.bufferID){var l=c.bufferID;h=0}else l=kk();c.bufferID=l;e||P(c);var k=e[2]*c.d*6+4,t=e[4+k],n=e[5+k];k=e[0];var v=e[1];0<=v&&(v*=.001);var r=e.id+4*c.d*e[2],u=-1;c.mv&&(u=q.now());z[0]=r;z[1]=u;z[2]=k;z[3]=v;z[4]=r+1;z[5]=u;z[6]=k;z[7]=v;z[8]=r+2;z[9]=u;z[10]=k;z[11]=v;z[12]=r+3;z[13]=u;z[14]=k;z[15]=v;var w=32*c.x32,
x=32*c.y32;k=32*c.y32;null!=c&&null!=c.z32&&(k*=c.z32);var y=ia;m.bindBuffer(m.ARRAY_BUFFER,kd);m.bufferSubData(m.ARRAY_BUFFER,16*l,z);m.bindBuffer(m.ARRAY_BUFFER,xc);if(c.rotation){var A=c.rotation;A*=2*Math.PI;var B=.5*e[8];v=.5*e[9];e=-1*k;r=-B;u=-v;var D=0*V.length;V[D]=r*Math.cos(A)-v*Math.sin(A)+w;V[D+1]=v*Math.cos(A)+r*Math.sin(A)+x;V[D+2]=e;V[D+3]=r*Math.cos(A)-u*Math.sin(A)+w;V[D+4]=u*Math.cos(A)+r*Math.sin(A)+x;V[D+5]=e;V[D+6]=B*Math.cos(A)-v*Math.sin(A)+w;V[D+7]=v*Math.cos(A)+B*Math.sin(A)+
x;V[D+8]=e;V[D+9]=B*Math.cos(A)-u*Math.sin(A)+w;V[D+10]=u*Math.cos(A)+B*Math.sin(A)+x;V[D+11]=e}else c.wh?(A=c.wh[0],B=c.wh[1],A-=t,B-=n,V[0]=w,V[1]=x,V[2]=k,V[3]=w+A,V[4]=x,V[5]=k,V[6]=w,V[7]=x+B,V[8]=k,V[9]=w+A,V[10]=x+B):(V[0]=w,V[1]=x,V[2]=k,V[3]=w,V[4]=x,V[5]=k,V[6]=w,V[7]=x,V[8]=k,V[9]=w,V[10]=x),V[11]=k;m.bufferSubData(m.ARRAY_BUFFER,12*l,V);u=eg(c,c.kingdom);e=u[0];v=u[1];r=u[2];u=u[3];if(1>u||c.alpha)c.alpha=!0,y=ta;m.bindBuffer(m.ARRAY_BUFFER,ub);z[0]=e;z[1]=v;z[2]=r;z[3]=u;z[4]=e;z[5]=
v;z[6]=r;z[7]=u;z[8]=e;z[9]=v;z[10]=r;z[11]=u;z[12]=e;z[13]=v;z[14]=r;z[15]=u;m.bufferSubData(m.ARRAY_BUFFER,16*l,z);m.bindBuffer(m.ARRAY_BUFFER,Jd);A=q.now();z[0]=b;z[1]=d;z[2]=f;z[3]=A;z[4]=b;z[5]=d;z[6]=f;z[7]=A;z[8]=b;z[9]=d;z[10]=f;z[11]=A;z[12]=b;z[13]=d;z[14]=f;z[15]=A;m.bufferSubData(m.ARRAY_BUFFER,16*l,z);h&&Vh(y,l,c);if(c.child&&!1!==c.built)for(b=k,d=c.child.length,f=[],c.childLoc=f,h=0;h<d;h++){y=c.child[h];e=wa[y.img];k=e[2]*c.d*6+4;A=e[4+k];B=e[5+k];k=e[0];v=e[1];0<=v&&(v*=.001);r=e.id+
4*c.d;u=-1;y.mv&&(u=1);z[0]=r;z[1]=u;z[2]=k;z[3]=v;z[4]=r+1;z[5]=u;z[6]=k;z[7]=v;z[8]=r+2;z[9]=u;z[10]=k;z[11]=v;z[12]=r+3;z[13]=u;z[14]=k;z[15]=v;u=eg(y,c.kingdom);e=u[0];v=u[1];r=u[2];u=u[3];D=w;var E=x;y.wh1&&(A=y.wh[0],B=y.wh[1]);y.center&&(D-=.5*~~(A-t),E-=.5*~~(B-n));l=kk();m.bindBuffer(m.ARRAY_BUFFER,kd);m.bufferSubData(m.ARRAY_BUFFER,16*l,z);m.bindBuffer(m.ARRAY_BUFFER,ub);z[0]=e;z[1]=v;z[2]=r;z[3]=u;z[4]=e;z[5]=v;z[6]=r;z[7]=u;z[8]=e;z[9]=v;z[10]=r;z[11]=u;z[12]=e;z[13]=v;z[14]=r;z[15]=u;
m.bufferSubData(m.ARRAY_BUFFER,16*l,z);k=y.z?32*y.z+b:b;m.bindBuffer(m.ARRAY_BUFFER,xc);V[0]=D;V[1]=E;V[2]=k;V[3]=D;V[4]=E;V[5]=k;V[6]=D;V[7]=E;V[8]=k;V[9]=D;V[10]=E;V[11]=k;m.bufferSubData(m.ARRAY_BUFFER,12*l,V);m.bindBuffer(m.ARRAY_BUFFER,Jd);z[0]=0;z[1]=0;z[2]=0;z[3]=0;z[4]=0;z[5]=0;z[6]=0;z[7]=0;z[8]=0;z[9]=0;z[10]=0;z[11]=0;z[12]=0;z[13]=0;z[14]=0;z[15]=0;m.bufferSubData(m.ARRAY_BUFFER,16*l,z);k=1>u?ta:y.light?ka:ia;f.put(k);A=k.length;f.put(A);k[A]=l;k[A+1]=l+1;k[A+2]=l+2;k[A+3]=l+1;k[A+4]=
l+2;k[A+5]=l+3;k.changed=!0}},Ec=function(c,b,d,f){var e=q.now(),h=c.bufferID;z[0]=b;z[1]=d;z[2]=f;z[3]=e;z[4]=b;z[5]=d;z[6]=f;z[7]=e;z[8]=b;z[9]=d;z[10]=f;z[11]=e;z[12]=b;z[13]=d;z[14]=f;z[15]=e;m.bindBuffer(m.ARRAY_BUFFER,Jd);m.bufferSubData(m.ARRAY_BUFFER,16*h,z);m.bindBuffer(m.ARRAY_BUFFER,null);if(c.tempChild)for(e=0,c=c.tempChild,h=c.length;e<h;Ec(c[e++],b,d,f));},Rh=function(c,b,d,f,g,h){Ab[0]=c;Ab[1]=b;Ab[2]=d;Ab[3]=c+f;Ab[4]=b;Ab[5]=d;Ab[6]=c;Ab[7]=b+g;Ab[8]=d;Ab[9]=c+f;Ab[10]=b+g;Ab[11]=
d;m.bindBuffer(m.ARRAY_BUFFER,xc);m.bufferSubData(m.ARRAY_BUFFER,12*h,Ab);m.bindBuffer(m.ARRAY_BUFFER,null)},jk=function(c,b,d,f,g){z[0]=c;z[1]=b;z[2]=d;z[3]=f;z[4]=c;z[5]=b;z[6]=d;z[7]=f;z[8]=c;z[9]=b;z[10]=d;z[11]=f;z[12]=c;z[13]=b;z[14]=d;z[15]=f;m.bindBuffer(m.ARRAY_BUFFER,ub);m.bufferSubData(m.ARRAY_BUFFER,16*g,z);m.bindBuffer(m.ARRAY_BUFFER,null)},sb=function(c,b,d){void 0==d&&(d=32);c.z32&&(b*=c.z32);var e=c.x32*d;d*=c.y32;c.wh?Rh(e,d,b,c.wh[0]-wa[c.img][8],c.wh[1]-wa[c.img][9],c.bufferID):
Rh(e,d,b,0,0,c.bufferID);if(c.tempChild)for(b=c.tempChild,e=0,d=b.length;e<d;e++){var g=b[e];g.x32=c.x32;g.y32=c.y32;sb(g,32*c.y32)}},ra={getRadix:function(){return ib[this.zLevel]},checkMana:function(c,b,d,f){if(!this.mana)return!1;if(0>this.mana-c)return this.manaTask=[d.url,b,c],this.stay55(),c>this.manaMax&&f&&(this.blockedCost=f,b=this.setupChild(Db.curse,1),this.blocked=2,this.blockedimg=b,this.manaTarget=c,m.bindBuffer(m.ARRAY_BUFFER,ub),m.bufferSubData(m.ARRAY_BUFFER,16*this.bufferID,hf),
m.bufferSubData(m.ARRAY_BUFFER,16*b.bufferID,hf)),!1;this.mana-=c;return!0}},sc=function(c,b){return q.editor?!0:c.freezed||c.confused?!1:E[c.spy||c.kingdom].control[b.spy||b.kingdom]};ra.changeKingdom=function(c){hb[this.kingdom][this.type].quit(this.id);tc[this.id]&&(tc[this.id]=0,G.quit(this.id),0==G.length&&(ja([]),xe(),Ub=-1),Lh(this.id));this.kingdom=c;rc(this);this.childBuild&&(this.childBuild=0);if(!this.build||this.arrow)q.editor||this.stay();hb[c][this.type].put(this.id)};ra.aspettare=function(){this.nodes=
void 0;this.getRadix()[this.x32+this.y32*F]=this.id;this.waiting=!0;Z(this,this.url.idle);Ec(this,0,0,0);Pb(this,~~(32E3/this.spd))};ra.addItem=function(c){var b=this.inventory;b&&(b[b.length]=c.id,c.in=this.id,c.sword||c.shield)&&(c.attack&&(this.attack+=c.attack),c.defence&&(this.defence+=c.defence))};ra.showInventory=function(){Nh();for(var c=this.inventory,b=0;8>b;b++){var d=c[b];if(!d)break;var f=za[b];f.style.backgroundPosition="0px "+48*d.iconID+"px";f.className="";Zf[b]=null}};ra.deleteItem=
function(c){this.inventory.quit(c.id);this.attack-=c.attack;this.defence-=c.defence};ra.useItem=function(c){48==c.type&&(this.health+=c.lives,this.health>this.maxHealth&&(this.maxHealth=this.health),this.inventory.quit(c.id))};ra.onattack=function(c){!this.attack||this.freezed||this.death||this.func!=Hd.url&&this.func||nc(c.id,[this.id],1)};ra.setupINTV=function(c,b,d,f){this.funcObj=b;c.url||P(c,c.url);mi(this);this.changeFunc(c.url,f);this.deleteWorker();Pb(this,d);return d};ra.damage=function(c,
b){if(!(this.zolotoy||this.death||this.stoned)){this.defence&&(c-=this.defence);1>c&&(c=1);this.health-=c;b=E[b.kingdom].stats;b.dmgInflicted+=c;var e=E[this.kingdom].stats;e.dmgTaken+=c;1>this.health?(this.build?(e.buildsLosed++,b.buildsKilled++):(e.unitsLosed++,b.unitsKilled++),this.die()):Y(this.id,1)}};var Y=function(c,b){if(tc[c]||!1===c)return c=G.length,1===c?(c=y[G[0]],I.stockActive==c&&c.inventory.length?(Xc(c.id,1,1),Pj(c,1)):c.build?Oa(c,1):Xc(c.id,b)):1<c?Mh(G,b):bk(Ya),!0};ra.setupSpellIMG=
function(c){this.invisible&&zd(this.id);this.url.spell?(Z(this,this.url.spell,1),c||Xa({func:lk,data:this.id},rb(this.img),1)):this.stay()};var lk=function(c){c=y[c];c.death||c.stay()};ra.setupChild=function(c,b,d){var e={x32:this.x32,y32:this.y32,d:c.d,img:c.img,mv:c.mv,parent:this.id,z32:c.z32};if((this.dix||this.diy)&&!this.waiting){var g=.001*(q.now()-this.timestamp);e.x32+=this.dix*g/32-Math.sign(this.dix);e.y32+=this.diy*g/32-Math.sign(this.diy)}if(c.select){if(this.space)c=this.space[this.space.length-
1],h=(this.space.length-1)/c;else{c=this.sSizex||1;var h=this.sSizey||1}this.z32&&(e.z32=this.z32);e.wh=[32*c-3,32*h-3];this.selectAnim=e}$a(e);g&&Ec(e,this.dix,this.diy,0);d&&(m.bindBuffer(m.ARRAY_BUFFER,ub),m.bufferSubData(m.ARRAY_BUFFER,16*e.bufferID,d));this.tempChild||(this.tempChild=[]);this.tempChild.put(e);b||Zb.new(e,rb(e.img),mk);return e};var mk=function(c){y[c.parent].tempChild.quit(c);Eb(c)};ra.distance=0;var Z=function(c,b,d,f){c.img=b;b=wa[b];var e=b[0],h=b[1];0<=h&&(h*=.001);f&&(h*=
f);b=b.id+4*c.d*b[2];f=-1;1===d?f=q.now():0>d&&(f=1);d=f;c=c.bufferID;z[0]=b;z[1]=d;z[2]=e;z[3]=h;z[4]=b+1;z[5]=d;z[6]=e;z[7]=h;z[8]=b+2;z[9]=d;z[10]=e;z[11]=h;z[12]=b+3;z[13]=d;z[14]=e;z[15]=h;m.bindBuffer(m.ARRAY_BUFFER,kd);m.bufferSubData(m.ARRAY_BUFFER,16*c,z);m.bindBuffer(m.ARRAY_BUFFER,null)};ra.setupDir=function(c,b,d){c=Math.sign(c);b=Math.sign(b);c=3*(b-1)+(c+1);2==c?this.d=1:-6==c?this.d=5:0==c?this.d=7:-4==c?this.d=3:-1==c?this.d=2:1==c?this.d=0:-5==c?this.d=4:-3==c&&(this.d=6);d&&(this.d=
(this.d+d)%8)};ra.setupDirBuild=function(c){var b=O;1==c.health&&0==c.built&&(b=Cb[c.kingdom]);c=c.id;var e=F,f=this.x32+this.y32*e;b[f+e]==c?this.d=0:b[f-e]==c?this.d=4:b[f+1]==c?this.d=2:b[f-1]==c?this.d=6:b[f+e+1]==c?this.d=1:b[f-e+1]==c?this.d=3:b[f+e-1]==c?this.d=7:b[f-e-1]==c&&(this.d=5)};ra.spdMod=0;var sh=function(c,b){for(var e=b.length,f=0;f<e;f++){var g=y[b[f]];g.build||(g.spd=c)}};ra.changeFunc=function(c,b){var e=this.func;this.func=c;if(Nd){if(void 0!==this.workingOn)var f=y[this.workingOn];
(e=Wb[e])&&e.rule&&Zg(-1,this,e.rule,f);(c=Wb[c])&&c.rule&&Zg(1,this,c.rule,b)}};ra.stay=function(c){this.mv=1;this.time=void 0;this.diy=this.dix=0;this.nodes=this.c=void 0;this.xf=null;Ec(this,0,0,0);c||(this.changeFunc(void 0),this.stock&&0!==this.stock[0]?Z(this,this.img,NaN):Z(this,this.__proto__.img,1),this.buildList&&(this.buildList=void 0),this.deleteWorker(),this.standardFunc&&2!==this.stop&&void 0==this.spy&&this.standardFunc(this))};ra.stay55=function(){this.changeFunc(void 0);this.stock&&
0!==this.stock[0]?Z(this,this.img,NaN):Z(this,this.__proto__.img,1);this.deleteWorker();this.standardFunc&&2!==this.stop&&void 0==this.spy&&this.standardFunc(this)};var Tl=[],Eb=function(c){c.elemtId&&(nk(c.elemtId,c.typeBuffer),c.elemtId=void 0,c.typeBuffer=void 0)},fj=function(c){if(c.childLoc){c=c.childLoc;for(var b=0,e=c.length;b<e;b+=2)nk(c[b+1],c[b])}},nk=function(c,b){b[c]=NaN;b[c+1]=NaN;b[c+2]=NaN;b[c+3]=NaN;b[c+4]=NaN;b[c+5]=NaN;b.changed=!0;Tl.put(c)};ra.addWorker=function(c){this.workers.put(c.id);
c.workingOn=this.id};ra.deleteWorker=function(){this.workingOn&&(y[this.workingOn].workers.quit(this.id),this.workingOn=0);this.actionItem&&(this.actionItem=void 0);this.blockedAction()};ra.blockedAction=function(c){var b=this.blocked;if(ok[b])ok[b](this,c)};var ok={2:function(c,b){c.blocked=void 0;rc(c);mk(c.blockedimg);c.blockedimg=void 0;c.manaTarget=void 0;b||(E[c.kingdom].setupResources(c.blockedCost,-1),c.blockedCost=void 0)}},Hj=function(c){return k.delay[-c[1]+c[0]-1]},de=function(c){var b=
G.length;G.quit(c);if(b!=G.length){var e=y[c];e.selectAnim=void 0;b=0;for(e=e.tempChild;b<e.length;b++){var f=e[b];Eb(f);var g=e.length;e.quit(f);g!=e.length&&b--}tc[c]=void 0;0==G.length?xe():1==G.length?Xc(c):Mh(G)}Ya&&Ya.id===c&&(xe(),Ya.selectAnim&&(Eb(Ya.selectAnim),Ya.selectAnim=void 0),Ya=void 0)};ra.base=function(c){return ib[this.zLevel][c]};ra.rbase=function(){return ib[this.zLevel]};var Qf,Kh=function(c){Fb.put(c.bufferID);if(c.child){var b=0;c=c.childLoc;for(var e=c.length;b<e;b+=2)Fb.put(c[b][c[b+
1]])}};ra.die=function(c){if(!this.death){var b=F,e=this.id,f=this.kingdom,g=E[f];this.waitlist&&(g.unitLoading-=.5*this.waitlist.length);if(this.dieSound&&!q.editor){var h=this.dieSound;qa(h[~~(h.length*Math.random())],this.x32,this.y32)}de(this.id);(this.freezed||this.invisible)&&rc(this);var l=this.x32,m=this.y32;this.death=1;1==this.zLevel&&(Qf[l+m*b]=1);this.c=void 0;var t=this.url.die||this.dimg;void 0!=g.IAD&&Qa.arr[g.IAD].valorateLost(this);if(this.food&&!q.editor){var n=100,v=this.food/n,
r=~~v,u=~~((v-r)*n);for(h=0;h<v;h++){h==r&&u&&(n=u);var w=kj(l,m),x=~~(w/b);w%=b;w=new Tc(52,f,w,x,0);Z(w,k.item_meat);w.contain=[n,2,pl]}}g.stats.unitCountDeath[this.type]++;h=this.x32;b=this.y32;c||q.editor?(Eb(this),Kh(this)):t?(this.mv=!0,Z(this,t,1),c=wa[this.img],t=c[1],t=0>t?Hj(c):1E3*c[0]/t,Xa({func:Gj,data:this.id},t-25,1),Ec(this,0,0,0),void 0!==this.dix&&(c=.001*(q.now()-this.timestamp),this.x32+=this.dix*c/32-Math.sign(this.dix),this.y32+=this.diy*c/32-Math.sign(this.diy))):this.dimgInfinity?
(this.dimgRND&&(this.d=this.id%this.dimgRND),Z(this,this.dimgInfinity)):(Eb(this),Kh(this));fj(this);this.techStart&&nf(0,[this.id]);sb(this,32*this.y32-36);this.x32=h;this.y32=b;this.build||g.values.pop--;this.population&&this.built&&(g.values.popMax-=this.population);m=this.validator(l,m,this.space,this.kingdom);c=m[0];if(this.onbuild&&!q.editor)for(l=this.onbuild,t=g.technology,h=t.disabled,t=t.actived,b=0;b<l.length;b++)f=l[b].id,t[f]--,0===t[f]&&h[f]++;l=this.validator.dimension;h=0;for(t=c.length;h<
t;h++)b=c[h],l[b]=ic[b]?ic[b]:0;if(1==this.health&&!this.built)for(b=Cb[this.kingdom],h=0,t=c.length;h<t;b[c[h++]]=void 0);if(m[2])for(c=m[2],h=0,t=c.length;h<t;h++)b=c[h],ic[b]?(2<l[b]&&y[l[b]].die(1),l[b]=ic[b]):(2<l[b]&&y[l[b]].die(),l[b]=0);hb[this.kingdom][this.type].quit(this.id);mi(this);if(this.workers){h=0;l=this.workers.slice(0);for(t=l.length;h<t;h++)m=y[l[h]],m.workingOn===e&&(m.workingOn=0,m.func!==ph.url&&m.stay());this.workers.length=0}this.deleteFromList&&(l=this.deleteFromList,l.quit(this),
l.length||l.length0function(this));this.time=void 0;this.changeFunc(void 0);this.diy=this.dix=0;this.inventory&&0<this.inventory.length&&xd(this.id,this.inventory.slice(0));this.stock&&ij(this);q.editor||(g.check(),Zd(this.kingdom),g.checkPopArray());this.deleteWorker()}};Array.prototype.quit=function(c){c=this.indexOf(c);return-1<c?(this.splice(c,1),!0):!1};Array.prototype.add=function(c){0>this.indexOf(c)&&(this[this.length]=c)};var bb=["European","Arab","Asian"],aj={euro:"Lancelot Arthur Guivain Merlin Blackthorn Morin Golstuck Karambol Kelerick Rockmore Bridport Casevil Stirm Tonis Pelegrim Peresohn Pirk Pharn Gork".split(" "),
arab:"Ibn Fadlan;Mohammad;Al Ferissa;Harun Al Rashid;Sindbad;Mellemad;Moarrac;Sakhavan;Bellefars;Mokhac;Norahz;Kerhetin;Maham;Dushesh;Direkh".split(";"),asia:"Ishida Toranaga Ichinzen Haiako Mozuki Hitachi Tosheba Harachiko Marasuma Korodzum Ishinghen Genghis Musa Echibo Ichikahr Yotokan Maraga".split(" "),common:"Fistantilus Skenderbeg Raislin Tenis Morok Sokob Baras Haram Billihz Ynte Orgh Savael Birgos Savator Gandeh Gordor Fessh Gilmi Phergas".split(" ")},Lg=[x.gold,x.wood,x.food,x.stone,x.mana],
Dh=function(c,b,d){d&&(c=c.replace("%d",d));return c.replace("%s",b)},Dd={},Wh,uc,fc={},Bg=function(){for(var c="mapx mapwidth goldRes goldValue woodRes woodValue foodRes foodValue stoneRes stoneValue infinity infiniteValue".split(" "),b=0,d=c.length;b<d;b+=2){var f=document.getElementById(c[b+1]).value;"infinity"==c[b]?(f=document.getElementById(c[b+1]).checked,q[c[b]]=f):q[c[b]]=parseInt(f)}q.infinity&&(q.goldRes=Infinity,q.foodRes=Infinity,q.woodRes=Infinity,q.stoneRes=Infinity);q.infinity=void 0;
q.goldRes||(q.goldRes=Infinity);q.foodRes||(q.foodRes=Infinity);q.woodRes||(q.woodRes=Infinity);q.stoneRes||(q.stoneRes=Infinity);q.mapy=q.mapx;q.gravity=parseFloat(document.getElementById("mapgravity").value)*(580.9/9.8);q.name="";q.arje=555555*Math.random()+1},Xk=function(){q.online&&(pk(x.initializing),q.editor=0);q.mapx||Bg();q.pausedTime=0;q.canceled=0;for(var e=Object.keys(c),b=E.length,d=0,f=e.length;d<f;d++){var g=c[e[d]];g.id=d;if(g.disabled)for(var h=0;h<b;E[h++].technology.disabled[d]=
g.disabled);if(g.hidden)for(h=0;h<b;E[h++].technology.hidden[d]=1);}var l=performance.now();dd=document.getElementById("msgs1");q.online||(location.hash="");oa("playermenu");oa("index");Ta("menu");Ta("statButton");oa("mapeditorinfo");oa("mapeditorinfotop");Ta("resources");yb=E[w.kingdom];vf(w.kingdom);Wh||(Wh=JSON.parse(JSON.stringify(E.slice(1))));setTimeout(function(){q.cycle?q.deltaTime=25*q.cycle:(q.players=E.length-1,q.date=Date.now(),q.cycle=0,q.kingdoms=E,q.deltaTime=0);q.loadDate=Date.now();
q.online||Eh();q.now=Ti;q.paused=0;q.pausedTime=0;q.zMax=96*q.mapy;cc();var b=performance.now();q.allow14=!0;F=q.mapx;ua=q.mapy;q.temperature=25;var e=q.temperature;0==w.temperature&&(e+="&deg;C");document.getElementById("temperature").innerHTML=e;ba=1;Ul();xe();Qf={};var d=F,f=-d,g=+d;dc=[1,1+f,f,-1+f,-1,-1+g,g,g+1];Ui=[f,-1,1,g];q.online&&Ta("content");for(var h=["chat","loading","playermenu","index"],B=h.length,G=0;G<B;document.getElementById(h[G++]).style.display="none");r("loadingtext").innerHTML=
"Loading terrain";b=performance.now();if(!1!==q.arje){var H=performance.now(),J=F,I=J*ua,K=Math.sqrt(I),L=0,M=0,S=0,T=0,V=0,X=0,Z=0,aa=0,Y=0,ca=0,ia=0,la=0,ja=0,pa=100,ra=255,sa=0,qa=0,ka=0,va=new Int8Array(new ArrayBuffer(I)),oa=new Uint32Array([2,3,0,1,1,1,0,1,0,1,0,1,1,1,1,0,0,15,0,1]);for(vl(q.arje);Y<I;va[Y++]=0);var ya=oa.length;for(Y=0;Y<ya;Y+=4)oa[Y+3]&&(oa[Y+1]=~~(K/oa[Y+1]));for(ca=0;ca<ya;ca+=4)for(pa=oa[ca+1],ra=oa[ca],sa=oa[ca+2],Y=0;Y<pa;Y++)for(la=~~(ha()*I+.5),V=6*ha()-3,X=6*ha()-
3,sa?(aa=ha()*K,ka=~~(ha()*(K/15))+4,Z=~~(100*ha())/4,qa=ka/12):(aa=128*ha(),ka=~~(2.56*ha())+4,Z=~~(100*ha())/2,qa=1),L=la%J,M=~~(la/J),ia=0;ia<aa;ia++)for(100*ha()>Z&&(V=(6*ha()-3)*qa,X=(6*ha()-3)*qa),L+=V,M+=X,S=0;S<ka;S++)for(T=0;T<ka;T++)(S-ka/2)*(S-ka/2)+(T-ka/2)*(T-ka/2)<ka*ka/4&&(ja=~~L+S+(T+~~M)*J,ja>=I?ja%=I:0>ja&&(ja+=I),va[ja]=ra);var za=performance.now();P("randomtxt1",za-H);P("drawTerrain: ",performance.now()-za);uc=va}else uc=q.terrain?new Int8Array(q.terrain):new Int8Array(F*ua);fc.randomtxt=
performance.now()-b;P("randomtxt: ",fc.randomtxt);b=performance.now();r("loadingtext").innerHTML="Creating map";var xa=F*ua*4;O=new Uint32Array(new ArrayBuffer(xa));Ma=new Uint32Array(new ArrayBuffer(xa));bd=new Uint32Array(new ArrayBuffer(xa));jc={};N.dimension=O;ze.dimension=Ma;gk.dimension=O;hk.dimension=Ma;U.dimension=O;dg.dimension=bd;ec.dimension=Ma;cg.dimension=O;ib[0]=Ma;ib[1]=O;ib[2]=bd;fc.createMap=performance.now()-b;P("createMap: ",fc.createMap);r("content").style.display="block";b=performance.now();
P(q.allunits);if(!1===q.arje||q.allunits)D=q.allunits;else{var Da=uc,Ca=q.mapx,Oa=q.mapy,Sa=performance.now(),ma=0,Fa=0,Xa=0,Ka=0,La=0,Ba=Ca*Oa,Ua=Math.sqrt(Ba);Fa=Ba;D=[];Ed={};var Ja=Vl,ab=Wl,bb=Ed,cb=Xl,db=[12,63,62],Ea=[];Fa=E.length;for(ma=1;ma<Fa;ma++){for(var Wa=!0,Ya=E[ma],jb=db[Ya.race],da=0;Wa&&25>da;){da++;Ka=~~(ha()*(Ca-15)+.5)+4;La=~~(ha()*(Oa-15)+.5)+4;Wa=!1;Xa=Ea.length;for(var lb=0;lb<Xa;lb+=2)60>Math.sqrt((Ka-Ea[lb])*(Ka-Ea[lb])+(La-Ea[lb+1])*(La-Ea[lb+1]))&&(Wa=!0);Wa||(Ea.push(Ka+
4,La+3),Ja(Ka+La*Ca,{type:jb,kingdom:ma}))}if(25==da){E.length=ma;break}}var hb=2*(Fa-1);Fa=1*~~(Ua/3.2);for(ma=0;ma<Fa;ma++){var mb=~~(ha()*Ca+.5);var nb=~~(ha()*Oa+.5);var qb=~~(25*ha())+10;var rb=~~(25*ha())+10;for(Ya=0;55>Ya;Ya++){Ka=~~(ha()*qb+~~(mb+18*ha()-9)+.5);La=~~(ha()*rb+~~(nb+18*ha()-9)+.5);var Qa=Ka+La*Ca;ab(Qa)&&Qa<=Ba&&Ja(Qa,{type:7,d:~~(28*ha()+3)})}}Fa=40*~~(Ua/256);for(ma=0;ma<Fa;ma++){Qa=~~(ha()*Ba+.5);var Ra=Sh[~~(ha()*Sh.length)],Na=Object.assign({},Ra);Na.d+=~~(Ra.dMax*ha());
if(Ra.sword||Ra.potion)Na.attack=~~(6*ha())+1;if(Ra.shield||Ra.potion)Na.defence=~~(6*ha())+1;if(Ra.book){var pb=~~(ha()*fg.length);Na.spell=fg[pb];Na.iconID=c[fg[pb]].iconIDbook;Na.name=x[Na.spell];Na.attack=~~(6*ha())+1}Ja(Qa,Na)}Fa=3*~~(Ua/256);for(ma=0;ma<Fa;ma++)Qa=~~(ha()*Ba),ab(Qa)&&Ja(Qa,{type:43});for(lb=0;lb<hb;lb+=2){var sb=2*Math.round(ha())-1;var Va=Ea[lb]+10*(2*Math.round(ha())-1)+~~(3*ha());var eb=Ea[lb+1]+10*sb+~~(3*ha());var Aa=Ea[lb]+10*(2*Math.round(ha())-1)+~~(3*ha());var gb=Ea[lb+
1]+10*-sb+~~(3*ha());0>Va?Va=0:Va+4>F&&(Va-=(Va+4)%Ba);0>eb?eb=0:eb+4>ua&&(eb-=(eb+4)%Ba);0>Aa?Aa=0:Aa+4>F&&(Aa-=(Aa+4)%Ba);0>gb?gb=0:gb+4>ua&&(gb-=(gb+4)%Ba);Ja(Va+eb*Ca,{type:21});Ja(Aa+gb*Ca,{type:22})}ma=0;for(var yb=10*F*ua/65536;ma<yb;ma++)Ja(~~(ha()*Ba),{type:21});ma=0;for(yb=10*F*ua/65536;ma<yb;ma++)Ja(~~(ha()*Ba),{type:22});for(lb=0;lb<hb;lb+=2)for(Va=Ea[lb]-25,eb=Ea[lb+1]-25,Aa=0;50>Aa;Aa++)for(gb=0;50>gb;gb++)if(625>(Aa-25)*(Aa-25)+(gb-25)*(gb-25)){var wb=Aa+Va+(gb+eb)*Ca;7===cb(wb).type&&
(D.quit(bb[wb]),bb[wb]=void 0);1===kc.type[Da[wb]]&&(Da[wb]=0)}P("random:",performance.now()-Sa);fc.random=performance.now()-Sa}q.movtable&&!q.demo&&(Qc=q.movtable,Rc=q.movtable2);var Gb=performance.now();r("loadingtext").innerHTML="Loading textures";Sk(uc);fc.setupGL=performance.now()-Gb;P("setupGL: ",fc.setupGL);for(var kb=performance.now(),Ab=uc,Kb=kc.type,Lb=q.tr,Qb=F*ua,xb=0;xb<Qb;xb++)Kb[Ab[xb]]?(Ma[xb]=1,O[xb]=1,ic[xb]=1):0>Ab[xb]&&(ic[xb]=2,Ma[xb]=2,O[xb]=2);var vb=D;if(!q.custom&&vb){for(var Rb=
q,Cb=vb,Eb="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy".split(" "),Jb={},ob=0;ob<Eb.length;ob++)Jb[Eb[ob]]=ob;var Mb=[],Vb=Cb.length;for(ob=0;ob<Vb;ob++){var Pb=Cb[ob],Db=Object.keys(Pb),Tb={};Mb.put(Tb);for(var Bb=0,$b=Db.length;Bb<$b;Bb++)Tb[Jb[Db[Bb]]]=Pb[Db[Bb]]}Rb.ini=
Mb}q.demo&&(vb=q.ini);if(vb){xb=0;for(var ac=vb.length;xb<ac;xb++){var Ha=vb[xb];if(void 0!==Ha.race){Ha.type=Yl[Ha.type+256*Ha.race];Ha.kingdom=Lb[Ha.kingdom];if(void 0==Ha.type)continue;var bc=A[Ha.type];if(13==Ha.type||bc.build)Ha.d=0;Ha.resource&&(Ha.health=Ha.resource,Ha.maxHealth=Ha.resource);if(!Ha.health||void 0==Ha.kingdom)continue}if(Ha.death)y.put(Ha);else if(!Ha.cancell){var Wb=Ha.x32,Xb=Ha.y32,Yb=!1===Ha.built&&1===Ha.health?!0:!1,Zb=Ha.kingdom||0,Sb=new Tc(Ha.type,Zb,Wb,Xb,0,Yb,Ha);
Sb.invalid||(Yb||mj(Sb),Sb.castle&&(E[Zb].origin=[Wb+4,Xb+3]))}}}Ed=D=null;P("positioned:",performance.now()-kb);fc.positioned=performance.now()-kb;fc.setupGL=performance.now()-b;P("setupGL: ",fc.setupGL);$a(Za);$a(W);Zd(w.kingdom);Kj();qk();window.addEventListener("keydown",Uj);window.addEventListener("keyup",Vj);window.addEventListener("mousemove",Wj);Q=tb;R=new Float32Array(12);var Fb=wa[k.blank].id;z[0]=Fb;z[1]=0;z[2]=1;z[3]=0;z[4]=Fb;z[5]=0;z[6]=1;z[7]=0;z[8]=Fb;z[9]=0;z[10]=1;z[11]=0;z[12]=
Fb;z[13]=0;z[14]=1;z[15]=0;var zb=ta;zb[0]=0;zb[1]=1;zb[2]=2;zb[3]=1;zb[4]=2;zb[5]=3;m.bindBuffer(m.ARRAY_BUFFER,kd);m.bufferSubData(m.ARRAY_BUFFER,0,z);m.bindBuffer(m.ARRAY_BUFFER,ub);var Ub=3*w.kingdom,Hb=Ia[Ub],Ib=Ia[Ub+1],Nb=Ia[Ub+2];m.bufferSubData(m.ARRAY_BUFFER,0,new Float32Array([Hb,Ib,Nb,.5,Hb,Ib,Nb,.5,Hb,Ib,Nb,.5,Hb,Ib,Nb,.5]));var Ob=96*F;R[2]=Ob;R[5]=Ob;R[8]=Ob;R[11]=Ob;window.addEventListener("mousedown",Xj);window.addEventListener("mouseup",Yj);P("FULL: ",performance.now()-l);q.record||
(q.record={});q.online?(qd(Me(),x.waitingPlayers,1),w.admin?ed():fa(ed,0,0)):gg();q.allow14=!1;cd.list.push(0,JSON.stringify(fc))},300)},Me=function(){for(var c=J.length,b=J,d="",f=0;f<c;f++)Me.obj[b[f].id]||b[f].id==w.onlineID||(d+="<br>"+b[f].name);return d};Me.obj={};var si=function(){return w.gl?!1:(qd("You can't run WEBGL 2<br>More info <a href='http://webglreport.com/?v=2'>here</a>","Error"),bc(),!0)},Ag=!1,Nd,Wk=function(c){var b={};Nd={events:{defined:b,nodefined:{}}};for(var e={moving:1},
f=0,g=0,h=c.length;g<h;g++){var l=c[g];l.activeEvents=0;for(var k=l.events,m=0,n=k.length;m<n;m++){var q=k[m];q.id=f++;var r=q.list,u=q.to,w=q.type,x=q.zone;q.rule=l;for(var z=q.activeEvents=0,A=r.length;z<A;z++){var y=r[z];b[y]||(b[y]={});y=b[y];if(e[w])y[w]||(y[w]=[]),y[w].put(q);else if("zone"==w){y[w]||(y[w]=[]);for(var B=0;B<x.length;B++)y[w].push(q,x[B][0],x[B][1],x[B][2],x[B][3])}else{y[w]||(y[w]={defined:{}});y=y[w].defined;B=0;for(var D=u.length;B<D;B++)y[u[z]]||(y[u[z]]=[]),y[u[z]].put(q)}}}}},
Kj=function(){var c=document.getElementById("playersinfo");c.innerHTML="";if(!q.editor)for(var b=1,d=E.length;b<d;b++){var f=E[b],g=f.death?f.name.strike():f.name;c.innerHTML+=g+"<span id='score"+b+"'> 0/0</span><div class='playercolor' style='background:rgb("+f.color[0]+","+f.color[1]+","+f.color[2]+")'></div><br>"}},qk=function(){var c=window.innerWidth-w.mx,b=window.innerHeight,d=E[w.kingdom].origin;d?(c=32*d[0]-.5*c,b=32*d[1]-.5*b):b=c=0;od(~~c,~~b)},we,ck,Rj,Ul=function(){var c=document.getElementById("selectedobject").getContext("webgl",
{antialias:!1,depth:!1}),b=c.createShader(c.VERTEX_SHADER);c.shaderSource(b,"void main() {\ngl_Position = vec4(0 ,0, 0, 1);\ngl_PointSize=48.0;\n}");c.compileShader(b);var d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,"precision mediump float;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nuniform float txtCoord;\nvoid main() {\ngl_FragColor = texture2D(u_image, (vec2(\tmod(txtCoord,21.0) ,floor(txtCoord/21.0) ) + gl_PointCoord)*(0.046875));\nif(gl_FragColor.r==gl_FragColor.g&&gl_FragColor.r==gl_FragColor.b) gl_FragColor*=u_color;\n}");
c.compileShader(d);var f=c.createProgram();c.attachShader(f,b);c.attachShader(f,d);c.linkProgram(f);c.useProgram(f);b=c.createTexture();c.bindTexture(c.TEXTURE_2D,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texImage2D(c.TEXTURE_2D,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,I.icons);var g=c.getUniformLocation(f,"u_color"),
h=c.getUniformLocation(f,"txtCoord");we=function(b){if(wa[b.img][3]){var e=b.kingdom;c.uniform4f(g,Ia[3*e],Ia[3*e+1],Ia[3*e+2],1)}else c.uniform4f(g,1,1,1,1);c.uniform1f(h,b.iconID);c.drawArrays(c.POINTS,0,1)};ck=function(){c.uniform4f(g,1,1,1,1);c.uniform1f(h,189);c.drawArrays(c.POINTS,0,1)};Rj=function(){c.uniform1f(h,0);c.uniform4f(g,0,0,0,0);c.drawArrays(c.POINTS,0,1)}},Bb=128,Lb=128,y=[{terrain:1},{terrain:1},{terrain:1}],ic={},Zd=function(c){c===w.kingdom&&(c=yb.values.popMax<yb.values.popLimit?
yb.values.popMax:yb.values.popLimit,document.getElementById("pop").innerHTML=yb.values.pop+"/"+c)};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(c){window.setTimeout(c,1E3/60)}}();var Ed=D=void 0;var Vl=function(c,b){Ed[c]||(b.x32=c%F,b.y32=~~(c/ua),D.put(b),Ed[c]=b)},Wl=function(c){return!D[c]},Xl=function(c){return Ed[c]||NaN},Ja=[];window.addEventListener("offline",function(c){We("Offline",
"#ff0000")});window.addEventListener("online",function(c){We("Online","#00ff00")});var Xh=function(){ab.leaveRoom();Ja.length=0},Fd={};(function(){for(var c=["returnmenu","index","Account","accountIframe"],b=0,d=c.length;b<d;Fd[c[b]]=document.getElementById(c[b++]));})();var Zl=function(){location.replace("#"+this.gameID+"Room")},yi=function(c){Ja=[];P("connecting to",c,x.loading);r("game").style.display="block";r("gameName").innerHTML=x.loading;r("returnmenu").style.display="none";r("index").style.display=
"none";vc.innerHTML="";dd.innerHTML="";w.p2p?(ab.joinRoom(c,Dg),zg()):(ab||lc(),lc.func=function(){yi(c)})},$l=function(c){r("game").style.display="none";J.length=0;q.online=0;Xh();bc();c.constructor==String&&qd(c)},Jj={euro:0,arab:0,asia:0},vi=function(c,b,d){if(d){b=Yh(d.id);var e=b[1];b=b[0];c=nb(c);b.username||(rk[e].innerHTML=c,b.name=c,d.username=c,pk(x.joining,c,1E3))}},Na=function(c,b){if(b.resend)if(c.destinatary)(b=fd(c.destinatary))&&b.id!=w.onlineID&&(c.bridge=h.id,b.send(c));else{b=b.resend;
for(var e=0,f=b.length;e<f;e++){var g=b[e];c.bridge=h.id;g.send(c)}}else{var h=b;c.bridge&&(h=fd(c.bridge));if(void 0===c.length){if(void 0!==c.func)(0,gf[c.func])(c[1],c[2],h)}else b=c[0],h.orderList[b]=c,Na.done[b]||(Na.done[b]=0),Na.done[b]++,Na.done[b]==Ja.length&&Na.func&&(Na.func=!1,bh(),cc())}};Na.done=[];var gd=function(c,b,d){d&&(P(d.id,"CAN connect"),gd.ids[c]||(gd.ids[c]=1,w.admin||clearTimeout(gd.intv[c]),P("MAKE BRIDGE"),fd(c).bridge=d,fa(sk,c,0,[d],0)))};gd.ids={};gd.intv={};var sk=
function(c,b,d){d&&(P("BRIDGE"),d.resend||(d.resend=[]),d.resend.put(fd(c)))},fd=function(c){for(var b=0,e=Ja.length;b<e;b++){var f=Ja[b];if(f.id==c)return f}},ab,tk=function(c){if(!r("usernameForm")){Mb();var b=localStorage.name||"Guest",e=localStorage.color||"#"+Math.floor(16777215*Math.random()).toString(16),f=document.createElement("div");f.id="usernameForm";f.innerHTML="\n            <div>\n            <h2>"+x.username+'</h2>\n            <div>\n<input type="color" id=\'usernameColor\' value="'+
e+'" /><input id=\'usernameVal\' type="text" value="'+b+'" />\n</div>\n<br />\n</div>';b=document.createElement("button");b.innerHTML=x.continue;b.onclick=function(){w.name=nb(r("usernameVal").value);w.color=r("usernameColor").value;localStorage.color=w.color;localStorage.name=w.name;document.body.removeChild(r("usernameForm"));c();Ea()};f.children[0].appendChild(b);document.body.appendChild(f)}},lc=function(){si()||(w.name?(al(),ab=new SimpleWebRTC({localVideoEl:"",remoteVideosEl:"",autoRequestMedia:!1,
receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},url:"https://solar.tza.red/"}),ab.on("channelMessage",function(c,b,d){"nehhof"==d.type&&(b=JSON.parse(d.payload),Na(b,c))}),ab.on("error",function(c){"full"==c&&(bc(),We(x.gameFull,"#ff0000"))}),ab.on("connectionReady",function(c){var b=ab.connection.connection;w.p2p=b;b.username=w.name;b.color=w.color;b.on("getRooms",function(b){var c=Object.keys(b),e=r("gameList");if(0<c.length){e.innerHTML="";for(var d=0,l=c.length;d<l;d++){var k=c[d],
m=b[k],n=m.len;if(n){var q=document.createElement("tr"),w="";w=m.playing?w+("<td><div class='redCircle'></div>"+x.playing+"</td>"):w+("<td><div class='redCircle' style=\"background:rgba(0,255,0,.8)\"></div>"+x.waiting+"</td></td>");w+="<td>"+nb(m.description)+"</td><td>"+~~((Date.now()-m.date)/6E4)+" min ago</td><td>"+nb(n)+"/"+nb(m.max)+"</td>";q.innerHTML=w;q.gameID=k;m.playing||(q.onclick=Zl);e.appendChild(q)}}}else e.innerHTML="<tr><td>No games found</td></tr>"});w.onlineID=c;lc.func&&lc.func()}),
ab.on("createdPeer",function(c){q.started||Yk(c)})):tk(lc))},am=function(){zg();Ea();r("game").style.display="block";r("gameName").innerHTML=x.loading;r("returnmenu").style.display="none";r("index").style.display="none";vc.innerHTML="";dd.innerHTML="";Ja=[];wi();w.admin=1;w.room={description:r("gameFormName").value,max:parseInt(r("gameMax").value),public:!0};2>w.room.max&&(w.room.max=2);14<w.room.max&&(w.room.max=14);localStorage.gameDescription=w.room.description;ab.createRoom(w.onlineID+"b",Dg);
q.online=1;document.body.removeChild(r("gameForm"))},uk=function(){ab||lc();if(w.onlineID){Mb();var c=localStorage.gameDescription||w.name+"'s room",b=document.createElement("div");b.id="gameForm";b.innerHTML="\n<div>\n            <h2>"+x.gameOptions+"</h2>\n            "+x.gameName+': <input id=\'gameFormName\' type="text" value="'+c+'" maxlength="29" /><br />\n'+x.nplayers+': <input id="gameMax" type="number" value="6" max="14" min="2"/><br />\n            </div>';c=document.createElement("button");
c.innerHTML=x.continue;c.onclick=am;b.children[0].appendChild(c);document.body.appendChild(b)}else setTimeout(function(){location.hash=""},200),lc.func=uk},vk=function(c){for(var b="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy".split(" "),e=[],f=c.length,g=0;g<f;g++){var h=
c[g],l=Object.keys(h),m={};e.put(m);for(var k=0,n=l.length;k<n;k++)m[b[l[k]]]=h[l[k]]}return e},bm=function(c){for(var b=c.length,e=new Uint8Array(b),f=0,g=-1,h=0,l=0;l<b;l++){var k=c[l];if(g===k)h||(e[f++]=255),h++;else{if(h){if(4>h){f--;for(var m=0;m<h;m++)e[f++]=g}else e[f++]=h>>8&255,e[f++]=h&255;h=0}e[f++]=k}g=k}if(h)if(4>h)for(f--,m=0;m<h;m++)e[f++]=g;else e[f++]=h>>8&255,e[f++]=h&255;return e.slice(0,f)},wk=function(c,b){b=JSON.stringify(b);c.sendDirectly("channelMessage","nehhof",b)},Ne=[],
fa=function(c,b,d,f,g){var e;if(!0===g&&q.online&&Ja.length)d.change&&(d=d.slice(0)),Ua(function(){fa(c,b,d,f,55)});else if(void 0===c.location)c();else{if(q.started&&!q.editor){var l=q.record;l[q.cycle]||(l[q.cycle]=[]);var m=l[q.cycle];l=m.length;m[l]=c.location;m[l+1]=b;d.length&&(d=d.slice(0));m[l+2]=d}if(q.online&&Ja.length)if(55===g&&(e=!1),m={func:c.location,1:b,2:d,active:e,rnd:4294967296*Math.random()},q.started&&c!=cc&&c!=gg&&c!=oc)if(f)for(l=0,e=f.length;l<e;l++)g=f[l],m.destinatary=g.id,
g.bridge?wk(g.bridge,m):wk(g,m);else Ne.put(m);else Zh(m),c(b,d);else c(b,d)}},cm=function(){if(Ja.length){Bg();ed.i=0;w.p2p.emit("gameStarted");for(var c={},b=0,d=J.length;b<d;b++)c[J[b].id]=b;fa($h,q,c,0,0)}},ed=function(c,b,d){d&&(Me.obj[d.id]=1,c=Me(),""==c?qd(c,x.loading,1):qd(c,x.waitingPlayers,1));w.admin&&(ed.i++,ed.i==J.length&&setTimeout(function(){fa(gg,0,0,0,!0)},100))};ed.i=0;var Zh=function(c){c=JSON.stringify(c);for(var b=0,e=Ja.length;b<e;b++)Ja[b].sendDirectly("channelMessage","nehhof",
c)},hd,ai,bh=function(){if(!Na.done[hd]||Na.done[hd]<Ja.length)return Na.func=!0,cc(),!0;for(var c=0,b=J.length;c<b;c++){var d=fd(J[c].id);if(c==w.kingdom-1)var f=ai;else{if(!d)continue;f=d.orderList[hd]}for(var g=1,h=f.length;g<h;g++){var l=f[g];gf[l.func](l[1],l[2],d)}}Na.func=!1;Zh(Ne);ai=Ne;hd++;Ne=[hd+1];return!1},gg=function(){document.getElementById("alert").style.display="none";q.started=1;q.date=Date.now();cc();Fa();Ea();hd=0;if(!q.custom||q.demo)for(var c=1,b=E.length;c<b;c++){var d=mb[Xf[E[c].race]],
f=d.peasant.type;if(d=y[hb[c][d.castle.type][0]])Sc(f,d,1),Sc(f,d,1),Sc(f,d,1)}Qa.arr=[];Qa.units=[];Qa.time=500;Qa.steps=0;Qa.process=0;if(!q.editor&&!q.demo){for(c=1;c<E.length;c++)b=E[c].resources,E[c].IA&&Infinity==b[0]&&Infinity==b[1]&&Infinity==b[2]&&Infinity==b[3]&&new Qa(E[c]);c=0;b=Qa.arr;for(f=b.length;c<f;b[c++].leaveMeAloneIKnowWhatToDo());Vg()}q.online&&(Zh([0]),Ne=[1],ai=[0]);eb()},$h=function(c,b,d){if(d&&d.admin){d=[J[0]];for(var e=0,g=J.length;e<g;e++)d[b[J[e].id]]=J[e];J=d}qa("bless");
q=c;q.infinity&&(q.goldRes=Infinity,q.foodRes=Infinity,q.woodRes=Infinity,q.stoneRes=Infinity);q.infinity=void 0;q.goldRes||(q.goldRes=Infinity);q.foodRes||(q.foodRes=Infinity);q.woodRes||(q.woodRes=Infinity);q.stoneRes||(q.stoneRes=Infinity);pd()},Ld=!1,Ea=function(){Ld=!1;r("basic").style.filter=""},Mb=function(){Ld=!0;r("basic").style.filter="blur(94px)"};var dm=function(){Ta("game");J.length=0;q.online=0;Xh();bc();w.admin=0};var Dg=function(c){if(w.admin||c)if(c=ab.roomName,c+="Room",P("login"),
Ea(),0!==ab.getPeers().length||w.admin){var b=w.room||NaN;q.id=c;q.online=1;wi();Ta("chat");r("gameName").innerHTML=nb(b.description)||"Online Game";r("onlineID").value=location.origin+"/#"+q.id;oa("returnmenu");Cg();w.admin?(location.replace("#"+q.id),r("buttons").innerHTML='<button id="startbutton">'+x.play+'</button><button id="optionbutton">'+x.options+'</button><button id="closebutton">'+x.close+"</button>",r("startbutton").onclick=cm,r("optionbutton").onclick=xk,r("closebutton").onclick=dm):
(r("buttons").innerHTML='<button id="quitbutton">'+x.disconnect+"</button>",r("quitbutton").onclick=$l);ab.connection.on("remove",function(b){if(b=fd(b.id))if(oc(Dh(x.playerDisconnected,b.username),0,5),q.online){if(q.started)for(var c=0;c<J.length;c++)if(J[c].id==b.id){E[c+1].die();break}Ja.quit(b);q.started?Na.done[hd]==Ja.length&&Na.func&&(Na.func=!1,bh(),cc()):(Cg(),b.admin&&(bc(),ab.leaveRoom(),qd(x.gameClosed)))}})}else location.hash="",bc()},Ua=function(c){Ua.func.put(c);0===Ua.active&&(fa(yk,
0,0,0,0),Ua.date=Date.now(),Ua.received=0,Ua.max=-Infinity,Ua.active=1)};Ua.func=[];Ua.active=0;var yk=function(c,b,d){d&&fa(zk,0,0,[d],0)},bi={},zk=function(c,b,d){if(d&&(d.ping=~~(.5*(Date.now()-Ua.date)+.5),bi[d.id]?bi[d.id].put(d.ping):bi[d.id]=[d.ping],d.ping>Ua.max&&(Ua.max=d.ping),Ua.received++,Ua.received==Ja.length)){c=performance.now();b=0;for(d=Ua.func.length;b<d;Ua.func[b++]());P(-c+performance.now());Ua.func.length=0;Ua.active=0}},ci=document.getElementsByClassName("ucolor"),rk=document.getElementsByClassName("username"),
di=document.getElementsByClassName("race"),hg=document.getElementsByClassName("team"),Ob=document.getElementsByClassName("isconnected"),Gg=function(c,b,d){d&&(b=Yh(d.id),d=b[1],b=b[0],b.race=c%3,b.race||(b.race=0),di[d].innerHTML=bb[b.race])},Yh=function(c){for(var b=0,e=J.length;b<e;b++){var f=J[b];if(f.id==c)return[f,b]}},Eg=function(c,b,d){if(d){P(c);b=c.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);b||(c="ffffff",b=["ffffff","ff","ff","ff"]);d.color=c;d=Yh(d.id);var e=d[1];d=d[0];ci[e].style.background=
c;d.color=[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]}},Fg=function(c,b,d){c=parseInt(c);if(isNaN(c)||!c)c=0;(c%=5)||(c=0);if(d){b=d.id;d=0;for(var e=J.length;d<e;d++){var g=J[d];if(g.id==b){g.team=c;hg[d].innerHTML=c;break}}}},Cg=function(){P("setup MENU");var c=document.getElementById("multiplayertable");c.innerHTML="";for(var b=w.room?w.room.max:14,d=0;d<b;d++)c.innerHTML+='<tr><td class="ucolor"></td><td class="username">'+x.open+'</td><td class="race"></td><td class="team"></td><td class="isconnected"></td></tr>';
c=ab.roomName;c=c.substr(0,c.length-1);var f=[w.p2p];d=0;for(b=Ja.length;d<b;d++){var g=Ja[d];g.admin?f.unshift(g):f.put(g)}for(b=0;b<f.length;b++){g=f[b];J[b]&&J[b].id==g.id?d=J[b]:(d=parseInt((g.color||"ffffff").substr(1),16),d={color:[d>>16&255,d>>8&255,d&255],ia:0,name:g.username,race:0,team:1,id:g.id,cID:b});g&&g.id?(Ob[b].style.background="#00ff00",Ob[b].style.boxShadow="0px 0px 30px 0px #00ff00"):(Ob[b].style.background="#ff0000",Ob[b].style.boxShadow="0px 0px 30px 0px #ff0000");ci[b].style.background=
"rgb("+d.color[0]+","+d.color[1]+","+d.color[2]+")";rk[b].innerHTML=d.name;d.id==c&&(g.admin=!0);if(w.onlineID==d.id){hg[b].innerHTML="";g=document.createElement("button");g.onmousedown=Ak;g.iteam=b;g.innerHTML=d.team;hg[b].appendChild(g);g=document.createElement("button");g.onmousedown=Bk;g.iteam=b;g.innerHTML=bb[d.race];di[b].appendChild(g);g=document.createElement("input");g.type="color";var h=d.color;g.iteam=b;g.value="#"+(16777216+(h[0]<<16)+(h[1]<<8)+h[2]).toString(16).slice(1);ci[b].appendChild(g);
g.onchange=Ck;Ob[b].style.background="#00ff00";Ob[b].style.boxShadow="0px 0px 30px 0px #00ff00"}else hg[b].innerHTML=d.team,di[b].innerHTML=bb[d.race];J[b]=d}J.length=f.length},J=[];window.onhashchange=xi;var dd=document.getElementById("msgs"),vc=document.getElementById("msgs1"),ig=document.getElementById("msginput"),Gh=document.getElementById("msginputGame"),Fh=document.getElementById("enterwindow");ig.addEventListener("keyup",function(c){13==c.keyCode&&Hh()});var oc=function(c,b,d){qa("chat");d&&
(q.started?(b=vc,ei()):b=dd,b.innerHTML=5!==d?b.innerHTML+("<li><span>"+d.username+" \u2014</span> "+nb(c)+"</li>"):b.innerHTML+("<li>"+c+"</li>"),b.scrollTop=b.scrollHeight)},ei=function(){11==dd.children.length&&vc.removeChild(vc.children[0]);ei.intv=setTimeout(function(){vc.children[0]&&vc.removeChild(vc.children[0])},16E3)},nb=function(c){return String(c).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Hh=function(){if(q.started){var c=vc,b=Gh.value;Gh.value="";ei()}else c=dd,
b=ig.value,ig.value="";""!=b&&(b=nb(b),c.innerHTML+="<li><span>"+w.name+" \u2014</span> "+b+"</li>",fa(oc,b,0,0,0),c.scrollTop=c.scrollHeight)},gf=[$h,Qb,fe,nc,rf,yd,td,Ai,Bi,oc,cf,ce,wd,Ph,xd,ue,lh,nf,gh,ed,cc,yk,zk,Fg,Tj,function(c,b,d){d&&(c=fd(c))&&c.open&&(P("I CAN connect"),fa(gd,c.id,0,[d],0))},gd,sk,gg,Ug,wh,If,yh,Aj,th,uf,xf,Sf,Kf,zh,Bf,lj,je,Eg,function(c,b){b=y[b];var d=c[0];c=c[1];var e=F;!1!==d&&(b.kx=d);!1!==c&&(b.ky=c);d=-(b.x32+d+(c+b.y32)*e);b.stop=b.kx||b.ky?!1:!0;Number.isInteger(b.xf)||
Qb(d,[b.id])},sh,sj,Wg,Gg,zf,vh,Uf,Nf,wj,Wf,Ff,Df,Pf,Bh,Mj,xj,Oi,vi];localStorage.favMusic&&(musicSelect.mversion.value=localStorage.favMusic);$h.antiHack=0;Qb.antiHack=0;fe.antiHack=0;nc.antiHack=0;rf.antiHack=0;yd.antiHack=0;td.antiHack=0;X.antiHack=0;pf.antiHack=0;db.antiHack=0;Ra.antiHack=0;X.antiHack=0;Ai.antiHack=0;Bi.antiHack=0;oc.antiHack=0;cf.antiHack=0;ce.antiHack=0;wd.antiHack=0;$d.antiHack=0;Ph.antiHack=0;xd.antiHack=0;ue.antiHack=0;lh.antiHack=0;nf.antiHack=0;(function(){for(var c=gf,
b=0,d=c.length;b<d;b++)c[b].location=b})();var xk=function(){r("mapconfiguration").style.display="block";r("basic").style.filter="blur(94px)"},Dk=document.getElementsByClassName("ucolor1"),em=document.getElementsByClassName("username1"),fm=document.getElementsByClassName("race1"),gm=document.getElementsByClassName("team1"),Ak=function(c){var b=1;2==c.button&&(b=-1);c=this.iteam;J[c].team+=b;0>J[c].team&&(J[c].team=0);this.innerHTML=J[c].team;q.online&&(b=parseInt(this.innerHTML),b%=6,0==b&&(b=1),
this.innerHTML=b,fa(Fg,b,0,0,2),J[c].team=b)},Bk=function(c){c=J[this.iteam];c.race=(c.race+1)%3;this.innerHTML=bb[c.race];fa(Gg,c.race,0,0,2)},Ck=function(){this.parentElement.style.background=this.value;var c=this.value.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);J[this.iteam].color=[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)];Ja.length&&fa(Eg,this.value,0,0,2)},hm=function(){Hb.nu++;Hb()},im=function(){Hb.nu--;0>=Hb.nu?Hb.nu=1:J.length--;Hb()},Xf={0:"euro",1:"arab",2:"asia"},
Ek=[["a","e","i","o","u"],"bcdfghjklmnpqrstvwxyz".split("")],Hb=function(){if(w.name){document.getElementById("returnmenu").style.display="block";document.getElementById("oneplayertbody").innerHTML="";document.getElementById("oneplayertbody").innerHTML+='<tr><td></td><td id="addremove"><button id="addPlayer">+</button><button id="removePlayer">-</button></td><td></td><td></td></tr>';for(var c=Hb.nu,b=0;b<c;b++)if(document.getElementById("oneplayertbody").innerHTML+='<tr><td class="ucolor1"></td><td class="username1"></td><td class="race1"><button></button></td><td class="team1"><button></button></td></tr>',
!J[b]){var d=~~(16777216*Math.random());J[b]={color:[d>>16&255,d>>8&255,d&255],IA:1,race:~~(3*Math.random()),team:b}}document.getElementById("addPlayer").onclick=hm;document.getElementById("removePlayer").onclick=im;d=parseInt(w.color.substr(1),16);J[0].color=[d>>16&255,d>>8&255,d&255];J[0].name=w.name;for(b=d=J[0].IA=0;b<c;b++){var f=J[b],g=aj[Xf[f.race]];if(f.IA)if(d<g.length)f.name=g[d++];else{g=f;var h=~~(9*Math.random())+2,l=Ek[1],m=l[~~(Math.random()*l.length)].toUpperCase();.85<Math.random()&&
(m+=l[~~(Math.random()*l.length)]);for(l=0;l<h;l++){var k=Ek[l%2];m+=k[~~(Math.random()*k.length)];.8<Math.random()&&(m+=k[~~(Math.random()*k.length)])}g.name=m}Dk[b].style.background="rgb("+f.color[0]+","+f.color[1]+","+f.color[2]+")";em[b].innerHTML=f.name;g=gm[b].getElementsByTagName("button")[0];g.iteam=b;g.onmousedown=Ak;g.innerHTML=b;g=fm[b].getElementsByTagName("button")[0];g.iteam=b;g.onmousedown=Bk;g.innerHTML=bb[f.race];f=J[b].color;g=document.createElement("input");g.type="color";g.iteam=
b;g.value="#"+(16777216+(f[0]<<16)+(f[1]<<8)+f[2]).toString(16).slice(1);Dk[b].appendChild(g);g.onchange=Ck}}else tk(Hb)};Hb.nu=4;var pk=function(c,b,d){"granted"!=Notification.permission&&Notification.requestPermission(function(b){});var e=new Notification(c,{icon:"https://i.imgur.com/SWtWteN.png",body:b,requireInteraction:!0});d||(d=7550);setTimeout(function(){e.close()},d)},kc,Jc=function(c){if(pa(c%F,~~(c/F))&&(c=uc[c],0<=c&&!kc.type[c]))return!0},Lc=function(c){if(c){Lc.update=!1;c=uc;for(var b=
F,d=[],e={},g=0,h=F*ua;g<h;g++){var l=c[g];if(kc.type[l]||0>l){var k=0;Jc(g-1-b)&&(k+=1E7);Jc(g-b)&&(k+=1E6);Jc(g-b+1)&&(k+=1E5);Jc(g-1)&&(k+=1E4);Jc(g+1)&&(k+=1E3);Jc(g-1+b)&&(k+=100);Jc(g+b)&&(k+=10);Jc(g+1+b)&&(k+=1);k?void 0!==dk[k]&&(d.add(g),e[d.length-1]=-dk[k]/256-2):0>l&&(c[g]=3)}}g=0;for(len=d.length;g<len;c[d[g]]=e[g++]);m.useProgram(xa);m.activeTexture(m.TEXTURE1);b=m.createTexture();m.bindTexture(m.TEXTURE_2D,b);m.texImage2D(m.TEXTURE_2D,0,m.R8I,F,ua,0,m.RED_INTEGER,m.BYTE,c);m.texParameteri(m.TEXTURE_2D,
m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.REPEAT);m.bindTexture(m.TEXTURE_2D,null);m.bindTexture(m.TEXTURE_2D,b);m.uniform1i(m.getUniformLocation(xa,"img_data"),1);m.useProgram(la);m.activeTexture(m.TEXTURE2)}else Lc.update=!0};Lc.update=!1;var c,ik,fg,Ae,Be,Ce,De,Ee,Fe,Ge,He,Ie,Je,Ke,Le,Sl=function(){var e={};c={move:function(){Q=Qb;Qb.cursor=
7}};c.move.iconID=262;c.move.obj={name:x.move};c.attack=function(){Q=nc};c.attack.iconID=250;c.attack.obj={name:x.attack};c.guard=function(){Gc(4)};c.guard.iconID=237;c.guard.obj={name:x.guard};c.patrol=function(){Gc(8)};c.patrol.iconID=238;c.patrol.obj={name:x.patrol};c.pickUp=function(){Q=wd};c.pickUp.iconID=240;c.pickUp.obj={name:x.pickItems};c.explore=function(){Gc(7)};c.explore.iconID=40;c.explore.obj={name:x.explore};c.stop=function(){fa(lh,0,G)};c.stop.iconID=160;c.stop.obj={name:x.stop};c.stand=
function(){fa(lj,0,G)};c.stand.iconID=27;c.stand.obj={name:x.stand};c.attackGround=function(){};c.attackGround.iconID=100;c.steady=function(){};c.steady.iconID=21;c.createOrk=function(){aa(58)};c.createOrk.iconID=120;c.createDwarf=function(){aa(59)};c.createDwarf.iconID=117;c.createSkeleton=function(){aa(60)};c.createSkeleton.iconID=87;c.createGhost=function(){aa(40)};c.createGhost.iconID=222;c.createFootman=function(){aa(0)};c.createFootman.iconID=182;c.createArcher=function(){aa(4)};c.createArcher.iconID=
185;c.createMaceman=function(){aa(3)};c.createMaceman.iconID=186;c.createPikeman=function(){aa(1)};c.createPikeman.iconID=183;c.createLongbowman=function(){aa(6)};c.createLongbowman.iconID=184;c.createKnight=function(){aa(19)};c.createKnight.iconID=180;c.iniMercenaries=function(b){b.mlist=[];b.mlistID=[];b.mercID=0;hh(b);b.setupINTV(Oh,b.id,2E3)};c.iniMercenaries.builds=[30];c.iniHeroes=function(b){b.hlist=[];b.hlistID=[];b.heroID=0;hh(b);b.setupINTV(Oh,b.id,2E3)};c.iniHeroes.builds=[30];c.mercFootmanArab=
function(){La()};c.mercFootmanArab.iconID=49;c.mercFootmanArab.unit=80;c.mercFootmanArab.obj={};c.mercArcherArab=function(){La()};c.mercArcherArab.iconID=52;c.mercArcherArab.unit=85;c.mercArcherArab.obj={};c.mercMacemanArab=function(){La()};c.mercMacemanArab.iconID=116;c.mercMacemanArab.obj={};c.mercMacemanArab.unit=83;c.mercPikemanArab=function(){La()};c.mercPikemanArab.iconID=52;c.mercPikemanArab.unit=82;c.mercPikemanArab.obj={};c.mercCavalry=function(){La()};c.mercCavalry.iconID=133;c.mercCavalry.unit=
84;c.mercCavalry.obj={};c.mercEnichar=function(){La()};c.mercEnichar.iconID=123;c.mercEnichar.unit=91;c.mercEnichar.obj={};c.mercJihad=function(){La()};c.mercJihad.iconID=236;c.mercJihad.unit=86;c.mercJihad.obj={};c.mercFootmanArab6=function(){cb()};c.mercFootmanArab6.iconID=49;c.mercFootmanArab6.unit=80;c.mercFootmanArab6.obj={};c.mercArcherArab6=function(){cb()};c.mercArcherArab6.iconID=52;c.mercArcherArab6.unit=85;c.mercArcherArab6.obj={};c.mercMacemanArab6=function(){cb()};c.mercMacemanArab6.iconID=
116;c.mercMacemanArab6.unit=83;c.mercMacemanArab6.obj={};c.mercPikemanArab6=function(){cb()};c.mercPikemanArab6.iconID=52;c.mercPikemanArab6.unit=82;c.mercPikemanArab6.obj={};c.mercCavalry6=function(){cb()};c.mercCavalry6.iconID=133;c.mercCavalry6.unit=84;c.mercCavalry6.obj={};c.mercEnichar6=function(){cb()};c.mercEnichar6.iconID=123;c.mercEnichar6.unit=91;c.mercEnichar6.obj={};c.mercJihad6=function(){cb()};c.mercJihad6.iconID=236;c.mercJihad6.unit=86;c.mercJihad6.obj={};c.mercFootman=function(){La()};
c.mercFootman.iconID=182;c.mercFootman.unit=0;c.mercArcher=function(){La()};c.mercArcher.iconID=185;c.mercArcher.unit=4;c.mercMaceman=function(){La()};c.mercMaceman.iconID=186;c.mercMaceman.unit=3;c.mercPikeman=function(){La()};c.mercPikeman.iconID=183;c.mercPikeman.unit=1;c.mercLongbowman=function(){La()};c.mercLongbowman.iconID=184;c.mercLongbowman.unit=6;c.mercKnight=function(){La()};c.mercKnight.iconID=180;c.mercKnight.unit=19;c.mercFootman6=function(){cb()};c.mercFootman6.iconID=182;c.mercFootman6.unit=
0;c.mercFootman6.obj={};c.mercArcher6=function(){cb()};c.mercArcher6.iconID=185;c.mercArcher6.unit=4;c.mercArcher6.obj={};c.mercMaceman6=function(){cb()};c.mercMaceman6.iconID=186;c.mercMaceman6.unit=3;c.mercMaceman6.obj={};c.mercPikeman6=function(){cb()};c.mercPikeman6.iconID=183;c.mercPikeman6.unit=1;c.mercPikeman6.obj={};c.mercLongbowman6=function(){cb()};c.mercLongbowman6.iconID=184;c.mercLongbowman6.unit=6;c.mercLongbowman6.obj={};c.mercKnight6=function(){cb()};c.mercKnight6.iconID=180;c.mercKnight6.unit=
19;c.mercKnight6.obj={};c.mercArcherAsian6=function(){cb()};c.mercArcherAsian6.iconID=53;c.mercArcherAsian6.unit=67;c.mercArcherAsian6.obj={};c.mercSamurai6=function(){cb()};c.mercSamurai6.iconID=122;c.mercSamurai6.unit=68;c.mercSamurai6.obj={};c.mercHourseSamurai6=function(){cb()};c.mercHourseSamurai6.iconID=121;c.mercHourseSamurai6.unit=70;c.mercHourseSamurai6.obj={};c.mercRonin6=function(){cb()};c.mercRonin6.iconID=54;c.mercRonin6.unit=66;c.mercRonin6.obj={};c.mercHorseArcher6=function(){cb()};
c.mercHorseArcher6.iconID=52;c.mercHorseArcher6.unit=69;c.mercHorseArcher6.obj={};c.mercChariot6=function(){cb()};c.mercChariot6.iconID=79;c.mercChariot6.unit=72;c.mercChariot6.obj={};c.mercArcherAsian=function(){La()};c.mercArcherAsian.iconID=53;c.mercArcherAsian.unit=67;c.mercArcherAsian.obj={};c.mercSamurai=function(){La()};c.mercSamurai.iconID=122;c.mercSamurai.unit=68;c.mercSamurai.obj={};c.mercHourseSamurai=function(){La()};c.mercHourseSamurai.iconID=121;c.mercHourseSamurai.unit=70;c.mercHourseSamurai.obj=
{};c.mercRonin=function(){La()};c.mercRonin.iconID=54;c.mercRonin.unit=66;c.mercRonin.obj={};c.mercHorseArcher=function(){La()};c.mercHorseArcher.iconID=52;c.mercHorseArcher.unit=69;c.mercHorseArcher.obj={};c.mercChariot=function(){La()};c.mercChariot.iconID=79;c.mercChariot.unit=72;c.mercChariot.obj={};c.createPeon=function(){aa(10)};c.createPeon.iconID=187;c.sameSpeed=function(){fa(Wg,G)};c.sameSpeed.iconID=82;c.restoreSpeed=function(){fa(sj,G)};c.restoreSpeed.iconID=88;c.createSpy=function(){aa(2)};
c.createSpy.iconID=162;c.emergeAllUnits=function(){var b=G[0];fa(xd,b,y[b].inventory.slice(0))};c.emergeAllUnits.iconID=261;c.techFeudalism=function(){H(12)};c.techFeudalism.iconID=233;c.techArchitecture=function(){H(13)};c.techArchitecture.iconID=226;c.techLearning=function(){H(14)};c.techLearning.iconID=129;c.createPeon1=function(){aa(64)};c.createPeon1.iconID=55;c.createPeon2=function(){aa(79)};c.createPeon2.iconID=132;c.createNinja=function(){aa(65)};c.createNinja.iconID=51;c.techArmoredChariot=
function(){H(51)};c.techArmoredChariot.iconID=79;c.techBuddhism=function(){H(45)};c.techBuddhism.iconID=127;c.techGreatWall=function(){H(48)};c.techGreatWall.iconID=80;c.ridingHorses=function(){H(49)};c.ridingHorses.iconID=64;c.irrigation=function(){H(50)};c.irrigation.iconID=72;c.createHorseArcher2=function(){aa(85)};c.createHorseArcher2.iconID=52;c.techMeditation=function(){H(52)};c.techMeditation.iconID=71;c.techKungFu=function(){H(53)};c.techKungFu.iconID=228;c.techTournaments=function(){H(54)};
c.techTournaments.iconID=73;c.techPhilosophy=function(){H(55)};c.techPhilosophy.iconID=68;c.techNinjas=function(){H(56)};c.techNinjas.iconID=56;c.techMastery=function(){H(57)};c.techMastery.iconID=69;c.techGoldMining=function(){H(1)};c.techGoldMining.iconID=58;c.techStoneMining=function(){H(2)};c.techStoneMining.iconID=57;c.createCrusaders=function(){fa(Ph,G[0],0)};c.createCrusaders.iconID=221;c.techFanaticism=function(){H(31)};c.techFanaticism.iconID=235;c.techCrusade=function(){H(32)};c.techCrusade.iconID=
93;c.techEspionage=function(){H(30)};c.techEspionage.iconID=215;c.techInquisition=function(){H(33)};c.techInquisition.iconID=97;c.techHealing=function(){H(34)};c.techHealing.iconID=219;c.healing=function(){Q=wh};c.healing.iconID=219;c.healing.iconIDbook=201;c.teach=function(){Q=Bh};c.teach.iconID=23;c.teach.iconIDbook=217;c.techBless=function(){H(36)};c.techBless.iconID=159;c.bless=function(){Q=If};c.bless.iconID=159;c.bless.iconIDbook=204;c.techMedicine=function(){H(35)};c.techMedicine.iconID=220;
c.createMage=function(){aa(5)};c.createMage.iconID=156;c.techBat=function(){H(38)};c.techBat.iconID=168;c.techGolem=function(){H(41)};c.techGolem.iconID=119;c.techInvisibility=function(){H(37)};c.techInvisibility.iconID=217;c.techLightning=function(){H(40)};c.techLightning.iconID=143;c.techFreeze=function(){H(39)};c.techFreeze.iconID=130;c.techHeroism=function(){H(22)};c.techHeroism.iconID=136;c.techWarfare=function(){H(23)};c.techWarfare.iconID=108;c.techTactics=function(){H(24)};c.techTactics.iconID=
257;c.techMercenaries=function(){H(25)};c.techMercenaries.iconID=95;c.techHeroes=function(){H(26)};c.techHeroes.iconID=96;c.techFame=function(){H(27)};c.techFame.iconID=111;c.techSiegeTactics=function(){H(28)};c.techSiegeTactics.iconID=258;c.techBodyBuilding=function(){H(29)};c.techBodyBuilding.iconID=101;c.createPriest=function(){aa(9)};c.createPriest.iconID=155;c.createCow=function(){aa(27)};c.createCow.iconID=163;c.techCropRotation=function(){H(8)};c.techCropRotation.iconID=227;c.techDomestication=
function(){H(7)};c.techDomestication.iconID=157;c.techMapMaking=function(){H(16)};c.techMapMaking.iconID=89;c.techTradeRoutes=function(){H(17)};c.techTradeRoutes.iconID=102;c.techTradeTaxes=function(){H(18)};c.techTradeTaxes.iconID=110;c.techUsury=function(){H(19)};c.techUsury.iconID=105;c.techSupplyStorage=function(){H(20)};c.techSupplyStorage.iconID=62;c.techBribery=function(){H(21)};c.techBribery.iconID=109;c.bribe=function(){};c.bribe.iconID=128;c.createCaravan=function(){aa(61)};c.createCaravan.iconID=
169;c.createCaravan2=function(){aa(90)};c.createCaravan2.iconID=134;c.createFootman2=function(){aa(80)};c.createFootman2.iconID=49;c.createArcher2=function(){aa(81)};c.createArcher2.iconID=43;c.createSatrap=function(){aa(83)};c.createSatrap.iconID=116;c.createPikeman2=function(){aa(82)};c.createPikeman2.iconID=42;c.createHorseArcher2=function(){aa(85)};c.createHorseArcher2.iconID=124;c.createCavalry=function(){aa(84)};c.createCavalry.iconID=133;c.createEnichar=function(){aa(91)};c.createEnichar.iconID=
123;c.createJihad=function(){aa(86)};c.createJihad.iconID=236;c.trade=function(){};c.trade.iconID=161;c.unload=function(){Q=uf};c.unload.iconID=148;c.createMercenaries=function(){ja(y[G[0]].mlist)};c.createMercenaries.iconID=95;c.createHeroes=function(){ja(y[G[0]].hlist)};c.createHeroes.iconID=96;c.upgradeGuildTower=function(){H(42)};c.upgradeGuildTower.iconID=171;c.upgradeStoneTower=function(){H(43)};c.upgradeStoneTower.iconID=178;c.upgradeCannonTower=function(){H(44)};c.upgradeCannonTower.iconID=
178;c.createCatapult=function(){aa(37)};c.createCatapult.iconID=152;c.createHeavyCatapult=function(){aa(39)};c.createHeavyCatapult.iconID=153;c.createBallist=function(){aa(38)};c.createBallist.iconID=154;c.techEngineering=function(){H(47)};c.techEngineering.iconID=92;c.techCannonTower=function(){H(46)};c.techCannonTower.iconID=178;c.techPlateArmor=function(){H(10)};c.techPlateArmor.iconID=131;c.techTemperIron=function(){H(4)};c.techTemperIron.iconID=266;c.techHalberd=function(){H(6)};c.techHalberd.iconID=
113;c.techScaleArmor=function(){H(5)};c.techScaleArmor.iconID=251;c.techChainMail=function(){H(9)};c.techChainMail.iconID=252;c.techLongbow=function(){H(0)};c.techLongbow.iconID=259;c.techWoodCutting=function(){H(3)};c.techWoodCutting.iconID=107;c.techCrossbow=function(){H(11)};c.techCrossbow.iconID=112;c.createFishingBoat=function(){aa(74)};c.createFishingBoat.iconID=48;c.createXebec=function(){aa(76)};c.createXebec.iconID=166;c.upgradeShip=function(){};c.upgradeShip.iconID=268;c.fishing=function(){};
c.fishing.iconID=41;c.createHulk=function(){aa(75)};c.createHulk.iconID=165;c.createGalleon=function(){aa(73)};c.createGalleon.iconID=164;c.techLandingTactics=function(){};c.techLandingTactics.iconID=98;c.techConcentration=function(){H(58)};c.techConcentration.iconID=75;c.techConfusion=function(){H(59)};c.techConfusion.iconID=76;c.techWhirlpool=function(){H(60)};c.techWhirlpool.iconID=78;c.techDragon=function(){H(61)};c.techDragon.iconID=115;c.techTurnToStone=function(){H(62)};c.techTurnToStone.iconID=
77;c.techFlameBolt=function(){H(63)};c.techFlameBolt.iconID=25;c.techJewelry=function(){H(64)};c.techJewelry.iconID=230;c.techBanking=function(){H(65)};c.techBanking.iconID=74;c.techChemistry=function(){H(66)};c.techChemistry.iconID=225;c.techSeaFood=function(){H(67)};c.techSeaFood.iconID=67;c.techGunPowder=function(){H(68)};c.techGunPowder.iconID=212;c.techRocketArrow=function(){H(69)};c.techRocketArrow.iconID=47;c.techBushido=function(){H(70)};c.techBushido.iconID=60;c.techLeadership=function(){H(71)};
c.techLeadership.iconID=114;c.techHonor=function(){H(72)};c.techHonor.iconID=94;c.techSunTzu=function(){H(73)};c.techSunTzu.iconID=66;c.createRonin=function(){aa(66)};c.createRonin.iconID=54;c.createArcher1=function(){aa(67)};c.createArcher1.iconID=53;c.createSamurai=function(){aa(68)};c.createSamurai.iconID=122;c.createHorseArcher1=function(){aa(69)};c.createHorseArcher1.iconID=52;c.createMonk=function(){aa(128)};c.createMonk.iconID=45;c.createMage1=function(){aa(129)};c.createMage1.iconID=50;c.createPriest1=
function(){aa(127)};c.createPriest1.iconID=44;c.createPriest2=function(){aa(87)};c.createPriest2.iconID=125;c.buyItems=function(){};c.buyItems.iconID=31;c.sellItems=function(){};c.sellItems.iconID=30;c.createHorseSamurai=function(){aa(70)};c.createHorseSamurai.iconID=121;c.createChariot=function(){aa(72)};c.createChariot.iconID=79;c.stopTech=function(){fa(nf,0,G);Oa(y[G[0]])};c.stopTech.iconID=160;c.repair=function(){Q=yd};c.repair.iconID=145;c.conquest=function(){};c.conquest.iconID=249;c.dcm=function(){Q=
fe};c.dcm.iconID=260;c.buildBarrack=function(){K(14)};c.buildBarrack.iconID=205;c.buildBarrack1=function(){K(71)};c.buildBarrack1.iconID=205;c.buildBarrack2=function(){K(102)};c.buildBarrack2.iconID=205;c.buildTower=function(){K(32)};c.buildTower.iconID=170;c.buildStorage=function(){K(18)};c.buildStorage.iconID=200;c.buildLumbermill=function(){K(15)};c.buildLumbermill.iconID=199;c.buildLumbermill2=function(){K(93)};c.buildLumbermill2.iconID=199;c.buildFields=function(){K(20)};c.buildFields.iconID=
265;c.buildCastle=function(){K(12)};c.buildCastle.iconID=206;c.buildCastle1=function(){K(62)};c.buildCastle1.iconID=206;c.buildCastle2=function(){K(63)};c.buildCastle2.iconID=206;c.buildAcademy=function(){K(17)};c.buildAcademy.iconID=204;c.buildCathedral=function(){K(11)};c.buildCathedral.iconID=191;c.buildCathedral2=function(){K(106)};c.buildCathedral2.iconID=189;c.buildMerchands=function(){K(24)};c.buildMerchands.iconID=198;c.buildMerchands2=function(){K(108)};c.buildMerchands2.iconID=198;c.buildChurch=
function(){K(25)};c.buildChurch.iconID=197;c.buildMarket=function(){K(33)};c.buildMarket.iconID=194;c.buildMageTower=function(){K(16)};c.buildMageTower.iconID=192;c.buildMageTower2=function(){K(107)};c.buildMageTower2.iconID=192;c.buildDummy=function(){K(36)};c.buildDummy.iconID=65;c.buildFarm=function(){K(23)};c.buildFarm.iconID=193;c.buildBlacksmith=function(){K(26)};c.buildBlacksmith.iconID=202;c.buildWorkshop=function(){K(29)};c.buildWorkshop.iconID=201;c.buildWorkshop2=function(){K(98)};c.buildWorkshop2.iconID=
201;c.buildStable=function(){K(28)};c.buildStable.iconID=196;c.buildStable2=function(){K(103)};c.buildStable2.iconID=196;c.buildTavern=function(){K(30)};c.buildTavern.iconID=208;c.buildHouse=function(){K(31)};c.buildHouse.iconID=195;c.buildHarbor=function(){K(41)};c.buildHarbor.iconID=188;c.buildOutpost=function(){K(34)};c.buildOutpost.iconID=158;c.buildWoodWall=function(){kh(13)};c.buildWoodWall.iconID=210;c.buildWoodGate=function(){};c.buildWoodGate.iconID=209;c.buildWoodGate.disabled=2;c.buildBridge=
function(){K(35)};c.buildBridge.iconID=176;fg="freeze invisibility lightning turnToStone bless healing".split(" ");c.freeze=function(){Q=Sf};c.freeze.iconID=99;c.freeze.obj={name:x.freeze};c.freeze.iconIDbook=205;c.confusion=function(){Q=Uf};c.confusion.iconID=76;c.confusion.obj={name:"Confusion",spcost:[120,0,0,0]};c.confusion.iconIDbook=206;c.turnToStone=function(){Q=vh};c.turnToStone.iconID=77;c.turnToStone.iconIDbook=213;c.turnToStone.obj={name:"Turn to Stone",spcost:[40,0,0,0]};c.whirlpool=function(){Q=
wj};c.whirlpool.iconID=78;c.whirlpool.iconIDbook=214;c.whirlpool.obj={name:"Whirlpool",spcost:[80,0,0,0]};c.flameBolt=function(){Q=Nf};c.flameBolt.iconID=25;c.flameBolt.obj={name:"Flame Bolt",spcost:[120,0,0,0]};c.flameBolt.iconIDbook=216;c.createDragon=function(){Q=zf};c.createDragon.iconID=115;c.createDragon.obj={name:"Spawn Dragon",spcost:[320,0,0,0]};c.createDragon.iconIDbook=215;c.lightning=function(){Q=zh};c.lightning.iconID=263;c.lightning.obj={name:x.lightning,spcost:[80,0,0,0]};c.lightning.iconIDbook=
200;c.createBat=function(){Q=Bf};c.createBat.iconID=168;c.createBat.iconIDbook=203;c.createGolem=function(){Q=xf};c.createGolem.iconID=119;c.createGolem.iconIDbook=209;c.autoInvisibility=function(){Q=Kf};c.autoInvisibility.iconID=217;c.autoInvisibility.obj={name:x.invisibility};c.invisibility=function(){Q=Kf};c.invisibility.iconID=217;c.invisibility.iconIDbook=208;c.impersonate=function(){Q=yh};c.impersonate.iconID=32;c.impersonate.obj={name:"Impersonate"};c.revealSelf=function(){fa(Aj,G[0],0)};c.revealSelf.iconID=
33;c.revealSelf.obj={name:"Reveal your true self"};c.buildHouse1=function(){K(111)};c.buildHouse1.iconID=195;c.buildHouse2=function(){K(92)};c.buildHouse2.iconID=195;c.buildLumbermill1=function(){K(112)};c.buildLumbermill1.iconID=199;c.buildStorage1=function(){K(113)};c.buildStorage1.iconID=200;c.buildStorage2=function(){K(94)};c.buildStorage2.iconID=200;c.buildFarm1=function(){K(114)};c.buildFarm1.iconID=193;c.buildFarm2=function(){K(95)};c.buildFarm2.iconID=193;c.buildHarbor1=function(){K(115)};
c.buildHarbor1.iconID=188;c.buildHarbor2=function(){K(96)};c.buildHarbor2.iconID=188;c.buildBlacksmith1=function(){K(116)};c.buildBlacksmith1.iconID=202;c.buildBlacksmith2=function(){K(97)};c.buildBlacksmith2.iconID=202;c.buildWorkshop1=function(){K(117)};c.buildWorkshop1.iconID=201;c.buildChurch1=function(){K(118)};c.buildChurch1.iconID=197;c.buildChurch2=function(){K(99)};c.buildChurch2.iconID=197;c.buildTavern1=function(){K(119)};c.buildTavern1.iconID=208;c.buildTavern2=function(){K(100)};c.buildTavern2.iconID=
208;c.buildMarket1=function(){K(120)};c.buildMarket1.iconID=194;c.buildMarket2=function(){K(101)};c.buildMarket2.iconID=194;c.buildStable1=function(){K(121)};c.buildStable1.iconID=196;c.buildOutpost1=function(){K(122)};c.buildOutpost1.iconID=158;c.buildOutpost2=function(){K(104)};c.buildOutpost2.iconID=158;c.buildCathedral1=function(){K(123)};c.buildCathedral1.iconID=190;c.buildMageTower1=function(){K(124)};c.buildMageTower1.iconID=192;c.createObjects=function(){le("magicworkshopmenu",ca)};c.createObjects.iconID=
20;c.createObjects.obj={};c.buildMagicWorkshop=function(){K(110)};c.buildMagicWorkshop.iconID=46;c.buildMerchands1=function(){K(125)};c.buildMerchands1.iconID=198;c.buildAcademy1=function(){K(126)};c.buildAcademy1.iconID=204;c.buildAcademy2=function(){K(109)};c.buildAcademy2.iconID=204;c.buildRocketTower=function(){K(57)};c.buildRocketTower.iconID=47;c.murder=function(){};c.murder.iconID=28;c.convertJihad=function(){};c.convertJihad.iconID=236;c.convertJihad.obj={};c.menuCommonBuild2=function(){ja(Ie)};
c.menuCommonBuild2.iconID=17;Ie=[c.buildFarm2,c.buildBlacksmith2,c.buildWorkshop2,c.buildStable2,c.buildTavern2,c.buildHouse2];Ie.menuName="a_build";c.menuCommonBuild2.xtra=Ie;c.menuSpecialBuild2=function(){ja(Je)};c.menuSpecialBuild2.iconID=15;Je=[c.buildCastle2,c.buildAcademy2,c.buildCathedral2,c.buildMerchands2,c.buildChurch2,c.buildMarket2,c.buildMageTower2,c.buildMagicWorkshop];Je.menuName="a_build";c.menuSpecialBuild2.xtra=Je;c.menuOtherBuild2=function(){ja(Ke)};c.menuOtherBuild2.iconID=16;
Ke=[c.buildHarbor2,c.buildOutpost2,c.buildWoodWall,c.buildWoodGate,c.buildBridge];Ke.menuName="e_build";c.menuOtherBuild2.xtra=Ke;c.menuBuilds2=function(){ja(Le)};c.menuBuilds2.iconID=245;Le=[c.menuSpecialBuild2,c.menuCommonBuild2,c.menuOtherBuild2,c.buildBarrack2,c.buildTower,c.buildStorage2,c.buildLumbermill2,c.buildFields];Le.menuName="a_build";c.menuBuilds2.xtra=Le;c.origin=qk;c.origin.iconID=255;c.createCarpet=function(){Q=Ff};c.createCarpet.iconID=146;c.createCarpet.iconIDbook=202;c.createJinn=
function(){Q=Df};c.createJinn.iconID=118;c.createJinn.iconIDbook=218;c.magicVision=function(){};c.magicVision.iconID=223;c.magicVision.iconIDbook=210;c.fireRain=function(){Q=Wf};c.fireRain.iconID=264;c.fireRain.iconIDbook=199;c.raiseDead=function(){Q=Pf};c.raiseDead.iconID=87;c.raiseDead.iconIDbook=211;c.createMage2=function(){aa(89)};c.createMage2.iconID=126;c.techCowPoaching=function(){H(74)};c.techCowPoaching.iconID=85;c.techHorseManShip=function(){H(75)};c.techHorseManShip.iconID=231;c.techScimitar=
function(){H(76)};c.techScimitar.iconID=84;c.techJihad=function(){H(77)};c.techJihad.iconID=236;c.techCarpet=function(){H(78)};c.techCarpet.iconID=146;c.techMagicWorkshop=function(){H(79)};c.techMagicWorkshop.iconID=86;c.techFireRain=function(){H(80)};c.techFireRain.iconID=264;c.techMagicVision=function(){H(81)};c.techMagicVision.iconID=224;c.techNecromancy=function(){H(82)};c.techNecromancy.iconID=87;c.techJinn=function(){H(83)};c.techJinn.iconID=118;c.techOreFloatation=function(){H(84)};c.techOreFloatation.iconID=
106;c.techRiddingHorses=function(){H(85)};c.techRiddingHorses.iconID=232;c.techJanissary=function(){H(86)};c.techJanissary.iconID=81;c.buildMagicItems=function(){};c.buildMagicItems.iconID=20;c.techSlavery=function(){H(87)};c.techSlavery.iconID=135;c.stopBuilding=function(){fa(ue,0,G)};c.stopBuilding.iconID=160;c.menuSpecialBuild1=function(){ja(Ae)};c.menuSpecialBuild1.iconID=15;Ae=[c.buildCastle1,c.buildAcademy1,c.buildCathedral1,c.buildMerchands1,c.buildChurch1,c.buildMarket1,c.buildMageTower1,
c.buildRocketTower,c.buildDummy];Ae.menuName="a_build";c.menuSpecialBuild1.xtra=Ae;c.menuCommonBuild1=function(){ja(Be)};c.menuCommonBuild1.iconID=17;Be=[c.buildFarm1,c.buildBlacksmith1,c.buildWorkshop1,c.buildStable1,c.buildTavern1,c.buildHouse1];Be.menuName="a_build";c.menuCommonBuild1.xtra=Be;c.menuSpecialBuild=function(){ja(Ce)};c.menuSpecialBuild.iconID=15;Ce=[c.buildCastle,c.buildAcademy,c.buildCathedral,c.buildMerchands,c.buildChurch,c.buildMarket,c.buildMageTower,c.buildDummy];Ce.menuName=
"e_build";c.menuSpecialBuild.xtra=Ce;c.menuCommonBuild=function(){ja(De)};c.menuCommonBuild.iconID=17;De=[c.buildFarm,c.buildBlacksmith,c.buildWorkshop,c.buildStable,c.buildTavern,c.buildHouse];De.menuName="e_build";c.menuCommonBuild.xtra=De;c.menuOtherBuild=function(){ja(Ee)};c.menuOtherBuild.iconID=16;Ee=[c.buildHarbor,c.buildOutpost,c.buildWoodWall,c.buildWoodGate,c.buildBridge];Ee.menuName="e_build";c.menuOtherBuild.xtra=Ee;c.menuOtherBuild1=function(){ja(Fe)};c.menuOtherBuild1.iconID=16;Fe=[c.buildHarbor1,
c.buildOutpost1,c.buildWoodWall,c.buildWoodGate,c.buildBridge];Fe.menuName="e_build";c.menuOtherBuild1.xtra=Fe;c.menuBuilds=function(){ja(Ge)};Ge=[c.menuSpecialBuild,c.menuCommonBuild,c.menuOtherBuild,c.buildBarrack,c.buildTower,c.buildStorage,c.buildLumbermill,c.buildFields];Ge.menuName="e_build";c.menuBuilds.iconID=245;c.menuBuilds.xtra=Ge;c.menuBuilds1=function(){ja(He)};c.menuBuilds1.iconID=245;He=[c.menuSpecialBuild1,c.menuCommonBuild1,c.menuOtherBuild1,c.buildBarrack1,c.buildTower,c.buildStorage1,
c.buildLumbermill1,c.buildFields];He.menuName="a_build";c.menuBuilds1.xtra=He;ik=function(){c.fishing.obj={};c.impersonate.obj={};c.techGreatWall.obj=B[48];c.revealSelf.obj={};c.trade.obj={};c.unload.obj={};c.mercFootman6.obj={};c.murder.obj={};c.mercArcher6.obj={};c.mercMaceman6.obj={};c.mercPikeman6.obj={};c.mercLongbowman6.obj={};c.sameSpeed.obj={name:"Same speed"};c.restoreSpeed.obj={name:"Restore speed"};c.mercKnight6.obj={};c.attackGround.obj={};c.steady.obj={};c.bribe.obj={};c.createPriest1.obj=
A[127];c.createPriest2.obj=A[87];c.createFootman2.obj=A[80];c.createArcher2.obj=A[81];c.createSatrap.obj=A[83];c.createPikeman2.obj=A[82];c.createHorseArcher2.obj=A[85];c.createCavalry.obj=A[84];c.createEnichar.obj=A[91];c.createJihad.obj=A[86];c.createMonk.obj=A[128];c.healing.obj={name:x.heal,spcost:[20,0,0,0]};c.bless.obj={name:x.bless,spcost:[20,0,0,0]};c.stopTech.obj={};c.conquest.obj={};c.dcm.obj={name:x.dcm};c.repair.obj={name:x.repair};c.menuOtherBuild.obj={};c.menuOtherBuild1.obj={};c.menuOtherBuild2.obj=
{};c.sellItems.obj={};c.buyItems.obj={};c.menuBuilds.obj={name:x.menuBuild};c.menuCommonBuild.obj={};c.menuSpecialBuild.obj={};c.techMastery.obj=B[57];c.techNinjas.obj=B[56];c.teach.obj={name:"Teach",spcost:[20,0,0,0]};c.techPhilosophy.obj=B[55];c.techKungFu.obj=B[53];c.techTournaments.obj=B[54];c.techMeditation.obj=B[52];c.menuCommonBuild1.obj={};c.menuCommonBuild2.obj={};c.createMage1.obj=A[129];c.menuSpecialBuild1.obj={};c.menuSpecialBuild2.obj={};c.menuBuilds1.obj={name:x.menuBuild};c.menuBuilds2.obj=
{name:x.menuBuild};c.stopBuilding.obj={};c.freeze.obj={name:x.freeze,spcost:[200,0,0,0]};c.invisibility.obj={name:x.invisibility,spcost:[40,0,0,0]};c.autoInvisibility.obj={name:x.invisibility};c.createHeroes.obj={};c.createMercenaries.obj={};c.upgradeShip.obj={};c.techMedicine.obj=B[35];c.techBless.obj=B[36];c.buildHouse1.obj=A[111];c.techHealing.obj=B[34];c.techInquisition.obj=B[33];c.techArmoredChariot.obj=B[51];c.techRocketArrow.obj=B[69];c.techJewelry.obj=B[64];c.techGunPowder.obj=B[68];c.techSeaFood.obj=
B[67];c.techChemistry.obj=B[66];c.techBanking.obj=B[65];c.createMage.obj=A[5];c.techBat.obj=B[38];c.techGolem.obj=B[41];c.techInvisibility.obj=B[37];c.techLightning.obj=B[40];c.techFreeze.obj=B[39];c.techHeroism.obj=B[22];c.createHorseSamurai.obj=A[70];c.createChariot.obj=A[72];c.createHorseArcher1.obj=A[69];c.createHorseArcher2.obj=A[85];c.createSamurai.obj=A[68];c.createArcher1.obj=A[67];c.techConfusion.obj=B[59];c.techConcentration.obj=B[58];c.techWhirlpool.obj=B[60];c.techDragon.obj=B[61];c.techTurnToStone.obj=
B[62];c.techFlameBolt.obj=B[63];c.createRonin.obj=A[66];c.buildStorage.obj=A[18];c.buildStorage1.obj=A[113];c.buildStorage2.obj=A[94];c.buildFields.obj=A[20];c.buildLumbermill.obj=A[15];c.buildLumbermill1.obj=A[112];c.buildLumbermill2.obj=A[93];c.buildTower.obj=A[32];c.buildBarrack1.obj=A[71];c.buildBarrack.obj=A[14];c.buildBarrack2.obj=A[102];c.buildDummy.obj=A[36];c.buildRocketTower.obj=A[57];c.buildMageTower.obj=A[16];c.buildMageTower1.obj=A[124];c.buildMageTower2.obj=A[107];c.buildMarket.obj=
A[33];c.buildMarket1.obj=A[120];c.buildMarket2.obj=A[101];c.buildChurch.obj=A[25];c.buildChurch1.obj=A[118];c.buildChurch2.obj=A[99];c.buildMerchands.obj=A[24];c.irrigation.obj=B[50];c.ridingHorses.obj=B[49];c.buildMerchands1.obj=A[125];c.buildMerchands2.obj=A[108];c.buildCathedral.obj=A[11];c.buildCathedral1.obj=A[123];c.buildCathedral2.obj=A[106];c.buildAcademy.obj=A[17];c.buildAcademy1.obj=A[126];c.buildAcademy2.obj=A[109];c.buildCastle.obj=A[12];c.magicVision.obj={name:"Magic Vision",spcost:[20,
0,0,0]};c.fireRain.obj={name:"Fire Rain",spcost:[200,0,0,0]};c.raiseDead.obj={name:"Raise the Dead",spcost:[40,0,0,0]};c.createJinn.obj={name:"Spawn Jinn",spcost:[320,0,0,0]};c.createCarpet.obj={name:"Spawn Magic Carpet",spcost:[320,0,0,0]};c.buildCastle1.obj=A[62];c.buildCastle2.obj=A[63];c.buildHouse.obj=A[31];c.buildHouse2.obj=A[92];c.buildTavern.obj=A[30];c.buildTavern1.obj=A[119];c.buildTavern2.obj=A[100];c.buildStable.obj=A[28];c.buildStable1.obj=A[121];c.buildStable2.obj=A[103];c.buildFarm.obj=
A[23];c.buildFarm1.obj=A[114];c.buildFarm2.obj=A[95];c.buildWorkshop.obj=A[29];c.buildWorkshop1.obj=A[117];c.buildWorkshop2.obj=A[98];c.buildBlacksmith.obj=A[26];c.buildBlacksmith1.obj=A[116];c.buildBlacksmith2.obj=A[97];c.buildBridge.obj=A[35];c.buildHarbor.obj=A[41];c.buildHarbor1.obj=A[115];c.buildHarbor2.obj=A[96];c.createMage2.obj=A[89];c.buildMagicItems.obj={};c.techJanissary.obj=B[86];c.techRiddingHorses.obj=B[85];c.techOreFloatation.obj=B[84];c.techJinn.obj=B[83];c.techNecromancy.obj=B[82];
c.techMagicVision.obj=B[81];c.techFireRain.obj=B[80];c.techMagicWorkshop.obj=B[79];c.techCarpet.obj=B[78];c.techJihad.obj=B[77];c.techScimitar.obj=B[76];c.techHorseManShip.obj=B[75];c.techCowPoaching.obj=B[74];c.buildWoodGate.obj={};c.buildWoodWall.obj=A[13];c.buildOutpost.obj=A[34];c.buildOutpost1.obj=A[122];c.buildOutpost2.obj=A[104];c.createGolem.obj={name:"Spawn Stone Golem",spcost:[480,0,0,0]};c.techSunTzu.obj=B[73];c.techBushido.obj=B[70];c.techLeadership.obj=B[71];c.techHonor.obj=B[72];c.createBat.obj=
{name:"Spawn Bat",spcost:[40,0,0,0]};c.techGoldMining.obj=B[1];c.techStoneMining.obj=B[2];c.emergeAllUnits.obj={};c.origin.obj={name:"Origin"};c.createOrk.obj=A[58];c.createDwarf.obj=A[59];c.createSkeleton.obj=A[60];c.createGhost.obj=A[40];c.createFootman.obj=A[0];c.createArcher.obj=A[4];c.techSlavery.obj=B[87];c.createMaceman.obj=A[3];c.createPikeman.obj=A[1];c.createLongbowman.obj=A[6];c.createKnight.obj=A[19];c.mercFootman.obj=e;c.mercArcher.obj=e;c.mercMaceman.obj=e;c.mercPikeman.obj=e;c.mercLongbowman.obj=
e;c.mercKnight.obj=e;c.createPeon.obj=A[10];c.createSpy.obj=A[2];c.techFeudalism.obj=B[12];c.techArchitecture.obj=B[13];c.techLearning.obj=B[14];c.createPeon1.obj=A[64];c.createPeon2.obj=A[79];c.createNinja.obj=A[65];c.techBuddhism.obj=B[45];c.createCrusaders.obj={name:"Preach a crusade",spcost:[1E3,0,2E3,0]};c.buildMagicWorkshop.obj=A[110];c.techFanaticism.obj=B[31];c.techCrusade.obj=B[32];c.techEspionage.obj=B[30];c.techChainMail.obj=B[9];c.techHalberd.obj=B[6];c.techLongbow.obj=B[0];c.techScaleArmor.obj=
B[5];c.techTemperIron.obj=B[4];c.techPlateArmor.obj=B[10];c.techLandingTactics.obj={};c.createGalleon.obj=A[73];c.createHulk.obj=A[75];c.createXebec.obj=A[76];c.createFishingBoat.obj=A[74];c.techCrossbow.obj=B[11];c.techWoodCutting.obj=B[3];c.techCannonTower.obj=B[46];c.techEngineering.obj=B[47];c.createBallist.obj=A[38];c.createHeavyCatapult.obj=A[39];c.createCatapult.obj=A[37];c.upgradeCannonTower.obj=B[44];c.upgradeStoneTower.obj=B[43];c.upgradeGuildTower.obj=B[42];c.createCaravan.obj=A[61];c.createCaravan2.obj=
A[90];c.techBribery.obj=B[21];c.techSupplyStorage.obj=B[20];c.techUsury.obj=B[19];c.techCropRotation.obj=B[8];c.createCow.obj=A[27];c.techDomestication.obj=B[7];c.techTradeTaxes.obj=B[18];c.techTradeRoutes.obj=B[17];c.techMapMaking.obj=B[16];c.createPriest.obj=A[9];c.techBodyBuilding.obj=B[29];c.techSiegeTactics.obj=B[28];c.techFame.obj=B[27];c.techHeroes.obj=B[26];c.techMercenaries.obj=B[25];c.techTactics.obj=B[24];c.techWarfare.obj=B[23];for(var b=Object.keys(c),d=0,f=b.length;d<f;d++){var g=c[b[d]];
g.objName=b[d];g.obj&&(g.obj.nu=g)}}},jg=function(c,b){var d=b.length,e=c.length,g=0;a:for(;g<d;g++){for(var h=0;h<e;h++)if(b[g+h]!==c[h])continue a;return g}return!1},Fk=function(c){for(var b=c.length,d=new Uint16Array(c.length),e=0;e<b;e++)d[e]=c.charCodeAt(e);return d},wc=function(c,b){return jg(Fk(c),b)+c.length},kg=function(c,b){c+=String.fromCharCode(0);return jg(Fk(c),b)},fi=function(c,b,d){var e="";for(b+=c;c<b&&d[c];c++)e+=String.fromCharCode(d[c]);return e},Oe=function(c){c=new Uint8Array(c);
var b=jg([50,109,122,116],c)+6,d=c[b]+256*c[b+1],e=c[b+2]+(c[b+3]<<8)+(c[b+4]<<16);P("mapx:",d,"units",e);P("header",c[wc(".header",c)],"description",c[wc(".description",c)],"kingdominfo",c[wc(".kingdominfo",c)],"diplomacy",c[wc(".diplomacy",c)],"forbidden.upgrades",c[wc(".forbidden.upgrades",c)],"tiles",c[wc(".tiles",c)]);P(c);b=2*d;d={mapx:d,mapy:d,arje:!1};var g="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12".split(" "),
h="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12 xx13 xx14 xx15 xx16 xx17 xx18 xx19 xx20 xx21 resource".split(" "),l=b/2,m=20480+2*l*l,k={};l=0;for(var n=c.length;l<n;l++){var q=c[l];k[q]||(k[q]=[]);k[q].push(l)}k=[];var r={56:!0,58:!0,88:!0,72:!0};l=m+1;for(n=c.length;l<n;l++)if(q=c[l],r[q]&&r[c[l+4]]){m={};q=72!==q?g:h;for(var u=l-2,w=0,x=q.length;w<x;w++){var y=q[w];"kingdom"==y||"race"==y?(m[y]=c[u],u++):(m[y]=
c[u]+256*c[u+1],u+=2)}l+=2*x-3;k.push(m)}d.allunits=k;d.allunits.length>e&&(d.allunits.length=e);e=d.allunits;b/=2;k=[];g=0;r=[];q=m=c[wc(".forbidden.upgrades",c)]+1;l=m*=512;for(h=c.length;l<h;l+=2){w=c[l];u=~~(l/512);for(n=8;n<b&&c[n+l]===(w+n/4)%256;n+=4);20<n&&(l=512*u,1==k.length&&(l=512*(u-(2-(u-q)%2))),n=c.slice(m,l),m-l&&(k[g++]=[m,l],r.push(n)),l+=512,2==k.length&&(l-=512),m=l)}k[g++]=[m,c.length];r={64:[k[0]],96:[k[0]],128:[k[0]],192:[k[1],k[0],k[2],k[3]],256:[k[1],k[0],k[2],k[3]],384:[k[1],
k[0],k[2],k[3],k[4],k[5],k[6]],512:[k[1],k[0],k[2],k[3],k[4],k[5],k[6],k[7],k[8],k[9]]}[b];P(k);k=new Uint8Array(b*b);m=new Uint8Array(b*b);n=g=0;for(q=r.length;n<q;n++)if(h=r[n],g<b*b)for(l=h[0],h=h[1];l<h;l+=2)k[g]=jm[c[l]]||0,m[g]=c[l+1],10<m[g]&&e.push({type:7,d:m[g]%31,x32:g%b,y32:~~(g/b)}),g++;d.terrain=k;e=(b="grass",kg("grass",c))||(b="summer",kg("summer",c))||(b="desert",kg("desert",c))||(b="snow",kg("snow",c));if("summer"==b||b)if("summer"==b||"desert"==b)b="grass";g=fi(512*(c[wc(".description",
c)]-1),512,c);d.description=g;d.author=fi(e-64,64,c);d.name=fi(e-128,64,c);d.terrainType=b;d.kingdoms=Oe.getKingdoms(c,d);Oe.getDiplomacy(c,d.kingdoms);P(d);Gk(d)};Oe.getKingdoms=function(c,b){for(var d=jg([192,4],c)+50;!c[d];)d++;var e="name tzar active resGold resStone resFood resWood x6 race x8 x9 x10 x11 x12 x13 x14 AI x16 x17 x18 x19 x20".split(" "),g=e.length,h=[],l,k=[[0,0,189],[206,25,25],[49,181,0],[173,0,197],[255,222,0],[0,181,181],[255,156,33],[90,90,90]];P("kingdoms:",d);b.tr={0:0,9:0,
10:0};for(var m=0;8>m;m++){for(var n={color:k[m]},q=!0,r=0;r<g;r++){var u=e[r];if("name"==u||"tzar"==u){for(n[u]="";!c[d];)d++;for(l=d+32;c[d];)n[u]+=String.fromCharCode(c[d]),d++;d=l}else n[u]=c[d]+(c[d+1]<<8)+(c[d+2]<<16)+(c[d+3]<<24),"race"==u&&(n[u]=c[d],n.racestr=Xf[c[d]-1]),2!=r||c[d]||(q=!1),d+=4}q&&(h.push(n),b.tr[m+1]=h.length);1<h.length&&(n.IA=1);n.resources=[n.resGold,n.resWood,n.resFood,n.resStone];n.race--}P(h);return h};Oe.getDiplomacy=function(c,b){for(var d=512*(c[wc(".diplomacy",
c)]-1),e=b.length,g=0;g<e;g++){var h=[0];if(b[g]){b[g].diplomacy=h;for(var l=1;9>l;l++){if(b[l-1]){var k=c[d];k=60>k&&l-1!=g?1:0;h.push(k)}d+=4}}else d+=32}};var jm={0:3,32:0,144:1,240:2,64:2},Yl={15:78,16:77,19:37,20:39,21:38,22:131,23:73,24:75,25:76,27:59,28:58,30:132,31:40,32:130,36:60,38:42,39:55,40:32,41:44,42:56,43:57,61:13,62:13,63:20,64:35,72:43,110:27,133:36,136:74,257:10,258:61,259:0,260:4,261:3,262:6,263:1,264:19,267:8,270:2,273:5,274:9,300:12,301:14,302:15,303:23,304:30,305:25,306:28,
307:18,308:34,309:33,310:41,311:11,312:17,314:26,315:29,316:16,321:24,322:31,513:79,514:90,515:80,516:81,517:83,519:82,522:85,529:89,530:87,541:91,545:86,547:84,556:63,557:102,558:93,559:95,560:100,561:99,562:103,563:94,564:104,565:101,566:96,568:109,570:97,571:98,572:107,577:108,578:92,581:110,583:106,769:64,771:66,772:67,773:68,778:69,780:128,781:65,785:129,786:127,802:70,805:72,812:62,813:71,814:112,815:114,816:119,817:118,818:121,819:113,820:122,821:120,822:115,824:126,826:116,827:117,828:124,
833:125,834:111,838:123,76:21,78:22},Zg=function(c,b,d,f){if(Nd&&!q.editor){var e=Nd.events.defined[b.id];if(e&&e[d])if(e=e[d],"zone"==d)for(c=0,f=e.length;c<f;c+=5){d=e[c];var h=e[c+2],l=e[c+3],k=e[c+4];b.x32>=e[c+1]&&b.x32<=l&&b.y32>=h&&b.y32<=k?(b.inZone||(b.inZone={}),b.inZone[d.id]||lg([e[c]],1),b.inZone[d.id]=1):b.inZone&&b.inZone[d.id]&&(b.inZone[d.id]=0,lg([e[c]],-1))}else{if(!f)return lg(e,c);P(f.name);b=e.defined;b[f.id]&&lg(b[f.id],c)}}},lg=function(c,b){for(var d=c.length,e=0;e<d;e++){var g=
c[e],h=g.rule,l=g.activeEvents;g.activeEvents+=b;0===l?h.activeEvents++:0===g.activeEvents&&h.activeEvents--;if(1==b&&h.activeEvents==h.events.length)for(g=0,h=h.actions,l=h.length;g<l;g++){var k=h[g];P("action:",k.type);if(Hk[k.type])Hk[k.type](k.to[0],k.list)}}},Hk={attack:nc,move:Qb},Kc={};r("selectUnits").onclick=function(){r("mapeditorinfoUnits").style.display="block";r("mapeditorinfoBuilds").style.display="none";r("mapeditorinfoItems").style.display="none";r("mapeditorinfoNature").style.display=
"none"};r("selectBuilds").onclick=function(){r("mapeditorinfoUnits").style.display="none";r("mapeditorinfoBuilds").style.display="block";r("mapeditorinfoItems").style.display="none";r("mapeditorinfoNature").style.display="none"};r("selectItems").onclick=function(){r("mapeditorinfoUnits").style.display="none";r("mapeditorinfoBuilds").style.display="none";r("mapeditorinfoItems").style.display="block";r("mapeditorinfoNature").style.display="none"};r("selectNature").onclick=function(){r("mapeditorinfoUnits").style.display=
"none";r("mapeditorinfoBuilds").style.display="none";r("mapeditorinfoItems").style.display="none";r("mapeditorinfoNature").style.display="block"};Kc.start=function(){Mb();var c=document.createElement("div");c.id="mapForm";c.innerHTML="\n            <div>\n            <h2>"+x.gameOptions+"</h2>\n            <table>\n<tr><td>"+x.mapSize+': </td><td><input type="number" id=\'editorSize\' min="10" value="256" /></td></tr>\n<tr><td>'+x.random+' </td><td>\n<label class="container">\n  <input type="checkbox" id="editorRandom">\n  <span class="checkmark"></span>\n</label>\n</td></tr>\n<tr><td>'+
x.nplayers+': </td><td><input id="editorPlayers" type="number" min="1" value="3"></td></tr>\n</table>\n</div>';var b=document.createElement("button");b.innerHTML=x.continue;b.onclick=Kc.func;c.children[0].appendChild(b);b=document.createElement("button");b.innerHTML=x.cancel;b.onclick=km;c.children[0].appendChild(b);document.body.appendChild(c)};var km=function(){location.hash="";setTimeout(Eh,200);document.body.removeChild(this.parentElement.parentElement);Ea()};Kc.func=function(){P(q.arje);if(void 0==
q.arje){Ea();r("editorRandom").checked?q.arje=555555*Math.random()+1:q.arje=!1;q.mapx=parseInt(r("editorSize").value);q.mapy=q.mapx;q.goldRes=Infinity;q.foodRes=Infinity;q.woodRes=Infinity;q.stoneRes=Infinity;q.gravity=580.9/9.8*9.8;J=[];for(var c=0,b=parseInt(r("editorPlayers").value);c<b;c++)J[c]={color:[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],IA:!1,name:"Tzar "+(c+1),race:0,team:0};document.body.removeChild(r("mapForm"))}q.editor=1;if(pd(0,Kc.func)){r("statButton").style.display=
"none";r("menu").style.display="none";r("resources").style.display="none";r("mapeditorinfotop").style.display="block";r("mapeditorinfo").style.display="block";var d=document.getElementById("mapeditorinfoUnits");d.style.display="block";mg();if(!Kc.preload){Kc.preload=!0;var f={},g={},h=A,l={euro:bb[0],arab:bb[1],asia:bb[2],common:x.common};f[bb[0]]=[];f[bb[1]]=[];f[bb[2]]=[];f[x.common]=[];g[bb[0]]=[];g[bb[1]]=[];g[bb[2]]=[];g[x.common]=[];c=0;for(b=h.length;c<b;c++){var k=h[c];!k.race||k.illegal||
7==k.type||k.item||(k.build?g[l[k.race]].put(c):f[l[k.race]].put(c))}for(k=0;2>k;k++){h=Object.keys(f);var m={};c=0;for(b=h.length;c<b;m={ul$20:m.ul$20},c++){var n=document.createElement("h1");n.innerHTML=h[c];m.ul$20=document.createElement("ul");n.onclick=function(b){return function(){Ig(b.ul$20)}}(m);m.ul$20.style.display="none";for(var v=f[h[c]],w=Object.keys(v),u={},y=0,z=w.length;y<z;u={tcreate:u.tcreate},y++)l=document.createElement("li"),l.innerHTML=A[v[w[y]]].name,u.tcreate=v[w[y]],l.onclick=
function(b){return function(){var c=b.tcreate;A[c].wall?kh(c):K(c)}}(u),m.ul$20.appendChild(l);d.appendChild(n);d.appendChild(m.ul$20)}f=g;d=r("mapeditorinfoBuilds")}h=Object.keys(Yb);d=r("mapeditorinfoItems");ul=document.createElement("ul");f={};c=0;for(b=h.length;c<b;f={u$21:f.u$21},c++)l=document.createElement("li"),f.u$21=Yb[h[c]],l.onclick=function(b){return function(){Di(b.u$21)}}(f),l.innerHTML=f.u$21.name,ul.appendChild(l);d.appendChild(ul);d=r("mapeditorinfoNature");n=document.createElement("h1");
n.innerHTML=x.trees;ul=document.createElement("ul");n.onclick=function(){Ig(ul)};ul.style.display="none";l=document.createElement("li");ul.appendChild(l);d.appendChild(n);d.appendChild(ul);l.onclick=function(){gi(lm)};l.innerHTML=x.delete;l=document.createElement("li");ul.appendChild(l);l.onclick=function(){gi(mm)};l.innerHTML=x.create;n=document.createElement("h1");n.innerHTML=x.terrain;var B=document.createElement("ul");n.onclick=function(){Ig(B)};B.style.display="none";d.appendChild(n);d.appendChild(B);
b=kc.texturesRandomMap;d={};c=0;for(b=b.length;c<b;d={l:d.l},c++)l=document.createElement("li"),B.appendChild(l),l.innerHTML=c,d.l=c,l.onclick=function(b){return function(){gi(hi);hi.active=b.l}}(d)}}};var mg=function(){var c=r("selectKingdom");c.innerHTML="";for(var b=1,d=E.length;b<d;b++){var f=E[b];1===b&&(c.style.background="rgba("+f.color[0]+","+f.color[1]+","+f.color[2]+",1)");c.innerHTML+='<option value="'+b+'" style="background:rgba('+f.color[0]+","+f.color[1]+","+f.color[2]+',1)">'+f.name+
"</option>"}};r("selectKingdom").onchange=function(){w.kingdom=parseInt(this.value);var c=E[w.kingdom].color;this.style.background="rgba("+c[0]+","+c[1]+","+c[2]+",.8)"};var Nl=function(c){Mb();var b=document.createElement("div"),d=document.createElement("div");b.id="unitProps";var e="<table>"+('\n<tr><td>Name </td><td><input data-prop="name" type="text" value="'+c.name+'" /></td></tr>\n<tr><td>'+x.health+' </td><td><input data-prop="health" type="number" value="'+c.health+'" /></td></tr>\n<tr><td>'+
x.maxHealth+'</td> <td><input data-prop="maxHealth" type="number" value="'+c.maxHealth+'" /></td></tr>\n');if(c.build||c.item)if(c.item){if(c.sword||c.shield)e+="\n<tr><td>"+x.attack+'</td><td><input data-prop="attack" type="number" value="'+(c.attack||0)+'" /></td></tr>\n<tr><td>'+x.defence+'</td> <td><input data-prop="defence" type="number" value="'+(c.defence||0)+'" /></td></tr>\n'}else c.kingdom&&(e+="<tr><td>"+x.kingdom+' </td><td><select id="selectKingdom2">'+r("selectKingdom").innerHTML+"</select></td></tr>");
else e+="\n<tr><td>"+x.attack+'</td><td><input data-prop="attack" type="number" value="'+(c.attack||0)+'" /></td></tr>\n<tr><td>'+x.defence+'</td> <td><input data-prop="defence" type="number" value="'+(c.defence||0)+'" /></td></tr>\n<tr><td>'+x.mana+' <td><input data-prop="mana" type="number" value="'+(c.mana||0)+'" /></td></tr>\n<tr><td>'+x.kingdom+' </td><td><select id="selectKingdom2">'+r("selectKingdom").innerHTML+"</select></td></tr>\n";d.innerHTML=e+"</table>";e=document.createElement("button");
e.innerHTML=x.ok;e.onclick=function(){for(var b=r("unitProps").getElementsByTagName("input"),d=0,e=b.length;d<e;d++)if(b[d]){var f=b[d].value;"number"==b[d].type&&(f=parseInt(f));var k=b[d].dataset.prop;c.__proto__[k]!=f&&(c[k]=f)}c.kingdom&&(b=parseInt(r("selectKingdom2").value),b!=c.kingdom&&c.changeKingdom(b));document.body.removeChild(r("unitProps"));Ea()};d.appendChild(e);b.appendChild(d);document.body.appendChild(b);P(c.kingdom);r("selectKingdom2")&&(r("selectKingdom2").value=c.kingdom)},oa=
function(c){document.getElementById(c).style.display="none"},Ta=function(c){document.getElementById(c).style.display="block"},Qh,gi=function(c){Qh=!0;Q=function(){};var b=W;b.img=k.blank;var d=32*Gd();b.wh=[d,d];$a(b);b.active=!0;document.addEventListener("mousemove",Ib);document.addEventListener("mousedown",Ik);Ib.active=c},Ik=function(c){if(2==c.buttons||c.pageX<w.menumx||c.pageY<w.menumy)return Jk();Ib(c)},Qj=function(c){if(q.editor){var b=parseInt(r("brushSize").value)+c;b>r("brushSize").max?
r("brushSize").value=r("brushSize").max:1>b?r("brushSize").value=1:(r("brushSize").value=b,W.wh&&(W.wh[0]+=32*c,W.wh[1]+=32*c,W.active=!0))}},Gd=function(){return parseInt(r("brushSize").value)},hi=function(c,b,d){c=Gd();for(var e=c*c,g=F,h=uc,l=hi.active,k=kc.type,m=0;m<e;m++){var n=b+m%c,q=d+~~(m/c);pa(n,q)&&(n+=q*g,h[n]=l,k[l]&&(2<O[n]&&y[O[n]].die(),2<Ma[n]&&y[Ma[n]].die()))}Lc()},mm=function(c,b,d){c=Gd();for(var e=c*c,g=F,h=0;h<e;h++){var l=b+h%c,k=d+~~(h/c);pa(l,k)&&(0===O[l+k*g]?.2>Math.random()&&
td([l+k*g,7,{d:3+~~(28*Math.random())}]):(l=y[O[l+k*g]],7==l.type&&l.die()))}},lm=function(c,b,d){c=Gd();for(var e=c*c,g=F,h=0;h<e;h++){var l=b+h%c,k=d+~~(h/c);pa(l,k)&&(l=y[O[l+k*g]],7==l.type&&l.die())}},Ib=function(c){var b=32*Gd();b=Sb(c.pageX-w.mx-.5*b/ba,c.pageY-.5*b/ba);var d=~~(.03125*b[1]);b=~~(.03125*b[0]);W.x=32*b;W.y=32*d;W.active=!0;if(0!==c.buttons){if(2==c.buttons)return Jk();Ib.last!==b+d*F&&Ib.active&&Ib.active(c,b,d);Ib.last=b+d*F}},Jk=function(){W.active=!0;W.x=-9999;W.y=-9999;
Qh=!1;if(Ib.active){var c=32*Gd();Sb(event.pageX-w.mx-.5*c/ba,event.pageY-.5*c/ba);Ib.active=!1}W.wh=void 0;document.removeEventListener("mousedown",Ik);document.removeEventListener("mousemove",Ib)};r("mapProps").onclick=function(){r("mapPropsWindow").style.display="block";Mb();if(""==r("mapPropsWindow").innerHTML){var c=document.createElement("div");r("mapPropsWindow").appendChild(c);var b=document.createElement("table");c.appendChild(b);b=document.createElement("div");b.innerHTML=x.mapName;var d=
document.createElement("input");d.value=q.name||x.strcusMap;d.id="mapName";d.type="text";c.appendChild(b);c.appendChild(d);b=document.createElement("div");b.innerHTML=x.description;d=document.createElement("textarea");d.type="text";d.value=q.description||"";d.id="mapDescription";c.appendChild(b);c.appendChild(d);b=document.createElement("div");b.innerHTML=x.author;d=document.createElement("input");d.id="mapAuthor";d.value=q.author||"";d.type="text";c.appendChild(b);c.appendChild(d);c.appendChild(document.createElement("p"));
b=document.createElement("button");b.onclick=Kk;b.innerHTML=x.close;c.appendChild(b)}ii()};var Kk=function(){P(this);this.parentElement.parentElement.style.display="none";Ea()},Mk={objAction:{id:"edobjAction",msg:x.objAction,func:function(){ya.active.type="attack";Ta("selectionEvents");oa("eventZone");Ta("unitListDiv2");r("byButton2").style.display="inline-block";r("byButton1").style.display="inline-block";ya.active.zone=void 0}},objZone:{id:"edobjAction",msg:x.objZone,func:function(){ya.active.type=
"zone";ya.active.to.length=0;oa("selectionEvents");r("eventZone").style.display="inline-block";oa("byButton2");oa("byButton1");oa("unitListDiv2");Lk()}}},Cd=function(c){if(c)oa("mapRulesWindow"),Ea(),Cd.actived=!0;else if(Cd.actived){Ta("mapRulesWindow");Mb();c=~~(R[0]/32);var b=~~(R[1]/32),d=~~(R[9]/32),e=~~(R[10]/32);if(c<d)var g=c,h=d;else g=d,h=c;if(b<e)var l=b,k=e;else l=e,k=b;ya.active.zone||(ya.active.zone=[]);ya.active.zone.put([g,l,h,k]);P(c,b,d,e);Lk();Cd.actived=!1}},Lk=function(){var c=
r("zoneList");c.innerHTML="";var b=ya.active.zone;if(b)for(var d=b.length,f=0;f<d;f++){var g=b[f],h=document.createElement("div"),l=document.createElement("button");l.innerHTML="x";l.obj=g;l.pObj=b;l.spObj=!0;l.onclick=ji;h.innerHTML=g[0]+"x "+g[1]+"y -> "+g[2]+"x "+g[3]+"y";h.appendChild(l);c.appendChild(h)}};r("mapRules").onclick=function(){r("mapRulesWindow").style.display="block";Mb();if(""==r("mapRulesWindow").innerHTML){var c=document.createElement("div");c.innerHTML='\n<div id="mapEvent">\n<h4>'+
x.events+'</h4>\n<select id="eventOptions" style="display:none">\n<option value="objAction">'+x.objAction+'</option>\n<option value="objZone">'+x.objZone+'</option>\n</select>\n<div id="eventScreen">\n</div>\n<div id="eventLayout">\n</div>\n<button id="addEvent">+</button>\n</div>\n<div id="mapActions">\n<h4>'+x.actions+'</h4>\n<select id="actionOptions" style="display:none">\n<option value="objOrder">'+x.objOrder+'</option>\n</select>\n<div id="actionScreen">\n</div>\n<div id="actionLayout">\n</div>\n<button id="addAction">+</button>\n</div>\n<h4>'+
x.rules+"</h4>\n";var b=document.createElement("div");b.id="rulist";c.appendChild(b);b=document.createElement("button");b.onclick=nm;b.innerHTML="+";c.appendChild(b);b.id="addRule";c.appendChild(document.createElement("p"));b=document.createElement("button");b.onclick=Kk;b.innerHTML=x.close;c.appendChild(b);r("mapRulesWindow").appendChild(c);r("addEvent").onclick=om;r("addAction").onclick=pm;r("eventOptions").onchange=function(){var b=Mk[this.value];ya.div=b.id;Ta(ya.div);ya.active.name=this.value;
b.func&&b.func();b=r("eventScreen").getElementsByTagName("button");for(var c=!1,d=0,e=b.length;d<e;d++){var f=b[d];if(f.sdiv)if("none"==f.style.display)f.sdiv.style.display="none";else{if(!c)f.onclick();c=!0}}ng(Jb.active,"eventLayout")};r("actionOptions").onchange=function(){Va.active.name=this.value;ng(Jb.active,"actionLayout")};c=document.createElement("div");c.id="edobjAction";var d=document.createElement("select");d.innerHTML='\n<option value="attack">'+x.attack+'</option>\n<option value="destroy">'+
x.destroy+'</option>\n<option value="moving">'+x.moving+'</option>\n<option value="capture">'+x.capture+"</option>\n";d.value="attack";d.id="selectionEvents";d.onchange=qm;var f=document.createElement("section"),g=document.createElement("section"),h=document.createElement("section"),l=document.createElement("section"),k=document.createElement("section");b=document.createElement("button");b.innerHTML=x.add;b.onclick=Cd;var m=document.createElement("div");m.className="unitList";m.id="zoneList";h.appendChild(b);
h.appendChild(m);m=document.createElement("div");m.className="unitList";m.id="unitListDiv";m.spType=ya;b=document.createElement("button");b.innerHTML=x.add;b.onclick=function(){Gb(this)};b.button=m;b.style.margin="10px";f.appendChild(b);b=document.createElement("button");b.innerHTML=x.defined;b.onclick=ob;b.sdiv=f;c.appendChild(b);b.onclick();b=document.createElement("button");b.innerHTML=x.undefined;b.onclick=ob;b.sdiv=g;c.appendChild(b);f.appendChild(m);c.appendChild(f);c.appendChild(g);c.appendChild(document.createElement("p"));
c.appendChild(d);c.appendChild(document.createElement("p"));m=document.createElement("div");m.className="unitList";m.id="unitListDiv2";m.spType=ya;b=document.createElement("button");b.innerHTML=x.add;b.onclick=function(){Gb(this)};b.button=m;b.style.margin="10px";l.appendChild(b);b=document.createElement("button");b.innerHTML=x.defined;b.onclick=ob;b.sdiv=l;b.id="byButton1";c.appendChild(b);b=document.createElement("button");b.innerHTML=x.undefined;b.onclick=ob;b.id="byButton2";b.sdiv=k;c.appendChild(b);
l.appendChild(m);b=document.createElement("button");b.innerHTML=x.zone;b.onclick=ob;b.sdiv=h;b.id="eventZone";b.style.display="none";c.appendChild(b);c.appendChild(h);c.appendChild(l);c.appendChild(k);r("eventScreen").appendChild(c);oa("mapEvent");oa("mapActions");c=document.createElement("div");c.id="edobjOrder";d=document.createElement("select");d.innerHTML='\n<option value="move">'+x.move+'</option>\n<option value="attack">'+x.attack+"</option>\n";d.value="move";d.id="selectionActions";d.onchange=
rm;f=document.createElement("section");g=document.createElement("section");l=document.createElement("section");k=document.createElement("section");m=document.createElement("div");m.className="unitList";m.id="unitListDivAction";m.spType=Va;b=document.createElement("button");b.innerHTML=x.add;b.onclick=function(){Gb(this)};b.button=m;b.style.margin="10px";f.appendChild(b);b=document.createElement("button");b.innerHTML=x.defined;b.onclick=ob;b.sdiv=f;c.appendChild(b);b=document.createElement("button");
b.innerHTML=x.undefined;b.onclick=ob;b.sdiv=g;c.appendChild(b);f.appendChild(m);c.appendChild(f);c.appendChild(g);b.onclick();c.appendChild(document.createElement("p"));c.appendChild(d);c.appendChild(document.createElement("p"));m=document.createElement("div");m.className="unitList";m.id="unitListDivAction2";m.spType=Va;b=document.createElement("button");b.innerHTML=x.add;b.onclick=function(){Gb(this)};b.button=m;b.style.margin="10px";l.appendChild(b);b=document.createElement("button");b.innerHTML=
x.defined;b.onclick=ob;b.sdiv=l;b.id="toButton1";c.appendChild(b);b=document.createElement("button");b.innerHTML=x.undefined;b.onclick=ob;b.id="toButton2";b.sdiv=k;c.appendChild(b);l.appendChild(m);c.appendChild(l);c.appendChild(k);b.onclick();r("actionScreen").appendChild(c);oa("mapEvent");oa("mapActions")}};var Nk={moving:1},qm=function(){Nk[this.value]?(oa("byButton2"),oa("byButton1"),oa("unitListDiv2")):(Ta("unitListDiv2"),r("byButton2").style.display="inline-block",r("byButton1").style.display=
"inline-block");ya.active.type=this.value},rm=function(){Nk[this.value]?(oa("toButton2"),oa("toButton1"),oa("unitListDivAction2")):(Ta("unitListDivAction2"),r("toButton2").style.display="inline-block",r("toButton1").style.display="inline-block");Va.active.type=this.value},Gb=function(c){if(c)oa("mapRulesWindow"),Ea(),Gb.actived=c.button;else if(Gb.actived){Ta("mapRulesWindow");Mb();c=Gb.actived.spType.active;c="unitListDiv2"==Gb.actived.id||"unitListDivAction2"==Gb.actived.id?c.to:c.list;for(var b=
{},d=0,e=c.length;d<e;d++)b[c[d]]=1;d=0;for(e=G.length;d<e;d++)b[G[d]]||c.put(G[d]);Pe(Gb.actived,c);Gb.actived=!1}},Pe=function(c,b){c.innerHTML="";for(var d=0,e=b.length;d<e;d++){var g=document.createElement("div");g.innerHTML=y[b[d]].name;var h=document.createElement("button");h.onclick=ji;h.innerHTML="x";h.pObj=b;h.spObj=!0;h.obj=b[d];g.appendChild(h);c.appendChild(g)}},ob=function(){ob.active&&(ob.active.className="");ob.active=this;this.className="spSelect";for(var c=this.parentElement.getElementsByTagName("section"),
b=0,d=c.length;b<d;b++)c[b].style.display="none";this.sdiv.style.display="block"},Jb=function(){var c=this.editorRule;c.deleted||(Ta("mapEvent"),Ta("mapActions"),oa("eventOptions"),Jb.active&&(Jb.div.className=""),this.className="spSelect",Jb.active=c,Jb.div=this,ng(c,"eventLayout"),ng(c,"actionLayout"),ya.div&&oa(ya.div),ya.div1=void 0)},ya=function(){var c=this.editorRule;c.deleted||(Ta("eventOptions"),ya.div1&&(ya.div1.className=""),this.className="spSelect",ya.active=c,r("selectionEvents").value=
c.type,ya.div1=this,r("eventOptions").value=c.name,ya.div=Mk[c.name].id,Ta(ya.div),Pe(r("unitListDiv"),c.list),Pe(r("unitListDiv2"),c.to))},Va=function(){var c=this.editorRule;c.deleted||(Ta("actionOptions"),Va.div1&&(Va.div1.className=""),this.className="spSelect",Va.active=c,r("selectionActions").value=c.type,Va.div1=this,r("actionOptions").value=c.name,Va.div="ed"+c.name,Ta(Va.div),Pe(r("unitListDivAction"),c.list),Pe(r("unitListDivAction2"),c.to))},ng=function(c,b){r(b).innerHTML="";if("eventLayout"==
b){c=c.events;var d=ya,e=Jb.active.events}else c=c.actions,d=Va,e=Jb.active.actions;for(var g=0,h=c.length;g<h;g++){var l=document.createElement("div");og(l,c[g],d,e);r(b).appendChild(l)}},om=function(){var c=Jb.active,b={name:"objAction",list:[],to:[],type:"attack"};c.events.put(b);var d=document.createElement("div");og(d,b,ya,c.events);r("eventLayout").appendChild(d);if(ya.div1)ya.div1.onclick()},pm=function(){var c=Jb.active,b={name:"objOrder",list:[],to:[],type:"move"};c.actions.put(b);var d=
document.createElement("div");og(d,b,Va,c.actions);r("actionLayout").appendChild(d);if(Va.div1)Va.div1.onclick()},og=function(c,b,d,f){c.innerHTML=b.events?b.name:x[b.name];c.onclick=d;c.editorRule=b;d=document.createElement("button");d.innerHTML="x";d.obj=b;d.pObj=f;d.onclick=ji;c.appendChild(d)},nm=function(){q.rules||(q.rules=[]);var c={name:"Rule"+q.rules.length,events:[],actions:[]};q.rules.put(c);var b=document.createElement("div");og(b,c,Jb,q.rules);r("rulist").appendChild(b)},ji=function(){this.pObj.quit(this.obj);
this.obj.deleted=!0;this.parentElement.parentElement.removeChild(this.parentElement);if(!this.spObj)if(this.pObj!==q.rules)Jb.div.onclick();else oa("mapEvent"),oa("mapActions")};r("infiniteValue").onchange=function(){var c=this.checked;r("goldValue").disabled=c;r("stoneValue").disabled=c;r("woodValue").disabled=c;r("foodValue").disabled=c};r("infiniteValue").onchange();var ii=function(){var c=r("mapPropsWindow").getElementsByTagName("table")[0];c.innerHTML="";c.innerHTML+="<tr><td>"+x.color+"</td><td>"+
x.username+"</td><td>"+x.gold+"</td><td>"+x.wood+"</td><td>"+x.food+"</td><td>"+x.stone+"</td><td>"+x.AI+"</td><td>"+x.team+"</td></tr>";for(var b=1,d=E.length;b<d;b++){var f=E[b],g=f.color,h=f.resources;g="#"+(16777216+(g[0]<<16)+(g[1]<<8)+g[2]).toString(16).slice(1);c.innerHTML+='<tr><td><input style="background:'+g+'" type="color" value="'+g+'" /></td><td><input type="text" value="'+f.name+'"></td>\n\n<td><input type="text" class="res" value="'+(parseInt(h[0])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+
(parseInt(h[1])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[2])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[3])||"\u221e")+'"></td>\n<td><label class="container">\n  <input type="checkbox">\n  <span class="checkmark"></span>\n</label></td><td><input type="number" min="0" value="'+f.team+'"></td></tr>'}c.innerHTML+="<tr><td><button id='editorAdd'>+</button><button id='editorDelete'>-</button></td></tr>";r("editorAdd").onclick=sm;r("editorDelete").onclick=
tm;c=c.getElementsByTagName("input");b=0;for(d=E.length-1;b<d;b++)h=8*b,f=E[b+1],c[h].onchange=um,c[h+1].onchange=vm,c[h+2].onchange=pg,c[h+3].onchange=pg,c[h+4].onchange=pg,c[h+5].onchange=pg,c[h+2].res=0,c[h+3].res=1,c[h+4].res=2,c[h+5].res=3,c[h+6].onchange=wm,c[h+6].checked=f.IA,c[h+7].onchange=xm,c[h].team=b+1,c[h+1].team=b+1,c[h+2].team=b+1,c[h+3].team=b+1,c[h+4].team=b+1,c[h+5].team=b+1,c[h+6].team=b+1,c[h+7].team=b+1},pg=function(){var c=parseInt(this.value);c||(c=Infinity,this.value="\u221e");
E[this.team].resources[this.res]=c},sm=function(){new Nb("Tzar "+E.length,[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],[0],0,!0,[q.goldRes,q.woodRes,q.foodRes,q.stoneRes],2);mg();ii()},tm=function(){if(2<E.length){for(var c=E.length-1,b=3,d=y.length;b<d;b++){var f=y[b];f.kingdom==c&&f.die()}E.length--;mg();ii()}},um=function(){var c=E[this.team],b=parseInt(this.value.substr(1),16),d=b>>16&255,f=b>>8&255;b&=255;c.color=[d,f,b];var g=this.team;c=hb[g];E[g].color=[d,f,b];g*=3;
Ia[g]=d/255;Ia[g+1]=f/255;Ia[g+2]=b/255;d=0;for(f=c.length;d<f;d++){b=c[d];g=0;for(var h=b.length;g<h;g++)rc(y[b[g]])}mg()},vm=function(){E[this.team].name=this.value},wm=function(){E[this.team].IA=this.checked?!0:!1},xm=function(){var c=E[this.team];c.team=parseInt(this.value);for(var b=E.length,d=1;d<b;d++){var f=E[d];f.team!==c.team&&(f.diplomacy[c.k]=1,c.diplomacy[f.k]=1)}};ve.onchange=function(c){fa(sh,parseInt(ve.value)/100,G)};r("mapload").accept=".tzared,.wmp";r("mapload").onchange=function(c){c=
document.getElementById("mapload").files[0];var b=c.name.split(".");b=b[b.length-1];var d=new FileReader;d.onload=function(){var c=new Uint8Array(this.result);if("wmp"==b)return Oe(c);P(c[0]);var d=c[1]+(c[2]<<8)+(c[3]<<16)+(c[4]<<24),e=new TextDecoder("utf-8");e=JSON.parse(e.decode(c.slice(5,d+5)));if(!1===e.arje){c=c.slice(d+5,d+5+Math.pow(e.mapx,2));var l=Math.pow(e.mapx,2);d=c.length;l=l?new Uint8Array(l):[];for(var k=0,m=0;m<d;m++){var n=c[m];if(255!==n)l[k++]=n;else{n=c[m-1];for(var q=(c[m+
1]<<8)+c[m+2],r=0;r<q;r++)l[k++]=n;m+=2}}e.terrain=l}e.allunits&&(e.allunits=vk(e.allunits));e.ini&&(e.ini=vk(e.ini));Gk(e)};d.readAsArrayBuffer(c)};var Ca,Gk=function(c){Ta("customMapcont");r("editCustom").style.display="inline-table";Ca=c;Ca.kingdomStart?(r("seeStats").style.display="inline-table",r("playrecord").style.display="inline-table"):(r("seeStats").style.display="none",r("playrecord").style.display="none");null===Ca.goldRes&&(Ca.goldRes=Infinity);null===Ca.stoneRes&&(Ca.stoneRes=Infinity);
null===Ca.foodRes&&(Ca.foodRes=Infinity);null===Ca.woodRes&&(Ca.woodRes=Infinity);c=document.getElementById("custombody");c.innerHTML="";for(var b=Ca.kingdoms,d=0,e=b.length;d<e;d++){var g=b[d],h=g.color,l=g.team;void 0==l&&(l="");c.innerHTML+="<tr><td style='background:rgb("+h[0]+","+h[1]+","+h[2]+')\' class="ucolor1"></td><td class="username1">'+g.name+'</td><td style="display:none" class="race1">'+g.race+'</td><td class="team1">'+l+"</td></tr>"}},ym=function(c){var b={Blue:189,Red:13506841,Green:3257600,
Purple:11337925,Yellow:16768512,Cyan:46517,Orange:16751649,Gray:5921370},d=c.split(["[Player"]),e=c.split("GameDuration =")[1].split("[")[0].split(" min")[0].split(" ")[1],g=[];c=[];for(var h=1,l=d.length;h<l;h++){var k=d[h].split("\n"),m={};g[h-1]=m;for(var n=0,q=k.length;n<q;n++){var r=k[n];r=r.split(" = ");if(r[1]&&n){r[1]=r[1].trim();"Color"==r[0]&&(r[1]=b[r[1]]);"Type"==u&&"Status"!==r[0]&&c.put("N");r[1]=encodeURIComponent(r[1]);c.put(r[1]);m[r[0]]=r[1];var u=r[0]}}}b=g[0].Name+"'s Game";var w=
new XMLHttpRequest;w.open("POST",baseUrl+"php/stats.php",!0);w.setRequestHeader("Content-type","application/x-www-form-urlencoded");w.onreadystatechange=function(){200===w.status&&4===w.readyState&&(location.hash="MatchX"+w.responseText)};c=c.join("<");w.send("arr="+c+"&time="+6E4*e+"&name="+b+"&players="+g.length)},ki=function(c,b){for(var d=0,e=0,g=c.length;e<g;e++)d+=b[c[e]];return d},li=function(c,b,d){var e=["",d];performance.now();for(var g=0,h=c.length;g<h;g++){var l=c[g],k=l.stats,m=k.resources,
n=k.unitCountMax,q=24*g+2,w=l.color,u=l.IA;u=u?"IA":"Human";e[q]=(w[0]<<16)+(w[1]<<8)+w[2];e[q+1]=l.name;e[q+1]=l.name;e[q+2]=u;e[q+3]=l.status;e[q+4]=l.team;e[q+5]=bb[l.race];e[q+6]=k.score;e[q+7]=m[0];e[q+8]=m[1];e[q+9]=m[2];e[q+10]=m[3];e[q+11]=k.dmgInflicted;e[q+12]=k.dmgTaken;e[q+13]=k.unitsKilled;e[q+14]=k.unitsLosed;e[q+15]=k.buildsDestroyed;e[q+16]=k.buildsLosed;e[q+17]=ki([10,79,64],n);e[q+18]=ki([32,44],n);e[q+19]=ki([55,56],n);e[q+20]=0;e[q+21]=0;e[q+22]=0;e[q+23]=0}Ok(e,b);b&&setTimeout(function(){"block"==
r("ingameStats").style.display&&li(c,b,d)},500)},Ok=function(c,b){for(var d="<tr style='background:#000;'><td style='    padding-right: 150px;'>Name</td><td>Type</td><td>Status</td><td>Team</td><td>Race</td><td>Score</td><td>Gold</td><td>Wood</td><td>Food</td><td>Stone</td><td title='Damage Inflicted'>D.I</td><td title='Damage Taken'>D.T</td><td title='Units Killed'>U.K</td><td title='Units Losed'>U.L</td><td title='Buildings Destroyed'>B.D</td><td title='Buildings Losed'>B.L</td><td title='Maximum Peasants'>M.P</td><td title='Maximum Towers'>M.T</td><td title='Maximum Stone Towers'>M.S.T</td><td title='Gold Traded'>G.T</td><td title='Stone Traded'>S.T</td><td title='Gold Converted'>G.C</td><td title='Stone Converted'>S.C</td></tr>",
e=2,g=c.length;e<g;e++)if((e-2)%24)0!==(e-3)%24&&(h=~~((e-2)/24)%2?"style = 'background:rgba(0,0,0,0.45)'":"style = 'background:rgba(0,0,0,0.65)'"),d+="<td "+h+">"+nb(decodeURIComponent(c[e]))+"</td>";else{e-2&&(d+="</tr>");h=parseInt(nb(decodeURIComponent(c[e])));var h="style = 'background:rgba("+Math.floor(h/65536)+","+Math.floor(h/256)%256+","+h%256+",0.45)'";d+="<tr>"}d+="</tr>";b?(r("ingameStats").style.display="block",r("statsGame").innerHTML="<tbody>"+d+"</tbody>",b=r("statsGame").getElementsByTagName("td")):
(r("MatchX").style.display="block",r("returnmenu").style.display="block",r("statsTable").innerHTML="<tbody>"+d+"</tbody>",b=r("statsTable").getElementsByTagName("td"));c=[];e=0;for(g=b.length;e<g;e++)d=e%23,4<d&&23<e&&(c[d-5]||(c[d-5]=[]),c[d-5].put(b[e]));e=0;for(g=c.length;e<g;e++){b=c[e];b.sort($k);d=b.length;if(!b[1])break;b[0].innerHTML!=b[1].innerHTML&&(b[0].style.background="rgba(127,0,0,0.45)");b[d-1].innerHTML!=b[d-2].innerHTML&&(b[d-1].style.background="rgba(0,127,0,0.45)")}};r("statsLoad").onchange=
function(){var c=document.getElementById("statsLoad").files[0],b=new FileReader;b.onloadend=function(b){ym(b.target.result)};c&&b.readAsText(c,"ascii")};var Zk=function(c){var b=new XMLHttpRequest;b.open("POST",baseUrl+"php/loadstat.php",!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");Pk(b,function(b){Ok(b.responseText.split("<"))});P(c);b.send("id="+c)},Pk=function(c,b){c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b(c):alert("Error: "+c.status))}};
r("deleteUnit").onclick=function(){fa(ue,1,G.slice(0))};r("rotatebutton").onclick=function(){for(var c=G,b=0,d=c.length;b<d;b++){var f=y[c[b]];f.build||(f.d=(f.d+1)%8,Z(f,f.img))}};r("gameMenu").onclick=ui;r("menueditor").onclick=ui;r("quitButton1").onclick=function(){Ci("playingMenu");q.online&&Xh();J.length=0;G=[];Ya=void 0;clearInterval(df);E=[];jc={};Uh=8;Ea();q={canceled:!0};J.length=0;y=[{terrain:1},{terrain:1},{terrain:1}];Rc={};Qc={};ic={};Fb.length=0;hb=[];Cb=[];Ia=[];w.admin=!1;yb=w.kingdom=
void 0;Jj={euro:0,arab:0,asia:0};Fa.stop();dd=document.getElementById("msgs");ig=document.getElementById("msginput");window.removeEventListener("mousemove",Kb);window.removeEventListener("keydown",Uj);window.removeEventListener("keyup",Vj);window.removeEventListener("mousemove",Wj);window.removeEventListener("mousedown",Xj);window.removeEventListener("mouseup",Yj);bc();document.getElementById("playermenu").style.display="block";document.getElementById("playingMenu").style.display="none"};r("backToGame").onclick=
function(){r("playingMenu").style.display="none";Ea()};r("backToGameS").onclick=function(){Ci("ingameStats");Ea()};r("statButton").onclick=function(){li(E.slice(1),!0,q.now());Mb()};r("returnmenu1").onclick=bc;r("returnmenu").onclick=bc;r("refreshButton1").onclick=Hg;r("sendmsg").onclick=Hh;r("start1").onclick=xk;r("start2").onclick=pd;r("alertok").onclick=function(){r("alert").style.display="none";Ea()};r("saveGame").onclick=function(){q.editor&&(q.arje=!1,r("mapDescription")&&(q.description=r("mapDescription").value,
q.name=r("mapName").value,q.author=r("mapAuthor").value));delete q.terrain;var c=q,b=y,d=[];d.length=b.length-3;for(var f=3,g=b.length;f<g;f++){var h=b[f],l=A[h.type],k={0:h.kingdom,1:h.d,2:h.type,3:h.img,4:h.x32,5:h.y32};h.name!==l.name&&(k[6]=h.name);h.iconID!==l.iconID&&(k[7]=h.iconID);h.attack!==l.attack&&(k[8]=h.attack);h.defence!==l.defence&&(k[9]=h.defence);h.level!==l.level&&(k[10]=h.level);h.health!==l.health&&(k[11]=h.health);h.maxHealth!==l.maxHealth&&(k[12]=h.maxHealth);h.func&&(k[13]=
h.func);h.funcObj&&(k[14]=h.funcObj);h.workers&&h.workers.length&&(k[15]=h.workers);h.workingOn&&(k[16]=h.workingOn);h.inventory&&h.inventory.length&&(k[17]=h.inventory);h.dix&&(k[18]=h.dix);h.diy&&(k[19]=h.diy);h.timestamp&&(k[20]=h.timestamp);h.working&&(k[21]=h.working);h.rnd&&(k[22]=h.rnd);h.techID&&(k[23]=h.techID);h.techStart&&(k[24]=h.techStart);h.activeTech&&(k[25]=h.activeTech);h.levelProgress&&(k[26]=h.levelProgress);h.c&&(k[27]=h.c);h.mimg&&(k[28]=h.mimg);void 0!==h.built&&(k[29]=h.built);
void 0!==h.xf&&(k[30]=h.xf);void 0!==h.yf&&(k[31]=h.yf);void 0!==h.action&&(k[32]=h.action);h.point&&(k[33]=h.point);h.waitlist&&(k[34]=h.waitlist);h.mv&&(k[35]=h.mv);h.work&&(k[36]=h.work);h.death&&(k[37]=h.death);h.freezed&&(k[38]=h.freezed);h.confused&&(k[39]=h.confused);h.sword&&(k[40]=h.sword);h.shield&&(k[41]=h.shield);h.book&&(k[42]=h.book);h.spy&&(k[43]=h.spy);h.stock&&(k[44]=h.stock);d[f-3]=k}c.allunits=d;q.movtable=Qc;q.movtable2=Rc;q.kingdomStart||q.editor||(q.kingdomStart=Wh);q.kingdoms=
E.slice(1);c=q;c=JSON.stringify(c);c=(new TextEncoder("utf-8")).encode(c);c=[new Uint8Array([55]),new Uint8Array((new Uint32Array([c.length])).buffer),c];0==q.arje&&c.put(bm(uc));c=new Blob(c,{type:"application/octet-binary"});c=URL.createObjectURL(c);b=document.createElement("a");document.body.appendChild(b);b.style="display: none";b.href=c;b.download="savegame.tzared";b.click();q.allunits=void 0};r("closeButton1").onclick=function(){r("mapconfiguration").style.display="none";Ea()};r("createGame1").onclick=
uk;r("copyButton").onclick=function(){document.getElementById("onlineID").select();document.execCommand("Copy")};r("startCustom").onclick=function(){q=Object.assign({},Ca);q.editor=!1;q.custom=!0;q.online=!1;Ca=void 0;oa("customMapcont");pd(!1,!1)};r("editCustom").onclick=function(){q=Object.assign({},Ca);q.custom=!0;Kc.func();Ca=void 0;oa("customMapcont")};r("playrecord").onclick=function(){q=Object.assign({},Ca);q.online=!1;q.custom=!0;q.demo=!0;q.cycle=0;q.editor=!1;Ca=void 0;oa("customMapcont");
pd(!1,!1)};r("seeStats").onclick=function(){li(Ca.kingdoms,!1,25*Ca.cycle);location.hash="MatchX"};var zm=function(){P(this,this.checked);localStorage[this.localProp]=this.checked},Qk=function(){"color"==this.type&&(this.style.backgroundColor=this.value);w[this.localProp]=this.value;localStorage[this.localProp]=this.value},zi={MatchHistory:function(){document.getElementById("returnmenu").style.display="block";var c=new XMLHttpRequest;c.open("GET",baseUrl+"php/latest.php",!0);Pk(c,function(b){b=b.responseText.split("|");
for(var c=b.length-1,e="",g=0;g<c;g+=5)e+="<tr id='statList"+nb(decodeURIComponent(b[g]))+"'><td>"+nb(decodeURIComponent(b[g+1]))+"</td><td>"+nb(decodeURIComponent(b[g+2]))+"</td><td>"+nb(decodeURIComponent(b[g+3]))+"</td><td>"+parseInt(nb(decodeURIComponent(b[g+4])))/6E4+" min</td></tr>";document.getElementById("matchtable").innerHTML="<tbody>"+e+"</tbody>";e={};for(g=0;g<c;e={l:e.l},g+=5)e.l=nb(decodeURIComponent(b[g])),r("statList"+e.l).onclick=function(b){return function(){location.hash="MatchX"+
b.l}}(e)});c.send(null)},GameList:Hg,RandomMap:Hb,Twitter:function(){document.getElementById("returnmenu").style.display="block"},Account:function(){Fd.returnmenu.style.display="block";""==Fd.Account.innerHTML&&(Fd.Account.innerHTML='<iframe id="accountIframe"></iframe>',Fd.accountIframe=document.getElementById("accountIframe"));Fd.accountIframe.src=baseUrl+w.langCodeUrl+"account/?iframe=1"},MapEditor:Kc.start,CustomMap:function(){document.getElementById("returnmenu").style.display="block"},Settings:function(){var c=
r("Settings");if(""==c.innerHTML){var b=document.createElement("h2");b.innerHTML=x.strSettings;c.appendChild(b);b=document.createElement("div");var d=document.createElement("span");d.innerHTML=x.color;b.appendChild(d);var f=document.createElement("input");f.type="color";f.value=localStorage.color;f.onchange=Qk;f.localProp="color";f.style.backgroundColor=localStorage.color;b.appendChild(f);d=document.createElement("span");d.innerHTML=x.username;b.appendChild(d);f=document.createElement("input");f.type=
"text";f.value=localStorage.name;f.onchange=Qk;f.localProp="name";b.appendChild(f);d=document.createElement("span");d.innerHTML=x.offlinePlay;b.appendChild(d);d=document.createElement("button");d.innerHTML=x.downloadAll;d.onclick=zc;b.appendChild(d);d=document.createElement("span");d.innerHTML=x.fullscreen;b.appendChild(d);var g=document.createElement("label");g.className="container";d=document.createElement("span");d.className="checkmark";f=document.createElement("input");f.type="checkbox";f.checked=
"true"==localStorage.fullscreen?!0:!1;f.onchange=zm;f.localProp="fullscreen";g.appendChild(f);g.appendChild(d);b.appendChild(g);c.appendChild(b)}Ta("returnmenu")}};xi();var Wb=[Oc,Hf,Wc,Uc,ie,wf,Rf,Jf,Af,yf,Gf,Tf,Mf,vj,Vf,Cf,Ef,Of,ke,Vd,Hd,Ri,ef,Vg,Pi,tj,sf,zj,Bj,zd,Ah,Cj,Dj,Ej,Fj,sf,lk,qj,Gj,Yd,rj,lf,oj,pj,ph,qh,be,qc,oh,Vc,Uc,ee,Wc,Dc,ud,ge,X,function(c){var b=c[1],d=y[c[2]];c=B[c[0]];E[d.kingdom].technology.hidden[c.id.id]=0;pc(d,c,b);ja.actv[c.id.id]&&Y(!1)},$d,of,db,gj,Ra,pf,mh,Ud,Oh,Nj,yj,xh,
Lf,uj];(function(){for(var c=0,b=Wb.length;c<b;c++)Wb[c].url=c})();Vd.rule="moving";qh.rule="attack"})();
