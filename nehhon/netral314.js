/*
 JSON v3.2.6 | http://bestiejs.github.io/json3 | Copyright 2012-2013, Kit Cambridge | http://kit.mit-license.org  https://mths.be/utf8js v2.0.0 by @mathias */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(z,fa,ua){z!=Array.prototype&&z!=Object.prototype&&(z[fa]=ua.value)};$jscomp.getGlobal=function(z){return"undefined"!=typeof window&&window===z?z:"undefined"!=typeof global&&null!=global?global:z};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var z=0;return function(fa){return $jscomp.SYMBOL_PREFIX+(fa||"")+z++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var z=$jscomp.global.Symbol.iterator;z||(z=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[z]&&$jscomp.defineProperty(Array.prototype,z,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(z){var fa=0;return $jscomp.iteratorPrototype(function(){return fa<z.length?{done:!1,value:z[fa++]}:{done:!0}})};$jscomp.iteratorPrototype=function(z){$jscomp.initSymbolIterator();z={next:z};z[$jscomp.global.Symbol.iterator]=function(){return this};return z};
$jscomp.iteratorFromArray=function(z,fa){$jscomp.initSymbolIterator();z instanceof String&&(z+="");var ua=0,ya={next:function(){if(ua<z.length){var Ca=ua++;return{value:fa(Ca,z[Ca]),done:!1}}ya.next=function(){return{done:!0,value:void 0}};return ya.next()}};ya[Symbol.iterator]=function(){return ya};return ya};
$jscomp.polyfill=function(z,fa,ua,ya){if(fa){ua=$jscomp.global;z=z.split(".");for(ya=0;ya<z.length-1;ya++){var Ca=z[ya];Ca in ua||(ua[Ca]={});ua=ua[Ca]}z=z[z.length-1];ya=ua[z];fa=fa(ya);fa!=ya&&null!=fa&&$jscomp.defineProperty(ua,z,{configurable:!0,writable:!0,value:fa})}};$jscomp.polyfill("Array.prototype.keys",function(z){return z?z:function(){return $jscomp.iteratorFromArray(this,function(z){return z})}},"es6","es3");
$jscomp.polyfill("Object.getOwnPropertySymbols",function(z){return z?z:function(){return[]}},"es6","es5");$jscomp.findInternal=function(z,fa,ua){z instanceof String&&(z=String(z));for(var ya=z.length,Ca=0;Ca<ya;Ca++){var U=z[Ca];if(fa.call(ua,U,Ca,z))return{i:Ca,v:U}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(z){return z?z:function(z,ua){return $jscomp.findInternal(this,z,ua).v}},"es6","es3");$jscomp.owns=function(z,fa){return Object.prototype.hasOwnProperty.call(z,fa)};
$jscomp.polyfill("Object.assign",function(z){return z?z:function(z,ua){for(var fa=1;fa<arguments.length;fa++){var Ca=arguments[fa];if(Ca)for(var U in Ca)$jscomp.owns(Ca,U)&&(z[U]=Ca[U])}return z}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(z){return z?z:function(){return $jscomp.iteratorFromArray(this,function(z,ua){return ua})}},"es8","es3");$jscomp.polyfill("Math.sign",function(z){return z?z:function(z){z=Number(z);return 0===z||isNaN(z)?z:0<z?1:-1}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(z){return z?z:function(z){return"number"!==typeof z?!1:!isNaN(z)&&Infinity!==z&&-Infinity!==z}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(z){return z?z:function(z){return Number.isFinite(z)?z===Math.floor(z):!1}},"es6","es3");
(function(){var z,fa,ua,ya;function Ca(d,b){var e=E,f;for(f=2;60>=f;f+=2){d--;b--;for(var g=0;g<=f;){if(2<R[d+g+e*b]&&1==y[R[d+g+e*b]].res&&ka(d+g,b))return R[d+g+e*b];if(2<R[d+g+e*(b+f)]&&1==y[R[d+g+e*(b+f)]].res&&ka(d+g,b+f))return R[d+g+e*(b+f)];g++}for(g=0;g<f-1;){g++;if(2<R[d+e*(b+g)]&&1==y[R[d+e*(b+g)]].res&&ka(d,b+g))return R[d+e*(b+g)];if(2<R[d+f+e*(b+g)]&&1==y[R[d+f+e*(b+g)]].res&&ka(d+f,b+g))return R[d+f+e*(b+g)]}}return!1}function U(d,b){if(!Kd(d)){var e=d.x32,f=d.y32,g=d.sight;d.build&&
(g=d.attDist);var c=E,m=2*g+1,t=m*m,v=d.id,n={};d.callList||(d.callList=[]);for(var B=0;B<t;B++){var F=B%m-g,r=~~(B/m)-g;if(Math.sqrt(Math.pow(F,2)+Math.pow(r,2))<=g){F+=e;r+=f;var Oa=F+r*c;ka(F,r)&&(lc[Oa]?(F=y[lc[Oa]],n[F.id]||b||(F.callList||O(F),F.callList.put(d.id),F.callList.put(d.x32+d.y32*c),n[F.id]=1)):lc[Oa]=v)}}}}function qi(d){if(d.callList){for(var b=d.x32,e=d.y32,f=d.sight,g=E,c=2*f+1,m=c*c,t=d.id,v=0;v<m;v++){var n=v%c-f,B=~~(v/c)-f;Math.sqrt(Math.pow(n,2)+Math.pow(B,2))<=f&&(n+=b,
B+=e,n+=B*g,lc[n]==t&&(lc[n]=void 0))}b=d.callList;d.callList=void 0;v=0;for(m=b.length;v<m;v+=2)d=y[b[v]],d.x32+d.y32*g==b[v+1]&&d.callList&&U(d,!0);b.length=0}}function el(){for(var d=0,b=Da.length;d<b;Da[d++].className="");}function fl(d){k.getError()==k.CONTEXT_LOST_WEBGL&&(k=document.getElementById("tzar").getContext("webgl2",{antialias:!1,alpha:!1}),O("restored"));fa=[];ua=[0,1,2,1,2,3];ya=[];ua.changed=!0;if(!pd){var b=k.createShader(k.VERTEX_SHADER);k.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec4 a_kingdom;\nin vec4 a_physic;\nuniform float zoom;\nuniform mediump int miniMap;\nuniform float now;\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform sampler2D u_image1;\nuniform sampler2D delay;\nuniform float zMax;\nout highp vec2 vTextureCoord;\nout vec4 v_kcolor;\nout float height;\n\nvec4 superArray(in highp uint position) {\n     return(texelFetch(u_image1, ivec2(\t\t(position%uint(512))\t\t,\tposition/uint(512)\t), 0));\n}\n\n\n\nvoid main() {\n\n\n\n    highp float  x;\n    float t;\n\thighp uint pos;\n\n\nif(a_texCoord.y>-.5&&miniMap==0){\nt=(now-a_texCoord.y);\nif(a_texCoord.w>=0.0){\npos=uint(floor(t * a_texCoord.w));         \n}else{\n\n\nint index=int(-a_texCoord.w);\nint len=int(a_texCoord.z);\nint i;\n\nfloat spt= mod(t,texelFetch(delay, ivec2(len-1+index, 0), 0).r);\n\n for(i=0;i<len;i++){\n\n\nif(texelFetch(delay, ivec2(i+index, 0), 0).r>spt) {\n\nbreak;\n }\n\n\n }\n\n pos=uint(i);\n\n\t\t\t\t  \n //pos=uint(4);\n}\n\n\n\tpos=uint(a_texCoord.x)+uint(4)*(pos%uint(a_texCoord.z));\n\n\n}else{\n\npos=uint(a_texCoord.x);\n\n}\n\n\n\n    vec4 coord = superArray(pos);\n\n\tpos=pos-pos%uint(4);\n\n\theight = (superArray(pos+uint(3)).w-superArray(pos).w)/512.0;\n\n    vec2 mxy=vec2(coord.p,coord.q);\n\n\n\t\tfloat z=a_position.z;\n\n\tif(z<0.0){\n\tz*=-1.0;\n\tmxy*=0.0;\n\n\t}\n\n\n\n    t = (now - a_physic.w) * 0.001;\n    mxy.x+=a_physic.x * t;\n\n\tfloat physicY=a_physic.y * t + a_physic.z * .5 * t * t;\n\n    mxy.y+=physicY;\n\n\nif(miniMap==1){\n\tz=0.0;\n}else{\n\tz=(1.0 - (physicY+z)/ zMax)*.9;\n}\n\n   gl_Position = vec4((((a_position.xy+mxy) + u_translation) / u_resolution * 2.0 - 1.0) * vec2(zoom, -zoom), (z), 1.0);\n\n   vTextureCoord=vec2(coord.s,coord.t);\n\n\n    v_kcolor=a_kingdom;\n\n\n}\n");
k.compileShader(b);d=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(d,"#version 300 es\nprecision mediump float;\n\n\n\nuniform sampler2D lightmap;\nuniform vec2 u_resolution;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform mediump int miniMap;\nin vec4 v_kcolor;\nin highp vec2 vTextureCoord;\nin float height;\nout vec4 COLOR;\n\nvoid main() {\n\n\nif(miniMap==0){\n\n\n\n\nvec2 txtFinal=vTextureCoord;\n\nif(txtFinal.x>=1.0){\ntxtFinal.y+=height*floor(txtFinal.x);\n}\n\n\nvec4 color=texture(img_common, vec3(txtFinal, int(txtFinal.y)));\n \n\nif(color.a<0.5) discard;\n\n\n\n\nif(v_kcolor.a<1.0){\ncolor*=v_kcolor;\n}else if(v_kcolor.a!=1.0){\n\nif(color.r==color.g&&color.r==color.b){\ncolor.rgb*=v_kcolor.rgb;\n}\ncolor.a*=v_kcolor.a-1.0;\n}\nvec4 light=vec4(1.0);\n\n\nlight = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+vec4(1.0,1.0,1.0,0.0)*u_ambient;\n\nCOLOR=color*light;\n\n}else{\nCOLOR=v_kcolor;\n}\n\n}");
k.compileShader(d);pa=k.createProgram();k.attachShader(pa,b);k.attachShader(pa,d);k.linkProgram(pa);k.useProgram(pa);b=k.getShaderInfoLog(b);console.log("Shader compiler log: "+b);b=k.getShaderInfoLog(d);console.log("Shader compiler log: "+b);b=k.createShader(k.VERTEX_SHADER);k.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\n\n\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform mediump int miniMap;\nuniform float zoom;\n\n\nvoid main() {\n\nfloat depth;\nif(miniMap==1){\ndepth=.03;\n}else{\ndepth=1.0;\n}\n\n   gl_Position = vec4(a_position.x, a_position.y, depth, 1.0);\n   \n\n}");
k.compileShader(b);d=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(d,"#version 300 es\nprecision mediump float;\n\nuniform float u_fps;\nuniform mediump int miniMap;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform vec2 borderCoords;\nuniform vec2 waterBorder;\nuniform vec2 u_translation;\nuniform vec2 u_resolution;\nuniform vec2 minimapMargin;\nuniform mediump isampler2D img_data;\nuniform sampler2D lightmap;\nout vec4 COLOR;\nuniform float zoom;\nuniform float mx;\nuniform float mapSize;\nuniform float terrainInfo[32];\nvec4 sptexture3D(in vec2 coords,in float height1) {\n \n\n \nif(coords.x>=1.0){\ncoords.y+=height1*floor(coords.x);\n}\n\n\n\n    return(\ttexture(img_common, vec3(coords,int(coords.y)))\t);\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\nvec4 color;\n\nvec2 xy =  vec2(gl_FragCoord.x,u_resolution.y-gl_FragCoord.y)/zoom;\n\nif(miniMap==1){\nxy+=minimapMargin/zoom;\n}else{\nxy+=-u_translation+vec2(mx,0.0)/zoom+0.5*(u_resolution-u_resolution/zoom);\n}\n\nvec2 xy32=xy/32.0;\n\nvec2 floorxy32=floor(xy32);\n\nvec2 xyr=xy32-floorxy32;\n\n\nvec2 xyb;\n\n\nfloat dx=0.0;\nfloat dy=0.0;\n\nif(xyr.x>0.5){dx=1.0;}\nif(xyr.y>0.5){dy=1.0;}\n\nvec2 oxy32=xy32;\n\n\nif(dx==1.0){\nxyb=vec2(borderCoords.x+floor(rand(floorxy32)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(-16.0,8.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.x+=dx;\n}\n}\n\nif(dy==1.0){\nxyb=vec2(borderCoords.x+floor(rand(1.5*floorxy32-3.0)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(8,-16.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.y+=dy;\n}\n}\n\n\nint type = texture(img_data,xy32/(mapSize)).r;\nint ntype = texture(img_data,oxy32/(mapSize)).r;\n\nif(type<0&&type!=ntype){\n\nif(ntype<0){\ntype=ntype;\n}else if(ntype==3){\ntype=ntype;\n}else{\ntype=1;\n}\n}\n\n\n\nfloat h;\nfloat w;\nvec2 xytxt;\nif(type<0){\n\ntype=-type-2;\nxytxt=waterBorder+vec2(float(type*8*32),0.0)/512.0;\nw=32.0;\nh=32.0;\ntype*=-1;\n}else{\nxytxt=vec2(terrainInfo[type*4],terrainInfo[type*4+1]);\nw=terrainInfo[type*4+2];\nh=terrainInfo[type*4+3];\n\nif(type==3) xytxt+=vec2(u_fps,0.0);\n}\n\n\nvec2 xyt=vec2(xytxt)+vec2(mod(xy.x,w),mod(xy.y,h))/512.0;\n\n\nif(type==3){ h=576.0; }\ncolor=sptexture3D(xyt,h/512.0);\n\nmediump vec4 light=vec4(1.0);\nif(miniMap==0) light = (texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+1.0)*u_ambient;\n\n\n\nCOLOR=color*light;\n\n\n\n}");
k.compileShader(d);na=k.createProgram();k.attachShader(na,b);k.attachShader(na,d);k.linkProgram(na);b=k.getShaderInfoLog(b);console.log("Shader1 compiler log T: "+b);b=k.getShaderInfoLog(d);console.log("Shader compiler log T: "+b)}d=k.getAttribLocation(pa,"a_position");b=k.getAttribLocation(pa,"a_texCoord");var e=k.getAttribLocation(pa,"a_kingdom"),f=k.getAttribLocation(pa,"a_physic"),g=l,c=mc.dir,m=[];m.length=4*c.length;for(var t=0,v=c.length;t<v;t++){var n=Ia[g[c[t]]],B=n[7]+n.deltaY,F=n[8],r=
n[9];m[4*t]=n[6]/512;m[4*t+1]=B/512;m[4*t+2]=F;m[4*t+3]=r}O(m);t=1/512;k.useProgram(na);v=k.getUniformLocation(na,"minimapMargin");Ld=k.getUniformLocation(na,"u_translation");tg=k.getUniformLocation(na,"u_resolution");ug=k.getUniformLocation(na,"u_fps");var Oa=k.getUniformLocation(na,"u_ambient");qd=k.getUniformLocation(na,"zoom");n=k.getUniformLocation(na,"mx");c=k.getUniformLocation(na,"mapSize");B=k.getUniformLocation(na,"borderCoords");F=k.getUniformLocation(na,"waterBorder");Se=k.getUniformLocation(na,
"miniMap");r=k.getUniformLocation(na,"terrainInfo");k.uniform2fv(B,[Ia[g.terrain_border][6]*t,t*(Ia[g.terrain_border].deltaY+Ia[g.terrain_border][7])]);k.uniform2fv(F,[Ia[g.waterborder][6]*t,t*(Ia[g.waterborder].deltaY+Ia[g.waterborder][7])]);k.uniform1i(Se,0);k.uniform2fv(Ld,[0,0]);k.uniform1f(ug,-1);k.uniform1f(qd,1);k.uniform1f(n,-w.mx);k.uniform1f(c,E);k.uniform1fv(r,m);p.editor?k.uniform2fv(v,[0,-60]):k.uniform2fv(v,[-4,-31]);g=k.getAttribLocation(na,"a_position");vg=k.createVertexArray();k.bindVertexArray(vg);
m=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,m);k.bufferData(k.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,1,1,-1,1]),k.STATIC_DRAW);k.enableVertexAttribArray(g);k.vertexAttribPointer(g,2,k.FLOAT,!1,0,0);k.bindVertexArray(null);k.useProgram(pa);k.bindBuffer(k.ARRAY_BUFFER,null);g=E*Ea*3;wg=k.createVertexArray();k.bindVertexArray(wg);pb=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,pb);k.enableVertexAttribArray(e);k.vertexAttribPointer(e,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,16*g,
k.DYNAMIC_DRAW);rd=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,rd);k.enableVertexAttribArray(b);k.vertexAttribPointer(b,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,16*g,k.DYNAMIC_DRAW);Dc=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Dc);k.enableVertexAttribArray(d);k.vertexAttribPointer(d,3,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,12*g,k.DYNAMIC_DRAW);Md=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Md);k.enableVertexAttribArray(f);k.vertexAttribPointer(f,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,
16*g,k.DYNAMIC_DRAW);k.bindVertexArray(null);Te=k.getUniformLocation(pa,"u_resolution");var ec=k.getUniformLocation(pa,"u_ambient");Nd=k.getUniformLocation(pa,"u_translation");sd=k.getUniformLocation(pa,"zoom");ri=k.getUniformLocation(pa,"now");Ue=k.getUniformLocation(pa,"miniMap");d=k.getUniformLocation(pa,"zMax");k.uniform1f(d,p.zMax);k.uniform1i(Ue,0);k.useProgram(pa);l.delay=[100,250,400,550,650,750,850,1E3,1150,5150,7650,10150,13650,17150,21150,25150,100,200,300,400,500,600,700,800,900,1E3,1100,
1200,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6500,7700,8900,10100,13600,17100,22100,8E3,8080,8160,8240,8320,8400,8480,100,200,300,400,500,600,700,800,900,1E3,1100,2400,3600,4800,6E3,7200,8400,11900,15400,20400,8E3,8077,8154,8231,8308,8385,8462,8539,8616,8693,8770,8847,8923,5E3,5072,5143,5215,5286,5358,5429,5501,5572,5644,5715,5787,5858,5929,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,3700,4900,7100,9600,12600,17100,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,
8833,8916,9E3,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,8833,8916,9E3,9080,5E3,5100,5200,5300,5400,5500,5600,5700,5850,6E3,70,140,210,280,350,420,490,560,630,700,770,840,910,980,4980,8980,12980,16980,20980,26980,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,4100,6300,8500,11E3,13500,17E3,20500,5E3,5100,5200,5300,5400,5500,5600,5700,5800,5900,6E3,125,230,335,431,546,606,666,731,857,952,1045,1139,1238,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,3300,
5800,8800,12E3,15500,5500,5600,5700,5800,5900,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6800,9800,12800,16300,19800,23800,28300,5E3,5100,5200,5300,5400,5500,5600,210,420,654,864,1074,1284,1494,108,244,380,516,652,788,924,1060,1196,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4100,6100,8100,11100,14100,17100,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5200,9E3,11E3,13800,17600,23400,7E3,7100,
7200,7300,7400,8200,8300,8400,8500,8600,9600,9700,9800,9900,1E4,80,160,210,360,610,1010,1510,100,200,300,400,500,3500,7500,13500,40,80,120,160,200,240,280,320,360,400,440,480,520,2520,3520,4520,5520,6520,8520,11520,107,214,321,428,535,642,749,856,963,1070,1177,1284,1391,1498,7323,13148,18973,24798,30623,36448,7E3,7170,7340,7510,7680,7980,8150,8320,8490,8660,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,6400,8900,11400,14900,18400,7E3,7200,7400,7600,7800,8E3,8200,125,250,375,500,
2E3,2125,2250,100,200,300,400,500,4E3,10500,100,200,300,400,500,600,700,800,900,8900,15900,21400,27400,33900,38900,44900,51900,800,1E3,1200,1400,1600,1800,2E3,2200,2400,2600,NaN,80,160,240,320,400,480,560,640,720,800,880,960,1040,5040,9040,12790,16540,19290,22040,25790,7671,7771,7871,7971,8071,8171,8271,100,200,300,400,500,600,700,800,900,1E3,1100,1200,6200,9700,13200,17200,21200,25200,29200,35200,100,200,300,400,500,600,9600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,11300,17300,
27300,37300,49300,64300,8E3,8228,8457,8685,8914,9142,9371,80,160,240,320,400,480,560,640,720,800,880,960,4960,8460,11460,14460,18460,22460,28460,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5400,8900,12900,16900,22900,28900,5E3,5143,5286,5429,5572,5715,5857,121,232,361,508,629,758,879,1018,1165,1425,1445,1465,1536,1692,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8300,11300,14800,18800,23300,29300,6E3,6171,6343,6514,6685,6857,7028,125,
250,375,500,625,750,875,1E3,1125,1250,1375,1500,6500,10500,13500,16500,19500,23E3,27E3,31500,8E3,8185,8370,8555,8740,8925,9108,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4300,7800,11300,15300,19300,23800,29800,1E4,10107,10214,10321,10428,10535,10643,10750,10857,10964,11071,11178,11285,11393,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4900,8400,12900,17400,22400,27400,
8E3,8250,8500,8750,9E3,9250,9500,9750,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,8300,11800,15800,19800,24300,29300,5E3,5157,5314,5471,5628,5785,5943,125,250,375,500,625,3125,3250,3375,100,200,300,400,500,600,4600,8600,14600,15600,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14400,18400,
22400,28400,180,360,540,720,900,1080,10080,100,200,350,500,600,700,800,950,1100,1250,1400,1550,1700,6200,8700,11700,15200,18700,22700,27700,6E3,6120,6240,6360,6480,6600,6720,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14900,18900,23400,29400,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,7400,10900,14900,19900,5E3,5100,5200,5300,5400,5500,5600,116,232,348,464,522,580,638,696,812,928,1044,1160,1276,1392,100,200,300,400,
500,600,700,800,900,1E3,1100,1200,5200,8700,11700,14700,18700,22700,28700,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,6900,10900,14400,18400,22400,27400,7E3,7100,7200,7300,7400,7500,7600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8600,10800,13E3,15500,19500,24E3,8E3,8100,8200,8300,8400,8500,8600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8800,12300,16300,20300,24300,29300,6E3,6100,6200,6300,6400,6500,6600,100,200,
300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1630,1730,1830,1930,2030,2130,2230,2330,5330,8330,11330,7E3,7150,7300,7450,7600,7750,7900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,5200,8700,12200,15700,20200,24700,29700,34700,8E3,8080,8163,8246,8330,8413,8496,8580,8663,8746,8830,8913,8996,9080,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,5599,5684,5770,5855,5941,6026,6112,125,250,375,500,625,
750,875,1E3,1125,1250,1375,1500,1625,5625,8625,11625,14625,18125,22125,26625,8E3,8185,8370,8555,8740,8925,9108,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,6100,10600,14600,18100,21600,26100,30600,35600,40600,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1700,6700,10700,11300,6E3,6200,6400,6600,6800,7E3,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,10400,100,
200,300,400,500,600,8600];d=l.delay;var fc=d.length;Ia[l.expl_small_hole][1]=-fc;for(b=t=0;14>t;t++)b+=66,d[t+fc]=b;d.put(b+3E4);d=new Float32Array(d);si=function(d){k.useProgram(na);k.uniform4fv(Oa,d);k.useProgram(pa);k.uniform4fv(ec,d)};xg=function(d){if(!Od&&(d.clientX>w.menumx||td||!d.clientX)){d=.07*Math.sign(d.deltaY)*ha;var b=(ha+d)*tzar.height*.03125;(ha+d)*tzar.width*.03125-(ha+d)*w.mx/32>E||b>Ea||(ha+=d,.08>ha&&(ha=.08),Gb(),ud(-xb,-Fa),k.useProgram(na),k.uniform1f(qd,1/ha),k.useProgram(pa),
k.uniform1f(sd,1/ha))}};window.addEventListener("wheel",xg,!1);ti=function(){fc=[xb,Fa];k.useProgram(na);k.uniform2fv(Ld,fc);k.useProgram(pa);k.uniform2fv(Nd,fc)};gl();si(new Float32Array([1,1,1,1]));k.uniform1f(sd,1);k.uniform2fv(Nd,[0,0]);var Ua=k.createFramebuffer(),gc;Pd=function(){var d=window.innerWidth,b=window.innerHeight;tzar.width=d;tzar.height=b;k.useProgram(na);k.uniform2f(tg,d,b);k.useProgram(pa);Ua.width=d;Ua.height=b;k.activeTexture(k.TEXTURE2);gc||(gc=k.createTexture());k.bindTexture(k.TEXTURE_2D,
gc);k.texImage2D(k.TEXTURE_2D,0,k.RGBA,d,b,0,k.RGBA,k.UNSIGNED_BYTE,null);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.bindFramebuffer(k.FRAMEBUFFER,Ua);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,gc,0);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);k.bindFramebuffer(k.FRAMEBUFFER,
null);ha=1;k.uniform1f(sd,1/ha);k.uniform1i(k.getUniformLocation(pa,"lightmap"),2);k.useProgram(na);k.uniform1i(k.getUniformLocation(na,"lightmap"),2);k.uniform1f(qd,1/ha);k.useProgram(pa);k.uniform2f(Te,d,b);k.viewport(w.mx,0,d,b);Pd.changed=1;ud(-xb,-Fa)};Pd.changed=0;window.addEventListener("resize",Pd,!1);Pd();k.blendEquation(k.FUNC_ADD);k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA);k.disable(k.DITHER);k.disable(k.BLEND);performance.now();b=k.createTexture();e=N.info;k.bindTexture(k.TEXTURE_2D,
b);k.texImage2D(k.TEXTURE_2D,0,k.RGBA32F,512,512,0,k.RGBA,k.FLOAT,e);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT);k.bindTexture(k.TEXTURE_2D,null);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,b);k.uniform1i(k.getUniformLocation(pa,"u_image1"),0);k.activeTexture(k.TEXTURE1);b=k.createTexture();k.bindTexture(k.TEXTURE_2D_ARRAY,
b);k.texParameteri(k.TEXTURE_2D_ARRAY,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D_ARRAY,k.TEXTURE_MIN_FILTER,k.NEAREST);e=N.common;f=e.length;n=N.xtra;t=0;for(v=n.length;t<v;f+=n[t++].length);O(N);k.texImage3D(k.TEXTURE_2D_ARRAY,0,k.RGBA,N.size,N.size,f/(4*N.size*N.size),0,k.RGBA,k.UNSIGNED_BYTE,null);f=e.length;k.texSubImage3D(k.TEXTURE_2D_ARRAY,0,0,0,0,N.size,N.size,e.length/(4*N.size*N.size),k.RGBA,k.UNSIGNED_BYTE,e);t=0;for(v=n.length;t<v;t++)e=n[t],k.texSubImage3D(k.TEXTURE_2D_ARRAY,
0,0,0,f/1048576,N.size,N.size,e.length/(4*N.size*N.size),k.RGBA,k.UNSIGNED_BYTE,e),f+=e.length;O(f);k.activeTexture(k.TEXTURE1);k.bindTexture(k.TEXTURE_2D_ARRAY,b);k.uniform1i(k.getUniformLocation(pa,"img_common"),1);k.useProgram(na);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D_ARRAY,b);k.uniform1i(k.getUniformLocation(na,"img_common"),0);Uc(1);pd||(O(d),k.activeTexture(k.TEXTURE3),b=k.createTexture(),k.bindTexture(k.TEXTURE_2D,b),k.texImage2D(k.TEXTURE_2D,0,k.R16F,d.length,1,0,k.RED,k.FLOAT,
d),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.bindTexture(k.TEXTURE_2D,null),k.bindTexture(k.TEXTURE_2D,b),k.uniform1i(k.getUniformLocation(pa,"delay"),3),k.activeTexture(k.TEXTURE2),yg=k.createTexture(),k.bindTexture(k.TEXTURE_2D,yg),k.texImage2D(k.TEXTURE_2D,0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,new Uint8Array([255,
255,255,255])),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.clearColor(0,0,0,1));k.bindFramebuffer(k.FRAMEBUFFER,Ua);Ua.width=1;Ua.height=1;k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,gc,0);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);k.bindFramebuffer(k.FRAMEBUFFER,null);new Float32Array(8);
zg=k.createBuffer();Ag=k.createBuffer();ui=k.createBuffer();t=0;for(v=Bg.length;t<v;t++)qb(Bg[t]);k.enable(k.DEPTH_TEST);k.depthFunc(k.LEQUAL);Hb.fp1000=1E3;Hb.delta=0;Hb.now=0;Hb.frameCount=0;k.bindTexture(k.TEXTURE_2D,gc);pd=N.setup=!0}function vd(d,b){Cg();var e=b||vd,f=function(){e(d,b)};if(!vi()){if("true"==localStorage.fullscreen){var g=document.documentElement;g.requestFullscreen?g.requestFullscreen():g.msRequestFullscreen?g.msRequestFullscreen():g.mozRequestFullScreen?g.mozRequestFullScreen():
g.webkitRequestFullscreen&&g.webkitRequestFullscreen()}p.editor?(w.marx=0,w.mary=60,q("saveGame").innerHTML=x.save,w.menumy=60,Cb=ac=171,w.mx=171,w.menumx=171):(w.mx=151,Cb=ac=128,w.menumx=151,w.menumy=0,q("saveGame").innerHTML=x.savegame,w.marx=4,w.mary=31);Vc.style.width=ac+"px";Vc.style.height=Cb+"px";Vc.style.left=w.marx+"px";Vc.style.top=w.mary+"px";Ob();q("loading").style.display="block";origin=!1;O(N.load,N.images);if(N.load<N.images||!N.images)return N.started||(q("qdgraphics")&&(q("qdgraphics").style.display=
"none"),wi()),q("loadingtext").innerHTML=x.waitImages,bc=f,!1;if(Qd.last!==w.terrainType)return Dg=!0,q("loadingtext").innerHTML="Downloading terrain",hl(),bc=f,!1;il();q("notifybottom").style.display="none";void 0===p.arje&&Eg();p.demo?q("saveGame").style.display="none":q("saveGame").style.display="block";if(p.custom){var c=0==p.cycle?p.kingdomStart||p.kingdoms:p.kingdoms;f=0;for(g=c.length;f<g;f++){var m=new Yb("",c[f].color,[0],!0);Object.assign(m,c[f]);m.values.pop=0;null==m.resources[0]&&(m.resources[0]=
Infinity);null==m.resources[1]&&(m.resources[1]=Infinity);null==m.resources[2]&&(m.resources[2]=Infinity);null==m.resources[3]&&(m.resources[3]=Infinity)}}else for(f=0,g=M.length;f<g;f++){c=M[f];m=[0];for(var t=0;t<g;t++)m[t+1]=M[t].team==c.team?0:1;p.online&&c.id===w.onlineID&&(w.kingdom=f+1);new Yb(c.name,c.color,m,c.race,c.IA,[p.goldRes,p.woodRes,p.foodRes,p.stoneRes],c.team)}p.rules?jl(p.rules):Rd=void 0;w.kingdom||(w.kingdom=1);xi();return!0}}function yi(){q("playingMenu").style.display="block";
Ob()}function kl(d){O("setup:",d);d.toSend=[];d.orderList=[];d.sendDirectly("channelMessage","nehhof",{});d.channels.channelMessage.onopen=function(){Ya.put(d);qa("attack");Fg();Gg(1);O("DATACHANNEL OPEN");for(var b=0,e=M.length;b<e;b++)if(M[b].id==d.id)d.username=M[b].name,nc[b]&&(nc[b].style.background="#00ff00",nc[b].style.boxShadow="0px 0px 30px 0px #00ff00");else if(M[b].id==w.onlineID){var f=M[b],g=w.color;O("sending");W(zi,w.version,0,[d],2);W(Hg,g,0,[d],2);W(Ig,f.team,0,[d],2);W(Jg,f.race,
0,[d],2);W(Ai,w.name,0,[d],2)}};d.channels.channelMessage.onerror=function(d){O(d)}}function Bi(){document.getElementById("buttons").innerHTML="";document.getElementById("onlineID").value="";document.getElementById("gameName").innerHTML=""}function Kg(){w.p2p?(nb(),w.p2p.emit("getRooms"),q("returnmenu").style.display="block"):(sa||oc(),oc.func=Kg)}function Ci(){var d=location,b=d.hash.substr(1);""==b&&(document.getElementById("returnmenu").style.display="none");if("MatchX"==b.substr(0,6))6<b.length&&
ll(b.substr(6-b.length));else if("Room"==d.hash.substr(-4))d=d.hash.substr(1),w.admin||Di(d.substr(0,d.length-4));else if(Ei[b])Ei[b]();else d.hash=""}function Fi(d){var b=new Date;d=new Uint32Array(d);for(var e,f=E,g=0;g<R.length;g++)R[g]!=d[g]&&(e=d[g],R[g]=e,e=y[e],e.x32=g%f,e.y32=~~(g/f));console.log(new Date-b)}function Gi(d){d=new Uint32Array(d);console.log(d)}function Hi(d){d=document.getElementById(d);d.style.display="none"==d.style.display?"block":"none"}function Lg(d){d.style.display="none"==
d.style.display?"block":"none"}function Ii(d){T=function(){};Ub=!1;var b=K;b.d=d.d;aa(b,d.img);b.active=!0;Va=u[52];Sd=d;document.addEventListener("mousemove",Mg);document.addEventListener("mousedown",Ve)}function ml(d,b){return d.innerHTML-b.innerHTML}var ol=function(){(function(d){"object"===typeof exports&&"undefined"!==typeof module?module.exports=d():"function"===typeof define&&define.amd?define([],d):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?
self:this).SimpleWebRTC=d()})(function(){return function g(b,e,f){function c(h,t){if(!e[h]){if(!b[h]){var n="function"==typeof require&&require;if(!t&&n)return n(h,!0);if(m)return m(h,!0);t=Error("Cannot find module '"+h+"'");throw t.code="MODULE_NOT_FOUND",t;}t=e[h]={exports:{}};b[h][0].call(t.exports,function(g){var e=b[h][1][g];return c(e?e:g)},t,t.exports,g,b,e,f)}return e[h].exports}for(var m="function"==typeof require&&require,t=0;t<f.length;t++)c(f[t]);return c}({1:[function(b,e,f){function g(){}
e.exports=function(b,e,f){function c(b,g){if(0>=c.count)throw Error("after called too many times");--c.count;b?(h=!0,e(b),e=f):0!==c.count||h||e(null,g)}var h=!1;f=f||g;c.count=b;return 0===b?e():c}},{}],2:[function(b,e,f){e.exports=function(b,e,f){var g=b.byteLength;e=e||0;f=f||g;if(b.slice)return b.slice(e,f);0>e&&(e+=g);0>f&&(f+=g);f>g&&(f=g);if(e>=g||e>=f||0===g)return new ArrayBuffer(0);b=new Uint8Array(b);g=new Uint8Array(f-e);for(var c=0;e<f;e++,c++)g[c]=b[e];return g.buffer}},{}],3:[function(b,
e,f){e.exports=function(b,e,f){var g,c=e;e={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};if(f)for(g in f)e[g]=f[g];c?"audio"===c.tagName.toLowerCase()&&(e.audio=!0):c=document.createElement(e.audio?"audio":"video");e.disableContextMenu&&(c.oncontextmenu=function(b){b.preventDefault()});e.autoplay&&(c.autoplay="autoplay");e.muted&&(c.muted=!0);!e.audio&&e.mirror&&["","moz","webkit","o","ms"].forEach(function(b){c.style[b?b+"Transform":"transform"]="scaleX(-1)"});c.srcObject=b;return c}},
{}],4:[function(b,e,f){function g(b){b=b||{};this.ms=b.min||100;this.max=b.max||1E4;this.factor=b.factor||2;this.jitter=0<b.jitter&&1>=b.jitter?b.jitter:0;this.attempts=0}e.exports=g;g.prototype.duration=function(){var b=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),g=Math.floor(e*this.jitter*b);b=0==(Math.floor(10*e)&1)?b-g:b+g}return Math.min(b,this.max)|0};g.prototype.reset=function(){this.attempts=0};g.prototype.setMin=function(b){this.ms=b};g.prototype.setMax=
function(b){this.max=b};g.prototype.setJitter=function(b){this.jitter=b}},{}],5:[function(b,e,f){(function(b){f.encode=function(e){e=new Uint8Array(e);var g,f=e.length,c="";for(g=0;g<f;g+=3)c+=b[e[g]>>2],c+=b[(e[g]&3)<<4|e[g+1]>>4],c+=b[(e[g+1]&15)<<2|e[g+2]>>6],c+=b[e[g+2]&63];2===f%3?c=c.substring(0,c.length-1)+"=":1===f%3&&(c=c.substring(0,c.length-2)+"==");return c};f.decode=function(e){var g=.75*e.length,f=e.length,c=0;"="===e[e.length-1]&&(g--,"="===e[e.length-2]&&g--);var h=new ArrayBuffer(g),
B=new Uint8Array(h);for(g=0;g<f;g+=4){var F=b.indexOf(e[g]);var r=b.indexOf(e[g+1]);var Oa=b.indexOf(e[g+2]);var ec=b.indexOf(e[g+3]);B[c++]=F<<2|r>>4;B[c++]=(r&15)<<4|Oa>>2;B[c++]=(Oa&3)<<6|ec&63}return h}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],6:[function(b,e,f){(function(b){function g(b){for(var e=0;e<b.length;e++){var g=b[e];if(g.buffer instanceof ArrayBuffer){var f=g.buffer;if(g.byteLength!==f.byteLength){var c=new Uint8Array(g.byteLength);c.set(new Uint8Array(f,
g.byteOffset,g.byteLength));f=c.buffer}b[e]=f}}}function f(b,e){e=e||{};var f=new v;g(b);for(var c=0;c<b.length;c++)f.append(b[c]);return e.type?f.getBlob(e.type):f.getBlob()}function c(b,e){g(b);return new Blob(b,e||{})}var v=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder;try{var n=2===(new Blob(["hi"])).size}catch(r){n=!1}var B;if(B=n)try{B=2===(new Blob([new Uint8Array([1,2])])).size}catch(r){B=!1}var F=v&&v.prototype.append&&v.prototype.getBlob;b=n?B?b.Blob:c:F?f:void 0;
e.exports=b}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],7:[function(b,e,f){var g=[].slice;e.exports=function(b,e){"string"==typeof e&&(e=b[e]);if("function"!=typeof e)throw Error("bind() requires a function");var f=g.call(arguments,2);return function(){return e.apply(b,f.concat(g.call(arguments)))}}},{}],8:[function(b,e,f){function g(b){if(b){for(var e in g.prototype)b[e]=g.prototype[e];return b}}e.exports=g;g.prototype.on=
g.prototype.addEventListener=function(b,e){this._callbacks=this._callbacks||{};(this._callbacks[b]=this._callbacks[b]||[]).push(e);return this};g.prototype.once=function(b,e){function g(){f.off(b,g);e.apply(this,arguments)}var f=this;this._callbacks=this._callbacks||{};g.fn=e;this.on(b,g);return this};g.prototype.off=g.prototype.removeListener=g.prototype.removeAllListeners=g.prototype.removeEventListener=function(b,e){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks=
{},this;var g=this._callbacks[b];if(!g)return this;if(1==arguments.length)return delete this._callbacks[b],this;for(var f,c=0;c<g.length;c++)if(f=g[c],f===e||f.fn===e){g.splice(c,1);break}return this};g.prototype.emit=function(b){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),g=this._callbacks[b];if(g){g=g.slice(0);for(var f=0,c=g.length;f<c;++f)g[f].apply(this,e)}return this};g.prototype.listeners=function(b){this._callbacks=this._callbacks||{};return this._callbacks[b]||[]};
g.prototype.hasListeners=function(b){return!!this.listeners(b).length}},{}],9:[function(b,e,f){e.exports=function(b,e){var g=function(){};g.prototype=e.prototype;b.prototype=new g;b.prototype.constructor=b}},{}],10:[function(b,e,f){function g(b){return g.enabled(b)?function(e){e instanceof Error&&(e=e.stack||e.message);var f=new Date,c=f-(g[b]||f);g[b]=f;e=b+" "+e+" +"+g.humanize(c);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}e.exports=g;
g.names=[];g.skips=[];g.enable=function(b){try{localStorage.debug=b}catch(n){}for(var e=(b||"").split(/[\s,]+/),f=e.length,c=0;c<f;c++)b=e[c].replace("*",".*?"),"-"===b[0]?g.skips.push(new RegExp("^"+b.substr(1)+"$")):g.names.push(new RegExp("^"+b+"$"))};g.disable=function(){g.enable("")};g.humanize=function(b){return 36E5<=b?(b/36E5).toFixed(1)+"h":6E4<=b?(b/6E4).toFixed(1)+"m":1E3<=b?(b/1E3|0)+"s":b+"ms"};g.enabled=function(b){for(var e=0,f=g.skips.length;e<f;e++)if(g.skips[e].test(b))return!1;
e=0;for(f=g.names.length;e<f;e++)if(g.names[e].test(b))return!0;return!1};try{window.localStorage&&g.enable(localStorage.debug)}catch(h){}},{}],11:[function(b,e,f){e.exports=b("./lib/")},{"./lib/":12}],12:[function(b,e,f){e.exports=b("./socket");e.exports.parser=b("engine.io-parser")},{"./socket":13,"engine.io-parser":24}],13:[function(b,e,f){(function(g){function f(b,e){if(!(this instanceof f))return new f(b,e);e=e||{};b&&"object"==typeof b&&(e=b,b=null);b&&(b=F(b),e.host=b.host,e.secure="https"==
b.protocol||"wss"==b.protocol,e.port=b.port,b.query&&(e.query=b.query));this.secure=null!=e.secure?e.secure:g.location&&"https:"==location.protocol;e.host&&(b=e.host.split(":"),e.hostname=b.shift(),b.length?e.port=b.pop():e.port||(e.port=this.secure?"443":"80"));this.agent=e.agent||!1;this.hostname=e.hostname||(g.location?location.hostname:"localhost");this.port=e.port||(g.location&&location.port?location.port:this.secure?443:80);this.query=e.query||{};"string"==typeof this.query&&(this.query=Oa.decode(this.query));
this.upgrade=!1!==e.upgrade;this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!e.forceJSONP;this.jsonp=!1!==e.jsonp;this.forceBase64=!!e.forceBase64;this.enablesXDR=!!e.enablesXDR;this.timestampParam=e.timestampParam||"t";this.timestampRequests=e.timestampRequests;this.transports=e.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=e.policyPort||843;this.rememberUpgrade=e.rememberUpgrade||!1;this.binaryType=null;
this.onlyBinaryUpgrades=e.onlyBinaryUpgrades;this.pfx=e.pfx||null;this.key=e.key||null;this.passphrase=e.passphrase||null;this.cert=e.cert||null;this.ca=e.ca||null;this.ciphers=e.ciphers||null;this.rejectUnauthorized=e.rejectUnauthorized||null;this.open()}var c=b("./transports"),t=b("component-emitter"),v=b("debug")("engine.io-client:socket"),n=b("indexof"),B=b("engine.io-parser"),F=b("parseuri"),r=b("parsejson"),Oa=b("parseqs");e.exports=f;f.priorWebsocketSuccess=!1;t(f.prototype);f.protocol=B.protocol;
f.Socket=f;f.Transport=b("./transport");f.transports=b("./transports");f.parser=b("engine.io-parser");f.prototype.createTransport=function(b){v('creating transport "%s"',b);var e=this.query,f={},g;for(g in e)e.hasOwnProperty(g)&&(f[g]=e[g]);f.EIO=B.protocol;f.transport=b;this.id&&(f.sid=this.id);return new c[b]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:f,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,
timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})};f.prototype.open=function(){if(this.rememberUpgrade&&f.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))var b="websocket";else{if(0==this.transports.length){var e=this;setTimeout(function(){e.emit("error","No transports available")},
0);return}b=this.transports[0]}this.readyState="opening";try{b=this.createTransport(b)}catch(Ua){this.transports.shift();this.open();return}b.open();this.setTransport(b)};f.prototype.setTransport=function(b){v("setting transport %s",b.name);var e=this;this.transport&&(v("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=b;b.on("drain",function(){e.onDrain()}).on("packet",function(b){e.onPacket(b)}).on("error",function(b){e.onError(b)}).on("close",
function(){e.onClose("transport close")})};f.prototype.probe=function(b){function e(){if(r.onlyBinaryUpgrades){var e=!this.supportsBinary&&r.transport.supportsBinary;F=F||e}F||(v('probe transport "%s" opened',b),B.send([{type:"ping",data:"probe"}]),B.once("packet",function(e){F||("pong"==e.type&&"probe"==e.data?(v('probe transport "%s" pong',b),r.upgrading=!0,r.emit("upgrading",B),B&&(f.priorWebsocketSuccess="websocket"==B.name,v('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){F||
"closed"==r.readyState||(v("changing transport and sending upgrade packet"),n(),r.setTransport(B),B.send([{type:"upgrade"}]),r.emit("upgrade",B),B=null,r.upgrading=!1,r.flush())}))):(v('probe transport "%s" failed',b),e=Error("probe error"),e.transport=B.name,r.emit("upgradeError",e)))}))}function g(){F||(F=!0,n(),B.close(),B=null)}function c(e){var f=Error("probe error: "+e);f.transport=B.name;g();v('probe transport "%s" failed because of error: %s',b,e);r.emit("upgradeError",f)}function h(){c("transport closed")}
function m(){c("socket closed")}function t(b){B&&b.name!=B.name&&(v('"%s" works - aborting "%s"',b.name,B.name),g())}function n(){B.removeListener("open",e);B.removeListener("error",c);B.removeListener("close",h);r.removeListener("close",m);r.removeListener("upgrading",t)}v('probing transport "%s"',b);var B=this.createTransport(b,{probe:1}),F=!1,r=this;f.priorWebsocketSuccess=!1;B.once("open",e);B.once("error",c);B.once("close",h);this.once("close",m);this.once("upgrading",t);B.open()};f.prototype.onOpen=
function(){v("socket open");this.readyState="open";f.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){v("starting upgrade probes");for(var b=0,e=this.upgrades.length;b<e;b++)this.probe(this.upgrades[b])}};f.prototype.onPacket=function(b){if("opening"==this.readyState||"open"==this.readyState)switch(v('socket receive: type "%s", data "%s"',b.type,b.data),this.emit("packet",b),this.emit("heartbeat"),
b.type){case "open":this.onHandshake(r(b.data));break;case "pong":this.setPing();break;case "error":var e=Error("server error");e.code=b.data;this.emit("error",e);break;case "message":this.emit("data",b.data),this.emit("message",b.data)}else v('packet received with socket readyState "%s"',this.readyState)};f.prototype.onHandshake=function(b){this.emit("handshake",b);this.id=b.sid;this.transport.query.sid=b.sid;this.upgrades=this.filterUpgrades(b.upgrades);this.pingInterval=b.pingInterval;this.pingTimeout=
b.pingTimeout;this.onOpen();"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};f.prototype.onHeartbeat=function(b){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){if("closed"!=e.readyState)e.onClose("ping timeout")},b||e.pingInterval+e.pingTimeout)};f.prototype.setPing=function(){var b=this;clearTimeout(b.pingIntervalTimer);b.pingIntervalTimer=setTimeout(function(){v("writing ping packet - expecting pong within %sms",
b.pingTimeout);b.ping();b.onHeartbeat(b.pingTimeout)},b.pingInterval)};f.prototype.ping=function(){this.sendPacket("ping")};f.prototype.onDrain=function(){for(var b=0;b<this.prevBufferLen;b++)if(this.callbackBuffer[b])this.callbackBuffer[b]();this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0==this.writeBuffer.length?this.emit("drain"):this.flush()};f.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&
this.writeBuffer.length&&(v("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};f.prototype.write=f.prototype.send=function(b,e){this.sendPacket("message",b,e);return this};f.prototype.sendPacket=function(b,e,f){"closing"!=this.readyState&&"closed"!=this.readyState&&(b={type:b,data:e},this.emit("packetCreate",b),this.writeBuffer.push(b),this.callbackBuffer.push(f),this.flush())};f.prototype.close=
function(){if("opening"==this.readyState||"open"==this.readyState){var b=function(){g.once("upgrade",e);g.once("upgradeError",e)},e=function(){g.removeListener("upgrade",e);g.removeListener("upgradeError",e);f()},f=function(){g.onClose("forced close");v("socket closing - telling transport to close");g.transport.close()};this.readyState="closing";var g=this;if(this.writeBuffer.length)this.once("drain",function(){this.upgrading?b():f()});else this.upgrading?b():f()}return this};f.prototype.onError=
function(b){v("socket error %j",b);f.priorWebsocketSuccess=!1;this.emit("error",b);this.onClose("transport error",b)};f.prototype.onClose=function(b,e){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){v('socket close with reason: "%s"',b);var f=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){f.writeBuffer=[];f.callbackBuffer=[];f.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();
this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",b,e)}};f.prototype.filterUpgrades=function(b){for(var e=[],f=0,g=b.length;f<g;f++)~n(this.transports,b[f])&&e.push(b[f]);return e}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./transport":14,"./transports":15,"component-emitter":8,debug:21,"engine.io-parser":24,indexof:32,parsejson:40,parseqs:41,parseuri:23}],14:[function(b,e,f){function g(b){this.path=
b.path;this.hostname=b.hostname;this.port=b.port;this.secure=b.secure;this.query=b.query;this.timestampParam=b.timestampParam;this.timestampRequests=b.timestampRequests;this.readyState="";this.agent=b.agent||!1;this.socket=b.socket;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized}var c=b("engine.io-parser");b=b("component-emitter");e.exports=g;b(g.prototype);g.timestamps=
0;g.prototype.onError=function(b,e){b=Error(b);b.type="TransportError";b.description=e;this.emit("error",b);return this};g.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this};g.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),this.onClose();return this};g.prototype.send=function(b){if("open"==this.readyState)this.write(b);else throw Error("Transport not open");};g.prototype.onOpen=
function(){this.readyState="open";this.writable=!0;this.emit("open")};g.prototype.onData=function(b){b=c.decodePacket(b,this.socket.binaryType);this.onPacket(b)};g.prototype.onPacket=function(b){this.emit("packet",b)};g.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,"engine.io-parser":24}],15:[function(b,e,f){(function(e){var g=b("xmlhttprequest"),c=b("./polling-xhr"),t=b("./polling-jsonp"),v=b("./websocket");f.polling=function(b){var f=!1,h=!1,m=
!1!==b.jsonp;e.location&&(h="https:"==location.protocol,(f=location.port)||(f=h?443:80),f=b.hostname!=location.hostname||f!=b.port,h=b.secure!=h);b.xdomain=f;b.xscheme=h;if("open"in new g(b)&&!b.forceJSONP)return new c(b);if(!m)throw Error("JSONP disabled");return new t(b)};f.websocket=v}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(b,e,
f){(function(f){function g(){}function c(b){t.call(this,b);this.query=this.query||{};F||(f.___eio||(f.___eio=[]),F=f.___eio);this.index=F.length;var e=this;F.push(function(b){e.onData(b)});this.query.j=this.index;f.document&&f.addEventListener&&f.addEventListener("beforeunload",function(){e.script&&(e.script.onerror=g)},!1)}var t=b("./polling"),v=b("component-inherit");e.exports=c;var n=/\n/g,B=/\\n/g,F;v(c,t);c.prototype.supportsBinary=!1;c.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),
this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.iframe=this.form=null);t.prototype.doClose.call(this)};c.prototype.doPoll=function(){var b=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);e.async=!0;e.src=this.uri();e.onerror=function(e){b.onError("jsonp poll error",e)};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(e,f);this.script=e;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&
setTimeout(function(){var b=document.createElement("iframe");document.body.appendChild(b);document.body.removeChild(b)},100)};c.prototype.doWrite=function(b,e){function f(){g();e()}function g(){if(c.iframe)try{c.form.removeChild(c.iframe)}catch(Ng){c.onError("jsonp polling iframe removal error",Ng)}try{v=document.createElement('<iframe src="javascript:0" name="'+c.iframeId+'">')}catch(Ng){v=document.createElement("iframe"),v.name=c.iframeId,v.src="javascript:0"}v.id=c.iframeId;c.form.appendChild(v);
c.iframe=v}var c=this;if(!this.form){var h=document.createElement("form"),m=document.createElement("textarea"),t=this.iframeId="eio_iframe_"+this.index,v;h.className="socketio";h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=t;h.method="POST";h.setAttribute("accept-charset","utf-8");m.name="d";h.appendChild(m);document.body.appendChild(h);this.form=h;this.area=m}this.form.action=this.uri();g();b=b.replace(B,"\\\n");this.area.value=b.replace(n,"\\n");try{this.form.submit()}catch(Ng){}this.iframe.attachEvent?
this.iframe.onreadystatechange=function(){"complete"==c.iframe.readyState&&f()}:this.iframe.onload=f}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-inherit":9}],17:[function(b,e,f){(function(f){function g(){}function c(b){B.call(this,b);if(f.location){var e="https:"==location.protocol,g=location.port;g||(g=e?443:80);this.xd=b.hostname!=f.location.hostname||g!=b.port;this.xs=b.secure!=e}}function t(b){this.method=
b.method||"GET";this.uri=b.uri;this.xd=!!b.xd;this.xs=!!b.xs;this.async=!1!==b.async;this.data=void 0!=b.data?b.data:null;this.agent=b.agent;this.isBinary=b.isBinary;this.supportsBinary=b.supportsBinary;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized;this.create()}function v(){for(var b in t.requests)t.requests.hasOwnProperty(b)&&t.requests[b].abort()}var n=b("xmlhttprequest"),
B=b("./polling"),F=b("component-emitter"),r=b("component-inherit"),Oa=b("debug")("engine.io-client:polling-xhr");e.exports=c;e.exports.Request=t;r(c,B);c.prototype.supportsBinary=!0;c.prototype.request=function(b){b=b||{};b.uri=this.uri();b.xd=this.xd;b.xs=this.xs;b.agent=this.agent||!1;b.supportsBinary=this.supportsBinary;b.enablesXDR=this.enablesXDR;b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;
return new t(b)};c.prototype.doWrite=function(b,e){b=this.request({method:"POST",data:b,isBinary:"string"!==typeof b&&void 0!==b});var f=this;b.on("success",e);b.on("error",function(b){f.onError("xhr post error",b)});this.sendXhr=b};c.prototype.doPoll=function(){Oa("xhr poll");var b=this.request(),e=this;b.on("data",function(b){e.onData(b)});b.on("error",function(b){e.onError("xhr poll error",b)});this.pollXhr=b};F(t.prototype);t.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,
xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new n(b),g=this;try{Oa("xhr open %s: %s",this.method,this.uri);e.open(this.method,this.uri,this.async);this.supportsBinary&&(e.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type",
"text/plain;charset=UTF-8")}catch(gc){}"withCredentials"in e&&(e.withCredentials=!0);this.hasXDR()?(e.onload=function(){g.onLoad()},e.onerror=function(){g.onError(e.responseText)}):e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status||1223==e.status)g.onLoad();else setTimeout(function(){g.onError(e.status)},0)};Oa("xhr data %s",this.data);e.send(this.data)}catch(gc){setTimeout(function(){g.onError(gc)},0);return}f.document&&(this.index=t.requestsCount++,t.requests[this.index]=this)};
t.prototype.onSuccess=function(){this.emit("success");this.cleanup()};t.prototype.onData=function(b){this.emit("data",b);this.onSuccess()};t.prototype.onError=function(b){this.emit("error",b);this.cleanup(!0)};t.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=this.xhr.onerror=g:this.xhr.onreadystatechange=g;if(b)try{this.xhr.abort()}catch(fc){}f.document&&delete t.requests[this.index];this.xhr=null}};t.prototype.onLoad=function(){try{try{var b=
this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(Ua){}var e="application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(Ua){this.onError(Ua)}if(null!=e)this.onData(e)};t.prototype.hasXDR=function(){return"undefined"!==typeof f.XDomainRequest&&!this.xs&&this.enablesXDR};t.prototype.abort=function(){this.cleanup()};f.document&&(t.requestsCount=0,t.requests={},f.attachEvent?f.attachEvent("onunload",v):f.addEventListener&&f.addEventListener("beforeunload",
v,!1))}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-emitter":8,"component-inherit":9,debug:21,xmlhttprequest:20}],18:[function(b,e,f){function g(b){var e=b&&b.forceBase64;if(!n||e)this.supportsBinary=!1;c.call(this,b)}var c=b("../transport"),m=b("parseqs"),t=b("engine.io-parser");f=b("component-inherit");var v=b("debug")("engine.io-client:polling");e.exports=g;var n=null!=(new (b("xmlhttprequest"))({xdomain:!1})).responseType;
f(g,c);g.prototype.name="polling";g.prototype.doOpen=function(){this.poll()};g.prototype.pause=function(b){function e(){v("paused");f.readyState="paused";b()}var f=this;this.readyState="pausing";if(this.polling||!this.writable){var g=0;this.polling&&(v("we are currently polling - waiting to pause"),g++,this.once("pollComplete",function(){v("pre-pause polling complete");--g||e()}));this.writable||(v("we are currently writing - waiting to pause"),g++,this.once("drain",function(){v("pre-pause writing complete");
--g||e()}))}else e()};g.prototype.poll=function(){v("polling");this.polling=!0;this.doPoll();this.emit("poll")};g.prototype.onData=function(b){var e=this;v("polling got data %s",b);t.decodePayload(b,this.socket.binaryType,function(b,f,g){if("opening"==e.readyState)e.onOpen();if("close"==b.type)return e.onClose(),!1;e.onPacket(b)});"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():v('ignoring poll - transport state "%s"',this.readyState))};g.prototype.doClose=
function(){function b(){v("writing close packet");e.write([{type:"close"}])}var e=this;"open"==this.readyState?(v("transport open - closing"),b()):(v("transport not open - deferring close"),this.once("open",b))};g.prototype.write=function(b){var e=this;this.writable=!1;var f=function(){e.writable=!0;e.emit("drain")};e=this;t.encodePayload(b,this.supportsBinary,function(b){e.doWrite(b,f)})};g.prototype.uri=function(){var b=this.query||{},e=this.secure?"https":"http",f="";!1!==this.timestampRequests&&
(b[this.timestampParam]=+new Date+"-"+c.timestamps++);this.supportsBinary||b.sid||(b.b64=1);b=m.encode(b);this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(f=":"+this.port);b.length&&(b="?"+b);return e+"://"+this.hostname+f+this.path+b}},{"../transport":14,"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,xmlhttprequest:20}],19:[function(b,e,f){function g(b){b&&b.forceBase64&&(this.supportsBinary=!1);c.call(this,b)}var c=b("../transport"),m=b("engine.io-parser"),t=
b("parseqs");f=b("component-inherit");var v=b("debug")("engine.io-client:websocket"),n=b("ws");e.exports=g;f(g,c);g.prototype.name="websocket";g.prototype.supportsBinary=!0;g.prototype.doOpen=function(){if(this.check()){var b=this.uri(),e={agent:this.agent};e.pfx=this.pfx;e.key=this.key;e.passphrase=this.passphrase;e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;this.ws=new n(b,void 0,e);void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.binaryType=
"arraybuffer";this.addEventListeners()}};g.prototype.addEventListeners=function(){var b=this;this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(){b.onClose()};this.ws.onmessage=function(e){b.onData(e.data)};this.ws.onerror=function(e){b.onError("websocket error",e)}};"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(g.prototype.onData=function(b){var e=this;setTimeout(function(){c.prototype.onData.call(e,b)},0)});g.prototype.write=function(b){var e=this;this.writable=
!1;for(var f=0,g=b.length;f<g;f++)m.encodePacket(b[f],this.supportsBinary,function(b){try{e.ws.send(b)}catch(fc){v("websocket closed before onclose event")}});setTimeout(function(){e.writable=!0;e.emit("drain")},0)};g.prototype.onClose=function(){c.prototype.onClose.call(this)};g.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()};g.prototype.uri=function(){var b=this.query||{},e=this.secure?"wss":"ws",f="";this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(f=
":"+this.port);this.timestampRequests&&(b[this.timestampParam]=+new Date);this.supportsBinary||(b.b64=1);b=t.encode(b);b.length&&(b="?"+b);return e+"://"+this.hostname+f+this.path+b};g.prototype.check=function(){return!!n&&!("__initialize"in n&&this.name===g.prototype.name)}},{"../transport":14,"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,ws:66}],20:[function(b,e,f){var g=b("has-cors");e.exports=function(b){var e=b.xdomain,f=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&
(!e||g))return new XMLHttpRequest}catch(v){}try{if("undefined"!=typeof XDomainRequest&&!f&&b)return new XDomainRequest}catch(v){}if(!e)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(v){}}},{"has-cors":31}],21:[function(b,e,f){function g(){try{var b=localStorage.debug}catch(m){}return b}f=e.exports=b("./debug");f.log=function(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)};f.formatArgs=function(){var b=arguments,
e=this.useColors;b[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+b[0]+(e?"%c ":" ")+"+"+f.humanize(this.diff);if(!e)return b;e="color: "+this.color;b=[b[0],e,"color: inherit"].concat(Array.prototype.slice.call(b,1));var g=0,c=0;b[0].replace(/%[a-z%]/g,function(b){"%%"!==b&&(g++,"%c"===b&&(c=g))});b.splice(c,0,e);return b};f.save=function(b){try{null==b?localStorage.removeItem("debug"):localStorage.debug=b}catch(m){}};f.load=g;f.useColors=function(){return"WebkitAppearance"in document.documentElement.style||
window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)};f.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");f.formatters.j=function(b){return JSON.stringify(b)};f.enable(g())},{"./debug":22}],22:[function(b,e,f){f=e.exports=function(b){function e(){}function h(){var b=+new Date;h.diff=b-(c||b);h.prev=c;c=h.curr=b;null==h.useColors&&(h.useColors=f.useColors());null==
h.color&&h.useColors&&(h.color=f.colors[g++%f.colors.length]);var e=Array.prototype.slice.call(arguments);e[0]=f.coerce(e[0]);"string"!==typeof e[0]&&(e=["%o"].concat(e));var m=0;e[0]=e[0].replace(/%([a-z%])/g,function(b,g){if("%%"===b)return b;m++;g=f.formatters[g];"function"===typeof g&&(b=g.call(h,e[m]),e.splice(m,1),m--);return b});"function"===typeof f.formatArgs&&(e=f.formatArgs.apply(h,e));(h.log||f.log||console.log.bind(console)).apply(h,e)}e.enabled=!1;h.enabled=!0;var m=f.enabled(b)?h:e;
m.namespace=b;return m};f.coerce=function(b){return b instanceof Error?b.stack||b.message:b};f.disable=function(){f.enable("")};f.enable=function(b){f.save(b);for(var e=(b||"").split(/[\s,]+/),g=e.length,c=0;c<g;c++)e[c]&&(b=e[c].replace(/\*/g,".*?"),"-"===b[0]?f.skips.push(new RegExp("^"+b.substr(1)+"$")):f.names.push(new RegExp("^"+b+"$")))};f.enabled=function(b){var e;var g=0;for(e=f.skips.length;g<e;g++)if(f.skips[g].test(b))return!1;g=0;for(e=f.names.length;g<e;g++)if(f.names[g].test(b))return!0;
return!1};f.humanize=b("ms");f.names=[];f.skips=[];f.formatters={};var g=0,c},{ms:38}],23:[function(b,e,f){var g=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");e.exports=function(b){var e=b,f=b.indexOf("["),
h=b.indexOf("]");-1!=f&&-1!=h&&(b=b.substring(0,f)+b.substring(f,h).replace(/:/g,";")+b.substring(h,b.length));b=g.exec(b||"");for(var m={},F=14;F--;)m[c[F]]=b[F]||"";-1!=f&&-1!=h&&(m.source=e,m.host=m.host.substring(1,m.host.length-1).replace(/;/g,":"),m.authority=m.authority.replace("[","").replace("]","").replace(/;/g,":"),m.ipv6uri=!0);return m}},{}],24:[function(b,e,f){(function(e){function g(b,e,g){if(!e)return f.encodeBase64Packet(b,g);var c=new FileReader;c.onload=function(){b.data=c.result;
f.encodePacket(b,e,!0,g)};return c.readAsArrayBuffer(b.data)}function c(b,e,f){var g=Array(b.length);f=F(b.length,f);for(var c=function(b,f,c){e(f,function(e,f){g[b]=f;c(e,g)})},h=0;h<b.length;h++)c(h,b[h],f)}var t=b("./keys"),v=b("has-binary"),n=b("arraybuffer.slice"),B=b("base64-arraybuffer"),F=b("after"),r=b("utf8"),Oa=navigator.userAgent.match(/Android/i),k=/PhantomJS/i.test(navigator.userAgent),l=Oa||k;f.protocol=3;var p=f.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},q=t(p),
ma={type:"error",data:"parser error"},Z=b("blob");f.encodePacket=function(b,c,h,m){"function"==typeof c&&(m=c,c=!1);"function"==typeof h&&(m=h,h=null);var t=void 0===b.data?void 0:b.data.buffer||b.data;if(e.ArrayBuffer&&t instanceof ArrayBuffer){if(c){h=b.data;c=new Uint8Array(h);h=new Uint8Array(1+h.byteLength);h[0]=p[b.type];for(b=0;b<c.length;b++)h[b+1]=c[b];b=m(h.buffer)}else b=f.encodeBase64Packet(b,m);return b}if(Z&&t instanceof e.Blob)return c?l?b=g(b,c,m):(c=new Uint8Array(1),c[0]=p[b.type],
b=new Z([c.buffer,b.data]),b=m(b)):b=f.encodeBase64Packet(b,m),b;if(t&&t.base64)return m("b"+f.packets[b.type]+b.data.data);c=p[b.type];void 0!==b.data&&(c+=h?r.encode(String(b.data)):String(b.data));return m(""+c)};f.encodeBase64Packet=function(b,g){var c="b"+f.packets[b.type];if(Z&&b.data instanceof Z){var h=new FileReader;h.onload=function(){var b=h.result.split(",")[1];g(c+b)};return h.readAsDataURL(b.data)}try{var m=String.fromCharCode.apply(null,new Uint8Array(b.data))}catch(Om){b=new Uint8Array(b.data);
m=Array(b.length);for(var t=0;t<b.length;t++)m[t]=b[t];m=String.fromCharCode.apply(null,m)}c+=e.btoa(m);return g(c)};f.decodePacket=function(b,e,g){if("string"==typeof b||void 0===b){if("b"==b.charAt(0))return f.decodeBase64Packet(b.substr(1),e);if(g)try{b=r.decode(b)}catch(Nm){return ma}g=b.charAt(0);return Number(g)==g&&q[g]?1<b.length?{type:q[g],data:b.substring(1)}:{type:q[g]}:ma}g=(new Uint8Array(b))[0];b=n(b,1);Z&&"blob"===e&&(b=new Z([b]));return{type:q[g],data:b}};f.decodeBase64Packet=function(b,
f){var g=q[b.charAt(0)];if(!e.ArrayBuffer)return{type:g,data:{base64:!0,data:b.substr(1)}};b=B.decode(b.substr(1));"blob"===f&&Z&&(b=new Z([b]));return{type:g,data:b}};f.encodePayload=function(b,e,g){"function"==typeof e&&(g=e,e=null);var h=v(b);if(e&&h)return Z&&!l?f.encodePayloadAsBlob(b,g):f.encodePayloadAsArrayBuffer(b,g);if(!b.length)return g("0:");c(b,function(b,g){f.encodePacket(b,h?e:!1,!0,function(b){g(null,b.length+":"+b)})},function(b,e){return g(e.join(""))})};f.decodePayload=function(b,
e,g){if("string"!=typeof b)return f.decodePayloadAsBinary(b,e,g);"function"===typeof e&&(g=e,e=null);if(""==b)return g(ma,0,1);var c="";for(var h,m,t=0,n=b.length;t<n;t++)if(m=b.charAt(t),":"!=m)c+=m;else{if(""==c||c!=(h=Number(c)))return g(ma,0,1);m=b.substr(t+1,h);if(c!=m.length)return g(ma,0,1);if(m.length){c=f.decodePacket(m,e,!0);if(ma.type==c.type&&ma.data==c.data)return g(ma,0,1);if(!1===g(c,t+h,n))return}t+=h;c=""}if(""!=c)return g(ma,0,1)};f.encodePayloadAsArrayBuffer=function(b,e){if(!b.length)return e(new ArrayBuffer(0));
c(b,function(b,e){f.encodePacket(b,!0,!0,function(b){return e(null,b)})},function(b,f){b=f.reduce(function(b,e){e="string"===typeof e?e.length:e.byteLength;return b+e.toString().length+e+2},0);var g=new Uint8Array(b),c=0;f.forEach(function(b){var e="string"===typeof b,f=b;if(e){f=new Uint8Array(b.length);for(var h=0;h<b.length;h++)f[h]=b.charCodeAt(h);f=f.buffer}e?g[c++]=0:g[c++]=1;b=f.byteLength.toString();for(h=0;h<b.length;h++)g[c++]=parseInt(b[h]);g[c++]=255;f=new Uint8Array(f);for(h=0;h<f.length;h++)g[c++]=
f[h]});return e(g.buffer)})};f.encodePayloadAsBlob=function(b,e){c(b,function(b,e){f.encodePacket(b,!0,!0,function(b){var f=new Uint8Array(1);f[0]=1;if("string"===typeof b){for(var g=new Uint8Array(b.length),c=0;c<b.length;c++)g[c]=b.charCodeAt(c);b=g.buffer;f[0]=0}g=(b instanceof ArrayBuffer?b.byteLength:b.size).toString();var h=new Uint8Array(g.length+1);for(c=0;c<g.length;c++)h[c]=parseInt(g[c]);h[g.length]=255;Z&&(b=new Z([f.buffer,h.buffer,b]),e(null,b))})},function(b,f){return e(new Z(f))})};
f.decodePayloadAsBinary=function(b,e,g){"function"===typeof e&&(g=e,e=null);for(var c=[],h=!1;0<b.byteLength;){for(var m=new Uint8Array(b),t=0===m[0],v="",B=1;255!=m[B];B++){if(310<v.length){h=!0;break}v+=m[B]}if(h)return g(ma,0,1);b=n(b,2+v.length);v=parseInt(v);m=n(b,0,v);if(t)try{m=String.fromCharCode.apply(null,new Uint8Array(m))}catch(Pm){for(t=new Uint8Array(m),m="",B=0;B<t.length;B++)m+=String.fromCharCode(t[B])}c.push(m);b=n(b,v)}var F=c.length;c.forEach(function(b,c){g(f.decodePacket(b,e,
!0),c,F)})}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./keys":25,after:1,"arraybuffer.slice":2,"base64-arraybuffer":5,blob:6,"has-binary":30,utf8:60}],25:[function(b,e,f){e.exports=Object.keys||function(b){var e=[],f=Object.prototype.hasOwnProperty,g;for(g in b)f.call(b,g)&&e.push(g);return e}},{}],26:[function(b,e,f){function g(b){m.call(this);b=b||{};this.config={chunksize:16384,pacing:0};for(var e in b)this.config[e]=
b[e];this.channel=this.file=null}function c(){m.call(this);this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null}var m=b("wildemitter");b=b("util");b.inherits(g,m);g.prototype.send=function(b,e){var f=this;this.file=b;this.channel=e;var g="number"!==typeof e.bufferedAmountLowThreshold,c=0,h=function(){var m=new window.FileReader;m.onload=function(){return function(m){f.channel.send(m.target.result);f.emit("progress",c,b.size,m.target.result);b.size>c+m.target.result.byteLength?
g?window.setTimeout(h,f.config.pacing):e.bufferedAmount<=e.bufferedAmountLowThreshold&&window.setTimeout(h,0):(f.emit("progress",b.size,b.size,null),f.emit("sentFile"));c+=f.config.chunksize}}(b);var t=b.slice(c,c+f.config.chunksize);m.readAsArrayBuffer(t)};g||(e.bufferedAmountLowThreshold=8*this.config.chunksize,e.addEventListener("bufferedamountlow",h));window.setTimeout(h,0)};b.inherits(c,m);c.prototype.receive=function(b,e){var f=this;b&&(this.metadata=b);this.channel=e;e.binaryType="arraybuffer";
this.channel.onmessage=function(b){f.received+=b.data.byteLength;f.receiveBuffer.push(b.data);f.emit("progress",f.received,f.metadata.size,b.data);f.received===f.metadata.size?(f.emit("receivedFile",new window.Blob(f.receiveBuffer),f.metadata),f.receiveBuffer=[]):f.received>f.metadata.size&&(console.error("received more than expected, discarding..."),f.receiveBuffer=[])}};e.exports={};e.exports.support="undefined"!==typeof window&&window&&window.File&&window.FileReader&&window.Blob;e.exports.Sender=
g;e.exports.Receiver=c},{util:63,wildemitter:65}],27:[function(b,e,f){var g={};e.exports=function(b,e){var f=2===arguments.length,c=f?e:b;if("undefined"===typeof window||"http:"===window.location.protocol){var h=Error("NavigatorUserMediaError");h.name="HTTPS_REQUIRED";return c(h)}if(window.navigator.userAgent.match("Chrome")){var m=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),F=33,r=!window.chrome.webstore;window.navigator.userAgent.match("Linux")&&(F=35);sessionStorage.getScreenMediaJSExtensionId?
chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(e){e&&""!==e.sourceId?(b=f&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}},b.video.mandatory.chromeMediaSourceId=e.sourceId,window.navigator.mediaDevices.getUserMedia(b).then(function(b){c(null,b)}).catch(function(b){c(b)})):(e=Error("NavigatorUserMediaError"),e.name="NotAllowedError",c(e))}):window.cefGetScreenMedia?
window.cefGetScreenMedia(function(e){e?(b=f&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},b.video.mandatory.chromeMediaSourceId=e,window.navigator.mediaDevices.getUserMedia(b).then(function(b){c(null,b)}).catch(function(b){c(b)})):(e=Error("cefGetScreenMediaError"),e.name="CEF_GETSCREENMEDIA_CANCELED",c(e))}):r||26<=m&&m<=F?(b=f&&b||{video:{mandatory:{googLeakyBucket:!0,
maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){c(null,b)}).catch(function(b){c(b)})):(m=window.setTimeout(function(){h=Error("NavigatorUserMediaError");h.name="EXTENSION_UNAVAILABLE";return c(h)},1E3),g[m]=[c,f?b:null],window.postMessage({type:"getScreen",id:m},"*"))}else window.navigator.userAgent.match("Firefox")&&(33<=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],
10)?(b=f&&b||{video:{mozMediaSource:"window",mediaSource:"window"}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){c(null,b);var e=b.currentTime,f=window.setInterval(function(){b||window.clearInterval(f);if(b.currentTime==e&&(window.clearInterval(f),b.onended))b.onended();e=b.currentTime},500)}).catch(function(b){c(b)})):(h=Error("NavigatorUserMediaError"),h.name="EXTENSION_UNAVAILABLE"))};"undefined"!==typeof window&&window.addEventListener("message",function(b){if(b.origin==window.location.origin)if("gotScreen"==
b.data.type&&g[b.data.id]){var e=g[b.data.id],f=e[1],c=e[0];delete g[b.data.id];""===b.data.sourceId?(b=Error("NavigatorUserMediaError"),b.name="NotAllowedError",c(b)):(f=f||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},f.video.mandatory.chromeMediaSourceId=b.data.sourceId,window.navigator.mediaDevices.getUserMedia(f).then(function(b){c(null,b)}).catch(function(b){c(b)}))}else"getScreenPending"==
b.data.type&&window.clearTimeout(b.data.id)})},{}],28:[function(b,e,f){e.exports=function(){return this}()},{}],29:[function(b,e,f){var g=b("wildemitter"),c;"undefined"!==typeof window&&(c=window.AudioContext||window.webkitAudioContext);var m=null;e.exports=function(b,e){var f=new g;if(!c)return f;e=e||{};var h=e.smoothing||.1,t=e.interval||50,v=e.threshold,Oa=e.play;e=e.history||10;var k=!0;m||(m=new c);var l=m.createAnalyser();l.fftSize=512;l.smoothingTimeConstant=h;var p=new Float32Array(l.frequencyBinCount);
b.jquery&&(b=b[0]);if(b instanceof HTMLAudioElement||b instanceof HTMLVideoElement){var q=m.createMediaElementSource(b);"undefined"===typeof Oa&&(Oa=!0)}else q=m.createMediaStreamSource(b);v=v||-50;q.connect(l);Oa&&l.connect(m.destination);f.speaking=!1;f.setThreshold=function(b){v=b};f.setInterval=function(b){t=b};f.stop=function(){k=!1;f.emit("volume_change",-100,v);f.speaking&&(f.speaking=!1,f.emit("stopped_speaking"));l.disconnect();q.disconnect()};f.speakingHistory=[];for(b=0;b<e;b++)f.speakingHistory.push(0);
var ma=function(){setTimeout(function(){if(k){var b=-Infinity;l.getFloatFrequencyData(p);for(var e=4,g=p.length;e<g;e++)p[e]>b&&0>p[e]&&(b=p[e]);f.emit("volume_change",b,v);e=0;if(b>v&&!f.speaking){for(g=f.speakingHistory.length-3;g<f.speakingHistory.length;g++)e+=f.speakingHistory[g];2<=e&&(f.speaking=!0,f.emit("speaking"))}else if(b<v&&f.speaking){for(g=0;g<f.speakingHistory.length;g++)e+=f.speakingHistory[g];0==e&&(f.speaking=!1,f.emit("stopped_speaking"))}f.speakingHistory.shift();f.speakingHistory.push(0+
(b>v));ma()}},t)};ma();return f}},{wildemitter:65}],30:[function(b,e,f){(function(f){var g=b("isarray");e.exports=function(b){function e(b){if(!b)return!1;if(f.Buffer&&f.Buffer.isBuffer(b)||f.ArrayBuffer&&b instanceof ArrayBuffer||f.Blob&&b instanceof Blob||f.File&&b instanceof File)return!0;if(g(b))for(var c=0;c<b.length;c++){if(e(b[c]))return!0}else if(b&&"object"==typeof b)for(c in b.toJSON&&(b=b.toJSON()),b)if(Object.prototype.hasOwnProperty.call(b,c)&&e(b[c]))return!0;return!1}return e(b)}}).call(this,
"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{isarray:33}],31:[function(b,e,f){b=b("global");try{e.exports="XMLHttpRequest"in b&&"withCredentials"in new b.XMLHttpRequest}catch(g){e.exports=!1}},{global:28}],32:[function(b,e,f){var g=[].indexOf;e.exports=function(b,e){if(g)return b.indexOf(e);for(var f=0;f<b.length;++f)if(b[f]===e)return f;return-1}},{}],33:[function(b,e,f){e.exports=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)}},
{}],34:[function(b,e,f){(function(b){function e(b){if(e[b]!==v)return e[b];if("bug-string-char-index"==b)var f=!1;else if("json"==b)f=e("json-stringify")&&e("json-parse");else{var g;if("json-stringify"==b){f=B.stringify;var h="function"==typeof f&&F;if(h){(g=function(){return 1}).toJSON=g;try{h="0"===f(0)&&"0"===f(new Number)&&'""'==f(new String)&&f(c)===v&&f(v)===v&&f()===v&&"1"===f(g)&&"[1]"==f([g])&&"[null]"==f([v])&&"null"==f(null)&&"[null,null,null]"==f([v,c,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==
f({a:[g,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===f(null,g)&&"[\n 1,\n 2\n]"==f([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==f(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==f(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==f(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==f(new Date(-1))}catch(We){h=!1}}f=h}if("json-parse"==b){f=B.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){g=f('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var m=5==g.a.length&&1===g.a[0];if(m){try{m=
!f('"\t"')}catch(We){}if(m)try{m=1!==f("01")}catch(We){}if(m)try{m=1!==f("1.")}catch(We){}}}}catch(We){m=!1}f=m}}return e[b]=!!f}var c={}.toString,g,v,n="object"==typeof JSON&&JSON,B="object"==typeof f&&f&&!f.nodeType&&f;B&&n?(B.stringify=n.stringify,B.parse=n.parse):B=b.JSON=n||{};var F=new Date(-0xc782b5b800cec);try{F=-109252==F.getUTCFullYear()&&0===F.getUTCMonth()&&1===F.getUTCDate()&&10==F.getUTCHours()&&37==F.getUTCMinutes()&&6==F.getUTCSeconds()&&708==F.getUTCMilliseconds()}catch(Qm){}if(!e("json")){var r=
e("bug-string-char-index");if(!F)var Oa=Math.floor,k=[0,31,59,90,120,151,181,212,243,273,304,334],l=function(b,e){return k[e]+365*(b-1970)+Oa((b-1969+(e=+(1<e)))/4)-Oa((b-1901+e)/100)+Oa((b-1601+e)/400)};(g={}.hasOwnProperty)||(g=function(b){var e={};if((e.__proto__=null,e.__proto__={toString:1},e).toString!=c)g=function(b){var e=this.__proto__;b=b in(this.__proto__=null,this);this.__proto__=e;return b};else{var f=e.constructor;g=function(b){var e=(this.constructor||f).prototype;return b in this&&
!(b in e&&this[b]===e[b])}}e=null;return g.call(this,b)});var p={"boolean":1,number:1,string:1,undefined:1};var q=function(b,e){var f=0,h,m;(h=function(){this.valueOf=0}).prototype.valueOf=0;var t=new h;for(m in t)g.call(t,m)&&f++;h=t=null;f?q=2==f?function(b,e){var f={},h="[object Function]"==c.call(b),m;for(m in b)h&&"prototype"==m||g.call(f,m)||!(f[m]=1)||!g.call(b,m)||e(m)}:function(b,e){var f="[object Function]"==c.call(b),h,m;for(h in b)f&&"prototype"==h||!g.call(b,h)||(m="constructor"===h)||
e(h);(m||g.call(b,h="constructor"))&&e(h)}:(t="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),q=function(b,e){var f="[object Function]"==c.call(b),h,m;if(m=!f&&"function"!=typeof b.constructor)m=typeof b.hasOwnProperty,m="object"==m?!!b.hasOwnProperty:!p[m];m=m?b.hasOwnProperty:g;for(h in b)f&&"prototype"==h||!m.call(b,h)||e(h);for(f=t.length;h=t[--f];m.call(b,h)&&e(h));});return q(b,e)};if(!e("json-stringify")){var ma={92:"\\\\",34:'\\"',
8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},Z=function(b,e){return("000000"+(e||0)).slice(-b)},y=function(b){var e='"',f=0,g=b.length,c=10<g&&r,h;for(c&&(h=b.split(""));f<g;f++){var m=b.charCodeAt(f);switch(m){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=ma[m];break;default:e=32>m?e+("\\u00"+Z(2,m.toString(16))):e+(c?h[f]:r?b.charAt(f):b[f])}}return e+'"'},x=function(b,e,f,h,m,t,n){var B;try{var F=e[b]}catch(Sm){}if("object"==typeof F&&F){var r=c.call(F);if("[object Date]"!=r||g.call(F,
"toJSON"))"function"==typeof F.toJSON&&("[object Number]"!=r&&"[object String]"!=r&&"[object Array]"!=r||g.call(F,"toJSON"))&&(F=F.toJSON(b));else if(F>-1/0&&F<1/0){if(l){var k=Oa(F/864E5);for(r=Oa(k/365.2425)+1970-1;l(r+1,0)<=k;r++);for(B=Oa((k-l(r,0))/30.42);l(r,B+1)<=k;B++);k=1+k-l(r,B);var ec=(F%864E5+864E5)%864E5;var p=Oa(ec/36E5)%24;var fc=Oa(ec/6E4)%60;var Ua=Oa(ec/1E3)%60;ec%=1E3}else r=F.getUTCFullYear(),B=F.getUTCMonth(),k=F.getUTCDate(),p=F.getUTCHours(),fc=F.getUTCMinutes(),Ua=F.getUTCSeconds(),
ec=F.getUTCMilliseconds();F=(0>=r||1E4<=r?(0>r?"-":"+")+Z(6,0>r?-r:r):Z(4,r))+"-"+Z(2,B+1)+"-"+Z(2,k)+"T"+Z(2,p)+":"+Z(2,fc)+":"+Z(2,Ua)+"."+Z(3,ec)+"Z"}else F=null}f&&(F=f.call(e,b,F));if(null===F)return"null";r=c.call(F);if("[object Boolean]"==r)return""+F;if("[object Number]"==r)return F>-1/0&&F<1/0?""+F:"null";if("[object String]"==r)return y(""+F);if("object"==typeof F){for(b=n.length;b--;)if(n[b]===F)throw TypeError();n.push(F);var ma=[];e=t;t+=m;if("[object Array]"==r){B=0;for(b=F.length;B<
b;B++)r=x(B,F,f,h,m,t,n),ma.push(r===v?"null":r);b=ma.length?m?"[\n"+t+ma.join(",\n"+t)+"\n"+e+"]":"["+ma.join(",")+"]":"[]"}else q(h||F,function(b){var e=x(b,F,f,h,m,t,n);e!==v&&ma.push(y(b)+":"+(m?" ":"")+e)}),b=ma.length?m?"{\n"+t+ma.join(",\n"+t)+"\n"+e+"}":"{"+ma.join(",")+"}":"{}";n.pop();return b}};B.stringify=function(b,e,f){var g;if("function"==typeof e||"object"==typeof e&&e)if("[object Function]"==(g=c.call(e)))var h=e;else if("[object Array]"==g){var m={};for(var t=0,n=e.length,v;t<n;v=
e[t++],(g=c.call(v),"[object String]"==g||"[object Number]"==g)&&(m[v]=1));}if(f)if("[object Number]"==(g=c.call(f))){if(0<(f-=f%1)){var B="";for(10<f&&(f=10);B.length<f;B+=" ");}}else"[object String]"==g&&(B=10>=f.length?f:f.slice(0,10));return x("",(v={},v[""]=b,v),h,m,B,"",[])}}if(!e("json-parse")){var A=String.fromCharCode,w={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},u,E,D=function(){u=E=null;throw SyntaxError();},C=function(){for(var b=E,e=b.length,f,g,c,h,m;u<e;)switch(m=
b.charCodeAt(u),m){case 9:case 10:case 13:case 32:u++;break;case 123:case 125:case 91:case 93:case 58:case 44:return f=r?b.charAt(u):b[u],u++,f;case 34:f="@";for(u++;u<e;)if(m=b.charCodeAt(u),32>m)D();else if(92==m)switch(m=b.charCodeAt(++u),m){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:f+=w[m];u++;break;case 117:g=++u;for(c=u+4;u<c;u++)m=b.charCodeAt(u),48<=m&&57>=m||97<=m&&102>=m||65<=m&&70>=m||D();f+=A("0x"+b.slice(g,u));break;default:D()}else{if(34==m)break;m=b.charCodeAt(u);
for(g=u;32<=m&&92!=m&&34!=m;)m=b.charCodeAt(++u);f+=b.slice(g,u)}if(34==b.charCodeAt(u))return u++,f;D();default:g=u;45==m&&(h=!0,m=b.charCodeAt(++u));if(48<=m&&57>=m){for(48==m&&(m=b.charCodeAt(u+1),48<=m&&57>=m)&&D();u<e&&(m=b.charCodeAt(u),48<=m&&57>=m);u++);if(46==b.charCodeAt(u)){for(c=++u;c<e&&(m=b.charCodeAt(c),48<=m&&57>=m);c++);c==u&&D();u=c}m=b.charCodeAt(u);if(101==m||69==m){m=b.charCodeAt(++u);43!=m&&45!=m||u++;for(c=u;c<e&&(m=b.charCodeAt(c),48<=m&&57>=m);c++);c==u&&D();u=c}return+b.slice(g,
u)}h&&D();if("true"==b.slice(u,u+4))return u+=4,!0;if("false"==b.slice(u,u+5))return u+=5,!1;if("null"==b.slice(u,u+4))return u+=4,null;D()}return"$"},z=function(b){var e,f;"$"==b&&D();if("string"==typeof b){if("@"==(r?b.charAt(0):b[0]))return b.slice(1);if("["==b){for(e=[];;f||(f=!0)){b=C();if("]"==b)break;f&&(","==b?(b=C(),"]"==b&&D()):D());","==b&&D();e.push(z(b))}return e}if("{"==b){for(e={};;f||(f=!0)){b=C();if("}"==b)break;f&&(","==b?(b=C(),"}"==b&&D()):D());","!=b&&"string"==typeof b&&"@"==
(r?b.charAt(0):b[0])&&":"==C()||D();e[b.slice(1)]=z(C())}return e}D()}return b},H=function(b,e,f){f=G(b,e,f);f===v?delete b[e]:b[e]=f},G=function(b,e,f){var g=b[e],h;if("object"==typeof g&&g)if("[object Array]"==c.call(g))for(h=g.length;h--;)H(g,h,f);else q(g,function(b){H(g,b,f)});return f.call(b,e,g)};B.parse=function(b,e){var f;u=0;E=""+b;b=z(C());"$"!=C()&&D();u=E=null;return e&&"[object Function]"==c.call(e)?G((f={},f[""]=b,f),"",e):b}}}})(this)},{}],35:[function(b,e,f){function g(b){var e=!0;
b.getTracks().forEach(function(b){e="ended"===b.readyState&&e});return e}function c(){if("undefined"===typeof window||!window.navigator.mozGetUserMedia)return!1;var b=window.navigator.userAgent.match(/Firefox\/(\d+)\./);return 50>(b&&1<=b.length&&parseInt(b[1],10))}function m(b){n.call(this);var e=this.config={detectSpeakingEvents:!1,audioFallback:!1,media:{audio:!0,video:!0},harkOptions:null,logger:B},f;for(f in b)b.hasOwnProperty(f)&&(this.config[f]=b[f]);this.logger=e.logger;this._log=this.logger.log.bind(this.logger,
"LocalMedia:");this._logerror=this.logger.error.bind(this.logger,"LocalMedia:");this.localStreams=[];this.localScreens=[];navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||this._logerror("Your browser does not support local media capture.");this._audioMonitors=[];this.on("localStreamStopped",this._stopAudioMonitor.bind(this));this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}f=b("util");var t=b("hark"),v=b("getscreenmedia"),n=b("wildemitter"),B=b("mockconsole");f.inherits(m,
n);m.prototype.start=function(b,e){var f=this,c=b||this.config.media;this.emit("localStreamRequested",c);navigator.mediaDevices.getUserMedia(c).then(function(b){c.audio&&f.config.detectSpeakingEvents&&f._setupAudioMonitor(b,f.config.harkOptions);f.localStreams.push(b);b.getTracks().forEach(function(e){e.addEventListener("ended",function(){g(b)&&f._removeStream(b)})});f.emit("localStream",b);if(e)return e(null,b)}).catch(function(b){if(f.config.audioFallback&&"NotFoundError"===b.name&&!1!==c.video)c.video=
!1,f.start(c,e);else if(f.emit("localStreamRequestFailed",c),e)return e(b,null)})};m.prototype.stop=function(b){this.stopStream(b);this.stopScreenShare(b)};m.prototype.stopStream=function(b){var e=this;b?-1<this.localStreams.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),c()&&this._removeStream(b)):this.localStreams.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});c()&&e._removeStream(b)})};m.prototype.startScreenShare=function(b,e){var f=this;this.emit("localScreenRequested");
"function"!==typeof b||e||(e=b,b=null);v(b,function(b,g){b?f.emit("localScreenRequestFailed"):(f.localScreens.push(g),g.getTracks().forEach(function(b){b.addEventListener("ended",function(){var b=!0;g.getTracks().forEach(function(e){b="ended"===e.readyState&&b});b&&f._removeStream(g)})}),f.emit("localScreen",g));if(e)return e(b,g)})};m.prototype.stopScreenShare=function(b){var e=this;b?-1<this.localScreens.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),c()&&this._removeStream(b)):this.localScreens.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});
c()&&e._removeStream(b)})};m.prototype.mute=function(){this._audioEnabled(!1);this.emit("audioOff")};m.prototype.unmute=function(){this._audioEnabled(!0);this.emit("audioOn")};m.prototype.pauseVideo=function(){this._videoEnabled(!1);this.emit("videoOff")};m.prototype.resumeVideo=function(){this._videoEnabled(!0);this.emit("videoOn")};m.prototype.pause=function(){this.mute();this.pauseVideo()};m.prototype.resume=function(){this.unmute();this.resumeVideo()};m.prototype._audioEnabled=function(b){this.localStreams.forEach(function(e){e.getAudioTracks().forEach(function(e){e.enabled=
!!b})})};m.prototype._videoEnabled=function(b){this.localStreams.forEach(function(e){e.getVideoTracks().forEach(function(e){e.enabled=!!b})})};m.prototype.isAudioEnabled=function(){var b=!0;this.localStreams.forEach(function(e){e.getAudioTracks().forEach(function(e){b=b&&e.enabled})});return b};m.prototype.isVideoEnabled=function(){var b=!0;this.localStreams.forEach(function(e){e.getVideoTracks().forEach(function(e){b=b&&e.enabled})});return b};m.prototype._removeStream=function(b){var e=this.localStreams.indexOf(b);
-1<e?(this.localStreams.splice(e,1),this.emit("localStreamStopped",b)):(e=this.localScreens.indexOf(b),-1<e&&(this.localScreens.splice(e,1),this.emit("localScreenStopped",b)))};m.prototype._setupAudioMonitor=function(b,e){this._log("Setup audio");e=t(b,e);var f=this,g;e.on("speaking",function(){f.emit("speaking")});e.on("stopped_speaking",function(){g&&clearTimeout(g);g=setTimeout(function(){f.emit("stoppedSpeaking")},1E3)});e.on("volume_change",function(b,e){f.emit("volumeChange",b,e)});this._audioMonitors.push({audio:e,
stream:b})};m.prototype._stopAudioMonitor=function(b){var e=-1;this._audioMonitors.forEach(function(f,g){f.stream===b&&(e=g)});-1<e&&(this._audioMonitors[e].audio.stop(),this._audioMonitors.splice(e,1))};e.exports=m},{getscreenmedia:27,hark:29,mockconsole:37,util:63,wildemitter:65}],36:[function(b,e,f){(function(b){function c(b,e){b.set(e[0],e[1]);return b}function g(b,e){b.add(e);return b}function t(b,e){for(var f=-1,c=b?b.length:0;++f<c&&!1!==e(b[f],f,b););return b}function v(b,e,f,c){var g=-1,
h=b?b.length:0;for(c&&h&&(f=b[++g]);++g<h;)f=e(f,b[g],g,b);return f}function n(b){var e=!1;if(null!=b&&"function"!=typeof b.toString)try{e=!!(b+"")}catch(yb){}return e}function B(b){var e=-1,f=Array(b.size);b.forEach(function(b,c){f[++e]=[c,b]});return f}function F(b,e){return function(f){return b(e(f))}}function r(b){var e=-1,f=Array(b.size);b.forEach(function(b){f[++e]=b});return f}function k(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var c=b[e];this.set(c[0],c[1])}}function l(b){var e=
-1,f=b?b.length:0;for(this.clear();++e<f;){var c=b[e];this.set(c[0],c[1])}}function p(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var c=b[e];this.set(c[0],c[1])}}function Ua(b){this.__data__=new l(b)}function q(b,e,f){var c=b[e];Q.call(b,e)&&(c===f||c!==c&&f!==f)&&(void 0!==f||e in b)||(b[e]=f)}function ma(b,e){for(var f=b.length;f--;){var c=b[f][0];if(c===e||c!==c&&e!==e)return f}return-1}function Z(b,e){return b&&E(e,R(e),b)}function u(b,e,f,c,g,h,m){var v;c&&(v=h?c(b,g,h,m):c(b));if(void 0!==
v)return v;if(!P(b))return b;if(g=za(b)){if(v=H(b),!e)return w(b,v)}else{var B=wa(b),F="[object Function]"==B||"[object GeneratorFunction]"==B;if(Sa(b))return x(b,e);if("[object Object]"==B||"[object Arguments]"==B||F&&!h){if(n(b))return h?b:{};v=G(F?{}:b);if(!e)return D(b,Z(v,b))}else{if(!K[B])return h?b:{};v=O(b,B,u,e)}}m||(m=new Ua);if(h=m.get(b))return h;m.set(b,v);if(!g)var r=f?y(b,R,oa):R(b);t(r||b,function(g,h){r&&(h=g,g=b[h]);q(v,h,u(g,e,f,c,h,b,m))});return v}function y(b,e,f){e=e(b);if(!za(b)){b=
f(b);f=-1;for(var c=b.length,g=e.length;++f<c;)e[g+f]=b[f]}return e}function x(b,e){if(e)return b.slice();e=new b.constructor(b.length);b.copy(e);return e}function A(b){var e=new b.constructor(b.byteLength);(new da(e)).set(new da(b));return e}function w(b,e){var f=-1,c=b.length;for(e||(e=Array(c));++f<c;)e[f]=b[f];return e}function E(b,e,f,c){f||(f={});for(var g=-1,h=e.length;++g<h;){var m=e[g],t=c?c(f[m],b[m],m,f,b):void 0;q(f,m,void 0===t?b[m]:t)}return f}function D(b,e){return E(b,oa(b),e)}function C(b,
e){b=b.__data__;var f=typeof e;return("string"==f||"number"==f||"symbol"==f||"boolean"==f?"__proto__"!==e:null===e)?b["string"==typeof e?"string":"hash"]:b.map}function z(b,e){b=null==b?void 0:b[e];e=!P(b)||X&&X in b?!1:(J(b)||n(b)?ha:T).test(Wc(b));return e?b:void 0}function H(b){var e=b.length,f=b.constructor(e);e&&"string"==typeof b[0]&&Q.call(b,"index")&&(f.index=b.index,f.input=b.input);return f}function G(b){"function"!=typeof b.constructor||Ji(b)?b={}:(b=ka(b),b=P(b)?ea(b):{});return b}function O(b,
e,f,h){var m=b.constructor;switch(e){case "[object ArrayBuffer]":return A(b);case "[object Boolean]":case "[object Date]":return new m(+b);case "[object DataView]":return e=h?A(b.buffer):b.buffer,new b.constructor(e,b.byteOffset,b.byteLength);case "[object Float32Array]":case "[object Float64Array]":case "[object Int8Array]":case "[object Int16Array]":case "[object Int32Array]":case "[object Uint8Array]":case "[object Uint8ClampedArray]":case "[object Uint16Array]":case "[object Uint32Array]":return e=
h?A(b.buffer):b.buffer,new b.constructor(e,b.byteOffset,b.length);case "[object Map]":return e=h?f(B(b),!0):B(b),v(e,c,new b.constructor);case "[object Number]":case "[object String]":return new m(b);case "[object RegExp]":return e=new b.constructor(b.source,U.exec(b)),e.lastIndex=b.lastIndex,e;case "[object Set]":return e=h?f(r(b),!0):r(b),v(e,g,new b.constructor);case "[object Symbol]":return ja?Object(ja.call(b)):{}}}function Ji(b){var e=b&&b.constructor;return b===("function"==typeof e&&e.prototype||
ba)}function Wc(b){if(null!=b){try{return Y.call(b)}catch(Pa){}return b+""}return""}function Ki(b){var e;if(e=null!=b)e=b.length,e="number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e;return e&&!J(b)}function J(b){b=P(b)?ca.call(b):"";return"[object Function]"==b||"[object GeneratorFunction]"==b}function P(b){var e=typeof b;return!!b&&("object"==e||"function"==e)}function R(b){if(Ki(b)){var e;(e=za(b))||(e=!!b&&"object"==typeof b&&Ki(b)&&Q.call(b,"callee")&&(!ia.call(b,"callee")||"[object Arguments]"==
ca.call(b)));if(e){e=b.length;for(var f=String,c=-1,g=Array(e);++c<e;)g[c]=f(c);e=g}else e=[];f=e.length;c=!!f;for(var h in b){if(!(g=!Q.call(b,h))&&(g=c)&&!(g="length"==h)){g=h;var m=f;m=null==m?9007199254740991:m;g=!!m&&("number"==typeof g||W.test(g))&&-1<g&&0==g%1&&g<m}g||e.push(h)}b=e}else if(Ji(b)){h=[];for(e in Object(b))Q.call(b,e)&&"constructor"!=e&&h.push(e);b=h}else b=ta(b);return b}function L(){return[]}function S(){return!1}var U=/\w*$/,T=/^\[object .+?Constructor\]$/,W=/^(?:0|[1-9]\d*)$/,
K={};K["[object Arguments]"]=K["[object Array]"]=K["[object ArrayBuffer]"]=K["[object DataView]"]=K["[object Boolean]"]=K["[object Date]"]=K["[object Float32Array]"]=K["[object Float64Array]"]=K["[object Int8Array]"]=K["[object Int16Array]"]=K["[object Int32Array]"]=K["[object Map]"]=K["[object Number]"]=K["[object Object]"]=K["[object RegExp]"]=K["[object Set]"]=K["[object String]"]=K["[object Symbol]"]=K["[object Uint8Array]"]=K["[object Uint8ClampedArray]"]=K["[object Uint16Array]"]=K["[object Uint32Array]"]=
!0;K["[object Error]"]=K["[object Function]"]=K["[object WeakMap]"]=!1;var M="object"==typeof self&&self&&self.Object===Object&&self;b="object"==typeof b&&b&&b.Object===Object&&b||M||Function("return this")();var V=(M="object"==typeof f&&f&&!f.nodeType&&f)&&"object"==typeof e&&e&&!e.nodeType&&e;M=V&&V.exports===M;V=Array.prototype;var N=Function.prototype,ba=Object.prototype,I=b["__core-js_shared__"],X=function(){var b=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),
Y=N.toString,Q=ba.hasOwnProperty,ca=ba.toString,ha=RegExp("^"+Y.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");N=M?b.Buffer:void 0;M=b.Symbol;var da=b.Uint8Array,ka=F(Object.getPrototypeOf,Object),ea=Object.create,ia=ba.propertyIsEnumerable,aa=V.splice;V=Object.getOwnPropertySymbols;N=N?N.isBuffer:void 0;var ta=F(Object.keys,Object),fa=z(b,"DataView"),ua=z(b,"Map"),Qa=z(b,"Promise"),pa=z(b,"Set");b=z(b,"WeakMap");var na=
z(Object,"create"),Ia=Wc(fa),Ea=Wc(ua),va=Wc(Qa),qa=Wc(pa),Ja=Wc(b),ja=(M=M?M.prototype:void 0)?M.valueOf:void 0;k.prototype.clear=function(){this.__data__=na?na(null):{}};k.prototype["delete"]=function(b){return this.has(b)&&delete this.__data__[b]};k.prototype.get=function(b){var e=this.__data__;return na?(b=e[b],"__lodash_hash_undefined__"===b?void 0:b):Q.call(e,b)?e[b]:void 0};k.prototype.has=function(b){var e=this.__data__;return na?void 0!==e[b]:Q.call(e,b)};k.prototype.set=function(b,e){this.__data__[b]=
na&&void 0===e?"__lodash_hash_undefined__":e;return this};l.prototype.clear=function(){this.__data__=[]};l.prototype["delete"]=function(b){var e=this.__data__;b=ma(e,b);if(0>b)return!1;b==e.length-1?e.pop():aa.call(e,b,1);return!0};l.prototype.get=function(b){var e=this.__data__;b=ma(e,b);return 0>b?void 0:e[b][1]};l.prototype.has=function(b){return-1<ma(this.__data__,b)};l.prototype.set=function(b,e){var f=this.__data__,c=ma(f,b);0>c?f.push([b,e]):f[c][1]=e;return this};p.prototype.clear=function(){this.__data__=
{hash:new k,map:new (ua||l),string:new k}};p.prototype["delete"]=function(b){return C(this,b)["delete"](b)};p.prototype.get=function(b){return C(this,b).get(b)};p.prototype.has=function(b){return C(this,b).has(b)};p.prototype.set=function(b,e){C(this,b).set(b,e);return this};Ua.prototype.clear=function(){this.__data__=new l};Ua.prototype["delete"]=function(b){return this.__data__["delete"](b)};Ua.prototype.get=function(b){return this.__data__.get(b)};Ua.prototype.has=function(b){return this.__data__.has(b)};
Ua.prototype.set=function(b,e){var f=this.__data__;if(f instanceof l){f=f.__data__;if(!ua||199>f.length)return f.push([b,e]),this;f=this.__data__=new p(f)}f.set(b,e);return this};var oa=V?F(V,Object):L,wa=function(b){return ca.call(b)};if(fa&&"[object DataView]"!=wa(new fa(new ArrayBuffer(1)))||ua&&"[object Map]"!=wa(new ua)||Qa&&"[object Promise]"!=wa(Qa.resolve())||pa&&"[object Set]"!=wa(new pa)||b&&"[object WeakMap]"!=wa(new b))wa=function(b){var e=ca.call(b);if(b=(b="[object Object]"==e?b.constructor:
void 0)?Wc(b):void 0)switch(b){case Ia:return"[object DataView]";case Ea:return"[object Map]";case va:return"[object Promise]";case qa:return"[object Set]";case Ja:return"[object WeakMap]"}return e};var za=Array.isArray,Sa=N||S;e.exports=function(b){return u(b,!0,!0)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],37:[function(b,e,f){b="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profileEnd time timeEnd trace warn".split(" ");
f=b.length;for(var c=function(){},h={};f--;)h[b[f]]=c;e.exports=h},{}],38:[function(b,e,f){function c(b){if(b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(b)){var e=parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case "years":case "year":case "y":return e*m;case "days":case "day":case "d":return 864E5*e;case "hours":case "hour":case "h":return 36E5*e;case "minutes":case "minute":case "m":return 6E4*e;case "seconds":case "second":case "s":return 1E3*e;case "ms":return e}}}
function h(b,e,f){if(!(b<e))return b<1.5*e?Math.floor(b/e)+" "+f:Math.ceil(b/e)+" "+f+"s"}var m=315576E5;e.exports=function(b,e){e=e||{};return"string"==typeof b?c(b):e.long?h(b,864E5,"day")||h(b,36E5,"hour")||h(b,6E4,"minute")||h(b,1E3,"second")||b+" ms":864E5<=b?Math.round(b/864E5)+"d":36E5<=b?Math.round(b/36E5)+"h":6E4<=b?Math.round(b/6E4)+"m":1E3<=b?Math.round(b/1E3)+"s":b+"ms"}},{}],39:[function(b,e,f){var c=Object.prototype.hasOwnProperty;f.keys=Object.keys||function(b){var e=[],f;for(f in b)c.call(b,
f)&&e.push(f);return e};f.values=function(b){var e=[],f;for(f in b)c.call(b,f)&&e.push(b[f]);return e};f.merge=function(b,e){for(var f in e)c.call(e,f)&&(b[f]=e[f]);return b};f.length=function(b){return f.keys(b).length};f.isEmpty=function(b){return 0==f.length(b)}},{}],40:[function(b,e,f){(function(b){var f=/^[\],:{}\s]*$/,c=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,g=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,v=/(?:^|:|,)(?:\s*\[)+/g,n=/^\s+/,B=/\s+$/;e.exports=function(e){if("string"!=
typeof e||!e)return null;e=e.replace(n,"").replace(B,"");if(b.JSON&&JSON.parse)return JSON.parse(e);if(f.test(e.replace(c,"@").replace(g,"]").replace(v,"")))return(new Function("return "+e))()}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],41:[function(b,e,f){f.encode=function(b){var e="",f;for(f in b)b.hasOwnProperty(f)&&(e.length&&(e+="&"),e+=encodeURIComponent(f)+"="+encodeURIComponent(b[f]));return e};f.decode=function(b){var e=
{};b=b.split("&");for(var f=0,c=b.length;f<c;f++){var g=b[f].split("=");e[decodeURIComponent(g[0])]=decodeURIComponent(g[1])}return e}},{}],42:[function(b,e,f){var c=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,h="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");
e.exports=function(b){b=c.exec(b||"");for(var e={},f=14;f--;)e[h[f]]=b[f]||"";return e}},{}],43:[function(b,e,f){function c(){throw Error("setTimeout has not been defined");}function h(){throw Error("clearTimeout has not been defined");}function m(b){if(r===setTimeout)return setTimeout(b,0);if((r===c||!r)&&setTimeout)return r=setTimeout,setTimeout(b,0);try{return r(b,0)}catch(Z){try{return r.call(null,b,0)}catch(nl){return r.call(this,b,0)}}}function t(b){if(k===clearTimeout)return clearTimeout(b);
if((k===h||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(b);try{return k(b)}catch(Z){try{return k.call(null,b)}catch(nl){return k.call(this,b)}}}function v(){p&&Ua&&(p=!1,Ua.length?l=Ua.concat(l):q=-1,l.length&&n())}function n(){if(!p){var b=m(v);p=!0;for(var e=l.length;e;){Ua=l;for(l=[];++q<e;)Ua&&Ua[q].run();q=-1;e=l.length}Ua=null;p=!1;t(b)}}function B(b,e){this.fun=b;this.array=e}function F(){}b=e.exports={};try{var r="function"===typeof setTimeout?setTimeout:c}catch(ma){r=c}try{var k=
"function"===typeof clearTimeout?clearTimeout:h}catch(ma){k=h}var l=[],p=!1,Ua,q=-1;b.nextTick=function(b){var e=Array(arguments.length-1);if(1<arguments.length)for(var f=1;f<arguments.length;f++)e[f-1]=arguments[f];l.push(new B(b,e));1!==l.length||p||m(n)};B.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=F;b.addListener=F;b.once=F;b.off=F;b.removeListener=F;b.removeAllListeners=F;b.emit=F;b.prependListener=
F;b.prependOnceListener=F;b.listeners=function(b){return[]};b.binding=function(b){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(b){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}],44:[function(b,e,f){function c(b,e){var f=this,c;m.call(this);b=b||{};b.iceServers=b.iceServers||[];this.enableChromeNativeSimulcast=!1;e&&e.optional&&window.chrome&&null===navigator.appVersion.match(/Chromium\//)&&e.optional.forEach(function(b){b.enableChromeNativeSimulcast&&
(f.enableChromeNativeSimulcast=!0)});this.enableMultiStreamHacks=!1;e&&e.optional&&window.chrome&&e.optional.forEach(function(b){b.enableMultiStreamHacks&&(f.enableMultiStreamHacks=!0)});this.restrictBandwidth=0;e&&e.optional&&e.optional.forEach(function(b){b.andyetRestrictBandwidth&&(f.restrictBandwidth=b.andyetRestrictBandwidth)});this.batchIceCandidates=0;e&&e.optional&&e.optional.forEach(function(b){b.andyetBatchIce&&(f.batchIceCandidates=b.andyetBatchIce)});this.batchedIceCandidates=[];e&&e.optional&&
window.chrome&&e.optional.forEach(function(b){b.andyetFasterICE&&(f.eliminateDuplicateCandidates=b.andyetFasterICE)});e&&e.optional&&e.optional.forEach(function(b){b.andyetDontSignalCandidates&&(f.dontSignalCandidates=b.andyetDontSignalCandidates)});this.assumeSetLocalSuccess=!1;e&&e.optional&&e.optional.forEach(function(b){b.andyetAssumeSetLocalSuccess&&(f.assumeSetLocalSuccess=b.andyetAssumeSetLocalSuccess)});window.navigator.mozGetUserMedia&&e&&e.optional&&(this.wtFirefox=0,e.optional.forEach(function(b){b.andyetFirefoxMakesMeSad&&
(f.wtFirefox=b.andyetFirefoxMakesMeSad,0<f.wtFirefox&&(f.firefoxcandidatebuffer=[]))}));this.pc=new RTCPeerConnection(b,e);this.getLocalStreams="function"===typeof this.pc.getLocalStreams?this.pc.getLocalStreams.bind(this.pc):function(){return[]};this.getSenders="function"===typeof this.pc.getSenders?this.pc.getSenders.bind(this.pc):function(){return[]};this.getRemoteStreams="function"===typeof this.pc.getRemoteStreams?this.pc.getRemoteStreams.bind(this.pc):function(){return[]};this.getReceivers=
"function"===typeof this.pc.getReceivers?this.pc.getReceivers.bind(this.pc):function(){return[]};this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=function(b){"function"===typeof f.pc.removeStream?f.pc.removeStream.apply(f.pc,arguments):"function"===typeof f.pc.removeTrack&&b.getTracks().forEach(function(b){f.pc.removeTrack(b)})};"function"===typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc));this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onremovetrack=
this.emit.bind(this,"removeTrack");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:!1,
sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};this.iceCredentials={local:{},remote:{}};for(c in b)this.config[c]=b[c];if(this.config.debug)this.on("*",function(){(b.logger||console).log("PeerConnection event:",arguments)});this.hadRemoteIPv6Candidate=this.hadLocalIPv6Candidate=this.hadRemoteRelayCandidate=this.hadLocalRelayCandidate=this.hadRemoteStunCandidate=this.hadLocalStunCandidate=!1;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}f=b("util");var h=
b("sdp-jingle-json"),m=b("wildemitter"),t=b("lodash.clonedeep");f.inherits(c,m);Object.defineProperty(c.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(c.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});c.prototype._role=function(){return this.isInitiator?"initiator":"responder"};c.prototype.addStream=function(b){this.localStream=b;this.pc.addStream(b)};c.prototype._checkLocalCandidate=function(b){b=h.toCandidateJSON(b);
"srflx"==b.type?this.hadLocalStunCandidate=!0:"relay"==b.type&&(this.hadLocalRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)};c.prototype._checkRemoteCandidate=function(b){b=h.toCandidateJSON(b);"srflx"==b.type?this.hadRemoteStunCandidate=!0:"relay"==b.type&&(this.hadRemoteRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)};c.prototype.processIce=function(b,e){e=e||function(){};var f=this;if("closed"===this.pc.signalingState)return e();if(b.contents||
b.jingle&&b.jingle.contents){var c=this.remoteDescription.contents.map(function(b){return b.name});(b.contents||b.jingle.contents).forEach(function(b){var g=b.transport||{},m=g.candidates||[],t=c.indexOf(b.name),n=b.name,v=f.remoteDescription.contents.find(function(e){return e.name===b.name}),B=function(){m.forEach(function(b){b=h.toCandidateSDP(b);f.pc.addIceCandidate(new RTCIceCandidate({candidate:b,sdpMLineIndex:t,sdpMid:n}),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b)});
e()};f.iceCredentials.remote[b.name]&&g.ufrag&&f.iceCredentials.remote[b.name].ufrag!==g.ufrag?v?(v.transport.ufrag=g.ufrag,v.transport.pwd=g.pwd,g={type:"offer",jingle:f.remoteDescription},g.sdp=h.toSessionSDP(g.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"}),f.pc.setRemoteDescription(new RTCSessionDescription(g),function(){B()},function(b){f.emit("error",b)})):f.emit("error","ice restart failed to find matching content"):B()})}else{b.candidate&&0!==b.candidate.candidate.indexOf("a=")&&
(b.candidate.candidate="a="+b.candidate.candidate);if(this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(b.candidate),e();f.pc.addIceCandidate(new RTCIceCandidate(b.candidate),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b.candidate.candidate);e()}};c.prototype.offer=function(b,e){var f=this,c=2===arguments.length,g=c&&b?b:{offerToReceiveAudio:1,offerToReceiveVideo:1};
e=(e=c?e:b)||function(){};if("closed"===this.pc.signalingState)return e("Already closed");this.pc.createOffer(function(b){var c={type:"offer",sdp:b.sdp};f.assumeSetLocalSuccess&&(f.emit("offer",c),e(null,c));f._candidateBuffer=[];f.pc.setLocalDescription(b,function(){if(f.config.useJingle){var g=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"});g.sid=f.config.sid;f.localDescription=g;g.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.local[b.name]={ufrag:e.ufrag,
pwd:e.pwd})});c.jingle=g}c.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkLocalCandidate(b)});f.assumeSetLocalSuccess||(f.emit("offer",c),e(null,c))},function(b){f.emit("error",b);e(b)})},function(b){f.emit("error",b);e(b)},g)};c.prototype.handleOffer=function(b,e){e=e||function(){};var f=this;b.type="offer";if(b.jingle){this.enableChromeNativeSimulcast&&b.jingle.contents.forEach(function(b){"video"===b.name&&(b.application.googConferenceFlag=!0)});this.enableMultiStreamHacks&&
b.jingle.contents.forEach(function(b){if("video"===b.name){var e=b.application.sources||[];if(0===e.length||"3735928559"!==e[0].ssrc)e.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),b.application.sources=e}});if(0<f.restrictBandwidth&&2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name){var c=b.jingle.contents[1];c.application&&c.application.bandwidth&&c.application.bandwidth.bandwidth||(b.jingle.contents[1].application.bandwidth=
{type:"AS",bandwidth:f.restrictBandwidth.toString()},b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"outgoing"}))}b.jingle.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.remote[b.name]={ufrag:e.ufrag,pwd:e.pwd})});b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"});f.remoteDescription=b.jingle}b.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkRemoteCandidate(b)});
f.pc.setRemoteDescription(new RTCSessionDescription(b),function(){e()},e)};c.prototype.answerAudioOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},b)};c.prototype.answerBroadcastOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},b)};c.prototype.answer=function(b,e){var f=2===arguments.length;this._answer(f&&b?b:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},f?e:b)};c.prototype.handleAnswer=function(b,e){e=
e||function(){};var f=this;b.jingle&&(b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"}),f.remoteDescription=b.jingle,b.jingle.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.remote[b.name]={ufrag:e.ufrag,pwd:e.pwd})}));b.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkRemoteCandidate(b)});f.pc.setRemoteDescription(new RTCSessionDescription(b),function(){f.wtFirefox&&window.setTimeout(function(){f.firefoxcandidatebuffer.forEach(function(b){f.pc.addIceCandidate(new RTCIceCandidate(b),
function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b.candidate)});f.firefoxcandidatebuffer=null},f.wtFirefox);e(null)},e)};c.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};c.prototype._answer=function(b,e){e=e||function(){};var f=this;if(!this.pc.remoteDescription)throw Error("remoteDescription not set");if("closed"===this.pc.signalingState)return e("Already closed");f.pc.createAnswer(function(b){var c=[];if(f.enableChromeNativeSimulcast&&
(b.jingle=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"}),2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name)){var g=b.jingle.contents[1].application.sourceGroups||[],m=!1;g.forEach(function(b){"SIM"==b.semantics&&(m=!0)});if(!m&&b.jingle.contents[1].application.sources.length){var n=JSON.parse(JSON.stringify(b.jingle.contents[1].application.sources[0]));n.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(n);c.push(b.jingle.contents[1].application.sources[0].ssrc);
c.push(n.ssrc);g.push({semantics:"SIM",sources:c});c=JSON.parse(JSON.stringify(n));c.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(c);g.push({semantics:"FID",sources:[n.ssrc,c.ssrc]});b.jingle.contents[1].application.sourceGroups=g;b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"outgoing"})}}var v={type:"answer",sdp:b.sdp};f.assumeSetLocalSuccess&&(g=t(v),f.emit("answer",g),e(null,g));f._candidateBuffer=[];f.pc.setLocalDescription(b,
function(){if(f.config.useJingle){var c=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"});c.sid=f.config.sid;f.localDescription=c;v.jingle=c}f.enableChromeNativeSimulcast&&(v.jingle||(v.jingle=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"})),v.jingle.contents[1].application.sources.forEach(function(b,e){b.parameters=b.parameters.map(function(b){"msid"===b.key&&(b.value+="-"+Math.floor(e/2));return b})}),v.sdp=h.toSessionSDP(v.jingle,{sid:f.sdpSessionID,role:f._role(),direction:"outgoing"}));
v.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkLocalCandidate(b)});f.assumeSetLocalSuccess||(c=t(v),f.emit("answer",c),e(null,c))},function(b){f.emit("error",b);e(b)})},function(b){f.emit("error",b);e(b)},b)};c.prototype._onIce=function(b){var e=this;if(b.candidate){if(!this.dontSignalCandidates){b=b.candidate;var f={candidate:{candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex}};this._checkLocalCandidate(b.candidate);var c=h.toCandidateJSON(b.candidate);
if(this.eliminateDuplicateCandidates&&"relay"===c.type){var g=this._candidateBuffer.filter(function(b){return"relay"===b.type}).map(function(b){return b.foundation+":"+b.component});var m=g.indexOf(c.foundation+":"+c.component);if(-1<m&&c.priority>>24>=g[m].priority>>24)return}if("max-bundle"===this.config.bundlePolicy&&(g=this._candidateBuffer.filter(function(b){return c.type===b.type}).map(function(b){return b.address+":"+b.port}),m=g.indexOf(c.address+":"+c.port),-1<m))return;if("require"!==this.config.rtcpMuxPolicy||
"2"!==c.component){this._candidateBuffer.push(c);if(e.config.useJingle&&(b.sdpMid||(b.sdpMid=e.pc.remoteDescription&&"offer"===e.pc.remoteDescription.type?e.remoteDescription.contents[b.sdpMLineIndex].name:e.localDescription.contents[b.sdpMLineIndex].name),e.iceCredentials.local[b.sdpMid]||h.toSessionJSON(e.pc.localDescription.sdp,{role:e._role(),direction:"outgoing"}).contents.forEach(function(b){var f=b.transport||{};f.ufrag&&(e.iceCredentials.local[b.name]={ufrag:f.ufrag,pwd:f.pwd})}),f.jingle=
{contents:[{name:b.sdpMid,creator:e._role(),transport:{transportType:"iceUdp",ufrag:e.iceCredentials.local[b.sdpMid].ufrag,pwd:e.iceCredentials.local[b.sdpMid].pwd,candidates:[c]}}]},0<e.batchIceCandidates)){0===e.batchedIceCandidates.length&&window.setTimeout(function(){var b={};e.batchedIceCandidates.forEach(function(e){e=e.contents[0];b[e.name]||(b[e.name]=e);b[e.name].transport.candidates.push(e.transport.candidates[0])});var f={jingle:{contents:[]}};Object.keys(b).forEach(function(e){f.jingle.contents.push(b[e])});
e.batchedIceCandidates=[];e.emit("ice",f)},e.batchIceCandidates);e.batchedIceCandidates.push(f.jingle);return}this.emit("ice",f)}}}else this.emit("endOfCandidates")};c.prototype._onDataChannel=function(b){b=b.channel;this._remoteDataChannels.push(b);this.emit("addChannel",b)};c.prototype.createDataChannel=function(b,e){b=this.pc.createDataChannel(b,e);this._localDataChannels.push(b);return b};c.prototype.getStats=function(){if("function"===typeof arguments[0]){var b=arguments[0];this.pc.getStats().then(function(e){b(null,
e)},function(e){b(e)})}else return this.pc.getStats.apply(this.pc,arguments)};e.exports=c},{"lodash.clonedeep":36,"sdp-jingle-json":45,util:63,wildemitter:65}],45:[function(b,e,f){var c=b("./lib/tosdp"),h=b("./lib/tojson");f.toIncomingSDPOffer=function(b){return c.toSessionSDP(b,{role:"responder",direction:"incoming"})};f.toOutgoingSDPOffer=function(b){return c.toSessionSDP(b,{role:"initiator",direction:"outgoing"})};f.toIncomingSDPAnswer=function(b){return c.toSessionSDP(b,{role:"initiator",direction:"incoming"})};
f.toOutgoingSDPAnswer=function(b){return c.toSessionSDP(b,{role:"responder",direction:"outgoing"})};f.toIncomingMediaSDPOffer=function(b){return c.toMediaSDP(b,{role:"responder",direction:"incoming"})};f.toOutgoingMediaSDPOffer=function(b){return c.toMediaSDP(b,{role:"initiator",direction:"outgoing"})};f.toIncomingMediaSDPAnswer=function(b){return c.toMediaSDP(b,{role:"initiator",direction:"incoming"})};f.toOutgoingMediaSDPAnswer=function(b){return c.toMediaSDP(b,{role:"responder",direction:"outgoing"})};
f.toCandidateSDP=c.toCandidateSDP;f.toMediaSDP=c.toMediaSDP;f.toSessionSDP=c.toSessionSDP;f.toIncomingJSONOffer=function(b,e){return h.toSessionJSON(b,{role:"responder",direction:"incoming",creators:e})};f.toOutgoingJSONOffer=function(b,e){return h.toSessionJSON(b,{role:"initiator",direction:"outgoing",creators:e})};f.toIncomingJSONAnswer=function(b,e){return h.toSessionJSON(b,{role:"initiator",direction:"incoming",creators:e})};f.toOutgoingJSONAnswer=function(b,e){return h.toSessionJSON(b,{role:"responder",
direction:"outgoing",creators:e})};f.toIncomingMediaJSONOffer=function(b,e){return h.toMediaJSON(b,{role:"responder",direction:"incoming",creator:e})};f.toOutgoingMediaJSONOffer=function(b,e){return h.toMediaJSON(b,{role:"initiator",direction:"outgoing",creator:e})};f.toIncomingMediaJSONAnswer=function(b,e){return h.toMediaJSON(b,{role:"initiator",direction:"incoming",creator:e})};f.toOutgoingMediaJSONAnswer=function(b,e){return h.toMediaJSON(b,{role:"responder",direction:"outgoing",creator:e})};
f.toCandidateJSON=h.toCandidateJSON;f.toMediaJSON=h.toMediaJSON;f.toSessionJSON=h.toSessionJSON},{"./lib/tojson":48,"./lib/tosdp":49}],46:[function(b,e,f){f.lines=function(b){return b.split("\r\n").filter(function(b){return 0<b.length})};f.findLine=function(b,e,f){for(var c=b.length,g=0;g<e.length;g++)if(e[g].substr(0,c)===b)return e[g];if(!f)return!1;for(e=0;e<f.length;e++)if(f[e].substr(0,c)===b)return f[e];return!1};f.findLines=function(b,e,f){for(var c=[],g=b.length,h=0;h<e.length;h++)e[h].substr(0,
g)===b&&c.push(e[h]);if(c.length||!f)return c;for(e=0;e<f.length;e++)f[e].substr(0,g)===b&&c.push(f[e]);return c};f.mline=function(b){b=b.substr(2).split(" ");for(var e={media:b[0],port:b[1],proto:b[2],formats:[]},f=3;f<b.length;f++)b[f]&&e.formats.push(b[f]);return e};f.rtpmap=function(b){b=b.substr(9).split(" ");var e={id:b.shift()};b=b[0].split("/");e.name=b[0];e.clockrate=b[1];e.channels=3==b.length?b[2]:"1";return e};f.sctpmap=function(b){b=b.substr(10).split(" ");return{number:b.shift(),protocol:b.shift(),
streams:b.shift()}};f.fmtp=function(b){for(var e,f=b.substr(b.indexOf(" ")+1).split(";"),c=[],g=0;g<f.length;g++)e=f[g].split("="),b=e[0].trim(),e=e[1],b&&e?c.push({key:b,value:e}):b&&c.push({key:"",value:b});return c};f.crypto=function(b){b=b.substr(9).split(" ");return{tag:b[0],cipherSuite:b[1],keyParams:b[2],sessionParams:b.slice(3).join(" ")}};f.fingerprint=function(b){b=b.substr(14).split(" ");return{hash:b[0],value:b[1]}};f.extmap=function(b){b=b.substr(9).split(" ");var e={},f=b.shift(),c=
f.indexOf("/");0<=c?(e.id=f.substr(0,c),e.senders=f.substr(c+1)):(e.id=f,e.senders="sendrecv");e.uri=b.shift()||"";return e};f.rtcpfb=function(b){b=b.substr(10).split(" ");var e={};e.id=b.shift();e.type=b.shift();"trr-int"===e.type?e.value=b.shift():e.subtype=b.shift()||"";e.parameters=b;return e};f.candidate=function(b){b=0===b.indexOf("a=candidate:")?b.substring(12).split(" "):b.substring(10).split(" ");for(var e={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:b[3],ip:b[4],
port:b[5],type:b[7],generation:"0"},f=8;f<b.length;f+=2)"raddr"===b[f]?e.relAddr=b[f+1]:"rport"===b[f]?e.relPort=b[f+1]:"generation"===b[f]?e.generation=b[f+1]:"tcptype"===b[f]&&(e.tcpType=b[f+1]);e.network="1";return e};f.sourceGroups=function(b){for(var e=[],f=0;f<b.length;f++){var c=b[f].substr(13).split(" ");e.push({semantics:c.shift(),sources:c})}return e};f.sources=function(b){for(var e=[],f={},c=0;c<b.length;c++){var g=b[c].substr(7).split(" "),n=g.shift();if(!f[n]){var B={ssrc:n,parameters:[]};
e.push(B);f[n]=B}g=g.join(" ").split(":");B=g.shift();g=g.join(":")||null;f[n].parameters.push({key:B,value:g})}return e};f.groups=function(b){for(var e=[],f,c=0;c<b.length;c++)f=b[c].substr(8).split(" "),e.push({semantics:f.shift(),contents:f});return e};f.bandwidth=function(b){b=b.substr(2).split(":");var e={};e.type=b.shift();e.bandwidth=b.shift();return e};f.msid=function(b){b=b.substr(7);var e=b.split(" ");return{msid:b,mslabel:e[0],label:e[1]}}},{}],47:[function(b,e,f){e.exports={initiator:{incoming:{initiator:"recvonly",
responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",
both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],48:[function(b,e,f){var c=b("./senders"),h=b("./parsers"),m=Math.random();f._setIdCounter=function(b){m=b};f.toSessionJSON=function(b,e){var c,g=e.creators||[],m=e.role||"initiator";e=e.direction||"outgoing";var t=b.split("\r\nm=");for(c=1;c<t.length;c++)t[c]="m="+t[c],c!==t.length-1&&(t[c]+="\r\n");var v=t.shift()+"\r\n",k=h.lines(v);b={};var l=[];for(c=0;c<t.length;c++)l.push(f.toMediaJSON(t[c],
v,{role:m,direction:e,creator:g[c]||"initiator"}));b.contents=l;g=h.findLines("a=group:",k);g.length&&(b.groups=h.groups(g));return b};f.toMediaJSON=function(b,e,g){var m=g.creator||"initiator",t=g.role||"initiator",n=g.direction||"outgoing",v=h.lines(b);b=h.lines(e);e=h.mline(v[0]);m={creator:m,name:e.media,application:{applicationType:"rtp",media:e.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==e.media&&
(m.application={applicationType:"datachannel"},m.transport.sctp=[]);var k=m.application,l=m.transport;if(e=h.findLine("a=mid:",v))m.name=e.substr(6);h.findLine("a=sendrecv",v,b)?m.senders="both":h.findLine("a=sendonly",v,b)?m.senders=c[t][n].sendonly:h.findLine("a=recvonly",v,b)?m.senders=c[t][n].recvonly:h.findLine("a=inactive",v,b)&&(m.senders="none");if("rtp"==k.applicationType){if(e=h.findLine("b=",v))k.bandwidth=h.bandwidth(e);if(e=h.findLine("a=ssrc:",v))k.ssrc=e.substr(7).split(" ")[0];h.findLines("a=rtpmap:",
v).forEach(function(b){var e=h.rtpmap(b);e.parameters=[];e.feedback=[];h.findLines("a=fmtp:"+e.id,v).forEach(function(b){e.parameters=h.fmtp(b)});h.findLines("a=rtcp-fb:"+e.id,v).forEach(function(b){e.feedback.push(h.rtcpfb(b))});k.payloads.push(e)});h.findLines("a=crypto:",v,b).forEach(function(b){k.encryption.push(h.crypto(b))});h.findLine("a=rtcp-mux",v)&&(k.mux=!0);h.findLines("a=rtcp-fb:*",v).forEach(function(b){k.feedback.push(h.rtcpfb(b))});h.findLines("a=extmap:",v).forEach(function(b){b=
h.extmap(b);b.senders=c[t][n][b.senders];k.headerExtensions.push(b)});e=h.findLines("a=ssrc-group:",v);k.sourceGroups=h.sourceGroups(e||[]);e=h.findLines("a=ssrc:",v);var p=k.sources=h.sources(e||[]);if(e=h.findLine("a=msid:",v)){var q=h.msid(e);["msid","mslabel","label"].forEach(function(b){for(var e=0;e<p.length;e++){for(var f=!1,c=0;c<p[e].parameters.length;c++)p[e].parameters[c].key===b&&(f=!0);f||p[e].parameters.push({key:b,value:q[b]})}})}h.findLine("a=x-google-flag:conference",v,b)&&(k.googConferenceFlag=
!0)}e=h.findLines("a=fingerprint:",v,b);var ma=h.findLine("a=setup:",v,b);e.forEach(function(b){b=h.fingerprint(b);ma&&(b.setup=ma.substr(8));l.fingerprints.push(b)});e=h.findLine("a=ice-ufrag:",v,b);g=h.findLine("a=ice-pwd:",v,b);e&&g&&(l.ufrag=e.substr(12),l.pwd=g.substr(10),l.candidates=[],h.findLines("a=candidate:",v,b).forEach(function(b){l.candidates.push(f.toCandidateJSON(b))}));"datachannel"==k.applicationType&&h.findLines("a=sctpmap:",v).forEach(function(b){b=h.sctpmap(b);l.sctp.push(b)});
return m};f.toCandidateJSON=function(b){b=h.candidate(b.split("\r\n")[0]);b.id=(m++).toString(36).substr(0,12);return b}},{"./parsers":46,"./senders":47}],49:[function(b,e,f){var c=b("./senders");f.toSessionSDP=function(b,e){var c=e.sid||b.sid||Date.now(),g=e.time||Date.now(),h=["v=0","o=- "+c+" "+g+" IN IP4 0.0.0.0","s=-","t=0 0"];c=b.contents||[];var m=!1;c.forEach(function(b){b.application.sources&&b.application.sources.length&&(m=!0)});m&&h.push("a=msid-semantic: WMS *");(b.groups||[]).forEach(function(b){h.push("a=group:"+
b.semantics+" "+b.contents.join(" "))});c.forEach(function(b){h.push(f.toMediaSDP(b,e))});return h.join("\r\n")+"\r\n"};f.toMediaSDP=function(b,e){var g=[],h=e.role||"initiator",m=e.direction||"outgoing",B=b.application;e=b.transport;var F=B.payloads||[],r=e&&e.fingerprints||[],k=[];"datachannel"==B.applicationType?(k.push("application"),k.push("1"),k.push("DTLS/SCTP"),e.sctp&&e.sctp.forEach(function(b){k.push(b.number)})):(k.push(B.media),k.push("1"),0<r.length?k.push("UDP/TLS/RTP/SAVPF"):B.encryption&&
0<B.encryption.length?k.push("RTP/SAVPF"):k.push("RTP/AVPF"),F.forEach(function(b){k.push(b.id)}));g.push("m="+k.join(" "));g.push("c=IN IP4 0.0.0.0");B.bandwidth&&B.bandwidth.type&&B.bandwidth.bandwidth&&g.push("b="+B.bandwidth.type+":"+B.bandwidth.bandwidth);"rtp"==B.applicationType&&g.push("a=rtcp:1 IN IP4 0.0.0.0");e&&(e.ufrag&&g.push("a=ice-ufrag:"+e.ufrag),e.pwd&&g.push("a=ice-pwd:"+e.pwd),r.forEach(function(b){g.push("a=fingerprint:"+b.hash+" "+b.value);b.setup&&g.push("a=setup:"+b.setup)}),
e.sctp&&e.sctp.forEach(function(b){g.push("a=sctpmap:"+b.number+" "+b.protocol+" "+b.streams)}));"rtp"==B.applicationType&&g.push("a="+(c[h][m][b.senders]||"sendrecv"));g.push("a=mid:"+b.name);B.sources&&B.sources.length&&(B.sources[0].parameters||[]).forEach(function(b){"msid"===b.key&&g.push("a=msid:"+b.value)});B.mux&&g.push("a=rtcp-mux");(B.encryption||[]).forEach(function(b){g.push("a=crypto:"+b.tag+" "+b.cipherSuite+" "+b.keyParams+(b.sessionParams?" "+b.sessionParams:""))});B.googConferenceFlag&&
g.push("a=x-google-flag:conference");F.forEach(function(b){var e="a=rtpmap:"+b.id+" "+b.name+"/"+b.clockrate;b.channels&&"1"!=b.channels&&(e+="/"+b.channels);g.push(e);if(b.parameters&&b.parameters.length){e=["a=fmtp:"+b.id];var f=[];b.parameters.forEach(function(b){f.push((b.key?b.key+"=":"")+b.value)});e.push(f.join(";"));g.push(e.join(" "))}b.feedback&&b.feedback.forEach(function(e){"trr-int"===e.type?g.push("a=rtcp-fb:"+b.id+" trr-int "+(e.value?e.value:"0")):g.push("a=rtcp-fb:"+b.id+" "+e.type+
(e.subtype?" "+e.subtype:""))})});B.feedback&&B.feedback.forEach(function(b){"trr-int"===b.type?g.push("a=rtcp-fb:* trr-int "+(b.value?b.value:"0")):g.push("a=rtcp-fb:* "+b.type+(b.subtype?" "+b.subtype:""))});(B.headerExtensions||[]).forEach(function(b){g.push("a=extmap:"+b.id+(b.senders?"/"+c[h][m][b.senders]:"")+" "+b.uri)});(B.sourceGroups||[]).forEach(function(b){g.push("a=ssrc-group:"+b.semantics+" "+b.sources.join(" "))});(B.sources||[]).forEach(function(b){for(var e=0;e<b.parameters.length;e++){var f=
b.parameters[e];g.push("a=ssrc:"+(b.ssrc||B.ssrc)+" "+f.key+(f.value?":"+f.value:""))}});(e.candidates||[]).forEach(function(b){g.push(f.toCandidateSDP(b))});return g.join("\r\n")};f.toCandidateSDP=function(b){var e=[];e.push(b.foundation);e.push(b.component);e.push(b.protocol.toUpperCase());e.push(b.priority);e.push(b.ip);e.push(b.port);var f=b.type;e.push("typ");e.push(f);("srflx"===f||"prflx"===f||"relay"===f)&&b.relAddr&&b.relPort&&(e.push("raddr"),e.push(b.relAddr),e.push("rport"),e.push(b.relPort));
b.tcpType&&"TCP"==b.protocol.toUpperCase()&&(e.push("tcptype"),e.push(b.tcpType));e.push("generation");e.push(b.generation||"0");return"a=candidate:"+e.join(" ")}},{"./senders":47}],50:[function(b,e,f){e.exports=b("./lib/")},{"./lib/":51}],51:[function(b,e,f){function c(b,e){"object"==typeof b&&(e=b,b=void 0);e=e||{};b=h(b);var f=b.source,c=b.id;e.forceNew||e["force new connection"]||!1===e.multiplex?(v("ignoring socket cache for %s",f),e=t(f,e)):(n[c]||(v("new io instance for %s",f),n[c]=t(f,e)),
e=n[c]);return e.socket(b.path)}var h=b("./url"),m=b("socket.io-parser"),t=b("./manager"),v=b("debug")("socket.io-client");e.exports=f=c;var n=f.managers={};f.protocol=m.protocol;f.connect=c;f.Manager=b("./manager");f.Socket=b("./socket")},{"./manager":52,"./socket":54,"./url":55,debug:10,"socket.io-parser":57}],52:[function(b,e,f){function c(b,e){if(!(this instanceof c))return new c(b,e);b&&"object"==typeof b&&(e=b,b=void 0);e=e||{};e.path=e.path||"/socket.io";this.nsps={};this.subs=[];this.opts=
e;this.reconnection(!1!==e.reconnection);this.reconnectionAttempts(e.reconnectionAttempts||Infinity);this.reconnectionDelay(e.reconnectionDelay||1E3);this.reconnectionDelayMax(e.reconnectionDelayMax||5E3);this.randomizationFactor(e.randomizationFactor||.5);this.backoff=new k({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==e.timeout?2E4:e.timeout);this.readyState="closed";this.uri=b;this.connected=[];this.encoding=!1;this.packetBuffer=
[];this.encoder=new t.Encoder;this.decoder=new t.Decoder;(this.autoConnect=!1!==e.autoConnect)&&this.open()}b("./url");var h=b("engine.io-client"),m=b("./socket");f=b("component-emitter");var t=b("socket.io-parser"),v=b("./on"),n=b("component-bind");b("object-component");var B=b("debug")("socket.io-client:manager"),F=b("indexof"),k=b("backo2");e.exports=c;c.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var b in this.nsps)this.nsps[b].emit.apply(this.nsps[b],arguments)};c.prototype.updateSocketIds=
function(){for(var b in this.nsps)this.nsps[b].id=this.engine.id};f(c.prototype);c.prototype.reconnection=function(b){if(!arguments.length)return this._reconnection;this._reconnection=!!b;return this};c.prototype.reconnectionAttempts=function(b){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=b;return this};c.prototype.reconnectionDelay=function(b){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=b;this.backoff&&this.backoff.setMin(b);return this};
c.prototype.randomizationFactor=function(b){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=b;this.backoff&&this.backoff.setJitter(b);return this};c.prototype.reconnectionDelayMax=function(b){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=b;this.backoff&&this.backoff.setMax(b);return this};c.prototype.timeout=function(b){if(!arguments.length)return this._timeout;this._timeout=b;return this};c.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&
this._reconnection&&0===this.backoff.attempts&&this.reconnect()};c.prototype.open=c.prototype.connect=function(b){B("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;B("opening %s",this.uri);var e=this.engine=h(this.uri,this.opts),f=this;this.readyState="opening";this.skipReconnect=!1;var c=v(e,"open",function(){f.onopen();b&&b()}),g=v(e,"error",function(e){B("connect_error");f.cleanup();f.readyState="closed";f.emitAll("connect_error",e);if(b){var c=Error("Connection error");
c.data=e;b(c)}else f.maybeReconnectOnOpen()});if(!1!==this._timeout){var m=this._timeout;B("connect attempt will timeout after %d",m);var t=setTimeout(function(){B("connect attempt timed out after %d",m);c.destroy();e.close();e.emit("error","timeout");f.emitAll("connect_timeout",m)},m);this.subs.push({destroy:function(){clearTimeout(t)}})}this.subs.push(c);this.subs.push(g);return this};c.prototype.onopen=function(){B("open");this.cleanup();this.readyState="open";this.emit("open");var b=this.engine;
this.subs.push(v(b,"data",n(this,"ondata")));this.subs.push(v(this.decoder,"decoded",n(this,"ondecoded")));this.subs.push(v(b,"error",n(this,"onerror")));this.subs.push(v(b,"close",n(this,"onclose")))};c.prototype.ondata=function(b){this.decoder.add(b)};c.prototype.ondecoded=function(b){this.emit("packet",b)};c.prototype.onerror=function(b){B("error",b);this.emitAll("error",b)};c.prototype.socket=function(b){var e=this.nsps[b];if(!e){e=new m(this,b);this.nsps[b]=e;var f=this;e.on("connect",function(){e.id=
f.engine.id;~F(f.connected,e)||f.connected.push(e)})}return e};c.prototype.destroy=function(b){b=F(this.connected,b);~b&&this.connected.splice(b,1);this.connected.length||this.close()};c.prototype.packet=function(b){B("writing packet %j",b);var e=this;e.encoding?e.packetBuffer.push(b):(e.encoding=!0,this.encoder.encode(b,function(b){for(var f=0;f<b.length;f++)e.engine.write(b[f]);e.encoding=!1;e.processPacketQueue()}))};c.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var b=
this.packetBuffer.shift();this.packet(b)}};c.prototype.cleanup=function(){for(var b;b=this.subs.shift();)b.destroy();this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};c.prototype.close=c.prototype.disconnect=function(){this.skipReconnect=!0;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};c.prototype.onclose=function(b){B("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",b);this._reconnection&&!this.skipReconnect&&this.reconnect()};
c.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var b=this;if(this.backoff.attempts>=this._reconnectionAttempts)B("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();B("will wait %dms before reconnect attempt",e);this.reconnecting=!0;var f=setTimeout(function(){b.skipReconnect||(B("attempting reconnect"),b.emitAll("reconnect_attempt",b.backoff.attempts),b.emitAll("reconnecting",b.backoff.attempts),
b.skipReconnect||b.open(function(e){e?(B("reconnect attempt error"),b.reconnecting=!1,b.reconnect(),b.emitAll("reconnect_error",e.data)):(B("reconnect success"),b.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(f)}})}};c.prototype.onreconnect=function(){var b=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",b)}},{"./on":53,"./socket":54,"./url":55,backo2:4,"component-bind":7,"component-emitter":8,debug:10,"engine.io-client":11,
indexof:32,"object-component":39,"socket.io-parser":57}],53:[function(b,e,f){e.exports=function(b,e,f){b.on(e,f);return{destroy:function(){b.removeListener(e,f)}}}},{}],54:[function(b,e,f){function c(b,e){this.io=b;this.nsp=e;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&this.open();this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0}var h=b("socket.io-parser");f=b("component-emitter");var m=b("to-array"),t=b("./on"),v=b("component-bind"),n=b("debug")("socket.io-client:socket"),
B=b("has-binary");e.exports=c;var F={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},k=f.prototype.emit;f(c.prototype);c.prototype.subEvents=function(){if(!this.subs){var b=this.io;this.subs=[t(b,"open",v(this,"onopen")),t(b,"packet",v(this,"onpacket")),t(b,"close",v(this,"onclose"))]}};c.prototype.open=c.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==
this.io.readyState)this.onopen();return this};c.prototype.send=function(){var b=m(arguments);b.unshift("message");this.emit.apply(this,b);return this};c.prototype.emit=function(b){if(F.hasOwnProperty(b))return k.apply(this,arguments),this;var e=m(arguments),f=h.EVENT;B(e)&&(f=h.BINARY_EVENT);f={type:f,data:e};"function"==typeof e[e.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),f.id=this.ids++);this.connected?this.packet(f):this.sendBuffer.push(f);return this};
c.prototype.packet=function(b){b.nsp=this.nsp;this.io.packet(b)};c.prototype.onopen=function(){n("transport is open - connecting");"/"!=this.nsp&&this.packet({type:h.CONNECT})};c.prototype.onclose=function(b){n("close (%s)",b);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",b)};c.prototype.onpacket=function(b){if(b.nsp==this.nsp)switch(b.type){case h.CONNECT:this.onconnect();break;case h.EVENT:this.onevent(b);break;case h.BINARY_EVENT:this.onevent(b);break;case h.ACK:this.onack(b);
break;case h.BINARY_ACK:this.onack(b);break;case h.DISCONNECT:this.ondisconnect();break;case h.ERROR:this.emit("error",b.data)}};c.prototype.onevent=function(b){var e=b.data||[];n("emitting event %j",e);null!=b.id&&(n("attaching ack callback to event"),e.push(this.ack(b.id)));this.connected?k.apply(this,e):this.receiveBuffer.push(e)};c.prototype.ack=function(b){var e=this,f=!1;return function(){if(!f){f=!0;var c=m(arguments);n("sending ack %j",c);var g=B(c)?h.BINARY_ACK:h.ACK;e.packet({type:g,id:b,
data:c})}}};c.prototype.onack=function(b){n("calling ack %s with %j",b.id,b.data);this.acks[b.id].apply(this,b.data);delete this.acks[b.id]};c.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};c.prototype.emitBuffered=function(){var b;for(b=0;b<this.receiveBuffer.length;b++)k.apply(this,this.receiveBuffer[b]);this.receiveBuffer=[];for(b=0;b<this.sendBuffer.length;b++)this.packet(this.sendBuffer[b]);this.sendBuffer=[]};c.prototype.ondisconnect=
function(){n("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};c.prototype.destroy=function(){if(this.subs){for(var b=0;b<this.subs.length;b++)this.subs[b].destroy();this.subs=null}this.io.destroy(this)};c.prototype.close=c.prototype.disconnect=function(){this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:h.DISCONNECT}));this.destroy();if(this.connected)this.onclose("io client disconnect");return this}},{"./on":53,"component-bind":7,"component-emitter":8,
debug:10,"has-binary":30,"socket.io-parser":57,"to-array":59}],55:[function(b,e,f){(function(f){var c=b("parseuri"),g=b("debug")("socket.io-client:url");e.exports=function(b,e){var h=b;e=e||f.location;null==b&&(b=e.protocol+"//"+e.host);"string"==typeof b&&("/"==b.charAt(0)&&(b="/"==b.charAt(1)?e.protocol+b:e.hostname+b),/^(https?|wss?):\/\//.test(b)||(g("protocol-less url %s",b),b="undefined"!=typeof e?e.protocol+"//"+b:"https://"+b),g("parse %s",b),h=c(b));h.port||(/^(http|ws)$/.test(h.protocol)?
h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443"));h.path=h.path||"/";h.id=h.protocol+"://"+h.host+":"+h.port;h.href=h.protocol+"://"+h.host+(e&&e.port==h.port?"":":"+h.port);return h}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{debug:10,parseuri:42}],56:[function(b,e,f){(function(e){var c=b("isarray"),g=b("./is-buffer");f.deconstructPacket=function(b){function e(b){if(!b)return b;if(g(b)){var h={_placeholder:!0,
num:f.length};f.push(b);return h}if(c(b)){h=Array(b.length);for(var m=0;m<b.length;m++)h[m]=e(b[m]);return h}if("object"==typeof b&&!(b instanceof Date)){h={};for(m in b)h[m]=e(b[m]);return h}return b}var f=[];b.data=e(b.data);b.attachments=f.length;return{packet:b,buffers:f}};f.reconstructPacket=function(b,e){function f(b){if(b&&b._placeholder)return e[b.num];if(c(b))for(var g=0;g<b.length;g++)b[g]=f(b[g]);else if(b&&"object"==typeof b)for(g in b)b[g]=f(b[g]);return b}b.data=f(b.data);b.attachments=
void 0;return b};f.removeBlobs=function(b,f){function h(b,n,v){if(!b)return b;if(e.Blob&&b instanceof Blob||e.File&&b instanceof File){m++;var B=new FileReader;B.onload=function(){v?v[n]=this.result:t=this.result;--m||f(t)};B.readAsArrayBuffer(b)}else if(c(b))for(B=0;B<b.length;B++)h(b[B],B,b);else if(b&&"object"==typeof b&&!g(b))for(B in b)h(b[B],B,b)}var m=0,t=b;h(t);m||f(t)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./is-buffer":58,
isarray:33}],57:[function(b,e,f){function c(){}function h(b){var e=!1;var c=""+b.type;if(f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type)c+=b.attachments,c+="-";b.nsp&&"/"!=b.nsp&&(e=!0,c+=b.nsp);null!=b.id&&(e&&(c+=",",e=!1),c+=b.id);null!=b.data&&(e&&(c+=","),c+=B.stringify(b.data));n("encoded %j as %s",b,c);return c}function m(b,e){k.removeBlobs(b,function(b){var f=k.deconstructPacket(b);b=h(f.packet);f=f.buffers;f.unshift(b);e(f)})}function t(){this.reconstructor=null}function v(b){this.reconPack=
b;this.buffers=[]}var n=b("debug")("socket.io-parser"),B=b("json3");b("isarray");e=b("component-emitter");var k=b("./binary"),r=b("./is-buffer");f.protocol=4;f.types="CONNECT DISCONNECT EVENT BINARY_EVENT ACK BINARY_ACK ERROR".split(" ");f.CONNECT=0;f.DISCONNECT=1;f.EVENT=2;f.ACK=3;f.ERROR=4;f.BINARY_EVENT=5;f.BINARY_ACK=6;f.Encoder=c;f.Decoder=t;c.prototype.encode=function(b,e){n("encoding packet %j",b);f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type?m(b,e):(b=h(b),e([b]))};e(t.prototype);t.prototype.add=
function(b){if("string"==typeof b){a:{var e={},c=0;e.type=Number(b.charAt(0));if(null==f.types[e.type])b={type:f.ERROR,data:"parser error"};else{if(f.BINARY_EVENT==e.type||f.BINARY_ACK==e.type){for(var g="";"-"!=b.charAt(++c)&&(g+=b.charAt(c),c!=b.length););if(g!=Number(g)||"-"!=b.charAt(c))throw Error("Illegal attachments");e.attachments=Number(g)}if("/"==b.charAt(c+1))for(e.nsp="";++c;){g=b.charAt(c);if(","==g)break;e.nsp+=g;if(c==b.length)break}else e.nsp="/";g=b.charAt(c+1);if(""!==g&&Number(g)==
g){for(e.id="";++c;){g=b.charAt(c);if(null==g||Number(g)!=g){--c;break}e.id+=b.charAt(c);if(c==b.length)break}e.id=Number(e.id)}if(b.charAt(++c))try{e.data=B.parse(b.substr(c))}catch(gc){b={type:f.ERROR,data:"parser error"};break a}n("decoded %s as %j",b,e);b=e}}f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type?(this.reconstructor=new v(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else if(r(b)||b.base64)if(this.reconstructor){if(b=this.reconstructor.takeBinaryData(b))this.reconstructor=
null,this.emit("decoded",b)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+b);};t.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};v.prototype.takeBinaryData=function(b){this.buffers.push(b);return this.buffers.length==this.reconPack.attachments?(b=k.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),b):null};v.prototype.finishedReconstruction=function(){this.reconPack=null;
this.buffers=[]}},{"./binary":56,"./is-buffer":58,"component-emitter":8,debug:10,isarray:33,json3:34}],58:[function(b,e,f){(function(b){e.exports=function(e){return b.Buffer&&b.Buffer.isBuffer(e)||b.ArrayBuffer&&e instanceof ArrayBuffer}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],59:[function(b,e,f){e.exports=function(b,e){for(var f=[],c=(e=e||0)||0;c<b.length;c++)f[c-e]=b[c];return f}},{}],60:[function(b,e,f){(function(b){(function(c){function g(b){for(var e=
[],f=0,c=b.length,g,h;f<c;)g=b.charCodeAt(f++),55296<=g&&56319>=g&&f<c?(h=b.charCodeAt(f++),56320==(h&64512)?e.push(((g&1023)<<10)+(h&1023)+65536):(e.push(g),f--)):e.push(g);return e}function h(b){if(55296<=b&&57343>=b)throw Error("Lone surrogate U+"+b.toString(16).toUpperCase()+" is not a scalar value");}function v(){if(u>=q)throw Error("Invalid byte index");var b=p[u]&255;u++;if(128==(b&192))return b&63;throw Error("Invalid continuation byte");}function n(){if(u>q)throw Error("Invalid byte index");
if(u==q)return!1;var b=p[u]&255;u++;if(0==(b&128))return b;if(192==(b&224)){var e=v();b=(b&31)<<6|e;if(128<=b)return b;throw Error("Invalid continuation byte");}if(224==(b&240)){e=v();var f=v();b=(b&15)<<12|e<<6|f;if(2048<=b)return h(b),b;throw Error("Invalid continuation byte");}if(240==(b&248)){e=v();f=v();var c=v();b=(b&15)<<18|e<<12|f<<6|c;if(65536<=b&&1114111>=b)return b}throw Error("Invalid UTF-8 detected");}var B="object"==typeof f&&f,k="object"==typeof e&&e&&e.exports==B&&e,r="object"==typeof b&&
b;if(r.global===r||r.window===r)c=r;var l=String.fromCharCode,p,q,u;r={version:"2.0.0",encode:function(b){b=g(b);for(var e=b.length,f=-1,c,m="";++f<e;){c=b[f];if(0==(c&4294967168))c=l(c);else{var t="";0==(c&4294965248)?t=l(c>>6&31|192):0==(c&4294901760)?(h(c),t=l(c>>12&15|224),t+=l(c>>6&63|128)):0==(c&4292870144)&&(t=l(c>>18&7|240),t+=l(c>>12&63|128),t+=l(c>>6&63|128));c=t+=l(c&63|128)}m+=c}return m},decode:function(b){p=g(b);q=p.length;u=0;b=[];for(var e;!1!==(e=n());)b.push(e);e=b.length;for(var f=
-1,c,h="";++f<e;)c=b[f],65535<c&&(c-=65536,h+=l(c>>>10&1023|55296),c=56320|c&1023),h+=l(c);return h}};if(B&&!B.nodeType)if(k)k.exports=r;else{c={}.hasOwnProperty;for(var y in r)c.call(r,y)&&(B[y]=r[y])}else c.utf8=r})(this)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],61:[function(b,e,f){e.exports="function"===typeof Object.create?function(b,e){b.super_=e;b.prototype=Object.create(e.prototype,{constructor:{value:b,enumerable:!1,
writable:!0,configurable:!0}})}:function(b,e){b.super_=e;var f=function(){};f.prototype=e.prototype;b.prototype=new f;b.prototype.constructor=b}},{}],62:[function(b,e,f){e.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===typeof b.fill&&"function"===typeof b.readUInt8}},{}],63:[function(b,e,f){(function(e,c){function g(b,e){var c={seen:[],stylize:v};3<=arguments.length&&(c.depth=arguments[2]);4<=arguments.length&&(c.colors=arguments[3]);y(e)?c.showHidden=
e:e&&f._extend(c,e);w(c.showHidden)&&(c.showHidden=!1);w(c.depth)&&(c.depth=2);w(c.colors)&&(c.colors=!1);w(c.customInspect)&&(c.customInspect=!0);c.colors&&(c.stylize=h);return B(c,b,c.depth)}function h(b,e){return(e=g.styles[e])?"\u001b["+g.colors[e][0]+"m"+b+"\u001b["+g.colors[e][1]+"m":b}function v(b,e){return b}function n(b){var e={};b.forEach(function(b,f){e[b]=!0});return e}function B(b,e,c){if(b.customInspect&&e&&H(e.inspect)&&e.inspect!==f.inspect&&(!e.constructor||e.constructor.prototype!==
e)){var g=e.inspect(c,b);A(g)||(g=B(b,g,c));return g}if(g=k(b,e))return g;var h=Object.keys(e),m=n(h);b.showHidden&&(h=Object.getOwnPropertyNames(e));if(z(e)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return r(e);if(0===h.length){if(H(e))return b.stylize("[Function"+(e.name?": "+e.name:"")+"]","special");if(E(e))return b.stylize(RegExp.prototype.toString.call(e),"regexp");if(C(e))return b.stylize(Date.prototype.toString.call(e),"date");if(z(e))return r(e)}g="";var t=!1,v=["{","}"];u(e)&&
(t=!0,v=["[","]"]);H(e)&&(g=" [Function"+(e.name?": "+e.name:"")+"]");E(e)&&(g=" "+RegExp.prototype.toString.call(e));C(e)&&(g=" "+Date.prototype.toUTCString.call(e));z(e)&&(g=" "+r(e));if(0===h.length&&(!t||0==e.length))return v[0]+g+v[1];if(0>c)return E(e)?b.stylize(RegExp.prototype.toString.call(e),"regexp"):b.stylize("[Object]","special");b.seen.push(e);h=t?l(b,e,c,m,h):h.map(function(f){return p(b,e,c,m,f,t)});b.seen.pop();return q(h,g,v)}function k(b,e){if(w(e))return b.stylize("undefined",
"undefined");if(A(e))return e="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",b.stylize(e,"string");if(x(e))return b.stylize(""+e,"number");if(y(e))return b.stylize(""+e,"boolean");if(null===e)return b.stylize("null","null")}function r(b){return"["+Error.prototype.toString.call(b)+"]"}function l(b,e,f,c,g){for(var h=[],m=0,t=e.length;m<t;++m)Object.prototype.hasOwnProperty.call(e,String(m))?h.push(p(b,e,f,c,String(m),!0)):h.push("");g.forEach(function(g){g.match(/^\d+$/)||
h.push(p(b,e,f,c,g,!0))});return h}function p(b,e,f,c,g,h){var m,t;e=Object.getOwnPropertyDescriptor(e,g)||{value:e[g]};e.get?t=e.set?b.stylize("[Getter/Setter]","special"):b.stylize("[Getter]","special"):e.set&&(t=b.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(c,g)||(m="["+g+"]");t||(0>b.seen.indexOf(e.value)?(t=null===f?B(b,e.value,null):B(b,e.value,f-1),-1<t.indexOf("\n")&&(t=h?t.split("\n").map(function(b){return"  "+b}).join("\n").substr(2):"\n"+t.split("\n").map(function(b){return"   "+
b}).join("\n"))):t=b.stylize("[Circular]","special"));if(w(m)){if(h&&g.match(/^\d+$/))return t;m=JSON.stringify(""+g);m.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(m=m.substr(1,m.length-2),m=b.stylize(m,"name")):(m=m.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),m=b.stylize(m,"string"))}return m+": "+t}function q(b,e,f){var c=0;return 60<b.reduce(function(b,e){c++;0<=e.indexOf("\n")&&c++;return b+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?f[0]+(""===e?"":e+"\n ")+" "+b.join(",\n  ")+
" "+f[1]:f[0]+e+" "+b.join(", ")+" "+f[1]}function u(b){return Array.isArray(b)}function y(b){return"boolean"===typeof b}function x(b){return"number"===typeof b}function A(b){return"string"===typeof b}function w(b){return void 0===b}function E(b){return D(b)&&"[object RegExp]"===Object.prototype.toString.call(b)}function D(b){return"object"===typeof b&&null!==b}function C(b){return D(b)&&"[object Date]"===Object.prototype.toString.call(b)}function z(b){return D(b)&&("[object Error]"===Object.prototype.toString.call(b)||
b instanceof Error)}function H(b){return"function"===typeof b}function G(b){return 10>b?"0"+b.toString(10):b.toString(10)}function K(){var b=new Date,e=[G(b.getHours()),G(b.getMinutes()),G(b.getSeconds())].join(":");return[b.getDate(),R[b.getMonth()],e].join(" ")}var O=/%[sdj%]/g;f.format=function(b){if(!A(b)){for(var e=[],f=0;f<arguments.length;f++)e.push(g(arguments[f]));return e.join(" ")}f=1;var c=arguments,h=c.length;e=String(b).replace(O,function(b){if("%%"===b)return"%";if(f>=h)return b;switch(b){case "%s":return String(c[f++]);
case "%d":return Number(c[f++]);case "%j":try{return JSON.stringify(c[f++])}catch(Rm){return"[Circular]"}default:return b}});for(var m=c[f];f<h;m=c[++f])e=null!==m&&D(m)?e+(" "+g(m)):e+(" "+m);return e};f.deprecate=function(b,g){if(w(c.process))return function(){return f.deprecate(b,g).apply(this,arguments)};if(!0===e.noDeprecation)return b;var h=!1;return function(){if(!h){if(e.throwDeprecation)throw Error(g);e.traceDeprecation?console.trace(g):console.error(g);h=!0}return b.apply(this,arguments)}};
var J={},P;f.debuglog=function(b){w(P)&&(P=e.env.NODE_DEBUG||"");b=b.toUpperCase();if(!J[b])if((new RegExp("\\b"+b+"\\b","i")).test(P)){var c=e.pid;J[b]=function(){var e=f.format.apply(f,arguments);console.error("%s %d: %s",b,c,e)}}else J[b]=function(){};return J[b]};f.inspect=g;g.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};g.styles={special:"cyan",number:"yellow",
"boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};f.isArray=u;f.isBoolean=y;f.isNull=function(b){return null===b};f.isNullOrUndefined=function(b){return null==b};f.isNumber=x;f.isString=A;f.isSymbol=function(b){return"symbol"===typeof b};f.isUndefined=w;f.isRegExp=E;f.isObject=D;f.isDate=C;f.isError=z;f.isFunction=H;f.isPrimitive=function(b){return null===b||"boolean"===typeof b||"number"===typeof b||"string"===typeof b||"symbol"===typeof b||"undefined"===
typeof b};f.isBuffer=b("./support/isBuffer");var R="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");f.log=function(){console.log("%s - %s",K(),f.format.apply(f,arguments))};f.inherits=b("inherits");f._extend=function(b,e){if(!e||!D(e))return b;for(var f=Object.keys(e),c=f.length;c--;)b[f[c]]=e[f[c]];return b}}).call(this,b("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":62,_process:43,inherits:61}],
64:[function(b,e,f){if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){var c="moz";var h=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)c="webkit",h=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10);b=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;f=window.mozRTCIceCandidate||window.RTCIceCandidate;var m=
window.mozRTCSessionDescription||window.RTCSessionDescription,t=window.webkitMediaStream||window.MediaStream,v="https:"===window.location.protocol&&("webkit"===c&&26<=h||"moz"===c&&33<=h),n=window.AudioContext||window.webkitAudioContext,B=document.createElement("video");B=B&&B.canPlayType&&"probably"===B.canPlayType('video/webm; codecs="vp8", vorbis');var k=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;e.exports={prefix:c,browserVersion:h,
support:!!b&&!!k,supportRTCPeerConnection:!!b,supportVp8:B,supportGetUserMedia:!!k,supportDataChannel:!!(b&&b.prototype&&b.prototype.createDataChannel),supportWebAudio:!(!n||!n.prototype.createMediaStreamSource),supportMediaStream:!(!t||!t.prototype.removeTrack),supportScreenSharing:!!v,AudioContext:n,PeerConnection:b,SessionDescription:m,IceCandidate:f,MediaStream:t,getUserMedia:k}},{}],65:[function(b,e,f){function c(){}e.exports=c;c.mixin=function(b){b=b.prototype||b;b.isWildEmitter=!0;b.on=function(b,
e,f){this.callbacks=this.callbacks||{};var c=3===arguments.length,g=c?arguments[2]:arguments[1];g._groupName=c?arguments[1]:void 0;(this.callbacks[b]=this.callbacks[b]||[]).push(g);return this};b.once=function(b,e,f){function c(){g.off(b,c);m.apply(this,arguments)}var g=this,h=3===arguments.length,m=h?arguments[2]:arguments[1];this.on(b,h?arguments[1]:void 0,c);return this};b.releaseGroup=function(b){this.callbacks=this.callbacks||{};var e,f;for(e in this.callbacks){var c=this.callbacks[e];var g=
0;for(f=c.length;g<f;g++)c[g]._groupName===b&&(c.splice(g,1),g--,f--)}return this};b.off=function(b,e){this.callbacks=this.callbacks||{};var f=this.callbacks[b];if(!f)return this;if(1===arguments.length)return delete this.callbacks[b],this;var c=f.indexOf(e);f.splice(c,1);0===f.length&&delete this.callbacks[b];return this};b.emit=function(b){this.callbacks=this.callbacks||{};var e=[].slice.call(arguments,1),f=this.callbacks[b],c=this.getWildcardCallbacks(b),g;if(f){var h=f.slice();f=0;for(g=h.length;f<
g&&h[f];++f)h[f].apply(this,e)}if(c)for(h=c.slice(),f=0,g=h.length;f<g&&h[f];++f)h[f].apply(this,[b].concat(e));return this};b.getWildcardCallbacks=function(b){this.callbacks=this.callbacks||{};var e,f=[];for(e in this.callbacks){var c=e.split("*");if("*"===e||2===c.length&&b.slice(0,c[0].length)===c[0])f=f.concat(this.callbacks[e])}return f}};c.mixin(c)},{}],66:[function(b,e,f){function c(b,e,f){return e?new h(b,e):new h(b)}b=window;var h=b.WebSocket||b.MozWebSocket;e.exports=h?c:null;h&&(c.prototype=
h.prototype)},{}],67:[function(b,e,f){function c(b){var e=!0;b.getTracks().forEach(function(b){e="ended"===b.readyState&&e});return e}function h(b){var e=this;v.call(this);this.id=b.id;this.parent=b.parent;this.type=b.type||"video";this.oneway=b.oneway||!1;this.sharemyscreen=b.sharemyscreen||!1;this.browserPrefix=b.prefix;this.stream=b.stream;this.enableDataChannels=void 0===b.enableDataChannels?this.parent.config.enableDataChannels:b.enableDataChannels;this.receiveMedia=b.receiveMedia||this.parent.config.receiveMedia;
this.channels={};this.sid=b.sid||Date.now().toString();this.pc=new t(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints);this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("endOfCandidates",function(b){e.send("endOfCandidates",b)});this.pc.on("offer",function(b){e.parent.config.nick&&(b.nick=e.parent.config.nick);e.send("offer",b)});this.pc.on("answer",function(b){e.parent.config.nick&&(b.nick=e.parent.config.nick);e.send("answer",b)});this.pc.on("addStream",
this.handleRemoteStreamAdded.bind(this));this.pc.on("addChannel",this.handleDataChannelAdded.bind(this));this.pc.on("removeStream",this.handleStreamRemoved.bind(this));this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded"));this.pc.on("iceConnectionStateChange",this.emit.bind(this,"iceConnectionStateChange"));this.pc.on("iceConnectionStateChange",function(){switch(e.pc.iceConnectionState){case "failed":"offer"===e.pc.pc.localDescription.type&&(e.parent.emit("iceFailed",e),e.send("connectivityError"))}});
this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange"));this.logger=this.parent.logger;"screen"===b.type?this.parent.localScreens&&this.parent.localScreens[0]&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),this.pc.addStream(this.parent.localScreens[0]),this.broadcaster=b.broadcaster):this.parent.localStreams.forEach(function(b){e.pc.addStream(b)});this.on("channelOpen",function(b){"https://simplewebrtc.com/protocol/filetransfer#inband-v1"===
b.protocol&&(b.onmessage=function(f){f=JSON.parse(f.data);var c=new n.Receiver;c.receive(f,b);e.emit("fileTransfer",f,c);c.on("receivedFile",function(b,e){c.channel.close()})})});this.on("*",function(){e.parent.emit.apply(e.parent,arguments)})}f=b("util");var m=b("webrtcsupport"),t=b("rtcpeerconnection"),v=b("wildemitter"),n=b("filetransfer");f.inherits(h,v);h.prototype.handleMessage=function(b){var e=this;this.logger.log("getting",b.type,b);b.prefix&&(this.browserPrefix=b.prefix);"offer"===b.type?
(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleOffer(b.payload,function(b){b||e.pc.answer(function(b,e){})})):"answer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleAnswer(b.payload)):"candidate"===b.type?this.pc.processIce(b.payload):"connectivityError"===b.type?this.parent.emit("connectivityError",e):"mute"===b.type?this.parent.emit("mute",{id:b.from,name:b.payload.name}):"unmute"===b.type&&this.parent.emit("unmute",{id:b.from,name:b.payload.name})};
h.prototype.send=function(b,e){e={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:b,payload:e,prefix:m.prefix};this.logger.log("sending",b,e);this.parent.emit("message",e)};h.prototype.sendDirectly=function(b,e,f){f={type:e,payload:f};this.logger.log("sending via datachannel",b,e,f);b=this.getDataChannel(b);if("open"!=b.readyState)return!1;b.send(JSON.stringify(f));return!0};h.prototype._observeDataChannel=function(b){var e=this;b.onclose=this.emit.bind(this,"channelClose",
b);b.onerror=this.emit.bind(this,"channelError",b);b.onmessage=function(f){e.emit("channelMessage",e,b.label,JSON.parse(f.data),b,f)};b.onopen=this.emit.bind(this,"channelOpen",b)};h.prototype.getDataChannel=function(b,e){if(!m.supportDataChannel)return this.emit("error",Error("createDataChannel not supported"));var f=this.channels[b];e||(e={});if(f)return f;f=this.channels[b]=this.pc.createDataChannel(b,e);this._observeDataChannel(f);return f};h.prototype.onIceCandidate=function(b){if(!this.closed)if(b){var e=
this.parent.config.peerConnectionConfig;"moz"===m.prefix&&e&&e.iceTransports&&b.candidate&&b.candidate.candidate&&0>b.candidate.candidate.indexOf(e.iceTransports)?this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",e.iceTransports):this.send("candidate",b)}else this.logger.log("End of candidates.")};h.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc");this.pc.offer(this.receiveMedia,function(b,e){})};h.prototype.icerestart=function(){var b=
this.receiveMedia;b.mandatory.IceRestart=!0;this.pc.offer(b,function(b,e){})};h.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())};h.prototype.handleRemoteStreamAdded=function(b){var e=this;this.stream?this.logger.warn("Already have a remote stream"):(this.stream=b.stream,this.stream.getTracks().forEach(function(b){b.addEventListener("ended",function(){c(e.stream)&&e.end()})}),this.parent.emit("peerStreamAdded",this))};h.prototype.handleStreamRemoved=function(){var b=
this.parent.peers.indexOf(this);-1<b&&(this.parent.peers.splice(b,1),this.closed=!0,this.parent.emit("peerStreamRemoved",this))};h.prototype.handleDataChannelAdded=function(b){this.channels[b.label]=b;this._observeDataChannel(b)};h.prototype.sendFile=function(b){var e=new n.Sender,f=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:"https://simplewebrtc.com/protocol/filetransfer#inband-v1"});f.onopen=function(){f.send(JSON.stringify({size:b.size,name:b.name}));e.send(b,f)};f.onclose=
function(){console.log("sender received transfer");e.emit("complete")};return e};e.exports=h},{filetransfer:26,rtcpeerconnection:44,util:63,webrtcsupport:64,wildemitter:65}],68:[function(b,e,f){function c(b){var e=this,f=b||{},c=this.config={url:"https://sandbox.simplewebrtc.com:443/",socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,
offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}},g;var B=b.debug?b.logger||console:b.logger||n;this.logger=B;for(g in f)f.hasOwnProperty(g)&&(this.config[g]=f[g]);this.capabilities=t;m.call(this);var l=null===this.config.connection?this.connection=new k(this.config):this.connection=this.config.connection;l.on("connect",function(){e.emit("connectionReady",l.getSessionid());e.sessionReady=!0;e.testReadiness()});l.on("message",function(b){var f=e.webrtc.getPeers(b.from,b.roomType);
if("offer"===b.type){f.length&&f.forEach(function(e){e.sid==b.sid&&(c=e)});if(!c){var c=e.webrtc.createPeer({id:b.from,sid:b.sid,type:b.roomType,enableDataChannels:e.config.enableDataChannels&&"screen"!==b.roomType,sharemyscreen:"screen"===b.roomType&&!b.broadcaster,broadcaster:"screen"!==b.roomType||b.broadcaster?null:e.connection.getSessionid()});e.emit("createdPeer",c)}c.handleMessage(b)}else f.length&&f.forEach(function(e){b.sid?e.sid===b.sid&&e.handleMessage(b):e.handleMessage(b)})});l.on("remove",
function(b){b.id!==e.connection.getSessionid()&&e.webrtc.removePeers(b.id,b.type)});b.logger=this.logger;b.debug=!1;this.webrtc=new h(b);"mute unmute pauseVideo resumeVideo pause resume sendToAll sendDirectlyToAll getPeers".split(" ").forEach(function(b){e[b]=e.webrtc[b].bind(e.webrtc)});this.webrtc.on("*",function(){e.emit.apply(e,arguments)});if(c.debug)this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:"));this.webrtc.on("localStream",function(){e.testReadiness()});this.webrtc.on("message",
function(b){e.connection.emit("message",b)});this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this));this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this));this.config.adjustPeerVolume&&(this.webrtc.on("speaking",this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1)));l.on("stunservers",function(b){e.webrtc.config.peerConnectionConfig.iceServers=b;e.emit("stunservers",b)});l.on("turnservers",
function(b){e.webrtc.config.peerConnectionConfig.iceServers=e.webrtc.config.peerConnectionConfig.iceServers.concat(b);e.emit("turnservers",b)});this.webrtc.on("iceFailed",function(b){});this.webrtc.on("connectivityError",function(b){});this.webrtc.on("audioOn",function(){e.webrtc.sendToAll("unmute",{name:"audio"})});this.webrtc.on("audioOff",function(){e.webrtc.sendToAll("mute",{name:"audio"})});this.webrtc.on("videoOn",function(){e.webrtc.sendToAll("unmute",{name:"video"})});this.webrtc.on("videoOff",
function(){e.webrtc.sendToAll("mute",{name:"video"})});this.webrtc.on("localScreen",function(b){var f=document.createElement("video"),c=e.getRemoteVideoContainer();f.oncontextmenu=function(){return!1};f.id="localScreen";v(b,f);c&&c.appendChild(f);e.emit("localScreenAdded",f);e.connection.emit("shareScreen");e.webrtc.peers.forEach(function(b){"video"===b.type&&(b=e.webrtc.createPeer({id:b.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},
broadcaster:e.connection.getSessionid()}),e.emit("createdPeer",b),b.start())})});this.webrtc.on("localScreenStopped",function(b){e.getLocalScreen()&&e.stopScreenShare()});this.webrtc.on("channelMessage",function(b,f,c){"volume"==c.type&&e.emit("remoteVolumeChange",b,c.volume)});this.config.autoRequestMedia&&this.startLocalVideo()}var h=b("./webrtc"),m=b("wildemitter"),t=b("webrtcsupport"),v=b("attachmediastream"),n=b("mockconsole"),k=b("./socketioconnection");c.prototype=Object.create(m.prototype,
{constructor:{value:c}});c.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare();this.emit("leftRoom",this.roomName);this.roomName=void 0}};c.prototype.disconnect=function(){this.connection.disconnect();delete this.connection};c.prototype.handlePeerStreamAdded=function(b){var e=this,f=this.getRemoteVideoContainer(),c=v(b.stream);b.videoEl=c;c.id=this.getDomId(b);f&&f.appendChild(c);
this.emit("videoAdded",c,b);window.setTimeout(function(){e.webrtc.isAudioEnabled()||b.send("mute",{name:"audio"});e.webrtc.isVideoEnabled()||b.send("mute",{name:"video"})},250)};c.prototype.handlePeerStreamRemoved=function(b){var e=this.getRemoteVideoContainer(),f=b.videoEl;this.config.autoRemoveVideos&&e&&f&&e.removeChild(f);f&&this.emit("videoRemoved",f,b)};c.prototype.getDomId=function(b){return[b.id,b.type,b.broadcaster?"broadcasting":"incoming"].join("_")};c.prototype.setVolumeForAll=function(b){this.webrtc.peers.forEach(function(e){e.videoEl&&
(e.videoEl.volume=b)})};c.prototype.joinRoom=function(b,e){var f=this;this.roomName=b;this.connection.emit("join",b,function(c,g){console.log("join CB",c);O(g);if(c)f.emit("error",c);else{if(!g.xtra){nb();Lb();Td(x.errorLoading,"#ff0000");return}w.room=g.xtra;var h,m;for(h in g.clients){var t=g.clients[h];for(m in t)if(t[m]){var n=f.webrtc.createPeer({id:h,type:m,enableDataChannels:f.config.enableDataChannels&&"screen"!==m,receiveMedia:{offerToReceiveAudio:"screen"!==m&&f.config.receiveMedia.offerToReceiveAudio?
1:0,offerToReceiveVideo:f.config.receiveMedia.offerToReceiveVideo}});f.emit("createdPeer",n);n.start()}}}e&&e(c,g);f.emit("joinedRoom",b)})};c.prototype.getEl=function(b){return"string"===typeof b?document.getElementById(b):b};c.prototype.startLocalVideo=function(){var b=this;this.webrtc.start(this.config.media,function(e,f){e?b.emit("localMediaError",e):v(f,b.getLocalVideoContainer(),b.config.localVideo)})};c.prototype.stopLocalVideo=function(){this.webrtc.stop()};c.prototype.getLocalVideoContainer=
function(){var b=this.getEl(this.config.localVideoEl);if(b&&"VIDEO"===b.tagName)return b.oncontextmenu=function(){return!1},b;if(b){var e=document.createElement("video");e.oncontextmenu=function(){return!1};b.appendChild(e);return e}};c.prototype.getRemoteVideoContainer=function(){return this.getEl(this.config.remoteVideosEl)};c.prototype.shareScreen=function(b){this.webrtc.startScreenShare(b)};c.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]};c.prototype.stopScreenShare=
function(){this.connection.emit("unshareScreen");var b=document.getElementById("localScreen"),e=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&e&&b&&e.removeChild(b);b&&this.emit("videoRemoved",b);this.getLocalScreen()&&this.webrtc.stopScreenShare();this.webrtc.peers.forEach(function(b){b.broadcaster&&b.end()})};c.prototype.testReadiness=function(){this.sessionReady&&(this.config.media.video||this.config.media.audio?0<this.webrtc.localStreams.length&&this.emit("readyToCall",this.connection.getSessionid()):
this.emit("readyToCall",this.connection.getSessionid()))};c.prototype.createRoom=function(b,e){this.roomName=b;this.connection.emit("create",w.room,e)};c.prototype.sendFile=function(){if(!t.dataChannel)return this.emit("error",Error("DataChannelNotSupported"))};e.exports=c},{"./socketioconnection":69,"./webrtc":70,attachmediastream:3,mockconsole:37,webrtcsupport:64,wildemitter:65}],69:[function(b,e,f){function c(b){this.connection=h.connect(b.url,b.socketio)}var h=b("socket.io-client");c.prototype.on=
function(b,e){this.connection.on(b,e)};c.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};c.prototype.getSessionid=function(){return this.connection.id};c.prototype.disconnect=function(){return this.connection.disconnect()};e.exports=c},{"socket.io-client":50}],70:[function(b,e,f){function c(b){var e=this,f=b||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,
offerToReceiveVideo:1},enableDataChannels:!0};var c;b=b.debug?b.logger||console:b.logger||m;this.logger=b;for(c in f)f.hasOwnProperty(c)&&(this.config[c]=f[c]);h.support||this.logger.error("Your browser doesn't seem to support WebRTC");this.peers=[];t.call(this,this.config);this.on("speaking",function(){e.hardMuted||e.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"speaking"})))})});this.on("stoppedSpeaking",function(){e.hardMuted||
e.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"stoppedSpeaking"})))})});this.on("volumeChange",function(b,f){e.hardMuted||e.peers.forEach(function(e){e.enableDataChannels&&(e=e.getDataChannel("hark"),"open"==e.readyState&&e.send(JSON.stringify({type:"volume",volume:b})))})});if(this.config.debug)this.on("*",function(b,f,c){(e.config.logger===m?console:e.logger).log("event:",b,f,c)})}f=b("util");var h=b("webrtcsupport"),
m=b("mockconsole"),t=b("localmedia"),v=b("./peer");f.inherits(c,t);c.prototype.createPeer=function(b){b.parent=this;b=new v(b);this.peers.push(b);return b};c.prototype.removePeers=function(b,e){this.getPeers(b,e).forEach(function(b){b.end()})};c.prototype.getPeers=function(b,e){return this.peers.filter(function(f){return(!b||f.id===b)&&(!e||f.type===e)})};c.prototype.sendToAll=function(b,e){this.peers.forEach(function(f){f.send(b,e)})};c.prototype.sendDirectlyToAll=function(b,e,f){this.peers.forEach(function(c){c.enableDataChannels&&
c.sendDirectly(b,e,f)})};e.exports=c},{"./peer":67,localmedia:35,mockconsole:37,util:63,webrtcsupport:64}]},{},[68])(68)})},E,Ea,x={},w={name:localStorage.name,color:localStorage.color||"#ff0000"},Fc=function(){};console.log("%c nehhon %c POWER ","background: #00ffd4; color: #000; font-size:20px","background: #000; color: #00ffd4; font-size:20px");console.log("%c Author: Ruben ","background: #000; color: #00ffd4; font-size:20px");console.log("%c webmaster@nehhon.com ","background: #00ffd4; color: #000; font-size:20px");
console.log("%c @nehhon ","background: #000; color: #00ffd4; font-size:20px");var q=function(d){return document.getElementById(d)},Mb=function(d,b,e){void 0===localStorage[d]&&(localStorage[d]=b);e&&(q(e).value=localStorage[d])};void 0===localStorage.fullscreen&&(localStorage.fullscreen=!0);Mb("musicRange",80,"musicRange");Mb("soundRange",45,"soundRange");Mb("gold",400);Mb("food",400);Mb("stone",400);Mb("wood",400);Mb("infinity","true");Mb("mapSize",256);Mb("terrain","grass");Mb("water","0");console.log=
Fc;console.error=Fc;console.warn=Fc;console.info=Fc;"tza.red"!==location.hostname&&(location.href="https://tza.red");window.onbeforeunload=function(){return"Are you sure you want to quit?"};var pl=function(d){d.parentNode.removeChild(d)},Td=function(d,b){var e=document.getElementById("notifybar"),f=document.createElement("div");f.innerHTML=d;b&&(f.style.background=b);e.appendChild(f);setTimeout(pl,11E3,f)},ql=location;(function(){var d=!!window.opr||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),
b="undefined"!==typeof InstallTrigger,e=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),f=!!document.documentMode,c=!f&&!!window.StyleMedia,h=!!window.chrome&&!!window.chrome.webstore,m;d?m="Opera":b?m="Firefox":e?m="Safari":f?m="IE":c?m="Edge":h&&(m="Chrome");w.navLang=navigator.language||navigator.userLanguage;d=w.navLang.substr(0,2);b={es:["Tzared","Juego de estrategia en tiempo real para navegadores web, juega solo o con amigos","tzared,jugar,multijugador,juego,online,navegador web,tzar"],
it:["Tzared","Gioco di strategia in tempo reale per browser web, giocare da soli o con gli amici","tzared,giocare,multigiocatore,gioco,online,navigatore,tzar,web"],pl:["Tzared","Gra strategiczna w czasie rzeczywistym dla przegl\u0105darek internetowych, bawi\u0107 si\u0119 samotnie lub z przyjaci\u00f3\u0142mi","tzared,gra,multiplayer,online,tzar,przegl\u0105darka internetowa"],ru:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u043b\u044f \u0432\u0435\u0431-\u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u0432, \u0438\u0433\u0440\u0430\u0442\u044c \u0432 \u043e\u0434\u0438\u043d\u043e\u0447\u043a\u0443 \u0438\u043b\u0438 \u0441 \u0434\u0440\u0443\u0437\u044c\u044f\u043c\u0438",
"\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u044c\u0442\u0438\u043f\u043b\u0435\u0435\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u0435\u0440,\u043e\u0433\u043d\u0451\u043c \u0438 \u043c\u0435\u0447\u043e\u043c"],pt:["Tzared","Jogo de estrat\u00e9gia em tempo real para navegadores da web, jogar sozinho ou com amigos","tzared,jogar,multiplayer,jogo,online,navegador web,tzar"],bg:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0447\u0435\u0441\u043a\u0430 \u0438\u0433\u0440\u0430 \u0432 \u0440\u0435\u0430\u043b\u043d\u043e \u0432\u0440\u0435\u043c\u0435 \u0437\u0430 \u0443\u0435\u0431 \u0431\u0440\u0430\u0443\u0437\u044a\u0440\u0438, \u0438\u0433\u0440\u0430\u0439\u0442\u0435 \u0441\u0430\u043c\u0438 \u0438\u043b\u0438 \u0441 \u043f\u0440\u0438\u044f\u0442\u0435\u043b\u0438",
"\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u0442\u0438\u043f\u043b\u0435\u0439\u044a\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u044a\u0440"],de:["Tzared","Echtzeit-Strategiespiel f\u00fcr Webbrowser, alleine oder mit Freunden spielen","tzared,multiplayer,spiel,online,Webbrowser,tzar"],en:["Tzared","Real-time strategy game for web browsers, play alone or with friends","tzared,play,multiplayer,game,online,browser,tzar,web"]};b[d]||(d=
"en");document.getElementsByTagName("html")[0].lang=d;b=b[location.search.split("lang=")[1]||"en"];document.getElementsByTagName("title")[0].innerHTML=b[0];document.getElementsByTagName("meta").description=b[1];document.getElementsByTagName("meta").keywords=b[2];w.version="v31.4";w.versionDate=Date.now()-1531411007341;localStorage.version!==w.version&&(localStorage.version=w.version,Td("Updated to "+w.version));q("info").innerHTML="Work in progress - Beta "+w.version+" - Updated "+~~(w.versionDate/
864E5)+" days ago";w.lang="en es it pt ru pl bg de".split(" ").indexOf(d);0>w.lang&&(w.lang=0);w.langstr=d;w.race=0;w.navigator=m;w.mx=151;w.onlineID=null;w.temperature=0;w.cdn="/nehhon/"})();x={open:"Open",loading:"Loading...",systemAlert:"System Message",notEnough:"Not enough %s",ok:"OK",yes:"Yes",no:"No",secure:"Are you sure?",gold:"Gold",stone:"Stone",wood:"Wood",food:"Food",mana:"Manna",warning:"Warning",play:"PLAY",grass:"Grass",snow:"Snow",close:"CLOSE",gameClosed:"The game was canceled by the server.",
loadgraphics:"Downloading graphics...",waitImages:"Downloading graphics",wait:"Wait",audioproblem:"Your browser is not compatible with Web Audio",defeated:"DEFEATED",victorious:"VICTORIOUS",options:"OPTIONS",refresh:"Refresh",back:"BACK",paused:"PAUSED",chatMsg:"CHAT MESSAGE",disconnect:"Disconnect",playerDisconnected:"%s has disconnected!",connectionError:"Connection error",noP2P:"Engine not loaded",startingResources:"Starting Resources",mapSize:"Map Size",menu:"MENU",quit:"QUIT",downloadAll:"Download all",
continue:"Continue",backToGame:"BACK TO GAME",initializing:"Initializing...",requires:"Requires",stop:"Stop",pickItems:"Pick items",move:"Move",stand:"Stand ground",explore:"Explore",patrol:"Patrol",guard:"Guard",errorLoading:"Error loading game.",waitingPlayers:"Waiting for players to connect",musicVolume:"Music Volume",soundVolume:"Sound Volume",common:"Common",popLimit:"Population limit reached",houseLimit:"Not enough houses",lightning:"Lightning",freeze:"Freeze",bless:"Bless",heal:"Heal",invisibility:"Invisibility",
dcm:"Dig, chop or mine",repair:"Repair building",menuBuild:"See what you can build",units:"Units",infinite:"Infinite",gameFull:"Sorry, the game is full.",terrainOption:"Terrain",playerDefeated:"%s has been defeated!",savegame:"SAVE GAME",loadRecord:"Recording",stats:"Stats",builds:"Builds",items:"Items",nature:"Nature",trees:"Trees",delete:"Delete",create:"Create",username:"Player Name",gameOptions:"GAME OPTIONS",nplayers:"Number of Players",gameName:"Enter Game Name",gamesFound:"Games Found",strSearch:"SEARCH| Search for existing games",
strCreate:"CREATE| Create a game",randomMap:"RANDOM MAP",strcusMap:"CUSTOM MAP",strSettings:"SETTINGS",mapMaking:"Map Making",terrain:"Terrain",save:"SAVE",accept:"ACCEPT",team:"Team",color:"Colour",offlinePlay:"For playing offline",AI:"AI Assist",kingdom:"Kingdom",attack:"Attack",defence:"Defence",health:"Health",maxHealth:"Max health",playing:"Playing",waiting:"Waiting",joining:"Joining...",random:"Random",cancel:"CANCEL",rules:"Rules",events:"Events",actions:"Actions",objAction:"Object action",
destroyObj:"Destroy object",defined:"Defined",undefined:"Undefined",destroy:"Destroy",capture:"Capture",moving:"Moving",add:"Add",objOrder:"Order",objZone:"Object in zone",zone:"Zone",editMap:"Edit",mapName:"Map name",water:"Water",description:"Map Description",author:"Author",fullscreen:"Automatic full screen",versionError:"Incorrect game version."};var Mi=Fc,Oi=function(d){d--;var b=new XMLHttpRequest;b.open("GET","/nehhon/"+w.langstr+".json",!0);b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");
b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var d=JSON.parse(b.response);Mi=function(){for(var b=u,e=0;e<b.length;e++){var f=b[e].name;d[f]&&(b[e].name=d[f])}for(e=0;e<C.length;e++)b=C[e],d[b.name[0]]&&d[b.name[1]]&&(b.name[0]=d[b.name[0]],b.name[1]=d[b.name[1]]);d=null};for(var f=[],g=0;0>g;g++)"undefined"!=typeof c[g]&&null!=c[g].tech&&(f.push(c[g].tech.name),Object.freeze(c[g].tech));for(g=0;g<f.length;g++)f[g][0]=d[f[g][0]],f[g][1]=d[f[g][1]];f=Object.keys(x);for(g=0;g<
f.length;g++){var h=f[g];void 0!=d[x[h]]&&(x[h]=d[x[h]])}Object.freeze(x);for(g=0;g<$a.length;g++)$a[g]=d[$a[g]];for(g=0;g<0*Og.length;g++)Og[g]=d[Og[g]];Object.freeze($a);Ni()}};b.send()},Ni=function(){for(var d=["refreshButton",x.refresh,"optionsButton",x.options,"startButton",x.play,"backButton",x.back,"closeButton",x.close,"quitButton",x.quit,"continueButton",x.continue],b=0,e=d.length;b<e;b+=2)for(var f=document.getElementsByClassName(d[b]),c=0,h=f.length;c<h;c++)f[c].innerHTML=d[b+1];d=["alertok",
x.ok,"sendMessageH2",x.chatMsg,"backToGame",x.backToGame,"backToGameS",x.backToGame,"musicVolume",x.musicVolume,"soundVolume",x.soundVolume,"menueditor",x.menu,"saveGame",x.savegame,"playrecord",x.loadRecord,"seeStats",x.stats,"gameMenu",x.menu,"selectBuilds",x.builds,"selectUnits",x.units,"selectItems",x.items,"selectNature",x.nature,"gamesFound",x.gamesFound,"strSearch",x.strSearch.split("| ")[1],"strCreate",x.strCreate.split("| ")[1],"strRandomMap",x.randomMap,"strcusMap",x.strcusMap,"strMapEditor",
x.mapMaking,"h2cusmap",x.strcusMap,"h2rndMap",x.randomMap,"mapProps",x.options,"mapRules",x.rules,"editCustom",x.editMap,"strSettings",x.strSettings];b=0;for(e=d.length;b<e;b+=2)document.getElementById(d[b]).innerHTML=d[b+1]};0<w.lang?(Oi(w.lang),Oi.translated=!0):Ni();var O=console.log,rl=document.getElementById("alerttitle"),sl=document.getElementById("alerttext"),tl=document.getElementById("alert"),Xc=function(d,b,e){tl.style.display="block";rl.innerHTML=b||x.warning;sl.innerHTML=d;e?document.getElementById("alertok").style.display=
"none":document.getElementById("alertok").style.display="block";q("basic").style.filter="blur(94px)"},ul=[1E3,0,2E3,0],wi,Qi=function(d,b,e){var f=new XMLHttpRequest;f.open("GET",d,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");f.onload=function(){b.length?N[b]=Pi(f.response):N.xtra[b]=Pi(f.response);N.load++;bc&&N.load===N.images&&bc()};e&&(f.onprogress=function(b){e(b)});f.send("")},Pi=function(d){performance.now();d=new Uint16Array(d);
var b=d.length,e=d[b-4]+65536*d[b-3],f=d[b-2]+65536*d[b-1];b-=2;var c=-1;f=new Uint8Array(4*f);for(var h=0;e<b;e++){var m=d[e];if(65533<m){65535==m?(m=d[e+1],e+=1):(m=d[e+1]+65536*d[e+2],e+=2);for(var t=0;t<m;t++)f[h++]=c&255,f[h++]=c>>8&255,f[h++]=c>>16&255,f[h++]=c>>24&255}else m=d[2*m]+65536*d[2*m+1],f[h++]=m&255,f[h++]=m>>8&255,f[h++]=m>>16&255,f[h++]=m>>24&255,c=m}return f},Gc=function(){var d=["icons.png","images.json","graphics.nh17","terrainDataGrass.json","grass.nh17"];d=d.concat(Pg);var b=
d.length;Gc.max=b;for(var e=0;e<b;e++)vl(w.cdn+d[e]);this.innerHTML="0%";this.disabled=!0;Gc.button=this};Gc.loaded=0;var vl=function(d){var b=new XMLHttpRequest;b.open("GET",d,!0);b.responseType="arraybuffer";b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onload=function(){Gc.loaded++;Gc.button.innerHTML=~~(100*Gc.loaded/Gc.max+.5)+"%"};b.send("")},N={size:512,load:0,xtra:[]},bc;N.xtraRes=[];var X={page:0,length:8,leftButton:document.getElementById("aleft"),
rightButton:document.getElementById("aright"),stock:document.getElementById("stock")},l;(function(){var d=0,b=0,e=function(e){e.target.loadedSize||(b+=e.total,e.target.lastLoaded=0,e.target.loadedSize=!0);d+=e.loaded-e.target.lastLoaded;e.target.lastLoaded=e.loaded;q("loadingtext").innerHTML=x.loadgraphics+~~(100*d/b)+"%"},f=function(b){var d=!!b.icons;N.images=Object.keys(b).length;if(d){var f=new XMLHttpRequest;f.open("GET",b.icons,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type",
" text / plain; charset = dropbox - cors - hack");f.onreadystatechange=function(){if(4===f.readyState&&200===f.status){var b=new Uint8Array(f.response);b=new Blob([b],{type:"image/png"});var d=new Image;d.src=URL.createObjectURL(b);N.load++;X.icons=d;bc&&N.load===N.images&&bc();Date.now()}};f.onprogress=function(b){e(b)};f.send("")}Date.now();var c=new XMLHttpRequest;c.open("GET",b.imageJSON,!0);d&&c.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");c.onreadystatechange=
function(){4==this.readyState&&200==this.status&&(N.load++,bc&&N.load===N.images&&bc(),l=JSON.parse(c.response))};c.onprogress=function(b){e(b)};c.send(!0);Qi(b.common,"common",e)};(function(){var b=!1;"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/sworker.js").then(function(b){console.log("CLIENT: service worker registration complete.")},function(b){O(b);console.log("CLIENT: service worker registration failure.")}),
navigator.serviceWorker.oncontrollerchange=function(){console.log("page controlled by:",navigator.serviceWorker.controller);location.reload(!0)}):console.log("CLIENT: service worker is not supported.");wi=function(){N.started=!0;if(!b){b=!0;var d=w.cdn;f({icons:d+"icons.png",imageJSON:d+"images.json",common:d+"graphics.nh17"})}}})()})();var Qd={grass:{json:"terrainDataGrass.json",main:"grass.nh17"},snow:{json:"terrainDataSnow.json",main:"snow.nh17"},last:""},Xe,hl=function(){var d=w.cdn;N.images+=
2;q("terrainSelect")&&(localStorage.terrain=q("terrainSelect").value);var b=Qd[p.terrainType||localStorage.terrain];Qd.last=p.terrainType||localStorage.terrain;p.terrainType=Qd.last;localStorage.terrain=p.terrainType;w.terrainType=Qd.last;var e=new XMLHttpRequest;e.open("GET",d+b.json,!0);e.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){N.xtraRes[0]=JSON.parse(e.response);mc=N.xtraRes[0];var b=
mc.specialColor;Xe=new Float32Array(Za(b[0]/255,b[1]/255,b[2]/255,.9));N.load++;b="rgb("+b[0]+","+b[1]+","+b[2]+")";q("msgs1").style.color=b;q("playersinfo").style.color=b;q("topinfo").style.color=b;bc&&N.load===N.images&&bc()}};e.send(!0);Qi(d+b.main,0,!1)},pc,wd,Ye,Hc,Ze,Qg,Ud,Ri,Vd,Si,Ti,J,$e,Wd,Ga,Rg,ab,qa,af={},Pg="ts1.mp3 ts2.mp3 ts3.mp3 ts4.mp3 ts5.mp3 ts6.mp3 ts7.mp3 ts8.mp3 ts9.mp3 ts10.mp3 sr1.mp3 sr2.mp3 sr3.mp3 sr4.mp3 sr5.mp3 sr6.mp3 sr7.mp3 sr8.mp3 sr9.mp3 sr10.mp3 1.mp3 2.mp3 3.mp3 4.mp3 5.mp3 6.mp3 7.mp3 8.mp3 9.mp3 10.mp3 INTRO.mp3 OUTRO.mp3 WIN1.mp3 WIN2.mp3 ATTACK.WAV BALLISTA.WAV BLDGDONE.WAV CHAT%20LOCATION.WAV TECHDONE.WAV UNITDONE.WAV CHAT.WAV E_CASTLE1.WAV E_CATHEDRAL1.WAV E_CATHEDRAL2.WAV E_FARM1.WAV E_CHURCH1.WAV E_FARM2.WAV E_HARBOR1.WAV E_LUMBER1.WAV E_MAGETOWER1.WAV E_MAGETOWER2.WAV E_MAGETOWER3.WAV E_MARKET1.WAV E_SHIPYARD1.WAV E_STABLES1.WAV E_STORAGE1.WAV E_OUTPOST1.WAV E_STORAGE2.WAV E_TAVERN1.WAV E_WARACADEMY1.WAV E_WORKSHOP1.WAV EVILCASTLE.WAV GATE1.WAV GATE2.WAV GATE3.WAV GATE4.WAV GATE5.WAV GATE6.WAV GATEWAY.WAV HOUSE1.WAV HOUSE2.WAV HOUSE3.WAV HOUSE4.WAV HOUSE5.WAV MERCHANT.WAV MINE1.WAV MONASTERY1.WAV MONASTERY2.WAV R_CATHEDRAL1.WAV R_CHURCH1.WAV SHAOLIN2.WAV SHAOLIN.WAV CHOP%201.WAV CHOP%202.WAV CHOP%203.WAV CHOP%204.WAV CHOP%205.WAV CHOP%206.WAV CHOP%207.WAV CHOP%208.WAV CHOP%209.WAV CHOP%2010.WAV CHOP%2011.WAV DIG%201.WAV DIG%202.WAV DIG%203.WAV MINE%201.WAV MINE%202.WAV MINE%203.WAV HIT%201.WAV HIT%202.WAV HIT%203.WAV HIT%204.WAV HIT%205.WAV HIT%206.WAV HIT%207.WAV GHOST1.WAV GHOST2.WAV GOLEM1.WAV GOLEM2.WAV H%20SWORD%201.WAV H%20SWORD%202.WAV H%20SWORD%203.WAV H%20SWORD%204.WAV H%20SWORD%205.WAV H%20SWORD%206.WAV H%20SWORD%207.WAV H%20SWORD%207.WAV H%20SWORD%208.WAV H%20SWORD%209.WAV H%20SWORD%2010.WAV H%20SWORD%2011.WAV H%20SWORD%2012.WAV HAND1.WAV HAND2.WAV HAND3.WAV HAND4.WAV MAGE%20ATTACK.WAV MESSIAH.WAV ORC%20SWORD%201.WAV ORC%20SWORD%202.WAV ORC%20SWORD%203.WAV ORC%20SWORD%204.WAV ORC%20SWORD%205.WAV ORC%20SWORD%206.WAV ORC%20SWORD%20V1.WAV ORC%20SWORD%20V2.WAV ORC%20SWORD%20V3.WAV SHIP%20CANNON%201.WAV SHIP%20CANNON%202.WAV SHIP%20CANNON%203.WAV SHIP%20CANNON%204.WAV SHIP%20CANNON%205.WAV SHIP%20CANNON%206.WAV SHIP%20CANNON%207.WAV SIEGE.WAV SWORD%201.WAV SWORD%202.WAV SWORD%203.WAV SWORD%204.WAV SWORD%205.WAV SWORD%206.WAV SWORD%207.WAV SWORD%208.WAV SWORD%209.WAV SWORD%2010.WAV SWORD%2011.WAV SWORD%2012.WAV SWORD%2013.WAV SWORD%2014.WAV SWORD%2015.WAV SWORD%2016.WAV V%20SWORD%201.WAV V%20SWORD%202.WAV V%20SWORD%203.WAV V%20SWORD%204.WAV V%20SWORD%205.WAV V%20SWORD%206.WAV V%20SWORD%207.WAV ADRAGON2.WAV ADRAGON3.WAV ARROW%201.WAV ARROW%202.WAV ARROW%203.WAV ARROW%204.WAV ARROW%205.WAV ARROW%206.WAV ARROW%20V1.WAV ARROW%20V2.WAV ARROW%20V3.WAV ARROW%20V4.WAV BEAR1.WAV BEAR2.WAV BEAR3.WAV BEAR4.WAV BEAR5.WAV MWORKSHOP.WAV DESTROY%20BUILDING.WAV DESTROY%20MINE.WAV LIGHTING2.WAV LIGHTING.WAV METEOR.WAV SMALL%20EXPLOSION.WAV WATER%20BLOP.WAV SPY%20KILL%201.WAV SPY%20KILL%203.WAV SPY%20KILL%202.WAV PRIEST%20ATTACK.WAV LIGHTNING.WAV INVISIBLE.WAV HEAL.WAV FREEZE.WAV FLAME%20BALL.WAV CURSE.WAV CRUSADE.WAV CONFUSION.WAV BLESS.WAV WHIRLPOOL.WAV TURN%20TO%20STONE.WAV TEACH.WAV SUMMON10.WAV SUMMON9.WAV SUMMON8.WAV SUMMON7.WAV SUMMON6.WAV SUMMON5.WAV SUMMON4.WAV SUMMON3.WAV SUMMON2.WAV SUMMON1.WAV REVEAL.WAV RESSURECT.WAV COWDIE1.WAV COWDIE2.WAV COWDIE1.WAV COWDIE3.WAV COWDIE4.WAV DIE%201.WAV DIE%202.WAV DIE%203.WAV DIE%204.WAV DIE%205.WAV DIE%206.WAV DIE%207.WAV DIE%208.WAV DIE%209.WAV DIE%2010.WAV DRAGON%20DIE%201.WAV DRAGON%20DIE%202.WAV GHOST1.WAV GHOST2.WAV GOLEM.WAV H%20DIE%201.WAV H%20DIE%202.WAV H%20DIE%203.WAV H%20DIE%204.WAV H%20DIE%205.WAV H%20DIE%206.WAV H%20DIE%207.WAV H%20DIE%208.WAV H%20DIE%209.WAV H%20DIE%2010.WAV MAGE.WAV ORC%20DIE%201.WAV ORC%20DIE%202.WAV SHIP%20SINK.WAV SIEGE%20DIE%201.WAV SIEGE%20DIE%202.WAV SIEGE%20DIE%203.WAV SIEGE%20DIE%204.WAV SKELETON%20DIE%201.WAV SKELETON%20DIE%202.WAV SKELETON%20DIE%203.WAV SKELETON%20DIE%204.WAV MESSIAH_ATTACK.WAV C%20DIE%201.WAV C%20DIE%202.WAV C%20DIE%203.WAV C%20DIE%204.WAV C%20DIE%205.WAV CAMELDIE1.WAV CAMELDIE2.WAV CAMELDIE3.WAV BAT%20ATTACK.WAV BAT%20CMD.WAV BAT%20DIE.WAV".split(" "),
Cg=function(){if(!pc){var d=function(b,d,e){d=d.split(".")[0].toLowerCase();af[d]=b;!e||e.music&&e.mid!=ab.id||(qa(d,e.x,e.y,e.k,e.music,e.date),e.date=0)},b=function(b,d,e){this.context=b;this.urlList=d;this.onload=e;this.loadCount=0};b.prototype.loadBuffer=function(b,e){var f=new XMLHttpRequest;f.open("GET",h+b,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");var c=this;f.onreadystatechange=function(){4===f.readyState&&200===f.status&&
c.context.decodeAudioData(f.response).then(function(f){f&&d(f,b,e)})};f.send()};for(var e=0,f=Pg.length;e<f;e++){var c=Pg[e];af[c.split(".")[0].toLowerCase()]=c}wd="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206 arrow%20v1 arrow%20v2 arrow%20v3 arrow%20v4".split(" ");Ye="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206".split(" ");Hc="sword%201 sword%202 sword%203 sword%204 sword%205 sword%206 sword%207 sword%208 sword%209 sword%2010 sword%2011 sword%2012 sword%2013 sword%2014 sword%2015 sword%2016 v%20sword%201 v%20sword%202 v%20sword%203 v%20sword%204 v%20sword%205 v%20sword%206 v%20sword%207".split(" ");
Ze=["siege"];Qg=["hand1","hand2","hand3","hand4"];Ud="h%20sword%201 h%20sword%202 h%20sword%203 h%20sword%204 h%20sword%205 h%20sword%206 h%20sword%207 h%20sword%208 h%20sword%209 h%20sword%2010 h%20sword%2011 h%20sword%2012".split(" ");Ri=["ork%20sword%20v1","ork%20sword%20v2","ork%20sword%20v3"];Vd="ship%20cannon%201 ship%20cannon%202 ship%20cannon%203 ship%20cannon%204 ship%20cannon%205 ship%20cannon%206 ship%20cannon%207".split(" ");Si=["ghost%201","ghost%202"];Ti=["mage%20attack"];J=["destroy%20building"];
$e=["siege%20die%201","siege%20die%202","siege%20die%203","siege%20die%204"];Wd="h%20die%201 h%20die%202 h%20die%203 h%20die%204 h%20die%205 h%20die%206 h%20die%207 h%20die%208 h%20die%209 h%20die%2010".split(" ");Ga="die%201 die%202 die%203 die%204 die%205 die%206 die%207 die%208 die%209 die%2010".split(" ");Rg=["e_barrack1"];var h=w.cdn;if("undefined"!==typeof AudioContext){window.AudioContext=window.AudioContext||window.webkitAudioContext;pc=new AudioContext;var m=pc.createGain();var t=pc.createGain();
var v=new b(pc,void 0,d);O("Sound: OK");m.gain.value=parseInt(document.getElementById("musicRange").value)/100;t.gain.value=parseInt(document.getElementById("soundRange").value)/100}ab=function(){if(!p.editor){ab.id++;localStorage.setItem("favMusic",musicSelect.mversion.value);var b=ab.list[musicSelect.mversion.value];b&&qa(b[~~(b.length*Math.random())],0,0,void 0,1,0,ab.id)}};document.getElementById("musicRange").oninput=function(){m.gain.value=parseInt(document.getElementById("musicRange").value)/
100;localStorage.musicRange=document.getElementById("musicRange").value};document.getElementById("soundRange").oninput=function(){t.gain.value=parseInt(document.getElementById("soundRange").value)/100;localStorage.soundRange=document.getElementById("soundRange").value};ab.reset=function(){ab.stop();ab()};ab.stop=function(){ab.active&&(ab.active.stop(),clearTimeout(ab.intv))};ab.id=0;ab.list={originalMusic1:[1,2,3,4,5,6,7,8,9,10,"outro"],originalMusic:"ts1 ts2 ts3 ts4 ts5 ts6 ts7 ts8 ts9 ts10".split(" "),
sharpRain:"sr1 sr2 sr3 sr4 sr5 sr6 sr7 sr8 sr9 sr10".split(" ")};qa=function(b,d,e,f,c,g,h){var n=b;if((b=af[b])&&"loading"!==b&&!p.canceled){var k=-xb+(window.innerWidth-w.mx)/2,B=-Fa+window.innerHeight/2;if(b.duration){if(p.started)if(64<p.now()-b.lastPlayed||!b.lastPlayed)b.lastPlayed=p.now();else return;if(!(!c&&"attack"!=n&&g&&600<Date.now()-g)){if(d){d=-k+32*d;e=-B+32*e;B=ha;if(d*d+e*e>Math.pow(2E3,2))return!1;d/=80;e/=80;B/=8}else B=e=d=0;void 0!==f&&f!==w.kingdom||p.mute||(f=pc.createBufferSource(),
f.buffer=b,c?(f.connect(m),m.connect(pc.destination),ab.active=f,ab.intv=setTimeout(ab,~~(1E3*b.duration)+1E3)):(b=pc.createPanner(),b.panningModel="HRTF",b.setPosition(d,e,B),f.connect(b),b.connect(t),t.connect(pc.destination)),f.start(0))}}else af[n]="loading",c={x:d,y:e,k:f,music:c,date:Date.now(),mid:h},v.loadBuffer(b,c)}};b=document.getElementById("musicSelect").getElementsByTagName("input");e=0;for(f=b.length;e<f;e++)b[e].onchange=ab.reset}},Xd=function(d,b,e,f){d.img===f.url&&(qa(b+~~(Math.random()*
e+1),d.x32,d.y32),setTimeout(Xd,ub(f),d,b,e,f))};"use strict";var wl=function(d){for(var b=[],e=0,f=[d.icons],c=0,h=f.length;c<h;c++)for(var m=f[c],t=0,v=m.length;t<v;t++)if(m[t]){var n=m[t];n.doneBy||(n.doneBy=[]);n.doneBy.put(d);b[e++]=n;n.xtra&&(f.put(n.xtra),h++)}d.habilities=b},Sg=function(){},xl=function(d,b){return b.balanceTotal-d.balanceTotal},Tg=function(d,b){return b.priority-d.priority},bf=function(d,b){if(!d.url.attack||d.attackOnly&&!d.attackOnly[b.type])return 0;var e=25*~~(ub(d.url.attack)/
25);d=d.attack*((xd[d.type][b.type]||0)+1);d-=b.defence;1>d&&(d=1);return~~(b.health/d)*e},db=function(d){this.kingdom=d.k;this.aggressive=this.perfection=1;this.cantBuild={};this.houseLoading=0;this.mineGroup={};d.IAD=db.arr.length;db.arr.put(this)};db.prototype.valorateLost=function(d){this.script.put({order:d.nu,obj:d,priority:1})};var Ug=function(d,b,e,f,c){var g=e.obj.cost;f[0]+=g[0];f[1]+=g[1];f[2]+=g[2];f[3]+=g[3];d[d.length]={order:e,priority:b.priority,name:e.obj.name,obj:e.obj,pTime:b.obj.time,
required:1,doner:c};d.changed=!0},Vg=function(d,b,e,f,c){var g=[d],m=[],t={},v=c.target;m.put(d);for(var n=0;n<g.length;n++){var k=g[n];k.availables&&(k.availables=void 0);if((d=k.order)&&!t[k.order.id]&&(t[k.order.id]=1,!e[d.id])){var l=d.requireObj;if(l)for(var r=0,p=l.length;r<p;r++)if(d=l[r],d.tech)b[d.nu.id]||e[d.nu.id]||Ug(g,k,d.nu,v);else{var q=f[d.type];q.length||Ug(g,k,d.nu,v)}if(l=d.doneBy)for(r=0,p=l.length;r<p;r++)d=l[r],q=f[d.type],q.length||d.race!=c.racestr||Ug(g,k,d.nu,v,1);n&&!k.doner&&
m.put(k)}}return m},Wg={food:2,wood:1,gold:0,stone:3},qc=function(d,b){d=d.order;var e=d.obj,f=qc.tech;e.build?f=qc.build:e.tech||(f=qc.unit);return f(d,b)};qc.unit=function(d,b){d=d.doneBy;if(b.pop<b.popMax)for(var e=0,f=d.length;e<f;e++)for(var c=b[d[e].type],h=0,m=c.length;h<m;h++){var t=c[h];if(t.free)return[t]}return!1};qc.tech=function(d,b){d=d.doneBy;for(var e=0,f=d.length;e<f;e++)for(var c=b[d[e].type],h=0,m=c.length;h<m;h++){var t=c[h];if(t.free)return[t]}return!1};qc.build=function(d,b,
e){d=d.doneBy;e=0;for(var f=d.length;e<f;e++)for(var c=b[d[e].type],h=0,m=c.length;h<m;h++){var t=c[h];if(t.free)return[t]}return!1};qc.sPeasant=function(d){for(var b=[10,79,64],e=[],f=0,c=0,h=b.length;c<h;c++)for(var m=d[b[c]],t=0,v=m.length;t<v;t++)m[t].free&&(e[f++]=m[t]);return e};var Ic=function(d,b,e){if(d){d=d.order;var f=d.obj,c=Ic.unit;f.tech?c=Ic.tech:f.build&&(c=Ic.build);return c(d,b,e)}};Ic.build=function(d,b,e){var f=db.arr[b.IAD];if(4<=f.cantBuild[d.obj.type]&&b.stats.buildsLosed==
f.buildsLosed)return!1;for(var c=[],h=d.doneBy,m=Ja[b.k],t=0,v=h.length;t<v;t++)for(var n=m[h[t].type],k=0,l=n.length;k<l;k++){var r=y[n[k]];if(!r.func&&!r.in||e){c.put(r.id);break}}if(!c.length)return!1;r=d.obj;d=b.origin[0];e=b.origin[1];d=Xg(d,e,80,e-1,d-1,b,r,900);if(0>d)return f.cantBuild[r.type]||(f.cantBuild[r.type]=0),f.cantBuild[r.type]++,f.buildsLosed=b.stats.buildsLosed,!1;f.cantBuild[r.type]&&(f.cantBuild[r.type]=0);W(rc,[d,r.type],c);return!0};var Xg=function(d,b,e,f,c,h,m,t){var g=E,
n=m.space;m=m.validator.check;if(!m)return-1;for(var k=-1,l=e/2*(e/2),r=1,p=d,q=b;0>k&&d-p<e/2;){--p;--q;for(var u=2*r+1,y=2*r+1,x=0,A=u*y;x<A;x++){var w=x%u,D=~~(x/u);if(!w||!D||w==u-1||D==y-1){w+=p;D+=q;var C=(w-d)*(w-d)+(D-b)*(D-b);if(C<l&&m(w,D,n,f,c,C<t,h.k)){k=w+D*g;break}}}r++}return k};Ic.tech=function(d,b,e){e=d.doneBy;b=Ja[b.k];for(var f=[],c=0,h=e.length;c<h;c++)for(var m=b[e[c].type],t=0,v=m.length;t<v;t++){var n=y[m[t]];n.working||n.techStart||!n.built||f.put(n.id)}if(!f.length)return!1;
W(Yg,[d.obj.id,d.id],f[0]);return!0};Ic.unit=function(d,b,e){e=d.doneBy;b=Ja[b.k];for(var f=[],c=0,h=e.length;c<h;c++)for(var m=b[e[c].type],t=0,v=m.length;t<v;t++){var n=y[m[t]];n.working||n.techStart||!1===n.built||f.put(n.id)}if(!f.length)return!1;W(cf,[d.obj.type,1,0],f[0]);return!0};db.prototype.leaveMeAloneIKnowWhatToDo=function(){performance.now();var d=D[this.kingdom],b=d.resources,e=Ja[this.kingdom],f=E;if(d.origin){for(var c=d.origin[0],h=d.origin[1],m=h-1,t=c-1,v=c-40,n=h-40,k=0,l=6400,
r=0;r<l;r++){var q=r%80+v,x=~~(r/80)+n;1600>(c-q)*(c-q)+(h-x)*(h-x)&&(!(q>=t&&q<=t+2)||x>=m&&x<=m+2)&&0===R[q+x*f]&&ka(q,x)&&k++}var A=[];performance.now();for(var w=0,z=0,ma=u.length;z<ma;z++){var Z=u[z];if(!Z.build&&!Z.item&&!Z.boat&&Z.url.attack&&Z.race==d.racestr&&8!=Z.type&&void 0==Z.res){A.put(Z);Z.balanceSum=0;Z.bestBalance=-1;Z.balanceDefence={};for(var H=Infinity,G=Z.attDist,K=0;K<ma;K++){var J=u[K];if(!J.build&&!J.item&&!J.boat&&J.race==d.racestr&&J.url.attack&&8!=J.type&&void 0==Z.res&&
(w=bf(J,Z))){var P=bf(Z,J);P&&(w-=P,w+=2E3*G,w<H&&(H=w,Z.bestBalance=J),Z.balanceSum+=w)}}Z.balanceTotal=Z.balanceSum}}A.sort(xl);Z=A[0];for(var M=1E3,L={},Ec=[],S=0,U=M;!L[Z.type];)L[Z.type]=1,Ec[S++]=Z,Ec[S++]=M,J=Z.bestBalance,M=~~(M*bf(J,Z)/bf(Z,J)+.5),U+=M,Z=J;Ec.nu=U-M;for(var T=d.target,W=C,V=W.length,N=[],Q=0;Q<V;Q++){var I=W[Q],X;if(!(X=!I.type||I.upgrade||I.type==ba||void 0!==Wg[I.value]&&d.resources[I.value]>=T[I.value])){a:{for(var ca=I.nu.doneBy,Y=0,ha=ca.length;Y<ha;Y++)if(ca[Y].race==
d.racestr){var da=!0;break a}da=!1}X=!da}X||N.put({order:I.nu,obj:I,original:1,priority:1E-10})}var ea=[];r=0;l=Ec.length;for(var ia=Ec.nu;r<l;r+=2){var ua=~~(.5+Ec[r+1]/ia*250)-e[Ec[r].type].length,aa=Ec[r];aa=aa.nu;for(var fa=0;fa<ua;fa++)N.put({order:aa,priority:1-fa/ua,obj:aa.obj,original:1})}var na=0,ta=0,pa=d.target,wa={};ta++;pa[0]=0;pa[1]=0;pa[2]=0;pa[3]=0;r=na=ea.length=0;for(l=N.length;r<l;r++){var Ia=N[r].priority,Ea=Vg(N[r],d.technology.actived,d.technology.hidden,e,d);fa=0;for(var va=
Ea.length;fa<va;fa++){aa=Ea[fa];aa.original||(aa.priority=Ia);var qa=1;void 0!==aa.priority&&(qa=aa.priority);var ja=aa.obj;ja.increase&&void 0!==Wg[ja.value]&&(qa=ja.increase*qa/b[Wg[ja.value]]);qa/=ja.time;aa.priority=qa;if(!(0>=aa.priority)){var oa=aa.order.id;!wa[oa]||aa.original?(wa[oa]=na,ea[na++]=aa):ea[wa[oa]].priority+=aa.priority}}}var za=!1;ea.sort(Tg);var Sa={},lb={},Ca={},ya=[],ab=u.length;for(r=0;r<ab;Ca[r++]=0);for(r=0;r<ea.length;r++){var Qa=ea[r];aa=Qa.order;var Li=Qa.obj;if(Qa.original||
Qa.required)Qa.obj.tech||Ca[Qa.obj.type]++,ya.put(Qa);var Ma=aa.doneBy,Da=Li.time;fa=0;for(l=Ma.length;fa<l;fa++){var ob=Ma[fa],Ya=ob.time;if(ob.race===d.racestr){if(Li){for(var sa=ob,$a=e[ob.type],gb=db.process,kb=Da,Ra=$a.length,la=!1,Ba=Infinity,Ka=0;Ka<Ra;Ka++){var Pa=y[$a[Ka]],yb=0;Pa.build&&(Pa.working||Pa.techStart||!Pa.built)&&(Pa.built?(yb=(Pa.c-p.cycle)*Jc.speed,yb/=1E3):(yb=Pa.time*(Pa.maxHealth-Pa.health)/Pa.maxHealth,Pa.workers&&Pa.workers.length&&(yb/=Pa.workers.length)));Pa.build||
!Pa.func&&!Pa.in||(yb=Infinity);Pa.nato!=gb?(Pa.nato=gb,Pa.natoTime=0):yb+=Pa.natoTime;yb<Ba&&(Ba=yb,la=Pa)}la&&Ba<=sa.time?(la.natoTime+=kb,za=la):za=!1}if(!za){Sa[ob.type]||(Sa[ob.type]=[],lb[ob.type]=[]);var bb=Sa[ob.type],Wa=lb[ob.type];Ca[ob.type]||(Ca[ob.type]=0);var vb=!1,xa=0;for(va=bb.length+1;xa<va;xa++){if(void 0==bb[xa]){var nb={order:ob.nu,priority:0,obj:ob};ea.put(nb);ya.put(nb);bb[xa]=0;Wa[xa]=nb;Ca[ob.type]++;vb=!0}if(bb[xa]+Da<=Ya||vb){bb[xa]+=Da;Wa[xa].priority+=Qa.priority;break}}}}}}ya.sort(Tg);
var jb=0;r=0;for(l=ya.length;r<l;r++)if(Qa=ya[r].obj,Qa.build){var tb=Qa.space[Qa.space.length-1]+2;jb+=tb*((Qa.space.length-1)/tb+2)}O(jb,k);if(jb>k){var ub=k/jb*.7;r=0;for(l=u.length;r<l;r++)u[r].build&&(Qa=Ca[r])&&((Qa=~~(Qa*ub))||(Qa=1),Ca[r]=Qa)}r=0;for(l=ya.length;r<l;r++)Qa=ya[r].obj,Qa.build&&(Ca[Qa.type]?Ca[Qa.type]--:ya[r]=0);O(ya);Ui(ya);for(var La=ya,Na=new Uint32Array(14),Xa=new Uint32Array(7),pb=new Uint32Array(7),qb=new Uint32Array(7),Va=6.25,Ga=d.resources,Ab=[Xa,qb,Na,pb],ra=0,Ta=
0,xb=0;3>xb;xb++){var Fa=Ga[0],Ha=Ga[1],ib=Ga[2],zb=Ga[3];Infinity==Fa&&Infinity==Ha&&Infinity==ib&&Infinity==zb&&(Va=-1);var mb=0,Hb=0,Eb=0,cb=0;ra=0;for(Ta=La.length;ra<Ta;ra++)if(La[ra]){var wb=La[ra].obj.cost;mb+=wb[0];Hb+=wb[1];Eb+=wb[2];cb+=wb[3]}if(xb){for(ra=0;ra<Na.length;Na[ra++]=0);for(ra=0;ra<Xa.length;Xa[ra++]=0);for(ra=0;ra<pb.length;pb[ra++]=0);for(ra=0;ra<qb.length;qb[ra++]=0);}var Bb=[],Gb={},Cb={},cc={pop:0,popMax:200},Nb=[[]];ra=0;for(Ta=e.length;ra<Ta;ra++){eb=e[ra];var Ib=[];
cc[ra]=Ib;for(var rb=0,Db=eb.length;rb<Db;rb++)Ib[rb]={free:1,type:ra}}for(var Aa=0;9E3>Aa;){var Jb=10*df(Xa)/7,Tb=10*df(qb)/7,Kb=10*df(Na)/14,Ob=10*df(pb)/7;Fa+=10*Xa[Aa%Xa.length];Ha+=10*qb[Aa%qb.length];ib+=10*Na[Aa%Na.length];zb+=10*pb[Aa%pb.length];var Lb=Nb[Aa];if(Lb)for(ra=0,Ta=Lb.length;ra<Ta;ra++){var Za=Lb[ra],hb=Za.list;rb=0;for(Db=hb.length;rb<Db;rb++){var eb=hb[rb];eb.used||(eb.used=!0,Bb.put(eb.action));eb.free=1}var Pb=Za.action&&(Za.action.original||Za.action.required)?!0:!1;if(Za.obj.tech){Gb[Za.obj.nu.id]=
1;var Qb=Za.obj;"popLimit"==Qb.value&&(cc.popMax+=Qb.increase)}else Za.obj.build||cc.pop++,cc[Za.obj.type].put({free:1,type:Za.obj.type,action:Za.action,used:Pb})}ra=0;for(Ta=La.length;ra<Ta;ra++)if(eb=La[ra]){var Zb=eb.obj;if(Zb.peon||!(Kb<Va)){var sb=Zb.cost;if(!(sb[0]>Fa||sb[1]>Ha||sb[2]>ib||sb[3]>zb)&&1===Vg(eb,Gb,Cb,cc,d).length&&(hb=qc(eb,cc))){La[ra]=void 0;var Fb=eb.obj.time+Aa;Nb[Fb]||(Nb[Fb]=[]);if(eb.obj.tech){if(Cb[eb.order.id])continue;Cb[eb.order.id]=1}(eb.original||eb.required)&&Bb.put(eb);
for(var Rb=0;Rb<hb.length;hb[Rb++].free=0);Nb[Fb].put({list:hb,obj:eb.obj,action:eb});Fa-=sb[0];Ha-=sb[1];ib-=sb[2];zb-=sb[3]}}}hb=qc.sPeasant(cc);ra=0;for(Ta=hb.length;ra<Ta;ra++){var Sb=Vi(Jb,Tb,Kb,Ob,Fa,Ha,ib,zb,mb,Hb,Eb,cb);if(0>Sb)break;2===Sb&&(Ha-=200);Ab[Sb][Aa%Ab[Sb].length]++;eb=hb[ra];eb.free=0;eb.used||(eb.used=!0,Bb.put(eb.action))}Aa++}La=Bb;La.sort(Tg);Ui(La)}this.script=ya=La}};var df=function(d){for(var b=0,e=d.length,f=0;f<e;b+=d[f++]);return b},Vi=function(d,b,e,f,c,h,m,t,v,n,k,
l){if(Infinity==c&&Infinity==h&&Infinity==m&&Infinity==t)return-1;if(6.25>e)return 200>h?1:2;c=v+l+k+n;h=d+b+e+f;d/=v/c*h;b/=n/c*h;e/=k/c*h;f/=l/c*h;return d<b&&d<e&&d<f?0:b<e&&b<f?1:e<f?2:3},Zg=function(){for(var d=0,b=db.arr,e=b.length;d<e;b[d++].maintenance());gb({func:Zg},db.time,1);db.process++},Wi=function(d,b,e){for(var f=d.length,c=Infinity,h=0,m=0;m<f;m++){var t=y[d[m]],v=Math.pow(b-t.x32,2)+Math.pow(e-t.y32,2);v<c&&(c=v,h=t.id)}return h};db.prototype.maintenance=function(){var d=this.script;
if(d){var b=D[this.kingdom];if(b.origin){p.blocked=!0;var e=b.technology,f=e.actived,g=e.hidden,h=Ja[b.k];e=E;var m={};if(b.values.pop+b.unitLoading+5>b.values.popMax&&b.values.popMax<=b.values.popLimit){for(var t=La[b.race].house.nu,v=0,n=0,k=b.building,l=k.length;n<l;n++){var r=y[k[n]];r.population&&(v+=r.population)}b.values.pop+b.unitLoading+5>b.values.popMax+v&&Ic({order:t,priority:1,obj:t.obj},b,!0)}k=b.resources;t=k[0];v=k[1];var q=k[2],x=k[3],A=[];if(Infinity!=t||Infinity!=v||Infinity!=q||
Infinity!=x){r=0==b.race?c.createPeon.obj:1==b.race?c.createPeon2.obj:c.createPeon1.obj;var w=0,C=0,ma=0,Z=0;n=0;for(l=d.length;n<l;n++)if(d[n]){var z=d[n].obj.cost;w+=z[0];C+=z[1];ma+=z[2];Z+=z[3]}var H=z=0,G=0,K=0,J=h[r.type];n=0;for(l=J.length;n<l;n++)if(r=y[J[n]],40==r.func)21==y[r.funcObj.u].type?z+=10/7:K+=10/7;else if(43==r.func)G+=10/14;else if(42==r.func)H+=10/7;else{if(19==r.func&&r.stock){var O=r.stock[1];0==O?z+=10/7:1==O?H+=10/7:2==O?G+=10/14:K+=10/7}(19!=r.func||r.action)&&r.func||A.put(r)}}n=
0;for(l=d.length;n<l;n++)r=d[n],!r||m[r.order.id]||6.25>G&&!r.obj.peon||(J=Vg(r,f,g,h,b).length,O=r.obj.cost,O[0]>k[0]||O[1]>k[1]||O[2]>k[2]||O[3]>k[3]||1===J&&(Ic(r,b)?d[n]=0:m[r.order.id]=1));if(A.length)for(d=-Infinity,n=0,k=b.building,l=k.length;n<l;n++){r=y[k[n]];if(r.population)break;r=r.time*(1-r.health/r.maxHealth);r>d&&(d=r)}n=0;for(l=A.length;n<l;n++)if(r=A[n],k=Vi(z,H,G,K,t,v,q,x,w,C,ma,Z),0==k)(k=Wi(Ja[0][21],r.x32,r.y32))&&Xi(k,r,this,b);else if(1==k)Yi(r);else if(2==k){a:{k=h[20];d=
k.length;for(f=0;f<d;f++)if(g=y[k[f]],!g.workers.length&&14E3<25*(p.cycle-g.lastUse)){g.lastUse=p.cycle+100;k=g;break a}k=void 0}if(k)W(sc,k.id,[r.id]);else{m=Ja[b.k];k=E;J=hb[2];d=[];d.length=J.length;f=0;for(g=J.length;f<g;d[f]=m[J[f++]]);m=Infinity;J=u[20].space;O=-1;f=0;for(g=d.length;f<g;f++)for(var P=d[f],M=0,R=P.length;M<R;M++){var L=y[P[M]],S=L.x32-10,I=L.y32-10,N=L.space[L.space.length-1],T=L.x32+.5*N;L=L.y32+.5*(L.space.length-1)/N;for(N=0;400>N;N++){var V=N%20,Q=~~(N/20);V+=S;Q+=I;var X=
(V+1-T)*(V+1-T)+(Q+1-L)*(Q+1-L);X<m&&$g(V,Q,J)[1]&&(O=V+Q*k,m=X)}}k=O;-1<k&&(W(rc,[k,20],[r.id]),v-=200)}}else 3==k&&(k=Wi(Ja[0][22],r.x32,r.y32))&&Xi(k,r,this,b);w=!1;h=Infinity;G=b.diplomacy;ma=b.origin[0];Z=b.origin[1];C=Ja[b.k];n=1;for(l=D.length;n<l;n++)G[n]&&!D[n].death&&D[n].origin&&(r=D[n],z=r.origin[0]-ma,H=r.origin[1]-Z,b=z*z+H*H,b<h&&(h=b,w=r));if(w){b=[];n=z=0;for(l=C.length;n<l;n++)for(H=C[n],h=0,G=H.length;h<G;h++)r=y[H[h]],void 0!=r.func||r.standardFunc!=U||r.death||(b[z++]=r.id);if(60<
b.length){r=w.origin[0];C=w.origin[1];k=[40,0,-40,0,0,40,0,-40];h=Infinity;n=0;for(l=k.length;n<l;n+=2)if(z=k[n],H=k[n+1],z+=ma+10*Math.sign(z),H+=Z+10*Math.sign(H),(z-r)*(z-r)+(C-H)*(C-H)<h&&ka(z,H)){h=(z-r)*(z-r)+(C-H)*(C-H);var aa=z+H*e}l=aa%e;ma=~~(aa/e);Z=-1;z=Infinity;C=Ja[w.k];n=0;for(length=C.length;n<length;n++)for(w=C[n],h=0,H=w.length;h<H;h++)r=y[w[h]],G=(r.x32-l)*(r.x32-l)+(r.y32-ma)*(r.y32-ma),G<z&&(z=G,Z=r.x32+r.y32*e);-1<Z&&W(Zi,[aa,Z],b)}}p.blocked=!1}}};var Xi=function(d,b,e,f){var c=
La[b.race].storage,h=y[d],m=y[e.mineGroup[d]];!m&&f.paypalTest(c.cost)?(h=Xg(h.x32+2,h.y32+2,20,0,0,f,c,0),-1<h&&W(rc,[h,c.type],[b.id]),e.mineGroup[d]=f.building[f.building.length-1]):m&&!1===m.built?W(tc,m.id,[b.id]):W(sc,d,[b.id])},Yi=function(d){for(var b=D[d.kingdom],e=Ja[b.k],f=hb[1],c=0,h=f.length;c<h;c++)for(var m=e[f[c]],t=0,v=m.length;t<v;t++){var n=y[m[t]];if(!n.castle){if(!1===n.built)return W(tc,n.id,[d.id]);if(n=$i(n.x32,n.y32,.075))return W(sc,n,[d.id])}}m=b.building;c=0;for(h=m.length;c<
h;c++)if(n=y[m[c]],1===n.storage)return W(tc,n.id,[d.id]);e=La[d.race].lumbermill;f=b.origin[0];m=b.origin[1];c=1;h=b.resources;t=e.cost;if(t[0]<h[0]&&t[1]<h[1]&&t[2]<h[2]&&t[3]<h[3])for(;80>c;){--f;--m;v=2*c+1;n=2*c+1;t=0;for(h=v*n;t<h;t++){var k=t%v,l=~~(t/v);if(!k||!l||k==v-1||l==n-1)if(k+=f,l+=m,-1<$i(k,l,.15,!0)&&(k=Xg(k,l,8,0,0,b,e,0),-1<k))return W(rc,[k,e.type],[d.id])}c++}b=Ja[0][7];c=b.length;h=Infinity;for(e=t=0;e<c;e++)f=y[b[e]],m=Math.pow(d.x32-f.x32,2)+Math.pow(d.y32-f.y32,2),m<h&&(h=
m,t=f.id);(b=t)&&W(sc,b,[d.id])},$i=function(d,b,e,f){var c=E,h=d,m=b;d-=5;b-=5;for(var t=0,v=-1,n=Infinity,k=0;100>k;k++){var l=k%10,r=~~(k/10);l+=d;r+=b;if(ka(l,r)){var p=y[R[l+r*c]];if(f&&1==p.storage)return-1;7===p.type&&(t++,l=Math.pow(l-h,2)+Math.pow(r-m,2),l<n&&(n=l,v=p.id))}}if(t/100>=e)return v},Zi=function(d,b){var e=E,f=d[0];d=d[1];var c=d%e;e=~~(d/e);for(var h=0,m=b.length;h<m;h++){var t=y[b[h]];6400<(t.x32-c)*(t.x32-c)+(t.y32-e)*(t.y32-e)?ta(-f,t,Yd,t.url.move):ta(-d,t,Yd,t.url.move)}ah(b);
gb({func:aj,data:{list:b,xy:-d}},3E4,1)},aj=function(d){var b=d.list;d=d.xy;for(var e=0,f=b.length;e<f;e++){var c=y[b[e]];c.death||ta(d,c,Yd,c.url.move)}},Ui=function(d){for(var b={},e=0;e<d.length;e++)d[e]&&!d[e].obj.tech&&(b[d[e].obj.name]||(b[d[e].obj.name]=0),b[d[e].obj.name]++,"Blacksmith"==d[e].obj.name&&O(d[e]));O(b)},bj=function(d){var b=d.x32+d.y32*E,e=D[d.kingdom].diplomacy;!d.invisible&&lc[b]&&(b=y[lc[b]],e[b.kingdom]&&uc(d.id,[b.id],0,yd))},Kd=function(d){var b=bh(d.id);return b?(uc(b,
[d.id],0,yd),!0):!1},bh=function(d,b){d=y[d];if(!d.freezed&&!d.invisible&&!1!==d.built){var e=d.x32,f=d.y32,c=D[d.kingdom].diplomacy,h=d.sight;d.build&&(h=d.attDist);var m=E,t=2*h+1,v=!!d.confused,n=0;b&&(n=h-b);for(var k=Infinity,l=!1,r=0,p=t*t;r<p;r++){var q=r%t-h,u=~~(r/t)-h,x=Math.sqrt(q*q+u*u);if(x<=h&&x>=n&&(q+=e,u+=f,ka(q,u)))for(var A=0;3>A;A++){b=bb[A][q+m*u];var w=y[b];if((w&&w.kingdom&&(c[w.kingdom]||w.confused)||v)&&!(w.death||w.invisible||d.attackOnly&&!d.attackOnly[w.type]||b==d.id||
w.item||w.field)){var z=xd[d.type][w.type];z||(z=0);w=x*x+.05*w.health-(z+1)*d.attack;w<k&&(l=b,k=w)}}}return l}},yl=function(d){d.setupINTV(cj,d.id,1E3)},cj=function(d){d=y[d];var b=d.free;b||(b=dj);var e=E,f=d.x32,c=d.y32,h=[];h.length=D.length;for(var m=h.length,t=0;t<m;h[t++]=0);t=0;for(var v=b.length;t<v;t+=2){var n=b[t]+f,k=b[t+1]+c;ka(n,k)&&(n=y[R[n+k*e]],n.nocapture||n.build||h[n.kingdom]++)}e=b=0;for(t=1;t<m;t++)h[t]>b&&(e=t,b=h[t]);b&&d.kingdom!=e&&d.changeKingdom(e);Pb(d,1E3)},ef,zl=[1,
1],ej=function(){return 25*(Date.now()-p.loadDate+p.pausedTime+p.deltaTime)/Jc.speed},Nb=function(d){if(!(d&&p.online||Nb.bySystem&&d))if(0===p.paused){p.paused=1;void 0!=ef&&clearInterval(ef);var b=p.now();p.pausedTime+=Date.now();d||(Nb.bySystem=1);p.now=function(){return b}}else p.pausedTime-=Date.now(),p.paused=0,Nb.bySystem=0,d&&(document.getElementById("alert").style.display="none"),ef=setInterval(Jc,Jc.speed),p.now=ej};Nb.bySystem=0;var Ib=function(d,b){var e=!1;if(1>d){d*=-1;var f=~~(d/Ea),
c=d%Ea}else e=d;d=0;for(var h=b.length;d<h;d++){var m=y[b[d]];m.build||m.cow&&m.workers.length||e==m.id||(m.action=null,m.distance=0,m.mv&&null!=m.xf?(e?(m.xf=e,m.yf=!0):(m.xf=c,m.yf=f),m.nodes=void 0):m.x32==c&&m.y32==f?m.stay():(m.dix=(c-m.x32)/Math.abs(c-m.x32),m.diy=(f-m.y32)/Math.abs(f-m.y32),e?(m.xf=e,m.yf=!0):(m.xf=c,m.yf=f),m.mv=!0,m.setupINTV(Zd,m.id,0),ch(m),m.action=null))}},ch=function(d){d.stock&&0!==d.stock[0]?(d.mimg=d.url[d.stock[4].url],d.stock[3]===Kc&&(d.mimg=d.url.milk)):d.mimg=
d.url.move};Ib.cursor=7;Ib.allowPos=1;var Pb=function(d,b,e){b=~~(b/25)+p.cycle;e=Yc[b];e||(e=[],Yc[b]=e);var f=e.length;d.c=b;e[f]=d.id;d.timestamp=p.now()},Yc={},ff=function(d){var b=y[d[0]];if(!b.death){var e=d[1],f=d[2],c=d[3];b.cow&&"milk"==e&&b.workers&&b.workers.length||(b[e]+=D[b.kingdom].values[f],f=b[e+"Max"],b[e]>f&&2!==b.blocked&&(b[e]=f));"mana"==e&&(f=b.manaTask)&&f[2]<=b[e]&&(O(f),ta(f[1],b,Qb[f[0]],b.url.move),b.manaTask=void 0,b.blockedAction(1));Y(b.id,1);gb({func:ff,data:d},c,1)}},
gb=function(d,b,e){d.func.url||O(d.func);d.func=d.func.url;e&&(b=~~(b/25)+p.cycle);e=Zc[b];e||(e=[],Zc[b]=e);e.put(d)},Zc={},Zd=function(d){d=y[d];var b=E,e=!1;d.waiting&&ch(d);var f=d.y32,c=d.x32;dh(1,d,"zone");var h=Qb[d.action];ib(d,32*f);var m=bb[d.zLevel],t=c+f*b;bj(d);if(d.id===m[t]){var v=d.size;if(2>v)m[t]=d.radix;else for(var n=v*v,k=-b,l=0;l<n;l++){var r=l%v;0===r&&(k+=b);m[t+r+k]=0}}if(d.stop)return m[t]=d.id,d.stay(),d.stop=void 0,0;if(d.kx||d.ky){var p=d.kx||0,q=d.ky||0;n=!1;if(0!==m[p+
c+(q+f)*b])return d.aspettare()}else{h&&h.rev&&(n=h.rev(d))&&(d.action=n[0],h=Qb[d.action],d.xf=n[1],d.yf=!0);if(!0===d.yf){n=d.xf;var u=y[n];if(!u||u.death&&(!h||!h.available))return m[t]=d.id,d.stay();l=!0;k=!1;if(h&&h.available){k=h.available(d,u);if(!1===k)return d.aspettare();if("kill"===k)return m[t]=d.id,d.stay();if(55===k)return m[t]=d.id;l=k[2]}else u.death||(k=Lc(u,d,50,d.radix));d.xf!==n&&(u=y[d.xf]);if(!u||u.death||u.in)return m[t]=d.id,d.stay();if(!l&&(x+w*b===t||h))return d.aspettare();
var x=k[0],w=k[1];if(h&&h.distance){var A=h.distance;A=0>A?d.attDist:D[d.kingdom].values[A];k=eh(u,c,f);$d(c,f,k%E,~~(k/E),A)&&(e=2)}d==u&&(e=2)}else{x=d.xf;w=d.yf;n=m[x+w*b];if(2<n&&(!h||h&&h.rev)){n=y[n];k=Lc(n,d,50,d.radix);if(!1===k)return m[t]=d.id,d.stay();x=k[0];w=k[1]}h&&h.distance&&(A=h.distance,A=0>A?d.attDist:D[d.kingdom].values[A],$d(c,f,x,w,A)&&(e=2))}n=x+w*b;k=x;l=w;if(d.nodes){var z=d.nodes;20<z.length&&(z.length=2);l=z[z.length-2];k=l%b;l=~~(l/b);r=z[z.length-1];if(c+f*b==k+l*b||m[r]==
d.radix||m[k+l*b]!==d.radix)z.length-=2,z.length?(l=z[z.length-2],k=l%b,l=~~(l/b)):(k=x,l=w,d.nodes=void 0)}if(!e){p=k;q=l;r=d.radix;z=E;var C=c+f*z,H=p+q*z,G,J=p-c,K=q-f,O=Math.sqrt(J*J+K*K);for(G=0;16>G;G++){var L=~~(8*fh(C%z-p,~~(C/z)-q)+.5)%8;if(C===H)break;var P=m[C+Zb[L]];if(P===r||gf(P))C+=Zb[L];else if(P=m[C+Zb[(L+1)%8]],P===r||gf(P))C+=Zb[(L+1)%8];else{var M=L-1;-1===M&&(M=7);P=m[C+Zb[M]];if(P===r||gf(P))C+=Zb[M];else{C+=Zb[L];break}}if(!G)var N=C;ae&&zd(C%z,~~(C/z),"stone")}L=0;P=-1;if(m[C]>
r){2<m[C]&&(P=C);var R=[C],S=1,V=0,T={};T[C]=2;for(var Q=Infinity,I=-Infinity,U=0;void 0!==(M=R[V++]);){ae&&zd(M%z,~~(M/z),"food");G=M%z;var W=~~(M/z);G=((G-p)*K-(W-q)*J)/O;G<Q?(Q=G,L=M):G>I&&(I=G,U=M);for(G=0;4>G;G++)if(C=M+fj[G],ka(C%z,~~(C/z))&&!T[C]&&m[C]!==r&&!gf(m[C]))for(H=0;8>H;H++)if(m[C+Zb[H]]===r){R[S++]=C;T[C]=2;break}}ae&&zd(L%z,~~(L/z),"gold");ae&&zd(U%z,~~(U/z),"gold");M=Math.pow(Q,2)<=Math.pow(I,2)?L:U;Q=-Infinity;for(H=0;8>H;H++){C=M+Zb[H];if(G=m[C]===r)G=E,R=M+Zb[H],G=1<Math.abs(M%
G-R%G)||1<Math.abs(~~(M/G)-~~(R/G))?!1:!0;G&&(G=C%z,W=~~(C/z),G=((G-p)*K-(W-q)*J)/O,Math.pow(G,2)>Q&&(L=C,Q=Math.pow(G,2)))}ae&&zd(L%z,~~(L/z),"wood")}q=[N,L,P];N=q[0];p=q[1];r=q[2];p&&(d.nodes?(d.nodes.put(p),d.nodes.put(r)):d.nodes=[p,r]);void 0!==N?(p=-c+N%b,q=-f+~~(N/b)):q=p=1;if(1<Math.abs(p)||1<Math.abs(q))return d.aspettare();if(m[c+p+(f+q)*b]!==d.radix||!ka(c+p,f+q)){N=[c+1,f,c-1,f,c+1,f+1,c+1,f-1,c,f-1,c-1,f+1,c,f+1,c-1,f-1];p=E;q=Infinity;for(r=0;r<N.length;r+=2)if(0===m[N[r]+N[r+1]*p]&&
ka(N[r],N[r+1])&&q>=(N[r]-k)*(N[r]-k)+(N[r+1]-l)*(N[r+1]-l)){q=(N[r]-k)*(N[r]-k)+(N[r+1]-l)*(N[r+1]-l);var X=r}k=[N[X],N[X+1]];p=k[0]-c;q=k[1]-f;p=0<p?1:0>p?-1:0;q=0<q?1:0>q?-1:0;if(m[c+p+(f+q)*b]!==d.radix||!ka(c+p,f+q))return d.aspettare()}}}if(t==n||e)if(m[c+f*b]=d.id,d.x32=c,d.y32=f,h){if(h.distance&&2!==e)return d.aspettare();d.stay(1);u||(u=x+w*b);d.action=void 0;h(u,d,A)}else d.stay();else{if(0===p&&0===q)return d.aspettare();d.setupDir(p,q);e=d.spd;aa(d,d.mimg,-1,d.spd/d.__proto__.spd);d.dix=
p*e;d.diy=q*e;f+=q;c+=p;d.x32=c;d.y32=f;d.distance++;Pb(d,~~(32E3/e));Mc(d,p*e,q*e,0);t=c+f*b;if(2>v)m[t]=d.id;else for(n=v*v,k=-b,l=0;l<n;l++)r=l%v,0===r&&(k+=b),m[t+r+k]=d.id}},Jc=function(){if(!p.editor){var d=p.cycle;p.now();var b=Date.now();if(p.demo){var e=p.record[d];if(e)for(var f=0;f<e.length;f+=3)hf[e[f]](e[f+1],e[f+2])}if(e=Zc[d]){for(f=0;f<e.length;f++){var c=e[f];Qb[c.func](c.data)}delete Zc[d]}if(e=Yc[d]){for(f=0;f<e.length;f++)c=y[e[f]],c.c===d&&(c.death?O("anti stall:",Qb[c.func].name,
c.func,c):(c.c=void 0,Qb[c.func](c.funcObj)));delete Yc[d]}p.cycle++;if(p.online&&0===p.cycle%8)var h=gh();hh+=Date.now()-b;0===p.cycle%40&&(d=p.now()/1E3,b=~~(d/60)%60,e=~~(d/3600),d=~~(d%60),1===(d+"").length&&(d="0"+d),0!=e?(e+=":",10>b&&(b="0"+b)):e="",q("topinfo").innerHTML="<span>CPU:"+(hh/10).toFixed(2)+"%</span> <span>"+~~(ih/jh+.5)+"FPS</span> <span>"+e+b+":"+d+"</span>",ih=jh=hh=0);!h&&!p.automatic&&p.now()-(p.cycle-1)*Jc.speed>=Jc.speed&&Jc()}};Jc.speed=25;var hh=0,jh=0,ih=0,Zb,fj,zd=function(d,
b,e){e=Object.assign({},$b[e]);e.x32=d;e.y32=b;e.z32=2;qb(e);Vb.new(e,500)},gf=function(d){return(d=y[d])&&19===d.func&&!d.waiting?!0:!1},ae,fh=function(d,b){d=.5-Math.atan2(b,d)/(2*Math.PI);1==d&&(d=0);return d},Za=function(d,b,e,f){return[d,b,e,f,d,b,e,f,d,b,e,f,d,b,e,f]},jf=new Float32Array(Za(1,0,0,.75)),Al=new Float32Array(Za(1,1,1,.5)),gj=new Float32Array(Za(0,1,0,.75)),Bl=new Float32Array(Za(0,1,0,.9)),Cl=new Float32Array(Za(.3515625,.29296875,.21875,.9)),hj=new Float32Array(Za(0,1,1,.9)),
kh=new Float32Array(Za(1,1,1,.5)),ij=new Float32Array(Za(.3,.3,.3,.9)),jj=new Float32Array(Za(.7,.2,.2,.9));hj.noAlpha=1;ij.noAlpha=1;jj.noAlpha=1;var Q=function(d){W(cf,[d,4*rb.shift+1,Db],G[0])},cf=function(d,b){var e=d[0],f=d[1],c=d[2];d=u[e];b=y[b];var h=b.icons.indexOf(d.nu);if(!(0>h)){performance.now();if(0==c)for(c=0;c<f;c++){var m=D[b.kingdom],t=m.mod[e].cost||d.cost;if(m.paypal(t))break;b.waitlist||(b.waitlist=[]);b.waitlist.push(e,-h-1);b.work||(b.work={});b.work[h]||(b.work[h]=0);b.work[h]++;
b.working=1;m.unitLoading++;2==b.waitlist.length&&(t=1E3*d.time,b.setupINTV(be,b.id,t))}else{if(!b.work||!b.waitlist.length)return;var k=b.waitlist;m=D[b.kingdom];for(c=0;c<f;c++){t=m.mod[e].cost||d.cost;m.setupResources(t,-1);t=k.lastIndexOf(e);if(0>t)break;k.splice(t,2);b.work[h]--;if(0==k.length){b.c=-1;b.working=0;break}m.unitLoading--;0===t&&(t=1E3*u[k[0]].time,b.setupINTV(be,b.id,t))}}Y(b.id)}},kj=0,be=function(d){d=y[d];var b=d.kingdom;b=D[b];var e=b.values.pop>=b.values.popMax?x.houseLimit:
x.popLimit;if(b.values.pop>=b.values.popMax||b.values.pop>=b.values.popLimit)return document.getElementById("msgs1").getElementsByTagName("li"),3E4<Date.now()-kj&&b.k==w.kingdom&&vc(e,0,5),kj=Date.now(),b.onFreePop.put(d.id);b.unitLoading--;b=d.waitlist[0];e=u[b];d.work[-d.waitlist[1]-1]--;d.waitlist.splice(0,2);0<d.waitlist.length?d.setupINTV(be,d.id,1E3*e.time):d.working=0;$c(b,d);Y(d.id)},kb=function(){if(0==Db){var d=y[G[0]];W(lh,[d.mlistID[jb.nu],!0],d.id)}},Ra=function(){if(0==Db){var d=y[G[0]];
W(lh,[d.hlistID[jb.nu],!1],d.id)}},lj=function(d,b,e){var f=1.6,c=0;1===b&&(e=0,f=3.6,c=620);return[c+~~(f*d[0]*b+.5)+120*e,~~(f*d[1]*b+.5),~~(f*d[2]*b+.5),~~(f*d[3]*b+.5)]},lh=function(d,b){var e=d[0];d=d[1];b=y[b];var f=D[b.kingdom],c=D[b.kingdom];if(c.values.pop>=c.values.popMax)return vc(x.popLimit,0,5);if(d)var h=c.values.fameTech;c=4;var m=9*d;m||(m=1);if(d)var t=b.mlist,k=b.mlistID;else t=b.hlist,k=b.hlistID;var n=k.indexOf(e);if(!(0>n)){e=t[n].unit;var l=lj(u[e].cost,m,h);if(f.paypal(l))return 0;
t.splice(n,1);k.splice(n,1);X.active==t&&ia(t);for(f=0;f<m;f++)k=$c(e,b),h?k.level=c:d||(c=16,k.level=c,t=mj[k.race],k.name=t[k.id%t.length],nj(k))}},$c=function(d,b,e,f){var c=E,h=b.kingdom;b.rnd||mh(b);var m=-1,t=-1;if(b.point&&!b.disallowPoint){var k=b.point[0],n=b.point[1];m=oj(b,k,n,u[d].radix,u[d].rbase())[0]}else m=oj(b,m,t,u[d].radix,u[d].rbase())[1],m=m[pj(b,m.length)];t=~~(m/c);d=new ad(d,h,m%c,t,0,!1,f);ce(h);e||qa("unitdone",0,0,d.kingdom);if(b.point&&(b=nh(k,n,d,!0),e=b[1],b[0]))b[0](e,
[d.id]);return d},kf=0,lf=0,Ub,Va,Sd,L=function(d){T=function(){};d=u[d];Ub=!1;var b=K;aa(b,d.img);b.active=!0;Va=d;Sd=!1;document.addEventListener("mousemove",Mg);document.addEventListener("mousedown",Ve)},Ve=function(d){var b=Va.validator,e=Va.space,f=Ia[Va.img];if(0==d.button&&151<d.pageX){f=Wb(d.pageX-w.mx-.5*f[8]/ha,d.pageY-.5*f[9]/ha);var c=~~(.03125*f[1]);f=~~(.03125*f[0]);b(f,c,e,w.kingdom)[1]&&(Ub=!0,K.active=!0,K.x=-9999,K.y=-9999,T=151<d.pageX?0:zb,document.removeEventListener("mousedown",
Ve),W(rc,[f+E*c,Va.type,Sd],G),rb.shift&&(Sd?Ii(Sd):L(Va.type)));T=function(){}}else K.active=!0,K.x=-9999,K.y=-9999,Ub=!0,T=zb,document.removeEventListener("mousedown",Ve)},Mg=function(d){var b=Va.validator,e=Va.space,f=Ia[Va.img];if(Ub)document.removeEventListener("mousemove",Mg);else{var c=d.pageX,h=d.pageY;if(c!=kf||h!=lf)K.active=!0,kf=c,lf=h,c=Wb(d.pageX-w.mx-.5*f[8]/ha,d.pageY-.5*f[9]/ha),h=~~(.03125*c[1]),c=~~(.03125*c[0]),d=32*c,f=32*h,(b=!b(c,h,e,Eb.k)[1])?b!=Nc&&(Nc=b,k.bindBuffer(k.ARRAY_BUFFER,
pb),k.bufferSubData(k.ARRAY_BUFFER,16*K.bufferID,jf)):b!=Nc&&(Nc=b,k.bindBuffer(k.ARRAY_BUFFER,pb),k.bufferSubData(k.ARRAY_BUFFER,16*K.bufferID,gj)),K.x=d,K.y=f}},rc=function(d,b){var e=d[0],c=e%Ea,g=~~(e/Ea),h=p.editor?w.kingdom:y[b[0]].kingdom;e=d[1];var m=u[e],t=m.cost,k=D[h];if(!m.validator(c,g,m.space,h)[1]||!p.editor&&k.paypal(t))return!1;d=new ad(e,h,c,g,0,!p.editor,d[2]);if(!0===d.invalid||p.editor)return!1;d.waitlist=[];if(20===e)d.built=1,c=y[b[0]],ta(d.id,c,bd,c.url.move);else for(d.health=
1,aa(d,d.bimg),d=d.id,e=0,g=b.length;e<g;e++)c=y[b[e]],c.buildList?(c.buildList.put(d),c.func!==mf.url&&(h=nf(c.buildList,c.x32,c.y32))&&ta(h,c,cd,c.url.move)):(c.buildList=[d],c.func!==mf.url&&ta(d,c,cd,c.url.move))},Nc=null,ph=function(d){T=function(){};d=u[d];Ub=!1;var b=K;Va=d;aa(b,d.img);document.addEventListener("mousemove",qj);document.addEventListener("mousedown",oh)},oh=function(d){var b=E,e=Ia[Va.img];if(0==d.button&&151<d.pageX){d=Wb(d.pageX-w.mx-.5*e[8]/ha,d.pageY-.5*e[9]/ha);var c=~~(.03125*
d[1]);d=~~(.03125*d[0]);k.bindBuffer(k.ARRAY_BUFFER,pb);k.bufferSubData(k.ARRAY_BUFFER,0,Cl);var g=ca[2];ca[2]=32;ca[5]=32;ca[8]=32;ca[11]=32;K.wall=d+c*b;var h=d;document.addEventListener("mouseup",function v(d){Gb.forced=!1;d=wa[3*w.kingdom];var e=wa[3*w.kingdom+1],f=wa[3*w.kingdom+2];A[0]=d;A[1]=e;A[2]=f;A[3]=.5;A[4]=d;A[5]=e;A[6]=f;A[7]=.5;A[8]=d;A[9]=e;A[10]=f;A[11]=.5;A[12]=d;A[13]=e;A[14]=f;A[15]=.5;k.bindBuffer(k.ARRAY_BUFFER,pb);k.bufferSubData(k.ARRAY_BUFFER,0,A);ca[2]=g;ca[5]=g;ca[8]=g;
ca[11]=g;var t=~~(ca[9]/32),l=~~(ca[10]/32);e=Math.abs(h-t);f=Math.abs(c-l);e&&--e;f&&--f;d=1;t=t<h?t:h;var p=l<c?l:c;l=[t+p*b];for(var q=0;q<e+1;q++)l[d++]=t+q+p*b,f&&(l[d++]=t+q+(p+f)*b);for(q=1;q<f;q++)l[d++]=t+(p+q)*b,e&&(l[d++]=t+(p+q)*b+e);for(q=1;q<d;q++)e=l[q],Ub=!0,T=function(){T=zb},Oc(2),W(rc,[e,Va.type],G);K.active=!0;K.x=-9999;K.y=-9999;rb.shift&&ph(Va.type);document.removeEventListener("mouseup",v)});document.removeEventListener("mousedown",oh);Ub=!0}else K.active=!0,K.x=-9999,K.y=-9999,
Ub=!0,T=151<d.pageX?0:zb,document.removeEventListener("mousedown",oh)},qj=function(d){var b=E,e=Ia[Va.img];if(Ub)document.removeEventListener("mousemove",qj);else{var c=d.pageX,g=d.pageY;if(c!=kf||g!=lf){var h=!0;kf=c;lf=g;K.active=!0;d=Wb(d.pageX-w.mx-.5*e[8]/ha,d.pageY-.5*e[9]/ha);e=~~(d[1]/32);d=~~(d[0]/32);c=32*d;g=32*e;0==R[d+e*b]&&(h=!1);h?h!=Nc&&(Nc=h,k.bindBuffer(k.ARRAY_BUFFER,pb),k.bufferSubData(k.ARRAY_BUFFER,16*K.bufferID,jf)):h!=Nc&&(Nc=h,k.bindBuffer(k.ARRAY_BUFFER,pb),k.bufferSubData(k.ARRAY_BUFFER,
16*K.bufferID,gj));K.x=c;K.y=g}}},qh=function(d,b){d=0;for(var e=b.length;d<e;d++){var c=y[b[d]];c.xf?c.stop=1:c.stay()}},of=function(d,b){d=y[b[0]];d.techStart=0;d.c=void 0;b=d.techID;d.techID=void 0;if(b){var e=D[d.kingdom].technology.hidden;-1<b&&(e[b]=0);D[d.kingdom].setupResources(C[d.activeTech].cost,-1)}else if(d.lcost)D[d.kingdom].setupResources(d.lcost,-1);else return;Y(d.id)},H=function(d){W(Yg,[d,jb.lastFunc.id],y[G[0]].id)},Yg=function(d,b){var e=d[0];d=d[1];var c=C[e],g=y[b];c.upgrade&&
(d=-1);if(D[g.kingdom].paypal(c.cost))return!1;g.activeTech=e;g.techID=d;g.setupINTV(c.type,[e,d,b],1E3*c.time);g.techStart=g.c-p.cycle;e=D[y[b].kingdom].technology.hidden;-1<d&&(e[d]=1);Y(b)},ba=function(d){var b=d[1],e=y[d[2]];d=C[d[0]];wc(e,d,b)},de=function(d){var b=d[1],e=y[d[2]];d=C[d[0]];var c=u[d.obj],g=D[e.kingdom].mod[c.type];rj(e);e.img=c.img;e.attack=g.attack||c.attack;e.health=e.health/e.maxHealth*c.health;e.maxHealth=c.health;e.__proto__=c;qb(e);wc(e,d,b)},pf=function(d){var b=d[1],
e=y[d[2]];d=C[d[0]];if(d.actvintv)for(var c=d.actvintv,g=0,h=c.length;g<h;g++){var m=c[g];D[e.kingdom].technology.disabled[m.id]=0;for(var t=m.builds,k=Ja[e.kingdom],n=0,l=t.length;n<l;n++)for(var p=k[t[n]],r=0,q=p.length;r<q;r++)m(y[p[r]])}wc(e,d,b)},la=function(d,b){var e=d[1];b=y[d[2]];d=C[d[0]];D[b.kingdom].values[d.value]+=d.increase;"popMax"==d.value&&ce(b.kingdom);wc(b,d,e)},sj=function(d,b){var e=d[1];b=y[d[2]];d=C[d[0]];var c=d.group,g=D[b.kingdom],h=Ja[g.k];g=g.mod;for(var m=0,t=c.length;m<
t;m++)for(var k=g[c[m].type],n=h[c[m].type],l=0,p=d.values,r=p.length;l<r;l+=2){var q=p[l],u=p[l+1];k[q]||(k[q]=c[m][q]||0);for(var x=0,w=n.length;x<w;x++)y[n[x]][q]+=u;k[q]+=u}wc(b,d,e)},Ab=function(d,b){var e=d[1];b=y[d[2]];d=C[d[0]];var c=d.group,g=D[b.kingdom],h=g.mod;g=Ja[g.k];for(var m=0,t=c.length;m<t;m++){var k=h[c[m].type];k[d.value]||(k[d.value]=c[m][d.value]||0);k[d.value]+=d.increase;k=g[c[m].type];for(var n=0,l=k.length;n<l;n++)y[k[n]][d.value]+=d.increase}wc(b,d,e)},qf=function(d,b){var e=
d[1];b=y[d[2]];d=C[d[0]];for(var c=D[b.kingdom].mod,g=d.mulp,h=0,m=d.group.length;h<m;h++){var t=d.group[h],k=c[t.type].cost||t.cost;c[t.type].cost=g?[~~(k[0]*g),~~(k[1]*g),~~(k[2]*g),~~(k[3]*g)]:[k[0]-d.decrease[0],k[1]-d.decrease[1],k[2]-d.decrease[2],k[3]-d.decrease[3]]}wc(b,d,e)},rh=function(d,b){var e=d[1];b=y[d[2]];d=C[d[0]];for(var c=D[b.kingdom].mod,g=0,h=d.decrease,m=h.length;g<m;g+=2){var t=h[g],k=h[g+1],n=c[t.type].cost||t.cost;c[t.type].cost=[n[0]-k[0],n[1]-k[1],n[2]-k[2],n[3]-k[3]]}wc(b,
d,e)},wc=function(d,b,e){d.techStart=void 0;d.activeTech=void 0;d.techID=void 0;d.func=void 0;var c=D[d.kingdom].technology,g=c.disabled;c.investigated[e]=1;qa("techdone",0,0,d.kingdom);if(b=b.next){e=!1;c=0;for(var h=b.length;c<h;c++){var m=b[c].id;g[m]--;ia.actv[m]&&(e=!0)}e&&ia(X.active)}Y(d.id)};"use strict";var hb,Dl={icon:"food",img:"item_meat",url:"meat"},El={icon:"milk",img:"milk",url:"milk"},Fl={icon:"gold",img:"item_gold",url:"gold"},Gl={icon:"stone",img:"item_stone",url:"stone"},tj={icon:"wood",
img:"item_tree",url:"tree"},Hl={icon:"food",img:"item_food",url:"food"},ee=function(d,b,e,c){d=Ja[d];var f=hb[b];b=[];b.length=f.length;for(var h=0,m=f.length;h<m;b[h]=d[f[h++]]);d=Infinity;f=-1;for(h=0;h<b.length;h++){m=b[h];for(var t=m.length,k=0;k<t;k++){var n=y[m[k]];if(!1!==n.built){var l=n.x32,p=n.y32,r=n.space;n=r[r.length-1];r=(r.length-1)/n;n*=.5;r*=.5;l+=n;p+=r;n=.5*(n+r);l=Math.sqrt((l-e)*(l-e)+(p-c)*(p-c))-n;d>=l&&(d=l,f=m[k])}}}return f},ea,Il=function(d){if("string"==typeof d){for(var b=
1,e=0,c=d.length;e<c;e++)b+=b*(d.charCodeAt(e)/65535)*(e+1);d=b+c}var g=4294967295-d,h=4294967295+d;e=0;ea=function(){h+=e;g-=e++;h=36969*(h&65535)+(h>>16)&4294967295;g=18E3*(g&65535)+(g>>16)&4294967295;return((h<<16)+g&4294967295)/4294967295+.5}},pj=function(d,b){d=d.rnd;var e=d[0],c=d[1],g=d[2];e+=g;c-=g;e=36969*(e&65535)+(e>>16)&4294967295;c=18E3*(c&65535)+(c>>16)&4294967295;d[0]=e;d[1]=c;d[2]++;return~~((((e<<16)+c&4294967295)/4294967295+.5)*b)},Oc=function(d){d!=Jl&&(document.body.className=
"ncursor"+d)},Jl=-1,Ad=function(d,b){for(var e=0,c=b.length;e<c;e++){var g=y[b[e]];ta(d,g,fe,g.url.move)}};Ad.spLevel=function(d){var b=0;2<Sa[d]&&(b=Sa[d]);return b};var fe=function(d,b){b.stay55();if(b.inventory&&b.invMax===b.inventory.length||!d.item)return 1;Sa[d.x32+d.y32*E]=d.radix;ib(d,NaN);if(b.peon&&d.contain){var e=d.contain[1],c=d.contain[0];b.stock&&uj(b);var g=vj(b.x32,b.y32)||!1,h=d.contain[2];d.die(1);b.stock=[c,e,g,fe.url,h];d=ee(b.kingdom,e,b.x32,b.y32);ta(d,b,xc,b.url[h.url]);Y(b.id);
return 1}b.addItem(d);Y(b.id)},uj=function(d){var b=wj(d.x32,d.y32),e=~~(b/E);b%=E;b=new ad(52,d.kingdom,b,e,0);aa(b,l[d.stock[4].img]);b.contain=[d.stock[0],2,d.stock[4]]},xj=function(d,b){d=0;for(var e=b.length;d<e;d++){var c=y[b[d]];c.xf?c.stop=2:(c.stop=2,c.stay(),c.stop=void 0)}},Bd=function(d,b){var e=E;d=y[d];for(var c=0,g=b.length;c<g;c++){var h=y[b[c]],m=bb[h.zLevel],t=h.x32+h.y32*e;if(0!==m[t]||!d.build){t=d.build?sh(h,h.x32,h.y32):sh(h,d.x32,d.y32);if(!1===t)continue;h.x32=t%E;h.y32=~~(t/
E)}h.item&&(d.attack-=h.attack||0,d.defence-=h.defence||0);h.url.idle&&aa(h,h.url.idle,1);m[t]=h.id;h.in=0;d.inventory.quit(h.id);m=1;h.z32&&(m=h.z32);ib(h,32*h.y32*m)}Y(d.id,1)},ge=function(d,b){d=y[d];if(1===d.invType)for(var e=0,c=b.length;e<c;e++){var g=y[b[e]];g!=d&&ta(d.id,g,th,g.url.move)}},th=function(d,b){var e=d.inventory;if(e.length<d.invMax){var c=b.x32,g=b.y32;b.stay55();b.rbase()[c+g*E]=b.radix;e.put(b.id);ib(b,NaN);b.in=d.id;he(b.id);Y(d.id)}else b.stay55()},tc=function(d,b){for(var e=
b.length,c=0;c<e;c++){var g=y[b[c]];g.buildList=!1;ta(d,g,cd,g.url.move)}},cd=function(d,b){if(d.dummy&&d.dummy.built)return b.stay55();if(d.health<d.maxHealth)b.dix=0,b.diy=0,b.mv=!0,b.setupDirBuild(d),aa(b,b.url.build,1),b.setupINTV(mf,{u:d.id,a:b.id},ub(b.img)),Xd(b,"hit%20",7,b.img);else{if(b.buildList&&(d=nf(b.buildList,b.x32,b.y32)))return ta(d,b,cd,b.url.move),0;b.stay55()}},rf=function(d,b){return b[d]&&13==y[b[d]].type||13==y[R[d]].type?!0:!1},mf=function(d){var b=y[d.u];d=y[d.a];var e=d.x32,
c=d.y32,g=b.x32+b.y32*E;if(b.death)return d.stay();var h=b.maxHealth,m=h/b.time*D[d.kingdom].values.buildSpeed;if(1===b.health){for(var t=b.validator(b.x32,b.y32,b.space,b.kingdom)[0],k=b.id,n=b.validator.dimension,B=0,p=t.length;B<p;B++)if(2<n[t[B]]){Pb(d,ub(d.img));return}var r=Aa[b.kingdom];B=0;for(p=t.length;B<p;B++)n[t[B]]=k,r[t[B]]=void 0;Ja[b.kingdom][b.type].put(b.id);yc(b)}b.health+=m;m=b.health;0==b.built&&(r=~~(4*m/h),r>b.d&&(b.d=r,aa(b,b.img)));if(m>=h){m=b.health=h;Y(b.id);if(!1===b.built){b.d=
0;t=b.url;r=Aa[b.kingdom];13===b.type&&(rf(g-1,r)&&rf(g+1,r)?(t=l.wood_horz,b.child=void 0):rf(g+E,r)&&rf(g-E,r)&&(t=l.wood_vert,b.child=void 0));b.built=1;b.img=t;qb(b);if(b.valid2)for(t=b.validator(b.x32,b.y32,b.space,b.kingdom)[2],n=b.validator.dimension,B=0,p=t.length;B<p;n[t[B++]]=0);yj(b);qa("bldgdone",0,0,b.kingdom);D[b.kingdom].building.quit(b.id);Y(b.id);b.standardFunc&&b.standardFunc(b)}b.action=void 0;(g=d.buildList)&&g.quit(b.id);if(!g||d.buildList&&0===d.buildList.length)d.buildList=
zj(d),g=d.buildList;if(e=nf(g,e,c))return ta(e,d,cd,d.url.move),0;d.buildList.length=0;d.stay();d.stock&&d.stock[0]&&aa(d,d.url[d.stock[4].url])}else Y(b.id),Pb(d,ub(d.img));G[0]==b&&(Pc.innerHTML=m+"/"+h,Ma.value=m)},sf=function(d,b){if(2<d)for(var e=0,c=b.length;e<c;e++){var g=y[b[e]];ta(d,g,bd,g.url.move)}},sc=function(d,b){var e=d;d=y[d];if(d.field)for(c=0,d=b.length;c<d;c++)g=y[b[c]],ta(e,g,bd,g.url.move);else if(0===d.res||3===d.res){var c=0;for(d=b.length;c<d;c++){var g=y[b[c]];ta(e,g,tf,g.url.move)}}else if(1===
d.res)for(c=0,d=b.length;c<d;c++)g=y[b[c]],ta(e,g,dd,g.url.move);else if(2===d.res)for(c=0,d=b.length;c<d;c++)g=y[b[c]],ta(e,g,Kc,g.url.move)},uc=function(d,b,e,c){e=c||ie;if(!(3>d||(d=y[d],void 0!=d.res||d.magicGateway))){c=0;for(var f=b.length;c<f;c++){var h=y[b[c]];h==d||h.attackOnly&&!h.attackOnly[d.type]||h.bat&&d.build||d.stoned||(h.build?e(d,h):ta(d.id,h,e,h.url.move))}}},dd=function(d,b){if(0<d.health){var e=b.x32,c=b.y32;b.mv=!0;b.setupDir(d.x32-e,d.y32-c);aa(b,b.url.cut,1);b.dix=0;b.diy=
0;Xd(b,"chop%20",11,b.img);b.setupINTV(Aj,{u:d.id,a:b.id},7E3);d.addWorker(b)}else b.stay55()},Aj=function(d){var b=E,e=y[d.u];d=y[d.a];var c=D[d.kingdom].values.wood;e.workers.quit(d.id);var g=ee(d.kingdom,1,d.x32,d.y32),h=y[g];e.health-=c;d.mv=!1;Y(e.id);if(1>e.health){c+=e.health;R[e.x32+e.y32*b]=0;b=Ca(h.x32,h.y32);h=e.health=0;for(var m=e.workers.slice(0),t=m.length;h<t;h++){var k=y[m[h]];b?ta(b,k,dd,d.url.move):k.stay()}d.stock=[c,1,b,dd.url,tj];d.mv=!1;ta(g,d,xc,d.url.tree);Y(d.id,1);e.workers.length=
0;e.die()}else d.stock=[c,1,e.id,dd.url,tj],ta(g,d,xc,d.url.tree),Y(d.id,1);if(0>g)return d.stay()},bd=function(d,b){b.mv=!0;b.setupDir(d.x32-b.x32,d.y32-b.y32);aa(b,b.url.dig,1);Xd(b,"dig%20",3,b.img);b.setupINTV(Bj,{u:d.id,a:b.id},14E3);d.addWorker(b)},Bj=function(d){var b=y[d.u];d=y[d.a];var e=D[d.kingdom].values.food,c=d.x32,g=d.y32;b.lastUse=p.cycle;c=ee(d.kingdom,2,c,g);d.mv=!1;d.stock=[e,2,b.id,bd.url,Hl];ta(c,d,xc,d.url.food);Y(d.id,1);if(0>c)return d.stay()},Kc=function(d,b){b.mv=!0;b.setupDir(d.x32-
b.x32,d.y32-b.y32);aa(b,b.url.milk1,1);b.stock=[0,2,d.id,Kc.url,El];b.setupINTV(uh,{u:d.id,a:b.id},1E3);d.addWorker(b);d.d=(8-b.d)%8;d.stay()},uh=function(d){var b=y[d.u];d=y[d.a];b.milk-=3;var e=d.x32,c=d.y32;d.stock[0]+=3;Y(d.id,1);if(0>=b.milk||b.death){if(50<d.stock[0]&&(d.stock[0]=50),d.mv=!1,b=ee(d.kingdom,2,e,c),ta(b,d,xc,d.url.milk),0>b)return d.stay()}else Pb(d,1E3)},Yd=function(d,b){b.stay55()},yd=function(d,b){ie(d,b)},ie=function(d,b){if(1!==d.death&&d!=b){if(d.dummy&&!D[b.kingdom].values.experience)return b.stay55();
b.invisible&&Cd(b.id);if(!0!==b.build){b.mv=1;var e=d.x32-b.x32,c=d.y32-b.y32;d.space&&(c=eh(d,b.x32,b.y32),e=c%E-b.x32,c=~~(c/E)-b.y32);b.setupDir(e,c,b.d2attack);b.url.attack&&aa(b,b.url.attack,1)}b.setupINTV(vh,{u:d.id,a:b.id},b.attackTime||ub(b.img),d);d.addWorker(b)}else b.stay55()};ie.distance=-1;yd.distance=-1;var wh=function(d,b){var e=D[d.kingdom];if(e.values.experience&&(!b||0!=e.diplomacy[b.kingdom]||b.dummy)){if(0==d.level||null==d.level)d.level=0,d.levelProgress=0;d.levelProgress++;d.levelProgress>=
~~(d.level/e.values.experience)&&d.level<e.values.maxLevel&&(d.level++,d.health+=e.values.healthJump,d.maxHealth+=e.values.healthJump,d.levelProgress=0,d.attack+=d.level,d.defence+=d.level%2,Y(d.id,1))}},nj=function(d){var b=d.level;d.attack+=b;d.defence+=~~(.5*b)},vh=function(d){var b=y[d.u];d=y[d.a];var e=d.attDist,c=b.x32-d.x32,g=b.y32-d.y32,h=b.x32,m=b.y32,t=!d.build;if(d.attackSound){var k=d.attackSound;qa(k[~~(k.length*Math.random())],d.x32,d.y32)}t&&!b.build&&d.setupDir(c,g,d.d2attack);aa(d,
d.img,1);if(b.death||d.level&&8<=d.level&&b.dummy||b.dummy&&d.level&&d.level>=D[d.kingdom].values.maxLevel)return d.stay();if(1<e&&!d.dragon){t=!0;var n=Ia[d.attimg]}else t=!1;if(b.build||$d(b.x32,b.y32,d.x32,d.y32,e)){b.onattack(d);e=d.attack*((xd[d.type][b.type]||0)+1);if(t){b.space&&(c=eh(b,d.x32,d.y32),h=c%E,m=~~(c/E),c=h-d.x32,g=m-d.y32);t=0;if(d.arrow||d.ball){k=Cj;var l=fh(-c,-g);var F=c;var r=g;var q=411/Math.sqrt(F*F+r*r);F*=q;r*=q;var u=Math.sqrt(1024*c*c+g*g*1024)/Math.sqrt(F*F+r*r);d.ball&&
(n[1]=n[0]/u)}else{var x=2;k=uf;t=F=p.gravity;l=Math.PI/180*60;q=Math.cos(l);l=d.attackDeg;l*=Math.PI/180;r=Math.sin(l);u=Math.cos(l);l=32*Math.sqrt(c*c+g*g);F=u*Math.sqrt(F*l/(r*u*2));u=l/F;r=-Math.sin(Math.atan2(-c,-g));l=fh(-c,-g);F*=r;t=Math.abs(t*q*r);r=(32*g-t*u*u*.5)/u}u=Math.round(1E3*u);q={x32:d.x32+.5,y32:d.y32+.5,img:n.url,mv:d.ball,d:0,rotation:-l+1.5,xf:h,yf:m,obj:b.id,attack:e,range:x};qb(q);Mc(q,F,r,t);gb({func:k,data:q},u,1)}q||b.damage(e,d);if(b.dummy){if(50<=d.dummyDamage||!d.dummyDamage)d.dummyDamage=
0;d.dummyDamage+=e;50<=d.dummyDamage&&wh(d,b)}b.death?(d.action=null,b.build||d.build||wh(d,b),Kd(d)||d.stay()):Pb(d,d.attackTime||ub(d.img))}else d.build&&(Kd(d)||d.stay()),d.mv=!1,0!==d.state&&ta(b.id,d,ie,d.url.move)},tf=function(d,b){0<d.health?(b.dix=0,b.diy=0,b.mv=1,b.setupDirBuild(d),aa(b,b.url.kirka,1),Xd(b,"mine%20",3,b.img),b.setupINTV(Dj,{u:d.id,a:b.id},7E3),d.addWorker(b)):b.stay()},Dj=function(d){var b=y[d.u];d=y[d.a];var e=b.res,c=D[d.kingdom].values[0==e?"gold":"stone"],g=d.x32,h=d.y32;
b.health-=c/D[d.kingdom].values.miningPerf;Y(b.id);1>b.health&&(c=b.health+c,b.health=0,b.d=3,b.die());d.mv=!1;g=ee(d.kingdom,e,g,h);0==e?(d.stock=[c,e,b.id,tf.url,Fl],ta(g,d,xc,d.url.gold)):(d.stock=[c,e,b.id,tf.url,Gl],ta(g,d,xc,d.url.stone));Y(d.id,1);if(0>g)return d.stay()},ta=function(d,b,e,c){b.cow&&b.workers.length||(b.action=e.url,b.distance=0,b.nodes=void 0,0<d?(b.xf=d,b.yf=!0):(d*=-1,b.xf=d%E,b.yf=~~(d/E)),b.func!=Zd.url&&(c==b.url.move?ch(b):b.mimg=c,b.dix=0,b.diy=0,b.mv=!0,b.setupINTV(Zd,
b.id,0)))},wf=function(d,b){O(d);vf(b,d,Ej)};wf.allowPos=1;var Ej=function(d,b){O(d);Bd(b.id,b.inventory.slice(0));b.stay55()},eh=function(d,b,e){var c=d.space||zl,g=c.length-1,h=c[g],m=d.x32;d=d.y32-1;for(var t=Infinity,k=0,n=0;n<g;n++){var l=n%h;l||d++;var p=(m+l-b)*(m+l-b)+(d-e)*(d-e);p<t&&c[n]&&(k=m+l+d*E,t=p)}return k},sh=function(d,b,e){var c=E,g=d.radix,h=bb[d.zLevel];for(d=2;60>=d;d+=2){b--;e--;for(var m=0;m<=d;){var t=b+m+c*e;if(h[t]===g)return t;t=b+m+c*(e+d);if(h[t]===g)return t;m++}for(m=
0;m<d-1;){m++;t=b+c*(e+m);if(h[t]===g)return t;t=b+d+c*(e+m);if(h[t]===g)return t}}return!1},wj=function(d,b){var e=E,c,g=Sa;for(c=2;60>=c;c+=2){d--;b--;for(var h=0;h<=c;){var m=d+h+e*b;if(0===g[m]&&0===R[m])return m;m=d+h+e*(b+c);if(0===g[m]&&0===R[m])return m;h++}for(h=0;h<c-1;){h++;m=d+e*(b+h);if(0===g[m]&&0===R[m])return m;m=d+c+e*(b+h);if(0===g[m]&&0===R[m])return m}}return!1},Lc=function(d,b,e,c){var f=b.x32,h=b.y32,m=E,t=f+h*m,k=d.x32,n=d.y32,l=d.space;if(l){var p=l[l.length-1];l=(l.length-
1)/p;d=d.free}else l=p=1,d=dj;b=b.rbase();for(var r,q=Infinity,u=-1,x=!1,w=0;w<e&&-1==u;){if(0==w&&d){for(var A=[],y=0,z=d.length;y<z;y+=2){var C=d[y]+k;r=d[y+1]+n;if(ka(C,r)&&(b[C+r*m]===c||C+r*m==t))a:{var D=A;C+=r*m;r=f;for(var G=h,H=E,J=Math.pow(C%H-r,2)+Math.pow(~~(C/H)-G,2),K=0,L=D.length;K<L;K++)if(Math.pow(D[K]%H-r,2)+Math.pow(~~(D[K]/H)-G,2)>J){D.splice(K,0,C);break a}D.put(C)}}A[0]&&(u=A[0]);if(-1<u){x=!0;break}if(1==e)break}w++;--k;--n;A=p+2*w;D=l+2*w;y=0;for(z=A*D;y<z;y++)r=y%A,G=~~(y/
A),r&&G&&r!=A-1&&G!=D-1||(r+=k,G+=n,C=r+G*m,b[C]==c&&ka(r,G)&&(r=(r-f)*(r-f)+(G-h)*(G-h),q>r&&(q=r,u=C)))}return-1<u?[u%m,~~(u/m),x]:!1},oj=function(d,b,e,c,g){performance.now();var f=E,m=d.x32,t=d.y32,k=d.space,n=[],l=0;if(k){var p=k[k.length-1];k=(k.length-1)/p;var r=d.free}else k=p=1;d=-1==b?-Infinity:Infinity;for(var q=-1,u=0,x=0;0==n.length;){if(r&&0==x){for(var w=0,A=r.length;w<A;w+=2){var y=r[w]+m,z=r[w+1]+t;ka(y,z)&&g[y+z*f]===c&&(n[l++]=y+z*f,u=(y-b)*(y-b)+(z-e)*(z-e),d>u&&(d=u,q=y+z*f))}if(n.length)break}x++;
--m;--t;for(w=0;w<p+2*x;w++)g[m+t*f+w]==c&&ka(m+w,t)&&(n[l++]=m+w+t*f,u=(m+w-b)*(m+w-b)+(t-e)*(t-e),d>u&&(d=u,q=m+w+t*f)),g[m+(t+k+2*x-1)*f+w]==c&&ka(m+w,t+k+2*x-1)&&(n[l++]=m+(t+k+2*x-1)*f+w,u=(m+w-b)*(m+w-b)+(t+k+2*x-1-e)*(t+k+2*x-1-e),d>u&&(d=u,q=m+(t+k+2*x-1)*f+w));for(w=1;w<k+2*x-1;w++)g[m+(t+w)*f]==c&&ka(m,t+w)&&(n[l++]=m+(t+w)*f,u=(m-b)*(m-b)+(t+w-e)*(t+w-e),d>u&&(d=u,q=m+(t+w)*f)),g[m+p+2*x-1+(t+w)*f]==c&&ka(m+p+2*x-1,t+w)&&(n[l++]=m+p+2*x-1+(t+w)*f,d>u&&(d=u,q=m+p+2*x-1+(t+w)*f))}return[q,
n]},dj=[-1,0,-1,-1,0,-1,1,-1,1,0,1,1,0,1,-1,1],nf=function(d,b,e){for(var c=Infinity,g=!1,h=0,m=d.length;h<m;h++){var t=d[h],k=y[d[h]];if(0!=k.built||k.death)h--,m--,d.quit(t);else{var n=k.x32;k=k.y32;k=(n-b)*(n-b)+(k-e)*(k-e);c>=k&&(c=k,g=t)}}return g},Fj=function(d){for(var b=0,e=d.length;b<e;b++){var c=y[d[b]];c.spd=c.__proto__.spd}},ah=function(d){for(var b=Infinity,e=0,c=d.length;e<c;e++){var g=y[d[e]];g.spd<b&&(b=g.spd)}xh(b,d)},vj=function(d,b){for(var e=E,c,g=Infinity,h=0,m=0;121>m;m++){var k=
m%11-5,l=~~(m/11)-5,n=k*k+l*l;k+=d;l+=b;n<g&&(c=Sa[k+e*l],0<c&&0==R[k+e*l]&&(c=y[c],c.contain&&(g=n,h=c.id)))}return h},yh=function(d,b){vf(b,d,xc)},xc=function(d,b){d=D[b.kingdom];var e=b.stock;d.resources[e[1]]+=e[0];d.stats.resources[e[1]]+=e[0];xf(b.kingdom);b.func=1;var c=Qb[e[3]],g=y[e[2]];if(c==Kc){var h=E;for(var m,k=Infinity,l=!1,n=0;961>n;n++){var B=n%31-15,p=~~(n/31)-15,r=B*B+p*p;B+=b.x32;p+=b.y32;r<k&&(m=Sa[B+h*p],0<m&&0===R[B+h*p]&&(m=y[m],m.contain&&"meat"==m.contain[2].url&&(k=r,l=
m)))}if(h=l)c=fe,g=h}else"meat"==e[4].url&&!1===e[2]&&(h=zh(b.x32,b.y32,!0))&&(c=Kc,g=h,e[2]=1);b.stock=void 0;if(!1===e[2])return b.stay();if(h=100<Math.pow(g.x32-b.x32,2)+Math.pow(g.y32-b.y32,2))a:{h=hb[1];k=Ja[b.kingdom];l=0;for(n=h.length;l<n;l++)if(r=h[l],1==u[r].storage&&k[r].length){h=!0;break a}h=!1}if(h&&void 0!==d.IAD&&1==e[1])return Yi(b);ta(g.id,b,c,b.url.move);Y(b.id,1)};sc.cursor=6;uc.cursor=1;tc.cursor=9;Ad.cursor=5;ge.cursor=7;wf.cursor=7;sf.cursor=6;yh.cursor=6;var zj=function(d){var b=
E,e=d.kingdom,c=d.x32,g=d.y32;c-=16;g-=16;for(var h={},m=[],k=0,l=Aa[e],n=0;1024>n;n++){d=n%32+c;var B=~~(n/32)+g;ka(d,B)&&(d=l[d+B*b],void 0!==d&&(d=y[d],d.kingdom!=e||!1!==d.built||h[d.id]||(m[k++]=d.id,h[d.id]=1)))}return m};dd.available=function(d,b){var e=D[d.kingdom].values.wood;if(b.death||1>b.health-e&&b.workers.length)b=Ca(b.x32,b.y32),d.xf=b,b=y[b];return Lc(b,d,1,d.radix)};bd.available=function(d,b){if(b.death)return"kill";d=b.x32+1;b=b.y32+1;return 0===R[d+b*E]?[d,b,1]:!1};cd.available=
function(d,b){var e=d.x32,c=d.y32;if(!b.death&&b.health<b.maxHealth){var g=Lc(b,d,1,d.radix);if(g[2])return g}d.buildList?(g=d.buildList,g.quit(b.id)):(d.buildList=zj(d),g=d.buildList);b=nf(g,e,c);if(!b)return"kill";d.xf=b;b=y[b];return Lc(b,d,1,d.radix)};Yd.rev=function(d){return 0===d.distance%3&&(d=bh(d.id,1))?[yd.url,d]:!1};yd.available=function(d,b){if(0===d.distance%3){var e=bh(d.id);e&&(d.xf=e,b=y[e])}return Lc(b,d,5,d.radix)};fe.available=function(d,b){if(b.death||b.in)if(b.contain)if(b=vj(b.x32,
b.y32))d.xf=b,b=y[b];else return(b=zh(d.x32,d.y32,!0))?(d.stay(),ta(b.id,d,Kc,d.url.move),55):"kill";else return"kill";d=b.x32;b=b.y32;return 0===R[d+b*E]?[d,b,1]:!1};Kc.available=function(d,b){if(b.workers.length||10>b.milk||b.death){b=zh(d.x32,d.y32);if(!b)return!1;d.xf=b.id}return b.xf?!1:Lc(b,d,5,d.radix)};th.available=function(d,b){if(b.death)return"kill";var e=1;b.boat&&(e=2);return(d=Lc(b,d,e,d.radix))?(d[2]=1,d):!1};var zh=function(d,b,e){for(var c=E,g,h=Infinity,m=!1,k=0;441>k;k++){g=k%21-
10;var l=~~(k/21)-10,n=g*g+l*l;g+=d;l+=b;n<h&&(g=R[g+c*l],0<g&&(g=y[g],g.cow&&(!g.workers.length&&g.milk>=50/1.5||e)&&(h=n,m=g)))}return m},vf=function(d,b,e){for(var c=0,g=d.length;c<g;c++){var h=y[d[c]];ta(b,h,e,h.url.move)}},zf=function(d,b){Wa(b,d,yf)};zf.noObj=1;var yf=function(d,b){je(b,-d,77,yf)},Bf=function(d,b){Wa(b,d,Af)};Bf.noObj=1;var Af=function(d,b){je(b,-d,130,Af)},Df=function(d,b){Wa(b,d,Cf)};Df.noObj=1;var Cf=function(d,b){je(b,-d,78,Cf)},Ff=function(d,b){Wa(b,d,Ef)};Ff.noObj=1;Ff.cursor=
10;var Ef=function(d,b){je(b,-d,132,Ef)},Hf=function(d,b){Wa(b,d,Gf)};Hf.cursor=10;Hf.noObj=1;var Gf=function(d,b){je(b,-d,131,Gf)},je=function(d,b,e,c){var f=E,h=D[d.kingdom],m=u[e],k=u[e].cost,l=d.mana>d.manaMax;if(cb(d)||d.checkMana(k[4],b,c,k)){l||h.paypal(k);c=e;b*=-1;l=b%f;var n=~~(b/f),B=l,p=n,r=bb[m.zLevel],q=~~(d.mana/k[4])+1;1<q&&(h.resources[0]-=k[0]*(q-1),d.mana-=k[4]*(q-1));for(h=0;h<q;h++)0!==r[b]&&(e=sh(m,l,n),B=e%f,p=~~(e/f)),qa("summon"+~~(10*Math.random()+1),B,p),e=new ad(c,d.kingdom,
B,p,0),e.setupChild(sb.spawn);d.setupDir(-d.x32+e.x32,-d.y32+e.y32);d.setupSpellIMG()}else h.paypal(k);Y(d.id)},$d=function(d,b,e,c,g){return~~Math.sqrt((d-e)*(d-e)+(b-c)*(b-c))<=g},Ah=function(d,b){Wa(b,d,If)};Ah.cursor=0;var If=function(d,b){d.build||d.terrain||d.nofreeze||!cb(b)&&!b.checkMana(50,d.id,If)||(d.freezed=1,d.stoned=1,ib(d,32*d.y32),d.stay(),aa(d,d.img,0),d.setupChild(sb.turnStone),Dd(d,ij),he(d.id),b.setupDir(-b.x32+d.x32,-b.y32+d.y32),b.setupSpellIMG(),qa("turn%20to%20stone",b.x32,
b.y32),gb({func:Gj,data:d.id},24E4,1))},Gj=function(d){d=y[d];d.freezed=0;yc(d);d.stoned=0},Bh=function(d,b){Wa(b,d,ke)},ke=function(d,b){d.health<d.maxHealth&&!d.build?(b.setupDir(d.x32-b.x32,d.y32-b.y32),O("heal",ub(b.img)),b.setupSpellIMG(!0),b.setupINTV(Hj,{u:d.id,a:b.id},0),d.addWorker(b)):b.stay()},Jj=function(){Wa(list,obj,Ij)},Ij=function(){},Hj=function(d){var b=y[d.a];d=y[d.u];var e=D[b.kingdom].values.healingRange;qa("heal",b.x32,b.y32);if(!$d(d.x32,d.y32,b.x32,b.y32,e))return ta(d.id,
b,ke,b.url.move);if(cb(b)||b.checkMana(4,d.id,ke)){b.setupDir(d.x32-b.x32,d.y32-b.y32);d.health+=6;d.setupChild(sb.heal);if(d.health>=d.maxHealth)return d.health=d.maxHealth,Y(d.id,1),Y(b.id,1),b.stay();Y(d.id,1);Y(b.id,1);Pb(b,ub(b.url.spell))}},Kf=function(d,b){Wa(b,d,Jf)};Kf.cursor=10;var Kj=function(d,b){d=y[d];b=y[b];if(d.inventory.quit(b.id)){b=c[b.spell];d.icons==d.__proto__.icons&&(d.icons=d.icons.slice(0));d.icons.put(b);var e=d.icons;e.olegal||(e.olegal={});e.olegal[b.id]=1;Y(d.id)}},le=
function(d,b){var e=b[1];b=y[b[0]];y[d].nopotion||y[d].build||(ta(d,b,Lj,b.url.move),b.actionItem=e)};le.item=1;var Lj=function(d,b){var e=y[b.actionItem];b.actionItem=void 0;e.attack&&(d.attack+=e.attack);e.defence&&(d.defence+=e.defence);e.mana&&(d.mana||(d.mana=0,d.manaMax=0,d.update?d.update.push("mana","manaSpeed",1E3):d.update=["mana","manaSpeed",1E3],gb({func:ff,data:[d.id,"mana","manaSpeed",1E3]},1E3,1)),d.manaMax+=e.mana,d.mana+=e.mana);e.level&&(d.level||(d.level=0),d.level+=e.level,d.attack+=
e.level,d.defence+=~~e.level);qa("bless",d.x32,d.y32);b.inventory.quit(e.id);b.stay55();Y(b.id)};le.cursor=10;Bh.cursor=10;zf.cursor=10;Bf.cursor=10;Df.cursor=10;var Dh=function(d,b){Wa(b,d,Ch)};Dh.cursor=1;var Ch=function(d,b){if(d.isSpy&&d==b)b.stay55();else if(cb(b)||b.checkMana(90,d.id,Ch))b.setupDir(-b.x32+d.x32,-b.y32+d.y32),aa(b,b.url.attack,1),gb({func:Mj,data:[d,b]},ub(b.img)-25,1)},Mj=function(d){var b=d[1];d=d[0];d.die(1);var e=d.getRadix();e[b.x32+b.y32*E]=b.radix;b.x32=d.x32;b.y32=d.y32;
b.d=d.d;b.name=b.name;b.attack=d.attack;b.defence=d.defence;b.update=b.update;b.mana=0;b.manaMax=b.manaMax;e[b.x32+b.y32*E]=b.id;ib(b,32*b.y32);b.__proto__=d.__proto__;aa(b,b.url.idle);e=d.icons.slice(0);e.quit(c.menuBuilds);e.quit(c.menuBuilds1);e.quit(c.menuBuilds2);e.put(c.impersonate);e.put(c.revealSelf);b.icons=e;b.spy||(b.spy=b.kingdom);b.kingdom!==d.kingdom&&b.changeKingdom(d.kingdom);b.setupChild(sb.impersonate);Y(b.id)},Nj=function(d){d=y[d];if(d.spy){var b=u[2];d.attack=b.attack;d.defence=
b.defence;d.__proto__=b;d.icons=b.icons;d.kingdom!==d.spy?d.changeKingdom(d.spy):d.stay();aa(d,d.url.idle);Y(d.id);d.spy=void 0}};Kf.allowPos=1;var Jf=function(d,b){if(d.id){var e=d.id,c=d.x32;d=d.y32}else e=-d,c=d%E,d=~~(d/E);if(cb(b)||b.checkMana(60,e,Jf)){b.setupDir(-b.x32+c,-b.y32+d);b.setupSpellIMG();e=8;c-=.5*e;d-=.5*e;var g=[];e+=1;var h=e*e;qa("bless",b.x32,b.y32);for(b=0;b<h;b++)for(var m=1;3>m;m++){var k=y[bb[m][b%e+c+(~~(b/e)+d)*E]];k.build||k.terrain||(k.setupChild(sb.bless),k.blessed||
(k.blessed=1,k.attack+=5,Y(k.id,1),g.put(k)))}gb({func:Oj,data:g},3E4,1)}},Wa=function(d,b,e){if(d[1]&&y[d[1]].item){var c=d[1];d.length--;vf(d,b,e);y[d[0]].actionItem=c}else vf(d,b,e)},cb=function(d){var b=d.actionItem;if(!b)return!1;b=y[b];b.attack&&(b.attack--,0===b.attack&&(d.inventory.quit(b.id),Y(d.id)));return!0},Oj=function(d){for(var b=0,e=d.length;b<e;b++){var c=d[b];c.blessed=void 0;c.attack-=5;Y(c.id,1)}},Mf=function(d,b){Wa(b,d,Lf)};Mf.cursor=10;var Lf=function(d,b){d.freezed||!cb(b)&&
!b.checkMana(50,d.id,Lf)?b.stay55():(b.setupDir(-b.x32+d.x32,-b.y32+d.y32),b.setupSpellIMG(),qa("invisible",d.x32,d.y32),d.invisible||(Dd(d,kh),d.invisible=1,d.stay()),Y(d.id),gb({func:Cd,data:d.id},5E4,1))},Cd=function(d){d=y[d];d.death||(d.invisible=void 0,yc(d))},Eh=function(d,b){Wa(b,d,Nf)};Eh.cursor=0;var Nf=function(d,b){if(cb(b)||b.checkMana(50,d.id,Nf))b.setupDir(-b.x32+d.x32,-b.y32+d.y32),b.setupSpellIMG(),qa("lightning",b.x32,b.y32),d.damage(50,b)},Pf=function(d,b){Wa(b,d,Of)};Pf.cursor=
0;Pf.noObj=1;var Of=function(d,b){var e=E;if(d.id){var c=d.id,g=d.x32;d=d.y32}else c=-d,g=d%e,d=~~(d/e);if(cb(b)||b.checkMana(50,c,Of)){b.setupDir(-b.x32+g,-b.y32+d);b.setupSpellIMG();qa("flame%20ball",g,d);c=g-b.x32;g=d-b.y32;d=Math.sqrt(c*c+g*g);c/=d;g/=d;for(var h=b.x32+.5,m=b.y32+.5,k=[],l=[],n=0,B,p,r=0;r<d;r++)B=h+c*r,p=m+g*r,l.put(B),l.put(p),B=~~B,p=~~p,k[n++]=B+p*e,k[n++]=~~(B+g)+~~(p+c)*e,k[n++]=~~(B-g)+~~(p-c)*e;for(r=0;r<0*k.length;r++)zd(k[r]%e,~~(k[r]/e),"food");gb({func:Fh,data:{list:k,
anim:l,i:2,a:b}},1E3,1)}},Gh=function(d,b){Wa(b,d,me)};Gh.cursor=10;var me=function(d,b){b.setupDir(-b.x32+d.x32,-b.y32+d.y32);b.setupSpellIMG(!0);b.setupINTV(Kl,{u:d.id,a:b.id},0);d.addWorker(b)},Kl=function(d){var b=y[d.a];d=y[d.u];if(!$d(d.x32,d.y32,b.x32,b.y32,D[b.kingdom].values.teachDistance))return ta(d.id,b,me,b.url.move);if(d.level>=b.level)return b.stay();if(cb(b)||b.checkMana(10,d.id,me))qa("teach",b.x32,b.y32),b.setupDir(d.x32-b.x32,d.y32-b.y32),d.setupChild(sb.curse,!1,Bl),wh(d,!1),Y(d.id,
1),Y(b.id,1),Pb(b,ub(b.url.spell))},Rf=function(d,b){Wa(b,d,Qf)};Rf.cursor=0;Rf.noObj=1;var Qf=function(d,b){var e=E;if(d.id){var c=d.id,g=d.x32;d=d.y32}else c=-d,g=d%e,d=~~(d/e);if(cb(b)||b.checkMana(70,c,Qf)){b.setupDir(-b.x32+g,-b.y32+d);b.setupSpellIMG();c=g;var h=d;g-=8;d-=8;for(var m=0;256>m;m++){var k=g+m%16,l=~~(m/16)+d,n=k+l*e;ka(k,l)&&64>=Math.pow(k-c,2)+Math.pow(l-h,2)&&Sf[n]&&0===R[n]&&(O(k,l),new ad(60,b.kingdom,k,l,0))}}},Fh=function(d){var b=d.list,e=d.anim,c=d.i,g=d.a,h={x32:e[2*c],
y32:e[2*c+1],d:0,img:l.flame_trail,mv:1,z32:2,alpha:!0};qb(h);Vb.new(h,ub(h.img));for(h=0;3>h;h++){var m=y[R[b[h+3*c]]];m.health&&m.damage(96,g)}d.i++;d.i<.5*e.length&&gb({func:Fh,data:d},50,1)},Uf=function(d,b){Wa(b,d,Tf)};Uf.cursor=0;Uf.noObj=1;var Tf=function(d,b){if(d.id){var e=d.id,c=d.x32;d=d.y32}else e=-d,c=d%E,d=~~(d/E);if(cb(b)||b.checkMana(60,e,Tf))b.setupDir(-b.x32+c,-b.y32+d),b.setupSpellIMG(),qa("freeze",c,d),gb({func:Pj,data:[c,d]},1E3,1)},Wf=function(d,b){Wa(b,d,Vf)};Wf.cursor=0;Wf.noObj=
1;var Vf=function(d,b){if(d.id){var e=d.id,c=d.x32;d=d.y32}else e=-d,c=d%E,d=~~(d/E);if(cb(b)||b.checkMana(70,e,Vf)){b.setupDir(-b.x32+c,-b.y32+d);b.setupSpellIMG();qa("confusion",c,d);b=4;c-=.5*b;d-=.5*b;e=E;var g=[];b+=1;for(var h=b*b,m=0;m<h;m++)for(var k=1;3>k;k++){var l=y[bb[k][m%b+c+(~~(m/b)+d)*e]];l.build||l.terrain||l.stoned||(l.confused=1,l.invisible&&Cd(l),Dd(l,jj),l.stay(),g.put(l),he(l.id))}h&&1===G.length&&Y(G[0]);g.length&&gb({func:Qj,data:g},2E4,1)}},Qj=function(d){for(var b=0,e=d.length;b<
e;b++){var c=d[b];c.confused=void 0;c.death||(aa(c,c.img,1),yc(c),c.stay(),Na==c&&(Na=void 0,G[0]=c.id,Y(c.id)))}},Pj=function(d){var b=6,e=d[0]-.5*b,c=d[1]-.5*b,g=E,h=[];b+=1;var m=b*b;d={img:l.freeze_expl,d:0,mv:1,x32:d[0],y32:d[1]};qb(d);Vb.new(d,ub(d.img));for(var k=0;k<m;k++)for(var v=1;3>v;v++)d=y[bb[v][k%b+e+(~~(k/b)+c)*g]],d.build||d.terrain||d.nofreeze||d.stoned||(d.freezed=1,ib(d,32*d.y32),d.stay(),aa(d,d.img,0),d.invisible&&Cd(d),Dd(d,hj),d.health-=40,1>d.health&&(d.health=1),h.put(d),
he(d.id));m&&1===G.length&&Y(G[0]);gb({func:Rj,data:h},2E4,1)},Rj=function(d){for(var b=0,e=d.length;b<e;b++){var c=d[b];c.freezed=void 0;c.death||(aa(c,c.img,1),yc(c),Na==c&&(Na=void 0,G[0]=c.id,Y(c.id)))}},Yf=function(d,b){O(b);Wa(b,d,Xf)};Yf.cursor=0;Yf.noObj=1;var Xf=function(d,b){O(d,b);if(d.id){var e=d.id,c=d.x32;d=d.y32}else e=-d,c=d%E,d=~~(d/E);if(cb(b)||b.checkMana(100,e,Xf))b.setupDir(-b.x32+c,-b.y32+d),b.setupSpellIMG(),Hh(c,d,3,20,4500,b.id)},Hh=function(d,b,e,c,g,h){for(var f=l.fire_rain,
k=p.gravity,v=Date.now(),n=Hh.rnd,B=Math.PI,q=performance.now(),r=0;r<c;r++){var u=2*n()*B,w=e*n(),x=d+w*Math.cos(u);u=b+w*Math.sin(u);w=~~(r/c*g);ka(x,u)&&gb({func:Sj,data:{x32:x,y32:u-6,dix:0,diy:140,img:f,mv:1,d:0,timestamp:v,finnish:Infinity,aceleration:k,attack:40,xf:x,yf:u,range:2,kingdom:0,obj:h,crashTime:(Math.sqrt(19600+384*k)-140)/k*1E3}},w,1)}O(performance.now()-q)},Sj=function(d){gb({func:uf,data:d},d.crashTime,1);qb(d,0,d.diy,p.gravity)};Hh.rnd=function(){var d=4096,b=2048;return function(){b=
36969*(b&65535)+(b>>16)&4294967295;d=18E3*(d&65535)+(d>>16)&4294967295;return((b<<16)+d&4294967295)/4294967296+.5}}();var Cj=function(d){y[d.obj].damage(d.attack,y[d.obj]);Jb(d);Xb.put(d.bufferID)},Tj=function(d){d=y[d];d.bufferID&&(Jb(d),Xb.put(d.bufferID));Sf[d.x32+d.y32*E]=void 0},uf=function(d){var b=E,e=d.xf,c=d.yf,g=d.attack;d.mv=1;d.func=void 0;d.x32=e;d.y32=c;Mc(d,0,0,0);ib(d,2);e=~~e;c=~~c;var h=e+c*b,m=R[h];Fb[h]?(d.img=l.expl_small_water,qa("water%blop",d.x32,d.y32)):(d.img=l.expl_small_hole,
qa("small%20explosion",d.x32,d.y32));aa(d,d.img,1);Vb.new(d,Uj(Ia[d.img]));if(Fb[h]){if(m=Sa[h],2<m){var k=y[m];k.damage(g,y[d.obj])}}else{2<m&&(k=y[m],k.damage(g,y[d.obj]));h=d.range;m=2*h+1;for(var v=0,n=m*m;v<n;v++){k=v%m-h;var p=~~(v/m)-h,q=~~Math.sqrt(k*k+p*p);q<h&&(k+=e,p+=c,k=R[k+p*b],2<k&&(k=y[k],k.damage(g*(1-q/h),y[d.obj])))}}},Ll=function(d){if(0<G.length){var b=y[G[0]],e=0,c=0,g=0,h=0;void 0!==b.dix&&(d=.001*(d-b.timestamp),h=b.dix,g=b.diy,e=h*d,c=g*d);if(b.space){var m=b.space;d=m[m.length-
1];m=(m.length-1)/d}else m=d=1;e+=32*(b.x32+.5*d-Math.sign(h))+.5*-tzar.width+.5;c+=32*(b.y32+.5*m-Math.sign(g))+.5*-tzar.height+.5;xb=~~-e;Fa=~~-c;ud(-xb,-Fa)}},Vj=function(){};ke.distance="healingRange";yf.distance="createGolemRange";Jf.distance="blessDistance";Tf.distance="freezeDistance";Vf.distance="confusionDistance";Lf.distance="invisibilityDistance";Nf.distance="lightningDistance";Cf.distance="createBatDistance";Af.distance="createDragonDistance";Gf.distance="createCarpetDistance";Ef.distance=
"createJinnDistance";If.distance="turnToStoneDistance";Of.distance="flameBoltDistance";Xf.distance="fireRainDistance";Qf.distance="freezeDistance";me.distance="teachDistance";var D=[];var Yb=function(d,b,e,c,g,h,m){this.name=d;this.k=D.length;this.color=b;this.status="";this.stats={dmgInflicted:0,dmgTaken:0,resources:[0,0,0,0],score:0,unitsKilled:0,unitsLosed:0,buildsLosed:0,buildsDestroyed:0,unitCount:new Uint32Array(u.length),unitCountMax:new Uint32Array(u.length),unitCountDeath:new Uint32Array(u.length),
goldTraded:0,goldConverted:0,stoneTraded:0};this.team=m;this.resources=h||[5E4,5E4,5E4,5E4];this.values={gold:10,wood:10,food:10,stone:10,buildSpeed:1,experience:0,healthJump:0,maxLevel:4,pop:0,popMax:1,popLimit:200,healingRange:1,blessDistance:9,createGolemRange:5,freezeDistance:13,invisibilityDistance:9,createBatDistance:16,lightningDistance:12,createDragonDistance:4,turnToStoneDistance:21,flameBoltDistance:19,fameTech:0,confusionDistance:13,manaSpeed:2,milkSpeed:2,cowSpeed:2,stealCow:0,miningPerf:1,
fireRainDistance:15,createCarpetDistance:3,createJinnDistance:3,teachDistance:2};this.race=c;this.racestr=Zf[c];this.IA=g||0;this.building=[];this.diplomacy=e;this.control={};this.control[this.k]=1;this.onFreePop=[];d=[];d.length0function=Ml;this.unitLoading=0;this.target=[0,0,0,0];this.crusade={number:0,list:d};this.technology={hidden:{},disabled:{},actived:{},investigated:{}};this.mod=b=[];Wj[this.racestr]++;d=0;for(e=u.length;d<e;b[d++]={});D[D.length]=this;d=this.k;b=[];Aa[d]={};Ja[d]=b;for(e=
0;e<u.length;e++)b[e]=[];b=this.color;wa[3*d]=b[0]/255;wa[3*d+1]=b[1]/255;wa[3*d+2]=b[2]/255};Yb.prototype.setupResources=function(d,b){var e=this.resources;b||(b=1);e[0]-=d[0]*b;e[1]-=d[1]*b;e[2]-=d[2]*b;e[3]-=d[3]*b;xf(this.k)};var Ja=[];var Aa=[];var wa=[];Yb.prototype.check=function(){if(this.values.pop)return!0;for(var d=Nl,b=Ja[this.k],e=0,c=u.length;e<c;e++)if(!d[e]&&0<b[e].length)return!0;this.die()};Yb.prototype.checkPopArray=function(){this.onFreePop.length&&be(this.onFreePop.shift())};
Yb.prototype.die=function(){this.death||(this.death=1,this.status="defeated",Xj(),vc(Ih(x.playerDefeated,this.name),0,5))};Yb.prototype.paypal=function(d){var b=this.resources,e=!1,c=this.k;b[0]<d[0]&&($f(c,x.gold),e=!0);b[1]<d[1]&&($f(c,x.wood),e=!0);b[2]<d[2]&&($f(c,x.food),e=!0);b[3]<d[3]&&($f(c,x.stone),e=!0);if(e)return e;b[0]-=d[0];b[1]-=d[1];b[2]-=d[2];b[3]-=d[3];xf(this.k)};Yb.prototype.paypalTest=function(d){var b=this.resources;return d[0]>b[0]||d[1]>b[1]||d[2]>b[2]||d[3]>b[3]?!1:!0};var $f=
function(d,b){d==w.kingdom&&vc(Ih(x.notEnough,b),0,5)},xf=function(d){if(d==w.kingdom){var b=D[d].resources;d=b[0];var e=b[1],c=b[2];b=b[3];Infinity==d&&(d="***");Infinity==e&&(e="***");Infinity==c&&(c="***");Infinity==b&&(b="***");Ol.innerHTML=d;Pl.innerHTML=e;Ql.innerHTML=c;Rl.innerHTML=b}},Nl={13:1,20:1,21:1,22:1,27:1,32:1,35:1,36:1,43:1,44:1,55:1,56:1,57:1},Eb;var Yj=[];(function(){var d="",b=new Image;b.src="data:image/gif;base64,R0lGODlhIQB2AfcAAAAAABAIAAgAABEhACE6ABkbChAQAAgIABAQCO/vlN7epf/6hZSQUv76n721a//rY/XmhnNjECklEP7oecW1Y+7ZeP/rhvvrljEpCCgiB+/Wa97OjP/WSu3YhyEZAIhzLf/WWOnHWv7baL2lVt3Db/vsvUo3BGtSCGhVIdq1SnhjKdy4V62USuvIaPzad/felO/XlzopAGtaMe3Kd/zbiOjMhv/9+JxzGWNKECEZCP/JSuu5Sc6lSMynV4tzPdSyaK2UWjEhADopCNacKWNKGVdCGf/IVuu4VruUSPzJZ7qYU0IqABkQAGdFB2tKEFI6D5tzKMqVN9unSNyrVlRDI/nLd7JwACkZAOaUEDEhCMSMMZRrKYlkJ/u3SJt0M8yYRquDQO66Zu3MlrWcc5haAItSAf+lGUIqCGNCEJdjGXpTGJxrIfisOGtKGcSNOtacQruHOfu6VsiYVOm6dPvLh/rZqTohAHdHB3NKEFo6D0kxEJRjIc6MMalzKYRaIZxrKXlTIuCcP6x5M+umR1I6GX5aKdacSuqqVdedUollNK2HVUopAFQxBXtKEGtCEMmBJ7h2J3NKGdeNNMOCMWNBGZRjKf2rR86MOtaUQpdpMt6cSrqFQkk0GnVWL9OjZolVGeeQLJ5jIKdqJ4xaIeCTObd6NembRt6UQsWEPGlHIf+tUsuMQ9aUSppyRzEZAGU1BkopCHNCEDohCFIxECkZCPeXM3tKGdKDMIRSIZxjKlo6Gc6EOoxaKahwNt6USjUkE/zLmUIgACEQAIZLEtZ2H5ZUF2Y6ELlpIN9/KGtBGUUpEHVKIRkQCNaMRntCEHNCGZdZI86MUjoZAFQoBs5qIF0xECUZEE8hAHQ0CIQ9C5RHD65TFb5cGXY6EDEZCHtCGYRKIVIxGSkQAEohCEIfCVIpEKJEEUUpGWgnBzoZCEIzKzEQABkIAHMpCIw0CyEQCFsZAlEZBikQCDQZECEHAD4PATEQCGshEDEIAPNGKRkAABAAABkICBAICAgICP///yH5BAEAAP8ALAAAAAAhAHYBAAj/AP8JHEiwIEEBBhMqXPiP3QGEAwVAZKgQYoBwLAIMpIUCwESKE5lI/CeA0woU+wTSIvHk40IBD/9x+vHrnYB9+358EbdPwDsavfi5NMiEChcA/5i0QIKrzTsANeQoC+DzAhJvKYcK3AeoAheqAlbo0XNGlpIKR5axEyChwwo/U7UK+EWiAxRdgH5RGnWpD6ArwpCUWlaES40WX0pRompQwIcXLbR8ObKi1BdUcXatMsZuFCUuUtxKidLr11ABT5Ag+tIHjK5MYb5UilPqlK0rVwKkmiJFyyVBpgsyCRCAEpIvyubJC4CkCq9Rh3JhqiRSAJQvcPgIUgaTIIofMvL8/5hCKwfEHmEiDcq0CtosdklHjeoDaSpSgQKoWGjRowMYWh4JlEgYm4wyhR+buaKLAEwoQ4gfs9CikUBM/OBWCytEAuBESIThhyZbVGILOU+QJEAOhFBCyy/44QDDDFKsgJwwqRA0oBejiBJJMmecYSIAOSxjjzf4jeLCFNi9ocxugAyk3hSVhIILGmd4U6KJ77yTAzu/cMIOZXBQ4gcsRXyRhB4CPXEJHT2U4kUyeggzS0QCABAAHD0koUIP/HkjzwH/+ODCFz7qUQoNM3zBVB5X+GjQLGBQtkIHSTxDXAB5wGFBGEUUcUsVF8SWSzJZyJLQTZUc0cIMK7ghhAAZ/P9DySAWuBCHKYdcMMMUgkQSZxGnyiPFF27wIAUX9hgQQBu4DOKCrVLQUMURboySBxNonurFCmn4UYoWfsiT0l6TDBLHIWGEgeQfaAQhREXhrADHLLrgIsgswgiURySiuCEFK4dg4oYoz5yhlUDiRCEFJfZk0UYeNgkkizGfiCJKKajAkYstswTQpEKzVsIOO+Rk4Y1IAglzRh7OQFOKIKF8wmgWClHVhyRFBOARLbRMxI4wsDgSSh99jJKMLKfNxY4abgiii851fiQAO64Yc4woebiCckE5qFCFEnB8IcUWv2zdmDDDSCMRg40RIkgILVAmxRPvTJjQPuwA4FG+pzL/w8UkYGCXzC8BJkSVnSBloYssnMxSsgEHU2RQFjoH4I0wkUuuEAB4Z655RZ8rVAIgzIQeehx0RMKE6Z9XkcQspbNOESZ0xAG77BQFAoztseOukO6WlNO77waZUocls+RAvEKHHJ/88gk1X4sxtEBvUBh1sGGM8tYTNIgNtXzC/T9kVA99IOA/f0cJtYxPPB82gHLHP03QYAU93fOBzDE5bGLKK90byB1I4Q3zdS8PjGhCCaxgQOjdwQZWMAMtzIAFmlmPBmzIAiX+8YohlKEM81teGXg2kDLYgAZkCOBAmlCLWtxHhf/4IAxnSMMa2vCGOMyhDnfIwx768B82QEMN/2dgg3fN0BNhsAERZtgKRMDABsaYISvCAIMSPINIAczEEeRQhxK8woLWe8UOLrGCElzAFukIIB+O8IgpXGAOr0hHH6yXiyQkRgwwSMIdvGGx5anBCFNYhSjmMIcj3MAbgIDE8jQRBkQIYg3j2YEUZBELLRAPCUk4hBy4kAs5wEFh8nDEG6KAuyZkcgpwaEQvFCGIK3jjDIx4xA5wd4QjBPITjviDMITBjiysCAMvDF0f4iCFUkBDDx6QhTVmIY/CyY4eSZACKi5BjgA0QgtbkEUDZReFHexAHOKoRAPC0IZXLm8ZIBCHzvTgiVKlwhrLO4cx9oEUAGSAFnKYAhf6of9CABxAEDtIhCxMAMMA7OEMPSiGGmDIiDF0AAnQgOEBQFEDRgSzeyYoBqZ+yNGOevSjIA2pSAVygic0gXVLkFwT3BGPeIQOHYx4wkUL0gRzcCMe2KiH5tCBDnfo7R/kUIg79hcPdLhUcuiwqUvrwQiDtJQatQiEOdxBAKQO9RgR6GlCpsENZOgAGdxoRzAo8tSoTpUA7RhIPYo6VB3ooAuSaCpFuOpVsLZDrsFohzt4So0u6MAIICjGWBligra+Na7uYEQw3OGOf5iAG2z46wOksA10UAQdff1rYBlbD3MU4x/40EYtACuCB1SWIo+NrBEmy9MMcIMa7sAHPh6hAxD/GIEDoOAGNggrWtKaFh3C2AYoGCvbY7CBDaAgRjF2S9ha1Pa2oMgGPhhRC9hqY6/aSC4xZMHchZgAG9g4bnKLEQ/hgsIc1KCGOeqhjW6wFJwUwYY7skuM7b5iG1A9BlSJgQ5yoMMY2CiA5kyAjm24Nx5LcAc12BAIZBx3G8HARgbEEVTJYWMc4/gvNmiBDmKAQge1YEMXkGEOciDucxgex4QZUY/6dsEIx60FMnA3DmwwIwCMYIQ5zEGMOOiADSGuMOsC8F1s5HjHo+1CLUABCuIFYLc7tikpunAL4Q4Deozdhja2wQ1zwOMRw7gy8eABj20Uoxxchgc5lKGM5cGj/7NnCEA3wgqAJaQUeu2gypPRUY9pbMN6AchCBhAQjAybo3tkzkA83lEAIXcvB9gQRwGkMdJKW/rSBlHGDFhHAxZRJAdV2PTnfhCGbSbkHZqgQRg0hwgXaMLTDBEGL1ywK4qsIgxJyISpDSKMZEBCD0VIxEIooQxvbCMZuy6IN6YSgGQPJAuY24ezB+IndsDCCFFUSB6mAIt3sAOLmnsGJXRBhSIAQhB9EIUXEkGIZETI0Zr7hS5IMYELXKABF6hAC5JwhC+0wZes08UXBpEEC1igAQ2oVRICAYdKKAPeklvGwI0wgYM3YAJJiMMb4MALPUw7Ictwg7lEgHFTTCEJYf9wQy9SUZOA/yEQcQDBD/KRD3f4AA598MMTaPEO1inDW4OwRCvu4Y56qAMQe2iDMnIgD9Z5IxJ9MIUlOsGJeajj6J/QxS+Y8XGD0IISezhFF7rwB3VQAQqTiESEEADuz3ljFkDvgghEYIRBKGbpzADj52ThsJfL3QVGOAIXnpAFZuRddjl4Ai5IYQkjiICYfvA4M3ouO1n8IhKCGIQRkmCJLwBi6c32nTcI0Qdz1V0QRaBc1xkiC13AwQinJwQz2o67TCjDGKUwRR+MUQ0JWO8Qn3+HhNjxiVNA7xBfqIaQx5EHTKyCeGCYAiXSSJB08IIUgsBdKwyBC9oLRBm5sLv/7MCQiDYrJBWtyASm189+9tvBDq4QBwyfMApW9CEZ7EhJ98Cwik3EYRKrYFHdkwhV8AW4kASiYAqRMDLWIwc0gAu2cAi4oAm84DmjVgV5IIHNMApnMFOy4zWbAAiH8AyowAj0MCfQowRzEAmHUAi84AhXQFCycyUCUgWZgAu5gAbGcAWuIDtEcAjAIhDJcAg/wAuVoAbV4ArsIIOh8wRy4AJBIBBnsAoX8AOb4AXGEAz7YCqs4wMQgAhX8A9nUAoXQANToARqwAhUIzsmsAoJEAZjsQs00AAFWAnGsEu4kwdxkAATcASkEAYNoGqCEAvBIADZYjqUoAaHAAEYlyuq/2aAsCAAjsI6eTAKbnAIKFcFVRAGhvAHeSAMYYg7JuAIorAKU4AIYcAKXyAKO+iBnyMOjKAGfyAKvVAKm5ALjhAMAPAxuLMP0jANxjAMgiAI0OAIsPAzy+MRrjANwwAN0MB74uCKoaM3+jANxVAMdrAW0mg6nPMK9KA3zgQ9HgGOdmM94LiN7ZeO6riO7HhpvdALgJAKNdI9QFAKq7AKqggGhQBrvvMDM2AKvsAK94gKm5AJ50A8PwADdBAGAMkKqECQmyAInOA7JFACM3AIhzAIlXBurLAJBTmRsvMDJVADh7ADEPACiZAKuXePnYA7P2ADdRAGgzAHNqAA35AKnP+QCJ1ABbjDRSUQBhipATZwBLkAADc2ALgDBh1AA3FzBKkQAhuwCalQjrKDCPl2BILgD9TQC60QDa0gYL6TCj/QAodwDgDACZsADK3ADAiwPKmQCVQQO5nQCe/Qb9XglsFEBb9QBz8gCLYAQ79ABXy5ChukQr/QCTDgCaUQDoBJBWLgCZkAkgH0C4nwmJnAmIbZCmIgB51AldDzC62gCOqQAZ65PL/wCwdAHDN0Ke3Ymq75mrAZm7ApmbhDmwSRCqdQmOFgfp9DCKigC5kGCKUADsogAnCFmQwRB3GgBxeDC6aWBctwBtzwAA1gCZFAEV0wAQ1wDNWQDJRnEAeQBZD/YAkuUJ28aRCWUHGWgAzCoHeZJgi7kJ4NcAsKUQsNIAKmIAmiAJwMkQOUwC+3cAQQkAwGkQsL0AWQMArQoCGSkwM8MwvVMAu+QhCzoAbdMA16oE3uwzq4EAeqcJ7W06ElIALQAKLLE4E0cAvpUJq+MwtWMw4BsDoq9A4ZyqIU8XV/UAqScJ9GwIsDMQopQAKBMAkv0waHyDX+VApJUAITEAi8gJwDoQzHcAQlQAeDwAVTYaL/ACBMcABwMAinIApQShCyAAldkACJEAAHACQJoQx/gAzKcABuUApaOhDGIAnHAADdoA0kVBCzIAmWwAbcAADLkAx1+n1/wAS/wAeg/0ANBaEMcKAKpoAJnZAFAKAHhzoQyaAzlPAFpkAKkGBBunEJojALT2GUR6oQlKM3utALl0CnysMMB7AM5sMzY7oQv2A+DqML72B+zMCPxMMJB7B6slmsxnqsyNqO+0AfvoMOxcANxIAMknALx9AHoHgEgzAIxxA6jNAIj0AKRxCI0hIGkjAM7JAG5UmHpvA5mNMIXeAGaeAIS3AF4tAEWfMIoGAEFjcDbyA5IoEbxMEOTMAEAssEwuAEofAIjyAJSfAsUyA5+ReF//AJgjAJdwaKrrAIefAKd3AHogAH/fo5dyAGJWAJ1BAD/yAM4mAHMWAHgLFLBksRFisQV0ADSf8wCKGwCLgzCW/AB4GABsPxD3aQbq/wCnbwOVwABsYyAzRgK4MQBIUDGOIgo/8AB1uABqJAgwQhDksjBWFQBS5QBVGAOaIACYvwBGcQA4wgCF57CHFACqJwZwkBAMGwDccACX2xD0EgCpJgBC5gAWVYBdIyGsVAD/LHEPtwDdjwCX2wFsWQBpCgsNN6CZOQBp8QC9JwBVTLEAHADoygM0zgCuswDdfAU9LQE5wTDD34OewQAK6gfzPEN8k6u7Rbu7Z7u7ibu5rTB+LAhSr0LNPAN4VgqbuoBJ+FOyKwAq9gCAYXBqUwAxVAAz8wDdhwvKxTDCFgAUlwb67TAmEwA47/kA2LKzsNsABJAHtx0AWB0AMkQAl5EwvOwDoJB3tG0AWDQApTAAaYQxw/FTrl6wIZ1wWgQAqIsARrozcWWBAAbARxMAiSgAibsL/nKDthgK2kgAmIYAwSoY11gjtTsAluoAmlQBX0cAYqEBO+AwdKoASMIBH0Cgap4AqhiDtKoAiuQBUHgAcqsAAO0AEMQDxMIA514hEBIAwU8ASfcAUJ/DlXUAFPYLfXsBYBdAbbUAWmEAoC2D2u8AoAPAmfIMXdIwClUAWaAA0trEKycAhVAAmOgDkBZAe4EAY/8AmRqEJnAAdzIAiOcMMqxAhfMAqzQDl2nMRqaqO4kxtLrLuK/7zIjBxSsLAIROIEgMkCUqAOUDANAbQFH8ACK+ACbfAJAqEGLLBQvpMBbbACK9AFXOAov7ADR+s7A5ACPAACg2ALRiQNtHANy+MNn5AMsMAEJ2UQetAGbcAIsAAFn0MLJsAOdiBXBgEASAAIPdAK5ODMC+EIjjANWSACSDEWZSEQX0ACYcADK2AIMkIR2VAEKwA0D8AEe9EXfyEMAGAMSRACIdArM7wQAXAEI8AFM9AGXnAZmbEZ7JC8UoAEUfAJqWo4gGABSqABI6AHmyAbtGEbuNEHe4AHdWYQd2DCjKAJLoAEIr0CUiAFhFAERQgd0kEd7CAPApBsDDABLSAA5P/gLCtAGVPwB0TgA+mxHu3xHuxwDbsGAJsQAl2gN8swCFMgKVJgDHpAIAaCIMagIAshDVzQBVpwAFywADCCylOQCZSgB53gISAiIiTCEOGgN1CgBUUbBVGgDFygBt7wDlwQBjiiIzwyiQnxCgLACK7gCrvIBYSwCUXwBHP9JFEyJVWitQzRD81w0mYyFkygJmziJnAiJ5rzCrLwDD4hKIQyD4aCKIqCC4yi1wvxCvQkDrSQKZvSKZ8SKl8wKqXCOgbgDbNSK7eSK7vSK7/CED4ABipQEMziLNAiLdRiLdiyEMxwBF1gouRiLuiiLl/ALu6yENOQCG0ACwmxL/3yLwFJMzAFkzmguBATUzEXkzEb0zE+yjoqwzIuAzMycwXuyTo/EzRDUzRHk8gVQTVWgzVao98vgTZqIxGbuzx4g8CyC2h1YsiN/DkBAQA7";
var e=document.createElement("canvas"),c=e.getContext("2d");b.onload=function(){e.width=33;e.height=34;for(var f=0;11>f;f++)c.drawImage(b,0,34*f,33,34,0,0,33,34),Yj[f]=e.toDataURL("image/png"),d+=".ncursor"+f+"{cursor:url('"+Yj[f]+"'), default}",c.clearRect(0,0,33,34);document.getElementsByTagName("style")[0].innerHTML=d};Oc(2)})();var ne=function(d,b){q(d).style.display="block";ne.actived=d;b.actual="potion";b.id=0;b.amount=100;b.func()};ne.actived="";var da={potion:{bak:1,max:4,ord:["level","mana",
"attack","defence"]},sword:{bak:5,max:3,ord:["attack","attackBow","defence"]},book:{bak:8,max:18,ord:"fireRain lightning healing createCarpet createBat bless freeze confusion invisibility createGolem magicVision raiseDead turnToStone whirlpool createDragon flameBolt teach createJinn".split(" ")}};q("mgbook").onclick=function(){da.actual="book";da.id=0;da.amount=c[da.book.ord[da.id]].obj.spcost[0];da.func()};q("mgpotion").onclick=function(){da.actual="potion";da.id=0;da.amount=100;da.func()};q("mgsword").onclick=
function(){da.actual="sword";da.id=0;da.amount=100;da.func()};q("mgdecline").onclick=function(){q("magicworkshopmenu").style.display="none"};q("mgitem").onmousedown=function(d){var b=1;d.button&&(b*=-1);d=da[da.actual].max;0>da.id+b&&(da.id=d);da.id=(da.id+b)%d;"book"==da.actual&&(da.amount=c[da.book.ord[da.id]].obj.spcost[0]);da.func()};q("mgaccept").onclick=function(){W(Zj,[da.actual,da.id,parseInt(q("mgamount").innerHTML)],G[0])};var Zj=function(d,b){b=y[b];var e=d[2],c=[e,0,0,0];Eb.paypal(c)||
(e=~~(250*e),"book"==d[0]&&(e*=2),b.setupINTV(ak,[d,b.id],e),b.lcost=c,b.techStart=b.c-p.cycle,Y(b.id)&&(q("magicworkshopmenu").style.display="none"))},Sl={defence:6,mana:0,level:2,health:1,attack:5},Tl={attack:"sword",attackBow:"bow",defence:"shield"},Ul={attack:.5,mana:1,defence:.5,level:.2},ak=function(d){var b=y[d[1]],e=d[0][0],f=da[e].ord[d[0][1]];d=d[0][2];b.lcost=void 0;"sword"==e&&(e=Tl[f]);"attackBow"==f&&(f="attack");e=Object.assign({},$b[e]);if(e.potion)e.d=Sl[f],e[f]=~~(d*Ul[f]);else if(e.book){var g=
c[f],h=g.obj;e.spell=f;e.attack=~~(d/h.spcost[0]);e.name=h.name;e.iconID=g.iconIDbook}else e[f]=~~(.25*d),250<e[f]&&(e[f]=250);O(e);$c(52,b,!0,e);b.techStart=void 0;Y(b.id)};q("mgamount").onmousedown=function(d){var b=10;"book"==da.actual&&(b=c[da.book.ord[da.id]].obj.spcost[0]);var e=b;d.button&&(b*=-1);rb.shift&&(b*=5);da.amount+=b;0>=da.amount&&(da.amount=e);q("mgamount").innerHTML=da.amount};da.func=function(){q("mgitem").style.backgroundPositionY=-48*(da.id+da[da.actual].bak)+"px";q("mgamount").innerHTML=
da.amount};var ag=[0,0,0,0,0,0,0,0],Db,td,Da=[document.getElementById("order1"),document.getElementById("order2"),document.getElementById("order3"),document.getElementById("order4"),document.getElementById("order5"),document.getElementById("order6"),document.getElementById("order7"),document.getElementById("order8")],bk=document.getElementById("bottominfo"),oe=Da[0],pe=Da[1],qe=Da[2],re=Da[3],se=Da[4],te=Da[5],ue=Da[6],ve=Da[7];oe.addEventListener("mousedown",function(){oe.style.transform="translate(2px,2px)"});
pe.addEventListener("mousedown",function(){pe.style.transform="translate(2px,2px)"});qe.addEventListener("mousedown",function(){qe.style.transform="translate(2px,2px)"});re.addEventListener("mousedown",function(){re.style.transform="translate(2px,2px)"});se.addEventListener("mousedown",function(){se.style.transform="translate(2px,2px)"});te.addEventListener("mousedown",function(){te.style.transform="translate(2px,2px)"});ue.addEventListener("mousedown",function(){ue.style.transform="translate(2px,2px)"});
ve.addEventListener("mousedown",function(){ve.style.transform="translate(2px,2px)"});oe.addEventListener("mouseup",function(d){Db=d.button;jb(0)});pe.addEventListener("mouseup",function(d){Db=d.button;jb(1)});qe.addEventListener("mouseup",function(d){Db=d.button;jb(2)});re.addEventListener("mouseup",function(d){Db=d.button;jb(3)});se.addEventListener("mouseup",function(d){Db=d.button;jb(4)});te.addEventListener("mouseup",function(d){Db=d.button;jb(5)});ue.addEventListener("mouseup",function(d){Db=
d.button;jb(6)});ve.addEventListener("mouseup",function(d){Db=d.button;jb(7)});document.getElementById("stock").addEventListener("click",function(d){(d=y[G[0]])&&ck(d)});var ck=function(d,b){if(0==X.stockActive||b){if(b=d.inventory,b.length){var e=[];e.length=b.length;for(var c=0,g=b.length;c<g;e[c]=y[b[c++]]);ia(e,d,1)}}else ia(d.icons,d)};(function(){for(var d={},b=0,e=Da.length;b<e;d={l:d.l},b++)d.l=b,Da[b].addEventListener("mouseenter",function(b){return function(){var d=X.displayed[b.l],e=y[G[0]];
if(e&&e.kingdom)var c=D[e.kingdom];if(d){if(void 0!==d.unit){e=u[d.unit];var f={name:e.name,cost:lj(e.cost,d.hero||d.merc,c.values.fameTech)}}else f=d.obj;X.stockActive&&ed(X.active[b.l].id,1,1);if(f&&f.name){var k=f.name;e="<span>";e=2==k.length?e+(k[0]+" - "+k[1]):e+k;if(k=f.cost){!f.tech&&c.mod[f.type]&&c.mod[f.type].cost&&(k=c.mod[f.type].cost);e+=" - (";for(c=0;5>c;c++)k[c]&&(e+=k[c]+"<img class='resource' src='"+Vl[c]+"' /> ");e=e.substring(0,e.length-1);e+=")"}e+="</span>";G.length&&(D[y[G[0]].kingdom].technology.disabled[d.id]&&
(e+="<span class='red'>"+x.requires+": "+d.require+"</span>"),f.type==Ab&&(e+="<span class='increase'>+"+f.increase+"</span>"),(c=X.active.cut)&&c[d.objName]&&(e+="<span class='shotcut'>"+c[d.objName].toLocaleUpperCase()+"</span>"),bk.innerHTML=e)}}}}(d)),Da[b].addEventListener("mouseout",function(){X.stockActive&&ed(G[0],1,1);bk.innerHTML=""})})();var Jh=function(){history.pushState("",document.title,window.location.pathname)},Lb=function(){p.online=0;location.hash="";q("MatchX").style.display="none";
document.getElementById("index").style.display="block";document.getElementById("returnmenu").style.display="none";document.getElementById("game").style.display="none";document.getElementById("chat").style.display="none";document.getElementById("gameFinish").style.display="none";setTimeout(Jh,200)},jb=function(d){var b=ag[d];jb.lastFunc=b;jb.nu=d;if(X.stockActive){b=y[G[0]];var e=y[b.inventory[d]];e&&(e.potion?rb.control?W(le,b.id,[b.id,e.id]):(T=le,T.item=e.id):e.spell?rb.control&&b.mana?W(Kj,b.id,
e.id):(c[e.spell](),T.item=e.id):(W(Bd,b.id,[e.id]),Y(b.id)))}else b&&b();jb.lastFunc=void 0;jb.nu=void 0;Da[d].style.transform=""},gl=function(d){var b=[.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.27,.3,1,.5,.5,.5,1,.62,.62,.62,1,.74,.74,.74,1,.3+.58,.3+.58,.3+.58,1,.94,.94,.94,1,1,1,1,1,1.06,1.06,1.06,1,.3+.82,.3+.82,.3+.82,1,1.08,1.08,1.08,1,1.04,1.04,1.04,1,1,1,1,1,.95,.95,.95,1,.3+.58,.8,.7,1,.3+.54,.72,.6,1,.7,.62,.5,1,.6,.55,.3+.15,1,.5,.44,.42,1,.4,.37,.35,1],e=new Date;
null!=d&&(e=d);d=e.getMinutes()/60;e=e.getHours();document.getElementById("daynighticon").style.backgroundPosition="0 -"+36*e+"px";var c=[b[4*e],b[4*e+1],b[4*e+2],b[4*e+3]];e=(e+1)%24*4;c[0]+=(-c[0]+b[e])*d;c[1]+=(-c[1]+b[e+1])*d;c[2]+=(-c[2]+b[e+2])*d;c[3]+=(-c[3]+b[e+3])*d;return c},xb=0,Fa=0,fd=0,gd=0,ud=function(d,b){var e=tzar.width,c=tzar.height,g=w.mx/32;d/=32;b/=32;var h=ha*e*.03125,m=ha*c*.03125,k=.03125*e,l=.03125*c,n=d+.5*(k-h),p=b+.5*(l-m);0>n?d=.5*-(k-h):n+h-g*ha>E&&(d=E-h-.5*(k-h)+g*
ha);0>p?b=.5*-(l-m):p+m>Ea&&(b=Ea-m-.5*(l-m));h-w.mx>E&&(ha=E/(.03125*e),O(ha));m>Ea&&(ha=Ea/(.03125*c),O(ha));xb=32*-d;Fa=32*-b},Vc=document.getElementById("minimap"),bg=function(d){var b=d.pageX-parseInt(Vc.style.left);d=d.pageY-parseInt(Vc.style.top);var e=tzar.height*Cb/(32*Ea);b=~~(.5+(b-tzar.width*ac/(32*E)*.5)*E/ac);d=~~(.5+(d-.5*e)*Ea/Cb);ud(32*b,32*d);0==td&&document.removeEventListener("mousemove",bg)};Vc.addEventListener("mousedown",function(d){var b=d.pageX-4,e=d.pageY-31;0==d.button?
(document.addEventListener("mouseup",function h(b){document.removeEventListener("mouseup",h);document.removeEventListener("mousemove",bg)}),td=!0,bg(d),document.addEventListener("mousemove",bg)):2==d.button&&(b=~~(E*(d.pageX-4)/ac),e=~~(Ea*(d.pageY-31)/Cb),W(Ib,b+e*E,G))});var rb={control:0,shift:0,esc:0},oa=function(d,b){d&&!p.editor&&(d=X.active,b=Wl[b],d&&d.cut&&(b=c[d.cut[b]]))&&(d=Eb.technology,Db=0,d.disabled[b.id]||d.hidden[b.id]||(jb.lastFunc=b,b(),jb.lastFunc=void 0))},Rb={37:function(d){fd=
d},40:function(d){gd=-d},39:function(d){fd=-d},38:function(d){gd=d},32:function(d){Vj=d?Ll:function(){}},46:function(d){d||W(we,rb.shift,G.slice(0))},16:function(d){rb.shift=d},17:function(d){rb.control=d},27:function(d){rb.esc=d},13:function(d){d&&!p.editor&&("displaynone"==Kh.className?(Kh.className="displayblock",Lh.focus(),Rb.blocked=13):(Mh(),Kh.className="displaynone",Rb.blocked=null))},19:function(d){d||p.online||Nb(1)},48:function(d){d&&rb.control&&(ha=1,xg({deltaY:0}))},176:function(d){d&&
(p.deltaTime+=3E4)},65:oa,66:oa,67:oa,68:oa,69:oa,70:oa,71:oa,72:oa,73:oa,74:oa,75:oa,76:oa,77:oa,78:oa,79:oa,80:oa,81:oa,82:oa,83:oa,84:oa,85:oa,86:oa,87:oa,88:oa,89:oa,90:oa,219:function(d){d&&dk(-1)},221:function(d){d&&dk(1)}},Wl={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};Rb.blocked=null;(function(){for(var d=[65,37,40,83,39,68,38,87],b=d.length=0,e=d.length;b<
e;b+=2)Rb[d[b]]=Rb[d[b+1]]})();document.oncontextmenu=function(){return!1};var hc=document.getElementById("attackmenu"),hd=document.getElementById("defencemenu"),id=document.getElementById("levelmenu"),Ed=document.getElementById("kingdom"),Ma=document.getElementById("progressone"),cg=document.getElementById("unitname"),Pc=document.getElementById("progressvalue");document.getElementById("selectedobject");var we=function(d,b){if(b.length){d=d||p.editor?b.length:1;for(var e=0;e<d;e++)y[b[e]].die()}},
Ba=function(d,b){d.sound&&!b&&(b=d.sound,qa(b[~~(b.length*Math.random())]));id.style.display="none";xe.style.display="none";Ed.style.display="block";Ma.style.display="block";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";hd.style.display="none";cg.innerHTML=d.name;ye(d);Ed.innerHTML=D[d.kingdom].name;d.attack?(hc.style.display="block",hc.innerHTML=d.attack):hc.style.display="none";b=d.health;var e=d.maxHealth;Infinity==b?(Ma.value=100,Ma.max=100,Pc.innerHTML=
b):Ma.value=b;Infinity==e&&Infinity!=b?(Ma.max=100,Ma.value=1):Infinity!==e&&(Ma.max=e);d.inventory&&d.inventory.length&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=d.inventory.length);Pc.innerHTML=~~b+"/"+e;if(!zc(d,w))return ia([]);d.point&&(b=d.point,vb.x32=b[0],vb.y32=b[1],ib(vb,96*(Ea-1)),vb.show=1);if(!1===d.built)ia([c.stopBuilding]),ye(d);else if(d.techStart)ia([c.stopTech]),ye(d),manamenu.style.display="block",manamenu.style.backgroundPosition=
"0px -200px",manamenu.innerHTML=100-~~(100*(d.c-p.cycle)/d.techStart)+"%",Ba.intv&&clearInterval(Ba.intv),Ba.intv=setInterval(function(){G[0]==d.id?manamenu.innerHTML=100-~~(100*(d.c-p.cycle)/d.techStart)+"%":clearInterval(Ba.intv)},400);else{el();if(d.working){e=d.work;var f=X.page*X.length;b=0;for(var g=X.length;b<g;b++){var h=e[b+f];Da[b].innerHTML=h?h:""}manamenu.style.display="block";manamenu.style.backgroundPosition="0px -200px";var m=1E3*u[d.waitlist[0]].time;b=~~(100*(p.now()-d.timestamp)/
m);100<b&&(b=100);manamenu.innerHTML=b+"%";Ba.intv&&clearInterval(Ba.intv);Ba.intv=setInterval(function(){if(G[0]==d.id&&d.working){var b=~~(100*(p.now()-d.timestamp)/m);100<b&&(b=100);manamenu.innerHTML=b+"%"}else clearInterval(Ba.intv)},400)}else for(b=0,e=X.length;b<e;Da[b++].innerHTML="");ia(d.icons,d)}};Ba.intv=!1;var ze=function(){hc.style.display="none";hd.style.display="none";id.style.display="none";Ma.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display=
"none";cg.innerHTML="";hc.innerHTML="";hd.innerHTML="";manamenu.innerHTML="";id.innerHTML="";Ed.innerHTML="";Pc.innerHTML="";Ma.value="";Pc.maxLength="";xe.style.display="none";oe.innerHTML="";pe.innerHTML="";qe.innerHTML="";re.innerHTML="";se.innerHTML="";te.innerHTML="";ue.innerHTML="";ve.innerHTML="";ia([c.origin]);ek()},T,Na,ic,xg,Ac={},nh=function(d,b,e,c){var f=e||y[G[0]],h=c?D[f.kingdom]:Eb;if("peon"==(e?f.clss:ic))var m=!0;if(p.editor)return[zb,k];var k=d+b*E;if(!c&&T!=zb)return[T,k];d=R[k];
b=0;if(!f)return[b,k];if(2<d||(d=jd[k])&&2<d){var l=y[d];l.invisible||(m&&l.storage&&f.stock?b=yh:m&&void 0!=l.res?b=sc:m&&l.health<l.maxHealth&&!h.diplomacy[l.kingdom]&&l.build&&!l.dummy||l.dummy&&!l.built?b=tc:h.diplomacy[l.kingdom]||l.dummy&&h.values.experience||l.confused?b=uc:1===l.invType&&!f.build&&!f.boat&&0<l.invMax&&zc(f,l)&&(b=ge))}else d=Sa[k],2<d&&!f.build&&!f.boat&&(l=y[d],l.item?b=Ad:l.field&&m?b=sf:1===l.invType&&!f.build&&!f.boat&&0<l.invMax&&zc(f,l)&&(b=ge));0===b&&(f=Aa[f.kingdom],
f[k]&&m?(d=f[k],b=tc):(l||(d=-k),b=Ib,Ib.cursor=2));return[b,d]},G=[];G.change=1;var fk,Ol=document.getElementById("gold"),Pl=document.getElementById("wood"),Ql=document.getElementById("food"),Rl=document.getElementById("stone"),ca,Nh;var Oh=!1;var Wb=function(d,b){var e=ha,c=tzar.width,g=tzar.height;d=d*e-xb+.5*(c-e*c);b=b*e-Fa+.5*(g-e*g);return[d,b]},Gb=function(d){if(d){var b=d.pageX;d=d.pageY;Gb.lastX=b;Gb.lastY=d}else b=Gb.lastX,d=Gb.lastY;b=Wb(b-w.mx,d);d=b[1];b=b[0];0==Oh?(window.removeEventListener("mousemove",
Gb),Nh=!1):Nh=!0;if(1===ca[2]||Gb.forced)d=32*~~(d/32),b=32*~~(b/32);ca[4]=d;ca[6]=b;ca[9]=b;ca[10]=d},gk=function(d,b){b=y[b];R[d[0]+d[1]*E]==b.id?(b.point=void 0,G[0]==b.id&&(vb.x32=2*E,ib(vb,128*E),vb.show=0)):(b.point=d,vb.x32=d[0],vb.y32=d[1],G[0]==b.id&&(ib(vb,96*(Ea-1)),vb.show=1))};document.onkeydown=function(d){return d.ctrlKey&&d.shiftKey?!1:{116:1,115:1,123:1}[d.keyCode]?!1:!0};var hk=function(d){if(null==Rb.blocked||Rb.blocked==d.keyCode){var b=Rb[d.keyCode];b&&b(1,d.keyCode)}},ik=function(d){if(null==
Rb.blocked||Rb.blocked==d.keyCode){var b=Rb[d.keyCode];b&&b(0,d.keyCode)}},jk=function(d){var b=window.innerWidth,e=window.innerHeight,c=d.pageX,g=d.pageY;if(screen.height-10<=e){if(1.2==Math.abs(fd)||0==fd)fd=1.2*((10>c)-(c>b-10));if(1.2==Math.abs(gd)||0==gd)gd=1.2*((10>g)-(g>e-10))}c=Wb(c-w.mx,g);g=~~(.03125*c[1]);c=~~(.03125*c[0]);d.pageX<w.mx?Oc(2):(d=nh(c,g)[0],0==d||void 0==d.cursor?Oc(2):Oc(d.cursor))},kk=function(d){if(!Od)if(d.pageX>w.menumx){if(0==d.button){window.addEventListener("mousemove",
Gb);d=Wb(d.pageX-w.mx,d.pageY);var b=d[1];d=d[0];void 0!=K.wall&&(d=K.wall,b=32*~~(d/E),d=d%E*32,Gb.forced=!0,K.wall=void 0);Oh=!0;ca[0]=d;ca[1]=b;ca[9]=ca[0];ca[10]=ca[1];ca[3]=ca[0];ca[7]=ca[1];dg=!1}}else dg=!0},dg=!1,Xl=function(d){if(d.pageX>w.menumx&&d.pageY>w.menumy&&!td&&0==dg){Oh=!1;var b=Wb(d.pageX-w.mx,d.pageY),e=~~(b[1]/32);b=~~(b[0]/32);O(b,e);var c=Ea;if(2==d.button&&!p.editor){if(T!=zb){T=zb;return}if(0<G.length)if(c=y[G[0]],1!=c.build||c.arrow){if(0===T){T=zb;return}c=nh(b,e);d=c[1];
c=c[0];c==Ib&&(b={x32:b,y32:e,d:0,mv:1,img:l.cursor},qb(b),Vb.new(b,ub(b.img)));W(c,d,G)}else W(gk,[b,e],G[0]);return!1}if(0==d.button){if(T==zb)return zb();d=b+e*c;if(T.spLevel)d=T.spLevel(d);else{var g=0;2<jd[d]?g=jd[d]:2<R[d]?g=R[d]:2<Sa[d]&&(g=Sa[d]);d=g}if(d)T.allowPos&&y[d].build&&(d=-(b+e*c));else if(T.allowPos||T.noObj)d=-(b+e*c);else return T=zb;T.noObj&&3<=d&&(d=-(b+e*c));T.item?(W(T,d,[G[0],T.item]),T.item=void 0):W(T,d,G);rb.shift||(T=zb)}}dg=!1},lk=function(d){Od||(Xl(d),Fd.actived&&
Fd(),ca[0]=NaN,ca[1]=NaN,ca[9]=NaN,ca[10]=NaN,ca[3]=NaN,ca[7]=NaN,k.bindBuffer(k.ARRAY_BUFFER,Dc),k.bufferSubData(k.ARRAY_BUFFER,0,ca),wb.actived&&wb(),td&&(td=!1))},Qh=function(d){d=y[d];d.tempChild.quit(d.selectAnim);Jb(d.selectAnim);Ph(d.selectAnim);d.selectAnim=void 0},zb=function(){for(var d=0,b=G.length;d<b;Qh(G[d++]));ne.actived&&(q(ne.actived).style.display="none");Na&&(Qh(Na.id),Na=void 0);G.length=0;ic=-1;Ac={};xe.style.display="none";oe.innerHTML="";pe.innerHTML="";qe.innerHTML="";re.innerHTML=
"";se.innerHTML="";te.innerHTML="";ue.innerHTML="";ve.innerHTML="";hc.className="";X.page=0;vb.show&&(vb.x32=2*E,ib(vb,128*E),vb.show=0);var e=E,c=ca[0],g=ca[1];d=ca[9];var h=ca[10];if(10>=Math.abs(g-h)&&10>=Math.abs(c-d)){h=~~(c/32);var m=~~(g/32),k=g,l=c,n=0;for(d=0;3>d;d++){b=bb[d];var B=h,F=m;c=l;g=k;2<b[B+F*e]?(c=B,g=F,n=y[b[c+g*e]]):(.5<=g/32-F?F++:F--,2<b[B+F*e]?(c=B,g=F,n=y[b[c+g*e]]):(.5<=c/32-B?B++:B--,2<b[B+F*e]?(c=B,g=F,n=y[b[c+g*e]]):(F=~~(g/32),2<b[B+F*e]&&(c=B,g=F,n=y[b[c+g*e]]))))}n.id||
(n=Aa[w.kingdom][h+m*e])&&(n=y[n]);if(n&&2<n.id&&(!n.invisible||zc(n,w)))if(Ac[n.id]=1,G.length=0,n.setupChild(sb.select,1,Xe),zc(n,w)&&!p.demo){G[0]=n.id;ic=null!=n.defence?n.clss:-2;if(256>Date.now()-fk){if(p.editor){Yl(y[G[0]]);return}if(!n.build)for(e=~~(ha*tzar.width*.03125),c=~~(ha*tzar.height*.03125),h=~~(.03125*-xb+.5*(~~(.03125*tzar.width)-e)),k=~~(.03125*-Fa+.5*(~~(.03125*tzar.height)-c)),c*=e,h+=k*E,d=0;d<c;d++)for(g=h+d%e+~~(d/e)*E,m=0;3>m;m++)k=bb[m][g],2<k&&(l=y[k],l.clss!=n.clss||Ac[k]||
!zc(l,n)||l.item||(l.setupChild(sb.select,1,Xe),Ac[k]=1,G.put(k)))}fk=Date.now();if(n.build)return Ba(n)}else return Na=n,ed(n.id),!1}else if(!p.demo)for(c=~~(c/32),d=~~(d/32),g=~~(g/32),h=~~(h/32),c>=d&&(n=c,c=d,d=n),g>=h&&(n=g,g=h,h=n),d++,n=[1,1,1],l=d-c,d=0,b=l*(h-g+1);d<b;d++)for(h=d%l+c,k=~~(d/l)+g,m=0;3>m;m++)if(B=bb[m][h+k*e],F=y[B])F.selected=1,n[B]||(n[B]=1,F.build||!zc(F,w)||F.item||(G[G.length]=B,F.setupChild(sb.select,1,Xe),Ac[B]=1));1<G.length?Rh(G):1==G.length?ed(G[0]):(ia([]),ze(),
ic=-1,G.length=0)},mk=[manamenu,manamenu1],nk={mana:{background:"0px -120px",progress:progressmana},food:{background:"0px -240px"},milk:{background:"0px -280px"},gold:{background:"0px -260px"},stone:{background:"0px -320px"},wood:{background:"0px -340px"}},Vl=["https://i.imgur.com/toj2Nv3.gif","https://i.imgur.com/TwImKWn.gif","https://i.imgur.com/wFIu276.gif","https://i.imgur.com/kIWwIhG.gif","https://i.imgur.com/JBGA2KM.gif"],xe=document.getElementById("unitSpeed"),ed=function(d,b,e){manamenu.style.display=
"none";manamenu1.style.display="none";progressmana.style.display="none";d=y[d];d.sound&&!e&&(e=d.sound,qa(e[~~(e.length*Math.random())]));ic=d.clss;d.inventory&&d.inventory.length&&zc(d,w)&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=d.inventory.length);b||(zc(d,w)&&!p.demo?ia(d.icons,d):Sh());Ed.style.display="block";cg.innerHTML=d.name;d.attack&&d.item||void 0!==d.attack?(hc.innerHTML=d.attack,hc.style.display="block"):hc.style.display="none";
d.defence&&d.item||void 0!==d.defence?(hd.innerHTML=d.defence,hd.style.display="block"):hd.style.display="none";d.mana&&!d.manaTarget&&(manamenu.style.display="block",manamenu.innerHTML=d.mana,manamenu.style.backgroundPosition="0px -120px");b=0;var c=d.update;if(c){b=0;for(var g=c.length;b<g;b+=3){var h=c[b],m=nk[h];e=mk[b/3];e.innerHTML=d[h];e.style.display="block";e.style.backgroundPosition=m.background;"mana"==h&&d.manaTarget&&(e.innerHTML=~~(100*d.mana/d.manaTarget+.5)+"%",e.style.backgroundPosition=
"0px -200px");m.progress&&(m.progress.style.display="block",m.progress.value=d[h],m.progress.max=d[h+"Max"])}}d.stock&&(c=d.stock,e=mk[b/3],e.style.display="block",e.style.backgroundPosition=nk[c[4].icon].background,e.innerHTML=c[0]);b=d.level?d.level:0;id.innerHTML=b;id.style.display="block";0===b&&(d.item||d.build)&&(id.style.display="none");Ed.innerHTML=D[d.kingdom].name;Ma.style.display="block";ok(d);ye(d)},ok=function(d){var b=d.health;d=d.maxHealth;Infinity==b?(Ma.value=100,Ma.max=100,Pc.innerHTML=
b):(Ma.value=b,Infinity==d?(Ma.max=100,Ma.value=1):Ma.max=d,Pc.innerHTML=~~b+"/"+d)},Rh=function(d,b){var e=y[d[0]],c=0,g=0,h=e.clss,m=d.length,k={},l=[];l.cut={};for(var n=0;n<m;n++){e=y[d[n]];c+=e.maxHealth;g+=e.health;ic=h!=e.clss?-1:!0;for(var p=e.icons,q=p.length,r=0;r<q;r++){var u=p[r].id;void 0===k[u]?k[u]=1:k[u]++;if(k[u]===m){if(p.cut){u=p.cut;var w=p[r].objName;u[w]&&(l.cut[w]=u[w],l.cut[u[w]]=w)}l.put(p[r])}}}!0===ic&&(ic=e.clss);g=Infinity==g?100:~~(g/c*100);Pc.innerHTML=g+"/100(%)";pk();
cg.innerHTML="";hc.style.display="none";hd.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";id.style.display="none";Ed.innerHTML=m+" "+x.units;Ma.style.display="block";Ma.value=g;Ma.max=100;b||(!0!==ic?ia(l):ia(e.icons))},ti=function(){};new Float32Array(8);var pb,rd,Dc,Pd,Md,ha=1,qk={1:2560,101001:2048,101E3:2048,1001:2048,1E3:2048,100:1536,10010100:1280,10100:1280,1001E4:1280,1E4:1280,10010010:256,10010110:256,10110:256,10111:256,
10010111:256,110:512,111:512,11:512,10:512,111E5:2816,11E5:2816,11E6:2816,1E6:2816,1101E4:768,11110100:768,11010100:768,1111E4:768,1E7:3360,1E5:3072,1101E3:1792,1101001:1792,11101E3:1792,11101001:1792,101111:0,1011:0,1111:0,101011:0},Zl=function(d){Jb(d);Xb.put(d.bufferID)},Vb={table:{},dates:[],new:function(d,b,e){b=Math.floor(b)+p.now();var c=this.table;e||(e=Zl);c[b]||(c[b]=[]);d.animFunc=e;c[b].put(d);this.dates.add(b);this.needOrder=!0}},ub=function(d){d=Ia[d];return 0>d[1]?l.delay[d[0]-d[1]-
1]:~~(d[0]/d[1]*1E3)},Bb=new Float32Array(12),mh=function(d){var b=d.id+p.arje+d.x32+d.y32;d.rnd=[4294967295+b,4294967295-b,0]},Th=function(d){d=y[d];d.mlist&&rk(d,!0);d.hlist&&rk(d,!1)},rk=function(d,b){if(b)var e=d.mlist,c=d.mlistID,g=Gd.mercenaries;else e=d.hlist,c=d.hlistID,g=Gd.heroes;e.unshift(g[pj(d,g.length)]);b?c.unshift(d.mercID++):c.unshift(d.heroID++);8<e.length&&(e.length=8,c.length=8);X.active==e&&ia(e);Pb(d,5E4)},Uh=function(d){d=y[d];if(!D[d.kingdom].paypal(ul)){var b=D[d.kingdom],
e=16+4*b.crusade.number;b.crusade.number++;32<e&&(e=32);var f=b.crusade.list;f.length=e;for(var g=0;g<e;g++)(f[g]=$c(8,d,1)).deleteFromList=f;qa("crusade",d.x32,d.y32);b.technology.disabled[c.createCrusaders.id]=1;Y(d.id)}},Ml=function(d){D[d.kingdom].technology.disabled[c.createCrusaders.id]=0},sd,R=[],Sa=[],jd=[],lc={},bb=[];bb.length=3;var Sh=function(){for(var d=X.displayed.length=0,b=X.length;d<b;d++){var e=Da[d];e.className="blocked";e.style.backgroundPosition="48px 96px";ag[d]=Fc}X.rightButton.className=
"blocked";X.leftButton.className="blocked";X.stock.className="blocked";X.rightBlocked=1};X.leftButton.onclick=function(){X.page&&(X.page--,ia(X.active,0,X.stockActive))};X.rightButton.onclick=function(){X.rightBlocked||(X.page++,ia(X.active,0,X.stockActive))};X.displayed=[];var ia=function(d,b,e){e=!!e;b||(b=NaN);var c=d.olegal||NaN;if(b.working&&!e)var g=1;X.active=d;X.displayed.length=0;var h=Eb.technology,m=X.page,k=X.length;Sh();!1!==e&&b?X.stockActive=b:!1===e&&(X.stockActive=!1);ia.actv={};
d.length<=m*k&&d.length&&(X.page--,m--);for(var l=0,n=0,p;l<k;l++){p=d[l+m*k];if(!p)break;var q=Da[n];if(!e&&(ia.actv[p.id]=1,h.hidden[p.id]||p.obj.tech&&g)){k++;continue}q.style.backgroundPosition=48*e+"px "+(-e||1)*p.iconID*48+"px";e||!h.disabled[p.id]||c[p.id]?(q.className="",ag[n]=p):q.className="blocked";X.displayed[n]=p;n++}d[l+m*k]&&(X.rightButton.className="",X.rightBlocked=0);0<m&&(X.leftButton.className="");1===G.length&&(b=y[G[0]]);b.inventory&&0<b.inventory.length&&(X.stock.className=
"")};ia.actv={};var si,pa,na,yg;var k=q("tzar").getContext("webgl2",{antialias:!0,alpha:!1});w.gl=!!k;if(k){var $l=k.getExtension("WEBGL_lose_context");k.canvas.addEventListener("webglcontextlost",function(d){setTimeout(function(){$l.restoreContext()},2E3);d.preventDefault()},!1);k.canvas.addEventListener("webglcontextrestored",function(d){O("restored 2")},!1)}var ri,zg,Ag,ui,Te,ug,tg,Se,Ue,Nd,Ld,qd,vg,wg,Hb=function(){if(p.canceled)return 0;requestAnimationFrame(Hb);var d=Hb.fp1000,b=Hb.delta,e=
Hb.now;performance.now();var c=e;Hb.frameCount++;e=p.now();Hb.now=e;b=(b+(e-c))/1E3;Hb.delta=b;jh+=b;ih++;Hb.fp1000=d+b;d=Vb.table;c=Vb.dates;Vb.needOrder&&(c.sort(function(b,d){return b-d}),Vb.needOrder=0);for(var g=0;c[g]<=e+17;g++){for(var h=d[c[g]],m=0,l=h.length;m<l;m++){var v=h[m];v.animFunc(v)}delete d[c[g]];g--;c.shift()}if(0!=fd||0!=gd)xb+=fd*b*640*ha,Fa+=gd*b*640*ha,ud(-xb,-Fa),Gb();Vj(e);ti();k.uniform1f(ri,e);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);if(d=ya.length)k.bindFramebuffer(k.FRAMEBUFFER,
fb),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,ui),b=ya,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.enable(k.BLEND),k.blendEquation(k.MAX),k.blendFunc(k.SRC_COLOR,k.SRC_COLOR),k.bindTexture(k.TEXTURE_2D,yg),k.drawElements(k.TRIANGLES,d,k.UNSIGNED_INT,0),k.bindTexture(k.TEXTURE_2D,Lighttexture),k.disable(k.BLEND),k.bindFramebuffer(k.FRAMEBUFFER,null);sk(zg);c=window.innerWidth;g=window.innerHeight;k.viewport(w.marx,g-Cb-w.mary,ac,Cb);k.uniform2f(Te,
32*E,32*Ea);k.uniform2fv(Nd,[0,0]);k.uniform1i(Ue,1);k.uniform1f(sd,1);sk(zg);k.viewport(w.mx,0,c,g);performance.now();k.useProgram(na);k.bindVertexArray(vg);k.uniform1f(ug,~~((.01*e+.5)%5));k.drawArrays(k.TRIANGLES,0,6);k.viewport(w.marx,g-Cb-w.mary,ac,Cb);k.uniform1i(Se,1);k.uniform2fv(Ld,[0,0]);k.uniform1f(qd,ac/32/E);k.drawArrays(k.TRIANGLES,0,6);k.uniform1i(Se,0);k.uniform2f(tg,c,g);k.uniform2fv(Ld,[xb,Fa]);k.uniform1f(qd,1/ha);k.viewport(w.mx,0,c,g);k.useProgram(pa);k.bindVertexArray(wg);if(d=
ua.length)k.enable(k.BLEND),k.blendEquation(k.FUNC_ADD),k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA),k.bindBuffer(k.ARRAY_BUFFER,Dc),c=tzar.width,g=tzar.height,e=-xb+.5*(c-ha*c),b=-Fa+.5*(g-ha*g),h=ha*(c-w.mx),m=ha*g,k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([e,b,24576,e+h,b,24576,e,b+m,24576,e+h,b+m,24576])),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Ag),b=ua,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.viewport(w.marx,g-Cb-
w.mary,ac,Cb),k.drawElements(k.TRIANGLES,12,k.UNSIGNED_INT,0),k.uniform1i(Ue,0),k.uniform2f(Te,c,g),k.uniform2fv(Nd,[xb,Fa]),k.uniform1f(sd,1/ha),k.viewport(w.mx,0,c,g),k.bindBuffer(k.ARRAY_BUFFER,Dc),Nh&&!Vh?k.bufferSubData(k.ARRAY_BUFFER,0,ca):k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([NaN,NaN,24576,NaN,4347,24576,5551,NaN,24576,NaN,NaN,24576])),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Ag),b=ua,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),
k.drawElements(k.TRIANGLES,d,k.UNSIGNED_INT,0),k.disable(k.BLEND);K.active&&(e=K.x,b=K.y,d=96*E,K.wh?(c=K.wh[0]-Ia[K.img][8],g=K.wh[1]-Ia[K.img][9]):g=c=0,Wh(e,b,d,c,g,K.bufferID),K.active=!1);Uc.update&&Uc(1)},sk=function(d){var b=fa.length;b&&(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,d),d=fa,d.changed&&(d.typed=new Uint32Array(d),d.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,d.typed,k.STATIC_DRAW)),k.drawElements(k.TRIANGLES,b,k.UNSIGNED_INT,0))},pd=!1;"use strict";var ka=function(d,b){return d<E&&
0<=d&&0<=b&&b<Ea?!0:!1};Array.prototype.put=function(d){this[this.length]=d};var sb,Ae,$b,Xh,kd=function(d,b,e,c){c&&0==kd.cols[c]&&(kd.list.push(c,d),kd.cols[c]=1)};kd.cols={};kd.list=[];var S=function(d){for(var b=Object.keys(d),e=0;e<b.length;e++)d[d[b[e]]]=b[e];return d};window.onerror=kd;var p={},Ia=[],am=function(d,b,e,c){for(var f=0,h=Object.keys(d),m=0,k=h.length;m<k;m++){var l=h[m],n=d[l];if(Array.isArray(n)){d[l]=f;n.url=f;l=Ia[f++]=n;var p=n.deltaY?n.deltaY:0;l.id=c/4;for(var q=6,r=l.length;q<
r;q+=6){var u=l[q-2],w=l[q-1],x=l[q+2],y=l[q+3];b[c++]=l[q]/e;b[c++]=(p+l[q+1])/e;b[c++]=u;b[c++]=w;b[c++]=(l[q]+x)/e;b[c++]=(l[q+1]+p)/e;b[c++]=u+x;b[c++]=w;b[c++]=l[q]/e;b[c++]=(l[q+1]+y+p)/e;b[c++]=u;b[c++]=w+y;b[c++]=(l[q]+x)/e;b[c++]=(l[q+1]+y+p)/e;b[c++]=u+x;b[c++]=w+y}}else for(var A=Object.keys(n),z=0,C=A.length;z<C;z++)for(l=n[A[z]],l.id=c/4,l.url=f,n[A[z]]=f,Ia[f++]=l,p=l.deltaY?l.deltaY:0,q=6,r=l.length;q<r;q+=6)u=l[q-2],w=l[q-1],x=l[q+2],y=l[q+3],b[c++]=l[q]/e,b[c++]=(p+l[q+1])/e,b[c++]=
u,b[c++]=w,b[c++]=(l[q]+x)/e,b[c++]=(l[q+1]+p)/e,b[c++]=u+x,b[c++]=w,b[c++]=l[q]/e,b[c++]=(l[q+1]+y+p)/e,b[c++]=u,b[c++]=w+y,b[c++]=(l[q]+x)/e,b[c++]=(l[q+1]+y+p)/e,b[c++]=u+x,b[c++]=w+y}return c},P=function(d,b,e,c){var f=0,h=e.length-1,m=e[h];c=Aa[c];var k=[],l=0,n=!0;ka(d,b)&&ka(d+m-1,b+h/m-1)||(n=!1);for(var p=E,q=0;q<h;q++){f==m&&(f=0,b++);if(e[q]){var r=d+f+p*b;c[r]&&(n=!1);if(0<R[r]||Fb[r])n=!1;k[l++]=r}f++}return[k,n]};P.check=function(d,b,e,c,g,h,m){var f=e.length-1;e=e[f];var k=f/e;f=E;
m=Aa[m];e+=2;--d;--b;k=e*(k+2);for(var l=0;l<k;l++){var p=d+l%e,q=b+~~(l/e),r=p+q*f;if(0<R[r]||Fb[r]||h&&(p>=g&&p<=g+2||q>=c&&q<=c+2)||!ka(p,q)||m[r]||y[Sa[r]].field)return!1}return!0};var tk=function(d,b,e){var c=0,g=e.length-1,h=e[g],m=[],k=[],l=0,n=!0;ka(d,b)&&ka(d+h-1,b+g/h-1)||(n=!1);for(var p=0,q=0;q<g;q++){c==h&&(c=0,b++);var r=d+c+E*b;e[q]?(2<R[r]&&(n=!1),m[l++]=r):(k[p++]=r,2<R[r]&&(n=!1));c++}return[m,n,k]},$g=function(d,b,e){var c=0,g=e.length-1,h=e[g],m=[],k=0,l=!0;ka(d,b)&&ka(d+h-1,b+
g/h-1)||(l=!1);for(var n=0;n<g;n++){c==h&&(c=0,b++);var p=d+c+b*E;if(e[n]&&2<R[p]&&1==y[R[p]].build||0<Sa[p])l=!1;m[k++]=p;c++}return[m,l]},eg=function(d,b,e){var c=!1,g=0,h=[],m=0,k=e.length-1,l=e[k],n=0,p=!0;ka(d,b)&&ka(d+l-1,b+k/l-1)||(p=!1);for(var q=0;q<k;q++){n==l&&(n=0,b++);if(e[q]){var r=d+n+E*b,u=R[r];2<u&&(p=!1);0<u?g++:c=!0;h[m++]=r}n++}g>.5*(k-1)&&c||(p=!1);return[h,p]},Be=function(d,b,e){e=!0;ka(d,b)||(e=!1);1!==Sa[d+b*E]&&(e=!1);return[[d+b*E],e]},V=function(d,b,e){e=!0;ka(d,b)||(e=
!1);0<R[d+b*E]&&(e=!1);return[[d+b*E],e]},fg=function(d,b,e){e=!0;ka(d,b)||(e=!1);0<jd[d+b*E]&&(e=!1);return[[d+b*E],e]},Sb=function(d,b,e){e=!0;ka(d,b)||(e=!1);if(0<Sa[d+b*E]||2==R[d+b*E]||1==R[d+b*E])e=!1;return[[d+b*E],e]},bm=function(d){for(var b=Object.keys(d),e=N.common.length/1048576,c=0,g=b.length;c<g;c++)d[b[c]].deltaY=512*e},K,C,tb,La,il=function(){K={img:0,x32:-1E3,y32:-1E3,rgb:[0,0,0,.5],d:0,active:!1};var d=8,b=9;if(!pd){cm();var e=[c.move,c.attack,c.guard,c.patrol,c.pickUp,c.explore,
c.stop,c.stand,c.sameSpeed,c.restoreSpeed];Ae={magic_creatures:[58,40,59,5,78,77,60,130,131,132,89,129]};for(var f=Object.keys(Ae),g=0,h=f.length;g<h;g++){var m=Ae[f[g]],k={};m.obj=k;for(var v=0,n=m.length;v<n;k[m[v++]]=1);}Gd.mercenaries=[c.mercArcher,c.mercFootman,c.mercMaceman,c.mercLongbowman,c.mercPikeman,c.mercKnight,c.mercArcherAsian,c.mercSamurai,c.mercHourseSamurai,c.mercRonin,c.mercHorseArcher,c.mercChariot,c.mercFootmanArab,c.mercArcherArab,c.mercMacemanArab,c.mercPikemanArab,c.mercCavalry,
c.mercEnichar,c.mercJihad];Gd.heroes=[c.mercArcher6,c.mercFootman6,c.mercMaceman6,c.mercLongbowman6,c.mercPikeman6,c.mercKnight6,c.mercArcherAsian6,c.mercSamurai6,c.mercHourseSamurai6,c.mercRonin6,c.mercHorseArcher6,c.mercChariot6,c.mercFootmanArab6,c.mercArcherArab6,c.mercMacemanArab6,c.mercPikemanArab6,c.mercCavalry6,c.mercEnichar6,c.mercJihad6];f=Gd.mercenaries;g=0;for(h=f.length;g<h;f[g++].merc=9);f=Gd.heroes;g=0;for(h=f.length;g<h;f[g++].hero=1);n=l;n.build2x2[2]=1;n.build3x3[2]=1;n.build4x4[2]=
1;n.build5x5[2]=1;n.build6x6[2]=1;n.items1[2]=1;n.build_harbor[2]=1;n.bridge_horz_build[2]=1;n.bridge_vert_build[2]=1;n.fields[0]=9;n.fields[2]=1;n.sexplosion[0]=13;n.sexplosion[1]=25;n.flame_trail[0]=16;n.flame_trail[1]=25;g=0;for(m=n.asian_charriot.idle.length;g<m;g+=6)n.asian_charriot.idle[4+g]-=17;g=0;for(m=n.asian_charriot.attack.length;g<m;g+=6)n.asian_charriot.attack[4+g]-=17;g=0;for(m=n.asian_charriot.move.length;g<m;g+=6)n.asian_charriot.move[4+g]-=17;g=0;for(m=n.asian_charriot.die.length;g<
m;g+=6)n.asian_charriot.die[4+g]-=17;g=0;for(m=n.flame_trail.length;g<m;g+=6)n.flame_trail[4+g]-=32,n.flame_trail[5+g]-=32;g=0;for(m=n.sexplosion.length;g<m;g+=6)n.sexplosion[4+g]-=48,n.sexplosion[5+g]-=48;n.items1[1]=0;n.books[1]=0;n.potions[1]=0;n.troll.attack[1]=14;n.ork.attack[1]=14;n.dwarf.attack[1]=14;n.asian_mage.move[1]=14;n.arab_priest.attack=n.arab_priest.spell;n.asian_mage.spell=n.asian_mage.castspell;n.asian_mage.attack=n.asian_mage.castspell;n.asian_mage.spell[1]=13;n.arab_horse_archer.move=
n.arab_horse.archer;n.arab_jwarrior.attack[1]=14;n.arab_peasant.attack=n.arab_peasant.attack1;n.arab_peasant.tree=n.arab_peasant.wood;n.asian_peasant.attack=n.asian_peasant.attack1;n.asian_peasant.cut=n.asian_peasant.chop;n.asian_peasant.tree=n.asian_peasant.wood;n.asian_peasant.dig[1]=10;n.asian_peasant.dig[0]=11;n.asian_archer.die[1]=14;n.asian_ronin.attack=n.asian_ronin.attack1;g=0;for(m=n.asian_peasant.dig.length;g<m;g+=6)n.asian_peasant.dig[4+g]-=16,n.asian_peasant.dig[5+g]-=16;g=0;for(m=n.turn_to_stone.length;g<
m;g+=6)n.turn_to_stone[4+g]-=56,n.turn_to_stone[5+g]-=64;n.arab_tcguild_c[4]=31;n.arab_tcguild_c[5]=85;n.dragon.idle=n.dragon.move;n.asian_samurai.attack=n.asian_samurai.attack1;n.asian_horsamurai.idle=n.asian_horsamurai.idle1;n.asian_horsarcher.idle=n.asian_horsarcher.idle2;n.asian_priest.attack=n.asian_priest.attack1;n.asian_priest.spell=n.asian_priest.pray;n.asian_monk.attack[1]=12;n.euro_mage.attack=n.euro_mage.spell;n.euro_ghost.idle=n.euro_ghost.move;n.euro_priest.attack=n.euro_priest.spell;
n.arab_mage.spell=n.arab_mage.attack;n.cursor[1]=15;n.star[1]=15;n.select[4]+=3;n.select[5]+=3;n.arab_houses_c[d]=96;n.asia_houses_c[d]=96;n.asia_houses_c[4]-=9;n.asia_houses_c[5]-=15;n.wood_build[2]=1;n.res_gold[2]=1;n.res_gold_s[2]=1;n.res_stone[2]=1;n.res_stone_s[2]=1;n.bridge_horz1[4]=-9;n.bridge_horz1[5]=132;n.bridge_horz1[4]=-9;n.bridge_horz1[5]=132;n.euro_stable_c[4]+=18;n.euro_stable_c[5]-=10;n.euro_lumbermill_s[4]-=19;n.euro_lumbermill_s[5]-=17;n.wood_tower_c[4]=0;n.wood_tower_c[5]*=1;n.bat.idle=
n.bat.move;n.galleon.idle[1]=7;n.galleon.die[1]=8;n.expl_small_water[1]=11;g=0;for(m=n.curse.length;g<m;g+=6)n.curse[5+g]-=48;g=0;for(m=n.impersonate.length;g<m;g+=6)n.impersonate[5+g]-=48;g=0;for(m=n.bless.length;g<m;g+=6)n.bless[5+g]-=48;g=0;for(m=n.euro_barracks_c.length;g<m;g+=6)n.euro_barracks_c[4+g]+=50;g=0;for(m=n.healing.length;g<m;g+=6)n.healing[5+g]-=48;g=0;for(m=n.expl_small_hole.length;g<m;g+=6)n.expl_small_hole[4+g]-=4,n.expl_small_hole[5+g]-=34;Date.now();f=[c.createKnight,c.createHorseArcher1,
c.createHorseArcher2,c.createHorseSamurai,c.createChariot,c.createEnichar,c.createCavalry]}if(Dg){Dg=!1;O("TErrain changed");g=0;for(h=N.xtra.length;g<h;g++){n=N.xtraRes[g].coords;bm(n);n.terrain_water[d]=512;n.terrain_water[b]=512;n.terrain_water[6]+=32;n.terrain_water[7]+=32;v=0;for(m=n.terrain_tree.length;v<m;v+=6)n.terrain_tree[4+v]-=32,n.terrain_tree[5+v]-=96;v=0;for(m=n.terrain_tree_s.length;v<m;v+=6)n.terrain_tree_s[5+v]-=32;n.terrain_tree[2]=1;Object.assign(l,n)}d=N.size;h=new Float32Array(1048576);
n=am(l,h,d,0);N.info=h;N.ids=n/16}if(!pd){$b={sword:{name:"Sword",iconID:16,img:l.items1,d:0,dMax:7,attack:1,type:52,sword:1},bow:{name:"Bow",iconID:4,img:l.items1,d:15,dMax:4,attack:1,type:52,sword:1},shield:{name:"Shield",iconID:1,img:l.items1,d:8,dMax:6,defence:1,type:52,shield:1},potion:{name:"Potion",iconID:11,img:l.potions,d:0,dMax:7,type:52,potion:1},book:{name:"Book",iconID:9,img:l.books,d:0,dMax:4,type:52,book:1},gold:{name:"Gold",iconID:20,img:l.item_gold,d:0,dMax:0,type:52},stone:{name:"Stone",
iconID:22,img:l.item_stone,d:0,dMax:0,type:52},food:{name:"Food",iconID:14,img:l.item_food,d:0,dMax:0,type:52},wood:{name:"Wood",iconID:15,img:l.item_tree,d:0,dMax:0,type:52},iron:{name:"Iron",iconID:21,img:l.item_iron,d:0,dMax:0,type:52}};Xh=[$b.sword,$b.potion,$b.book,$b.bow,$b.shield];h=[c.move,c.attack,c.stop,c.stand,c.pickUp,c.explore,c.healing,c.bless];d=[c.attack,c.guard,c.patrol,c.explore,c.stop,c.stand,c.attackGround,c.steady,c.move];b=[c.buildAcademy,c.buildWorkshop,c.buildWorkshop1,c.buildAcademy1,
c.buildWorkshop2,c.buildAcademy2];g=[c.buildMerchands1,c.buildMerchands2,c.buildMerchands];La={euro:{},asia:{},arab:{},common:{}};u=[{name:"Footman",attack:6,defence:3,health:65,maxHealth:65,img:l.euro_footman.idle,attackSound:Hc,invType:0,invMax:8,validator:V,human:12,iconID:36,time:12,sight:5,url:l.euro_footman,icons:e,cost:[0,0,50,0],attDist:1,spd:50,dieSound:Ga,clss:"footman",size:1,standardFunc:U,radix:0,zLevel:1,strID:"e_footman",race:"euro"},{name:"Pikeman",radix:0,attackSound:Hc,attack:8,
defence:4,health:75,maxHealth:75,img:l.euro_pikeman.idle,invType:0,dieSound:Ga,invMax:8,validator:V,human:1,iconID:39,time:18,sight:5,url:l.euro_pikeman,icons:e,cost:[40,0,60,0],attDist:1,spd:50,standardFunc:U,clss:"e_pikeman",zLevel:1,size:1,strID:"e_pikeman",nu:c.createPikeman,race:"euro"},{name:"Spy",radix:0,attack:20,defence:0,mana:100,manaMax:100,health:50,maxHealth:50,img:l.euro_spy.idle,attackSound:["spy%20kill%201","spy%20kill%202","spy%20kill%203"],invType:0,invMax:8,validator:V,human:1,
dieSound:Ga,iconID:41,time:30,sight:12,url:l.euro_spy,icons:[c.move,c.attack,c.guard,c.patrol,c.pickUp,c.explore,c.stop,c.stand,c.impersonate,c.revealSelf],zLevel:1,cost:[120,0,0,0],attDist:1,spd:50,clss:"spy",standardFunc:U,size:1,update:["mana","manaSpeed",1E3],isSpy:1,strID:"spy",nu:c.createSpy,race:"common"},{name:"Maceman",radix:0,attack:8,defence:0,health:120,maxHealth:120,img:l.euro_maceman.idle,attackSound:Hc,invType:0,invMax:8,validator:V,human:1,iconID:37,time:14,dieSound:Ga,sight:5,zLevel:1,
url:l.euro_maceman,icons:e,cost:[0,0,120,0],attDist:1,spd:50,clss:"maceman",standardFunc:U,size:1,strID:"e_maceman",nu:c.createMaceman,race:"euro"},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:l.euro_archer1.idle,invType:0,invMax:8,validator:V,human:1,sight:10,dieSound:Ga,arrow:!0,iconID:38,zLevel:1,time:12,url:l.euro_archer1,icons:e,cost:[0,20,40,0],attDist:7,spd:50,clss:"archer",standardFunc:U,attimg:l.arrow1,attackSound:wd,size:1,strID:"e_archer",nu:c.createArcher,race:"euro"},
{radix:0,name:"Wizard",attackSound:Ti,dieSound:["mage"],attack:5,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:l.euro_mage.idle,zLevel:1,invType:0,invMax:8,validator:V,human:1,iconID:42,time:30,sight:15,url:l.euro_mage,icons:[c.stop,c.pickUp,c.explore,c.lightning,c.createBat,c.freeze,c.createGolem,c.invisibility,c.stand,c.attack,c.move],cost:[150,0,0,0],attDist:10,attimg:l.flame_bolt,ball:1,spd:50,clss:"mage",standardFunc:U,size:1,update:["mana","manaSpeed",1E3],strID:"e_mage",nu:c.createMage,
race:"euro"},{radix:0,name:"Longbowman",attack:6,defence:2,health:50,maxHealth:50,img:l.euro_longbowman.idle,zLevel:1,invType:0,invMax:8,dieSound:Ga,attackSound:wd,arrow:!0,validator:V,race:"euro",human:1,iconID:35,time:18,sight:18,url:l.euro_longbowman,icons:e,cost:[50,0,90,0],attDist:12,spd:50,standardFunc:U,clss:"longbowman",size:1,d2attack:2,strID:"e_longbowman",attimg:l.arrow1,nu:c.createLongbowman},{radix:0,clss:"tree",name:"Tree",health:100,maxHealth:100,img:l.terrain_tree,invType:0,invMax:8,
zLevel:1,mMapcolor:[11,131,11],validator:V,child:[{img:l.terrain_tree_s,rgb:[0,0,0,.5],alpha:1,x:0,y:0}],iconID:23,url:l.terrain_tree,dimgInfinity:l.terrain_tree,dimgRND:3,icons:[],res:1,race:"common",build:!0,size:1,zolotoy:1,strID:"tree"},{radix:0,name:"Crusader",zLevel:1,dieSound:Wd,attackSound:Ud,attack:14,defence:8,health:180,maxHealth:180,img:l.crus.idle,invType:0,invMax:8,validator:V,human:1,race:"euro",iconID:100,time:19,sight:5,url:l.crus,icons:e,cost:[0,0,0,0],attDist:1,spd:85,standardFunc:U,
clss:"crusader",size:1,strID:"crusader"},{radix:0,name:"Priest",attack:20,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:l.euro_priest.idle,invType:0,zLevel:1,invMax:8,validator:V,human:1,iconID:40,time:30,ball:1,sight:21,dieSound:Ga,url:l.euro_priest,icons:h,attackOnly:Ae.magic_creatures.obj,cost:[150,0,0,0],attDist:18,race:"euro",spd:50,standardFunc:U,clss:"priest",size:1,update:["mana","manaSpeed",1E3],strID:"e_priest",nu:c.createPriest,attimg:l.flame_bolt},{radix:0,name:"Peasant",attackSound:Qg,
attack:5,defence:0,health:50,maxHealth:50,img:l.euro_peasant.idle,invType:0,invMax:8,dieSound:Ga,zLevel:1,validator:V,human:1,race:"euro",iconID:33,time:8,sight:5,url:l.euro_peasant,icons:[c.move,c.menuBuilds,c.repair,c.conquest,c.dcm,c.pickUp,c.explore,c.stop,c.stand,c.attack,c.bribe,c.sameSpeed,c.restoreSpeed],cost:[0,0,50,0],attDist:1,spd:50,clss:"peon",size:1,peon:1,strID:"e_peon",nu:c.createPeon,nocapture:1,standardFunc:Sg},{radix:0,clss:"cathedral",name:"Cathedral",dieSound:J,sound:["e_cathedral1",
"e_cathedral2"],resistance:700,health:5E3,maxHealth:5E3,img:l.euro_cathedral,invType:0,invMax:8,race:"euro",zLevel:1,validator:P,bimg:l.build5x5,dimg:l.des_5x5,iconID:60,icons:[c.createCrusaders,c.techFanaticism,c.techEspionage,c.techInquisition,c.techHealing,c.techBless,c.techCrusade,c.techMedicine],time:90,sight:8,child:[{img:l.euro_cathedral_c,x:0,y:0},{img:l.euro_cathedral_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,5]),url:l.euro_cathedral,
build:!0,cost:[2E3,0,0,2E3],onbuild:[c.buildChurch],size:1,strID:"cathedral"},{radix:0,name:"Castle",clss:"castle",dieSound:J,sound:["e_castle1"],resistance:700,health:8E3,maxHealth:8E3,img:l.euro_castle,invType:1,invMax:50,race:"euro",zLevel:1,validator:P,bimg:l.build6x6,dimg:l.des_6x6,iconID:59,time:120,sight:12,child:[{img:l.euro_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:l.euro_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[c.createPeon,c.createSpy,c.emergeAllUnits,c.techFeudalism,c.techArchitecture,c.techLearning],
space:new Uint8Array([0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,7]),menu:Ba,url:l.euro_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1,strID:"e_castle"},{radix:0,name:"Wooden Wall",clss:"wall_wood",resistance:700,health:2E3,maxHealth:2E3,img:l.wood_tower,time:6,sight:1,zLevel:1,dieSound:J,validator:V,bimg:l.wood_build,dimgInfinity:l.wood_debris,iconID:49,icons:[],mx:0,race:"common",my:0,hframe:71,menu:Ba,url:l.wood_tower,
wall:1,build:!0,cost:[0,0,20,0],size:1,strID:"woodwall",child:[{img:l.wood_tower_c,x:0,y:0}]},{radix:0,name:"Barracks",clss:"barracks",strID:"e_barrack",sound:Rg,generator:1,resistance:500,health:1400,maxHealth:1400,img:l.euro_barrack,invType:1,invMax:0,dieSound:J,time:60,sight:6,zLevel:1,race:"euro",validator:P,bimg:l.build5x5,dimg:l.des_5x5,child:[{img:l.euro_barracks_c,mv:!0},{img:l.euro_barrack_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:57,icons:[c.createFootman,c.createArcher,c.createMaceman,
c.createPikeman,c.createLongbowman,c.createKnight],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:l.euro_barrack,build:!0,cost:[0,200,0,200],size:1},{radix:0,strID:"e_lumber",name:"Lumber Mill",sound:["e_lumber1"],clss:"lumber_mill",resistance:500,health:800,maxHealth:800,img:l.euro_lumbermill,invType:1,invMax:0,time:30,race:"euro",sight:4,dieSound:J,zLevel:1,validator:P,bimg:l.build2x2,dimg:l.des_2x2,iconID:64,child:[{img:l.euro_lumbermill_c,x:0,y:0},{alpha:!0,img:l.euro_lumbermill_s,
x:0,y:0,rgb:[0,0,0,.5]}],icons:[c.techLongbow,c.techWoodCutting,c.techCrossbow],space:new Uint8Array([1,1,1,1,2]),hframe:98,url:l.euro_lumbermill,build:!0,cost:[0,100,0,0],storage:1,size:1},{radix:0,name:"Mage Tower",strID:"e_magetower",sound:["e_magetower1","e_magetower2","e_magetower3"],clss:"magictower",resistance:700,health:5E3,maxHealth:5E3,img:l.euro_magetower,invType:1,invMax:0,time:90,race:"euro",dieSound:J,sight:8,validator:P,bimg:l.build5x5,dimg:l.des_5x5,zLevel:1,child:[{img:l.euro_magetower_c,
x:0,y:0},{img:l.euro_magetower_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:71,icons:[c.createMage,c.techBat,c.techInvisibility,c.techLightning,c.techFreeze,c.techGolem],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:l.euro_magetower,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,strID:"e_waracademy",name:"Warriors Guild",sound:["e_waracademy1"],clss:"academy",resistance:700,health:5E3,maxHealth:5E3,img:l.euro_waracademy,invType:1,invMax:0,race:"euro",time:90,sight:8,dieSound:J,zLevel:1,
validator:P,bimg:l.build6x6,dimg:l.des_6x6,iconID:56,child:[{img:l.euro_waracademy_c,x:0,y:0,mv:!0},{img:l.euro_waracademy_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],icons:[c.techHeroism,c.techWarfare,c.techMercenaries,c.techSiegeTactics,c.techBodyBuilding,c.techLeadership,c.techTactics,c.techHeroes,c.techHonor,c.techFame],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,5]),url:l.euro_waracademy,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,name:"Storage",strID:"e_storage",sound:["e_storage1",
"e_storage2"],clss:"storage",resistance:80,health:800,maxHealth:800,img:l.euro_storage,invType:1,invMax:0,time:30,dieSound:J,zLevel:1,sight:5,validator:P,bimg:l.build4x4,dimg:l.des_4x4,iconID:69,race:"euro",icons:[c.techGoldMining,c.techStoneMining],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:l.euro_storage,storage:0,build:!0,cost:[0,200,0,0],size:1,child:[{img:l.euro_storage_c,x:0,y:0},{img:l.euro_storage_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Knight",strID:"e_knight",
dieSound:Wd,clss:"knight",attackSound:Ud,attack:12,defence:6,health:120,maxHealth:120,img:l.euro_knight.idle,invType:0,zLevel:1,race:"euro",invMax:8,validator:V,human:1,iconID:43,d2attack:2,time:22,sight:5,url:l.euro_knight,icons:e,cost:[120,0,70,0],attDist:1,spd:85,nu:c.createKnight,standardFunc:U,size:1},{radix:0,name:"Field",clss:"field",strID:"field",instantBuild:1,resistance:80,health:100,maxHealth:100,img:l.fields,invMax:0,validator:$g,zLevel:1,iconID:104,race:"common",icons:[],space:new Uint8Array([1,
1,1,1,1,1,1,1,1,3]),url:l.fields,build:!0,field:1,res:2,cost:[0,200,0,0],rndDirection:9,time:0,sight:1,z32:.5,size:1},{radix:0,name:"Golden rocks",mMapcolor:[148,148,0],strID:"gold",sound:["mine1"],clss:"golden_rocks",resistance:0,health:8E3,maxHealth:8E3,img:l.res_gold,invMax:0,validator:P,iconID:20,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:l.res_gold,build:!0,zLevel:1,race:"common",res:0,cost:[0,0,0,0],time:0,sight:2,dieSound:["destroy%20mine"],size:1,zolotoy:1,child:[{img:l.res_gold_s,
x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:l.res_gold},{radix:0,name:"Rocks",strID:"stone",mMapcolor:[132,132,132],sound:["mine1"],clss:"rocks",dieSound:["destroy%20mine"],resistance:0,health:8E3,maxHealth:8E3,img:l.res_stone,invMax:0,validator:P,zLevel:1,iconID:22,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:l.res_stone,build:!0,res:3,cost:[0,0,0,0],race:"common",time:0,sight:2,size:1,zolotoy:1,child:[{img:l.res_stone_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:l.res_stone},
{radix:0,name:"Farm",strID:"e_farm",sound:["e_farm1","e_farm2"],clss:"farm",resistance:0,health:800,maxHealth:800,img:l.euro_farm,invType:1,invMax:0,zLevel:1,validator:P,bimg:l.build4x4,dimg:l.des_4x4,iconID:61,dieSound:J,race:"euro",icons:[c.createCow,c.techCropRotation,c.techDomestication],space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Ba,url:l.euro_farm,build:!0,cost:[0,200,0,0],time:30,sight:5,storage:2,size:1,child:[{img:l.euro_farm_c,x:0,y:0}]},{radix:0,name:"Merchants Guild",
strID:"e_merchant",sound:["merchant"],clss:"merchants_guild",resistance:0,health:5E3,maxHealth:5E3,img:l.euro_tcguild,invType:1,invMax:0,validator:P,bimg:l.build6x6,zLevel:1,dimg:l.des_6x6,race:"euro",iconID:62,dieSound:J,icons:[c.techMapMaking,c.techTradeRoutes,c.techUsury,c.techSupplyStorage,c.techBribery,c.techTradeTaxes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),menu:Ba,url:l.euro_tcguild,build:!0,time:90,sight:8,cost:[2E3,0,0,2E3],onbuild:[c.buildMarket],size:1,
child:[{img:l.euro_tcguild_c,x:0,y:0},{img:l.euro_tcguild_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Church",clss:"church",strID:"e_church",sound:["e_church1"],resistance:0,health:800,maxHealth:800,img:l.euro_church,invType:1,invMax:0,dieSound:J,validator:P,bimg:l.build3x3,race:"euro",zLevel:1,dimg:l.des_3x3,iconID:139,icons:[c.createPriest],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),menu:Ba,url:l.euro_church,build:!0,cost:[0,0,200,200],time:40,sight:6,size:1,child:[{img:l.euro_church_c,
x:0,y:0},{img:l.euro_church_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Blacksmith",clss:"blacksmith",strID:"e_blacksmith",resistance:0,health:800,maxHealth:800,img:l.euro_blacksmith,invType:1,invMax:0,time:40,zLevel:1,sight:5,dieSound:J,validator:P,bimg:l.build4x4,race:"euro",dimg:l.des_4x4,child:[{img:l.euro_blacksmith_c,x:0,y:0}],iconID:58,icons:[c.techPlateArmor,c.techTemperIron,c.techScaleArmor,c.techHalberd,c.techChainMail],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Ba,
url:l.euro_blacksmith,build:!0,cost:[0,0,200,200],onbuild:b,size:1},{radix:0,name:"Cow",clss:"cow",nu:c.createCow,race:"common",strID:"cow",attack:0,defence:3,health:50,maxHealth:50,img:l.cow.idle,invType:0,invMax:8,zLevel:1,validator:V,iconID:99,time:20,dieSound:["cowdie1","cowdie2","cowdie3","cowdie4"],url:l.cow,icons:[c.move,c.stop],sight:3,cost:[0,0,300,0],attDist:0,spd:32,res:2,food:300,milk:50,milkMax:50,foodMax:600,size:1,cow:1,update:["milk","milkSpeed",1E3,"food","cowSpeed",1E3]},{radix:0,
name:"Stable",sound:["e_stables1"],clss:"stable",strID:"e_stable",onlyRequired:1,resistance:0,health:800,maxHealth:800,invType:1,invMax:0,race:"euro",zLevel:1,validator:P,bimg:l.build4x4,dimg:l.des_4x4,iconID:68,dieSound:J,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,4]),url:l.euro_stables,build:!0,cost:[0,200,0,0],onbuild:f,size:1,time:40,sight:5,img:l.euro_stables,nu:c.createCow,child:[{img:l.euro_stable_c,x:0,y:0}]},{radix:0,name:"Workshop",sound:["e_workshop1"],clss:"workshop",strID:"e_workshop",
zLevel:1,resistance:0,health:800,maxHealth:800,img:l.euro_workshop,invType:1,invMax:0,dieSound:J,validator:P,bimg:l.build4x4,race:"euro",dimg:l.des_4x4,iconID:75,icons:[c.createCatapult,c.createHeavyCatapult,c.createBallist,c.techEngineering,c.techCannonTower],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:l.euro_workshop,build:!0,cost:[0,200,200,0],size:1,time:40,sight:5,child:[{img:l.euro_workshop_c,x:0,y:0}]},{radix:0,name:"Tavern",sound:["e_tavern1"],clss:"tavern",strID:"e_tavern",
dieSound:J,resistance:0,health:1E3,maxHealth:1E3,img:l.euro_tavern,invType:1,invMax:0,validator:P,race:"euro",bimg:l.build4x4,dimg:l.des_4x4,zLevel:1,iconID:70,icons:[c.createMercenaries,c.createHeroes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4]),url:l.euro_tavern,build:1,cost:[0,200,200,0],onbuild:g,actvintv:[c.iniMercenaries,c.iniHeroes],size:1,time:40,sight:5,child:[{img:l.euro_tavern_c,x:0,y:0}]},{name:"House",sound:["house1","house2","house3","house4","house5"],clss:"house",strID:"e_house",
resistance:0,health:500,maxHealth:500,img:l.euro_houses,invType:1,invMax:0,validator:P,bimg:l.build3x3,dimg:l.des_3x3,race:"euro",iconID:73,zLevel:1,dieSound:J,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:l.euro_houses,build:!0,cost:[0,75,0,0],population:10,size:1,time:20,sight:4,child:[{img:l.euro_houses_c,x:0,y:0}]},{name:"Watch Tower",attackSound:Ye,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),clss:"watch_tower",strID:"watch_tower",attack:7,health:400,maxHealth:400,img:l.euro_tower_wood_2,
state:0,invType:1,race:"common",invMax:0,zLevel:1,dieSound:J,level:0,validator:P,child:[{img:l.euro_tower_wood_2_c,x:0,y:0},{alpha:!0,img:l.euro_tower_wood_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attimg:l.arrow1,attDist:8,bimg:l.build2x2,dimg:l.des_2x2,iconID:53,icons:[c.attack,c.stop,c.upgradeGuildTower],space:new Uint8Array([1,1,1,1,2]),url:l.euro_tower_wood_2,build:!0,cost:[0,300,0,0],size:1,arrow:!0,time:10,sight:15,standardFunc:U},{name:"Market",sound:["e_market1"],clss:"market",strID:"e_market",resistance:0,
health:1400,maxHealth:1400,img:l.euro_market,invType:1,invMax:0,dieSound:J,zLevel:1,validator:P,bimg:l.build4x4,dimg:l.des_4x4,iconID:65,race:"euro",icons:[c.createCaravan],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,4]),url:l.euro_market,build:!0,cost:[0,200,200,0],size:1,time:60,sight:8,child:[{img:l.euro_market_c,x:0,y:0}]},{name:"Outpost",sound:["e_outpost1"],clss:"outpost",strID:"e_outpost",zLevel:1,resistance:0,health:2E3,maxHealth:2E3,img:l.euro_outpost,invType:1,dieSound:J,invMax:50,
validator:P,race:"euro",bimg:l.build4x4,dimg:l.des_4x4,iconID:66,icons:[c.emergeAllUnits],space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,4]),url:l.euro_outpost,build:!0,cost:[0,200,0,400],size:1,child:[{img:l.euro_outpost_c,x:0,y:0},{img:l.euro_outpost_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{name:"Bridge",clss:"bridge",strID:"bridge",resistance:0,health:1E4,maxHealth:1E4,img:l.bridge_horz,invMax:0,valid2:!0,validator:tk,bimg:l.bridge_horz_build,race:"common",zLevel:1,dieSound:J,
child:[{alpha:!0,img:l.bridge_horz_s,x:0,y:0,rgb:[0,0,0,.5]},{img:l.bridge_horz1,x:0,y:0,z:6}],time:22,sight:1,dimg:l.bridge_horz_demol,iconID:44,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,11]),url:l.bridge_horz,build:!0,cost:[0,200,0,400],size:1},{name:"Dummy",clss:"dummy",strID:"dummy",resistance:0,health:5E3,maxHealth:5E3,img:l.dummy1,invMax:0,validator:V,
bimg:l.dummy1_b,iconID:165,icons:[],mx:0,zLevel:1,my:16,hframe:65,race:"common",url:l.dummy1,dimg:l.dummy1_d,build:!0,cost:[0,300,0,0],dummy:!0,child:[{img:l.dummy1_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:10,sight:1},{name:"Catapult",strID:"catapult",dieSound:$e,clss:"catapult",attackSound:Ze,defence:0,attack:10,health:110,maxHealth:110,img:l.catapult.idle,invMax:0,radix:0,validator:V,iconID:30,time:30,sight:20,race:"common",url:l.catapult,level:0,zLevel:1,icons:d,cost:[0,600,0,0],nofreeze:1,arrow:!1,
attDist:17,spd:40,standardFunc:U,size:1,attimg:l.cat_stone,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:c.createCatapult},{name:"Ballista",radix:0,strID:"ballista",attackSound:Ze,dieSound:$e,clss:"ballista",defence:0,attack:60,health:75,maxHealth:75,img:l.ballista.idle,invMax:0,validator:V,iconID:31,time:30,sight:16,nofreeze:1,race:"common",zLevel:1,url:l.ballista,icons:d,cost:[0,800,0,0],attDist:13,spd:40,standardFunc:U,size:1,attimg:l.arrow_ballista1,space:new Uint8Array([1,1,1,1,2]),attackDeg:30,
nu:c.createBallist},{name:"Heavy Catapult",strID:"heavy_catapult",attackSound:Ze,defence:0,attack:25,health:250,maxHealth:250,img:l.h_catapult.idle,invMax:0,radix:0,validator:V,iconID:45,time:60,dieSound:$e,sight:26,race:"common",url:l.h_catapult,zLevel:1,icons:d,standardFunc:U,cost:[0,1200,0,0],attDist:22,spd:40,nofreeze:1,clss:"heavy_catapult",size:1,attimg:l.cb_metal,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:c.createHeavyCatapult},{radix:0,name:"Ghost",strID:"ghost",defence:0,attack:8,
health:60,maxHealth:60,img:l.euro_ghost.idle,invType:0,invMax:8,dieSound:["ghost1","ghost2"],validator:V,iconID:178,zLevel:1,race:"common",time:15,attackSound:Si,sight:5,standardFunc:U,url:l.euro_ghost,icons:e,w:1,cost:[40,0,0,0],attDist:1,spd:80,clss:"ghost",size:1,nu:c.createGhost},{name:"Harbor",strID:"e_harbor",resistance:80,health:800,maxHealth:800,img:l.euro_harbor,invType:1,invMax:0,validator:eg,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:l.build_harbor,dimg:l.des_harbor,zLevel:1,
race:"euro",dieSound:J,iconID:63,icons:[c.createFishingBoat,c.createXebec,c.createHulk,c.createGalleon,c.techLandingTactics],clss:"harbor",url:l.euro_harbor,storage:4,build:!0,cost:[0,200,200,0],child:[{img:l.euro_harbor_c,x:0,y:0},{img:l.euro_harbor_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{radix:0,name:"Messiah",strID:"messiah",attack:50,defence:10,mana:1E3,manaMax:1E3,health:1E3,maxHealth:1E3,img:l.messiah.idle,invType:0,invMax:0,race:"common",validator:V,human:1,iconID:169,zLevel:1,
attackSound:["messiah_attack"],dieSound:["messiah"],time:300,sight:26,url:l.messiah,standardFunc:U,icons:e,cost:[2E3,0,0,0],attDist:10,spd:50,clss:"messiah",size:1,update:["mana","manaSpeed",1E3]},{name:"Magic Gateway",sound:["gateway"],strID:"gateway",magicGateway:1,resistance:0,health:Infinity,maxHealth:Infinity,img:l.teleport,invMax:0,validator:P,bimg:l.build4x4,zLevel:1,dieSound:J,race:"common",iconID:180,clss:"magic_gateway",icons:[c.createOrk,c.createDwarf,c.createGhost,c.createSkeleton],space:new Uint8Array([0,
1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,5]),url:l.teleport,build:!0,cost:[0,0,0,0],size:1,time:10,sight:10,zolotoy:1,child:[{img:l.teleport_c,x:0,y:0},{alpha:!0,img:l.teleport_s,x:0,y:0,rgb:[0,0,0,.5]}],standardFunc:yl},{name:"Guard Tower",strID:"guard_tower",race:"common",clss:"guard_tower",attackSound:Ye,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:12,health:1E3,maxHealth:1E3,img:l.euro_tower_wood,state:0,invType:1,invMax:0,dieSound:J,zLevel:1,validator:P,child:[{img:l.euro_tower_wood_c,
x:0,y:0},{alpha:!0,img:l.euro_tower_wood_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:12,bimg:l.build2x2,dimg:l.des_2x2,iconID:52,icons:[c.attack,c.stop,c.upgradeStoneTower,c.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:l.euro_tower_wood,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:l.arrow1,time:35,sight:16,standardFunc:U},{name:"Sword",attack:0,defence:0,health:25,maxHealth:25,img:l.items1,state:0,invMax:0,validator:Sb,iconID:16,url:l.items1,icons:[],cost:[0,0,0,0],size:1,zLevel:0,z32:.5,
radix:0,race:"common",item:1},{name:"Bow",attack:0,defence:0,health:25,maxHealth:25,img:l.items1,state:0,invMax:0,validator:Sb,iconID:4,url:l.items1,icons:[],cost:[0,0,0,0],size:1,z32:.5,zLevel:0,radix:0,race:"common",item:1},{name:"Shield",attack:0,defence:0,health:25,maxHealth:25,img:l.items1,state:0,invMax:0,validator:Sb,iconID:1,url:l.items1,icons:[],cost:[0,0,0,0],zLevel:0,race:"common",radix:0,size:1,z32:.5,item:1},{name:"Potion",attack:0,defence:0,health:25,maxHealth:25,img:l.potions,state:0,
invMax:0,validator:Sb,iconID:11,url:l.potions,icons:[],radix:0,race:"common",zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Book",attack:0,defence:0,health:25,maxHealth:25,img:l.book1,state:0,invMax:0,validator:Sb,iconID:9,zLevel:0,race:"common",radix:0,url:l.books,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Gold",health:1,maxHealth:1,img:l.item_gold,invMax:0,validator:Sb,iconID:20,radix:0,race:"common",zLevel:0,url:l.item_gold,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Stone",
health:1,maxHealth:1,img:l.item_stone,invMax:0,validator:Sb,iconID:22,race:"common",radix:0,url:l.item_stone,zLevel:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Food",health:15,maxHealth:15,img:l.item_food,invMax:0,mMapcolor:[0,255,255],validator:Sb,iconID:14,url:l.item_food,radix:0,race:"common",icons:[],zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{ignore:1,name:"Wood",health:1,maxHealth:1,img:l.item_wood,invMax:0,validator:Sb,iconID:15,url:l.item_wood,icons:[],race:"common",radix:0,
zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Iron",health:1,maxHealth:1,img:l.item_iron,invMax:0,validator:Sb,iconID:21,zLevel:0,race:"common",url:l.item_iron,radix:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Keep Tower",strID:"keep_tower",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:16,health:2E3,maxHealth:2E3,img:l.euro_tower_stone,state:0,invType:1,zLevel:1,attackSound:Ye,invMax:0,dieSound:J,validator:P,clss:"keep_tower",race:"common",child:[{alpha:!0,img:l.euro_tower_stone_s,
x:0,y:0,rgb:[0,0,0,.5]},{img:l.euro_tower_stone_c,x:0,y:0}],attDist:14,bimg:l.build2x2,dimg:l.des_2x2,standardFunc:U,iconID:54,icons:[c.attack,c.stop,c.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:l.euro_tower_stone,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:l.arrow_big1,time:40,sight:18},{name:"Cannon Tower",clss:"tower_stone2",strID:"tower_stone2",attackSound:Vd,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:40,health:2500,maxHealth:2500,img:l.euro_tower_stone_2,
state:0,invType:1,invMax:0,dieSound:J,race:"common",validator:P,zLevel:1,child:[{img:l.euro_tower_stone_2_c,x:0,y:0},{alpha:!0,img:l.euro_tower_stone_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:10,bimg:l.build2x2,dimg:l.des_2x2,iconID:54,icons:[c.attack,c.stop],space:new Uint8Array([1,1,1,1,2]),url:l.euro_tower_stone_2,build:!0,cost:[0,600,0,0],standardFunc:U,size:1,arrow:!1,attimg:l.hot_cannon,time:45,sight:18,attackDeg:30},{name:"Rocket Tower",strID:"tower_rocket",race:"asia",clss:"tower_rocket",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),
zLevel:1,attack:30,health:1400,maxHealth:1400,img:l.rocket_tower,state:0,invType:1,invMax:0,dieSound:J,validator:P,child:[{img:l.rocket_tower_c},{alpha:!0,img:l.rocket_tower_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:20,bimg:l.build2x2,dimg:l.des_2x2,iconID:186,icons:[],space:new Uint8Array([1,1,1,1,2]),url:l.rocket_tower,build:!0,cost:[0,600,0,0],standardFunc:U,size:1,arrow:!0,attimg:l.arrow_big1,time:60,sight:26},{radix:0,name:"Ork",race:"common",strID:"ork",dieSound:["orc%20die%201","orc%20die%202"],attackSound:Ri,
attack:18,defence:2,health:75,maxHealth:75,img:l.ork.idle,invType:0,invMax:8,validator:V,zLevel:1,iconID:143,time:12,sight:5,url:l.ork,standardFunc:U,icons:e,cost:[60,0,0,0],attDist:1,spd:50,clss:"ork",size:1,nu:c.createOrk},{radix:0,name:"Dwarf",race:"common",attack:7,defence:7,health:120,maxHealth:120,img:l.dwarf.idle,invType:0,strID:"dwarf",invMax:8,zLevel:1,dieSound:Ga,validator:V,iconID:185,time:12,sight:3,url:l.dwarf,standardFunc:U,icons:e,cost:[80,0,0,0],attDist:1,spd:50,clss:"dwarf",size:1,
nu:c.createDwarf},{radix:0,name:"Skeleton",strID:"skeleton",race:"common",dieSound:["skeleton%20die%201","skeleton%20die%202","skeleton%20die%203","skeleton%20die%204"],attack:4,defence:0,health:40,maxHealth:40,img:l.skeleton.idle,invType:0,zLevel:1,attackSound:Hc,invMax:8,nofreeze:1,validator:V,iconID:167,time:12,sight:3,url:l.skeleton,standardFunc:U,icons:e,cost:[0,0,30,0],attDist:1,spd:50,clss:"skeleton",size:1,nu:c.createSkeleton},{radix:0,name:"Caravan",race:"euro",strID:"e_caravan",attack:0,
defence:0,health:350,maxHealth:350,img:l.caravan.idle,invType:1,invMax:8,validator:V,iconID:34,zLevel:1,time:50,sight:7,url:l.caravan,icons:[c.move,c.trade,c.explore,c.stop,c.stand,c.unload],cost:[0,200,400,0],attDist:1,spd:75,clss:"caravan",size:1,nu:c.createCaravan},{name:"Castle",health:8E3,maxHealth:8E3,img:l.asia_castle,invType:1,strID:"a_castle",zLevel:1,race:"asia",invMax:50,validator:P,bimg:l.build6x6,dimg:l.des_6x6,iconID:164,time:120,sight:12,dieSound:J,clss:"castle",child:[{img:l.asia_castle_c,
x:0,y:0,mv:!0},{alpha:!0,img:l.asia_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[c.createPeon1,c.createNinja,c.emergeAllUnits,c.techFeudalism,c.techArchitecture,c.techLearning,c.techBuddhism,c.techGreatWall],space:new Uint8Array([0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,8]),menu:Ba,url:l.asia_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{name:"Castle",dieSound:J,clss:"castle",strID:"r_castle",
race:"arab",health:8E3,maxHealth:8E3,img:l.arab_castle,invType:1,invMax:50,validator:P,bimg:l.build6x6,dimg:l.des_6x6,zLevel:1,iconID:97,time:120,sight:12,child:[{img:l.arab_castle_c}],icons:[c.createPeon2,c.createSpy,c.emergeAllUnits,c.techFeudalism,c.techArchitecture,c.techLearning,c.techSlavery],space:new Uint8Array([0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,,8]),menu:Ba,url:l.arab_castle,build:!0,cost:[0,1500,
0,1500],storage:-1,castle:!0,population:20,size:1},{radix:0,name:"Peasant",attack:5,defence:0,health:50,maxHealth:50,img:l.asian_peasant.idle,invType:0,invMax:8,attackSound:Qg,race:"asia",validator:V,human:1,strID:"a_peon",iconID:132,standardFunc:Sg,dieSound:Ga,zLevel:1,time:8,peon:1,sight:5,url:l.asian_peasant,icons:[c.move,c.menuBuilds1,c.repair,c.conquest,c.dcm,c.pickUp,c.explore,c.stop,c.stand,c.attack,c.sameSpeed,c.restoreSpeed],cost:[0,0,40,0],attDist:1,spd:50,clss:"peon",nocapture:1,size:1},
{radix:0,name:"Ninja",race:"asia",attack:12,defence:5,mana:100,manaMax:100,health:90,maxHealth:90,img:l.asian_ninja.idle,invType:0,invMax:8,attackSound:Hc,validator:V,human:1,iconID:133,strID:"ninja",dieSound:Ga,zLevel:1,time:20,standardFunc:U,sight:10,url:l.asian_ninja,icons:[c.guard,c.patrol,c.pickUp,c.explore,c.stop,c.stand,c.invisibility,c.murder,c.move,c.attack,c.sameSpeed,c.restoreSpeed],cost:[120,0,0,0],attDist:1,spd:85,clss:"ninja",size:1,update:["mana","manaSpeed",1E3]},{radix:0,name:"Ronin",
attack:7,defence:0,health:45,maxHealth:45,img:l.asian_ronin.idle,invType:0,invMax:8,race:"asia",validator:V,human:1,standardFunc:U,iconID:141,strID:"ronin",dieSound:Ga,zLevel:1,time:8,sight:5,url:l.asian_ronin,icons:e,cost:[0,0,40,0],attDist:1,spd:50,attackSound:Hc,clss:"a_footman",size:1},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:l.asian_archer.idle,invType:0,invMax:8,race:"asia",validator:V,human:1,strID:"a_archer",dieSound:Ga,zLevel:1,attimg:l.arrow1,iconID:136,arrow:1,
attackSound:wd,time:12,sight:10,url:l.asian_archer,icons:e,cost:[0,20,40,0],standardFunc:U,spd:50,clss:"archer",size:1,attDist:6},{radix:0,name:"Samurai",attack:10,defence:4,health:90,maxHealth:90,img:l.asian_samurai.idle,invType:0,race:"asia",strID:"samurai",invMax:8,attackSound:Hc,validator:V,human:1,iconID:142,time:20,standardFunc:U,zLevel:1,dieSound:Ga,sight:6,url:l.asian_samurai,icons:e,cost:[50,0,150,0],attDist:1,spd:50,clss:"a_maceman",size:1},{radix:0,name:"Horse Archer",attack:7,defence:0,
health:75,maxHealth:75,img:l.asian_horsarcher.idle,invType:0,race:"asia",invMax:8,validator:V,human:1,attackSound:wd,iconID:183,strID:"a_horse_archer",dieSound:Wd,time:20,standardFunc:U,sight:12,url:l.asian_horsarcher,zLevel:1,icons:e,arrow:1,attimg:l.arrow1,cost:[40,0,120,0],spd:85,clss:"horse_archer",size:1,attDist:7},{radix:0,name:"Horse Samurai",attack:14,defence:4,health:160,maxHealth:160,img:l.asian_horsamurai.idle,invType:0,invMax:8,validator:V,human:1,iconID:135,race:"asia",standardFunc:U,
attackSound:Ud,time:22,zLevel:1,strID:"horse_samurai",dieSound:Wd,sight:5,url:l.asian_horsamurai,icons:e,cost:[75,0,120,0],attDist:1,spd:85,clss:"horse_samurai",size:1},{name:"Barracks",resistance:500,health:1400,maxHealth:1400,img:l.asia_barracks,invType:1,sound:Rg,invMax:0,time:60,dieSound:J,radix:0,sight:6,race:"asia",strID:"a_barrack",validator:P,zLevel:1,bimg:l.build5x5,dimg:l.des_5x5,child:[{img:l.asia_barracks_c,x:0,y:0,mv:!0},{img:l.asia_barracks_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:146,
icons:[c.createRonin,c.createArcher1,c.createSamurai,c.createHorseArcher1,c.createHorseSamurai,c.createChariot],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:l.asia_barracks,build:!0,cost:[0,200,0,200],size:1,clss:"barracks"},{name:"Chariot",attack:4,defence:3,health:180,maxHealth:180,img:l.asian_charriot.idle,invType:0,radix:0,race:"asia",invMax:8,strID:"chariot",dieSound:["c%20die%201","c%20die%202","c%20die%203","c%20die%204","c%20die%205"],attackSound:Ud,validator:V,
human:1,zLevel:1,iconID:175,standardFunc:U,time:8,sight:5,url:l.asian_charriot,icons:e,cost:[0,200,150,0],attDist:1,spd:85,clss:"chariot",size:1},{radix:1,name:"Galleon",attackSound:Vd,attack:35,attDist:12,race:"common",defence:0,health:1200,attackTime:2E3,maxHealth:1200,strID:"galleon",nu:c.createGalleon,img:l.galleon.idle,invType:1,invMax:24,dieSound:["ship%20sink"],zLevel:0,validator:Be,iconID:32,time:50,boat:!0,attimg:l.cb_metal,attackDeg:20,sight:16,url:l.galleon,icons:[c.move,c.explore,c.unload,
c.attack,c.attackGround,c.stop,c.stand,c.stop,c.stand,c.attack,c.steady,c.upgradeShip],cost:[0,1200,800,0],spd:50,nofreeze:1,clss:"galleon",standardFunc:U,size:1,peon:1},{radix:1,name:"Fishing Boat",attackSound:Vd,attack:0,attDist:8,race:"common",defence:0,health:50,boat:!0,nu:c.createFishingBoat,maxHealth:50,img:l.boat.idle,invType:1,invMax:0,strID:"fishing_boat",dieSound:["ship%20sink"],zLevel:0,validator:Be,iconID:184,nofreeze:1,time:50,sight:16,url:l.boat,icons:[c.move,c.explore,c.stop,c.stand,
c.fishing],cost:[0,200,100,0],spd:65,clss:"fishing_boat",size:1},{radix:1,name:"Hulk",attackSound:Vd,attack:18,attDist:10,race:"common",defence:0,health:700,maxHealth:700,strID:"hulk",img:l.hulk.idle,invType:1,attackTime:2E3,boat:!0,nu:c.createHulk,attackDeg:20,invMax:16,dieSound:["ship%20sink"],zLevel:0,validator:Be,iconID:128,time:30,sight:14,attimg:l.cb_metal,url:l.hulk,icons:[c.move,c.explore,c.unload,c.attack,c.attackGround,c.stop,c.stand,c.stop,c.stand,c.attack,c.steady,c.upgradeShip],cost:[0,
500,300,0],spd:65,nofreeze:1,clss:"hulk",standardFunc:U,size:1},{radix:1,name:"Pinque",attackSound:wd,attack:10,race:"common",attDist:8,defence:0,health:300,boat:!0,maxHealth:300,img:l.xebec.idle,attimg:l.arrow1,arrow:!0,strID:"pinque",invType:1,invMax:8,dieSound:["ship%20sink"],zLevel:0,validator:Be,iconID:129,time:20,nofreeze:1,sight:12,url:l.xebec,icons:[c.move,c.explore,c.unload,c.attack,c.attackGround,c.stop,c.stand,c.stop,c.stand,c.attack,c.steady,c.upgradeShip],cost:[0,300,200,0],spd:80,clss:"xebec",
size:1,standardFunc:U,nu:c.createXebec},{radix:0,name:"Stone Golem",strID:"troll",defence:3,attack:25,health:400,maxHealth:400,img:l.troll.idle,invType:0,invMax:0,dieSound:["golem"],validator:V,iconID:144,race:"common",zLevel:1,nofreeze:1,attackSound:["golem1","golem2"],sight:10,standardFunc:U,url:l.troll,icons:e,w:1,cost:[120,0,0,0,600],attDist:1,spd:56,clss:"troll",size:1},{radix:0,name:"Bat",strID:"bat",defence:0,attack:3,health:20,maxHealth:20,img:l.bat.move,invType:0,invMax:0,race:"common",bat:1,
dieSound:["bat%20die"],validator:fg,iconID:105,zLevel:2,attackSound:["bat%20attack"],sight:10,standardFunc:U,url:l.bat,icons:e,w:1,cost:[0,0,0,0,25],attDist:1,spd:128,clss:"bat",size:1,z32:1.5},{race:"arab",invType:0,invMax:8,iconID:138,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.arab_peasant,img:l.arab_peasant.idle,spd:50,validator:V,human:1,icons:[c.move,c.menuBuilds2,c.repair,c.conquest,c.dcm,c.pickUp,c.explore,c.stop,c.stand,c.attack,c.convertJihad,c.bribe,c.sameSpeed,c.restoreSpeed],
name:"Peasant",clss:"peon",cost:[0,0,50,0],attDist:1,time:8,nocapture:1,standardFunc:Sg,peon:1,sight:5,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:172,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.arab_footman,img:l.arab_footman.idle,standardFunc:U,spd:50,validator:V,human:1,attDist:1,icons:e,name:"Footman",clss:"footman",cost:[0,0,50,0],time:12,sight:5,health:50,attack:6,defence:1},{race:"arab",invType:0,invMax:8,iconID:170,zLevel:1,dieSound:[],attackSound:[],
size:1,radix:0,url:l.arab_archer,img:l.arab_archer.idle,spd:50,validator:V,standardFunc:U,human:1,attimg:l.arrow1,arrow:1,icons:e,name:"Archer",clss:"archer",cost:[0,20,40,0],time:12,sight:10,attDist:6,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:173,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.arab_spearman,img:l.arab_spearman.idle,spd:50,validator:V,standardFunc:U,human:1,icons:e,name:"Spearman",clss:"pikeman",attDist:1,cost:[40,0,60,0],time:14,sight:5,health:75,
attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:174,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,standardFunc:U,url:l.arab_satrap,img:l.arab_satrap.idle,spd:50,validator:V,human:1,icons:e,name:"Satrap",attDist:1,clss:"maceman",cost:[0,0,120,0],time:14,sight:5,health:120,attack:8,defence:0},{race:"arab",invType:0,invMax:8,iconID:171,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.arab_cavalry,standardFunc:U,img:l.arab_cavalry.idle,spd:85,validator:V,human:1,attDist:1,icons:e,
name:"Cavalry",clss:"heavy_cavalry",cost:[60,0,100,0],time:14,sight:5,health:90,attack:10,defence:4},{race:"arab",invType:0,invMax:8,iconID:168,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.arab_horse_archer,img:l.arab_horse_archer.idle,spd:85,validator:V,human:1,standardFunc:U,icons:e,name:"Horse Archer",clss:"horse_archer",cost:[50,0,100,0],time:14,attimg:l.arrow1,arrow:1,sight:12,attDist:7,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:179,zLevel:1,dieSound:[],
attackSound:[],size:1,radix:0,url:l.arab_jwarrior,img:l.arab_jwarrior.idle,spd:50,validator:V,human:1,standardFunc:U,icons:e,name:"Jihad warrior",attDist:1,clss:"jihad_warrior",cost:[0,0,100,0],time:8,sight:5,health:75,attack:10,defence:2},{race:"arab",invType:0,invMax:8,iconID:176,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.arab_priest,img:l.arab_priest.idle,standardFunc:U,spd:50,mana:100,validator:V,human:1,icons:h,name:"Priest",clss:"priest",cost:[150,0,0,0],time:30,sight:21,attDist:18,
health:60,attack:20,update:["mana","manaSpeed",1E3],manaMax:100,defence:0,attimg:l.flame_bolt,ball:1,attackOnly:Ae.magic_creatures.obj},{race:"arab",invType:0,invMax:0,iconID:105,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:0,img:0,testing:1,illegal:1,spd:50,validator:V,human:1,icons:[],name:"Spy",clss:"spy",cost:150,time:30,sight:12,health:50,attack:20,defence:0},{race:"arab",invType:0,invMax:8,iconID:188,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,attimg:l.flame_bolt,url:l.arab_mage,
img:l.arab_mage.idle,spd:50,validator:V,human:1,icons:[c.stop,c.pickUp,c.explore,c.createCarpet,c.createJinn,c.fireRain,c.magicVision,c.raiseDead,c.attack,c.stand,c.move],standardFunc:U,name:"Mage",clss:"mage",ball:1,mana:100,manaMax:100,update:["mana","manaSpeed",1E3],cost:[150,0,0,0],time:30,sight:15,attDist:10,health:60,attack:8,defence:0},{race:"arab",invType:1,invMax:8,iconID:126,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.arab_caravan,img:l.arab_caravan.idle,spd:75,validator:V,
human:1,icons:[],name:"Caravan",clss:"trader",cost:[0,0,500,0],time:30,sight:5,health:150},{race:"arab",invType:0,invMax:8,iconID:177,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.arab_enichar,img:l.arab_enichar.idle,spd:85,validator:V,human:1,standardFunc:U,icons:e,name:"Enichar",attDist:1,clss:"enichar",cost:[80,0,120,0],time:25,sight:5,health:130,attack:18,defence:4},{race:"arab",invType:1,invMax:0,iconID:82,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:l.build3x3,
dimg:l.des_3x3,radix:0,population:10,url:l.arab_houses,validator:P,build:1,icons:[],child:[{img:l.arab_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],time:20,sight:4,resistance:50,health:500},{race:"arab",invType:1,invMax:0,iconID:85,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:l.build3x3,dimg:l.des_3x3,radix:0,url:l.arab_lumbermill,validator:P,build:1,icons:[c.techWoodCutting,c.techCrossbow],child:[{img:l.arab_lumbermill_c}],name:"Lumber Mill",clss:"lumber",cost:[0,
100,0,0],storage:1,time:30,sight:4,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:96,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.arab_storage,validator:P,build:1,storage:0,icons:[c.techGoldMining,c.techStoneMining],child:[{img:l.arab_storage_c},{alpha:!0,img:l.arab_storage_s,rgb:[0,0,0,.5]}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,
invMax:0,iconID:80,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.arab_farm,validator:P,build:1,icons:[c.createCow,c.techCropRotation,c.techDomestication,c.techCowPoaching,c.ridingHorses,c.techHorseManShip],child:[{img:l.arab_farm_c}],name:"Farm",storage:2,clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:81,zLevel:1,dieSound:J,validator:eg,space:new Uint8Array([1,
1,0,0,1,1,1,1,1,1,1,1,4]),bimg:l.build_harbor,dimg:l.des_harbor,radix:0,url:l.arab_harbour,build:1,icons:[c.createFishingBoat,c.createXebec,c.createHulk,c.techLandingTactics],child:[{img:l.arab_harbour_c},{alpha:!0,img:l.arab_harbour_s,rgb:[0,0,0,.5]}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:79,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:l.build3x3,dimg:l.des_3x3,radix:0,url:l.arab_blacksmith,
validator:P,build:1,icons:[c.techTemperIron,c.techScaleArmor,c.techScimitar,c.techChainMail,c.techHalberd],child:[{img:l.arab_blacksmith_c},{alpha:!0,img:l.arab_blacksmith_s,rgb:[0,0,0,.5]}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],onbuild:b,time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:95,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.arab_workshop,validator:P,build:1,icons:[c.createCatapult,
c.createBallist,c.techEngineering,c.techCannonTower],child:[{img:l.arab_workshop_c},{alpha:!0,img:l.arab_workshop_s,rgb:[0,0,0,.5]}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:140,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:l.build3x3,dimg:l.des_3x3,radix:0,url:l.arab_church,validator:P,build:1,icons:[c.createPriest2],child:[{img:l.arab_church_c},{alpha:!0,img:l.arab_church_s,rgb:[0,0,
0,.5]}],name:"Church",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"arab",invType:1,invMax:0,iconID:92,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.arab_tavern,validator:P,build:1,icons:[c.createMercenaries,c.createHeroes],child:[{img:l.arab_tavern_c}],name:"Tavern",clss:"tavern",cost:[0,200,200,0],onbuild:g,actvintv:[c.iniMercenaries,c.iniHeroes],time:40,sight:5,resistance:150,health:1E3},
{race:"arab",invType:1,invMax:0,iconID:87,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.arab_market,validator:P,build:1,icons:[c.createCaravan2],child:[{img:l.arab_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:98,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:l.build5x5,dimg:l.des_5x5,
radix:0,url:l.arab_barracks,validator:P,build:1,icons:[c.createFootman2,c.createArcher2,c.createSatrap,c.createPikeman2,c.createHorseArcher2,c.createCavalry,c.createEnichar,c.createJihad],child:[{img:l.arab_barracks_c},{alpha:!0,img:l.arab_barracks_s,rgb:[0,0,0,.5]}],name:"Barracks",clss:"barrack",cost:[0,0,200,200],time:60,sight:6,resistance:500,health:1400},{race:"arab",invType:1,invMax:0,iconID:91,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,
radix:0,url:l.arab_stables,validator:P,build:1,icons:[],child:[{img:l.arab_stables_c}],name:"Stable",clss:"stable",cost:[0,200,200,0],time:40,onbuild:f,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:50,iconID:89,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.arab_outpost,validator:P,build:1,icons:[c.emergeAllUnits],child:[{img:l.arab_outpost_c,mv:1},{alpha:!0,img:l.arab_outpost_s,rgb:[0,0,0,.5]}],name:"Outpost",
clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"arab",invType:1,invMax:0,iconID:105,zLevel:1,dieSound:J,space:23213123,bimg:l.build3x3,dimg:l.des_3x3,radix:0,url:0,img:0,validator:P,build:1,icons:[],child:[{img:3213123}],name:"NULL",testing:1,clss:"castle",cost:[0,1500,0,1500],time:120,sight:12,resistance:1E3,health:8E3},{race:"arab",invType:1,invMax:0,iconID:88,zLevel:1,dieSound:J,space:new Uint8Array([0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
0,1,1,1,1,0,0,6]),bimg:l.build5x5,dimg:l.des_5x5,radix:0,url:l.arab_mosque,validator:P,build:1,icons:[c.techFanaticism,c.techEspionage,c.techHealing,c.techBless,c.techJihad],child:[{img:l.arab_mosque_c},{alpha:!0,img:l.arab_mosque_s,rgb:[0,0,0,.5]}],name:"Mosque",onbuild:[c.buildChurch2],clss:"mosque",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:86,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,4]),bimg:l.build4x4,
dimg:l.des_4x4,radix:0,url:l.arab_magetower,validator:P,build:1,icons:[c.createMage2,c.techCarpet,c.techMagicWorkshop,c.techFireRain,c.techMagicVision,c.techNecromancy,c.techJinn],child:[{img:l.arab_magetower_c},{alpha:!0,img:l.arab_magetower_s,rgb:[0,0,0,.5]}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:93,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5]),bimg:l.build5x5,
dimg:l.des_5x5,radix:0,url:l.arab_tc_guild,validator:P,build:1,icons:[c.techUsury,c.techTradeRoutes,c.techSupplyStorage,c.techBribery,c.techOreFloatation],child:[{img:l.arab_tcguild_c},{alpha:!0,img:l.arab_tc_guild_s,rgb:[0,0,0,.5]}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[c.buildMarket2],sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:94,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:l.build5x5,
dimg:l.des_5x5,radix:0,url:l.arab_waracademy,validator:P,build:1,icons:[c.techHeroism,c.techWarfare,c.techMercenaries,c.techRiddingHorses,c.techBodyBuilding,c.techLeadership,c.techHeroes,c.techJanissary,c.techHonor,c.techFame],child:[{img:l.arab_waracademy_c},{alpha:!0,img:l.arab_waracademy_s,rgb:[0,0,0,.5]}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:158,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,
1,1,1,1,1,1,3]),bimg:l.build3x3,dimg:l.des_3x3,radix:0,url:l.arab_magicworkshop,validator:P,build:1,icons:[c.createObjects],child:[{img:l.arab_magicworkshop_c},{alpha:!0,img:l.arab_magicworkshop_s,rgb:[0,0,0,.5]}],name:"Magic Workshop",disallowPoint:!0,clss:"magicworkshop",cost:[0,0,0,300],time:20,sight:5,resistance:200,health:1200},{race:"asia",invType:1,invMax:0,iconID:161,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,0,1,3]),bimg:l.build3x3,dimg:l.des_3x3,radix:0,url:l.asia_houses,validator:P,
build:1,icons:[],child:[{img:l.asia_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],population:10,time:20,sight:4,resistance:50,health:500},{race:"asia",invType:1,invMax:0,iconID:149,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),bimg:l.build3x3,dimg:l.des_3x3,radix:0,storage:1,url:l.asia_lumbermill,validator:P,build:1,icons:[c.techWoodCutting,c.techCrossbow],child:[{img:l.asia_lumbermill_c},{img:l.asia_lumbermill_s,rgb:[0,0,0,.5],alpha:!0}],name:"Lumber Mill",clss:"lumber",
cost:[0,100,0,0],time:30,sight:4,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:154,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.asia_storage,storage:0,validator:P,build:1,icons:[c.techGoldMining,c.techStoneMining],child:[{img:l.asia_storage_s,rgb:[0,0,0,.5],alpha:!0},{img:l.asia_storage_c}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,
invMax:0,iconID:147,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,storage:2,url:l.asia_farm,validator:P,build:1,icons:[c.techCropRotation,c.ridingHorses,c.irrigation],child:[{img:l.asia_farm_c}],name:"Farm",clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:148,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),validator:eg,bimg:l.build_harbor,dimg:l.des_harbor,
radix:0,url:l.asia_harbor,build:1,icons:[c.createFishingBoat,c.createXebec,c.createHulk,c.techLandingTactics],child:[{img:l.asia_harbor_c},{img:l.asia_harbor_s,rgb:[0,0,0,.5],alpha:!0}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:145,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:l.build5x5,dimg:l.des_5x5,radix:0,url:l.asia_blacksmith,validator:P,build:1,icons:[c.techTemperIron,
c.techScaleArmor,c.techArmoredChariot,c.techChainMail],child:[{img:l.asia_blacksmith_c},{img:l.asia_blacksmith_s,rgb:[0,0,0,.5],alpha:!0}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],time:40,sight:5,onbuild:b,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:157,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.asia_workshop,validator:P,build:1,icons:[c.createCatapult,c.createBallist,c.techEngineering,
c.techCannonTower],child:[{img:l.asia_workshop_c,x:0,y:0},{img:l.asia_workshop_s,rgb:[0,0,0,.5],alpha:!0}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:162,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,0,5]),bimg:l.build5x5,dimg:l.des_5x5,radix:0,url:l.asian_monastery,validator:P,build:1,icons:[c.createMonk,c.createPriest1],child:[{img:l.asian_monastery_c},{img:l.asian_monastery_s,
rgb:[0,0,0,.5],alpha:!0}],name:"Monastery",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"asia",invType:1,invMax:0,iconID:155,zLevel:1,dieSound:J,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.asia_tavern,validator:P,build:1,icons:[c.createMercenaries,c.createHeroes],child:[{img:l.asia_tavern_c},{img:l.asia_tavern_s,rgb:[0,0,0,.5],alpha:!0}],onbuild:g,name:"Tavern",clss:"tavern",actvintv:[c.iniMercenaries,
c.iniHeroes],cost:[0,200,200,0],time:40,sight:5,resistance:150,health:1E3},{race:"asia",invType:1,invMax:0,iconID:150,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.asia_market,validator:P,build:1,icons:[],child:[{img:l.asia_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:153,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,0,1,1,1,
1,1,1,1,1,1,1,1,1,4]),bimg:l.build4x4,dimg:l.des_4x4,radix:0,url:l.asia_stables,validator:P,build:1,icons:[],child:[{img:l.asia_stables_c,mv:!0},{img:l.asia_stables_s,rgb:[0,0,0,.5],alpha:!0}],name:"Stable",clss:"stable",onbuild:f,cost:[0,200,200,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:151,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:l.build3x3,dimg:l.des_3x3,radix:0,url:l.asia_outpost,validator:P,build:1,icons:[c.emergeAllUnits],
child:[{img:l.asia_outpost_c,mv:1},{img:l.asia_outpost_s,rgb:[0,0,0,.5],alpha:!0}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"asia",invType:1,invMax:0,iconID:163,zLevel:1,dieSound:J,space:new Uint8Array([0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,6]),bimg:l.build6x6,dimg:l.des_6x6,radix:0,url:l.asia_shao_lin,validator:P,build:1,icons:[c.techMeditation,c.techKungFu,c.techHealing,c.techPhilosophy,c.techNinjas,c.techMastery,
c.techTournaments,c.techMedicine],child:[{img:l.asia_shao_lin_c},{img:l.asia_shao_lin_s,rgb:[0,0,0,.5],alpha:!0}],name:"Shao Linn",onbuild:[c.buildChurch1],clss:"shaolinn",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:152,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:l.build5x5,dimg:l.des_5x5,radix:0,url:l.asia_wizardguild,validator:P,build:1,icons:[c.createMage1,c.techConcentration,c.techWhirlpool,
c.techFlameBolt,c.techTurnToStone,c.techConfusion,c.techDragon],child:[{img:l.asia_wizardguild_c},{img:l.asia_wizardguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:159,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:l.build5x5,dimg:l.des_5x5,radix:0,url:l.asia_tcguild,validator:P,build:1,icons:[c.techTradeRoutes,c.techUsury,
c.techJewelry,c.techSupplyStorage,c.techBanking,c.techChemistry,c.techSeaFood,c.techGunPowder,c.techRocketArrow],child:[{img:l.asia_tcguild_c,mv:!0},{img:l.asia_tcguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[c.buildMarket1],sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:156,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:l.build5x5,dimg:l.des_5x5,radix:0,url:l.asia_warguild,
validator:P,build:1,icons:[c.techBushido,c.techHeroism,c.techWarfare,c.techMercenaries,c.techLeadership,c.techTactics,c.techHeroes,c.techHonor,c.techSunTzu],child:[{img:l.asia_warguild_c,mv:!0},{img:l.asia_warguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:0,invMax:0,iconID:166,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.asian_priest,img:l.asian_priest.idle,spd:50,validator:V,human:1,
icons:[c.attack,c.stop,c.stand,c.pickUp,c.explore,c.healing,c.teach,c.move],name:"Priest",clss:"priest",cost:[170,0,0,0],time:30,sight:21,health:120,standardFunc:U,attDist:1,attack:10,defence:10,mana:100,update:["mana","manaSpeed",1E3],manaMax:100},{race:"asia",invType:0,invMax:0,iconID:187,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.asian_monk,img:l.asian_monk.idle,spd:50,validator:V,human:1,icons:e,name:"Monk",standardFunc:U,clss:"monk",cost:[0,0,200,0],time:20,sight:5,health:90,attack:6,
defence:6,attDist:1},{race:"asia",invType:0,invMax:0,iconID:134,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:l.asian_mage,img:l.asian_mage.idle,spd:50,attimg:l.flame_bolt,validator:V,standardFunc:U,human:1,icons:[c.stop,c.pickUp,c.explore,c.confusion,c.turnToStone,c.whirlpool,c.flameBolt,c.createDragon,c.attack,c.stand,c.move],name:"Mage",clss:"mage",cost:[150,0,0,0],ball:1,time:30,sight:15,mana:100,attDist:10,health:60,attack:8,defence:0,update:["mana","manaSpeed",1E3],manaMax:100},{radix:0,
name:"Dragon",strID:"dragon",defence:0,attack:25,health:300,maxHealth:300,img:l.dragon.idle,invType:0,invMax:0,dieSound:[],sSizex:2,sSizey:2,dragon:1,iconID:160,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:12,standardFunc:U,url:l.dragon,icons:e,cost:[80,0,0,0,800],attDist:2,spd:128,clss:"drg",size:1,z32:1.5,validator:fg},{radix:0,name:"Carpet",strID:"carpet",defence:0,attack:0,health:90,maxHealth:90,img:l.carpet.idle,invType:1,invMax:8,dieSound:[],iconID:131,race:"common",zLevel:2,nofreeze:1,
attackSound:[],sight:8,url:l.carpet,icons:[c.move,c.unload,c.explore,c.stop,c.stand],cost:[80,0,0,0,500],attDist:2,spd:120,clss:"carpet",size:1,z32:1.5,validator:fg},{radix:0,name:"Jinn",strID:"jinn",defence:5,attack:20,health:300,maxHealth:300,img:l.arab_jinn.idle,invType:0,invMax:0,dieSound:[],validator:V,iconID:182,race:"common",zLevel:1,nofreeze:1,attackSound:[],sight:8,standardFunc:U,url:l.arab_jinn,icons:e,w:1,cost:[80,0,0,0,300],attDist:1,spd:85,clss:"jinn",size:1}];xd={};Yh={arr:[]};tb={euro:[],
asia:[],arab:[],common:[]};uk=[];hb=[[],[],[],[],[],[]];n=0;for(k=u.length;n<k;n++){m=u[n];u[n].type=n;var p=m.space;m.name.split(" ").join("");m.population&&uk.put(m);xd[n]={};void 0!==m.storage&&(-1<m.storage?(0===m.storage&&hb[3].put(n),hb[m.storage].put(n)):(hb[0].put(n),hb[1].put(n),hb[2].put(n),hb[3].put(n)));La[m.race][m.name.toLowerCase().split(" ").join("")]=m;m.icons.menuName=m.strID;Yh[m.name]=n;Yh.arr.put(n);m.img||(m.img=m.url);m.maxHealth=m.health;m.race&&tb[m.race].put(m);g=0;f=m.icons;
for(h=f.length;g<h;g++)(d=f[g])&&d.obj&&(d.orderOrigin=m);if(p){g=[];m.free=g;d=p[p.length-1];b=(p.length-1)/d;m=d+2;h=b+2;f=new Uint8Array(m*h);for(v=0;v<b;v++)for(var q=0;q<d;q++)f[(v+1)*m+q+1]=p[q+v*d];v=0;for(h*=m;v<h;v++)!f[v]&&(f[v+1]||f[v-1]||f[v+1+m]||f[v+1-m]||f[v-1+m]||f[v-1-m]||f[v+m]||f[v-m])&&(g.put(v%m-1),g.put(~~(v/m)-1))}}tb.euro=tb.euro.concat(tb.common);tb.asia=tb.asia.concat(tb.common);tb.arab=tb.arab.concat(tb.common);tb[0]=tb.euro;tb[1]=tb.arab;tb[2]=tb.asian;f=La.euro;h=La.asia;
d=La.arab;b=La.common;La[0]=La.euro;La[1]=La.arab;La[2]=La.asia;pd||(e.cut=S({a:"attack",g:"guard",r:"patrol",p:"pickUp",e:"explore",s:"stop",n:"stand"}),f.tavern.icons.cut=S({t:"trade1",g:"gamble",m:"createMercenaries",h:"createHeroes",l:"loan"}),f.castle.icons.cut=S({p:"createPeon",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning"}),h.castle.icons.cut=S({p:"createPeon1",n:"createNina",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",
b:"techBudhism",w:"techGreatwall"}),d.castle.icons.cut=S({p:"createPeon2",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",y:"techSlavery"}),f.barracks.icons.cut=S({f:"createFootman",a:"createArcher",m:"createMaceman",p:"createPikeman",l:"createLongbowman",k:"createKnight"}),h.barracks.icons.cut=S({r:"createRonin",a:"createArcher1",s:"createSamurai",h:"createHorseArcher1",o:"createHorseSamurai",c:"createChariot"}),d.barracks.icons.cut=S({f:"createFootman2",
a:"createArcher2",s:"createSatrap",p:"createPikeman2",h:"createHorseArcher2",c:"createCavalry",j:"createEnichar",d:"createJihad"}),f.magetower.icons.cut=S({m:"createMage"}),h.mageguild.icons.cut=S({m:"createMage1"}),d.mageguild.icons.cut=S({m:"createMage2"}),f.peasant.icons.cut=S({b:"menuBuilds",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",i:"bribe"}),d.peasant.icons.cut=S({b:"menuBuilds2",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",
a:"attack",j:"become_jihadw",i:"bribe"}),h.peasant.icons.cut=S({b:"menuBuilds1",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",t:"trade"}),f.priest.icons.cut=S({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),d.priest.icons.cut=S({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),h.priest.icons.cut=S({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",r:"raiseexp"}),f.wizard.icons.cut=S({m:"move",
a:"attack",s:"stop",n:"stand",l:"lightning",b:"createBat",f:"freeze",t:"createGolem",i:"invisibility"}),d.mage.icons.cut=S({m:"move",a:"attack",s:"stop",n:"stand",c:"spell_spawncarpet",j:"spell_spawnjin",r:"spell_firerain",v:"spell_magicvision",d:"raisedead"}),h.mage.icons.cut=S({m:"move",a:"attack",s:"stop",n:"stand",h:"spell_hypnotize",t:"spell_turntostone",w:"spell_whirlpool",f:"spell_flamebolt",d:"spell_spawndragon"}),b.spy.icons.cut=S({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",
n:"stand",s:"stop"}),h.monk.icons.cut=S({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"}),h.ninja.icons.cut=S({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand",c:"cloak",u:"murder"}),b.catapult.icons.cut=S({a:"attack",g:"guard",p:"patrol",e:"explore",s:"stop",n:"stand",r:"attack_ground",h:"hold_steady"}),f.market.icons.cut=S({c:"createCaravan"}),d.market.icons.cut=S({c:"createCaravan2"}),h.market.icons.cut=S({b:"market_items",s:"market_sell"}),
f.workshop.icons.cut=S({c:"createCatapult",h:"createHeavyCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),d.workshop.icons.cut=S({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),h.workshop.icons.cut=S({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),f.church.icons.cut=S({p:"createPriest"}),d.church.icons.cut=S({p:"createPriest2"}),h.monastery.icons.cut=S({m:"createMonk",p:"createPriest1"}),d.magicworkshop.icons.cut=
S({i:"build_item"}),e=S({c:"buildCastle",s:"buildStorage",b:"buildBarrack",k:"buildBlacksmith",f:"buildFarm",l:"buildLumbermill",p:"buildWorkshop",e:"buildCathedral",u:"buildChurch",n:"buildTavern",m:"buildMageTower",a:"buildStable",r:"buildHarbor",o:"buildOutpost",i:"buildFields",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse",g:"buildGateWood",y:"buildDummy"}),g=S({c:"buildCastle2",k:"buildBlacksmith2",f:"buildFarm2",n:"buildTavern2",b:"buildBarrack2",p:"buildWorkshop2",s:"buildStorage2",
a:"buildStable2",l:"buildLumbermill2",r:"buildHarbor2",o:"buildOutpost2",u:"buildChurch2",e:"buildMosque",i:"buildFields",m:"buildMageTower2",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse2",g:"buildGateWood"}),n=S({c:"buildCastle1",f:"buildFarm1",e:"buildShaolinn",n:"buildTavern1",b:"buildBarrack1",p:"buildWorkshop1",s:"buildStorage1",k:"buildBlacksmith1",a:"buildStable1",l:"buildLumbermill1",r:"buildHarbor1",o:"buildOutpost1",u:"buildChurch1",i:"buildFields",m:"buildMageTower1",
w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse1",g:"buildGateWood"}),Ce.cut=n,De.cut=n,Ee.cut=e,Fe.cut=e,Ge.cut=e,He.cut=n,Ie.cut=e,Je.cut=n,Ke.cut=g,Le.cut=g,Me.cut=g,Ne.cut=g,f.lumbermill.icons.cut=S({b:"techLongbow",w:"techWoodCutting",c:"techCrossbow"}),d.lumbermill.icons.cut=S({w:"techWoodCutting",c:"techCrossbow"}),h.lumbermill.icons.cut=S({w:"techWoodCutting",c:"techCrossbow"}),f.blacksmith.icons.cut=S({p:"techPlateArmor",t:"techTemperIron",s:"techScaleArmor",h:"techHalberd",
c:"techChainMail"}),d.blacksmith.icons.cut=S({t:"techTemperIron",a:"techScaleArmor",s:"techScimitar",c:"techChainMail",h:"techHalberd"}),h.blacksmith.icons.cut=S({t:"techTemperIron",a:"techScaleArmor",r:"techArmoredChariot",c:"techChainMail"}),f.outpost.icons.cut=S({e:"emergeAllUnits"}),d.outpost.icons.cut=S({e:"emergeAllUnits"}),h.outpost.icons.cut=S({e:"emergeAllUnits"}),b.watchtower.icons.cut=S({a:"attack",s:"stop",g:"upgradeGuildTower"}),b.guardtower.icons.cut=S({a:"attack",s:"stop",g:"upgradeStoneTower",
c:"upgradeCannonTower"}),b.keeptower.icons.cut=S({a:"attack",s:"stop",c:"upgradeCannonTower"}),b.cannontower.icons.cut=S({a:"attack",r:"attack_ground",s:"stop",h:"holdfire"}),h.rockettower.icons.cut=S({a:"attack",r:"attack_ground",s:"stop",f:"fireatwill"}),f.harbor.icons.cut=S({f:"createFishingBoat",x:"createXebec",h:"createHulk",g:"createGalleon",t:"te_landingtactics"}),d.harbor.icons.cut=S({f:"createFishingBoat",h:"createHulk",x:"createXebec",t:"te_landingtactics"}),h.harbor.icons.cut=S({f:"createFishingBoat",
h:"createHulk",x:"createXebec"}),f.farm.icons.cut=S({c:"createCow",f:"techCropRotation",d:"techDomestication"}),d.farm.icons.cut=S({c:"createCow",f:"techDomestication",d:"techDomestication",p:"techCowPoaching",r:"ridingHorses",h:"techHorseManShip"}),h.farm.icons.cut=S({f:"techDomestication",a:"ridingHorses",i:"irrigation"}),f.storage.icons.cut=S({g:"techGoldMining",s:"techStoneMining"}),d.storage.icons.cut=S({g:"techGoldMining",s:"techStoneMining"}),h.storage.icons.cut=S({g:"techGoldMining",s:"techStoneMining"}),
f.cathedral.icons.cut=S({c:"createCrusaders"}),b.magicgateway.icons.cut=S({o:"createOrk",d:"createDwarf",g:"createGhost",s:"createSkeleton"}));e=[f.knight,h.horsesamurai,d.cavalry,d.enichar,f.crusader,h.chariot,h.horsearcher,d.horsearcher];g=[h.horsesamurai,f.crusader,d.enichar];n=[f.knight,d.cavalry,h.chariot,h.horsearcher,d.horsearcher];m=[f.longbowman,d.archer,h.archer,f.archer];v=[b.catapult,b.ballista,b.heavycatapult];k=[b.galleon,b.hulk,b.pinque,b.fishingboat];p=[b.galleon,b.hulk,b.pinque];
q=[d.satrap,f.maceman];var r=[f.longbowman,d.archer,h.archer,f.archer,h.horsearcher,d.horsearcher,b.pinque,b.watchtower,b.keeptower,b.guardtower],w=[b.stonegolem,b.ork,b.dwarf,b.skeleton,b.ghost,b.dragon,b.jinn,b.bat,f.wizard,d.mage,h.mage],x=[f.peasant,h.peasant,d.peasant,f.footman,d.footman,h.ronin,f.pikeman,d.spearman,d.satrap,f.maceman,d.cavalry,d.jihadwarrior,b.spy,d.enichar,h.horsesamurai,h.monk,h.chariot,h.ninja,b.stonegolem,b.ork,b.dwarf,b.jinn,b.skeleton,b.ghost,f.knight,f.crusader],y=[b.watchtower,
b.keeptower,b.guardtower,b.cannontower],A=[b.cannontower,h.rockettower],z=[f.cathedral,f.castle,b.woodenwall,f.barracks,f.lumbermill,f.magetower,f.warriorsguild,f.storage,f.farm,f.merchantsguild,f.church,f.blacksmith,f.stable,f.workshop,f.tavern,f.house,b.watchtower,f.market,f.outpost,b.bridge,f.harbor,b.guardtower,b.keeptower,b.cannontower,h.rockettower,h.castle,d.castle,h.barracks,d.house,d.lumbermill,d.storage,d.farm,d.harbor,d.blacksmith,d.workshop,d.church,d.tavern,d.market,d.barracks,d.stable,
d.outpost,d.mosque,d.mageguild,d.merchantsguild,d.warriorsguild,d.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],D=[f.cathedral,f.castle,b.woodenwall,f.barracks,f.lumbermill,f.magetower,f.warriorsguild,f.storage,f.farm,f.merchantsguild,f.church,f.blacksmith,f.stable,f.workshop,f.tavern,f.house,b.watchtower,f.market,f.outpost,b.bridge,f.harbor,h.castle,d.castle,
h.barracks,d.house,d.lumbermill,d.storage,d.farm,d.harbor,d.blacksmith,d.workshop,d.church,d.tavern,d.market,d.barracks,d.stable,d.outpost,d.mosque,d.mageguild,d.merchantsguild,d.warriorsguild,d.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],E=[b.catapult,b.heavycatapult],G=[f.pikeman,d.spearman],H=[h.monk,h.priest],L=[b.woodenwall],M=[f.peasant,h.peasant,
d.peasant],R=[f.wizard,d.mage,h.mage],Q=[f.footman,d.footman,h.ronin],T=[f.priest,d.priest,h.priest];sb={bless:{img:l.bless,d:0,mv:1},star:{img:l.star,d:0,mv:1},heal:{img:l.healing,d:0,mv:1},impersonate:{img:l.impersonate,d:0,mv:1},select:{img:l.select,d:0,mv:0,select:1,z32:.8},spawn:{img:l.spawn,d:0,mv:1},curse:{img:l.curse,d:0,mv:1},turnStone:{img:l.turn_to_stone,d:0,mv:1}};var I=function(b,d,e){for(var c=b.length,f=0,g=d.length;f<g;f++)for(var h=0;h<c;h++)xd[b[h].type][d[f].type]=e};I(A,p,4);I(p,
p,3);I(p,D,3);I(p,y,3);I(p,L,5);I(p,v,2);I(E,D,4);I(E,k,4);I(E,y,6);I(E,v,4);I(E,L,9);I([h.samurai],g,.5);I([h.samurai],n,.3);I([h.ronin],M,1);I(G,e,6);I(Q,G,1.5);I(Q,m,1.5);I(Q,[d.jihadwarrior],1);I([d.satrap],M,2);I(q,v,1.5);I(r,[b.dragon],.75);I(r,[b.bat],1);I(r,[f.pikeman],-.75);I(r,q,1);I(r,[h.chariot],-.3);I(r,H,.5);I(R,T,4);I(T,R,3);I(T,w,3);I(x,[b.bat],-.2);I(x,[b.dragon],-.5);I([b.stonegolem],z,1);I([b.dwarf],z,4);I(w,[h.priest],-.5);vb={img:l.gath_point,x32:-10,y32:-10,d:0,mv:!0};Bg=[vb];
m=za;e=Object.keys(m);for(g=0;g<u.length;g++)for(v=u[g],n=0;n<e.length;n++)v[e[n]]=m[e[n]];e=[f.archer,f.longbowman,h.archer,h.horsearcher,d.archer,d.horsearcher];g=[f.footman,f.maceman,f.knight,f.crusader,f.pikeman,d.jihadwarrior,d.cavalry,d.footman,d.enichar,f.peasant,d.peasant,d.satrap,d.spearman,b.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,b.skeleton,b.ghost,b.ork,b.dwarf];n=[f.footman,f.maceman,f.knight,f.crusader,f.pikeman,d.jihadwarrior,d.cavalry,d.footman,d.enichar,
f.peasant,d.peasant,d.satrap,d.spearman,b.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,f.archer,f.longbowman,h.archer,h.horsearcher,d.archer,d.horsearcher,f.wizard,d.mage,h.mage,f.priest,d.priest,h.priest,b.skeleton,b.ghost,b.ork,b.dwarf];C=[{name:["Longbow","Allows the production of longbowmen"],next:[c.createLongbowman],cost:[400,0,0,0],time:45,type:ba},{name:["Gold Mining","Increases gold production"],increase:2,value:"gold",cost:[400,0,0,0],time:20,type:la},{name:["Stone Mining",
"Increases stone production"],increase:2,value:"stone",cost:[400,0,0,0],time:20,type:la},{name:["Wood Cutting","Increases wood production"],increase:2,value:"wood",cost:[400,0,0,0],time:20,type:la},{name:["Temper Iron","Increases hand-to-hand units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:g,next:[c.techHalberd],type:Ab},{name:["Scale Armor","Increases unit's defense"],increase:1,value:"defence",cost:[400,0,0,0],time:30,group:n,next:[c.techChainMail],type:Ab},{name:["Halberd",
"Allows the production of spear units"],next:[c.createPikeman,c.createPikeman2],cost:[400,0,0,0],time:30,type:ba},{name:["Domestication","Allows the production of cows"],next:[c.createCow],cost:[300,0,0,0],time:20,type:ba},{name:["Crop Rotation","Increases the production of fields"],increase:2,value:"food",cost:[400,0,0,0],time:20,type:la,next:[c.irrigation]},{name:["Chain Mail","Increases unit's defense"],increase:2,value:"defence",cost:[400,0,0,0],time:30,group:n,type:Ab},{name:["Plate Armor","Allows the production of knights"],
next:[c.createKnight],cost:[400,0,0,0],time:60,type:ba},{name:["Crossbow","Increases arrow units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:e,type:Ab},{name:["Feudalism","Makes peasants cheaper"],cost:[300,0,0,0],time:30,decrease:[h.peasant,[0,0,8,0],f.peasant,[0,0,10,0],d.peasant,[0,0,10,0]],type:rh,next:[c.techSlavery]},{name:["Architecture","Peasants build faster, and allows stone wall, gate and towers"],increase:.5,value:"buildSpeed",cost:[300,0,0,0],time:30,type:la,
next:[c.upgradeStoneTower,c.techGreatWall,c.buildBridge]},{name:["Learning","Allows units to gather experience"],increase:1,value:"experience",cost:[400,0,0,0],time:30,type:la,next:[c.buildAcademy,c.buildAcademy1,c.buildAcademy2]},{name:["Convert Resources",""],cost:[400,0,0,0],time:30},{name:["Map Making","Allows the production of galleons"],cost:[800,0,0,0],time:30,type:ba},{name:["Trade Routes","Allows trading"],cost:[400,0,0,0],time:30,type:ba,next:[c.techTradeTaxes]},{name:["Trade Taxes","Increases trade profit"],
cost:[400,0,0,0],time:30},{name:["Usury","Allows the obtaining of loans in taverns"],cost:[300,0,0,0],time:30,type:pf,changeicon:38,next:[c.techBanking]},{name:["Supply Storage","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:la,value:"popLimit",next:[c.techSeaFood]},{name:["Bribery","Allows the bribing of enemy units"],cost:[600,0,0,0],time:60,type:ba,next:[c.bribe]},{name:["Heroism","Allows unlimited experience"],cost:[500,0,0,0],time:30,increase:Infinity,value:"maxLevel",
type:la,next:[c.techLeadership]},{name:["Warfare","Gain experience faster"],cost:[400,0,0,0],time:30,type:la,increase:1,value:"experience",next:[c.techTactics]},{name:["Tactics","Gain experience faster"],cost:[800,0,0,0],time:30,type:ba,next:[c.buildDummy,c.techSunTzu]},{name:["Mercenaries","Allows the recruitment of units in taverns"],cost:[600,0,0,0],time:30,type:pf,next:[c.techHeroes,c.createMercenaries],actvintv:[c.iniMercenaries]},{name:["Heroes' Quest","Allows the recruitment of heroes in taverns"],
cost:[800,0,0,0],time:30,type:pf,next:[c.techFame,c.createHeroes],actvintv:[c.iniHeroes]},{name:["Fame","Recruit better units from taverns"],cost:[500,0,0,0],time:30,value:"fameTech",increase:1,type:la},{name:["Siege Tactics","Allows the production of heavy catapults"],cost:[1200,0,0,0],time:60,type:ba,next:[c.createHeavyCatapult]},{name:["Body Building","Increases unit's hit points at every new level"],cost:[800,0,0,0],time:60,value:"healthJump",increase:5,type:la},{name:["Espionage","Allows the production of a spy"],
cost:[400,0,0,0],time:30,type:ba,next:[c.createSpy]},{name:["Fanaticism","Increases the building's resistance"],cost:[400,0,0,0],time:30,type:Ab,group:[],increase:5,value:"resistance",next:[c.techCrusade,c.techJihad]},{name:["Crusade","Allows the preaching of a crusade"],cost:[1200,0,0,0],time:180,type:ba,next:[c.createCrusaders]},{name:["Inquisition","Increases priest attack"],cost:[400,0,0,0],time:30,type:Ab,group:[f.priest,d.priest,h.priest],increase:5,value:"attack"},{name:["Healing","Allows healing of units"],
cost:[400,0,0,0],time:30,next:[c.techMedicine,c.healing],type:ba},{name:["Medicine","Allows remote healing of units"],cost:[500,0,0,0],time:30,value:"healingRange",increase:5,type:la},{name:["Bless","Temporarily increases unit attack skill"],cost:[400,0,0,0],time:30,type:ba,next:[c.bless]},{name:["Invisibility","Invisibility spell"],cost:[500,0,0,0],time:30,type:ba,next:[c.invisibility]},{name:["Bat","Researches bat summoning"],cost:[400,0,0,0],time:240,type:ba,next:[c.createBat]},{name:["Freeze",
"Freeze spell"],cost:[800,0,0,0],time:30,type:ba,next:[c.freeze]},{name:["Lightning","Lightning spell"],cost:[400,0,0,0],time:30,type:ba,next:[c.lightning]},{name:["Stone Golem","Researches stone golem summoning"],cost:[800,0,0,0],time:120,type:ba,next:[c.createGolem]},{name:"Upgrade to Guard Tower",cost:[0,600,0,0],time:20,type:de,obj:44,upgrade:1},{name:"Upgrade to Stone Tower",cost:[0,0,0,500],time:30,type:de,obj:55,upgrade:1},{name:"Upgrade to Cannon Tower",cost:[0,0,0,500],time:30,type:de,obj:56,
upgrade:1},{name:["Buddhism"],cost:[400,0,0,0],time:30,type:ba,next:[c.buildCathedral1]},{name:["Cannon Tower","Allows the building of cannon towers"],next:[c.upgradeCannonTower],cost:[400,0,0,0],time:30,type:ba},{name:["Engineering","Increases siege weapon's attack"],increase:5,value:"attack",cost:[400,0,0,0],time:30,group:[b.ballista,b.catapult,b.heavycatapult],type:Ab},{name:["Great Wall","Makes stone walls, towers and gates stronger"],cost:[600,0,0,0],time:30,type:ba},{name:["Art of Riding","Allows the production of horse archers"],
cost:[500,0,0,0],time:30,type:ba,next:[c.createHorseArcher1,c.createHorseArcher2,c.techHorseManShip]},{name:["Irrigation","Increases field production"],increase:4,value:"food",cost:[400,0,0,0],time:30,type:la},{name:["Armored Chariot","Allows the production of armored chariots"],cost:[500,0,0,0],time:60,type:ba,next:[c.createChariot]},{name:["Meditation","Makes monks cheaper"],cost:[300,0,0,0],time:30,decrease:[0,0,50,0],type:qf,next:[c.techPhilosophy],group:[h.monk]},{name:["Kung-Fu","Increases the attack of all kung-fu units"],
cost:[400,0,0,0],time:30,type:Ab,increase:1,value:"attack",group:[h.peasant,h.ninja,h.monk,h.priest],next:[c.techMastery,c.techNinjas,c.techTournaments]},{name:["Tournaments","Allows sharing of experience between kung-fu units"],cost:[800,0,0,0],time:30,type:ba,next:[]},{name:["Philosophy","Allows the production of more experienced monks"],cost:[400,0,0,0],time:30,type:Ab,increase:2,value:"level",group:[h.monk,h.priest],next:[c.createPriest1]},{name:["Ninjas","Allows the production of ninjas"],cost:[500,
0,0,0],time:30,type:ba,next:[c.createNinja]},{name:["Mastery","Allows priests to teach kung-fu units"],cost:[500,0,0,0],time:30,type:ba,next:[c.teach]},{name:["Concentration","Allows faster manna restoration"],cost:[600,0,0,0],time:80,type:ba,next:[c.techConfusion]},{name:["Confusion","Researches the Confusion spell"],cost:[400,0,0,0],time:30,type:ba,next:[c.confusion]},{name:["Whirlpool","Researches the Whirlpool spell"],cost:[300,0,0,0],time:30,type:ba,next:[c.whirlpool]},{name:["Dragon","Researches Dragon summoning"],
cost:[800,0,0,0],time:300,type:ba,next:[c.createDragon]},{name:["Turn to Stone","Researches the Turn to Stone spell"],cost:[300,0,0,0],time:30,type:ba,next:[c.turnToStone]},{name:["Flame Bolt","Researches the Flame Bolt spell"],cost:[400,0,0,0],time:30,type:ba,next:[c.techDragon,c.flameBolt]},{name:["Jewelry","Allows trading of items"],cost:[400,0,0,0],time:30,type:ba,next:[c.sellItems,c.buyItems]},{name:["Banking","Increases trade profit"],cost:[600,0,0,0],time:30,type:ba},{name:["Chemistry","Increases arrow units' attack power"],
cost:[500,0,0,0],time:30,type:Ab,group:e,increase:1,value:"attack",next:[c.techGunPowder]},{name:["Sea Food","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:la,value:"popLimit"},{name:["Gun Powder","Increases cannon tower's attack power"],cost:[500,0,0,0],time:30,type:Ab,increase:10,value:"attack",group:[b.cannontower],next:[c.techRocketArrow]},{name:["Rocket Arrow","Allows the building of rocket tower"],cost:[800,0,0,0],time:30,type:ba,next:[c.buildRocketTower]},{name:["Bushido",
"Allows the production of horse samurai"],cost:[800,0,0,0],time:120,type:ba,next:[c.createHorseSamurai]},{name:["Leadership","Units around a hero gain experience"],cost:[600,0,0,0],time:30,type:ba,next:[c.techHonor]},{name:["Honor","Hero vs. hero attack bonus"],cost:[500,0,0,0],time:30,type:ba},{name:["Sun Tzu's Book","Increases the speed of learning"],cost:[800,0,0,0],time:30,type:la,increase:1,value:"experience"},{name:["Cow Poaching","Allows peasants to steal cows"],cost:[200,0,0,0],time:30,type:la,
increase:1,value:"stealCows"},{name:["Horsemanship","Makes mounted units cheaper"],cost:[500,0,0,0],time:30,type:qf,mulp:.75,group:[h.horsearcher,d.cavalry,d.horsearcher]},{name:["Scimitar","Increases sword attack power and allows the production of satraps"],cost:[400,0,0,0],time:30,type:Ab,increase:1,value:"attack",group:g,next:[c.createSatrap]},{name:["Jihad","Allows the production of Jihad Warriors"],cost:[1200,0,0,0],time:30,type:ba,next:[c.createJihad,c.convertJihad]},{name:["Magic Carpet","Researches Magic Carpet summoning"],
cost:[300,0,0,0],time:30,type:ba,next:[c.createCarpet,c.techJinn]},{name:["Magic Workshop","Allows the building of a magic workshop"],cost:[1200,0,0,0],time:180,type:ba,next:[c.buildMagicWorkshop]},{name:["Rain of Fire",""],cost:[800,0,0,0],time:60,type:ba,next:[c.fireRain]},{name:["Magic Vision","Researches the Magic Vision spell"],cost:[400,0,0,0],time:30,type:ba,next:[c.magicVision]},{name:["Necromancy","Researches the Raise the Dead spell"],cost:[400,0,0,0],time:30,type:ba,next:[c.raiseDead]},
{name:["Jinn","Researches Jinn summoning"],cost:[600,0,0,0],time:300,type:ba,next:[c.createJinn]},{name:["Ore Enrichment","Increases mine production"],cost:[800,0,0,0],time:30,type:la,increase:1,value:"miningPerf"},{name:["Riding Horses","Increases the mounted units' attack and defense power"],cost:[500,0,0,0],time:30,type:sj,values:["attack",2,"defence",1],group:[h.horsearcher,d.cavalry,d.horsearcher],next:[c.techJanissary]},{name:["Janissary","Allows the production of Janissaries"],cost:[1200,0,
0,0],time:120,type:ba,next:[c.createEnichar]},{name:["Slavery","Makes peasants cheaper"],cost:[200,0,0,0],time:30,decrease:[h.peasant,[0,0,7,0],f.peasant,[0,0,8,0],d.peasant,[0,0,8,0]],type:rh}];Mi();c.buildMarket.disabled=1;vk();n=0;for(k=u.length;n<k;n++)if(m=u[n],m.onbuild)for(f=m.onbuild,g=0,h=f.length;g<h;g++)d=f[g],d.obj.race==m.race&&(d.disabled=1,d.require=m.name,d.requireObj||(d.requireObj=[]),d.requireObj.put(m));g=0;for(h=C.length;g<h;g++)if(d=C[g],d.tech=1,d.id=g,d.next)for(f=d.next,v=
0,n=f.length;v<n;v++)m=f[v],m.disabled?(m.disabled++,m.require+=", "+d.name[0],m.requireObj.put(d)):(m.requireObj=[d],m.disabled=1,m.require=d.name[0]);g=0;f=u;for(h=f.length;g<h;wl(f[g++]));}new Yb("",[255,255,255],[0],!0)},u,xd,Yh,vb,Bg,uk,Zh=8,A=new Float32Array(16),ad=function(d,b,e,c,g,h,m){var f=u[d];if(f.ignore)return f.invalid=!0,!1;if(h=h&&!f.instantBuild)this.built=!1;var k=D[b],l=k.mod[d],q=Object.keys(l);this.__proto__=f;this.kingdom=b;this.d=g;this.x32=e;this.y32=c;this.taskList=[];g=
0;for(var x=q.length;g<x;this[q[g]]=l[q[g++]]);if(m)for(l=Object.keys(m),g=0,x=l.length;g<x;this[l[g]]=m[l[g++]]);0<f.invMax&&(this.inventory=[]);20==f.type&&(this.lastUse=p.cycle);f.build||(this.mv=1);m=k.technology.disabled;l=f.actvintv;this.workers=[];this.id=x=y.length;f.rndDirection&&(this.d=x*e%f.rndDirection);this.build||this.item||this.cow||k.values.pop++;e=f.validator(e,c,f.space,b);if(e[1]||h){c=f.validator.dimension;q=e[0];if(h){var r=Aa[b];g=0;for(f=q.length;g<f;g++)r[q[g]]=x;k.building.put(x)}else for(g=
0,f=q.length;g<f;c[q[g++]]=x);if(e[2]&&(q=e[2],!h))for(g=0,f=q.length;g<f;c[q[g++]]=0);}else return this.invalid=!0,!1;y[x]=this;h||Ja[b][d].put(x);if(this.update&&!p.custom)for(d=this.update,g=0,x=d.length;g<x;g+=3)gb({func:ff,data:[this.id,d[g],d[g+1],d[g+2]]},d[g+2],1);if(l)for(d=0,f=l.length;d<f;d++)b=l[d],m[b.id]||b(this);h?(qb(this),w.kingdom==this.kingdom?Dd(this,Al):Dd(this,kh)):(qb(this),bj(this));this.level&&!this.potion&&nj(this);!this.standardFunc||this.func||p.editor||h||this.standardFunc(this);
h=k.stats;h.unitCount[this.type]++;k=h.unitCount[this.type]-h.unitCountDeath[this.type];k>h.unitCountMax[this.type]&&(h.unitCountMax[this.type]=k)},yj=function(d){var b=D[d.kingdom];if(d.population){var e=d.population;b.values.popMax+=e;ce(d.kingdom);for(var c=0;c<e;c++)b.checkPopArray()}if(d.onbuild)for(d=d.onbuild,e=b.technology,b=e.disabled,e=e.actived,c=0;c<d.length;c++){var g=d[c].id;e[g]||(e[g]=0);e[g]++;e[g]-1||(b[g]--,!b[g]&&ia.actv[g]&&ia(X.active))}},Xb=[],I=new Float32Array(12),$h=function(d,
b,e){var c=d.length;d[c]=b;d[c+1]=b+1;d[c+2]=b+2;d[c+3]=b+1;d[c+4]=b+2;d[c+5]=b+3;d.changed=!0;e.typeBuffer=d;e.elemtId=c},Dd=function(d,b){var e=b[3];if(b.noAlpha)c=fa;else{d.alpha=!0;var c=ua}if(d.typeBuffer!==c){if(b==kh){if(Eb.diplomacy[d.kingdom]){Jb(d);return}b=new Float32Array(Za(wa[3*d.kingdom],wa[3*d.kingdom+1],wa[3*d.kingdom+2],e+1))}Jb(d);$h(c,d.bufferID,d)}k.bindBuffer(k.ARRAY_BUFFER,pb);k.bufferSubData(k.ARRAY_BUFFER,16*d.bufferID,b)},yc=function(d){var b=gg(d,d.kingdom),e=b[0],c=b[1],
g=b[2];b=b[3];var h=d.bufferID;wk(e,c,g,b,d.bufferID);1>b?(d.alpha=!0,e=ua):e=fa;d.typeBuffer!==e&&(Jb(d),$h(e,h,d));if(d.child&&(!1!==d.built||!d.build))for(var m=d.child,k=0,l=m.length;k<l;k++)h+=4,b=gg(m[k],d.kingdom),e=b[0],c=b[1],g=b[2],b=b[3],wk(e,c,g,b,h)},gg=function(d,b){if(null!=d.rgb){var e=d.rgb;d=e[0];var c=e[1];b=e[2];e=e[3]}else Ia[d.img][3]?(d=wa[3*b],c=wa[3*b+1],b=wa[3*b+2],e=2):(d.mMapcolor?(b=d.mMapcolor,d=b[0]/255,c=b[1]/255,b=b[2]/255):(d=wa[3*b],c=wa[3*b+1],b=wa[3*b+2]),e=1);
return[d,c,b,e]},xk=function(){if(Xb.length){var d=Xb[Xb.length-1];Xb.length--}else d=Zh,Zh+=4;return d},qb=function(d,b,e,c){void 0==b&&(c=e=b=0);var f=Ia[d.img],h=1;if(d.bufferID){var m=d.bufferID;h=0}else m=xk();d.bufferID=m;f||O(d);var l=f[2]*d.d*6+4,v=f[4+l],n=f[5+l];l=f[0];var q=f[1];0<=q&&(q*=.001);var u=f.id+4*d.d*f[2],r=-1;d.mv&&(r=p.now());A[0]=u;A[1]=r;A[2]=l;A[3]=q;A[4]=u+1;A[5]=r;A[6]=l;A[7]=q;A[8]=u+2;A[9]=r;A[10]=l;A[11]=q;A[12]=u+3;A[13]=r;A[14]=l;A[15]=q;var w=32*d.x32,x=32*d.y32;
l=32*d.y32;null!=d&&null!=d.z32&&(l*=d.z32);var y=fa;k.bindBuffer(k.ARRAY_BUFFER,rd);k.bufferSubData(k.ARRAY_BUFFER,16*m,A);k.bindBuffer(k.ARRAY_BUFFER,Dc);if(d.rotation){var z=d.rotation;z*=2*Math.PI;var C=.5*f[8];q=.5*f[9];f=-1*l;u=-C;r=-q;var D=0*I.length;I[D]=u*Math.cos(z)-q*Math.sin(z)+w;I[D+1]=q*Math.cos(z)+u*Math.sin(z)+x;I[D+2]=f;I[D+3]=u*Math.cos(z)-r*Math.sin(z)+w;I[D+4]=r*Math.cos(z)+u*Math.sin(z)+x;I[D+5]=f;I[D+6]=C*Math.cos(z)-q*Math.sin(z)+w;I[D+7]=q*Math.cos(z)+C*Math.sin(z)+x;I[D+
8]=f;I[D+9]=C*Math.cos(z)-r*Math.sin(z)+w;I[D+10]=r*Math.cos(z)+C*Math.sin(z)+x;I[D+11]=f}else d.wh?(z=d.wh[0],C=d.wh[1],z-=v,C-=n,I[0]=w,I[1]=x,I[2]=l,I[3]=w+z,I[4]=x,I[5]=l,I[6]=w,I[7]=x+C,I[8]=l,I[9]=w+z,I[10]=x+C):(I[0]=w,I[1]=x,I[2]=l,I[3]=w,I[4]=x,I[5]=l,I[6]=w,I[7]=x,I[8]=l,I[9]=w,I[10]=x),I[11]=l;k.bufferSubData(k.ARRAY_BUFFER,12*m,I);r=gg(d,d.kingdom);f=r[0];q=r[1];u=r[2];r=r[3];if(1>r||d.alpha)d.alpha=!0,y=ua;k.bindBuffer(k.ARRAY_BUFFER,pb);A[0]=f;A[1]=q;A[2]=u;A[3]=r;A[4]=f;A[5]=q;A[6]=
u;A[7]=r;A[8]=f;A[9]=q;A[10]=u;A[11]=r;A[12]=f;A[13]=q;A[14]=u;A[15]=r;k.bufferSubData(k.ARRAY_BUFFER,16*m,A);k.bindBuffer(k.ARRAY_BUFFER,Md);z=p.now();A[0]=b;A[1]=e;A[2]=c;A[3]=z;A[4]=b;A[5]=e;A[6]=c;A[7]=z;A[8]=b;A[9]=e;A[10]=c;A[11]=z;A[12]=b;A[13]=e;A[14]=c;A[15]=z;k.bufferSubData(k.ARRAY_BUFFER,16*m,A);h&&$h(y,m,d);if(d.child&&!1!==d.built)for(b=l,e=d.child.length,c=[],d.childLoc=c,h=0;h<e;h++){y=d.child[h];f=Ia[y.img];l=f[2]*d.d*6+4;z=f[4+l];C=f[5+l];l=f[0];q=f[1];0<=q&&(q*=.001);u=f.id+4*d.d;
r=-1;y.mv&&(r=1);A[0]=u;A[1]=r;A[2]=l;A[3]=q;A[4]=u+1;A[5]=r;A[6]=l;A[7]=q;A[8]=u+2;A[9]=r;A[10]=l;A[11]=q;A[12]=u+3;A[13]=r;A[14]=l;A[15]=q;r=gg(y,d.kingdom);f=r[0];q=r[1];u=r[2];r=r[3];D=w;var E=x;y.wh1&&(z=y.wh[0],C=y.wh[1]);y.center&&(D-=.5*~~(z-v),E-=.5*~~(C-n));m=xk();k.bindBuffer(k.ARRAY_BUFFER,rd);k.bufferSubData(k.ARRAY_BUFFER,16*m,A);k.bindBuffer(k.ARRAY_BUFFER,pb);A[0]=f;A[1]=q;A[2]=u;A[3]=r;A[4]=f;A[5]=q;A[6]=u;A[7]=r;A[8]=f;A[9]=q;A[10]=u;A[11]=r;A[12]=f;A[13]=q;A[14]=u;A[15]=r;k.bufferSubData(k.ARRAY_BUFFER,
16*m,A);l=y.z?32*y.z+b:b;k.bindBuffer(k.ARRAY_BUFFER,Dc);I[0]=D;I[1]=E;I[2]=l;I[3]=D;I[4]=E;I[5]=l;I[6]=D;I[7]=E;I[8]=l;I[9]=D;I[10]=E;I[11]=l;k.bufferSubData(k.ARRAY_BUFFER,12*m,I);k.bindBuffer(k.ARRAY_BUFFER,Md);A[0]=0;A[1]=0;A[2]=0;A[3]=0;A[4]=0;A[5]=0;A[6]=0;A[7]=0;A[8]=0;A[9]=0;A[10]=0;A[11]=0;A[12]=0;A[13]=0;A[14]=0;A[15]=0;k.bufferSubData(k.ARRAY_BUFFER,16*m,A);l=1>r?ua:y.light?ya:fa;c.put(l);z=l.length;c.put(z);l[z]=m;l[z+1]=m+1;l[z+2]=m+2;l[z+3]=m+1;l[z+4]=m+2;l[z+5]=m+3;l.changed=!0}},Mc=
function(d,b,e,c){var f=p.now(),h=d.bufferID;A[0]=b;A[1]=e;A[2]=c;A[3]=f;A[4]=b;A[5]=e;A[6]=c;A[7]=f;A[8]=b;A[9]=e;A[10]=c;A[11]=f;A[12]=b;A[13]=e;A[14]=c;A[15]=f;k.bindBuffer(k.ARRAY_BUFFER,Md);k.bufferSubData(k.ARRAY_BUFFER,16*h,A);k.bindBuffer(k.ARRAY_BUFFER,null);if(d.tempChild)for(f=0,d=d.tempChild,h=d.length;f<h;Mc(d[f++],b,e,c));},Wh=function(d,b,e,c,g,h){Bb[0]=d;Bb[1]=b;Bb[2]=e;Bb[3]=d+c;Bb[4]=b;Bb[5]=e;Bb[6]=d;Bb[7]=b+g;Bb[8]=e;Bb[9]=d+c;Bb[10]=b+g;Bb[11]=e;k.bindBuffer(k.ARRAY_BUFFER,Dc);
k.bufferSubData(k.ARRAY_BUFFER,12*h,Bb);k.bindBuffer(k.ARRAY_BUFFER,null)},wk=function(d,b,e,c,g){A[0]=d;A[1]=b;A[2]=e;A[3]=c;A[4]=d;A[5]=b;A[6]=e;A[7]=c;A[8]=d;A[9]=b;A[10]=e;A[11]=c;A[12]=d;A[13]=b;A[14]=e;A[15]=c;k.bindBuffer(k.ARRAY_BUFFER,pb);k.bufferSubData(k.ARRAY_BUFFER,16*g,A);k.bindBuffer(k.ARRAY_BUFFER,null)},ib=function(d,b,e){void 0==e&&(e=32);d.z32&&(b*=d.z32);var c=d.x32*e;e*=d.y32;d.wh?Wh(c,e,b,d.wh[0]-Ia[d.img][8],d.wh[1]-Ia[d.img][9],d.bufferID):Wh(c,e,b,0,0,d.bufferID);if(d.tempChild)for(b=
d.tempChild,c=0,e=b.length;c<e;c++){var g=b[c];g.x32=d.x32;g.y32=d.y32;ib(g,32*d.y32)}},za={getRadix:function(){return bb[this.zLevel]},checkMana:function(d,b,e,c){if(!this.mana)return!1;if(0>this.mana-d)return this.manaTask=[e.url,b,d],this.stay55(),d>this.manaMax&&c&&(this.blockedCost=c,b=this.setupChild(sb.curse,1),this.blocked=2,this.blockedimg=b,this.manaTarget=d,k.bindBuffer(k.ARRAY_BUFFER,pb),k.bufferSubData(k.ARRAY_BUFFER,16*this.bufferID,jf),k.bufferSubData(k.ARRAY_BUFFER,16*b.bufferID,jf)),
!1;this.mana-=d;return!0}},zc=function(d,b){return p.editor?!0:d.freezed||d.confused?!1:D[d.spy||d.kingdom].control[b.spy||b.kingdom]};za.changeKingdom=function(d){Ja[this.kingdom][this.type].quit(this.id);Ac[this.id]&&(Ac[this.id]=0,G.quit(this.id),0==G.length&&(ia([]),ze(),ic=-1),Qh(this.id));this.kingdom=d;yc(this);this.childBuild&&(this.childBuild=0);if(!this.build||this.arrow)p.editor||this.stay();Ja[d][this.type].put(this.id)};za.aspettare=function(){this.nodes=void 0;this.getRadix()[this.x32+
this.y32*E]=this.id;this.waiting=!0;aa(this,this.url.idle);Mc(this,0,0,0);Pb(this,~~(32E3/this.spd))};za.addItem=function(d){var b=this.inventory;b&&(b[b.length]=d.id,d.in=this.id,d.sword||d.shield)&&(d.attack&&(this.attack+=d.attack),d.defence&&(this.defence+=d.defence))};za.showInventory=function(){Sh();for(var d=this.inventory,b=0;8>b;b++){var e=d[b];if(!e)break;var c=Da[b];c.style.backgroundPosition="0px "+48*e.iconID+"px";c.className="";ag[b]=null}};za.deleteItem=function(d){this.inventory.quit(d.id);
this.attack-=d.attack;this.defence-=d.defence};za.useItem=function(d){48==d.type&&(this.health+=d.lives,this.health>this.maxHealth&&(this.maxHealth=this.health),this.inventory.quit(d.id))};za.onattack=function(d){!this.attack||this.freezed||this.death||this.func!=Kd.url&&this.func||uc(d.id,[this.id],1)};za.setupINTV=function(d,b,e,c){this.funcObj=b;d.url||O(d,d.url);qi(this);this.changeFunc(d.url,c);this.deleteWorker();Pb(this,e);return e};za.damage=function(d,b){if(!(this.zolotoy||this.death||this.stoned)){this.defence&&
(d-=this.defence);1>d&&(d=1);this.health-=d;b=D[b.kingdom].stats;b.dmgInflicted+=d;var e=D[this.kingdom].stats;e.dmgTaken+=d;1>this.health?(this.build?(e.buildsLosed++,b.buildsKilled++):(e.unitsLosed++,b.unitsKilled++),this.die()):Y(this.id,1)}};var Y=function(d,b){if(Ac[d]||!1===d)return d=G.length,1===d?(d=y[G[0]],X.stockActive==d&&d.inventory.length?(ed(d.id,1,1),ck(d,1)):d.build?Ba(d,1):ed(d.id,b)):1<d?Rh(G,b):ok(Na),!0};za.setupSpellIMG=function(d){this.invisible&&Cd(this.id);this.url.spell?
(aa(this,this.url.spell,1),d||gb({func:yk,data:this.id},ub(this.img),1)):this.stay()};var yk=function(d){d=y[d];d.death||d.stay()};za.setupChild=function(d,b,e){var c={x32:this.x32,y32:this.y32,d:d.d,img:d.img,mv:d.mv,parent:this.id,z32:d.z32};if((this.dix||this.diy)&&!this.waiting){var g=.001*(p.now()-this.timestamp);c.x32+=this.dix*g/32-Math.sign(this.dix);c.y32+=this.diy*g/32-Math.sign(this.diy)}if(d.select){if(this.space)d=this.space[this.space.length-1],h=(this.space.length-1)/d;else{d=this.sSizex||
1;var h=this.sSizey||1}this.z32&&(c.z32=this.z32);c.wh=[32*d-3,32*h-3];this.selectAnim=c}qb(c);g&&Mc(c,this.dix,this.diy,0);e&&(k.bindBuffer(k.ARRAY_BUFFER,pb),k.bufferSubData(k.ARRAY_BUFFER,16*c.bufferID,e));this.tempChild||(this.tempChild=[]);this.tempChild.put(c);b||Vb.new(c,ub(c.img),zk);return c};var zk=function(d){y[d.parent].tempChild.quit(d);Jb(d)};za.distance=0;var aa=function(d,b,e,c){d.img=b;Ia[b]||O(b);b=Ia[b];var f=b[0],h=b[1];0<=h&&(h*=.001);c&&(h*=c);b=b.id+4*d.d*b[2];c=-1;1===e?c=
p.now():0>e&&(c=1);e=c;d=d.bufferID;A[0]=b;A[1]=e;A[2]=f;A[3]=h;A[4]=b+1;A[5]=e;A[6]=f;A[7]=h;A[8]=b+2;A[9]=e;A[10]=f;A[11]=h;A[12]=b+3;A[13]=e;A[14]=f;A[15]=h;k.bindBuffer(k.ARRAY_BUFFER,rd);k.bufferSubData(k.ARRAY_BUFFER,16*d,A);k.bindBuffer(k.ARRAY_BUFFER,null)};za.setupDir=function(d,b,e){d=Math.sign(d);b=Math.sign(b);d=3*(b-1)+(d+1);2==d?this.d=1:-6==d?this.d=5:0==d?this.d=7:-4==d?this.d=3:-1==d?this.d=2:1==d?this.d=0:-5==d?this.d=4:-3==d&&(this.d=6);e&&(this.d=(this.d+e)%8)};za.setupDirBuild=
function(d){var b=R;1==d.health&&0==d.built&&(b=Aa[d.kingdom]);d=d.id;var e=E,c=this.x32+this.y32*e;b[c+e]==d?this.d=0:b[c-e]==d?this.d=4:b[c+1]==d?this.d=2:b[c-1]==d?this.d=6:b[c+e+1]==d?this.d=1:b[c-e+1]==d?this.d=3:b[c+e-1]==d?this.d=7:b[c-e-1]==d&&(this.d=5)};za.spdMod=0;var xh=function(d,b){for(var e=b.length,c=0;c<e;c++){var g=y[b[c]];g.build||(g.spd=d)}};za.changeFunc=function(d,b){var e=this.func;this.func=d;if(Rd){if(void 0!==this.workingOn)var c=y[this.workingOn];(e=Qb[e])&&e.rule&&dh(-1,
this,e.rule,c);(d=Qb[d])&&d.rule&&dh(1,this,d.rule,b)}};za.stay=function(d){this.mv=1;this.time=void 0;this.diy=this.dix=0;this.nodes=this.c=void 0;this.xf=null;Mc(this,0,0,0);d||(this.changeFunc(void 0),this.stock&&0!==this.stock[0]?aa(this,this.img,NaN):aa(this,this.__proto__.img,1),this.buildList&&(this.buildList=void 0),this.deleteWorker(),this.standardFunc&&2!==this.stop&&void 0==this.spy&&this.standardFunc(this))};za.stay55=function(){this.changeFunc(void 0);this.stock&&0!==this.stock[0]?aa(this,
this.img,NaN):aa(this,this.__proto__.img,1);this.deleteWorker();this.standardFunc&&2!==this.stop&&void 0==this.spy&&this.standardFunc(this)};var dm=[],Jb=function(d){d.elemtId&&(Ak(d.elemtId,d.typeBuffer),d.elemtId=void 0,d.typeBuffer=void 0)},rj=function(d){if(d.childLoc){d=d.childLoc;for(var b=0,e=d.length;b<e;b+=2)Ak(d[b+1],d[b])}},Ak=function(d,b){b[d]=NaN;b[d+1]=NaN;b[d+2]=NaN;b[d+3]=NaN;b[d+4]=NaN;b[d+5]=NaN;b.changed=!0;dm.put(d)};za.addWorker=function(d){this.workers.put(d.id);d.workingOn=
this.id};za.deleteWorker=function(){this.workingOn&&(y[this.workingOn].workers.quit(this.id),this.workingOn=0);this.actionItem&&(this.actionItem=void 0);this.blockedAction()};za.blockedAction=function(d){var b=this.blocked;if(Bk[b])Bk[b](this,d)};var Bk={2:function(d,b){d.blocked=void 0;yc(d);zk(d.blockedimg);d.blockedimg=void 0;d.manaTarget=void 0;b||(D[d.kingdom].setupResources(d.blockedCost,-1),d.blockedCost=void 0)}},Uj=function(d){return l.delay[-d[1]+d[0]-1]},he=function(d){var b=G.length;G.quit(d);
if(b!=G.length){var e=y[d];e.selectAnim=void 0;b=0;for(e=e.tempChild;b<e.length;b++){var c=e[b];Jb(c);var g=e.length;e.quit(c);g!=e.length&&b--}Ac[d]=void 0;0==G.length?ze():1==G.length?ed(d):Rh(G)}Na&&Na.id===d&&(ze(),Na.selectAnim&&(Jb(Na.selectAnim),Na.selectAnim=void 0),Na=void 0)};za.base=function(d){return bb[this.zLevel][d]};za.rbase=function(){return bb[this.zLevel]};var Sf,Ph=function(d){Xb.put(d.bufferID);if(d.child){var b=0;d=d.childLoc;for(var e=d.length;b<e;b+=2)Xb.put(d[b][d[b+1]])}};
za.die=function(d){if(!this.death){var b=E,e=this.id,c=this.kingdom,g=D[c];this.waitlist&&(g.unitLoading-=.5*this.waitlist.length);if(this.dieSound&&!p.editor){var h=this.dieSound;qa(h[~~(h.length*Math.random())],this.x32,this.y32)}he(this.id);(this.freezed||this.invisible)&&yc(this);var m=this.x32,k=this.y32;this.death=1;1==this.zLevel&&(Sf[m+k*b]=1);this.c=void 0;var v=this.url.die||this.dimg;!1===this.built&&g.building.quit(this.id);void 0!=g.IAD&&g.k&&!this.item&&db.arr[g.IAD].valorateLost(this);
if(this.food&&!p.editor){var n=100,q=this.food/n,u=~~q,r=~~((q-u)*n);for(h=0;h<q;h++){h==u&&r&&(n=r);var w=wj(m,k),x=~~(w/b);w%=b;w=new ad(52,c,w,x,0);aa(w,l.item_meat);w.contain=[n,2,Dl]}}g.stats.unitCountDeath[this.type]++;h=this.x32;b=this.y32;d||p.editor?(Jb(this),Ph(this)):v?(this.mv=!0,aa(this,v,1),d=Ia[this.img],v=d[1],v=0>v?Uj(d):1E3*d[0]/v,gb({func:Tj,data:this.id},v-25,1),Mc(this,0,0,0),void 0!==this.dix&&(d=.001*(p.now()-this.timestamp),this.x32+=this.dix*d/32-Math.sign(this.dix),this.y32+=
this.diy*d/32-Math.sign(this.diy))):this.dimgInfinity?(this.dimgRND&&(this.d=this.id%this.dimgRND),aa(this,this.dimgInfinity)):(Jb(this),Ph(this));rj(this);this.techStart&&of(0,[this.id]);ib(this,32*this.y32-36);this.x32=h;this.y32=b;this.build||this.item||this.cow||g.values.pop--;this.population&&this.built&&(g.values.popMax-=this.population);k=this.validator(m,k,this.space,this.kingdom);d=k[0];if(this.onbuild&&!p.editor)for(m=this.onbuild,v=g.technology,h=v.disabled,v=v.actived,b=0;b<m.length;b++)c=
m[b].id,v[c]--,0===v[c]&&h[c]++;m=this.validator.dimension;h=0;for(v=d.length;h<v;h++)b=d[h],m[b]=Fb[b]?Fb[b]:0;if(1==this.health&&!this.built)for(b=Aa[this.kingdom],h=0,v=d.length;h<v;b[d[h++]]=void 0);if(k[2])for(d=k[2],h=0,v=d.length;h<v;h++)b=d[h],Fb[b]?(2<m[b]&&y[m[b]].die(1),m[b]=Fb[b]):(2<m[b]&&y[m[b]].die(),m[b]=0);Ja[this.kingdom][this.type].quit(this.id);qi(this);if(this.workers){h=0;m=this.workers.slice(0);for(v=m.length;h<v;h++)k=y[m[h]],k.workingOn===e&&(k.workingOn=0,k.func!==uh.url&&
k.stay());this.workers.length=0}this.deleteFromList&&(m=this.deleteFromList,m.quit(this),m.length||m.length0function(this));this.time=void 0;this.changeFunc(void 0);this.diy=this.dix=0;this.inventory&&0<this.inventory.length&&Bd(this.id,this.inventory.slice(0));this.stock&&uj(this);p.editor||(g.check(),ce(this.kingdom),g.checkPopArray());this.deleteWorker()}};Array.prototype.quit=function(d){d=this.indexOf(d);return-1<d?(this.splice(d,1),!0):!1};Array.prototype.add=function(d){0>this.indexOf(d)&&
(this[this.length]=d)};var $a=["European","Arab","Asian"],mj={euro:"Lancelot Arthur Guivain Merlin Blackthorn Morin Golstuck Karambol Kelerick Rockmore Bridport Casevil Stirm Tonis Pelegrim Peresohn Pirk Pharn Gork".split(" "),arab:"Ibn Fadlan;Mohammad;Al Ferissa;Harun Al Rashid;Sindbad;Mellemad;Moarrac;Sakhavan;Bellefars;Mokhac;Norahz;Kerhetin;Maham;Dushesh;Direkh".split(";"),asia:"Ishida Toranaga Ichinzen Haiako Mozuki Hitachi Tosheba Harachiko Marasuma Korodzum Ishinghen Genghis Musa Echibo Ichikahr Yotokan Maraga".split(" "),
common:"Fistantilus Skenderbeg Raislin Tenis Morok Sokob Baras Haram Billihz Ynte Orgh Savael Birgos Savator Gandeh Gordor Fessh Gilmi Phergas".split(" ")},Og=[x.gold,x.wood,x.food,x.stone,x.mana],Ih=function(d,b,e){e&&(d=d.replace("%d",e));return d.replace("%s",b)},Gd={},ai,Qc,dc={},Eg=function(){if(""!=q("mapconfiguration").innerHTML)for(var d="mapx mapwidth goldRes goldValue woodRes woodValue foodRes foodValue stoneRes stoneValue infinity infiniteValue water waterValue".split(" "),b=0,e=d.length;b<
e;b+=2){var c=document.getElementById(d[b+1]).value;"infinity"==d[b]?(c=document.getElementById(d[b+1]).checked,p[d[b]]=c):p[d[b]]=parseInt(c);localStorage[d[b]]=c}else"true"==localStorage.infinity&&(p.infinity=!0),p.goldRes=parseInt(localStorage.gold),p.foodRes=parseInt(localStorage.food),p.woodRes=parseInt(localStorage.wood),p.stoneRes=parseInt(localStorage.stone),p.mapx=parseInt(localStorage.mapSize),p.water=parseInt(localStorage.water);p.infinity&&(p.goldRes=Infinity,p.foodRes=Infinity,p.woodRes=
Infinity,p.stoneRes=Infinity);p.infinity=void 0;p.goldRes||(p.goldRes=Infinity);p.foodRes||(p.foodRes=Infinity);p.woodRes||(p.woodRes=Infinity);p.stoneRes||(p.stoneRes=Infinity);p.mapy=p.mapx;p.gravity=580.9/9.8*9.8;p.name="";p.arje=555555*Math.random()+1},xi=function(){p.online&&(Ck(x.initializing),p.editor=0);p.mapx||Eg();p.pausedTime=0;p.canceled=0;for(var d=Object.keys(c),b=D.length,e=0,f=d.length;e<f;e++){var g=c[d[e]];g.id=e;if(g.disabled)for(var h=0;h<b;D[h++].technology.disabled[e]=g.disabled);
if(g.hidden)for(h=0;h<b;D[h++].technology.hidden[e]=1);}var m=performance.now();Bc=document.getElementById("msgs1");p.online||(location.hash="");va("playermenu");va("index");lb("menu");lb("statButton");va("mapeditorinfo");va("mapeditorinfotop");lb("resources");Eb=D[w.kingdom];xf(w.kingdom);ai||(ai=JSON.parse(JSON.stringify(D.slice(1))));setTimeout(function(){p.cycle?p.deltaTime=25*p.cycle:(p.players=D.length-1,p.date=Date.now(),p.cycle=0,p.kingdoms=D,p.deltaTime=0);p.loadDate=Date.now();p.online||
Jh();p.now=ej;p.paused=0;p.pausedTime=0;p.zMax=96*p.mapy;Nb();var b=performance.now();p.allow14=!0;E=p.mapx;Ea=p.mapy;p.temperature=25;var d=p.temperature;0==w.temperature&&(d+="&deg;C");document.getElementById("temperature").innerHTML=d;ha=1;em();ze();Sf={};var e=E,f=-e,g=+e;Zb=[1,1+f,f,-1+f,-1,-1+g,g,g+1];fj=[f,-1,1,g];p.online&&lb("content");for(var h=["chat","loading","playermenu","index"],C=h.length,G=0;G<C;document.getElementById(h[G++]).style.display="none");q("loadingtext").innerHTML="Loading terrain";
b=performance.now();if(!1!==p.arje){var H=performance.now(),J=E,I=J*Ea,L=Math.sqrt(I),M=0,N=0,Q=0,S=0,U=0,X=0,aa=0,ba=0,Y=0,da=0,fa=0,ka=0,ia=0,na=100,pa=255,ta=0,qa=0,ja=0,va=new Int8Array(new ArrayBuffer(I)),oa=new Uint32Array([2,3,0,1,1,1,0,1,0,1,0,1,3,p.water,1,0,1,1,1,0,0,15,0,1]);for(Il(p.arje);Y<I;va[Y++]=0);var ya=oa.length;for(Y=0;Y<ya;Y+=4)oa[Y+3]&&(oa[Y+1]=~~(L/oa[Y+1]));for(da=0;da<ya;da+=4)for(na=oa[da+1],pa=oa[da],ta=oa[da+2],Y=0;Y<na;Y++)for(ka=~~(ea()*I+.5),U=6*ea()-3,X=6*ea()-3,ta?
(ba=ea()*L,ja=~~(ea()*(L/15))+4,aa=~~(100*ea())/4,qa=ja/12):(ba=128*ea(),ja=~~(2.56*ea())+4,aa=~~(100*ea())/2,qa=1),M=ka%J,N=~~(ka/J),fa=0;fa<ba;fa++)for(100*ea()>aa&&(U=(6*ea()-3)*qa,X=(6*ea()-3)*qa),M+=U,N+=X,Q=0;Q<ja;Q++)for(S=0;S<ja;S++)(Q-ja/2)*(Q-ja/2)+(S-ja/2)*(S-ja/2)<ja*ja/4&&(ia=~~M+Q+(S+~~N)*J,ia>=I?ia%=I:0>ia&&(ia+=I),va[ia]=pa);var za=performance.now();O("randomtxt1",za-H);O("drawTerrain: ",performance.now()-za);Qc=va}else Qc=p.terrain?new Int8Array(p.terrain):new Int8Array(E*Ea);dc.randomtxt=
performance.now()-b;O("randomtxt: ",dc.randomtxt);b=performance.now();q("loadingtext").innerHTML="Creating map";var Ca=E*Ea*4;R=new Uint32Array(new ArrayBuffer(Ca));Sa=new Uint32Array(new ArrayBuffer(Ca));jd=new Uint32Array(new ArrayBuffer(Ca));lc={};P.dimension=R;Be.dimension=Sa;tk.dimension=R;$g.dimension=Sa;V.dimension=R;fg.dimension=jd;Sb.dimension=Sa;eg.dimension=R;bb[0]=Sa;bb[1]=R;bb[2]=jd;dc.createMap=performance.now()-b;O("createMap: ",dc.createMap);q("content").style.display="block";b=performance.now();
if(!1===p.arje||p.allunits)z=p.allunits;else{var Ja=Qc,xa=p.mapx,La=p.mapy,Ta=performance.now(),la=0,Da=0,Za=0,Ma=0,Na=0,Ba=xa*La,Xa=Math.sqrt(Ba);Da=Ba;z=[];Hd={};var Ka=fm,$a=gm,ab=Hd,gb=hm,jb=[12,63,62],Aa=[];Da=D.length;for(la=1;la<Da;la++){for(var Wa=!0,Ya=D[la],nb=jb[Ya.race],Qa=0;Wa&&25>Qa;){Qa++;Ma=~~(ea()*(xa-15)+.5)+4;Na=~~(ea()*(La-15)+.5)+4;Wa=!1;Za=Aa.length;for(var sa=0;sa<Za;sa+=2)60>Math.sqrt((Ma-Aa[sa])*(Ma-Aa[sa])+(Na-Aa[sa+1])*(Na-Aa[sa+1]))&&(Wa=!0);Wa||(Aa.push(Ma+4,Na+3),Ka(Ma+
Na*xa,{type:nb,kingdom:la}))}if(25==Qa){D.length=la;break}}var hb=2*(Da-1);for(sa=0;sa<hb;sa+=2){var kb=2*Math.round(ea())-1;var ob=Aa[sa]+10*(2*Math.round(ea())-1)+~~(3*ea());var Ra=Aa[sa+1]+10*kb+~~(3*ea());var Fa=Aa[sa]+10*(2*Math.round(ea())-1)+~~(3*ea());var Ga=Aa[sa+1]+10*-kb+~~(3*ea());0>ob?ob=0:ob+4>E&&(ob-=(ob+4)%Ba);0>Ra?Ra=0:Ra+4>Ea&&(Ra-=(Ra+4)%Ba);0>Fa?Fa=0:Fa+4>E&&(Fa-=(Fa+4)%Ba);0>Ga?Ga=0:Ga+4>Ea&&(Ga-=(Ga+4)%Ba);O(Fa,Ga);Infinity!==p.goldRes&&Ka(ob+Ra*xa,{type:21});Infinity!==p.stoneRes&&
Ka(Fa+Ga*xa,{type:22})}if(Infinity!==p.goldRes){la=0;for(var ib=10*E*Ea/65536;la<ib;la++)Ka(~~(ea()*Ba),{type:21})}if(Infinity!==p.stoneRes)for(la=0,ib=10*E*Ea/65536;la<ib;la++)Ka(~~(ea()*Ba),{type:22});Da=1*~~(Xa/3.2);for(la=0;la<Da;la++){var rb=~~(ea()*xa+.5);var sb=~~(ea()*La+.5);var tb=~~(25*ea())+10;var xb=~~(25*ea())+10;for(Ya=0;55>Ya;Ya++){Ma=~~(ea()*tb+~~(rb+18*ea()-9)+.5);Na=~~(ea()*xb+~~(sb+18*ea()-9)+.5);var Va=Ma+Na*xa;$a(Va)&&Va<=Ba&&Ka(Va,{type:7,d:~~(28*ea()+3)})}}Da=40*~~(Xa/256);
for(la=0;la<Da;la++){Va=~~(ea()*Ba+.5);var Pa=Xh[~~(ea()*Xh.length)],yb=Object.assign({},Pa);yb.d+=~~(Pa.dMax*ea());if(Pa.sword||Pa.potion)yb.attack=~~(6*ea())+1;if(Pa.shield||Pa.potion)yb.defence=~~(6*ea())+1;if(Pa.book){var ub=~~(ea()*hg.length);yb.spell=hg[ub];yb.iconID=c[hg[ub]].iconIDbook;yb.name=x[yb.spell];yb.attack=~~(6*ea())+1}Ka(Va,yb)}Da=3*~~(Xa/256);for(la=0;la<Da;la++)Va=~~(ea()*Ba),$a(Va)&&Ka(Va,{type:43});for(sa=0;sa<hb;sa+=2)for(ob=Aa[sa]-25,Ra=Aa[sa+1]-25,Fa=0;50>Fa;Fa++)for(Ga=0;50>
Ga;Ga++)if(625>(Fa-25)*(Fa-25)+(Ga-25)*(Ga-25)){var db=Fa+ob+(Ga+Ra)*xa;7===gb(db).type&&(z.quit(ab[db]),ab[db]=void 0);1===mc.type[Ja[db]]&&(Ja[db]=0)}O("random:",performance.now()-Ta);dc.random=performance.now()-Ta}p.movtable&&!p.demo&&(Yc=p.movtable,Zc=p.movtable2);var Ab=performance.now();q("loadingtext").innerHTML="Loading textures";fl(Qc);dc.setupGL=performance.now()-Ab;O("setupGL: ",dc.setupGL);var wb=performance.now(),Bb=p.tr,mb=z;if(!p.custom&&mb){for(var Hb=p,Cb=mb,Db="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy".split(" "),
Eb={},cb=0;cb<Db.length;cb++)Eb[Db[cb]]=cb;var Gb=[],Lb=Cb.length;for(cb=0;cb<Lb;cb++){var Ib=Cb[cb],Fb=Object.keys(Ib),Kb={};Gb.put(Kb);for(var ra=0,Qb=Fb.length;ra<Qb;ra++)Kb[Eb[Fb[ra]]]=Ib[Fb[ra]]}Hb.ini=Gb}p.demo&&(mb=p.ini);if(mb)for(var Jb=0,Rb=mb.length;Jb<Rb;Jb++){var Ha=mb[Jb];if(void 0!==Ha.race){Ha.type=im[Ha.type+256*Ha.race];Ha.kingdom=Bb[Ha.kingdom];if(void 0==Ha.type)continue;var Tb=u[Ha.type];if(13==Ha.type||Tb.build)Ha.d=0;Ha.resource&&(Ha.health=Ha.resource,Ha.maxHealth=Ha.resource);
if(!Ha.health||void 0==Ha.kingdom)continue}if(Ha.death)y.put(Ha);else if(!Ha.cancell){var Ob=Ha.x32,Pb=Ha.y32,ac=!1===Ha.built&&1===Ha.health?!0:!1,bc=Ha.kingdom||0,Yb=new ad(Ha.type,bc,Ob,Pb,0,ac,Ha);Yb.invalid||(ac||yj(Yb),Yb.castle&&(D[bc].origin=[Ob+4,Pb+3]))}}Hd=z=null;O("positioned:",performance.now()-wb);dc.positioned=performance.now()-wb;dc.setupGL=performance.now()-b;O("setupGL: ",dc.setupGL);qb(vb);qb(K);ce(w.kingdom);Xj();Dk();window.addEventListener("keydown",hk);window.addEventListener("keyup",
ik);window.addEventListener("mousemove",jk);T=zb;ca=new Float32Array(12);var Ub=Ia[l.blank].id;A[0]=Ub;A[1]=0;A[2]=1;A[3]=0;A[4]=Ub;A[5]=0;A[6]=1;A[7]=0;A[8]=Ub;A[9]=0;A[10]=1;A[11]=0;A[12]=Ub;A[13]=0;A[14]=1;A[15]=0;var Mb=ua;Mb[0]=0;Mb[1]=1;Mb[2]=2;Mb[3]=1;Mb[4]=2;Mb[5]=3;k.bindBuffer(k.ARRAY_BUFFER,rd);k.bufferSubData(k.ARRAY_BUFFER,0,A);k.bindBuffer(k.ARRAY_BUFFER,pb);var $b=3*w.kingdom,Vb=wa[$b],cc=wa[$b+1],Wb=wa[$b+2];k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([Vb,cc,Wb,.5,Vb,cc,Wb,.5,
Vb,cc,Wb,.5,Vb,cc,Wb,.5]));var Xb=96*E;ca[2]=Xb;ca[5]=Xb;ca[8]=Xb;ca[11]=Xb;window.addEventListener("mousedown",kk);window.addEventListener("mouseup",lk);O("FULL: ",performance.now()-m);p.record||(p.record={});p.online?(Xc(Oe(),x.waitingPlayers,1),w.admin?ld():W(ld,0,0)):ig();p.allow14=!1;kd.list.push(0,JSON.stringify(dc))},300)},Oe=function(){for(var d=M.length,b=M,e="",c=0;c<d;c++)Oe.obj[b[c].id]||b[c].id==w.onlineID||(e+="<br>"+b[c].name);return e};Oe.obj={};var vi=function(){return w.gl?!1:(Xc("You can't run WEBGL 2<br>More info <a href='http://webglreport.com/?v=2'>here</a>",
"Error"),Lb(),!0)},Dg=!1,Rd,jl=function(d){var b={};Rd={events:{defined:b,nodefined:{}}};for(var e={moving:1},c=0,g=0,h=d.length;g<h;g++){var m=d[g];m.activeEvents=0;for(var k=m.events,l=0,n=k.length;l<n;l++){var p=k[l];p.id=c++;var q=p.list,r=p.to,u=p.type,w=p.zone;p.rule=m;for(var x=p.activeEvents=0,y=q.length;x<y;x++){var z=q[x];b[z]||(b[z]={});z=b[z];if(e[u])z[u]||(z[u]=[]),z[u].put(p);else if("zone"==u){z[u]||(z[u]=[]);for(var A=0;A<w.length;A++)z[u].push(p,w[A][0],w[A][1],w[A][2],w[A][3])}else{z[u]||
(z[u]={defined:{}});z=z[u].defined;A=0;for(var C=r.length;A<C;A++)z[r[x]]||(z[r[x]]=[]),z[r[x]].put(p)}}}}},Xj=function(){var d=document.getElementById("playersinfo");d.innerHTML="";if(!p.editor)for(var b=1,e=D.length;b<e;b++){var c=D[b],g=c.death?c.name.strike():c.name;d.innerHTML+=g+"<span id='score"+b+"'> 0/0</span><div class='playercolor' style='background:rgb("+c.color[0]+","+c.color[1]+","+c.color[2]+")'></div><br>"}},Dk=function(){var d=window.innerWidth-w.mx,b=window.innerHeight,e=D[w.kingdom].origin;
e?(d=32*e[0]-.5*d,b=32*e[1]-.5*b):b=d=0;ud(~~d,~~b)},ye,pk,ek,em=function(){var d=document.getElementById("selectedobject").getContext("webgl",{antialias:!1,depth:!1}),b=d.createShader(d.VERTEX_SHADER);d.shaderSource(b,"void main() {\ngl_Position = vec4(0 ,0, 0, 1);\ngl_PointSize=48.0;\n}");d.compileShader(b);var e=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(e,"precision mediump float;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nuniform float txtCoord;\nvoid main() {\ngl_FragColor = texture2D(u_image, (vec2(\tmod(txtCoord,21.0) ,floor(txtCoord/21.0) ) + gl_PointCoord)*(0.046875));\nif(gl_FragColor.r==gl_FragColor.g&&gl_FragColor.r==gl_FragColor.b) gl_FragColor*=u_color;\n}");
d.compileShader(e);var c=d.createProgram();d.attachShader(c,b);d.attachShader(c,e);d.linkProgram(c);d.useProgram(c);b=d.createTexture();d.bindTexture(d.TEXTURE_2D,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texImage2D(d.TEXTURE_2D,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,X.icons);var g=d.getUniformLocation(c,"u_color"),
h=d.getUniformLocation(c,"txtCoord");ye=function(b){if(Ia[b.img][3]){var e=b.kingdom;d.uniform4f(g,wa[3*e],wa[3*e+1],wa[3*e+2],1)}else d.uniform4f(g,1,1,1,1);d.uniform1f(h,b.iconID);d.drawArrays(d.POINTS,0,1)};pk=function(){d.uniform4f(g,1,1,1,1);d.uniform1f(h,189);d.drawArrays(d.POINTS,0,1)};ek=function(){d.uniform1f(h,0);d.uniform4f(g,0,0,0,0);d.drawArrays(d.POINTS,0,1)}},ac=128,Cb=128,y=[{terrain:1},{terrain:1},{terrain:1}],Fb={},ce=function(d){d===w.kingdom&&(d=Eb.values.popMax<Eb.values.popLimit?
Eb.values.popMax:Eb.values.popLimit,document.getElementById("pop").innerHTML=Eb.values.pop+"/"+d)};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(d){window.setTimeout(d,1E3/60)}}();var Hd=z=void 0;var fm=function(d,b){Hd[d]||(b.x32=d%E,b.y32=~~(d/Ea),z.put(b),Hd[d]=b)},gm=function(d){return!z[d]},hm=function(d){return Hd[d]||NaN},Ya=[];window.addEventListener("offline",function(d){Td("Offline",
"#ff0000")});window.addEventListener("online",function(d){Td("Online","#00ff00")});var bi=function(){sa.leaveRoom();Ya.length=0},Id={};(function(){for(var d=["returnmenu","index","Account","accountIframe"],b=0,e=d.length;b<e;Id[d[b]]=document.getElementById(d[b++]));})();var jm=function(){location.replace("#"+this.gameID+"Room")},Di=function(d){Ya=[];O("connecting to",d,x.loading);q("game").style.display="block";q("gameName").innerHTML=x.loading;q("returnmenu").style.display="none";q("index").style.display=
"none";Rc.innerHTML="";Bc.innerHTML="";w.p2p?(sa.joinRoom(d,Gg),Cg()):(sa||oc(),oc.func=function(){Di(d)})},km={6400900:".",28462225:"a",29052100:"b",29648025:"c",3025E4:"d",30858025:"e",31472100:"f",32092225:"g",32718400:"h",33350625:"i",33988900:"j",34633225:"k",35283600:"l",35940025:"m",36602500:"n",37271025:"o",37945600:"p",38626225:"q",39312900:"r",40005625:"s",40704400:"t",41409225:"u",42120100:"v",42837025:"w",4356E4:"x",44289025:"y",45024100:"z"},lm=function(d){q("game").style.display="none";
M.length=0;p.online=0;bi();Lb();d.constructor==String&&Xc(d)},Wj={euro:0,arab:0,asia:0},Ai=function(d,b,e){if(e){b=ci(e.id);var c=b[1];b=b[0];d=Xa(d);b.username||(Ek[c].innerHTML=d,b.name||Ck(x.joining,d,1E3),b.name=d,e.username=d)}},zi=function(d,b,e){e&&e.admin&&d!=w.version&&(Lb(),sa.leaveRoom(),Xc(x.versionError+"<p> Admin version: "+parseInt(d.substr(1))+"<br> Your version: "+parseInt(w.version.substr(1))))},Ta=function(d,b){if(b.resend)if(d.destinatary)(b=md(d.destinatary))&&b.id!=w.onlineID&&
(d.bridge=h.id,b.send(d));else{b=b.resend;for(var e=0,c=b.length;e<c;e++){var g=b[e];d.bridge=h.id;g.send(d)}}else{var h=b;d.bridge&&(h=md(d.bridge));if(void 0===d.length){if(void 0!==d.func)(0,hf[d.func])(d[1],d[2],h)}else b=d[0],h.orderList[b]=d,Ta.done[b]||(Ta.done[b]=0),Ta.done[b]++,Ta.done[b]==Ya.length&&Ta.func&&(Ta.func=!1,gh(),Nb())}};Ta.done=[];var nd=function(d,b,e){e&&(O(e.id,"CAN connect"),nd.ids[d]||(nd.ids[d]=1,w.admin||clearTimeout(nd.intv[d]),O("MAKE BRIDGE"),md(d).bridge=e,W(Fk,d,
0,[e],0)))};nd.ids={};nd.intv={};var Fk=function(d,b,e){e&&(O("BRIDGE"),e.resend||(e.resend=[]),e.resend.put(md(d)))},md=function(d){for(var b=0,e=Ya.length;b<e;b++){var c=Ya[b];if(c.id==d)return c}},sa,Gk=function(d){if(!q("usernameForm")){Ob();var b=localStorage.name||"Guest",e=localStorage.color||"#"+Math.floor(16777215*Math.random()).toString(16),c=document.createElement("div");c.id="usernameForm";c.innerHTML="\n            <div>\n            <h2>"+x.username+'</h2>\n            <div>\n<input type="color" id=\'usernameColor\' value="'+
e+'" /><input id=\'usernameVal\' type="text" value="'+b+'" />\n</div>\n<br />\n</div>';b=document.createElement("button");b.innerHTML=x.continue;b.onclick=function(){w.name=Xa(q("usernameVal").value);w.color=q("usernameColor").value;localStorage.color=w.color;localStorage.name=w.name;document.body.removeChild(q("usernameForm"));d();nb()};c.children[0].appendChild(b);document.body.appendChild(c)}},oc=function(){vi()||(w.name?(ol(),sa=new SimpleWebRTC({localVideoEl:"",remoteVideosEl:"",autoRequestMedia:!1,
receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},url:"https://solar.tza.red/"}),sa.on("channelMessage",function(d,b,e){"nehhof"==e.type&&(b=JSON.parse(e.payload),Ta(b,d))}),sa.on("error",function(d){"full"==d&&(Lb(),Td(x.gameFull,"#ff0000"))}),sa.on("connectionReady",function(d){var b=sa.connection.connection;w.p2p=b;b.username=w.name;b.color=w.color;b.on("getRooms",function(b){var d=b.date,e=Object.keys(b),c=q("gameList");if(1<e.length){c.innerHTML="";for(var m=0,k=e.length;m<k;m++){var l=
e[m],n=b[l];if("date"!=l){var p=n.len;if(p){var u=document.createElement("tr"),r="";r=n.playing?r+("<td><div class='redCircle'></div>"+x.playing+"</td>"):r+("<td><div class='redCircle' style=\"background:rgba(0,255,0,.8)\"></div>"+x.waiting+"</td></td>");r+="<td>"+Xa(n.description)+"</td><td>"+~~((d-n.date)/6E4)+" min ago</td><td>"+Xa(p)+"/"+Xa(n.max)+"</td>";u.innerHTML=r;u.gameID=l;n.playing||(u.onclick=jm);c.appendChild(u)}}}}else c.innerHTML="<tr><td>No games found</td></tr>"});w.onlineID=d;oc.func&&
oc.func()}),sa.on("createdPeer",function(d){p.started||kl(d)})):Gk(oc))},mm=function(){Cg();nb();q("game").style.display="block";q("gameName").innerHTML=x.loading;q("returnmenu").style.display="none";q("index").style.display="none";Rc.innerHTML="";Bc.innerHTML="";Ya=[];Bi();w.admin=1;w.room={description:q("gameFormName").value,max:parseInt(q("gameMax").value),public:!0};2>w.room.max&&(w.room.max=2);14<w.room.max&&(w.room.max=14);localStorage.gameDescription=w.room.description;sa.createRoom(w.onlineID+
"b",Gg);p.online=1;document.body.removeChild(q("gameForm"))},Hk=function(){sa||oc();if(w.onlineID){Ob();var d=localStorage.gameDescription||w.name+"'s room",b=document.createElement("div");b.id="gameForm";b.innerHTML="\n<div>\n            <h2>"+x.gameOptions+"</h2>\n            "+x.gameName+': <input id=\'gameFormName\' type="text" value="'+d+'" maxlength="29" /><br />\n'+x.nplayers+': <input id="gameMax" type="number" value="6" max="14" min="2"/><br />\n            </div>';d=document.createElement("button");
d.innerHTML=x.continue;d.onclick=mm;b.children[0].appendChild(d);document.body.appendChild(b)}else setTimeout(function(){location.hash=""},200),oc.func=Hk},Ik=function(d){for(var b="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy stock".split(" "),c=[],f=d.length,g=
0;g<f;g++){var h=d[g],m=Object.keys(h),k={};c.put(k);for(var l=0,n=m.length;l<n;l++)k[b[m[l]]]=h[m[l]]}return c},nm=function(d){for(var b=d.length,c=new Uint8Array(b),f=0,g=-1,h=0,m=0;m<b;m++){var k=d[m];if(g===k)h||(c[f++]=255),h++;else{if(h){if(4>h){f--;for(var l=0;l<h;l++)c[f++]=g}else c[f++]=h>>8&255,c[f++]=h&255;h=0}c[f++]=k}g=k}if(h)if(4>h)for(f--,l=0;l<h;l++)c[f++]=g;else c[f++]=h>>8&255,c[f++]=h&255;return c.slice(0,f)},Jk=function(d,b){b=JSON.stringify(b);d.sendDirectly("channelMessage",
"nehhof",b)},Pe=[],W=function(d,b,c,f,g){var e;if(!0===g&&p.online&&Ya.length)c.change&&(c=c.slice(0)),xa(function(){W(d,b,c,f,55)});else if(void 0===d.location)d();else{if(p.started&&!p.editor){var m=p.record;m[p.cycle]||(m[p.cycle]=[]);var k=m[p.cycle];m=k.length;k[m]=d.location;k[m+1]=b;c.length&&(c=c.slice(0));k[m+2]=c}if(!p.blocked&&p.online&&Ya.length)if(55===g&&(e=!1),k={func:d.location,1:b,2:c,active:e,rnd:4294967296*Math.random()},p.started&&d!=Nb&&d!=ig&&d!=vc)if(f)for(m=0,e=f.length;m<
e;m++)g=f[m],k.destinatary=g.id,g.bridge?Jk(g.bridge,k):Jk(g,k);else Pe.put(k);else di(k),d(b,c);else d(b,c)}},om=function(){if(Ya.length){Eg();ld.i=0;w.p2p.emit("gameStarted");for(var d={},b=0,c=M.length;b<c;b++)d[M[b].id]=b;W(ei,p,d,0,0)}},ld=function(d,b,c){c&&(Oe.obj[c.id]=1,d=Oe(),""==d?Xc(d,x.loading,1):Xc(d,x.waitingPlayers,1));w.admin&&(ld.i++,ld.i==M.length&&setTimeout(function(){W(ig,0,0,0,!0)},100))};ld.i=0;var di=function(d){d=JSON.stringify(d);for(var b=0,c=Ya.length;b<c;b++)Ya[b].sendDirectly("channelMessage",
"nehhof",d)},od,fi,gh=function(){if(!Ta.done[od]||Ta.done[od]<Ya.length)return Ta.func=!0,Nb(),!0;for(var d=0,b=M.length;d<b;d++){var c=md(M[d].id);if(d==w.kingdom-1)var f=fi;else{if(!c)continue;f=c.orderList[od]}for(var g=1,h=f.length;g<h;g++){var m=f[g];hf[m.func](m[1],m[2],c)}}Ta.func=!1;di(Pe);fi=Pe;od++;Pe=[od+1];return!1},ig=function(){document.getElementById("alert").style.display="none";p.started=1;p.date=Date.now();Nb();ab();nb();od=0;if(!p.custom||p.demo)for(var d=1,b=D.length;d<b;d++){var c=
La[Zf[D[d].race]],f=c.peasant.type;if(c=y[Ja[d][c.castle.type][0]])$c(f,c,1),$c(f,c,1),$c(f,c,1)}db.arr=[];db.units=[];db.time=500;db.steps=0;db.process=0;if(!p.editor&&!p.demo){for(d=0;d<D.length;d++)D[d].IA&&new db(D[d]);d=0;b=db.arr;for(f=b.length;d<f;b[d++].leaveMeAloneIKnowWhatToDo());Zg()}p.online&&(di([0]),Pe=[1],fi=[0]);Hb()},ei=function(d,b,c){if(c&&c.admin){c=[M[0]];for(var e=0,g=M.length;e<g;e++)c[b[M[e].id]]=M[e];M=c}qa("bless");p=d;p.infinity&&(p.goldRes=Infinity,p.foodRes=Infinity,p.woodRes=
Infinity,p.stoneRes=Infinity);p.infinity=void 0;p.goldRes||(p.goldRes=Infinity);p.foodRes||(p.foodRes=Infinity);p.woodRes||(p.woodRes=Infinity);p.stoneRes||(p.stoneRes=Infinity);vd()},Od=!1,nb=function(){Od=!1;q("basic").style.filter=""},Ob=function(){Od=!0;q("basic").style.filter="blur(94px)"};var pm=function(){lb("game");M.length=0;p.online=0;bi();Lb();w.admin=0};var Gg=function(d){if(w.admin||d)if(d=sa.roomName,d+="Room",O("login"),nb(),0!==sa.getPeers().length||w.admin){var b=w.room||NaN;p.id=
d;p.online=1;Bi();lb("chat");q("gameName").innerHTML=Xa(b.description)||"Online Game";q("onlineID").value=location.origin+"/#"+p.id;va("returnmenu");Fg();w.admin?(location.replace("#"+p.id),q("buttons").innerHTML='<button id="startbutton">'+x.play+'</button><button id="optionbutton">'+x.options+'</button><button id="closebutton">'+x.close+"</button>",q("startbutton").onclick=om,q("optionbutton").onclick=Kk,q("closebutton").onclick=pm):(q("buttons").innerHTML='<button id="quitbutton">'+x.disconnect+
"</button>",q("quitbutton").onclick=lm);sa.connection.on("remove",function(b){if(b=md(b.id))if(vc(Ih(x.playerDisconnected,b.username),0,5),p.online){if(p.started)for(var d=0;d<M.length;d++)if(M[d].id==b.id){D[d+1].die();break}Ya.quit(b);p.started?Ta.done[od]==Ya.length&&Ta.func&&(Ta.func=!1,gh(),Nb()):(Fg(),b.admin&&(Lb(),sa.leaveRoom(),Xc(x.gameClosed)))}})}else location.hash="",Lb()},xa=function(d){xa.func.put(d);0===xa.active&&(W(Lk,0,0,0,0),xa.date=Date.now(),xa.received=0,xa.max=-Infinity,xa.active=
1)};xa.func=[];xa.active=0;var Lk=function(d,b,c){c&&W(Mk,0,0,[c],0)},gi={},Mk=function(d,b,c){if(c&&(c.ping=~~(.5*(Date.now()-xa.date)+.5),gi[c.id]?gi[c.id].put(c.ping):gi[c.id]=[c.ping],c.ping>xa.max&&(xa.max=c.ping),xa.received++,xa.received==Ya.length)){d=performance.now();b=0;for(c=xa.func.length;b<c;xa.func[b++]());O(-d+performance.now());xa.func.length=0;xa.active=0}},hi=document.getElementsByClassName("ucolor"),Ek=document.getElementsByClassName("username"),ii=document.getElementsByClassName("race"),
jg=document.getElementsByClassName("team"),nc=document.getElementsByClassName("isconnected"),Jg=function(d,b,c){c&&(b=ci(c.id),c=b[1],b=b[0],b.race=d%3,b.race||(b.race=0),ii[c].innerHTML=$a[b.race])},ci=function(d){for(var b=0,c=M.length;b<c;b++){var f=M[b];if(f.id==d)return[f,b]}},Hg=function(d,b,c){if(c){O(d);b=d.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);b||(d="ffffff",b=["ffffff","ff","ff","ff"]);c.color=d;c=ci(c.id);var e=c[1];c=c[0];hi[e].style.background=d;c.color=[parseInt(b[1],16),
parseInt(b[2],16),parseInt(b[3],16)]}},Ig=function(d,b,c){d=parseInt(d);if(isNaN(d)||!d)d=0;(d%=5)||(d=0);if(c){b=c.id;c=0;for(var e=M.length;c<e;c++){var g=M[c];if(g.id==b){g.team=d;jg[c].innerHTML=d;break}}}},Fg=function(){O("setup MENU");var d=document.getElementById("multiplayertable");d.innerHTML="";for(var b=w.room?w.room.max:14,c=0;c<b;c++)d.innerHTML+='<tr><td class="ucolor"></td><td class="username">'+x.open+'</td><td class="race"></td><td class="team"></td><td class="isconnected"></td></tr>';
d=sa.roomName;d=d.substr(0,d.length-1);var f=[w.p2p];c=0;for(b=Ya.length;c<b;c++){var g=Ya[c];g.admin?f.unshift(g):f.put(g)}for(b=0;b<f.length;b++){g=f[b];M[b]&&M[b].id==g.id?c=M[b]:(c=parseInt((g.color||"ffffff").substr(1),16),c={color:[c>>16&255,c>>8&255,c&255],ia:0,name:g.username,race:0,team:sa.getPeers().length+1,id:g.id,cID:b});g&&g.id?(nc[b].style.background="#00ff00",nc[b].style.boxShadow="0px 0px 30px 0px #00ff00"):(nc[b].style.background="#ff0000",nc[b].style.boxShadow="0px 0px 30px 0px #ff0000");
hi[b].style.background="rgb("+c.color[0]+","+c.color[1]+","+c.color[2]+")";Ek[b].innerHTML=c.name;c.id==d&&(g.admin=!0);if(w.onlineID==c.id){jg[b].innerHTML="";g=document.createElement("button");g.onmousedown=Nk;g.iteam=b;g.innerHTML=c.team;jg[b].appendChild(g);g=document.createElement("button");g.onmousedown=Ok;g.iteam=b;g.innerHTML=$a[c.race];ii[b].appendChild(g);g=document.createElement("input");g.type="color";var h=c.color;g.iteam=b;g.value="#"+(16777216+(h[0]<<16)+(h[1]<<8)+h[2]).toString(16).slice(1);
hi[b].appendChild(g);g.onchange=Pk;nc[b].style.background="#00ff00";nc[b].style.boxShadow="0px 0px 30px 0px #00ff00"}else jg[b].innerHTML=c.team,ii[b].innerHTML=$a[c.race];M[b]=c}M.length=f.length},M=[];window.onhashchange=Ci;var Bc=document.getElementById("msgs"),Rc=document.getElementById("msgs1"),kg=document.getElementById("msginput"),Lh=document.getElementById("msginputGame"),Kh=document.getElementById("enterwindow");kg.addEventListener("keyup",function(d){13==d.keyCode&&Mh()});var vc=function(d,
b,c){qa("chat");c&&(b=p.started?Rc:Bc,b.innerHTML=5!==c?b.innerHTML+("<li><span>"+c.username+" \u2014</span> "+Xa(d)+"</li>"):b.innerHTML+("<li>"+d+"</li>"),b.scrollTop=b.scrollHeight,p.started&&lg())},lg=function(){11==Bc.children.length&&Rc.removeChild(Rc.children[0]);1==Bc.children.length&&(lg.intv=setInterval(qm,16E3))},qm=function(){Rc.removeChild(Rc.children[0]);0==Bc.children.length&&clearInterval(lg.intv)},Xa=function(d){return String(d).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;")},Mh=function(){if(p.started){var d=Rc,b=Lh.value;Lh.value=""}else d=Bc,b=kg.value,kg.value="";""!=b&&(b=Xa(b),d.innerHTML+="<li><span>"+w.name+" \u2014</span> "+b+"</li>",W(vc,b,0,0,0),d.scrollTop=d.scrollHeight,p.started&&lg())},hf=[ei,Ib,sc,uc,sf,tc,rc,Fi,Gi,vc,cf,ge,Ad,Uh,Bd,we,qh,of,lh,ld,Nb,Lk,Mk,Ig,gk,function(d,b,c){c&&(d=md(d))&&d.open&&(O("I CAN connect"),W(nd,d.id,0,[c],0))},nd,Fk,ig,Yg,Bh,Kf,Dh,Nj,yh,wf,zf,Uf,Mf,Eh,Df,xj,le,Hg,function(d,b){b=y[b];var c=d[0];d=d[1];var f=E;!1!==
c&&(b.kx=c);!1!==d&&(b.ky=d);c=-(b.x32+c+(d+b.y32)*f);b.stop=b.kx||b.ky?!1:!0;Number.isInteger(b.xf)||Ib(c,[b.id])},xh,Fj,ah,Jg,Bf,Ah,Wf,Pf,Jj,Yf,Hf,Ff,Rf,Gh,Zj,Kj,Zi,Ai,zi];localStorage.favMusic&&(musicSelect.mversion.value=localStorage.favMusic);ei.antiHack=0;Ib.antiHack=0;sc.antiHack=0;uc.antiHack=0;sf.antiHack=0;tc.antiHack=0;rc.antiHack=0;ba.antiHack=0;qf.antiHack=0;la.antiHack=0;Ab.antiHack=0;ba.antiHack=0;Fi.antiHack=0;Gi.antiHack=0;vc.antiHack=0;cf.antiHack=0;ge.antiHack=0;Ad.antiHack=0;de.antiHack=
0;Uh.antiHack=0;Bd.antiHack=0;we.antiHack=0;qh.antiHack=0;of.antiHack=0;(function(){for(var d=hf,b=0,c=d.length;b<c;b++)d[b].location=b})();var Qk=document.getElementsByClassName("ucolor1"),rm=document.getElementsByClassName("username1"),sm=document.getElementsByClassName("race1"),tm=document.getElementsByClassName("team1"),Nk=function(d){var b=1;2==d.button&&(b=-1);d=this.iteam;M[d].team+=b;0>M[d].team&&(M[d].team=0);this.innerHTML=M[d].team;p.online&&(b=parseInt(this.innerHTML),b%=6,0==b&&(b=1),
this.innerHTML=b,W(Ig,b,0,0,2),M[d].team=b)},Ok=function(d){d=M[this.iteam];d.race=(d.race+1)%3;this.innerHTML=$a[d.race];W(Jg,d.race,0,0,2)},Pk=function(){this.parentElement.style.background=this.value;var d=this.value.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);M[this.iteam].color=[parseInt(d[1],16),parseInt(d[2],16),parseInt(d[3],16)];w.color=this.value;Ya.length&&W(Hg,this.value,0,0,2)},um=function(){jc.nu++;jc()},vm=function(){jc.nu--;0>=jc.nu?jc.nu=1:M.length--;jc()},Zf={0:"euro",1:"arab",
2:"asia"},Rk=[["a","e","i","o","u"],"bcdfghjklmnpqrstvwxyz".split("")],jc=function(){if(w.name){document.getElementById("returnmenu").style.display="block";document.getElementById("oneplayertbody").innerHTML="";document.getElementById("oneplayertbody").innerHTML+='<tr><td></td><td id="addremove"><button id="addPlayer">+</button><button id="removePlayer">-</button></td><td></td><td></td></tr>';for(var d=jc.nu,b=0;b<d;b++)if(document.getElementById("oneplayertbody").innerHTML+='<tr><td class="ucolor1"></td><td class="username1"></td><td class="race1"><button></button></td><td class="team1"><button></button></td></tr>',
!M[b]){var c=~~(16777216*Math.random());M[b]={color:[c>>16&255,c>>8&255,c&255],IA:1,race:~~(3*Math.random()),team:b}}document.getElementById("addPlayer").onclick=um;document.getElementById("removePlayer").onclick=vm;c=parseInt(w.color.substr(1),16);M[0].color=[c>>16&255,c>>8&255,c&255];M[0].name=w.name;for(b=c=M[0].IA=0;b<d;b++){var f=M[b],g=mj[Zf[f.race]];if(f.IA)if(c<g.length)f.name=g[c++];else{g=f;var h=~~(9*Math.random())+2,m=Rk[1],k=m[~~(Math.random()*m.length)].toUpperCase();.85<Math.random()&&
(k+=m[~~(Math.random()*m.length)]);for(m=0;m<h;m++){var l=Rk[m%2];k+=l[~~(Math.random()*l.length)];.8<Math.random()&&(k+=l[~~(Math.random()*l.length)])}g.name=k}Qk[b].style.background="rgb("+f.color[0]+","+f.color[1]+","+f.color[2]+")";rm[b].innerHTML=f.name;g=tm[b].getElementsByTagName("button")[0];g.iteam=b;g.onmousedown=Nk;g.innerHTML=b;g=sm[b].getElementsByTagName("button")[0];g.iteam=b;g.onmousedown=Ok;g.innerHTML=$a[f.race];f=M[b].color;g=document.createElement("input");g.type="color";g.iteam=
b;g.value="#"+(16777216+(f[0]<<16)+(f[1]<<8)+f[2]).toString(16).slice(1);Qk[b].appendChild(g);g.onchange=Pk}}else Gk(jc)};jc.nu=4;var Ck=function(d,b,c){"granted"!=Notification.permission&&Notification.requestPermission(function(b){});var e=new Notification(d,{icon:"https://i.imgur.com/SWtWteN.png",body:b,requireInteraction:!0});c||(c=7550);setTimeout(function(){e.close()},c)},mc,Sc=function(d){if(ka(d%E,~~(d/E))&&(d=Qc[d],0<=d&&!mc.type[d]))return!0},Sk=function(d){for(var b="",c=0,f=d.length;c<
f;c++)b+=km[d[c]];return b};ql[Sk([32718400,37271025,40005625,40704400,36602500,28462225,35940025,30858025])]!==Sk([40704400,45024100,28462225,6400900,39312900,30858025,3025E4])&&(O("edge chrome firefox - compt"),xi=Fc);var Uc=function(d){if(d){Uc.update=!1;d=Qc;for(var b=1*E,c=[],f={},g=0,h=E*Ea;g<h;g++){var m=d[g];if(mc.type[m]||0>m){var l=0;Sc(g-1-b)&&(l+=1E7);Sc(g-b)&&(l+=1E6);Sc(g-b+1)&&(l+=1E5);Sc(g-1)&&(l+=1E4);Sc(g+1)&&(l+=1E3);Sc(g-1+b)&&(l+=100);Sc(g+b)&&(l+=10);Sc(g+1+b)&&(l+=1);mc.type[m]&&
(Fb[g]=1,Sa[g]=1,R[g]=1);l?void 0!==qk[l]&&(c.put(g),f[c.length-1]=-qk[l]/256-2):0>m&&(d[g]=3)}}g=0;for(b=c.length;g<b;g++)h=c[g],d[h]=f[g],Fb[h]=2,Sa[h]=2,R[h]=2;k.useProgram(na);k.activeTexture(k.TEXTURE1);c=k.createTexture();k.bindTexture(k.TEXTURE_2D,c);k.texImage2D(k.TEXTURE_2D,0,k.R8I,E,Ea,0,k.RED_INTEGER,k.BYTE,d);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT);
k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT);k.bindTexture(k.TEXTURE_2D,null);k.bindTexture(k.TEXTURE_2D,c);k.uniform1i(k.getUniformLocation(na,"img_data"),1);k.useProgram(pa);k.activeTexture(k.TEXTURE2)}else Uc.update=!0};Uc.update=!1;var c,vk,hg,Ce,De,Ee,Fe,Ge,He,Ie,Je,Ke,Le,Me,Ne,cm=function(){var d={};c={move:function(){T=Ib;Ib.cursor=7}};c.move.iconID=262;c.move.obj={name:x.move};c.attack=function(){T=uc};c.attack.iconID=250;c.attack.obj={name:x.attack};c.guard=function(){Oc(4)};c.guard.iconID=
237;c.guard.obj={name:x.guard};c.patrol=function(){Oc(8)};c.patrol.iconID=238;c.patrol.obj={name:x.patrol};c.pickUp=function(){T=Ad};c.pickUp.iconID=240;c.pickUp.obj={name:x.pickItems};c.explore=function(){Oc(7)};c.explore.iconID=40;c.explore.obj={name:x.explore};c.stop=function(){W(qh,0,G)};c.stop.iconID=160;c.stop.obj={name:x.stop};c.stand=function(){W(xj,0,G)};c.stand.iconID=27;c.stand.obj={name:x.stand};c.attackGround=function(){};c.attackGround.iconID=100;c.steady=function(){};c.steady.iconID=
21;c.createOrk=function(){Q(58)};c.createOrk.iconID=120;c.createDwarf=function(){Q(59)};c.createDwarf.iconID=117;c.createSkeleton=function(){Q(60)};c.createSkeleton.iconID=87;c.createGhost=function(){Q(40)};c.createGhost.iconID=222;c.createFootman=function(){Q(0)};c.createFootman.iconID=182;c.createArcher=function(){Q(4)};c.createArcher.iconID=185;c.createMaceman=function(){Q(3)};c.createMaceman.iconID=186;c.createPikeman=function(){Q(1)};c.createPikeman.iconID=183;c.createLongbowman=function(){Q(6)};
c.createLongbowman.iconID=184;c.createKnight=function(){Q(19)};c.createKnight.iconID=180;c.iniMercenaries=function(b){b.mlist=[];b.mlistID=[];b.mercID=0;mh(b);b.setupINTV(Th,b.id,2E3)};c.iniMercenaries.builds=[30];c.iniHeroes=function(b){b.hlist=[];b.hlistID=[];b.heroID=0;mh(b);b.setupINTV(Th,b.id,2E3)};c.iniHeroes.builds=[30];c.mercFootmanArab=function(){kb()};c.mercFootmanArab.iconID=49;c.mercFootmanArab.unit=80;c.mercFootmanArab.obj={};c.mercArcherArab=function(){kb()};c.mercArcherArab.iconID=
52;c.mercArcherArab.unit=85;c.mercArcherArab.obj={};c.mercMacemanArab=function(){kb()};c.mercMacemanArab.iconID=116;c.mercMacemanArab.obj={};c.mercMacemanArab.unit=83;c.mercPikemanArab=function(){kb()};c.mercPikemanArab.iconID=52;c.mercPikemanArab.unit=82;c.mercPikemanArab.obj={};c.mercCavalry=function(){kb()};c.mercCavalry.iconID=133;c.mercCavalry.unit=84;c.mercCavalry.obj={};c.mercEnichar=function(){kb()};c.mercEnichar.iconID=123;c.mercEnichar.unit=91;c.mercEnichar.obj={};c.mercJihad=function(){kb()};
c.mercJihad.iconID=236;c.mercJihad.unit=86;c.mercJihad.obj={};c.mercFootmanArab6=function(){Ra()};c.mercFootmanArab6.iconID=49;c.mercFootmanArab6.unit=80;c.mercFootmanArab6.obj={};c.mercArcherArab6=function(){Ra()};c.mercArcherArab6.iconID=52;c.mercArcherArab6.unit=85;c.mercArcherArab6.obj={};c.mercMacemanArab6=function(){Ra()};c.mercMacemanArab6.iconID=116;c.mercMacemanArab6.unit=83;c.mercMacemanArab6.obj={};c.mercPikemanArab6=function(){Ra()};c.mercPikemanArab6.iconID=52;c.mercPikemanArab6.unit=
82;c.mercPikemanArab6.obj={};c.mercCavalry6=function(){Ra()};c.mercCavalry6.iconID=133;c.mercCavalry6.unit=84;c.mercCavalry6.obj={};c.mercEnichar6=function(){Ra()};c.mercEnichar6.iconID=123;c.mercEnichar6.unit=91;c.mercEnichar6.obj={};c.mercJihad6=function(){Ra()};c.mercJihad6.iconID=236;c.mercJihad6.unit=86;c.mercJihad6.obj={};c.mercFootman=function(){kb()};c.mercFootman.iconID=182;c.mercFootman.unit=0;c.mercArcher=function(){kb()};c.mercArcher.iconID=185;c.mercArcher.unit=4;c.mercMaceman=function(){kb()};
c.mercMaceman.iconID=186;c.mercMaceman.unit=3;c.mercPikeman=function(){kb()};c.mercPikeman.iconID=183;c.mercPikeman.unit=1;c.mercLongbowman=function(){kb()};c.mercLongbowman.iconID=184;c.mercLongbowman.unit=6;c.mercKnight=function(){kb()};c.mercKnight.iconID=180;c.mercKnight.unit=19;c.mercFootman6=function(){Ra()};c.mercFootman6.iconID=182;c.mercFootman6.unit=0;c.mercFootman6.obj={};c.mercArcher6=function(){Ra()};c.mercArcher6.iconID=185;c.mercArcher6.unit=4;c.mercArcher6.obj={};c.mercMaceman6=function(){Ra()};
c.mercMaceman6.iconID=186;c.mercMaceman6.unit=3;c.mercMaceman6.obj={};c.mercPikeman6=function(){Ra()};c.mercPikeman6.iconID=183;c.mercPikeman6.unit=1;c.mercPikeman6.obj={};c.mercLongbowman6=function(){Ra()};c.mercLongbowman6.iconID=184;c.mercLongbowman6.unit=6;c.mercLongbowman6.obj={};c.mercKnight6=function(){Ra()};c.mercKnight6.iconID=180;c.mercKnight6.unit=19;c.mercKnight6.obj={};c.mercArcherAsian6=function(){Ra()};c.mercArcherAsian6.iconID=53;c.mercArcherAsian6.unit=67;c.mercArcherAsian6.obj={};
c.mercSamurai6=function(){Ra()};c.mercSamurai6.iconID=122;c.mercSamurai6.unit=68;c.mercSamurai6.obj={};c.mercHourseSamurai6=function(){Ra()};c.mercHourseSamurai6.iconID=121;c.mercHourseSamurai6.unit=70;c.mercHourseSamurai6.obj={};c.mercRonin6=function(){Ra()};c.mercRonin6.iconID=54;c.mercRonin6.unit=66;c.mercRonin6.obj={};c.mercHorseArcher6=function(){Ra()};c.mercHorseArcher6.iconID=52;c.mercHorseArcher6.unit=69;c.mercHorseArcher6.obj={};c.mercChariot6=function(){Ra()};c.mercChariot6.iconID=79;c.mercChariot6.unit=
72;c.mercChariot6.obj={};c.mercArcherAsian=function(){kb()};c.mercArcherAsian.iconID=53;c.mercArcherAsian.unit=67;c.mercArcherAsian.obj={};c.mercSamurai=function(){kb()};c.mercSamurai.iconID=122;c.mercSamurai.unit=68;c.mercSamurai.obj={};c.mercHourseSamurai=function(){kb()};c.mercHourseSamurai.iconID=121;c.mercHourseSamurai.unit=70;c.mercHourseSamurai.obj={};c.mercRonin=function(){kb()};c.mercRonin.iconID=54;c.mercRonin.unit=66;c.mercRonin.obj={};c.mercHorseArcher=function(){kb()};c.mercHorseArcher.iconID=
52;c.mercHorseArcher.unit=69;c.mercHorseArcher.obj={};c.mercChariot=function(){kb()};c.mercChariot.iconID=79;c.mercChariot.unit=72;c.mercChariot.obj={};c.createPeon=function(){Q(10)};c.createPeon.iconID=187;c.sameSpeed=function(){W(ah,G)};c.sameSpeed.iconID=82;c.restoreSpeed=function(){W(Fj,G)};c.restoreSpeed.iconID=88;c.createSpy=function(){Q(2)};c.createSpy.iconID=162;c.emergeAllUnits=function(){var b=G[0];W(Bd,b,y[b].inventory.slice(0))};c.emergeAllUnits.iconID=261;c.techFeudalism=function(){H(12)};
c.techFeudalism.iconID=233;c.techArchitecture=function(){H(13)};c.techArchitecture.iconID=226;c.techLearning=function(){H(14)};c.techLearning.iconID=129;c.createPeon1=function(){Q(64)};c.createPeon1.iconID=55;c.createPeon2=function(){Q(79)};c.createPeon2.iconID=132;c.createNinja=function(){Q(65)};c.createNinja.iconID=51;c.techArmoredChariot=function(){H(51)};c.techArmoredChariot.iconID=79;c.techBuddhism=function(){H(45)};c.techBuddhism.iconID=127;c.techGreatWall=function(){H(48)};c.techGreatWall.iconID=
80;c.ridingHorses=function(){H(49)};c.ridingHorses.iconID=64;c.irrigation=function(){H(50)};c.irrigation.iconID=72;c.createHorseArcher2=function(){Q(85)};c.createHorseArcher2.iconID=52;c.techMeditation=function(){H(52)};c.techMeditation.iconID=71;c.techKungFu=function(){H(53)};c.techKungFu.iconID=228;c.techTournaments=function(){H(54)};c.techTournaments.iconID=73;c.techPhilosophy=function(){H(55)};c.techPhilosophy.iconID=68;c.techNinjas=function(){H(56)};c.techNinjas.iconID=56;c.techMastery=function(){H(57)};
c.techMastery.iconID=69;c.techGoldMining=function(){H(1)};c.techGoldMining.iconID=58;c.techStoneMining=function(){H(2)};c.techStoneMining.iconID=57;c.createCrusaders=function(){W(Uh,G[0],0)};c.createCrusaders.iconID=221;c.techFanaticism=function(){H(31)};c.techFanaticism.iconID=235;c.techCrusade=function(){H(32)};c.techCrusade.iconID=93;c.techEspionage=function(){H(30)};c.techEspionage.iconID=215;c.techInquisition=function(){H(33)};c.techInquisition.iconID=97;c.techHealing=function(){H(34)};c.techHealing.iconID=
219;c.healing=function(){T=Bh};c.healing.iconID=219;c.healing.iconIDbook=201;c.teach=function(){T=Gh};c.teach.iconID=23;c.teach.iconIDbook=217;c.techBless=function(){H(36)};c.techBless.iconID=159;c.bless=function(){T=Kf};c.bless.iconID=159;c.bless.iconIDbook=204;c.techMedicine=function(){H(35)};c.techMedicine.iconID=220;c.createMage=function(){Q(5)};c.createMage.iconID=156;c.techBat=function(){H(38)};c.techBat.iconID=168;c.techGolem=function(){H(41)};c.techGolem.iconID=119;c.techInvisibility=function(){H(37)};
c.techInvisibility.iconID=217;c.techLightning=function(){H(40)};c.techLightning.iconID=143;c.techFreeze=function(){H(39)};c.techFreeze.iconID=130;c.techHeroism=function(){H(22)};c.techHeroism.iconID=136;c.techWarfare=function(){H(23)};c.techWarfare.iconID=108;c.techTactics=function(){H(24)};c.techTactics.iconID=257;c.techMercenaries=function(){H(25)};c.techMercenaries.iconID=95;c.techHeroes=function(){H(26)};c.techHeroes.iconID=96;c.techFame=function(){H(27)};c.techFame.iconID=111;c.techSiegeTactics=
function(){H(28)};c.techSiegeTactics.iconID=258;c.techBodyBuilding=function(){H(29)};c.techBodyBuilding.iconID=101;c.createPriest=function(){Q(9)};c.createPriest.iconID=155;c.createCow=function(){Q(27)};c.createCow.iconID=163;c.techCropRotation=function(){H(8)};c.techCropRotation.iconID=227;c.techDomestication=function(){H(7)};c.techDomestication.iconID=157;c.techMapMaking=function(){H(16)};c.techMapMaking.iconID=89;c.techTradeRoutes=function(){H(17)};c.techTradeRoutes.iconID=102;c.techTradeTaxes=
function(){H(18)};c.techTradeTaxes.iconID=110;c.techUsury=function(){H(19)};c.techUsury.iconID=105;c.techSupplyStorage=function(){H(20)};c.techSupplyStorage.iconID=62;c.techBribery=function(){H(21)};c.techBribery.iconID=109;c.bribe=function(){};c.bribe.iconID=128;c.createCaravan=function(){Q(61)};c.createCaravan.iconID=169;c.createCaravan2=function(){Q(90)};c.createCaravan2.iconID=134;c.createFootman2=function(){Q(80)};c.createFootman2.iconID=49;c.createArcher2=function(){Q(81)};c.createArcher2.iconID=
43;c.createSatrap=function(){Q(83)};c.createSatrap.iconID=116;c.createPikeman2=function(){Q(82)};c.createPikeman2.iconID=42;c.createHorseArcher2=function(){Q(85)};c.createHorseArcher2.iconID=124;c.createCavalry=function(){Q(84)};c.createCavalry.iconID=133;c.createEnichar=function(){Q(91)};c.createEnichar.iconID=123;c.createJihad=function(){Q(86)};c.createJihad.iconID=236;c.trade=function(){};c.trade.iconID=161;c.unload=function(){T=wf};c.unload.iconID=148;c.createMercenaries=function(){ia(y[G[0]].mlist)};
c.createMercenaries.iconID=95;c.createHeroes=function(){ia(y[G[0]].hlist)};c.createHeroes.iconID=96;c.upgradeGuildTower=function(){H(42)};c.upgradeGuildTower.iconID=171;c.upgradeStoneTower=function(){H(43)};c.upgradeStoneTower.iconID=178;c.upgradeCannonTower=function(){H(44)};c.upgradeCannonTower.iconID=178;c.createCatapult=function(){Q(37)};c.createCatapult.iconID=152;c.createHeavyCatapult=function(){Q(39)};c.createHeavyCatapult.iconID=153;c.createBallist=function(){Q(38)};c.createBallist.iconID=
154;c.techEngineering=function(){H(47)};c.techEngineering.iconID=92;c.techCannonTower=function(){H(46)};c.techCannonTower.iconID=178;c.techPlateArmor=function(){H(10)};c.techPlateArmor.iconID=131;c.techTemperIron=function(){H(4)};c.techTemperIron.iconID=266;c.techHalberd=function(){H(6)};c.techHalberd.iconID=113;c.techScaleArmor=function(){H(5)};c.techScaleArmor.iconID=251;c.techChainMail=function(){H(9)};c.techChainMail.iconID=252;c.techLongbow=function(){H(0)};c.techLongbow.iconID=259;c.techWoodCutting=
function(){H(3)};c.techWoodCutting.iconID=107;c.techCrossbow=function(){H(11)};c.techCrossbow.iconID=112;c.createFishingBoat=function(){Q(74)};c.createFishingBoat.iconID=48;c.createXebec=function(){Q(76)};c.createXebec.iconID=166;c.upgradeShip=function(){};c.upgradeShip.iconID=268;c.fishing=function(){};c.fishing.iconID=41;c.createHulk=function(){Q(75)};c.createHulk.iconID=165;c.createGalleon=function(){Q(73)};c.createGalleon.iconID=164;c.techLandingTactics=function(){};c.techLandingTactics.iconID=
98;c.techConcentration=function(){H(58)};c.techConcentration.iconID=75;c.techConfusion=function(){H(59)};c.techConfusion.iconID=76;c.techWhirlpool=function(){H(60)};c.techWhirlpool.iconID=78;c.techDragon=function(){H(61)};c.techDragon.iconID=115;c.techTurnToStone=function(){H(62)};c.techTurnToStone.iconID=77;c.techFlameBolt=function(){H(63)};c.techFlameBolt.iconID=25;c.techJewelry=function(){H(64)};c.techJewelry.iconID=230;c.techBanking=function(){H(65)};c.techBanking.iconID=74;c.techChemistry=function(){H(66)};
c.techChemistry.iconID=225;c.techSeaFood=function(){H(67)};c.techSeaFood.iconID=67;c.techGunPowder=function(){H(68)};c.techGunPowder.iconID=212;c.techRocketArrow=function(){H(69)};c.techRocketArrow.iconID=47;c.techBushido=function(){H(70)};c.techBushido.iconID=60;c.techLeadership=function(){H(71)};c.techLeadership.iconID=114;c.techHonor=function(){H(72)};c.techHonor.iconID=94;c.techSunTzu=function(){H(73)};c.techSunTzu.iconID=66;c.createRonin=function(){Q(66)};c.createRonin.iconID=54;c.createArcher1=
function(){Q(67)};c.createArcher1.iconID=53;c.createSamurai=function(){Q(68)};c.createSamurai.iconID=122;c.createHorseArcher1=function(){Q(69)};c.createHorseArcher1.iconID=52;c.createMonk=function(){Q(128)};c.createMonk.iconID=45;c.createMage1=function(){Q(129)};c.createMage1.iconID=50;c.createPriest1=function(){Q(127)};c.createPriest1.iconID=44;c.createPriest2=function(){Q(87)};c.createPriest2.iconID=125;c.buyItems=function(){};c.buyItems.iconID=31;c.sellItems=function(){};c.sellItems.iconID=30;
c.createHorseSamurai=function(){Q(70)};c.createHorseSamurai.iconID=121;c.createChariot=function(){Q(72)};c.createChariot.iconID=79;c.stopTech=function(){W(of,0,G)};c.stopTech.iconID=160;c.repair=function(){T=tc};c.repair.iconID=145;c.conquest=function(){};c.conquest.iconID=249;c.dcm=function(){T=sc};c.dcm.iconID=260;c.buildBarrack=function(){L(14)};c.buildBarrack.iconID=205;c.buildBarrack1=function(){L(71)};c.buildBarrack1.iconID=205;c.buildBarrack2=function(){L(102)};c.buildBarrack2.iconID=205;c.buildTower=
function(){L(32)};c.buildTower.iconID=170;c.buildStorage=function(){L(18)};c.buildStorage.iconID=200;c.buildLumbermill=function(){L(15)};c.buildLumbermill.iconID=199;c.buildLumbermill2=function(){L(93)};c.buildLumbermill2.iconID=199;c.buildFields=function(){L(20)};c.buildFields.iconID=265;c.buildCastle=function(){L(12)};c.buildCastle.iconID=206;c.buildCastle1=function(){L(62)};c.buildCastle1.iconID=206;c.buildCastle2=function(){L(63)};c.buildCastle2.iconID=206;c.buildAcademy=function(){L(17)};c.buildAcademy.iconID=
204;c.buildCathedral=function(){L(11)};c.buildCathedral.iconID=191;c.buildCathedral2=function(){L(106)};c.buildCathedral2.iconID=189;c.buildMerchands=function(){L(24)};c.buildMerchands.iconID=198;c.buildMerchands2=function(){L(108)};c.buildMerchands2.iconID=198;c.buildChurch=function(){L(25)};c.buildChurch.iconID=197;c.buildMarket=function(){L(33)};c.buildMarket.iconID=194;c.buildMageTower=function(){L(16)};c.buildMageTower.iconID=192;c.buildMageTower2=function(){L(107)};c.buildMageTower2.iconID=
192;c.buildDummy=function(){L(36)};c.buildDummy.iconID=65;c.buildFarm=function(){L(23)};c.buildFarm.iconID=193;c.buildBlacksmith=function(){L(26)};c.buildBlacksmith.iconID=202;c.buildWorkshop=function(){L(29)};c.buildWorkshop.iconID=201;c.buildWorkshop2=function(){L(98)};c.buildWorkshop2.iconID=201;c.buildStable=function(){L(28)};c.buildStable.iconID=196;c.buildStable2=function(){L(103)};c.buildStable2.iconID=196;c.buildTavern=function(){L(30)};c.buildTavern.iconID=208;c.buildHouse=function(){L(31)};
c.buildHouse.iconID=195;c.buildHarbor=function(){L(41)};c.buildHarbor.iconID=188;c.buildOutpost=function(){L(34)};c.buildOutpost.iconID=158;c.buildWoodWall=function(){ph(13)};c.buildWoodWall.iconID=210;c.buildWoodGate=function(){};c.buildWoodGate.iconID=209;c.buildWoodGate.disabled=2;c.buildBridge=function(){L(35)};c.buildBridge.iconID=176;hg="freeze invisibility lightning turnToStone bless healing".split(" ");c.freeze=function(){T=Uf};c.freeze.iconID=99;c.freeze.obj={name:x.freeze};c.freeze.iconIDbook=
205;c.confusion=function(){T=Wf};c.confusion.iconID=76;c.confusion.obj={name:"Confusion",spcost:[120,0,0,0]};c.confusion.iconIDbook=206;c.turnToStone=function(){T=Ah};c.turnToStone.iconID=77;c.turnToStone.iconIDbook=213;c.turnToStone.obj={name:"Turn to Stone",spcost:[40,0,0,0]};c.whirlpool=function(){T=Jj};c.whirlpool.iconID=78;c.whirlpool.iconIDbook=214;c.whirlpool.obj={name:"Whirlpool",spcost:[80,0,0,0]};c.flameBolt=function(){T=Pf};c.flameBolt.iconID=25;c.flameBolt.obj={name:"Flame Bolt",spcost:[120,
0,0,0]};c.flameBolt.iconIDbook=216;c.createDragon=function(){T=Bf};c.createDragon.iconID=115;c.createDragon.obj={name:"Spawn Dragon",spcost:[320,0,0,0]};c.createDragon.iconIDbook=215;c.lightning=function(){T=Eh};c.lightning.iconID=263;c.lightning.obj={name:x.lightning,spcost:[80,0,0,0]};c.lightning.iconIDbook=200;c.createBat=function(){T=Df};c.createBat.iconID=168;c.createBat.iconIDbook=203;c.createGolem=function(){T=zf};c.createGolem.iconID=119;c.createGolem.iconIDbook=209;c.autoInvisibility=function(){T=
Mf};c.autoInvisibility.iconID=217;c.autoInvisibility.obj={name:x.invisibility};c.invisibility=function(){T=Mf};c.invisibility.iconID=217;c.invisibility.iconIDbook=208;c.impersonate=function(){T=Dh};c.impersonate.iconID=32;c.impersonate.obj={name:"Impersonate"};c.revealSelf=function(){W(Nj,G[0],0)};c.revealSelf.iconID=33;c.revealSelf.obj={name:"Reveal your true self"};c.buildHouse1=function(){L(111)};c.buildHouse1.iconID=195;c.buildHouse2=function(){L(92)};c.buildHouse2.iconID=195;c.buildLumbermill1=
function(){L(112)};c.buildLumbermill1.iconID=199;c.buildStorage1=function(){L(113)};c.buildStorage1.iconID=200;c.buildStorage2=function(){L(94)};c.buildStorage2.iconID=200;c.buildFarm1=function(){L(114)};c.buildFarm1.iconID=193;c.buildFarm2=function(){L(95)};c.buildFarm2.iconID=193;c.buildHarbor1=function(){L(115)};c.buildHarbor1.iconID=188;c.buildHarbor2=function(){L(96)};c.buildHarbor2.iconID=188;c.buildBlacksmith1=function(){L(116)};c.buildBlacksmith1.iconID=202;c.buildBlacksmith2=function(){L(97)};
c.buildBlacksmith2.iconID=202;c.buildWorkshop1=function(){L(117)};c.buildWorkshop1.iconID=201;c.buildChurch1=function(){L(118)};c.buildChurch1.iconID=197;c.buildChurch2=function(){L(99)};c.buildChurch2.iconID=197;c.buildTavern1=function(){L(119)};c.buildTavern1.iconID=208;c.buildTavern2=function(){L(100)};c.buildTavern2.iconID=208;c.buildMarket1=function(){L(120)};c.buildMarket1.iconID=194;c.buildMarket2=function(){L(101)};c.buildMarket2.iconID=194;c.buildStable1=function(){L(121)};c.buildStable1.iconID=
196;c.buildOutpost1=function(){L(122)};c.buildOutpost1.iconID=158;c.buildOutpost2=function(){L(104)};c.buildOutpost2.iconID=158;c.buildCathedral1=function(){L(123)};c.buildCathedral1.iconID=190;c.buildMageTower1=function(){L(124)};c.buildMageTower1.iconID=192;c.createObjects=function(){ne("magicworkshopmenu",da)};c.createObjects.iconID=20;c.createObjects.obj={};c.buildMagicWorkshop=function(){L(110)};c.buildMagicWorkshop.iconID=46;c.buildMerchands1=function(){L(125)};c.buildMerchands1.iconID=198;
c.buildAcademy1=function(){L(126)};c.buildAcademy1.iconID=204;c.buildAcademy2=function(){L(109)};c.buildAcademy2.iconID=204;c.buildRocketTower=function(){L(57)};c.buildRocketTower.iconID=47;c.murder=function(){};c.murder.iconID=28;c.convertJihad=function(){};c.convertJihad.iconID=236;c.convertJihad.obj={};c.menuCommonBuild2=function(){ia(Ke)};c.menuCommonBuild2.iconID=17;Ke=[c.buildFarm2,c.buildBlacksmith2,c.buildWorkshop2,c.buildStable2,c.buildTavern2,c.buildHouse2];Ke.menuName="a_build";c.menuCommonBuild2.xtra=
Ke;c.menuSpecialBuild2=function(){ia(Le)};c.menuSpecialBuild2.iconID=15;Le=[c.buildCastle2,c.buildAcademy2,c.buildCathedral2,c.buildMerchands2,c.buildChurch2,c.buildMarket2,c.buildMageTower2,c.buildMagicWorkshop];Le.menuName="a_build";c.menuSpecialBuild2.xtra=Le;c.menuOtherBuild2=function(){ia(Me)};c.menuOtherBuild2.iconID=16;Me=[c.buildHarbor2,c.buildOutpost2,c.buildWoodWall,c.buildWoodGate,c.buildBridge];Me.menuName="e_build";c.menuOtherBuild2.xtra=Me;c.menuBuilds2=function(){ia(Ne)};c.menuBuilds2.iconID=
245;Ne=[c.menuSpecialBuild2,c.menuCommonBuild2,c.menuOtherBuild2,c.buildBarrack2,c.buildTower,c.buildStorage2,c.buildLumbermill2,c.buildFields];Ne.menuName="a_build";c.menuBuilds2.xtra=Ne;c.origin=Dk;c.origin.iconID=255;c.createCarpet=function(){T=Hf};c.createCarpet.iconID=146;c.createCarpet.iconIDbook=202;c.createJinn=function(){T=Ff};c.createJinn.iconID=118;c.createJinn.iconIDbook=218;c.magicVision=function(){};c.magicVision.iconID=223;c.magicVision.iconIDbook=210;c.fireRain=function(){T=Yf};c.fireRain.iconID=
264;c.fireRain.iconIDbook=199;c.raiseDead=function(){T=Rf};c.raiseDead.iconID=87;c.raiseDead.iconIDbook=211;c.createMage2=function(){Q(89)};c.createMage2.iconID=126;c.techCowPoaching=function(){H(74)};c.techCowPoaching.iconID=85;c.techHorseManShip=function(){H(75)};c.techHorseManShip.iconID=231;c.techScimitar=function(){H(76)};c.techScimitar.iconID=84;c.techJihad=function(){H(77)};c.techJihad.iconID=236;c.techCarpet=function(){H(78)};c.techCarpet.iconID=146;c.techMagicWorkshop=function(){H(79)};c.techMagicWorkshop.iconID=
86;c.techFireRain=function(){H(80)};c.techFireRain.iconID=264;c.techMagicVision=function(){H(81)};c.techMagicVision.iconID=224;c.techNecromancy=function(){H(82)};c.techNecromancy.iconID=87;c.techJinn=function(){H(83)};c.techJinn.iconID=118;c.techOreFloatation=function(){H(84)};c.techOreFloatation.iconID=106;c.techRiddingHorses=function(){H(85)};c.techRiddingHorses.iconID=232;c.techJanissary=function(){H(86)};c.techJanissary.iconID=81;c.buildMagicItems=function(){};c.buildMagicItems.iconID=20;c.techSlavery=
function(){H(87)};c.techSlavery.iconID=135;c.stopBuilding=function(){W(we,0,G)};c.stopBuilding.iconID=160;c.menuSpecialBuild1=function(){ia(Ce)};c.menuSpecialBuild1.iconID=15;Ce=[c.buildCastle1,c.buildAcademy1,c.buildCathedral1,c.buildMerchands1,c.buildChurch1,c.buildMarket1,c.buildMageTower1,c.buildRocketTower,c.buildDummy];Ce.menuName="a_build";c.menuSpecialBuild1.xtra=Ce;c.menuCommonBuild1=function(){ia(De)};c.menuCommonBuild1.iconID=17;De=[c.buildFarm1,c.buildBlacksmith1,c.buildWorkshop1,c.buildStable1,
c.buildTavern1,c.buildHouse1];De.menuName="a_build";c.menuCommonBuild1.xtra=De;c.menuSpecialBuild=function(){ia(Ee)};c.menuSpecialBuild.iconID=15;Ee=[c.buildCastle,c.buildAcademy,c.buildCathedral,c.buildMerchands,c.buildChurch,c.buildMarket,c.buildMageTower,c.buildDummy];Ee.menuName="e_build";c.menuSpecialBuild.xtra=Ee;c.menuCommonBuild=function(){ia(Fe)};c.menuCommonBuild.iconID=17;Fe=[c.buildFarm,c.buildBlacksmith,c.buildWorkshop,c.buildStable,c.buildTavern,c.buildHouse];Fe.menuName="e_build";c.menuCommonBuild.xtra=
Fe;c.menuOtherBuild=function(){ia(Ge)};c.menuOtherBuild.iconID=16;Ge=[c.buildHarbor,c.buildOutpost,c.buildWoodWall,c.buildWoodGate,c.buildBridge];Ge.menuName="e_build";c.menuOtherBuild.xtra=Ge;c.menuOtherBuild1=function(){ia(He)};c.menuOtherBuild1.iconID=16;He=[c.buildHarbor1,c.buildOutpost1,c.buildWoodWall,c.buildWoodGate,c.buildBridge];He.menuName="e_build";c.menuOtherBuild1.xtra=He;c.menuBuilds=function(){ia(Ie)};Ie=[c.menuSpecialBuild,c.menuCommonBuild,c.menuOtherBuild,c.buildBarrack,c.buildTower,
c.buildStorage,c.buildLumbermill,c.buildFields];Ie.menuName="e_build";c.menuBuilds.iconID=245;c.menuBuilds.xtra=Ie;c.menuBuilds1=function(){ia(Je)};c.menuBuilds1.iconID=245;Je=[c.menuSpecialBuild1,c.menuCommonBuild1,c.menuOtherBuild1,c.buildBarrack1,c.buildTower,c.buildStorage1,c.buildLumbermill1,c.buildFields];Je.menuName="a_build";c.menuBuilds1.xtra=Je;vk=function(){c.fishing.obj={};c.impersonate.obj={};c.techGreatWall.obj=C[48];c.revealSelf.obj={};c.trade.obj={};c.unload.obj={};c.mercFootman6.obj=
{};c.murder.obj={};c.mercArcher6.obj={};c.mercMaceman6.obj={};c.mercPikeman6.obj={};c.mercLongbowman6.obj={};c.sameSpeed.obj={name:"Same speed"};c.restoreSpeed.obj={name:"Restore speed"};c.mercKnight6.obj={};c.attackGround.obj={};c.steady.obj={};c.bribe.obj={};c.createPriest1.obj=u[127];c.createPriest2.obj=u[87];c.createFootman2.obj=u[80];c.createArcher2.obj=u[81];c.createSatrap.obj=u[83];c.createPikeman2.obj=u[82];c.createHorseArcher2.obj=u[85];c.createCavalry.obj=u[84];c.createEnichar.obj=u[91];
c.createJihad.obj=u[86];c.createMonk.obj=u[128];c.healing.obj={name:x.heal,spcost:[20,0,0,0]};c.bless.obj={name:x.bless,spcost:[20,0,0,0]};c.stopTech.obj={};c.conquest.obj={};c.dcm.obj={name:x.dcm};c.repair.obj={name:x.repair};c.menuOtherBuild.obj={};c.menuOtherBuild1.obj={};c.menuOtherBuild2.obj={};c.sellItems.obj={};c.buyItems.obj={};c.menuBuilds.obj={name:x.menuBuild};c.menuCommonBuild.obj={};c.menuSpecialBuild.obj={};c.techMastery.obj=C[57];c.techNinjas.obj=C[56];c.teach.obj={name:"Teach",spcost:[20,
0,0,0]};c.techPhilosophy.obj=C[55];c.techKungFu.obj=C[53];c.techTournaments.obj=C[54];c.techMeditation.obj=C[52];c.menuCommonBuild1.obj={};c.menuCommonBuild2.obj={};c.createMage1.obj=u[129];c.menuSpecialBuild1.obj={};c.menuSpecialBuild2.obj={};c.menuBuilds1.obj={name:x.menuBuild};c.menuBuilds2.obj={name:x.menuBuild};c.stopBuilding.obj={};c.freeze.obj={name:x.freeze,spcost:[200,0,0,0]};c.invisibility.obj={name:x.invisibility,spcost:[40,0,0,0]};c.autoInvisibility.obj={name:x.invisibility};c.createHeroes.obj=
{};c.createMercenaries.obj={};c.upgradeShip.obj={};c.techMedicine.obj=C[35];c.techBless.obj=C[36];c.buildHouse1.obj=u[111];c.techHealing.obj=C[34];c.techInquisition.obj=C[33];c.techArmoredChariot.obj=C[51];c.techRocketArrow.obj=C[69];c.techJewelry.obj=C[64];c.techGunPowder.obj=C[68];c.techSeaFood.obj=C[67];c.techChemistry.obj=C[66];c.techBanking.obj=C[65];c.createMage.obj=u[5];c.techBat.obj=C[38];c.techGolem.obj=C[41];c.techInvisibility.obj=C[37];c.techLightning.obj=C[40];c.techFreeze.obj=C[39];c.techHeroism.obj=
C[22];c.createHorseSamurai.obj=u[70];c.createChariot.obj=u[72];c.createHorseArcher1.obj=u[69];c.createHorseArcher2.obj=u[85];c.createSamurai.obj=u[68];c.createArcher1.obj=u[67];c.techConfusion.obj=C[59];c.techConcentration.obj=C[58];c.techWhirlpool.obj=C[60];c.techDragon.obj=C[61];c.techTurnToStone.obj=C[62];c.techFlameBolt.obj=C[63];c.createRonin.obj=u[66];c.buildStorage.obj=u[18];c.buildStorage1.obj=u[113];c.buildStorage2.obj=u[94];c.buildFields.obj=u[20];c.buildLumbermill.obj=u[15];c.buildLumbermill1.obj=
u[112];c.buildLumbermill2.obj=u[93];c.buildTower.obj=u[32];c.buildBarrack1.obj=u[71];c.buildBarrack.obj=u[14];c.buildBarrack2.obj=u[102];c.buildDummy.obj=u[36];c.buildRocketTower.obj=u[57];c.buildMageTower.obj=u[16];c.buildMageTower1.obj=u[124];c.buildMageTower2.obj=u[107];c.buildMarket.obj=u[33];c.buildMarket1.obj=u[120];c.buildMarket2.obj=u[101];c.buildChurch.obj=u[25];c.buildChurch1.obj=u[118];c.buildChurch2.obj=u[99];c.buildMerchands.obj=u[24];c.irrigation.obj=C[50];c.ridingHorses.obj=C[49];c.buildMerchands1.obj=
u[125];c.buildMerchands2.obj=u[108];c.buildCathedral.obj=u[11];c.buildCathedral1.obj=u[123];c.buildCathedral2.obj=u[106];c.buildAcademy.obj=u[17];c.buildAcademy1.obj=u[126];c.buildAcademy2.obj=u[109];c.buildCastle.obj=u[12];c.magicVision.obj={name:"Magic Vision",spcost:[20,0,0,0]};c.fireRain.obj={name:"Fire Rain",spcost:[200,0,0,0]};c.raiseDead.obj={name:"Raise the Dead",spcost:[40,0,0,0]};c.createJinn.obj={name:"Spawn Jinn",spcost:[320,0,0,0]};c.createCarpet.obj={name:"Spawn Magic Carpet",spcost:[320,
0,0,0]};c.buildCastle1.obj=u[62];c.buildCastle2.obj=u[63];c.buildHouse.obj=u[31];c.buildHouse2.obj=u[92];c.buildTavern.obj=u[30];c.buildTavern1.obj=u[119];c.buildTavern2.obj=u[100];c.buildStable.obj=u[28];c.buildStable1.obj=u[121];c.buildStable2.obj=u[103];c.buildFarm.obj=u[23];c.buildFarm1.obj=u[114];c.buildFarm2.obj=u[95];c.buildWorkshop.obj=u[29];c.buildWorkshop1.obj=u[117];c.buildWorkshop2.obj=u[98];c.buildBlacksmith.obj=u[26];c.buildBlacksmith1.obj=u[116];c.buildBlacksmith2.obj=u[97];c.buildBridge.obj=
u[35];c.buildHarbor.obj=u[41];c.buildHarbor1.obj=u[115];c.buildHarbor2.obj=u[96];c.createMage2.obj=u[89];c.buildMagicItems.obj={};c.techJanissary.obj=C[86];c.techRiddingHorses.obj=C[85];c.techOreFloatation.obj=C[84];c.techJinn.obj=C[83];c.techNecromancy.obj=C[82];c.techMagicVision.obj=C[81];c.techFireRain.obj=C[80];c.techMagicWorkshop.obj=C[79];c.techCarpet.obj=C[78];c.techJihad.obj=C[77];c.techScimitar.obj=C[76];c.techHorseManShip.obj=C[75];c.techCowPoaching.obj=C[74];c.buildWoodGate.obj={};c.buildWoodWall.obj=
u[13];c.buildOutpost.obj=u[34];c.buildOutpost1.obj=u[122];c.buildOutpost2.obj=u[104];c.createGolem.obj={name:"Spawn Stone Golem",spcost:[480,0,0,0]};c.techSunTzu.obj=C[73];c.techBushido.obj=C[70];c.techLeadership.obj=C[71];c.techHonor.obj=C[72];c.createBat.obj={name:"Spawn Bat",spcost:[40,0,0,0]};c.techGoldMining.obj=C[1];c.techStoneMining.obj=C[2];c.emergeAllUnits.obj={};c.origin.obj={name:"Origin"};c.createOrk.obj=u[58];c.createDwarf.obj=u[59];c.createSkeleton.obj=u[60];c.createGhost.obj=u[40];
c.createFootman.obj=u[0];c.createArcher.obj=u[4];c.techSlavery.obj=C[87];c.createMaceman.obj=u[3];c.createPikeman.obj=u[1];c.createLongbowman.obj=u[6];c.createKnight.obj=u[19];c.mercFootman.obj=d;c.mercArcher.obj=d;c.mercMaceman.obj=d;c.mercPikeman.obj=d;c.mercLongbowman.obj=d;c.mercKnight.obj=d;c.createPeon.obj=u[10];c.createSpy.obj=u[2];c.techFeudalism.obj=C[12];c.techArchitecture.obj=C[13];c.techLearning.obj=C[14];c.createPeon1.obj=u[64];c.createPeon2.obj=u[79];c.createNinja.obj=u[65];c.techBuddhism.obj=
C[45];c.createCrusaders.obj={name:"Preach a crusade",cost:[1E3,0,2E3,0]};c.buildMagicWorkshop.obj=u[110];c.techFanaticism.obj=C[31];c.techCrusade.obj=C[32];c.techEspionage.obj=C[30];c.techChainMail.obj=C[9];c.techHalberd.obj=C[6];c.techLongbow.obj=C[0];c.techScaleArmor.obj=C[5];c.techTemperIron.obj=C[4];c.techPlateArmor.obj=C[10];c.techLandingTactics.obj={};c.createGalleon.obj=u[73];c.createHulk.obj=u[75];c.createXebec.obj=u[76];c.createFishingBoat.obj=u[74];c.techCrossbow.obj=C[11];c.techWoodCutting.obj=
C[3];c.techCannonTower.obj=C[46];c.techEngineering.obj=C[47];c.createBallist.obj=u[38];c.createHeavyCatapult.obj=u[39];c.createCatapult.obj=u[37];c.upgradeCannonTower.obj=C[44];c.upgradeStoneTower.obj=C[43];c.upgradeGuildTower.obj=C[42];c.createCaravan.obj=u[61];c.createCaravan2.obj=u[90];c.techBribery.obj=C[21];c.techSupplyStorage.obj=C[20];c.techUsury.obj=C[19];c.techCropRotation.obj=C[8];c.createCow.obj=u[27];c.techDomestication.obj=C[7];c.techTradeTaxes.obj=C[18];c.techTradeRoutes.obj=C[17];c.techMapMaking.obj=
C[16];c.createPriest.obj=u[9];c.techBodyBuilding.obj=C[29];c.techSiegeTactics.obj=C[28];c.techFame.obj=C[27];c.techHeroes.obj=C[26];c.techMercenaries.obj=C[25];c.techTactics.obj=C[24];c.techWarfare.obj=C[23];for(var b=Object.keys(c),e=0,f=b.length;e<f;e++){var g=c[b[e]];g.objName=b[e];g.obj&&(g.obj.nu=g)}}},mg=function(d,b){var c=b.length,f=d.length,g=0;a:for(;g<c;g++){for(var h=0;h<f;h++)if(b[g+h]!==d[h])continue a;return g}return!1},Tk=function(d){for(var b=d.length,c=new Uint16Array(d.length),
f=0;f<b;f++)c[f]=d.charCodeAt(f);return c},Cc=function(d,b){return mg(Tk(d),b)+d.length},ng=function(d,b){d+=String.fromCharCode(0);return mg(Tk(d),b)},ji=function(d,b,c){var e="";for(b+=d;d<b&&c[d];d++)e+=String.fromCharCode(c[d]);return e},Qe=function(d){d=new Uint8Array(d);var b=mg([50,109,122,116],d)+6,c=d[b]+256*d[b+1],f=d[b+2]+(d[b+3]<<8)+(d[b+4]<<16);O("mapx:",c,"units",f);O("header",d[Cc(".header",d)],"description",d[Cc(".description",d)],"kingdominfo",d[Cc(".kingdominfo",d)],"diplomacy",
d[Cc(".diplomacy",d)],"forbidden.upgrades",d[Cc(".forbidden.upgrades",d)],"tiles",d[Cc(".tiles",d)]);O(d);b=2*c;c={mapx:c,mapy:c,arje:!1};var g="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12".split(" "),h="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12 xx13 xx14 xx15 xx16 xx17 xx18 xx19 xx20 xx21 resource".split(" "),m=b/2,k=
20480+2*m*m,l={};m=0;for(var n=d.length;m<n;m++){var p=d[m];l[p]||(l[p]=[]);l[p].push(m)}l=[];var q={56:!0,58:!0,88:!0,72:!0};m=k+1;for(n=d.length;m<n;m++)if(p=d[m],q[p]&&q[d[m+4]]){k={};p=72!==p?g:h;for(var r=m-2,u=0,w=p.length;u<w;u++){var x=p[u];"kingdom"==x||"race"==x?(k[x]=d[r],r++):(k[x]=d[r]+256*d[r+1],r+=2)}m+=2*w-3;l.push(k)}c.allunits=l;c.allunits.length>f&&(c.allunits.length=f);f=c.allunits;b/=2;l=[];g=0;q=[];p=k=d[Cc(".forbidden.upgrades",d)]+1;m=k*=512;for(h=d.length;m<h;m+=2){u=d[m];
r=~~(m/512);for(n=8;n<b&&d[n+m]===(u+n/4)%256;n+=4);20<n&&(m=512*r,1==l.length&&(m=512*(r-(2-(r-p)%2))),n=d.slice(k,m),k-m&&(l[g++]=[k,m],q.push(n)),m+=512,2==l.length&&(m-=512),k=m)}l[g++]=[k,d.length];q={64:[l[0]],96:[l[0]],128:[l[0]],192:[l[1],l[0],l[2],l[3]],256:[l[1],l[0],l[2],l[3]],384:[l[1],l[0],l[2],l[3],l[4],l[5],l[6]],512:[l[1],l[0],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9]]}[b];O(l);l=new Uint8Array(b*b);k=new Uint8Array(b*b);n=g=0;for(p=q.length;n<p;n++)if(h=q[n],g<b*b)for(m=h[0],h=h[1];m<
h;m+=2)l[g]=wm[d[m]]||0,k[g]=d[m+1],10<k[g]&&f.push({type:7,d:k[g]%31,x32:g%b,y32:~~(g/b)}),g++;c.terrain=l;f=(b="grass",ng("grass",d))||(b="summer",ng("summer",d))||(b="desert",ng("desert",d))||(b="snow",ng("snow",d));if("summer"==b||b)if("summer"==b||"desert"==b)b="grass";g=ji(512*(d[Cc(".description",d)]-1),512,d);c.description=g;c.author=ji(f-64,64,d);c.name=ji(f-128,64,d);c.terrainType=b;c.kingdoms=Qe.getKingdoms(d,c);Qe.getDiplomacy(d,c.kingdoms);O(c);Uk(c)};Qe.getKingdoms=function(d,b){for(var c=
mg([192,4],d)+50;!d[c];)c++;var f="name tzar active resGold resStone resFood resWood x6 race x8 x9 x10 x11 x12 x13 x14 AI x16 x17 x18 x19 x20".split(" "),g=f.length,h=[],m,k=[[0,0,189],[206,25,25],[49,181,0],[173,0,197],[255,222,0],[0,181,181],[255,156,33],[90,90,90]];O("kingdoms:",c);b.tr={0:0,9:0,10:0};for(var l=0;8>l;l++){for(var n={color:k[l]},p=!0,q=0;q<g;q++){var r=f[q];if("name"==r||"tzar"==r){for(n[r]="";!d[c];)c++;for(m=c+32;d[c];)n[r]+=String.fromCharCode(d[c]),c++;c=m}else n[r]=d[c]+(d[c+
1]<<8)+(d[c+2]<<16)+(d[c+3]<<24),"race"==r&&(n[r]=d[c],n.racestr=Zf[d[c]-1]),2!=q||d[c]||(p=!1),c+=4}p&&(h.push(n),b.tr[l+1]=h.length);1<h.length&&(n.IA=1);n.resources=[n.resGold,n.resWood,n.resFood,n.resStone];n.race--}O(h);return h};Qe.getDiplomacy=function(d,b){for(var c=512*(d[Cc(".diplomacy",d)]-1),f=b.length,g=0;g<f;g++){var h=[0];if(b[g]){b[g].diplomacy=h;for(var m=1;9>m;m++){if(b[m-1]){var k=d[c];k=60>k&&m-1!=g?1:0;h.push(k)}c+=4}}else c+=32}};var wm={0:3,32:0,144:1,240:2,64:2},im={15:78,
16:77,19:37,20:39,21:38,22:131,23:73,24:75,25:76,27:59,28:58,30:132,31:40,32:130,36:60,38:42,39:55,40:32,41:44,42:56,43:57,61:13,62:13,63:20,64:35,72:43,110:27,133:36,136:74,257:10,258:61,259:0,260:4,261:3,262:6,263:1,264:19,267:8,270:2,273:5,274:9,300:12,301:14,302:15,303:23,304:30,305:25,306:28,307:18,308:34,309:33,310:41,311:11,312:17,314:26,315:29,316:16,321:24,322:31,513:79,514:90,515:80,516:81,517:83,519:82,522:85,529:89,530:87,541:91,545:86,547:84,556:63,557:102,558:93,559:95,560:100,561:99,
562:103,563:94,564:104,565:101,566:96,568:109,570:97,571:98,572:107,577:108,578:92,581:110,583:106,769:64,771:66,772:67,773:68,778:69,780:128,781:65,785:129,786:127,802:70,805:72,812:62,813:71,814:112,815:114,816:119,817:118,818:121,819:113,820:122,821:120,822:115,824:126,826:116,827:117,828:124,833:125,834:111,838:123,76:21,78:22},dh=function(d,b,c,f){if(Rd&&!p.editor){var e=Rd.events.defined[b.id];if(e&&e[c])if(e=e[c],"zone"==c)for(d=0,f=e.length;d<f;d+=5){c=e[d];var h=e[d+2],m=e[d+3],k=e[d+4];
b.x32>=e[d+1]&&b.x32<=m&&b.y32>=h&&b.y32<=k?(b.inZone||(b.inZone={}),b.inZone[c.id]||og([e[d]],1),b.inZone[c.id]=1):b.inZone&&b.inZone[c.id]&&(b.inZone[c.id]=0,og([e[d]],-1))}else{if(!f)return og(e,d);O(f.name);b=e.defined;b[f.id]&&og(b[f.id],d)}}},og=function(d,b){for(var c=d.length,f=0;f<c;f++){var g=d[f],h=g.rule,m=g.activeEvents;g.activeEvents+=b;0===m?h.activeEvents++:0===g.activeEvents&&h.activeEvents--;if(1==b&&h.activeEvents==h.events.length)for(g=0,h=h.actions,m=h.length;g<m;g++){var k=h[g];
O("action:",k.type);if(Vk[k.type])Vk[k.type](k.to[0],k.list)}}},Vk={attack:uc,move:Ib},Tc={};q("selectUnits").onclick=function(){q("mapeditorinfoUnits").style.display="block";q("mapeditorinfoBuilds").style.display="none";q("mapeditorinfoItems").style.display="none";q("mapeditorinfoNature").style.display="none"};q("selectBuilds").onclick=function(){q("mapeditorinfoUnits").style.display="none";q("mapeditorinfoBuilds").style.display="block";q("mapeditorinfoItems").style.display="none";q("mapeditorinfoNature").style.display=
"none"};q("selectItems").onclick=function(){q("mapeditorinfoUnits").style.display="none";q("mapeditorinfoBuilds").style.display="none";q("mapeditorinfoItems").style.display="block";q("mapeditorinfoNature").style.display="none"};q("selectNature").onclick=function(){q("mapeditorinfoUnits").style.display="none";q("mapeditorinfoBuilds").style.display="none";q("mapeditorinfoItems").style.display="none";q("mapeditorinfoNature").style.display="block"};Tc.start=function(){Ob();var d=document.createElement("div");
d.id="mapForm";d.innerHTML="\n            <div>\n            <h2>"+x.gameOptions+"</h2>\n            <table>\n<tr><td>"+x.mapSize+': </td><td><input type="number" id=\'editorSize\' min="10" value="256" /></td></tr>\n<tr><td>'+x.random+' </td><td>\n<label class="container">\n  <input type="checkbox" id="editorRandom">\n  <span class="checkmark"></span>\n</label>\n</td></tr>\n<tr><td>'+x.nplayers+': </td><td><input id="editorPlayers" type="number" min="1" value="3"></td></tr>\n</table>\n</div>';var b=
document.createElement("button");b.innerHTML=x.continue;b.onclick=Tc.func;d.children[0].appendChild(b);b=document.createElement("button");b.innerHTML=x.cancel;b.onclick=xm;d.children[0].appendChild(b);document.body.appendChild(d)};var xm=function(){location.hash="";setTimeout(Jh,200);document.body.removeChild(this.parentElement.parentElement);nb()};Tc.func=function(){O(p.arje);if(void 0==p.arje){nb();q("editorRandom").checked?p.arje=555555*Math.random()+1:p.arje=!1;p.mapx=parseInt(q("editorSize").value);
p.mapy=p.mapx;p.goldRes=Infinity;p.foodRes=Infinity;p.woodRes=Infinity;p.stoneRes=Infinity;p.gravity=580.9/9.8*9.8;M=[];for(var d=0,b=parseInt(q("editorPlayers").value);d<b;d++)M[d]={color:[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],IA:!1,name:"Tzar "+(d+1),race:0,team:0};document.body.removeChild(q("mapForm"))}p.editor=1;if(vd(0,Tc.func)){q("statButton").style.display="none";q("menu").style.display="none";q("resources").style.display="none";q("mapeditorinfotop").style.display=
"block";q("mapeditorinfo").style.display="block";var c=document.getElementById("mapeditorinfoUnits");c.style.display="block";pg();if(!Tc.preload){Tc.preload=!0;var f={},g={},h=u,m={euro:$a[0],arab:$a[1],asia:$a[2],common:x.common};f[$a[0]]=[];f[$a[1]]=[];f[$a[2]]=[];f[x.common]=[];g[$a[0]]=[];g[$a[1]]=[];g[$a[2]]=[];g[x.common]=[];d=0;for(b=h.length;d<b;d++){var k=h[d];!k.race||k.illegal||7==k.type||k.item||(k.build?g[m[k.race]].put(d):f[m[k.race]].put(d))}for(k=0;2>k;k++){h=Object.keys(f);var l=
{};d=0;for(b=h.length;d<b;l={ul$17:l.ul$17},d++){var n=document.createElement("h1");n.innerHTML=h[d];l.ul$17=document.createElement("ul");n.onclick=function(b){return function(){Lg(b.ul$17)}}(l);l.ul$17.style.display="none";for(var w=f[h[d]],y=Object.keys(w),r={},z=0,A=y.length;z<A;r={tcreate:r.tcreate},z++)m=document.createElement("li"),m.innerHTML=u[w[y[z]]].name,r.tcreate=w[y[z]],m.onclick=function(b){return function(){var d=b.tcreate;u[d].wall?ph(d):L(d)}}(r),l.ul$17.appendChild(m);c.appendChild(n);
c.appendChild(l.ul$17)}f=g;c=q("mapeditorinfoBuilds")}h=Object.keys($b);c=q("mapeditorinfoItems");var C=document.createElement("ul");f={};d=0;for(b=h.length;d<b;f={u$18:f.u$18},d++)m=document.createElement("li"),f.u$18=$b[h[d]],m.onclick=function(b){return function(){Ii(b.u$18)}}(f),m.innerHTML=f.u$18.name,C.appendChild(m);c.appendChild(C);c=q("mapeditorinfoNature");n=document.createElement("h1");n.innerHTML=x.trees;C=document.createElement("ul");n.onclick=function(){Lg(C)};C.style.display="none";
m=document.createElement("li");C.appendChild(m);c.appendChild(n);c.appendChild(C);m.onclick=function(){ki(ym)};m.innerHTML=x.delete;m=document.createElement("li");C.appendChild(m);m.onclick=function(){ki(zm)};m.innerHTML=x.create;n=document.createElement("h1");n.innerHTML=x.terrain;var D=document.createElement("ul");n.onclick=function(){Lg(D)};D.style.display="none";c.appendChild(n);c.appendChild(D);b=mc.texturesRandomMap;c={};d=0;for(b=b.length;d<b;c={l:c.l},d++)m=document.createElement("li"),D.appendChild(m),
m.innerHTML=d,c.l=d,m.onclick=function(b){return function(){ki(li);li.active=b.l}}(c)}}};var pg=function(){var d=q("selectKingdom");d.innerHTML="";for(var b=1,c=D.length;b<c;b++){var f=D[b];1===b&&(d.style.background="rgba("+f.color[0]+","+f.color[1]+","+f.color[2]+",1)");d.innerHTML+='<option value="'+b+'" style="background:rgba('+f.color[0]+","+f.color[1]+","+f.color[2]+',1)">'+f.name+"</option>"}};q("selectKingdom").onchange=function(){w.kingdom=parseInt(this.value);var d=D[w.kingdom].color;this.style.background=
"rgba("+d[0]+","+d[1]+","+d[2]+",.8)"};var Yl=function(d){Ob();var b=document.createElement("div"),c=document.createElement("div");b.id="unitProps";var f="<table>"+('\n<tr><td>Name </td><td><input data-prop="name" type="text" value="'+d.name+'" /></td></tr>\n<tr><td>'+x.health+' </td><td><input data-prop="health" type="number" value="'+d.health+'" /></td></tr>\n<tr><td>'+x.maxHealth+'</td> <td><input data-prop="maxHealth" type="number" value="'+d.maxHealth+'" /></td></tr>\n');if(d.build||d.item)if(d.item){if(d.sword||
d.shield)f+="\n<tr><td>"+x.attack+'</td><td><input data-prop="attack" type="number" value="'+(d.attack||0)+'" /></td></tr>\n<tr><td>'+x.defence+'</td> <td><input data-prop="defence" type="number" value="'+(d.defence||0)+'" /></td></tr>\n'}else d.kingdom&&(f+="<tr><td>"+x.kingdom+' </td><td><select id="selectKingdom2">'+q("selectKingdom").innerHTML+"</select></td></tr>");else f+="\n<tr><td>"+x.attack+'</td><td><input data-prop="attack" type="number" value="'+(d.attack||0)+'" /></td></tr>\n<tr><td>'+
x.defence+'</td> <td><input data-prop="defence" type="number" value="'+(d.defence||0)+'" /></td></tr>\n<tr><td>'+x.mana+' <td><input data-prop="mana" type="number" value="'+(d.mana||0)+'" /></td></tr>\n<tr><td>'+x.kingdom+' </td><td><select id="selectKingdom2">'+q("selectKingdom").innerHTML+"</select></td></tr>\n";c.innerHTML=f+"</table>";f=document.createElement("button");f.innerHTML=x.ok;f.onclick=function(){for(var b=q("unitProps").getElementsByTagName("input"),c=0,e=b.length;c<e;c++)if(b[c]){var f=
b[c].value;"number"==b[c].type&&(f=parseInt(f));var k=b[c].dataset.prop;d.__proto__[k]!=f&&(d[k]=f)}d.kingdom&&(b=parseInt(q("selectKingdom2").value),b!=d.kingdom&&d.changeKingdom(b));document.body.removeChild(q("unitProps"));nb()};c.appendChild(f);b.appendChild(c);document.body.appendChild(b);O(d.kingdom);q("selectKingdom2")&&(q("selectKingdom2").value=d.kingdom)},va=function(d){document.getElementById(d).style.display="none"},lb=function(d){document.getElementById(d).style.display="block"},Vh,ki=
function(d){Vh=!0;T=function(){};var b=K;b.img=l.blank;var c=32*Jd();b.wh=[c,c];qb(b);b.active=!0;document.addEventListener("mousemove",kc);document.addEventListener("mousedown",Wk);kc.active=d},Wk=function(d){if(2==d.buttons||d.pageX<w.menumx||d.pageY<w.menumy)return Xk();kc(d)},dk=function(d){if(p.editor){var b=parseInt(q("brushSize").value)+d;b>q("brushSize").max?q("brushSize").value=q("brushSize").max:1>b?q("brushSize").value=1:(q("brushSize").value=b,K.wh&&(K.wh[0]+=32*d,K.wh[1]+=32*d,K.active=
!0))}},Jd=function(){return parseInt(q("brushSize").value)},li=function(d,b,c){d=Jd();for(var e=d*d,g=E,h=Qc,m=li.active,k=mc.type,l=0;l<e;l++){var n=b+l%d,p=c+~~(l/d);ka(n,p)&&(n+=p*g,h[n]=m,k[m]&&(2<R[n]&&y[R[n]].die(),2<Sa[n]&&y[Sa[n]].die()))}Uc()},zm=function(d,b,c){d=Jd();for(var e=d*d,g=E,h=0;h<e;h++){var m=b+h%d,k=c+~~(h/d);ka(m,k)&&(0===R[m+k*g]?.2>Math.random()&&rc([m+k*g,7,{d:3+~~(28*Math.random())}]):(m=y[R[m+k*g]],7==m.type&&m.die()))}},ym=function(d,b,c){d=Jd();for(var e=d*d,g=E,h=0;h<
e;h++){var k=b+h%d,l=c+~~(h/d);ka(k,l)&&(k=y[R[k+l*g]],7==k.type&&k.die())}},kc=function(d){var b=32*Jd();b=Wb(d.pageX-w.mx-.5*b/ha,d.pageY-.5*b/ha);var c=~~(.03125*b[1]);b=~~(.03125*b[0]);K.x=32*b;K.y=32*c;K.active=!0;if(0!==d.buttons){if(2==d.buttons)return Xk();kc.last!==b+c*E&&kc.active&&kc.active(d,b,c);kc.last=b+c*E}},Xk=function(){K.active=!0;K.x=-9999;K.y=-9999;Vh=!1;if(kc.active){var d=32*Jd();Wb(event.pageX-w.mx-.5*d/ha,event.pageY-.5*d/ha);kc.active=!1}K.wh=void 0;document.removeEventListener("mousedown",
Wk);document.removeEventListener("mousemove",kc)};q("mapProps").onclick=function(){q("mapPropsWindow").style.display="block";Ob();if(""==q("mapPropsWindow").innerHTML){var d=document.createElement("div");q("mapPropsWindow").appendChild(d);var b=document.createElement("table");d.appendChild(b);b=document.createElement("div");b.innerHTML=x.mapName;var c=document.createElement("input");c.value=p.name||x.strcusMap;c.id="mapName";c.type="text";d.appendChild(b);d.appendChild(c);b=document.createElement("div");
b.innerHTML=x.description;c=document.createElement("textarea");c.type="text";c.value=p.description||"";c.id="mapDescription";d.appendChild(b);d.appendChild(c);b=document.createElement("div");b.innerHTML=x.author;c=document.createElement("input");c.id="mapAuthor";c.value=p.author||"";c.type="text";d.appendChild(b);d.appendChild(c);d.appendChild(document.createElement("p"));b=document.createElement("button");b.onclick=Yk;b.innerHTML=x.close;d.appendChild(b)}mi()};var Yk=function(){O(this);this.parentElement.parentElement.style.display=
"none";nb()},$k={objAction:{id:"edobjAction",msg:x.objAction,func:function(){ja.active.type="attack";lb("selectionEvents");va("eventZone");lb("unitListDiv2");q("byButton2").style.display="inline-block";q("byButton1").style.display="inline-block";ja.active.zone=void 0}},objZone:{id:"edobjAction",msg:x.objZone,func:function(){ja.active.type="zone";ja.active.to.length=0;va("selectionEvents");q("eventZone").style.display="inline-block";va("byButton2");va("byButton1");va("unitListDiv2");Zk()}}},Fd=function(d){if(d)va("mapRulesWindow"),
nb(),Fd.actived=!0;else if(Fd.actived){lb("mapRulesWindow");Ob();d=~~(ca[0]/32);var b=~~(ca[1]/32),c=~~(ca[9]/32),f=~~(ca[10]/32);if(d<c)var g=d,h=c;else g=c,h=d;if(b<f)var k=b,l=f;else k=f,l=b;ja.active.zone||(ja.active.zone=[]);ja.active.zone.put([g,k,h,l]);O(d,b,c,f);Zk();Fd.actived=!1}},Zk=function(){var d=q("zoneList");d.innerHTML="";var b=ja.active.zone;if(b)for(var c=b.length,f=0;f<c;f++){var g=b[f],h=document.createElement("div"),k=document.createElement("button");k.innerHTML="x";k.obj=g;
k.pObj=b;k.spObj=!0;k.onclick=ni;h.innerHTML=g[0]+"x "+g[1]+"y -> "+g[2]+"x "+g[3]+"y";h.appendChild(k);d.appendChild(h)}};q("mapRules").onclick=function(){q("mapRulesWindow").style.display="block";Ob();if(""==q("mapRulesWindow").innerHTML){var d=document.createElement("div");d.innerHTML='\n<div id="mapEvent">\n<h4>'+x.events+'</h4>\n<select id="eventOptions" style="display:none">\n<option value="objAction">'+x.objAction+'</option>\n<option value="objZone">'+x.objZone+'</option>\n</select>\n<div id="eventScreen">\n</div>\n<div id="eventLayout">\n</div>\n<button id="addEvent">+</button>\n</div>\n<div id="mapActions">\n<h4>'+
x.actions+'</h4>\n<select id="actionOptions" style="display:none">\n<option value="objOrder">'+x.objOrder+'</option>\n</select>\n<div id="actionScreen">\n</div>\n<div id="actionLayout">\n</div>\n<button id="addAction">+</button>\n</div>\n<h4>'+x.rules+"</h4>\n";var b=document.createElement("div");b.id="rulist";d.appendChild(b);b=document.createElement("button");b.onclick=Am;b.innerHTML="+";d.appendChild(b);b.id="addRule";d.appendChild(document.createElement("p"));b=document.createElement("button");
b.onclick=Yk;b.innerHTML=x.close;d.appendChild(b);q("mapRulesWindow").appendChild(d);q("addEvent").onclick=Bm;q("addAction").onclick=Cm;q("eventOptions").onchange=function(){var b=$k[this.value];ja.div=b.id;lb(ja.div);ja.active.name=this.value;b.func&&b.func();b=q("eventScreen").getElementsByTagName("button");for(var d=!1,c=0,e=b.length;c<e;c++){var f=b[c];if(f.sdiv)if("none"==f.style.display)f.sdiv.style.display="none";else{if(!d)f.onclick();d=!0}}qg(Tb.active,"eventLayout")};q("actionOptions").onchange=
function(){mb.active.name=this.value;qg(Tb.active,"actionLayout")};d=document.createElement("div");d.id="edobjAction";var c=document.createElement("select");c.innerHTML='\n<option value="attack">'+x.attack+'</option>\n<option value="destroy">'+x.destroy+'</option>\n<option value="moving">'+x.moving+'</option>\n<option value="capture">'+x.capture+"</option>\n";c.value="attack";c.id="selectionEvents";c.onchange=Dm;var f=document.createElement("section"),g=document.createElement("section"),h=document.createElement("section"),
k=document.createElement("section"),l=document.createElement("section");b=document.createElement("button");b.innerHTML=x.add;b.onclick=Fd;var p=document.createElement("div");p.className="unitList";p.id="zoneList";h.appendChild(b);h.appendChild(p);p=document.createElement("div");p.className="unitList";p.id="unitListDiv";p.spType=ja;b=document.createElement("button");b.innerHTML=x.add;b.onclick=function(){wb(this)};b.button=p;b.style.margin="10px";f.appendChild(b);b=document.createElement("button");
b.innerHTML=x.defined;b.onclick=Kb;b.sdiv=f;d.appendChild(b);b.onclick();b=document.createElement("button");b.innerHTML=x.undefined;b.onclick=Kb;b.sdiv=g;d.appendChild(b);f.appendChild(p);d.appendChild(f);d.appendChild(g);d.appendChild(document.createElement("p"));d.appendChild(c);d.appendChild(document.createElement("p"));p=document.createElement("div");p.className="unitList";p.id="unitListDiv2";p.spType=ja;b=document.createElement("button");b.innerHTML=x.add;b.onclick=function(){wb(this)};b.button=
p;b.style.margin="10px";k.appendChild(b);b=document.createElement("button");b.innerHTML=x.defined;b.onclick=Kb;b.sdiv=k;b.id="byButton1";d.appendChild(b);b=document.createElement("button");b.innerHTML=x.undefined;b.onclick=Kb;b.id="byButton2";b.sdiv=l;d.appendChild(b);k.appendChild(p);b=document.createElement("button");b.innerHTML=x.zone;b.onclick=Kb;b.sdiv=h;b.id="eventZone";b.style.display="none";d.appendChild(b);d.appendChild(h);d.appendChild(k);d.appendChild(l);q("eventScreen").appendChild(d);
va("mapEvent");va("mapActions");d=document.createElement("div");d.id="edobjOrder";c=document.createElement("select");c.innerHTML='\n<option value="move">'+x.move+'</option>\n<option value="attack">'+x.attack+"</option>\n";c.value="move";c.id="selectionActions";c.onchange=Em;f=document.createElement("section");g=document.createElement("section");k=document.createElement("section");l=document.createElement("section");p=document.createElement("div");p.className="unitList";p.id="unitListDivAction";p.spType=
mb;b=document.createElement("button");b.innerHTML=x.add;b.onclick=function(){wb(this)};b.button=p;b.style.margin="10px";f.appendChild(b);b=document.createElement("button");b.innerHTML=x.defined;b.onclick=Kb;b.sdiv=f;d.appendChild(b);b=document.createElement("button");b.innerHTML=x.undefined;b.onclick=Kb;b.sdiv=g;d.appendChild(b);f.appendChild(p);d.appendChild(f);d.appendChild(g);b.onclick();d.appendChild(document.createElement("p"));d.appendChild(c);d.appendChild(document.createElement("p"));p=document.createElement("div");
p.className="unitList";p.id="unitListDivAction2";p.spType=mb;b=document.createElement("button");b.innerHTML=x.add;b.onclick=function(){wb(this)};b.button=p;b.style.margin="10px";k.appendChild(b);b=document.createElement("button");b.innerHTML=x.defined;b.onclick=Kb;b.sdiv=k;b.id="toButton1";d.appendChild(b);b=document.createElement("button");b.innerHTML=x.undefined;b.onclick=Kb;b.id="toButton2";b.sdiv=l;d.appendChild(b);k.appendChild(p);d.appendChild(k);d.appendChild(l);b.onclick();q("actionScreen").appendChild(d);
va("mapEvent");va("mapActions")}};var al={moving:1},Dm=function(){al[this.value]?(va("byButton2"),va("byButton1"),va("unitListDiv2")):(lb("unitListDiv2"),q("byButton2").style.display="inline-block",q("byButton1").style.display="inline-block");ja.active.type=this.value},Em=function(){al[this.value]?(va("toButton2"),va("toButton1"),va("unitListDivAction2")):(lb("unitListDivAction2"),q("toButton2").style.display="inline-block",q("toButton1").style.display="inline-block");mb.active.type=this.value},wb=
function(d){if(d)va("mapRulesWindow"),nb(),wb.actived=d.button;else if(wb.actived){lb("mapRulesWindow");Ob();d=wb.actived.spType.active;d="unitListDiv2"==wb.actived.id||"unitListDivAction2"==wb.actived.id?d.to:d.list;for(var b={},c=0,f=d.length;c<f;c++)b[d[c]]=1;c=0;for(f=G.length;c<f;c++)b[G[c]]||d.put(G[c]);Re(wb.actived,d);wb.actived=!1}},Re=function(d,b){d.innerHTML="";for(var c=0,f=b.length;c<f;c++){var g=document.createElement("div");g.innerHTML=y[b[c]].name;var h=document.createElement("button");
h.onclick=ni;h.innerHTML="x";h.pObj=b;h.spObj=!0;h.obj=b[c];g.appendChild(h);d.appendChild(g)}},Kb=function(){Kb.active&&(Kb.active.className="");Kb.active=this;this.className="spSelect";for(var d=this.parentElement.getElementsByTagName("section"),b=0,c=d.length;b<c;b++)d[b].style.display="none";this.sdiv.style.display="block"},Tb=function(){var d=this.editorRule;d.deleted||(lb("mapEvent"),lb("mapActions"),va("eventOptions"),Tb.active&&(Tb.div.className=""),this.className="spSelect",Tb.active=d,Tb.div=
this,qg(d,"eventLayout"),qg(d,"actionLayout"),ja.div&&va(ja.div),ja.div1=void 0)},ja=function(){var d=this.editorRule;d.deleted||(lb("eventOptions"),ja.div1&&(ja.div1.className=""),this.className="spSelect",ja.active=d,q("selectionEvents").value=d.type,ja.div1=this,q("eventOptions").value=d.name,ja.div=$k[d.name].id,lb(ja.div),Re(q("unitListDiv"),d.list),Re(q("unitListDiv2"),d.to))},mb=function(){var d=this.editorRule;d.deleted||(lb("actionOptions"),mb.div1&&(mb.div1.className=""),this.className=
"spSelect",mb.active=d,q("selectionActions").value=d.type,mb.div1=this,q("actionOptions").value=d.name,mb.div="ed"+d.name,lb(mb.div),Re(q("unitListDivAction"),d.list),Re(q("unitListDivAction2"),d.to))},qg=function(d,b){q(b).innerHTML="";if("eventLayout"==b){d=d.events;var c=ja,f=Tb.active.events}else d=d.actions,c=mb,f=Tb.active.actions;for(var g=0,h=d.length;g<h;g++){var k=document.createElement("div");rg(k,d[g],c,f);q(b).appendChild(k)}},Bm=function(){var c=Tb.active,b={name:"objAction",list:[],
to:[],type:"attack"};c.events.put(b);var e=document.createElement("div");rg(e,b,ja,c.events);q("eventLayout").appendChild(e);if(ja.div1)ja.div1.onclick()},Cm=function(){var c=Tb.active,b={name:"objOrder",list:[],to:[],type:"move"};c.actions.put(b);var e=document.createElement("div");rg(e,b,mb,c.actions);q("actionLayout").appendChild(e);if(mb.div1)mb.div1.onclick()},rg=function(c,b,e,f){c.innerHTML=b.events?b.name:x[b.name];c.onclick=e;c.editorRule=b;e=document.createElement("button");e.innerHTML=
"x";e.obj=b;e.pObj=f;e.onclick=ni;c.appendChild(e)},Am=function(){p.rules||(p.rules=[]);var c={name:"Rule"+p.rules.length,events:[],actions:[]};p.rules.put(c);var b=document.createElement("div");rg(b,c,Tb,p.rules);q("rulist").appendChild(b)},ni=function(){this.pObj.quit(this.obj);this.obj.deleted=!0;this.parentElement.parentElement.removeChild(this.parentElement);if(!this.spObj)if(this.pObj!==p.rules)Tb.div.onclick();else va("mapEvent"),va("mapActions")},mi=function(){var c=q("mapPropsWindow").getElementsByTagName("table")[0];
c.innerHTML="";c.innerHTML+="<tr><td>"+x.color+"</td><td>"+x.username+"</td><td>"+x.gold+"</td><td>"+x.wood+"</td><td>"+x.food+"</td><td>"+x.stone+"</td><td>"+x.AI+"</td><td>"+x.team+"</td></tr>";for(var b=1,e=D.length;b<e;b++){var f=D[b],g=f.color,h=f.resources;g="#"+(16777216+(g[0]<<16)+(g[1]<<8)+g[2]).toString(16).slice(1);c.innerHTML+='<tr><td><input style="background:'+g+'" type="color" value="'+g+'" /></td><td><input type="text" value="'+f.name+'"></td>\n\n<td><input type="text" class="res" value="'+
(parseInt(h[0])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[1])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[2])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[3])||"\u221e")+'"></td>\n<td><label class="container">\n  <input type="checkbox">\n  <span class="checkmark"></span>\n</label></td><td><input type="number" min="0" value="'+f.team+'"></td></tr>'}c.innerHTML+="<tr><td><button id='editorAdd'>+</button><button id='editorDelete'>-</button></td></tr>";
q("editorAdd").onclick=Fm;q("editorDelete").onclick=Gm;c=c.getElementsByTagName("input");b=0;for(e=D.length-1;b<e;b++)h=8*b,f=D[b+1],c[h].onchange=Hm,c[h+1].onchange=Im,c[h+2].onchange=sg,c[h+3].onchange=sg,c[h+4].onchange=sg,c[h+5].onchange=sg,c[h+2].res=0,c[h+3].res=1,c[h+4].res=2,c[h+5].res=3,c[h+6].onchange=Jm,c[h+6].checked=f.IA,c[h+7].onchange=Km,c[h].team=b+1,c[h+1].team=b+1,c[h+2].team=b+1,c[h+3].team=b+1,c[h+4].team=b+1,c[h+5].team=b+1,c[h+6].team=b+1,c[h+7].team=b+1},sg=function(){var c=
parseInt(this.value);c||(c=Infinity,this.value="\u221e");D[this.team].resources[this.res]=c},Fm=function(){new Yb("Tzar "+D.length,[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],[0],0,!0,[p.goldRes,p.woodRes,p.foodRes,p.stoneRes],2);pg();mi()},Gm=function(){if(2<D.length){for(var c=D.length-1,b=3,e=y.length;b<e;b++){var f=y[b];f.kingdom==c&&f.die()}D.length--;pg();mi()}},Hm=function(){var c=D[this.team],b=parseInt(this.value.substr(1),16),e=b>>16&255,f=b>>8&255;b&=255;c.color=
[e,f,b];var g=this.team;c=Ja[g];D[g].color=[e,f,b];g*=3;wa[g]=e/255;wa[g+1]=f/255;wa[g+2]=b/255;e=0;for(f=c.length;e<f;e++){b=c[e];g=0;for(var h=b.length;g<h;g++)yc(y[b[g]])}pg()},Im=function(){D[this.team].name=this.value},Jm=function(){D[this.team].IA=this.checked?!0:!1},Km=function(){var c=D[this.team];c.team=parseInt(this.value);for(var b=D.length,e=1;e<b;e++){var f=D[e];f.team!==c.team&&(f.diplomacy[c.k]=1,c.diplomacy[f.k]=1)}};xe.onchange=function(c){W(xh,parseInt(xe.value)/100,G)};q("mapload").accept=
".tzared,.wmp";q("mapload").onchange=function(c){c=document.getElementById("mapload").files[0];var b=c.name.split(".");b=b[b.length-1];var d=new FileReader;d.onload=function(){var c=new Uint8Array(this.result);if("wmp"==b)return Qe(c);O(c[0]);var d=c[1]+(c[2]<<8)+(c[3]<<16)+(c[4]<<24),e=new TextDecoder("utf-8");e=JSON.parse(e.decode(c.slice(5,d+5)));if(!1===e.arje){c=c.slice(d+5,d+5+Math.pow(e.mapx,2));var k=Math.pow(e.mapx,2);d=c.length;k=k?new Uint8Array(k):[];for(var l=0,p=0;p<d;p++){var n=c[p];
if(255!==n)k[l++]=n;else{n=c[p-1];for(var q=(c[p+1]<<8)+c[p+2],u=0;u<q;u++)k[l++]=n;p+=2}}e.terrain=k}e.allunits&&(e.allunits=Ik(e.allunits));e.ini&&(e.ini=Ik(e.ini));Uk(e)};d.readAsArrayBuffer(c)};var Ka,Uk=function(c){lb("customMapcont");q("editCustom").style.display="inline-table";Ka=c;Ka.kingdomStart?(q("seeStats").style.display="inline-table",q("playrecord").style.display="inline-table"):(q("seeStats").style.display="none",q("playrecord").style.display="none");null===Ka.goldRes&&(Ka.goldRes=
Infinity);null===Ka.stoneRes&&(Ka.stoneRes=Infinity);null===Ka.foodRes&&(Ka.foodRes=Infinity);null===Ka.woodRes&&(Ka.woodRes=Infinity);c=document.getElementById("custombody");c.innerHTML="";for(var b=Ka.kingdoms,d=0,f=b.length;d<f;d++){var g=b[d],h=g.color,k=g.team;void 0==k&&(k="");c.innerHTML+="<tr><td style='background:rgb("+h[0]+","+h[1]+","+h[2]+')\' class="ucolor1"></td><td class="username1">'+g.name+'</td><td style="display:none" class="race1">'+g.race+'</td><td class="team1">'+k+"</td></tr>"}},
Lm=function(c){var b={Blue:189,Red:13506841,Green:3257600,Purple:11337925,Yellow:16768512,Cyan:46517,Orange:16751649,Gray:5921370},d=c.split(["[Player"]),f=c.split("GameDuration =")[1].split("[")[0].split(" min")[0].split(" ")[1],g=[];c=[];for(var h=1,k=d.length;h<k;h++){var l=d[h].split("\n"),p={};g[h-1]=p;for(var n=0,q=l.length;n<q;n++){var u=l[n];u=u.split(" = ");if(u[1]&&n){u[1]=u[1].trim();"Color"==u[0]&&(u[1]=b[u[1]]);"Type"==r&&"Status"!==u[0]&&c.put("N");u[1]=encodeURIComponent(u[1]);c.put(u[1]);
p[u[0]]=u[1];var r=u[0]}}}b=g[0].Name+"'s Game";var w=new XMLHttpRequest;w.open("POST",baseUrl+"php/stats.php",!0);w.setRequestHeader("Content-type","application/x-www-form-urlencoded");w.onreadystatechange=function(){200===w.status&&4===w.readyState&&(location.hash="MatchX"+w.responseText)};c=c.join("<");w.send("arr="+c+"&time="+6E4*f+"&name="+b+"&players="+g.length)},oi=function(c,b){for(var d=0,f=0,g=c.length;f<g;f++)d+=b[c[f]];return d},pi=function(c,b,e){var d=["",e];performance.now();for(var g=
0,h=c.length;g<h;g++){var k=c[g],l=k.stats,p=l.resources,n=l.unitCountMax,u=24*g+2,w=k.color,r=k.IA;r=r?"IA":"Human";d[u]=(w[0]<<16)+(w[1]<<8)+w[2];d[u+1]=k.name;d[u+1]=k.name;d[u+2]=r;d[u+3]=k.status;d[u+4]=k.team;d[u+5]=$a[k.race];d[u+6]=l.score;d[u+7]=p[0];d[u+8]=p[1];d[u+9]=p[2];d[u+10]=p[3];d[u+11]=l.dmgInflicted;d[u+12]=l.dmgTaken;d[u+13]=l.unitsKilled;d[u+14]=l.unitsLosed;d[u+15]=l.buildsDestroyed;d[u+16]=l.buildsLosed;d[u+17]=oi([10,79,64],n);d[u+18]=oi([32,44],n);d[u+19]=oi([55,56],n);d[u+
20]=0;d[u+21]=0;d[u+22]=0;d[u+23]=0}bl(d,b);b&&setTimeout(function(){"block"==q("ingameStats").style.display&&pi(c,b,e)},500)},bl=function(c,b){for(var d="<tr style='background:#000;'><td style='    padding-right: 150px;'>Name</td><td>Type</td><td>Status</td><td>Team</td><td>Race</td><td>Score</td><td>Gold</td><td>Wood</td><td>Food</td><td>Stone</td><td title='Damage Inflicted'>D.I</td><td title='Damage Taken'>D.T</td><td title='Units Killed'>U.K</td><td title='Units Losed'>U.L</td><td title='Buildings Destroyed'>B.D</td><td title='Buildings Losed'>B.L</td><td title='Maximum Peasants'>M.P</td><td title='Maximum Towers'>M.T</td><td title='Maximum Stone Towers'>M.S.T</td><td title='Gold Traded'>G.T</td><td title='Stone Traded'>S.T</td><td title='Gold Converted'>G.C</td><td title='Stone Converted'>S.C</td></tr>",
f=2,g=c.length;f<g;f++)if((f-2)%24)0!==(f-3)%24&&(h=~~((f-2)/24)%2?"style = 'background:rgba(0,0,0,0.45)'":"style = 'background:rgba(0,0,0,0.65)'"),d+="<td "+h+">"+Xa(decodeURIComponent(c[f]))+"</td>";else{f-2&&(d+="</tr>");h=parseInt(Xa(decodeURIComponent(c[f])));var h="style = 'background:rgba("+Math.floor(h/65536)+","+Math.floor(h/256)%256+","+h%256+",0.45)'";d+="<tr>"}d+="</tr>";b?(q("ingameStats").style.display="block",q("statsGame").innerHTML="<tbody>"+d+"</tbody>",b=q("statsGame").getElementsByTagName("td")):
(q("MatchX").style.display="block",q("returnmenu").style.display="block",q("statsTable").innerHTML="<tbody>"+d+"</tbody>",b=q("statsTable").getElementsByTagName("td"));c=[];f=0;for(g=b.length;f<g;f++)d=f%23,4<d&&23<f&&(c[d-5]||(c[d-5]=[]),c[d-5].put(b[f]));f=0;for(g=c.length;f<g;f++){b=c[f];b.sort(ml);d=b.length;if(!b[1])break;b[0].innerHTML!=b[1].innerHTML&&(b[0].style.background="rgba(127,0,0,0.45)");b[d-1].innerHTML!=b[d-2].innerHTML&&(b[d-1].style.background="rgba(0,127,0,0.45)")}};q("statsLoad").onchange=
function(){var c=document.getElementById("statsLoad").files[0],b=new FileReader;b.onloadend=function(b){Lm(b.target.result)};c&&b.readAsText(c,"ascii")};var ll=function(c){var b=new XMLHttpRequest;b.open("POST",baseUrl+"php/loadstat.php",!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");cl(b,function(b){bl(b.responseText.split("<"))});O(c);b.send("id="+c)},cl=function(c,b){c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b(c):alert("Error: "+c.status))}},
Kk=function(){q("mapconfiguration").style.display="block";q("basic").style.filter="blur(94px)";if(""==q("mapconfiguration").innerHTML){for(var c="",b=["grass","snow"],e=0,f=b.length;e<f;e++)c+='<option value="'+b[e]+'" '+(b[e]==localStorage.terrain?"selected":"")+">"+x[b[e]]+"</option>";b="";"true"==localStorage.infinity&&(b="checked");q("mapconfiguration").innerHTML="<table>\n<tbody>\n<tr><td>"+x.mapSize+'</td><td><input id="mapwidth" type="number" value="'+localStorage.mapSize+'" step="32" min="32" /></td></tr>\n<tr><td><hr></td></tr>\n<tr><td>'+
x.startingResources+"</td></tr>\n<tr><td><hr></td></tr>\n<tr><td>"+x.infinite+'</td><td><label class="container">\n  <input id="infiniteValue" type="checkbox" '+b+'>\n  <span class="checkmark"></span>\n</label></td></tr>\n<tr><td>'+x.gold+'</td><td><input id="goldValue" type="number" value="'+localStorage.gold+'" step="250" /></td></tr>\n<tr><td>'+x.wood+'</td><td><input id="woodValue" type="number" value="'+localStorage.wood+'" step="250" /></td></tr>\n<tr><td>'+x.food+'</td><td><input id="foodValue" type="number" value="'+
localStorage.food+'" step="250" /></td></tr>\n<tr><td>'+x.stone+'</td><td><input id="stoneValue" type="number" value="'+localStorage.stone+'" step="250" /></td></tr>\n<tr><td><hr></td></tr>\n<tr><td>'+x.terrainOption+'</td></tr>\n<tr><td><select name="terrain" id="terrainSelect">\n'+c+"\n<tr><td>"+x.water+'</td><td><input type="number" value="'+localStorage.water+'" id="waterValue" /></td></tr>\n</select>\n</td>\n</tr>\n<tr><td></td></tr>\n<tr><td><button id="closeButton1" class="start">'+x.close+
"</button></td></tr>\n</tbody>\n</table>";q("infiniteValue").onchange=function(){var b=this.checked;q("goldValue").disabled=b;q("stoneValue").disabled=b;q("woodValue").disabled=b;q("foodValue").disabled=b};q("infiniteValue").onchange();q("closeButton1").onclick=function(){q("mapconfiguration").style.display="none";nb()}}};q("deleteUnit").onclick=function(){W(we,1,G.slice(0))};q("rotatebutton").onclick=function(){for(var c=G,b=0,e=c.length;b<e;b++){var f=y[c[b]];f.build||(f.d=(f.d+1)%8,aa(f,f.img))}};
q("gameMenu").onclick=yi;q("menueditor").onclick=yi;q("quitButton1").onclick=function(){Hi("playingMenu");p.online&&bi();M.length=0;G=[];Na=void 0;clearInterval(ef);D=[];lc={};Zh=8;nb();p={canceled:!0};M.length=0;y=[{terrain:1},{terrain:1},{terrain:1}];Zc={};Yc={};Fb={};Xb.length=0;Ja=[];Aa=[];wa=[];w.admin=!1;Eb=w.kingdom=void 0;Wj={euro:0,arab:0,asia:0};ab.stop();Bc=document.getElementById("msgs");kg=document.getElementById("msginput");window.removeEventListener("mousemove",Gb);window.removeEventListener("keydown",
hk);window.removeEventListener("keyup",ik);window.removeEventListener("mousemove",jk);window.removeEventListener("mousedown",kk);window.removeEventListener("mouseup",lk);Lb();document.getElementById("playermenu").style.display="block";document.getElementById("playingMenu").style.display="none"};q("backToGame").onclick=function(){q("playingMenu").style.display="none";nb()};q("backToGameS").onclick=function(){Hi("ingameStats");nb()};q("statButton").onclick=function(){pi(D.slice(1),!0,p.now());Ob()};
q("returnmenu1").onclick=Lb;q("returnmenu").onclick=Lb;q("refreshButton1").onclick=Kg;q("sendmsg").onclick=Mh;q("start1").onclick=Kk;q("start2").onclick=vd;q("alertok").onclick=function(){q("alert").style.display="none";nb()};q("saveGame").onclick=function(){p.editor&&(p.arje=!1,q("mapDescription")&&(p.description=q("mapDescription").value,p.name=q("mapName").value,p.author=q("mapAuthor").value));delete p.terrain;var c=p,b=y,e=[];e.length=b.length-3;for(var f=3,g=b.length;f<g;f++){var h=b[f],k=u[h.type],
l={0:h.kingdom,1:h.d,2:h.type,3:h.img,4:h.x32,5:h.y32};h.name!==k.name&&(l[6]=h.name);h.iconID!==k.iconID&&(l[7]=h.iconID);h.attack!==k.attack&&(l[8]=h.attack);h.defence!==k.defence&&(l[9]=h.defence);h.level!==k.level&&(l[10]=h.level);h.health!==k.health&&(l[11]=h.health);h.maxHealth!==k.maxHealth&&(l[12]=h.maxHealth);h.func&&(l[13]=h.func);h.funcObj&&(l[14]=h.funcObj);h.workers&&h.workers.length&&(l[15]=h.workers);h.workingOn&&(l[16]=h.workingOn);h.inventory&&h.inventory.length&&(l[17]=h.inventory);
h.dix&&(l[18]=h.dix);h.diy&&(l[19]=h.diy);h.timestamp&&(l[20]=h.timestamp);h.working&&(l[21]=h.working);h.rnd&&(l[22]=h.rnd);h.techID&&(l[23]=h.techID);h.techStart&&(l[24]=h.techStart);h.activeTech&&(l[25]=h.activeTech);h.levelProgress&&(l[26]=h.levelProgress);h.c&&(l[27]=h.c);h.mimg&&(l[28]=h.mimg);void 0!==h.built&&(l[29]=h.built);void 0!==h.xf&&(l[30]=h.xf);void 0!==h.yf&&(l[31]=h.yf);void 0!==h.action&&(l[32]=h.action);h.point&&(l[33]=h.point);h.waitlist&&(l[34]=h.waitlist);h.mv&&(l[35]=h.mv);
h.work&&(l[36]=h.work);h.death&&(l[37]=h.death);h.freezed&&(l[38]=h.freezed);h.confused&&(l[39]=h.confused);h.sword&&(l[40]=h.sword);h.shield&&(l[41]=h.shield);h.book&&(l[42]=h.book);h.spy&&(l[43]=h.spy);h.stock&&(l[44]=h.stock);e[f-3]=l}c.allunits=e;p.movtable=Yc;p.movtable2=Zc;p.kingdomStart||p.editor||(p.kingdomStart=ai);p.kingdoms=D.slice(1);c=p;c=JSON.stringify(c);c=(new TextEncoder("utf-8")).encode(c);c=[new Uint8Array([55]),new Uint8Array((new Uint32Array([c.length])).buffer),c];0==p.arje&&
c.put(nm(Qc));c=new Blob(c,{type:"application/octet-binary"});c=URL.createObjectURL(c);b=document.createElement("a");document.body.appendChild(b);b.style="display: none";b.href=c;b.download="savegame.tzared";b.click();p.allunits=void 0};q("createGame1").onclick=Hk;q("copyButton").onclick=function(){document.getElementById("onlineID").select();document.execCommand("Copy")};q("startCustom").onclick=function(){p=Object.assign({},Ka);p.editor=!1;p.custom=!0;p.online=!1;Ka=void 0;va("customMapcont");vd(!1,
!1)};q("editCustom").onclick=function(){p=Object.assign({},Ka);p.custom=!0;Tc.func();Ka=void 0;va("customMapcont")};q("playrecord").onclick=function(){p=Object.assign({},Ka);p.online=!1;p.custom=!0;p.demo=!0;p.cycle=0;p.editor=!1;Ka=void 0;va("customMapcont");vd(!1,!1)};q("seeStats").onclick=function(){pi(Ka.kingdoms,!1,25*Ka.cycle);location.hash="MatchX"};var Mm=function(){O(this,this.checked);localStorage[this.localProp]=this.checked},dl=function(){"color"==this.type&&(this.style.backgroundColor=
this.value);w[this.localProp]=this.value;localStorage[this.localProp]=this.value},Ei={MatchHistory:function(){document.getElementById("returnmenu").style.display="block";var c=new XMLHttpRequest;c.open("GET",baseUrl+"php/latest.php",!0);cl(c,function(b){b=b.responseText.split("|");for(var c=b.length-1,d="",g=0;g<c;g+=5)d+="<tr id='statList"+Xa(decodeURIComponent(b[g]))+"'><td>"+Xa(decodeURIComponent(b[g+1]))+"</td><td>"+Xa(decodeURIComponent(b[g+2]))+"</td><td>"+Xa(decodeURIComponent(b[g+3]))+"</td><td>"+
parseInt(Xa(decodeURIComponent(b[g+4])))/6E4+" min</td></tr>";document.getElementById("matchtable").innerHTML="<tbody>"+d+"</tbody>";d={};for(g=0;g<c;d={l:d.l},g+=5)d.l=Xa(decodeURIComponent(b[g])),q("statList"+d.l).onclick=function(b){return function(){location.hash="MatchX"+b.l}}(d)});c.send(null)},GameList:Kg,RandomMap:jc,Twitter:function(){document.getElementById("returnmenu").style.display="block"},Account:function(){Id.returnmenu.style.display="block";""==Id.Account.innerHTML&&(Id.Account.innerHTML=
'<iframe id="accountIframe"></iframe>',Id.accountIframe=document.getElementById("accountIframe"));Id.accountIframe.src=baseUrl+w.langCodeUrl+"account/?iframe=1"},MapEditor:Tc.start,CustomMap:function(){document.getElementById("returnmenu").style.display="block"},Settings:function(){var c=q("Settings");if(""==c.innerHTML){var b=document.createElement("h2");b.innerHTML=x.strSettings;c.appendChild(b);b=document.createElement("div");var e=document.createElement("span");e.innerHTML=x.color;b.appendChild(e);
var f=document.createElement("input");f.type="color";f.value=localStorage.color;f.onchange=dl;f.localProp="color";f.style.backgroundColor=localStorage.color;b.appendChild(f);e=document.createElement("span");e.innerHTML=x.username;b.appendChild(e);f=document.createElement("input");f.type="text";f.value=localStorage.name;f.onchange=dl;f.localProp="name";b.appendChild(f);e=document.createElement("span");e.innerHTML=x.offlinePlay;b.appendChild(e);e=document.createElement("button");e.innerHTML=x.downloadAll;
e.onclick=Gc;b.appendChild(e);e=document.createElement("span");e.innerHTML=x.fullscreen;b.appendChild(e);var g=document.createElement("label");g.className="container";e=document.createElement("span");e.className="checkmark";f=document.createElement("input");f.type="checkbox";f.checked="true"==localStorage.fullscreen?!0:!1;f.onchange=Mm;f.localProp="fullscreen";g.appendChild(f);g.appendChild(e);b.appendChild(g);c.appendChild(b)}lb("returnmenu")}};Ci();var Qb=[Fc,Jf,dd,bd,ke,yf,Tf,Lf,Cf,Af,If,Vf,Of,
Ij,Xf,Ef,Gf,Qf,me,Zd,Kd,cj,ff,Zg,aj,Gj,uf,Mj,Oj,Cd,Fh,Pj,Qj,Rj,Sj,uf,yk,Cj,Tj,be,Dj,mf,Aj,Bj,uh,vh,fe,xc,th,cd,bd,tf,dd,Kc,yd,ie,ba,function(c){var b=c[1],d=y[c[2]];c=C[c[0]];D[d.kingdom].technology.hidden[c.id.id]=0;wc(d,c,b);ia.actv[c.id.id]&&Y(!1)},de,pf,la,sj,Ab,qf,rh,Yd,Th,ak,Lj,Ch,Nf,Hj,Ej];(function(){for(var c=0,b=Qb.length;c<b;c++)Qb[c].url=c})();Zd.rule="moving";vh.rule="attack"})();
