var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(B,ca,Da){B!=Array.prototype&&B!=Object.prototype&&(B[ca]=Da.value)};$jscomp.getGlobal=function(B){return"undefined"!=typeof window&&window===B?B:"undefined"!=typeof global&&null!=global?global:B};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var B=0;return function(ca){return $jscomp.SYMBOL_PREFIX+(ca||"")+B++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var B=$jscomp.global.Symbol.iterator;B||(B=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[B]&&$jscomp.defineProperty(Array.prototype,B,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(B){var ca=0;return $jscomp.iteratorPrototype(function(){return ca<B.length?{done:!1,value:B[ca++]}:{done:!0}})};$jscomp.iteratorPrototype=function(B){$jscomp.initSymbolIterator();B={next:B};B[$jscomp.global.Symbol.iterator]=function(){return this};return B};
$jscomp.iteratorFromArray=function(B,ca){$jscomp.initSymbolIterator();B instanceof String&&(B+="");var Da=0,bb={next:function(){if(Da<B.length){var Ta=Da++;return{value:ca(Ta,B[Ta]),done:!1}}bb.next=function(){return{done:!0,value:void 0}};return bb.next()}};bb[Symbol.iterator]=function(){return bb};return bb};
$jscomp.polyfill=function(B,ca,Da,bb){if(ca){Da=$jscomp.global;B=B.split(".");for(bb=0;bb<B.length-1;bb++){var Ta=B[bb];Ta in Da||(Da[Ta]={});Da=Da[Ta]}B=B[B.length-1];bb=Da[B];ca=ca(bb);ca!=bb&&null!=ca&&$jscomp.defineProperty(Da,B,{configurable:!0,writable:!0,value:ca})}};$jscomp.polyfill("Array.prototype.keys",function(B){return B?B:function(){return $jscomp.iteratorFromArray(this,function(B){return B})}},"es6","es3");
$jscomp.polyfill("Object.getOwnPropertySymbols",function(B){return B?B:function(){return[]}},"es6","es5");$jscomp.findInternal=function(B,ca,Da){B instanceof String&&(B=String(B));for(var bb=B.length,Ta=0;Ta<bb;Ta++){var R=B[Ta];if(ca.call(Da,R,Ta,B))return{i:Ta,v:R}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(B){return B?B:function(B,Da){return $jscomp.findInternal(this,B,Da).v}},"es6","es3");$jscomp.owns=function(B,ca){return Object.prototype.hasOwnProperty.call(B,ca)};
$jscomp.polyfill("Object.assign",function(B){return B?B:function(B,Da){for(var ca=1;ca<arguments.length;ca++){var Ta=arguments[ca];if(Ta)for(var R in Ta)$jscomp.owns(Ta,R)&&(B[R]=Ta[R])}return B}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(B){return B?B:function(){return $jscomp.iteratorFromArray(this,function(B,Da){return Da})}},"es8","es3");$jscomp.polyfill("Math.sign",function(B){return B?B:function(B){B=Number(B);return 0===B||isNaN(B)?B:0<B?1:-1}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(B){return B?B:function(B){return"number"!==typeof B?!1:!isNaN(B)&&Infinity!==B&&-Infinity!==B}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(B){return B?B:function(B){return Number.isFinite(B)?B===Math.floor(B):!1}},"es6","es3");
(function(){var B,ca,Da,bb;function Ta(c,b){var e=A,f;for(f=2;60>=f;f+=2){c--;b--;for(var g=0;g<=f;){if(2<K[c+g+e*b]&&1==x[K[c+g+e*b]].res&&ma(c+g,b))return K[c+g+e*b];if(2<K[c+g+e*(b+f)]&&1==x[K[c+g+e*(b+f)]].res&&ma(c+g,b+f))return K[c+g+e*(b+f)];g++}for(g=0;g<f-1;){g++;if(2<K[c+e*(b+g)]&&1==x[K[c+e*(b+g)]].res&&ma(c,b+g))return K[c+e*(b+g)];if(2<K[c+f+e*(b+g)]&&1==x[K[c+f+e*(b+g)]].res&&ma(c+f,b+g))return K[c+f+e*(b+g)]}}return!1}function R(c,b){if(!qd(c)){var e=c.x32,f=c.y32,g=c.sight;c.build&&
(g=c.attDist);var d=A,l=2*g+1,p=l*l,u=c.id,E={};c.callList||(c.callList=[]);for(var D=0;D<p;D++){var r=D%l-g,U=~~(D/l)-g;if(Math.sqrt(Math.pow(r,2)+Math.pow(U,2))<=g){r+=e;U+=f;var J=r+U*d;ma(r,U)&&(oc[J]?(r=x[oc[J]],E[r.id]||b||(r.callList||O(r),r.callList.put(c.id),r.callList.put(c.x32+c.y32*d),E[r.id]=1)):oc[J]=u)}}}}function Li(c){if(c.callList){for(var b=c.x32,e=c.y32,f=c.sight,g=A,d=2*f+1,l=d*d,p=c.id,u=0;u<l;u++){var E=u%d-f,D=~~(u/d)-f;Math.sqrt(Math.pow(E,2)+Math.pow(D,2))<=f&&(E+=b,D+=e,
E+=D*g,oc[E]==p&&(oc[E]=void 0))}b=c.callList;c.callList=void 0;u=0;for(l=b.length;u<l;u+=2)c=x[b[u]],c.x32+c.y32*g==b[u+1]&&c.callList&&R(c,!0);b.length=0}}function rl(){for(var c=0,b=Ua.length;c<b;Ua[c++].className="");}function sl(c){k.getError()==k.CONTEXT_LOST_WEBGL&&(k=document.getElementById("tzar").getContext("webgl2",{antialias:!1,alpha:!1}),O("restored"));ca=[];Da=[0,1,2,1,2,3];bb=[];Da.changed=!0;if(!Td){var b=k.createShader(k.VERTEX_SHADER);k.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec4 a_kingdom;\nin vec4 a_physic;\nuniform float zoom;\nuniform mediump int miniMap;\nuniform float now;\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform sampler2D u_image1;\nuniform sampler2D delay;\nuniform float zMax;\nout highp vec2 vTextureCoord;\nout vec4 v_kcolor;\nout float height;\n\nvec4 superArray(in highp uint position) {\n     return(texelFetch(u_image1, ivec2(\t\t(position%uint(512))\t\t,\tposition/uint(512)\t), 0));\n}\n\n\n\nvoid main() {\n\n\n\n    highp float  x;\n    float t;\n\thighp uint pos;\n\n\nif(a_texCoord.y>-.5&&miniMap==0){\nt=(now-a_texCoord.y);\nif(a_texCoord.w>=0.0){\npos=uint(floor(t * a_texCoord.w));         \n}else{\n\n\nint index=int(-a_texCoord.w);\nint len=int(a_texCoord.z);\nint i;\n\nfloat spt= mod(t,texelFetch(delay, ivec2(len-1+index, 0), 0).r);\n\n for(i=0;i<len;i++){\n\n\nif(texelFetch(delay, ivec2(i+index, 0), 0).r>spt) {\n\nbreak;\n }\n\n\n }\n\n pos=uint(i);\n\n\t\t\t\t  \n //pos=uint(4);\n}\n\n\n\tpos=uint(a_texCoord.x)+uint(4)*(pos%uint(a_texCoord.z));\n\n\n}else{\n\npos=uint(a_texCoord.x);\n\n}\n\n\n\n    vec4 coord = superArray(pos);\n\n\tpos=pos-pos%uint(4);\n\n\theight = (superArray(pos+uint(3)).w-superArray(pos).w)/512.0;\n\n    vec2 mxy=vec2(coord.p,coord.q);\n\n\n\t\tfloat z=a_position.z;\n\n\tif(z<0.0){\n\tz*=-1.0;\n\tmxy*=0.0;\n\n\t}\n\n\n\n    t = (now - a_physic.w) * 0.001;\n    mxy.x+=a_physic.x * t;\n\n\tfloat physicY=a_physic.y * t + a_physic.z * .5 * t * t;\n\n    mxy.y+=physicY;\n\n\nif(miniMap==1){\n\tz=0.0;\n}else{\n\tz=(1.0 - (physicY+z)/ zMax)*.9;\n}\n\n   gl_Position = vec4((((a_position.xy+mxy) + u_translation) / u_resolution * 2.0 - 1.0) * vec2(zoom, -zoom), (z), 1.0);\n\n   vTextureCoord=vec2(coord.s,coord.t);\n\n\n    v_kcolor=a_kingdom;\n\n\n}\n");
k.compileShader(b);c=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(c,"#version 300 es\nprecision mediump float;\n\n\n\nuniform sampler2D lightmap;\nuniform vec2 u_resolution;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform mediump int miniMap;\nin vec4 v_kcolor;\nin highp vec2 vTextureCoord;\nin float height;\nout vec4 COLOR;\n\nvoid main() {\n\n\nif(miniMap==0){\n\n\n\n\nvec2 txtFinal=vTextureCoord;\n\nif(txtFinal.x>=1.0){\ntxtFinal.y+=height*floor(txtFinal.x);\n}\n\n\nvec4 color=texture(img_common, vec3(txtFinal, int(txtFinal.y)));\n \n\nif(color.a<0.5) discard;\n\n\n\n\nif(v_kcolor.a<1.0){\ncolor*=v_kcolor;\n}else if(v_kcolor.a!=1.0){\n\nif(color.r==color.g&&color.r==color.b){\ncolor.rgb*=v_kcolor.rgb;\n}\ncolor.a*=v_kcolor.a-1.0;\n}\nvec4 light=vec4(1.0);\n\n\nlight = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+vec4(1.0,1.0,1.0,0.0)*u_ambient;\n\nCOLOR=color*light;\n\n}else{\nCOLOR=v_kcolor;\n}\n\n}");
k.compileShader(c);ra=k.createProgram();k.attachShader(ra,b);k.attachShader(ra,c);k.linkProgram(ra);k.useProgram(ra);(b=k.getShaderInfoLog(b))&&console.log("Shader compiler log: "+b);(b=k.getShaderInfoLog(c))&&console.log("Shader compiler log: "+b);b=k.createShader(k.VERTEX_SHADER);k.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\n\n\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform mediump int miniMap;\nuniform float zoom;\n\n\nvoid main() {\n\nfloat depth;\nif(miniMap==1){\ndepth=.03;\n}else{\ndepth=1.0;\n}\n\n   gl_Position = vec4(a_position.x, a_position.y, depth, 1.0);\n   \n\n}");
k.compileShader(b);c=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(c,"#version 300 es\nprecision mediump float;\n\nuniform float u_fps;\nuniform mediump int miniMap;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform vec2 borderCoords;\nuniform vec2 waterBorder;\nuniform vec2 u_translation;\nuniform vec2 u_resolution;\nuniform vec2 minimapMargin;\nuniform mediump isampler2D img_data;\nuniform sampler2D lightmap;\nout vec4 COLOR;\nuniform float zoom;\nuniform float mx;\nuniform float mapSize;\nuniform float terrainInfo[32];\nvec4 sptexture3D(in vec2 coords,in float height1) {\n \n\n \nif(coords.x>=1.0){\ncoords.y+=height1*floor(coords.x);\n}\n\n\n\n    return(\ttexture(img_common, vec3(coords,int(coords.y)))\t);\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\nvec4 color;\n\nvec2 xy =  vec2(gl_FragCoord.x,u_resolution.y-gl_FragCoord.y)/zoom;\n\nif(miniMap==1){\nxy+=minimapMargin/zoom;\n}else{\nxy+=-u_translation+vec2(mx,0.0)/zoom+0.5*(u_resolution-u_resolution/zoom);\n}\n\nvec2 xy32=xy/32.0;\n\nvec2 floorxy32=floor(xy32);\n\nvec2 xyr=xy32-floorxy32;\n\n\nvec2 xyb;\n\n\nfloat dx=0.0;\nfloat dy=0.0;\n\nif(xyr.x>0.5){dx=1.0;}\nif(xyr.y>0.5){dy=1.0;}\n\nvec2 oxy32=xy32;\n\n\nif(dx==1.0){\nxyb=vec2(borderCoords.x+floor(rand(floorxy32)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(-16.0,8.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.x+=dx;\n}\n}\n\nif(dy==1.0){\nxyb=vec2(borderCoords.x+floor(rand(1.5*floorxy32-3.0)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(8,-16.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.y+=dy;\n}\n}\n\n\nint type = texture(img_data,xy32/(mapSize)).r;\nint ntype = texture(img_data,oxy32/(mapSize)).r;\n\nif(type<0&&type!=ntype){\n\nif(ntype<0){\ntype=ntype;\n}else if(ntype==3){\ntype=ntype;\n}else{\ntype=1;\n}\n}\n\n\n\nfloat h;\nfloat w;\nvec2 xytxt;\nif(type<0){\n\ntype=-type-2;\nxytxt=waterBorder+vec2(float(type*8*32),0.0)/512.0;\nw=32.0;\nh=32.0;\ntype*=-1;\n}else{\nxytxt=vec2(terrainInfo[type*4],terrainInfo[type*4+1]);\nw=terrainInfo[type*4+2];\nh=terrainInfo[type*4+3];\n\nif(type==3) xytxt+=vec2(u_fps,0.0);\n}\n\n\nvec2 xyt=vec2(xytxt)+vec2(mod(xy.x,w),mod(xy.y,h))/512.0;\n\n\nif(type==3){ h=576.0; }\ncolor=sptexture3D(xyt,h/512.0);\n\nmediump vec4 light=vec4(1.0);\nif(miniMap==0) light = (texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+1.0)*u_ambient;\n\n\n\nCOLOR=color*light;\n\n\n\n}");
k.compileShader(c);ya=k.createProgram();k.attachShader(ya,b);k.attachShader(ya,c);k.linkProgram(ya);(b=k.getShaderInfoLog(b))&&console.log("Shader1 compiler log T: "+b);(b=k.getShaderInfoLog(c))&&console.log("Shader compiler log T: "+b)}c=k.getAttribLocation(ra,"a_position");b=k.getAttribLocation(ra,"a_texCoord");var e=k.getAttribLocation(ra,"a_kingdom"),f=k.getAttribLocation(ra,"a_physic"),g=m,d=pc.dir,l=[];l.length=4*d.length;for(var p=0,u=d.length;p<u;p++){var E=Z[g[d[p]]],D=E[7]+E.deltaY,r=E[8],
U=E[9];l[4*p]=E[6]/512;l[4*p+1]=D/512;l[4*p+2]=r;l[4*p+3]=U}p=1/512;k.useProgram(ya);d=k.getUniformLocation(ya,"minimapMargin");Ud=k.getUniformLocation(ya,"u_translation");Tg=k.getUniformLocation(ya,"u_resolution");Ug=k.getUniformLocation(ya,"u_fps");Mi=k.getUniformLocation(ya,"u_ambient");rd=k.getUniformLocation(ya,"zoom");u=k.getUniformLocation(ya,"mx");E=k.getUniformLocation(ya,"mapSize");D=k.getUniformLocation(ya,"borderCoords");r=k.getUniformLocation(ya,"waterBorder");pf=k.getUniformLocation(ya,
"miniMap");U=k.getUniformLocation(ya,"terrainInfo");k.uniform2fv(D,[Z[g.terrain_border][6]*p,p*(Z[g.terrain_border].deltaY+Z[g.terrain_border][7])]);k.uniform2fv(r,[Z[g.waterborder][6]*p,p*(Z[g.waterborder].deltaY+Z[g.waterborder][7])]);k.uniform1i(pf,0);k.uniform2fv(Ud,[0,0]);k.uniform1f(Ug,-1);k.uniform1f(rd,1);k.uniform1f(u,-v.mx);k.uniform1f(E,A);k.uniform1fv(U,l);n.editor?k.uniform2fv(d,[0,-60]):k.uniform2fv(d,[-4,-31]);g=k.getAttribLocation(ya,"a_position");Vg=k.createVertexArray();k.bindVertexArray(Vg);
l=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,l);k.bufferData(k.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,1,1,-1,1]),k.STATIC_DRAW);k.enableVertexAttribArray(g);k.vertexAttribPointer(g,2,k.FLOAT,!1,0,0);k.bindVertexArray(null);k.useProgram(ra);k.bindBuffer(k.ARRAY_BUFFER,null);g=A*Ka*3;Wg=k.createVertexArray();k.bindVertexArray(Wg);Qb=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Qb);k.enableVertexAttribArray(e);k.vertexAttribPointer(e,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,16*g,
k.DYNAMIC_DRAW);sd=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,sd);k.enableVertexAttribArray(b);k.vertexAttribPointer(b,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,16*g,k.DYNAMIC_DRAW);Ec=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Ec);k.enableVertexAttribArray(c);k.vertexAttribPointer(c,3,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,12*g,k.DYNAMIC_DRAW);Vd=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Vd);k.enableVertexAttribArray(f);k.vertexAttribPointer(f,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,
16*g,k.DYNAMIC_DRAW);k.bindVertexArray(null);qf=k.getUniformLocation(ra,"u_resolution");Ni=k.getUniformLocation(ra,"u_ambient");Wd=k.getUniformLocation(ra,"u_translation");td=k.getUniformLocation(ra,"zoom");Oi=k.getUniformLocation(ra,"now");rf=k.getUniformLocation(ra,"miniMap");c=k.getUniformLocation(ra,"zMax");k.uniform1f(c,n.zMax);k.uniform1i(rf,0);k.useProgram(ra);m.delay=[100,250,400,550,650,750,850,1E3,1150,5150,7650,10150,13650,17150,21150,25150,100,200,300,400,500,600,700,800,900,1E3,1100,
1200,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6500,7700,8900,10100,13600,17100,22100,8E3,8080,8160,8240,8320,8400,8480,100,200,300,400,500,600,700,800,900,1E3,1100,2400,3600,4800,6E3,7200,8400,11900,15400,20400,8E3,8077,8154,8231,8308,8385,8462,8539,8616,8693,8770,8847,8923,5E3,5072,5143,5215,5286,5358,5429,5501,5572,5644,5715,5787,5858,5929,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,3700,4900,7100,9600,12600,17100,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,
8833,8916,9E3,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,8833,8916,9E3,9080,5E3,5100,5200,5300,5400,5500,5600,5700,5850,6E3,70,140,210,280,350,420,490,560,630,700,770,840,910,980,4980,8980,12980,16980,20980,26980,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,4100,6300,8500,11E3,13500,17E3,20500,5E3,5100,5200,5300,5400,5500,5600,5700,5800,5900,6E3,125,230,335,431,546,606,666,731,857,952,1045,1139,1238,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,3300,
5800,8800,12E3,15500,5500,5600,5700,5800,5900,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6800,9800,12800,16300,19800,23800,28300,5E3,5100,5200,5300,5400,5500,5600,210,420,654,864,1074,1284,1494,108,244,380,516,652,788,924,1060,1196,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4100,6100,8100,11100,14100,17100,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5200,9E3,11E3,13800,17600,23400,7E3,7100,
7200,7300,7400,8200,8300,8400,8500,8600,9600,9700,9800,9900,1E4,80,160,210,360,610,1010,1510,100,200,300,400,500,3500,7500,13500,40,80,120,160,200,240,280,320,360,400,440,480,520,2520,3520,4520,5520,6520,8520,11520,107,214,321,428,535,642,749,856,963,1070,1177,1284,1391,1498,7323,13148,18973,24798,30623,36448,7E3,7170,7340,7510,7680,7980,8150,8320,8490,8660,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,6400,8900,11400,14900,18400,7E3,7200,7400,7600,7800,8E3,8200,125,250,375,500,
2E3,2125,2250,100,200,300,400,500,4E3,10500,100,200,300,400,500,600,700,800,900,8900,15900,21400,27400,33900,38900,44900,51900,800,1E3,1200,1400,1600,1800,2E3,2200,2400,2600,NaN,80,160,240,320,400,480,560,640,720,800,880,960,1040,5040,9040,12790,16540,19290,22040,25790,7671,7771,7871,7971,8071,8171,8271,100,200,300,400,500,600,700,800,900,1E3,1100,1200,6200,9700,13200,17200,21200,25200,29200,35200,100,200,300,400,500,600,9600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,11300,17300,
27300,37300,49300,64300,8E3,8228,8457,8685,8914,9142,9371,80,160,240,320,400,480,560,640,720,800,880,960,4960,8460,11460,14460,18460,22460,28460,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5400,8900,12900,16900,22900,28900,5E3,5143,5286,5429,5572,5715,5857,121,232,361,508,629,758,879,1018,1165,1425,1445,1465,1536,1692,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8300,11300,14800,18800,23300,29300,6E3,6171,6343,6514,6685,6857,7028,125,
250,375,500,625,750,875,1E3,1125,1250,1375,1500,6500,10500,13500,16500,19500,23E3,27E3,31500,8E3,8185,8370,8555,8740,8925,9108,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4300,7800,11300,15300,19300,23800,29800,1E4,10107,10214,10321,10428,10535,10643,10750,10857,10964,11071,11178,11285,11393,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4900,8400,12900,17400,22400,27400,
8E3,8250,8500,8750,9E3,9250,9500,9750,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,8300,11800,15800,19800,24300,29300,5E3,5157,5314,5471,5628,5785,5943,125,250,375,500,625,3125,3250,3375,100,200,300,400,500,600,4600,8600,14600,15600,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14400,18400,
22400,28400,180,360,540,720,900,1080,10080,100,200,350,500,600,700,800,950,1100,1250,1400,1550,1700,6200,8700,11700,15200,18700,22700,27700,6E3,6120,6240,6360,6480,6600,6720,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14900,18900,23400,29400,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,7400,10900,14900,19900,5E3,5100,5200,5300,5400,5500,5600,116,232,348,464,522,580,638,696,812,928,1044,1160,1276,1392,100,200,300,400,
500,600,700,800,900,1E3,1100,1200,5200,8700,11700,14700,18700,22700,28700,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,6900,10900,14400,18400,22400,27400,7E3,7100,7200,7300,7400,7500,7600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8600,10800,13E3,15500,19500,24E3,8E3,8100,8200,8300,8400,8500,8600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8800,12300,16300,20300,24300,29300,6E3,6100,6200,6300,6400,6500,6600,100,200,
300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1630,1730,1830,1930,2030,2130,2230,2330,5330,8330,11330,7E3,7150,7300,7450,7600,7750,7900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,5200,8700,12200,15700,20200,24700,29700,34700,8E3,8080,8163,8246,8330,8413,8496,8580,8663,8746,8830,8913,8996,9080,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,5599,5684,5770,5855,5941,6026,6112,125,250,375,500,625,
750,875,1E3,1125,1250,1375,1500,1625,5625,8625,11625,14625,18125,22125,26625,8E3,8185,8370,8555,8740,8925,9108,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,6100,10600,14600,18100,21600,26100,30600,35600,40600,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1700,6700,10700,11300,6E3,6200,6400,6600,6800,7E3,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,10400,100,
200,300,400,500,600,8600];c=m.delay;b=c.length;Z[m.expl_small_hole][1]=-b;for(e=p=0;14>p;p++)e+=66,c[p+b]=e;c.put(e+3E4);c=new Float32Array(c);tl();ul(new Float32Array([1,1,1,1]));k.uniform1f(td,1);k.uniform2fv(Wd,[0,0]);var J=k.createFramebuffer(),Xb;ud=function(){var c=window.innerWidth,b=window.innerHeight;tzar.width=c;tzar.height=b;k.useProgram(ya);k.uniform2f(Tg,c,b);k.useProgram(ra);J.width=c;J.height=b;k.activeTexture(k.TEXTURE2);Xb||(Xb=k.createTexture());k.bindTexture(k.TEXTURE_2D,Xb);k.texImage2D(k.TEXTURE_2D,
0,k.RGBA,c,b,0,k.RGBA,k.UNSIGNED_BYTE,null);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.bindFramebuffer(k.FRAMEBUFFER,J);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,Xb,0);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);k.bindFramebuffer(k.FRAMEBUFFER,null);V=1;k.uniform1f(td,
1/V);k.uniform1i(k.getUniformLocation(ra,"lightmap"),2);k.useProgram(ya);k.uniform1i(k.getUniformLocation(ya,"lightmap"),2);k.uniform1f(rd,1/V);k.useProgram(ra);k.uniform2f(qf,c,b);k.viewport(v.mx,0,c,b);ud.changed=1;wd(-Eb,-db)};ud.changed=0;window.addEventListener("resize",ud,!1);ud();k.blendEquation(k.FUNC_ADD);k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA);k.disable(k.DITHER);k.disable(k.BLEND);performance.now();tf&&(b=k.createTexture(),e=Y.info,k.bindTexture(k.TEXTURE_2D,b),k.texImage2D(k.TEXTURE_2D,
0,k.RGBA32F,512,512,0,k.RGBA,k.FLOAT,e),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.bindTexture(k.TEXTURE_2D,null),k.activeTexture(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,b),k.uniform1i(k.getUniformLocation(ra,"u_image1"),0),k.activeTexture(k.TEXTURE1),b=k.createTexture(),k.bindTexture(k.TEXTURE_2D_ARRAY,b),k.texParameteri(k.TEXTURE_2D_ARRAY,
k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D_ARRAY,k.TEXTURE_MIN_FILTER,k.NEAREST),e=performance.now(),k.texImage3D(k.TEXTURE_2D_ARRAY,0,k.RGBA,Y.size,Y.size,Y.common.length/(4*Y.size*Y.size),0,k.RGBA,k.UNSIGNED_BYTE,Y.common),O("3dtex",performance.now()-e),Y.common=void 0,k.activeTexture(k.TEXTURE1),k.bindTexture(k.TEXTURE_2D_ARRAY,b),k.uniform1i(k.getUniformLocation(ra,"img_common"),1),k.useProgram(ya),k.activeTexture(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D_ARRAY,b),k.uniform1i(k.getUniformLocation(ya,
"img_common"),0));Yc(1);Td||(k.activeTexture(k.TEXTURE3),b=k.createTexture(),k.bindTexture(k.TEXTURE_2D,b),k.texImage2D(k.TEXTURE_2D,0,k.R16F,c.length,1,0,k.RED,k.FLOAT,c),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.bindTexture(k.TEXTURE_2D,null),k.bindTexture(k.TEXTURE_2D,b),k.uniform1i(k.getUniformLocation(ra,
"delay"),3),k.activeTexture(k.TEXTURE2),Xg=k.createTexture(),k.bindTexture(k.TEXTURE_2D,Xg),k.texImage2D(k.TEXTURE_2D,0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.clearColor(0,0,0,1));k.bindFramebuffer(k.FRAMEBUFFER,J);J.width=1;J.height=
1;k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,Xb,0);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);k.bindFramebuffer(k.FRAMEBUFFER,null);new Float32Array(8);Yg=k.createBuffer();Zg=k.createBuffer();Pi=k.createBuffer();p=0;for(u=$g.length;p<u;p++)yb($g[p]);k.enable(k.DEPTH_TEST);k.depthFunc(k.LEQUAL);Ya.fp1000=1E3;Ya.delta=0;Ya.now=0;Ya.frameCount=0;k.bindTexture(k.TEXTURE_2D,Xb);Td=Y.setup=!0}function xd(c,b){ah();var e=b||xd,f=function(){e(c,b)};if(!Qi()){if("true"==localStorage.fullscreen){var g=
document.documentElement;g.requestFullscreen?g.requestFullscreen():g.msRequestFullscreen?g.msRequestFullscreen():g.mozRequestFullScreen?g.mozRequestFullScreen():g.webkitRequestFullscreen&&g.webkitRequestFullscreen()}n.editor?(v.marx=0,v.mary=60,t("saveGame").innerHTML=q.save,v.menumy=60,Rb=bc=171,v.mx=171,v.menumx=171):(v.mx=151,Rb=bc=128,v.menumx=151,v.menumy=0,t("saveGame").innerHTML=q.savegame,v.marx=4,v.mary=31);Zc.style.width=bc+"px";Zc.style.height=Rb+"px";Zc.style.left=v.marx+"px";Zc.style.top=
v.mary+"px";Sb();t("loading").style.display="block";origin=!1;void 0===n.arje&&Xd();if(uf.last!==n.terrainType)return Y.common=new Uint8Array(I.textureSize+uf[n.terrainType].size),t("qdgraphics")&&(t("qdgraphics").style.display="none"),vl(),t("loadingtext").innerHTML=q.waitImages,uf.last=n.terrainType,tf=!0,qc=f,!1;wl();t("notifybottom").style.display="none";t("loadingtext").innerHTML=q.loading;n.demo?t("saveGame").style.display="none":t("saveGame").style.display="block";if(n.custom){var d=0==n.cycle?
n.kingdomStart||n.kingdoms:n.kingdoms;f=0;for(g=d.length;f<g;f++){n.online&&ha[f]&&!ha[f].name&&(d[f].IA=!1);var l=new Tb("",d[f].color,[0],!0);Object.assign(l,d[f]);l.values.pop=0;null==l.resources[0]&&(l.resources[0]=Infinity);null==l.resources[1]&&(l.resources[1]=Infinity);null==l.resources[2]&&(l.resources[2]=Infinity);null==l.resources[3]&&(l.resources[3]=Infinity)}}else for(f=0,g=Aa.length;f<g;f++){d=Aa[f];l=[0];for(var p=0;p<g;p++)l[p+1]=Aa[p].team==d.team?0:1;n.online&&d.id===v.onlineID&&
(v.kingdom=f+1);new Tb(d.name,Ri(d.color),l,d.race,d.IA,[n.goldRes,n.woodRes,n.foodRes,n.stoneRes],d.team)}n.rules?xl(n.rules):Yd=void 0;v.kingdom||(v.kingdom=1);Si();return!0}}function Ti(){t("playingMenu").style.display="block";Sb()}function yl(c){O("setup:",c);c.toSend=[];c.orderList=[];var b=Va.roomName;b=b.substr(0,b.length-1);c.id==b&&(c.admin=!0);c.sendDirectly("channelMessage","nehhof",{});O(c.channels.channelMessage);c.channels.channelMessage.onopen=function(){Ra.put(c);Ea("attack");bh(1);
O("DATACHANNEL OPEN");setTimeout(function(){Q(Zd,vf(),0,[c]);v.admin&&(Q(wf,v.room.max,0,[c]),ia?Ui(ia.compressed):Q($c,n,!1),ha.put(c.id),Q(eb,ha,0))},500)};c.channels.channelMessage.onerror=function(c){O(c)}}function Vi(){document.getElementById("buttons").innerHTML="";document.getElementById("gameName").innerHTML=""}function ch(){v.p2p?(Ma(),v.p2p.emit("getRooms"),t("returnmenu").style.display="block"):(Va||rc(),rc.func=ch)}function Wi(){var c=location,b=c.hash.substr(1);""==b&&(document.getElementById("returnmenu").style.display=
"none");if("MatchX"==b.substr(0,6))6<b.length&&zl(b.substr(6-b.length));else if("Room"==c.hash.substr(-4))c=c.hash.substr(1),v.admin||Xi(c.substr(0,c.length-4));else if(Yi[b])Yi[b]();else c.hash=""}function Zi(c){c=document.getElementById(c);c.style.display="none"==c.style.display?"block":"none"}function dh(c){c.style.display="none"==c.style.display?"block":"none"}function $i(c){W=function(){};Jb=!1;var b=C;b.d=c.d;na(b,c.img);b.active=!0;zb=y[52];$d=c;document.addEventListener("mousemove",eh);document.addEventListener("mousedown",
xf)}function Al(c,b){return c.innerHTML-b.innerHTML}var Dl=function(){(function(c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define([],c):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).SimpleWebRTC=c()})(function(){return function g(b,e,f){function d(h,p){if(!e[h]){if(!b[h]){var u="function"==typeof require&&require;if(!p&&u)return u(h,!0);if(l)return l(h,!0);p=Error("Cannot find module '"+
h+"'");throw p.code="MODULE_NOT_FOUND",p;}p=e[h]={exports:{}};b[h][0].call(p.exports,function(f){var e=b[h][1][f];return d(e?e:f)},p,p.exports,g,b,e,f)}return e[h].exports}for(var l="function"==typeof require&&require,p=0;p<f.length;p++)d(f[p]);return d}({1:[function(b,e,f){function g(){}e.exports=function(b,f,e){function d(b,g){if(0>=d.count)throw Error("after called too many times");--d.count;b?(h=!0,f(b),f=e):0!==d.count||h||f(null,g)}var h=!1;e=e||g;d.count=b;return 0===b?f():d}},{}],2:[function(b,
e,f){e.exports=function(b,f,e){var g=b.byteLength;f=f||0;e=e||g;if(b.slice)return b.slice(f,e);0>f&&(f+=g);0>e&&(e+=g);e>g&&(e=g);if(f>=g||f>=e||0===g)return new ArrayBuffer(0);b=new Uint8Array(b);g=new Uint8Array(e-f);for(var d=0;f<e;f++,d++)g[d]=b[f];return g.buffer}},{}],3:[function(b,e,f){e.exports=function(b,f,e){var g,d=f;f={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};if(e)for(g in e)f[g]=e[g];d?"audio"===d.tagName.toLowerCase()&&(f.audio=!0):d=document.createElement(f.audio?
"audio":"video");f.disableContextMenu&&(d.oncontextmenu=function(b){b.preventDefault()});f.autoplay&&(d.autoplay="autoplay");f.muted&&(d.muted=!0);!f.audio&&f.mirror&&["","moz","webkit","o","ms"].forEach(function(b){d.style[b?b+"Transform":"transform"]="scaleX(-1)"});d.srcObject=b;return d}},{}],4:[function(b,e,f){function g(b){b=b||{};this.ms=b.min||100;this.max=b.max||1E4;this.factor=b.factor||2;this.jitter=0<b.jitter&&1>=b.jitter?b.jitter:0;this.attempts=0}e.exports=g;g.prototype.duration=function(){var b=
this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var f=Math.random(),e=Math.floor(f*this.jitter*b);b=0==(Math.floor(10*f)&1)?b-e:b+e}return Math.min(b,this.max)|0};g.prototype.reset=function(){this.attempts=0};g.prototype.setMin=function(b){this.ms=b};g.prototype.setMax=function(b){this.max=b};g.prototype.setJitter=function(b){this.jitter=b}},{}],5:[function(b,e,f){(function(b){f.encode=function(f){f=new Uint8Array(f);var e,g=f.length,d="";for(e=0;e<g;e+=3)d+=b[f[e]>>2],d+=b[(f[e]&3)<<
4|f[e+1]>>4],d+=b[(f[e+1]&15)<<2|f[e+2]>>6],d+=b[f[e+2]&63];2===g%3?d=d.substring(0,d.length-1)+"=":1===g%3&&(d=d.substring(0,d.length-2)+"==");return d};f.decode=function(f){var e=.75*f.length,g=f.length,d=0;"="===f[f.length-1]&&(e--,"="===f[f.length-2]&&e--);var h=new ArrayBuffer(e),D=new Uint8Array(h);for(e=0;e<g;e+=4){var r=b.indexOf(f[e]);var U=b.indexOf(f[e+1]);var J=b.indexOf(f[e+2]);var Xb=b.indexOf(f[e+3]);D[d++]=r<<2|U>>4;D[d++]=(U&15)<<4|J>>2;D[d++]=(J&3)<<6|Xb&63}return h}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},
{}],6:[function(b,e,f){(function(b){function f(b){for(var f=0;f<b.length;f++){var e=b[f];if(e.buffer instanceof ArrayBuffer){var g=e.buffer;if(e.byteLength!==g.byteLength){var d=new Uint8Array(e.byteLength);d.set(new Uint8Array(g,e.byteOffset,e.byteLength));g=d.buffer}b[f]=g}}}function g(b,e){e=e||{};var g=new u;f(b);for(var d=0;d<b.length;d++)g.append(b[d]);return e.type?g.getBlob(e.type):g.getBlob()}function d(b,e){f(b);return new Blob(b,e||{})}var u=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||
b.MozBlobBuilder;try{var E=2===(new Blob(["hi"])).size}catch(U){E=!1}var D;if(D=E)try{D=2===(new Blob([new Uint8Array([1,2])])).size}catch(U){D=!1}var r=u&&u.prototype.append&&u.prototype.getBlob;b=E?D?b.Blob:d:r?g:void 0;e.exports=b}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],7:[function(b,e,f){var g=[].slice;e.exports=function(b,f){"string"==typeof f&&(f=b[f]);if("function"!=typeof f)throw Error("bind() requires a function");
var e=g.call(arguments,2);return function(){return f.apply(b,e.concat(g.call(arguments)))}}},{}],8:[function(b,e,f){function g(b){if(b){for(var f in g.prototype)b[f]=g.prototype[f];return b}}e.exports=g;g.prototype.on=g.prototype.addEventListener=function(b,f){this._callbacks=this._callbacks||{};(this._callbacks[b]=this._callbacks[b]||[]).push(f);return this};g.prototype.once=function(b,f){function e(){g.off(b,e);f.apply(this,arguments)}var g=this;this._callbacks=this._callbacks||{};e.fn=f;this.on(b,
e);return this};g.prototype.off=g.prototype.removeListener=g.prototype.removeAllListeners=g.prototype.removeEventListener=function(b,f){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var e=this._callbacks[b];if(!e)return this;if(1==arguments.length)return delete this._callbacks[b],this;for(var g,d=0;d<e.length;d++)if(g=e[d],g===f||g.fn===f){e.splice(d,1);break}return this};g.prototype.emit=function(b){this._callbacks=this._callbacks||{};var f=[].slice.call(arguments,
1),e=this._callbacks[b];if(e){e=e.slice(0);for(var g=0,d=e.length;g<d;++g)e[g].apply(this,f)}return this};g.prototype.listeners=function(b){this._callbacks=this._callbacks||{};return this._callbacks[b]||[]};g.prototype.hasListeners=function(b){return!!this.listeners(b).length}},{}],9:[function(b,e,f){e.exports=function(b,f){var e=function(){};e.prototype=f.prototype;b.prototype=new e;b.prototype.constructor=b}},{}],10:[function(b,e,f){function g(b){return g.enabled(b)?function(f){f instanceof Error&&
(f=f.stack||f.message);var e=new Date,d=e-(g[b]||e);g[b]=e;f=b+" "+f+" +"+g.humanize(d);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}e.exports=g;g.names=[];g.skips=[];g.enable=function(b){try{localStorage.debug=b}catch(E){}for(var f=(b||"").split(/[\s,]+/),e=f.length,d=0;d<e;d++)b=f[d].replace("*",".*?"),"-"===b[0]?g.skips.push(new RegExp("^"+b.substr(1)+"$")):g.names.push(new RegExp("^"+b+"$"))};g.disable=function(){g.enable("")};g.humanize=
function(b){return 36E5<=b?(b/36E5).toFixed(1)+"h":6E4<=b?(b/6E4).toFixed(1)+"m":1E3<=b?(b/1E3|0)+"s":b+"ms"};g.enabled=function(b){for(var f=0,e=g.skips.length;f<e;f++)if(g.skips[f].test(b))return!1;f=0;for(e=g.names.length;f<e;f++)if(g.names[f].test(b))return!0;return!1};try{window.localStorage&&g.enable(localStorage.debug)}catch(h){}},{}],11:[function(b,e,f){e.exports=b("./lib/")},{"./lib/":12}],12:[function(b,e,f){e.exports=b("./socket");e.exports.parser=b("engine.io-parser")},{"./socket":13,
"engine.io-parser":24}],13:[function(b,e,f){(function(f){function g(b,e){if(!(this instanceof g))return new g(b,e);e=e||{};b&&"object"==typeof b&&(e=b,b=null);b&&(b=r(b),e.host=b.host,e.secure="https"==b.protocol||"wss"==b.protocol,e.port=b.port,b.query&&(e.query=b.query));this.secure=null!=e.secure?e.secure:f.location&&"https:"==location.protocol;e.host&&(b=e.host.split(":"),e.hostname=b.shift(),b.length?e.port=b.pop():e.port||(e.port=this.secure?"443":"80"));this.agent=e.agent||!1;this.hostname=
e.hostname||(f.location?location.hostname:"localhost");this.port=e.port||(f.location&&location.port?location.port:this.secure?443:80);this.query=e.query||{};"string"==typeof this.query&&(this.query=J.decode(this.query));this.upgrade=!1!==e.upgrade;this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!e.forceJSONP;this.jsonp=!1!==e.jsonp;this.forceBase64=!!e.forceBase64;this.enablesXDR=!!e.enablesXDR;this.timestampParam=e.timestampParam||"t";this.timestampRequests=e.timestampRequests;
this.transports=e.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=e.policyPort||843;this.rememberUpgrade=e.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=e.onlyBinaryUpgrades;this.pfx=e.pfx||null;this.key=e.key||null;this.passphrase=e.passphrase||null;this.cert=e.cert||null;this.ca=e.ca||null;this.ciphers=e.ciphers||null;this.rejectUnauthorized=e.rejectUnauthorized||null;this.open()}var d=b("./transports"),p=b("component-emitter"),
u=b("debug")("engine.io-client:socket"),E=b("indexof"),D=b("engine.io-parser"),r=b("parseuri"),U=b("parsejson"),J=b("parseqs");e.exports=g;g.priorWebsocketSuccess=!1;p(g.prototype);g.protocol=D.protocol;g.Socket=g;g.Transport=b("./transport");g.transports=b("./transports");g.parser=b("engine.io-parser");g.prototype.createTransport=function(b){u('creating transport "%s"',b);var e=this.query,f={},g;for(g in e)e.hasOwnProperty(g)&&(f[g]=e[g]);f.EIO=D.protocol;f.transport=b;this.id&&(f.sid=this.id);return new d[b]({agent:this.agent,
hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:f,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})};g.prototype.open=function(){if(this.rememberUpgrade&&g.priorWebsocketSuccess&&
-1!=this.transports.indexOf("websocket"))var b="websocket";else{if(0==this.transports.length){var e=this;setTimeout(function(){e.emit("error","No transports available")},0);return}b=this.transports[0]}this.readyState="opening";try{b=this.createTransport(b)}catch(vd){this.transports.shift();this.open();return}b.open();this.setTransport(b)};g.prototype.setTransport=function(b){u("setting transport %s",b.name);var e=this;this.transport&&(u("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());
this.transport=b;b.on("drain",function(){e.onDrain()}).on("packet",function(b){e.onPacket(b)}).on("error",function(b){e.onError(b)}).on("close",function(){e.onClose("transport close")})};g.prototype.probe=function(b){function e(){if(J.onlyBinaryUpgrades){var e=!this.supportsBinary&&J.transport.supportsBinary;E=E||e}E||(u('probe transport "%s" opened',b),r.send([{type:"ping",data:"probe"}]),r.once("packet",function(e){E||("pong"==e.type&&"probe"==e.data?(u('probe transport "%s" pong',b),J.upgrading=
!0,J.emit("upgrading",r),r&&(g.priorWebsocketSuccess="websocket"==r.name,u('pausing current transport "%s"',J.transport.name),J.transport.pause(function(){E||"closed"==J.readyState||(u("changing transport and sending upgrade packet"),D(),J.setTransport(r),r.send([{type:"upgrade"}]),J.emit("upgrade",r),r=null,J.upgrading=!1,J.flush())}))):(u('probe transport "%s" failed',b),e=Error("probe error"),e.transport=r.name,J.emit("upgradeError",e)))}))}function f(){E||(E=!0,D(),r.close(),r=null)}function d(e){var g=
Error("probe error: "+e);g.transport=r.name;f();u('probe transport "%s" failed because of error: %s',b,e);J.emit("upgradeError",g)}function h(){d("transport closed")}function l(){d("socket closed")}function p(b){r&&b.name!=r.name&&(u('"%s" works - aborting "%s"',b.name,r.name),f())}function D(){r.removeListener("open",e);r.removeListener("error",d);r.removeListener("close",h);J.removeListener("close",l);J.removeListener("upgrading",p)}u('probing transport "%s"',b);var r=this.createTransport(b,{probe:1}),
E=!1,J=this;g.priorWebsocketSuccess=!1;r.once("open",e);r.once("error",d);r.once("close",h);this.once("close",l);this.once("upgrading",p);r.open()};g.prototype.onOpen=function(){u("socket open");this.readyState="open";g.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var b=0,e=this.upgrades.length;b<e;b++)this.probe(this.upgrades[b])}};g.prototype.onPacket=function(b){if("opening"==
this.readyState||"open"==this.readyState)switch(u('socket receive: type "%s", data "%s"',b.type,b.data),this.emit("packet",b),this.emit("heartbeat"),b.type){case "open":this.onHandshake(U(b.data));break;case "pong":this.setPing();break;case "error":var e=Error("server error");e.code=b.data;this.emit("error",e);break;case "message":this.emit("data",b.data),this.emit("message",b.data)}else u('packet received with socket readyState "%s"',this.readyState)};g.prototype.onHandshake=function(b){this.emit("handshake",
b);this.id=b.sid;this.transport.query.sid=b.sid;this.upgrades=this.filterUpgrades(b.upgrades);this.pingInterval=b.pingInterval;this.pingTimeout=b.pingTimeout;this.onOpen();"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};g.prototype.onHeartbeat=function(b){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){if("closed"!=e.readyState)e.onClose("ping timeout")},b||e.pingInterval+e.pingTimeout)};
g.prototype.setPing=function(){var b=this;clearTimeout(b.pingIntervalTimer);b.pingIntervalTimer=setTimeout(function(){u("writing ping packet - expecting pong within %sms",b.pingTimeout);b.ping();b.onHeartbeat(b.pingTimeout)},b.pingInterval)};g.prototype.ping=function(){this.sendPacket("ping")};g.prototype.onDrain=function(){for(var b=0;b<this.prevBufferLen;b++)if(this.callbackBuffer[b])this.callbackBuffer[b]();this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);
this.prevBufferLen=0;0==this.writeBuffer.length?this.emit("drain"):this.flush()};g.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(u("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};g.prototype.write=g.prototype.send=function(b,e){this.sendPacket("message",b,e);return this};g.prototype.sendPacket=function(b,e,f){"closing"!=
this.readyState&&"closed"!=this.readyState&&(b={type:b,data:e},this.emit("packetCreate",b),this.writeBuffer.push(b),this.callbackBuffer.push(f),this.flush())};g.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){var b=function(){g.once("upgrade",e);g.once("upgradeError",e)},e=function(){g.removeListener("upgrade",e);g.removeListener("upgradeError",e);f()},f=function(){g.onClose("forced close");u("socket closing - telling transport to close");g.transport.close()};this.readyState=
"closing";var g=this;if(this.writeBuffer.length)this.once("drain",function(){this.upgrading?b():f()});else this.upgrading?b():f()}return this};g.prototype.onError=function(b){u("socket error %j",b);g.priorWebsocketSuccess=!1;this.emit("error",b);this.onClose("transport error",b)};g.prototype.onClose=function(b,e){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){u('socket close with reason: "%s"',b);var f=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);
setTimeout(function(){f.writeBuffer=[];f.callbackBuffer=[];f.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",b,e)}};g.prototype.filterUpgrades=function(b){for(var e=[],f=0,g=b.length;f<g;f++)~E(this.transports,b[f])&&e.push(b[f]);return e}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./transport":14,
"./transports":15,"component-emitter":8,debug:21,"engine.io-parser":24,indexof:32,parsejson:40,parseqs:41,parseuri:23}],14:[function(b,e,f){function g(b){this.path=b.path;this.hostname=b.hostname;this.port=b.port;this.secure=b.secure;this.query=b.query;this.timestampParam=b.timestampParam;this.timestampRequests=b.timestampRequests;this.readyState="";this.agent=b.agent||!1;this.socket=b.socket;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;
this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized}var d=b("engine.io-parser");b=b("component-emitter");e.exports=g;b(g.prototype);g.timestamps=0;g.prototype.onError=function(b,e){b=Error(b);b.type="TransportError";b.description=e;this.emit("error",b);return this};g.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this};g.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),
this.onClose();return this};g.prototype.send=function(b){if("open"==this.readyState)this.write(b);else throw Error("Transport not open");};g.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};g.prototype.onData=function(b){b=d.decodePacket(b,this.socket.binaryType);this.onPacket(b)};g.prototype.onPacket=function(b){this.emit("packet",b)};g.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,"engine.io-parser":24}],15:[function(b,
e,f){(function(e){var g=b("xmlhttprequest"),d=b("./polling-xhr"),p=b("./polling-jsonp"),u=b("./websocket");f.polling=function(b){var f=!1,h=!1,l=!1!==b.jsonp;e.location&&(h="https:"==location.protocol,(f=location.port)||(f=h?443:80),f=b.hostname!=location.hostname||f!=b.port,h=b.secure!=h);b.xdomain=f;b.xscheme=h;if("open"in new g(b)&&!b.forceJSONP)return new d(b);if(!l)throw Error("JSONP disabled");return new p(b)};f.websocket=u}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(b,e,f){(function(f){function g(){}function d(b){p.call(this,b);this.query=this.query||{};r||(f.___eio||(f.___eio=[]),r=f.___eio);this.index=r.length;var e=this;r.push(function(b){e.onData(b)});this.query.j=this.index;f.document&&f.addEventListener&&f.addEventListener("beforeunload",function(){e.script&&(e.script.onerror=g)},!1)}var p=b("./polling"),u=b("component-inherit");
e.exports=d;var E=/\n/g,D=/\\n/g,r;u(d,p);d.prototype.supportsBinary=!1;d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.iframe=this.form=null);p.prototype.doClose.call(this)};d.prototype.doPoll=function(){var b=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);e.async=!0;e.src=this.uri();e.onerror=function(e){b.onError("jsonp poll error",
e)};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(e,f);this.script=e;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var b=document.createElement("iframe");document.body.appendChild(b);document.body.removeChild(b)},100)};d.prototype.doWrite=function(b,e){function f(){g();e()}function g(){if(d.iframe)try{d.form.removeChild(d.iframe)}catch(gh){d.onError("jsonp polling iframe removal error",gh)}try{u=document.createElement('<iframe src="javascript:0" name="'+
d.iframeId+'">')}catch(gh){u=document.createElement("iframe"),u.name=d.iframeId,u.src="javascript:0"}u.id=d.iframeId;d.form.appendChild(u);d.iframe=u}var d=this;if(!this.form){var h=document.createElement("form"),l=document.createElement("textarea"),p=this.iframeId="eio_iframe_"+this.index,u;h.className="socketio";h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=p;h.method="POST";h.setAttribute("accept-charset","utf-8");l.name="d";h.appendChild(l);document.body.appendChild(h);
this.form=h;this.area=l}this.form.action=this.uri();g();b=b.replace(D,"\\\n");this.area.value=b.replace(E,"\\n");try{this.form.submit()}catch(gh){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==d.iframe.readyState&&f()}:this.iframe.onload=f}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-inherit":9}],17:[function(b,e,f){(function(f){function g(){}function d(b){D.call(this,
b);if(f.location){var e="https:"==location.protocol,g=location.port;g||(g=e?443:80);this.xd=b.hostname!=f.location.hostname||g!=b.port;this.xs=b.secure!=e}}function p(b){this.method=b.method||"GET";this.uri=b.uri;this.xd=!!b.xd;this.xs=!!b.xs;this.async=!1!==b.async;this.data=void 0!=b.data?b.data:null;this.agent=b.agent;this.isBinary=b.isBinary;this.supportsBinary=b.supportsBinary;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;
this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized;this.create()}function u(){for(var b in p.requests)p.requests.hasOwnProperty(b)&&p.requests[b].abort()}var E=b("xmlhttprequest"),D=b("./polling"),r=b("component-emitter"),U=b("component-inherit"),J=b("debug")("engine.io-client:polling-xhr");e.exports=d;e.exports.Request=p;U(d,D);d.prototype.supportsBinary=!0;d.prototype.request=function(b){b=b||{};b.uri=this.uri();b.xd=this.xd;b.xs=this.xs;b.agent=this.agent||!1;b.supportsBinary=
this.supportsBinary;b.enablesXDR=this.enablesXDR;b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;return new p(b)};d.prototype.doWrite=function(b,e){b=this.request({method:"POST",data:b,isBinary:"string"!==typeof b&&void 0!==b});var f=this;b.on("success",e);b.on("error",function(b){f.onError("xhr post error",b)});this.sendXhr=b};d.prototype.doPoll=function(){J("xhr poll");var b=this.request(),
e=this;b.on("data",function(b){e.onData(b)});b.on("error",function(b){e.onError("xhr poll error",b)});this.pollXhr=b};r(p.prototype);p.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new E(b),g=this;try{J("xhr open %s: %s",this.method,this.uri);e.open(this.method,this.uri,
this.async);this.supportsBinary&&(e.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(fh){}"withCredentials"in e&&(e.withCredentials=!0);this.hasXDR()?(e.onload=function(){g.onLoad()},e.onerror=function(){g.onError(e.responseText)}):e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status||1223==e.status)g.onLoad();else setTimeout(function(){g.onError(e.status)},
0)};J("xhr data %s",this.data);e.send(this.data)}catch(fh){setTimeout(function(){g.onError(fh)},0);return}f.document&&(this.index=p.requestsCount++,p.requests[this.index]=this)};p.prototype.onSuccess=function(){this.emit("success");this.cleanup()};p.prototype.onData=function(b){this.emit("data",b);this.onSuccess()};p.prototype.onError=function(b){this.emit("error",b);this.cleanup(!0)};p.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=this.xhr.onerror=
g:this.xhr.onreadystatechange=g;if(b)try{this.xhr.abort()}catch(sf){}f.document&&delete p.requests[this.index];this.xhr=null}};p.prototype.onLoad=function(){try{try{var b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(vd){}var e="application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(vd){this.onError(vd)}if(null!=e)this.onData(e)};p.prototype.hasXDR=function(){return"undefined"!==typeof f.XDomainRequest&&!this.xs&&this.enablesXDR};p.prototype.abort=
function(){this.cleanup()};f.document&&(p.requestsCount=0,p.requests={},f.attachEvent?f.attachEvent("onunload",u):f.addEventListener&&f.addEventListener("beforeunload",u,!1))}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-emitter":8,"component-inherit":9,debug:21,xmlhttprequest:20}],18:[function(b,e,f){function g(b){var e=b&&b.forceBase64;if(!E||e)this.supportsBinary=!1;d.call(this,b)}var d=b("../transport"),
l=b("parseqs"),p=b("engine.io-parser");f=b("component-inherit");var u=b("debug")("engine.io-client:polling");e.exports=g;var E=null!=(new (b("xmlhttprequest"))({xdomain:!1})).responseType;f(g,d);g.prototype.name="polling";g.prototype.doOpen=function(){this.poll()};g.prototype.pause=function(b){function e(){u("paused");f.readyState="paused";b()}var f=this;this.readyState="pausing";if(this.polling||!this.writable){var g=0;this.polling&&(u("we are currently polling - waiting to pause"),g++,this.once("pollComplete",
function(){u("pre-pause polling complete");--g||e()}));this.writable||(u("we are currently writing - waiting to pause"),g++,this.once("drain",function(){u("pre-pause writing complete");--g||e()}))}else e()};g.prototype.poll=function(){u("polling");this.polling=!0;this.doPoll();this.emit("poll")};g.prototype.onData=function(b){var e=this;u("polling got data %s",b);p.decodePayload(b,this.socket.binaryType,function(b,f,g){if("opening"==e.readyState)e.onOpen();if("close"==b.type)return e.onClose(),!1;
e.onPacket(b)});"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))};g.prototype.doClose=function(){function b(){u("writing close packet");e.write([{type:"close"}])}var e=this;"open"==this.readyState?(u("transport open - closing"),b()):(u("transport not open - deferring close"),this.once("open",b))};g.prototype.write=function(b){var e=this;this.writable=!1;var f=function(){e.writable=!0;
e.emit("drain")};e=this;p.encodePayload(b,this.supportsBinary,function(b){e.doWrite(b,f)})};g.prototype.uri=function(){var b=this.query||{},e=this.secure?"https":"http",f="";!1!==this.timestampRequests&&(b[this.timestampParam]=+new Date+"-"+d.timestamps++);this.supportsBinary||b.sid||(b.b64=1);b=l.encode(b);this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(f=":"+this.port);b.length&&(b="?"+b);return e+"://"+this.hostname+f+this.path+b}},{"../transport":14,"component-inherit":9,debug:21,
"engine.io-parser":24,parseqs:41,xmlhttprequest:20}],19:[function(b,e,f){function g(b){b&&b.forceBase64&&(this.supportsBinary=!1);d.call(this,b)}var d=b("../transport"),l=b("engine.io-parser"),p=b("parseqs");f=b("component-inherit");var u=b("debug")("engine.io-client:websocket"),E=b("ws");e.exports=g;f(g,d);g.prototype.name="websocket";g.prototype.supportsBinary=!0;g.prototype.doOpen=function(){if(this.check()){var b=this.uri(),e={agent:this.agent};e.pfx=this.pfx;e.key=this.key;e.passphrase=this.passphrase;
e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;this.ws=new E(b,void 0,e);void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.binaryType="arraybuffer";this.addEventListeners()}};g.prototype.addEventListeners=function(){var b=this;this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(){b.onClose()};this.ws.onmessage=function(e){b.onData(e.data)};this.ws.onerror=function(e){b.onError("websocket error",e)}};"undefined"!=typeof navigator&&
/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(g.prototype.onData=function(b){var e=this;setTimeout(function(){d.prototype.onData.call(e,b)},0)});g.prototype.write=function(b){var e=this;this.writable=!1;for(var f=0,g=b.length;f<g;f++)l.encodePacket(b[f],this.supportsBinary,function(b){try{e.ws.send(b)}catch(sf){u("websocket closed before onclose event")}});setTimeout(function(){e.writable=!0;e.emit("drain")},0)};g.prototype.onClose=function(){d.prototype.onClose.call(this)};g.prototype.doClose=
function(){"undefined"!==typeof this.ws&&this.ws.close()};g.prototype.uri=function(){var b=this.query||{},e=this.secure?"wss":"ws",f="";this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(f=":"+this.port);this.timestampRequests&&(b[this.timestampParam]=+new Date);this.supportsBinary||(b.b64=1);b=p.encode(b);b.length&&(b="?"+b);return e+"://"+this.hostname+f+this.path+b};g.prototype.check=function(){return!!E&&!("__initialize"in E&&this.name===g.prototype.name)}},{"../transport":14,"component-inherit":9,
debug:21,"engine.io-parser":24,parseqs:41,ws:66}],20:[function(b,e,f){var g=b("has-cors");e.exports=function(b){var e=b.xdomain,f=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||g))return new XMLHttpRequest}catch(u){}try{if("undefined"!=typeof XDomainRequest&&!f&&b)return new XDomainRequest}catch(u){}if(!e)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(u){}}},{"has-cors":31}],21:[function(b,e,f){function g(){try{var b=localStorage.debug}catch(l){}return b}f=e.exports=
b("./debug");f.log=function(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)};f.formatArgs=function(){var b=arguments,e=this.useColors;b[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+b[0]+(e?"%c ":" ")+"+"+f.humanize(this.diff);if(!e)return b;e="color: "+this.color;b=[b[0],e,"color: inherit"].concat(Array.prototype.slice.call(b,1));var g=0,d=0;b[0].replace(/%[a-z%]/g,function(b){"%%"!==b&&(g++,"%c"===b&&(d=g))});b.splice(d,
0,e);return b};f.save=function(b){try{null==b?localStorage.removeItem("debug"):localStorage.debug=b}catch(l){}};f.load=g;f.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)};f.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");f.formatters.j=function(b){return JSON.stringify(b)};f.enable(g())},
{"./debug":22}],22:[function(b,e,f){f=e.exports=function(b){function e(){}function h(){var b=+new Date;h.diff=b-(d||b);h.prev=d;d=h.curr=b;null==h.useColors&&(h.useColors=f.useColors());null==h.color&&h.useColors&&(h.color=f.colors[g++%f.colors.length]);var e=Array.prototype.slice.call(arguments);e[0]=f.coerce(e[0]);"string"!==typeof e[0]&&(e=["%o"].concat(e));var l=0;e[0]=e[0].replace(/%([a-z%])/g,function(b,g){if("%%"===b)return b;l++;g=f.formatters[g];"function"===typeof g&&(b=g.call(h,e[l]),e.splice(l,
1),l--);return b});"function"===typeof f.formatArgs&&(e=f.formatArgs.apply(h,e));(h.log||f.log||console.log.bind(console)).apply(h,e)}e.enabled=!1;h.enabled=!0;var l=f.enabled(b)?h:e;l.namespace=b;return l};f.coerce=function(b){return b instanceof Error?b.stack||b.message:b};f.disable=function(){f.enable("")};f.enable=function(b){f.save(b);for(var e=(b||"").split(/[\s,]+/),g=e.length,d=0;d<g;d++)e[d]&&(b=e[d].replace(/\*/g,".*?"),"-"===b[0]?f.skips.push(new RegExp("^"+b.substr(1)+"$")):f.names.push(new RegExp("^"+
b+"$")))};f.enabled=function(b){var e;var g=0;for(e=f.skips.length;g<e;g++)if(f.skips[g].test(b))return!1;g=0;for(e=f.names.length;g<e;g++)if(f.names[g].test(b))return!0;return!1};f.humanize=b("ms");f.names=[];f.skips=[];f.formatters={};var g=0,d},{ms:38}],23:[function(b,e,f){var g=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
d="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");e.exports=function(b){var e=b,f=b.indexOf("["),h=b.indexOf("]");-1!=f&&-1!=h&&(b=b.substring(0,f)+b.substring(f,h).replace(/:/g,";")+b.substring(h,b.length));b=g.exec(b||"");for(var l={},r=14;r--;)l[d[r]]=b[r]||"";-1!=f&&-1!=h&&(l.source=e,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=
!0);return l}},{}],24:[function(b,e,f){(function(e){function g(b,e,g){if(!e)return f.encodeBase64Packet(b,g);var d=new FileReader;d.onload=function(){b.data=d.result;f.encodePacket(b,e,!0,g)};return d.readAsArrayBuffer(b.data)}function d(b,e,f){var g=Array(b.length);f=r(b.length,f);for(var d=function(b,f,d){e(f,function(e,f){g[b]=f;d(e,g)})},h=0;h<b.length;h++)d(h,b[h],f)}var p=b("./keys"),u=b("has-binary"),E=b("arraybuffer.slice"),D=b("base64-arraybuffer"),r=b("after"),U=b("utf8"),J=navigator.userAgent.match(/Android/i),
k=/PhantomJS/i.test(navigator.userAgent),m=J||k;f.protocol=3;var n=f.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},q=p(n),ja={type:"error",data:"parser error"},t=b("blob");f.encodePacket=function(b,d,h,l){"function"==typeof d&&(l=d,d=!1);"function"==typeof h&&(l=h,h=null);var p=void 0===b.data?void 0:b.data.buffer||b.data;if(e.ArrayBuffer&&p instanceof ArrayBuffer){if(d){h=b.data;d=new Uint8Array(h);h=new Uint8Array(1+h.byteLength);h[0]=n[b.type];for(b=0;b<d.length;b++)h[b+1]=
d[b];b=l(h.buffer)}else b=f.encodeBase64Packet(b,l);return b}if(t&&p instanceof e.Blob)return d?m?b=g(b,d,l):(d=new Uint8Array(1),d[0]=n[b.type],b=new t([d.buffer,b.data]),b=l(b)):b=f.encodeBase64Packet(b,l),b;if(p&&p.base64)return l("b"+f.packets[b.type]+b.data.data);d=n[b.type];void 0!==b.data&&(d+=h?U.encode(String(b.data)):String(b.data));return l(""+d)};f.encodeBase64Packet=function(b,d){var g="b"+f.packets[b.type];if(t&&b.data instanceof t){var h=new FileReader;h.onload=function(){var b=h.result.split(",")[1];
d(g+b)};return h.readAsDataURL(b.data)}try{var l=String.fromCharCode.apply(null,new Uint8Array(b.data))}catch(dn){b=new Uint8Array(b.data);l=Array(b.length);for(var p=0;p<b.length;p++)l[p]=b[p];l=String.fromCharCode.apply(null,l)}g+=e.btoa(l);return d(g)};f.decodePacket=function(b,e,d){if("string"==typeof b||void 0===b){if("b"==b.charAt(0))return f.decodeBase64Packet(b.substr(1),e);if(d)try{b=U.decode(b)}catch(cn){return ja}d=b.charAt(0);return Number(d)==d&&q[d]?1<b.length?{type:q[d],data:b.substring(1)}:
{type:q[d]}:ja}d=(new Uint8Array(b))[0];b=E(b,1);t&&"blob"===e&&(b=new t([b]));return{type:q[d],data:b}};f.decodeBase64Packet=function(b,f){var d=q[b.charAt(0)];if(!e.ArrayBuffer)return{type:d,data:{base64:!0,data:b.substr(1)}};b=D.decode(b.substr(1));"blob"===f&&t&&(b=new t([b]));return{type:d,data:b}};f.encodePayload=function(b,e,g){"function"==typeof e&&(g=e,e=null);var h=u(b);if(e&&h)return t&&!m?f.encodePayloadAsBlob(b,g):f.encodePayloadAsArrayBuffer(b,g);if(!b.length)return g("0:");d(b,function(b,
d){f.encodePacket(b,h?e:!1,!0,function(b){d(null,b.length+":"+b)})},function(b,e){return g(e.join(""))})};f.decodePayload=function(b,e,d){if("string"!=typeof b)return f.decodePayloadAsBinary(b,e,d);"function"===typeof e&&(d=e,e=null);if(""==b)return d(ja,0,1);var g="";for(var h,l,p=0,u=b.length;p<u;p++)if(l=b.charAt(p),":"!=l)g+=l;else{if(""==g||g!=(h=Number(g)))return d(ja,0,1);l=b.substr(p+1,h);if(g!=l.length)return d(ja,0,1);if(l.length){g=f.decodePacket(l,e,!0);if(ja.type==g.type&&ja.data==g.data)return d(ja,
0,1);if(!1===d(g,p+h,u))return}p+=h;g=""}if(""!=g)return d(ja,0,1)};f.encodePayloadAsArrayBuffer=function(b,e){if(!b.length)return e(new ArrayBuffer(0));d(b,function(b,e){f.encodePacket(b,!0,!0,function(b){return e(null,b)})},function(b,f){b=f.reduce(function(b,e){e="string"===typeof e?e.length:e.byteLength;return b+e.toString().length+e+2},0);var d=new Uint8Array(b),g=0;f.forEach(function(b){var e="string"===typeof b,f=b;if(e){f=new Uint8Array(b.length);for(var h=0;h<b.length;h++)f[h]=b.charCodeAt(h);
f=f.buffer}e?d[g++]=0:d[g++]=1;b=f.byteLength.toString();for(h=0;h<b.length;h++)d[g++]=parseInt(b[h]);d[g++]=255;f=new Uint8Array(f);for(h=0;h<f.length;h++)d[g++]=f[h]});return e(d.buffer)})};f.encodePayloadAsBlob=function(b,e){d(b,function(b,e){f.encodePacket(b,!0,!0,function(b){var f=new Uint8Array(1);f[0]=1;if("string"===typeof b){for(var d=new Uint8Array(b.length),g=0;g<b.length;g++)d[g]=b.charCodeAt(g);b=d.buffer;f[0]=0}d=(b instanceof ArrayBuffer?b.byteLength:b.size).toString();var h=new Uint8Array(d.length+
1);for(g=0;g<d.length;g++)h[g]=parseInt(d[g]);h[d.length]=255;t&&(b=new t([f.buffer,h.buffer,b]),e(null,b))})},function(b,f){return e(new t(f))})};f.decodePayloadAsBinary=function(b,e,d){"function"===typeof e&&(d=e,e=null);for(var g=[],h=!1;0<b.byteLength;){for(var l=new Uint8Array(b),p=0===l[0],u="",D=1;255!=l[D];D++){if(310<u.length){h=!0;break}u+=l[D]}if(h)return d(ja,0,1);b=E(b,2+u.length);u=parseInt(u);l=E(b,0,u);if(p)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(en){for(p=new Uint8Array(l),
l="",D=0;D<p.length;D++)l+=String.fromCharCode(p[D])}g.push(l);b=E(b,u)}var r=g.length;g.forEach(function(b,g){d(f.decodePacket(b,e,!0),g,r)})}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./keys":25,after:1,"arraybuffer.slice":2,"base64-arraybuffer":5,blob:6,"has-binary":30,utf8:60}],25:[function(b,e,f){e.exports=Object.keys||function(b){var e=[],f=Object.prototype.hasOwnProperty,d;for(d in b)f.call(b,d)&&e.push(d);return e}},
{}],26:[function(b,e,f){function d(b){l.call(this);b=b||{};this.config={chunksize:16384,pacing:0};for(var e in b)this.config[e]=b[e];this.channel=this.file=null}function h(){l.call(this);this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null}var l=b("wildemitter");b=b("util");b.inherits(d,l);d.prototype.send=function(b,e){var f=this;this.file=b;this.channel=e;var d="number"!==typeof e.bufferedAmountLowThreshold,g=0,h=function(){var l=new window.FileReader;l.onload=function(){return function(l){f.channel.send(l.target.result);
f.emit("progress",g,b.size,l.target.result);b.size>g+l.target.result.byteLength?d?window.setTimeout(h,f.config.pacing):e.bufferedAmount<=e.bufferedAmountLowThreshold&&window.setTimeout(h,0):(f.emit("progress",b.size,b.size,null),f.emit("sentFile"));g+=f.config.chunksize}}(b);var p=b.slice(g,g+f.config.chunksize);l.readAsArrayBuffer(p)};d||(e.bufferedAmountLowThreshold=8*this.config.chunksize,e.addEventListener("bufferedamountlow",h));window.setTimeout(h,0)};b.inherits(h,l);h.prototype.receive=function(b,
e){var f=this;b&&(this.metadata=b);this.channel=e;e.binaryType="arraybuffer";this.channel.onmessage=function(b){f.received+=b.data.byteLength;f.receiveBuffer.push(b.data);f.emit("progress",f.received,f.metadata.size,b.data);f.received===f.metadata.size?(f.emit("receivedFile",new window.Blob(f.receiveBuffer),f.metadata),f.receiveBuffer=[]):f.received>f.metadata.size&&(console.error("received more than expected, discarding..."),f.receiveBuffer=[])}};e.exports={};e.exports.support="undefined"!==typeof window&&
window&&window.File&&window.FileReader&&window.Blob;e.exports.Sender=d;e.exports.Receiver=h},{util:63,wildemitter:65}],27:[function(b,e,f){var d={};e.exports=function(b,e){var f=2===arguments.length,g=f?e:b;if("undefined"===typeof window||"http:"===window.location.protocol){var h=Error("NavigatorUserMediaError");h.name="HTTPS_REQUIRED";return g(h)}if(window.navigator.userAgent.match("Chrome")){var l=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),r=33,U=!window.chrome.webstore;window.navigator.userAgent.match("Linux")&&
(r=35);sessionStorage.getScreenMediaJSExtensionId?chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(e){e&&""!==e.sourceId?(b=f&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}},b.video.mandatory.chromeMediaSourceId=e.sourceId,window.navigator.mediaDevices.getUserMedia(b).then(function(b){g(null,b)}).catch(function(b){g(b)})):(e=Error("NavigatorUserMediaError"),
e.name="NotAllowedError",g(e))}):window.cefGetScreenMedia?window.cefGetScreenMedia(function(e){e?(b=f&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},b.video.mandatory.chromeMediaSourceId=e,window.navigator.mediaDevices.getUserMedia(b).then(function(b){g(null,b)}).catch(function(b){g(b)})):(e=Error("cefGetScreenMediaError"),e.name="CEF_GETSCREENMEDIA_CANCELED",
g(e))}):U||26<=l&&l<=r?(b=f&&b||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){g(null,b)}).catch(function(b){g(b)})):(l=window.setTimeout(function(){h=Error("NavigatorUserMediaError");h.name="EXTENSION_UNAVAILABLE";return g(h)},1E3),d[l]=[g,f?b:null],window.postMessage({type:"getScreen",id:l},"*"))}else window.navigator.userAgent.match("Firefox")&&
(33<=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)?(b=f&&b||{video:{mozMediaSource:"window",mediaSource:"window"}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){g(null,b);var e=b.currentTime,f=window.setInterval(function(){b||window.clearInterval(f);if(b.currentTime==e&&(window.clearInterval(f),b.onended))b.onended();e=b.currentTime},500)}).catch(function(b){g(b)})):(h=Error("NavigatorUserMediaError"),h.name="EXTENSION_UNAVAILABLE"))};"undefined"!==typeof window&&
window.addEventListener("message",function(b){if(b.origin==window.location.origin)if("gotScreen"==b.data.type&&d[b.data.id]){var e=d[b.data.id],f=e[1],g=e[0];delete d[b.data.id];""===b.data.sourceId?(b=Error("NavigatorUserMediaError"),b.name="NotAllowedError",g(b)):(f=f||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},f.video.mandatory.chromeMediaSourceId=
b.data.sourceId,window.navigator.mediaDevices.getUserMedia(f).then(function(b){g(null,b)}).catch(function(b){g(b)}))}else"getScreenPending"==b.data.type&&window.clearTimeout(b.data.id)})},{}],28:[function(b,e,f){e.exports=function(){return this}()},{}],29:[function(b,e,f){var d=b("wildemitter"),h;"undefined"!==typeof window&&(h=window.AudioContext||window.webkitAudioContext);var l=null;e.exports=function(b,e){var f=new d;if(!h)return f;e=e||{};var g=e.smoothing||.1,p=e.interval||50,u=e.threshold,
J=e.play;e=e.history||10;var k=!0;l||(l=new h);var m=l.createAnalyser();m.fftSize=512;m.smoothingTimeConstant=g;var n=new Float32Array(m.frequencyBinCount);b.jquery&&(b=b[0]);if(b instanceof HTMLAudioElement||b instanceof HTMLVideoElement){var t=l.createMediaElementSource(b);"undefined"===typeof J&&(J=!0)}else t=l.createMediaStreamSource(b);u=u||-50;t.connect(m);J&&m.connect(l.destination);f.speaking=!1;f.setThreshold=function(b){u=b};f.setInterval=function(b){p=b};f.stop=function(){k=!1;f.emit("volume_change",
-100,u);f.speaking&&(f.speaking=!1,f.emit("stopped_speaking"));m.disconnect();t.disconnect()};f.speakingHistory=[];for(b=0;b<e;b++)f.speakingHistory.push(0);var ja=function(){setTimeout(function(){if(k){var b=-Infinity;m.getFloatFrequencyData(n);for(var e=4,d=n.length;e<d;e++)n[e]>b&&0>n[e]&&(b=n[e]);f.emit("volume_change",b,u);e=0;if(b>u&&!f.speaking){for(d=f.speakingHistory.length-3;d<f.speakingHistory.length;d++)e+=f.speakingHistory[d];2<=e&&(f.speaking=!0,f.emit("speaking"))}else if(b<u&&f.speaking){for(d=
0;d<f.speakingHistory.length;d++)e+=f.speakingHistory[d];0==e&&(f.speaking=!1,f.emit("stopped_speaking"))}f.speakingHistory.shift();f.speakingHistory.push(0+(b>u));ja()}},p)};ja();return f}},{wildemitter:65}],30:[function(b,e,f){(function(f){var d=b("isarray");e.exports=function(b){function e(b){if(!b)return!1;if(f.Buffer&&f.Buffer.isBuffer(b)||f.ArrayBuffer&&b instanceof ArrayBuffer||f.Blob&&b instanceof Blob||f.File&&b instanceof File)return!0;if(d(b))for(var g=0;g<b.length;g++){if(e(b[g]))return!0}else if(b&&
"object"==typeof b)for(g in b.toJSON&&(b=b.toJSON()),b)if(Object.prototype.hasOwnProperty.call(b,g)&&e(b[g]))return!0;return!1}return e(b)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{isarray:33}],31:[function(b,e,f){b=b("global");try{e.exports="XMLHttpRequest"in b&&"withCredentials"in new b.XMLHttpRequest}catch(g){e.exports=!1}},{global:28}],32:[function(b,e,f){var d=[].indexOf;e.exports=function(b,e){if(d)return b.indexOf(e);
for(var f=0;f<b.length;++f)if(b[f]===e)return f;return-1}},{}],33:[function(b,e,f){e.exports=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)}},{}],34:[function(b,e,f){(function(b){function e(b){if(e[b]!==u)return e[b];if("bug-string-char-index"==b)var f=!1;else if("json"==b)f=e("json-stringify")&&e("json-parse");else{var g;if("json-stringify"==b){f=D.stringify;var h="function"==typeof f&&r;if(h){(g=function(){return 1}).toJSON=g;try{h="0"===f(0)&&"0"===f(new Number)&&
'""'==f(new String)&&f(d)===u&&f(u)===u&&f()===u&&"1"===f(g)&&"[1]"==f([g])&&"[null]"==f([u])&&"null"==f(null)&&"[null,null,null]"==f([u,d,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==f({a:[g,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===f(null,g)&&"[\n 1,\n 2\n]"==f([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==f(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==f(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==f(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==f(new Date(-1))}catch(yf){h=
!1}}f=h}if("json-parse"==b){f=D.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){g=f('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var l=5==g.a.length&&1===g.a[0];if(l){try{l=!f('"\t"')}catch(yf){}if(l)try{l=1!==f("01")}catch(yf){}if(l)try{l=1!==f("1.")}catch(yf){}}}}catch(yf){l=!1}f=l}}return e[b]=!!f}var d={}.toString,g,u,E="object"==typeof JSON&&JSON,D="object"==typeof f&&f&&!f.nodeType&&f;D&&E?(D.stringify=E.stringify,D.parse=E.parse):D=b.JSON=E||{};var r=new Date(-0xc782b5b800cec);
try{r=-109252==r.getUTCFullYear()&&0===r.getUTCMonth()&&1===r.getUTCDate()&&10==r.getUTCHours()&&37==r.getUTCMinutes()&&6==r.getUTCSeconds()&&708==r.getUTCMilliseconds()}catch(fn){}if(!e("json")){var U=e("bug-string-char-index");if(!r)var J=Math.floor,k=[0,31,59,90,120,151,181,212,243,273,304,334],m=function(b,e){return k[e]+365*(b-1970)+J((b-1969+(e=+(1<e)))/4)-J((b-1901+e)/100)+J((b-1601+e)/400)};(g={}.hasOwnProperty)||(g=function(b){var e={};if((e.__proto__=null,e.__proto__={toString:1},e).toString!=
d)g=function(b){var e=this.__proto__;b=b in(this.__proto__=null,this);this.__proto__=e;return b};else{var f=e.constructor;g=function(b){var e=(this.constructor||f).prototype;return b in this&&!(b in e&&this[b]===e[b])}}e=null;return g.call(this,b)});var n={"boolean":1,number:1,string:1,undefined:1};var t=function(b,e){var f=0,h,l;(h=function(){this.valueOf=0}).prototype.valueOf=0;var p=new h;for(l in p)g.call(p,l)&&f++;h=p=null;f?t=2==f?function(b,e){var f={},h="[object Function]"==d.call(b),l;for(l in b)h&&
"prototype"==l||g.call(f,l)||!(f[l]=1)||!g.call(b,l)||e(l)}:function(b,e){var f="[object Function]"==d.call(b),h,l;for(h in b)f&&"prototype"==h||!g.call(b,h)||(l="constructor"===h)||e(h);(l||g.call(b,h="constructor"))&&e(h)}:(p="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),t=function(b,e){var f="[object Function]"==d.call(b),h,l;if(l=!f&&"function"!=typeof b.constructor)l=typeof b.hasOwnProperty,l="object"==l?!!b.hasOwnProperty:!n[l];l=
l?b.hasOwnProperty:g;for(h in b)f&&"prototype"==h||!l.call(b,h)||e(h);for(f=p.length;h=p[--f];l.call(b,h)&&e(h));});return t(b,e)};if(!e("json-stringify")){var ja={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},q=function(b,e){return("000000"+(e||0)).slice(-b)},x=function(b){var e='"',f=0,d=b.length,g=10<d&&U,h;for(g&&(h=b.split(""));f<d;f++){var l=b.charCodeAt(f);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=ja[l];break;default:e=32>l?e+("\\u00"+q(2,l.toString(16))):
e+(g?h[f]:U?b.charAt(f):b[f])}}return e+'"'},v=function(b,e,f,h,l,p,D){var r;try{var E=e[b]}catch(hn){}if("object"==typeof E&&E){var U=d.call(E);if("[object Date]"!=U||g.call(E,"toJSON"))"function"==typeof E.toJSON&&("[object Number]"!=U&&"[object String]"!=U&&"[object Array]"!=U||g.call(E,"toJSON"))&&(E=E.toJSON(b));else if(E>-1/0&&E<1/0){if(m){var k=J(E/864E5);for(U=J(k/365.2425)+1970-1;m(U+1,0)<=k;U++);for(r=J((k-m(U,0))/30.42);m(U,r+1)<=k;r++);k=1+k-m(U,r);var Xb=(E%864E5+864E5)%864E5;var n=J(Xb/
36E5)%24;var sf=J(Xb/6E4)%60;var vd=J(Xb/1E3)%60;Xb%=1E3}else U=E.getUTCFullYear(),r=E.getUTCMonth(),k=E.getUTCDate(),n=E.getUTCHours(),sf=E.getUTCMinutes(),vd=E.getUTCSeconds(),Xb=E.getUTCMilliseconds();E=(0>=U||1E4<=U?(0>U?"-":"+")+q(6,0>U?-U:U):q(4,U))+"-"+q(2,r+1)+"-"+q(2,k)+"T"+q(2,n)+":"+q(2,sf)+":"+q(2,vd)+"."+q(3,Xb)+"Z"}else E=null}f&&(E=f.call(e,b,E));if(null===E)return"null";U=d.call(E);if("[object Boolean]"==U)return""+E;if("[object Number]"==U)return E>-1/0&&E<1/0?""+E:"null";if("[object String]"==
U)return x(""+E);if("object"==typeof E){for(b=D.length;b--;)if(D[b]===E)throw TypeError();D.push(E);var ja=[];e=p;p+=l;if("[object Array]"==U){r=0;for(b=E.length;r<b;r++)U=v(r,E,f,h,l,p,D),ja.push(U===u?"null":U);b=ja.length?l?"[\n"+p+ja.join(",\n"+p)+"\n"+e+"]":"["+ja.join(",")+"]":"[]"}else t(h||E,function(b){var e=v(b,E,f,h,l,p,D);e!==u&&ja.push(x(b)+":"+(l?" ":"")+e)}),b=ja.length?l?"{\n"+p+ja.join(",\n"+p)+"\n"+e+"}":"{"+ja.join(",")+"}":"{}";D.pop();return b}};D.stringify=function(b,e,f){var g;
if("function"==typeof e||"object"==typeof e&&e)if("[object Function]"==(g=d.call(e)))var h=e;else if("[object Array]"==g){var l={};for(var p=0,u=e.length,r;p<u;r=e[p++],(g=d.call(r),"[object String]"==g||"[object Number]"==g)&&(l[r]=1));}if(f)if("[object Number]"==(g=d.call(f))){if(0<(f-=f%1)){var D="";for(10<f&&(f=10);D.length<f;D+=" ");}}else"[object String]"==g&&(D=10>=f.length?f:f.slice(0,10));return v("",(r={},r[""]=b,r),h,l,D,"",[])}}if(!e("json-parse")){var w=String.fromCharCode,y={92:"\\",
34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},A,H,z=function(){A=H=null;throw SyntaxError();},B=function(){for(var b=H,e=b.length,f,d,g,h,l;A<e;)switch(l=b.charCodeAt(A),l){case 9:case 10:case 13:case 32:A++;break;case 123:case 125:case 91:case 93:case 58:case 44:return f=U?b.charAt(A):b[A],A++,f;case 34:f="@";for(A++;A<e;)if(l=b.charCodeAt(A),32>l)z();else if(92==l)switch(l=b.charCodeAt(++A),l){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:f+=y[l];A++;break;case 117:d=
++A;for(g=A+4;A<g;A++)l=b.charCodeAt(A),48<=l&&57>=l||97<=l&&102>=l||65<=l&&70>=l||z();f+=w("0x"+b.slice(d,A));break;default:z()}else{if(34==l)break;l=b.charCodeAt(A);for(d=A;32<=l&&92!=l&&34!=l;)l=b.charCodeAt(++A);f+=b.slice(d,A)}if(34==b.charCodeAt(A))return A++,f;z();default:d=A;45==l&&(h=!0,l=b.charCodeAt(++A));if(48<=l&&57>=l){for(48==l&&(l=b.charCodeAt(A+1),48<=l&&57>=l)&&z();A<e&&(l=b.charCodeAt(A),48<=l&&57>=l);A++);if(46==b.charCodeAt(A)){for(g=++A;g<e&&(l=b.charCodeAt(g),48<=l&&57>=l);g++);
g==A&&z();A=g}l=b.charCodeAt(A);if(101==l||69==l){l=b.charCodeAt(++A);43!=l&&45!=l||A++;for(g=A;g<e&&(l=b.charCodeAt(g),48<=l&&57>=l);g++);g==A&&z();A=g}return+b.slice(d,A)}h&&z();if("true"==b.slice(A,A+4))return A+=4,!0;if("false"==b.slice(A,A+5))return A+=5,!1;if("null"==b.slice(A,A+4))return A+=4,null;z()}return"$"},G=function(b){var e,f;"$"==b&&z();if("string"==typeof b){if("@"==(U?b.charAt(0):b[0]))return b.slice(1);if("["==b){for(e=[];;f||(f=!0)){b=B();if("]"==b)break;f&&(","==b?(b=B(),"]"==
b&&z()):z());","==b&&z();e.push(G(b))}return e}if("{"==b){for(e={};;f||(f=!0)){b=B();if("}"==b)break;f&&(","==b?(b=B(),"}"==b&&z()):z());","!=b&&"string"==typeof b&&"@"==(U?b.charAt(0):b[0])&&":"==B()||z();e[b.slice(1)]=G(B())}return e}z()}return b},F=function(b,e,f){f=I(b,e,f);f===u?delete b[e]:b[e]=f},I=function(b,e,f){var g=b[e],h;if("object"==typeof g&&g)if("[object Array]"==d.call(g))for(h=g.length;h--;)F(g,h,f);else t(g,function(b){F(g,b,f)});return f.call(b,e,g)};D.parse=function(b,e){var f;
A=0;H=""+b;b=G(B());"$"!=B()&&z();A=H=null;return e&&"[object Function]"==d.call(e)?I((f={},f[""]=b,f),"",e):b}}}})(this)},{}],35:[function(b,e,f){function g(b){var e=!0;b.getTracks().forEach(function(b){e="ended"===b.readyState&&e});return e}function d(){if("undefined"===typeof window||!window.navigator.mozGetUserMedia)return!1;var b=window.navigator.userAgent.match(/Firefox\/(\d+)\./);return 50>(b&&1<=b.length&&parseInt(b[1],10))}function l(b){E.call(this);var e=this.config={detectSpeakingEvents:!1,
audioFallback:!1,media:{audio:!0,video:!0},harkOptions:null,logger:D},f;for(f in b)b.hasOwnProperty(f)&&(this.config[f]=b[f]);this.logger=e.logger;this._log=this.logger.log.bind(this.logger,"LocalMedia:");this._logerror=this.logger.error.bind(this.logger,"LocalMedia:");this.localStreams=[];this.localScreens=[];navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||this._logerror("Your browser does not support local media capture.");this._audioMonitors=[];this.on("localStreamStopped",this._stopAudioMonitor.bind(this));
this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}f=b("util");var p=b("hark"),u=b("getscreenmedia"),E=b("wildemitter"),D=b("mockconsole");f.inherits(l,E);l.prototype.start=function(b,e){var f=this,d=b||this.config.media;this.emit("localStreamRequested",d);navigator.mediaDevices.getUserMedia(d).then(function(b){d.audio&&f.config.detectSpeakingEvents&&f._setupAudioMonitor(b,f.config.harkOptions);f.localStreams.push(b);b.getTracks().forEach(function(e){e.addEventListener("ended",function(){g(b)&&
f._removeStream(b)})});f.emit("localStream",b);if(e)return e(null,b)}).catch(function(b){if(f.config.audioFallback&&"NotFoundError"===b.name&&!1!==d.video)d.video=!1,f.start(d,e);else if(f.emit("localStreamRequestFailed",d),e)return e(b,null)})};l.prototype.stop=function(b){this.stopStream(b);this.stopScreenShare(b)};l.prototype.stopStream=function(b){var e=this;b?-1<this.localStreams.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),d()&&this._removeStream(b)):this.localStreams.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});
d()&&e._removeStream(b)})};l.prototype.startScreenShare=function(b,e){var f=this;this.emit("localScreenRequested");"function"!==typeof b||e||(e=b,b=null);u(b,function(b,d){b?f.emit("localScreenRequestFailed"):(f.localScreens.push(d),d.getTracks().forEach(function(b){b.addEventListener("ended",function(){var b=!0;d.getTracks().forEach(function(e){b="ended"===e.readyState&&b});b&&f._removeStream(d)})}),f.emit("localScreen",d));if(e)return e(b,d)})};l.prototype.stopScreenShare=function(b){var e=this;
b?-1<this.localScreens.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),d()&&this._removeStream(b)):this.localScreens.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});d()&&e._removeStream(b)})};l.prototype.mute=function(){this._audioEnabled(!1);this.emit("audioOff")};l.prototype.unmute=function(){this._audioEnabled(!0);this.emit("audioOn")};l.prototype.pauseVideo=function(){this._videoEnabled(!1);this.emit("videoOff")};l.prototype.resumeVideo=function(){this._videoEnabled(!0);
this.emit("videoOn")};l.prototype.pause=function(){this.mute();this.pauseVideo()};l.prototype.resume=function(){this.unmute();this.resumeVideo()};l.prototype._audioEnabled=function(b){this.localStreams.forEach(function(e){e.getAudioTracks().forEach(function(e){e.enabled=!!b})})};l.prototype._videoEnabled=function(b){this.localStreams.forEach(function(e){e.getVideoTracks().forEach(function(e){e.enabled=!!b})})};l.prototype.isAudioEnabled=function(){var b=!0;this.localStreams.forEach(function(e){e.getAudioTracks().forEach(function(e){b=
b&&e.enabled})});return b};l.prototype.isVideoEnabled=function(){var b=!0;this.localStreams.forEach(function(e){e.getVideoTracks().forEach(function(e){b=b&&e.enabled})});return b};l.prototype._removeStream=function(b){var e=this.localStreams.indexOf(b);-1<e?(this.localStreams.splice(e,1),this.emit("localStreamStopped",b)):(e=this.localScreens.indexOf(b),-1<e&&(this.localScreens.splice(e,1),this.emit("localScreenStopped",b)))};l.prototype._setupAudioMonitor=function(b,e){this._log("Setup audio");e=
p(b,e);var f=this,d;e.on("speaking",function(){f.emit("speaking")});e.on("stopped_speaking",function(){d&&clearTimeout(d);d=setTimeout(function(){f.emit("stoppedSpeaking")},1E3)});e.on("volume_change",function(b,e){f.emit("volumeChange",b,e)});this._audioMonitors.push({audio:e,stream:b})};l.prototype._stopAudioMonitor=function(b){var e=-1;this._audioMonitors.forEach(function(f,d){f.stream===b&&(e=d)});-1<e&&(this._audioMonitors[e].audio.stop(),this._audioMonitors.splice(e,1))};e.exports=l},{getscreenmedia:27,
hark:29,mockconsole:37,util:63,wildemitter:65}],36:[function(b,e,f){(function(b){function d(b,e){b.set(e[0],e[1]);return b}function g(b,e){b.add(e);return b}function p(b,e){for(var f=-1,d=b?b.length:0;++f<d&&!1!==e(b[f],f,b););return b}function u(b,e,f,d){var g=-1,h=b?b.length:0;for(d&&h&&(f=b[++g]);++g<h;)f=e(f,b[g],g,b);return f}function E(b){var e=!1;if(null!=b&&"function"!=typeof b.toString)try{e=!!(b+"")}catch(kn){}return e}function D(b){var e=-1,f=Array(b.size);b.forEach(function(b,d){f[++e]=
[d,b]});return f}function r(b,e){return function(f){return b(e(f))}}function U(b){var e=-1,f=Array(b.size);b.forEach(function(b){f[++e]=b});return f}function J(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var d=b[e];this.set(d[0],d[1])}}function k(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var d=b[e];this.set(d[0],d[1])}}function m(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var d=b[e];this.set(d[0],d[1])}}function n(b){this.__data__=new k(b)}function t(b,e,f){var d=b[e];V.call(b,
e)&&(d===f||d!==d&&f!==f)&&(void 0!==f||e in b)||(b[e]=f)}function ja(b,e){for(var f=b.length;f--;){var d=b[f][0];if(d===e||d!==d&&e!==e)return f}return-1}function q(b,e){return b&&z(e,N(e),b)}function x(b,e,f,d,g,h,l){var u;d&&(u=h?d(b,g,h,l):d(b));if(void 0!==u)return u;if(!L(b))return b;if(g=sa(b)){if(u=F(b),!e)return y(b,u)}else{var D=xa(b),r="[object Function]"==D||"[object GeneratorFunction]"==D;if(ea(b))return A(b,e);if("[object Object]"==D||"[object Arguments]"==D||r&&!h){if(E(b))return h?
b:{};u=I(r?{}:b);if(!e)return H(b,q(u,b))}else{if(!C[D])return h?b:{};u=Q(b,D,x,e)}}l||(l=new n);if(h=l.get(b))return h;l.set(b,u);if(!g)var J=f?v(b,N,Ea):N(b);p(J||b,function(g,h){J&&(h=g,g=b[h]);t(u,h,x(g,e,f,d,h,b,l))});return u}function v(b,e,f){e=e(b);if(!sa(b)){b=f(b);f=-1;for(var d=b.length,g=e.length;++f<d;)e[g+f]=b[f]}return e}function A(b,e){if(e)return b.slice();e=new b.constructor(b.length);b.copy(e);return e}function w(b){var e=new b.constructor(b.byteLength);(new ma(e)).set(new ma(b));
return e}function y(b,e){var f=-1,d=b.length;for(e||(e=Array(d));++f<d;)e[f]=b[f];return e}function z(b,e,f,d){f||(f={});for(var g=-1,h=e.length;++g<h;){var l=e[g],p=d?d(f[l],b[l],l,f,b):void 0;t(f,l,void 0===p?b[l]:p)}return f}function H(b,e){return z(b,Ea(b),e)}function B(b,e){b=b.__data__;var f=typeof e;return("string"==f||"number"==f||"symbol"==f||"boolean"==f?"__proto__"!==e:null===e)?b["string"==typeof e?"string":"hash"]:b.map}function G(b,e){b=null==b?void 0:b[e];e=!L(b)||ba&&ba in b?!1:(P(b)||
E(b)?la:R).test(ad(b));return e?b:void 0}function F(b){var e=b.length,f=b.constructor(e);e&&"string"==typeof b[0]&&V.call(b,"index")&&(f.index=b.index,f.input=b.input);return f}function I(b){"function"!=typeof b.constructor||aj(b)?b={}:(b=oa(b),b=L(b)?ha(b):{});return b}function Q(b,e,f,h){var l=b.constructor;switch(e){case "[object ArrayBuffer]":return w(b);case "[object Boolean]":case "[object Date]":return new l(+b);case "[object DataView]":return e=h?w(b.buffer):b.buffer,new b.constructor(e,b.byteOffset,
b.byteLength);case "[object Float32Array]":case "[object Float64Array]":case "[object Int8Array]":case "[object Int16Array]":case "[object Int32Array]":case "[object Uint8Array]":case "[object Uint8ClampedArray]":case "[object Uint16Array]":case "[object Uint32Array]":return e=h?w(b.buffer):b.buffer,new b.constructor(e,b.byteOffset,b.length);case "[object Map]":return e=h?f(D(b),!0):D(b),u(e,d,new b.constructor);case "[object Number]":case "[object String]":return new l(b);case "[object RegExp]":return e=
new b.constructor(b.source,K.exec(b)),e.lastIndex=b.lastIndex,e;case "[object Set]":return e=h?f(U(b),!0):U(b),u(e,g,new b.constructor);case "[object Symbol]":return Aa?Object(Aa.call(b)):{}}}function aj(b){var e=b&&b.constructor;return b===("function"==typeof e&&e.prototype||aa)}function ad(b){if(null!=b){try{return fa.call(b)}catch(jn){}return b+""}return""}function bj(b){var e;if(e=null!=b)e=b.length,e="number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e;return e&&!P(b)}function P(b){b=L(b)?Y.call(b):
"";return"[object Function]"==b||"[object GeneratorFunction]"==b}function L(b){var e=typeof b;return!!b&&("object"==e||"function"==e)}function N(b){if(bj(b)){var e;(e=sa(b))||(e=!!b&&"object"==typeof b&&bj(b)&&V.call(b,"callee")&&(!pa.call(b,"callee")||"[object Arguments]"==Y.call(b)));if(e){e=b.length;for(var f=String,d=-1,g=Array(e);++d<e;)g[d]=f(d);e=g}else e=[];f=e.length;d=!!f;for(var h in b){if(!(g=!V.call(b,h))&&(g=d)&&!(g="length"==h)){g=h;var l=f;l=null==l?9007199254740991:l;g=!!l&&("number"==
typeof g||W.test(g))&&-1<g&&0==g%1&&g<l}g||e.push(h)}b=e}else if(aj(b)){h=[];for(e in Object(b))V.call(b,e)&&"constructor"!=e&&h.push(e);b=h}else b=ia(b);return b}function M(){return[]}function O(){return!1}var K=/\w*$/,R=/^\[object .+?Constructor\]$/,W=/^(?:0|[1-9]\d*)$/,C={};C["[object Arguments]"]=C["[object Array]"]=C["[object ArrayBuffer]"]=C["[object DataView]"]=C["[object Boolean]"]=C["[object Date]"]=C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=
C["[object Int32Array]"]=C["[object Map]"]=C["[object Number]"]=C["[object Object]"]=C["[object RegExp]"]=C["[object Set]"]=C["[object String]"]=C["[object Symbol]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0;C["[object Error]"]=C["[object Function]"]=C["[object WeakMap]"]=!1;var S="object"==typeof self&&self&&self.Object===Object&&self;b="object"==typeof b&&b&&b.Object===Object&&b||S||Function("return this")();var X=(S="object"==
typeof f&&f&&!f.nodeType&&f)&&"object"==typeof e&&e&&!e.nodeType&&e;S=X&&X.exports===S;X=Array.prototype;var T=Function.prototype,aa=Object.prototype,da=b["__core-js_shared__"],ba=function(){var b=/[^.]+$/.exec(da&&da.keys&&da.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),fa=T.toString,V=aa.hasOwnProperty,Y=aa.toString,la=RegExp("^"+fa.call(V).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");T=S?b.Buffer:void 0;S=b.Symbol;
var ma=b.Uint8Array,oa=r(Object.getPrototypeOf,Object),ha=Object.create,pa=aa.propertyIsEnumerable,ka=X.splice;X=Object.getOwnPropertySymbols;T=T?T.isBuffer:void 0;var ia=r(Object.keys,Object),na=G(b,"DataView"),qa=G(b,"Map"),ta=G(b,"Promise"),ca=G(b,"Set");b=G(b,"WeakMap");var Z=G(Object,"create"),Da=ad(na),Ca=ad(qa),ra=ad(ta),ya=ad(ca),Ka=ad(b),Aa=(S=S?S.prototype:void 0)?S.valueOf:void 0;J.prototype.clear=function(){this.__data__=Z?Z(null):{}};J.prototype["delete"]=function(b){return this.has(b)&&
delete this.__data__[b]};J.prototype.get=function(b){var e=this.__data__;return Z?(b=e[b],"__lodash_hash_undefined__"===b?void 0:b):V.call(e,b)?e[b]:void 0};J.prototype.has=function(b){var e=this.__data__;return Z?void 0!==e[b]:V.call(e,b)};J.prototype.set=function(b,e){this.__data__[b]=Z&&void 0===e?"__lodash_hash_undefined__":e;return this};k.prototype.clear=function(){this.__data__=[]};k.prototype["delete"]=function(b){var e=this.__data__;b=ja(e,b);if(0>b)return!1;b==e.length-1?e.pop():ka.call(e,
b,1);return!0};k.prototype.get=function(b){var e=this.__data__;b=ja(e,b);return 0>b?void 0:e[b][1]};k.prototype.has=function(b){return-1<ja(this.__data__,b)};k.prototype.set=function(b,e){var f=this.__data__,d=ja(f,b);0>d?f.push([b,e]):f[d][1]=e;return this};m.prototype.clear=function(){this.__data__={hash:new J,map:new (qa||k),string:new J}};m.prototype["delete"]=function(b){return B(this,b)["delete"](b)};m.prototype.get=function(b){return B(this,b).get(b)};m.prototype.has=function(b){return B(this,
b).has(b)};m.prototype.set=function(b,e){B(this,b).set(b,e);return this};n.prototype.clear=function(){this.__data__=new k};n.prototype["delete"]=function(b){return this.__data__["delete"](b)};n.prototype.get=function(b){return this.__data__.get(b)};n.prototype.has=function(b){return this.__data__.has(b)};n.prototype.set=function(b,e){var f=this.__data__;if(f instanceof k){f=f.__data__;if(!qa||199>f.length)return f.push([b,e]),this;f=this.__data__=new m(f)}f.set(b,e);return this};var Ea=X?r(X,Object):
M,xa=function(b){return Y.call(b)};if(na&&"[object DataView]"!=xa(new na(new ArrayBuffer(1)))||qa&&"[object Map]"!=xa(new qa)||ta&&"[object Promise]"!=xa(ta.resolve())||ca&&"[object Set]"!=xa(new ca)||b&&"[object WeakMap]"!=xa(new b))xa=function(b){var e=Y.call(b);if(b=(b="[object Object]"==e?b.constructor:void 0)?ad(b):void 0)switch(b){case Da:return"[object DataView]";case Ca:return"[object Map]";case ra:return"[object Promise]";case ya:return"[object Set]";case Ka:return"[object WeakMap]"}return e};
var sa=Array.isArray,ea=T||O;e.exports=function(b){return x(b,!0,!0)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],37:[function(b,e,f){b="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profileEnd time timeEnd trace warn".split(" ");f=b.length;for(var d=function(){},h={};f--;)h[b[f]]=d;e.exports=h},{}],38:[function(b,e,f){function d(b){if(b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(b)){var e=
parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case "years":case "year":case "y":return e*l;case "days":case "day":case "d":return 864E5*e;case "hours":case "hour":case "h":return 36E5*e;case "minutes":case "minute":case "m":return 6E4*e;case "seconds":case "second":case "s":return 1E3*e;case "ms":return e}}}function h(b,e,f){if(!(b<e))return b<1.5*e?Math.floor(b/e)+" "+f:Math.ceil(b/e)+" "+f+"s"}var l=315576E5;e.exports=function(b,e){e=e||{};return"string"==typeof b?d(b):e.long?h(b,864E5,"day")||
h(b,36E5,"hour")||h(b,6E4,"minute")||h(b,1E3,"second")||b+" ms":864E5<=b?Math.round(b/864E5)+"d":36E5<=b?Math.round(b/36E5)+"h":6E4<=b?Math.round(b/6E4)+"m":1E3<=b?Math.round(b/1E3)+"s":b+"ms"}},{}],39:[function(b,e,f){var d=Object.prototype.hasOwnProperty;f.keys=Object.keys||function(b){var e=[],f;for(f in b)d.call(b,f)&&e.push(f);return e};f.values=function(b){var e=[],f;for(f in b)d.call(b,f)&&e.push(b[f]);return e};f.merge=function(b,e){for(var f in e)d.call(e,f)&&(b[f]=e[f]);return b};f.length=
function(b){return f.keys(b).length};f.isEmpty=function(b){return 0==f.length(b)}},{}],40:[function(b,e,f){(function(b){var f=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,g=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,u=/(?:^|:|,)(?:\s*\[)+/g,E=/^\s+/,D=/\s+$/;e.exports=function(e){if("string"!=typeof e||!e)return null;e=e.replace(E,"").replace(D,"");if(b.JSON&&JSON.parse)return JSON.parse(e);if(f.test(e.replace(d,"@").replace(g,"]").replace(u,"")))return(new Function("return "+
e))()}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],41:[function(b,e,f){f.encode=function(b){var e="",f;for(f in b)b.hasOwnProperty(f)&&(e.length&&(e+="&"),e+=encodeURIComponent(f)+"="+encodeURIComponent(b[f]));return e};f.decode=function(b){var e={};b=b.split("&");for(var f=0,d=b.length;f<d;f++){var g=b[f].split("=");e[decodeURIComponent(g[0])]=decodeURIComponent(g[1])}return e}},{}],42:[function(b,e,f){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
h="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");e.exports=function(b){b=d.exec(b||"");for(var e={},f=14;f--;)e[h[f]]=b[f]||"";return e}},{}],43:[function(b,e,f){function d(){throw Error("setTimeout has not been defined");}function h(){throw Error("clearTimeout has not been defined");}function l(b){if(U===setTimeout)return setTimeout(b,0);if((U===d||!U)&&setTimeout)return U=setTimeout,setTimeout(b,0);try{return U(b,0)}catch(Bl){try{return U.call(null,
b,0)}catch(Cl){return U.call(this,b,0)}}}function p(b){if(J===clearTimeout)return clearTimeout(b);if((J===h||!J)&&clearTimeout)return J=clearTimeout,clearTimeout(b);try{return J(b)}catch(Bl){try{return J.call(null,b)}catch(Cl){return J.call(this,b)}}}function u(){m&&n&&(m=!1,n.length?k=n.concat(k):t=-1,k.length&&E())}function E(){if(!m){var b=l(u);m=!0;for(var e=k.length;e;){n=k;for(k=[];++t<e;)n&&n[t].run();t=-1;e=k.length}n=null;m=!1;p(b)}}function D(b,e){this.fun=b;this.array=e}function r(){}b=
e.exports={};try{var U="function"===typeof setTimeout?setTimeout:d}catch(ja){U=d}try{var J="function"===typeof clearTimeout?clearTimeout:h}catch(ja){J=h}var k=[],m=!1,n,t=-1;b.nextTick=function(b){var e=Array(arguments.length-1);if(1<arguments.length)for(var f=1;f<arguments.length;f++)e[f-1]=arguments[f];k.push(new D(b,e));1!==k.length||m||l(E)};D.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=r;b.addListener=
r;b.once=r;b.off=r;b.removeListener=r;b.removeAllListeners=r;b.emit=r;b.prependListener=r;b.prependOnceListener=r;b.listeners=function(b){return[]};b.binding=function(b){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(b){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}],44:[function(b,e,f){function d(b,e){var f=this,d;l.call(this);b=b||{};b.iceServers=b.iceServers||[];this.enableChromeNativeSimulcast=!1;e&&e.optional&&
window.chrome&&null===navigator.appVersion.match(/Chromium\//)&&e.optional.forEach(function(b){b.enableChromeNativeSimulcast&&(f.enableChromeNativeSimulcast=!0)});this.enableMultiStreamHacks=!1;e&&e.optional&&window.chrome&&e.optional.forEach(function(b){b.enableMultiStreamHacks&&(f.enableMultiStreamHacks=!0)});this.restrictBandwidth=0;e&&e.optional&&e.optional.forEach(function(b){b.andyetRestrictBandwidth&&(f.restrictBandwidth=b.andyetRestrictBandwidth)});this.batchIceCandidates=0;e&&e.optional&&
e.optional.forEach(function(b){b.andyetBatchIce&&(f.batchIceCandidates=b.andyetBatchIce)});this.batchedIceCandidates=[];e&&e.optional&&window.chrome&&e.optional.forEach(function(b){b.andyetFasterICE&&(f.eliminateDuplicateCandidates=b.andyetFasterICE)});e&&e.optional&&e.optional.forEach(function(b){b.andyetDontSignalCandidates&&(f.dontSignalCandidates=b.andyetDontSignalCandidates)});this.assumeSetLocalSuccess=!1;e&&e.optional&&e.optional.forEach(function(b){b.andyetAssumeSetLocalSuccess&&(f.assumeSetLocalSuccess=
b.andyetAssumeSetLocalSuccess)});window.navigator.mozGetUserMedia&&e&&e.optional&&(this.wtFirefox=0,e.optional.forEach(function(b){b.andyetFirefoxMakesMeSad&&(f.wtFirefox=b.andyetFirefoxMakesMeSad,0<f.wtFirefox&&(f.firefoxcandidatebuffer=[]))}));this.pc=new RTCPeerConnection(b,e);this.getLocalStreams="function"===typeof this.pc.getLocalStreams?this.pc.getLocalStreams.bind(this.pc):function(){return[]};this.getSenders="function"===typeof this.pc.getSenders?this.pc.getSenders.bind(this.pc):function(){return[]};
this.getRemoteStreams="function"===typeof this.pc.getRemoteStreams?this.pc.getRemoteStreams.bind(this.pc):function(){return[]};this.getReceivers="function"===typeof this.pc.getReceivers?this.pc.getReceivers.bind(this.pc):function(){return[]};this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=function(b){"function"===typeof f.pc.removeStream?f.pc.removeStream.apply(f.pc,arguments):"function"===typeof f.pc.removeTrack&&b.getTracks().forEach(function(b){f.pc.removeTrack(b)})};"function"===
typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc));this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onremovetrack=this.emit.bind(this,"removeTrack");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);
this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:!1,sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};this.iceCredentials={local:{},remote:{}};for(d in b)this.config[d]=b[d];if(this.config.debug)this.on("*",function(){(b.logger||console).log("PeerConnection event:",arguments)});this.hadRemoteIPv6Candidate=this.hadLocalIPv6Candidate=this.hadRemoteRelayCandidate=this.hadLocalRelayCandidate=this.hadRemoteStunCandidate=
this.hadLocalStunCandidate=!1;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}f=b("util");var h=b("sdp-jingle-json"),l=b("wildemitter"),p=b("lodash.clonedeep");f.inherits(d,l);Object.defineProperty(d.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(d.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});d.prototype._role=function(){return this.isInitiator?"initiator":"responder"};d.prototype.addStream=
function(b){this.localStream=b;this.pc.addStream(b)};d.prototype._checkLocalCandidate=function(b){b=h.toCandidateJSON(b);"srflx"==b.type?this.hadLocalStunCandidate=!0:"relay"==b.type&&(this.hadLocalRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)};d.prototype._checkRemoteCandidate=function(b){b=h.toCandidateJSON(b);"srflx"==b.type?this.hadRemoteStunCandidate=!0:"relay"==b.type&&(this.hadRemoteRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)};d.prototype.processIce=
function(b,e){e=e||function(){};var f=this;if("closed"===this.pc.signalingState)return e();if(b.contents||b.jingle&&b.jingle.contents){var d=this.remoteDescription.contents.map(function(b){return b.name});(b.contents||b.jingle.contents).forEach(function(b){var g=b.transport||{},l=g.candidates||[],p=d.indexOf(b.name),u=b.name,D=f.remoteDescription.contents.find(function(e){return e.name===b.name}),r=function(){l.forEach(function(b){b=h.toCandidateSDP(b);f.pc.addIceCandidate(new RTCIceCandidate({candidate:b,
sdpMLineIndex:p,sdpMid:u}),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b)});e()};f.iceCredentials.remote[b.name]&&g.ufrag&&f.iceCredentials.remote[b.name].ufrag!==g.ufrag?D?(D.transport.ufrag=g.ufrag,D.transport.pwd=g.pwd,g={type:"offer",jingle:f.remoteDescription},g.sdp=h.toSessionSDP(g.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"}),f.pc.setRemoteDescription(new RTCSessionDescription(g),function(){r()},function(b){f.emit("error",b)})):f.emit("error",
"ice restart failed to find matching content"):r()})}else{b.candidate&&0!==b.candidate.candidate.indexOf("a=")&&(b.candidate.candidate="a="+b.candidate.candidate);if(this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(b.candidate),e();f.pc.addIceCandidate(new RTCIceCandidate(b.candidate),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b.candidate.candidate);e()}};d.prototype.offer=
function(b,e){var f=this,d=2===arguments.length,g=d&&b?b:{offerToReceiveAudio:1,offerToReceiveVideo:1};e=(e=d?e:b)||function(){};if("closed"===this.pc.signalingState)return e("Already closed");this.pc.createOffer(function(b){var d={type:"offer",sdp:b.sdp};f.assumeSetLocalSuccess&&(f.emit("offer",d),e(null,d));f._candidateBuffer=[];f.pc.setLocalDescription(b,function(){if(f.config.useJingle){var g=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"});g.sid=f.config.sid;f.localDescription=g;
g.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.local[b.name]={ufrag:e.ufrag,pwd:e.pwd})});d.jingle=g}d.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkLocalCandidate(b)});f.assumeSetLocalSuccess||(f.emit("offer",d),e(null,d))},function(b){f.emit("error",b);e(b)})},function(b){f.emit("error",b);e(b)},g)};d.prototype.handleOffer=function(b,e){e=e||function(){};var f=this;b.type="offer";if(b.jingle){this.enableChromeNativeSimulcast&&b.jingle.contents.forEach(function(b){"video"===
b.name&&(b.application.googConferenceFlag=!0)});this.enableMultiStreamHacks&&b.jingle.contents.forEach(function(b){if("video"===b.name){var e=b.application.sources||[];if(0===e.length||"3735928559"!==e[0].ssrc)e.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),b.application.sources=e}});if(0<f.restrictBandwidth&&2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name){var d=b.jingle.contents[1];d.application&&d.application.bandwidth&&
d.application.bandwidth.bandwidth||(b.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:f.restrictBandwidth.toString()},b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"outgoing"}))}b.jingle.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.remote[b.name]={ufrag:e.ufrag,pwd:e.pwd})});b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"});f.remoteDescription=b.jingle}b.sdp.split("\r\n").forEach(function(b){0===
b.indexOf("a=candidate:")&&f._checkRemoteCandidate(b)});f.pc.setRemoteDescription(new RTCSessionDescription(b),function(){e()},e)};d.prototype.answerAudioOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},b)};d.prototype.answerBroadcastOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},b)};d.prototype.answer=function(b,e){var f=2===arguments.length;this._answer(f&&b?b:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},
f?e:b)};d.prototype.handleAnswer=function(b,e){e=e||function(){};var f=this;b.jingle&&(b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"}),f.remoteDescription=b.jingle,b.jingle.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.remote[b.name]={ufrag:e.ufrag,pwd:e.pwd})}));b.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkRemoteCandidate(b)});f.pc.setRemoteDescription(new RTCSessionDescription(b),function(){f.wtFirefox&&
window.setTimeout(function(){f.firefoxcandidatebuffer.forEach(function(b){f.pc.addIceCandidate(new RTCIceCandidate(b),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b.candidate)});f.firefoxcandidatebuffer=null},f.wtFirefox);e(null)},e)};d.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};d.prototype._answer=function(b,e){e=e||function(){};var f=this;if(!this.pc.remoteDescription)throw Error("remoteDescription not set");
if("closed"===this.pc.signalingState)return e("Already closed");f.pc.createAnswer(function(b){var d=[];if(f.enableChromeNativeSimulcast&&(b.jingle=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"}),2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name)){var g=b.jingle.contents[1].application.sourceGroups||[],l=!1;g.forEach(function(b){"SIM"==b.semantics&&(l=!0)});if(!l&&b.jingle.contents[1].application.sources.length){var u=JSON.parse(JSON.stringify(b.jingle.contents[1].application.sources[0]));
u.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(u);d.push(b.jingle.contents[1].application.sources[0].ssrc);d.push(u.ssrc);g.push({semantics:"SIM",sources:d});d=JSON.parse(JSON.stringify(u));d.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(d);g.push({semantics:"FID",sources:[u.ssrc,d.ssrc]});b.jingle.contents[1].application.sourceGroups=g;b.sdp=h.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),
direction:"outgoing"})}}var D={type:"answer",sdp:b.sdp};f.assumeSetLocalSuccess&&(g=p(D),f.emit("answer",g),e(null,g));f._candidateBuffer=[];f.pc.setLocalDescription(b,function(){if(f.config.useJingle){var d=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"});d.sid=f.config.sid;f.localDescription=d;D.jingle=d}f.enableChromeNativeSimulcast&&(D.jingle||(D.jingle=h.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"})),D.jingle.contents[1].application.sources.forEach(function(b,e){b.parameters=
b.parameters.map(function(b){"msid"===b.key&&(b.value+="-"+Math.floor(e/2));return b})}),D.sdp=h.toSessionSDP(D.jingle,{sid:f.sdpSessionID,role:f._role(),direction:"outgoing"}));D.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkLocalCandidate(b)});f.assumeSetLocalSuccess||(d=p(D),f.emit("answer",d),e(null,d))},function(b){f.emit("error",b);e(b)})},function(b){f.emit("error",b);e(b)},b)};d.prototype._onIce=function(b){var e=this;if(b.candidate){if(!this.dontSignalCandidates){b=
b.candidate;var f={candidate:{candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex}};this._checkLocalCandidate(b.candidate);var d=h.toCandidateJSON(b.candidate);if(this.eliminateDuplicateCandidates&&"relay"===d.type){var g=this._candidateBuffer.filter(function(b){return"relay"===b.type}).map(function(b){return b.foundation+":"+b.component});var l=g.indexOf(d.foundation+":"+d.component);if(-1<l&&d.priority>>24>=g[l].priority>>24)return}if("max-bundle"===this.config.bundlePolicy&&(g=
this._candidateBuffer.filter(function(b){return d.type===b.type}).map(function(b){return b.address+":"+b.port}),l=g.indexOf(d.address+":"+d.port),-1<l))return;if("require"!==this.config.rtcpMuxPolicy||"2"!==d.component){this._candidateBuffer.push(d);if(e.config.useJingle&&(b.sdpMid||(b.sdpMid=e.pc.remoteDescription&&"offer"===e.pc.remoteDescription.type?e.remoteDescription.contents[b.sdpMLineIndex].name:e.localDescription.contents[b.sdpMLineIndex].name),e.iceCredentials.local[b.sdpMid]||h.toSessionJSON(e.pc.localDescription.sdp,
{role:e._role(),direction:"outgoing"}).contents.forEach(function(b){var f=b.transport||{};f.ufrag&&(e.iceCredentials.local[b.name]={ufrag:f.ufrag,pwd:f.pwd})}),f.jingle={contents:[{name:b.sdpMid,creator:e._role(),transport:{transportType:"iceUdp",ufrag:e.iceCredentials.local[b.sdpMid].ufrag,pwd:e.iceCredentials.local[b.sdpMid].pwd,candidates:[d]}}]},0<e.batchIceCandidates)){0===e.batchedIceCandidates.length&&window.setTimeout(function(){var b={};e.batchedIceCandidates.forEach(function(e){e=e.contents[0];
b[e.name]||(b[e.name]=e);b[e.name].transport.candidates.push(e.transport.candidates[0])});var f={jingle:{contents:[]}};Object.keys(b).forEach(function(e){f.jingle.contents.push(b[e])});e.batchedIceCandidates=[];e.emit("ice",f)},e.batchIceCandidates);e.batchedIceCandidates.push(f.jingle);return}this.emit("ice",f)}}}else this.emit("endOfCandidates")};d.prototype._onDataChannel=function(b){b=b.channel;this._remoteDataChannels.push(b);this.emit("addChannel",b)};d.prototype.createDataChannel=function(b,
e){b=this.pc.createDataChannel(b,e);this._localDataChannels.push(b);return b};d.prototype.getStats=function(){if("function"===typeof arguments[0]){var b=arguments[0];this.pc.getStats().then(function(e){b(null,e)},function(e){b(e)})}else return this.pc.getStats.apply(this.pc,arguments)};e.exports=d},{"lodash.clonedeep":36,"sdp-jingle-json":45,util:63,wildemitter:65}],45:[function(b,e,f){var d=b("./lib/tosdp"),h=b("./lib/tojson");f.toIncomingSDPOffer=function(b){return d.toSessionSDP(b,{role:"responder",
direction:"incoming"})};f.toOutgoingSDPOffer=function(b){return d.toSessionSDP(b,{role:"initiator",direction:"outgoing"})};f.toIncomingSDPAnswer=function(b){return d.toSessionSDP(b,{role:"initiator",direction:"incoming"})};f.toOutgoingSDPAnswer=function(b){return d.toSessionSDP(b,{role:"responder",direction:"outgoing"})};f.toIncomingMediaSDPOffer=function(b){return d.toMediaSDP(b,{role:"responder",direction:"incoming"})};f.toOutgoingMediaSDPOffer=function(b){return d.toMediaSDP(b,{role:"initiator",
direction:"outgoing"})};f.toIncomingMediaSDPAnswer=function(b){return d.toMediaSDP(b,{role:"initiator",direction:"incoming"})};f.toOutgoingMediaSDPAnswer=function(b){return d.toMediaSDP(b,{role:"responder",direction:"outgoing"})};f.toCandidateSDP=d.toCandidateSDP;f.toMediaSDP=d.toMediaSDP;f.toSessionSDP=d.toSessionSDP;f.toIncomingJSONOffer=function(b,e){return h.toSessionJSON(b,{role:"responder",direction:"incoming",creators:e})};f.toOutgoingJSONOffer=function(b,e){return h.toSessionJSON(b,{role:"initiator",
direction:"outgoing",creators:e})};f.toIncomingJSONAnswer=function(b,e){return h.toSessionJSON(b,{role:"initiator",direction:"incoming",creators:e})};f.toOutgoingJSONAnswer=function(b,e){return h.toSessionJSON(b,{role:"responder",direction:"outgoing",creators:e})};f.toIncomingMediaJSONOffer=function(b,e){return h.toMediaJSON(b,{role:"responder",direction:"incoming",creator:e})};f.toOutgoingMediaJSONOffer=function(b,e){return h.toMediaJSON(b,{role:"initiator",direction:"outgoing",creator:e})};f.toIncomingMediaJSONAnswer=
function(b,e){return h.toMediaJSON(b,{role:"initiator",direction:"incoming",creator:e})};f.toOutgoingMediaJSONAnswer=function(b,e){return h.toMediaJSON(b,{role:"responder",direction:"outgoing",creator:e})};f.toCandidateJSON=h.toCandidateJSON;f.toMediaJSON=h.toMediaJSON;f.toSessionJSON=h.toSessionJSON},{"./lib/tojson":48,"./lib/tosdp":49}],46:[function(b,e,f){f.lines=function(b){return b.split("\r\n").filter(function(b){return 0<b.length})};f.findLine=function(b,e,f){for(var d=b.length,g=0;g<e.length;g++)if(e[g].substr(0,
d)===b)return e[g];if(!f)return!1;for(e=0;e<f.length;e++)if(f[e].substr(0,d)===b)return f[e];return!1};f.findLines=function(b,e,f){for(var d=[],g=b.length,h=0;h<e.length;h++)e[h].substr(0,g)===b&&d.push(e[h]);if(d.length||!f)return d;for(e=0;e<f.length;e++)f[e].substr(0,g)===b&&d.push(f[e]);return d};f.mline=function(b){b=b.substr(2).split(" ");for(var e={media:b[0],port:b[1],proto:b[2],formats:[]},f=3;f<b.length;f++)b[f]&&e.formats.push(b[f]);return e};f.rtpmap=function(b){b=b.substr(9).split(" ");
var e={id:b.shift()};b=b[0].split("/");e.name=b[0];e.clockrate=b[1];e.channels=3==b.length?b[2]:"1";return e};f.sctpmap=function(b){b=b.substr(10).split(" ");return{number:b.shift(),protocol:b.shift(),streams:b.shift()}};f.fmtp=function(b){for(var e,f=b.substr(b.indexOf(" ")+1).split(";"),d=[],g=0;g<f.length;g++)e=f[g].split("="),b=e[0].trim(),e=e[1],b&&e?d.push({key:b,value:e}):b&&d.push({key:"",value:b});return d};f.crypto=function(b){b=b.substr(9).split(" ");return{tag:b[0],cipherSuite:b[1],keyParams:b[2],
sessionParams:b.slice(3).join(" ")}};f.fingerprint=function(b){b=b.substr(14).split(" ");return{hash:b[0],value:b[1]}};f.extmap=function(b){b=b.substr(9).split(" ");var e={},f=b.shift(),d=f.indexOf("/");0<=d?(e.id=f.substr(0,d),e.senders=f.substr(d+1)):(e.id=f,e.senders="sendrecv");e.uri=b.shift()||"";return e};f.rtcpfb=function(b){b=b.substr(10).split(" ");var e={};e.id=b.shift();e.type=b.shift();"trr-int"===e.type?e.value=b.shift():e.subtype=b.shift()||"";e.parameters=b;return e};f.candidate=function(b){b=
0===b.indexOf("a=candidate:")?b.substring(12).split(" "):b.substring(10).split(" ");for(var e={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:b[3],ip:b[4],port:b[5],type:b[7],generation:"0"},f=8;f<b.length;f+=2)"raddr"===b[f]?e.relAddr=b[f+1]:"rport"===b[f]?e.relPort=b[f+1]:"generation"===b[f]?e.generation=b[f+1]:"tcptype"===b[f]&&(e.tcpType=b[f+1]);e.network="1";return e};f.sourceGroups=function(b){for(var e=[],f=0;f<b.length;f++){var d=b[f].substr(13).split(" ");e.push({semantics:d.shift(),
sources:d})}return e};f.sources=function(b){for(var e=[],f={},d=0;d<b.length;d++){var g=b[d].substr(7).split(" "),E=g.shift();if(!f[E]){var D={ssrc:E,parameters:[]};e.push(D);f[E]=D}g=g.join(" ").split(":");D=g.shift();g=g.join(":")||null;f[E].parameters.push({key:D,value:g})}return e};f.groups=function(b){for(var e=[],f,d=0;d<b.length;d++)f=b[d].substr(8).split(" "),e.push({semantics:f.shift(),contents:f});return e};f.bandwidth=function(b){b=b.substr(2).split(":");var e={};e.type=b.shift();e.bandwidth=
b.shift();return e};f.msid=function(b){b=b.substr(7);var e=b.split(" ");return{msid:b,mslabel:e[0],label:e[1]}}},{}],47:[function(b,e,f){e.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",
responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],48:[function(b,e,f){var d=b("./senders"),h=b("./parsers"),l=Math.random();f._setIdCounter=function(b){l=b};f.toSessionJSON=function(b,e){var d,g=e.creators||[],l=e.role||"initiator";e=e.direction||"outgoing";
var p=b.split("\r\nm=");for(d=1;d<p.length;d++)p[d]="m="+p[d],d!==p.length-1&&(p[d]+="\r\n");var u=p.shift()+"\r\n",k=h.lines(u);b={};var m=[];for(d=0;d<p.length;d++)m.push(f.toMediaJSON(p[d],u,{role:l,direction:e,creator:g[d]||"initiator"}));b.contents=m;g=h.findLines("a=group:",k);g.length&&(b.groups=h.groups(g));return b};f.toMediaJSON=function(b,e,g){var l=g.creator||"initiator",p=g.role||"initiator",u=g.direction||"outgoing",E=h.lines(b);b=h.lines(e);e=h.mline(E[0]);l={creator:l,name:e.media,
application:{applicationType:"rtp",media:e.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==e.media&&(l.application={applicationType:"datachannel"},l.transport.sctp=[]);var k=l.application,m=l.transport;if(e=h.findLine("a=mid:",E))l.name=e.substr(6);h.findLine("a=sendrecv",E,b)?l.senders="both":h.findLine("a=sendonly",E,b)?l.senders=d[p][u].sendonly:h.findLine("a=recvonly",E,b)?l.senders=d[p][u].recvonly:
h.findLine("a=inactive",E,b)&&(l.senders="none");if("rtp"==k.applicationType){if(e=h.findLine("b=",E))k.bandwidth=h.bandwidth(e);if(e=h.findLine("a=ssrc:",E))k.ssrc=e.substr(7).split(" ")[0];h.findLines("a=rtpmap:",E).forEach(function(b){var e=h.rtpmap(b);e.parameters=[];e.feedback=[];h.findLines("a=fmtp:"+e.id,E).forEach(function(b){e.parameters=h.fmtp(b)});h.findLines("a=rtcp-fb:"+e.id,E).forEach(function(b){e.feedback.push(h.rtcpfb(b))});k.payloads.push(e)});h.findLines("a=crypto:",E,b).forEach(function(b){k.encryption.push(h.crypto(b))});
h.findLine("a=rtcp-mux",E)&&(k.mux=!0);h.findLines("a=rtcp-fb:*",E).forEach(function(b){k.feedback.push(h.rtcpfb(b))});h.findLines("a=extmap:",E).forEach(function(b){b=h.extmap(b);b.senders=d[p][u][b.senders];k.headerExtensions.push(b)});e=h.findLines("a=ssrc-group:",E);k.sourceGroups=h.sourceGroups(e||[]);e=h.findLines("a=ssrc:",E);var n=k.sources=h.sources(e||[]);if(e=h.findLine("a=msid:",E)){var t=h.msid(e);["msid","mslabel","label"].forEach(function(b){for(var e=0;e<n.length;e++){for(var f=!1,
d=0;d<n[e].parameters.length;d++)n[e].parameters[d].key===b&&(f=!0);f||n[e].parameters.push({key:b,value:t[b]})}})}h.findLine("a=x-google-flag:conference",E,b)&&(k.googConferenceFlag=!0)}e=h.findLines("a=fingerprint:",E,b);var q=h.findLine("a=setup:",E,b);e.forEach(function(b){b=h.fingerprint(b);q&&(b.setup=q.substr(8));m.fingerprints.push(b)});e=h.findLine("a=ice-ufrag:",E,b);g=h.findLine("a=ice-pwd:",E,b);e&&g&&(m.ufrag=e.substr(12),m.pwd=g.substr(10),m.candidates=[],h.findLines("a=candidate:",
E,b).forEach(function(b){m.candidates.push(f.toCandidateJSON(b))}));"datachannel"==k.applicationType&&h.findLines("a=sctpmap:",E).forEach(function(b){b=h.sctpmap(b);m.sctp.push(b)});return l};f.toCandidateJSON=function(b){b=h.candidate(b.split("\r\n")[0]);b.id=(l++).toString(36).substr(0,12);return b}},{"./parsers":46,"./senders":47}],49:[function(b,e,f){var d=b("./senders");f.toSessionSDP=function(b,e){var d=e.sid||b.sid||Date.now(),g=e.time||Date.now(),h=["v=0","o=- "+d+" "+g+" IN IP4 0.0.0.0",
"s=-","t=0 0"];d=b.contents||[];var l=!1;d.forEach(function(b){b.application.sources&&b.application.sources.length&&(l=!0)});l&&h.push("a=msid-semantic: WMS *");(b.groups||[]).forEach(function(b){h.push("a=group:"+b.semantics+" "+b.contents.join(" "))});d.forEach(function(b){h.push(f.toMediaSDP(b,e))});return h.join("\r\n")+"\r\n"};f.toMediaSDP=function(b,e){var g=[],h=e.role||"initiator",l=e.direction||"outgoing",D=b.application;e=b.transport;var r=D.payloads||[],k=e&&e.fingerprints||[],m=[];"datachannel"==
D.applicationType?(m.push("application"),m.push("1"),m.push("DTLS/SCTP"),e.sctp&&e.sctp.forEach(function(b){m.push(b.number)})):(m.push(D.media),m.push("1"),0<k.length?m.push("UDP/TLS/RTP/SAVPF"):D.encryption&&0<D.encryption.length?m.push("RTP/SAVPF"):m.push("RTP/AVPF"),r.forEach(function(b){m.push(b.id)}));g.push("m="+m.join(" "));g.push("c=IN IP4 0.0.0.0");D.bandwidth&&D.bandwidth.type&&D.bandwidth.bandwidth&&g.push("b="+D.bandwidth.type+":"+D.bandwidth.bandwidth);"rtp"==D.applicationType&&g.push("a=rtcp:1 IN IP4 0.0.0.0");
e&&(e.ufrag&&g.push("a=ice-ufrag:"+e.ufrag),e.pwd&&g.push("a=ice-pwd:"+e.pwd),k.forEach(function(b){g.push("a=fingerprint:"+b.hash+" "+b.value);b.setup&&g.push("a=setup:"+b.setup)}),e.sctp&&e.sctp.forEach(function(b){g.push("a=sctpmap:"+b.number+" "+b.protocol+" "+b.streams)}));"rtp"==D.applicationType&&g.push("a="+(d[h][l][b.senders]||"sendrecv"));g.push("a=mid:"+b.name);D.sources&&D.sources.length&&(D.sources[0].parameters||[]).forEach(function(b){"msid"===b.key&&g.push("a=msid:"+b.value)});D.mux&&
g.push("a=rtcp-mux");(D.encryption||[]).forEach(function(b){g.push("a=crypto:"+b.tag+" "+b.cipherSuite+" "+b.keyParams+(b.sessionParams?" "+b.sessionParams:""))});D.googConferenceFlag&&g.push("a=x-google-flag:conference");r.forEach(function(b){var e="a=rtpmap:"+b.id+" "+b.name+"/"+b.clockrate;b.channels&&"1"!=b.channels&&(e+="/"+b.channels);g.push(e);if(b.parameters&&b.parameters.length){e=["a=fmtp:"+b.id];var f=[];b.parameters.forEach(function(b){f.push((b.key?b.key+"=":"")+b.value)});e.push(f.join(";"));
g.push(e.join(" "))}b.feedback&&b.feedback.forEach(function(e){"trr-int"===e.type?g.push("a=rtcp-fb:"+b.id+" trr-int "+(e.value?e.value:"0")):g.push("a=rtcp-fb:"+b.id+" "+e.type+(e.subtype?" "+e.subtype:""))})});D.feedback&&D.feedback.forEach(function(b){"trr-int"===b.type?g.push("a=rtcp-fb:* trr-int "+(b.value?b.value:"0")):g.push("a=rtcp-fb:* "+b.type+(b.subtype?" "+b.subtype:""))});(D.headerExtensions||[]).forEach(function(b){g.push("a=extmap:"+b.id+(b.senders?"/"+d[h][l][b.senders]:"")+" "+b.uri)});
(D.sourceGroups||[]).forEach(function(b){g.push("a=ssrc-group:"+b.semantics+" "+b.sources.join(" "))});(D.sources||[]).forEach(function(b){for(var e=0;e<b.parameters.length;e++){var f=b.parameters[e];g.push("a=ssrc:"+(b.ssrc||D.ssrc)+" "+f.key+(f.value?":"+f.value:""))}});(e.candidates||[]).forEach(function(b){g.push(f.toCandidateSDP(b))});return g.join("\r\n")};f.toCandidateSDP=function(b){var e=[];e.push(b.foundation);e.push(b.component);e.push(b.protocol.toUpperCase());e.push(b.priority);e.push(b.ip);
e.push(b.port);var f=b.type;e.push("typ");e.push(f);("srflx"===f||"prflx"===f||"relay"===f)&&b.relAddr&&b.relPort&&(e.push("raddr"),e.push(b.relAddr),e.push("rport"),e.push(b.relPort));b.tcpType&&"TCP"==b.protocol.toUpperCase()&&(e.push("tcptype"),e.push(b.tcpType));e.push("generation");e.push(b.generation||"0");return"a=candidate:"+e.join(" ")}},{"./senders":47}],50:[function(b,e,f){e.exports=b("./lib/")},{"./lib/":51}],51:[function(b,e,f){function d(b,e){"object"==typeof b&&(e=b,b=void 0);e=e||
{};b=h(b);var f=b.source,d=b.id;e.forceNew||e["force new connection"]||!1===e.multiplex?(u("ignoring socket cache for %s",f),e=p(f,e)):(E[d]||(u("new io instance for %s",f),E[d]=p(f,e)),e=E[d]);return e.socket(b.path)}var h=b("./url"),l=b("socket.io-parser"),p=b("./manager"),u=b("debug")("socket.io-client");e.exports=f=d;var E=f.managers={};f.protocol=l.protocol;f.connect=d;f.Manager=b("./manager");f.Socket=b("./socket")},{"./manager":52,"./socket":54,"./url":55,debug:10,"socket.io-parser":57}],52:[function(b,
e,f){function d(b,e){if(!(this instanceof d))return new d(b,e);b&&"object"==typeof b&&(e=b,b=void 0);e=e||{};e.path=e.path||"/socket.io";this.nsps={};this.subs=[];this.opts=e;this.reconnection(!1!==e.reconnection);this.reconnectionAttempts(e.reconnectionAttempts||Infinity);this.reconnectionDelay(e.reconnectionDelay||1E3);this.reconnectionDelayMax(e.reconnectionDelayMax||5E3);this.randomizationFactor(e.randomizationFactor||.5);this.backoff=new k({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==e.timeout?2E4:e.timeout);this.readyState="closed";this.uri=b;this.connected=[];this.encoding=!1;this.packetBuffer=[];this.encoder=new p.Encoder;this.decoder=new p.Decoder;(this.autoConnect=!1!==e.autoConnect)&&this.open()}b("./url");var h=b("engine.io-client"),l=b("./socket");f=b("component-emitter");var p=b("socket.io-parser"),u=b("./on"),E=b("component-bind");b("object-component");var D=b("debug")("socket.io-client:manager"),r=b("indexof"),
k=b("backo2");e.exports=d;d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var b in this.nsps)this.nsps[b].emit.apply(this.nsps[b],arguments)};d.prototype.updateSocketIds=function(){for(var b in this.nsps)this.nsps[b].id=this.engine.id};f(d.prototype);d.prototype.reconnection=function(b){if(!arguments.length)return this._reconnection;this._reconnection=!!b;return this};d.prototype.reconnectionAttempts=function(b){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=
b;return this};d.prototype.reconnectionDelay=function(b){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=b;this.backoff&&this.backoff.setMin(b);return this};d.prototype.randomizationFactor=function(b){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=b;this.backoff&&this.backoff.setJitter(b);return this};d.prototype.reconnectionDelayMax=function(b){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=b;this.backoff&&
this.backoff.setMax(b);return this};d.prototype.timeout=function(b){if(!arguments.length)return this._timeout;this._timeout=b;return this};d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};d.prototype.open=d.prototype.connect=function(b){D("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;D("opening %s",this.uri);var e=this.engine=h(this.uri,this.opts),f=this;this.readyState="opening";this.skipReconnect=
!1;var d=u(e,"open",function(){f.onopen();b&&b()}),g=u(e,"error",function(e){D("connect_error");f.cleanup();f.readyState="closed";f.emitAll("connect_error",e);if(b){var d=Error("Connection error");d.data=e;b(d)}else f.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;D("connect attempt will timeout after %d",l);var p=setTimeout(function(){D("connect attempt timed out after %d",l);d.destroy();e.close();e.emit("error","timeout");f.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(p)}})}this.subs.push(d);
this.subs.push(g);return this};d.prototype.onopen=function(){D("open");this.cleanup();this.readyState="open";this.emit("open");var b=this.engine;this.subs.push(u(b,"data",E(this,"ondata")));this.subs.push(u(this.decoder,"decoded",E(this,"ondecoded")));this.subs.push(u(b,"error",E(this,"onerror")));this.subs.push(u(b,"close",E(this,"onclose")))};d.prototype.ondata=function(b){this.decoder.add(b)};d.prototype.ondecoded=function(b){this.emit("packet",b)};d.prototype.onerror=function(b){D("error",b);
this.emitAll("error",b)};d.prototype.socket=function(b){var e=this.nsps[b];if(!e){e=new l(this,b);this.nsps[b]=e;var f=this;e.on("connect",function(){e.id=f.engine.id;~r(f.connected,e)||f.connected.push(e)})}return e};d.prototype.destroy=function(b){b=r(this.connected,b);~b&&this.connected.splice(b,1);this.connected.length||this.close()};d.prototype.packet=function(b){D("writing packet %j",b);var e=this;e.encoding?e.packetBuffer.push(b):(e.encoding=!0,this.encoder.encode(b,function(b){for(var f=0;f<
b.length;f++)e.engine.write(b[f]);e.encoding=!1;e.processPacketQueue()}))};d.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var b=this.packetBuffer.shift();this.packet(b)}};d.prototype.cleanup=function(){for(var b;b=this.subs.shift();)b.destroy();this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};d.prototype.close=d.prototype.disconnect=function(){this.skipReconnect=!0;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};
d.prototype.onclose=function(b){D("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",b);this._reconnection&&!this.skipReconnect&&this.reconnect()};d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var b=this;if(this.backoff.attempts>=this._reconnectionAttempts)D("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();D("will wait %dms before reconnect attempt",
e);this.reconnecting=!0;var f=setTimeout(function(){b.skipReconnect||(D("attempting reconnect"),b.emitAll("reconnect_attempt",b.backoff.attempts),b.emitAll("reconnecting",b.backoff.attempts),b.skipReconnect||b.open(function(e){e?(D("reconnect attempt error"),b.reconnecting=!1,b.reconnect(),b.emitAll("reconnect_error",e.data)):(D("reconnect success"),b.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(f)}})}};d.prototype.onreconnect=function(){var b=this.backoff.attempts;this.reconnecting=
!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",b)}},{"./on":53,"./socket":54,"./url":55,backo2:4,"component-bind":7,"component-emitter":8,debug:10,"engine.io-client":11,indexof:32,"object-component":39,"socket.io-parser":57}],53:[function(b,e,f){e.exports=function(b,e,f){b.on(e,f);return{destroy:function(){b.removeListener(e,f)}}}},{}],54:[function(b,e,f){function d(b,e){this.io=b;this.nsp=e;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&this.open();this.receiveBuffer=
[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0}var h=b("socket.io-parser");f=b("component-emitter");var l=b("to-array"),p=b("./on"),u=b("component-bind"),E=b("debug")("socket.io-client:socket"),D=b("has-binary");e.exports=d;var r={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},k=f.prototype.emit;f(d.prototype);d.prototype.subEvents=function(){if(!this.subs){var b=this.io;this.subs=
[p(b,"open",u(this,"onopen")),p(b,"packet",u(this,"onpacket")),p(b,"close",u(this,"onclose"))]}};d.prototype.open=d.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};d.prototype.send=function(){var b=l(arguments);b.unshift("message");this.emit.apply(this,b);return this};d.prototype.emit=function(b){if(r.hasOwnProperty(b))return k.apply(this,arguments),this;var e=l(arguments),f=h.EVENT;D(e)&&(f=h.BINARY_EVENT);
f={type:f,data:e};"function"==typeof e[e.length-1]&&(E("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),f.id=this.ids++);this.connected?this.packet(f):this.sendBuffer.push(f);return this};d.prototype.packet=function(b){b.nsp=this.nsp;this.io.packet(b)};d.prototype.onopen=function(){E("transport is open - connecting");"/"!=this.nsp&&this.packet({type:h.CONNECT})};d.prototype.onclose=function(b){E("close (%s)",b);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",
b)};d.prototype.onpacket=function(b){if(b.nsp==this.nsp)switch(b.type){case h.CONNECT:this.onconnect();break;case h.EVENT:this.onevent(b);break;case h.BINARY_EVENT:this.onevent(b);break;case h.ACK:this.onack(b);break;case h.BINARY_ACK:this.onack(b);break;case h.DISCONNECT:this.ondisconnect();break;case h.ERROR:this.emit("error",b.data)}};d.prototype.onevent=function(b){var e=b.data||[];E("emitting event %j",e);null!=b.id&&(E("attaching ack callback to event"),e.push(this.ack(b.id)));this.connected?
k.apply(this,e):this.receiveBuffer.push(e)};d.prototype.ack=function(b){var e=this,f=!1;return function(){if(!f){f=!0;var d=l(arguments);E("sending ack %j",d);var g=D(d)?h.BINARY_ACK:h.ACK;e.packet({type:g,id:b,data:d})}}};d.prototype.onack=function(b){E("calling ack %s with %j",b.id,b.data);this.acks[b.id].apply(this,b.data);delete this.acks[b.id]};d.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};d.prototype.emitBuffered=function(){var b;
for(b=0;b<this.receiveBuffer.length;b++)k.apply(this,this.receiveBuffer[b]);this.receiveBuffer=[];for(b=0;b<this.sendBuffer.length;b++)this.packet(this.sendBuffer[b]);this.sendBuffer=[]};d.prototype.ondisconnect=function(){E("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};d.prototype.destroy=function(){if(this.subs){for(var b=0;b<this.subs.length;b++)this.subs[b].destroy();this.subs=null}this.io.destroy(this)};d.prototype.close=d.prototype.disconnect=function(){this.connected&&
(E("performing disconnect (%s)",this.nsp),this.packet({type:h.DISCONNECT}));this.destroy();if(this.connected)this.onclose("io client disconnect");return this}},{"./on":53,"component-bind":7,"component-emitter":8,debug:10,"has-binary":30,"socket.io-parser":57,"to-array":59}],55:[function(b,e,f){(function(f){var d=b("parseuri"),g=b("debug")("socket.io-client:url");e.exports=function(b,e){var h=b;e=e||f.location;null==b&&(b=e.protocol+"//"+e.host);"string"==typeof b&&("/"==b.charAt(0)&&(b="/"==b.charAt(1)?
e.protocol+b:e.hostname+b),/^(https?|wss?):\/\//.test(b)||(g("protocol-less url %s",b),b="undefined"!=typeof e?e.protocol+"//"+b:"https://"+b),g("parse %s",b),h=d(b));h.port||(/^(http|ws)$/.test(h.protocol)?h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443"));h.path=h.path||"/";h.id=h.protocol+"://"+h.host+":"+h.port;h.href=h.protocol+"://"+h.host+(e&&e.port==h.port?"":":"+h.port);return h}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?
window:{})},{debug:10,parseuri:42}],56:[function(b,e,f){(function(e){var d=b("isarray"),g=b("./is-buffer");f.deconstructPacket=function(b){function e(b){if(!b)return b;if(g(b)){var h={_placeholder:!0,num:f.length};f.push(b);return h}if(d(b)){h=Array(b.length);for(var l=0;l<b.length;l++)h[l]=e(b[l]);return h}if("object"==typeof b&&!(b instanceof Date)){h={};for(l in b)h[l]=e(b[l]);return h}return b}var f=[];b.data=e(b.data);b.attachments=f.length;return{packet:b,buffers:f}};f.reconstructPacket=function(b,
e){function f(b){if(b&&b._placeholder)return e[b.num];if(d(b))for(var g=0;g<b.length;g++)b[g]=f(b[g]);else if(b&&"object"==typeof b)for(g in b)b[g]=f(b[g]);return b}b.data=f(b.data);b.attachments=void 0;return b};f.removeBlobs=function(b,f){function h(b,u,D){if(!b)return b;if(e.Blob&&b instanceof Blob||e.File&&b instanceof File){l++;var r=new FileReader;r.onload=function(){D?D[u]=this.result:p=this.result;--l||f(p)};r.readAsArrayBuffer(b)}else if(d(b))for(r=0;r<b.length;r++)h(b[r],r,b);else if(b&&
"object"==typeof b&&!g(b))for(r in b)h(b[r],r,b)}var l=0,p=b;h(p);l||f(p)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./is-buffer":58,isarray:33}],57:[function(b,e,f){function d(){}function h(b){var e=!1;var d=""+b.type;if(f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type)d+=b.attachments,d+="-";b.nsp&&"/"!=b.nsp&&(e=!0,d+=b.nsp);null!=b.id&&(e&&(d+=",",e=!1),d+=b.id);null!=b.data&&(e&&(d+=","),d+=D.stringify(b.data));E("encoded %j as %s",
b,d);return d}function l(b,e){r.removeBlobs(b,function(b){var f=r.deconstructPacket(b);b=h(f.packet);f=f.buffers;f.unshift(b);e(f)})}function p(){this.reconstructor=null}function u(b){this.reconPack=b;this.buffers=[]}var E=b("debug")("socket.io-parser"),D=b("json3");b("isarray");e=b("component-emitter");var r=b("./binary"),k=b("./is-buffer");f.protocol=4;f.types="CONNECT DISCONNECT EVENT BINARY_EVENT ACK BINARY_ACK ERROR".split(" ");f.CONNECT=0;f.DISCONNECT=1;f.EVENT=2;f.ACK=3;f.ERROR=4;f.BINARY_EVENT=
5;f.BINARY_ACK=6;f.Encoder=d;f.Decoder=p;d.prototype.encode=function(b,e){E("encoding packet %j",b);f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type?l(b,e):(b=h(b),e([b]))};e(p.prototype);p.prototype.add=function(b){if("string"==typeof b){a:{var e={},d=0;e.type=Number(b.charAt(0));if(null==f.types[e.type])b={type:f.ERROR,data:"parser error"};else{if(f.BINARY_EVENT==e.type||f.BINARY_ACK==e.type){for(var g="";"-"!=b.charAt(++d)&&(g+=b.charAt(d),d!=b.length););if(g!=Number(g)||"-"!=b.charAt(d))throw Error("Illegal attachments");
e.attachments=Number(g)}if("/"==b.charAt(d+1))for(e.nsp="";++d;){g=b.charAt(d);if(","==g)break;e.nsp+=g;if(d==b.length)break}else e.nsp="/";g=b.charAt(d+1);if(""!==g&&Number(g)==g){for(e.id="";++d;){g=b.charAt(d);if(null==g||Number(g)!=g){--d;break}e.id+=b.charAt(d);if(d==b.length)break}e.id=Number(e.id)}if(b.charAt(++d))try{e.data=D.parse(b.substr(d))}catch(fh){b={type:f.ERROR,data:"parser error"};break a}E("decoded %s as %j",b,e);b=e}}f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type?(this.reconstructor=
new u(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else if(k(b)||b.base64)if(this.reconstructor){if(b=this.reconstructor.takeBinaryData(b))this.reconstructor=null,this.emit("decoded",b)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+b);};p.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};u.prototype.takeBinaryData=function(b){this.buffers.push(b);
return this.buffers.length==this.reconPack.attachments?(b=r.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),b):null};u.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},{"./binary":56,"./is-buffer":58,"component-emitter":8,debug:10,isarray:33,json3:34}],58:[function(b,e,f){(function(b){e.exports=function(e){return b.Buffer&&b.Buffer.isBuffer(e)||b.ArrayBuffer&&e instanceof ArrayBuffer}}).call(this,"undefined"!==typeof global?global:"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{}],59:[function(b,e,f){e.exports=function(b,e){for(var f=[],d=(e=e||0)||0;d<b.length;d++)f[d-e]=b[d];return f}},{}],60:[function(b,e,f){(function(b){(function(d){function g(b){for(var e=[],f=0,d=b.length,g,h;f<d;)g=b.charCodeAt(f++),55296<=g&&56319>=g&&f<d?(h=b.charCodeAt(f++),56320==(h&64512)?e.push(((g&1023)<<10)+(h&1023)+65536):(e.push(g),f--)):e.push(g);return e}function h(b){if(55296<=b&&57343>=b)throw Error("Lone surrogate U+"+b.toString(16).toUpperCase()+
" is not a scalar value");}function u(){if(q>=t)throw Error("Invalid byte index");var b=n[q]&255;q++;if(128==(b&192))return b&63;throw Error("Invalid continuation byte");}function E(){if(q>t)throw Error("Invalid byte index");if(q==t)return!1;var b=n[q]&255;q++;if(0==(b&128))return b;if(192==(b&224)){var e=u();b=(b&31)<<6|e;if(128<=b)return b;throw Error("Invalid continuation byte");}if(224==(b&240)){e=u();var f=u();b=(b&15)<<12|e<<6|f;if(2048<=b)return h(b),b;throw Error("Invalid continuation byte");
}if(240==(b&248)){e=u();f=u();var d=u();b=(b&15)<<18|e<<12|f<<6|d;if(65536<=b&&1114111>=b)return b}throw Error("Invalid UTF-8 detected");}var D="object"==typeof f&&f,r="object"==typeof e&&e&&e.exports==D&&e,k="object"==typeof b&&b;if(k.global===k||k.window===k)d=k;var m=String.fromCharCode,n,t,q;k={version:"2.0.0",encode:function(b){b=g(b);for(var e=b.length,f=-1,d,l="";++f<e;){d=b[f];if(0==(d&4294967168))d=m(d);else{var p="";0==(d&4294965248)?p=m(d>>6&31|192):0==(d&4294901760)?(h(d),p=m(d>>12&15|
224),p+=m(d>>6&63|128)):0==(d&4292870144)&&(p=m(d>>18&7|240),p+=m(d>>12&63|128),p+=m(d>>6&63|128));d=p+=m(d&63|128)}l+=d}return l},decode:function(b){n=g(b);t=n.length;q=0;b=[];for(var e;!1!==(e=E());)b.push(e);e=b.length;for(var f=-1,d,h="";++f<e;)d=b[f],65535<d&&(d-=65536,h+=m(d>>>10&1023|55296),d=56320|d&1023),h+=m(d);return h}};if(D&&!D.nodeType)if(r)r.exports=k;else{d={}.hasOwnProperty;for(var x in k)d.call(k,x)&&(D[x]=k[x])}else d.utf8=k})(this)}).call(this,"undefined"!==typeof global?global:
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],61:[function(b,e,f){e.exports="function"===typeof Object.create?function(b,e){b.super_=e;b.prototype=Object.create(e.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,e){b.super_=e;var f=function(){};f.prototype=e.prototype;b.prototype=new f;b.prototype.constructor=b}},{}],62:[function(b,e,f){e.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===
typeof b.fill&&"function"===typeof b.readUInt8}},{}],63:[function(b,e,f){(function(e,d){function g(b,e){var d={seen:[],stylize:u};3<=arguments.length&&(d.depth=arguments[2]);4<=arguments.length&&(d.colors=arguments[3]);x(e)?d.showHidden=e:e&&f._extend(d,e);w(d.showHidden)&&(d.showHidden=!1);w(d.depth)&&(d.depth=2);w(d.colors)&&(d.colors=!1);w(d.customInspect)&&(d.customInspect=!0);d.colors&&(d.stylize=h);return D(d,b,d.depth)}function h(b,e){return(e=g.styles[e])?"\u001b["+g.colors[e][0]+"m"+b+"\u001b["+
g.colors[e][1]+"m":b}function u(b,e){return b}function E(b){var e={};b.forEach(function(b,f){e[b]=!0});return e}function D(b,e,d){if(b.customInspect&&e&&G(e.inspect)&&e.inspect!==f.inspect&&(!e.constructor||e.constructor.prototype!==e)){var g=e.inspect(d,b);A(g)||(g=D(b,g,d));return g}if(g=r(b,e))return g;var h=Object.keys(e),l=E(h);b.showHidden&&(h=Object.getOwnPropertyNames(e));if(B(e)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return k(e);if(0===h.length){if(G(e))return b.stylize("[Function"+
(e.name?": "+e.name:"")+"]","special");if(y(e))return b.stylize(RegExp.prototype.toString.call(e),"regexp");if(H(e))return b.stylize(Date.prototype.toString.call(e),"date");if(B(e))return k(e)}g="";var p=!1,u=["{","}"];q(e)&&(p=!0,u=["[","]"]);G(e)&&(g=" [Function"+(e.name?": "+e.name:"")+"]");y(e)&&(g=" "+RegExp.prototype.toString.call(e));H(e)&&(g=" "+Date.prototype.toUTCString.call(e));B(e)&&(g=" "+k(e));if(0===h.length&&(!p||0==e.length))return u[0]+g+u[1];if(0>d)return y(e)?b.stylize(RegExp.prototype.toString.call(e),
"regexp"):b.stylize("[Object]","special");b.seen.push(e);h=p?m(b,e,d,l,h):h.map(function(f){return n(b,e,d,l,f,p)});b.seen.pop();return t(h,g,u)}function r(b,e){if(w(e))return b.stylize("undefined","undefined");if(A(e))return e="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",b.stylize(e,"string");if(v(e))return b.stylize(""+e,"number");if(x(e))return b.stylize(""+e,"boolean");if(null===e)return b.stylize("null","null")}function k(b){return"["+Error.prototype.toString.call(b)+
"]"}function m(b,e,f,d,g){for(var h=[],l=0,p=e.length;l<p;++l)Object.prototype.hasOwnProperty.call(e,String(l))?h.push(n(b,e,f,d,String(l),!0)):h.push("");g.forEach(function(g){g.match(/^\d+$/)||h.push(n(b,e,f,d,g,!0))});return h}function n(b,e,f,d,g,h){var l,p;e=Object.getOwnPropertyDescriptor(e,g)||{value:e[g]};e.get?p=e.set?b.stylize("[Getter/Setter]","special"):b.stylize("[Getter]","special"):e.set&&(p=b.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(d,g)||(l="["+g+"]");p||
(0>b.seen.indexOf(e.value)?(p=null===f?D(b,e.value,null):D(b,e.value,f-1),-1<p.indexOf("\n")&&(p=h?p.split("\n").map(function(b){return"  "+b}).join("\n").substr(2):"\n"+p.split("\n").map(function(b){return"   "+b}).join("\n"))):p=b.stylize("[Circular]","special"));if(w(l)){if(h&&g.match(/^\d+$/))return p;l=JSON.stringify(""+g);l.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(l=l.substr(1,l.length-2),l=b.stylize(l,"name")):(l=l.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),l=b.stylize(l,
"string"))}return l+": "+p}function t(b,e,f){var d=0;return 60<b.reduce(function(b,e){d++;0<=e.indexOf("\n")&&d++;return b+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?f[0]+(""===e?"":e+"\n ")+" "+b.join(",\n  ")+" "+f[1]:f[0]+e+" "+b.join(", ")+" "+f[1]}function q(b){return Array.isArray(b)}function x(b){return"boolean"===typeof b}function v(b){return"number"===typeof b}function A(b){return"string"===typeof b}function w(b){return void 0===b}function y(b){return z(b)&&"[object RegExp]"===Object.prototype.toString.call(b)}
function z(b){return"object"===typeof b&&null!==b}function H(b){return z(b)&&"[object Date]"===Object.prototype.toString.call(b)}function B(b){return z(b)&&("[object Error]"===Object.prototype.toString.call(b)||b instanceof Error)}function G(b){return"function"===typeof b}function F(b){return 10>b?"0"+b.toString(10):b.toString(10)}function C(){var b=new Date,e=[F(b.getHours()),F(b.getMinutes()),F(b.getSeconds())].join(":");return[b.getDate(),P[b.getMonth()],e].join(" ")}var I=/%[sdj%]/g;f.format=
function(b){if(!A(b)){for(var e=[],f=0;f<arguments.length;f++)e.push(g(arguments[f]));return e.join(" ")}f=1;var d=arguments,h=d.length;e=String(b).replace(I,function(b){if("%%"===b)return"%";if(f>=h)return b;switch(b){case "%s":return String(d[f++]);case "%d":return Number(d[f++]);case "%j":try{return JSON.stringify(d[f++])}catch(gn){return"[Circular]"}default:return b}});for(var l=d[f];f<h;l=d[++f])e=null!==l&&z(l)?e+(" "+g(l)):e+(" "+l);return e};f.deprecate=function(b,g){if(w(d.process))return function(){return f.deprecate(b,
g).apply(this,arguments)};if(!0===e.noDeprecation)return b;var h=!1;return function(){if(!h){if(e.throwDeprecation)throw Error(g);e.traceDeprecation?console.trace(g):console.error(g);h=!0}return b.apply(this,arguments)}};var Q={},L;f.debuglog=function(b){w(L)&&(L=e.env.NODE_DEBUG||"");b=b.toUpperCase();if(!Q[b])if((new RegExp("\\b"+b+"\\b","i")).test(L)){var d=e.pid;Q[b]=function(){var e=f.format.apply(f,arguments);console.error("%s %d: %s",b,d,e)}}else Q[b]=function(){};return Q[b]};f.inspect=g;
g.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};g.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};f.isArray=q;f.isBoolean=x;f.isNull=function(b){return null===b};f.isNullOrUndefined=function(b){return null==b};f.isNumber=v;f.isString=A;f.isSymbol=function(b){return"symbol"===
typeof b};f.isUndefined=w;f.isRegExp=y;f.isObject=z;f.isDate=H;f.isError=B;f.isFunction=G;f.isPrimitive=function(b){return null===b||"boolean"===typeof b||"number"===typeof b||"string"===typeof b||"symbol"===typeof b||"undefined"===typeof b};f.isBuffer=b("./support/isBuffer");var P="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");f.log=function(){console.log("%s - %s",C(),f.format.apply(f,arguments))};f.inherits=b("inherits");f._extend=function(b,e){if(!e||!z(e))return b;for(var f=Object.keys(e),
d=f.length;d--;)b[f[d]]=e[f[d]];return b}}).call(this,b("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":62,_process:43,inherits:61}],64:[function(b,e,f){if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){var d="moz";var h=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)d="webkit",h=navigator.userAgent.match(/Chrom(e|ium)/)&&
parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10);b=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;f=window.mozRTCIceCandidate||window.RTCIceCandidate;var l=window.mozRTCSessionDescription||window.RTCSessionDescription,p=window.webkitMediaStream||window.MediaStream,u="https:"===window.location.protocol&&("webkit"===d&&26<=h||"moz"===d&&33<=h),E=window.AudioContext||window.webkitAudioContext,D=document.createElement("video");D=D&&D.canPlayType&&
"probably"===D.canPlayType('video/webm; codecs="vp8", vorbis');var r=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;e.exports={prefix:d,browserVersion:h,support:!!b&&!!r,supportRTCPeerConnection:!!b,supportVp8:D,supportGetUserMedia:!!r,supportDataChannel:!!(b&&b.prototype&&b.prototype.createDataChannel),supportWebAudio:!(!E||!E.prototype.createMediaStreamSource),supportMediaStream:!(!p||!p.prototype.removeTrack),supportScreenSharing:!!u,AudioContext:E,
PeerConnection:b,SessionDescription:l,IceCandidate:f,MediaStream:p,getUserMedia:r}},{}],65:[function(b,e,f){function d(){}e.exports=d;d.mixin=function(b){b=b.prototype||b;b.isWildEmitter=!0;b.on=function(b,e,f){this.callbacks=this.callbacks||{};var d=3===arguments.length,g=d?arguments[2]:arguments[1];g._groupName=d?arguments[1]:void 0;(this.callbacks[b]=this.callbacks[b]||[]).push(g);return this};b.once=function(b,e,f){function d(){g.off(b,d);l.apply(this,arguments)}var g=this,h=3===arguments.length,
l=h?arguments[2]:arguments[1];this.on(b,h?arguments[1]:void 0,d);return this};b.releaseGroup=function(b){this.callbacks=this.callbacks||{};var e,f;for(e in this.callbacks){var d=this.callbacks[e];var g=0;for(f=d.length;g<f;g++)d[g]._groupName===b&&(d.splice(g,1),g--,f--)}return this};b.off=function(b,e){this.callbacks=this.callbacks||{};var f=this.callbacks[b];if(!f)return this;if(1===arguments.length)return delete this.callbacks[b],this;var d=f.indexOf(e);f.splice(d,1);0===f.length&&delete this.callbacks[b];
return this};b.emit=function(b){this.callbacks=this.callbacks||{};var e=[].slice.call(arguments,1),f=this.callbacks[b],d=this.getWildcardCallbacks(b),g;if(f){var h=f.slice();f=0;for(g=h.length;f<g&&h[f];++f)h[f].apply(this,e)}if(d)for(h=d.slice(),f=0,g=h.length;f<g&&h[f];++f)h[f].apply(this,[b].concat(e));return this};b.getWildcardCallbacks=function(b){this.callbacks=this.callbacks||{};var e,f=[];for(e in this.callbacks){var d=e.split("*");if("*"===e||2===d.length&&b.slice(0,d[0].length)===d[0])f=
f.concat(this.callbacks[e])}return f}};d.mixin(d)},{}],66:[function(b,e,f){function d(b,e,f){return e?new h(b,e):new h(b)}b=window;var h=b.WebSocket||b.MozWebSocket;e.exports=h?d:null;h&&(d.prototype=h.prototype)},{}],67:[function(b,e,f){function d(b){var e=!0;b.getTracks().forEach(function(b){e="ended"===b.readyState&&e});return e}function h(b){var e=this;u.call(this);this.id=b.id;this.parent=b.parent;this.type=b.type||"video";this.oneway=b.oneway||!1;this.sharemyscreen=b.sharemyscreen||!1;this.browserPrefix=
b.prefix;this.stream=b.stream;this.enableDataChannels=void 0===b.enableDataChannels?this.parent.config.enableDataChannels:b.enableDataChannels;this.receiveMedia=b.receiveMedia||this.parent.config.receiveMedia;this.channels={};this.sid=b.sid||Date.now().toString();this.pc=new p(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints);this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("endOfCandidates",function(b){e.send("endOfCandidates",b)});this.pc.on("offer",
function(b){e.parent.config.nick&&(b.nick=e.parent.config.nick);e.send("offer",b)});this.pc.on("answer",function(b){e.parent.config.nick&&(b.nick=e.parent.config.nick);e.send("answer",b)});this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this));this.pc.on("addChannel",this.handleDataChannelAdded.bind(this));this.pc.on("removeStream",this.handleStreamRemoved.bind(this));this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded"));this.pc.on("iceConnectionStateChange",this.emit.bind(this,
"iceConnectionStateChange"));this.pc.on("iceConnectionStateChange",function(){switch(e.pc.iceConnectionState){case "failed":"offer"===e.pc.pc.localDescription.type&&(e.parent.emit("iceFailed",e),e.send("connectivityError"))}});this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange"));this.logger=this.parent.logger;"screen"===b.type?this.parent.localScreens&&this.parent.localScreens[0]&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),this.pc.addStream(this.parent.localScreens[0]),
this.broadcaster=b.broadcaster):this.parent.localStreams.forEach(function(b){e.pc.addStream(b)});this.on("channelOpen",function(b){"https://simplewebrtc.com/protocol/filetransfer#inband-v1"===b.protocol&&(b.onmessage=function(f){f=JSON.parse(f.data);var d=new k.Receiver;d.receive(f,b);e.emit("fileTransfer",f,d);d.on("receivedFile",function(b,e){d.channel.close()})})});this.on("*",function(){e.parent.emit.apply(e.parent,arguments)})}f=b("util");var l=b("webrtcsupport"),p=b("rtcpeerconnection"),u=b("wildemitter"),
k=b("filetransfer");f.inherits(h,u);h.prototype.handleMessage=function(b){var e=this;this.logger.log("getting",b.type,b);b.prefix&&(this.browserPrefix=b.prefix);"offer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleOffer(b.payload,function(b){b||e.pc.answer(function(b,e){})})):"answer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleAnswer(b.payload)):"candidate"===b.type?this.pc.processIce(b.payload):"connectivityError"===
b.type?this.parent.emit("connectivityError",e):"mute"===b.type?this.parent.emit("mute",{id:b.from,name:b.payload.name}):"unmute"===b.type&&this.parent.emit("unmute",{id:b.from,name:b.payload.name})};h.prototype.send=function(b,e){e={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:b,payload:e,prefix:l.prefix};this.logger.log("sending",b,e);this.parent.emit("message",e)};h.prototype.sendDirectly=function(b,e,f){var d={type:e,payload:f};this.logger.log("sending via datachannel",
b,e,d);b=this.getDataChannel(b);if("open"!=b.readyState)return!1;f.func!==Wa.location?b.send(JSON.stringify(d)):b.send(f[1].buffer);return!0};h.prototype._observeDataChannel=function(b){var e=this;b.binaryType="arraybuffer";b.onclose=this.emit.bind(this,"channelClose",b);b.onerror=this.emit.bind(this,"channelError",b);b.onmessage=function(f){var d=f.data;d=d.byteLength?{type:"nehhof",payload:{1:new Uint8Array(d),func:Wa.location}}:JSON.parse(d);e.emit("channelMessage",e,b.label,d,b,f)};b.onopen=this.emit.bind(this,
"channelOpen",b)};h.prototype.getDataChannel=function(b,e){if(!l.supportDataChannel)return this.emit("error",Error("createDataChannel not supported"));var f=this.channels[b];e||(e={});if(f)return f;f=this.channels[b]=this.pc.createDataChannel(b,e);f.binaryType="arraybuffer";this._observeDataChannel(f);return f};h.prototype.onIceCandidate=function(b){if(!this.closed)if(b){var e=this.parent.config.peerConnectionConfig;"moz"===l.prefix&&e&&e.iceTransports&&b.candidate&&b.candidate.candidate&&0>b.candidate.candidate.indexOf(e.iceTransports)?
this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",e.iceTransports):this.send("candidate",b)}else this.logger.log("End of candidates.")};h.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc");this.pc.offer(this.receiveMedia,function(b,e){})};h.prototype.icerestart=function(){var b=this.receiveMedia;b.mandatory.IceRestart=!0;this.pc.offer(b,function(b,e){})};h.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())};
h.prototype.handleRemoteStreamAdded=function(b){var e=this;this.stream?this.logger.warn("Already have a remote stream"):(this.stream=b.stream,this.stream.getTracks().forEach(function(b){b.addEventListener("ended",function(){d(e.stream)&&e.end()})}),this.parent.emit("peerStreamAdded",this))};h.prototype.handleStreamRemoved=function(){var b=this.parent.peers.indexOf(this);-1<b&&(this.parent.peers.splice(b,1),this.closed=!0,this.parent.emit("peerStreamRemoved",this))};h.prototype.handleDataChannelAdded=
function(b){this.channels[b.label]=b;this._observeDataChannel(b)};h.prototype.sendFile=function(b){var e=new k.Sender,f=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:"https://simplewebrtc.com/protocol/filetransfer#inband-v1"});f.onopen=function(){f.send(JSON.stringify({size:b.size,name:b.name}));e.send(b,f)};f.onclose=function(){console.log("sender received transfer");e.emit("complete")};return e};e.exports=h},{filetransfer:26,rtcpeerconnection:44,util:63,webrtcsupport:64,wildemitter:65}],
68:[function(b,e,f){function d(b){var e=this,f=b||{},d=this.config={url:"https://sandbox.simplewebrtc.com:443/",socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}},g;var r=b.debug?b.logger||console:b.logger||k;this.logger=r;for(g in f)f.hasOwnProperty(g)&&
(this.config[g]=f[g]);this.capabilities=p;l.call(this);var E=null===this.config.connection?this.connection=new D(this.config):this.connection=this.config.connection;E.on("connect",function(){e.emit("connectionReady",E.getSessionid());e.sessionReady=!0;e.testReadiness()});E.on("message",function(b){var f=e.webrtc.getPeers(b.from,b.roomType);if("offer"===b.type){f.length&&f.forEach(function(e){e.sid==b.sid&&(d=e)});if(!d){var d=e.webrtc.createPeer({id:b.from,sid:b.sid,type:b.roomType,enableDataChannels:e.config.enableDataChannels&&
"screen"!==b.roomType,sharemyscreen:"screen"===b.roomType&&!b.broadcaster,broadcaster:"screen"!==b.roomType||b.broadcaster?null:e.connection.getSessionid()});e.emit("createdPeer",d)}d.handleMessage(b)}else f.length&&f.forEach(function(e){b.sid?e.sid===b.sid&&e.handleMessage(b):e.handleMessage(b)})});E.on("remove",function(b){b.id!==e.connection.getSessionid()&&e.webrtc.removePeers(b.id,b.type)});b.logger=this.logger;b.debug=!1;this.webrtc=new h(b);"mute unmute pauseVideo resumeVideo pause resume sendToAll sendDirectlyToAll getPeers".split(" ").forEach(function(b){e[b]=
e.webrtc[b].bind(e.webrtc)});this.webrtc.on("*",function(){e.emit.apply(e,arguments)});if(d.debug)this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:"));this.webrtc.on("localStream",function(){e.testReadiness()});this.webrtc.on("message",function(b){e.connection.emit("message",b)});this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this));this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this));this.config.adjustPeerVolume&&(this.webrtc.on("speaking",
this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1)));E.on("stunservers",function(b){e.webrtc.config.peerConnectionConfig.iceServers=b;e.emit("stunservers",b)});E.on("turnservers",function(b){e.webrtc.config.peerConnectionConfig.iceServers=e.webrtc.config.peerConnectionConfig.iceServers.concat(b);e.emit("turnservers",b)});this.webrtc.on("iceFailed",function(b){});this.webrtc.on("connectivityError",function(b){});this.webrtc.on("audioOn",
function(){e.webrtc.sendToAll("unmute",{name:"audio"})});this.webrtc.on("audioOff",function(){e.webrtc.sendToAll("mute",{name:"audio"})});this.webrtc.on("videoOn",function(){e.webrtc.sendToAll("unmute",{name:"video"})});this.webrtc.on("videoOff",function(){e.webrtc.sendToAll("mute",{name:"video"})});this.webrtc.on("localScreen",function(b){var f=document.createElement("video"),d=e.getRemoteVideoContainer();f.oncontextmenu=function(){return!1};f.id="localScreen";u(b,f);d&&d.appendChild(f);e.emit("localScreenAdded",
f);e.connection.emit("shareScreen");e.webrtc.peers.forEach(function(b){"video"===b.type&&(b=e.webrtc.createPeer({id:b.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:e.connection.getSessionid()}),e.emit("createdPeer",b),b.start())})});this.webrtc.on("localScreenStopped",function(b){e.getLocalScreen()&&e.stopScreenShare()});this.webrtc.on("channelMessage",function(b,f,d){"volume"==d.type&&e.emit("remoteVolumeChange",b,d.volume)});
this.config.autoRequestMedia&&this.startLocalVideo()}var h=b("./webrtc"),l=b("wildemitter"),p=b("webrtcsupport"),u=b("attachmediastream"),k=b("mockconsole"),D=b("./socketioconnection");d.prototype=Object.create(l.prototype,{constructor:{value:d}});d.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare();this.emit("leftRoom",this.roomName);this.roomName=void 0}};d.prototype.disconnect=
function(){this.connection.disconnect();delete this.connection};d.prototype.handlePeerStreamAdded=function(b){var e=this,f=this.getRemoteVideoContainer(),d=u(b.stream);b.videoEl=d;d.id=this.getDomId(b);f&&f.appendChild(d);this.emit("videoAdded",d,b);window.setTimeout(function(){e.webrtc.isAudioEnabled()||b.send("mute",{name:"audio"});e.webrtc.isVideoEnabled()||b.send("mute",{name:"video"})},250)};d.prototype.handlePeerStreamRemoved=function(b){var e=this.getRemoteVideoContainer(),f=b.videoEl;this.config.autoRemoveVideos&&
e&&f&&e.removeChild(f);f&&this.emit("videoRemoved",f,b)};d.prototype.getDomId=function(b){return[b.id,b.type,b.broadcaster?"broadcasting":"incoming"].join("_")};d.prototype.setVolumeForAll=function(b){this.webrtc.peers.forEach(function(e){e.videoEl&&(e.videoEl.volume=b)})};d.prototype.joinRoom=function(b,e){var f=this;this.roomName=b;this.connection.emit("join",b,function(d,g){console.log("join CB",d);if(d)f.emit("error",d);else{if(!g.xtra){Ma();cc();ae(q.errorLoading,"#ff0000");return}v.room=g.xtra;
var h,l;for(h in g.clients){var p=g.clients[h];for(l in p)if(p[l]){var u=f.webrtc.createPeer({id:h,type:l,enableDataChannels:f.config.enableDataChannels&&"screen"!==l,receiveMedia:{offerToReceiveAudio:"screen"!==l&&f.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:f.config.receiveMedia.offerToReceiveVideo}});f.emit("createdPeer",u);u.start()}}}e&&e(d,g);f.emit("joinedRoom",b)})};d.prototype.getEl=function(b){return"string"===typeof b?document.getElementById(b):b};d.prototype.startLocalVideo=
function(){var b=this;this.webrtc.start(this.config.media,function(e,f){e?b.emit("localMediaError",e):u(f,b.getLocalVideoContainer(),b.config.localVideo)})};d.prototype.stopLocalVideo=function(){this.webrtc.stop()};d.prototype.getLocalVideoContainer=function(){var b=this.getEl(this.config.localVideoEl);if(b&&"VIDEO"===b.tagName)return b.oncontextmenu=function(){return!1},b;if(b){var e=document.createElement("video");e.oncontextmenu=function(){return!1};b.appendChild(e);return e}};d.prototype.getRemoteVideoContainer=
function(){return this.getEl(this.config.remoteVideosEl)};d.prototype.shareScreen=function(b){this.webrtc.startScreenShare(b)};d.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]};d.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var b=document.getElementById("localScreen"),e=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&e&&b&&e.removeChild(b);b&&this.emit("videoRemoved",b);this.getLocalScreen()&&this.webrtc.stopScreenShare();
this.webrtc.peers.forEach(function(b){b.broadcaster&&b.end()})};d.prototype.testReadiness=function(){this.sessionReady&&(this.config.media.video||this.config.media.audio?0<this.webrtc.localStreams.length&&this.emit("readyToCall",this.connection.getSessionid()):this.emit("readyToCall",this.connection.getSessionid()))};d.prototype.createRoom=function(b,e){this.roomName=b;this.connection.emit("create",v.room,e)};d.prototype.sendFile=function(){if(!p.dataChannel)return this.emit("error",Error("DataChannelNotSupported"))};
e.exports=d},{"./socketioconnection":69,"./webrtc":70,attachmediastream:3,mockconsole:37,webrtcsupport:64,wildemitter:65}],69:[function(b,e,f){function d(b){this.connection=h.connect(b.url,b.socketio)}var h=b("socket.io-client");d.prototype.on=function(b,e){this.connection.on(b,e)};d.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};d.prototype.getSessionid=function(){return this.connection.id};d.prototype.disconnect=function(){return this.connection.disconnect()};e.exports=
d},{"socket.io-client":50}],70:[function(b,e,f){function d(b){var e=this,f=b||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:!0};var d;b=b.debug?b.logger||console:b.logger||l;this.logger=b;for(d in f)f.hasOwnProperty(d)&&(this.config[d]=f[d]);h.support||this.logger.error("Your browser doesn't seem to support WebRTC");this.peers=[];
p.call(this,this.config);this.on("speaking",function(){e.hardMuted||e.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"speaking"})))})});this.on("stoppedSpeaking",function(){e.hardMuted||e.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"stoppedSpeaking"})))})});this.on("volumeChange",function(b,f){e.hardMuted||e.peers.forEach(function(e){e.enableDataChannels&&
(e=e.getDataChannel("hark"),"open"==e.readyState&&e.send(JSON.stringify({type:"volume",volume:b})))})});if(this.config.debug)this.on("*",function(b,f,d){(e.config.logger===l?console:e.logger).log("event:",b,f,d)})}f=b("util");var h=b("webrtcsupport"),l=b("mockconsole"),p=b("localmedia"),u=b("./peer");f.inherits(d,p);d.prototype.createPeer=function(b){b.parent=this;b=new u(b);this.peers.push(b);return b};d.prototype.removePeers=function(b,e){this.getPeers(b,e).forEach(function(b){b.end()})};d.prototype.getPeers=
function(b,e){return this.peers.filter(function(f){return(!b||f.id===b)&&(!e||f.type===e)})};d.prototype.sendToAll=function(b,e){this.peers.forEach(function(f){f.send(b,e)})};d.prototype.sendDirectlyToAll=function(b,e,f){this.peers.forEach(function(d){d.enableDataChannels&&d.sendDirectly(b,e,f)})};e.exports=d},{"./peer":67,localmedia:35,mockconsole:37,util:63,webrtcsupport:64}]},{},[68])(68)})},A,Ka,q={},v={name:localStorage.name,color:localStorage.color||"#ff0000"},Fc=function(){};console.log("%c nehhon %c POWER ",
"background: #00ffd4; color: #000; font-size:20px","background: #000; color: #00ffd4; font-size:20px");console.log("%c Author: Ruben ","background: #000; color: #00ffd4; font-size:20px");console.log("%c webmaster@nehhon.com ","background: #00ffd4; color: #000; font-size:20px");console.log("%c @nehhon ","background: #000; color: #00ffd4; font-size:20px");var t=function(c){return document.getElementById(c)},Oa=function(c,b,e){void 0===localStorage[c]&&(localStorage[c]=b);e&&(t(e).value=localStorage[c])};
void 0===localStorage.fullscreen&&(localStorage.fullscreen=!0);Oa("musicRange",80,"musicRange");Oa("soundRange",45,"soundRange");Oa("goldRes",400);Oa("foodRes",400);Oa("stoneRes",400);Oa("woodRes",400);Oa("infinity","true");Oa("mapSize",256);Oa("terrainType","grass");Oa("water","0");Oa("items","10");Oa("peons","3");Oa("gateways","1");Oa("freePop","1");console.log=Fc;console.error=Fc;console.warn=Fc;console.info=Fc;"tza.red"!==location.hostname&&(location.href="https://tza.red");window.onbeforeunload=
function(){return"Are you sure you want to quit?"};var El=function(c){c.parentNode.removeChild(c)},ae=function(c,b){var e=document.getElementById("notifybar"),f=document.createElement("div");f.innerHTML=c;b&&(f.style.background=b);e.appendChild(f);setTimeout(El,11E3,f)};document.body.style.setProperty("--baksp","linear-gradient(60deg, rgba(55, 0, 56, 0.6) 0%, rgba(var(--lred),var(--lgreen),var(--lblue), 0.5) 100%), url(/nehhon/bak2.jpg) fixed repeat");document.body.style.setProperty("--bak2sp","url(/nehhon/bak.jpg) fixed repeat");
var Ri=function(c){c=parseInt(c.substr(1),16);return[c>>16&255,c>>8&255,c&255]},Fl=location;(function(){var c=!!window.opr||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),b="undefined"!==typeof InstallTrigger,e=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),f=!!document.documentMode,d=!f&&!!window.StyleMedia,h=!!window.chrome&&!!window.chrome.webstore,l;c?l="Opera":b?l="Firefox":e?l="Safari":f?l="IE":d?l="Edge":h&&(l="Chrome");v.navLang=localStorage.language||
navigator.language||navigator.userLanguage;c=v.navLang.substr(0,2);b={es:["Tzared","Juego de estrategia en tiempo real para navegadores web, juega solo o con amigos","tzared,jugar,multijugador,juego,online,navegador web,tzar"],it:["Tzared","Gioco di strategia in tempo reale per browser web, giocare da soli o con gli amici","tzared,giocare,multigiocatore,gioco,online,navigatore,tzar,web"],pl:["Tzared","Gra strategiczna w czasie rzeczywistym dla przegl\u0105darek internetowych, bawi\u0107 si\u0119 samotnie lub z przyjaci\u00f3\u0142mi",
"tzared,gra,multiplayer,online,tzar,przegl\u0105darka internetowa"],ru:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u043b\u044f \u0432\u0435\u0431-\u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u0432, \u0438\u0433\u0440\u0430\u0442\u044c \u0432 \u043e\u0434\u0438\u043d\u043e\u0447\u043a\u0443 \u0438\u043b\u0438 \u0441 \u0434\u0440\u0443\u0437\u044c\u044f\u043c\u0438",
"\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u044c\u0442\u0438\u043f\u043b\u0435\u0435\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u0435\u0440,\u043e\u0433\u043d\u0451\u043c \u0438 \u043c\u0435\u0447\u043e\u043c"],pt:["Tzared","Jogo de estrat\u00e9gia em tempo real para navegadores da web, jogar sozinho ou com amigos","tzared,jogar,multiplayer,jogo,online,navegador web,tzar"],bg:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0447\u0435\u0441\u043a\u0430 \u0438\u0433\u0440\u0430 \u0432 \u0440\u0435\u0430\u043b\u043d\u043e \u0432\u0440\u0435\u043c\u0435 \u0437\u0430 \u0443\u0435\u0431 \u0431\u0440\u0430\u0443\u0437\u044a\u0440\u0438, \u0438\u0433\u0440\u0430\u0439\u0442\u0435 \u0441\u0430\u043c\u0438 \u0438\u043b\u0438 \u0441 \u043f\u0440\u0438\u044f\u0442\u0435\u043b\u0438",
"\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u0442\u0438\u043f\u043b\u0435\u0439\u044a\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u044a\u0440"],de:["Tzared","Echtzeit-Strategiespiel f\u00fcr Webbrowser, alleine oder mit Freunden spielen","tzared,multiplayer,spiel,online,Webbrowser,tzar"],en:["Tzared","Real-time strategy game for web browsers, play alone or with friends","tzared,play,multiplayer,game,online,browser,tzar,web"]};b[c]||(c=
"en");document.getElementsByTagName("html")[0].lang=c;b=b[location.search.split("lang=")[1]||"en"];document.title=b[0];v.title=b[0];document.getElementsByTagName("meta").description=b[1];document.getElementsByTagName("meta").keywords=b[2];v.version="v31.8";v.versionDate=Date.now()-1536857200814;localStorage.version!==v.version&&(localStorage.version=v.version,ae("Updated to "+v.version));t("info").innerHTML="Work in progress - Beta "+v.version+" - Updated "+~~(v.versionDate/864E5)+" days ago";v.lang=
"en es it pt ru pl bg de".split(" ").indexOf(c);0>v.lang&&(v.lang=0);v.langstr=c;v.team=0;v.race=0;v.navigator=l;v.mx=151;v.onlineID=null;v.temperature=0;v.cdn="/nehhon/"})();q={open:"Open",loading:"Loading...",systemAlert:"System Message",notEnough:"Not enough %s",ok:"OK",yes:"Yes",no:"No",secure:"Are you sure?",gold:"Gold",stone:"Stone",wood:"Wood",food:"Food",mana:"Manna",warning:"Warning",play:"PLAY",grass:"Grass",snow:"Snow",close:"CLOSE",gameClosed:"The game was canceled by the server.",loadgraphics:"Downloading graphics...",
waitImages:"Downloading graphics",wait:"Wait",audioproblem:"Your browser is not compatible with Web Audio",defeated:"DEFEATED",victorious:"VICTORIOUS",options:"OPTIONS",refresh:"Refresh",back:"BACK",paused:"PAUSED",chatMsg:"CHAT MESSAGE",disconnect:"Disconnect",playerDisconnected:"%s has disconnected!",connectionError:"Connection error",noP2P:"Engine not loaded",startingResources:"Starting Resources",mapSize:"Map Size",menu:"MENU",quit:"QUIT",downloadAll:"Download all",continue:"Continue",backToGame:"BACK TO GAME",
initializing:"Initializing...",requires:"Requires",stop:"Stop",pickItems:"Pick items",move:"Move",stand:"Stand ground",explore:"Explore",patrol:"Patrol",guard:"Guard",errorLoading:"Error loading game.",waitingPlayers:"Waiting for players to connect",musicVolume:"Music Volume",soundVolume:"Sound Volume",common:"Common",popLimit:"Population limit reached",houseLimit:"Not enough houses",lightning:"Lightning",freeze:"Freeze",bless:"Bless",heal:"Heal",invisibility:"Invisibility",dcm:"Dig, chop or mine",
repair:"Repair building",menuBuild:"See what you can build",units:"Units",infinite:"Infinite",gameFull:"Sorry, the game is full.",terrainOption:"Terrain",playerDefeated:"%s has been defeated!",savegame:"SAVE GAME",loadRecord:"Recording",stats:"Stats",builds:"Builds",items:"Items",nature:"Nature",trees:"Trees",delete:"Delete",create:"Create",username:"Player Name",gameOptions:"GAME OPTIONS",nplayers:"Number of Players",gameName:"Enter Game Name",gamesFound:"Games Found",strSearch:"SEARCH| Search for existing games",
strCreate:"CREATE| Create a game",randomMap:"RANDOM MAP",strcusMap:"CUSTOM MAP",strSettings:"SETTINGS",mapMaking:"Map Making",terrain:"Terrain",save:"SAVE",accept:"ACCEPT",team:"Team",color:"Colour",offlinePlay:"For playing offline",AI:"AI Assist",kingdom:"Kingdom",attack:"Attack",defence:"Defence",health:"Health",maxHealth:"Max health",playing:"Playing",waiting:"Waiting",joining:"Joining...",random:"Random",cancel:"CANCEL",rules:"Rules",events:"Events",actions:"Actions",objAction:"Object action",
destroyObj:"Destroy object",defined:"Defined",undefined:"Undefined",destroy:"Destroy",capture:"Capture",moving:"Moving",add:"Add",objOrder:"Order",objZone:"Object in zone",zone:"Zone",editMap:"Edit",mapName:"Map name",water:"Water",description:"Map Description",author:"Author",fullscreen:"Automatic full screen",versionError:"Incorrect game version.",language:"Language",english:"English",spanish:"Espa\u00f1ol",italian:"Italiano",portuguese:"Portugu\u00eas",russian:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",
polish:"Polski",bulgarian:"\u0431\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",german:"Deutsch",up:"Up",down:"Down",kick:"Kick",kicked:"You were kicked off by the server.",nospace:"Not enought space",peons:"Peasants",gateways:"Magic Gateways",computer:"Computer",addAI:"Add AI",race:"Race",date:"Date",freePop:"Free population",about:"About",loadTerrain:"Loading Terrain..."};var cj=Fc,ej=function(c){c--;var b=new XMLHttpRequest;b.open("GET","/nehhon/"+v.langstr+".json",!0);b.setRequestHeader("Content-type",
" text / plain; charset = dropbox - cors - hack");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=JSON.parse(b.response);cj=function(){for(var b=y,e=0;e<b.length;e++){var f=b[e].name;c[f]&&(b[e].name=c[f])}for(e=0;e<z.length;e++)b=z[e],c[b.name[0]]&&c[b.name[1]]&&(b.name[0]=c[b.name[0]],b.name[1]=c[b.name[1]]);c=null};for(var f=[],g=0;0>g;g++)"undefined"!=typeof d[g]&&null!=d[g].tech&&(f.push(d[g].tech.name),Object.freeze(d[g].tech));for(g=0;g<f.length;g++)f[g][0]=c[f[g][0]],
f[g][1]=c[f[g][1]];f=Object.keys(q);for(g=0;g<f.length;g++){var h=f[g];void 0!=c[q[h]]&&(q[h]=c[q[h]])}Object.freeze(q);for(g=0;g<cb.length;g++)cb[g]=c[cb[g]];for(g=0;g<0*hh.length;g++)hh[g]=c[hh[g]];Object.freeze(cb);dj()}};b.send()},dj=function(){for(var c=["refreshButton",q.refresh,"optionsButton",q.options,"startButton",q.play,"backButton",q.back,"closeButton",q.close,"quitButton",q.quit,"continueButton",q.continue],b=0,e=c.length;b<e;b+=2)for(var f=document.getElementsByClassName(c[b]),d=0,h=
f.length;d<h;d++)f[d].innerHTML=c[b+1];c=["alertok",q.ok,"sendMessageH2",q.chatMsg,"backToGame",q.backToGame,"backToGameS",q.backToGame,"musicVolume",q.musicVolume,"soundVolume",q.soundVolume,"menueditor",q.menu,"saveGame",q.savegame,"playrecord",q.loadRecord,"seeStats",q.stats,"gameMenu",q.menu,"selectBuilds",q.builds,"selectUnits",q.units,"selectItems",q.items,"selectNature",q.nature,"gamesFound",q.gamesFound,"strSearch",q.strSearch.split("| ")[1],"strCreate",q.strCreate.split("| ")[1],"strRandomMap",
q.randomMap,"strcusMap",q.strcusMap,"strMapEditor",q.mapMaking,"h2cusmap",q.strcusMap,"h2rndMap",q.randomMap,"mapProps",q.options,"mapRules",q.rules,"editCustom",q.editMap,"strSettings",q.strSettings,"about",q.about];b=0;for(e=c.length;b<e;b+=2)document.getElementById(c[b]).innerHTML=c[b+1]};0<v.lang?(ej(v.lang),ej.translated=!0):dj();var O=console.log,Gl=document.getElementById("alerttitle"),Hl=document.getElementById("alerttext"),Il=document.getElementById("alert"),Gc=function(c,b,e){Il.style.display=
"block";Gl.innerHTML=b||q.warning;Hl.innerHTML=c;e?document.getElementById("alertok").style.display="none":document.getElementById("alertok").style.display="block";t("basic").style.filter="blur(94px)"},I={blessIncrease:5,blessRange:8,freezeRange:6,healVol:6,freezeDamage:40,lightningDamage:150,AIxtension:80,maxCrusaders:32,startingCrusaders:16,crusaderGain:4,crusaderRegenerationTime:1,teachMana:10,dummyLevelLimit:8,dummyIncreaseLevelValue:50,manaRechargeTime:1E3,milkRechargeTime:1E3,cowRechargeTime:1E3,
milkMax:50,foodMax:600,milkInterval:1E3,impersonateMana:90,turnToStoneMana:50,turnToStoneTime:24E4,confusionTime:2E4,confusionMana:70,confusionRange:4,itemMaxSize:100,necromancyRadius:8,heroExp:16,fameExp:4,fireRainMana:100,lightningMana:50,healingMana:4,blessMana:60,freezeMana:60,invisibilityMana:50,flameBoltMana:50,raiseDeadMana:70,mercenaries:9,fameGold:120,crusaderCost:[1E3,0,2E3,0],digTime:14E3,kirkaTime:7E3,cutTime:7E3,textureSize:346030080},gj=function(c,b,e){var f=new XMLHttpRequest;f.open("GET",
c,!0);f.responseType="arraybuffer";f.onload=function(){b.length?fj(f.response,0):fj(f.response,I.textureSize);Y.load++;qc&&Y.load===Y.images&&qc()};f.onprogress=e;f.send(1)},fj=function(c,b){var e=performance.now();c=new Uint16Array(c);var f=c.length,d=c[f-4]+65536*c[f-3],h=c[f-2]+65536*c[f-1];h*=4;f-=2;for(var l=-1,p=Y.common,u=b;d<f;d++){var k=c[d];if(65533<k){65535==k?(k=c[d+1],d+=1):(k=c[d+1]+65536*c[d+2],d+=2);for(var D=0;D<k&&!(p[u++]=l&255,p[u++]=l>>8&255,p[u++]=l>>16&255,p[u++]=l>>24&255,
u-b>=h);D++);}else{k=c[2*k]+65536*c[2*k+1];p[u++]=k&255;p[u++]=k>>8&255;p[u++]=k>>16&255;p[u++]=k>>24&255;if(u-b>=h)break;l=k}}O("nh17:",performance.now()-e)},Hc=function(){var c=["icons.png","images.json","graphics.nh17","terrainDataGrass.json","grass.nh17"];c=c.concat(ih);var b=c.length;Hc.max=b;for(var e=0;e<b;e++)Jl(v.cdn+c[e]);this.innerHTML="0%";this.disabled=!0;Hc.button=this};Hc.loaded=0;var Jl=function(c){var b=new XMLHttpRequest;b.open("GET",c,!0);b.responseType="arraybuffer";b.setRequestHeader("Content-type",
" text / plain; charset = dropbox - cors - hack");b.onload=function(){Hc.loaded++;Hc.button.innerHTML=~~(100*Hc.loaded/Hc.max+.5)+"%"};b.send("")},Y={size:512,load:0,xtra:[],common:1},qc;Y.xtraRes=[];var S={page:0,length:8,leftButton:document.getElementById("aleft"),rightButton:document.getElementById("aright"),stock:document.getElementById("stock")},m,Ab=function(c){c.target.loadedSize||(Ab.total+=c.total,c.target.lastLoaded=0,c.target.loadedSize=!0);Ab.progress+=c.loaded-c.target.lastLoaded;c.target.lastLoaded=
c.loaded;t("loadingtext").innerHTML=q.loadgraphics+~~(100*Ab.progress/Ab.total)+"%"},Kl=function(c){Y.images=Object.keys(c).length;Y.load=0;Ab.progress=0;Ab.total=0;Date.now();if(S.icons)Y.load++;else{var b=new XMLHttpRequest;b.open("GET",c.icons,!0);b.responseType="arraybuffer";b.onreadystatechange=function(){if(4===b.readyState&&200===b.status){var c=new Uint8Array(b.response);c=new Blob([c],{type:"image/png"});var e=new Image;e.src=URL.createObjectURL(c);Y.load++;S.icons=e;qc&&Y.load===Y.images&&
qc();Date.now()}};b.onprogress=Ab;b.send(1)}if(m)Y.load++;else{var e=new XMLHttpRequest;e.open("GET",c.imageJSON,!0);e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(Y.load++,qc&&Y.load===Y.images&&qc(),m=JSON.parse(e.response))};e.onprogress=Ab;e.send(1)}gj(c.common,"common",Ab);c=v.cdn;Y.images+=2;t("terrainSelect")&&(localStorage.terrain=t("terrainSelect").value);var f=uf[n.terrainType],d=new XMLHttpRequest;d.open("GET",c+f.json,!0);d.onreadystatechange=function(){if(4==this.readyState&&
200==this.status){Y.xtraRes[0]=JSON.parse(d.response);pc=Y.xtraRes[0];var b=pc.specialColor;be=new Float32Array(dc(b[0]/255,b[1]/255,b[2]/255,.9));Y.load++;b="rgb("+b[0]+","+b[1]+","+b[2]+")";t("msgs1").style.color=b;t("playersinfo").style.color=b;t("topinfo").style.color=b;qc&&Y.load===Y.images&&qc()}};d.onprogress=Ab;d.send(!0);gj(c+f.main,0,!1)},vl=function(){Y.started=!0;var c=v.cdn;Kl({icons:c+"icons.png",imageJSON:c+"images.json",common:c+"graphics.nh17"})},uf={grass:{json:"terrainDataGrass.json",
main:"grass.nh17",size:37748736},snow:{json:"terrainDataSnow.json",main:"snow.nh17",size:19922944},last:""},be;(function(){"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/sworker.js").then(function(c){console.log("CLIENT: service worker registration complete.")},function(c){O(c);console.log("CLIENT: service worker registration failure.")}),navigator.serviceWorker.oncontrollerchange=function(){console.log("page controlled by:",
navigator.serviceWorker.controller);location.reload(!0)}):console.log("CLIENT: service worker is not supported.")})();var sc,yd,zf,Ic,Af,jh,ce,hj,de,ij,jj,P,Bf,ee,Xa,kh,Ba,Ea,Cf={},ih="ts1.mp3 ts2.mp3 ts3.mp3 ts4.mp3 ts5.mp3 ts6.mp3 ts7.mp3 ts8.mp3 ts9.mp3 ts10.mp3 sr1.mp3 sr2.mp3 sr3.mp3 sr4.mp3 sr5.mp3 sr6.mp3 sr7.mp3 sr8.mp3 sr9.mp3 sr10.mp3 1.mp3 2.mp3 3.mp3 4.mp3 5.mp3 6.mp3 7.mp3 8.mp3 9.mp3 10.mp3 INTRO.mp3 OUTRO.mp3 WIN1.mp3 WIN2.mp3 ATTACK.WAV BALLISTA.WAV BLDGDONE.WAV CHAT%20LOCATION.WAV TECHDONE.WAV UNITDONE.WAV CHAT.WAV E_CASTLE1.WAV E_CATHEDRAL1.WAV E_CATHEDRAL2.WAV E_FARM1.WAV E_CHURCH1.WAV E_FARM2.WAV E_HARBOR1.WAV E_LUMBER1.WAV E_MAGETOWER1.WAV E_MAGETOWER2.WAV E_MAGETOWER3.WAV E_MARKET1.WAV E_SHIPYARD1.WAV E_STABLES1.WAV E_STORAGE1.WAV E_OUTPOST1.WAV E_STORAGE2.WAV E_TAVERN1.WAV E_WARACADEMY1.WAV E_WORKSHOP1.WAV EVILCASTLE.WAV GATE1.WAV GATE2.WAV GATE3.WAV GATE4.WAV GATE5.WAV GATE6.WAV GATEWAY.WAV HOUSE1.WAV HOUSE2.WAV HOUSE3.WAV HOUSE4.WAV HOUSE5.WAV MERCHANT.WAV MINE1.WAV MONASTERY1.WAV MONASTERY2.WAV R_CATHEDRAL1.WAV R_CHURCH1.WAV SHAOLIN2.WAV SHAOLIN.WAV CHOP%201.WAV CHOP%202.WAV CHOP%203.WAV CHOP%204.WAV CHOP%205.WAV CHOP%206.WAV CHOP%207.WAV CHOP%208.WAV CHOP%209.WAV CHOP%2010.WAV CHOP%2011.WAV DIG%201.WAV DIG%202.WAV DIG%203.WAV MINE%201.WAV MINE%202.WAV MINE%203.WAV HIT%201.WAV HIT%202.WAV HIT%203.WAV HIT%204.WAV HIT%205.WAV HIT%206.WAV HIT%207.WAV GHOST1.WAV GHOST2.WAV GOLEM1.WAV GOLEM2.WAV H%20SWORD%201.WAV H%20SWORD%202.WAV H%20SWORD%203.WAV H%20SWORD%204.WAV H%20SWORD%205.WAV H%20SWORD%206.WAV H%20SWORD%207.WAV H%20SWORD%207.WAV H%20SWORD%208.WAV H%20SWORD%209.WAV H%20SWORD%2010.WAV H%20SWORD%2011.WAV H%20SWORD%2012.WAV HAND1.WAV HAND2.WAV HAND3.WAV HAND4.WAV MAGE%20ATTACK.WAV MESSIAH.WAV ORC%20SWORD%201.WAV ORC%20SWORD%202.WAV ORC%20SWORD%203.WAV ORC%20SWORD%204.WAV ORC%20SWORD%205.WAV ORC%20SWORD%206.WAV ORC%20SWORD%20V1.WAV ORC%20SWORD%20V2.WAV ORC%20SWORD%20V3.WAV SHIP%20CANNON%201.WAV SHIP%20CANNON%202.WAV SHIP%20CANNON%203.WAV SHIP%20CANNON%204.WAV SHIP%20CANNON%205.WAV SHIP%20CANNON%206.WAV SHIP%20CANNON%207.WAV SIEGE.WAV SWORD%201.WAV SWORD%202.WAV SWORD%203.WAV SWORD%204.WAV SWORD%205.WAV SWORD%206.WAV SWORD%207.WAV SWORD%208.WAV SWORD%209.WAV SWORD%2010.WAV SWORD%2011.WAV SWORD%2012.WAV SWORD%2013.WAV SWORD%2014.WAV SWORD%2015.WAV SWORD%2016.WAV V%20SWORD%201.WAV V%20SWORD%202.WAV V%20SWORD%203.WAV V%20SWORD%204.WAV V%20SWORD%205.WAV V%20SWORD%206.WAV V%20SWORD%207.WAV ADRAGON2.WAV ADRAGON3.WAV ARROW%201.WAV ARROW%202.WAV ARROW%203.WAV ARROW%204.WAV ARROW%205.WAV ARROW%206.WAV ARROW%20V1.WAV ARROW%20V2.WAV ARROW%20V3.WAV ARROW%20V4.WAV BEAR1.WAV BEAR2.WAV BEAR3.WAV BEAR4.WAV BEAR5.WAV MWORKSHOP.WAV DESTROY%20BUILDING.WAV DESTROY%20MINE.WAV LIGHTING2.WAV LIGHTING.WAV METEOR.WAV SMALL%20EXPLOSION.WAV WATER%20BLOP.WAV SPY%20KILL%201.WAV SPY%20KILL%203.WAV SPY%20KILL%202.WAV PRIEST%20ATTACK.WAV LIGHTNING.WAV INVISIBLE.WAV HEAL.WAV FREEZE.WAV FLAME%20BALL.WAV CURSE.WAV CRUSADE.WAV CONFUSION.WAV BLESS.WAV WHIRLPOOL.WAV TURN%20TO%20STONE.WAV TEACH.WAV SUMMON10.WAV SUMMON9.WAV SUMMON8.WAV SUMMON7.WAV SUMMON6.WAV SUMMON5.WAV SUMMON4.WAV SUMMON3.WAV SUMMON2.WAV SUMMON1.WAV REVEAL.WAV RESSURECT.WAV COWDIE1.WAV COWDIE2.WAV COWDIE1.WAV COWDIE3.WAV COWDIE4.WAV DIE%201.WAV DIE%202.WAV DIE%203.WAV DIE%204.WAV DIE%205.WAV DIE%206.WAV DIE%207.WAV DIE%208.WAV DIE%209.WAV DIE%2010.WAV DRAGON%20DIE%201.WAV DRAGON%20DIE%202.WAV GHOST1.WAV GHOST2.WAV GOLEM.WAV H%20DIE%201.WAV H%20DIE%202.WAV H%20DIE%203.WAV H%20DIE%204.WAV H%20DIE%205.WAV H%20DIE%206.WAV H%20DIE%207.WAV H%20DIE%208.WAV H%20DIE%209.WAV H%20DIE%2010.WAV MAGE.WAV ORC%20DIE%201.WAV ORC%20DIE%202.WAV SHIP%20SINK.WAV SIEGE%20DIE%201.WAV SIEGE%20DIE%202.WAV SIEGE%20DIE%203.WAV SIEGE%20DIE%204.WAV SKELETON%20DIE%201.WAV SKELETON%20DIE%202.WAV SKELETON%20DIE%203.WAV SKELETON%20DIE%204.WAV MESSIAH_ATTACK.WAV C%20DIE%201.WAV C%20DIE%202.WAV C%20DIE%203.WAV C%20DIE%204.WAV C%20DIE%205.WAV CAMELDIE1.WAV CAMELDIE2.WAV CAMELDIE3.WAV BAT%20ATTACK.WAV BAT%20CMD.WAV BAT%20DIE.WAV".split(" "),
ah=function(){if(!sc){var c=function(b,c,e){c=c.split(".")[0].toLowerCase();Cf[c]=b;!e||e.music&&e.mid!=Ba.id||(Ea(c,e.x,e.y,e.k,e.music,e.date),e.date=0)},b=function(b,c,e){this.context=b;this.urlList=c;this.onload=e;this.loadCount=0};b.prototype.loadBuffer=function(b,e){var f=new XMLHttpRequest;f.open("GET",h+b,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");var d=this;f.onreadystatechange=function(){4===f.readyState&&200===f.status&&
d.context.decodeAudioData(f.response).then(function(f){f&&c(f,b,e)})};f.send()};for(var e=0,f=ih.length;e<f;e++){var d=ih[e];Cf[d.split(".")[0].toLowerCase()]=d}yd="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206 arrow%20v1 arrow%20v2 arrow%20v3 arrow%20v4".split(" ");zf="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206".split(" ");Ic="sword%201 sword%202 sword%203 sword%204 sword%205 sword%206 sword%207 sword%208 sword%209 sword%2010 sword%2011 sword%2012 sword%2013 sword%2014 sword%2015 sword%2016 v%20sword%201 v%20sword%202 v%20sword%203 v%20sword%204 v%20sword%205 v%20sword%206 v%20sword%207".split(" ");
Af=["siege"];jh=["hand1","hand2","hand3","hand4"];ce="h%20sword%201 h%20sword%202 h%20sword%203 h%20sword%204 h%20sword%205 h%20sword%206 h%20sword%207 h%20sword%208 h%20sword%209 h%20sword%2010 h%20sword%2011 h%20sword%2012".split(" ");hj=["ork%20sword%20v1","ork%20sword%20v2","ork%20sword%20v3"];de="ship%20cannon%201 ship%20cannon%202 ship%20cannon%203 ship%20cannon%204 ship%20cannon%205 ship%20cannon%206 ship%20cannon%207".split(" ");ij=["ghost%201","ghost%202"];jj=["mage%20attack"];P=["destroy%20building"];
Bf=["siege%20die%201","siege%20die%202","siege%20die%203","siege%20die%204"];ee="h%20die%201 h%20die%202 h%20die%203 h%20die%204 h%20die%205 h%20die%206 h%20die%207 h%20die%208 h%20die%209 h%20die%2010".split(" ");Xa="die%201 die%202 die%203 die%204 die%205 die%206 die%207 die%208 die%209 die%2010".split(" ");kh=["e_barrack1"];var h=v.cdn;if("undefined"!==typeof AudioContext){window.AudioContext=window.AudioContext||window.webkitAudioContext;sc=new AudioContext;var l=sc.createGain();var p=sc.createGain();
var u=new b(sc,void 0,c);O("Sound: OK");l.gain.value=parseInt(document.getElementById("musicRange").value)/100;p.gain.value=parseInt(document.getElementById("soundRange").value)/100}Ba=function(){if(!n.editor){Ba.id++;localStorage.setItem("favMusic",musicSelect.mversion.value);var b=Ba.list[musicSelect.mversion.value];b&&Ea(b[~~(b.length*Math.random())],0,0,void 0,1,0,Ba.id)}};document.getElementById("musicRange").oninput=function(){l.gain.value=parseInt(document.getElementById("musicRange").value)/
100;localStorage.musicRange=document.getElementById("musicRange").value};document.getElementById("soundRange").oninput=function(){p.gain.value=parseInt(document.getElementById("soundRange").value)/100;localStorage.soundRange=document.getElementById("soundRange").value};Ba.reset=function(){Ba.stop();Ba()};Ba.stop=function(){Ba.active&&(Ba.active.stop(),clearTimeout(Ba.intv))};Ba.id=0;Ba.list={originalMusic1:[1,2,3,4,5,6,7,8,9,10,"outro"],originalMusic:"ts1 ts2 ts3 ts4 ts5 ts6 ts7 ts8 ts9 ts10".split(" "),
sharpRain:"sr1 sr2 sr3 sr4 sr5 sr6 sr7 sr8 sr9 sr10".split(" ")};Ea=function(b,c,e,f,d,g,h){var k=b;if((b=Cf[b])&&"loading"!==b&&!n.canceled){var m=-Eb+(window.innerWidth-v.mx)/2,E=-db+window.innerHeight/2;if(b.duration){if(n.started)if(64<n.now()-b.lastPlayed||!b.lastPlayed)b.lastPlayed=n.now();else return;if(!(!d&&"attack"!=k&&g&&600<Date.now()-g)){if(c){c=-m+32*c;e=-E+32*e;E=V;if(c*c+e*e>Math.pow(2E3,2))return!1;c/=80;e/=80;E/=8}else E=e=c=0;void 0!==f&&f!==v.kingdom||n.mute||(f=sc.createBufferSource(),
f.buffer=b,d?(f.connect(l),l.connect(sc.destination),Ba.active=f,Ba.intv=setTimeout(Ba,~~(1E3*b.duration)+1E3)):(b=sc.createPanner(),b.panningModel="HRTF",b.setPosition(c,e,E),f.connect(b),b.connect(p),p.connect(sc.destination)),f.start(0))}}else Cf[k]="loading",d={x:c,y:e,k:f,music:d,date:Date.now(),mid:h},u.loadBuffer(b,d)}};b=document.getElementById("musicSelect").getElementsByTagName("input");e=0;for(f=b.length;e<f;e++)b[e].onchange=Ba.reset}},fe=function(c,b,e,f){c.img===f.url&&(Ea(b+~~(Math.random()*
e+1),c.x32,c.y32),setTimeout(fe,Za(f),c,b,e,f))};"use strict";var Ll=function(c){for(var b=[],e=0,f=[c.icons],d=0,h=f.length;d<h;d++)for(var l=f[d],p=0,u=l.length;p<u;p++)if(l[p]){var k=l[p];k.doneBy||(k.doneBy=[]);k.doneBy.put(c);b[e++]=k;k.xtra&&(f.put(k.xtra),h++)}c.habilities=b},Ml=function(c,b){return b.balanceTotal-c.balanceTotal},lh=function(c,b){return b.priority-c.priority},Df=function(c,b){if(!c.url.attack||c.attackOnly&&!c.attackOnly[b.type])return 0;var e=25*~~(Za(c.url.attack)/25);c=
c.attack*((zd[c.type][b.type]||0)+1);c-=b.defence;1>c&&(c=1);return~~(b.health/c)*e},lb=function(c){this.kingdom=c.k;this.aggressive=this.perfection=1;this.cantBuild={};this.houseLoading=0;this.mineGroup={};c.IAD=lb.arr.length;lb.arr.put(this)};lb.prototype.valorateLost=function(c){this.script&&this.script.put({order:c.nu,obj:c,priority:1})};var mh=function(c,b,e,f,d){var g=e.obj.cost;f[0]+=g[0];f[1]+=g[1];f[2]+=g[2];f[3]+=g[3];c[c.length]={order:e,priority:b.priority,name:e.obj.name,obj:e.obj,pTime:b.obj.time,
required:1,doner:d};c.changed=!0},nh=function(c,b,e,f){var d=[c],h=[],l={},p=f.target;h.put(c);for(var u=0;u<d.length;u++){var k=d[u];k.availables&&(k.availables=void 0);if((c=k.order)&&!l[k.order.id]){l[k.order.id]=1;var m=c.requireObj;if(m)for(var r=0,n=m.length;r<n;r++)if(c=m[r],c.tech)b[c.nu.id]||mh(d,k,c.nu,p);else{var J=e[c.type];J.length||mh(d,k,c.nu,p)}if(m=c.doneBy)for(r=0,n=m.length;r<n;r++)c=m[r],J=e[c.type],J.length||c.race!=f.racestr||mh(d,k,c.nu,p,1);u&&!k.doner&&h.put(k)}}return h},
oh={food:2,wood:1,gold:0,stone:3},tc=function(c,b){c=c.order;var e=c.obj,f=tc.tech;e.build?f=tc.build:e.tech||(f=tc.unit);return f(c,b)};tc.unit=function(c,b){c=c.doneBy;if(b.pop<b.popMax)for(var e=0,f=c.length;e<f;e++)for(var d=b[c[e].type],h=0,l=d.length;h<l;h++){var p=d[h];if(p.free)return[p]}return!1};tc.tech=function(c,b){c=c.doneBy;for(var e=0,f=c.length;e<f;e++)for(var d=b[c[e].type],h=0,l=d.length;h<l;h++){var p=d[h];if(p.free)return[p]}return!1};tc.build=function(c,b,e){c=c.doneBy;e=0;for(var f=
c.length;e<f;e++)for(var d=b[c[e].type],h=0,l=d.length;h<l;h++){var p=d[h];if(p.free)return[p]}return!1};tc.sPeasant=function(c){for(var b=[10,79,64],e=[],f=0,d=0,h=b.length;d<h;d++)for(var l=c[b[d]],p=0,u=l.length;p<u;p++)l[p].free&&(e[f++]=l[p]);return e};var Jc=function(c,b,e){if(c){c=c.order;var f=c.obj,d=Jc.unit;f.tech?d=Jc.tech:f.build&&(d=Jc.build);return d(c,b,e)}};Jc.build=function(c,b,e){var f=lb.arr[b.IAD];if(4<=f.cantBuild[c.obj.type]&&b.stats.buildsLosed==f.buildsLosed)return!1;for(var d=
[],h=c.doneBy,l=xa[b.k],p=0,u=h.length;p<u;p++)for(var k=l[h[p].type],m=0,r=k.length;m<r;m++){var n=x[k[m]];if(!n.func&&!n.in||e){d.put(n.id);break}}if(!d.length)return!1;e=A;n=c.obj;c=I.AIxtension;h=b.origin[0];l=b.origin[1];p=l-1;u=h-1;k=lb.arr[b.IAD].reserved;var J;if(J=k.added[n.type]){m=n.space;var t=n.validator.dimension,q=J%e,v=~~(J/e),w=m[m.length-1];r=(m.length-1)/w*w;for(m=0;m<r&&!t[q+m%w+(~~(m/w)+v)*e];m++);if(m==r)for(O(n.type),k.added[n.type]=!1,m=0;m<r;m++)k[q+m%w+(~~(m/w)+v)*e]=0;else J=
-1}else J=-1;0>J&&(J=Ef(h,l,c,p,u,b,n,900));if(0>J)return f.cantBuild[n.type]||(f.cantBuild[n.type]=0),f.cantBuild[n.type]++,f.buildsLosed=b.stats.buildsLosed,!1;f.cantBuild[n.type]&&(f.cantBuild[n.type]=0);Q(uc,[J,n.type],d);return!0};var Ef=function(c,b,e,f,d,h,l,p){var g=lb.arr[h.IAD].reserved,k=A,m=l.space;l=l.validator.check;if(!l)return-1;for(var r=-1,n=e/2*(e/2),J=1,t=c,q=b;0>r&&c-t<e/2;){--t;--q;for(var x=2*J+1,w=2*J+1,v=0,y=x*w;v<y;v++){var z=v%x,H=~~(v/x);if(!z||!H||z==x-1||H==w-1){z+=t;
H+=q;var B=(z-c)*(z-c)+(H-b)*(H-b);if(B<n&&l(z,H,m,f,d,B<p,h.k,g)){r=z+H*k;break}}}J++}return r};Jc.tech=function(c,b,e){e=c.doneBy;b=xa[b.k];for(var f=[],d=0,h=e.length;d<h;d++)for(var l=b[e[d].type],p=0,u=l.length;p<u;p++){var k=x[l[p]];k.working||k.techStart||!k.built||f.put(k.id)}if(!f.length)return!1;Q(Ff,[c.obj.id,c.id],f[0]);return!0};Jc.unit=function(c,b,e){e=c.doneBy;b=xa[b.k];for(var f=[],d=0,h=e.length;d<h;d++)for(var l=b[e[d].type],p=0,u=l.length;p<u;p++){var k=x[l[p]];k.working||k.techStart||
!1===k.built||f.put(k.id)}if(!f.length)return!1;Q(ge,[c.obj.type,1,0],f[0]);return!0};lb.prototype.leaveMeAloneIKnowWhatToDo=function(){performance.now();var c=H[this.kingdom],b=c.resources,e=xa[this.kingdom],f=A,d=I.AIxtension;if(c.origin){for(var h=c.origin[0],l=c.origin[1],p=l-1,u=h-1,k=h-.5*d,m=l-.5*d,r=0,U=-1,J=d*d,t=d/2*(d/2),q=0;q<J;q++){var w=q%d+k,v=~~(q/d)+m;(h-w)*(h-w)+(l-v)*(l-v)<t&&(!(w>=u&&w<=u+2)||v>=p&&v<=p+2)&&0===K[w+v*f]&&ma(w,v)&&r++}var ja=[];performance.now();for(var B=0,G=0,
F=y.length;G<F;G++){var C=y[G];if(!C.build&&!C.item&&!C.boat&&C.url.attack&&C.race==c.racestr&&8!=C.type&&void 0==C.res){ja.put(C);C.balanceSum=0;C.bestBalance=-1;C.balanceDefence={};for(var Q=Infinity,L=C.attDist,P=0;P<F;P++){var N=y[P];if(!N.build&&!N.item&&!N.boat&&N.race==c.racestr&&N.url.attack&&8!=N.type&&void 0==C.res&&(B=Df(N,C))){var S=Df(C,N);S&&(B-=S,B+=2E3*L,B<Q&&(Q=B,C.bestBalance=N),C.balanceSum+=B)}}C.balanceTotal=C.balanceSum}}ja.sort(Ml);C=ja[0];for(var hc=1E3,M={},R=[],W=0,X=hc;!M[C.type];)M[C.type]=
1,R[W++]=C,R[W++]=hc,N=C.bestBalance,hc=~~(hc*Df(N,C)/Df(C,N)+.5),X+=hc,C=N;R.nu=X-hc;O(R);for(var T=c.target,V=z,da=V.length,ba=[],fa=0;fa<da;fa++){var Y=V[fa],la;if(!(la=!Y.type||Y.upgrade||Y.type==aa||void 0!==oh[Y.value]&&c.resources[Y.value]>=T[Y.value])){a:{for(var oa=Y.nu.doneBy,ha=0,pa=oa.length;ha<pa;ha++)if(oa[ha].race==c.racestr){var qa=!0;break a}qa=!1}la=!qa}la||ba.put({order:Y.nu,obj:Y,original:1,priority:1E-10})}var ka=[];q=0;J=R.length;for(var ia=R.nu;q<J;q+=2){var na=~~(.5+R[q+1]/
ia*250)-e[R[q].type].length,Z=R[q],ta=Z.type;Z=Z.nu;for(var ca=0;ca<na;ca++)ba.put({order:Z,priority:1-ca/na,obj:Z.obj,original:1})}var Da=0,Aa=0,ra=c.target,ya={};Aa++;ra[0]=0;ra[1]=0;ra[2]=0;ra[3]=0;q=Da=ka.length=0;for(J=ba.length;q<J;q++){var Ka=ba[q].priority,Ea=nh(ba[q],c.technology.investigated,e,c);ca=0;for(var sa=Ea.length;ca<sa;ca++){Z=Ea[ca];Z.original||(Z.priority=Ka);var ea=1;void 0!==Z.priority&&(ea=Z.priority);var Na=Z.obj;Na.increase&&void 0!==oh[Na.value]&&(ea=Na.increase*ea/b[oh[Na.value]]);
ea/=Na.time;Z.priority=ea;if(!(0>=Z.priority)){var La=Z.order.id;!ya[La]||Z.original?(ya[La]=Da,ka[Da++]=Z):ka[ya[La]].priority+=Z.priority}}}var Sa=!1;ka.sort(lh);var Ra={},ib={},ua={},kb=[],Ta=y.length;for(q=0;q<Ta;ua[q++]=0);for(q=0;q<ka.length;q++){var Ca=ka[q];Z=Ca.order;var qb=Ca.obj;if(Ca.original||Ca.required)Ca.obj.tech||ua[Ca.obj.type]++,kb.put(Ca);var bb=Z.doneBy,Ua=qb.time;ca=0;for(J=bb.length;ca<J;ca++){var Ba=bb[ca],wa=Ba.time;if(Ba.race===c.racestr){if(qb){for(var cb=Ba,hb=e[Ba.type],
ab=lb.process,ob=Ua,Pa=hb.length,Va=!1,Wa=Infinity,rb=0;rb<Pa;rb++){var jb=x[hb[rb]],Ha=0;jb.build&&(jb.working||jb.techStart||!jb.built)&&(jb.built?(Ha=(jb.c-n.cycle)*Kc.speed,Ha/=1E3):(Ha=jb.time*(jb.maxHealth-jb.health)/jb.maxHealth,jb.workers&&jb.workers.length&&(Ha/=jb.workers.length)));jb.build||!jb.func&&!jb.in||(Ha=Infinity);jb.nato!=ab?(jb.nato=ab,jb.natoTime=0):Ha+=jb.natoTime;Ha<Wa&&(Wa=Ha,Va=jb)}Va&&Wa<=cb.time?(Va.natoTime+=ob,Sa=Va):Sa=!1}if(!Sa){Ra[Ba.type]||(Ra[Ba.type]=[],ib[Ba.type]=
[]);var Ja=Ra[Ba.type],wb=ib[Ba.type];ua[Ba.type]||(ua[Ba.type]=0);var Ma=!1,Ga=0;for(sa=Ja.length+1;Ga<sa;Ga++){if(void 0==Ja[Ga]){var Qa={order:Ba.nu,priority:0,obj:Ba};ka.put(Qa);kb.put(Qa);Ja[Ga]=0;wb[Ga]=Qa;ua[Ba.type]++;Ma=!0}if(Ja[Ga]+Ua<=wa||Ma){Ja[Ga]+=Ua;wb[Ga].priority+=Ca.priority;break}}}}}}kb.sort(lh);var yb=0;q=0;for(J=kb.length;q<J;q++)if(Ca=kb[q].obj,Ca.build){var Za=Ca.space[Ca.space.length-1]+2,$a=(Ca.space.length-1)/Za+2;yb+=Za*$a}O(yb,r);if(yb>r){var Cb=r/yb*.7;q=0;for(J=y.length;q<
J;q++)y[q].build&&(Ca=ua[q])&&((Ca=~~(Ca*Cb))||(Ca=1),ua[q]=Ca)}q=0;for(J=kb.length;q<J;q++)Ca=kb[q].obj,Ca.build&&(ua[Ca.type]?ua[Ca.type]--:kb[q]=0);for(var za=kb,Qb=~~(I.digTime/1E3),zb=~~(I.kirkaTime/1E3),Xa=~~(I.kirkaTime/1E3),Eb=~~(I.cutTime/1E3),Ia=new Uint32Array(Qb),db=new Uint32Array(zb),Oa=new Uint32Array(Xa),nb=new Uint32Array(Eb),Fb=6.25,Bb=c.resources,Mb=[db,nb,Ia,Oa],va=0,Wb=0,Ib=0;3>Ib;Ib++){var Ya=Bb[0],sb=Bb[1],tb=Bb[2],vb=Bb[3];Infinity==Ya&&Infinity==sb&&Infinity==tb&&Infinity==
vb&&(Fb=-1);var Ub=0,Vb=0,Ob=0,Rb=0;va=0;for(Wb=za.length;va<Wb;va++)if(za[va]){var Ab=za[va].obj.cost;Ub+=Ab[0];Vb+=Ab[1];Ob+=Ab[2];Rb+=Ab[3]}if(Ib){for(va=0;va<Ia.length;Ia[va++]=0);for(va=0;va<db.length;db[va++]=0);for(va=0;va<Oa.length;Oa[va++]=0);for(va=0;va<nb.length;nb[va++]=0);}var ub=[],Zb={},Nb={},pb={pop:0,popMax:2E3},Db=[[]];va=0;for(Wb=e.length;va<Wb;va++){gb=e[va];var Hb=[];pb[va]=Hb;for(var xb=0,Sb=gb.length;xb<Sb;xb++)Hb[xb]={free:1,type:va}}for(var eb=0;9E3>eb;){var cc=10*Gf(db)/
zb,dc=10*Gf(nb)/Eb,Kb=10*Gf(Ia)/Qb,ec=10*Gf(Oa)/Xa;Ya+=10*db[eb%db.length];sb+=10*nb[eb%nb.length];tb+=10*Ia[eb%Ia.length];vb+=10*Oa[eb%Oa.length];var Yb=Db[eb];if(Yb)for(va=0,Wb=Yb.length;va<Wb;va++){var Fa=Yb[va],mb=Fa.list;xb=0;for(Sb=mb.length;xb<Sb;xb++){var gb=mb[xb];gb.used||(gb.used=!0,ub.put(gb.action));gb.free=1}var fc=Fa.action&&(Fa.action.original||Fa.action.required)?!0:!1;if(Fa.obj.tech){Zb[Fa.obj.nu.id]=1;var $b=Fa.obj;"popLimit"==$b.value&&(pb.popMax+=$b.increase)}else Fa.obj.build||
pb.pop++,pb[Fa.obj.type].put({free:1,type:Fa.obj.type,action:Fa.action,used:fc})}va=0;for(Wb=za.length;va<Wb;va++)if(gb=za[va]){var ac=gb.obj;if(ac.peon||!(Kb<Fb)){var Gb=ac.cost;if(!(Gb[0]>Ya||Gb[1]>sb||Gb[2]>tb||Gb[3]>vb)&&1===nh(gb,Zb,pb,c).length&&(mb=tc(gb,pb))){var Pb=gb.obj.time+eb;Db[Pb]||(Db[Pb]=[]);if(gb.obj.tech){if(Nb[gb.order.id])continue;Nb[gb.order.id]=1}za[va]=void 0;(gb.original||gb.required)&&ub.put(gb);for(var bc=0;bc<mb.length;mb[bc++].free=0);Db[Pb].put({list:mb,obj:gb.obj,action:gb});
Ya-=Gb[0];sb-=Gb[1];tb-=Gb[2];vb-=Gb[3]}}}mb=tc.sPeasant(pb);va=0;for(Wb=mb.length;va<Wb;va++){var Tb=kj(cc,dc,Kb,ec,Ya,sb,tb,vb,Ub,Vb,Ob,Rb);if(0>Tb)break;2===Tb&&(sb-=200);Mb[Tb][eb%Mb[Tb].length]++;gb=mb[va];gb.free=0;gb.used||(gb.used=!0,ub.put(gb.action))}eb++}za=ub;za.sort(lh);lj(za)}kb=za;lj(kb);var Jb={},gc={added:Jb};this.reserved=gc;q=0;for(J=kb.length;q<J;q++)if((Z=kb[q])&&(qb=Z.obj)&&qb.build&&void 0==Jb[qb.type]&&(U=Ef(h,l,d,p,u,c,qb,900),-1<U)){w=U%f;v=~~(U/f);ta=qb.type;Jb[qb.type]=
U;var Lb=qb.space;Za=Lb[Lb.length-1];$a=(Lb.length-1)/Za;var ic=Za*$a;for(ca=0;ca<ic;ca++)gc[w+ca%Za+(~~(ca/Za)+v)*f]=ta}this.script=kb}};var Gf=function(c){for(var b=0,e=c.length,f=0;f<e;b+=c[f++]);return b},kj=function(c,b,e,f,d,h,l,p,u,k,m,r){if(Infinity==d&&Infinity==h&&Infinity==l&&Infinity==p)return-1;if(6.25>e)return 200>h?1:2;d=u+r+m+k;h=c+b+e+f;c/=u/d*h;b/=k/d*h;e/=m/d*h;f/=r/d*h;return c<b&&c<e&&c<f?0:b<e&&b<f?1:e<f?2:3},ph=function(){for(var c=0,b=lb.arr,e=b.length;c<e;b[c++].maintenance());
hb({func:ph},lb.time,1);lb.process++},mj=function(c,b,e){for(var f=c.length,d=Infinity,h=0,l=0;l<f;l++){var p=x[c[l]],u=Math.pow(b-p.x32,2)+Math.pow(e-p.y32,2);u<d&&(d=u,h=p.id)}return h};lb.prototype.maintenance=function(){var c=this.script;if(c){var b=H[this.kingdom];if(b.origin){n.blocked=!0;var e=b.technology.investigated,f=xa[b.k],g=A,h={};if(b.values.pop+b.unitLoading+5>b.values.popMax&&b.values.popMax<=b.values.popLimit){for(var l=$a[b.race].house.nu,p=0,u=0,k=b.building,m=k.length;u<m;u++){var r=
x[k[u]];r.population&&(p+=r.population)}b.values.pop+b.unitLoading+5>b.values.popMax+p&&Jc({order:l,priority:1,obj:l.obj},b,!0)}k=b.resources;l=k[0];p=k[1];var U=k[2],q=k[3],t=[];if(Infinity!=l||Infinity!=p||Infinity!=U||Infinity!=q){r=0==b.race?d.createPeon.obj:1==b.race?d.createPeon2.obj:d.createPeon1.obj;var w=0,v=0,z=0,ja=0;u=0;for(m=c.length;u<m;u++)if(c[u]){var B=c[u].obj.cost;w+=B[0];v+=B[1];z+=B[2];ja+=B[3]}var C=~~(I.digTime/1E3),G=~~(I.kirkaTime/1E3),F=~~(I.kirkaTime/1E3),N=~~(I.cutTime/
1E3),L=B=0,P=0,S=0,M=f[r.type];u=0;for(m=M.length;u<m;u++)if(r=x[M[u]],40==r.func)21==x[r.funcObj.u].type?B+=10/G:S+=10/F;else if(43==r.func)P+=10/C;else if(42==r.func)L+=10/N;else{if(19==r.func&&r.stock){var hc=r.stock[1];0==hc?B+=10/G:1==hc?L+=10/N:2==hc?P+=10/C:S+=10/F}(19!=r.func||r.action)&&r.func||t.put(r)}}u=0;for(m=c.length;u<m;u++)!(r=c[u])||!r.order||h[r.order.id]||6.25>P&&!r.obj.peon||(C=nh(r,e,f,b).length,G=r.obj.cost,G[0]>k[0]||G[1]>k[1]||G[2]>k[2]||G[3]>k[3]||1===C&&(Jc(r,b)?c[u]=0:
h[r.order.id]=1));if(t.length)for(c=-Infinity,u=0,k=b.building,m=k.length;u<m;u++){r=x[k[u]];if(r.population)break;r=r.time*(1-r.health/r.maxHealth);r>c&&(c=r)}u=0;for(m=t.length;u<m;u++)if(r=t[u],c=kj(B,L,P,S,l,p,U,q,w,v,z,ja),0==c)(c=mj(xa[0][21],r.x32,r.y32))&&nj(c,r,this,b);else if(1==c)oj(r);else if(2==c){a:{c=f[20];e=c.length;for(h=0;h<e;h++)if(k=x[c[h]],!k.workers.length&&14E3<25*(n.cycle-k.lastUse)){k.lastUse=n.cycle+100;c=k;break a}c=void 0}if(c)Q(vc,c.id,[r.id]);else{C=xa[b.k];c=A;G=Kb[2];
e=[];e.length=G.length;h=0;for(k=G.length;h<k;e[h]=C[G[h++]]);C=Infinity;G=y[20].space;F=-1;h=0;for(k=e.length;h<k;h++)for(N=e[h],M=0,hc=N.length;M<hc;M++){var O=x[N[M]],W=O.x32-10,K=O.y32-10,X=O.space[O.space.length-1],Z=O.x32+.5*X;O=O.y32+.5*(O.space.length-1)/X;for(X=0;400>X;X++){var T=X%20,V=~~(X/20);T+=W;V+=K;var Y=(T+1-Z)*(T+1-Z)+(V+1-O)*(V+1-O);Y<C&&qh(T,V,G)[1]&&(F=T+V*c,C=Y)}}c=F;-1<c&&(Q(uc,[c,20],[r.id]),p-=200)}}else 3==c&&(c=mj(xa[0][22],r.x32,r.y32))&&nj(c,r,this,b);f=!1;ja=Infinity;
P=b.diplomacy;v=b.origin[0];z=b.origin[1];w=xa[b.k];u=1;for(m=H.length;u<m;u++)P[u]&&!H[u].death&&H[u].origin&&(r=H[u],B=r.origin[0]-v,L=r.origin[1]-z,b=B*B+L*L,b<ja&&(ja=b,f=r));if(f){b=[];u=B=0;for(m=w.length;u<m;u++)for(L=w[u],ja=0,P=L.length;ja<P;ja++)r=x[L[ja]],void 0!=r.func||r.standardFunc!=R||r.death||r.build||(b[B++]=r.id);if(60<b.length){r=f.origin[0];w=f.origin[1];u=.5*I.AIxtension;k=[u,0,-u,0,0,u,0,-u];ja=Infinity;u=0;for(m=k.length;u<m;u+=2)if(B=k[u],L=k[u+1],B+=v+10*Math.sign(B),L+=
z+10*Math.sign(L),(B-r)*(B-r)+(w-L)*(w-L)<ja&&ma(B,L)){ja=(B-r)*(B-r)+(w-L)*(w-L);var ba=B+L*g}m=ba%g;v=~~(ba/g);z=-1;B=Infinity;w=xa[f.k];u=0;for(length=w.length;u<length;u++)for(f=w[u],ja=0,L=f.length;ja<L;ja++)r=x[f[ja]],P=(r.x32-m)*(r.x32-m)+(r.y32-v)*(r.y32-v),P<B&&(B=P,z=r.x32+r.y32*g);-1<z&&Q(rh,[ba,z],b)}}n.blocked=!1}}};var nj=function(c,b,e,f){var d=$a[b.race].storage,h=x[c],l=x[e.mineGroup[c]];!l&&f.paypalTest(d.cost)?(h=Ef(h.x32+2,h.y32+2,20,0,0,f,d,0),-1<h&&Q(uc,[h,d.type],[b.id]),e.mineGroup[c]=
f.building[f.building.length-1]):l&&!1===l.built?Q(wc,l.id,[b.id]):Q(vc,c,[b.id])},oj=function(c){for(var b=H[c.kingdom],e=xa[b.k],f=Kb[1],d=0,h=f.length;d<h;d++)for(var l=e[f[d]],p=0,u=l.length;p<u;p++){var k=x[l[p]];if(!k.castle){if(!1===k.built)return Q(wc,k.id,[c.id]);if(k=pj(k.x32,k.y32,.075))return Q(vc,k,[c.id])}}l=b.building;d=0;for(h=l.length;d<h;d++)if(k=x[l[d]],1===k.storage)return Q(wc,k.id,[c.id]);e=$a[c.race].lumbermill;f=b.origin[0];l=b.origin[1];d=1;h=b.resources;p=e.cost;if(p[0]<
h[0]&&p[1]<h[1]&&p[2]<h[2]&&p[3]<h[3])for(;80>d;){--f;--l;u=2*d+1;k=2*d+1;p=0;for(h=u*k;p<h;p++){var m=p%u,r=~~(p/u);if(!m||!r||m==u-1||r==k-1)if(m+=f,r+=l,-1<pj(m,r,.15,!0)&&(m=Ef(m,r,8,0,0,b,e,0),-1<m))return Q(uc,[m,e.type],[c.id])}d++}b=xa[0][7];d=b.length;h=Infinity;for(e=p=0;e<d;e++)f=x[b[e]],l=Math.pow(c.x32-f.x32,2)+Math.pow(c.y32-f.y32,2),l<h&&(h=l,p=f.id);(b=p)&&Q(vc,b,[c.id])},pj=function(c,b,e,f){var d=A,h=c,l=b;c-=5;b-=5;for(var p=0,u=-1,k=Infinity,m=0;100>m;m++){var r=m%10,n=~~(m/10);
r+=c;n+=b;if(ma(r,n)){var q=x[K[r+n*d]];if(f&&1==q.storage)return-1;7===q.type&&(p++,r=Math.pow(r-h,2)+Math.pow(n-l,2),r<k&&(k=r,u=q.id))}}if(p/100>=e)return u},rh=function(c,b){var e=A,f=c[0];c=c[1];var d=c%e;e=~~(c/e);for(var h=0,l=b.length;h<l;h++){var p=x[b[h]];6400<(p.x32-d)*(p.x32-d)+(p.y32-e)*(p.y32-e)?qa(-f,p,he,p.url.move):qa(-c,p,he,p.url.move)}Hf(!1,b);hb({func:qj,data:{list:b,xy:-c}},3E4,1)},qj=function(c){var b=c.list;c=c.xy;for(var e=0,f=b.length;e<f;e++){var d=x[b[e]];d.death||qa(c,
d,he,d.url.move)}},lj=function(c){for(var b={},e=0;e<c.length;e++)c[e]&&!c[e].obj.tech&&(b[c[e].obj.name]||(b[c[e].obj.name]=0),b[c[e].obj.name]++,"Blacksmith"==c[e].obj.name&&O(c[e]));O(b)},sh=function(c){var b=c.x32+c.y32*A,e=H[c.kingdom].diplomacy;!c.invisible&&oc[b]&&(b=x[oc[b]],!b.freezed&&e[b.kingdom]&&xc(c.id,[b.id],0,Ad))},qd=function(c){var b=th(c.id);return b?(xc(b,[c.id],0,Ad),!0):!1},th=function(c,b){c=x[c];if(!c.freezed&&!c.invisible&&!1!==c.built){var e=c.x32,f=c.y32,d=H[c.kingdom].diplomacy,
h=c.sight;c.build&&(h=c.attDist);var l=A,p=2*h+1,u=!!c.confused,k=0;b&&(k=h-b);for(var m=Infinity,r=!1,n=0,q=p*p;n<q;n++){var t=n%p-h,w=~~(n/p)-h,v=Math.sqrt(t*t+w*w);if(v<=h&&v>=k&&(t+=e,w+=f,ma(t,w)))for(var y=0;3>y;y++){b=rb[y][t+l*w];var B=x[b];if((B&&B.kingdom&&(d[B.kingdom]||B.confused)||u)&&!(B.death||B.invisible||c.attackOnly&&!c.attackOnly[B.type]||b==c.id||B.item||B.field)){var z=zd[c.type][B.type];z||(z=0);B=v*v+.05*B.health-(z+1)*c.attack;B<m&&(r=b,m=B)}}}return r}},Nl=function(c){c.setupINTV(rj,
c.id,1E3)},rj=function(c){c=x[c];var b=c.free;b||(b=sj);var e=A,f=c.x32,d=c.y32,h=[];h.length=H.length;for(var l=h.length,p=0;p<l;h[p++]=0);p=0;for(var u=b.length;p<u;p+=2){var k=b[p]+f,m=b[p+1]+d;ma(k,m)&&(k=x[K[k+m*e]],k.nocapture||k.build||h[k.kingdom]++)}e=b=0;for(p=1;p<l;p++)h[p]>b&&(e=p,b=h[p]);b&&c.kingdom!=e&&c.changeKingdom(e);ec(c,1E3)},If,Ol=[1,1],tj=function(){return 25*(Date.now()-n.loadDate+n.pausedTime+n.deltaTime)/Kc.speed},Yb=function(c){if(!(c&&n.online||Yb.bySystem&&c))if(0===n.paused){n.paused=
1;void 0!=If&&clearInterval(If);var b=n.now();n.pausedTime+=Date.now();c||(Yb.bySystem=1);n.now=function(){return b}}else n.pausedTime-=Date.now(),n.paused=0,Yb.bySystem=0,c&&(document.getElementById("alert").style.display="none"),If=setInterval(Kc,Kc.speed),n.now=tj};Yb.bySystem=0;Yb.fast=!0;var Fa=function(c,b){var e=!1;if(1>c){c*=-1;var f=~~(c/Ka),d=c%Ka}else e=c;c=0;for(var h=b.length;c<h;c++){var l=x[b[c]];l.build||l.cow&&l.workers.length||e==l.id||l.freezed||l.in||l.stoned||(l.action=null,l.distance=
0,l.mv&&null!=l.xf?(e?(l.xf=e,l.yf=!0):(l.xf=d,l.yf=f),l.nodes=void 0):l.x32==d&&l.y32==f?l.stay():(l.dix=(d-l.x32)/Math.abs(d-l.x32),l.diy=(f-l.y32)/Math.abs(f-l.y32),e?(l.xf=e,l.yf=!0):(l.xf=d,l.yf=f),l.mv=!0,l.setupINTV(ie,l.id,0),uh(l),l.action=null))}},uh=function(c){c.stock&&0!==c.stock[0]?(c.mimg=c.url[c.stock[4].url],c.stock[3]===Lc&&(c.mimg=c.url.milk)):c.mimg=c.url.move};Fa.cursor=7;Fa.allowPos=1;var ec=function(c,b,e){b=~~(b/25)+n.cycle;e=bd[b];e||(e=[],bd[b]=e);var f=e.length;c.c=b;e[f]=
c.id;c.timestamp=n.now()},bd={},Jf=function(c){var b=x[c[0]];if(!b.death){var e=c[1],f=c[2],d=c[3];b.cow&&"milk"==e&&b.workers&&b.workers.length||(b[e]+=H[b.kingdom].values[f],f=b[e+"Max"],b[e]>f&&2!==b.blocked&&(b[e]=f));"mana"==e&&(f=b.manaTask)&&f[2]<=b[e]&&(b.blockedAction(1),qa(f[1],b,mb[f[0]],b.url.move),b.manaTask=void 0);da(b.id,1);hb({func:Jf,data:c},d,1)}},hb=function(c,b,e){c.func.url||O(c.func);c.func=c.func.url;e&&(b=~~(b/25)+n.cycle);e=cd[b];e||(e=[],cd[b]=e);e.put(c)},cd={},ie=function(c){c=
x[c];var b=A,e=!1;c.waiting&&uh(c);var f=c.y32,d=c.x32;vh(1,c,"zone");var h=mb[c.action];nb(c,32*f);var l=rb[c.zLevel],p=d+f*b;sh(c);if(c.id===l[p]){var u=c.size;if(2>u)l[p]=c.radix;else for(var k=u*u,m=-b,r=0;r<k;r++){var n=r%u;0===n&&(m+=b);l[p+n+m]=0}}if(c.stop)return l[p]=c.id,c.stay(),c.stop=void 0,0;if(c.kx||c.ky){var q=c.kx||0,t=c.ky||0;k=!1;if(0!==l[q+d+(t+f)*b])return c.aspettare()}else{h&&h.rev&&(k=h.rev(c))&&(c.action=k[0],h=mb[c.action],c.xf=k[1],c.yf=!0);if(!0===c.yf){k=c.xf;var w=x[k];
if(!w||w.death&&(!h||!h.available))return l[p]=c.id,c.stay();r=!0;m=!1;if(h&&h.available){m=h.available(c,w);if(!1===m)return c.aspettare();if("kill"===m)return l[p]=c.id,c.stay();if(55===m)return l[p]=c.id;r=m[2]}else w.death||(m=Mc(w,c,50,c.radix));c.xf!==k&&(w=x[c.xf]);if(!w||w.death||w.in)return l[p]=c.id,c.stay();if(!r&&(v+y*b===p||h))return c.aspettare();var v=m[0],y=m[1];if(h&&h.distance){var B=h.distance;B=0>B?c.attDist:H[c.kingdom].values[B];m=wh(w,d,f);je(d,f,m%A,~~(m/A),B)&&(e=2)}c==w&&
(e=2)}else{v=c.xf;y=c.yf;k=l[v+y*b];if(2<k&&(!h||h&&h.rev)){k=x[k];m=Mc(k,c,50,c.radix);if(!1===m)return l[p]=c.id,c.stay();v=m[0];y=m[1]}h&&h.distance&&(B=h.distance,B=0>B?c.attDist:H[c.kingdom].values[B],je(d,f,v,y,B)&&(e=2))}k=v+y*b;m=v;r=y;if(c.nodes){var z=c.nodes;20<z.length&&(z.length=2);r=z[z.length-2];m=r%b;r=~~(r/b);n=z[z.length-1];if(d+f*b==m+r*b||l[n]==c.radix||l[m+r*b]!==c.radix)z.length-=2,z.length?(r=z[z.length-2],m=r%b,r=~~(r/b)):(m=v,r=y,c.nodes=void 0)}if(!e){q=m;t=r;n=c.radix;z=
A;var C=d+f*z,G=q+t*z,F,L=q-d,P=t-f,N=Math.sqrt(L*L+P*P);for(F=0;16>F;F++){var I=~~(8*xh(C%z-q,~~(C/z)-t)+.5)%8;if(C===G)break;var Q=l[C+fc[I]];if(Q===n||Kf(Q))C+=fc[I];else if(Q=l[C+fc[(I+1)%8]],Q===n||Kf(Q))C+=fc[(I+1)%8];else{var O=I-1;-1===O&&(O=7);Q=l[C+fc[O]];if(Q===n||Kf(Q))C+=fc[O];else{C+=fc[I];break}}if(!F)var M=C;ke&&Bd(C%z,~~(C/z),"stone")}I=0;Q=-1;if(l[C]>n){2<l[C]&&(Q=C);var R=[C],S=1,X=0,W={};W[C]=2;for(var T=Infinity,K=-Infinity,V=0;void 0!==(O=R[X++]);){ke&&Bd(O%z,~~(O/z),"food");
F=O%z;var Z=~~(O/z);F=((F-q)*P-(Z-t)*L)/N;F<T?(T=F,I=O):F>K&&(K=F,V=O);for(F=0;4>F;F++)if(C=O+uj[F],ma(C%z,~~(C/z))&&!W[C]&&l[C]!==n&&!Kf(l[C]))for(G=0;8>G;G++)if(l[C+fc[G]]===n){R[S++]=C;W[C]=2;break}}ke&&Bd(I%z,~~(I/z),"gold");ke&&Bd(V%z,~~(V/z),"gold");O=Math.pow(T,2)<=Math.pow(K,2)?I:V;T=-Infinity;for(G=0;8>G;G++){C=O+fc[G];if(F=l[C]===n)F=A,R=O+fc[G],F=1<Math.abs(O%F-R%F)||1<Math.abs(~~(O/F)-~~(R/F))?!1:!0;F&&(F=C%z,Z=~~(C/z),F=((F-q)*P-(Z-t)*L)/N,Math.pow(F,2)>T&&(I=C,T=Math.pow(F,2)))}ke&&
Bd(I%z,~~(I/z),"wood")}t=[M,I,Q];M=t[0];q=t[1];n=t[2];q&&(c.nodes?(c.nodes.put(q),c.nodes.put(n)):c.nodes=[q,n]);void 0!==M?(q=-d+M%b,t=-f+~~(M/b)):t=q=1;if(1<Math.abs(q)||1<Math.abs(t))return c.aspettare();if(l[d+q+(f+t)*b]!==c.radix||!ma(d+q,f+t)){M=[d+1,f,d-1,f,d+1,f+1,d+1,f-1,d,f-1,d-1,f+1,d,f+1,d-1,f-1];q=A;t=Infinity;for(n=0;n<M.length;n+=2)if(0===l[M[n]+M[n+1]*q]&&ma(M[n],M[n+1])&&t>=(M[n]-m)*(M[n]-m)+(M[n+1]-r)*(M[n+1]-r)){t=(M[n]-m)*(M[n]-m)+(M[n+1]-r)*(M[n+1]-r);var Y=n}m=[M[Y],M[Y+1]];
q=m[0]-d;t=m[1]-f;q=0<q?1:0>q?-1:0;t=0<t?1:0>t?-1:0;if(l[d+q+(f+t)*b]!==c.radix||!ma(d+q,f+t))return c.aspettare()}}}if(p==k||e)if(l[d+f*b]=c.id,c.x32=d,c.y32=f,h){if(h.distance&&2!==e)return c.aspettare();c.stay(1);w||(w=v+y*b);c.action=void 0;h(w,c,B)}else c.stay();else{if(0===q&&0===t)return c.aspettare();c.setupDir(q,t);e=c.spd;na(c,c.mimg,-1,c.spd/c.__proto__.spd);c.dix=q*e;c.diy=t*e;f+=t;d+=q;c.x32=d;c.y32=f;c.distance++;ec(c,~~(32E3/e));Nc(c,q*e,t*e,0);p=d+f*b;if(2>u)l[p]=c.id;else for(k=u*
u,m=-b,r=0;r<k;r++)n=r%u,0===n&&(m+=b),l[p+n+m]=c.id}},Kc=function(){if(!n.editor){var c=n.cycle;n.now();var b=Date.now();if(n.demo){var e=n.record[c];if(e)for(var f=0;f<e.length;f+=3)Lf[e[f]](e[f+1],e[f+2])}if(e=cd[c]){for(f=0;f<e.length;f++){var d=e[f];mb[d.func](d.data)}delete cd[c]}if(e=bd[c]){for(f=0;f<e.length;f++)d=x[e[f]],d.c===c&&(d.death?O("anti stall:",mb[d.func].name,d.func,d):(d.c=void 0,mb[d.func](d.funcObj)));delete bd[c]}n.cycle++;if(n.online&&0===n.cycle%(Cd.maxPing/25))var h=Cd();
n.online&&0===n.cycle%80&&sb();yh+=Date.now()-b;0===n.cycle%40&&(c=n.now()/1E3,b=~~(c/60)%60,e=~~(c/3600),c=~~(c%60),1===(c+"").length&&(c="0"+c),0!=e?(e+=":",10>b&&(b="0"+b)):e="",t("topinfo").innerHTML="<span>CPU:"+(yh/10).toFixed(2)+"%</span> <span>"+~~(zh/Ah+.5)+"FPS</span> <span>"+e+b+":"+c+"</span>",zh=Ah=yh=0);!h&&!n.automatic&&n.now()-(n.cycle-1)*Kc.speed>=Kc.speed&&Kc()}};Kc.speed=25;var yh=0,Ah=0,zh=0,fc,uj,Bd=function(c,b,e){e=Object.assign({},gc[e]);e.x32=c;e.y32=b;e.z32=2;yb(e);Lb.new(e,
500)},Kf=function(c){return(c=x[c])&&19===c.func&&!c.waiting?!0:!1},ke,xh=function(c,b){c=.5-Math.atan2(b,c)/(2*Math.PI);1==c&&(c=0);return c},dc=function(c,b,e,f){return[c,b,e,f,c,b,e,f,c,b,e,f,c,b,e,f]},Mf=new Float32Array(dc(1,0,0,.75)),Pl=new Float32Array(dc(1,1,1,.5)),vj=new Float32Array(dc(0,1,0,.75)),Ql=new Float32Array(dc(0,1,0,.9)),Rl=new Float32Array(dc(.3515625,.29296875,.21875,.9)),wj=new Float32Array(dc(0,1,1,.9)),Bh=new Float32Array(dc(1,1,1,.5)),xj=new Float32Array(dc(.3,.3,.3,.9)),
yj=new Float32Array(dc(.7,.2,.2,.9));wj.noAlpha=1;xj.noAlpha=1;yj.noAlpha=1;var ba=function(c){var b=y[c];if(1===G.length){var e=G[0];Q(ge,[c,4*Fb.shift+1,Bb],e)}else for(var f=0,d=4*Fb.shift+1;f<d;f++){var h=G,l=Infinity;e=-1;for(var p=0,u=h.length;p<u;p++){var k=x[h[p]];if(!k.techStart&&!1!==k.built){var m=k.icons.indexOf(b.nu);m=(k.work&&k.work[m]||0)+(n.online&&k.usedCycle==n.cycle&&k.usedTimes||0);m<l&&(!Bb||m)&&(l=m,e=k.id)}}0<e&&(h=x[e],h.usedCycle!=n.cycle&&(h.usedTimes=0,h.usedCycle=n.cycle),
h.usedTimes++,Q(ge,[c,1,Bb],e))}},ge=function(c,b){var e=c[0],f=c[1],d=c[2];c=y[e];b=x[b];var h=b.icons.indexOf(c.nu);if(!(0>h||void 0!==b.techID)){performance.now();if(0==d)for(d=0;d<f;d++){var l=H[b.kingdom],p=l.mod[e].cost||c.cost;if(l.paypal(p))break;b.waitlist||(b.waitlist=[]);b.waitlist.push(e,-h-1);b.work||(b.work={});b.work[h]||(b.work[h]=0);b.work[h]++;b.working=1;l.unitLoading++;2==b.waitlist.length&&(p=1E3*c.time,b.setupINTV(le,b.id,p))}else{if(!b.work||!b.waitlist.length)return;var u=
b.waitlist;l=H[b.kingdom];for(d=0;d<f;d++){p=l.mod[e].cost||c.cost;l.setupResources(p,-1);p=u.lastIndexOf(e);if(0>p)break;u.splice(p,2);b.work[h]--;if(0==u.length){b.c=-1;b.working=0;break}l.unitLoading--;0===p&&(p=1E3*y[u[0]].time,b.setupINTV(le,b.id,p))}}da(b.id)}},zj=0,le=function(c){c=x[c];if(c.death||c.waitlist&&!c.waitlist.length)return!1;var b=c.kingdom;b=H[b];var e=b.values.pop>=b.values.popMax?q.houseLimit:q.popLimit;if(b.values.pop>=b.values.popMax||b.values.pop>=b.values.popLimit)return document.getElementById("msgs1").getElementsByTagName("li"),
3E4<Date.now()-zj&&b.k==v.kingdom&&Oc(e,0,5),zj=Date.now(),b.onFreePop.put(c.id),!0;b.unitLoading--;b=c.waitlist[0];e=y[b];c.work[-c.waitlist[1]-1]--;c.waitlist.splice(0,2);0<c.waitlist.length?c.setupINTV(le,c.id,1E3*e.time):c.working=0;me(b,c);da(c.id);return!0},ab=function(){if(0==Bb){var c=x[G[0]];Q(Nf,[c.mlistID[Ga.nu],!0],c.id)}},ob=function(){if(0==Bb){var c=x[G[0]];Q(Nf,[c.hlistID[Ga.nu],!1],c.id)}},Aj=function(c,b,e){var f=1.6,d=0;1===b&&(e=0,f=3.6,d=620);return[d+~~(f*c[0]*b+.5)+e*I.fameGold,
~~(f*c[1]*b+.5),~~(f*c[2]*b+.5),~~(f*c[3]*b+.5)]},Nf=function(c,b){var e=c[0];c=c[1];b=x[b];var f=H[b.kingdom],d=H[b.kingdom];if(d.values.pop>=d.values.popMax&&b.kingdom==v.kingdom)return Oc(q.popLimit,0,5);if(c)var h=d.values.fameTech;d=I.fameExp;var l=I.mercenaries*c;l||(l=1);if(c)var p=b.mlist,u=b.mlistID;else p=b.hlist,u=b.hlistID;var k=u.indexOf(e);if(!(0>k)){e=p[k].unit;var m=Aj(y[e].cost,l,h);if(f.paypal(m))return 0;p.splice(k,1);u.splice(k,1);S.active==p&&ka(p);for(f=0;f<l;f++)u=me(e,b),h?
u.level=d:c||(d=I.heroExp,u.level=d,p=Bj[u.race],u.name=p[u.id%p.length],Cj(u))}},me=function(c,b,e,f){var d=A,h=b.kingdom;b.rnd||Ch(b);var l=-1,p=-1;if(b.point&&!b.disallowPoint){var u=b.point[0],k=b.point[1];l=Dj(b,u,k,y[c].radix,y[c].rbase())[0]}else l=Dj(b,l,p,y[c].radix,y[c].rbase())[1],l=l[Ej(b,l.length)];p=~~(l/d);c=new dd(c,h,l%d,p,0,!1,f);ne(h);e||Ea("unitdone",0,0,c.kingdom);if(b.point&&(b=Dh(u,k,c,!0),e=b[1],b[0]))b[0](e,[c.id]);return c},Of=0,Pf=0,Jb,zb,$d,N=function(c){W=function(){};
c=y[c];Jb=!1;var b=C;na(b,c.img);b.active=!0;zb=c;$d=!1;document.addEventListener("mousemove",eh);document.addEventListener("mousedown",xf)},xf=function(c){var b=zb.validator,e=zb.space,f=Z[zb.img];0==c.button&&151<c.pageX?(c=ic(c.pageX-v.mx-.5*f[8]/V,c.pageY-.5*f[9]/V),f=~~(.03125*c[1]),c=~~(.03125*c[0]),b(c,f,e,v.kingdom)[1]&&(Jb=!0,C.active=!0,C.x=-9999,C.y=-9999,document.removeEventListener("mousedown",xf),Q(uc,[c+A*f,zb.type,$d],G),Fb.shift&&($d?$i($d):N(zb.type))),W=function(){}):(C.active=
!0,C.x=-9999,C.y=-9999,Jb=!0,W=function(){},document.removeEventListener("mousedown",xf))},eh=function(c){var b=zb.validator,e=zb.space,f=Z[zb.img];if(Jb)document.removeEventListener("mousemove",eh);else{var d=c.pageX,h=c.pageY;if(d!=Of||h!=Pf)C.active=!0,Of=d,Pf=h,d=ic(c.pageX-v.mx-.5*f[8]/V,c.pageY-.5*f[9]/V),h=~~(.03125*d[1]),d=~~(.03125*d[0]),c=32*d,f=32*h,(b=!b(d,h,e,tb.k)[1])?b!=Pc&&(Pc=b,k.bindBuffer(k.ARRAY_BUFFER,Qb),k.bufferSubData(k.ARRAY_BUFFER,16*C.bufferID,Mf)):b!=Pc&&(Pc=b,k.bindBuffer(k.ARRAY_BUFFER,
Qb),k.bufferSubData(k.ARRAY_BUFFER,16*C.bufferID,vj)),C.x=c,C.y=f}},uc=function(c,b){var e=c[0],f=e%Ka,d=~~(e/Ka),h=n.editor?v.kingdom:x[b[0]].kingdom;e=c[1];var l=y[e],p=l.cost,u=H[h];if(!l.validator(f,d,l.space,h)[1]||!n.editor&&u.paypal(p))return!1;c=new dd(e,h,f,d,0,!n.editor,c[2]);if(!0===c.invalid||n.editor)return!1;c.waitlist=[];if(20===e)c.built=1,f=x[b[0]],qa(c.id,f,ed,f.url.move);else for(c.health=1,na(c,c.bimg),c=c.id,e=0,d=b.length;e<d;e++)f=x[b[e]],f.buildList?(f.buildList.put(c),f.func!==
Qf.url&&(h=Rf(f.buildList,f.x32,f.y32))&&qa(h,f,fd,f.url.move)):(f.buildList=[c],f.func!==Qf.url&&qa(c,f,fd,f.url.move))},Pc=null,Fh=function(c){W=function(){};c=y[c];Jb=!1;var b=C;zb=c;na(b,c.img);document.addEventListener("mousemove",Fj);document.addEventListener("mousedown",Eh)},Eh=function(c){var b=A,e=Z[zb.img];if(0==c.button&&151<c.pageX){c=ic(c.pageX-v.mx-.5*e[8]/V,c.pageY-.5*e[9]/V);var f=~~(.03125*c[1]);c=~~(.03125*c[0]);k.bindBuffer(k.ARRAY_BUFFER,Qb);k.bufferSubData(k.ARRAY_BUFFER,0,Rl);
var d=fa[2];fa[2]=32;fa[5]=32;fa[8]=32;fa[11]=32;C.wall=c+f*b;var h=c;document.addEventListener("mouseup",function u(c){ub.forced=!1;c=Na[3*v.kingdom];var e=Na[3*v.kingdom+1],g=Na[3*v.kingdom+2];w[0]=c;w[1]=e;w[2]=g;w[3]=.5;w[4]=c;w[5]=e;w[6]=g;w[7]=.5;w[8]=c;w[9]=e;w[10]=g;w[11]=.5;w[12]=c;w[13]=e;w[14]=g;w[15]=.5;k.bindBuffer(k.ARRAY_BUFFER,Qb);k.bufferSubData(k.ARRAY_BUFFER,0,w);fa[2]=d;fa[5]=d;fa[8]=d;fa[11]=d;var p=~~(fa[9]/32),m=~~(fa[10]/32);e=Math.abs(h-p);g=Math.abs(f-m);e&&--e;g&&--g;c=
1;p=p<h?p:h;var n=m<f?m:f;m=[p+n*b];for(var q=0;q<e+1;q++)m[c++]=p+q+n*b,g&&(m[c++]=p+q+(n+g)*b);for(q=1;q<g;q++)m[c++]=p+(n+q)*b,e&&(m[c++]=p+(n+q)*b+e);for(q=1;q<c;q++)e=m[q],Jb=!0,W=function(){W=Zb},Qc(2),Q(uc,[e,zb.type],G);C.active=!0;C.x=-9999;C.y=-9999;Fb.shift&&Fh(zb.type);document.removeEventListener("mouseup",u)});document.removeEventListener("mousedown",Eh);Jb=!0}else C.active=!0,C.x=-9999,C.y=-9999,Jb=!0,W=151<c.pageX?0:Zb,document.removeEventListener("mousedown",Eh)},Fj=function(c){var b=
A,e=Z[zb.img];if(Jb)document.removeEventListener("mousemove",Fj);else{var f=c.pageX,d=c.pageY;if(f!=Of||d!=Pf){var h=!0;Of=f;Pf=d;C.active=!0;c=ic(c.pageX-v.mx-.5*e[8]/V,c.pageY-.5*e[9]/V);e=~~(c[1]/32);c=~~(c[0]/32);f=32*c;d=32*e;0==K[c+e*b]&&(h=!1);h?h!=Pc&&(Pc=h,k.bindBuffer(k.ARRAY_BUFFER,Qb),k.bufferSubData(k.ARRAY_BUFFER,16*C.bufferID,Mf)):h!=Pc&&(Pc=h,k.bindBuffer(k.ARRAY_BUFFER,Qb),k.bufferSubData(k.ARRAY_BUFFER,16*C.bufferID,vj));C.x=f;C.y=d}}},Gh=function(c,b){c=0;for(var e=b.length;c<e;c++){var d=
x[b[c]];d.xf?d.stop=1:d.stay()}},Sf=function(c,b){c=x[b[0]];c.techStart=0;c.c=void 0;b=c.techID;c.techID=void 0;if(b){var e=H[c.kingdom].technology.hidden;-1<b&&(e[b]=0);H[c.kingdom].setupResources(z[c.activeTech].cost,-1)}else if(c.lcost)H[c.kingdom].setupResources(c.lcost,-1);else return;da(c.id)},F=function(c){Q(Ff,[c,Ga.lastFunc.id],x[G[0]].id)},Ff=function(c,b){var e=c[0];c=c[1];var d=z[e],g=x[b];d.upgrade&&(c=-1);if(void 0!==g.techID||g.waitlist&&g.waitlist.length||H[g.kingdom].paypal(d.cost))return!1;
g.activeTech=e;g.techID=c;g.setupINTV(d.type,[e,c,b],1E3*d.time);g.techStart=g.c-n.cycle;e=H[x[b].kingdom].technology.hidden;-1<c&&(e[c]=1);da(b)},aa=function(c){var b=c[1],e=x[c[2]];c=z[c[0]];yc(e,c,b)},Tf=function(c){var b=c[1],e=x[c[2]];c=z[c[0]];var d=y[c.obj],g=H[e.kingdom].mod[d.type];Hh(e);e.img=d.img;e.attack=g.attack||d.attack;e.health=e.health/e.maxHealth*d.health;e.maxHealth=d.health;e.__proto__=d;yb(e);yc(e,c,b)},Uf=function(c){var b=c[1],e=x[c[2]];c=z[c[0]];if(c.actvintv)for(var d=c.actvintv,
g=0,h=d.length;g<h;g++){var l=d[g];H[e.kingdom].technology.disabled[l.id]=0;for(var p=l.builds,u=xa[e.kingdom],k=0,m=p.length;k<m;k++)for(var r=u[p[k]],n=0,q=r.length;n<q;n++)l(x[r[n]])}yc(e,c,b)},Ha=function(c,b){var e=c[1];b=x[c[2]];c=z[c[0]];H[b.kingdom].values[c.value]+=c.increase;"popMax"==c.value&&ne(b.kingdom);yc(b,c,e)},Gj=function(c,b){var e=c[1];b=x[c[2]];c=z[c[0]];var d=c.group,g=H[b.kingdom],h=xa[g.k];g=g.mod;for(var l=0,p=d.length;l<p;l++)for(var u=g[d[l].type],k=h[d[l].type],m=0,r=c.values,
n=r.length;m<n;m+=2){var q=r[m],t=r[m+1];u[q]||(u[q]=d[l][q]||0);for(var w=0,v=k.length;w<v;w++)x[k[w]][q]+=t;u[q]+=t}yc(b,c,e)},Mb=function(c,b){var e=c[1];b=x[c[2]];c=z[c[0]];var d=c.group,g=H[b.kingdom],h=g.mod;g=xa[g.k];for(var l=0,p=d.length;l<p;l++){var u=h[d[l].type];u[c.value]||(u[c.value]=d[l][c.value]||0);u[c.value]+=c.increase;u=g[d[l].type];for(var k=0,m=u.length;k<m;k++)x[u[k]][c.value]+=c.increase}yc(b,c,e)},Ih=function(c,b){var e=c[1];b=x[c[2]];c=z[c[0]];for(var d=H[b.kingdom].mod,
g=c.mulp,h=0,l=c.group.length;h<l;h++){var p=c.group[h],u=d[p.type].cost||p.cost;d[p.type].cost=g?[~~(u[0]*g),~~(u[1]*g),~~(u[2]*g),~~(u[3]*g)]:[u[0]-c.decrease[0],u[1]-c.decrease[1],u[2]-c.decrease[2],u[3]-c.decrease[3]]}yc(b,c,e)},Jh=function(c,b){var e=c[1];b=x[c[2]];c=z[c[0]];for(var d=H[b.kingdom].mod,g=0,h=c.decrease,l=h.length;g<l;g+=2){var p=h[g],u=h[g+1],k=d[p.type].cost||p.cost;d[p.type].cost=[k[0]-u[0],k[1]-u[1],k[2]-u[2],k[3]-u[3]]}yc(b,c,e)},yc=function(c,b,e){c.techStart=void 0;c.activeTech=
void 0;c.techID=void 0;c.func=void 0;var d=H[c.kingdom].technology,g=d.disabled;d.investigated[e]=1;Ea("techdone",0,0,c.kingdom);if(b=b.next){e=!1;d=0;for(var h=b.length;d<h;d++){var l=b[d].id;g[l]--;ka.actv[l]&&(e=!0)}e&&ka(S.active)}c.standardFunc&&c.standardFunc(c);da(c.id)};"use strict";var Kb,Sl={icon:"food",img:"item_meat",url:"meat"},Tl={icon:"milk",img:"milk",url:"milk"},Ul={icon:"gold",img:"item_gold",url:"gold"},Vl={icon:"stone",img:"item_stone",url:"stone"},Hj={icon:"wood",img:"item_tree",
url:"tree"},Wl={icon:"food",img:"item_food",url:"food"},oe=function(c,b,e,d){c=xa[c];var f=Kb[b];b=[];b.length=f.length;for(var h=0,l=f.length;h<l;b[h]=c[f[h++]]);c=Infinity;f=-1;for(h=0;h<b.length;h++){l=b[h];for(var p=l.length,u=0;u<p;u++){var k=x[l[u]];if(!1!==k.built){var m=k.x32,r=k.y32,n=k.space;k=n[n.length-1];n=(n.length-1)/k;k*=.5;n*=.5;m+=k;r+=n;k=.5*(k+n);m=Math.sqrt((m-e)*(m-e)+(r-d)*(r-d))-k;c>=m&&(c=m,f=l[u])}}}return f},oa,Xl=function(c){if("string"==typeof c){for(var b=1,e=0,d=c.length;e<
d;e++)b+=b*(c.charCodeAt(e)/65535)*(e+1);c=b+d}var g=4294967295-c,h=4294967295+c;e=0;oa=function(){h+=e;g-=e++;h=36969*(h&65535)+(h>>16)&4294967295;g=18E3*(g&65535)+(g>>16)&4294967295;return((h<<16)+g&4294967295)/4294967295+.5}},Ej=function(c,b){c=c.rnd;var e=c[0],d=c[1],g=c[2];e+=g;d-=g;e=36969*(e&65535)+(e>>16)&4294967295;d=18E3*(d&65535)+(d>>16)&4294967295;c[0]=e;c[1]=d;c[2]++;return~~((((e<<16)+d&4294967295)/4294967295+.5)*b)},Qc=function(c){c!=Yl&&(document.body.className="ncursor"+c)},Yl=-1,
Dd=function(c,b){for(var e=0,d=b.length;e<d;e++){var g=x[b[e]];qa(c,g,pe,g.url.move)}};Dd.spLevel=function(c){var b=0;2<Sa[c]&&(b=Sa[c]);return b};var pe=function(c,b){b.stay55();if(b.inventory&&b.invMax===b.inventory.length||!c.item)return 1;Sa[c.x32+c.y32*A]=c.radix;nb(c,NaN);if(b.peon&&c.contain){var e=c.contain[1],d=c.contain[0];b.stock&&Ij(b);var g=Jj(b.x32,b.y32)||!1,h=c.contain[2];c.die(1);b.stock=[d,e,g,pe.url,h];c=oe(b.kingdom,e,b.x32,b.y32);qa(c,b,zc,b.url[h.url]);da(b.id);return 1}b.addItem(c);
da(b.id)},Ij=function(c){var b=Kj(c.x32,c.y32),e=~~(b/A);b%=A;b=new dd(52,c.kingdom,b,e,0);na(b,m[c.stock[4].img]);b.contain=[c.stock[0],2,c.stock[4]]},Kh=function(c,b){c=0;for(var e=b.length;c<e;c++){var d=x[b[c]];d.xf?d.stop=2:(d.stop=2,d.stay(),d.stop=void 0)}},Ed=function(c,b){var e=A;c=x[c];for(var d=0,g=b.length;d<g;d++){var h=x[b[d]];if(h.in){var l=rb[h.zLevel],p=h.x32+h.y32*e;if(0!==l[p]||!c.build){p=c.build?Vf(h,h.x32,h.y32):Vf(h,c.x32,c.y32);if(!1===p)continue;h.x32=p%A;h.y32=~~(p/A)}h.item&&
(c.attack-=h.attack||0,c.defence-=h.defence||0);h.url.idle&&na(h,h.url.idle,1);l[p]=h.id;h.in=0;c.inventory.quit(h.id);l=1;h.z32&&(l=h.z32);nb(h,32*h.y32*l)}}da(c.id,1)},qe=function(c,b){c=x[c];if(1===c.invType)for(var e=0,d=b.length;e<d;e++){var g=x[b[e]];g==c||g.in||qa(c.id,g,Lh,g.url.move)}},Lh=function(c,b){var e=c.inventory;if(e.length<c.invMax){var d=b.x32,g=b.y32;b.stay55();b.rbase()[d+g*A]=b.radix;e.put(b.id);nb(b,NaN);b.in=c.id;re(b.id);da(c.id)}else b.stay55()},wc=function(c,b){for(var e=
b.length,d=0;d<e;d++){var g=x[b[d]];g.buildList=!1;qa(c,g,fd,g.url.move)}},fd=function(c,b){if(c.dummy&&c.dummy.built)return b.stay55();if(c.health<c.maxHealth)b.dix=0,b.diy=0,b.mv=!0,b.setupDirBuild(c),na(b,b.url.build,1),b.setupINTV(Qf,{u:c.id,a:b.id},Za(b.img)),fe(b,"hit%20",7,b.img);else{if(b.buildList&&(c=Rf(b.buildList,b.x32,b.y32)))return qa(c,b,fd,b.url.move),0;b.stay55()}},Wf=function(c,b){return b[c]&&13==x[b[c]].type||13==x[K[c]].type?!0:!1},Qf=function(c){var b=x[c.u];c=x[c.a];var e=c.x32,
d=c.y32,g=b.x32+b.y32*A;if(b.death)return c.stay();var h=b.maxHealth,l=h/b.__proto__.time*H[c.kingdom].values.buildSpeed;b.health+=l;var p=b.health;if(0==b.built){if(1===b.health-l){for(var k=b.validator(b.x32,b.y32,b.space,b.kingdom)[0],n=b.id,D=b.validator.dimension,r=0,q=k.length;r<q;r++)if(2<D[k[r]]){ec(c,Za(c.img));b.health-=l;return}l=Nb[b.kingdom];r=0;for(q=k.length;r<q;r++)D[k[r]]=n,l[k[r]]=void 0;xa[b.kingdom][b.type].put(b.id);Ac(b)}k=~~(4*p/h);k>b.d&&(b.d=k,na(b,b.img))}if(p>=h){p=b.health=
h;da(b.id);if(!1===b.built){b.d=0;k=b.url;l=Nb[b.kingdom];13===b.type&&(Wf(g-1,l)&&Wf(g+1,l)?(k=m.wood_horz,b.child=void 0):Wf(g+A,l)&&Wf(g-A,l)&&(k=m.wood_vert,b.child=void 0));b.built=1;b.img=k;yb(b);if(b.valid2)for(k=b.validator(b.x32,b.y32,b.space,b.kingdom)[2],D=b.validator.dimension,r=0,q=k.length;r<q;D[k[r++]]=0);Lj(b);Ea("bldgdone",0,0,b.kingdom);H[b.kingdom].building.quit(b.id);da(b.id);b.standardFunc&&b.standardFunc(b)}b.action=void 0;(g=c.buildList)&&g.quit(b.id);if(!g||c.buildList&&0===
c.buildList.length)c.buildList=Mj(c),g=c.buildList;if(e=Rf(g,e,d))return qa(e,c,fd,c.url.move),0;c.buildList.length=0;c.stay();c.stock&&c.stock[0]&&na(c,c.url[c.stock[4].url])}else da(b.id),ec(c,Za(c.img));G[0]==b&&(Rc.innerHTML=p+"/"+h,wa.value=p)},Xf=function(c,b){if(2<c)for(var e=0,d=b.length;e<d;e++){var g=x[b[e]];qa(c,g,ed,g.url.move)}},vc=function(c,b){var e=c;c=x[c];if(c.field)for(d=0,c=b.length;d<c;d++)g=x[b[d]],qa(e,g,ed,g.url.move);else if(0===c.res||3===c.res){var d=0;for(c=b.length;d<
c;d++){var g=x[b[d]];qa(e,g,Yf,g.url.move)}}else if(1===c.res)for(d=0,c=b.length;d<c;d++)g=x[b[d]],qa(e,g,gd,g.url.move);else if(2===c.res)for(d=0,c=b.length;d<c;d++)g=x[b[d]],qa(e,g,Lc,g.url.move)},Mh=function(c,b){var e=y[c],d=b.length;c=H[x[b[0]].kingdom].mod[c];for(var g=0;g<d;g++){var h=x[b[g]];h.stay();Hh(h);h.img=e.img;h.attack=c.attack||e.attack;h.health=h.health/h.maxHealth*e.health;h.maxHealth=e.health;h.defence=c.defence||e.defence;h.__proto__=e;yb(h);da(h.id)}},xc=function(c,b,e,d){e=
d||Fd;if(!(3>c||(c=x[c],void 0!=c.res&&!c.cow||c.magicGateway))){d=0;for(var f=b.length;d<f;d++){var h=x[b[d]];h==c||h.attackOnly&&!h.attackOnly[c.type]||h.bat&&c.build||c.stoned||(h.build?e(c,h):qa(c.id,h,e,h.url.move))}}},gd=function(c,b){if(0<c.health){var e=b.x32,d=b.y32;b.mv=!0;b.setupDir(c.x32-e,c.y32-d);na(b,b.url.cut,1);b.dix=0;b.diy=0;fe(b,"chop%20",11,b.img);b.setupINTV(Nj,{u:c.id,a:b.id},I.cutTime);c.addWorker(b)}else b.stay55()},Nj=function(c){var b=A,e=x[c.u];c=x[c.a];var d=H[c.kingdom].values.wood;
e.workers.quit(c.id);var g=oe(c.kingdom,1,c.x32,c.y32),h=x[g];e.health-=d;c.mv=!1;da(e.id);if(1>e.health){d+=e.health;K[e.x32+e.y32*b]=0;b=Ta(h.x32,h.y32);h=e.health=0;for(var l=e.workers.slice(0),p=l.length;h<p;h++){var k=x[l[h]];b?qa(b,k,gd,c.url.move):k.stay()}c.stock=[d,1,b,gd.url,Hj];c.mv=!1;qa(g,c,zc,c.url.tree);da(c.id,1);e.workers.length=0;e.die()}else c.stock=[d,1,e.id,gd.url,Hj],qa(g,c,zc,c.url.tree),da(c.id,1);if(0>g)return c.stay()},ed=function(c,b){b.mv=!0;b.setupDir(c.x32-b.x32,c.y32-
b.y32);na(b,b.url.dig,1);fe(b,"dig%20",3,b.img);b.setupINTV(Oj,{u:c.id,a:b.id},I.digTime);c.addWorker(b)},Oj=function(c){var b=x[c.u];c=x[c.a];var e=H[c.kingdom].values.food,d=c.x32,g=c.y32;b.lastUse=n.cycle;d=oe(c.kingdom,2,d,g);c.mv=!1;c.stock=[e,2,b.id,ed.url,Wl];qa(d,c,zc,c.url.food);da(c.id,1);if(0>d)return c.stay()},Lc=function(c,b){b.mv=!0;b.setupDir(c.x32-b.x32,c.y32-b.y32);na(b,b.url.milk1,1);b.stock=[0,2,c.id,Lc.url,Tl];b.setupINTV(Nh,{u:c.id,a:b.id},I.milkInterval);c.addWorker(b);c.d=(8-
b.d)%8;c.stay()},Nh=function(c){var b=x[c.u];c=x[c.a];b.milk-=3;var e=c.x32,d=c.y32;c.stock[0]+=3;da(c.id,1);if(0>=b.milk||b.death){if(c.stock[0]>I.milkMax&&(c.stock[0]=I.milkMax),c.mv=!1,b=oe(c.kingdom,2,e,d),qa(b,c,zc,c.url.milk),0>b)return c.stay()}else ec(c,I.milkInterval)},he=function(c,b){b.stay55()},Ad=function(c,b){Fd(c,b)},Fd=function(c,b){if(1!==c.death&&c!=b){if(c.dummy&&!H[b.kingdom].values.experience)return b.stay55();b.invisible&&Gd(b.id);if(!0!==b.build){b.mv=1;var e=c.x32-b.x32,d=
c.y32-b.y32;c.space&&(d=wh(c,b.x32,b.y32),e=d%A-b.x32,d=~~(d/A)-b.y32);b.setupDir(e,d,b.d2attack);b.url.attack&&na(b,b.url.attack,1)}b.setupINTV(Zf,{u:c.id,a:b.id},b.attackTime||Za(b.img),c);c.addWorker(b)}else b.stay55()};Fd.distance=-1;Ad.distance=-1;var Oh=function(c,b){var e=H[c.kingdom];if(e.values.experience&&(!b||0!=e.diplomacy[b.kingdom]||b.dummy)){if(0==c.level||null==c.level)c.level=0,c.levelProgress=0;c.levelProgress++;c.levelProgress>=~~(c.level/e.values.experience)&&c.level<e.values.maxLevel&&
(c.level++,c.health+=e.values.healthJump,c.maxHealth+=e.values.healthJump,c.levelProgress=0,c.attack+=c.level,c.defence+=c.level%2,da(c.id,1))}},Cj=function(c){var b=c.level;c.attack+=b;c.defence+=~~(.5*b)},Zf=function(c){var b=x[c.u];c=x[c.a];var e=c.attDist,d=b.x32-c.x32,g=b.y32-c.y32,h=b.x32,l=b.y32,p=!c.build;if(c.attackSound){var k=c.attackSound;Ea(k[~~(k.length*Math.random())],c.x32,c.y32)}p&&!b.build&&c.setupDir(d,g,c.d2attack);na(c,c.img,1);if(b.death||c.level&&c.level>=I.dummyLevelLimit&&
b.dummy||b.dummy&&c.level&&c.level>=H[c.kingdom].values.maxLevel)return c.stay();if(1<e&&!c.dragon){p=!0;var m=Z[c.attimg]}else p=!1;if(b.build||je(b.x32,b.y32,c.x32,c.y32,e)){b.onattack(c);e=c.attack*((zd[c.type][b.type]||0)+1);if(p){b.space&&(d=wh(b,c.x32,c.y32),h=d%A,l=~~(d/A),d=h-c.x32,g=l-c.y32);p=0;if(c.arrow||c.ball){k=Pj;var D=xh(-d,-g);var r=d;var q=g;var t=411/Math.sqrt(r*r+q*q);r*=t;q*=t;var w=Math.sqrt(1024*d*d+g*g*1024)/Math.sqrt(r*r+q*q);c.ball&&(m[1]=m[0]/w)}else{var v=2;k=$f;p=r=n.gravity;
D=Math.PI/180*60;t=Math.cos(D);D=c.attackDeg;D*=Math.PI/180;q=Math.sin(D);w=Math.cos(D);D=32*Math.sqrt(d*d+g*g);r=w*Math.sqrt(r*D/(q*w*2));w=D/r;q=-Math.sin(Math.atan2(-d,-g));D=xh(-d,-g);r*=q;p=Math.abs(p*t*q);q=(32*g-p*w*w*.5)/w}w=Math.round(1E3*w);t={x32:c.x32+.5,y32:c.y32+.5,img:m.url,mv:c.ball,d:0,rotation:-D+1.5,xf:h,yf:l,obj:b.id,attack:e,range:v};yb(t);Nc(t,r,q,p);hb({func:k,data:t},w,1)}t||b.damage(e,c);if(b.dummy){if(c.dummyDamage>=I.dummyIncreaseLevelValue||!c.dummyDamage)c.dummyDamage=
0;c.dummyDamage+=e;c.dummyDamage>=I.dummyIncreaseLevelValue&&Oh(c,b)}b.death?(c.action=null,b.build||c.build||Oh(c,b),qd(c)||c.stay()):ec(c,c.attackTime||Za(c.img))}else c.build&&(qd(c)||c.stay()),c.mv=!1,0!==c.state&&qa(b.id,c,Fd,c.url.move)},Yf=function(c,b){0<c.health?(b.dix=0,b.diy=0,b.mv=1,b.setupDirBuild(c),na(b,b.url.kirka,1),fe(b,"mine%20",3,b.img),b.setupINTV(Qj,{u:c.id,a:b.id},I.kirkaTime),c.addWorker(b)):b.stay()},Qj=function(c){var b=x[c.u];c=x[c.a];var e=b.res,d=H[c.kingdom].values[0==
e?"gold":"stone"],g=c.x32,h=c.y32;b.health-=d/H[c.kingdom].values.miningPerf;da(b.id);1>b.health&&(d=b.health+d,b.health=0,b.d=3,b.die());c.mv=!1;g=oe(c.kingdom,e,g,h);0==e?(c.stock=[d,e,b.id,Yf.url,Ul],qa(g,c,zc,c.url.gold)):(c.stock=[d,e,b.id,Yf.url,Vl],qa(g,c,zc,c.url.stone));da(c.id,1);if(0>g)return c.stay()},qa=function(c,b,e,d){b.cow&&b.workers.length||b.freezed||b.in||b.stoned||(b.action=e.url,b.distance=0,b.nodes=void 0,0<c?(b.xf=c,b.yf=!0):(c*=-1,b.xf=c%A,b.yf=~~(c/A)),b.func!=ie.url&&(d==
b.url.move?uh(b):b.mimg=d,b.dix=0,b.diy=0,b.mv=!0,b.setupINTV(ie,b.id,0)))},se=function(c,b){if(x[b[0]].boat&&(c=-c,c=-Vf(y[76],c%A,~~(c/A)),!c))return!1;ag(b,c,Rj)};se.allowPos=1;var Rj=function(c,b){O(c);Ed(b.id,b.inventory.slice(0));b.stay55()},wh=function(c,b,e){var d=c.space||Ol,g=d.length-1,h=d[g],l=c.x32;c=c.y32-1;for(var p=Infinity,k=0,m=0;m<g;m++){var n=m%h;n||c++;var r=(l+n-b)*(l+n-b)+(c-e)*(c-e);r<p&&d[m]&&(k=l+n+c*A,p=r)}return k},Vf=function(c,b,e){var d=A,g=c.radix,h=rb[c.zLevel];for(c=
2;60>=c;c+=2){b--;e--;for(var l=0;l<=c;){var p=b+l+d*e;if(h[p]===g)return p;p=b+l+d*(e+c);if(h[p]===g)return p;l++}for(l=0;l<c-1;){l++;p=b+d*(e+l);if(h[p]===g)return p;p=b+c+d*(e+l);if(h[p]===g)return p}}return!1},Kj=function(c,b){var e=A,d,g=Sa;for(d=2;60>=d;d+=2){c--;b--;for(var h=0;h<=d;){var l=c+h+e*b;if(0===g[l]&&0===K[l])return l;l=c+h+e*(b+d);if(0===g[l]&&0===K[l])return l;h++}for(h=0;h<d-1;){h++;l=c+e*(b+h);if(0===g[l]&&0===K[l])return l;l=c+d+e*(b+h);if(0===g[l]&&0===K[l])return l}}return!1},
Mc=function(c,b,e,d){var f=b.x32,h=b.y32,l=A,p=f+h*l,k=c.x32,m=c.y32,n=c.space;if(n){var r=n[n.length-1];n=(n.length-1)/r;c=c.free}else n=r=1,c=sj;b=b.rbase();for(var q,t=Infinity,w=-1,v=!1,x=0;x<e&&-1==w;){if(0==x&&c){for(var z=[],y=0,B=c.length;y<B;y+=2){var C=c[y]+k;q=c[y+1]+m;if(ma(C,q)&&(b[C+q*l]===d||C+q*l==p))a:{var H=z;C+=q*l;q=f;for(var F=h,G=A,L=Math.pow(C%G-q,2)+Math.pow(~~(C/G)-F,2),I=0,M=H.length;I<M;I++)if(Math.pow(H[I]%G-q,2)+Math.pow(~~(H[I]/G)-F,2)>L){H.splice(I,0,C);break a}H.put(C)}}z[0]&&
(w=z[0]);if(-1<w){v=!0;break}if(1==e)break}x++;--k;--m;z=r+2*x;H=n+2*x;y=0;for(B=z*H;y<B;y++)q=y%z,F=~~(y/z),q&&F&&q!=z-1&&F!=H-1||(q+=k,F+=m,C=q+F*l,b[C]==d&&ma(q,F)&&(q=(q-f)*(q-f)+(F-h)*(F-h),t>q&&(t=q,w=C)))}return-1<w?[w%l,~~(w/l),v]:!1},Dj=function(c,b,e,d,g){performance.now();var f=A,l=c.x32,p=c.y32,k=c.space,m=[],n=0;if(k){var r=k[k.length-1];k=(k.length-1)/r;var q=c.free}else k=r=1;c=-1==b?-Infinity:Infinity;for(var t=-1,w=0,v=0;0==m.length;){if(q&&0==v){for(var x=0,z=q.length;x<z;x+=2){var y=
q[x]+l,B=q[x+1]+p;ma(y,B)&&g[y+B*f]===d&&(m[n++]=y+B*f,w=(y-b)*(y-b)+(B-e)*(B-e),c>w&&(c=w,t=y+B*f))}if(m.length)break}v++;--l;--p;for(x=0;x<r+2*v;x++)g[l+p*f+x]==d&&ma(l+x,p)&&(m[n++]=l+x+p*f,w=(l+x-b)*(l+x-b)+(p-e)*(p-e),c>w&&(c=w,t=l+x+p*f)),g[l+(p+k+2*v-1)*f+x]==d&&ma(l+x,p+k+2*v-1)&&(m[n++]=l+(p+k+2*v-1)*f+x,w=(l+x-b)*(l+x-b)+(p+k+2*v-1-e)*(p+k+2*v-1-e),c>w&&(c=w,t=l+(p+k+2*v-1)*f+x));for(x=1;x<k+2*v-1;x++)g[l+(p+x)*f]==d&&ma(l,p+x)&&(m[n++]=l+(p+x)*f,w=(l-b)*(l-b)+(p+x-e)*(p+x-e),c>w&&(c=w,
t=l+(p+x)*f)),g[l+r+2*v-1+(p+x)*f]==d&&ma(l+r+2*v-1,p+x)&&(m[n++]=l+r+2*v-1+(p+x)*f,c>w&&(c=w,t=l+r+2*v-1+(p+x)*f))}return[t,m]},sj=[-1,0,-1,-1,0,-1,1,-1,1,0,1,1,0,1,-1,1],Rf=function(c,b,e){for(var d=Infinity,g=!1,h=0,l=c.length;h<l;h++){var p=c[h],k=x[c[h]];if(0!=k.built||k.death)h--,l--,c.quit(p);else{var m=k.x32;k=k.y32;k=(m-b)*(m-b)+(k-e)*(k-e);d>=k&&(d=k,g=p)}}return g},Ph=function(c,b){c=0;for(var e=b.length;c<e;c++){var d=x[b[c]];d.spd=d.__proto__.spd}},Hf=function(c,b){c=Infinity;for(var e=
0,d=b.length;e<d;e++){var g=x[b[e]];g.spd<c&&(c=g.spd)}bg(c,b)},Jj=function(c,b){for(var e=A,d,g=Infinity,h=0,l=0;121>l;l++){var p=l%11-5,k=~~(l/11)-5,m=p*p+k*k;p+=c;k+=b;m<g&&(d=Sa[p+e*k],0<d&&0==K[p+e*k]&&(d=x[d],d.contain&&(g=m,h=d.id)))}return h},cg=function(c,b){ag(b,c,zc)},zc=function(c,b){c=H[b.kingdom];var e=b.stock;c.resources[e[1]]+=e[0];c.stats.resources[e[1]]+=e[0];dg(b.kingdom);b.func=1;var d=mb[e[3]],g=x[e[2]];if(d==Lc){var h=A;for(var l,p=Infinity,k=!1,m=0;961>m;m++){var q=m%31-15,
r=~~(m/31)-15,t=q*q+r*r;q+=b.x32;r+=b.y32;t<p&&(l=Sa[q+h*r],0<l&&0===K[q+h*r]&&(l=x[l],l.contain&&"meat"==l.contain[2].url&&(p=t,k=l)))}if(h=k)d=pe,g=h}else"meat"==e[4].url&&!1===e[2]&&(h=Qh(b.x32,b.y32,!0))&&(d=Lc,g=h,e[2]=1);b.stock=void 0;if(!1===e[2])return b.stay();if(h=100<Math.pow(g.x32-b.x32,2)+Math.pow(g.y32-b.y32,2))a:{h=Kb[1];p=xa[b.kingdom];k=0;for(m=h.length;k<m;k++)if(t=h[k],1==y[t].storage&&p[t].length){h=!0;break a}h=!1}h&&void 0!==c.IAD&&1==e[1]?(n.blocked=!0,oj(b),n.blocked=!1):
(qa(g.id,b,d,b.url.move),da(b.id,1))};vc.cursor=6;xc.cursor=1;wc.cursor=9;Dd.cursor=5;qe.cursor=7;se.cursor=7;Xf.cursor=6;cg.cursor=6;var Mj=function(c){var b=A,e=c.kingdom,d=c.x32,g=c.y32;d-=16;g-=16;for(var h={},l=[],p=0,k=Nb[e],m=0;1024>m;m++){c=m%32+d;var n=~~(m/32)+g;ma(c,n)&&(c=k[c+n*b],void 0!==c&&(c=x[c],c.kingdom!=e||!1!==c.built||h[c.id]||(l[p++]=c.id,h[c.id]=1)))}return l};gd.available=function(c,b){var e=H[c.kingdom].values.wood;if(b.death||1>b.health-e&&b.workers.length)b=Ta(b.x32,b.y32),
c.xf=b,b=x[b];return Mc(b,c,1,c.radix)};ed.available=function(c,b){if(b.death)return"kill";c=b.x32+1;b=b.y32+1;return 0===K[c+b*A]?[c,b,1]:!1};fd.available=function(c,b){var e=c.x32,d=c.y32;if(!b.death&&b.health<b.maxHealth){var g=Mc(b,c,1,c.radix);if(g[2])return g}c.buildList?(g=c.buildList,g.quit(b.id)):(c.buildList=Mj(c),g=c.buildList);b=Rf(g,e,d);if(!b)return"kill";c.xf=b;b=x[b];return Mc(b,c,1,c.radix)};he.rev=function(c){return 0===c.distance%3&&(c=th(c.id,1))?[Ad.url,c]:!1};Ad.available=function(c,
b){if(0===c.distance%3){var e=th(c.id);e&&(c.xf=e,b=x[e])}return Mc(b,c,5,c.radix)};pe.available=function(c,b){if(b.death||b.in)if(b.contain)if(b=Jj(b.x32,b.y32))c.xf=b,b=x[b];else return(b=Qh(c.x32,c.y32,!0))?(c.stay(),qa(b.id,c,Lc,c.url.move),55):"kill";else return"kill";c=b.x32;b=b.y32;return 0===K[c+b*A]?[c,b,1]:!1};Lc.available=function(c,b){if(b.workers.length||10>b.milk||b.death){b=Qh(c.x32,c.y32);if(!b)return!1;c.xf=b.id}return b.xf?!1:Mc(b,c,5,c.radix)};Lh.available=function(c,b){if(b.death)return"kill";
var e=1;b.boat&&(e=2);return(c=Mc(b,c,e,c.radix))?(c[2]=1,c):!1};var Qh=function(c,b,e){for(var d=A,g,h=Infinity,l=!1,p=0;441>p;p++){g=p%21-10;var k=~~(p/21)-10,m=g*g+k*k;g+=c;k+=b;m<h&&(g=K[g+d*k],0<g&&(g=x[g],g.cow&&(!g.workers.length&&g.milk>=I.milkMax/1.5||e)&&(h=m,l=g)))}return l},ag=function(c,b,e){for(var d=0,g=c.length;d<g;d++){var h=x[c[d]];qa(b,h,e,h.url.move)}},te=function(c,b){Ja(b,c,eg)};te.noObj=1;var eg=function(c,b){ue(b,-c,77,eg)},ve=function(c,b){Ja(b,c,fg)};ve.noObj=1;var fg=function(c,
b){ue(b,-c,130,fg)},we=function(c,b){Ja(b,c,gg)};we.noObj=1;var gg=function(c,b){ue(b,-c,78,gg)},xe=function(c,b){Ja(b,c,hg)};xe.noObj=1;xe.cursor=10;var hg=function(c,b){ue(b,-c,132,hg)},ye=function(c,b){Ja(b,c,ig)};ye.cursor=10;ye.noObj=1;var ig=function(c,b){ue(b,-c,131,ig)},ue=function(c,b,e,d){var f=A,h=H[c.kingdom],l=y[e],p=y[e].cost,k=c.mana>c.manaMax;if(vb(c)||c.checkMana(p[4],b,d,p)){k||h.paypal(p);d=e;b*=-1;k=b%f;var m=~~(b/f),n=k,r=m,q=rb[l.zLevel],t=~~(c.mana/p[4])+1;1<t&&(h.resources[0]-=
p[0]*(t-1),c.mana-=p[4]*(t-1));for(h=0;h<t;h++)0!==q[b]&&(e=Vf(l,k,m),n=e%f,r=~~(e/f)),Ea("summon"+~~(10*Math.random()+1),n,r),e=new dd(d,c.kingdom,n,r,0),e.setupChild(pb.spawn);c.setupDir(-c.x32+e.x32,-c.y32+e.y32);c.setupSpellIMG()}else h.paypal(p);da(c.id)},je=function(c,b,e,d,g){return~~Math.sqrt((c-e)*(c-e)+(b-d)*(b-d))<=g},kg=function(c,b){Ja(b,c,jg)};kg.cursor=0;var jg=function(c,b){c.build||c.terrain||c.nofreeze||!vb(b)&&!b.checkMana(I.turnToStoneMana,c.id,jg)||(c.freezed=1,c.stoned=1,nb(c,
32*c.y32),c.stay(),na(c,c.img,0),c.setupChild(pb.turnStone),Hd(c,xj),re(c.id),b.setupDir(-b.x32+c.x32,-b.y32+c.y32),b.setupSpellIMG(),Ea("turn%20to%20stone",b.x32,b.y32),hb({func:Sj,data:c.id},I.turnToStoneTime,1))},Sj=function(c){c=x[c];c.freezed=0;Ac(c);c.stoned=0},lg=function(c,b){Ja(b,c,ze)},ze=function(c,b){c.health<c.maxHealth&&!c.build?(b.setupDir(c.x32-b.x32,c.y32-b.y32),O("heal",Za(b.img)),b.setupSpellIMG(!0),b.setupINTV(Tj,{u:c.id,a:b.id},0),c.addWorker(b)):b.stay()},Rh=function(){Ja(list,
obj,Uj)},Uj=function(){},Tj=function(c){var b=x[c.a];c=x[c.u];var e=H[b.kingdom].values.healingRange;Ea("heal",b.x32,b.y32);if(!je(c.x32,c.y32,b.x32,b.y32,e))return qa(c.id,b,ze,b.url.move);if(vb(b)||b.checkMana(I.healingMana,c.id,ze)){b.setupDir(c.x32-b.x32,c.y32-b.y32);c.health+=I.healVol;c.setupChild(pb.heal);if(c.health>=c.maxHealth)return c.health=c.maxHealth,da(c.id,1),da(b.id,1),b.stay();da(c.id,1);da(b.id,1);ec(b,Za(b.url.spell))}},Ae=function(c,b){Ja(b,c,mg)};Ae.cursor=10;var Sh=function(c,
b){c=x[c];b=x[b];if(c.inventory.quit(b.id)){b=d[b.spell];c.icons==c.__proto__.icons&&(c.icons=c.icons.slice(0));c.icons.put(b);var e=c.icons;e.olegal||(e.olegal={});e.olegal[b.id]=1;da(c.id)}},Id=function(c,b){var e=b[1];b=x[b[0]];x[c].nopotion||x[c].build||(qa(c,b,Vj,b.url.move),b.actionItem=e)};Id.item=1;var Vj=function(c,b){var e=x[b.actionItem];b.actionItem=void 0;e.attack&&(c.attack+=e.attack);e.defence&&(c.defence+=e.defence);e.mana&&(c.mana||(c.mana=0,c.manaMax=0,c.update?c.update.push("mana",
"manaSpeed",I.manaRechargeTime):c.update=["mana","manaSpeed",I.manaRechargeTime],hb({func:Jf,data:[c.id,"mana","manaSpeed",I.manaRechargeTime]},I.manaRechargeTime,1)),c.manaMax+=e.mana,c.mana+=e.mana);e.level&&(c.level||(c.level=0),c.level+=e.level,c.attack+=e.level,c.defence+=~~e.level);Ea("bless",c.x32,c.y32);b.inventory.quit(e.id);b.stay55();da(b.id)};Id.cursor=10;lg.cursor=10;te.cursor=10;ve.cursor=10;we.cursor=10;var ng=function(c,b){Ja(b,c,Th)};ng.cursor=1;var Th=function(c,b){if(c.isSpy&&c==
b)b.stay55();else if(vb(b)||b.checkMana(I.impersonateMana,c.id,Th))b.setupDir(-b.x32+c.x32,-b.y32+c.y32),na(b,b.url.attack,1),hb({func:Wj,data:[c,b]},Za(b.img)-25,1)},Wj=function(c){var b=c[1];c=c[0];c.die(1);var e=c.getRadix();e[b.x32+b.y32*A]=b.radix;b.x32=c.x32;b.y32=c.y32;b.d=c.d;b.name=b.name;b.attack=c.attack;b.defence=c.defence;b.update=b.update;b.mana=0;b.manaMax=b.manaMax;e[b.x32+b.y32*A]=b.id;nb(b,32*b.y32);b.__proto__=c.__proto__;na(b,b.url.idle);e=c.icons.slice(0);e.quit(d.menuBuilds);
e.quit(d.menuBuilds1);e.quit(d.menuBuilds2);e.put(d.impersonate);e.put(d.revealSelf);b.icons=e;b.spy||(b.spy=b.kingdom);b.kingdom!==c.kingdom&&b.changeKingdom(c.kingdom);b.setupChild(pb.impersonate);da(b.id)},Uh=function(c){c=x[c];if(c.spy){var b=y[2];c.attack=b.attack;c.defence=b.defence;c.__proto__=b;c.icons=b.icons;c.kingdom!==c.spy?c.changeKingdom(c.spy):c.stay();na(c,c.url.idle);da(c.id);c.spy=void 0}};Ae.allowPos=1;var mg=function(c,b){if(c.id){var e=c.id,d=c.x32;c=c.y32}else e=-c,d=c%A,c=~~(c/
A);if(vb(b)||b.checkMana(I.blessMana,e,mg)){b.setupDir(-b.x32+d,-b.y32+c);b.setupSpellIMG();e=I.blessRange;d-=.5*e;c-=.5*e;var g=[];e+=1;var h=e*e;Ea("bless",b.x32,b.y32);for(b=0;b<h;b++)for(var l=1;3>l;l++){var p=x[rb[l][b%e+d+(~~(b/e)+c)*A]];p.build||p.terrain||(p.setupChild(pb.bless),p.blessed||(p.blessed=1,p.attack+=I.blessIncrease,da(p.id,1),g.put(p)))}hb({func:Xj,data:g},3E4,1)}},Ja=function(c,b,e){if(c[1]&&x[c[1]].item){var d=c[1];c.length--;ag(c,b,e);x[c[0]].actionItem=d}else ag(c,b,e)},vb=
function(c){var b=c.actionItem;if(!b)return!1;b=x[b];b.attack&&(b.attack--,0===b.attack&&(c.inventory.quit(b.id),da(c.id)));return!0},Xj=function(c){for(var b=0,e=c.length;b<e;b++){var d=c[b];d.blessed=void 0;d.attack-=I.blessIncrease;da(d.id,1)}},Be=function(c,b){Ja(b,c,og)};Be.cursor=10;var og=function(c,b){c.freezed||!vb(b)&&!b.checkMana(I.invisibilityMana,c.id,og)?b.stay55():(b.setupDir(-b.x32+c.x32,-b.y32+c.y32),c!==b&&b.setupSpellIMG(),Ea("invisible",c.x32,c.y32),c.invisible||(Hd(c,Bh),c.invisible=
1,c.stay()),da(c.id),hb({func:Gd,data:c.id},5E4,1))},Gd=function(c){c=x[c];c.death||(c.invisible=void 0,Ac(c),sh(c))},qg=function(c,b){Ja(b,c,pg)};qg.cursor=0;var pg=function(c,b){if(vb(b)||b.checkMana(I.lightningMana,c.id,pg))b.setupDir(-b.x32+c.x32,-b.y32+c.y32),b.setupSpellIMG(),Ea("lightning",b.x32,b.y32),c.damage(I.lightningMana,b)},Ce=function(c,b){Ja(b,c,rg)};Ce.cursor=0;Ce.noObj=1;var rg=function(c,b){var e=A;if(c.id){var d=c.id,g=c.x32;c=c.y32}else d=-c,g=c%e,c=~~(c/e);if(vb(b)||b.checkMana(I.flameBoltMana,
d,rg)){b.setupDir(-b.x32+g,-b.y32+c);b.setupSpellIMG();Ea("flame%20ball",g,c);d=g-b.x32;g=c-b.y32;c=Math.sqrt(d*d+g*g);d/=c;g/=c;for(var h=b.x32+.5,l=b.y32+.5,p=[],k=[],m=0,n,r,q=0;q<c;q++)n=h+d*q,r=l+g*q,k.put(n),k.put(r),n=~~n,r=~~r,p[m++]=n+r*e,p[m++]=~~(n+g)+~~(r+d)*e,p[m++]=~~(n-g)+~~(r-d)*e;for(q=0;q<0*p.length;q++)Bd(p[q]%e,~~(p[q]/e),"food");hb({func:Vh,data:{list:p,anim:k,i:2,a:b}},1E3,1)}},sg=function(c,b){Ja(b,c,De)};sg.cursor=10;var De=function(c,b){b.setupDir(-b.x32+c.x32,-b.y32+c.y32);
b.setupSpellIMG(!0);b.setupINTV(Zl,{u:c.id,a:b.id},0);c.addWorker(b)},Zl=function(c){var b=x[c.a];c=x[c.u];if(!je(c.x32,c.y32,b.x32,b.y32,H[b.kingdom].values.teachDistance))return qa(c.id,b,De,b.url.move);if(c.level>=b.level)return b.stay();if(vb(b)||b.checkMana(I.teachMana,c.id,De))Ea("teach",b.x32,b.y32),b.setupDir(c.x32-b.x32,c.y32-b.y32),c.setupChild(pb.curse,!1,Ql),Oh(c,!1),da(c.id,1),da(b.id,1),ec(b,Za(b.url.spell))},Ee=function(c,b){Ja(b,c,tg)};Ee.cursor=0;Ee.noObj=1;var tg=function(c,b){var e=
A;if(c.id){var d=c.id,g=c.x32;c=c.y32}else d=-c,g=c%e,c=~~(c/e);if(vb(b)||b.checkMana(I.raiseDeadMana,d,tg)){b.setupDir(-b.x32+g,-b.y32+c);b.setupSpellIMG();var h=I.necromancyRadius;d=2*h;var l=h*h,p=g,k=c;g-=h;c-=h;h=0;for(var m=d*d;h<m;h++){var n=g+h%d,r=~~(h/d)+c,q=n+r*e;ma(n,r)&&Math.pow(n-p,2)+Math.pow(r-k,2)<=l&&ug[q]&&0===K[q]&&(O(n,r),new dd(60,b.kingdom,n,r,0))}}},Vh=function(c){var b=c.list,e=c.anim,d=c.i,g=c.a,h={x32:e[2*d],y32:e[2*d+1],d:0,img:m.flame_trail,mv:1,z32:2,alpha:!0};yb(h);
Lb.new(h,Za(h.img));for(h=0;3>h;h++){var l=x[K[b[h+3*d]]];l.health&&l.damage(96,g)}c.i++;c.i<.5*e.length&&hb({func:Vh,data:c},50,1)},Fe=function(c,b){Ja(b,c,vg)};Fe.cursor=0;Fe.noObj=1;var vg=function(c,b){if(c.id){var e=c.id,d=c.x32;c=c.y32}else e=-c,d=c%A,c=~~(c/A);if(vb(b)||b.checkMana(I.freezeMana,e,vg))b.setupDir(-b.x32+d,-b.y32+c),b.setupSpellIMG(),Ea("freeze",d,c),hb({func:Yj,data:[d,c]},1E3,1)},Ge=function(c,b){Ja(b,c,wg)};Ge.cursor=0;Ge.noObj=1;var wg=function(c,b){if(c.id){var e=c.id,d=
c.x32;c=c.y32}else e=-c,d=c%A,c=~~(c/A);if(vb(b)||b.checkMana(I.confusionMana,e,wg)){b.setupDir(-b.x32+d,-b.y32+c);b.setupSpellIMG();Ea("confusion",d,c);b=I.confusionRange;d-=.5*b;c-=.5*b;e=A;var g=[];b+=1;for(var h=b*b,l=0;l<h;l++)for(var p=1;3>p;p++){var k=x[rb[p][l%b+d+(~~(l/b)+c)*e]];k.build||k.terrain||k.stoned||(k.confused=1,k.invisible&&Gd(k),Hd(k,yj),k.stay(),g.put(k),re(k.id))}h&&1===G.length&&da(G[0]);g.length&&hb({func:Zj,data:g},I.confusionTime,1)}},Zj=function(c){for(var b=0,e=c.length;b<
e;b++){var d=c[b];d.confused=void 0;d.death||(na(d,d.img,1),Ac(d),d.stay(),Cb==d&&(Cb=void 0,G[0]=d.id,da(d.id)))}},Yj=function(c){var b=I.freezeRange,e=c[0]-.5*b,d=c[1]-.5*b,g=A,h=[];b+=1;var l=b*b;c={img:m.freeze_expl,d:0,mv:1,x32:c[0],y32:c[1]};yb(c);Lb.new(c,Za(c.img));for(var p=0;p<l;p++)for(var k=1;3>k;k++)c=x[rb[k][p%b+e+(~~(p/b)+d)*g]],c.build||c.terrain||c.nofreeze||c.stoned||(c.freezed=1,nb(c,32*c.y32),c.stay(),na(c,c.img,0),c.invisible&&Gd(c),Hd(c,wj),c.health-=I.freezeDamage,1>c.health&&
(c.health=1),h.put(c),re(c.id));l&&1===G.length&&da(G[0]);hb({func:ak,data:h},2E4,1)},ak=function(c){for(var b=0,e=c.length;b<e;b++){var d=c[b];d.freezed=void 0;d.death||(na(d,d.img,1),Ac(d),Cb==d&&(Cb=void 0,G[0]=d.id,da(d.id)))}},He=function(c,b){O(b);Ja(b,c,xg)};He.cursor=0;He.noObj=1;var xg=function(c,b){O(c,b);if(c.id){var e=c.id,d=c.x32;c=c.y32}else e=-c,d=c%A,c=~~(c/A);if(vb(b)||b.checkMana(I.fireRainMana,e,xg))b.setupDir(-b.x32+d,-b.y32+c),b.setupSpellIMG(),Wh(d,c,3,20,4500,b.id)},Wh=function(c,
b,e,d,g,h){for(var f=m.fire_rain,p=n.gravity,k=Date.now(),q=Wh.rnd,D=Math.PI,r=performance.now(),t=0;t<d;t++){var w=2*q()*D,x=e*q(),v=c+x*Math.cos(w);w=b+x*Math.sin(w);x=~~(t/d*g);ma(v,w)&&hb({func:bk,data:{x32:v,y32:w-6,dix:0,diy:140,img:f,mv:1,d:0,timestamp:k,finnish:Infinity,aceleration:p,attack:40,xf:v,yf:w,range:2,kingdom:0,obj:h,crashTime:(Math.sqrt(19600+384*p)-140)/p*1E3}},x,1)}O(performance.now()-r)},bk=function(c){hb({func:$f,data:c},c.crashTime,1);yb(c,0,c.diy,n.gravity)};Wh.rnd=function(){var c=
4096,b=2048;return function(){b=36969*(b&65535)+(b>>16)&4294967295;c=18E3*(c&65535)+(c>>16)&4294967295;return((b<<16)+c&4294967295)/4294967296+.5}}();var Pj=function(c){x[c.obj].damage(c.attack,x[c.obj]);Db(c);jc.put(c.bufferID)},ck=function(c){c=x[c];c.bufferID&&(Db(c),jc.put(c.bufferID));ug[c.x32+c.y32*A]=void 0},$f=function(c){var b=A,e=c.xf,d=c.yf,g=c.attack;c.mv=1;c.func=void 0;c.x32=e;c.y32=d;Nc(c,0,0,0);nb(c,2);e=~~e;d=~~d;var h=e+d*b,l=K[h];Ub[h]?(c.img=m.expl_small_water,Ea("water%blop",
c.x32,c.y32)):(c.img=m.expl_small_hole,Ea("small%20explosion",c.x32,c.y32));na(c,c.img,1);Lb.new(c,dk(Z[c.img]));if(Ub[h]){if(l=Sa[h],2<l){var p=x[l];p.damage(g,x[c.obj])}}else{2<l&&(p=x[l],p.damage(g,x[c.obj]));h=c.range;l=2*h+1;for(var k=0,n=l*l;k<n;k++){p=k%l-h;var q=~~(k/l)-h,r=~~Math.sqrt(p*p+q*q);r<h&&(p+=e,q+=d,p=K[p+q*b],2<p&&(p=x[p],p.damage(g*(1-r/h),x[c.obj])))}}},$l=function(c){if(0<G.length){var b=x[G[0]],e=0,d=0,g=0,h=0;void 0!==b.dix&&(c=.001*(c-b.timestamp),h=b.dix,g=b.diy,e=h*c,d=
g*c);if(b.space){var l=b.space;c=l[l.length-1];l=(l.length-1)/c}else l=c=1;e+=32*(b.x32+.5*c-Math.sign(h))+.5*-tzar.width+.5;d+=32*(b.y32+.5*l-Math.sign(g))+.5*-tzar.height+.5;Eb=~~-e;db=~~-d;wd(-Eb,-db)}},ek=function(){};ze.distance="healingRange";eg.distance="createGolemRange";mg.distance="blessDistance";vg.distance="freezeDistance";wg.distance="confusionDistance";og.distance="invisibilityDistance";pg.distance="lightningDistance";gg.distance="createBatDistance";fg.distance="createDragonDistance";
ig.distance="createCarpetDistance";hg.distance="createJinnDistance";jg.distance="turnToStoneDistance";rg.distance="flameBoltDistance";xg.distance="fireRainDistance";tg.distance="freezeDistance";De.distance="teachDistance";var H=[];var Tb=function(c,b,e,d,g,h,l){this.name=c;this.k=H.length;this.color=b;this.status="";this.stats={dmgInflicted:0,dmgTaken:0,resources:[0,0,0,0],score:0,unitsKilled:0,unitsLosed:0,buildsLosed:0,buildsDestroyed:0,unitCount:new Uint32Array(y.length),unitCountMax:new Uint32Array(y.length),
unitCountDeath:new Uint32Array(y.length),goldTraded:0,goldConverted:0,stoneTraded:0};this.team=l;this.resources=h||[5E4,5E4,5E4,5E4];this.values={gold:10,wood:10,food:10,stone:10,buildSpeed:1,experience:0,healthJump:0,maxLevel:4,pop:0,popMax:n.freePop||1,popLimit:200,healingRange:1,blessDistance:9,createGolemRange:5,freezeDistance:13,invisibilityDistance:9,createBatDistance:16,lightningDistance:12,createDragonDistance:4,turnToStoneDistance:21,flameBoltDistance:19,fameTech:0,confusionDistance:13,manaSpeed:2,
milkSpeed:2,cowSpeed:2,stealCow:0,miningPerf:1,fireRainDistance:15,createCarpetDistance:3,createJinnDistance:3,teachDistance:2};this.race=d;this.racestr=yg[d];this.IA=g||0;this.building=[];this.diplomacy=e;this.control={};this.control[this.k]=1;this.onFreePop=[];c=[];c.length0function=am;this.unitLoading=0;this.target=[0,0,0,0];this.crusade={number:0,list:c};this.technology={hidden:{},disabled:{},actived:{},investigated:{}};this.mod=b=[];fk[this.racestr]++;c=0;for(e=y.length;c<e;b[c++]={});H[H.length]=
this;c=this.k;b=[];Nb[c]={};xa[c]=b;for(e=0;e<y.length;e++)b[e]=[];b=this.color;Na[3*c]=b[0]/255;Na[3*c+1]=b[1]/255;Na[3*c+2]=b[2]/255};Tb.prototype.setupResources=function(c,b){var e=this.resources;b||(b=1);e[0]-=c[0]*b;e[1]-=c[1]*b;e[2]-=c[2]*b;e[3]-=c[3]*b;dg(this.k)};var xa=[];var Nb=[];var Na=[];Tb.prototype.check=function(){if(this.values.pop)return!0;for(var c=bm,b=xa[this.k],e=0,d=y.length;e<d;e++)if(!c[e]&&0<b[e].length)return!0;this.die()};Tb.prototype.checkPopArray=function(){if(this.onFreePop.length)for(;!le(this.onFreePop.shift())&&
this.onFreePop.length;);};Tb.prototype.die=function(){this.death||(this.death=1,this.status="defeated",Xh(),Oc(Yh(q.playerDefeated,this.name),0,5))};Tb.prototype.paypal=function(c){var b=this.resources,e=!1,d=this.k;b[0]<c[0]&&(zg(d,q.gold),e=!0);b[1]<c[1]&&(zg(d,q.wood),e=!0);b[2]<c[2]&&(zg(d,q.food),e=!0);b[3]<c[3]&&(zg(d,q.stone),e=!0);if(e)return e;b[0]-=c[0];b[1]-=c[1];b[2]-=c[2];b[3]-=c[3];dg(this.k)};Tb.prototype.paypalTest=function(c){var b=this.resources;return c[0]>b[0]||c[1]>b[1]||c[2]>
b[2]||c[3]>b[3]?!1:!0};var zg=function(c,b){c==v.kingdom&&Oc(Yh(q.notEnough,b),0,5)},dg=function(c){if(c==v.kingdom){var b=H[c].resources;c=b[0];var e=b[1],d=b[2];b=b[3];Infinity==c&&(c="***");Infinity==e&&(e="***");Infinity==d&&(d="***");Infinity==b&&(b="***");cm.innerHTML=c;dm.innerHTML=e;em.innerHTML=d;fm.innerHTML=b}},bm={13:1,20:1,21:1,22:1,27:1,32:1,35:1,36:1,43:1,44:1,55:1,56:1,57:1},tb;var gk=[];(function(){var c="",b=new Image;b.src="data:image/gif;base64,R0lGODlhIQB2AfcAAAAAABAIAAgAABEhACE6ABkbChAQAAgIABAQCO/vlN7epf/6hZSQUv76n721a//rY/XmhnNjECklEP7oecW1Y+7ZeP/rhvvrljEpCCgiB+/Wa97OjP/WSu3YhyEZAIhzLf/WWOnHWv7baL2lVt3Db/vsvUo3BGtSCGhVIdq1SnhjKdy4V62USuvIaPzad/felO/XlzopAGtaMe3Kd/zbiOjMhv/9+JxzGWNKECEZCP/JSuu5Sc6lSMynV4tzPdSyaK2UWjEhADopCNacKWNKGVdCGf/IVuu4VruUSPzJZ7qYU0IqABkQAGdFB2tKEFI6D5tzKMqVN9unSNyrVlRDI/nLd7JwACkZAOaUEDEhCMSMMZRrKYlkJ/u3SJt0M8yYRquDQO66Zu3MlrWcc5haAItSAf+lGUIqCGNCEJdjGXpTGJxrIfisOGtKGcSNOtacQruHOfu6VsiYVOm6dPvLh/rZqTohAHdHB3NKEFo6D0kxEJRjIc6MMalzKYRaIZxrKXlTIuCcP6x5M+umR1I6GX5aKdacSuqqVdedUollNK2HVUopAFQxBXtKEGtCEMmBJ7h2J3NKGdeNNMOCMWNBGZRjKf2rR86MOtaUQpdpMt6cSrqFQkk0GnVWL9OjZolVGeeQLJ5jIKdqJ4xaIeCTObd6NembRt6UQsWEPGlHIf+tUsuMQ9aUSppyRzEZAGU1BkopCHNCEDohCFIxECkZCPeXM3tKGdKDMIRSIZxjKlo6Gc6EOoxaKahwNt6USjUkE/zLmUIgACEQAIZLEtZ2H5ZUF2Y6ELlpIN9/KGtBGUUpEHVKIRkQCNaMRntCEHNCGZdZI86MUjoZAFQoBs5qIF0xECUZEE8hAHQ0CIQ9C5RHD65TFb5cGXY6EDEZCHtCGYRKIVIxGSkQAEohCEIfCVIpEKJEEUUpGWgnBzoZCEIzKzEQABkIAHMpCIw0CyEQCFsZAlEZBikQCDQZECEHAD4PATEQCGshEDEIAPNGKRkAABAAABkICBAICAgICP///yH5BAEAAP8ALAAAAAAhAHYBAAj/AP8JHEiwIEEBBhMqXPiP3QGEAwVAZKgQYoBwLAIMpIUCwESKE5lI/CeA0woU+wTSIvHk40IBD/9x+vHrnYB9+358EbdPwDsavfi5NMiEChcA/5i0QIKrzTsANeQoC+DzAhJvKYcK3AeoAheqAlbo0XNGlpIKR5axEyChwwo/U7UK+EWiAxRdgH5RGnWpD6ArwpCUWlaES40WX0pRompQwIcXLbR8ObKi1BdUcXatMsZuFCUuUtxKidLr11ABT5Ag+tIHjK5MYb5UilPqlK0rVwKkmiJFyyVBpgsyCRCAEpIvyubJC4CkCq9Rh3JhqiRSAJQvcPgIUgaTIIofMvL8/5hCKwfEHmEiDcq0CtosdklHjeoDaSpSgQKoWGjRowMYWh4JlEgYm4wyhR+buaKLAEwoQ4gfs9CikUBM/OBWCytEAuBESIThhyZbVGILOU+QJEAOhFBCyy/44QDDDFKsgJwwqRA0oBejiBJJMmecYSIAOSxjjzf4jeLCFNi9ocxugAyk3hSVhIILGmd4U6KJ77yTAzu/cMIOZXBQ4gcsRXyRhB4CPXEJHT2U4kUyeggzS0QCABAAHD0koUIP/HkjzwH/+ODCFz7qUQoNM3zBVB5X+GjQLGBQtkIHSTxDXAB5wGFBGEUUcUsVF8SWSzJZyJLQTZUc0cIMK7ghhAAZ/P9DySAWuBCHKYdcMMMUgkQSZxGnyiPFF27wIAUX9hgQQBu4DOKCrVLQUMURboySBxNonurFCmn4UYoWfsiT0l6TDBLHIWGEgeQfaAQhREXhrADHLLrgIsgswgiURySiuCEFK4dg4oYoz5yhlUDiRCEFJfZk0UYeNgkkizGfiCJKKajAkYstswTQpEKzVsIOO+Rk4Y1IAglzRh7OQFOKIKF8wmgWClHVhyRFBOARLbRMxI4wsDgSSh99jJKMLKfNxY4abgiii851fiQAO64Yc4woebiCckE5qFCFEnB8IcUWv2zdmDDDSCMRg40RIkgILVAmxRPvTJjQPuwA4FG+pzL/w8UkYGCXzC8BJkSVnSBloYssnMxSsgEHU2RQFjoH4I0wkUuuEAB4Z655RZ8rVAIgzIQeehx0RMKE6Z9XkcQspbNOESZ0xAG77BQFAoztseOukO6WlNO77waZUocls+RAvEKHHJ/88gk1X4sxtEBvUBh1sGGM8tYTNIgNtXzC/T9kVA99IOA/f0cJtYxPPB82gHLHP03QYAU93fOBzDE5bGLKK90byB1I4Q3zdS8PjGhCCaxgQOjdwQZWMAMtzIAFmlmPBmzIAiX+8YohlKEM81teGXg2kDLYgAZkCOBAmlCLWtxHhf/4IAxnSMMa2vCGOMyhDnfIwx768B82QEMN/2dgg3fN0BNhsAERZtgKRMDABsaYISvCAIMSPINIAczEEeRQhxK8woLWe8UOLrGCElzAFukIIB+O8IgpXGAOr0hHH6yXiyQkRgwwSMIdvGGx5anBCFNYhSjmMIcj3MAbgIDE8jQRBkQIYg3j2YEUZBELLRAPCUk4hBy4kAs5wEFh8nDEG6KAuyZkcgpwaEQvFCGIK3jjDIx4xA5wd4QjBPITjviDMITBjiysCAMvDF0f4iCFUkBDDx6QhTVmIY/CyY4eSZACKi5BjgA0QgtbkEUDZReFHexAHOKoRAPC0IZXLm8ZIBCHzvTgiVKlwhrLO4cx9oEUAGSAFnKYAhf6of9CABxAEDtIhCxMAMMA7OEMPSiGGmDIiDF0AAnQgOEBQFEDRgSzeyYoBqZ+yNGOevSjIA2pSAVygic0gXVLkFwT3BGPeIQOHYx4wkUL0gRzcCMe2KiH5tCBDnfo7R/kUIg79hcPdLhUcuiwqUvrwQiDtJQatQiEOdxBAKQO9RgR6GlCpsENZOgAGdxoRzAo8tSoTpUA7RhIPYo6VB3ooAuSaCpFuOpVsLZDrsFohzt4So0u6MAIICjGWBligra+Na7uYEQw3OGOf5iAG2z46wOksA10UAQdff1rYBlbD3MU4x/40EYtACuCB1SWIo+NrBEmy9MMcIMa7sAHPh6hAxD/GIEDoOAGNggrWtKaFh3C2AYoGCvbY7CBDaAgRjF2S9ha1Pa2oMgGPhhRC9hqY6/aSC4xZMHchZgAG9g4bnKLEQ/hgsIc1KCGOeqhjW6wFJwUwYY7skuM7b5iG1A9BlSJgQ5yoMMY2CiA5kyAjm24Nx5LcAc12BAIZBx3G8HARgbEEVTJYWMc4/gvNmiBDmKAQge1YEMXkGEOciDucxgex4QZUY/6dsEIx60FMnA3DmwwIwCMYIQ5zEGMOOiADSGuMOsC8F1s5HjHo+1CLUABCuIFYLc7tikpunAL4Q4Deozdhja2wQ1zwOMRw7gy8eABj20Uoxxchgc5lKGM5cGj/7NnCEA3wgqAJaQUeu2gypPRUY9pbMN6AchCBhAQjAybo3tkzkA83lEAIXcvB9gQRwGkMdJKW/rSBlHGDFhHAxZRJAdV2PTnfhCGbSbkHZqgQRg0hwgXaMLTDBEGL1ywK4qsIgxJyISpDSKMZEBCD0VIxEIooQxvbCMZuy6IN6YSgGQPJAuY24ezB+IndsDCCFFUSB6mAIt3sAOLmnsGJXRBhSIAQhB9EIUXEkGIZETI0Zr7hS5IMYELXKABF6hAC5JwhC+0wZes08UXBpEEC1igAQ2oVRICAYdKKAPeklvGwI0wgYM3YAJJiMMb4MALPUw7Ictwg7lEgHFTTCEJYf9wQy9SUZOA/yEQcQDBD/KRD3f4AA598MMTaPEO1inDW4OwRCvu4Y56qAMQe2iDMnIgD9Z5IxJ9MIUlOsGJeajj6J/QxS+Y8XGD0IISezhFF7rwB3VQAQqTiESEEADuz3ljFkDvgghEYIRBKGbpzADj52ThsJfL3QVGOAIXnpAFZuRddjl4Ai5IYQkjiICYfvA4M3ouO1n8IhKCGIQRkmCJLwBi6c32nTcI0Qdz1V0QRaBc1xkiC13AwQinJwQz2o67TCjDGKUwRR+MUQ0JWO8Qn3+HhNjxiVNA7xBfqIaQx5EHTKyCeGCYAiXSSJB08IIUgsBdKwyBC9oLRBm5sLv/7MCQiDYrJBWtyASm189+9tvBDq4QBwyfMApW9CEZ7EhJ98Cwik3EYRKrYFHdkwhV8AW4kASiYAqRMDLWIwc0gAu2cAi4oAm84DmjVgV5IIHNMApnMFOy4zWbAAiH8AyowAj0MCfQowRzEAmHUAi84AhXQFCycyUCUgWZgAu5gAbGcAWuIDtEcAjAIhDJcAg/wAuVoAbV4ArsIIOh8wRy4AJBIBBnsAoX8AOb4AXGEAz7YCqs4wMQgAhX8A9nUAoXQANToARqwAhUIzsmsAoJEAZjsQs00AAFWAnGsEu4kwdxkAATcASkEAYNoGqCEAvBIADZYjqUoAaHAAEYlyuq/2aAsCAAjsI6eTAKbnAIKFcFVRAGhvAHeSAMYYg7JuAIorAKU4AIYcAKXyAKO+iBnyMOjKAGfyAKvVAKm5ALjhAMAPAxuLMP0jANxjAMgiAI0OAIsPAzy+MRrjANwwAN0MB74uCKoaM3+jANxVAMdrAW0mg6nPMK9KA3zgQ9HgGOdmM94LiN7ZeO6riO7HhpvdALgJAKNdI9QFAKq7AKqggGhQBrvvMDM2AKvsAK94gKm5AJ50A8PwADdBAGAMkKqECQmyAInOA7JFACM3AIhzAIlXBurLAJBTmRsvMDJVADh7ADEPACiZAKuXePnYA7P2ADdRAGgzAHNqAA35AKnP+QCJ1ABbjDRSUQBhipATZwBLkAADc2ALgDBh1AA3FzBKkQAhuwCalQjrKDCPl2BILgD9TQC60QDa0gYL6TCj/QAodwDgDACZsADK3ADAiwPKmQCVQQO5nQCe/Qb9XglsFEBb9QBz8gCLYAQ79ABXy5ChukQr/QCTDgCaUQDoBJBWLgCZkAkgH0C4nwmJnAmIbZCmIgB51AldDzC62gCOqQAZ65PL/wCwdAHDN0Ke3Ymq75mrAZm7ApmbhDmwSRCqdQmOFgfp9DCKigC5kGCKUADsogAnCFmQwRB3GgBxeDC6aWBctwBtzwAA1gCZFAEV0wAQ1wDNWQDJRnEAeQBZD/YAkuUJ28aRCWUHGWgAzCoHeZJgi7kJ4NcAsKUQsNIAKmIAmiAJwMkQOUwC+3cAQQkAwGkQsL0AWQMArQoCGSkwM8MwvVMAu+QhCzoAbdMA16oE3uwzq4EAeqcJ7W06ElIALQAKLLE4E0cAvpUJq+MwtWMw4BsDoq9A4ZyqIU8XV/UAqScJ9GwIsDMQopQAKBMAkv0waHyDX+VApJUAITEAi8gJwDoQzHcAQlQAeDwAVTYaL/ACBMcABwMAinIApQShCyAAldkACJEAAHACQJoQx/gAzKcABuUApaOhDGIAnHAADdoA0kVBCzIAmWwAbcAADLkAx1+n1/wAS/wAeg/0ANBaEMcKAKpoAJnZAFAKAHhzoQyaAzlPAFpkAKkGBBunEJojALT2GUR6oQlKM3utALl0CnysMMB7AM5sMzY7oQv2A+DqML72B+zMCPxMMJB7B6slmsxnqsyNqO+0AfvoMOxcANxIAMknALx9AHoHgEgzAIxxA6jNAIj0AKRxCI0hIGkjAM7JAG5UmHpvA5mNMIXeAGaeAIS3AF4tAEWfMIoGAEFjcDbyA5IoEbxMEOTMAEAssEwuAEofAIjyAJSfAsUyA5+ReF//AJgjAJdwaKrrAIefAKd3AHogAH/fo5dyAGJWAJ1BAD/yAM4mAHMWAHgLFLBksRFisQV0ADSf8wCKGwCLgzCW/AB4GABsPxD3aQbq/wCnbwOVwABsYyAzRgK4MQBIUDGOIgo/8AB1uABqJAgwQhDksjBWFQBS5QBVGAOaIACYvwBGcQA4wgCF57CHFACqJwZwkBAMGwDccACX2xD0EgCpJgBC5gAWVYBdIyGsVAD/LHEPtwDdjwCX2wFsWQBpCgsNN6CZOQBp8QC9JwBVTLEAHADoygM0zgCuswDdfAU9LQE5wTDD34OewQAK6gfzPEN8k6u7Rbu7Z7u7ibu5rTB+LAhSr0LNPAN4VgqbuoBJ+FOyKwAq9gCAYXBqUwAxVAAz8wDdhwvKxTDCFgAUlwb67TAmEwA47/kA2LKzsNsABJAHtx0AWB0AMkQAl5EwvOwDoJB3tG0AWDQApTAAaYQxw/FTrl6wIZ1wWgQAqIsARrozcWWBAAbARxMAiSgAibsL/nKDthgK2kgAmIYAwSoY11gjtTsAluoAmlQBX0cAYqEBO+AwdKoASMIBH0Cgap4AqhiDtKoAiuQBUHgAcqsAAO0AEMQDxMIA514hEBIAwU8ASfcAUJ/DlXUAFPYLfXsBYBdAbbUAWmEAoC2D2u8AoAPAmfIMXdIwClUAWaAA0trEKycAhVAAmOgDkBZAe4EAY/8AmRqEJnAAdzIAiOcMMqxAhfMAqzQDl2nMRqaqO4kxtLrLuK/7zIjBxSsLAIROIEgMkCUqAOUDANAbQFH8ACK+ACbfAJAqEGLLBQvpMBbbACK9AFXOAov7ADR+s7A5ACPAACg2ALRiQNtHANy+MNn5AMsMAEJ2UQetAGbcAIsAAFn0MLJsAOdiBXBgEASAAIPdAK5ODMC+EIjjANWSACSDEWZSEQX0ACYcADK2AIMkIR2VAEKwA0D8AEe9EXfyEMAGAMSRACIdArM7wQAXAEI8AFM9AGXnAZmbEZ7JC8UoAEUfAJqWo4gGABSqABI6AHmyAbtGEbuNEHe4AHdWYQd2DCjKAJLoAEIr0CUiAFhFAERQgd0kEd7CAPApBsDDABLSAA5P/gLCtAGVPwB0TgA+mxHu3xHuxwDbsGAJsQAl2gN8swCFMgKVJgDHpAIAaCIMagIAshDVzQBVpwAFywADCCylOQCZSgB53gISAiIiTCEOGgN1CgBUUbBVGgDFygBt7wDlwQBjiiIzwyiQnxCgLACK7gCrvIBYSwCUXwBHP9JFEyJVWitQzRD81w0mYyFkygJmziJnAiJ5rzCrLwDD4hKIQyD4aCKIqCC4yi1wvxCvQkDrSQKZvSKZ8SKl8wKqXCOgbgDbNSK7eSK7vSK7/CED4ABipQEMziLNAiLdRiLdiyEMxwBF1gouRiLuiiLl/ALu6yENOQCG0ACwmxL/3yLwFJMzAFkzmguBATUzEXkzEb0zE+yjoqwzIuAzMycwXuyTo/EzRDUzRHk8gVQTVWgzVao98vgTZqIxGbuzx4g8CyC2h1YsiN/DkBAQA7";
var e=document.createElement("canvas"),d=e.getContext("2d");b.onload=function(){e.width=33;e.height=34;for(var f=0;11>f;f++)d.drawImage(b,0,34*f,33,34,0,0,33,34),gk[f]=e.toDataURL("image/png"),c+=".ncursor"+f+"{cursor:url('"+gk[f]+"'), default}",d.clearRect(0,0,33,34);document.getElementsByTagName("style")[0].innerHTML=c};Qc(2)})();var Ie=function(c,b){t(c).style.display="block";Ie.actived=c;b.actual="potion";b.id=0;b.amount=100;b.func()};Ie.actived="";var la={potion:{bak:1,max:4,ord:["level","mana",
"attack","defence"]},sword:{bak:5,max:3,ord:["attack","attackBow","defence"]},book:{bak:8,max:18,ord:"fireRain lightning healing createCarpet createBat bless freeze confusion invisibility createGolem magicVision raiseDead turnToStone whirlpool createDragon flameBolt teach createJinn".split(" ")}};t("mgbook").onclick=function(){la.actual="book";la.id=0;la.amount=d[la.book.ord[la.id]].obj.spcost[0];la.func()};t("mgpotion").onclick=function(){la.actual="potion";la.id=0;la.amount=100;la.func()};t("mgsword").onclick=
function(){la.actual="sword";la.id=0;la.amount=100;la.func()};t("mgdecline").onclick=function(){t("magicworkshopmenu").style.display="none"};t("mgitem").onmousedown=function(c){var b=1;c.button&&(b*=-1);c=la[la.actual].max;0>la.id+b&&(la.id=c);la.id=(la.id+b)%c;"book"==la.actual&&(la.amount=d[la.book.ord[la.id]].obj.spcost[0]);la.func()};t("mgaccept").onclick=function(){Q(Zh,[la.actual,la.id,parseInt(t("mgamount").innerHTML)],G[0])};var Zh=function(c,b){b=x[b];var e=c[2],d=[e,0,0,0];tb.paypal(d)||
(e=~~(250*e),"book"==c[0]&&(e*=2),b.setupINTV(hk,[c,b.id],e),b.lcost=d,b.techStart=b.c-n.cycle,da(b.id)&&(t("magicworkshopmenu").style.display="none"))},gm={defence:6,mana:0,level:2,health:1,attack:5},hm={attack:"sword",attackBow:"bow",defence:"shield"},im={attack:.5,mana:1,defence:.5,level:.2},hk=function(c){var b=x[c[1]],e=c[0][0],f=la[e].ord[c[0][1]];c=c[0][2];b.lcost=void 0;"sword"==e&&(e=hm[f]);"attackBow"==f&&(f="attack");e=Object.assign({},gc[e]);if(e.potion)e.d=gm[f],e[f]=~~(c*im[f]);else if(e.book){var g=
d[f],h=g.obj;e.spell=f;e.attack=~~(c/h.spcost[0]);e.name=h.name;e.iconID=g.iconIDbook}else e[f]=~~(.25*c),250<e[f]&&(e[f]=250);O(e);me(52,b,!0,e);b.techStart=void 0;da(b.id)};t("mgamount").onmousedown=function(c){var b=10;"book"==la.actual&&(b=d[la.book.ord[la.id]].obj.spcost[0]);var e=b;c.button&&(b*=-1);Fb.shift&&(b*=5);la.amount+=b;0>=la.amount&&(la.amount=e);t("mgamount").innerHTML=la.amount};la.func=function(){t("mgitem").style.backgroundPositionY=-48*(la.id+la[la.actual].bak)+"px";t("mgamount").innerHTML=
la.amount};var Ag=[0,0,0,0,0,0,0,0],Bb,Jd,Ua=[document.getElementById("order1"),document.getElementById("order2"),document.getElementById("order3"),document.getElementById("order4"),document.getElementById("order5"),document.getElementById("order6"),document.getElementById("order7"),document.getElementById("order8")],ik=document.getElementById("bottominfo"),Je=Ua[0],Ke=Ua[1],Le=Ua[2],Me=Ua[3],Ne=Ua[4],Oe=Ua[5],Pe=Ua[6],Qe=Ua[7];Je.addEventListener("mousedown",function(){Je.style.transform="translate(2px,2px)"});
Ke.addEventListener("mousedown",function(){Ke.style.transform="translate(2px,2px)"});Le.addEventListener("mousedown",function(){Le.style.transform="translate(2px,2px)"});Me.addEventListener("mousedown",function(){Me.style.transform="translate(2px,2px)"});Ne.addEventListener("mousedown",function(){Ne.style.transform="translate(2px,2px)"});Oe.addEventListener("mousedown",function(){Oe.style.transform="translate(2px,2px)"});Pe.addEventListener("mousedown",function(){Pe.style.transform="translate(2px,2px)"});
Qe.addEventListener("mousedown",function(){Qe.style.transform="translate(2px,2px)"});Je.addEventListener("mouseup",function(c){Bb=c.button;Ga(0)});Ke.addEventListener("mouseup",function(c){Bb=c.button;Ga(1)});Le.addEventListener("mouseup",function(c){Bb=c.button;Ga(2)});Me.addEventListener("mouseup",function(c){Bb=c.button;Ga(3)});Ne.addEventListener("mouseup",function(c){Bb=c.button;Ga(4)});Oe.addEventListener("mouseup",function(c){Bb=c.button;Ga(5)});Pe.addEventListener("mouseup",function(c){Bb=
c.button;Ga(6)});Qe.addEventListener("mouseup",function(c){Bb=c.button;Ga(7)});document.getElementById("stock").addEventListener("click",function(c){(c=x[G[0]])&&jk(c)});var jk=function(c,b){if(0==S.stockActive||b){if(b=c.inventory,b.length){var e=[];e.length=b.length;for(var d=0,g=b.length;d<g;e[d]=x[b[d++]]);ka(e,c,1)}}else ka(c.icons,c)};(function(){for(var c={},b=0,e=Ua.length;b<e;c={l:c.l},b++)c.l=b,Ua[b].addEventListener("mouseenter",function(b){return function(){var c=S.displayed[b.l],e=x[G[0]];
if(e&&e.kingdom)var d=H[e.kingdom];if(c&&(void 0!==c.unit?(e=y[c.unit],e={name:e.name,cost:Aj(e.cost,c.hero||c.merc,d.values.fameTech)}):e=c.obj,S.stockActive&&Sc(S.active[b.l].id,1,1),e&&e.name)){var f=e.name,k="<span>";k=2==f.length?k+(f[0]+" - "+f[1]):k+f;if(f=e.cost){!e.tech&&d.mod[e.type]&&d.mod[e.type].cost&&(f=d.mod[e.type].cost);k+=" - (";for(var m=0;5>m;m++)f[m]&&(k+=f[m]+"<img class='resource' src='"+jm[m]+"' /> ");k=k.substring(0,k.length-1);k+=")"}k+="</span>";if(G.length){d=H[x[G[0]].kingdom];
if(d.technology.disabled[c.id]){f="<span class='red'>"+q.requires+": ";m=xa[d.k];var n=d.technology.investigated,r="",t=c.requireObj;if(t)for(var w=0,v=t.length;w<v;w++)d=t[w],d.tech?n[d.nu.id]||(r+=d.name[0]+", "):m[d.type].length||(r+=d.name+", ");r.length&&(r=r.substr(0,r.length-2));k+=f+r+"</span>"}e.type==Mb&&(k+="<span class='increase'>+"+e.increase+"</span>");(e=S.active.cut)&&e[c.objName]&&(k+="<span class='shotcut'>"+e[c.objName].toLocaleUpperCase()+"</span>");ik.innerHTML=k}}}}(c)),Ua[b].addEventListener("mouseout",
function(){S.stockActive&&Sc(G[0],1,1);ik.innerHTML=""})})();var $h=function(){history.pushState("",document.title,window.location.pathname)},cc=function(){n.online=0;location.hash="";t("MatchX").style.display="none";document.getElementById("index").style.display="block";document.getElementById("returnmenu").style.display="none";document.getElementById("game").style.display="none";document.getElementById("gameFinish").style.display="none";setTimeout($h,200)},Ga=function(c){var b=Ag[c];Ga.lastFunc=
b;Ga.nu=c;if(S.stockActive){b=x[G[0]];var e=x[b.inventory[c]];e&&(e.potion?Fb.control?Q(Id,b.id,[b.id,e.id]):(W=Id,W.item=e.id):e.spell?Fb.control&&b.mana?Q(Sh,b.id,e.id):(d[e.spell](),W.item=e.id):(Q(Ed,b.id,[e.id]),da(b.id)))}else b&&b();Ga.lastFunc=void 0;Ga.nu=void 0;Ua[c].style.transform=""},tl=function(c){var b=[.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.27,.3,1,.5,.5,.5,1,.62,.62,.62,1,.74,.74,.74,1,.3+.58,.3+.58,.3+.58,1,.94,.94,.94,1,1,1,1,1,1.06,1.06,1.06,1,.3+.82,.3+
.82,.3+.82,1,1.08,1.08,1.08,1,1.04,1.04,1.04,1,1,1,1,1,.95,.95,.95,1,.3+.58,.8,.7,1,.3+.54,.72,.6,1,.7,.62,.5,1,.6,.55,.3+.15,1,.5,.44,.42,1,.4,.37,.35,1],e=new Date;null!=c&&(e=c);c=e.getMinutes()/60;e=e.getHours();document.getElementById("daynighticon").style.backgroundPosition="0 -"+36*e+"px";var d=[b[4*e],b[4*e+1],b[4*e+2],b[4*e+3]];e=(e+1)%24*4;d[0]+=(-d[0]+b[e])*c;d[1]+=(-d[1]+b[e+1])*c;d[2]+=(-d[2]+b[e+2])*c;d[3]+=(-d[3]+b[e+3])*c;return d},Eb=0,db=0,hd=0,id=0,wd=function(c,b){var e=tzar.width,
d=tzar.height,g=v.mx/32;c/=32;b/=32;var h=V*e*.03125,l=V*d*.03125,p=.03125*e,k=.03125*d,m=c+.5*(p-h),n=b+.5*(k-l);0>m?c=.5*-(p-h):m+h-g*V>A&&(c=A-h-.5*(p-h)+g*V);0>n?b=.5*-(k-l):n+l>Ka&&(b=Ka-l-.5*(k-l));h-v.mx>A&&(V=A/(.03125*e),O(V));l>Ka&&(V=Ka/(.03125*d),O(V));Eb=32*-c;db=32*-b},Zc=document.getElementById("minimap"),Bg=function(c){var b=c.pageX-parseInt(Zc.style.left);c=c.pageY-parseInt(Zc.style.top);var e=tzar.height*Rb/(32*Ka);b=~~(.5+(b-tzar.width*bc/(32*A)*.5)*A/bc);c=~~(.5+(c-.5*e)*Ka/Rb);
wd(32*b,32*c);0==Jd&&document.removeEventListener("mousemove",Bg)};Zc.addEventListener("mousedown",function(c){var b=c.pageX-4,e=c.pageY-31;0==c.button?(document.addEventListener("mouseup",function h(b){document.removeEventListener("mouseup",h);document.removeEventListener("mousemove",Bg)}),Jd=!0,Bg(c),document.addEventListener("mousemove",Bg)):2==c.button&&(b=~~(A*(c.pageX-4)/bc),e=~~(Ka*(c.pageY-31)/Rb),Q(Fa,b+e*A,G))});var Fb={control:0,shift:0,esc:0},ea=function(c,b){c&&!n.editor&&(c=S.active,
b=km[b],c&&c.cut&&(b=d[c.cut[b]]))&&(c=tb.technology,Bb=0,c.disabled[b.id]||c.hidden[b.id]||(Ga.lastFunc=b,b(),Ga.lastFunc=void 0))},$b={37:function(c){hd=c},40:function(c){id=-c},39:function(c){hd=-c},38:function(c){id=c},32:function(c){ek=c?$l:function(){}},46:function(c){c||Q(Re,Fb.shift,G.slice(0))},16:function(c){Fb.shift=c},17:function(c){Fb.control=c},27:function(c){Fb.esc=c},13:function(c){c&&!n.editor&&("displaynone"==ai.className?(ai.className="displayblock",bi.focus(),$b.blocked=13):(ci(),
ai.className="displaynone",$b.blocked=null))},19:function(c){c||n.online||Yb(1)},48:function(c){c&&Fb.control&&(V=1,di({deltaY:0}))},176:function(c){c&&(n.deltaTime+=3E4)},65:ea,66:ea,67:ea,68:ea,69:ea,70:ea,71:ea,72:ea,73:ea,74:ea,75:ea,76:ea,77:ea,78:ea,79:ea,80:ea,81:ea,82:ea,83:ea,84:ea,85:ea,86:ea,87:ea,88:ea,89:ea,90:ea,219:function(c){c&&kk(-1)},221:function(c){c&&kk(1)}},km={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",
82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};$b.blocked=null;(function(){for(var c=[65,37,40,83,39,68,38,87],b=c.length=0,e=c.length;b<e;b+=2)$b[c[b]]=$b[c[b+1]]})();document.oncontextmenu=function(){return!1};var kc=document.getElementById("attackmenu"),jd=document.getElementById("defencemenu"),kd=document.getElementById("levelmenu"),Kd=document.getElementById("kingdom"),wa=document.getElementById("progressone"),Cg=document.getElementById("unitname"),Rc=document.getElementById("progressvalue");
document.getElementById("selectedobject");var Re=function(c,b){if(b.length){c=c||n.editor?b.length:1;for(var e=0;e<c;e++)x[b[e]].die()}},Pa=function(c,b){c.sound&&!b&&(b=c.sound,Ea(b[~~(b.length*Math.random())]));kd.style.display="none";Se.style.display="none";Kd.style.display="block";wa.style.display="block";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";jd.style.display="none";Cg.innerHTML=c.name;Te(c);Kd.innerHTML=H[c.kingdom].name;c.attack?(kc.style.display=
"block",kc.innerHTML=c.attack):kc.style.display="none";b=c.health;var e=c.maxHealth;Infinity==b?(wa.value=100,wa.max=100,Rc.innerHTML=b):wa.value=b;Infinity==e&&Infinity!=b?(wa.max=100,wa.value=1):Infinity!==e&&(wa.max=e);c.inventory&&c.inventory.length&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=c.inventory.length);Rc.innerHTML=~~b+"/"+e;if(!lc(c,v))return ka([]);c.point&&(b=c.point,wb.x32=b[0],wb.y32=b[1],nb(wb,96*(Ka-1)),wb.show=1);if(!1===
c.built)ka([d.stopBuilding]),Te(c);else if(c.techStart)ka([d.stopTech]),Te(c),manamenu.style.display="block",manamenu.style.backgroundPosition="0px -200px",manamenu.innerHTML=100-~~(100*(c.c-n.cycle)/c.techStart)+"%",Pa.intv&&clearInterval(Pa.intv),Pa.intv=setInterval(function(){G[0]==c.id?manamenu.innerHTML=100-~~(100*(c.c-n.cycle)/c.techStart)+"%":clearInterval(Pa.intv)},400);else{rl();if(c.working){e=c.work;var f=S.page*S.length;b=0;for(var g=S.length;b<g;b++){var h=e[b+f];Ua[b].innerHTML=h?h:
""}manamenu.style.display="block";manamenu.style.backgroundPosition="0px -200px";var l=1E3*y[c.waitlist[0]].time;b=~~(100*(n.now()-c.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%";Pa.intv&&clearInterval(Pa.intv);Pa.intv=setInterval(function(){if(G[0]==c.id&&c.working){var b=~~(100*(n.now()-c.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%"}else clearInterval(Pa.intv)},400)}else for(b=0,e=S.length;b<e;Ua[b++].innerHTML="");ka(c.icons,c)}};Pa.intv=!1;var Ue=function(){kc.style.display="none";
jd.style.display="none";kd.style.display="none";wa.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";Cg.innerHTML="";kc.innerHTML="";jd.innerHTML="";manamenu.innerHTML="";kd.innerHTML="";Kd.innerHTML="";Rc.innerHTML="";wa.value="";Rc.maxLength="";Se.style.display="none";Je.innerHTML="";Ke.innerHTML="";Le.innerHTML="";Me.innerHTML="";Ne.innerHTML="";Oe.innerHTML="";Pe.innerHTML="";Qe.innerHTML="";ka([d.origin]);lk()},W,Cb,Bc,ac={},Dh=
function(c,b,e,d){var f=e||x[G[0]],h=d?H[f.kingdom]:tb;if("peon"==(e?f.clss:Bc))var l=!0;if(n.editor)return[Zb,p];var p=c+b*A;if(!d&&W!=Zb)return[W,p];c=K[p];b=0;if(!f)return[b,p];if(2<c||(c=ld[p])&&2<c){var k=x[c];k.invisible||(l&&k.storage&&f.stock?b=cg:l&&void 0!=k.res?b=vc:l&&k.health<k.maxHealth&&!h.diplomacy[k.kingdom]&&k.build&&!k.dummy||k.dummy&&!k.built?b=wc:h.diplomacy[k.kingdom]||k.dummy&&h.values.experience||k.confused?b=xc:1===k.invType&&!f.build&&!f.boat&&0<k.invMax&&lc(f,k)&&(b=qe))}else c=
Sa[p],2<c&&!f.build&&!f.boat&&(k=x[c],k.item?b=Dd:k.field&&l?b=Xf:1===k.invType&&!f.build&&!f.boat&&0<k.invMax&&lc(f,k)&&(b=qe));0===b&&(f=Nb[f.kingdom],f[p]&&l?(c=f[p],b=wc):(k||(c=-p),b=Fa,Fa.cursor=2));return[b,c]},G=[];G.change=1;var mk,cm=document.getElementById("gold"),dm=document.getElementById("wood"),em=document.getElementById("food"),fm=document.getElementById("stone"),fa,ei;var fi=!1;var ic=function(c,b){var e=V,d=tzar.width,g=tzar.height;c=c*e-Eb+.5*(d-e*d);b=b*e-db+.5*(g-e*g);return[c,
b]},ub=function(c){if(c){var b=c.pageX;c=c.pageY;ub.lastX=b;ub.lastY=c}else b=ub.lastX,c=ub.lastY;b=ic(b-v.mx,c);c=b[1];b=b[0];0==fi?(window.removeEventListener("mousemove",ub),ei=!1):ei=!0;if(1===fa[2]||ub.forced)c=32*~~(c/32),b=32*~~(b/32);fa[4]=c;fa[6]=b;fa[9]=b;fa[10]=c},gi=function(c,b){for(var e=b.length,d=0;d<e;d++){var g=x[b[d]];g.build&&(K[c[0]+c[1]*A]==g.id?(g.point=void 0,G[0]==g.id&&(wb.x32=2*A,nb(wb,128*A),wb.show=0)):(g.point=c,wb.x32=c[0],wb.y32=c[1],G[0]==g.id&&(nb(wb,96*(Ka-1)),wb.show=
1)))}};document.onkeydown=function(c){return c.ctrlKey&&c.shiftKey?!1:{116:1,115:1,123:1}[c.keyCode]?!1:!0};var nk=function(c){if(null==$b.blocked||$b.blocked==c.keyCode){var b=$b[c.keyCode];b&&b(1,c.keyCode)}},ok=function(c){if(null==$b.blocked||$b.blocked==c.keyCode){var b=$b[c.keyCode];b&&b(0,c.keyCode)}},pk=function(c){var b=window.innerWidth,e=window.innerHeight,d=c.pageX,g=c.pageY;if(screen.height-10<=e){if(1.2==Math.abs(hd)||0==hd)hd=1.2*((10>d)-(d>b-10));if(1.2==Math.abs(id)||0==id)id=1.2*
((10>g)-(g>e-10))}d=ic(d-v.mx,g);g=~~(.03125*d[1]);d=~~(.03125*d[0]);c.pageX<v.mx?Qc(2):(c=Dh(d,g)[0],0==c||void 0==c.cursor?Qc(2):Qc(c.cursor))},qk=function(c){if(!Ve)if(c.pageX>v.menumx){if(0==c.button){window.addEventListener("mousemove",ub);c=ic(c.pageX-v.mx,c.pageY);var b=c[1];c=c[0];void 0!=C.wall&&(c=C.wall,b=32*~~(c/A),c=c%A*32,ub.forced=!0,C.wall=void 0);fi=!0;fa[0]=c;fa[1]=b;fa[9]=fa[0];fa[10]=fa[1];fa[3]=fa[0];fa[7]=fa[1];Dg=!1}}else Dg=!0},Dg=!1,lm=function(c){if(c.pageX>v.menumx&&c.pageY>
v.menumy&&!Jd&&0==Dg){fi=!1;var b=ic(c.pageX-v.mx,c.pageY),e=~~(b[1]/32);b=~~(b[0]/32);O(b,e);var d=Ka;if(2==c.button&&!n.editor){if(W!=Zb){W=Zb;return}if(0<G.length)if(d=x[G[0]],1!=d.build||d.arrow){if(0===W){W=Zb;return}d=Dh(b,e);c=d[1];d=d[0];d==Fa&&(b={x32:b,y32:e,d:0,mv:1,img:m.cursor},yb(b),Lb.new(b,Za(b.img)));Q(d,c,G)}else Q(gi,[b,e],G);return!1}if(0==c.button){if(W==Zb)return Zb();c=b+e*d;if(W.spLevel)c=W.spLevel(c);else{var g=0;2<ld[c]?g=ld[c]:2<K[c]?g=K[c]:2<Sa[c]&&(g=Sa[c]);c=g}if(c)W.allowPos&&
x[c].build&&(c=-(b+e*d));else if(W.allowPos||W.noObj)c=-(b+e*d);else return W=Zb;W.noObj&&3<=c&&(c=-(b+e*d));W.item?(Q(W,c,[G[0],W.item]),W.item=void 0):Q(W,c,G);Fb.shift||(W=Zb)}}Dg=!1},rk=function(c){Ve||(lm(c),Ld.actived&&Ld(),fa[0]=NaN,fa[1]=NaN,fa[9]=NaN,fa[10]=NaN,fa[3]=NaN,fa[7]=NaN,k.bindBuffer(k.ARRAY_BUFFER,Ec),k.bufferSubData(k.ARRAY_BUFFER,0,fa),Vb.actived&&Vb(),Jd&&(Jd=!1))},ii=function(c){c=x[c];c.tempChild.quit(c.selectAnim);Db(c.selectAnim);hi(c.selectAnim);c.selectAnim=void 0},sk=
function(c,b){for(var e=~~(c/32),d=~~(b/32),g=b,h=c,l=NaN,p=A,k=0,m;3>k;k++){m=rb[k];var n=e,r=d;c=h;b=g;2<m[n+r*p]?(c=n,b=r,l=x[m[c+b*p]]):(.5<=b/32-r?r++:r--,2<m[n+r*p]?(c=n,b=r,l=x[m[c+b*p]]):(.5<=c/32-n?n++:n--,2<m[n+r*p]?(c=n,b=r,l=x[m[c+b*p]]):(r=~~(b/32),2<m[n+r*p]&&(c=n,b=r,l=x[m[c+b*p]]))))}return l},Zb=function(){var c=A,b=fa[0],e=fa[1],d=fa[9],g=fa[10],h=~~(b/32),l=~~(e/32);if(Fb.shift){var p=sk(b,e);if(p&&lc(p,v)&&!ac[p.id])return G[G.length]=p.id,p.setupChild(pb.select,1,be),ac[p.id]=
1,1<G.length?Eg(G):Sc(p.id)}var k=0;for(p=G.length;k<p;ii(G[k++]));Ie.actived&&(t(Ie.actived).style.display="none");Cb&&(ii(Cb.id),Cb=void 0);G.length=0;Bc=-1;ac={};Se.style.display="none";Je.innerHTML="";Ke.innerHTML="";Le.innerHTML="";Me.innerHTML="";Ne.innerHTML="";Oe.innerHTML="";Pe.innerHTML="";Qe.innerHTML="";kc.className="";S.page=0;wb.show&&(wb.x32=2*A,nb(wb,128*A),wb.show=0);if(10>=Math.abs(e-g)&&10>=Math.abs(b-d)){if(p=sk(b,e),p.id||(p=Nb[v.kingdom][h+l*c])&&(p=x[p]),p&&2<p.id&&(!p.invisible||
lc(p,v)))if(ac[p.id]=1,G.length=0,p.setupChild(pb.select,1,be),lc(p,v)&&!n.demo){G[0]=p.id;Bc=null!=p.defence?p.clss:-2;if(256>Date.now()-mk){if(n.editor){mm(x[G[0]]);return}c=~~(V*tzar.width*.03125);b=~~(V*tzar.height*.03125);g=~~(.03125*-Eb+.5*(~~(.03125*tzar.width)-c));h=~~(.03125*-db+.5*(~~(.03125*tzar.height)-b));b*=c;g+=h*A;for(k=0;k<b;k++)for(e=g+k%c+~~(k/c)*A,d=0;3>d;d++)h=rb[d][e],2<h&&(l=x[h],l.clss!=p.clss||ac[h]||!lc(l,p)||l.item||(l.setupChild(pb.select,1,be),ac[h]=1,G.put(h)))}mk=Date.now();
if(p.build)return Pa(p)}else return Cb=p,Sc(p.id),!1}else if(!n.demo){b=~~(b/32);d=~~(d/32);e=~~(e/32);g=~~(g/32);b>=d&&(k=b,b=d,d=k);e>=g&&(k=e,e=g,g=k);d++;l=[1,1,1];var m=d-b;k=0;for(p=m*(g-e+1);k<p;k++)for(g=k%m+b,h=~~(k/m)+e,d=0;3>d;d++){var q=rb[d][g+h*c],r=x[q];r&&(r.selected=1,l[q]||(l[q]=1,r.build||!lc(r,v)||r.item||(G[G.length]=q,r.setupChild(pb.select,1,be),ac[q]=1)))}}1<G.length?Eg(G):1==G.length?Sc(G[0]):(ka([]),Ue(),Bc=-1,G.length=0)},tk=[manamenu,manamenu1],uk={mana:{background:"0px -120px",
progress:progressmana},food:{background:"0px -240px"},milk:{background:"0px -280px"},gold:{background:"0px -260px"},stone:{background:"0px -320px"},wood:{background:"0px -340px"}},jm=["/nehhon/gold.gif","/nehhon/wood.gif","/nehhon/food.gif","/nehhon/stone.gif","/nehhon/mana.gif"],Se=document.getElementById("unitSpeed"),Sc=function(c,b,e){manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";c=x[c];c.sound&&!e&&(e=c.sound,Ea(e[~~(e.length*Math.random())]));
Bc=c.clss;c.inventory&&c.inventory.length&&lc(c,v)&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=c.inventory.length);b||(lc(c,v)&&!n.demo?ka(c.icons,c):ji());Kd.style.display="block";Cg.innerHTML=c.name;c.attack&&c.item||void 0!==c.attack?(kc.innerHTML=c.attack,kc.style.display="block"):kc.style.display="none";c.defence&&c.item||void 0!==c.defence?(jd.innerHTML=c.defence,jd.style.display="block"):jd.style.display="none";c.mana&&!c.manaTarget&&
(manamenu.style.display="block",manamenu.innerHTML=c.mana,manamenu.style.backgroundPosition="0px -120px");b=0;var d=c.update;if(d){b=0;for(var g=d.length;b<g;b+=3){var h=d[b],l=uk[h];e=tk[b/3];e.innerHTML=c[h];e.style.display="block";e.style.backgroundPosition=l.background;"mana"==h&&c.manaTarget&&(e.innerHTML=~~(100*c.mana/c.manaTarget+.5)+"%",e.style.backgroundPosition="0px -200px");l.progress&&(l.progress.style.display="block",l.progress.value=c[h],l.progress.max=c[h+"Max"])}}c.stock&&(d=c.stock,
e=tk[b/3],e.style.display="block",e.style.backgroundPosition=uk[d[4].icon].background,e.innerHTML=d[0]);b=c.level?c.level:0;kd.innerHTML=b;kd.style.display="block";0===b&&(c.item||c.build)&&(kd.style.display="none");Kd.innerHTML=H[c.kingdom].name;wa.style.display="block";vk(c);Te(c)},vk=function(c){var b=c.health;c=c.maxHealth;Infinity==b?(wa.value=100,wa.max=100,Rc.innerHTML=b):(wa.value=b,Infinity==c?(wa.max=100,wa.value=1):wa.max=c,Rc.innerHTML=~~b+"/"+c)},Eg=function(c,b){var e=x[c[0]],d=0,g=
0,h=e.clss,l=c.length,p={},k=[];k.cut={};for(var m={},n=0;n<l;n++){e=x[c[n]];d+=e.maxHealth;g+=e.health;Bc=h!=e.clss?-1:!0;if(e.work)for(var r=e.work,t=Object.keys(r),w=0,v=t.length;w<v;w++){var y=t[w];m[y]||(m[y]=0);m[y]+=r[y]}t=e.icons;r=t.length;if(void 0===e.techID&&!1!==e.built)for(w=0;w<r;w++)v=t[w].id,t[w].obj.tech||(void 0===p[v]?p[v]=1:p[v]++,p[v]===l&&(t.cut&&(v=t.cut,y=t[w].objName,v[y]&&(k.cut[y]=v[y],k.cut[v[y]]=y)),k.put(t[w])))}!0===Bc&&(Bc=e.clss);g=Infinity==g?100:~~(g/d*100);Rc.innerHTML=
g+"/100(%)";wk();Cg.innerHTML="";kc.style.display="none";jd.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";kd.style.display="none";Kd.innerHTML=l+" "+q.units;wa.style.display="block";wa.value=g;wa.max=100;if(!b)for(ka(k),n=0,c=S.page*S.length,r=S.length;n<r;n++)b=m[n+c],Ua[n].innerHTML=b?b:""},xk=function(){};new Float32Array(8);var Qb,sd,Ec,ud,Vd,V=1,yk={1:2560,101001:2048,101E3:2048,1001:2048,1E3:2048,100:1536,10010100:1280,10100:1280,
1001E4:1280,1E4:1280,10010010:256,10010110:256,10110:256,10111:256,10010111:256,110:512,111:512,11:512,10:512,111E5:2816,11E5:2816,11E6:2816,1E6:2816,1101E4:768,11110100:768,11010100:768,1111E4:768,1E7:3360,1E5:3072,1101E3:1792,1101001:1792,11101E3:1792,11101001:1792,101111:0,1011:0,1111:0,101011:0},nm=function(c){Db(c);jc.put(c.bufferID)},Lb={table:{},dates:[],new:function(c,b,e){b=Math.floor(b)+n.now();var d=this.table;e||(e=nm);d[b]||(d[b]=[]);c.animFunc=e;d[b].put(c);this.dates.add(b);this.needOrder=
!0}},Za=function(c){c=Z[c];return 0>c[1]?m.delay[c[0]-c[1]-1]:~~(c[0]/c[1]*1E3)},Ob=new Float32Array(12),Ch=function(c){var b=c.id+n.arje+c.x32+c.y32;c.rnd=[4294967295+b,4294967295-b,0]},ki=function(c){c=x[c];c.mlist&&zk(c,!0);c.hlist&&zk(c,!1)},zk=function(c,b){if(b)var e=c.mlist,d=c.mlistID,g=Md.mercenaries;else e=c.hlist,d=c.hlistID,g=Md.heroes;e.unshift(g[Ej(c,g.length)]);b?d.unshift(c.mercID++):d.unshift(c.heroID++);8<e.length&&(e.length=8,d.length=8);S.active==e&&ka(e);ec(c,5E4)},li=function(c){c=
x[c];if(!H[c.kingdom].paypal(I.crusaderCost)){var b=I.maxCrusaders,e=H[c.kingdom],f=e.technology.disabled;if(!f[d.createCrusaders.id]){var g=16+e.crusade.number*I.crusaderGain;e.crusade.number++;g>b&&(g=b);b=e.crusade.list;b.length=g;for(e=0;e<g;e++)(b[e]=me(8,c,1)).deleteFromList=b;Ea("crusade",c.x32,c.y32);f[d.createCrusaders.id]=1;da(c.id)}}},am=function(c){H[c.kingdom].technology.disabled[d.createCrusaders.id]=0},td,K=[],Sa=[],ld=[],oc={},rb=[];rb.length=3;var ji=function(){for(var c=S.displayed.length=
0,b=S.length;c<b;c++){var e=Ua[c];e.className="blocked";e.style.backgroundPosition="48px 96px";Ag[c]=Fc}S.rightButton.className="blocked";S.leftButton.className="blocked";S.stock.className="blocked";S.rightBlocked=1};S.leftButton.onclick=function(){S.page&&(S.page--,ka(S.active,0,S.stockActive))};S.rightButton.onclick=function(){S.rightBlocked||(S.page++,ka(S.active,0,S.stockActive))};S.displayed=[];var ka=function(c,b,e){e=!!e;b||(b=NaN);var d=c.olegal||NaN;if(b.working&&!e)var g=1;S.active=c;S.displayed.length=
0;var h=tb.technology,l=S.page,k=S.length;ji();!1!==e&&b?S.stockActive=b:!1===e&&(S.stockActive=!1);ka.actv={};c.length<=l*k&&c.length&&(S.page--,l--);for(var m=0,n=0,q;m<k;m++){q=c[m+l*k];if(!q)break;var r=Ua[n];if(!e&&(ka.actv[q.id]=1,h.hidden[q.id]||q.obj.tech&&g)){k++;continue}r.style.backgroundPosition=48*e+"px "+(-e||1)*q.iconID*48+"px";e||!h.disabled[q.id]||d[q.id]?(r.className="",Ag[n]=q):r.className="blocked";S.displayed[n]=q;n++}c[m+l*k]&&(S.rightButton.className="",S.rightBlocked=0);0<
l&&(S.leftButton.className="");1===G.length&&(b=x[G[0]]);b.inventory&&0<b.inventory.length&&(S.stock.className="")};ka.actv={};var Ni,ra,ya,Xg,Mi;var k=t("tzar").getContext("webgl2",{antialias:!0,alpha:!1});v.gl=!!k;if(k){var om=k.getExtension("WEBGL_lose_context");k.canvas.addEventListener("webglcontextlost",function(c){setTimeout(function(){om.restoreContext()},2E3);c.preventDefault()},!1);k.canvas.addEventListener("webglcontextrestored",function(c){O("restored 2")},!1)}var Oi,Yg,Zg,Pi,qf,Ug,Tg,
pf,rf,Wd,Ud,rd,Vg,Wg,Ya=function(){if(n.canceled)return 0;requestAnimationFrame(Ya);var c=Ya.fp1000,b=Ya.delta,e=Ya.now;performance.now();var d=e;Ya.frameCount++;e=n.now();Ya.now=e;b=(b+(e-d))/1E3;Ya.delta=b;Ah+=b;zh++;Ya.fp1000=c+b;c=Lb.table;d=Lb.dates;Lb.needOrder&&(d.sort(function(b,c){return b-c}),Lb.needOrder=0);for(var g=0;d[g]<=e+17;g++){for(var h=c[d[g]],l=0,p=h.length;l<p;l++){var m=h[l];m.animFunc(m)}delete c[d[g]];g--;d.shift()}if(0!=hd||0!=id)Eb+=hd*b*640*V,db+=id*b*640*V,wd(-Eb,-db),
ub();ek(e);xk();k.uniform1f(Oi,e);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);if(c=bb.length)k.bindFramebuffer(k.FRAMEBUFFER,fb),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Pi),b=bb,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.enable(k.BLEND),k.blendEquation(k.MAX),k.blendFunc(k.SRC_COLOR,k.SRC_COLOR),k.bindTexture(k.TEXTURE_2D,Xg),k.drawElements(k.TRIANGLES,c,k.UNSIGNED_INT,0),k.bindTexture(k.TEXTURE_2D,Lighttexture),k.disable(k.BLEND),
k.bindFramebuffer(k.FRAMEBUFFER,null);Ak(Yg);d=window.innerWidth;g=window.innerHeight;k.viewport(v.marx,g-Rb-v.mary,bc,Rb);k.uniform2f(qf,32*A,32*Ka);k.uniform2fv(Wd,[0,0]);k.uniform1i(rf,1);k.uniform1f(td,1);Ak(Yg);k.viewport(v.mx,0,d,g);performance.now();k.useProgram(ya);k.bindVertexArray(Vg);k.uniform1f(Ug,~~((.01*e+.5)%5));k.drawArrays(k.TRIANGLES,0,6);k.viewport(v.marx,g-Rb-v.mary,bc,Rb);k.uniform1i(pf,1);k.uniform2fv(Ud,[0,0]);k.uniform1f(rd,bc/32/A);k.drawArrays(k.TRIANGLES,0,6);k.uniform1i(pf,
0);k.uniform2f(Tg,d,g);k.uniform2fv(Ud,[Eb,db]);k.uniform1f(rd,1/V);k.viewport(v.mx,0,d,g);k.useProgram(ra);k.bindVertexArray(Wg);if(c=Da.length)k.enable(k.BLEND),k.blendEquation(k.FUNC_ADD),k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA),k.bindBuffer(k.ARRAY_BUFFER,Ec),d=tzar.width,g=tzar.height,e=-Eb+.5*(d-V*d),b=-db+.5*(g-V*g),h=V*(d-v.mx),l=V*g,k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([e,b,24576,e+h,b,24576,e,b+l,24576,e+h,b+l,24576])),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Zg),b=Da,b.changed&&
(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.viewport(v.marx,g-Rb-v.mary,bc,Rb),k.drawElements(k.TRIANGLES,12,k.UNSIGNED_INT,0),k.uniform1i(rf,0),k.uniform2f(qf,d,g),k.uniform2fv(Wd,[Eb,db]),k.uniform1f(td,1/V),k.viewport(v.mx,0,d,g),k.bindBuffer(k.ARRAY_BUFFER,Ec),ei&&!mi?k.bufferSubData(k.ARRAY_BUFFER,0,fa):k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([NaN,NaN,24576,NaN,4347,24576,5551,NaN,24576,NaN,NaN,24576])),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,
Zg),b=Da,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.drawElements(k.TRIANGLES,c,k.UNSIGNED_INT,0),k.disable(k.BLEND);C.active&&(e=C.x,b=C.y,c=96*A,C.wh?(d=C.wh[0]-Z[C.img][8],g=C.wh[1]-Z[C.img][9]):g=d=0,ni(e,b,c,d,g,C.bufferID),C.active=!1);Yc.update&&Yc(1)},Ak=function(c){var b=ca.length;b&&(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,c),c=ca,c.changed&&(c.typed=new Uint32Array(c),c.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,c.typed,
k.STATIC_DRAW)),k.drawElements(k.TRIANGLES,b,k.UNSIGNED_INT,0))},Td=!1,di=function(c){if(!Ve&&(c.clientX>v.menumx||Jd||!c.clientX)){c=.07*Math.sign(c.deltaY)*V;var b=(V+c)*tzar.height*.03125;(V+c)*tzar.width*.03125-(V+c)*v.mx/32>A||b>Ka||(V+=c,.08>V&&(V=.08),ub(),wd(-Eb,-db),k.useProgram(ya),k.uniform1f(rd,1/V),k.useProgram(ra),k.uniform1f(td,1/V))}},ul=function(c){k.useProgram(ya);k.uniform4fv(Mi,c);k.useProgram(ra);k.uniform4fv(Ni,c)};xk=function(){var c=[Eb,db];k.useProgram(ya);k.uniform2fv(Ud,
c);k.useProgram(ra);k.uniform2fv(Wd,c)};"use strict";var ma=function(c,b){return c<A&&0<=c&&0<=b&&b<Ka?!0:!1};Array.prototype.put=function(c){this[this.length]=c};var pb,We,gc,oi,md=function(c,b,e,d){d&&0==md.cols[d]&&(md.list.push(d,c),md.cols[d]=1)};md.cols={};md.list=[];var M=function(c){for(var b=Object.keys(c),e=0;e<b.length;e++)c[c[b[e]]]=b[e];return c};window.onerror=md;var n={},Z=[],Bk=function(c,b,e,d){for(var f=Y.originalLength||0,h=Object.keys(c),l=0,k=h.length;l<k;l++){var m=h[l],n=c[m];
if(Array.isArray(n)){c[m]=f;n.url=f;m=Z[f++]=n;var q=n.deltaY||0;m.id=d/4;for(var r=6,t=m.length;r<t;r+=6){var w=m[r-2],v=m[r-1],x=m[r+2],y=m[r+3];b[d++]=m[r]/e;b[d++]=(q+m[r+1])/e;b[d++]=w;b[d++]=v;b[d++]=(m[r]+x)/e;b[d++]=(m[r+1]+q)/e;b[d++]=w+x;b[d++]=v;b[d++]=m[r]/e;b[d++]=(m[r+1]+y+q)/e;b[d++]=w;b[d++]=v+y;b[d++]=(m[r]+x)/e;b[d++]=(m[r+1]+y+q)/e;b[d++]=w+x;b[d++]=v+y}}else for(var z=Object.keys(n),A=0,B=z.length;A<B;A++)for(m=n[z[A]],m.id=d/4,m.url=f,n[z[A]]=f,Z[f++]=m,q=m.deltaY?m.deltaY:0,
r=6,t=m.length;r<t;r+=6)w=m[r-2],v=m[r-1],x=m[r+2],y=m[r+3],b[d++]=m[r]/e,b[d++]=(q+m[r+1])/e,b[d++]=w,b[d++]=v,b[d++]=(m[r]+x)/e,b[d++]=(m[r+1]+q)/e,b[d++]=w+x,b[d++]=v,b[d++]=m[r]/e,b[d++]=(m[r+1]+y+q)/e,b[d++]=w,b[d++]=v+y,b[d++]=(m[r]+x)/e,b[d++]=(m[r+1]+y+q)/e,b[d++]=w+x,b[d++]=v+y}return d},L=function(c,b,e,d){var f=0,h=e.length-1,l=e[h];d=Nb[d];var k=[],m=0,n=!0;ma(c,b)&&ma(c+l-1,b+h/l-1)||(n=!1);for(var q=A,r=0;r<h;r++){f==l&&(f=0,b++);if(e[r]){var t=c+f+q*b;d[t]&&(n=!1);if(0<K[t]||Ub[t])n=
!1;k[m++]=t}f++}return[k,n]};L.check=function(c,b,e,d,g,h,l,k){var f=e.length-1;e=e[f];var p=f/e;f=A;l=Nb[l];e+=2;--c;--b;p=e*(p+2);for(var m=0;m<p;m++){var n=c+m%e,q=b+~~(m/e),t=n+q*f;if(0<K[t]||Ub[t]||h&&(n>=g&&n<=g+2||q>=d&&q<=d+2)||!ma(n,q)||l[t]||x[Sa[t]].field||k[t])return!1}return!0};var Ck=function(c,b,e){var d=0,g=e.length-1,h=e[g],l=[],k=[],m=0,n=!0;ma(c,b)&&ma(c+h-1,b+g/h-1)||(n=!1);for(var q=0,r=0;r<g;r++){d==h&&(d=0,b++);var t=c+d+A*b;e[r]?(2<K[t]&&(n=!1),l[m++]=t):(k[q++]=t,2<K[t]&&
(n=!1));d++}return[l,n,k]},qh=function(c,b,e){var d=0,g=e.length-1,h=e[g],l=[],k=0,m=!0;ma(c,b)&&ma(c+h-1,b+g/h-1)||(m=!1);for(var n=0;n<g;n++){d==h&&(d=0,b++);var q=c+d+b*A;if(e[n]&&2<K[q]&&1==x[K[q]].build||0<Sa[q])m=!1;l[k++]=q;d++}return[l,m]},Fg=function(c,b,e){var d=!1,g=0,h=[],l=0,k=e.length-1,m=e[k],n=0,q=!0;ma(c,b)&&ma(c+m-1,b+k/m-1)||(q=!1);for(var r=0;r<k;r++){n==m&&(n=0,b++);if(e[r]){var t=c+n+A*b,w=K[t];2<w&&(q=!1);0<w?g++:d=!0;h[l++]=t}n++}g>.5*(k-1)&&d||(q=!1);return[h,q]},Xe=function(c,
b,e){e=!0;ma(c,b)||(e=!1);1!==Sa[c+b*A]&&(e=!1);return[[c+b*A],e]},X=function(c,b,e){e=!0;ma(c,b)||(e=!1);0<K[c+b*A]&&(e=!1);return[[c+b*A],e]},Gg=function(c,b,e){e=!0;ma(c,b)||(e=!1);0<ld[c+b*A]&&(e=!1);return[[c+b*A],e]},Gb=function(c,b,e){e=!0;ma(c,b)||(e=!1);if(0<Sa[c+b*A]||2==K[c+b*A]||1==K[c+b*A])e=!1;return[[c+b*A],e]},pm=function(c){for(var b=Object.keys(c),e=I.textureSize/1048576,d=0,g=b.length;d<g;d++)c[b[d]].deltaY=512*e},C,z,Qa,$a,wl=function(){C={img:0,x32:-1E3,y32:-1E3,rgb:[0,0,0,.5],
d:0,active:!1};var c=8,b=9;if(!Td){qm();var e=[d.move,d.attack,d.guard,d.patrol,d.pickUp,d.explore,d.stop,d.stand,d.sameSpeed,d.restoreSpeed];We={magic_creatures:[58,40,59,5,78,77,60,130,131,132,89,129]};for(var f=Object.keys(We),g=0,h=f.length;g<h;g++){var l=We[f[g]];b={};l.obj=b;for(var k=0,u=l.length;k<u;b[l[k++]]=1);}Md.mercenaries=[d.mercArcher,d.mercFootman,d.mercMaceman,d.mercLongbowman,d.mercPikeman,d.mercKnight,d.mercArcherAsian,d.mercSamurai,d.mercHourseSamurai,d.mercRonin,d.mercHorseArcher,
d.mercChariot,d.mercFootmanArab,d.mercArcherArab,d.mercMacemanArab,d.mercPikemanArab,d.mercCavalry,d.mercEnichar,d.mercJihad];Md.heroes=[d.mercArcher6,d.mercFootman6,d.mercMaceman6,d.mercLongbowman6,d.mercPikeman6,d.mercKnight6,d.mercArcherAsian6,d.mercSamurai6,d.mercHourseSamurai6,d.mercRonin6,d.mercHorseArcher6,d.mercChariot6,d.mercFootmanArab6,d.mercArcherArab6,d.mercMacemanArab6,d.mercPikemanArab6,d.mercCavalry6,d.mercEnichar6,d.mercJihad6];f=Md.mercenaries;g=0;for(h=f.length;g<h;f[g++].merc=
I.mercenaries);f=Md.heroes;g=0;for(h=f.length;g<h;f[g++].hero=1);l=m;l.build2x2[2]=1;l.build3x3[2]=1;l.build4x4[2]=1;l.build5x5[2]=1;l.build6x6[2]=1;l.items1[2]=1;l.build_harbor[2]=1;l.bridge_horz_build[2]=1;l.bridge_vert_build[2]=1;l.fields[0]=9;l.fields[2]=1;l.sexplosion[0]=13;l.sexplosion[1]=25;l.flame_trail[0]=16;l.flame_trail[1]=25;g=0;for(f=l.asian_charriot.idle.length;g<f;g+=6)l.asian_charriot.idle[4+g]-=17;g=0;for(f=l.asian_charriot.attack.length;g<f;g+=6)l.asian_charriot.attack[4+g]-=17;
g=0;for(f=l.asian_charriot.move.length;g<f;g+=6)l.asian_charriot.move[4+g]-=17;g=0;for(f=l.asian_charriot.die.length;g<f;g+=6)l.asian_charriot.die[4+g]-=17;g=0;for(f=l.flame_trail.length;g<f;g+=6)l.flame_trail[4+g]-=32,l.flame_trail[5+g]-=32;g=0;for(f=l.sexplosion.length;g<f;g+=6)l.sexplosion[4+g]-=48,l.sexplosion[5+g]-=48;l.items1[1]=0;l.books[1]=0;l.potions[1]=0;l.troll.attack[1]=14;l.ork.attack[1]=14;l.dwarf.attack[1]=14;l.asian_mage.move[1]=14;l.arab_priest.attack=l.arab_priest.spell;l.asian_mage.spell=
l.asian_mage.castspell;l.asian_mage.attack=l.asian_mage.castspell;l.asian_mage.spell[1]=13;l.arab_horse_archer.move=l.arab_horse.archer;l.arab_jwarrior.attack[1]=14;l.arab_peasant.attack=l.arab_peasant.attack1;l.arab_peasant.tree=l.arab_peasant.wood;l.asian_peasant.attack=l.asian_peasant.attack1;l.asian_peasant.cut=l.asian_peasant.chop;l.asian_peasant.tree=l.asian_peasant.wood;l.asian_peasant.dig[1]=10;l.asian_peasant.dig[0]=11;l.asian_archer.die[1]=14;l.asian_ronin.attack=l.asian_ronin.attack1;g=
0;for(f=l.asian_peasant.dig.length;g<f;g+=6)l.asian_peasant.dig[4+g]-=16,l.asian_peasant.dig[5+g]-=16;g=0;for(f=l.turn_to_stone.length;g<f;g+=6)l.turn_to_stone[4+g]-=56,l.turn_to_stone[5+g]-=64;l.arab_tcguild_c[4]=31;l.arab_tcguild_c[5]=85;l.dragon.idle=l.dragon.move;l.asian_samurai.attack=l.asian_samurai.attack1;l.asian_horsamurai.idle=l.asian_horsamurai.idle1;l.asian_horsarcher.idle=l.asian_horsarcher.idle2;l.asian_priest.attack=l.asian_priest.attack1;l.asian_priest.spell=l.asian_priest.pray;l.asian_monk.attack[1]=
12;l.euro_mage.attack=l.euro_mage.spell;l.euro_ghost.idle=l.euro_ghost.move;l.euro_priest.attack=l.euro_priest.spell;l.arab_mage.spell=l.arab_mage.attack;l.cursor[1]=15;l.star[1]=15;l.select[4]+=3;l.select[5]+=3;l.arab_houses_c[c]=96;l.asia_houses_c[c]=96;l.asia_houses_c[4]-=9;l.asia_houses_c[5]-=15;l.wood_build[2]=1;l.res_gold[2]=1;l.res_gold_s[2]=1;l.res_stone[2]=1;l.res_stone_s[2]=1;l.bridge_horz1[4]=-9;l.bridge_horz1[5]=132;l.bridge_horz1[4]=-9;l.bridge_horz1[5]=132;l.euro_stable_c[4]+=18;l.euro_stable_c[5]-=
10;l.euro_lumbermill_s[4]-=19;l.euro_lumbermill_s[5]-=17;l.wood_tower_c[4]=0;l.wood_tower_c[5]*=1;l.bat.idle=l.bat.move;l.galleon.idle[1]=7;l.galleon.die[1]=8;l.expl_small_water[1]=11;g=0;for(f=l.curse.length;g<f;g+=6)l.curse[5+g]-=48;g=0;for(f=l.impersonate.length;g<f;g+=6)l.impersonate[5+g]-=48;g=0;for(f=l.bless.length;g<f;g+=6)l.bless[5+g]-=48;g=0;for(f=l.euro_barracks_c.length;g<f;g+=6)l.euro_barracks_c[4+g]+=50;g=0;for(f=l.healing.length;g<f;g+=6)l.healing[5+g]-=48;g=0;for(f=l.expl_small_hole.length;g<
f;g+=6)l.expl_small_hole[4+g]-=4,l.expl_small_hole[5+g]-=34;Date.now();f=[d.createKnight,d.createHorseArcher1,d.createHorseArcher2,d.createHorseSamurai,d.createChariot,d.createEnichar,d.createCavalry];c=Y.size;h=new Float32Array(1048576);u=Bk(m,h,c,0);Y.info=h;Y.ids=u/16;Y.originalLength=Z.length;gc={sword:{name:"Sword",iconID:16,img:m.items1,d:0,dMax:7,attack:1,type:52,sword:1},bow:{name:"Bow",iconID:4,img:m.items1,d:15,dMax:4,attack:1,type:52,sword:1},shield:{name:"Shield",iconID:1,img:m.items1,
d:8,dMax:6,defence:1,type:52,shield:1},potion:{name:"Potion",iconID:11,img:m.potions,d:0,dMax:7,type:52,potion:1},book:{name:"Book",iconID:9,img:m.books,d:0,dMax:4,type:52,book:1},gold:{name:"Gold",iconID:20,img:m.item_gold,d:0,dMax:0,type:52},stone:{name:"Stone",iconID:22,img:m.item_stone,d:0,dMax:0,type:52},food:{name:"Food",iconID:14,img:m.item_food,d:0,dMax:0,type:52},wood:{name:"Wood",iconID:15,img:m.item_tree,d:0,dMax:0,type:52},iron:{name:"Iron",iconID:21,img:m.item_iron,d:0,dMax:0,type:52}};
oi=[gc.sword,gc.potion,gc.book,gc.bow,gc.shield];h=[d.move,d.attack,d.stop,d.stand,d.pickUp,d.explore,d.healing,d.bless];c=[d.attack,d.guard,d.patrol,d.explore,d.stop,d.stand,d.attackGround,d.steady,d.move];k=[d.buildAcademy,d.buildWorkshop,d.buildWorkshop1,d.buildAcademy1,d.buildWorkshop2,d.buildAcademy2];g=[d.buildMerchands1,d.buildMerchands2,d.buildMerchands];$a={euro:{},asia:{},arab:{},common:{}};y=[{name:"Footman",attack:6,defence:3,health:65,maxHealth:65,img:m.euro_footman.idle,attackSound:Ic,
invType:0,invMax:8,validator:X,human:12,iconID:36,time:12,sight:5,url:m.euro_footman,icons:e,cost:[0,0,50,0],attDist:1,spd:50,dieSound:Xa,clss:"footman",size:1,standardFunc:R,radix:0,zLevel:1,strID:"e_footman",race:"euro"},{name:"Pikeman",radix:0,attackSound:Ic,attack:8,defence:4,health:75,maxHealth:75,img:m.euro_pikeman.idle,invType:0,dieSound:Xa,invMax:8,validator:X,human:1,iconID:39,time:18,sight:5,url:m.euro_pikeman,icons:e,cost:[40,0,60,0],attDist:1,spd:50,standardFunc:R,clss:"e_pikeman",zLevel:1,
size:1,strID:"e_pikeman",nu:d.createPikeman,race:"euro"},{name:"Spy",radix:0,attack:20,defence:0,mana:100,manaMax:100,health:50,maxHealth:50,img:m.euro_spy.idle,attackSound:["spy%20kill%201","spy%20kill%202","spy%20kill%203"],invType:0,invMax:8,validator:X,human:1,dieSound:Xa,iconID:41,time:30,sight:12,url:m.euro_spy,icons:[d.move,d.attack,d.guard,d.patrol,d.pickUp,d.explore,d.stop,d.stand,d.impersonate,d.revealSelf],zLevel:1,cost:[120,0,0,0],attDist:1,spd:50,clss:"spy",standardFunc:R,size:1,update:["mana",
"manaSpeed",I.manaRechargeTime],isSpy:1,strID:"spy",nu:d.createSpy,race:"common"},{name:"Maceman",radix:0,attack:8,defence:0,health:120,maxHealth:120,img:m.euro_maceman.idle,attackSound:Ic,invType:0,invMax:8,validator:X,human:1,iconID:37,time:14,dieSound:Xa,sight:5,zLevel:1,url:m.euro_maceman,icons:e,cost:[0,0,120,0],attDist:1,spd:50,clss:"maceman",standardFunc:R,size:1,strID:"e_maceman",nu:d.createMaceman,race:"euro"},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:m.euro_archer1.idle,
invType:0,invMax:8,validator:X,human:1,sight:10,dieSound:Xa,arrow:!0,iconID:38,zLevel:1,time:12,url:m.euro_archer1,icons:e,cost:[0,20,40,0],attDist:7,spd:50,clss:"archer",standardFunc:R,attimg:m.arrow1,attackSound:yd,size:1,strID:"e_archer",nu:d.createArcher,race:"euro"},{radix:0,name:"Wizard",attackSound:jj,dieSound:["mage"],attack:5,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:m.euro_mage.idle,zLevel:1,invType:0,invMax:8,validator:X,human:1,iconID:42,time:30,sight:15,url:m.euro_mage,
icons:[d.stop,d.pickUp,d.explore,d.lightning,d.createBat,d.freeze,d.createGolem,d.invisibility,d.stand,d.attack,d.move],cost:[150,0,0,0],attDist:10,attimg:m.flame_bolt,ball:1,spd:50,clss:"mage",standardFunc:R,size:1,update:["mana","manaSpeed",I.manaRechargeTime],strID:"e_mage",nu:d.createMage,race:"euro"},{radix:0,name:"Longbowman",attack:6,defence:2,health:50,maxHealth:50,img:m.euro_longbowman.idle,zLevel:1,invType:0,invMax:8,dieSound:Xa,attackSound:yd,arrow:!0,validator:X,race:"euro",human:1,iconID:35,
time:18,sight:18,url:m.euro_longbowman,icons:e,cost:[50,0,90,0],attDist:12,spd:50,standardFunc:R,clss:"longbowman",size:1,d2attack:2,strID:"e_longbowman",attimg:m.arrow1,nu:d.createLongbowman},{radix:0,clss:"tree",name:"Tree",health:100,maxHealth:100,img:m.terrain_tree,invType:0,invMax:8,zLevel:1,mMapcolor:[11,131,11],validator:X,child:[{img:m.terrain_tree_s,rgb:[0,0,0,.5],alpha:1,x:0,y:0}],iconID:23,url:m.terrain_tree,dimgInfinity:m.terrain_tree,dimgRND:3,icons:[],res:1,race:"common",build:!0,size:1,
zolotoy:1,strID:"tree"},{radix:0,name:"Crusader",zLevel:1,dieSound:ee,attackSound:ce,attack:14,defence:8,health:180,maxHealth:180,img:m.crus.idle,invType:0,invMax:8,validator:X,human:1,race:"euro",iconID:100,time:19,sight:5,url:m.crus,icons:e,cost:[0,0,0,0],attDist:1,spd:85,standardFunc:R,clss:"crusader",size:1,strID:"crusader"},{radix:0,name:"Priest",attack:20,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:m.euro_priest.idle,invType:0,zLevel:1,invMax:8,validator:X,human:1,iconID:40,time:30,
ball:1,sight:21,dieSound:Xa,url:m.euro_priest,icons:h,attackOnly:We.magic_creatures.obj,cost:[150,0,0,0],attDist:18,race:"euro",spd:50,standardFunc:R,clss:"priest",size:1,update:["mana","manaSpeed",I.manaRechargeTime],strID:"e_priest",nu:d.createPriest,attimg:m.flame_bolt},{radix:0,name:"Peasant",attackSound:jh,attack:5,defence:0,health:50,maxHealth:50,img:m.euro_peasant.idle,invType:0,invMax:8,dieSound:Xa,zLevel:1,validator:X,human:1,race:"euro",iconID:33,time:8,sight:5,url:m.euro_peasant,icons:[d.move,
d.menuBuilds,d.repair,d.conquest,d.dcm,d.pickUp,d.explore,d.stop,d.stand,d.attack,d.bribe,d.sameSpeed,d.restoreSpeed],cost:[0,0,50,0],attDist:1,spd:50,clss:"peon",size:1,peon:1,strID:"e_peon",nu:d.createPeon,nocapture:1},{radix:0,clss:"cathedral",name:"Cathedral",dieSound:P,sound:["e_cathedral1","e_cathedral2"],resistance:700,health:5E3,maxHealth:5E3,img:m.euro_cathedral,invType:0,invMax:8,race:"euro",zLevel:1,validator:L,bimg:m.build5x5,dimg:m.des_5x5,iconID:60,icons:[d.createCrusaders,d.techFanaticism,
d.techEspionage,d.techInquisition,d.techHealing,d.techBless,d.techCrusade,d.techMedicine],time:90,sight:8,child:[{img:m.euro_cathedral_c,x:0,y:0},{img:m.euro_cathedral_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,5]),url:m.euro_cathedral,build:!0,cost:[2E3,0,0,2E3],onbuild:[d.buildChurch],size:1,strID:"cathedral"},{radix:0,name:"Castle",clss:"castle",dieSound:P,sound:["e_castle1"],resistance:700,health:8E3,maxHealth:8E3,img:m.euro_castle,
invType:1,invMax:50,race:"euro",zLevel:1,validator:L,bimg:m.build6x6,dimg:m.des_6x6,iconID:59,time:120,sight:12,child:[{img:m.euro_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:m.euro_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[d.createPeon,d.createSpy,d.emergeAllUnits,d.techFeudalism,d.techArchitecture,d.techLearning],space:new Uint8Array([0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,7]),menu:Pa,url:m.euro_castle,build:!0,cost:[0,1500,0,1500],storage:-1,
castle:!0,population:20,size:1,strID:"e_castle"},{radix:0,name:"Wooden Wall",clss:"wall_wood",resistance:700,health:2E3,maxHealth:2E3,img:m.wood_tower,time:6,sight:1,zLevel:1,dieSound:P,validator:L,bimg:m.wood_build,dimgInfinity:m.wood_debris,iconID:49,icons:[],mx:0,race:"common",my:0,hframe:71,menu:Pa,url:m.wood_tower,space:new Uint8Array([1,1]),wall:1,build:!0,cost:[0,20,0,0],size:1,strID:"woodwall",child:[{img:m.wood_tower_c,x:0,y:0}]},{radix:0,name:"Barracks",clss:"barracks",strID:"e_barrack",
sound:kh,generator:1,resistance:500,health:1400,maxHealth:1400,img:m.euro_barrack,invType:1,invMax:0,dieSound:P,time:60,sight:6,zLevel:1,race:"euro",validator:L,bimg:m.build5x5,dimg:m.des_5x5,child:[{img:m.euro_barracks_c,mv:!0},{img:m.euro_barrack_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:57,icons:[d.createFootman,d.createArcher,d.createMaceman,d.createPikeman,d.createLongbowman,d.createKnight],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:m.euro_barrack,build:!0,
cost:[0,200,0,200],size:1},{radix:0,strID:"e_lumber",name:"Lumber Mill",sound:["e_lumber1"],clss:"lumber_mill",resistance:500,health:800,maxHealth:800,img:m.euro_lumbermill,invType:1,invMax:0,time:30,race:"euro",sight:4,dieSound:P,zLevel:1,validator:L,bimg:m.build2x2,dimg:m.des_2x2,iconID:64,child:[{img:m.euro_lumbermill_c,x:0,y:0},{alpha:!0,img:m.euro_lumbermill_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[d.techLongbow,d.techWoodCutting,d.techCrossbow],space:new Uint8Array([1,1,1,1,2]),hframe:98,url:m.euro_lumbermill,
build:!0,cost:[0,100,0,0],storage:1,size:1},{radix:0,name:"Mage Tower",strID:"e_magetower",sound:["e_magetower1","e_magetower2","e_magetower3"],clss:"magictower",resistance:700,health:5E3,maxHealth:5E3,img:m.euro_magetower,invType:1,invMax:0,time:90,race:"euro",dieSound:P,sight:8,validator:L,bimg:m.build5x5,dimg:m.des_5x5,zLevel:1,child:[{img:m.euro_magetower_c,x:0,y:0},{img:m.euro_magetower_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:71,icons:[d.createMage,d.techBat,d.techInvisibility,d.techLightning,
d.techFreeze,d.techGolem],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.euro_magetower,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,strID:"e_waracademy",name:"Warriors Guild",sound:["e_waracademy1"],clss:"academy",resistance:700,health:5E3,maxHealth:5E3,img:m.euro_waracademy,invType:1,invMax:0,race:"euro",time:90,sight:8,dieSound:P,zLevel:1,validator:L,bimg:m.build6x6,dimg:m.des_6x6,iconID:56,child:[{img:m.euro_waracademy_c,x:0,y:0,mv:!0},{img:m.euro_waracademy_s,x:0,y:0,rgb:[0,
0,0,.5],alpha:!0}],icons:[d.techHeroism,d.techWarfare,d.techMercenaries,d.techSiegeTactics,d.techBodyBuilding,d.techLeadership,d.techTactics,d.techHeroes,d.techHonor,d.techFame],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,5]),url:m.euro_waracademy,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,name:"Storage",strID:"e_storage",sound:["e_storage1","e_storage2"],clss:"storage",resistance:80,health:800,maxHealth:800,img:m.euro_storage,invType:1,invMax:0,time:30,dieSound:P,zLevel:1,
sight:5,validator:L,bimg:m.build4x4,dimg:m.des_4x4,iconID:69,race:"euro",icons:[d.techGoldMining,d.techStoneMining],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:m.euro_storage,storage:0,build:!0,cost:[0,200,0,0],size:1,child:[{img:m.euro_storage_c,x:0,y:0},{img:m.euro_storage_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Knight",strID:"e_knight",dieSound:ee,clss:"knight",attackSound:ce,attack:12,defence:6,health:120,maxHealth:120,img:m.euro_knight.idle,invType:0,zLevel:1,race:"euro",
invMax:8,validator:X,human:1,iconID:43,d2attack:2,time:22,sight:5,url:m.euro_knight,icons:e,cost:[120,0,70,0],attDist:1,spd:85,nu:d.createKnight,standardFunc:R,size:1},{radix:0,name:"Field",clss:"field",strID:"field",instantBuild:1,resistance:80,health:100,maxHealth:100,img:m.fields,invMax:0,validator:qh,zLevel:1,iconID:104,race:"common",icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:m.fields,build:!0,field:1,res:2,cost:[0,200,0,0],rndDirection:9,time:0,sight:1,z32:.5,size:1},{radix:0,name:"Golden rocks",
mMapcolor:[148,148,0],strID:"gold",sound:["mine1"],clss:"golden_rocks",resistance:0,health:8E3,maxHealth:8E3,img:m.res_gold,invMax:0,validator:L,iconID:20,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.res_gold,build:!0,zLevel:1,race:"common",res:0,cost:[0,0,0,0],time:0,sight:2,dieSound:["destroy%20mine"],size:1,zolotoy:1,child:[{img:m.res_gold_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:m.res_gold},{radix:0,name:"Rocks",strID:"stone",mMapcolor:[132,132,132],sound:["mine1"],
clss:"rocks",dieSound:["destroy%20mine"],resistance:0,health:8E3,maxHealth:8E3,img:m.res_stone,invMax:0,validator:L,zLevel:1,iconID:22,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.res_stone,build:!0,res:3,cost:[0,0,0,0],race:"common",time:0,sight:2,size:1,zolotoy:1,child:[{img:m.res_stone_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:m.res_stone},{radix:0,name:"Farm",strID:"e_farm",sound:["e_farm1","e_farm2"],clss:"farm",resistance:0,health:800,maxHealth:800,img:m.euro_farm,
invType:1,invMax:0,zLevel:1,validator:L,bimg:m.build4x4,dimg:m.des_4x4,iconID:61,dieSound:P,race:"euro",icons:[d.createCow,d.techCropRotation,d.techDomestication],space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Pa,url:m.euro_farm,build:!0,cost:[0,200,0,0],time:30,sight:5,storage:2,size:1,child:[{img:m.euro_farm_c,x:0,y:0}]},{radix:0,name:"Merchants Guild",strID:"e_merchant",sound:["merchant"],clss:"merchants_guild",resistance:0,health:5E3,maxHealth:5E3,img:m.euro_tcguild,invType:1,
invMax:0,validator:L,bimg:m.build6x6,zLevel:1,dimg:m.des_6x6,race:"euro",iconID:62,dieSound:P,icons:[d.techMapMaking,d.techTradeRoutes,d.techUsury,d.techSupplyStorage,d.techBribery,d.techTradeTaxes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),menu:Pa,url:m.euro_tcguild,build:!0,time:90,sight:8,cost:[2E3,0,0,2E3],onbuild:[d.buildMarket],size:1,child:[{img:m.euro_tcguild_c,x:0,y:0},{img:m.euro_tcguild_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Church",clss:"church",
strID:"e_church",sound:["e_church1"],resistance:0,health:800,maxHealth:800,img:m.euro_church,invType:1,invMax:0,dieSound:P,validator:L,bimg:m.build3x3,race:"euro",zLevel:1,dimg:m.des_3x3,iconID:139,icons:[d.createPriest],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),menu:Pa,url:m.euro_church,build:!0,cost:[0,0,200,200],time:40,sight:6,size:1,child:[{img:m.euro_church_c,x:0,y:0},{img:m.euro_church_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Blacksmith",clss:"blacksmith",strID:"e_blacksmith",
resistance:0,health:800,maxHealth:800,img:m.euro_blacksmith,invType:1,invMax:0,time:40,zLevel:1,sight:5,dieSound:P,validator:L,bimg:m.build4x4,race:"euro",dimg:m.des_4x4,child:[{img:m.euro_blacksmith_c,x:0,y:0}],iconID:58,icons:[d.techPlateArmor,d.techTemperIron,d.techScaleArmor,d.techHalberd,d.techChainMail],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Pa,url:m.euro_blacksmith,build:!0,cost:[0,0,200,200],onbuild:k,size:1},{radix:0,name:"Cow",clss:"cow",nu:d.createCow,race:"common",
strID:"cow",attack:0,defence:3,health:50,maxHealth:50,img:m.cow.idle,invType:0,invMax:8,zLevel:1,validator:X,iconID:99,time:20,dieSound:["cowdie1","cowdie2","cowdie3","cowdie4"],url:m.cow,icons:[d.move,d.stop],sight:3,cost:[0,0,300,0],attDist:0,spd:32,res:2,food:300,milk:50,milkMax:I.milkMax,foodMax:I.foodMax,size:1,cow:1,update:["milk","milkSpeed",I.milkRechargeTime,"food","cowSpeed",I.cowRechargeTime]},{radix:0,name:"Stable",sound:["e_stables1"],clss:"stable",strID:"e_stable",onlyRequired:1,resistance:0,
health:800,maxHealth:800,invType:1,invMax:0,race:"euro",zLevel:1,validator:L,bimg:m.build4x4,dimg:m.des_4x4,iconID:68,dieSound:P,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.euro_stables,build:!0,cost:[0,200,0,0],onbuild:f,size:1,time:40,sight:5,img:m.euro_stables,nu:d.createCow,child:[{img:m.euro_stable_c,x:0,y:0}]},{radix:0,name:"Workshop",sound:["e_workshop1"],clss:"workshop",strID:"e_workshop",zLevel:1,resistance:0,health:800,maxHealth:800,img:m.euro_workshop,invType:1,invMax:0,
dieSound:P,validator:L,bimg:m.build4x4,race:"euro",dimg:m.des_4x4,iconID:75,icons:[d.createCatapult,d.createHeavyCatapult,d.createBallist,d.techEngineering,d.techCannonTower],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:m.euro_workshop,build:!0,cost:[0,200,200,0],size:1,time:40,sight:5,child:[{img:m.euro_workshop_c,x:0,y:0}]},{radix:0,name:"Tavern",sound:["e_tavern1"],clss:"tavern",strID:"e_tavern",dieSound:P,resistance:0,health:1E3,maxHealth:1E3,img:m.euro_tavern,invType:1,invMax:0,
validator:L,race:"euro",bimg:m.build4x4,dimg:m.des_4x4,zLevel:1,iconID:70,icons:[d.createMercenaries,d.createHeroes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4]),url:m.euro_tavern,build:1,cost:[0,200,200,0],onbuild:g,actvintv:[d.iniMercenaries,d.iniHeroes],size:1,time:40,sight:5,child:[{img:m.euro_tavern_c,x:0,y:0}]},{name:"House",sound:["house1","house2","house3","house4","house5"],clss:"house",strID:"e_house",resistance:0,health:500,maxHealth:500,img:m.euro_houses,invType:1,invMax:0,
validator:L,bimg:m.build3x3,dimg:m.des_3x3,race:"euro",iconID:73,zLevel:1,dieSound:P,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:m.euro_houses,build:!0,cost:[0,75,0,0],population:10,size:1,time:20,sight:4,child:[{img:m.euro_houses_c,x:0,y:0}]},{name:"Watch Tower",attackSound:zf,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),clss:"watch_tower",strID:"watch_tower",attack:7,health:400,maxHealth:400,img:m.euro_tower_wood_2,state:0,invType:1,race:"common",invMax:0,zLevel:1,dieSound:P,
level:0,validator:L,child:[{img:m.euro_tower_wood_2_c,x:0,y:0},{alpha:!0,img:m.euro_tower_wood_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attimg:m.arrow1,attDist:8,bimg:m.build2x2,dimg:m.des_2x2,iconID:53,icons:[d.attack,d.stop,d.upgradeGuildTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_wood_2,build:!0,cost:[0,300,0,0],size:1,arrow:!0,time:10,sight:15,standardFunc:R},{name:"Market",sound:["e_market1"],clss:"market",strID:"e_market",resistance:0,health:1400,maxHealth:1400,img:m.euro_market,invType:1,
invMax:0,dieSound:P,zLevel:1,validator:L,bimg:m.build4x4,dimg:m.des_4x4,iconID:65,race:"euro",icons:[d.createCaravan],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,4]),url:m.euro_market,build:!0,cost:[0,200,200,0],size:1,time:60,sight:8,child:[{img:m.euro_market_c,x:0,y:0}]},{name:"Outpost",sound:["e_outpost1"],clss:"outpost",strID:"e_outpost",zLevel:1,resistance:0,health:2E3,maxHealth:2E3,img:m.euro_outpost,invType:1,dieSound:P,invMax:50,validator:L,race:"euro",bimg:m.build4x4,dimg:m.des_4x4,
iconID:66,icons:[d.emergeAllUnits],space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,4]),url:m.euro_outpost,build:!0,cost:[0,200,0,400],size:1,child:[{img:m.euro_outpost_c,x:0,y:0},{img:m.euro_outpost_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{name:"Bridge",clss:"bridge",strID:"bridge",resistance:0,health:1E4,maxHealth:1E4,img:m.bridge_horz,invMax:0,valid2:!0,validator:Ck,bimg:m.bridge_horz_build,race:"common",zLevel:1,dieSound:P,child:[{alpha:!0,img:m.bridge_horz_s,x:0,y:0,rgb:[0,
0,0,.5]},{img:m.bridge_horz1,x:0,y:0,z:6}],time:22,sight:1,dimg:m.bridge_horz_demol,iconID:44,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,11]),url:m.bridge_horz,build:!0,cost:[0,200,0,400],size:1},{name:"Dummy",clss:"dummy",strID:"dummy",resistance:0,health:5E3,maxHealth:5E3,img:m.dummy1,invMax:0,validator:X,bimg:m.dummy1_b,iconID:165,icons:[],mx:0,zLevel:1,
my:16,hframe:65,race:"common",url:m.dummy1,dimg:m.dummy1_d,build:!0,cost:[0,300,0,0],dummy:!0,child:[{img:m.dummy1_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:10,sight:1},{name:"Catapult",strID:"catapult",dieSound:Bf,clss:"catapult",attackSound:Af,defence:0,attack:10,health:110,maxHealth:110,img:m.catapult.idle,invMax:0,radix:0,validator:X,iconID:30,time:30,sight:20,race:"common",url:m.catapult,level:0,zLevel:1,icons:c,cost:[0,600,0,0],nofreeze:1,arrow:!1,attDist:17,spd:40,standardFunc:R,size:1,attimg:m.cat_stone,
space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:d.createCatapult},{name:"Ballista",radix:0,strID:"ballista",attackSound:Af,dieSound:Bf,clss:"ballista",defence:0,attack:60,health:75,maxHealth:75,img:m.ballista.idle,invMax:0,validator:X,iconID:31,time:30,sight:16,nofreeze:1,race:"common",zLevel:1,url:m.ballista,icons:c,cost:[0,800,0,0],attDist:13,spd:40,standardFunc:R,size:1,attimg:m.arrow_ballista1,space:new Uint8Array([1,1,1,1,2]),attackDeg:30,nu:d.createBallist},{name:"Heavy Catapult",strID:"heavy_catapult",
attackSound:Af,defence:0,attack:25,health:250,maxHealth:250,img:m.h_catapult.idle,invMax:0,radix:0,validator:X,iconID:45,time:60,dieSound:Bf,sight:26,race:"common",url:m.h_catapult,zLevel:1,icons:c,standardFunc:R,cost:[0,1200,0,0],attDist:22,spd:40,nofreeze:1,clss:"heavy_catapult",size:1,attimg:m.cb_metal,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:d.createHeavyCatapult},{radix:0,name:"Ghost",strID:"ghost",defence:0,attack:8,health:60,maxHealth:60,img:m.euro_ghost.idle,invType:0,invMax:8,dieSound:["ghost1",
"ghost2"],validator:X,iconID:178,zLevel:1,race:"common",time:15,attackSound:ij,sight:5,standardFunc:R,url:m.euro_ghost,icons:e,w:1,cost:[40,0,0,0],attDist:1,spd:80,clss:"ghost",size:1,nu:d.createGhost},{name:"Harbor",strID:"e_harbor",resistance:80,health:800,maxHealth:800,img:m.euro_harbor,invType:1,invMax:0,validator:Fg,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:m.build_harbor,dimg:m.des_harbor,zLevel:1,race:"euro",dieSound:P,iconID:63,icons:[d.createFishingBoat,d.createXebec,d.createHulk,
d.createGalleon,d.techLandingTactics],clss:"harbor",url:m.euro_harbor,storage:4,build:!0,cost:[0,200,200,0],child:[{img:m.euro_harbor_c,x:0,y:0},{img:m.euro_harbor_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{radix:0,name:"Messiah",strID:"messiah",attack:50,defence:10,mana:1E3,manaMax:1E3,health:1E3,maxHealth:1E3,img:m.messiah.idle,invType:0,invMax:0,race:"common",validator:X,human:1,iconID:169,zLevel:1,attackSound:["messiah_attack"],dieSound:["messiah"],time:300,sight:26,url:m.messiah,standardFunc:R,
icons:e,cost:[2E3,0,0,0],attDist:10,spd:50,clss:"messiah",size:1,update:["mana","manaSpeed",I.manaRechargeTime]},{name:"Magic Gateway",sound:["gateway"],strID:"gateway",magicGateway:1,resistance:0,health:Infinity,maxHealth:Infinity,img:m.teleport,invMax:0,validator:L,bimg:m.build4x4,zLevel:1,dieSound:P,race:"common",iconID:180,clss:"magic_gateway",icons:[d.createOrk,d.createDwarf,d.createGhost,d.createSkeleton],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,5]),url:m.teleport,
build:!0,cost:[0,0,0,0],size:1,time:10,sight:10,zolotoy:1,child:[{img:m.teleport_c,x:0,y:0},{alpha:!0,img:m.teleport_s,x:0,y:0,rgb:[0,0,0,.5]}],standardFunc:Nl},{name:"Guard Tower",strID:"guard_tower",race:"common",clss:"guard_tower",attackSound:zf,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:12,health:1E3,maxHealth:1E3,img:m.euro_tower_wood,state:0,invType:1,invMax:0,dieSound:P,zLevel:1,validator:L,child:[{img:m.euro_tower_wood_c,x:0,y:0},{alpha:!0,img:m.euro_tower_wood_s,x:0,y:0,
rgb:[0,0,0,.5]}],attDist:12,bimg:m.build2x2,dimg:m.des_2x2,iconID:52,icons:[d.attack,d.stop,d.upgradeStoneTower,d.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_wood,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:m.arrow1,time:35,sight:16,standardFunc:R},{name:"Sword",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:Gb,iconID:16,url:m.items1,icons:[],cost:[0,0,0,0],size:1,zLevel:0,z32:.5,radix:0,race:"common",item:1},{name:"Bow",attack:0,
defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:Gb,iconID:4,url:m.items1,icons:[],cost:[0,0,0,0],size:1,z32:.5,zLevel:0,radix:0,race:"common",item:1},{name:"Shield",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:Gb,iconID:1,url:m.items1,icons:[],cost:[0,0,0,0],zLevel:0,race:"common",radix:0,size:1,z32:.5,item:1},{name:"Potion",attack:0,defence:0,health:25,maxHealth:25,img:m.potions,state:0,invMax:0,validator:Gb,iconID:11,url:m.potions,icons:[],
radix:0,race:"common",zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Book",attack:0,defence:0,health:25,maxHealth:25,img:m.book1,state:0,invMax:0,validator:Gb,iconID:9,zLevel:0,race:"common",radix:0,url:m.books,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Gold",health:1,maxHealth:1,img:m.item_gold,invMax:0,validator:Gb,iconID:20,radix:0,race:"common",zLevel:0,url:m.item_gold,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Stone",health:1,maxHealth:1,img:m.item_stone,invMax:0,validator:Gb,
iconID:22,race:"common",radix:0,url:m.item_stone,zLevel:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Food",health:15,maxHealth:15,img:m.item_food,invMax:0,mMapcolor:[0,255,255],validator:Gb,iconID:14,url:m.item_food,radix:0,race:"common",icons:[],zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{ignore:1,name:"Wood",health:1,maxHealth:1,img:m.item_wood,invMax:0,validator:Gb,iconID:15,url:m.item_wood,icons:[],race:"common",radix:0,zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Iron",health:1,
maxHealth:1,img:m.item_iron,invMax:0,validator:Gb,iconID:21,zLevel:0,race:"common",url:m.item_iron,radix:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Keep Tower",strID:"keep_tower",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:16,health:2E3,maxHealth:2E3,img:m.euro_tower_stone,state:0,invType:1,zLevel:1,attackSound:zf,invMax:0,dieSound:P,validator:L,clss:"keep_tower",race:"common",child:[{alpha:!0,img:m.euro_tower_stone_s,x:0,y:0,rgb:[0,0,0,.5]},{img:m.euro_tower_stone_c,
x:0,y:0}],attDist:14,bimg:m.build2x2,dimg:m.des_2x2,standardFunc:R,iconID:54,icons:[d.attack,d.stop,d.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_stone,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:m.arrow_big1,time:40,sight:18},{name:"Cannon Tower",clss:"tower_stone2",strID:"tower_stone2",attackSound:de,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:40,health:2500,maxHealth:2500,img:m.euro_tower_stone_2,state:0,invType:1,invMax:0,dieSound:P,race:"common",
validator:L,zLevel:1,child:[{img:m.euro_tower_stone_2_c,x:0,y:0},{alpha:!0,img:m.euro_tower_stone_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:10,bimg:m.build2x2,dimg:m.des_2x2,iconID:54,icons:[d.attack,d.stop],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_stone_2,build:!0,cost:[0,600,0,0],standardFunc:R,size:1,arrow:!1,attimg:m.hot_cannon,time:45,sight:18,attackDeg:30},{name:"Rocket Tower",strID:"tower_rocket",race:"asia",clss:"tower_rocket",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),zLevel:1,
attack:30,health:1400,maxHealth:1400,img:m.rocket_tower,state:0,invType:1,invMax:0,dieSound:P,validator:L,child:[{img:m.rocket_tower_c},{alpha:!0,img:m.rocket_tower_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:20,bimg:m.build2x2,dimg:m.des_2x2,iconID:186,icons:[],space:new Uint8Array([1,1,1,1,2]),url:m.rocket_tower,build:!0,cost:[0,600,0,0],standardFunc:R,size:1,arrow:!0,attimg:m.arrow_big1,time:60,sight:26},{radix:0,name:"Ork",race:"common",strID:"ork",dieSound:["orc%20die%201","orc%20die%202"],attackSound:hj,
attack:18,defence:2,health:75,maxHealth:75,img:m.ork.idle,invType:0,invMax:8,validator:X,zLevel:1,iconID:143,time:12,sight:5,url:m.ork,standardFunc:R,icons:e,cost:[60,0,0,0],attDist:1,spd:50,clss:"ork",size:1,nu:d.createOrk},{radix:0,name:"Dwarf",race:"common",attack:7,defence:7,health:120,maxHealth:120,img:m.dwarf.idle,invType:0,strID:"dwarf",invMax:8,zLevel:1,dieSound:Xa,validator:X,iconID:185,time:12,sight:3,url:m.dwarf,standardFunc:R,icons:e,cost:[80,0,0,0],attDist:1,spd:50,clss:"dwarf",size:1,
nu:d.createDwarf},{radix:0,name:"Skeleton",strID:"skeleton",race:"common",dieSound:["skeleton%20die%201","skeleton%20die%202","skeleton%20die%203","skeleton%20die%204"],attack:4,defence:0,health:40,maxHealth:40,img:m.skeleton.idle,invType:0,zLevel:1,attackSound:Ic,invMax:8,nofreeze:1,validator:X,iconID:167,time:12,sight:3,url:m.skeleton,standardFunc:R,icons:e,cost:[0,0,30,0],attDist:1,spd:50,clss:"skeleton",size:1,nu:d.createSkeleton},{radix:0,name:"Caravan",race:"euro",strID:"e_caravan",attack:0,
defence:0,health:350,maxHealth:350,img:m.caravan.idle,invType:1,invMax:8,validator:X,iconID:34,zLevel:1,time:50,sight:7,url:m.caravan,icons:[d.move,d.trade,d.explore,d.stop,d.stand,d.unload],cost:[0,200,400,0],attDist:1,spd:75,clss:"caravan",size:1,nu:d.createCaravan},{name:"Castle",health:8E3,maxHealth:8E3,img:m.asia_castle,invType:1,strID:"a_castle",zLevel:1,race:"asia",invMax:50,validator:L,bimg:m.build6x6,dimg:m.des_6x6,iconID:164,time:120,sight:12,dieSound:P,clss:"castle",child:[{img:m.asia_castle_c,
x:0,y:0,mv:!0},{alpha:!0,img:m.asia_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[d.createPeon1,d.createNinja,d.emergeAllUnits,d.techFeudalism,d.techArchitecture,d.techLearning,d.techBuddhism,d.techGreatWall],space:new Uint8Array([0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,8]),menu:Pa,url:m.asia_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{name:"Castle",dieSound:P,clss:"castle",strID:"r_castle",
race:"arab",health:8E3,maxHealth:8E3,img:m.arab_castle,invType:1,invMax:50,validator:L,bimg:m.build6x6,dimg:m.des_6x6,zLevel:1,iconID:97,time:120,sight:12,child:[{img:m.arab_castle_c}],icons:[d.createPeon2,d.createSpy,d.emergeAllUnits,d.techFeudalism,d.techArchitecture,d.techLearning,d.techSlavery],space:new Uint8Array([0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,,8]),menu:Pa,url:m.arab_castle,build:!0,cost:[0,1500,
0,1500],storage:-1,castle:!0,population:20,size:1},{radix:0,name:"Peasant",attack:5,defence:0,health:50,maxHealth:50,img:m.asian_peasant.idle,invType:0,invMax:8,attackSound:jh,race:"asia",validator:X,human:1,strID:"a_peon",iconID:132,dieSound:Xa,zLevel:1,time:8,peon:1,sight:5,url:m.asian_peasant,icons:[d.move,d.menuBuilds1,d.repair,d.conquest,d.dcm,d.pickUp,d.explore,d.stop,d.stand,d.attack,d.sameSpeed,d.restoreSpeed],cost:[0,0,40,0],attDist:1,spd:50,clss:"peon",nocapture:1,size:1},{radix:0,name:"Ninja",
race:"asia",attack:12,defence:5,mana:100,manaMax:100,health:90,maxHealth:90,img:m.asian_ninja.idle,invType:0,invMax:8,attackSound:Ic,validator:X,human:1,iconID:133,strID:"ninja",dieSound:Xa,zLevel:1,time:20,standardFunc:R,sight:10,url:m.asian_ninja,icons:[d.guard,d.patrol,d.pickUp,d.explore,d.stop,d.stand,d.invisibility,d.murder,d.move,d.attack,d.sameSpeed,d.restoreSpeed],cost:[120,0,0,0],attDist:1,spd:85,clss:"ninja",size:1,update:["mana","manaSpeed",I.manaRechargeTime]},{radix:0,name:"Ronin",attack:7,
defence:0,health:45,maxHealth:45,img:m.asian_ronin.idle,invType:0,invMax:8,race:"asia",validator:X,human:1,standardFunc:R,iconID:141,strID:"ronin",dieSound:Xa,zLevel:1,time:8,sight:5,url:m.asian_ronin,icons:e,cost:[0,0,40,0],attDist:1,spd:50,attackSound:Ic,clss:"a_footman",size:1},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:m.asian_archer.idle,invType:0,invMax:8,race:"asia",validator:X,human:1,strID:"a_archer",dieSound:Xa,zLevel:1,attimg:m.arrow1,iconID:136,arrow:1,attackSound:yd,
time:12,sight:10,url:m.asian_archer,icons:e,cost:[0,20,40,0],standardFunc:R,spd:50,clss:"archer",size:1,attDist:6},{radix:0,name:"Samurai",attack:10,defence:4,health:90,maxHealth:90,img:m.asian_samurai.idle,invType:0,race:"asia",strID:"samurai",invMax:8,attackSound:Ic,validator:X,human:1,iconID:142,time:20,standardFunc:R,zLevel:1,dieSound:Xa,sight:6,url:m.asian_samurai,icons:e,cost:[50,0,150,0],attDist:1,spd:50,clss:"a_maceman",size:1},{radix:0,name:"Horse Archer",attack:7,defence:0,health:75,maxHealth:75,
img:m.asian_horsarcher.idle,invType:0,race:"asia",invMax:8,validator:X,human:1,attackSound:yd,iconID:183,strID:"a_horse_archer",dieSound:ee,time:20,standardFunc:R,sight:12,url:m.asian_horsarcher,zLevel:1,icons:e,arrow:1,attimg:m.arrow1,cost:[40,0,120,0],spd:85,clss:"horse_archer",size:1,attDist:7},{radix:0,name:"Horse Samurai",attack:14,defence:4,health:160,maxHealth:160,img:m.asian_horsamurai.idle,invType:0,invMax:8,validator:X,human:1,iconID:135,race:"asia",standardFunc:R,attackSound:ce,time:22,
zLevel:1,strID:"horse_samurai",dieSound:ee,sight:5,url:m.asian_horsamurai,icons:e,cost:[75,0,120,0],attDist:1,spd:85,clss:"horse_samurai",size:1},{name:"Barracks",resistance:500,health:1400,maxHealth:1400,img:m.asia_barracks,invType:1,sound:kh,invMax:0,time:60,dieSound:P,radix:0,sight:6,race:"asia",strID:"a_barrack",validator:L,zLevel:1,bimg:m.build5x5,dimg:m.des_5x5,child:[{img:m.asia_barracks_c,x:0,y:0,mv:!0},{img:m.asia_barracks_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:146,icons:[d.createRonin,
d.createArcher1,d.createSamurai,d.createHorseArcher1,d.createHorseSamurai,d.createChariot],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:m.asia_barracks,build:!0,cost:[0,200,0,200],size:1,clss:"barracks"},{name:"Chariot",attack:4,defence:3,health:180,maxHealth:180,img:m.asian_charriot.idle,invType:0,radix:0,race:"asia",invMax:8,strID:"chariot",dieSound:["c%20die%201","c%20die%202","c%20die%203","c%20die%204","c%20die%205"],attackSound:ce,validator:X,human:1,zLevel:1,
iconID:175,standardFunc:R,time:8,sight:5,url:m.asian_charriot,icons:e,cost:[0,200,150,0],attDist:1,spd:85,clss:"chariot",size:1},{radix:1,name:"Galleon",attackSound:de,attack:35,attDist:12,race:"common",defence:0,health:1200,attackTime:2E3,maxHealth:1200,strID:"galleon",nu:d.createGalleon,img:m.galleon.idle,invType:1,invMax:24,dieSound:["ship%20sink"],zLevel:0,validator:Xe,iconID:32,time:50,boat:!0,attimg:m.cb_metal,attackDeg:20,sight:16,url:m.galleon,icons:[d.move,d.explore,d.unload,d.attack,d.attackGround,
d.stop,d.stand,d.stop,d.stand,d.attack,d.steady,d.upgradeShip],cost:[0,1200,800,0],spd:50,nofreeze:1,clss:"galleon",standardFunc:R,size:1,peon:1},{radix:1,name:"Fishing Boat",attackSound:de,attack:0,attDist:8,race:"common",defence:0,health:50,boat:!0,nu:d.createFishingBoat,maxHealth:50,img:m.boat.idle,invType:1,invMax:0,strID:"fishing_boat",dieSound:["ship%20sink"],zLevel:0,validator:Xe,iconID:184,nofreeze:1,time:50,sight:16,url:m.boat,icons:[d.move,d.explore,d.stop,d.stand,d.fishing],cost:[0,200,
100,0],spd:65,clss:"fishing_boat",size:1},{radix:1,name:"Hulk",attackSound:de,attack:18,attDist:10,race:"common",defence:0,health:700,maxHealth:700,strID:"hulk",img:m.hulk.idle,invType:1,attackTime:2E3,boat:!0,nu:d.createHulk,attackDeg:20,invMax:16,dieSound:["ship%20sink"],zLevel:0,validator:Xe,iconID:128,time:30,sight:14,attimg:m.cb_metal,url:m.hulk,icons:[d.move,d.explore,d.unload,d.attack,d.attackGround,d.stop,d.stand,d.stop,d.stand,d.attack,d.steady,d.upgradeShip],cost:[0,500,300,0],spd:65,nofreeze:1,
clss:"hulk",standardFunc:R,size:1},{radix:1,name:"Pinque",attackSound:yd,attack:10,race:"common",attDist:8,defence:0,health:300,boat:!0,maxHealth:300,img:m.xebec.idle,attimg:m.arrow1,arrow:!0,strID:"pinque",invType:1,invMax:8,dieSound:["ship%20sink"],zLevel:0,validator:Xe,iconID:129,time:20,nofreeze:1,sight:12,url:m.xebec,icons:[d.move,d.explore,d.unload,d.attack,d.attackGround,d.stop,d.stand,d.stop,d.stand,d.attack,d.steady,d.upgradeShip],cost:[0,300,200,0],spd:80,clss:"xebec",size:1,standardFunc:R,
nu:d.createXebec},{radix:0,name:"Stone Golem",strID:"troll",defence:3,attack:25,health:400,maxHealth:400,img:m.troll.idle,invType:0,invMax:0,dieSound:["golem"],validator:X,iconID:144,race:"common",zLevel:1,nofreeze:1,attackSound:["golem1","golem2"],sight:10,standardFunc:R,url:m.troll,icons:e,w:1,cost:[120,0,0,0,600],attDist:1,spd:56,clss:"troll",size:1},{radix:0,name:"Bat",strID:"bat",defence:0,attack:3,health:20,maxHealth:20,img:m.bat.move,invType:0,invMax:0,race:"common",bat:1,dieSound:["bat%20die"],
validator:Gg,iconID:105,zLevel:2,attackSound:["bat%20attack"],sight:10,standardFunc:R,url:m.bat,icons:e,w:1,cost:[0,0,0,0,25],attDist:1,spd:128,clss:"bat",size:1,z32:1.5},{race:"arab",invType:0,invMax:8,iconID:138,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_peasant,img:m.arab_peasant.idle,spd:50,validator:X,human:1,icons:[d.move,d.menuBuilds2,d.repair,d.conquest,d.dcm,d.pickUp,d.explore,d.stop,d.stand,d.attack,d.convertJihad,d.bribe,d.sameSpeed,d.restoreSpeed],name:"Peasant",clss:"peon",
cost:[0,0,50,0],attDist:1,time:8,nocapture:1,peon:1,sight:5,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:172,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_footman,img:m.arab_footman.idle,standardFunc:R,spd:50,validator:X,human:1,attDist:1,icons:e,name:"Footman",clss:"footman",cost:[0,0,50,0],time:12,sight:5,health:50,attack:6,defence:1},{race:"arab",invType:0,invMax:8,iconID:170,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_archer,img:m.arab_archer.idle,
spd:50,validator:X,standardFunc:R,human:1,attimg:m.arrow1,arrow:1,icons:e,name:"Archer",clss:"archer",cost:[0,20,40,0],time:12,sight:10,attDist:6,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:173,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_spearman,img:m.arab_spearman.idle,spd:50,validator:X,standardFunc:R,human:1,icons:e,name:"Spearman",clss:"pikeman",attDist:1,cost:[40,0,60,0],time:14,sight:5,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,
iconID:174,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,standardFunc:R,url:m.arab_satrap,img:m.arab_satrap.idle,spd:50,validator:X,human:1,icons:e,name:"Satrap",attDist:1,clss:"maceman",cost:[0,0,120,0],time:14,sight:5,health:120,attack:8,defence:0},{race:"arab",invType:0,invMax:8,iconID:171,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_cavalry,standardFunc:R,img:m.arab_cavalry.idle,spd:85,validator:X,human:1,attDist:1,icons:e,name:"Cavalry",clss:"heavy_cavalry",cost:[60,0,100,
0],time:14,sight:5,health:90,attack:10,defence:4},{race:"arab",invType:0,invMax:8,iconID:168,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_horse_archer,img:m.arab_horse_archer.idle,spd:85,validator:X,human:1,standardFunc:R,icons:e,name:"Horse Archer",clss:"horse_archer",cost:[50,0,100,0],time:14,attimg:m.arrow1,arrow:1,sight:12,attDist:7,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:179,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_jwarrior,img:m.arab_jwarrior.idle,
spd:50,validator:X,human:1,standardFunc:R,icons:e,name:"Jihad warrior",attDist:1,clss:"jihad_warrior",cost:[0,0,100,0],time:8,sight:5,health:75,attack:10,defence:2},{race:"arab",invType:0,invMax:8,iconID:176,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_priest,img:m.arab_priest.idle,standardFunc:R,spd:50,mana:100,validator:X,human:1,icons:h,name:"Priest",clss:"priest",cost:[150,0,0,0],time:30,sight:21,attDist:18,health:60,attack:20,update:["mana","manaSpeed",I.manaRechargeTime],manaMax:100,
defence:0,attimg:m.flame_bolt,ball:1,attackOnly:We.magic_creatures.obj},{race:"arab",invType:0,invMax:0,iconID:105,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:0,img:0,testing:1,illegal:1,spd:50,validator:X,human:1,icons:[],name:"Spy",clss:"spy",cost:150,time:30,sight:12,health:50,attack:20,defence:0},{race:"arab",invType:0,invMax:8,iconID:188,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,attimg:m.flame_bolt,url:m.arab_mage,img:m.arab_mage.idle,spd:50,validator:X,human:1,icons:[d.stop,
d.pickUp,d.explore,d.createCarpet,d.createJinn,d.fireRain,d.magicVision,d.raiseDead,d.attack,d.stand,d.move],standardFunc:R,name:"Mage",clss:"mage",ball:1,mana:100,manaMax:100,update:["mana","manaSpeed",I.manaRechargeTime],cost:[150,0,0,0],time:30,sight:15,attDist:10,health:60,attack:8,defence:0},{race:"arab",invType:1,invMax:8,iconID:126,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_caravan,img:m.arab_caravan.idle,spd:75,validator:X,human:1,icons:[],name:"Caravan",clss:"trader",cost:[0,
0,500,0],time:30,sight:5,health:150},{race:"arab",invType:0,invMax:8,iconID:177,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_enichar,img:m.arab_enichar.idle,spd:85,validator:X,human:1,standardFunc:R,icons:e,name:"Enichar",attDist:1,clss:"enichar",cost:[80,0,120,0],time:25,sight:5,health:130,attack:18,defence:4},{race:"arab",invType:1,invMax:0,iconID:82,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,population:10,url:m.arab_houses,
validator:L,build:1,icons:[],child:[{img:m.arab_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],time:20,sight:4,resistance:50,health:500},{race:"arab",invType:1,invMax:0,iconID:85,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_lumbermill,validator:L,build:1,icons:[d.techWoodCutting,d.techCrossbow],child:[{img:m.arab_lumbermill_c}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],storage:1,time:30,sight:4,resistance:80,health:800},
{race:"arab",invType:1,invMax:0,iconID:96,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_storage,validator:L,build:1,storage:0,icons:[d.techGoldMining,d.techStoneMining],child:[{img:m.arab_storage_c},{alpha:!0,img:m.arab_storage_s,rgb:[0,0,0,.5]}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:80,zLevel:1,dieSound:P,space:new Uint8Array([1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_farm,validator:L,build:1,icons:[d.createCow,d.techCropRotation,d.techDomestication,d.techCowPoaching,d.ridingHorses,d.techHorseManShip],child:[{img:m.arab_farm_c}],name:"Farm",storage:2,clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:81,zLevel:1,dieSound:P,validator:Fg,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:m.build_harbor,dimg:m.des_harbor,
radix:0,url:m.arab_harbour,build:1,icons:[d.createFishingBoat,d.createXebec,d.createHulk,d.techLandingTactics],child:[{img:m.arab_harbour_c},{alpha:!0,img:m.arab_harbour_s,rgb:[0,0,0,.5]}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:79,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_blacksmith,validator:L,build:1,icons:[d.techTemperIron,d.techScaleArmor,
d.techScimitar,d.techChainMail,d.techHalberd],child:[{img:m.arab_blacksmith_c},{alpha:!0,img:m.arab_blacksmith_s,rgb:[0,0,0,.5]}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],onbuild:k,time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:95,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_workshop,validator:L,build:1,icons:[d.createCatapult,d.createBallist,d.techEngineering,d.techCannonTower],
child:[{img:m.arab_workshop_c},{alpha:!0,img:m.arab_workshop_s,rgb:[0,0,0,.5]}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:140,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_church,validator:L,build:1,icons:[d.createPriest2],child:[{img:m.arab_church_c},{alpha:!0,img:m.arab_church_s,rgb:[0,0,0,.5]}],name:"Church",clss:"church",cost:[0,0,200,200],
time:40,sight:6,resistance:200,health:1E3},{race:"arab",invType:1,invMax:0,iconID:92,zLevel:1,dieSound:P,space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_tavern,validator:L,build:1,icons:[d.createMercenaries,d.createHeroes],child:[{img:m.arab_tavern_c}],name:"Tavern",clss:"tavern",cost:[0,200,200,0],onbuild:g,actvintv:[d.iniMercenaries,d.iniHeroes],time:40,sight:5,resistance:150,health:1E3},{race:"arab",invType:1,invMax:0,iconID:87,zLevel:1,
dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_market,validator:L,build:1,icons:[d.createCaravan2],child:[{img:m.arab_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:98,zLevel:1,dieSound:P,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_barracks,validator:L,
build:1,icons:[d.createFootman2,d.createArcher2,d.createSatrap,d.createPikeman2,d.createHorseArcher2,d.createCavalry,d.createEnichar,d.createJihad],child:[{img:m.arab_barracks_c},{alpha:!0,img:m.arab_barracks_s,rgb:[0,0,0,.5]}],name:"Barracks",clss:"barrack",cost:[0,0,200,200],time:60,sight:6,resistance:500,health:1400},{race:"arab",invType:1,invMax:0,iconID:91,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_stables,validator:L,
build:1,icons:[],child:[{img:m.arab_stables_c}],name:"Stable",clss:"stable",cost:[0,200,200,0],time:40,onbuild:f,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:50,iconID:89,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_outpost,validator:L,build:1,icons:[d.emergeAllUnits],child:[{img:m.arab_outpost_c,mv:1},{alpha:!0,img:m.arab_outpost_s,rgb:[0,0,0,.5]}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],
time:60,sight:8,resistance:500,health:2E3},{race:"arab",invType:1,invMax:0,iconID:105,zLevel:1,dieSound:P,space:23213123,bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:0,img:0,validator:L,build:1,icons:[],child:[{img:3213123}],name:"NULL",testing:1,clss:"castle",cost:[0,1500,0,1500],time:120,sight:12,resistance:1E3,health:8E3},{race:"arab",invType:1,invMax:0,iconID:88,zLevel:1,dieSound:P,space:new Uint8Array([0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,6]),bimg:m.build5x5,
dimg:m.des_5x5,radix:0,url:m.arab_mosque,validator:L,build:1,icons:[d.techFanaticism,d.techEspionage,d.techHealing,d.techBless,d.techJihad],child:[{img:m.arab_mosque_c},{alpha:!0,img:m.arab_mosque_s,rgb:[0,0,0,.5]}],name:"Mosque",onbuild:[d.buildChurch2],clss:"mosque",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:86,zLevel:1,dieSound:P,space:new Uint8Array([0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_magetower,
validator:L,build:1,icons:[d.createMage2,d.techCarpet,d.techMagicWorkshop,d.techFireRain,d.techMagicVision,d.techNecromancy,d.techJinn],child:[{img:m.arab_magetower_c},{alpha:!0,img:m.arab_magetower_s,rgb:[0,0,0,.5]}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:93,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_tc_guild,
validator:L,build:1,icons:[d.techUsury,d.techTradeRoutes,d.techSupplyStorage,d.techBribery,d.techOreFloatation],child:[{img:m.arab_tcguild_c},{alpha:!0,img:m.arab_tc_guild_s,rgb:[0,0,0,.5]}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[d.buildMarket2],sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:94,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_waracademy,
validator:L,build:1,icons:[d.techHeroism,d.techWarfare,d.techMercenaries,d.techRiddingHorses,d.techBodyBuilding,d.techLeadership,d.techHeroes,d.techJanissary,d.techHonor,d.techFame],child:[{img:m.arab_waracademy_c},{alpha:!0,img:m.arab_waracademy_s,rgb:[0,0,0,.5]}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:158,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,
radix:0,url:m.arab_magicworkshop,validator:L,build:1,icons:[d.createObjects],child:[{img:m.arab_magicworkshop_c},{alpha:!0,img:m.arab_magicworkshop_s,rgb:[0,0,0,.5]}],name:"Magic Workshop",disallowPoint:!0,clss:"magicworkshop",cost:[0,0,0,300],time:20,sight:5,resistance:200,health:1200},{race:"asia",invType:1,invMax:0,iconID:161,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,0,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.asia_houses,validator:L,build:1,icons:[],child:[{img:m.asia_houses_c}],
name:"House",clss:"house",cost:[0,75,0,0],population:10,time:20,sight:4,resistance:50,health:500},{race:"asia",invType:1,invMax:0,iconID:149,zLevel:1,dieSound:P,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,storage:1,url:m.asia_lumbermill,validator:L,build:1,icons:[d.techWoodCutting,d.techCrossbow],child:[{img:m.asia_lumbermill_c},{img:m.asia_lumbermill_s,rgb:[0,0,0,.5],alpha:!0}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],time:30,sight:4,resistance:80,
health:800},{race:"asia",invType:1,invMax:0,iconID:154,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_storage,storage:0,validator:L,build:1,icons:[d.techGoldMining,d.techStoneMining],child:[{img:m.asia_storage_s,rgb:[0,0,0,.5],alpha:!0},{img:m.asia_storage_c}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:147,zLevel:1,dieSound:P,space:new Uint8Array([1,
1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,storage:2,url:m.asia_farm,validator:L,build:1,icons:[d.techCropRotation,d.ridingHorses,d.irrigation],child:[{img:m.asia_farm_c}],name:"Farm",clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:148,zLevel:1,dieSound:P,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),validator:Fg,bimg:m.build_harbor,dimg:m.des_harbor,radix:0,url:m.asia_harbor,build:1,icons:[d.createFishingBoat,
d.createXebec,d.createHulk,d.techLandingTactics],child:[{img:m.asia_harbor_c},{img:m.asia_harbor_s,rgb:[0,0,0,.5],alpha:!0}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:145,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_blacksmith,validator:L,build:1,icons:[d.techTemperIron,d.techScaleArmor,d.techArmoredChariot,d.techChainMail],
child:[{img:m.asia_blacksmith_c},{img:m.asia_blacksmith_s,rgb:[0,0,0,.5],alpha:!0}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],time:40,sight:5,onbuild:k,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:157,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_workshop,validator:L,build:1,icons:[d.createCatapult,d.createBallist,d.techEngineering,d.techCannonTower],child:[{img:m.asia_workshop_c,x:0,
y:0},{img:m.asia_workshop_s,rgb:[0,0,0,.5],alpha:!0}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:162,zLevel:1,dieSound:P,space:new Uint8Array([0,1,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asian_monastery,validator:L,build:1,icons:[d.createMonk,d.createPriest1],child:[{img:m.asian_monastery_c},{img:m.asian_monastery_s,rgb:[0,0,0,.5],alpha:!0}],name:"Monastery",
clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"asia",invType:1,invMax:0,iconID:155,zLevel:1,dieSound:P,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_tavern,validator:L,build:1,icons:[d.createMercenaries,d.createHeroes],child:[{img:m.asia_tavern_c},{img:m.asia_tavern_s,rgb:[0,0,0,.5],alpha:!0}],onbuild:g,name:"Tavern",clss:"tavern",actvintv:[d.iniMercenaries,d.iniHeroes],cost:[0,200,200,0],time:40,sight:5,
resistance:150,health:1E3},{race:"asia",invType:1,invMax:0,iconID:150,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_market,validator:L,build:1,icons:[],child:[{img:m.asia_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:153,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,
radix:0,url:m.asia_stables,validator:L,build:1,icons:[],child:[{img:m.asia_stables_c,mv:!0},{img:m.asia_stables_s,rgb:[0,0,0,.5],alpha:!0}],name:"Stable",clss:"stable",onbuild:f,cost:[0,200,200,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:151,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.asia_outpost,validator:L,build:1,icons:[d.emergeAllUnits],child:[{img:m.asia_outpost_c,mv:1},{img:m.asia_outpost_s,
rgb:[0,0,0,.5],alpha:!0}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"asia",invType:1,invMax:0,iconID:163,zLevel:1,dieSound:P,space:new Uint8Array([0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,6]),bimg:m.build6x6,dimg:m.des_6x6,radix:0,url:m.asia_shao_lin,validator:L,build:1,icons:[d.techMeditation,d.techKungFu,d.techHealing,d.techPhilosophy,d.techNinjas,d.techMastery,d.techTournaments,d.techMedicine],child:[{img:m.asia_shao_lin_c},
{img:m.asia_shao_lin_s,rgb:[0,0,0,.5],alpha:!0}],name:"Shao Linn",onbuild:[d.buildChurch1],clss:"shaolinn",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:152,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_wizardguild,validator:L,build:1,icons:[d.createMage1,d.techConcentration,d.techWhirlpool,d.techFlameBolt,d.techTurnToStone,d.techConfusion,d.techDragon],
child:[{img:m.asia_wizardguild_c},{img:m.asia_wizardguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:159,zLevel:1,dieSound:P,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_tcguild,validator:L,build:1,icons:[d.techTradeRoutes,d.techUsury,d.techJewelry,d.techSupplyStorage,d.techBanking,d.techChemistry,
d.techSeaFood,d.techGunPowder,d.techRocketArrow],child:[{img:m.asia_tcguild_c,mv:!0},{img:m.asia_tcguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[d.buildMarket1],sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:156,zLevel:1,dieSound:P,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_warguild,validator:L,build:1,icons:[d.techBushido,d.techHeroism,
d.techWarfare,d.techMercenaries,d.techLeadership,d.techTactics,d.techHeroes,d.techHonor,d.techSunTzu],child:[{img:m.asia_warguild_c,mv:!0},{img:m.asia_warguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:0,invMax:0,iconID:166,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_priest,img:m.asian_priest.idle,spd:50,validator:X,human:1,icons:[d.attack,d.stop,d.stand,d.pickUp,d.explore,
d.healing,d.teach,d.move],name:"Priest",clss:"priest",cost:[170,0,0,0],time:30,sight:21,health:120,standardFunc:R,attDist:1,attack:10,defence:10,mana:100,update:["mana","manaSpeed",I.manaRechargeTime],manaMax:100},{race:"asia",invType:0,invMax:0,iconID:187,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_monk,img:m.asian_monk.idle,spd:50,validator:X,human:1,icons:e,name:"Monk",standardFunc:R,clss:"monk",cost:[0,0,200,0],time:20,sight:5,health:90,attack:6,defence:6,attDist:1},{race:"asia",
invType:0,invMax:0,iconID:134,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_mage,img:m.asian_mage.idle,spd:50,attimg:m.flame_bolt,validator:X,standardFunc:R,human:1,icons:[d.stop,d.pickUp,d.explore,d.confusion,d.turnToStone,d.whirlpool,d.flameBolt,d.createDragon,d.attack,d.stand,d.move],name:"Mage",clss:"mage",cost:[150,0,0,0],ball:1,time:30,sight:15,mana:100,attDist:10,health:60,attack:8,defence:0,update:["mana","manaSpeed",I.manaRechargeTime],manaMax:100},{radix:0,name:"Dragon",
strID:"dragon",defence:0,attack:25,health:300,maxHealth:300,img:m.dragon.idle,invType:0,invMax:0,dieSound:[],sSizex:2,sSizey:2,dragon:1,iconID:160,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:12,standardFunc:R,url:m.dragon,icons:e,cost:[80,0,0,0,800],attDist:2,spd:128,clss:"drg",size:1,z32:1.5,validator:Gg},{radix:0,name:"Carpet",strID:"carpet",defence:0,attack:0,health:90,maxHealth:90,img:m.carpet.idle,invType:1,invMax:8,dieSound:[],iconID:131,race:"common",zLevel:2,nofreeze:1,attackSound:[],
sight:8,url:m.carpet,icons:[d.move,d.unload,d.explore,d.stop,d.stand],cost:[80,0,0,0,500],attDist:2,spd:120,clss:"carpet",size:1,z32:1.5,validator:Gg},{radix:0,name:"Jinn",strID:"jinn",defence:5,attack:20,health:300,maxHealth:300,img:m.arab_jinn.idle,invType:0,invMax:0,dieSound:[],validator:X,iconID:182,race:"common",zLevel:1,nofreeze:1,attackSound:[],sight:8,standardFunc:R,url:m.arab_jinn,icons:e,w:1,cost:[80,0,0,0,300],attDist:1,spd:85,clss:"jinn",size:1}];zd={};pi={arr:[]};Qa={euro:[],asia:[],
arab:[],common:[]};Dk=[];Kb=[[],[],[],[],[],[]];u=0;for(var n=y.length;u<n;u++){b=y[u];y[u].type=u;var q=b.space;b.name.split(" ").join("");b.population&&Dk.put(b);zd[u]={};void 0!==b.storage&&(-1<b.storage?(0===b.storage&&Kb[3].put(u),Kb[b.storage].put(u)):(Kb[0].put(u),Kb[1].put(u),Kb[2].put(u),Kb[3].put(u)));$a[b.race][b.name.toLowerCase().split(" ").join("")]=b;b.icons.menuName=b.strID;pi[b.name]=u;pi.arr.put(u);b.img||(b.img=b.url);b.maxHealth=b.health;b.race&&Qa[b.race].put(b);g=0;f=b.icons;
for(h=f.length;g<h;g++)(c=f[g])&&c.obj&&(c.orderOrigin=b);if(q){g=[];b.free=g;c=q[q.length-1];b=(q.length-1)/c;var r=c+2;h=b+2;f=new Uint8Array(r*h);for(k=0;k<b;k++)for(var t=0;t<c;t++)f[(k+1)*r+t+1]=q[t+k*c];k=0;for(h*=r;k<h;k++)!f[k]&&(f[k+1]||f[k-1]||f[k+1+r]||f[k+1-r]||f[k-1+r]||f[k-1-r]||f[k+r]||f[k-r])&&(g.put(k%r-1),g.put(~~(k/r)-1))}}Qa.euro=Qa.euro.concat(Qa.common);Qa.asia=Qa.asia.concat(Qa.common);Qa.arab=Qa.arab.concat(Qa.common);Qa[0]=Qa.euro;Qa[1]=Qa.arab;Qa[2]=Qa.asian;f=$a.euro;h=
$a.asia;c=$a.arab;k=$a.common;$a[0]=$a.euro;$a[1]=$a.arab;$a[2]=$a.asia;Td||(e.cut=M({a:"attack",g:"guard",r:"patrol",p:"pickUp",e:"explore",s:"stop",n:"stand"}),f.tavern.icons.cut=M({t:"trade1",g:"gamble",m:"createMercenaries",h:"createHeroes",l:"loan"}),f.castle.icons.cut=M({p:"createPeon",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning"}),h.castle.icons.cut=M({p:"createPeon1",n:"createNina",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",
b:"techBudhism",w:"techGreatwall"}),c.castle.icons.cut=M({p:"createPeon2",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",y:"techSlavery"}),f.barracks.icons.cut=M({f:"createFootman",a:"createArcher",m:"createMaceman",p:"createPikeman",l:"createLongbowman",k:"createKnight"}),h.barracks.icons.cut=M({r:"createRonin",a:"createArcher1",s:"createSamurai",h:"createHorseArcher1",o:"createHorseSamurai",c:"createChariot"}),c.barracks.icons.cut=M({f:"createFootman2",
a:"createArcher2",s:"createSatrap",p:"createPikeman2",h:"createHorseArcher2",c:"createCavalry",j:"createEnichar",d:"createJihad"}),f.magetower.icons.cut=M({m:"createMage"}),h.mageguild.icons.cut=M({m:"createMage1"}),c.mageguild.icons.cut=M({m:"createMage2"}),f.peasant.icons.cut=M({b:"menuBuilds",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",i:"bribe"}),c.peasant.icons.cut=M({b:"menuBuilds2",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",
a:"attack",j:"become_jihadw",i:"bribe"}),h.peasant.icons.cut=M({b:"menuBuilds1",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",t:"trade"}),f.priest.icons.cut=M({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),c.priest.icons.cut=M({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),h.priest.icons.cut=M({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",r:"raiseexp"}),f.wizard.icons.cut=M({m:"move",
a:"attack",s:"stop",n:"stand",l:"lightning",b:"createBat",f:"freeze",t:"createGolem",i:"invisibility"}),c.mage.icons.cut=M({m:"move",a:"attack",s:"stop",n:"stand",c:"spell_spawncarpet",j:"spell_spawnjin",r:"spell_firerain",v:"spell_magicvision",d:"raisedead"}),h.mage.icons.cut=M({m:"move",a:"attack",s:"stop",n:"stand",h:"spell_hypnotize",t:"spell_turntostone",w:"spell_whirlpool",f:"spell_flamebolt",d:"spell_spawndragon"}),k.spy.icons.cut=M({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",
n:"stand",s:"stop"}),h.monk.icons.cut=M({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"}),h.ninja.icons.cut=M({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand",c:"cloak",u:"murder"}),k.catapult.icons.cut=M({a:"attack",g:"guard",p:"patrol",e:"explore",s:"stop",n:"stand",r:"attack_ground",h:"hold_steady"}),f.market.icons.cut=M({c:"createCaravan"}),c.market.icons.cut=M({c:"createCaravan2"}),h.market.icons.cut=M({b:"market_items",s:"market_sell"}),
f.workshop.icons.cut=M({c:"createCatapult",h:"createHeavyCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),c.workshop.icons.cut=M({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),h.workshop.icons.cut=M({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),f.church.icons.cut=M({p:"createPriest"}),c.church.icons.cut=M({p:"createPriest2"}),h.monastery.icons.cut=M({m:"createMonk",p:"createPriest1"}),c.magicworkshop.icons.cut=
M({i:"build_item"}),e=M({c:"buildCastle",s:"buildStorage",b:"buildBarrack",k:"buildBlacksmith",f:"buildFarm",l:"buildLumbermill",p:"buildWorkshop",e:"buildCathedral",u:"buildChurch",n:"buildTavern",m:"buildMageTower",a:"buildStable",r:"buildHarbor",o:"buildOutpost",i:"buildFields",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse",g:"buildGateWood",y:"buildDummy"}),g=M({c:"buildCastle2",k:"buildBlacksmith2",f:"buildFarm2",n:"buildTavern2",b:"buildBarrack2",p:"buildWorkshop2",s:"buildStorage2",
a:"buildStable2",l:"buildLumbermill2",r:"buildHarbor2",o:"buildOutpost2",u:"buildChurch2",e:"buildMosque",i:"buildFields",m:"buildMageTower2",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse2",g:"buildGateWood"}),u=M({c:"buildCastle1",f:"buildFarm1",e:"buildShaolinn",n:"buildTavern1",b:"buildBarrack1",p:"buildWorkshop1",s:"buildStorage1",k:"buildBlacksmith1",a:"buildStable1",l:"buildLumbermill1",r:"buildHarbor1",o:"buildOutpost1",u:"buildChurch1",i:"buildFields",m:"buildMageTower1",
w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse1",g:"buildGateWood"}),Ye.cut=u,Ze.cut=u,$e.cut=e,af.cut=e,bf.cut=e,cf.cut=u,df.cut=e,ef.cut=u,ff.cut=g,gf.cut=g,hf.cut=g,jf.cut=g,f.lumbermill.icons.cut=M({b:"techLongbow",w:"techWoodCutting",c:"techCrossbow"}),c.lumbermill.icons.cut=M({w:"techWoodCutting",c:"techCrossbow"}),h.lumbermill.icons.cut=M({w:"techWoodCutting",c:"techCrossbow"}),f.blacksmith.icons.cut=M({p:"techPlateArmor",t:"techTemperIron",s:"techScaleArmor",h:"techHalberd",
c:"techChainMail"}),c.blacksmith.icons.cut=M({t:"techTemperIron",a:"techScaleArmor",s:"techScimitar",c:"techChainMail",h:"techHalberd"}),h.blacksmith.icons.cut=M({t:"techTemperIron",a:"techScaleArmor",r:"techArmoredChariot",c:"techChainMail"}),f.outpost.icons.cut=M({e:"emergeAllUnits"}),c.outpost.icons.cut=M({e:"emergeAllUnits"}),h.outpost.icons.cut=M({e:"emergeAllUnits"}),k.watchtower.icons.cut=M({a:"attack",s:"stop",g:"upgradeGuildTower"}),k.guardtower.icons.cut=M({a:"attack",s:"stop",g:"upgradeStoneTower",
c:"upgradeCannonTower"}),k.keeptower.icons.cut=M({a:"attack",s:"stop",c:"upgradeCannonTower"}),k.cannontower.icons.cut=M({a:"attack",r:"attack_ground",s:"stop",h:"holdfire"}),h.rockettower.icons.cut=M({a:"attack",r:"attack_ground",s:"stop",f:"fireatwill"}),f.harbor.icons.cut=M({f:"createFishingBoat",x:"createXebec",h:"createHulk",g:"createGalleon",t:"te_landingtactics"}),c.harbor.icons.cut=M({f:"createFishingBoat",h:"createHulk",x:"createXebec",t:"te_landingtactics"}),h.harbor.icons.cut=M({f:"createFishingBoat",
h:"createHulk",x:"createXebec"}),f.farm.icons.cut=M({c:"createCow",f:"techCropRotation",d:"techDomestication"}),c.farm.icons.cut=M({c:"createCow",f:"techDomestication",d:"techDomestication",p:"techCowPoaching",r:"ridingHorses",h:"techHorseManShip"}),h.farm.icons.cut=M({f:"techDomestication",a:"ridingHorses",i:"irrigation"}),f.storage.icons.cut=M({g:"techGoldMining",s:"techStoneMining"}),c.storage.icons.cut=M({g:"techGoldMining",s:"techStoneMining"}),h.storage.icons.cut=M({g:"techGoldMining",s:"techStoneMining"}),
f.cathedral.icons.cut=M({c:"createCrusaders"}),k.magicgateway.icons.cut=M({o:"createOrk",d:"createDwarf",g:"createGhost",s:"createSkeleton"}));e=[f.knight,h.horsesamurai,c.cavalry,c.enichar,f.crusader,h.chariot,h.horsearcher,c.horsearcher];g=[h.horsesamurai,f.crusader,c.enichar];u=[f.knight,c.cavalry,h.chariot,h.horsearcher,c.horsearcher];b=[f.longbowman,c.archer,h.archer,f.archer];n=[k.catapult,k.ballista,k.heavycatapult];q=[k.galleon,k.hulk,k.pinque,k.fishingboat];r=[k.galleon,k.hulk,k.pinque];
t=[c.satrap,f.maceman];var w=[f.longbowman,c.archer,h.archer,f.archer,h.horsearcher,c.horsearcher,k.pinque,k.watchtower,k.keeptower,k.guardtower],v=[k.stonegolem,k.ork,k.dwarf,k.skeleton,k.ghost,k.dragon,k.jinn,k.bat,f.wizard,c.mage,h.mage],x=[f.peasant,h.peasant,c.peasant,f.footman,c.footman,h.ronin,f.pikeman,c.spearman,c.satrap,f.maceman,c.cavalry,c.jihadwarrior,k.spy,c.enichar,h.horsesamurai,h.monk,h.chariot,h.ninja,k.stonegolem,k.ork,k.dwarf,k.jinn,k.skeleton,k.ghost,f.knight,f.crusader],A=[k.watchtower,
k.keeptower,k.guardtower,k.cannontower],B=[k.cannontower,h.rockettower],F=[f.cathedral,f.castle,k.woodenwall,f.barracks,f.lumbermill,f.magetower,f.warriorsguild,f.storage,f.farm,f.merchantsguild,f.church,f.blacksmith,f.stable,f.workshop,f.tavern,f.house,k.watchtower,f.market,f.outpost,k.bridge,f.harbor,k.guardtower,k.keeptower,k.cannontower,h.rockettower,h.castle,c.castle,h.barracks,c.house,c.lumbermill,c.storage,c.farm,c.harbor,c.blacksmith,c.workshop,c.church,c.tavern,c.market,c.barracks,c.stable,
c.outpost,c.mosque,c.mageguild,c.merchantsguild,c.warriorsguild,c.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],H=[f.cathedral,f.castle,k.woodenwall,f.barracks,f.lumbermill,f.magetower,f.warriorsguild,f.storage,f.farm,f.merchantsguild,f.church,f.blacksmith,f.stable,f.workshop,f.tavern,f.house,k.watchtower,f.market,f.outpost,k.bridge,f.harbor,h.castle,c.castle,
h.barracks,c.house,c.lumbermill,c.storage,c.farm,c.harbor,c.blacksmith,c.workshop,c.church,c.tavern,c.market,c.barracks,c.stable,c.outpost,c.mosque,c.mageguild,c.merchantsguild,c.warriorsguild,c.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],G=[k.catapult,k.heavycatapult],O=[f.pikeman,c.spearman],Q=[h.monk,h.priest],N=[k.woodenwall],S=[f.peasant,h.peasant,
c.peasant],T=[f.wizard,c.mage,h.mage],V=[f.footman,c.footman,h.ronin],W=[f.priest,c.priest,h.priest];pb={bless:{img:m.bless,d:0,mv:1},star:{img:m.star,d:0,mv:1},heal:{img:m.healing,d:0,mv:1},impersonate:{img:m.impersonate,d:0,mv:1},select:{img:m.select,d:0,mv:0,select:1,z32:.8},spawn:{img:m.spawn,d:0,mv:1},curse:{img:m.curse,d:0,mv:1},turnStone:{img:m.turn_to_stone,d:0,mv:1}};var K=function(b,c,e){for(var d=b.length,f=0,g=c.length;f<g;f++)for(var h=0;h<d;h++)zd[b[h].type][c[f].type]=e};K(B,r,4);K(r,
r,3);K(r,H,3);K(r,A,3);K(r,N,5);K(r,n,2);K(G,H,4);K(G,q,4);K(G,A,6);K(G,n,4);K(G,N,9);K([h.samurai],g,.5);K([h.samurai],u,.3);K([h.ronin],S,1);K(O,e,6);K(V,O,1.5);K(V,b,1.5);K(V,[c.jihadwarrior],1);K([c.satrap],S,2);K(t,n,1.5);K(w,[k.dragon],.75);K(w,[k.bat],1);K(w,[f.pikeman],-.75);K(w,t,1);K(w,[h.chariot],-.3);K(w,Q,.5);K(T,W,4);K(W,T,3);K(W,v,3);K(x,[k.bat],-.2);K(x,[k.dragon],-.5);K([k.stonegolem],F,1);K([k.dwarf],F,4);K(v,[h.priest],-.5);b=La;e=Object.keys(b);for(g=0;g<y.length;g++)for(n=y[g],
u=0;u<e.length;u++)n[e[u]]=b[e[u]];e=[f.archer,f.longbowman,h.archer,h.horsearcher,c.archer,c.horsearcher];g=[f.footman,f.maceman,f.knight,f.crusader,f.pikeman,c.jihadwarrior,c.cavalry,c.footman,c.enichar,f.peasant,c.peasant,c.satrap,c.spearman,k.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,k.skeleton,k.ghost,k.ork,k.dwarf];u=[f.footman,f.maceman,f.knight,f.crusader,f.pikeman,c.jihadwarrior,c.cavalry,c.footman,c.enichar,f.peasant,c.peasant,c.satrap,c.spearman,k.spy,h.chariot,
h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,f.archer,f.longbowman,h.archer,h.horsearcher,c.archer,c.horsearcher,f.wizard,c.mage,h.mage,f.priest,c.priest,h.priest,k.skeleton,k.ghost,k.ork,k.dwarf];z=[{name:["Longbow","Allows the production of longbowmen"],next:[d.createLongbowman],cost:[400,0,0,0],time:45,type:aa},{name:["Gold Mining","Increases gold production"],increase:2,value:"gold",cost:[400,0,0,0],time:20,type:Ha},{name:["Stone Mining","Increases stone production"],increase:2,value:"stone",
cost:[400,0,0,0],time:20,type:Ha},{name:["Wood Cutting","Increases wood production"],increase:2,value:"wood",cost:[400,0,0,0],time:20,type:Ha},{name:["Temper Iron","Increases hand-to-hand units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:g,next:[d.techHalberd],type:Mb},{name:["Scale Armor","Increases unit's defense"],increase:1,value:"defence",cost:[400,0,0,0],time:30,group:u,next:[d.techChainMail],type:Mb},{name:["Halberd","Allows the production of spear units"],next:[d.createPikeman,
d.createPikeman2],cost:[400,0,0,0],time:30,type:aa},{name:["Domestication","Allows the production of cows"],next:[d.createCow],cost:[300,0,0,0],time:20,type:aa},{name:["Crop Rotation","Increases the production of fields"],increase:2,value:"food",cost:[400,0,0,0],time:20,type:Ha,next:[d.irrigation]},{name:["Chain Mail","Increases unit's defense"],increase:2,value:"defence",cost:[400,0,0,0],time:30,group:u,type:Mb},{name:["Plate Armor","Allows the production of knights"],next:[d.createKnight],cost:[400,
0,0,0],time:60,type:aa},{name:["Crossbow","Increases arrow units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:e,type:Mb},{name:["Feudalism","Makes peasants cheaper"],cost:[300,0,0,0],time:30,decrease:[h.peasant,[0,0,8,0],f.peasant,[0,0,10,0],c.peasant,[0,0,10,0]],type:Jh,next:[d.techSlavery]},{name:["Architecture","Peasants build faster, and allows stone wall, gate and towers"],increase:.5,value:"buildSpeed",cost:[300,0,0,0],time:30,type:Ha,next:[d.upgradeStoneTower,d.techGreatWall,
d.buildBridge]},{name:["Learning","Allows units to gather experience"],increase:1,value:"experience",cost:[400,0,0,0],time:30,type:Ha,next:[d.buildAcademy,d.buildAcademy1,d.buildAcademy2]},{name:["Convert Resources",""],cost:[400,0,0,0],time:30},{name:["Map Making","Allows the production of galleons"],cost:[800,0,0,0],time:30,type:aa,next:[d.createGalleon]},{name:["Trade Routes","Allows trading"],cost:[400,0,0,0],time:30,type:aa,next:[d.techTradeTaxes]},{name:["Trade Taxes","Increases trade profit"],
cost:[400,0,0,0],time:30},{name:["Usury","Allows the obtaining of loans in taverns"],cost:[300,0,0,0],time:30,type:Uf,next:[d.techBanking]},{name:["Supply Storage","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Ha,value:"popLimit",next:[d.techSeaFood]},{name:["Bribery","Allows the bribing of enemy units"],cost:[600,0,0,0],time:60,type:aa,next:[d.bribe]},{name:["Heroism","Allows unlimited experience"],cost:[500,0,0,0],time:30,increase:Infinity,value:"maxLevel",type:Ha,
next:[d.techLeadership]},{name:["Warfare","Gain experience faster"],cost:[400,0,0,0],time:30,type:Ha,increase:1,value:"experience",next:[d.techTactics]},{name:["Tactics","Gain experience faster"],cost:[800,0,0,0],time:30,type:aa,next:[d.buildDummy,d.techSunTzu]},{name:["Mercenaries","Allows the recruitment of units in taverns"],cost:[600,0,0,0],time:30,type:Uf,next:[d.techHeroes,d.createMercenaries],actvintv:[d.iniMercenaries]},{name:["Heroes' Quest","Allows the recruitment of heroes in taverns"],
cost:[800,0,0,0],time:30,type:Uf,next:[d.techFame,d.createHeroes],actvintv:[d.iniHeroes]},{name:["Fame","Recruit better units from taverns"],cost:[500,0,0,0],time:30,value:"fameTech",increase:1,type:Ha},{name:["Siege Tactics","Allows the production of heavy catapults"],cost:[1200,0,0,0],time:60,type:aa,next:[d.createHeavyCatapult]},{name:["Body Building","Increases unit's hit points at every new level"],cost:[800,0,0,0],time:60,value:"healthJump",increase:5,type:Ha},{name:["Espionage","Allows the production of a spy"],
cost:[400,0,0,0],time:30,type:aa,next:[d.createSpy]},{name:["Fanaticism","Increases the building's resistance"],cost:[400,0,0,0],time:30,type:Mb,group:[],increase:5,value:"resistance",next:[d.techCrusade,d.techJihad]},{name:["Crusade","Allows the preaching of a crusade"],cost:[1200,0,0,0],time:180,type:aa,next:[d.createCrusaders]},{name:["Inquisition","Increases priest attack"],cost:[400,0,0,0],time:30,type:Mb,group:[f.priest,c.priest,h.priest],increase:5,value:"attack"},{name:["Healing","Allows healing of units"],
cost:[400,0,0,0],time:30,next:[d.techMedicine,d.healing],type:aa},{name:["Medicine","Allows remote healing of units"],cost:[500,0,0,0],time:30,value:"healingRange",increase:5,type:Ha},{name:["Bless","Temporarily increases unit attack skill"],cost:[400,0,0,0],time:30,type:aa,next:[d.bless]},{name:["Invisibility","Invisibility spell"],cost:[500,0,0,0],time:30,type:aa,next:[d.invisibility]},{name:["Bat","Researches bat summoning"],cost:[400,0,0,0],time:240,type:aa,next:[d.createBat]},{name:["Freeze",
"Freeze spell"],cost:[800,0,0,0],time:30,type:aa,next:[d.freeze]},{name:["Lightning","Lightning spell"],cost:[400,0,0,0],time:30,type:aa,next:[d.lightning]},{name:["Stone Golem","Researches stone golem summoning"],cost:[800,0,0,0],time:120,type:aa,next:[d.createGolem]},{name:"Upgrade to Guard Tower",cost:[0,600,0,0],time:20,type:Tf,obj:44,upgrade:1},{name:"Upgrade to Stone Tower",cost:[0,0,0,500],time:30,type:Tf,obj:55,upgrade:1},{name:"Upgrade to Cannon Tower",cost:[0,0,0,500],time:30,type:Tf,obj:56,
upgrade:1},{name:["Buddhism"],cost:[400,0,0,0],time:30,type:aa,next:[d.buildCathedral1]},{name:["Cannon Tower","Allows the building of cannon towers"],next:[d.upgradeCannonTower],cost:[400,0,0,0],time:30,type:aa},{name:["Engineering","Increases siege weapon's attack"],increase:5,value:"attack",cost:[400,0,0,0],time:30,group:[k.ballista,k.catapult,k.heavycatapult],type:Mb},{name:["Great Wall","Makes stone walls, towers and gates stronger"],cost:[600,0,0,0],time:30,type:aa},{name:["Art of Riding","Allows the production of horse archers"],
cost:[500,0,0,0],time:30,type:aa,next:[d.createHorseArcher1,d.createHorseArcher2,d.techHorseManShip]},{name:["Irrigation","Increases field production"],increase:4,value:"food",cost:[400,0,0,0],time:30,type:Ha},{name:["Armored Chariot","Allows the production of armored chariots"],cost:[500,0,0,0],time:60,type:aa,next:[d.createChariot]},{name:["Meditation","Makes monks cheaper"],cost:[300,0,0,0],time:30,decrease:[0,0,50,0],type:Ih,next:[d.techPhilosophy],group:[h.monk]},{name:["Kung-Fu","Increases the attack of all kung-fu units"],
cost:[400,0,0,0],time:30,type:Mb,increase:1,value:"attack",group:[h.peasant,h.ninja,h.monk,h.priest],next:[d.techMastery,d.techNinjas,d.techTournaments]},{name:["Tournaments","Allows sharing of experience between kung-fu units"],cost:[800,0,0,0],time:30,type:aa,next:[]},{name:["Philosophy","Allows the production of more experienced monks"],cost:[400,0,0,0],time:30,type:Mb,increase:2,value:"level",group:[h.monk,h.priest],next:[d.createPriest1]},{name:["Ninjas","Allows the production of ninjas"],cost:[500,
0,0,0],time:30,type:aa,next:[d.createNinja]},{name:["Mastery","Allows priests to teach kung-fu units"],cost:[500,0,0,0],time:30,type:aa,next:[d.teach]},{name:["Concentration","Allows faster manna restoration"],cost:[600,0,0,0],time:80,type:aa,next:[d.techConfusion]},{name:["Confusion","Researches the Confusion spell"],cost:[400,0,0,0],time:30,type:aa,next:[d.confusion]},{name:["Whirlpool","Researches the Whirlpool spell"],cost:[300,0,0,0],time:30,type:aa,next:[d.whirlpool]},{name:["Dragon","Researches Dragon summoning"],
cost:[800,0,0,0],time:300,type:aa,next:[d.createDragon]},{name:["Turn to Stone","Researches the Turn to Stone spell"],cost:[300,0,0,0],time:30,type:aa,next:[d.turnToStone]},{name:["Flame Bolt","Researches the Flame Bolt spell"],cost:[400,0,0,0],time:30,type:aa,next:[d.techDragon,d.flameBolt]},{name:["Jewelry","Allows trading of items"],cost:[400,0,0,0],time:30,type:aa,next:[d.sellItems,d.buyItems]},{name:["Banking","Increases trade profit"],cost:[600,0,0,0],time:30,type:aa},{name:["Chemistry","Increases arrow units' attack power"],
cost:[500,0,0,0],time:30,type:Mb,group:e,increase:1,value:"attack",next:[d.techGunPowder]},{name:["Sea Food","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Ha,value:"popLimit"},{name:["Gun Powder","Increases cannon tower's attack power"],cost:[500,0,0,0],time:30,type:Mb,increase:10,value:"attack",group:[k.cannontower],next:[d.techRocketArrow]},{name:["Rocket Arrow","Allows the building of rocket tower"],cost:[800,0,0,0],time:30,type:aa,next:[d.buildRocketTower]},{name:["Bushido",
"Allows the production of horse samurai"],cost:[800,0,0,0],time:120,type:aa,next:[d.createHorseSamurai]},{name:["Leadership","Units around a hero gain experience"],cost:[600,0,0,0],time:30,type:aa,next:[d.techHonor]},{name:["Honor","Hero vs. hero attack bonus"],cost:[500,0,0,0],time:30,type:aa},{name:["Sun Tzu's Book","Increases the speed of learning"],cost:[800,0,0,0],time:30,type:Ha,increase:1,value:"experience"},{name:["Cow Poaching","Allows peasants to steal cows"],cost:[200,0,0,0],time:30,type:Ha,
increase:1,value:"stealCows"},{name:["Horsemanship","Makes mounted units cheaper"],cost:[500,0,0,0],time:30,type:Ih,mulp:.75,group:[h.horsearcher,c.cavalry,c.horsearcher]},{name:["Scimitar","Increases sword attack power and allows the production of satraps"],cost:[400,0,0,0],time:30,type:Mb,increase:1,value:"attack",group:g,next:[d.createSatrap]},{name:["Jihad","Allows the production of Jihad Warriors"],cost:[1200,0,0,0],time:30,type:aa,next:[d.createJihad,d.convertJihad]},{name:["Magic Carpet","Researches Magic Carpet summoning"],
cost:[300,0,0,0],time:30,type:aa,next:[d.createCarpet,d.techJinn]},{name:["Magic Workshop","Allows the building of a magic workshop"],cost:[1200,0,0,0],time:180,type:aa,next:[d.buildMagicWorkshop]},{name:["Rain of Fire",""],cost:[800,0,0,0],time:60,type:aa,next:[d.fireRain]},{name:["Magic Vision","Researches the Magic Vision spell"],cost:[400,0,0,0],time:30,type:aa,next:[d.magicVision]},{name:["Necromancy","Researches the Raise the Dead spell"],cost:[400,0,0,0],time:30,type:aa,next:[d.raiseDead]},
{name:["Jinn","Researches Jinn summoning"],cost:[600,0,0,0],time:300,type:aa,next:[d.createJinn]},{name:["Ore Enrichment","Increases mine production"],cost:[800,0,0,0],time:30,type:Ha,increase:1,value:"miningPerf"},{name:["Riding Horses","Increases the mounted units' attack and defense power"],cost:[500,0,0,0],time:30,type:Gj,values:["attack",2,"defence",1],group:[h.horsearcher,c.cavalry,c.horsearcher],next:[d.techJanissary]},{name:["Janissary","Allows the production of Janissaries"],cost:[1200,0,
0,0],time:120,type:aa,next:[d.createEnichar]},{name:["Slavery","Makes peasants cheaper"],cost:[200,0,0,0],time:30,decrease:[h.peasant,[0,0,7,0],f.peasant,[0,0,8,0],c.peasant,[0,0,8,0]],type:Jh}];cj();d.buildMarket.disabled=1;Ek();u=0;for(n=y.length;u<n;u++)if(b=y[u],b.onbuild)for(f=b.onbuild,g=0,h=f.length;g<h;g++)c=f[g],c.obj.race==b.race&&(c.disabled=1,c.requireObj||(c.requireObj=[]),c.requireObj.put(b));g=0;for(h=z.length;g<h;g++)if(c=z[g],c.tech=1,c.id=g,c.next)for(f=c.next,k=0,u=f.length;k<u;k++)b=
f[k],b.disabled?(b.disabled++,b.requireObj.put(c)):(b.requireObj=[c],b.disabled=1);g=0;f=y;for(h=f.length;g<h;Ll(f[g++]));}if(tf){c=8;b=9;g=0;for(h=Y.xtraRes.length;g<h;g++){l=Y.xtraRes[g].coords;pm(l);l.terrain_water[c]=512;l.terrain_water[b]=512;l.terrain_water[6]+=32;l.terrain_water[7]+=32;k=4;for(f=l.terrain_tree.length;k<f;k+=6)l.terrain_tree[k]-=32,l.terrain_tree[k+1]-=96;k=5;for(f=l.terrain_tree_s.length;k<f;k+=6)l.terrain_tree_s[k]-=32;l.terrain_tree[2]=1}Bk(l,Y.info,Y.size,16*Y.ids);f=y[7];
f.img=l.terrain_tree;f.url=Z[l.terrain_tree];f.child[0].img=l.terrain_tree_s;Object.assign(m,l)}wb={img:m.gath_point,x32:-10,y32:-10,d:0,mv:!0};$g=[wb];new Tb("",[255,255,255],[0],!0)},y,zd,pi,wb,$g,Dk,qi=8,w=new Float32Array(16),dd=function(c,b,e,d,g,h,l){var f=y[c];if(f.ignore)return f.invalid=!0,!1;if(h=h&&!f.instantBuild)this.built=!1;var k=H[b],m=k.mod[c],q=Object.keys(m);this.__proto__=f;this.kingdom=b;this.d=g;this.x32=e;this.y32=d;this.taskList=[];g=0;for(var r=q.length;g<r;this[q[g]]=m[q[g++]]);
if(l)for(m=Object.keys(l),g=0,r=m.length;g<r;this[m[g]]=l[m[g++]]);0<f.invMax&&(this.inventory=[]);20==f.type&&(this.lastUse=n.cycle);f.build||(this.mv=1);l=k.technology.disabled;m=f.actvintv;this.workers=[];this.id=r=x.length;f.rndDirection&&(this.d=r*e%f.rndDirection);this.build||this.item||this.cow||k.values.pop++;e=f.validator(e,d,f.space,b);if(e[1]||h){d=f.validator.dimension;q=e[0];if(h){var t=Nb[b];g=0;for(f=q.length;g<f;g++)t[q[g]]=r;k.building.put(r)}else for(g=0,f=q.length;g<f;d[q[g++]]=
r);if(e[2]&&(q=e[2],!h))for(g=0,f=q.length;g<f;d[q[g++]]=0);}else return this.invalid=!0,!1;x[r]=this;h||xa[b][c].put(r);if(this.update&&!n.custom)for(c=this.update,g=0,r=c.length;g<r;g+=3)hb({func:Jf,data:[this.id,c[g],c[g+1],c[g+2]]},c[g+2],1);if(m)for(c=0,f=m.length;c<f;c++)b=m[c],l[b.id]||b(this);h?(yb(this),v.kingdom==this.kingdom?Hd(this,Pl):Hd(this,Bh)):(yb(this),sh(this));this.level&&!this.potion&&Cj(this);!this.standardFunc||this.func||n.editor||h||this.standardFunc(this);h=k.stats;h.unitCount[this.type]++;
k=h.unitCount[this.type]-h.unitCountDeath[this.type];k>h.unitCountMax[this.type]&&(h.unitCountMax[this.type]=k)},Lj=function(c){var b=H[c.kingdom];if(c.population){var e=c.population;b.values.popMax+=e;ne(c.kingdom);for(var d=0;d<e;d++)b.checkPopArray()}if(c.onbuild)for(c=c.onbuild,e=b.technology,b=e.disabled,e=e.actived,d=0;d<c.length;d++){var g=c[d].id;e[g]||(e[g]=0);e[g]++;e[g]-1||(b[g]--,!b[g]&&ka.actv[g]&&ka(S.active))}},jc=[],T=new Float32Array(12),ri=function(c,b,e){var d=c.length;c[d]=b;c[d+
1]=b+1;c[d+2]=b+2;c[d+3]=b+1;c[d+4]=b+2;c[d+5]=b+3;c.changed=!0;e.typeBuffer=c;e.elemtId=d},Hd=function(c,b){var e=b[3];if(b.noAlpha)d=ca;else{c.alpha=!0;var d=Da}if(c.typeBuffer!==d){if(b==Bh){if(tb.diplomacy[c.kingdom]){Db(c);return}b=new Float32Array(dc(Na[3*c.kingdom],Na[3*c.kingdom+1],Na[3*c.kingdom+2],e+1))}Db(c);ri(d,c.bufferID,c)}k.bindBuffer(k.ARRAY_BUFFER,Qb);k.bufferSubData(k.ARRAY_BUFFER,16*c.bufferID,b)},Ac=function(c){var b=Hg(c,c.kingdom),e=b[0],d=b[1],g=b[2];b=b[3];var h=c.bufferID;
Fk(e,d,g,b,c.bufferID);1>b?(c.alpha=!0,e=Da):e=ca;c.typeBuffer!==e&&(Db(c),ri(e,h,c));if(c.child&&(!1!==c.built||!c.build))for(var l=c.child,k=0,m=l.length;k<m;k++)h+=4,b=Hg(l[k],c.kingdom),e=b[0],d=b[1],g=b[2],b=b[3],Fk(e,d,g,b,h)},Hg=function(c,b){if(null!=c.rgb){var e=c.rgb;c=e[0];var d=e[1];b=e[2];e=e[3]}else Z[c.img][3]?(c=Na[3*b],d=Na[3*b+1],b=Na[3*b+2],e=2):(c.mMapcolor?(b=c.mMapcolor,c=b[0]/255,d=b[1]/255,b=b[2]/255):(c=Na[3*b],d=Na[3*b+1],b=Na[3*b+2]),e=1);return[c,d,b,e]},Gk=function(){if(jc.length){var c=
jc[jc.length-1];jc.length--}else c=qi,qi+=4;return c},yb=function(c,b,e,d){void 0==b&&(d=e=b=0);var f=Z[c.img],h=1;if(c.bufferID){var l=c.bufferID;h=0}else l=Gk();c.bufferID=l;f||O(c);var m=f[2]*c.d*6+4,u=f[4+m],q=f[5+m];m=f[0];var t=f[1];0<=t&&(t*=.001);var r=f.id+4*c.d*f[2],v=-1;c.mv&&(v=n.now());w[0]=r;w[1]=v;w[2]=m;w[3]=t;w[4]=r+1;w[5]=v;w[6]=m;w[7]=t;w[8]=r+2;w[9]=v;w[10]=m;w[11]=t;w[12]=r+3;w[13]=v;w[14]=m;w[15]=t;var x=32*c.x32,y=32*c.y32;m=32*c.y32;null!=c&&null!=c.z32&&(m*=c.z32);var A=ca;
k.bindBuffer(k.ARRAY_BUFFER,sd);k.bufferSubData(k.ARRAY_BUFFER,16*l,w);k.bindBuffer(k.ARRAY_BUFFER,Ec);if(c.rotation){var z=c.rotation;z*=2*Math.PI;var B=.5*f[8];t=.5*f[9];f=-1*m;r=-B;v=-t;var C=0*T.length;T[C]=r*Math.cos(z)-t*Math.sin(z)+x;T[C+1]=t*Math.cos(z)+r*Math.sin(z)+y;T[C+2]=f;T[C+3]=r*Math.cos(z)-v*Math.sin(z)+x;T[C+4]=v*Math.cos(z)+r*Math.sin(z)+y;T[C+5]=f;T[C+6]=B*Math.cos(z)-t*Math.sin(z)+x;T[C+7]=t*Math.cos(z)+B*Math.sin(z)+y;T[C+8]=f;T[C+9]=B*Math.cos(z)-v*Math.sin(z)+x;T[C+10]=v*Math.cos(z)+
B*Math.sin(z)+y;T[C+11]=f}else c.wh?(z=c.wh[0],B=c.wh[1],z-=u,B-=q,T[0]=x,T[1]=y,T[2]=m,T[3]=x+z,T[4]=y,T[5]=m,T[6]=x,T[7]=y+B,T[8]=m,T[9]=x+z,T[10]=y+B):(T[0]=x,T[1]=y,T[2]=m,T[3]=x,T[4]=y,T[5]=m,T[6]=x,T[7]=y,T[8]=m,T[9]=x,T[10]=y),T[11]=m;k.bufferSubData(k.ARRAY_BUFFER,12*l,T);v=Hg(c,c.kingdom);f=v[0];t=v[1];r=v[2];v=v[3];if(1>v||c.alpha)c.alpha=!0,A=Da;k.bindBuffer(k.ARRAY_BUFFER,Qb);w[0]=f;w[1]=t;w[2]=r;w[3]=v;w[4]=f;w[5]=t;w[6]=r;w[7]=v;w[8]=f;w[9]=t;w[10]=r;w[11]=v;w[12]=f;w[13]=t;w[14]=r;
w[15]=v;k.bufferSubData(k.ARRAY_BUFFER,16*l,w);k.bindBuffer(k.ARRAY_BUFFER,Vd);z=n.now();w[0]=b;w[1]=e;w[2]=d;w[3]=z;w[4]=b;w[5]=e;w[6]=d;w[7]=z;w[8]=b;w[9]=e;w[10]=d;w[11]=z;w[12]=b;w[13]=e;w[14]=d;w[15]=z;k.bufferSubData(k.ARRAY_BUFFER,16*l,w);h&&ri(A,l,c);if(c.child&&!1!==c.built)for(b=m,e=c.child.length,d=[],c.childLoc=d,h=0;h<e;h++){A=c.child[h];f=Z[A.img];m=f[2]*c.d*6+4;z=f[4+m];B=f[5+m];m=f[0];t=f[1];0<=t&&(t*=.001);r=f.id+4*c.d;v=-1;A.mv&&(v=1);w[0]=r;w[1]=v;w[2]=m;w[3]=t;w[4]=r+1;w[5]=v;
w[6]=m;w[7]=t;w[8]=r+2;w[9]=v;w[10]=m;w[11]=t;w[12]=r+3;w[13]=v;w[14]=m;w[15]=t;v=Hg(A,c.kingdom);f=v[0];t=v[1];r=v[2];v=v[3];C=x;var F=y;A.wh1&&(z=A.wh[0],B=A.wh[1]);A.center&&(C-=.5*~~(z-u),F-=.5*~~(B-q));l=Gk();k.bindBuffer(k.ARRAY_BUFFER,sd);k.bufferSubData(k.ARRAY_BUFFER,16*l,w);k.bindBuffer(k.ARRAY_BUFFER,Qb);w[0]=f;w[1]=t;w[2]=r;w[3]=v;w[4]=f;w[5]=t;w[6]=r;w[7]=v;w[8]=f;w[9]=t;w[10]=r;w[11]=v;w[12]=f;w[13]=t;w[14]=r;w[15]=v;k.bufferSubData(k.ARRAY_BUFFER,16*l,w);m=A.z?32*A.z+b:b;k.bindBuffer(k.ARRAY_BUFFER,
Ec);T[0]=C;T[1]=F;T[2]=m;T[3]=C;T[4]=F;T[5]=m;T[6]=C;T[7]=F;T[8]=m;T[9]=C;T[10]=F;T[11]=m;k.bufferSubData(k.ARRAY_BUFFER,12*l,T);k.bindBuffer(k.ARRAY_BUFFER,Vd);w[0]=0;w[1]=0;w[2]=0;w[3]=0;w[4]=0;w[5]=0;w[6]=0;w[7]=0;w[8]=0;w[9]=0;w[10]=0;w[11]=0;w[12]=0;w[13]=0;w[14]=0;w[15]=0;k.bufferSubData(k.ARRAY_BUFFER,16*l,w);m=1>v?Da:A.light?bb:ca;d.put(m);z=m.length;d.put(z);m[z]=l;m[z+1]=l+1;m[z+2]=l+2;m[z+3]=l+1;m[z+4]=l+2;m[z+5]=l+3;m.changed=!0}},Nc=function(c,b,e,d){var f=n.now(),h=c.bufferID;w[0]=b;
w[1]=e;w[2]=d;w[3]=f;w[4]=b;w[5]=e;w[6]=d;w[7]=f;w[8]=b;w[9]=e;w[10]=d;w[11]=f;w[12]=b;w[13]=e;w[14]=d;w[15]=f;k.bindBuffer(k.ARRAY_BUFFER,Vd);k.bufferSubData(k.ARRAY_BUFFER,16*h,w);k.bindBuffer(k.ARRAY_BUFFER,null);if(c.tempChild)for(f=0,c=c.tempChild,h=c.length;f<h;Nc(c[f++],b,e,d));},ni=function(c,b,e,d,g,h){Ob[0]=c;Ob[1]=b;Ob[2]=e;Ob[3]=c+d;Ob[4]=b;Ob[5]=e;Ob[6]=c;Ob[7]=b+g;Ob[8]=e;Ob[9]=c+d;Ob[10]=b+g;Ob[11]=e;k.bindBuffer(k.ARRAY_BUFFER,Ec);k.bufferSubData(k.ARRAY_BUFFER,12*h,Ob);k.bindBuffer(k.ARRAY_BUFFER,
null)},Fk=function(c,b,e,d,g){w[0]=c;w[1]=b;w[2]=e;w[3]=d;w[4]=c;w[5]=b;w[6]=e;w[7]=d;w[8]=c;w[9]=b;w[10]=e;w[11]=d;w[12]=c;w[13]=b;w[14]=e;w[15]=d;k.bindBuffer(k.ARRAY_BUFFER,Qb);k.bufferSubData(k.ARRAY_BUFFER,16*g,w);k.bindBuffer(k.ARRAY_BUFFER,null)},nb=function(c,b,e){void 0==e&&(e=32);c.z32&&(b*=c.z32);var d=c.x32*e;e*=c.y32;c.wh?ni(d,e,b,c.wh[0]-Z[c.img][8],c.wh[1]-Z[c.img][9],c.bufferID):ni(d,e,b,0,0,c.bufferID);if(c.tempChild)for(b=c.tempChild,d=0,e=b.length;d<e;d++){var g=b[d];g.x32=c.x32;
g.y32=c.y32;nb(g,32*c.y32)}},La={getRadix:function(){return rb[this.zLevel]},checkMana:function(c,b,e,d){if(!this.mana)return!1;if(0>this.mana-c)return this.manaTask=[e.url,b,c],this.stay55(),c>this.manaMax&&d&&(this.blockedCost=d,b=this.setupChild(pb.curse,1),this.blocked=2,this.blockedimg=b,this.manaTarget=c,k.bindBuffer(k.ARRAY_BUFFER,Qb),k.bufferSubData(k.ARRAY_BUFFER,16*this.bufferID,Mf),k.bufferSubData(k.ARRAY_BUFFER,16*b.bufferID,Mf)),!1;this.mana-=c;return!0}},lc=function(c,b){return n.editor?
!0:c.freezed||c.confused?!1:H[c.spy||c.kingdom].control[b.spy||b.kingdom]};La.changeKingdom=function(c){xa[this.kingdom][this.type].quit(this.id);ac[this.id]&&(ac[this.id]=0,G.quit(this.id),0==G.length&&(ka([]),Ue(),Bc=-1),ii(this.id));this.kingdom=c;Ac(this);this.childBuild&&(this.childBuild=0);if(!this.build||this.arrow)n.editor||this.stay();xa[c][this.type].put(this.id)};La.aspettare=function(){this.nodes=void 0;this.getRadix()[this.x32+this.y32*A]=this.id;this.waiting=!0;na(this,this.url.idle);
Nc(this,0,0,0);ec(this,~~(32E3/this.spd))};La.addItem=function(c){var b=this.inventory;b&&(b[b.length]=c.id,c.in=this.id,c.sword||c.shield)&&(c.attack&&(this.attack+=c.attack),c.defence&&(this.defence+=c.defence))};La.showInventory=function(){ji();for(var c=this.inventory,b=0;8>b;b++){var e=c[b];if(!e)break;var d=Ua[b];d.style.backgroundPosition="0px "+48*e.iconID+"px";d.className="";Ag[b]=null}};La.deleteItem=function(c){this.inventory.quit(c.id);this.attack-=c.attack;this.defence-=c.defence};La.useItem=
function(c){48==c.type&&(this.health+=c.lives,this.health>this.maxHealth&&(this.maxHealth=this.health),this.inventory.quit(c.id))};La.onattack=function(c){!this.attack||this.freezed||this.death||this.item||this.func!=qd.url&&this.func||xc(c.id,[this.id],1)};La.setupINTV=function(c,b,e,d){this.funcObj=b;c.url||O(c,c.url);Li(this);this.changeFunc(c.url,d);this.deleteWorker();ec(this,e);return e};La.damage=function(c,b){if(!(this.zolotoy||this.death||this.stoned)){this.defence&&(c-=this.defence);1>c&&
(c=1);this.health-=c;b=H[b.kingdom].stats;b.dmgInflicted+=c;var e=H[this.kingdom].stats;e.dmgTaken+=c;1>this.health?(this.build?(e.buildsLosed++,b.buildsKilled++):(e.unitsLosed++,b.unitsKilled++),this.die()):da(this.id,1)}};var da=function(c,b){if(ac[c]||!1===c)return c=G.length,1===c?(c=x[G[0]],S.stockActive==c&&c.inventory.length?(Sc(c.id,1,1),jk(c,1)):c.build?Pa(c,1):Sc(c.id,b)):1<c?Eg(G,b):vk(Cb),!0};La.setupSpellIMG=function(c){this.invisible&&Gd(this.id);this.url.spell?(na(this,this.url.spell,
1),c||hb({func:Hk,data:this.id},Za(this.img),1)):this.stay()};var Hk=function(c){c=x[c];c.death||c.stay()};La.setupChild=function(c,b,e){var d={x32:this.x32,y32:this.y32,d:c.d,img:c.img,mv:c.mv,parent:this.id,z32:c.z32};if((this.dix||this.diy)&&!this.waiting){var g=.001*(n.now()-this.timestamp);d.x32+=this.dix*g/32-Math.sign(this.dix);d.y32+=this.diy*g/32-Math.sign(this.diy)}if(c.select){if(this.space)c=this.space[this.space.length-1],h=(this.space.length-1)/c;else{c=this.sSizex||1;var h=this.sSizey||
1}this.z32&&(d.z32=this.z32);d.wh=[32*c-3,32*h-3];this.selectAnim=d}yb(d);g&&Nc(d,this.dix,this.diy,0);e&&(k.bindBuffer(k.ARRAY_BUFFER,Qb),k.bufferSubData(k.ARRAY_BUFFER,16*d.bufferID,e));this.tempChild||(this.tempChild=[]);this.tempChild.put(d);b||Lb.new(d,Za(d.img),Ik);return d};var Ik=function(c){x[c.parent].tempChild.quit(c);Db(c)};La.distance=0;var na=function(c,b,e,d){c.img=b;Z[b]||O(b);(b=Z[b])||O(c);var f=b[0],h=b[1];0<=h&&(h*=.001);d&&(h*=d);b=b.id+4*c.d*b[2];d=-1;1===e?d=n.now():0>e&&(d=
1);e=d;c=c.bufferID;w[0]=b;w[1]=e;w[2]=f;w[3]=h;w[4]=b+1;w[5]=e;w[6]=f;w[7]=h;w[8]=b+2;w[9]=e;w[10]=f;w[11]=h;w[12]=b+3;w[13]=e;w[14]=f;w[15]=h;k.bindBuffer(k.ARRAY_BUFFER,sd);k.bufferSubData(k.ARRAY_BUFFER,16*c,w);k.bindBuffer(k.ARRAY_BUFFER,null)};La.setupDir=function(c,b,e){c=Math.sign(c);b=Math.sign(b);c=3*(b-1)+(c+1);2==c?this.d=1:-6==c?this.d=5:0==c?this.d=7:-4==c?this.d=3:-1==c?this.d=2:1==c?this.d=0:-5==c?this.d=4:-3==c&&(this.d=6);e&&(this.d=(this.d+e)%8)};La.setupDirBuild=function(c){var b=
K;1==c.health&&0==c.built&&(b=Nb[c.kingdom]);c=c.id;var e=A,d=this.x32+this.y32*e;b[d+e]==c?this.d=0:b[d-e]==c?this.d=4:b[d+1]==c?this.d=2:b[d-1]==c?this.d=6:b[d+e+1]==c?this.d=1:b[d-e+1]==c?this.d=3:b[d+e-1]==c?this.d=7:b[d-e-1]==c&&(this.d=5)};La.spdMod=0;var bg=function(c,b){for(var e=b.length,d=0;d<e;d++){var g=x[b[d]];g.build||(g.spd=c)}};La.changeFunc=function(c,b){var e=this.func;this.func=c;if(Yd){if(void 0!==this.workingOn)var d=x[this.workingOn];(e=mb[e])&&e.rule&&vh(-1,this,e.rule,d);(c=
mb[c])&&c.rule&&vh(1,this,c.rule,b)}};La.stay=function(c){this.mv=1;this.time=void 0;this.diy=this.dix=0;this.nodes=this.c=void 0;this.xf=null;Nc(this,0,0,0);if(!c){c=this.action==Fd.url||this.func==Zf.url;this.changeFunc(void 0);this.stock&&0!==this.stock[0]?na(this,this.img,NaN):na(this,this.__proto__.img,1);this.buildList&&(this.buildList=void 0);this.deleteWorker();if(this.standardFunc&&2!==this.stop&&void 0==this.spy)return this.standardFunc(this);c&&qd(this)}};La.stay55=function(){this.changeFunc(void 0);
this.stock&&0!==this.stock[0]?na(this,this.img,NaN):na(this,this.__proto__.img,1);this.deleteWorker();this.standardFunc&&2!==this.stop&&void 0==this.spy&&this.standardFunc(this)};var rm=[],Db=function(c){c.elemtId&&(Jk(c.elemtId,c.typeBuffer),c.elemtId=void 0,c.typeBuffer=void 0)},Hh=function(c){if(c.childLoc){c=c.childLoc;for(var b=0,d=c.length;b<d;b+=2)Jk(c[b+1],c[b])}},Jk=function(c,b){b[c]=NaN;b[c+1]=NaN;b[c+2]=NaN;b[c+3]=NaN;b[c+4]=NaN;b[c+5]=NaN;b.changed=!0;rm.put(c)};La.addWorker=function(c){this.workers.put(c.id);
c.workingOn=this.id};La.deleteWorker=function(){this.workingOn&&(x[this.workingOn].workers.quit(this.id),this.workingOn=0);this.actionItem&&(this.actionItem=void 0);this.blockedAction()};La.blockedAction=function(c){var b=this.blocked;if(Kk[b])Kk[b](this,c)};var Kk={2:function(c,b){c.blocked=void 0;Ac(c);Ik(c.blockedimg);c.blockedimg=void 0;c.manaTarget=void 0;b||(H[c.kingdom].setupResources(c.blockedCost,-1),c.blockedCost=void 0)}},dk=function(c){return m.delay[-c[1]+c[0]-1]},re=function(c){var b=
G.length;G.quit(c);if(b!=G.length){var d=x[c];d.selectAnim=void 0;b=0;for(d=d.tempChild;b<d.length;b++){var f=d[b];Db(f);var g=d.length;d.quit(f);g!=d.length&&b--}ac[c]=void 0;0==G.length?Ue():1==G.length?Sc(c):Eg(G)}Cb&&Cb.id===c&&(Ue(),Cb.selectAnim&&(Db(Cb.selectAnim),Cb.selectAnim=void 0),Cb=void 0)};La.base=function(c){return rb[this.zLevel][c]};La.rbase=function(){return rb[this.zLevel]};var ug,hi=function(c){jc.put(c.bufferID);if(c.child){var b=0;c=c.childLoc;for(var d=c.length;b<d;b+=2)jc.put(c[b][c[b+
1]])}};La.die=function(c){if(!this.death){var b=A,d=this.id,f=this.kingdom,g=H[f];this.waitlist&&(g.unitLoading-=.5*this.waitlist.length);if(this.dieSound&&!n.editor){var h=this.dieSound;Ea(h[~~(h.length*Math.random())],this.x32,this.y32)}re(this.id);(this.freezed||this.invisible)&&Ac(this);var l=this.x32,k=this.y32;this.death=1;1==this.zLevel&&(ug[l+k*b]=1);this.c=void 0;var u=this.url.die||this.dimg;!1===this.built&&g.building.quit(this.id);void 0!=g.IAD&&g.k&&!this.item&&lb.arr[g.IAD].valorateLost(this);
if(this.food&&!n.editor){var q=I.itemMaxSize,t=this.food/q,r=~~t,w=~~((t-r)*q);for(h=0;h<t;h++){h==r&&w&&(q=w);var v=Kj(l,k),z=~~(v/b);v%=b;v=new dd(52,f,v,z,0);na(v,m.item_meat);v.contain=[q,2,Sl]}}g.stats.unitCountDeath[this.type]++;h=this.x32;b=this.y32;c||n.editor?(Db(this),hi(this)):u?(this.mv=!0,na(this,u,1),c=Z[this.img],u=c[1],u=0>u?dk(c):1E3*c[0]/u,hb({func:ck,data:this.id},u-25,1),Nc(this,0,0,0),void 0!==this.dix&&(c=.001*(n.now()-this.timestamp),this.x32+=this.dix*c/32-Math.sign(this.dix),
this.y32+=this.diy*c/32-Math.sign(this.diy))):this.dimgInfinity?(this.dimgRND&&(this.d=this.id%this.dimgRND),na(this,this.dimgInfinity)):(Db(this),hi(this));Hh(this);this.techStart&&Sf(0,[this.id]);nb(this,32*this.y32-36);this.x32=h;this.y32=b;this.build||this.item||this.cow||g.values.pop--;this.population&&this.built&&(g.values.popMax-=this.population);k=this.validator(l,k,this.space,this.kingdom);c=k[0];if(this.onbuild&&!n.editor)for(l=this.onbuild,u=g.technology,h=u.disabled,u=u.actived,b=0;b<
l.length;b++)f=l[b].id,u[f]--,0===u[f]&&h[f]++;l=this.validator.dimension;h=0;for(u=c.length;h<u;h++)b=c[h],l[b]=Ub[b]?Ub[b]:0;if(1==this.health&&!this.built)for(b=Nb[this.kingdom],h=0,u=c.length;h<u;b[c[h++]]=void 0);if(k[2])for(c=k[2],h=0,u=c.length;h<u;h++)b=c[h],Ub[b]?(2<l[b]&&x[l[b]].die(1),l[b]=Ub[b]):(2<l[b]&&x[l[b]].die(),l[b]=0);xa[this.kingdom][this.type].quit(this.id);Li(this);if(this.workers){h=0;l=this.workers.slice(0);for(u=l.length;h<u;h++)k=x[l[h]],k.workingOn===d&&(k.workingOn=0,
k.func!==Nh.url&&k.stay());this.workers.length=0}this.deleteFromList&&(l=this.deleteFromList,l.quit(this),l.length||l.length0function(this));this.time=void 0;this.changeFunc(void 0);this.diy=this.dix=0;this.inventory&&0<this.inventory.length&&Ed(this.id,this.inventory.slice(0));this.stock&&Ij(this);n.editor||(g.check(),ne(this.kingdom),g.checkPopArray());this.deleteWorker()}};Array.prototype.quit=function(c){c=this.indexOf(c);return-1<c?(this.splice(c,1),!0):!1};Array.prototype.add=function(c){0>
this.indexOf(c)&&(this[this.length]=c)};var cb=["European","Arab","Asian"],Bj={euro:"Lancelot Arthur Guivain Merlin Blackthorn Morin Golstuck Karambol Kelerick Rockmore Bridport Casevil Stirm Tonis Pelegrim Peresohn Pirk Pharn Gork".split(" "),arab:"Ibn Fadlan;Mohammad;Al Ferissa;Harun Al Rashid;Sindbad;Mellemad;Moarrac;Sakhavan;Bellefars;Mokhac;Norahz;Kerhetin;Maham;Dushesh;Direkh".split(";"),asia:"Ishida Toranaga Ichinzen Haiako Mozuki Hitachi Tosheba Harachiko Marasuma Korodzum Ishinghen Genghis Musa Echibo Ichikahr Yotokan Maraga".split(" "),
common:"Fistantilus Skenderbeg Raislin Tenis Morok Sokob Baras Haram Billihz Ynte Orgh Savael Birgos Savator Gandeh Gordor Fessh Gilmi Phergas".split(" ")},hh=[q.gold,q.wood,q.food,q.stone,q.mana],Yh=function(c,b,d){d&&(c=c.replace("%d",d));return c.replace("%s",b)},Md={},si,Tc,nd={},Xd=function(c){n.infinity=void 0;if(""!=t("mapconfiguration").innerHTML){c="mapx mapwidth goldRes goldValue woodRes woodValue foodRes foodValue stoneRes stoneValue infinity infiniteValue water waterValue terrainType terrainSelect items itemsValue peons peonValue gateways gatewaysValue freePop freePopValue".split(" ");
for(var b=0,d=c.length;b<d;b+=2){var f=document.getElementById(c[b+1]).value;"infinity"==c[b]?(f=document.getElementById(c[b+1]).checked,n[c[b]]=f):parseInt(f)?n[c[b]]=parseInt(f):n[c[b]]=f;localStorage[c[b]]=f}}else"true"==localStorage.infinity&&(n.infinity=!0),n.goldRes=parseInt(localStorage.goldRes),n.foodRes=parseInt(localStorage.foodRes),n.woodRes=parseInt(localStorage.woodRes),n.stoneRes=parseInt(localStorage.stoneRes),n.mapx=parseInt(localStorage.mapSize),n.water=parseInt(localStorage.water),
n.terrainType=localStorage.terrainType,n.items=parseInt(localStorage.items),n.peons=parseInt(localStorage.peons),n.gateways=parseInt(localStorage.gateways),n.freePop=parseInt(localStorage.freePop);n.infinity&&(n.goldRes=Infinity,n.foodRes=Infinity,n.woodRes=Infinity,n.stoneRes=Infinity);n.infinity=void 0;n.goldRes||(n.goldRes=Infinity);n.foodRes||(n.foodRes=Infinity);n.woodRes||(n.woodRes=Infinity);n.stoneRes||(n.stoneRes=Infinity);n.mapy=n.mapx;n.gravity=580.9/9.8*9.8;n.name="";n.arje=555555*Math.random()+
1;Lk(n);return n},Si=function(){n.online&&(sm(q.initializing),n.editor=0);n.mapx||Xd();n.pausedTime=0;n.canceled=0;for(var c=Object.keys(d),b=H.length,e=0,f=c.length;e<f;e++){var g=d[c[e]];g.id=e;if(g.disabled)for(var h=0;h<b;H[h++].technology.disabled[e]=g.disabled);if(g.hidden)for(h=0;h<b;H[h++].technology.hidden[e]=1);}var l=performance.now();Cc=document.getElementById("msgs1");n.online||(location.hash="");ta("playermenu");ta("index");ib("menu");ib("statButton");ta("mapeditorinfo");ta("mapeditorinfotop");
ib("resources");tb=H[v.kingdom];dg(v.kingdom);si||(si=JSON.parse(JSON.stringify(H.slice(1))));setTimeout(function(){n.cycle?n.deltaTime=25*n.cycle:(n.players=H.length-1,n.date=Date.now(),n.cycle=0,n.kingdoms=H,n.deltaTime=0);n.loadDate=Date.now();n.online||$h();n.now=tj;n.paused=0;n.pausedTime=0;n.zMax=96*n.mapy;Yb();var b=performance.now();n.allow14=!0;A=n.mapx;Ka=n.mapy;n.temperature=25;var c=n.temperature;0==v.temperature&&(c+="&deg;C");document.getElementById("temperature").innerHTML=c;V=1;tm();
Ue();ug={};var e=A,f=-e,g=+e;fc=[1,1+f,f,-1+f,-1,-1+g,g,g+1];uj=[f,-1,1,g];n.online&&ib("content");for(var h=["loading","playermenu","index"],z=h.length,F=0;F<z;document.getElementById(h[F++]).style.display="none");t("loadingtext").innerHTML="Loading terrain";b=performance.now();if(!1!==n.arje){var G=A,I=G*Ka,M=Math.sqrt(I),N=0,P=0,R=0,S=0,T=0,Y=0,ba=0,da=0,aa=0,ca=0,ka=0,la=0,ha=0,ma=100,pa=255,qa=0,na=0,ia=0,ta=new Int8Array(new ArrayBuffer(I)),ra=new Uint32Array([2,3,0,1,1,1,0,1,0,1,0,1,3,n.water,
1,0,1,1,1,0,0,15,0,1]);for(Xl(n.arje);aa<I;ta[aa++]=0);var ya=ra.length;for(aa=0;aa<ya;aa+=4)ra[aa+3]&&(ra[aa+1]=~~(M/ra[aa+1]));for(ca=0;ca<ya;ca+=4)for(ma=ra[ca+1],pa=ra[ca],qa=ra[ca+2],aa=0;aa<ma;aa++)for(la=~~(oa()*I+.5),T=6*oa()-3,Y=6*oa()-3,qa?(da=oa()*M,ia=~~(oa()*(M/15))+4,ba=~~(100*oa())/4,na=ia/12):(da=128*oa(),ia=~~(2.56*oa())+4,ba=~~(100*oa())/2,na=1),N=la%G,P=~~(la/G),ka=0;ka<da;ka++)for(100*oa()>ba&&(T=(6*oa()-3)*na,Y=(6*oa()-3)*na),N+=T,P+=Y,R=0;R<ia;R++)for(S=0;S<ia;S++)(R-ia/2)*(R-
ia/2)+(S-ia/2)*(S-ia/2)<ia*ia/4&&(ha=~~N+R+(S+~~P)*G,ha>=I?ha%=I:0>ha&&(ha+=I),ta[ha]=pa);performance.now();Tc=ta}else Tc=n.terrain?new Int8Array(n.terrain):new Int8Array(A*Ka);nd.randomtxt=performance.now()-b;b=performance.now();t("loadingtext").innerHTML="Creating map";var xa=A*Ka*4;K=new Uint32Array(new ArrayBuffer(xa));Sa=new Uint32Array(new ArrayBuffer(xa));ld=new Uint32Array(new ArrayBuffer(xa));oc={};L.dimension=K;Xe.dimension=Sa;Ck.dimension=K;qh.dimension=Sa;X.dimension=K;Gg.dimension=ld;
Gb.dimension=Sa;Fg.dimension=K;rb[0]=Sa;rb[1]=K;rb[2]=ld;nd.createMap=performance.now()-b;t("content").style.display="block";b=performance.now();if(!1===n.arje||n.allunits)B=n.allunits;else{var Ba=Tc,sa=n.mapx,Aa=n.mapy,Ea=performance.now(),ea=0,ua=0,La=0,Ga=0,Ha=0,za=sa*Aa,Ra=Math.sqrt(za);ua=za;B=[];Nd={};var Ja=um,Ua=vm,Va=Nd,Za=wm,bb=[12,63,62],Fa=[];ua=H.length;for(ea=1;ea<ua;ea++){for(var Ta=!0,Wa=H[ea],hb=bb[Wa.race],ab=0;Ta&&25>ab;){ab++;Ga=~~(oa()*(sa-15)+.5)+4;Ha=~~(oa()*(Aa-15)+.5)+4;Ta=
!1;La=Fa.length;for(var wa=0;wa<La;wa+=2)60>Math.sqrt((Ga-Fa[wa])*(Ga-Fa[wa])+(Ha-Fa[wa+1])*(Ha-Fa[wa+1]))&&(Ta=!0);Ta||(Fa.push(Ga+4,Ha+3),Ja(Ga+Ha*sa,{type:hb,kingdom:ea}))}if(25==ab){H.length=ea;break}}var db=2*(ua-1);for(wa=0;wa<db;wa+=2){var eb=2*Math.round(oa())-1;var kb=Fa[wa]+10*(2*Math.round(oa())-1)+~~(3*oa());var Oa=Fa[wa+1]+10*eb+~~(3*oa());var Ca=Fa[wa]+10*(2*Math.round(oa())-1)+~~(3*oa());var qb=Fa[wa+1]+10*-eb+~~(3*oa());0>kb?kb=0:kb+4>A&&(kb-=(kb+4)%za);0>Oa?Oa=0:Oa+4>Ka&&(Oa-=(Oa+
4)%za);0>Ca?Ca=0:Ca+4>A&&(Ca-=(Ca+4)%za);0>qb?qb=0:qb+4>Ka&&(qb-=(qb+4)%za);Infinity!==n.goldRes&&Ja(kb+Oa*sa,{type:21});Infinity!==n.stoneRes&&Ja(Ca+qb*sa,{type:22})}if(Infinity!==n.goldRes){ea=0;for(var cb=10*A*Ka/65536;ea<cb;ea++)Ja(~~(oa()*za),{type:21})}if(Infinity!==n.stoneRes)for(ea=0,cb=10*A*Ka/65536;ea<cb;ea++)Ja(~~(oa()*za),{type:22});ua=1*~~(Ra/3.2);for(ea=0;ea<ua;ea++){var mb=~~(oa()*sa+.5);var nb=~~(oa()*Aa+.5);var ob=~~(25*oa())+10;var pb=~~(25*oa())+10;for(Wa=0;55>Wa;Wa++){Ga=~~(oa()*
ob+~~(mb+18*oa()-9)+.5);Ha=~~(oa()*pb+~~(nb+18*oa()-9)+.5);var Pa=Ga+Ha*sa;Ua(Pa)&&Pa<=za&&Ja(Pa,{type:7,d:~~(28*oa()+3)})}}ua=parseInt(n.items);for(ea=0;ea<ua;ea++){Pa=~~(oa()*za+.5);var Qa=oi[~~(oa()*oi.length)],Ma=Object.assign({},Qa);Ma.d+=~~(Qa.dMax*oa());if(Qa.sword||Qa.potion)Ma.attack=~~(6*oa())+1;if(Qa.shield||Qa.potion)Ma.defence=~~(6*oa())+1;if(Qa.book){var lb=~~(oa()*Ig.length);Ma.spell=Ig[lb];Ma.iconID=d[Ig[lb]].iconIDbook;Ma.name=q[Ma.spell];Ma.attack=~~(6*oa())+1}Ja(Pa,Ma)}ua=parseInt(n.gateways);
for(ea=0;ea<ua;ea++)Pa=~~(oa()*za),Ua(Pa)&&Ja(Pa,{type:43});for(wa=0;wa<db;wa+=2)for(kb=Fa[wa]-25,Oa=Fa[wa+1]-25,Ca=0;50>Ca;Ca++)for(qb=0;50>qb;qb++)if(625>(Ca-25)*(Ca-25)+(qb-25)*(qb-25)){var $a=Ca+kb+(qb+Oa)*sa;7===Za($a).type&&(B.quit(Va[$a]),Va[$a]=void 0);1===pc.type[Ba[$a]]&&(Ba[$a]=0)}nd.random=performance.now()-Ea}n.movtable&&!n.demo&&(bd=n.movtable,cd=n.movtable2);var sb=performance.now();t("loadingtext").innerHTML="Loading textures";sl(Tc);nd.setupGL=performance.now()-sb;var xb=performance.now(),
jb=n.tr,Ya=B;if(!n.custom&&Ya){for(var Bb=n,tb=Ya,vb="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy".split(" "),zb={},Xa=0;Xa<vb.length;Xa++)zb[vb[Xa]]=Xa;var Cb=[],Ib=tb.length;for(Xa=0;Xa<Ib;Xa++){var Eb=tb[Xa],Ab=Object.keys(Eb),Fb={};Cb.put(Fb);for(var ub=0,Mb=
Ab.length;ub<Mb;ub++)Fb[zb[Ab[ub]]]=Eb[Ab[ub]]}Bb.ini=Cb}n.demo&&(Ya=n.ini);if(Ya)for(var Db=0,Ub=Ya.length;Db<Ub;Db++){var Ia=Ya[Db];if(void 0!==Ia.race){Ia.type=xm[Ia.type+256*Ia.race];Ia.kingdom=jb[Ia.kingdom];if(void 0==Ia.type)continue;var Vb=y[Ia.type];if(13==Ia.type||Vb.build)Ia.d=0;Ia.resource&&(Ia.health=Ia.resource,Ia.maxHealth=Ia.resource);if(!Ia.health||void 0==Ia.kingdom)continue}if(Ia.death)x.put(Ia);else if(!Ia.cancell){var Ob=Ia.x32,Rb=Ia.y32,Sb=!1===Ia.built&&1===Ia.health?!0:!1,
Tb=Ia.kingdom||0,Nb=new dd(Ia.type,Tb,Ob,Rb,0,Sb,Ia);Nb.invalid||(Sb||Lj(Nb),Nb.castle&&(H[Tb].origin=[Ob+4,Rb+3]))}}Nd=B=null;nd.positioned=performance.now()-xb;nd.setupGL=performance.now()-b;yb(wb);yb(C);ne(v.kingdom);Xh();Mk();window.addEventListener("keydown",nk);window.addEventListener("keyup",ok);window.addEventListener("mousemove",pk);window.addEventListener("wheel",di,!1);W=Zb;fa=new Float32Array(12);var va=Z[m.blank].id;w[0]=va;w[1]=0;w[2]=1;w[3]=0;w[4]=va;w[5]=0;w[6]=1;w[7]=0;w[8]=va;w[9]=
0;w[10]=1;w[11]=0;w[12]=va;w[13]=0;w[14]=1;w[15]=0;var Wb=Da;Wb[0]=0;Wb[1]=1;Wb[2]=2;Wb[3]=1;Wb[4]=2;Wb[5]=3;k.bindBuffer(k.ARRAY_BUFFER,sd);k.bufferSubData(k.ARRAY_BUFFER,0,w);k.bindBuffer(k.ARRAY_BUFFER,Qb);var Pb=3*v.kingdom,Hb=Na[Pb],Jb=Na[Pb+1],Kb=Na[Pb+2];k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([Hb,Jb,Kb,.5,Hb,Jb,Kb,.5,Hb,Jb,Kb,.5,Hb,Jb,Kb,.5]));var Lb=96*A;fa[2]=Lb;fa[5]=Lb;fa[8]=Lb;fa[11]=Lb;window.addEventListener("mousedown",qk);window.addEventListener("mouseup",rk);O("FULL: ",
performance.now()-l);tf=!1;n.record||(n.record={});n.online?(Gc(od(),q.waitingPlayers,1),v.admin?Uc():(O("live ready"),Q(Uc,0,0))):kf();n.allow14=!1;md.list.push(0,JSON.stringify(nd))},300)},od=function(){for(var c=Ra.length,b=Ra,d="",f=0;f<c;f++){var g=b[f];od.obj[g.id]||g.id==v.onlineID||(d+="<br>"+g.nhinfo.name)}return d};od.obj={};var Qi=function(){return v.gl?!1:(Gc("You can't run WEBGL 2<br>More info <a href='http://webglreport.com/?v=2'>here</a>","Error"),cc(),!0)},tf=!1,Yd,xl=function(c){var b=
{};Yd={events:{defined:b,nodefined:{}}};for(var d={moving:1},f=0,g=0,h=c.length;g<h;g++){var l=c[g];l.activeEvents=0;for(var k=l.events,m=0,n=k.length;m<n;m++){var q=k[m];q.id=f++;var r=q.list,t=q.to,v=q.type,w=q.zone;q.rule=l;for(var x=q.activeEvents=0,z=r.length;x<z;x++){var y=r[x];b[y]||(b[y]={});y=b[y];if(d[v])y[v]||(y[v]=[]),y[v].put(q);else if("zone"==v){y[v]||(y[v]=[]);for(var A=0;A<w.length;A++)y[v].push(q,w[A][0],w[A][1],w[A][2],w[A][3])}else{y[v]||(y[v]={defined:{}});y=y[v].defined;A=0;
for(var B=t.length;A<B;A++)y[t[x]]||(y[t[x]]=[]),y[t[x]].put(q)}}}}},Xh=function(){var c=document.getElementById("playersinfo");c.innerHTML="";if(!n.editor)for(var b=1,d=H.length;b<d;b++){var f=H[b],g=f.death?f.name.strike():f.name;c.innerHTML+=g+"<span id='score"+b+"'></span><div class='playercolor' style='background:rgb("+f.color[0]+","+f.color[1]+","+f.color[2]+")'></div><span class='ping'>"+(void 0!=H[b].ping&&" "+H[b].ping+"ms"||"")+"</span><br>"}},Mk=function(){var c=window.innerWidth-v.mx,
b=window.innerHeight,d=H[v.kingdom].origin;d?(c=32*d[0]-.5*c,b=32*d[1]-.5*b):b=c=0;wd(~~c,~~b)},Te,wk,lk,tm=function(){var c=document.getElementById("selectedobject").getContext("webgl",{antialias:!1,depth:!1}),b=c.createShader(c.VERTEX_SHADER);c.shaderSource(b,"void main() {\ngl_Position = vec4(0 ,0, 0, 1);\ngl_PointSize=48.0;\n}");c.compileShader(b);var d=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(d,"precision mediump float;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nuniform float txtCoord;\nvoid main() {\ngl_FragColor = texture2D(u_image, (vec2(\tmod(txtCoord,21.0) ,floor(txtCoord/21.0) ) + gl_PointCoord)*(0.046875));\nif(gl_FragColor.r==gl_FragColor.g&&gl_FragColor.r==gl_FragColor.b) gl_FragColor*=u_color;\n}");
c.compileShader(d);var f=c.createProgram();c.attachShader(f,b);c.attachShader(f,d);c.linkProgram(f);c.useProgram(f);b=c.createTexture();c.bindTexture(c.TEXTURE_2D,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texImage2D(c.TEXTURE_2D,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,S.icons);var g=c.getUniformLocation(f,"u_color"),
h=c.getUniformLocation(f,"txtCoord");Te=function(b){if(Z[b.img][3]){var d=b.kingdom;c.uniform4f(g,Na[3*d],Na[3*d+1],Na[3*d+2],1)}else c.uniform4f(g,1,1,1,1);c.uniform1f(h,b.iconID);c.drawArrays(c.POINTS,0,1)};wk=function(){c.uniform4f(g,1,1,1,1);c.uniform1f(h,189);c.drawArrays(c.POINTS,0,1)};lk=function(){c.uniform1f(h,0);c.uniform4f(g,0,0,0,0);c.drawArrays(c.POINTS,0,1)}},bc=128,Rb=128,x=[{terrain:1},{terrain:1},{terrain:1}],Ub={},ne=function(c){c===v.kingdom&&(c=tb.values.popMax<tb.values.popLimit?
tb.values.popMax:tb.values.popLimit,document.getElementById("pop").innerHTML=tb.values.pop+"/"+c)};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(c){window.setTimeout(c,1E3/60)}}();var Nd=B=void 0;var um=function(c,b){Nd[c]||(b.x32=c%A,b.y32=~~(c/Ka),B.put(b),Nd[c]=b)},vm=function(c){return!B[c]},wm=function(c){return Nd[c]||NaN},Ra=[];window.addEventListener("offline",function(c){ae("Offline",
"#ff0000")});window.addEventListener("online",function(c){ae("Online","#00ff00")});var ti=function(){Va.leaveRoom();Ra.length=0},Od={};(function(){for(var c=["returnmenu","index","Account","accountIframe"],b=0,d=c.length;b<d;Od[c[b]]=document.getElementById(c[b++]));})();var ym=function(){location.replace("#"+this.gameID+"Room")},Xi=function(c){Ra=[];O("connecting to",c,q.loading);t("game").style.display="block";t("gameName").innerHTML=q.loading;t("returnmenu").style.display="none";t("index").style.display=
"none";Vc.innerHTML="";Cc.innerHTML="";ha=[];v.p2p?(Va.joinRoom(c,bh),ah()):(Va||rc(),rc.func=function(){Xi(c)})},zm={6400900:".",28462225:"a",29052100:"b",29648025:"c",3025E4:"d",30858025:"e",31472100:"f",32092225:"g",32718400:"h",33350625:"i",33988900:"j",34633225:"k",35283600:"l",35940025:"m",36602500:"n",37271025:"o",37945600:"p",38626225:"q",39312900:"r",40005625:"s",40704400:"t",41409225:"u",42120100:"v",42837025:"w",4356E4:"x",44289025:"y",45024100:"z"},Am=function(c){t("game").style.display=
"none";Aa.length=0;n.online=0;ia=n.id=void 0;ti();cc();c.constructor==String&&Gc(c)},fk={euro:0,arab:0,asia:0},Zd=function(c,b,d){if(!n.started&&d){O("peerInfo",c);c.name=ua(c.name);c.team=parseInt(c.team);0>c.team&&(c.team=0);c.team%=6;c.race=parseInt(c.race);if(0>c.race||2<c.race)c.race=0;b=c.version;d&&d.admin&&b!=v.version&&(cc(),Va.leaveRoom(),Gc(q.versionError+"<p> Admin version: "+parseFloat(b.substr(1))+"<br> Your version: "+parseFloat(v.version.substr(1))));d.nhinfo=c;d.username=c.name;Pd()}},
ha,eb=function(c,b,d){ha=c;Pd()},vf=function(){return{version:v.version,color:v.color,team:v.team,race:v.race,name:v.name}},za=function(c,b){if(b.resend)if(c.destinatary)(b=Qd(c.destinatary))&&b.id!=v.onlineID&&(c.bridge=h.id,b.send(c));else{b=b.resend;for(var d=0,f=b.length;d<f;d++){var g=b[d];c.bridge=h.id;g.send(c)}}else{var h=b;void 0===c.length?void 0!==c.func&&(b=Lf[c.func],Nk(b,c[1],c[2],h)||b(c[1],c[2],h)):(b=c[0],h.orderList[b]=c,za.done[b]||(za.done[b]=0),za.done[b]++,za.done[b]==Ra.length&&
za.func&&(za.func=!1,Cd(),Yb()))}};za.done=[];var Qd=function(c){for(var b=0,d=Ra.length;b<d;b++){var f=Ra[b];if(f.id==c)return f}},Va,Pk=function(c){if(!t("usernameForm")){Sb();var b=localStorage.name||"Guest",d=localStorage.color||"#"+Math.floor(16777215*Math.random()).toString(16),f=document.createElement("div");f.id="usernameForm";f.innerHTML="\n            <div>\n            <h2>"+q.username+'</h2>\n            <div>\n<input type="color" id=\'usernameColor\' value="'+d+'" /><input id=\'usernameVal\' type="text" value="'+
Ok(b)+'" />\n</div>\n<br />\n</div>';b=document.createElement("button");b.innerHTML=q.continue;b.onclick=function(){v.name=ua(t("usernameVal").value);v.color=t("usernameColor").value;localStorage.color=v.color;localStorage.name=v.name;document.body.removeChild(t("usernameForm"));c();Ma()};f.children[0].appendChild(b);document.body.appendChild(f)}},rc=function(){Qi()||(v.name?(Dl(),Va=new SimpleWebRTC({localVideoEl:"",remoteVideosEl:"",autoRequestMedia:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},
url:"https://solar.tza.red/"}),Va.on("channelMessage",function(c,b,d){"nehhof"==d.type&&za(d.payload,c)}),Va.on("error",function(c){"full"==c&&(cc(),ae(q.gameFull,"#ff0000"))}),Va.on("connectionReady",function(c){var b=Va.connection.connection;v.p2p=b;b.username=v.name;b.color=v.color;b.on("getRooms",function(b){var c=b.date,d=Object.keys(b),e=t("gameList");if(1<d.length){e.innerHTML="";for(var l=0,k=d.length;l<k;l++){var m=d[l],n=b[m];if("date"!=m){var v=n.len;if(v){var r=document.createElement("tr"),
w="";w=n.playing?w+("<td><div class='redCircle'></div>"+q.playing+"</td>"):w+("<td><div class='redCircle' style=\"background:rgba(0,255,0,.8); box-shadow:0px 0px 20px rgba(0,255,0,.8)\"></div>"+q.waiting+"</td></td>");w+="<td>"+ua(n.description)+"</td><td>"+~~((c-n.date)/6E4)+" min ago</td><td>"+ua(v)+"/"+ua(n.max)+"</td>";r.innerHTML=w;r.gameID=m;n.playing||(r.onclick=ym);e.appendChild(r)}}}}else e.innerHTML="<tr><td>No games found</td></tr>"});v.onlineID=c;rc.func&&rc.func()}),Va.on("createdPeer",
function(c){n.started||yl(c)})):Pk(rc))},Bm=function(){ah();Ma();t("game").style.display="block";t("gameName").innerHTML=q.loading;t("returnmenu").style.display="none";t("index").style.display="none";Vc.innerHTML="";Cc.innerHTML="";Ra=[];Vi();v.admin=1;v.room={description:t("gameFormName").value,max:parseInt(t("gameMax").value),public:!0};2>v.room.max&&(v.room.max=2);14<v.room.max&&(v.room.max=14);localStorage.gameDescription=v.room.description;Va.createRoom(v.onlineID+"b",bh);n.online=1;$c(Xd());
document.body.removeChild(t("gameForm"));ha=[v.onlineID];Pd()},Qk=function(){Va||rc();if(v.onlineID){Sb();var c=localStorage.gameDescription||v.name+"'s room",b=document.createElement("div");b.id="gameForm";b.innerHTML="\n<div>\n            <h2>"+q.gameOptions+"</h2>\n            "+q.gameName+': <input id=\'gameFormName\' type="text" value="'+c+'" maxlength="29" /><br />\n'+q.nplayers+': <input id="gameMax" type="number" value="6" max="14" min="2"/><br />\n            </div>';c=document.createElement("button");
c.innerHTML=q.continue;c.onclick=Bm;b.children[0].appendChild(c);document.body.appendChild(b)}else setTimeout(function(){location.hash=""},200),rc.func=Qk},Rk=function(c){for(var b="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy stock".split(" "),d=[],f=c.length,g=
0;g<f;g++){var h=c[g],l=Object.keys(h),k={};d.put(k);for(var m=0,n=l.length;m<n;m++)k[b[l[m]]]=h[l[m]]}return d},Cm=function(c){for(var b=c.length,d=new Uint8Array(b),f=0,g=-1,h=0,l=0;l<b;l++){var k=c[l];if(g===k)h||(d[f++]=255),h++;else{if(h){if(4>h){f--;for(var m=0;m<h;m++)d[f++]=g}else d[f++]=h>>8&255,d[f++]=h&255;h=0}d[f++]=k}g=k}if(h)if(4>h)for(f--,m=0;m<h;m++)d[f++]=g;else d[f++]=h>>8&255,d[f++]=h&255;return d.slice(0,f)},lf=[],Q=function(c,b,d,f,g){if(void 0===c.location)return c();if(n.started&&
!n.editor){var e=n.record;e[n.cycle]||(e[n.cycle]=[]);var l=e[n.cycle];e=l.length;l[e]=c.location;l[e+1]=b;d&&d.length&&(d=d.slice(0));l[e+2]=d}if(!n.blocked&&n.online&&Ra.length){if(55===g)var k=!1;g={func:c.location,1:b,2:d,active:k,rnd:4294967296*Math.random()};if(!n.started||c.fast)ui(g),c(b,d);else if(f)for(e=0,b=f.length;e<b;e++)c=f[e],g.destinatary=c.id,c.bridge?c.bridge.sendDirectly("channelMessage","nehhof",g):c.sendDirectly("channelMessage","nehhof",g);else lf.put(g)}else c(b,d)},Dm=function(){Ra.length&&
(Xd(),Uc.i=0,v.p2p.emit("gameStarted"),Q(vi,ia?!1:n,0,0,0))},Uc=function(c,b,d){if(d){if(od.obj[d.id])return;od.obj[d.id]=1;c=od();""==c?Gc(c,q.loading,1):Gc(c,q.waitingPlayers,1)}v.admin&&(Uc.i++,O(Uc.i,Aa.length,d),Uc.i==Aa.length-n.bots&&setTimeout(function(){Q(kf)},100))};Uc.i=0;var ui=function(c){for(var b=0,d=Ra.length;b<d;b++)Ra[b].sendDirectly("channelMessage","nehhof",c)},Nk=function(c,b,d,f){if(!f)return!1;(b=c.secureNH&&!c.secureNH(b,d,f))&&O(c,f);return b},pd,wi,Cd=function(){if(!za.done[pd]||
za.done[pd]<Ra.length)return za.func=!0,Yb(),!0;for(var c=ha,b=0,d=c.length;b<d;b++){if(c[b]==v.onlineID)var f=void 0,g=wi;else{f=Qd(c[b]);if(!f)continue;g=f.orderList[pd]}for(var h=1,l=g.length;h<l;h++){var k=g[h],m=Lf[k.func];Nk(m,k[1],k[2],f)||m(k[1],k[2],f)}}za.func=!1;ui(lf);wi=lf;pd++;lf=[pd+1];return!1};Cd.maxPing=200;var kf=function(){document.getElementById("alert").style.display="none";n.started=1;n.date=Date.now();Yb();Ba();Ma();pd=0;if(!n.custom||n.demo)for(var c=1,b=H.length;c<b;c++){var d=
$a[yg[H[c].race]],f=d.peasant.type;if(d=x[xa[c][d.castle.type][0]])for(var g=0,h=n.peons;g<h;g++)me(f,d,1)}lb.arr=[];lb.units=[];lb.time=500;lb.steps=0;lb.process=0;if(!n.editor&&!n.demo){for(c=0;c<H.length;c++)H[c].IA&&new lb(H[c]);c=0;b=lb.arr;for(f=b.length;c<f;b[c++].leaveMeAloneIKnowWhatToDo());ph()}n.online&&(ui([0]),lf=[1],wi=[0]);Ya()};kf.fast=!0;var vi=function(c,b,d){b=[];d=ha;n=!1!==c?c:ia;for(c=n.bots=0;c<d.length;c++){var e=d[c];e==v.onlineID?(b[c]=v,v.kingdom=c+1):(O(e),e.name?(n.bots++,
b[c]=e,e.IA=1):(e=Qd(e),b[c]=e.nhinfo,e.kingdom=c+1));Aa=b}Ea("bless");n.infinity&&(n.goldRes=Infinity,n.foodRes=Infinity,n.woodRes=Infinity,n.stoneRes=Infinity);n.infinity=void 0;n.goldRes||(n.goldRes=Infinity);n.foodRes||(n.foodRes=Infinity);n.woodRes||(n.woodRes=Infinity);n.stoneRes||(n.stoneRes=Infinity);xd()},Ve=!1,Ma=function(){Ve=!1;t("basic").style.filter=""},Sb=function(){Ve=!0;t("basic").style.filter="blur(94px)"};var Sk=function(){ib("game");Aa.length=0;n.id=void 0;n.online=0;ia=void 0;
n.compressed=void 0;n.arje=void 0;ti();cc();v.admin=0};var xi=function(c,b,d){d&&(Wa.arr=new Uint8Array(parseInt(c)),Wa.i=0,t("showGameInfo").innerHTML="<table><tr><td>Downloading custom map</td><td id='cmappr'></td></tr></table>")},Wa=function(c,b,d){d&&(Wa.arr.set(c,Wa.i),Wa.i+=c.length,t("cmappr").innerHTML=~~(100*Wa.i/Wa.arr.length+.5)+"%",Wa.i==Wa.arr.length&&Tk(Wa.arr))};Wa.step=1E4;var Tk=function(c){var b=Uk(c);b.custom=!0;ia=b;ia.online=!0;ia.started=!1;ia.editor=!1;v.admin&&(ia.compressed=
c);O("newmap",b);$c(b);Pd()},Vk=function(c){c=parseInt(c);if(2>c||!c)c=2;14<c&&(c=14);c!==v.room.max&&(v.p2p.emit("maxPlayers",c-(ha.length-Ra.length-1)),Q(wf,c))},wf=function(c){v.room.max=c;Pd()},Em=function(){Q($c,n,!1);t("optionbutton").style.display="inline-table";ta("deleteCusMap")},bh=function(c){if((v.admin||c)&&!n.id)if(c=Va.roomName,c+="Room",O("login"),Ma(),0!==Va.getPeers().length||v.admin){var b=v.room||NaN;n.id=c;n.online=1;Vi();v.admin&&(t("onlineTopInfo").innerHTML=' <button id="addAI" style="padding: 6px;">'+
q.addAI+'</button><span style="float:right">'+q.nplayers+'<input id="nplayersO" min="2" type="number" max="14" value="'+v.room.max+'" /></span>',t("nplayersO").onchange=function(){var b=this.value;b<ha.length&&(b=ha.length);O(ha.length,b);ha.length!=b||Ra.length||b++;Vk(b);this.value=v.room.max},t("addAI").onclick=function(){if(ha.length<v.room.max&&(ha.length+1!==v.room.max||Ra.length)){for(var b="#"+(~~(16777216*Math.random())).toString(16);7>b.length;)b+="0";ha.put({name:"AI",race:0,team:5,color:b});
v.p2p.emit("maxPlayers",v.room.max-(ha.length-Ra.length-1));Q(eb,ha,0)}});t("copyButton")&&(t("copyButton").onclick=function(){document.getElementById("onlineID").select();document.execCommand("Copy")},t("onlineID").value=location.origin+"/#"+n.id);t("gameName").innerHTML=ua(b.description)||"Online Game";ta("returnmenu");v.admin?(location.replace("#"+n.id),t("buttons").innerHTML='<button id="startbutton">'+q.play+'</button><button id="optionbutton">'+q.options+'</button><button id="closebutton">'+
q.close+'</button><br><input id="maploadOnline" type="file" /> <label for= "maploadOnline">'+q.strcusMap+'</label> <button id="deleteCusMap">'+q.randomMap+"</button>",t("startbutton").onclick=Dm,t("optionbutton").onclick=Wk,t("closebutton").onclick=Sk,t("maploadOnline").accept=".tzared",t("maploadOnline").onchange=Fm,ta("deleteCusMap"),t("deleteCusMap").onclick=Em):(t("buttons").innerHTML='<button id="quitbutton">'+q.disconnect+"</button>",t("quitbutton").onclick=Am);Va.connection.on("remove",Xk)}else location.hash=
"",cc()},Xk=function(c){if(c=Qd(c.id))if(Oc(Yh(q.playerDisconnected,c.nhinfo&&c.nhinfo.name),0,5),n.online){if(n.started)for(var b=0;b<Aa.length;b++)if(Aa[b].id==c.id){H[b+1].die();break}Ra.quit(c);n.started?za.done[pd]==Ra.length&&za.func&&(za.func=!1,Cd(),Yb()):(v.admin&&(ha.quit(c.id),Q(eb,ha,0)),c.admin&&(cc(),Va.leaveRoom(),Gc(q.gameClosed)))}},sb=function(){0===sb.active&&(Q(yi),sb.date=Date.now(),sb.received=0,sb.max=-Infinity,sb.active=1)};sb.active=0;var yi=function(c,b,d){d&&Q(Yk,0,0,[d],
0)};yi.fast=!0;var zi={},Yk=function(c,b,d){d&&(d.ping=~~(.5*(Date.now()-sb.date)+.5),zi[d.id]?zi[d.id].put(d.ping):zi[d.id]=[d.ping],d.ping>sb.max&&(sb.max=d.ping),sb.received++,sb.received==Ra.length&&(sb.active=0,n.started&&(H[d.kingdom].ping=d.ping,Xh())))},Ai=function(c){var b=c.id;if(v.onlineID==b)return Gc(c.sp&&q.nospace||q.kicked),Sk();if(c=Qd(b))c.end(),Xk(b)},Bi=document.getElementsByClassName("ucolor"),Ci=document.getElementsByClassName("username"),Zk=document.getElementsByClassName("race"),
Jg=document.getElementsByClassName("team"),Pb=function(c){if(v.admin){Pb.div&&(document.body.removeChild(Pb.div),Pb.div=void 0);var b=c.pageX;c=c.pageY;var d=this.i2,f=document.createElement("div");f.style.top=c+"px";f.style.left=b+"px";f.className="onlPlayer";Pb.div=f;if(this.peer.name)b=document.createElement("button"),b.onclick=function(){ha.splice(d,1);v.p2p.emit("maxPlayers",v.room.max-(ha.length-Ra.length-1));Q(eb,ha,0);document.body.removeChild(f);Pb.div=void 0},b.innerHTML=q.kick,f.appendChild(b);
else{var g=this.peer&&this.peer.id;b=document.createElement("button");b.onclick=function(){var b=ha.indexOf(g);ha[b-1]&&(ha[b]=ha[b-1],ha[b-1]=g,Q(eb,ha,0),document.body.removeChild(f),Pb.div=void 0)};b.innerHTML=q.up;f.appendChild(b);b=document.createElement("button");b.onclick=function(){var b=ha.indexOf(g);ha[b+1]&&(ha[b]=ha[b+1],ha[b+1]=g,Q(eb,ha,0),document.body.removeChild(f),Pb.div=void 0)};b.innerHTML=q.down;f.appendChild(b);v.onlineID!=g&&(b=document.createElement("button"),b.onclick=function(){Q(Ai,
{id:g});document.body.removeChild(f);Pb.div=void 0},b.innerHTML=q.kick,f.appendChild(b))}b=document.createElement("button");b.onclick=function(){document.body.removeChild(f);Pb.div=void 0};b.innerHTML=q.close;f.appendChild(b);document.body.appendChild(f)}},Pd=function(){var c=document.getElementById("multiplayertable"),b='<tr style="text-transform:uppercase"><td></td><td>'+q.username+"</td><td>"+q.race+"</td><td>"+q.team+"</td></tr>",d=ha,f=v.room&&v.room.max||14;d&&f<d.length&&(f=d.length);for(var g=
0;g<f;g++)b+='<tr><td class="ucolor"></td><td class="username">'+q.open+'</td><td class="race"></td><td class="team"></td></tr>';6>f&&(b+='<tr style="height: '+(260-46*f)+'px"></tr>');c.innerHTML=b;b=c.getElementsByTagName("tr");g=ia&&ia.kingdoms;var h=0;for(f=d.length;h<f;h++){if(d[h].name){m=d[h];n=v.admin;k=!0;var l=b[h+1];l.onclick=Pb;l.peer=m;l.i2=h;l.style.color="#fff900"}else{var k=!1;if(d[h]==v.onlineID)var m=v,n=!0;else{var w=Qd(d[h])||NaN;m=w.nhinfo;if(!m)return Ci[h].innerHTML="...";n=
!1}}g&&g[h]?(k=g[h],l=k.color,Bi[h].style.background="rgb("+l[0]+","+l[1]+","+l[2]+")",Ci[h].innerHTML=m.name,k.team&&(Jg[h].innerHTML=k.team)):(l=Ri(m.color),Bi[h].style.background="rgb("+l[0]+","+l[1]+","+l[2]+")",Ci[h].innerHTML=m.name,n?(Jg[h].innerHTML="",l=document.createElement("button"),l.onmousedown=$k,l.iteam=m,l.innerHTML=m.team,Jg[h].appendChild(l),k&&(l.style.color="#fff900"),l=document.createElement("button"),l.onmousedown=al,l.iteam=m,l.innerHTML=cb[m.race],Zk[h].appendChild(l),k&&
(l.style.color="#fff900"),k=document.createElement("input"),k.type="color",l=m.color,k.iteam=m,k.value="#"+(16777216+(l[0]<<16)+(l[1]<<8)+l[2]).toString(16).slice(1),Bi[h].appendChild(k),k.onchange=bl):(v.admin&&(b[h+1].onclick=Pb,b[h+1].peer=w),Jg[h].innerHTML=m.team,Zk[h].innerHTML=cb[m.race]))}t("msgs").style.height=c.clientHeight-87+"px"},Lk=function(c){c.goldRes=parseInt(c.goldRes);c.foodRes=parseInt(c.foodRes);c.woodRes=parseInt(c.woodRes);c.stoneRes=parseInt(c.stoneRes);c.goldRes||(c.goldRes=
Infinity);c.foodRes||(c.foodRes=Infinity);c.woodRes||(c.woodRes=Infinity);c.stoneRes||(c.stoneRes=Infinity);c.mapx=parseInt(c.mapx);(!c.mapx||32>c.mapx)&&(c.mapx=32);c.items=parseInt(c.items)||0;0>c.items&&(c.items=0);c.peons=parseInt(c.peons)||0;0>c.peons&&(c.peons=0);c.gateways=parseInt(c.gateways)||0;0>c.gateways&&(c.gateways=0);c.water=parseInt(c.water)||0;0>c.water&&(c.water=0);c.freePop=parseInt(c.freePop)||0;c.terrainType=ua(c.terrainType);c.description=ua(c.description);c.author=ua(c.author);
c.name=ua(c.name)},$c=function(c,b,d){Lk(c);c.goldRes||(c.goldRes=Infinity);c.foodRes||(c.foodRes=Infinity);c.woodRes||(c.woodRes=Infinity);c.stoneRes||(c.stoneRes=Infinity);b="<table><tbody>";c.custom?(d=new Date(c.date),d=d.getUTCDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear(),c=[q.mapName,c.name,q.mapSize,c.mapx,q.description,c.description,q.terrainOption,c.terrainType,q.author,c.author,q.date,d],d=4):(ia&&(ia=void 0,Pd()),c=[q.gold,c.goldRes,q.mapSize,c.mapx,q.items,c.items,q.wood,c.woodRes,q.terrainOption,
c.terrainType,q.peons,c.peons,q.food,c.foodRes,q.water,c.water,q.gateways,c.gateways,q.stone,c.stoneRes,q.freePop,c.freePop],d=6);for(var e=c.length,g=0;g<e;g+=2)g%d||(g&&(b+="</tr>"),b+="<tr>"),b+="<td>"+c[g]+":</td><td>"+c[g+1]+"</td>";b+="</tbody></table>";return t("showGameInfo").innerHTML=b},Aa=[];window.onhashchange=Wi;var Cc=document.getElementById("msgs"),Vc=document.getElementById("msgs1"),Kg=document.getElementById("msginput"),bi=document.getElementById("msginputGame"),ai=document.getElementById("enterwindow");
Kg.addEventListener("keyup",function(c){13==c.keyCode&&ci()});var Oc=function(c,b,d){Ea("chat");d&&(b=n.started?Vc:Cc,b.innerHTML=5!==d?b.innerHTML+("<li><span>"+d.username+" \u2014</span> "+ua(c)+"</li>"):b.innerHTML+("<li>"+c+"</li>"),b.scrollTop=b.scrollHeight,n.started&&Rd())};Oc.fast=!0;var Rd=function(){11==Cc.children.length&&Vc.removeChild(Vc.children[0]);1==Cc.children.length&&(Rd.intv=setInterval(Gm,16E3))},Gm=function(){Vc.removeChild(Vc.children[0]);0==Cc.children.length&&clearInterval(Rd.intv)},
ua=function(c){return String(c).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Ok=function(c){return String(c).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},ci=function(){if(n.started){var c=Vc,b=bi.value;bi.value=""}else c=Cc,b=Kg.value,Kg.value="";""!=b&&(b=ua(b),c.innerHTML+="<li><span>"+v.name+" \u2014</span> "+b+"</li>",Q(Oc,b,0,0,0),c.scrollTop=c.scrollHeight,n.started&&Rd())},Lf=[vi,Fa,vc,xc,Xf,wc,uc,Oc,ge,qe,Dd,li,Ed,Re,Gh,Sf,Nf,Uc,yi,Yk,gi,kf,Ff,lg,
Ae,ng,Uh,cg,se,te,Fe,Be,qg,we,Kh,Id,bg,Ph,Hf,ve,kg,Ge,Ce,Rh,He,ye,xe,Ee,sg,Zh,Sh,Mh,$c,Zd,eb,Wa,Ai,wf,rh,xi],cl=function(c,b,d){return d&&d.admin},mf=function(c,b,d){return(d&&d.admin||!d)&&!n.started},pa=function(c,b,d){c=b.length;d=H[d.kingdom].control;for(var e=0;e<c;e++)if(!d[x[b[e]].kingdom])return!1;return!0},Lg=function(c,b,d){c=H[d.kingdom].control;b=x[b];return c[b.kingdom]?!0:!1},Di=function(c,b,d){b=H[d.kingdom].control;c=x[c];return b[c.kingdom]?!0:!1};vi.secureNH=mf;Fa.secureNH=pa;vc.secureNH=
pa;xc.secureNH=pa;Xf.secureNH=pa;wc.secureNH=pa;uc.secureNH=pa;ge.secureNH=pa;qe.secureNH=pa;Dd.secureNH=pa;li.secureNH=Di;Ed.secureNH=pa;Re.secureNH=pa;Gh.secureNH=pa;Sf.secureNH=pa;Nf.secureNH=Lg;gi.secureNH=pa;kf.secureNH=function(c,b,d){return d&&d.admin||!d};Ff.secureNH=Lg;lg.secureNH=pa;Ae.secureNH=pa;ng.secureNH=pa;Uh.secureNH=Di;cg.secureNH=pa;se.secureNH=pa;te.secureNH=pa;Fe.secureNH=pa;Be.secureNH=pa;qg.secureNH=pa;we.secureNH=pa;Kh.secureNH=pa;Id.secureNH=Di;bg.secureNH=pa;Ph.secureNH=
pa;Hf.secureNH=pa;ve.secureNH=pa;kg.secureNH=pa;Ge.secureNH=pa;Ce.secureNH=pa;Rh.secureNH=pa;He.secureNH=pa;ye.secureNH=pa;xe.secureNH=pa;Ee.secureNH=pa;sg.secureNH=pa;Zh.secureNH=Lg;Sh.secureNH=Lg;Mh.secureNH=pa;$c.secureNH=mf;eb.secureNH=mf;Ai.secureNH=mf;wf.secureNH=mf;xi.secureNH=cl;Wa.secureNH=cl;rh.secureNH=function(c,b,d){return!d};localStorage.favMusic&&(musicSelect.mversion.value=localStorage.favMusic);(function(){for(var c=Lf,b=0,d=c.length;b<d;b++)c[b].location=b})();var dl=document.getElementsByClassName("ucolor1"),
Hm=document.getElementsByClassName("username1"),Im=document.getElementsByClassName("race1"),Jm=document.getElementsByClassName("team1"),$k=function(c){var b=1;2==c.button&&(b=-1);if(n.online){c=this.iteam;c.team+=b;0>c.team&&(c.team=0);c.team%=6;this.innerHTML=c.team;if(c==v){Q(Zd,vf());return}return Q(eb,ha,0)}c=this.iteam;Aa[c].team+=b;0>Aa[c].team&&(Aa[c].team=0);this.innerHTML=Aa[c].team},al=function(c){if(n.online){c=this.iteam;c.race=(c.race+1)%3;this.innerHTML=cb[c.race];if(c==v){Q(Zd,vf());
return}return Q(eb,ha,0)}c=Aa[this.iteam];c.race=(c.race+1)%3;this.innerHTML=cb[c.race]},bl=function(){O(this.value);this.parentElement.style.background=this.value;if(n.online){var c=this.iteam;c.color=this.value;if(c==v){Q(Zd,vf());return}return Q(eb,ha,0)}v.color=this.value;Aa[this.iteam].color=this.value},Km=function(){mc.nu++;mc()},Lm=function(){mc.nu--;0>=mc.nu?mc.nu=1:Aa.length--;mc()},yg={0:"euro",1:"arab",2:"asia"},el=[["a","e","i","o","u"],"bcdfghjklmnpqrstvwxyz".split("")],mc=function(){if(v.name){document.getElementById("returnmenu").style.display=
"block";document.getElementById("oneplayertbody").innerHTML="";document.getElementById("oneplayertbody").innerHTML+='<tr><td></td><td id="addremove"><button id="addPlayer">+</button><button id="removePlayer">-</button></td><td></td><td></td></tr>';for(var c=mc.nu,b=0;b<c;b++)if(document.getElementById("oneplayertbody").innerHTML+='<tr><td class="ucolor1"></td><td class="username1"></td><td class="race1"><button></button></td><td class="team1"><button></button></td></tr>',!Aa[b]){for(var d="#"+(~~(16777216*
Math.random())).toString(16);7>d.length;)d+="0";Aa[b]={color:d,IA:1,race:~~(3*Math.random()),team:b}}document.getElementById("addPlayer").onclick=Km;document.getElementById("removePlayer").onclick=Lm;Aa[0].color=v.color;Aa[0].name=v.name;Aa[0].IA=0;for(b=d=Aa[0].race=0;b<c;b++){var f=Aa[b],g=Bj[yg[f.race]];if(f.IA)if(d<g.length)f.name=g[d++];else{g=f;var h=~~(9*Math.random())+2,l=el[1],k=l[~~(Math.random()*l.length)].toUpperCase();.85<Math.random()&&(k+=l[~~(Math.random()*l.length)]);for(l=0;l<h;l++){var m=
el[l%2];k+=m[~~(Math.random()*m.length)];.8<Math.random()&&(k+=m[~~(Math.random()*m.length)])}g.name=k}dl[b].style.background=f.color;Hm[b].innerHTML=f.name;g=Jm[b].getElementsByTagName("button")[0];g.iteam=b;g.onmousedown=$k;g.innerHTML=b;g=Im[b].getElementsByTagName("button")[0];g.iteam=b;g.onmousedown=al;g.innerHTML=cb[f.race];g=document.createElement("input");g.type="color";g.iteam=b;g.value=f.color;dl[b].appendChild(g);g.onchange=bl}}else Pk(mc)};mc.nu=4;var sm=function(c,b,d){"granted"!=Notification.permission&&
Notification.requestPermission(function(b){});var e=new Notification(c,{icon:"/nehhon/807.png",body:b,requireInteraction:!1});d||(d=5550);setTimeout(function(){e.close()},d)},pc,Wc=function(c){if(ma(c%A,~~(c/A))&&(c=Tc[c],0<=c&&!pc.type[c]))return!0},fl=function(c){for(var b="",d=0,f=c.length;d<f;d++)b+=zm[c[d]];return b};Fl[fl([32718400,37271025,40005625,40704400,36602500,28462225,35940025,30858025])]!==fl([40704400,45024100,28462225,6400900,39312900,30858025,3025E4])&&(O("edge chrome firefox - compt"),
Si=Fc);var Yc=function(c){if(c){Yc.update=!1;c=Tc;for(var b=1*A,d=[],f={},g=0,h=A*Ka;g<h;g++){var l=c[g];if(pc.type[l]||0>l){var m=0;Wc(g-1-b)&&(m+=1E7);Wc(g-b)&&(m+=1E6);Wc(g-b+1)&&(m+=1E5);Wc(g-1)&&(m+=1E4);Wc(g+1)&&(m+=1E3);Wc(g-1+b)&&(m+=100);Wc(g+b)&&(m+=10);Wc(g+1+b)&&(m+=1);pc.type[l]&&(Ub[g]=1,Sa[g]=1,K[g]=1);m?void 0!==yk[m]&&(d.put(g),f[d.length-1]=-yk[m]/256-2):0>l&&(c[g]=3)}else Ub[g]&&(Ub[g]=0,Sa[g]=0,K[g]=0)}g=0;for(b=d.length;g<b;g++)h=d[g],c[h]=f[g],Ub[h]=2,Sa[h]=2,K[h]=2;k.useProgram(ya);
k.activeTexture(k.TEXTURE1);d=k.createTexture();k.bindTexture(k.TEXTURE_2D,d);k.texImage2D(k.TEXTURE_2D,0,k.R8I,A,Ka,0,k.RED_INTEGER,k.BYTE,c);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT);k.bindTexture(k.TEXTURE_2D,null);k.bindTexture(k.TEXTURE_2D,d);k.uniform1i(k.getUniformLocation(ya,"img_data"),1);k.useProgram(ra);
k.activeTexture(k.TEXTURE2)}else Yc.update=!0};Yc.update=!1;var d,Ek,Ig,Ye,Ze,$e,af,bf,cf,df,ef,ff,gf,hf,jf,qm=function(){var c={};d={move:function(){W=Fa;Fa.cursor=7}};d.move.iconID=262;d.move.obj={name:q.move};d.attack=function(){W=xc};d.attack.iconID=250;d.attack.obj={name:q.attack};d.guard=function(){Qc(4)};d.guard.iconID=237;d.guard.obj={name:q.guard};d.patrol=function(){Qc(8)};d.patrol.iconID=238;d.patrol.obj={name:q.patrol};d.pickUp=function(){W=Dd};d.pickUp.iconID=240;d.pickUp.obj={name:q.pickItems};
d.explore=function(){Qc(7)};d.explore.iconID=40;d.explore.obj={name:q.explore};d.stop=function(){Q(Gh,0,G)};d.stop.iconID=160;d.stop.obj={name:q.stop};d.stand=function(){Q(Kh,0,G)};d.stand.iconID=27;d.stand.obj={name:q.stand};d.attackGround=function(){};d.attackGround.iconID=100;d.steady=function(){};d.steady.iconID=21;d.createOrk=function(){ba(58)};d.createOrk.iconID=120;d.createDwarf=function(){ba(59)};d.createDwarf.iconID=117;d.createSkeleton=function(){ba(60)};d.createSkeleton.iconID=87;d.createGhost=
function(){ba(40)};d.createGhost.iconID=222;d.createFootman=function(){ba(0)};d.createFootman.iconID=182;d.createArcher=function(){ba(4)};d.createArcher.iconID=185;d.createMaceman=function(){ba(3)};d.createMaceman.iconID=186;d.createPikeman=function(){ba(1)};d.createPikeman.iconID=183;d.createLongbowman=function(){ba(6)};d.createLongbowman.iconID=184;d.createKnight=function(){ba(19)};d.createKnight.iconID=180;d.iniMercenaries=function(b){b.mlist=[];b.mlistID=[];b.mercID=0;Ch(b);b.setupINTV(ki,b.id,
2E3)};d.iniMercenaries.builds=[30];d.iniHeroes=function(b){b.hlist=[];b.hlistID=[];b.heroID=0;Ch(b);b.setupINTV(ki,b.id,2E3)};d.iniHeroes.builds=[30];d.mercFootmanArab=function(){ab()};d.mercFootmanArab.iconID=49;d.mercFootmanArab.unit=80;d.mercFootmanArab.obj={};d.mercArcherArab=function(){ab()};d.mercArcherArab.iconID=52;d.mercArcherArab.unit=85;d.mercArcherArab.obj={};d.mercMacemanArab=function(){ab()};d.mercMacemanArab.iconID=116;d.mercMacemanArab.obj={};d.mercMacemanArab.unit=83;d.mercPikemanArab=
function(){ab()};d.mercPikemanArab.iconID=52;d.mercPikemanArab.unit=82;d.mercPikemanArab.obj={};d.mercCavalry=function(){ab()};d.mercCavalry.iconID=133;d.mercCavalry.unit=84;d.mercCavalry.obj={};d.mercEnichar=function(){ab()};d.mercEnichar.iconID=123;d.mercEnichar.unit=91;d.mercEnichar.obj={};d.mercJihad=function(){ab()};d.mercJihad.iconID=236;d.mercJihad.unit=86;d.mercJihad.obj={};d.mercFootmanArab6=function(){ob()};d.mercFootmanArab6.iconID=49;d.mercFootmanArab6.unit=80;d.mercFootmanArab6.obj={};
d.mercArcherArab6=function(){ob()};d.mercArcherArab6.iconID=52;d.mercArcherArab6.unit=85;d.mercArcherArab6.obj={};d.mercMacemanArab6=function(){ob()};d.mercMacemanArab6.iconID=116;d.mercMacemanArab6.unit=83;d.mercMacemanArab6.obj={};d.mercPikemanArab6=function(){ob()};d.mercPikemanArab6.iconID=52;d.mercPikemanArab6.unit=82;d.mercPikemanArab6.obj={};d.mercCavalry6=function(){ob()};d.mercCavalry6.iconID=133;d.mercCavalry6.unit=84;d.mercCavalry6.obj={};d.mercEnichar6=function(){ob()};d.mercEnichar6.iconID=
123;d.mercEnichar6.unit=91;d.mercEnichar6.obj={};d.mercJihad6=function(){ob()};d.mercJihad6.iconID=236;d.mercJihad6.unit=86;d.mercJihad6.obj={};d.mercFootman=function(){ab()};d.mercFootman.iconID=182;d.mercFootman.unit=0;d.mercArcher=function(){ab()};d.mercArcher.iconID=185;d.mercArcher.unit=4;d.mercMaceman=function(){ab()};d.mercMaceman.iconID=186;d.mercMaceman.unit=3;d.mercPikeman=function(){ab()};d.mercPikeman.iconID=183;d.mercPikeman.unit=1;d.mercLongbowman=function(){ab()};d.mercLongbowman.iconID=
184;d.mercLongbowman.unit=6;d.mercKnight=function(){ab()};d.mercKnight.iconID=180;d.mercKnight.unit=19;d.mercFootman6=function(){ob()};d.mercFootman6.iconID=182;d.mercFootman6.unit=0;d.mercFootman6.obj={};d.mercArcher6=function(){ob()};d.mercArcher6.iconID=185;d.mercArcher6.unit=4;d.mercArcher6.obj={};d.mercMaceman6=function(){ob()};d.mercMaceman6.iconID=186;d.mercMaceman6.unit=3;d.mercMaceman6.obj={};d.mercPikeman6=function(){ob()};d.mercPikeman6.iconID=183;d.mercPikeman6.unit=1;d.mercPikeman6.obj=
{};d.mercLongbowman6=function(){ob()};d.mercLongbowman6.iconID=184;d.mercLongbowman6.unit=6;d.mercLongbowman6.obj={};d.mercKnight6=function(){ob()};d.mercKnight6.iconID=180;d.mercKnight6.unit=19;d.mercKnight6.obj={};d.mercArcherAsian6=function(){ob()};d.mercArcherAsian6.iconID=53;d.mercArcherAsian6.unit=67;d.mercArcherAsian6.obj={};d.mercSamurai6=function(){ob()};d.mercSamurai6.iconID=122;d.mercSamurai6.unit=68;d.mercSamurai6.obj={};d.mercHourseSamurai6=function(){ob()};d.mercHourseSamurai6.iconID=
121;d.mercHourseSamurai6.unit=70;d.mercHourseSamurai6.obj={};d.mercRonin6=function(){ob()};d.mercRonin6.iconID=54;d.mercRonin6.unit=66;d.mercRonin6.obj={};d.mercHorseArcher6=function(){ob()};d.mercHorseArcher6.iconID=52;d.mercHorseArcher6.unit=69;d.mercHorseArcher6.obj={};d.mercChariot6=function(){ob()};d.mercChariot6.iconID=79;d.mercChariot6.unit=72;d.mercChariot6.obj={};d.mercArcherAsian=function(){ab()};d.mercArcherAsian.iconID=53;d.mercArcherAsian.unit=67;d.mercArcherAsian.obj={};d.mercSamurai=
function(){ab()};d.mercSamurai.iconID=122;d.mercSamurai.unit=68;d.mercSamurai.obj={};d.mercHourseSamurai=function(){ab()};d.mercHourseSamurai.iconID=121;d.mercHourseSamurai.unit=70;d.mercHourseSamurai.obj={};d.mercRonin=function(){ab()};d.mercRonin.iconID=54;d.mercRonin.unit=66;d.mercRonin.obj={};d.mercHorseArcher=function(){ab()};d.mercHorseArcher.iconID=52;d.mercHorseArcher.unit=69;d.mercHorseArcher.obj={};d.mercChariot=function(){ab()};d.mercChariot.iconID=79;d.mercChariot.unit=72;d.mercChariot.obj=
{};d.createPeon=function(){ba(10)};d.createPeon.iconID=187;d.sameSpeed=function(){Q(Hf,0,G)};d.sameSpeed.iconID=82;d.restoreSpeed=function(){Q(Ph,0,G)};d.restoreSpeed.iconID=88;d.createSpy=function(){ba(2)};d.createSpy.iconID=162;d.emergeAllUnits=function(){var b=G[0];Q(Ed,b,x[b].inventory.slice(0))};d.emergeAllUnits.iconID=261;d.techFeudalism=function(){F(12)};d.techFeudalism.iconID=233;d.techArchitecture=function(){F(13)};d.techArchitecture.iconID=226;d.techLearning=function(){F(14)};d.techLearning.iconID=
129;d.createPeon1=function(){ba(64)};d.createPeon1.iconID=55;d.createPeon2=function(){ba(79)};d.createPeon2.iconID=132;d.createNinja=function(){ba(65)};d.createNinja.iconID=51;d.techArmoredChariot=function(){F(51)};d.techArmoredChariot.iconID=79;d.techBuddhism=function(){F(45)};d.techBuddhism.iconID=127;d.techGreatWall=function(){F(48)};d.techGreatWall.iconID=80;d.ridingHorses=function(){F(49)};d.ridingHorses.iconID=64;d.irrigation=function(){F(50)};d.irrigation.iconID=72;d.createHorseArcher2=function(){ba(85)};
d.createHorseArcher2.iconID=52;d.techMeditation=function(){F(52)};d.techMeditation.iconID=71;d.techKungFu=function(){F(53)};d.techKungFu.iconID=228;d.techTournaments=function(){F(54)};d.techTournaments.iconID=73;d.techPhilosophy=function(){F(55)};d.techPhilosophy.iconID=68;d.techNinjas=function(){F(56)};d.techNinjas.iconID=56;d.techMastery=function(){F(57)};d.techMastery.iconID=69;d.techGoldMining=function(){F(1)};d.techGoldMining.iconID=58;d.techStoneMining=function(){F(2)};d.techStoneMining.iconID=
57;d.createCrusaders=function(){Q(li,G[0],0)};d.createCrusaders.iconID=221;d.techFanaticism=function(){F(31)};d.techFanaticism.iconID=235;d.techCrusade=function(){F(32)};d.techCrusade.iconID=93;d.techEspionage=function(){F(30)};d.techEspionage.iconID=215;d.techInquisition=function(){F(33)};d.techInquisition.iconID=97;d.techHealing=function(){F(34)};d.techHealing.iconID=219;d.healing=function(){W=lg};d.healing.iconID=219;d.healing.iconIDbook=201;d.teach=function(){W=sg};d.teach.iconID=23;d.teach.iconIDbook=
217;d.techBless=function(){F(36)};d.techBless.iconID=159;d.bless=function(){W=Ae};d.bless.iconID=159;d.bless.iconIDbook=204;d.techMedicine=function(){F(35)};d.techMedicine.iconID=220;d.createMage=function(){ba(5)};d.createMage.iconID=156;d.techBat=function(){F(38)};d.techBat.iconID=168;d.techGolem=function(){F(41)};d.techGolem.iconID=119;d.techInvisibility=function(){F(37)};d.techInvisibility.iconID=217;d.techLightning=function(){F(40)};d.techLightning.iconID=143;d.techFreeze=function(){F(39)};d.techFreeze.iconID=
130;d.techHeroism=function(){F(22)};d.techHeroism.iconID=136;d.techWarfare=function(){F(23)};d.techWarfare.iconID=108;d.techTactics=function(){F(24)};d.techTactics.iconID=257;d.techMercenaries=function(){F(25)};d.techMercenaries.iconID=95;d.techHeroes=function(){F(26)};d.techHeroes.iconID=96;d.techFame=function(){F(27)};d.techFame.iconID=111;d.techSiegeTactics=function(){F(28)};d.techSiegeTactics.iconID=258;d.techBodyBuilding=function(){F(29)};d.techBodyBuilding.iconID=101;d.createPriest=function(){ba(9)};
d.createPriest.iconID=155;d.createCow=function(){ba(27)};d.createCow.iconID=163;d.techCropRotation=function(){F(8)};d.techCropRotation.iconID=227;d.techDomestication=function(){F(7)};d.techDomestication.iconID=157;d.techMapMaking=function(){F(16)};d.techMapMaking.iconID=89;d.techTradeRoutes=function(){F(17)};d.techTradeRoutes.iconID=102;d.techTradeTaxes=function(){F(18)};d.techTradeTaxes.iconID=110;d.techUsury=function(){F(19)};d.techUsury.iconID=105;d.techSupplyStorage=function(){F(20)};d.techSupplyStorage.iconID=
62;d.techBribery=function(){F(21)};d.techBribery.iconID=109;d.bribe=function(){};d.bribe.iconID=128;d.createCaravan=function(){ba(61)};d.createCaravan.iconID=169;d.createCaravan2=function(){ba(90)};d.createCaravan2.iconID=134;d.createFootman2=function(){ba(80)};d.createFootman2.iconID=49;d.createArcher2=function(){ba(81)};d.createArcher2.iconID=43;d.createSatrap=function(){ba(83)};d.createSatrap.iconID=116;d.createPikeman2=function(){ba(82)};d.createPikeman2.iconID=42;d.createHorseArcher2=function(){ba(85)};
d.createHorseArcher2.iconID=124;d.createCavalry=function(){ba(84)};d.createCavalry.iconID=133;d.createEnichar=function(){ba(91)};d.createEnichar.iconID=123;d.createJihad=function(){ba(86)};d.createJihad.iconID=236;d.trade=function(){};d.trade.iconID=161;d.unload=function(){W=se};d.unload.iconID=148;d.createMercenaries=function(){ka(x[G[0]].mlist)};d.createMercenaries.iconID=95;d.createHeroes=function(){ka(x[G[0]].hlist)};d.createHeroes.iconID=96;d.upgradeGuildTower=function(){F(42)};d.upgradeGuildTower.iconID=
171;d.upgradeStoneTower=function(){F(43)};d.upgradeStoneTower.iconID=178;d.upgradeCannonTower=function(){F(44)};d.upgradeCannonTower.iconID=178;d.createCatapult=function(){ba(37)};d.createCatapult.iconID=152;d.createHeavyCatapult=function(){ba(39)};d.createHeavyCatapult.iconID=153;d.createBallist=function(){ba(38)};d.createBallist.iconID=154;d.techEngineering=function(){F(47)};d.techEngineering.iconID=92;d.techCannonTower=function(){F(46)};d.techCannonTower.iconID=178;d.techPlateArmor=function(){F(10)};
d.techPlateArmor.iconID=131;d.techTemperIron=function(){F(4)};d.techTemperIron.iconID=266;d.techHalberd=function(){F(6)};d.techHalberd.iconID=113;d.techScaleArmor=function(){F(5)};d.techScaleArmor.iconID=251;d.techChainMail=function(){F(9)};d.techChainMail.iconID=252;d.techLongbow=function(){F(0)};d.techLongbow.iconID=259;d.techWoodCutting=function(){F(3)};d.techWoodCutting.iconID=107;d.techCrossbow=function(){F(11)};d.techCrossbow.iconID=112;d.createFishingBoat=function(){ba(74)};d.createFishingBoat.iconID=
48;d.createXebec=function(){ba(76)};d.createXebec.iconID=166;d.upgradeShip=function(){};d.upgradeShip.iconID=268;d.fishing=function(){};d.fishing.iconID=41;d.createHulk=function(){ba(75)};d.createHulk.iconID=165;d.createGalleon=function(){ba(73)};d.createGalleon.iconID=164;d.techLandingTactics=function(){};d.techLandingTactics.iconID=98;d.techConcentration=function(){F(58)};d.techConcentration.iconID=75;d.techConfusion=function(){F(59)};d.techConfusion.iconID=76;d.techWhirlpool=function(){F(60)};
d.techWhirlpool.iconID=78;d.techDragon=function(){F(61)};d.techDragon.iconID=115;d.techTurnToStone=function(){F(62)};d.techTurnToStone.iconID=77;d.techFlameBolt=function(){F(63)};d.techFlameBolt.iconID=25;d.techJewelry=function(){F(64)};d.techJewelry.iconID=230;d.techBanking=function(){F(65)};d.techBanking.iconID=74;d.techChemistry=function(){F(66)};d.techChemistry.iconID=225;d.techSeaFood=function(){F(67)};d.techSeaFood.iconID=67;d.techGunPowder=function(){F(68)};d.techGunPowder.iconID=212;d.techRocketArrow=
function(){F(69)};d.techRocketArrow.iconID=47;d.techBushido=function(){F(70)};d.techBushido.iconID=60;d.techLeadership=function(){F(71)};d.techLeadership.iconID=114;d.techHonor=function(){F(72)};d.techHonor.iconID=94;d.techSunTzu=function(){F(73)};d.techSunTzu.iconID=66;d.createRonin=function(){ba(66)};d.createRonin.iconID=54;d.createArcher1=function(){ba(67)};d.createArcher1.iconID=53;d.createSamurai=function(){ba(68)};d.createSamurai.iconID=122;d.createHorseArcher1=function(){ba(69)};d.createHorseArcher1.iconID=
52;d.createMonk=function(){ba(128)};d.createMonk.iconID=45;d.createMage1=function(){ba(129)};d.createMage1.iconID=50;d.createPriest1=function(){ba(127)};d.createPriest1.iconID=44;d.createPriest2=function(){ba(87)};d.createPriest2.iconID=125;d.buyItems=function(){};d.buyItems.iconID=31;d.sellItems=function(){};d.sellItems.iconID=30;d.createHorseSamurai=function(){ba(70)};d.createHorseSamurai.iconID=121;d.createChariot=function(){ba(72)};d.createChariot.iconID=79;d.stopTech=function(){Q(Sf,0,G)};d.stopTech.iconID=
160;d.repair=function(){W=wc};d.repair.iconID=145;d.conquest=function(){};d.conquest.iconID=249;d.dcm=function(){W=vc};d.dcm.iconID=260;d.buildBarrack=function(){N(14)};d.buildBarrack.iconID=205;d.buildBarrack1=function(){N(71)};d.buildBarrack1.iconID=205;d.buildBarrack2=function(){N(102)};d.buildBarrack2.iconID=205;d.buildTower=function(){N(32)};d.buildTower.iconID=170;d.buildStorage=function(){N(18)};d.buildStorage.iconID=200;d.buildLumbermill=function(){N(15)};d.buildLumbermill.iconID=199;d.buildLumbermill2=
function(){N(93)};d.buildLumbermill2.iconID=199;d.buildFields=function(){N(20)};d.buildFields.iconID=265;d.buildCastle=function(){N(12)};d.buildCastle.iconID=206;d.buildCastle1=function(){N(62)};d.buildCastle1.iconID=206;d.buildCastle2=function(){N(63)};d.buildCastle2.iconID=206;d.buildAcademy=function(){N(17)};d.buildAcademy.iconID=204;d.buildCathedral=function(){N(11)};d.buildCathedral.iconID=191;d.buildCathedral2=function(){N(106)};d.buildCathedral2.iconID=189;d.buildMerchands=function(){N(24)};
d.buildMerchands.iconID=198;d.buildMerchands2=function(){N(108)};d.buildMerchands2.iconID=198;d.buildChurch=function(){N(25)};d.buildChurch.iconID=197;d.buildMarket=function(){N(33)};d.buildMarket.iconID=194;d.buildMageTower=function(){N(16)};d.buildMageTower.iconID=192;d.buildMageTower2=function(){N(107)};d.buildMageTower2.iconID=192;d.buildDummy=function(){N(36)};d.buildDummy.iconID=65;d.buildFarm=function(){N(23)};d.buildFarm.iconID=193;d.buildBlacksmith=function(){N(26)};d.buildBlacksmith.iconID=
202;d.buildWorkshop=function(){N(29)};d.buildWorkshop.iconID=201;d.buildWorkshop2=function(){N(98)};d.buildWorkshop2.iconID=201;d.buildStable=function(){N(28)};d.buildStable.iconID=196;d.buildStable2=function(){N(103)};d.buildStable2.iconID=196;d.buildTavern=function(){N(30)};d.buildTavern.iconID=208;d.buildHouse=function(){N(31)};d.buildHouse.iconID=195;d.buildHarbor=function(){N(41)};d.buildHarbor.iconID=188;d.buildOutpost=function(){N(34)};d.buildOutpost.iconID=158;d.buildWoodWall=function(){Fh(13)};
d.buildWoodWall.iconID=210;d.buildWoodGate=function(){};d.buildWoodGate.iconID=209;d.buildWoodGate.disabled=2;d.buildBridge=function(){N(35)};d.buildBridge.iconID=176;Ig="freeze invisibility lightning turnToStone bless healing".split(" ");d.freeze=function(){W=Fe};d.freeze.iconID=99;d.freeze.obj={name:q.freeze};d.freeze.iconIDbook=205;d.confusion=function(){W=Ge};d.confusion.iconID=76;d.confusion.obj={name:"Confusion",spcost:[120,0,0,0]};d.confusion.iconIDbook=206;d.turnToStone=function(){W=kg};d.turnToStone.iconID=
77;d.turnToStone.iconIDbook=213;d.turnToStone.obj={name:"Turn to Stone",spcost:[40,0,0,0]};d.whirlpool=function(){W=Rh};d.whirlpool.iconID=78;d.whirlpool.iconIDbook=214;d.whirlpool.obj={name:"Whirlpool",spcost:[80,0,0,0]};d.flameBolt=function(){W=Ce};d.flameBolt.iconID=25;d.flameBolt.obj={name:"Flame Bolt",spcost:[120,0,0,0]};d.flameBolt.iconIDbook=216;d.createDragon=function(){W=ve};d.createDragon.iconID=115;d.createDragon.obj={name:"Spawn Dragon",spcost:[320,0,0,0]};d.createDragon.iconIDbook=215;
d.lightning=function(){W=qg};d.lightning.iconID=263;d.lightning.obj={name:q.lightning,spcost:[80,0,0,0]};d.lightning.iconIDbook=200;d.createBat=function(){W=we};d.createBat.iconID=168;d.createBat.iconIDbook=203;d.createGolem=function(){W=te};d.createGolem.iconID=119;d.createGolem.iconIDbook=209;d.autoInvisibility=function(){W=Be};d.autoInvisibility.iconID=217;d.autoInvisibility.obj={name:q.invisibility};d.invisibility=function(){W=Be};d.invisibility.iconID=217;d.invisibility.iconIDbook=208;d.impersonate=
function(){W=ng};d.impersonate.iconID=32;d.impersonate.obj={name:"Impersonate"};d.revealSelf=function(){Q(Uh,G[0],0)};d.revealSelf.iconID=33;d.revealSelf.obj={name:"Reveal your true self"};d.buildHouse1=function(){N(111)};d.buildHouse1.iconID=195;d.buildHouse2=function(){N(92)};d.buildHouse2.iconID=195;d.buildLumbermill1=function(){N(112)};d.buildLumbermill1.iconID=199;d.buildStorage1=function(){N(113)};d.buildStorage1.iconID=200;d.buildStorage2=function(){N(94)};d.buildStorage2.iconID=200;d.buildFarm1=
function(){N(114)};d.buildFarm1.iconID=193;d.buildFarm2=function(){N(95)};d.buildFarm2.iconID=193;d.buildHarbor1=function(){N(115)};d.buildHarbor1.iconID=188;d.buildHarbor2=function(){N(96)};d.buildHarbor2.iconID=188;d.buildBlacksmith1=function(){N(116)};d.buildBlacksmith1.iconID=202;d.buildBlacksmith2=function(){N(97)};d.buildBlacksmith2.iconID=202;d.buildWorkshop1=function(){N(117)};d.buildWorkshop1.iconID=201;d.buildChurch1=function(){N(118)};d.buildChurch1.iconID=197;d.buildChurch2=function(){N(99)};
d.buildChurch2.iconID=197;d.buildTavern1=function(){N(119)};d.buildTavern1.iconID=208;d.buildTavern2=function(){N(100)};d.buildTavern2.iconID=208;d.buildMarket1=function(){N(120)};d.buildMarket1.iconID=194;d.buildMarket2=function(){N(101)};d.buildMarket2.iconID=194;d.buildStable1=function(){N(121)};d.buildStable1.iconID=196;d.buildOutpost1=function(){N(122)};d.buildOutpost1.iconID=158;d.buildOutpost2=function(){N(104)};d.buildOutpost2.iconID=158;d.buildCathedral1=function(){N(123)};d.buildCathedral1.iconID=
190;d.buildMageTower1=function(){N(124)};d.buildMageTower1.iconID=192;d.createObjects=function(){Ie("magicworkshopmenu",la)};d.createObjects.iconID=20;d.createObjects.obj={};d.buildMagicWorkshop=function(){N(110)};d.buildMagicWorkshop.iconID=46;d.buildMerchands1=function(){N(125)};d.buildMerchands1.iconID=198;d.buildAcademy1=function(){N(126)};d.buildAcademy1.iconID=204;d.buildAcademy2=function(){N(109)};d.buildAcademy2.iconID=204;d.buildRocketTower=function(){N(57)};d.buildRocketTower.iconID=47;
d.murder=function(){};d.murder.iconID=28;d.convertJihad=function(){Q(Mh,86,G)};d.convertJihad.iconID=236;d.convertJihad.obj={};d.menuCommonBuild2=function(){ka(ff)};d.menuCommonBuild2.iconID=17;ff=[d.buildFarm2,d.buildBlacksmith2,d.buildWorkshop2,d.buildStable2,d.buildTavern2,d.buildHouse2];ff.menuName="a_build";d.menuCommonBuild2.xtra=ff;d.menuSpecialBuild2=function(){ka(gf)};d.menuSpecialBuild2.iconID=15;gf=[d.buildCastle2,d.buildAcademy2,d.buildCathedral2,d.buildMerchands2,d.buildChurch2,d.buildMarket2,
d.buildMageTower2,d.buildMagicWorkshop];gf.menuName="a_build";d.menuSpecialBuild2.xtra=gf;d.menuOtherBuild2=function(){ka(hf)};d.menuOtherBuild2.iconID=16;hf=[d.buildHarbor2,d.buildOutpost2,d.buildWoodWall,d.buildWoodGate,d.buildBridge];hf.menuName="e_build";d.menuOtherBuild2.xtra=hf;d.menuBuilds2=function(){ka(jf)};d.menuBuilds2.iconID=245;jf=[d.menuSpecialBuild2,d.menuCommonBuild2,d.menuOtherBuild2,d.buildBarrack2,d.buildTower,d.buildStorage2,d.buildLumbermill2,d.buildFields];jf.menuName="a_build";
d.menuBuilds2.xtra=jf;d.origin=Mk;d.origin.iconID=255;d.createCarpet=function(){W=ye};d.createCarpet.iconID=146;d.createCarpet.iconIDbook=202;d.createJinn=function(){W=xe};d.createJinn.iconID=118;d.createJinn.iconIDbook=218;d.magicVision=function(){};d.magicVision.iconID=223;d.magicVision.iconIDbook=210;d.fireRain=function(){W=He};d.fireRain.iconID=264;d.fireRain.iconIDbook=199;d.raiseDead=function(){W=Ee};d.raiseDead.iconID=87;d.raiseDead.iconIDbook=211;d.createMage2=function(){ba(89)};d.createMage2.iconID=
126;d.techCowPoaching=function(){F(74)};d.techCowPoaching.iconID=85;d.techHorseManShip=function(){F(75)};d.techHorseManShip.iconID=231;d.techScimitar=function(){F(76)};d.techScimitar.iconID=84;d.techJihad=function(){F(77)};d.techJihad.iconID=236;d.techCarpet=function(){F(78)};d.techCarpet.iconID=146;d.techMagicWorkshop=function(){F(79)};d.techMagicWorkshop.iconID=86;d.techFireRain=function(){F(80)};d.techFireRain.iconID=264;d.techMagicVision=function(){F(81)};d.techMagicVision.iconID=224;d.techNecromancy=
function(){F(82)};d.techNecromancy.iconID=87;d.techJinn=function(){F(83)};d.techJinn.iconID=118;d.techOreFloatation=function(){F(84)};d.techOreFloatation.iconID=106;d.techRiddingHorses=function(){F(85)};d.techRiddingHorses.iconID=232;d.techJanissary=function(){F(86)};d.techJanissary.iconID=81;d.buildMagicItems=function(){};d.buildMagicItems.iconID=20;d.techSlavery=function(){F(87)};d.techSlavery.iconID=135;d.stopBuilding=function(){Q(Re,0,G)};d.stopBuilding.iconID=160;d.menuSpecialBuild1=function(){ka(Ye)};
d.menuSpecialBuild1.iconID=15;Ye=[d.buildCastle1,d.buildAcademy1,d.buildCathedral1,d.buildMerchands1,d.buildChurch1,d.buildMarket1,d.buildMageTower1,d.buildRocketTower,d.buildDummy];Ye.menuName="a_build";d.menuSpecialBuild1.xtra=Ye;d.menuCommonBuild1=function(){ka(Ze)};d.menuCommonBuild1.iconID=17;Ze=[d.buildFarm1,d.buildBlacksmith1,d.buildWorkshop1,d.buildStable1,d.buildTavern1,d.buildHouse1];Ze.menuName="a_build";d.menuCommonBuild1.xtra=Ze;d.menuSpecialBuild=function(){ka($e)};d.menuSpecialBuild.iconID=
15;$e=[d.buildCastle,d.buildAcademy,d.buildCathedral,d.buildMerchands,d.buildChurch,d.buildMarket,d.buildMageTower,d.buildDummy];$e.menuName="e_build";d.menuSpecialBuild.xtra=$e;d.menuCommonBuild=function(){ka(af)};d.menuCommonBuild.iconID=17;af=[d.buildFarm,d.buildBlacksmith,d.buildWorkshop,d.buildStable,d.buildTavern,d.buildHouse];af.menuName="e_build";d.menuCommonBuild.xtra=af;d.menuOtherBuild=function(){ka(bf)};d.menuOtherBuild.iconID=16;bf=[d.buildHarbor,d.buildOutpost,d.buildWoodWall,d.buildWoodGate,
d.buildBridge];bf.menuName="e_build";d.menuOtherBuild.xtra=bf;d.menuOtherBuild1=function(){ka(cf)};d.menuOtherBuild1.iconID=16;cf=[d.buildHarbor1,d.buildOutpost1,d.buildWoodWall,d.buildWoodGate,d.buildBridge];cf.menuName="e_build";d.menuOtherBuild1.xtra=cf;d.menuBuilds=function(){ka(df)};df=[d.menuSpecialBuild,d.menuCommonBuild,d.menuOtherBuild,d.buildBarrack,d.buildTower,d.buildStorage,d.buildLumbermill,d.buildFields];df.menuName="e_build";d.menuBuilds.iconID=245;d.menuBuilds.xtra=df;d.menuBuilds1=
function(){ka(ef)};d.menuBuilds1.iconID=245;ef=[d.menuSpecialBuild1,d.menuCommonBuild1,d.menuOtherBuild1,d.buildBarrack1,d.buildTower,d.buildStorage1,d.buildLumbermill1,d.buildFields];ef.menuName="a_build";d.menuBuilds1.xtra=ef;Ek=function(){d.fishing.obj={};d.impersonate.obj={};d.techGreatWall.obj=z[48];d.revealSelf.obj={};d.trade.obj={};d.unload.obj={};d.mercFootman6.obj={};d.murder.obj={};d.mercArcher6.obj={};d.mercMaceman6.obj={};d.mercPikeman6.obj={};d.mercLongbowman6.obj={};d.sameSpeed.obj=
{name:"Same speed"};d.restoreSpeed.obj={name:"Restore speed"};d.mercKnight6.obj={};d.attackGround.obj={};d.steady.obj={};d.bribe.obj={};d.createPriest1.obj=y[127];d.createPriest2.obj=y[87];d.createFootman2.obj=y[80];d.createArcher2.obj=y[81];d.createSatrap.obj=y[83];d.createPikeman2.obj=y[82];d.createHorseArcher2.obj=y[85];d.createCavalry.obj=y[84];d.createEnichar.obj=y[91];d.createJihad.obj=y[86];d.createMonk.obj=y[128];d.healing.obj={name:q.heal,spcost:[20,0,0,0]};d.bless.obj={name:q.bless,spcost:[20,
0,0,0]};d.stopTech.obj={};d.conquest.obj={};d.dcm.obj={name:q.dcm};d.repair.obj={name:q.repair};d.menuOtherBuild.obj={};d.menuOtherBuild1.obj={};d.menuOtherBuild2.obj={};d.sellItems.obj={};d.buyItems.obj={};d.menuBuilds.obj={name:q.menuBuild};d.menuCommonBuild.obj={};d.menuSpecialBuild.obj={};d.techMastery.obj=z[57];d.techNinjas.obj=z[56];d.teach.obj={name:"Teach",spcost:[20,0,0,0]};d.techPhilosophy.obj=z[55];d.techKungFu.obj=z[53];d.techTournaments.obj=z[54];d.techMeditation.obj=z[52];d.menuCommonBuild1.obj=
{};d.menuCommonBuild2.obj={};d.createMage1.obj=y[129];d.menuSpecialBuild1.obj={};d.menuSpecialBuild2.obj={};d.menuBuilds1.obj={name:q.menuBuild};d.menuBuilds2.obj={name:q.menuBuild};d.stopBuilding.obj={};d.freeze.obj={name:q.freeze,spcost:[200,0,0,0]};d.invisibility.obj={name:q.invisibility,spcost:[40,0,0,0]};d.autoInvisibility.obj={name:q.invisibility};d.createHeroes.obj={};d.createMercenaries.obj={};d.upgradeShip.obj={};d.techMedicine.obj=z[35];d.techBless.obj=z[36];d.buildHouse1.obj=y[111];d.techHealing.obj=
z[34];d.techInquisition.obj=z[33];d.techArmoredChariot.obj=z[51];d.techRocketArrow.obj=z[69];d.techJewelry.obj=z[64];d.techGunPowder.obj=z[68];d.techSeaFood.obj=z[67];d.techChemistry.obj=z[66];d.techBanking.obj=z[65];d.createMage.obj=y[5];d.techBat.obj=z[38];d.techGolem.obj=z[41];d.techInvisibility.obj=z[37];d.techLightning.obj=z[40];d.techFreeze.obj=z[39];d.techHeroism.obj=z[22];d.createHorseSamurai.obj=y[70];d.createChariot.obj=y[72];d.createHorseArcher1.obj=y[69];d.createHorseArcher2.obj=y[85];
d.createSamurai.obj=y[68];d.createArcher1.obj=y[67];d.techConfusion.obj=z[59];d.techConcentration.obj=z[58];d.techWhirlpool.obj=z[60];d.techDragon.obj=z[61];d.techTurnToStone.obj=z[62];d.techFlameBolt.obj=z[63];d.createRonin.obj=y[66];d.buildStorage.obj=y[18];d.buildStorage1.obj=y[113];d.buildStorage2.obj=y[94];d.buildFields.obj=y[20];d.buildLumbermill.obj=y[15];d.buildLumbermill1.obj=y[112];d.buildLumbermill2.obj=y[93];d.buildTower.obj=y[32];d.buildBarrack1.obj=y[71];d.buildBarrack.obj=y[14];d.buildBarrack2.obj=
y[102];d.buildDummy.obj=y[36];d.buildRocketTower.obj=y[57];d.buildMageTower.obj=y[16];d.buildMageTower1.obj=y[124];d.buildMageTower2.obj=y[107];d.buildMarket.obj=y[33];d.buildMarket1.obj=y[120];d.buildMarket2.obj=y[101];d.buildChurch.obj=y[25];d.buildChurch1.obj=y[118];d.buildChurch2.obj=y[99];d.buildMerchands.obj=y[24];d.irrigation.obj=z[50];d.ridingHorses.obj=z[49];d.buildMerchands1.obj=y[125];d.buildMerchands2.obj=y[108];d.buildCathedral.obj=y[11];d.buildCathedral1.obj=y[123];d.buildCathedral2.obj=
y[106];d.buildAcademy.obj=y[17];d.buildAcademy1.obj=y[126];d.buildAcademy2.obj=y[109];d.buildCastle.obj=y[12];d.magicVision.obj={name:"Magic Vision",spcost:[20,0,0,0]};d.fireRain.obj={name:"Fire Rain",spcost:[200,0,0,0]};d.raiseDead.obj={name:"Raise the Dead",spcost:[40,0,0,0]};d.createJinn.obj={name:"Spawn Jinn",spcost:[320,0,0,0]};d.createCarpet.obj={name:"Spawn Magic Carpet",spcost:[320,0,0,0]};d.buildCastle1.obj=y[62];d.buildCastle2.obj=y[63];d.buildHouse.obj=y[31];d.buildHouse2.obj=y[92];d.buildTavern.obj=
y[30];d.buildTavern1.obj=y[119];d.buildTavern2.obj=y[100];d.buildStable.obj=y[28];d.buildStable1.obj=y[121];d.buildStable2.obj=y[103];d.buildFarm.obj=y[23];d.buildFarm1.obj=y[114];d.buildFarm2.obj=y[95];d.buildWorkshop.obj=y[29];d.buildWorkshop1.obj=y[117];d.buildWorkshop2.obj=y[98];d.buildBlacksmith.obj=y[26];d.buildBlacksmith1.obj=y[116];d.buildBlacksmith2.obj=y[97];d.buildBridge.obj=y[35];d.buildHarbor.obj=y[41];d.buildHarbor1.obj=y[115];d.buildHarbor2.obj=y[96];d.createMage2.obj=y[89];d.buildMagicItems.obj=
{};d.techJanissary.obj=z[86];d.techRiddingHorses.obj=z[85];d.techOreFloatation.obj=z[84];d.techJinn.obj=z[83];d.techNecromancy.obj=z[82];d.techMagicVision.obj=z[81];d.techFireRain.obj=z[80];d.techMagicWorkshop.obj=z[79];d.techCarpet.obj=z[78];d.techJihad.obj=z[77];d.techScimitar.obj=z[76];d.techHorseManShip.obj=z[75];d.techCowPoaching.obj=z[74];d.buildWoodGate.obj={};d.buildWoodWall.obj=y[13];d.buildOutpost.obj=y[34];d.buildOutpost1.obj=y[122];d.buildOutpost2.obj=y[104];d.createGolem.obj={name:"Spawn Stone Golem",
spcost:[480,0,0,0]};d.techSunTzu.obj=z[73];d.techBushido.obj=z[70];d.techLeadership.obj=z[71];d.techHonor.obj=z[72];d.createBat.obj={name:"Spawn Bat",spcost:[40,0,0,0]};d.techGoldMining.obj=z[1];d.techStoneMining.obj=z[2];d.emergeAllUnits.obj={};d.origin.obj={name:"Origin"};d.createOrk.obj=y[58];d.createDwarf.obj=y[59];d.createSkeleton.obj=y[60];d.createGhost.obj=y[40];d.createFootman.obj=y[0];d.createArcher.obj=y[4];d.techSlavery.obj=z[87];d.createMaceman.obj=y[3];d.createPikeman.obj=y[1];d.createLongbowman.obj=
y[6];d.createKnight.obj=y[19];d.mercFootman.obj=c;d.mercArcher.obj=c;d.mercMaceman.obj=c;d.mercPikeman.obj=c;d.mercLongbowman.obj=c;d.mercKnight.obj=c;d.createPeon.obj=y[10];d.createSpy.obj=y[2];d.techFeudalism.obj=z[12];d.techArchitecture.obj=z[13];d.techLearning.obj=z[14];d.createPeon1.obj=y[64];d.createPeon2.obj=y[79];d.createNinja.obj=y[65];d.techBuddhism.obj=z[45];d.createCrusaders.obj={name:"Preach a crusade",cost:[1E3,0,2E3,0]};d.buildMagicWorkshop.obj=y[110];d.techFanaticism.obj=z[31];d.techCrusade.obj=
z[32];d.techEspionage.obj=z[30];d.techChainMail.obj=z[9];d.techHalberd.obj=z[6];d.techLongbow.obj=z[0];d.techScaleArmor.obj=z[5];d.techTemperIron.obj=z[4];d.techPlateArmor.obj=z[10];d.techLandingTactics.obj={};d.createGalleon.obj=y[73];d.createHulk.obj=y[75];d.createXebec.obj=y[76];d.createFishingBoat.obj=y[74];d.techCrossbow.obj=z[11];d.techWoodCutting.obj=z[3];d.techCannonTower.obj=z[46];d.techEngineering.obj=z[47];d.createBallist.obj=y[38];d.createHeavyCatapult.obj=y[39];d.createCatapult.obj=y[37];
d.upgradeCannonTower.obj=z[44];d.upgradeStoneTower.obj=z[43];d.upgradeGuildTower.obj=z[42];d.createCaravan.obj=y[61];d.createCaravan2.obj=y[90];d.techBribery.obj=z[21];d.techSupplyStorage.obj=z[20];d.techUsury.obj=z[19];d.techCropRotation.obj=z[8];d.createCow.obj=y[27];d.techDomestication.obj=z[7];d.techTradeTaxes.obj=z[18];d.techTradeRoutes.obj=z[17];d.techMapMaking.obj=z[16];d.createPriest.obj=y[9];d.techBodyBuilding.obj=z[29];d.techSiegeTactics.obj=z[28];d.techFame.obj=z[27];d.techHeroes.obj=z[26];
d.techMercenaries.obj=z[25];d.techTactics.obj=z[24];d.techWarfare.obj=z[23];for(var b=Object.keys(d),e=0,f=b.length;e<f;e++){var g=d[b[e]];g.objName=b[e];g.obj&&(g.obj.nu=g)}}},Mg=function(c,b){var d=b.length,f=c.length,g=0;a:for(;g<d;g++){for(var h=0;h<f;h++)if(b[g+h]!==c[h])continue a;return g}return!1},gl=function(c){for(var b=c.length,d=new Uint16Array(c.length),f=0;f<b;f++)d[f]=c.charCodeAt(f);return d},Dc=function(c,b){return Mg(gl(c),b)+c.length},Ng=function(c,b){c+=String.fromCharCode(0);
return Mg(gl(c),b)},Ei=function(c,b,d){var e="";for(b+=c;c<b&&d[c];c++)e+=String.fromCharCode(d[c]);return e},nf=function(c){c=new Uint8Array(c);var b=Mg([50,109,122,116],c)+6,d=c[b]+256*c[b+1],f=c[b+2]+(c[b+3]<<8)+(c[b+4]<<16);O("mapx:",d,"units",f);O("header",c[Dc(".header",c)],"description",c[Dc(".description",c)],"kingdominfo",c[Dc(".kingdominfo",c)],"diplomacy",c[Dc(".diplomacy",c)],"forbidden.upgrades",c[Dc(".forbidden.upgrades",c)],"tiles",c[Dc(".tiles",c)]);O(c);b=2*d;d={mapx:d,mapy:d,arje:!1};
var g="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12".split(" "),h="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12 xx13 xx14 xx15 xx16 xx17 xx18 xx19 xx20 xx21 resource".split(" "),l=b/2,k=20480+2*l*l,m={};l=0;for(var n=c.length;l<n;l++){var q=c[l];m[q]||(m[q]=[]);m[q].push(l)}m=[];var r={56:!0,58:!0,88:!0,72:!0};l=k+1;for(n=
c.length;l<n;l++)if(q=c[l],r[q]&&r[c[l+4]]){k={};q=72!==q?g:h;for(var t=l-2,v=0,w=q.length;v<w;v++){var x=q[v];"kingdom"==x||"race"==x?(k[x]=c[t],t++):(k[x]=c[t]+256*c[t+1],t+=2)}l+=2*w-3;m.push(k)}d.allunits=m;d.allunits.length>f&&(d.allunits.length=f);f=d.allunits;b/=2;m=[];g=0;r=[];q=k=c[Dc(".forbidden.upgrades",c)]+1;l=k*=512;for(h=c.length;l<h;l+=2){v=c[l];t=~~(l/512);for(n=8;n<b&&c[n+l]===(v+n/4)%256;n+=4);20<n&&(l=512*t,1==m.length&&(l=512*(t-(2-(t-q)%2))),n=c.slice(k,l),k-l&&(m[g++]=[k,l],
r.push(n)),l+=512,2==m.length&&(l-=512),k=l)}m[g++]=[k,c.length];r={64:[m[0]],96:[m[0]],128:[m[0]],192:[m[1],m[0],m[2],m[3]],256:[m[1],m[0],m[2],m[3]],384:[m[1],m[0],m[2],m[3],m[4],m[5],m[6]],512:[m[1],m[0],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9]]}[b];O(m);m=new Uint8Array(b*b);k=new Uint8Array(b*b);n=g=0;for(q=r.length;n<q;n++)if(h=r[n],g<b*b)for(l=h[0],h=h[1];l<h;l+=2)m[g]=Mm[c[l]]||0,k[g]=c[l+1],10<k[g]&&f.push({type:7,d:k[g]%31,x32:g%b,y32:~~(g/b)}),g++;d.terrain=m;f=(b="grass",Ng("grass",c))||
(b="summer",Ng("summer",c))||(b="desert",Ng("desert",c))||(b="snow",Ng("snow",c));if("summer"==b||b)if("summer"==b||"desert"==b)b="grass";g=Ei(512*(c[Dc(".description",c)]-1),512,c);d.description=g;d.author=Ei(f-64,64,c);d.name=Ei(f-128,64,c);d.terrainType=b;d.kingdoms=nf.getKingdoms(c,d);nf.getDiplomacy(c,d.kingdoms);O(d);return d};nf.getKingdoms=function(c,b){for(var d=Mg([192,4],c)+50;!c[d];)d++;var f="name tzar active resGold resStone resFood resWood x6 race x8 x9 x10 x11 x12 x13 x14 AI x16 x17 x18 x19 x20".split(" "),
g=f.length,h=[],l,k=[[0,0,189],[206,25,25],[49,181,0],[173,0,197],[255,222,0],[0,181,181],[255,156,33],[90,90,90]];O("kingdoms:",d);b.tr={0:0,9:0,10:0};for(var m=0;8>m;m++){for(var n={color:k[m]},q=!0,r=0;r<g;r++){var t=f[r];if("name"==t||"tzar"==t){for(n[t]="";!c[d];)d++;for(l=d+32;c[d];)n[t]+=String.fromCharCode(c[d]),d++;d=l}else n[t]=c[d]+(c[d+1]<<8)+(c[d+2]<<16)+(c[d+3]<<24),"race"==t&&(n[t]=c[d],n.racestr=yg[c[d]-1]),2!=r||c[d]||(q=!1),d+=4}q&&(h.push(n),b.tr[m+1]=h.length);1<h.length&&(n.IA=
1);n.resources=[n.resGold,n.resWood,n.resFood,n.resStone];n.race--}O(h);return h};nf.getDiplomacy=function(c,b){for(var d=512*(c[Dc(".diplomacy",c)]-1),f=b.length,g=0;g<f;g++){var h=[0];if(b[g]){b[g].diplomacy=h;for(var l=1;9>l;l++){if(b[l-1]){var k=c[d];k=60>k&&l-1!=g?1:0;h.push(k)}d+=4}}else d+=32}};var Mm={0:3,32:0,144:1,240:2,64:2},xm={15:78,16:77,19:37,20:39,21:38,22:131,23:73,24:75,25:76,27:59,28:58,30:132,31:40,32:130,36:60,38:42,39:55,40:32,41:44,42:56,43:57,61:13,62:13,63:20,64:35,72:43,
110:27,133:36,136:74,257:10,258:61,259:0,260:4,261:3,262:6,263:1,264:19,267:8,270:2,273:5,274:9,300:12,301:14,302:15,303:23,304:30,305:25,306:28,307:18,308:34,309:33,310:41,311:11,312:17,314:26,315:29,316:16,321:24,322:31,513:79,514:90,515:80,516:81,517:83,519:82,522:85,529:89,530:87,541:91,545:86,547:84,556:63,557:102,558:93,559:95,560:100,561:99,562:103,563:94,564:104,565:101,566:96,568:109,570:97,571:98,572:107,577:108,578:92,581:110,583:106,769:64,771:66,772:67,773:68,778:69,780:128,781:65,785:129,
786:127,802:70,805:72,812:62,813:71,814:112,815:114,816:119,817:118,818:121,819:113,820:122,821:120,822:115,824:126,826:116,827:117,828:124,833:125,834:111,838:123,76:21,78:22},vh=function(c,b,d,f){if(Yd&&!n.editor){var e=Yd.events.defined[b.id];if(e&&e[d])if(e=e[d],"zone"==d)for(c=0,f=e.length;c<f;c+=5){d=e[c];var h=e[c+2],l=e[c+3],k=e[c+4];b.x32>=e[c+1]&&b.x32<=l&&b.y32>=h&&b.y32<=k?(b.inZone||(b.inZone={}),b.inZone[d.id]||Og([e[c]],1),b.inZone[d.id]=1):b.inZone&&b.inZone[d.id]&&(b.inZone[d.id]=
0,Og([e[c]],-1))}else{if(!f)return Og(e,c);O(f.name);b=e.defined;b[f.id]&&Og(b[f.id],c)}}},Og=function(c,b){for(var d=c.length,f=0;f<d;f++){var g=c[f],h=g.rule,l=g.activeEvents;g.activeEvents+=b;0===l?h.activeEvents++:0===g.activeEvents&&h.activeEvents--;if(1==b&&h.activeEvents==h.events.length)for(g=0,h=h.actions,l=h.length;g<l;g++){var k=h[g];O("action:",k.type);if(hl[k.type])hl[k.type](k.to[0],k.list)}}},hl={attack:xc,move:Fa},Xc={};t("selectUnits").onclick=function(){t("mapeditorinfoUnits").style.display=
"block";t("mapeditorinfoBuilds").style.display="none";t("mapeditorinfoItems").style.display="none";t("mapeditorinfoNature").style.display="none"};t("selectBuilds").onclick=function(){t("mapeditorinfoUnits").style.display="none";t("mapeditorinfoBuilds").style.display="block";t("mapeditorinfoItems").style.display="none";t("mapeditorinfoNature").style.display="none"};t("selectItems").onclick=function(){t("mapeditorinfoUnits").style.display="none";t("mapeditorinfoBuilds").style.display="none";t("mapeditorinfoItems").style.display=
"block";t("mapeditorinfoNature").style.display="none"};t("selectNature").onclick=function(){t("mapeditorinfoUnits").style.display="none";t("mapeditorinfoBuilds").style.display="none";t("mapeditorinfoItems").style.display="none";t("mapeditorinfoNature").style.display="block"};Xc.start=function(){Sb();var c=document.createElement("div");c.id="mapForm";c.innerHTML="\n            <div>\n            <h2>"+q.gameOptions+"</h2>\n            <table>\n<tr><td>"+q.mapSize+': </td><td><input type="number" id=\'editorSize\' min="10" value="256" /></td></tr>\n<tr><td>'+
q.random+' </td><td>\n<label class="container">\n  <input type="checkbox" id="editorRandom">\n  <span class="checkmark"></span>\n</label>\n</td></tr>\n<tr><td>'+q.nplayers+': </td><td><input id="editorPlayers" type="number" min="1" value="3"></td></tr>\n</table>\n</div>';var b=document.createElement("button");b.innerHTML=q.continue;b.onclick=Xc.func;c.children[0].appendChild(b);b=document.createElement("button");b.innerHTML=q.cancel;b.onclick=Nm;c.children[0].appendChild(b);document.body.appendChild(c)};
var Nm=function(){location.hash="";setTimeout($h,200);document.body.removeChild(this.parentElement.parentElement);Ma()};Xc.func=function(){O(n.arje);if(void 0==n.arje){Ma();t("editorRandom").checked?n.arje=555555*Math.random()+1:n.arje=!1;n.mapx=parseInt(t("editorSize").value);n.mapy=n.mapx;n.goldRes=Infinity;n.foodRes=Infinity;n.woodRes=Infinity;n.stoneRes=Infinity;n.gravity=580.9/9.8*9.8;n.terrainType="grass";Aa=[];for(var c=0,b=parseInt(t("editorPlayers").value);c<b;c++){for(var d="#"+(~~(16777216*
Math.random())).toString(16);7>d.length;)d+="0";Aa[c]={color:d,IA:!1,name:"Tzar "+(c+1),race:0,team:0}}document.body.removeChild(t("mapForm"))}n.editor=1;if(xd(0,Xc.func)&&(t("statButton").style.display="none",t("menu").style.display="none",t("resources").style.display="none",t("mapeditorinfotop").style.display="block",t("mapeditorinfo").style.display="block",d=document.getElementById("mapeditorinfoUnits"),d.style.display="block",Pg(),!Xc.preload)){Xc.preload=!0;var f={},g={},h=y,l={euro:cb[0],arab:cb[1],
asia:cb[2],common:q.common};f[cb[0]]=[];f[cb[1]]=[];f[cb[2]]=[];f[q.common]=[];g[cb[0]]=[];g[cb[1]]=[];g[cb[2]]=[];g[q.common]=[];c=0;for(b=h.length;c<b;c++){var k=h[c];!k.race||k.illegal||7==k.type||k.item||(k.build?g[l[k.race]].put(c):f[l[k.race]].put(c))}for(k=0;2>k;k++){h=Object.keys(f);var m={};c=0;for(b=h.length;c<b;m={ul$17:m.ul$17},c++){var v=document.createElement("h1");v.innerHTML=h[c];m.ul$17=document.createElement("ul");v.onclick=function(b){return function(){dh(b.ul$17)}}(m);m.ul$17.style.display=
"none";for(var w=f[h[c]],r=Object.keys(w),x={},z=0,A=r.length;z<A;x={tcreate:x.tcreate},z++)l=document.createElement("li"),l.innerHTML=y[w[r[z]]].name,x.tcreate=w[r[z]],l.onclick=function(b){return function(){var c=b.tcreate;y[c].wall?Fh(c):N(c)}}(x),m.ul$17.appendChild(l);d.appendChild(v);d.appendChild(m.ul$17)}f=g;d=t("mapeditorinfoBuilds")}h=Object.keys(gc);d=t("mapeditorinfoItems");var B=document.createElement("ul");f={};c=0;for(b=h.length;c<b;f={u$18:f.u$18},c++)l=document.createElement("li"),
f.u$18=gc[h[c]],l.onclick=function(b){return function(){$i(b.u$18)}}(f),l.innerHTML=f.u$18.name,B.appendChild(l);d.appendChild(B);d=t("mapeditorinfoNature");v=document.createElement("h1");v.innerHTML=q.trees;B=document.createElement("ul");v.onclick=function(){dh(B)};B.style.display="none";l=document.createElement("li");B.appendChild(l);d.appendChild(v);d.appendChild(B);l.onclick=function(){Fi(Om)};l.innerHTML=q.delete;l=document.createElement("li");B.appendChild(l);l.onclick=function(){Fi(Pm)};l.innerHTML=
q.create;v=document.createElement("h1");v.innerHTML=q.terrain;var C=document.createElement("ul");v.onclick=function(){dh(C)};C.style.display="none";d.appendChild(v);d.appendChild(C);b=pc.texturesRandomMap;d={};c=0;for(b=b.length;c<b;d={l:d.l},c++)l=document.createElement("li"),C.appendChild(l),l.innerHTML=c,d.l=c,l.onclick=function(b){return function(){Fi(Gi);Gi.active=b.l}}(d)}};var Pg=function(){var c=t("selectKingdom");c.innerHTML="";for(var b=1,d=H.length;b<d;b++){var f=H[b];1===b&&(c.style.background=
"rgba("+f.color[0]+","+f.color[1]+","+f.color[2]+",1)");c.innerHTML+='<option value="'+b+'" style="background:rgba('+f.color[0]+","+f.color[1]+","+f.color[2]+',1)">'+f.name+"</option>"}};t("selectKingdom").onchange=function(){v.kingdom=parseInt(this.value);var c=H[v.kingdom].color;this.style.background="rgba("+c[0]+","+c[1]+","+c[2]+",.8)"};var mm=function(c){Sb();var b=document.createElement("div"),d=document.createElement("div");b.id="unitProps";var f="<table>"+('\n<tr><td>Name </td><td><input data-prop="name" type="text" value="'+
c.name+'" /></td></tr>\n<tr><td>'+q.health+' </td><td><input data-prop="health" type="number" value="'+c.health+'" /></td></tr>\n<tr><td>'+q.maxHealth+'</td> <td><input data-prop="maxHealth" type="number" value="'+c.maxHealth+'" /></td></tr>\n');if(c.build||c.item)if(c.item){if(c.sword||c.shield)f+="\n<tr><td>"+q.attack+'</td><td><input data-prop="attack" type="number" value="'+(c.attack||0)+'" /></td></tr>\n<tr><td>'+q.defence+'</td> <td><input data-prop="defence" type="number" value="'+(c.defence||
0)+'" /></td></tr>\n'}else c.kingdom&&(f+="<tr><td>"+q.kingdom+' </td><td><select id="selectKingdom2">'+t("selectKingdom").innerHTML+"</select></td></tr>");else f+="\n<tr><td>"+q.attack+'</td><td><input data-prop="attack" type="number" value="'+(c.attack||0)+'" /></td></tr>\n<tr><td>'+q.defence+'</td> <td><input data-prop="defence" type="number" value="'+(c.defence||0)+'" /></td></tr>\n<tr><td>'+q.mana+' <td><input data-prop="mana" type="number" value="'+(c.mana||0)+'" /></td></tr>\n<tr><td>'+q.kingdom+
' </td><td><select id="selectKingdom2">'+t("selectKingdom").innerHTML+"</select></td></tr>\n";d.innerHTML=f+"</table>";f=document.createElement("button");f.innerHTML=q.ok;f.onclick=function(){for(var b=t("unitProps").getElementsByTagName("input"),d=0,e=b.length;d<e;d++)if(b[d]){var f=b[d].value;"number"==b[d].type&&(f=parseInt(f));var k=b[d].dataset.prop;c.__proto__[k]!=f&&(c[k]=f)}c.kingdom&&t("selectKingdom2")&&(b=parseInt(t("selectKingdom2").value),b!=c.kingdom&&c.changeKingdom(b));document.body.removeChild(t("unitProps"));
Ma()};d.appendChild(f);b.appendChild(d);document.body.appendChild(b);O(c.kingdom);t("selectKingdom2")&&(t("selectKingdom2").value=c.kingdom)},ta=function(c){document.getElementById(c).style.display="none"},ib=function(c){document.getElementById(c).style.display="block"},mi,Fi=function(c){mi=!0;W=function(){};var b=C;b.img=m.blank;var d=32*Sd();b.wh=[d,d];yb(b);b.active=!0;document.addEventListener("mousemove",nc);document.addEventListener("mousedown",il);nc.active=c},il=function(c){if(2==c.buttons||
c.pageX<v.menumx||c.pageY<v.menumy)return jl();nc(c)},kk=function(c){if(n.editor){var b=parseInt(t("brushSize").value)+c;b>t("brushSize").max?t("brushSize").value=t("brushSize").max:1>b?t("brushSize").value=1:(t("brushSize").value=b,C.wh&&(C.wh[0]+=32*c,C.wh[1]+=32*c,C.active=!0))}},Sd=function(){return parseInt(t("brushSize").value)},Gi=function(c,b,d){c=Sd();for(var e=c*c,g=A,h=Tc,k=Gi.active,m=pc.type,n=0;n<e;n++){var q=b+n%c,t=d+~~(n/c);ma(q,t)&&(q+=t*g,h[q]=k,m[k]&&(2<K[q]&&x[K[q]].die(),2<Sa[q]&&
x[Sa[q]].die()))}Yc()},Pm=function(c,b,d){c=Sd();for(var e=c*c,g=A,h=0;h<e;h++){var k=b+h%c,m=d+~~(h/c);ma(k,m)&&(0===K[k+m*g]?.2>Math.random()&&uc([k+m*g,7,{d:3+~~(28*Math.random())}]):(k=x[K[k+m*g]],7==k.type&&k.die()))}},Om=function(c,b,d){c=Sd();for(var e=c*c,g=A,h=0;h<e;h++){var k=b+h%c,m=d+~~(h/c);ma(k,m)&&(k=x[K[k+m*g]],7==k.type&&k.die())}},nc=function(c){var b=32*Sd();b=ic(c.pageX-v.mx-.5*b/V,c.pageY-.5*b/V);var d=~~(.03125*b[1]);b=~~(.03125*b[0]);C.x=32*b;C.y=32*d;C.active=!0;if(0!==c.buttons){if(2==
c.buttons)return jl();nc.last!==b+d*A&&nc.active&&nc.active(c,b,d);nc.last=b+d*A}},jl=function(){C.active=!0;C.x=-9999;C.y=-9999;mi=!1;if(nc.active){var c=32*Sd();ic(event.pageX-v.mx-.5*c/V,event.pageY-.5*c/V);nc.active=!1}C.wh=void 0;document.removeEventListener("mousedown",il);document.removeEventListener("mousemove",nc)};t("mapProps").onclick=function(){t("mapPropsWindow").style.display="block";Sb();if(""==t("mapPropsWindow").innerHTML){var c=document.createElement("div");t("mapPropsWindow").appendChild(c);
var b=document.createElement("table");c.appendChild(b);b=document.createElement("div");b.innerHTML=q.mapName;var d=document.createElement("input");d.value=n.name||q.strcusMap;d.id="mapName";d.type="text";c.appendChild(b);c.appendChild(d);b=document.createElement("div");b.innerHTML=q.description;d=document.createElement("textarea");d.type="text";d.value=n.description||"";d.id="mapDescription";c.appendChild(b);c.appendChild(d);b=document.createElement("div");b.innerHTML=q.author;d=document.createElement("input");
d.id="mapAuthor";d.value=n.author||"";d.type="text";c.appendChild(b);c.appendChild(d);c.appendChild(document.createElement("p"));b=document.createElement("button");b.onclick=kl;b.innerHTML=q.close;c.appendChild(b)}Hi()};var kl=function(){O(this);this.parentElement.parentElement.style.display="none";Ma()},ml={objAction:{id:"edobjAction",msg:q.objAction,func:function(){sa.active.type="attack";ib("selectionEvents");ta("eventZone");ib("unitListDiv2");t("byButton2").style.display="inline-block";t("byButton1").style.display=
"inline-block";sa.active.zone=void 0}},objZone:{id:"edobjAction",msg:q.objZone,func:function(){sa.active.type="zone";sa.active.to.length=0;ta("selectionEvents");t("eventZone").style.display="inline-block";ta("byButton2");ta("byButton1");ta("unitListDiv2");ll()}}},Ld=function(c){if(c)ta("mapRulesWindow"),Ma(),Ld.actived=!0;else if(Ld.actived){ib("mapRulesWindow");Sb();c=~~(fa[0]/32);var b=~~(fa[1]/32),d=~~(fa[9]/32),f=~~(fa[10]/32);if(c<d)var g=c,h=d;else g=d,h=c;if(b<f)var k=b,m=f;else k=f,m=b;sa.active.zone||
(sa.active.zone=[]);sa.active.zone.put([g,k,h,m]);O(c,b,d,f);ll();Ld.actived=!1}},ll=function(){var c=t("zoneList");c.innerHTML="";var b=sa.active.zone;if(b)for(var d=b.length,f=0;f<d;f++){var g=b[f],h=document.createElement("div"),k=document.createElement("button");k.innerHTML="x";k.obj=g;k.pObj=b;k.spObj=!0;k.onclick=Ii;h.innerHTML=g[0]+"x "+g[1]+"y -> "+g[2]+"x "+g[3]+"y";h.appendChild(k);c.appendChild(h)}};t("mapRules").onclick=function(){t("mapRulesWindow").style.display="block";Sb();if(""==
t("mapRulesWindow").innerHTML){var c=document.createElement("div");c.innerHTML='\n<div id="mapEvent">\n<h4>'+q.events+'</h4>\n<select id="eventOptions" style="display:none">\n<option value="objAction">'+q.objAction+'</option>\n<option value="objZone">'+q.objZone+'</option>\n</select>\n<div id="eventScreen">\n</div>\n<div id="eventLayout">\n</div>\n<button id="addEvent">+</button>\n</div>\n<div id="mapActions">\n<h4>'+q.actions+'</h4>\n<select id="actionOptions" style="display:none">\n<option value="objOrder">'+
q.objOrder+'</option>\n</select>\n<div id="actionScreen">\n</div>\n<div id="actionLayout">\n</div>\n<button id="addAction">+</button>\n</div>\n<h4>'+q.rules+"</h4>\n";var b=document.createElement("div");b.id="rulist";c.appendChild(b);b=document.createElement("button");b.onclick=Qm;b.innerHTML="+";c.appendChild(b);b.id="addRule";c.appendChild(document.createElement("p"));b=document.createElement("button");b.onclick=kl;b.innerHTML=q.close;c.appendChild(b);t("mapRulesWindow").appendChild(c);t("addEvent").onclick=
Rm;t("addAction").onclick=Sm;t("eventOptions").onchange=function(){var b=ml[this.value];sa.div=b.id;ib(sa.div);sa.active.name=this.value;b.func&&b.func();b=t("eventScreen").getElementsByTagName("button");for(var c=!1,d=0,e=b.length;d<e;d++){var f=b[d];if(f.sdiv)if("none"==f.style.display)f.sdiv.style.display="none";else{if(!c)f.onclick();c=!0}}Qg(Hb.active,"eventLayout")};t("actionOptions").onchange=function(){Ib.active.name=this.value;Qg(Hb.active,"actionLayout")};c=document.createElement("div");
c.id="edobjAction";var d=document.createElement("select");d.innerHTML='\n<option value="attack">'+q.attack+'</option>\n<option value="destroy">'+q.destroy+'</option>\n<option value="moving">'+q.moving+'</option>\n<option value="capture">'+q.capture+"</option>\n";d.value="attack";d.id="selectionEvents";d.onchange=Tm;var f=document.createElement("section"),g=document.createElement("section"),h=document.createElement("section"),k=document.createElement("section"),m=document.createElement("section");
b=document.createElement("button");b.innerHTML=q.add;b.onclick=Ld;var n=document.createElement("div");n.className="unitList";n.id="zoneList";h.appendChild(b);h.appendChild(n);n=document.createElement("div");n.className="unitList";n.id="unitListDiv";n.spType=sa;b=document.createElement("button");b.innerHTML=q.add;b.onclick=function(){Vb(this)};b.button=n;b.style.margin="10px";f.appendChild(b);b=document.createElement("button");b.innerHTML=q.defined;b.onclick=xb;b.sdiv=f;c.appendChild(b);b.onclick();
b=document.createElement("button");b.innerHTML=q.undefined;b.onclick=xb;b.sdiv=g;c.appendChild(b);f.appendChild(n);c.appendChild(f);c.appendChild(g);c.appendChild(document.createElement("p"));c.appendChild(d);c.appendChild(document.createElement("p"));n=document.createElement("div");n.className="unitList";n.id="unitListDiv2";n.spType=sa;b=document.createElement("button");b.innerHTML=q.add;b.onclick=function(){Vb(this)};b.button=n;b.style.margin="10px";k.appendChild(b);b=document.createElement("button");
b.innerHTML=q.defined;b.onclick=xb;b.sdiv=k;b.id="byButton1";c.appendChild(b);b=document.createElement("button");b.innerHTML=q.undefined;b.onclick=xb;b.id="byButton2";b.sdiv=m;c.appendChild(b);k.appendChild(n);b=document.createElement("button");b.innerHTML=q.zone;b.onclick=xb;b.sdiv=h;b.id="eventZone";b.style.display="none";c.appendChild(b);c.appendChild(h);c.appendChild(k);c.appendChild(m);t("eventScreen").appendChild(c);ta("mapEvent");ta("mapActions");c=document.createElement("div");c.id="edobjOrder";
d=document.createElement("select");d.innerHTML='\n<option value="move">'+q.move+'</option>\n<option value="attack">'+q.attack+"</option>\n";d.value="move";d.id="selectionActions";d.onchange=Um;f=document.createElement("section");g=document.createElement("section");k=document.createElement("section");m=document.createElement("section");n=document.createElement("div");n.className="unitList";n.id="unitListDivAction";n.spType=Ib;b=document.createElement("button");b.innerHTML=q.add;b.onclick=function(){Vb(this)};
b.button=n;b.style.margin="10px";f.appendChild(b);b=document.createElement("button");b.innerHTML=q.defined;b.onclick=xb;b.sdiv=f;c.appendChild(b);b=document.createElement("button");b.innerHTML=q.undefined;b.onclick=xb;b.sdiv=g;c.appendChild(b);f.appendChild(n);c.appendChild(f);c.appendChild(g);b.onclick();c.appendChild(document.createElement("p"));c.appendChild(d);c.appendChild(document.createElement("p"));n=document.createElement("div");n.className="unitList";n.id="unitListDivAction2";n.spType=Ib;
b=document.createElement("button");b.innerHTML=q.add;b.onclick=function(){Vb(this)};b.button=n;b.style.margin="10px";k.appendChild(b);b=document.createElement("button");b.innerHTML=q.defined;b.onclick=xb;b.sdiv=k;b.id="toButton1";c.appendChild(b);b=document.createElement("button");b.innerHTML=q.undefined;b.onclick=xb;b.id="toButton2";b.sdiv=m;c.appendChild(b);k.appendChild(n);c.appendChild(k);c.appendChild(m);b.onclick();t("actionScreen").appendChild(c);ta("mapEvent");ta("mapActions")}};var nl={moving:1},
Tm=function(){nl[this.value]?(ta("byButton2"),ta("byButton1"),ta("unitListDiv2")):(ib("unitListDiv2"),t("byButton2").style.display="inline-block",t("byButton1").style.display="inline-block");sa.active.type=this.value},Um=function(){nl[this.value]?(ta("toButton2"),ta("toButton1"),ta("unitListDivAction2")):(ib("unitListDivAction2"),t("toButton2").style.display="inline-block",t("toButton1").style.display="inline-block");Ib.active.type=this.value},Vb=function(c){if(c)ta("mapRulesWindow"),Ma(),Vb.actived=
c.button;else if(Vb.actived){ib("mapRulesWindow");Sb();c=Vb.actived.spType.active;c="unitListDiv2"==Vb.actived.id||"unitListDivAction2"==Vb.actived.id?c.to:c.list;for(var b={},d=0,f=c.length;d<f;d++)b[c[d]]=1;d=0;for(f=G.length;d<f;d++)b[G[d]]||c.put(G[d]);of(Vb.actived,c);Vb.actived=!1}},of=function(c,b){c.innerHTML="";for(var d=0,f=b.length;d<f;d++){var g=document.createElement("div");g.innerHTML=x[b[d]].name;var h=document.createElement("button");h.onclick=Ii;h.innerHTML="x";h.pObj=b;h.spObj=!0;
h.obj=b[d];g.appendChild(h);c.appendChild(g)}},xb=function(){xb.active&&(xb.active.className="");xb.active=this;this.className="spSelect";for(var c=this.parentElement.getElementsByTagName("section"),b=0,d=c.length;b<d;b++)c[b].style.display="none";this.sdiv.style.display="block"},Hb=function(){var c=this.editorRule;c.deleted||(ib("mapEvent"),ib("mapActions"),ta("eventOptions"),Hb.active&&(Hb.div.className=""),this.className="spSelect",Hb.active=c,Hb.div=this,Qg(c,"eventLayout"),Qg(c,"actionLayout"),
sa.div&&ta(sa.div),sa.div1=void 0)},sa=function(){var c=this.editorRule;c.deleted||(ib("eventOptions"),sa.div1&&(sa.div1.className=""),this.className="spSelect",sa.active=c,t("selectionEvents").value=c.type,sa.div1=this,t("eventOptions").value=c.name,sa.div=ml[c.name].id,ib(sa.div),of(t("unitListDiv"),c.list),of(t("unitListDiv2"),c.to))},Ib=function(){var c=this.editorRule;c.deleted||(ib("actionOptions"),Ib.div1&&(Ib.div1.className=""),this.className="spSelect",Ib.active=c,t("selectionActions").value=
c.type,Ib.div1=this,t("actionOptions").value=c.name,Ib.div="ed"+c.name,ib(Ib.div),of(t("unitListDivAction"),c.list),of(t("unitListDivAction2"),c.to))},Qg=function(c,b){t(b).innerHTML="";if("eventLayout"==b){c=c.events;var d=sa,f=Hb.active.events}else c=c.actions,d=Ib,f=Hb.active.actions;for(var g=0,h=c.length;g<h;g++){var k=document.createElement("div");Rg(k,c[g],d,f);t(b).appendChild(k)}},Rm=function(){var c=Hb.active,b={name:"objAction",list:[],to:[],type:"attack"};c.events.put(b);var d=document.createElement("div");
Rg(d,b,sa,c.events);t("eventLayout").appendChild(d);if(sa.div1)sa.div1.onclick()},Sm=function(){var c=Hb.active,b={name:"objOrder",list:[],to:[],type:"move"};c.actions.put(b);var d=document.createElement("div");Rg(d,b,Ib,c.actions);t("actionLayout").appendChild(d);if(Ib.div1)Ib.div1.onclick()},Rg=function(c,b,d,f){c.innerHTML=b.events?b.name:q[b.name];c.onclick=d;c.editorRule=b;d=document.createElement("button");d.innerHTML="x";d.obj=b;d.pObj=f;d.onclick=Ii;c.appendChild(d)},Qm=function(){n.rules||
(n.rules=[]);var c={name:"Rule"+n.rules.length,events:[],actions:[]};n.rules.put(c);var b=document.createElement("div");Rg(b,c,Hb,n.rules);t("rulist").appendChild(b)},Ii=function(){this.pObj.quit(this.obj);this.obj.deleted=!0;this.parentElement.parentElement.removeChild(this.parentElement);if(!this.spObj)if(this.pObj!==n.rules)Hb.div.onclick();else ta("mapEvent"),ta("mapActions")},Hi=function(){var c=t("mapPropsWindow").getElementsByTagName("table")[0];c.innerHTML="";c.innerHTML+="<tr><td>"+q.color+
"</td><td>"+q.username+"</td><td>"+q.gold+"</td><td>"+q.wood+"</td><td>"+q.food+"</td><td>"+q.stone+"</td><td>"+q.AI+"</td><td>"+q.team+"</td></tr>";for(var b=1,d=H.length;b<d;b++){var f=H[b],g=f.color,h=f.resources;g="#"+(16777216+(g[0]<<16)+(g[1]<<8)+g[2]).toString(16).slice(1);c.innerHTML+='<tr><td><input style="background:'+g+'" type="color" value="'+g+'" /></td><td><input type="text" value="'+f.name+'"></td>\n\n<td><input type="text" class="res" value="'+(parseInt(h[0])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+
(parseInt(h[1])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[2])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(h[3])||"\u221e")+'"></td>\n<td><label class="container">\n  <input type="checkbox">\n  <span class="checkmark"></span>\n</label></td><td><input type="number" min="0" value="'+f.team+'"></td></tr>'}c.innerHTML+="<tr><td><button id='editorAdd'>+</button><button id='editorDelete'>-</button></td></tr>";t("editorAdd").onclick=Vm;t("editorDelete").onclick=
Wm;c=c.getElementsByTagName("input");b=0;for(d=H.length-1;b<d;b++)h=8*b,f=H[b+1],c[h].onchange=Xm,c[h+1].onchange=Ym,c[h+2].onchange=Sg,c[h+3].onchange=Sg,c[h+4].onchange=Sg,c[h+5].onchange=Sg,c[h+2].res=0,c[h+3].res=1,c[h+4].res=2,c[h+5].res=3,c[h+6].onchange=Zm,c[h+6].checked=f.IA,c[h+7].onchange=$m,c[h].team=b+1,c[h+1].team=b+1,c[h+2].team=b+1,c[h+3].team=b+1,c[h+4].team=b+1,c[h+5].team=b+1,c[h+6].team=b+1,c[h+7].team=b+1},Sg=function(){var c=parseInt(this.value);c||(c=Infinity,this.value="\u221e");
H[this.team].resources[this.res]=c},Vm=function(){new Tb("Tzar "+H.length,[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],[0],0,!0,[n.goldRes,n.woodRes,n.foodRes,n.stoneRes],2);Pg();Hi()},Wm=function(){if(2<H.length){for(var c=H.length-1,b=3,d=x.length;b<d;b++){var f=x[b];f.kingdom==c&&f.die()}H.length--;Pg();Hi()}},Xm=function(){var c=H[this.team],b=parseInt(this.value.substr(1),16),d=b>>16&255,f=b>>8&255;b&=255;c.color=[d,f,b];var g=this.team;c=xa[g];H[g].color=[d,f,b];g*=3;
Na[g]=d/255;Na[g+1]=f/255;Na[g+2]=b/255;d=0;for(f=c.length;d<f;d++){b=c[d];g=0;for(var h=b.length;g<h;g++)Ac(x[b[g]])}Pg()},Ym=function(){H[this.team].name=this.value},Zm=function(){H[this.team].IA=this.checked?!0:!1},$m=function(){var c=H[this.team];c.team=parseInt(this.value);for(var b=H.length,d=1;d<b;d++){var f=H[d];f.team!==c.team&&(f.diplomacy[c.k]=1,c.diplomacy[f.k]=1)}};Se.onchange=function(c){Q(bg,parseInt(Se.value)/100,G)};var Ui=function(c){var b=c.length;Q(xi,b);for(var d=Wa.step,f=0;f<
b;f+=d)Q(Wa,c.slice(f,f+d))},Fm=function(c){if(c=document.getElementById("maploadOnline").files[0]){c.name.split(".");var b=new FileReader;b.onload=function(){var b=new Uint8Array(this.result);v.admin&&(ta("optionbutton"),Ui(b),Tk(b),O(ia),Vk(ia.kingdoms.length),t("nplayersO").value=v.room.max,t("deleteCusMap").style.display="inline-table")};b.readAsArrayBuffer(c)}},Uk=function(c,b){if(b&&"wmp"==b)return nf(c);O(c[0]);var d=c[1]+(c[2]<<8)+(c[3]<<16)+(c[4]<<24);b=new TextDecoder("utf-8");b=JSON.parse(b.decode(c.slice(5,
d+5)));if(!1===b.arje){c=c.slice(d+5,d+5+Math.pow(b.mapx,2));var f=Math.pow(b.mapx,2);d=c.length;f=f?new Uint8Array(f):[];for(var g=0,h=0;h<d;h++){var k=c[h];if(255!==k)f[g++]=k;else{k=c[h-1];for(var m=(c[h+1]<<8)+c[h+2],n=0;n<m;n++)f[g++]=k;h+=2}}b.terrain=f}b.allunits&&(b.allunits=Rk(b.allunits));b.ini&&(b.ini=Rk(b.ini));return b};t("mapload").accept=".tzared,.wmp";t("mapload").onchange=function(c){c=document.getElementById("mapload").files[0];var b=c.name.split(".");b=b[b.length-1];var d=new FileReader;
d.onload=function(){var c=new Uint8Array(this.result);c=Uk(c,b);ib("customMapcont");t("editCustom").style.display="inline-table";ia=c;ia.kingdomStart?(t("seeStats").style.display="inline-table",t("playrecord").style.display="inline-table"):(t("seeStats").style.display="none",t("playrecord").style.display="none");null===ia.goldRes&&(ia.goldRes=Infinity);null===ia.stoneRes&&(ia.stoneRes=Infinity);null===ia.foodRes&&(ia.foodRes=Infinity);null===ia.woodRes&&(ia.woodRes=Infinity);c=document.getElementById("custombody");
c.innerHTML="";for(var d=ia.kingdoms,e=0,k=d.length;e<k;e++){var m=d[e],n=m.color,q=m.team;void 0==q&&(q="");c.innerHTML+="<tr><td style='background:rgb("+n[0]+","+n[1]+","+n[2]+')\' class="ucolor1"></td><td class="username1">'+m.name+'</td><td style="display:none" class="race1">'+m.race+'</td><td class="team1">'+q+"</td></tr>"}};d.readAsArrayBuffer(c)};var ia,an=function(c){var b={Blue:189,Red:13506841,Green:3257600,Purple:11337925,Yellow:16768512,Cyan:46517,Orange:16751649,Gray:5921370},d=c.split(["[Player"]),
f=c.split("GameDuration =")[1].split("[")[0].split(" min")[0].split(" ")[1],g=[];c=[];for(var h=1,k=d.length;h<k;h++){var m=d[h].split("\n"),n={};g[h-1]=n;for(var q=0,t=m.length;q<t;q++){var r=m[q];r=r.split(" = ");if(r[1]&&q){r[1]=r[1].trim();"Color"==r[0]&&(r[1]=b[r[1]]);"Type"==v&&"Status"!==r[0]&&c.put("N");r[1]=encodeURIComponent(r[1]);c.put(r[1]);n[r[0]]=r[1];var v=r[0]}}}b=g[0].Name+"'s Game";var w=new XMLHttpRequest;w.open("POST",baseUrl+"php/stats.php",!0);w.setRequestHeader("Content-type",
"application/x-www-form-urlencoded");w.onreadystatechange=function(){200===w.status&&4===w.readyState&&(location.hash="MatchX"+w.responseText)};c=c.join("<");w.send("arr="+c+"&time="+6E4*f+"&name="+b+"&players="+g.length)},Ji=function(c,b){for(var d=0,f=0,g=c.length;f<g;f++)d+=b[c[f]];return d},Ki=function(c,b,d){var e=["",d];performance.now();for(var g=0,h=c.length;g<h;g++){var k=c[g],m=k.stats,n=m.resources,q=m.unitCountMax,v=24*g+2,r=k.color,w=k.IA;w=w?"IA":"Human";e[v]=(r[0]<<16)+(r[1]<<8)+r[2];
e[v+1]=k.name;e[v+1]=k.name;e[v+2]=w;e[v+3]=k.status;e[v+4]=k.team;e[v+5]=cb[k.race];e[v+6]=m.score;e[v+7]=n[0];e[v+8]=n[1];e[v+9]=n[2];e[v+10]=n[3];e[v+11]=m.dmgInflicted;e[v+12]=m.dmgTaken;e[v+13]=m.unitsKilled;e[v+14]=m.unitsLosed;e[v+15]=m.buildsDestroyed;e[v+16]=m.buildsLosed;e[v+17]=Ji([10,79,64],q);e[v+18]=Ji([32,44],q);e[v+19]=Ji([55,56],q);e[v+20]=0;e[v+21]=0;e[v+22]=0;e[v+23]=0}ol(e,b);b&&setTimeout(function(){"block"==t("ingameStats").style.display&&Ki(c,b,d)},500)},ol=function(c,b){for(var d=
"<tr style='background:#000;'><td style='    padding-right: 150px;'>Name</td><td>Type</td><td>Status</td><td>Team</td><td>Race</td><td>Score</td><td>Gold</td><td>Wood</td><td>Food</td><td>Stone</td><td title='Damage Inflicted'>D.I</td><td title='Damage Taken'>D.T</td><td title='Units Killed'>U.K</td><td title='Units Losed'>U.L</td><td title='Buildings Destroyed'>B.D</td><td title='Buildings Losed'>B.L</td><td title='Maximum Peasants'>M.P</td><td title='Maximum Towers'>M.T</td><td title='Maximum Stone Towers'>M.S.T</td><td title='Gold Traded'>G.T</td><td title='Stone Traded'>S.T</td><td title='Gold Converted'>G.C</td><td title='Stone Converted'>S.C</td></tr>",
f=2,g=c.length;f<g;f++)if((f-2)%24)0!==(f-3)%24&&(h=~~((f-2)/24)%2?"style = 'background:rgba(0,0,0,0.45)'":"style = 'background:rgba(0,0,0,0.65)'"),d+="<td "+h+">"+ua(decodeURIComponent(c[f]))+"</td>";else{f-2&&(d+="</tr>");h=parseInt(ua(decodeURIComponent(c[f])));var h="style = 'background:rgba("+Math.floor(h/65536)+","+Math.floor(h/256)%256+","+h%256+",0.45)'";d+="<tr>"}d+="</tr>";b?(t("ingameStats").style.display="block",t("statsGame").innerHTML="<tbody>"+d+"</tbody>",b=t("statsGame").getElementsByTagName("td")):
(t("MatchX").style.display="block",t("returnmenu").style.display="block",t("statsTable").innerHTML="<tbody>"+d+"</tbody>",b=t("statsTable").getElementsByTagName("td"));c=[];f=0;for(g=b.length;f<g;f++)d=f%23,4<d&&23<f&&(c[d-5]||(c[d-5]=[]),c[d-5].put(b[f]));f=0;for(g=c.length;f<g;f++){b=c[f];b.sort(Al);d=b.length;if(!b[1])break;b[0].innerHTML!=b[1].innerHTML&&(b[0].style.background="rgba(127,0,0,0.45)");b[d-1].innerHTML!=b[d-2].innerHTML&&(b[d-1].style.background="rgba(0,127,0,0.45)")}};t("statsLoad").onchange=
function(){var c=document.getElementById("statsLoad").files[0],b=new FileReader;b.onloadend=function(b){an(b.target.result)};c&&b.readAsText(c,"ascii")};var zl=function(c){var b=new XMLHttpRequest;b.open("POST",baseUrl+"php/loadstat.php",!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");pl(b,function(b){ol(b.responseText.split("<"))});O(c);b.send("id="+c)},pl=function(c,b){c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b(c):alert("Error: "+c.status))}},
Wk=function(){t("mapconfiguration").style.display="block";t("basic").style.filter="blur(94px)";if(""==t("mapconfiguration").innerHTML){for(var c="",b=["grass","snow"],d=0,f=b.length;d<f;d++)c+='<option value="'+b[d]+'" '+(b[d]==localStorage.terrain?"selected":"")+">"+q[b[d]]+"</option>";b="";"true"==localStorage.infinity&&(b="checked");t("mapconfiguration").innerHTML="<table>\n<tbody>\n<tr><td>"+q.mapSize+'</td><td><input id="mapwidth" type="number" value="'+localStorage.mapSize+'" step="32" min="32" /></td></tr>\n<tr><td><hr></td></tr>\n<tr><td>'+
q.startingResources+"</td></tr>\n<tr><td><hr></td></tr>\n<tr><td>"+q.infinite+'</td><td><label class="container">\n  <input id="infiniteValue" type="checkbox" '+b+'>\n  <span class="checkmark"></span>\n</label></td></tr>\n<tr><td>'+q.gold+'</td><td><input id="goldValue" type="number" value="'+localStorage.goldRes+'" step="250" /></td></tr>\n<tr><td>'+q.wood+'</td><td><input id="woodValue" type="number" value="'+localStorage.woodRes+'" step="250" /></td></tr>\n<tr><td>'+q.food+'</td><td><input id="foodValue" type="number" value="'+
localStorage.foodRes+'" step="250" /></td></tr>\n<tr><td>'+q.stone+'</td><td><input id="stoneValue" type="number" value="'+localStorage.stoneRes+'" step="250" /></td></tr>\n<tr><td><hr></td></tr>\n<tr><td>'+q.terrainOption+'</td></tr>\n<tr><td><select name="terrain" id="terrainSelect">\n'+c+"\n<tr><td>"+q.water+'</td><td><input type="number" value="'+localStorage.water+'" id="waterValue" min="0"/></td></tr>\n<tr><td>'+q.items+'</td><td><input type="number" value="'+localStorage.items+'" id="itemsValue" min="0"/></td></tr>\n<tr><td>'+
q.peons+'</td><td><input type="number" value="'+localStorage.peons+'" id="peonValue" min="0"/></td></tr>\n<tr><td>'+q.gateways+'</td><td><input type="number" value="'+localStorage.gateways+'" id="gatewaysValue" min="0" /></td></tr>\n<tr><td>'+q.freePop+'</td><td><input type="number" value="'+localStorage.freePop+'" id="freePopValue" /></td></tr>\n</select>\n</td>\n</tr>\n<tr><td></td></tr>\n<tr><td><button id="closeButton1" class="start">'+q.close+"</button></td></tr>\n</tbody>\n</table>";t("infiniteValue").onchange=
function(){var b=this.checked;t("goldValue").disabled=b;t("stoneValue").disabled=b;t("woodValue").disabled=b;t("foodValue").disabled=b};t("infiniteValue").onchange();t("closeButton1").onclick=function(){n.online&&Q($c,Xd());t("mapconfiguration").style.display="none";Ma()}}};t("deleteUnit").onclick=function(){Q(Re,1,G.slice(0))};t("rotatebutton").onclick=function(){for(var c=G,b=0,d=c.length;b<d;b++){var f=x[c[b]];f.build||(f.d=(f.d+1)%8,na(f,f.img))}};t("gameMenu").onclick=Ti;t("menueditor").onclick=
Ti;t("quitButton1").onclick=function(){Zi("playingMenu");n.online&&ti();Aa.length=0;G=[];Cb=void 0;od.obj={};za.done.length=0;clearInterval(If);H=[];oc={};Cd.maxPing=200;qi=8;Ma();n={canceled:!0};Aa.length=0;x=[{terrain:1},{terrain:1},{terrain:1}];cd={};bd={};Ub={};jc.length=0;xa=[];Nb=[];Na=[];v.admin=!1;tb=v.kingdom=void 0;Rd.intv&&clearInterval(Rd.intv);fk={euro:0,arab:0,asia:0};Ba.stop();Cc=document.getElementById("msgs");Kg=document.getElementById("msginput");window.removeEventListener("mousemove",
ub);window.removeEventListener("keydown",nk);window.removeEventListener("keyup",ok);window.removeEventListener("mousemove",pk);window.removeEventListener("mousedown",qk);window.removeEventListener("mouseup",rk);window.removeEventListener("wheel",di);window.removeEventListener("resize",ud);cc();document.getElementById("playermenu").style.display="block";document.getElementById("playingMenu").style.display="none"};t("backToGame").onclick=function(){t("playingMenu").style.display="none";Ma()};t("backToGameS").onclick=
function(){Zi("ingameStats");Ma()};t("statButton").onclick=function(){Ki(H.slice(1),!0,n.now());Sb()};t("returnmenu1").onclick=cc;t("returnmenu").onclick=cc;t("refreshButton1").onclick=ch;t("sendmsg").onclick=ci;t("start1").onclick=Wk;t("start2").onclick=xd;t("alertok").onclick=function(){t("alert").style.display="none";Ma()};t("saveGame").onclick=function(){n.editor&&(n.arje=!1,t("mapDescription")&&(n.description=t("mapDescription").value,n.name=t("mapName").value,n.author=t("mapAuthor").value));
delete n.terrain;var c=n,b=x,d=[];d.length=b.length-3;for(var f=3,g=b.length;f<g;f++){var h=b[f],k=y[h.type],m={0:h.kingdom,1:h.d,2:h.type,3:h.img,4:h.x32,5:h.y32};h.name!==k.name&&(m[6]=h.name);h.iconID!==k.iconID&&(m[7]=h.iconID);h.attack!==k.attack&&(m[8]=h.attack);h.defence!==k.defence&&(m[9]=h.defence);h.level!==k.level&&(m[10]=h.level);h.health!==k.health&&(m[11]=h.health);h.maxHealth!==k.maxHealth&&(m[12]=h.maxHealth);h.func&&(m[13]=h.func);h.funcObj&&(m[14]=h.funcObj);h.workers&&h.workers.length&&
(m[15]=h.workers);h.workingOn&&(m[16]=h.workingOn);h.inventory&&h.inventory.length&&(m[17]=h.inventory);h.dix&&(m[18]=h.dix);h.diy&&(m[19]=h.diy);h.timestamp&&(m[20]=h.timestamp);h.working&&(m[21]=h.working);h.rnd&&(m[22]=h.rnd);h.techID&&(m[23]=h.techID);h.techStart&&(m[24]=h.techStart);h.activeTech&&(m[25]=h.activeTech);h.levelProgress&&(m[26]=h.levelProgress);h.c&&(m[27]=h.c);h.mimg&&(m[28]=h.mimg);void 0!==h.built&&(m[29]=h.built);void 0!==h.xf&&(m[30]=h.xf);void 0!==h.yf&&(m[31]=h.yf);void 0!==
h.action&&(m[32]=h.action);h.point&&(m[33]=h.point);h.waitlist&&(m[34]=h.waitlist);h.mv&&(m[35]=h.mv);h.work&&(m[36]=h.work);h.death&&(m[37]=h.death);h.freezed&&(m[38]=h.freezed);h.confused&&(m[39]=h.confused);h.sword&&(m[40]=h.sword);h.shield&&(m[41]=h.shield);h.book&&(m[42]=h.book);h.spy&&(m[43]=h.spy);h.stock&&(m[44]=h.stock);d[f-3]=m}c.allunits=d;n.movtable=bd;n.movtable2=cd;n.kingdomStart||n.editor||(n.kingdomStart=si);n.kingdoms=H.slice(1);n.lastEdit=Date.now();c=n;c=JSON.stringify(c);c=(new TextEncoder("utf-8")).encode(c);
c=[new Uint8Array([55]),new Uint8Array((new Uint32Array([c.length])).buffer),c];0==n.arje&&c.put(Cm(Tc));c=new Blob(c,{type:"application/octet-binary"});c=URL.createObjectURL(c);b=document.createElement("a");document.body.appendChild(b);b.style="display: none";b.href=c;b.download="savegame.tzared";b.click();n.allunits=void 0};t("createGame1").onclick=Qk;t("startCustom").onclick=function(){n=Object.assign({},ia);n.editor=!1;n.custom=!0;n.online=!1;ia=void 0;ta("customMapcont");xd(!1,!1)};t("editCustom").onclick=
function(){n=Object.assign({},ia);n.custom=!0;n.online=!1;n.editor=!0;Xc.func();ia=void 0;ta("customMapcont")};t("playrecord").onclick=function(){n=Object.assign({},ia);n.online=!1;n.custom=!0;n.demo=!0;n.cycle=0;n.editor=!1;ia=void 0;ta("customMapcont");xd(!1,!1)};t("seeStats").onclick=function(){Ki(ia.kingdoms,!1,25*ia.cycle);location.hash="MatchX"};var bn=function(){O(this,this.checked);localStorage[this.localProp]=this.checked},ql=function(){var c=this.value;"color"==this.type?this.style.backgroundColor=
c:"name"==this.localProp&&(c=ua(c));v[this.localProp]=c;localStorage[this.localProp]=c},Yi={MatchHistory:function(){document.getElementById("returnmenu").style.display="block";var c=new XMLHttpRequest;c.open("GET",baseUrl+"php/latest.php",!0);pl(c,function(b){b=b.responseText.split("|");for(var c=b.length-1,d="",g=0;g<c;g+=5)d+="<tr id='statList"+ua(decodeURIComponent(b[g]))+"'><td>"+ua(decodeURIComponent(b[g+1]))+"</td><td>"+ua(decodeURIComponent(b[g+2]))+"</td><td>"+ua(decodeURIComponent(b[g+3]))+
"</td><td>"+parseInt(ua(decodeURIComponent(b[g+4])))/6E4+" min</td></tr>";document.getElementById("matchtable").innerHTML="<tbody>"+d+"</tbody>";d={};for(g=0;g<c;d={l:d.l},g+=5)d.l=ua(decodeURIComponent(b[g])),t("statList"+d.l).onclick=function(b){return function(){location.hash="MatchX"+b.l}}(d)});c.send(null)},GameList:ch,RandomMap:mc,Twitter:function(){document.getElementById("returnmenu").style.display="block"},Account:function(){Od.returnmenu.style.display="block";""==Od.Account.innerHTML&&(Od.Account.innerHTML=
'<iframe id="accountIframe"></iframe>',Od.accountIframe=document.getElementById("accountIframe"));Od.accountIframe.src=baseUrl+v.langCodeUrl+"account/?iframe=1"},MapEditor:Xc.start,CustomMap:function(){document.getElementById("returnmenu").style.display="block"},Settings:function(){var c=t("Settings");if(""==c.innerHTML){var b=document.createElement("h2");b.innerHTML=q.strSettings;c.appendChild(b);b=document.createElement("div");var d=document.createElement("span");d.innerHTML=q.color;b.appendChild(d);
var f=document.createElement("input");f.type="color";f.value=localStorage.color;f.onchange=ql;f.localProp="color";f.style.backgroundColor=localStorage.color;b.appendChild(f);d=document.createElement("span");d.innerHTML=q.username;b.appendChild(d);f=document.createElement("input");f.type="text";f.value=Ok(localStorage.name);f.onchange=ql;f.localProp="name";b.appendChild(f);d=document.createElement("span");d.innerHTML=q.language;b.appendChild(d);d=document.createElement("select");d.innerHTML='<option value="en">'+
q.english+'</option>\n<option value="es">'+q.spanish+'</option>\n<option value="it">'+q.italian+'</option>\n<option value="pt">'+q.portuguese+'</option>\n<option value="ru">'+q.russian+'</option>\n<option value="pl">'+q.polish+'</option>\n<option value="bg">'+q.bulgarian+'</option>\n<option value="de">'+q.german+"</option>\n";d.value=v.langstr;d.onchange=function(){localStorage.language=this.value;location.href=""};b.appendChild(d);d=document.createElement("span");d.innerHTML=q.offlinePlay;b.appendChild(d);
d=document.createElement("button");d.innerHTML=q.downloadAll;d.onclick=Hc;b.appendChild(d);d=document.createElement("span");d.innerHTML=q.fullscreen;b.appendChild(d);var g=document.createElement("label");g.className="container";d=document.createElement("span");d.className="checkmark";f=document.createElement("input");f.type="checkbox";f.checked="true"==localStorage.fullscreen?!0:!1;f.onchange=bn;f.localProp="fullscreen";g.appendChild(f);g.appendChild(d);b.appendChild(g);c.appendChild(b)}ib("returnmenu")},
About:function(){var c=t("About");""==c.innerHTML&&(c.innerHTML='<div style="text-align:center;    user-select: text;"><div class="svgnehhon" style="background-repeat: no-repeat;height: 184px;background-position: center;"></div>\nFully programmed by Rub\u00e9n from <a href="https://nehhon.com" target="_blank">nehhon</a><p>\nContact:</p>\n<a href=\'mailto:webmaster@nehhon.com\' target="_blank">webmaster@nehhon.com</a> <br> <a href="https://twitter.com/TzaredGame" target="_blank">@TzaredGame</a>\n<p>Graphics, sound and game concept (Tzar) by Haemimont</p>\n</div>');
ib("returnmenu")}};t("about").onclick=function(){location.hash="About"};Wi();var mb=[Fc,mg,gd,ed,ze,eg,vg,og,gg,fg,jg,wg,rg,Uj,xg,hg,ig,tg,De,ie,qd,rj,Jf,ph,qj,Sj,$f,Wj,Xj,Gd,Vh,Yj,Zj,ak,bk,$f,Hk,Pj,ck,le,Qj,Qf,Nj,Oj,Nh,Zf,pe,zc,Lh,fd,ed,Yf,gd,Lc,Ad,Fd,aa,function(c){var b=c[1],d=x[c[2]];c=z[c[0]];H[d.kingdom].technology.hidden[c.id.id]=0;yc(d,c,b);ka.actv[c.id.id]&&da(!1)},Tf,Uf,Ha,Gj,Mb,Ih,Jh,he,ki,hk,Vj,Th,pg,Tj,Rj];(function(){for(var c=0,b=mb.length;c<b;c++)mb[c].url=c})();ie.rule="moving";Zf.rule=
"attack"})();
