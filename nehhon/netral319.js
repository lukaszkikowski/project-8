var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(v,Z,ma){v!=Array.prototype&&v!=Object.prototype&&(v[Z]=ma.value)};$jscomp.getGlobal=function(v){return"undefined"!=typeof window&&window===v?v:"undefined"!=typeof global&&null!=global?global:v};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var v=0;return function(Z){return $jscomp.SYMBOL_PREFIX+(Z||"")+v++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var v=$jscomp.global.Symbol.iterator;v||(v=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[v]&&$jscomp.defineProperty(Array.prototype,v,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(v){var Z=0;return $jscomp.iteratorPrototype(function(){return Z<v.length?{done:!1,value:v[Z++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(v){$jscomp.initSymbolIterator();v={next:v};v[$jscomp.global.Symbol.iterator]=function(){return this};return v};$jscomp.iteratorFromArray=function(v,Z){$jscomp.initSymbolIterator();v instanceof String&&(v+="");var ma=0,wa={next:function(){if(ma<v.length){var Q=ma++;return{value:Z(Q,v[Q]),done:!1}}wa.next=function(){return{done:!0,value:void 0}};return wa.next()}};wa[Symbol.iterator]=function(){return wa};return wa};
$jscomp.polyfill=function(v,Z,ma,wa){if(Z){ma=$jscomp.global;v=v.split(".");for(wa=0;wa<v.length-1;wa++){var Q=v[wa];Q in ma||(ma[Q]={});ma=ma[Q]}v=v[v.length-1];wa=ma[v];Z=Z(wa);Z!=wa&&null!=Z&&$jscomp.defineProperty(ma,v,{configurable:!0,writable:!0,value:Z})}};$jscomp.polyfill("Array.prototype.keys",function(v){return v?v:function(){return $jscomp.iteratorFromArray(this,function(v){return v})}},"es6","es3");
$jscomp.polyfill("Object.getOwnPropertySymbols",function(v){return v?v:function(){return[]}},"es6","es5");$jscomp.findInternal=function(v,Z,ma){v instanceof String&&(v=String(v));for(var wa=v.length,Q=0;Q<wa;Q++){var Ka=v[Q];if(Z.call(ma,Ka,Q,v))return{i:Q,v:Ka}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(v){return v?v:function(v,ma){return $jscomp.findInternal(this,v,ma).v}},"es6","es3");$jscomp.owns=function(v,Z){return Object.prototype.hasOwnProperty.call(v,Z)};
$jscomp.polyfill("Object.assign",function(v){return v?v:function(v,ma){for(var Z=1;Z<arguments.length;Z++){var Q=arguments[Z];if(Q)for(var Ka in Q)$jscomp.owns(Q,Ka)&&(v[Ka]=Q[Ka])}return v}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(v){return v?v:function(){return $jscomp.iteratorFromArray(this,function(v,ma){return ma})}},"es8","es3");$jscomp.polyfill("Math.sign",function(v){return v?v:function(v){v=Number(v);return 0===v||isNaN(v)?v:0<v?1:-1}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(v){return v?v:function(v){return"number"!==typeof v?!1:!isNaN(v)&&Infinity!==v&&-Infinity!==v}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(v){return v?v:function(v){return Number.isFinite(v)?v===Math.floor(v):!1}},"es6","es3");$jscomp.makeIterator=function(v){$jscomp.initSymbolIterator();var Z=v[Symbol.iterator];return Z?Z.call(v):$jscomp.arrayIterator(v)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(v){function Z(){this.batch_=null}function ma(v){return v instanceof Q?v:new Q(function(G,bc){G(v)})}if(v&&!$jscomp.FORCE_POLYFILL_PROMISE)return v;Z.prototype.asyncExecute=function(v){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(v);return this};Z.prototype.asyncExecuteBatch_=function(){var v=this;this.asyncExecuteFunction(function(){v.executeBatch_()})};var wa=$jscomp.global.setTimeout;Z.prototype.asyncExecuteFunction=function(v){wa(v,
0)};Z.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var v=this.batch_;this.batch_=[];for(var G=0;G<v.length;++G){var Q=v[G];delete v[G];try{Q()}catch(ce){this.asyncThrow_(ce)}}}this.batch_=null};Z.prototype.asyncThrow_=function(v){this.asyncExecuteFunction(function(){throw v;})};var Q=function(v){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var G=this.createResolveAndReject_();try{v(G.resolve,G.reject)}catch(vd){G.reject(vd)}};Q.prototype.createResolveAndReject_=
function(){function v(v){return function(bc){Q||(Q=!0,v.call(G,bc))}}var G=this,Q=!1;return{resolve:v(this.resolveTo_),reject:v(this.reject_)}};Q.prototype.resolveTo_=function(v){if(v===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(v instanceof Q)this.settleSameAsPromise_(v);else{a:switch(typeof v){case "object":var G=null!=v;break a;case "function":G=!0;break a;default:G=!1}G?this.resolveToNonPromiseObj_(v):this.fulfill_(v)}};Q.prototype.resolveToNonPromiseObj_=function(v){var G=
void 0;try{G=v.then}catch(vd){this.reject_(vd);return}"function"==typeof G?this.settleSameAsThenable_(G,v):this.fulfill_(v)};Q.prototype.reject_=function(v){this.settle_(2,v)};Q.prototype.fulfill_=function(v){this.settle_(1,v)};Q.prototype.settle_=function(v,G){if(0!=this.state_)throw Error("Cannot settle("+v+", "+G|"): Promise already settled in state"+this.state_);this.state_=v;this.result_=G;this.executeOnSettledCallbacks_()};Q.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var v=
this.onSettledCallbacks_,G=0;G<v.length;++G)v[G].call(),v[G]=null;this.onSettledCallbacks_=null}};var Ka=new Z;Q.prototype.settleSameAsPromise_=function(v){var G=this.createResolveAndReject_();v.callWhenSettled_(G.resolve,G.reject)};Q.prototype.settleSameAsThenable_=function(v,G){var Q=this.createResolveAndReject_();try{v.call(G,Q.resolve,Q.reject)}catch(ce){Q.reject(ce)}};Q.prototype.then=function(v,G){function Z(v,G){return"function"==typeof v?function(G){try{ma(v(G))}catch(de){wa(de)}}:G}var ma,
wa,bc=new Q(function(v,G){ma=v;wa=G});this.callWhenSettled_(Z(v,ma),Z(G,wa));return bc};Q.prototype.catch=function(v){return this.then(void 0,v)};Q.prototype.callWhenSettled_=function(v,G){function Q(){switch(Z.state_){case 1:v(Z.result_);break;case 2:G(Z.result_);break;default:throw Error("Unexpected state: "+Z.state_);}}var Z=this;null==this.onSettledCallbacks_?Ka.asyncExecute(Q):this.onSettledCallbacks_.push(function(){Ka.asyncExecute(Q)})};Q.resolve=ma;Q.reject=function(v){return new Q(function(G,
Q){Q(v)})};Q.race=function(v){return new Q(function(G,Q){for(var Z=$jscomp.makeIterator(v),wa=Z.next();!wa.done;wa=Z.next())ma(wa.value).callWhenSettled_(G,Q)})};Q.all=function(v){var G=$jscomp.makeIterator(v),Z=G.next();return Z.done?ma([]):new Q(function(v,Q){function wa(G){return function(Q){Ka[G]=Q;bc--;0==bc&&v(Ka)}}var Ka=[],bc=0;do Ka.push(void 0),bc++,ma(Z.value).callWhenSettled_(wa(Ka.length-1),Q),Z=G.next();while(!Z.done)})};return Q},"es6","es3");
(function(){var v,Z,ma,wa;function Q(d,b,e){this.context=d;this.urlList=b;this.onload=e;this.loadCount=0}function Ka(d,b,e){b=b.split(".")[0].toLowerCase();Hf[b]=d;!e||e.music&&e.mid!=Fa.id||(Ca(b,e.x,e.y,e.k,e.music,e.date),e.date=0)}function bc(d,b){var e=F,f;for(f=2;60>=f;f+=2){d--;b--;for(var g=0;g<=f;){if(2<V[d+g+e*b]&&1==z[V[d+g+e*b]].res&&qa(d+g,b))return V[d+g+e*b];if(2<V[d+g+e*(b+f)]&&1==z[V[d+g+e*(b+f)]].res&&qa(d+g,b+f))return V[d+g+e*(b+f)];g++}for(g=0;g<f-1;){g++;if(2<V[d+e*(b+g)]&&1==
z[V[d+e*(b+g)]].res&&qa(d,b+g))return V[d+e*(b+g)];if(2<V[d+f+e*(b+g)]&&1==z[V[d+f+e*(b+g)]].res&&qa(d+f,b+g))return V[d+f+e*(b+g)]}}return!1}function G(d,b){if(!wd(d)){var e=d.x32,f=d.y32,g=d.sight;d.build&&(g=d.attDist);var h=F,c=2*g+1,n=c*c,t=d.id,E={};d.callList||(d.callList=[]);for(var B=0;B<n;B++){var q=B%c-g,T=~~(B/c)-g;if(Math.sqrt(Math.pow(q,2)+Math.pow(T,2))<=g){q+=e;T+=f;var K=q+T*h;qa(q,T)&&(nc[K]?(q=z[nc[K]],E[q.id]||b||(q.callList||P(q),q.callList.put(d.id),q.callList.put(d.x32+d.y32*
h),E[q.id]=1)):nc[K]=t)}}}}function vd(d){if(d.callList){for(var b=d.x32,e=d.y32,f=d.sight,g=F,h=2*f+1,c=h*h,n=d.id,t=0;t<c;t++){var E=t%h-f,B=~~(t/h)-f;Math.sqrt(Math.pow(E,2)+Math.pow(B,2))<=f&&(E+=b,B+=e,E+=B*g,nc[E]==n&&(nc[E]=void 0))}b=d.callList;d.callList=void 0;t=0;for(c=b.length;t<c;t+=2)d=z[b[t]],d.x32+d.y32*g==b[t+1]&&d.callList&&G(d,!0);b.length=0}}function ce(){for(var d=0,b=Ua.length;d<b;Ua[d++].className="");}function vm(d){k.getError()==k.CONTEXT_LOST_WEBGL&&(k=document.getElementById("tzar").getContext("webgl2",
{antialias:!1,alpha:!1}),P("restored"));Z=[];ma=[0,1,2,1,2,3];wa=[];ma.changed=!0;if(!ee){var b=k.createShader(k.VERTEX_SHADER);k.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec4 a_kingdom;\nin vec4 a_physic;\nuniform float zoom;\nuniform mediump int miniMap;\nuniform float now;\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform sampler2D u_image1;\nuniform sampler2D delay;\nuniform float zMax;\nout highp vec2 vTextureCoord;\nout vec4 v_kcolor;\nout float height;\n\nvec4 superArray(in highp uint position) {\n     return(texelFetch(u_image1, ivec2(\t\t(position%uint(512))\t\t,\tposition/uint(512)\t), 0));\n}\n\n\n\nvoid main() {\n\n\n\n    highp float  x;\n    float t;\n\thighp uint pos;\n\n\nif(a_texCoord.y>-.5&&miniMap==0){\nt=(now-a_texCoord.y);\nif(a_texCoord.w>=0.0){\npos=uint(floor(t * a_texCoord.w));         \n}else{\n\n\nint index=int(-a_texCoord.w);\nint len=int(a_texCoord.z);\nint i;\n\nfloat spt= mod(t,texelFetch(delay, ivec2(len-1+index, 0), 0).r);\n\n for(i=0;i<len;i++){\n\n\nif(texelFetch(delay, ivec2(i+index, 0), 0).r>spt) {\n\nbreak;\n }\n\n\n }\n\n pos=uint(i);\n\n\t\t\t\t  \n //pos=uint(4);\n}\n\n\n\tpos=uint(a_texCoord.x)+uint(4)*(pos%uint(a_texCoord.z));\n\n\n}else{\n\npos=uint(a_texCoord.x);\n\n}\n\n\n\n    vec4 coord = superArray(pos);\n\n\tpos=pos-pos%uint(4);\n\n\theight = (superArray(pos+uint(3)).w-superArray(pos).w)/512.0;\n\n    vec2 mxy=vec2(coord.p,coord.q);\n\n\n\t\tfloat z=a_position.z;\n\n\tif(z<0.0){\n\tz*=-1.0;\n\tmxy*=0.0;\n\n\t}\n\n\n\n    t = (now - a_physic.w) * 0.001;\n    mxy.x+=a_physic.x * t;\n\n\tfloat physicY=a_physic.y * t + a_physic.z * .5 * t * t;\n\n    mxy.y+=physicY;\n\n\nif(miniMap==1){\n\tz=0.0;\n}else{\n\tz=(1.0 - (physicY+z)/ zMax)*.9;\n}\n\n   gl_Position = vec4((((a_position.xy+mxy) + u_translation) / u_resolution * 2.0 - 1.0) * vec2(zoom, -zoom), (z), 1.0);\n\n   vTextureCoord=vec2(coord.s,coord.t);\n\n\n    v_kcolor=a_kingdom;\n\n\n}\n");
k.compileShader(b);d=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(d,"#version 300 es\nprecision mediump float;\n\n\n\nuniform sampler2D lightmap;\nuniform vec2 u_resolution;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform mediump int miniMap;\nin vec4 v_kcolor;\nin highp vec2 vTextureCoord;\nin float height;\nout vec4 COLOR;\n\nvoid main() {\n\n\nif(miniMap==0){\n\n\n\n\nvec2 txtFinal=vTextureCoord;\n\nif(txtFinal.x>=1.0){\ntxtFinal.y+=height*floor(txtFinal.x);\n}\n\n\nvec4 color=texture(img_common, vec3(txtFinal, int(txtFinal.y)));\n \n\nif(color.a<0.5) discard;\n\n\n\n\nif(v_kcolor.a<1.0){\ncolor*=v_kcolor;\n}else if(v_kcolor.a!=1.0){\n\nif(color.r==color.g&&color.r==color.b){\ncolor.rgb*=v_kcolor.rgb;\n}\ncolor.a*=v_kcolor.a-1.0;\n}\nvec4 light=vec4(1.0);\n\n\nlight = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+vec4(1.0,1.0,1.0,0.0)*u_ambient;\n\nCOLOR=color*light;\n\n}else{\nCOLOR=v_kcolor;\n}\n\n}");
k.compileShader(d);Ba=k.createProgram();k.attachShader(Ba,b);k.attachShader(Ba,d);k.linkProgram(Ba);k.useProgram(Ba);(b=k.getShaderInfoLog(b))&&console.log("Shader compiler log: "+b);(b=k.getShaderInfoLog(d))&&console.log("Shader compiler log: "+b);b=k.createShader(k.VERTEX_SHADER);k.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\n\n\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform mediump int miniMap;\nuniform float zoom;\n\n\nvoid main() {\n\nfloat depth;\nif(miniMap==1){\ndepth=.03;\n}else{\ndepth=1.0;\n}\n\n   gl_Position = vec4(a_position.x, a_position.y, depth, 1.0);\n   \n\n}");
k.compileShader(b);d=k.createShader(k.FRAGMENT_SHADER);k.shaderSource(d,"#version 300 es\nprecision mediump float;\n\nuniform float u_fps;\nuniform mediump int miniMap;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform vec2 borderCoords;\nuniform vec2 waterBorder;\nuniform vec2 u_translation;\nuniform vec2 u_resolution;\nuniform vec2 minimapMargin;\nuniform mediump isampler2D img_data;\nuniform sampler2D lightmap;\nout vec4 COLOR;\nuniform float zoom;\nuniform float mx;\nuniform float mapSize;\nuniform float terrainInfo[32];\nvec4 sptexture3D(in vec2 coords,in float height1) {\n \n\n \nif(coords.x>=1.0){\ncoords.y+=height1*floor(coords.x);\n}\n\n\n\n    return(\ttexture(img_common, vec3(coords,int(coords.y)))\t);\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\nvec4 color;\n\nvec2 xy =  vec2(gl_FragCoord.x,u_resolution.y-gl_FragCoord.y)/zoom;\n\nif(miniMap==1){\nxy+=minimapMargin/zoom;\n}else{\nxy+=-u_translation+vec2(mx,0.0)/zoom+0.5*(u_resolution-u_resolution/zoom);\n}\n\nvec2 xy32=xy/32.0;\n\nvec2 floorxy32=floor(xy32);\n\nvec2 xyr=xy32-floorxy32;\n\n\nvec2 xyb;\n\n\nfloat dx=0.0;\nfloat dy=0.0;\n\nif(xyr.x>0.5){dx=1.0;}\nif(xyr.y>0.5){dy=1.0;}\n\nvec2 oxy32=xy32;\n\n\nif(dx==1.0){\nxyb=vec2(borderCoords.x+floor(rand(floorxy32)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(-16.0,8.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.x+=dx;\n}\n}\n\nif(dy==1.0){\nxyb=vec2(borderCoords.x+floor(rand(1.5*floorxy32-3.0)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(8,-16.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.y+=dy;\n}\n}\n\n\nint type = texture(img_data,xy32/(mapSize)).r;\nint ntype = texture(img_data,oxy32/(mapSize)).r;\n\nif(type<0&&type!=ntype){\n\nif(ntype<0){\ntype=ntype;\n}else if(ntype==3){\ntype=ntype;\n}else{\ntype=1;\n}\n}\n\n\n\nfloat h;\nfloat w;\nvec2 xytxt;\nif(type<0){\n\ntype=-type-2;\nxytxt=waterBorder+vec2(float(type*8*32),0.0)/512.0;\nw=32.0;\nh=32.0;\ntype*=-1;\n}else{\nxytxt=vec2(terrainInfo[type*4],terrainInfo[type*4+1]);\nw=terrainInfo[type*4+2];\nh=terrainInfo[type*4+3];\n\nif(type==3) xytxt+=vec2(u_fps,0.0);\n}\n\n\nvec2 xyt=vec2(xytxt)+vec2(mod(xy.x,w),mod(xy.y,h))/512.0;\n\n\nif(type==3){ h=576.0; }\ncolor=sptexture3D(xyt,h/512.0);\n\nmediump vec4 light=vec4(1.0);\nif(miniMap==0) light = (texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+1.0)*u_ambient;\n\n\n\nCOLOR=color*light;\n\n\n\n}");
k.compileShader(d);za=k.createProgram();k.attachShader(za,b);k.attachShader(za,d);k.linkProgram(za);(b=k.getShaderInfoLog(b))&&console.log("Shader1 compiler log T: "+b);(b=k.getShaderInfoLog(d))&&console.log("Shader compiler log T: "+b)}d=k.getAttribLocation(Ba,"a_position");b=k.getAttribLocation(Ba,"a_texCoord");var e=k.getAttribLocation(Ba,"a_kingdom"),f=k.getAttribLocation(Ba,"a_physic"),g=m,h=oc.dir,c=[];c.length=4*h.length;for(var n=0,t=h.length;n<t;n++){var E=ra[g[h[n]]],B=E[7]+E.deltaY,q=E[8],
T=E[9];c[4*n]=E[6]/512;c[4*n+1]=B/512;c[4*n+2]=q;c[4*n+3]=T}n=1/512;k.useProgram(za);h=k.getUniformLocation(za,"minimapMargin");fe=k.getUniformLocation(za,"u_translation");oh=k.getUniformLocation(za,"u_resolution");ph=k.getUniformLocation(za,"u_fps");Fj=k.getUniformLocation(za,"u_ambient");xd=k.getUniformLocation(za,"zoom");t=k.getUniformLocation(za,"mx");E=k.getUniformLocation(za,"mapSize");B=k.getUniformLocation(za,"borderCoords");q=k.getUniformLocation(za,"waterBorder");If=k.getUniformLocation(za,
"miniMap");T=k.getUniformLocation(za,"terrainInfo");k.uniform2fv(B,[ra[g.terrain_border][6]*n,n*(ra[g.terrain_border].deltaY+ra[g.terrain_border][7])]);k.uniform2fv(q,[ra[g.waterborder][6]*n,n*(ra[g.waterborder].deltaY+ra[g.waterborder][7])]);k.uniform1i(If,0);k.uniform2fv(fe,[0,0]);k.uniform1f(ph,-1);k.uniform1f(xd,1);k.uniform1f(t,-w.mx);k.uniform1f(E,F);k.uniform1fv(T,c);p.editor?k.uniform2fv(h,[0,-60]):k.uniform2fv(h,[-4,-31]);g=k.getAttribLocation(za,"a_position");qh=k.createVertexArray();k.bindVertexArray(qh);
c=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,c);k.bufferData(k.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,1,1,-1,1]),k.STATIC_DRAW);k.enableVertexAttribArray(g);k.vertexAttribPointer(g,2,k.FLOAT,!1,0,0);k.bindVertexArray(null);k.useProgram(Ba);k.bindBuffer(k.ARRAY_BUFFER,null);g=F*sa*3;rh=k.createVertexArray();k.bindVertexArray(rh);Ma=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Ma);k.enableVertexAttribArray(e);k.vertexAttribPointer(e,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,16*g,
k.DYNAMIC_DRAW);yd=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,yd);k.enableVertexAttribArray(b);k.vertexAttribPointer(b,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,16*g,k.DYNAMIC_DRAW);Ec=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,Ec);k.enableVertexAttribArray(d);k.vertexAttribPointer(d,3,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,12*g,k.DYNAMIC_DRAW);ge=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,ge);k.enableVertexAttribArray(f);k.vertexAttribPointer(f,4,k.FLOAT,!1,0,0);k.bufferData(k.ARRAY_BUFFER,
16*g,k.DYNAMIC_DRAW);k.bindVertexArray(null);Jf=k.getUniformLocation(Ba,"u_resolution");Gj=k.getUniformLocation(Ba,"u_ambient");he=k.getUniformLocation(Ba,"u_translation");zd=k.getUniformLocation(Ba,"zoom");Hj=k.getUniformLocation(Ba,"now");Kf=k.getUniformLocation(Ba,"miniMap");d=k.getUniformLocation(Ba,"zMax");k.uniform1f(d,p.zMax);k.uniform1i(Kf,0);k.useProgram(Ba);m.delay=[100,250,400,550,650,750,850,1E3,1150,5150,7650,10150,13650,17150,21150,25150,100,200,300,400,500,600,700,800,900,1E3,1100,
1200,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6500,7700,8900,10100,13600,17100,22100,8E3,8080,8160,8240,8320,8400,8480,100,200,300,400,500,600,700,800,900,1E3,1100,2400,3600,4800,6E3,7200,8400,11900,15400,20400,8E3,8077,8154,8231,8308,8385,8462,8539,8616,8693,8770,8847,8923,5E3,5072,5143,5215,5286,5358,5429,5501,5572,5644,5715,5787,5858,5929,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,3700,4900,7100,9600,12600,17100,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,
8833,8916,9E3,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,8833,8916,9E3,9080,5E3,5100,5200,5300,5400,5500,5600,5700,5850,6E3,70,140,210,280,350,420,490,560,630,700,770,840,910,980,4980,8980,12980,16980,20980,26980,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,4100,6300,8500,11E3,13500,17E3,20500,5E3,5100,5200,5300,5400,5500,5600,5700,5800,5900,6E3,125,230,335,431,546,606,666,731,857,952,1045,1139,1238,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,3300,
5800,8800,12E3,15500,5500,5600,5700,5800,5900,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6800,9800,12800,16300,19800,23800,28300,5E3,5100,5200,5300,5400,5500,5600,210,420,654,864,1074,1284,1494,108,244,380,516,652,788,924,1060,1196,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4100,6100,8100,11100,14100,17100,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5200,9E3,11E3,13800,17600,23400,7E3,7100,
7200,7300,7400,8200,8300,8400,8500,8600,9600,9700,9800,9900,1E4,80,160,210,360,610,1010,1510,100,200,300,400,500,3500,7500,13500,40,80,120,160,200,240,280,320,360,400,440,480,520,2520,3520,4520,5520,6520,8520,11520,107,214,321,428,535,642,749,856,963,1070,1177,1284,1391,1498,7323,13148,18973,24798,30623,36448,7E3,7170,7340,7510,7680,7980,8150,8320,8490,8660,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,6400,8900,11400,14900,18400,7E3,7200,7400,7600,7800,8E3,8200,125,250,375,500,
2E3,2125,2250,100,200,300,400,500,4E3,10500,100,200,300,400,500,600,700,800,900,8900,15900,21400,27400,33900,38900,44900,51900,800,1E3,1200,1400,1600,1800,2E3,2200,2400,2600,NaN,80,160,240,320,400,480,560,640,720,800,880,960,1040,5040,9040,12790,16540,19290,22040,25790,7671,7771,7871,7971,8071,8171,8271,100,200,300,400,500,600,700,800,900,1E3,1100,1200,6200,9700,13200,17200,21200,25200,29200,35200,100,200,300,400,500,600,9600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,11300,17300,
27300,37300,49300,64300,8E3,8228,8457,8685,8914,9142,9371,80,160,240,320,400,480,560,640,720,800,880,960,4960,8460,11460,14460,18460,22460,28460,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5400,8900,12900,16900,22900,28900,5E3,5143,5286,5429,5572,5715,5857,121,232,361,508,629,758,879,1018,1165,1425,1445,1465,1536,1692,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8300,11300,14800,18800,23300,29300,6E3,6171,6343,6514,6685,6857,7028,125,
250,375,500,625,750,875,1E3,1125,1250,1375,1500,6500,10500,13500,16500,19500,23E3,27E3,31500,8E3,8185,8370,8555,8740,8925,9108,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4300,7800,11300,15300,19300,23800,29800,1E4,10107,10214,10321,10428,10535,10643,10750,10857,10964,11071,11178,11285,11393,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4900,8400,12900,17400,22400,27400,
8E3,8250,8500,8750,9E3,9250,9500,9750,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,8300,11800,15800,19800,24300,29300,5E3,5157,5314,5471,5628,5785,5943,125,250,375,500,625,3125,3250,3375,100,200,300,400,500,600,4600,8600,14600,15600,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14400,18400,
22400,28400,180,360,540,720,900,1080,10080,100,200,350,500,600,700,800,950,1100,1250,1400,1550,1700,6200,8700,11700,15200,18700,22700,27700,6E3,6120,6240,6360,6480,6600,6720,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14900,18900,23400,29400,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,7400,10900,14900,19900,5E3,5100,5200,5300,5400,5500,5600,116,232,348,464,522,580,638,696,812,928,1044,1160,1276,1392,100,200,300,400,
500,600,700,800,900,1E3,1100,1200,5200,8700,11700,14700,18700,22700,28700,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,6900,10900,14400,18400,22400,27400,7E3,7100,7200,7300,7400,7500,7600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8600,10800,13E3,15500,19500,24E3,8E3,8100,8200,8300,8400,8500,8600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8800,12300,16300,20300,24300,29300,6E3,6100,6200,6300,6400,6500,6600,100,200,
300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1630,1730,1830,1930,2030,2130,2230,2330,5330,8330,11330,7E3,7150,7300,7450,7600,7750,7900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,5200,8700,12200,15700,20200,24700,29700,34700,8E3,8080,8163,8246,8330,8413,8496,8580,8663,8746,8830,8913,8996,9080,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,5599,5684,5770,5855,5941,6026,6112,125,250,375,500,625,
750,875,1E3,1125,1250,1375,1500,1625,5625,8625,11625,14625,18125,22125,26625,8E3,8185,8370,8555,8740,8925,9108,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,6100,10600,14600,18100,21600,26100,30600,35600,40600,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1700,6700,10700,11300,6E3,6200,6400,6600,6800,7E3,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,10400,100,
200,300,400,500,600,8600];d=m.delay;b=d.length;ra[m.expl_small_hole][1]=-b;for(e=n=0;14>n;n++)e+=66,d[n+b]=e;d.put(e+3E4);d=new Float32Array(d);ym();zm(new Float32Array([1,1,1,1]));k.uniform1f(zd,1);k.uniform2fv(he,[0,0]);var K=k.createFramebuffer(),Ob;Ad=function(){var d=window.innerWidth,b=window.innerHeight;tzar.width=d;tzar.height=b;k.useProgram(za);k.uniform2f(oh,d,b);k.useProgram(Ba);K.width=d;K.height=b;k.activeTexture(k.TEXTURE2);Ob||(Ob=k.createTexture());k.bindTexture(k.TEXTURE_2D,Ob);k.texImage2D(k.TEXTURE_2D,
0,k.RGBA,d,b,0,k.RGBA,k.UNSIGNED_BYTE,null);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE);k.bindFramebuffer(k.FRAMEBUFFER,K);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,Ob,0);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);k.bindFramebuffer(k.FRAMEBUFFER,null);X=1;k.uniform1f(zd,
1/X);k.uniform1i(k.getUniformLocation(Ba,"lightmap"),2);k.useProgram(za);k.uniform1i(k.getUniformLocation(za,"lightmap"),2);k.uniform1f(xd,1/X);k.useProgram(Ba);k.uniform2f(Jf,d,b);k.viewport(w.mx,0,d,b);Ad.changed=1;Bd(-gb,-Fb)};Ad.changed=0;window.addEventListener("resize",Ad,!1);Ad();k.blendEquation(k.FUNC_ADD);k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA);k.disable(k.DITHER);k.disable(k.BLEND);performance.now();ad(1);ee||(k.activeTexture(k.TEXTURE3),b=k.createTexture(),k.bindTexture(k.TEXTURE_2D,
b),k.texImage2D(k.TEXTURE_2D,0,k.R16F,d.length,1,0,k.RED,k.FLOAT,d),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.bindTexture(k.TEXTURE_2D,null),k.bindTexture(k.TEXTURE_2D,b),k.uniform1i(k.getUniformLocation(Ba,"delay"),3),k.activeTexture(k.TEXTURE2),sh=k.createTexture(),k.bindTexture(k.TEXTURE_2D,sh),k.texImage2D(k.TEXTURE_2D,
0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT),k.clearColor(0,0,0,1));k.bindFramebuffer(k.FRAMEBUFFER,K);K.width=1;K.height=1;k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,Ob,0);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);
k.bindFramebuffer(k.FRAMEBUFFER,null);new Float32Array(8);th=k.createBuffer();uh=k.createBuffer();Ij=k.createBuffer();n=0;for(t=vh.length;n<t;n++)pb(vh[n]);k.enable(k.DEPTH_TEST);k.depthFunc(k.LEQUAL);yb.fp1000=1E3;yb.delta=0;yb.now=0;yb.frameCount=0;k.bindTexture(k.TEXTURE_2D,Ob);ee=ka.setup=!0}function Ej(){if(""==r("playingMenu").innerHTML){r("playingMenu").innerHTML='<div>\n<ul>\n<li id="backToGame">'+u.backToGame+'</li>\n<li style="display:none" id="saveGameCache">'+u.save+'</li>\n<li id="saveGame">'+
u.downloadmap+'</li>\n<li id="fullscreenmenu">'+u.fullscreen2+'</li>\n<li id="quitButton1">'+u.quit+"</li>\n</ul>\n<div>\n<span>"+u.musicVolume+'</span><br/><input type="range" id="musicRange" value="'+localStorage.musicRange+'"/><br/><br/>\n<form id="musicSelect">\n<input type="radio" name="mversion" value="originalMusic" checked /> Original<br/>\n<input type="radio" name="mversion" value="sharpRain" /> Original - <a href="https://www.youtube.com/user/rainheart666787/featured" target="_blank" rel="noopener noreferrer">Sharp Rain</a> Version<br/>\n<input type="radio" name="mversion" value="originalMusic1" /> Original - Alternative One<br/>\n<input type="radio" name="mversion" value="mute" /> Mute\n</form>\n<br />\n<span>'+
u.soundVolume+'</span><br/><input type="range" id="soundRange" value="'+localStorage.soundRange+'"/><br/>\n</div>\n</div>\n';r("quitButton1").onclick=wm;r("saveGame").onclick=Jj;r("saveGameCache").onclick=Am;r("backToGame").onclick=function(){fa("playingMenu");Oa()};r("fullscreenmenu").onclick=Kj;r("musicRange").oninput=function(){ie.gain.value=parseInt(document.getElementById("musicRange").value)/100;localStorage.musicRange=document.getElementById("musicRange").value};r("soundRange").oninput=function(){je.gain.value=
parseInt(document.getElementById("soundRange").value)/100;localStorage.soundRange=document.getElementById("soundRange").value};localStorage.favMusic&&(r("musicSelect").mversion.value=localStorage.favMusic);for(var d=r("musicSelect").getElementsByTagName("input"),b=0,e=d.length;b<e;b++)d[b].onchange=Fa.reset}p.demo&&fa("saveGame")||Da("saveGame");r("playingMenu").style.display="block";Pb()}function wm(){Lj("playingMenu");p.online&&wh();ta.length=0;D=[];hb=void 0;bd.obj={};Pa.done.length=0;clearInterval(Mf);
H=[];nc={};Cd.maxPing=200;xh=8;Oa();p={canceled:!0};ta.length=0;z=[{terrain:1},{terrain:1},{terrain:1}];cd={};dd={};zb={};Ab.length=0;xa=[];Gb=[];Ha=[];w.admin=!1;Jb=w.kingdom=void 0;Dd.intv&&clearInterval(Dd.intv);Mj={euro:0,arab:0,asia:0};Fa.stop();pc=document.getElementById("msgs");Nf=document.getElementById("msginput");window.removeEventListener("mousemove",Qb);window.removeEventListener("keydown",Nj);window.removeEventListener("keyup",Oj);window.removeEventListener("mousemove",Pj);window.removeEventListener("mousedown",
Qj);window.removeEventListener("mouseup",Rj);window.removeEventListener("wheel",yh);window.removeEventListener("resize",Ad);cc();document.getElementById("playermenu").style.display="block";document.getElementById("playingMenu").style.display="none"}function xm(d){P("setup:",d);d.toSend=[];d.orderList=[];var b=qb.roomName;b=b.substr(0,b.length-1);d.id==b&&(d.admin=!0);d.sendDirectly("channelMessage","nehhof",{});P(d.channels.channelMessage);d.channels.channelMessage.onopen=function(){Ea.put(d);Ca("attack");
zh(1);P("DATACHANNEL OPEN");setTimeout(function(){O(ke,Of(),0,[d]);w.admin&&(O(Pf,w.room.max,0,[d]),oa?Sj(oa.compressed):O(ed,p,!1),na.put(d.id),O(Wb,na,0))},500)};d.channels.channelMessage.onerror=function(d){P(d)}}function Dj(){document.getElementById("buttons").innerHTML="";document.getElementById("gameName").innerHTML=""}function de(){w.p2p?(Oa(),w.p2p.emit("getRooms"),r("returnmenu").style.display="block"):(qb||qc(),qc.func=de)}function Tj(){var d=location,b=d.hash.substr(1);""==b&&(document.getElementById("returnmenu").style.display=
"none");if("MatchX"==b.substr(0,6))6<b.length&&Bm(b.substr(6-b.length));else if("Room"==d.hash.substr(-4))d=d.hash.substr(1),w.admin||Uj(d.substr(0,d.length-4));else if(Vj[b])Vj[b]();else d.hash=""}function Lj(d){d=document.getElementById(d);d.style.display="none"==d.style.display?"block":"none"}function Ah(d){d.style.display="none"==d.style.display?"block":"none"}function Bh(d){return y.locateFile?y.locateFile(d,rc):rc+d}function Wj(d,b){b||(b=16);return Math.ceil(d/b)*b}function Ch(d,b){d||le("Assertion failed: "+
b)}function Xj(d){for(var b=0,e=0;e<d.length;++e){var f=d.charCodeAt(e);55296<=f&&57343>=f&&(f=65536+((f&1023)<<10)|d.charCodeAt(++e)&1023);127>=f?++b:b=2047>=f?b+2:65535>=f?b+3:2097151>=f?b+4:67108863>=f?b+5:b+6}var g=b+1;b=Yj(g);e=Dh;f=b;if(0<g){g=f+g-1;for(var h=0;h<d.length;++h){var c=d.charCodeAt(h);if(55296<=c&&57343>=c){var n=d.charCodeAt(++h);c=65536+((c&1023)<<10)|n&1023}if(127>=c){if(f>=g)break;e[f++]=c}else{if(2047>=c){if(f+1>=g)break;e[f++]=192|c>>6}else{if(65535>=c){if(f+2>=g)break;e[f++]=
224|c>>12}else{if(2097151>=c){if(f+3>=g)break;e[f++]=240|c>>18}else{if(67108863>=c){if(f+4>=g)break;e[f++]=248|c>>24}else{if(f+5>=g)break;e[f++]=252|c>>30;e[f++]=128|c>>24&63}e[f++]=128|c>>18&63}e[f++]=128|c>>12&63}e[f++]=128|c>>6&63}e[f++]=128|c&63}}e[f]=0}return b}function Eh(d,b){0<d%b&&(d+=b-d%b);return d}function Fh(){y.HEAP8=Dh=new Int8Array(Bb);y.HEAP16=new Int16Array(Bb);y.HEAP32=Gc=new Int32Array(Bb);y.HEAPU8=new Uint8Array(Bb);y.HEAPU16=new Uint16Array(Bb);y.HEAPU32=new Uint32Array(Bb);
y.HEAPF32=new Float32Array(Bb);y.HEAPF64=new Float64Array(Bb)}function Ed(d){for(;0<d.length;){var b=d.shift();if("function"==typeof b)b();else{var e=b.func;"number"===typeof e?void 0===b.arg?y.dynCall_v(e):y.dynCall_vi(e,b.arg):e(void 0===b.arg?null:b.arg)}}}function Qf(d){return String.prototype.startsWith?d.startsWith("data:application/octet-stream;base64,"):0===d.indexOf("data:application/octet-stream;base64,")}function Fd(d){this.name="ExitStatus";this.message="Program terminated with exit("+
d+")";this.status=d}function Gh(d){function b(){if(!y.calledRun&&(y.calledRun=!0,!Hh)){Rf||(Rf=!0,Ed(Ih));Ed(Cm);if(y.onRuntimeInitialized)y.onRuntimeInitialized();y._main&&Zj&&y.callMain(d);if(y.postRun)for("function"==typeof y.postRun&&(y.postRun=[y.postRun]);y.postRun.length;)ak.unshift(y.postRun.shift());Ed(ak)}}d=d||y.arguments;if(!(0<fd)){if(y.preRun)for("function"==typeof y.preRun&&(y.preRun=[y.preRun]);y.preRun.length;)bk.unshift(y.preRun.shift());Ed(bk);0<fd||y.calledRun||(y.setStatus?(y.setStatus("Running..."),
setTimeout(function(){setTimeout(function(){y.setStatus("")},1);b()},1)):b())}}function le(d){if(y.onAbort)y.onAbort(d);void 0!==d?(ck(d),Rb(d),d=JSON.stringify(d)):d="";Hh=!0;throw"abort("+d+"). Build with -s ASSERTIONS=1 for more info.";}function dk(d){aa=function(){};rb=!1;var b=L;b.d=d.d;pa(b,d.img);b.active=!0;Xa=A[52];me=d;document.addEventListener("mousemove",Jh);document.addEventListener("mousedown",Sf)}function Dm(d,b){return d.innerHTML-b.innerHTML}var Gm=function(){(function(d){"object"===
typeof exports&&"undefined"!==typeof module?module.exports=d():"function"===typeof define&&define.amd?define([],d):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).SimpleWebRTC=d()})(function(){return function g(b,e,f){function h(l,n){if(!e[l]){if(!b[l]){var t="function"==typeof require&&require;if(!n&&t)return t(l,!0);if(c)return c(l,!0);n=Error("Cannot find module '"+l+"'");throw n.code="MODULE_NOT_FOUND",n;}n=e[l]={exports:{}};b[l][0].call(n.exports,
function(e){var g=b[l][1][e];return h(g?g:e)},n,n.exports,g,b,e,f)}return e[l].exports}for(var c="function"==typeof require&&require,n=0;n<f.length;n++)h(f[n]);return h}({1:[function(b,e,f){function g(){}e.exports=function(b,e,f){function h(b,g){if(0>=h.count)throw Error("after called too many times");--h.count;b?(c=!0,e(b),e=f):0!==h.count||c||e(null,g)}var c=!1;f=f||g;h.count=b;return 0===b?e():h}},{}],2:[function(b,e,f){e.exports=function(b,e,f){var g=b.byteLength;e=e||0;f=f||g;if(b.slice)return b.slice(e,
f);0>e&&(e+=g);0>f&&(f+=g);f>g&&(f=g);if(e>=g||e>=f||0===g)return new ArrayBuffer(0);b=new Uint8Array(b);g=new Uint8Array(f-e);for(var c=0;e<f;e++,c++)g[c]=b[e];return g.buffer}},{}],3:[function(b,e,f){e.exports=function(b,e,f){var g,c=e;e={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};if(f)for(g in f)e[g]=f[g];c?"audio"===c.tagName.toLowerCase()&&(e.audio=!0):c=document.createElement(e.audio?"audio":"video");e.disableContextMenu&&(c.oncontextmenu=function(b){b.preventDefault()});
e.autoplay&&(c.autoplay="autoplay");e.muted&&(c.muted=!0);!e.audio&&e.mirror&&["","moz","webkit","o","ms"].forEach(function(b){c.style[b?b+"Transform":"transform"]="scaleX(-1)"});c.srcObject=b;return c}},{}],4:[function(b,e,f){function g(b){b=b||{};this.ms=b.min||100;this.max=b.max||1E4;this.factor=b.factor||2;this.jitter=0<b.jitter&&1>=b.jitter?b.jitter:0;this.attempts=0}e.exports=g;g.prototype.duration=function(){var b=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),
f=Math.floor(e*this.jitter*b);b=0==(Math.floor(10*e)&1)?b-f:b+f}return Math.min(b,this.max)|0};g.prototype.reset=function(){this.attempts=0};g.prototype.setMin=function(b){this.ms=b};g.prototype.setMax=function(b){this.max=b};g.prototype.setJitter=function(b){this.jitter=b}},{}],5:[function(b,e,f){(function(b){f.encode=function(e){e=new Uint8Array(e);var f,g=e.length,c="";for(f=0;f<g;f+=3)c+=b[e[f]>>2],c+=b[(e[f]&3)<<4|e[f+1]>>4],c+=b[(e[f+1]&15)<<2|e[f+2]>>6],c+=b[e[f+2]&63];2===g%3?c=c.substring(0,
c.length-1)+"=":1===g%3&&(c=c.substring(0,c.length-2)+"==");return c};f.decode=function(e){var f=.75*e.length,g=e.length,c=0;"="===e[e.length-1]&&(f--,"="===e[e.length-2]&&f--);var h=new ArrayBuffer(f),B=new Uint8Array(h);for(f=0;f<g;f+=4){var q=b.indexOf(e[f]);var T=b.indexOf(e[f+1]);var K=b.indexOf(e[f+2]);var Ob=b.indexOf(e[f+3]);B[c++]=q<<2|T>>4;B[c++]=(T&15)<<4|K>>2;B[c++]=(K&3)<<6|Ob&63}return h}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],6:[function(b,e,f){(function(b){function f(b){for(var e=
0;e<b.length;e++){var f=b[e];if(f.buffer instanceof ArrayBuffer){var g=f.buffer;if(f.byteLength!==g.byteLength){var c=new Uint8Array(f.byteLength);c.set(new Uint8Array(g,f.byteOffset,f.byteLength));g=c.buffer}b[e]=g}}}function g(b,e){e=e||{};var g=new t;f(b);for(var c=0;c<b.length;c++)g.append(b[c]);return e.type?g.getBlob(e.type):g.getBlob()}function c(b,e){f(b);return new Blob(b,e||{})}var t=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder;try{var E=2===(new Blob(["hi"])).size}catch(T){E=
!1}var B;if(B=E)try{B=2===(new Blob([new Uint8Array([1,2])])).size}catch(T){B=!1}var q=t&&t.prototype.append&&t.prototype.getBlob;b=E?B?b.Blob:c:q?g:void 0;e.exports=b}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],7:[function(b,e,f){var g=[].slice;e.exports=function(b,e){"string"==typeof e&&(e=b[e]);if("function"!=typeof e)throw Error("bind() requires a function");var f=g.call(arguments,2);return function(){return e.apply(b,
f.concat(g.call(arguments)))}}},{}],8:[function(b,e,f){function g(b){if(b){for(var e in g.prototype)b[e]=g.prototype[e];return b}}e.exports=g;g.prototype.on=g.prototype.addEventListener=function(b,e){this._callbacks=this._callbacks||{};(this._callbacks[b]=this._callbacks[b]||[]).push(e);return this};g.prototype.once=function(b,e){function f(){g.off(b,f);e.apply(this,arguments)}var g=this;this._callbacks=this._callbacks||{};f.fn=e;this.on(b,f);return this};g.prototype.off=g.prototype.removeListener=
g.prototype.removeAllListeners=g.prototype.removeEventListener=function(b,e){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var f=this._callbacks[b];if(!f)return this;if(1==arguments.length)return delete this._callbacks[b],this;for(var g,c=0;c<f.length;c++)if(g=f[c],g===e||g.fn===e){f.splice(c,1);break}return this};g.prototype.emit=function(b){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),f=this._callbacks[b];if(f){f=f.slice(0);for(var g=
0,c=f.length;g<c;++g)f[g].apply(this,e)}return this};g.prototype.listeners=function(b){this._callbacks=this._callbacks||{};return this._callbacks[b]||[]};g.prototype.hasListeners=function(b){return!!this.listeners(b).length}},{}],9:[function(b,e,f){e.exports=function(b,e){var f=function(){};f.prototype=e.prototype;b.prototype=new f;b.prototype.constructor=b}},{}],10:[function(b,e,f){function g(b){return g.enabled(b)?function(e){e instanceof Error&&(e=e.stack||e.message);var f=new Date,c=f-(g[b]||
f);g[b]=f;e=b+" "+e+" +"+g.humanize(c);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}e.exports=g;g.names=[];g.skips=[];g.enable=function(b){try{localStorage.debug=b}catch(E){}for(var e=(b||"").split(/[\s,]+/),f=e.length,c=0;c<f;c++)b=e[c].replace("*",".*?"),"-"===b[0]?g.skips.push(new RegExp("^"+b.substr(1)+"$")):g.names.push(new RegExp("^"+b+"$"))};g.disable=function(){g.enable("")};g.humanize=function(b){return 36E5<=b?(b/36E5).toFixed(1)+
"h":6E4<=b?(b/6E4).toFixed(1)+"m":1E3<=b?(b/1E3|0)+"s":b+"ms"};g.enabled=function(b){for(var e=0,f=g.skips.length;e<f;e++)if(g.skips[e].test(b))return!1;e=0;for(f=g.names.length;e<f;e++)if(g.names[e].test(b))return!0;return!1};try{window.localStorage&&g.enable(localStorage.debug)}catch(h){}},{}],11:[function(b,e,f){e.exports=b("./lib/")},{"./lib/":12}],12:[function(b,e,f){e.exports=b("./socket");e.exports.parser=b("engine.io-parser")},{"./socket":13,"engine.io-parser":24}],13:[function(b,e,f){(function(f){function g(b,
e){if(!(this instanceof g))return new g(b,e);e=e||{};b&&"object"==typeof b&&(e=b,b=null);b&&(b=q(b),e.host=b.host,e.secure="https"==b.protocol||"wss"==b.protocol,e.port=b.port,b.query&&(e.query=b.query));this.secure=null!=e.secure?e.secure:f.location&&"https:"==location.protocol;e.host&&(b=e.host.split(":"),e.hostname=b.shift(),b.length?e.port=b.pop():e.port||(e.port=this.secure?"443":"80"));this.agent=e.agent||!1;this.hostname=e.hostname||(f.location?location.hostname:"localhost");this.port=e.port||
(f.location&&location.port?location.port:this.secure?443:80);this.query=e.query||{};"string"==typeof this.query&&(this.query=K.decode(this.query));this.upgrade=!1!==e.upgrade;this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!e.forceJSONP;this.jsonp=!1!==e.jsonp;this.forceBase64=!!e.forceBase64;this.enablesXDR=!!e.enablesXDR;this.timestampParam=e.timestampParam||"t";this.timestampRequests=e.timestampRequests;this.transports=e.transports||["polling","websocket"];this.readyState=
"";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=e.policyPort||843;this.rememberUpgrade=e.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=e.onlyBinaryUpgrades;this.pfx=e.pfx||null;this.key=e.key||null;this.passphrase=e.passphrase||null;this.cert=e.cert||null;this.ca=e.ca||null;this.ciphers=e.ciphers||null;this.rejectUnauthorized=e.rejectUnauthorized||null;this.open()}var c=b("./transports"),n=b("component-emitter"),t=b("debug")("engine.io-client:socket"),E=b("indexof"),
B=b("engine.io-parser"),q=b("parseuri"),T=b("parsejson"),K=b("parseqs");e.exports=g;g.priorWebsocketSuccess=!1;n(g.prototype);g.protocol=B.protocol;g.Socket=g;g.Transport=b("./transport");g.transports=b("./transports");g.parser=b("engine.io-parser");g.prototype.createTransport=function(b){t('creating transport "%s"',b);var e=this.query,f={},g;for(g in e)e.hasOwnProperty(g)&&(f[g]=e[g]);f.EIO=B.protocol;f.transport=b;this.id&&(f.sid=this.id);return new c[b]({agent:this.agent,hostname:this.hostname,
port:this.port,secure:this.secure,path:this.path,query:f,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})};g.prototype.open=function(){if(this.rememberUpgrade&&g.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))var b=
"websocket";else{if(0==this.transports.length){var e=this;setTimeout(function(){e.emit("error","No transports available")},0);return}b=this.transports[0]}this.readyState="opening";try{b=this.createTransport(b)}catch(Fc){this.transports.shift();this.open();return}b.open();this.setTransport(b)};g.prototype.setTransport=function(b){t("setting transport %s",b.name);var e=this;this.transport&&(t("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=b;
b.on("drain",function(){e.onDrain()}).on("packet",function(b){e.onPacket(b)}).on("error",function(b){e.onError(b)}).on("close",function(){e.onClose("transport close")})};g.prototype.probe=function(b){function e(){if(K.onlyBinaryUpgrades){var e=!this.supportsBinary&&K.transport.supportsBinary;E=E||e}E||(t('probe transport "%s" opened',b),q.send([{type:"ping",data:"probe"}]),q.once("packet",function(e){E||("pong"==e.type&&"probe"==e.data?(t('probe transport "%s" pong',b),K.upgrading=!0,K.emit("upgrading",
q),q&&(g.priorWebsocketSuccess="websocket"==q.name,t('pausing current transport "%s"',K.transport.name),K.transport.pause(function(){E||"closed"==K.readyState||(t("changing transport and sending upgrade packet"),B(),K.setTransport(q),q.send([{type:"upgrade"}]),K.emit("upgrade",q),q=null,K.upgrading=!1,K.flush())}))):(t('probe transport "%s" failed',b),e=Error("probe error"),e.transport=q.name,K.emit("upgradeError",e)))}))}function f(){E||(E=!0,B(),q.close(),q=null)}function c(e){var g=Error("probe error: "+
e);g.transport=q.name;f();t('probe transport "%s" failed because of error: %s',b,e);K.emit("upgradeError",g)}function h(){c("transport closed")}function l(){c("socket closed")}function n(b){q&&b.name!=q.name&&(t('"%s" works - aborting "%s"',b.name,q.name),f())}function B(){q.removeListener("open",e);q.removeListener("error",c);q.removeListener("close",h);K.removeListener("close",l);K.removeListener("upgrading",n)}t('probing transport "%s"',b);var q=this.createTransport(b,{probe:1}),E=!1,K=this;g.priorWebsocketSuccess=
!1;q.once("open",e);q.once("error",c);q.once("close",h);this.once("close",l);this.once("upgrading",n);q.open()};g.prototype.onOpen=function(){t("socket open");this.readyState="open";g.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){t("starting upgrade probes");for(var b=0,e=this.upgrades.length;b<e;b++)this.probe(this.upgrades[b])}};g.prototype.onPacket=function(b){if("opening"==this.readyState||
"open"==this.readyState)switch(t('socket receive: type "%s", data "%s"',b.type,b.data),this.emit("packet",b),this.emit("heartbeat"),b.type){case "open":this.onHandshake(T(b.data));break;case "pong":this.setPing();break;case "error":var e=Error("server error");e.code=b.data;this.emit("error",e);break;case "message":this.emit("data",b.data),this.emit("message",b.data)}else t('packet received with socket readyState "%s"',this.readyState)};g.prototype.onHandshake=function(b){this.emit("handshake",b);
this.id=b.sid;this.transport.query.sid=b.sid;this.upgrades=this.filterUpgrades(b.upgrades);this.pingInterval=b.pingInterval;this.pingTimeout=b.pingTimeout;this.onOpen();"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};g.prototype.onHeartbeat=function(b){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){if("closed"!=e.readyState)e.onClose("ping timeout")},b||e.pingInterval+e.pingTimeout)};
g.prototype.setPing=function(){var b=this;clearTimeout(b.pingIntervalTimer);b.pingIntervalTimer=setTimeout(function(){t("writing ping packet - expecting pong within %sms",b.pingTimeout);b.ping();b.onHeartbeat(b.pingTimeout)},b.pingInterval)};g.prototype.ping=function(){this.sendPacket("ping")};g.prototype.onDrain=function(){for(var b=0;b<this.prevBufferLen;b++)if(this.callbackBuffer[b])this.callbackBuffer[b]();this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);
this.prevBufferLen=0;0==this.writeBuffer.length?this.emit("drain"):this.flush()};g.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(t("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};g.prototype.write=g.prototype.send=function(b,e){this.sendPacket("message",b,e);return this};g.prototype.sendPacket=function(b,e,f){"closing"!=
this.readyState&&"closed"!=this.readyState&&(b={type:b,data:e},this.emit("packetCreate",b),this.writeBuffer.push(b),this.callbackBuffer.push(f),this.flush())};g.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){var b=function(){g.once("upgrade",e);g.once("upgradeError",e)},e=function(){g.removeListener("upgrade",e);g.removeListener("upgradeError",e);f()},f=function(){g.onClose("forced close");t("socket closing - telling transport to close");g.transport.close()};this.readyState=
"closing";var g=this;if(this.writeBuffer.length)this.once("drain",function(){this.upgrading?b():f()});else this.upgrading?b():f()}return this};g.prototype.onError=function(b){t("socket error %j",b);g.priorWebsocketSuccess=!1;this.emit("error",b);this.onClose("transport error",b)};g.prototype.onClose=function(b,e){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){t('socket close with reason: "%s"',b);var f=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);
setTimeout(function(){f.writeBuffer=[];f.callbackBuffer=[];f.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",b,e)}};g.prototype.filterUpgrades=function(b){for(var e=[],f=0,g=b.length;f<g;f++)~E(this.transports,b[f])&&e.push(b[f]);return e}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./transport":14,
"./transports":15,"component-emitter":8,debug:21,"engine.io-parser":24,indexof:32,parsejson:40,parseqs:41,parseuri:23}],14:[function(b,e,f){function g(b){this.path=b.path;this.hostname=b.hostname;this.port=b.port;this.secure=b.secure;this.query=b.query;this.timestampParam=b.timestampParam;this.timestampRequests=b.timestampRequests;this.readyState="";this.agent=b.agent||!1;this.socket=b.socket;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;
this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized}var c=b("engine.io-parser");b=b("component-emitter");e.exports=g;b(g.prototype);g.timestamps=0;g.prototype.onError=function(b,e){b=Error(b);b.type="TransportError";b.description=e;this.emit("error",b);return this};g.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this};g.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),
this.onClose();return this};g.prototype.send=function(b){if("open"==this.readyState)this.write(b);else throw Error("Transport not open");};g.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};g.prototype.onData=function(b){b=c.decodePacket(b,this.socket.binaryType);this.onPacket(b)};g.prototype.onPacket=function(b){this.emit("packet",b)};g.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,"engine.io-parser":24}],15:[function(b,
e,f){(function(e){var g=b("xmlhttprequest"),c=b("./polling-xhr"),n=b("./polling-jsonp"),t=b("./websocket");f.polling=function(b){var f=!1,h=!1,l=!1!==b.jsonp;e.location&&(h="https:"==location.protocol,(f=location.port)||(f=h?443:80),f=b.hostname!=location.hostname||f!=b.port,h=b.secure!=h);b.xdomain=f;b.xscheme=h;if("open"in new g(b)&&!b.forceJSONP)return new c(b);if(!l)throw Error("JSONP disabled");return new n(b)};f.websocket=t}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(b,e,f){(function(f){function g(){}function c(b){n.call(this,b);this.query=this.query||{};q||(f.___eio||(f.___eio=[]),q=f.___eio);this.index=q.length;var e=this;q.push(function(b){e.onData(b)});this.query.j=this.index;f.document&&f.addEventListener&&f.addEventListener("beforeunload",function(){e.script&&(e.script.onerror=g)},!1)}var n=b("./polling"),t=b("component-inherit");
e.exports=c;var E=/\n/g,B=/\\n/g,q;t(c,n);c.prototype.supportsBinary=!1;c.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.iframe=this.form=null);n.prototype.doClose.call(this)};c.prototype.doPoll=function(){var b=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);e.async=!0;e.src=this.uri();e.onerror=function(e){b.onError("jsonp poll error",
e)};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(e,f);this.script=e;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var b=document.createElement("iframe");document.body.appendChild(b);document.body.removeChild(b)},100)};c.prototype.doWrite=function(b,e){function f(){g();e()}function g(){if(c.iframe)try{c.form.removeChild(c.iframe)}catch(Lh){c.onError("jsonp polling iframe removal error",Lh)}try{t=document.createElement('<iframe src="javascript:0" name="'+
c.iframeId+'">')}catch(Lh){t=document.createElement("iframe"),t.name=c.iframeId,t.src="javascript:0"}t.id=c.iframeId;c.form.appendChild(t);c.iframe=t}var c=this;if(!this.form){var h=document.createElement("form"),l=document.createElement("textarea"),n=this.iframeId="eio_iframe_"+this.index,t;h.className="socketio";h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=n;h.method="POST";h.setAttribute("accept-charset","utf-8");l.name="d";h.appendChild(l);document.body.appendChild(h);
this.form=h;this.area=l}this.form.action=this.uri();g();b=b.replace(B,"\\\n");this.area.value=b.replace(E,"\\n");try{this.form.submit()}catch(Lh){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==c.iframe.readyState&&f()}:this.iframe.onload=f}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-inherit":9}],17:[function(b,e,f){(function(f){function g(){}function c(b){B.call(this,
b);if(f.location){var e="https:"==location.protocol,g=location.port;g||(g=e?443:80);this.xd=b.hostname!=f.location.hostname||g!=b.port;this.xs=b.secure!=e}}function n(b){this.method=b.method||"GET";this.uri=b.uri;this.xd=!!b.xd;this.xs=!!b.xs;this.async=!1!==b.async;this.data=void 0!=b.data?b.data:null;this.agent=b.agent;this.isBinary=b.isBinary;this.supportsBinary=b.supportsBinary;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;
this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized;this.create()}function t(){for(var b in n.requests)n.requests.hasOwnProperty(b)&&n.requests[b].abort()}var E=b("xmlhttprequest"),B=b("./polling"),q=b("component-emitter"),T=b("component-inherit"),K=b("debug")("engine.io-client:polling-xhr");e.exports=c;e.exports.Request=n;T(c,B);c.prototype.supportsBinary=!0;c.prototype.request=function(b){b=b||{};b.uri=this.uri();b.xd=this.xd;b.xs=this.xs;b.agent=this.agent||!1;b.supportsBinary=
this.supportsBinary;b.enablesXDR=this.enablesXDR;b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;return new n(b)};c.prototype.doWrite=function(b,e){b=this.request({method:"POST",data:b,isBinary:"string"!==typeof b&&void 0!==b});var f=this;b.on("success",e);b.on("error",function(b){f.onError("xhr post error",b)});this.sendXhr=b};c.prototype.doPoll=function(){K("xhr poll");var b=this.request(),
e=this;b.on("data",function(b){e.onData(b)});b.on("error",function(b){e.onError("xhr poll error",b)});this.pollXhr=b};q(n.prototype);n.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new E(b),g=this;try{K("xhr open %s: %s",this.method,this.uri);e.open(this.method,this.uri,
this.async);this.supportsBinary&&(e.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Kh){}"withCredentials"in e&&(e.withCredentials=!0);this.hasXDR()?(e.onload=function(){g.onLoad()},e.onerror=function(){g.onError(e.responseText)}):e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status||1223==e.status)g.onLoad();else setTimeout(function(){g.onError(e.status)},
0)};K("xhr data %s",this.data);e.send(this.data)}catch(Kh){setTimeout(function(){g.onError(Kh)},0);return}f.document&&(this.index=n.requestsCount++,n.requests[this.index]=this)};n.prototype.onSuccess=function(){this.emit("success");this.cleanup()};n.prototype.onData=function(b){this.emit("data",b);this.onSuccess()};n.prototype.onError=function(b){this.emit("error",b);this.cleanup(!0)};n.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=this.xhr.onerror=
g:this.xhr.onreadystatechange=g;if(b)try{this.xhr.abort()}catch(Lf){}f.document&&delete n.requests[this.index];this.xhr=null}};n.prototype.onLoad=function(){try{try{var b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(Fc){}var e="application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(Fc){this.onError(Fc)}if(null!=e)this.onData(e)};n.prototype.hasXDR=function(){return"undefined"!==typeof f.XDomainRequest&&!this.xs&&this.enablesXDR};n.prototype.abort=
function(){this.cleanup()};f.document&&(n.requestsCount=0,n.requests={},f.attachEvent?f.attachEvent("onunload",t):f.addEventListener&&f.addEventListener("beforeunload",t,!1))}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-emitter":8,"component-inherit":9,debug:21,xmlhttprequest:20}],18:[function(b,e,f){function g(b){var e=b&&b.forceBase64;if(!E||e)this.supportsBinary=!1;c.call(this,b)}var c=b("../transport"),
l=b("parseqs"),n=b("engine.io-parser");f=b("component-inherit");var t=b("debug")("engine.io-client:polling");e.exports=g;var E=null!=(new (b("xmlhttprequest"))({xdomain:!1})).responseType;f(g,c);g.prototype.name="polling";g.prototype.doOpen=function(){this.poll()};g.prototype.pause=function(b){function e(){t("paused");f.readyState="paused";b()}var f=this;this.readyState="pausing";if(this.polling||!this.writable){var g=0;this.polling&&(t("we are currently polling - waiting to pause"),g++,this.once("pollComplete",
function(){t("pre-pause polling complete");--g||e()}));this.writable||(t("we are currently writing - waiting to pause"),g++,this.once("drain",function(){t("pre-pause writing complete");--g||e()}))}else e()};g.prototype.poll=function(){t("polling");this.polling=!0;this.doPoll();this.emit("poll")};g.prototype.onData=function(b){var e=this;t("polling got data %s",b);n.decodePayload(b,this.socket.binaryType,function(b,f,g){if("opening"==e.readyState)e.onOpen();if("close"==b.type)return e.onClose(),!1;
e.onPacket(b)});"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():t('ignoring poll - transport state "%s"',this.readyState))};g.prototype.doClose=function(){function b(){t("writing close packet");e.write([{type:"close"}])}var e=this;"open"==this.readyState?(t("transport open - closing"),b()):(t("transport not open - deferring close"),this.once("open",b))};g.prototype.write=function(b){var e=this;this.writable=!1;var f=function(){e.writable=!0;
e.emit("drain")};e=this;n.encodePayload(b,this.supportsBinary,function(b){e.doWrite(b,f)})};g.prototype.uri=function(){var b=this.query||{},e=this.secure?"https":"http",f="";!1!==this.timestampRequests&&(b[this.timestampParam]=+new Date+"-"+c.timestamps++);this.supportsBinary||b.sid||(b.b64=1);b=l.encode(b);this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(f=":"+this.port);b.length&&(b="?"+b);return e+"://"+this.hostname+f+this.path+b}},{"../transport":14,"component-inherit":9,debug:21,
"engine.io-parser":24,parseqs:41,xmlhttprequest:20}],19:[function(b,e,f){function g(b){b&&b.forceBase64&&(this.supportsBinary=!1);c.call(this,b)}var c=b("../transport"),l=b("engine.io-parser"),n=b("parseqs");f=b("component-inherit");var t=b("debug")("engine.io-client:websocket"),E=b("ws");e.exports=g;f(g,c);g.prototype.name="websocket";g.prototype.supportsBinary=!0;g.prototype.doOpen=function(){if(this.check()){var b=this.uri(),e={agent:this.agent};e.pfx=this.pfx;e.key=this.key;e.passphrase=this.passphrase;
e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;this.ws=new E(b,void 0,e);void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.binaryType="arraybuffer";this.addEventListeners()}};g.prototype.addEventListeners=function(){var b=this;this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(){b.onClose()};this.ws.onmessage=function(e){b.onData(e.data)};this.ws.onerror=function(e){b.onError("websocket error",e)}};"undefined"!=typeof navigator&&
/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(g.prototype.onData=function(b){var e=this;setTimeout(function(){c.prototype.onData.call(e,b)},0)});g.prototype.write=function(b){var e=this;this.writable=!1;for(var f=0,g=b.length;f<g;f++)l.encodePacket(b[f],this.supportsBinary,function(b){try{e.ws.send(b)}catch(Lf){t("websocket closed before onclose event")}});setTimeout(function(){e.writable=!0;e.emit("drain")},0)};g.prototype.onClose=function(){c.prototype.onClose.call(this)};g.prototype.doClose=
function(){"undefined"!==typeof this.ws&&this.ws.close()};g.prototype.uri=function(){var b=this.query||{},e=this.secure?"wss":"ws",f="";this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(f=":"+this.port);this.timestampRequests&&(b[this.timestampParam]=+new Date);this.supportsBinary||(b.b64=1);b=n.encode(b);b.length&&(b="?"+b);return e+"://"+this.hostname+f+this.path+b};g.prototype.check=function(){return!!E&&!("__initialize"in E&&this.name===g.prototype.name)}},{"../transport":14,"component-inherit":9,
debug:21,"engine.io-parser":24,parseqs:41,ws:66}],20:[function(b,e,f){var g=b("has-cors");e.exports=function(b){var e=b.xdomain,f=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||g))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!f&&b)return new XDomainRequest}catch(t){}if(!e)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}},{"has-cors":31}],21:[function(b,e,f){function g(){try{var b=localStorage.debug}catch(l){}return b}f=e.exports=
b("./debug");f.log=function(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)};f.formatArgs=function(){var b=arguments,e=this.useColors;b[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+b[0]+(e?"%c ":" ")+"+"+f.humanize(this.diff);if(!e)return b;e="color: "+this.color;b=[b[0],e,"color: inherit"].concat(Array.prototype.slice.call(b,1));var g=0,c=0;b[0].replace(/%[a-z%]/g,function(b){"%%"!==b&&(g++,"%c"===b&&(c=g))});b.splice(c,
0,e);return b};f.save=function(b){try{null==b?localStorage.removeItem("debug"):localStorage.debug=b}catch(l){}};f.load=g;f.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)};f.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");f.formatters.j=function(b){return JSON.stringify(b)};f.enable(g())},
{"./debug":22}],22:[function(b,e,f){f=e.exports=function(b){function e(){}function h(){var b=+new Date;h.diff=b-(c||b);h.prev=c;c=h.curr=b;null==h.useColors&&(h.useColors=f.useColors());null==h.color&&h.useColors&&(h.color=f.colors[g++%f.colors.length]);var e=Array.prototype.slice.call(arguments);e[0]=f.coerce(e[0]);"string"!==typeof e[0]&&(e=["%o"].concat(e));var l=0;e[0]=e[0].replace(/%([a-z%])/g,function(b,g){if("%%"===b)return b;l++;g=f.formatters[g];"function"===typeof g&&(b=g.call(h,e[l]),e.splice(l,
1),l--);return b});"function"===typeof f.formatArgs&&(e=f.formatArgs.apply(h,e));(h.log||f.log||console.log.bind(console)).apply(h,e)}e.enabled=!1;h.enabled=!0;var l=f.enabled(b)?h:e;l.namespace=b;return l};f.coerce=function(b){return b instanceof Error?b.stack||b.message:b};f.disable=function(){f.enable("")};f.enable=function(b){f.save(b);for(var e=(b||"").split(/[\s,]+/),g=e.length,c=0;c<g;c++)e[c]&&(b=e[c].replace(/\*/g,".*?"),"-"===b[0]?f.skips.push(new RegExp("^"+b.substr(1)+"$")):f.names.push(new RegExp("^"+
b+"$")))};f.enabled=function(b){var e;var g=0;for(e=f.skips.length;g<e;g++)if(f.skips[g].test(b))return!1;g=0;for(e=f.names.length;g<e;g++)if(f.names[g].test(b))return!0;return!1};f.humanize=b("ms");f.names=[];f.skips=[];f.formatters={};var g=0,c},{ms:38}],23:[function(b,e,f){var g=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
c="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");e.exports=function(b){var e=b,f=b.indexOf("["),h=b.indexOf("]");-1!=f&&-1!=h&&(b=b.substring(0,f)+b.substring(f,h).replace(/:/g,";")+b.substring(h,b.length));b=g.exec(b||"");for(var l={},q=14;q--;)l[c[q]]=b[q]||"";-1!=f&&-1!=h&&(l.source=e,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=
!0);return l}},{}],24:[function(b,e,f){(function(e){function g(b,e,g){if(!e)return f.encodeBase64Packet(b,g);var c=new FileReader;c.onload=function(){b.data=c.result;f.encodePacket(b,e,!0,g)};return c.readAsArrayBuffer(b.data)}function c(b,e,f){var g=Array(b.length);f=q(b.length,f);for(var c=function(b,f,c){e(f,function(e,f){g[b]=f;c(e,g)})},h=0;h<b.length;h++)c(h,b[h],f)}var n=b("./keys"),t=b("has-binary"),E=b("arraybuffer.slice"),B=b("base64-arraybuffer"),q=b("after"),T=b("utf8"),K=navigator.userAgent.match(/Android/i),
k=/PhantomJS/i.test(navigator.userAgent),m=K||k;f.protocol=3;var p=f.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},u=n(p),La={type:"error",data:"parser error"},r=b("blob");f.encodePacket=function(b,c,h,l){"function"==typeof c&&(l=c,c=!1);"function"==typeof h&&(l=h,h=null);var n=void 0===b.data?void 0:b.data.buffer||b.data;if(e.ArrayBuffer&&n instanceof ArrayBuffer){if(c){h=b.data;c=new Uint8Array(h);h=new Uint8Array(1+h.byteLength);h[0]=p[b.type];for(b=0;b<c.length;b++)h[b+1]=
c[b];b=l(h.buffer)}else b=f.encodeBase64Packet(b,l);return b}if(r&&n instanceof e.Blob)return c?m?b=g(b,c,l):(c=new Uint8Array(1),c[0]=p[b.type],b=new r([c.buffer,b.data]),b=l(b)):b=f.encodeBase64Packet(b,l),b;if(n&&n.base64)return l("b"+f.packets[b.type]+b.data.data);c=p[b.type];void 0!==b.data&&(c+=h?T.encode(String(b.data)):String(b.data));return l(""+c)};f.encodeBase64Packet=function(b,g){var c="b"+f.packets[b.type];if(r&&b.data instanceof r){var h=new FileReader;h.onload=function(){var b=h.result.split(",")[1];
g(c+b)};return h.readAsDataURL(b.data)}try{var l=String.fromCharCode.apply(null,new Uint8Array(b.data))}catch(no){b=new Uint8Array(b.data);l=Array(b.length);for(var n=0;n<b.length;n++)l[n]=b[n];l=String.fromCharCode.apply(null,l)}c+=e.btoa(l);return g(c)};f.decodePacket=function(b,e,g){if("string"==typeof b||void 0===b){if("b"==b.charAt(0))return f.decodeBase64Packet(b.substr(1),e);if(g)try{b=T.decode(b)}catch(mo){return La}g=b.charAt(0);return Number(g)==g&&u[g]?1<b.length?{type:u[g],data:b.substring(1)}:
{type:u[g]}:La}g=(new Uint8Array(b))[0];b=E(b,1);r&&"blob"===e&&(b=new r([b]));return{type:u[g],data:b}};f.decodeBase64Packet=function(b,f){var g=u[b.charAt(0)];if(!e.ArrayBuffer)return{type:g,data:{base64:!0,data:b.substr(1)}};b=B.decode(b.substr(1));"blob"===f&&r&&(b=new r([b]));return{type:g,data:b}};f.encodePayload=function(b,e,g){"function"==typeof e&&(g=e,e=null);var h=t(b);if(e&&h)return r&&!m?f.encodePayloadAsBlob(b,g):f.encodePayloadAsArrayBuffer(b,g);if(!b.length)return g("0:");c(b,function(b,
g){f.encodePacket(b,h?e:!1,!0,function(b){g(null,b.length+":"+b)})},function(b,e){return g(e.join(""))})};f.decodePayload=function(b,e,g){if("string"!=typeof b)return f.decodePayloadAsBinary(b,e,g);"function"===typeof e&&(g=e,e=null);if(""==b)return g(La,0,1);var c="";for(var h,l,n=0,t=b.length;n<t;n++)if(l=b.charAt(n),":"!=l)c+=l;else{if(""==c||c!=(h=Number(c)))return g(La,0,1);l=b.substr(n+1,h);if(c!=l.length)return g(La,0,1);if(l.length){c=f.decodePacket(l,e,!0);if(La.type==c.type&&La.data==c.data)return g(La,
0,1);if(!1===g(c,n+h,t))return}n+=h;c=""}if(""!=c)return g(La,0,1)};f.encodePayloadAsArrayBuffer=function(b,e){if(!b.length)return e(new ArrayBuffer(0));c(b,function(b,e){f.encodePacket(b,!0,!0,function(b){return e(null,b)})},function(b,f){b=f.reduce(function(b,e){e="string"===typeof e?e.length:e.byteLength;return b+e.toString().length+e+2},0);var g=new Uint8Array(b),c=0;f.forEach(function(b){var e="string"===typeof b,f=b;if(e){f=new Uint8Array(b.length);for(var h=0;h<b.length;h++)f[h]=b.charCodeAt(h);
f=f.buffer}e?g[c++]=0:g[c++]=1;b=f.byteLength.toString();for(h=0;h<b.length;h++)g[c++]=parseInt(b[h]);g[c++]=255;f=new Uint8Array(f);for(h=0;h<f.length;h++)g[c++]=f[h]});return e(g.buffer)})};f.encodePayloadAsBlob=function(b,e){c(b,function(b,e){f.encodePacket(b,!0,!0,function(b){var f=new Uint8Array(1);f[0]=1;if("string"===typeof b){for(var g=new Uint8Array(b.length),c=0;c<b.length;c++)g[c]=b.charCodeAt(c);b=g.buffer;f[0]=0}g=(b instanceof ArrayBuffer?b.byteLength:b.size).toString();var h=new Uint8Array(g.length+
1);for(c=0;c<g.length;c++)h[c]=parseInt(g[c]);h[g.length]=255;r&&(b=new r([f.buffer,h.buffer,b]),e(null,b))})},function(b,f){return e(new r(f))})};f.decodePayloadAsBinary=function(b,e,g){"function"===typeof e&&(g=e,e=null);for(var c=[],h=!1;0<b.byteLength;){for(var l=new Uint8Array(b),n=0===l[0],t="",q=1;255!=l[q];q++){if(310<t.length){h=!0;break}t+=l[q]}if(h)return g(La,0,1);b=E(b,2+t.length);t=parseInt(t);l=E(b,0,t);if(n)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(oo){for(n=new Uint8Array(l),
l="",q=0;q<n.length;q++)l+=String.fromCharCode(n[q])}c.push(l);b=E(b,t)}var B=c.length;c.forEach(function(b,c){g(f.decodePacket(b,e,!0),c,B)})}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./keys":25,after:1,"arraybuffer.slice":2,"base64-arraybuffer":5,blob:6,"has-binary":30,utf8:60}],25:[function(b,e,f){e.exports=Object.keys||function(b){var e=[],f=Object.prototype.hasOwnProperty,g;for(g in b)f.call(b,g)&&e.push(g);return e}},
{}],26:[function(b,e,f){function g(b){l.call(this);b=b||{};this.config={chunksize:16384,pacing:0};for(var e in b)this.config[e]=b[e];this.channel=this.file=null}function c(){l.call(this);this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null}var l=b("wildemitter");b=b("util");b.inherits(g,l);g.prototype.send=function(b,e){var f=this;this.file=b;this.channel=e;var g="number"!==typeof e.bufferedAmountLowThreshold,c=0,h=function(){var l=new window.FileReader;l.onload=function(){return function(l){f.channel.send(l.target.result);
f.emit("progress",c,b.size,l.target.result);b.size>c+l.target.result.byteLength?g?window.setTimeout(h,f.config.pacing):e.bufferedAmount<=e.bufferedAmountLowThreshold&&window.setTimeout(h,0):(f.emit("progress",b.size,b.size,null),f.emit("sentFile"));c+=f.config.chunksize}}(b);var n=b.slice(c,c+f.config.chunksize);l.readAsArrayBuffer(n)};g||(e.bufferedAmountLowThreshold=8*this.config.chunksize,e.addEventListener("bufferedamountlow",h));window.setTimeout(h,0)};b.inherits(c,l);c.prototype.receive=function(b,
e){var f=this;b&&(this.metadata=b);this.channel=e;e.binaryType="arraybuffer";this.channel.onmessage=function(b){f.received+=b.data.byteLength;f.receiveBuffer.push(b.data);f.emit("progress",f.received,f.metadata.size,b.data);f.received===f.metadata.size?(f.emit("receivedFile",new window.Blob(f.receiveBuffer),f.metadata),f.receiveBuffer=[]):f.received>f.metadata.size&&(console.error("received more than expected, discarding..."),f.receiveBuffer=[])}};e.exports={};e.exports.support="undefined"!==typeof window&&
window&&window.File&&window.FileReader&&window.Blob;e.exports.Sender=g;e.exports.Receiver=c},{util:63,wildemitter:65}],27:[function(b,e,f){var g={};e.exports=function(b,e){var f=2===arguments.length,c=f?e:b;if("undefined"===typeof window||"http:"===window.location.protocol){var h=Error("NavigatorUserMediaError");h.name="HTTPS_REQUIRED";return c(h)}if(window.navigator.userAgent.match("Chrome")){var l=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),q=33,T=!window.chrome.webstore;window.navigator.userAgent.match("Linux")&&
(q=35);sessionStorage.getScreenMediaJSExtensionId?chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(e){e&&""!==e.sourceId?(b=f&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}},b.video.mandatory.chromeMediaSourceId=e.sourceId,window.navigator.mediaDevices.getUserMedia(b).then(function(b){c(null,b)}).catch(function(b){c(b)})):(e=Error("NavigatorUserMediaError"),
e.name="NotAllowedError",c(e))}):window.cefGetScreenMedia?window.cefGetScreenMedia(function(e){e?(b=f&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},b.video.mandatory.chromeMediaSourceId=e,window.navigator.mediaDevices.getUserMedia(b).then(function(b){c(null,b)}).catch(function(b){c(b)})):(e=Error("cefGetScreenMediaError"),e.name="CEF_GETSCREENMEDIA_CANCELED",
c(e))}):T||26<=l&&l<=q?(b=f&&b||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){c(null,b)}).catch(function(b){c(b)})):(l=window.setTimeout(function(){h=Error("NavigatorUserMediaError");h.name="EXTENSION_UNAVAILABLE";return c(h)},1E3),g[l]=[c,f?b:null],window.postMessage({type:"getScreen",id:l},"*"))}else window.navigator.userAgent.match("Firefox")&&
(33<=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)?(b=f&&b||{video:{mozMediaSource:"window",mediaSource:"window"}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){c(null,b);var e=b.currentTime,f=window.setInterval(function(){b||window.clearInterval(f);if(b.currentTime==e&&(window.clearInterval(f),b.onended))b.onended();e=b.currentTime},500)}).catch(function(b){c(b)})):(h=Error("NavigatorUserMediaError"),h.name="EXTENSION_UNAVAILABLE"))};"undefined"!==typeof window&&
window.addEventListener("message",function(b){if(b.origin==window.location.origin)if("gotScreen"==b.data.type&&g[b.data.id]){var e=g[b.data.id],f=e[1],c=e[0];delete g[b.data.id];""===b.data.sourceId?(b=Error("NavigatorUserMediaError"),b.name="NotAllowedError",c(b)):(f=f||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},f.video.mandatory.chromeMediaSourceId=
b.data.sourceId,window.navigator.mediaDevices.getUserMedia(f).then(function(b){c(null,b)}).catch(function(b){c(b)}))}else"getScreenPending"==b.data.type&&window.clearTimeout(b.data.id)})},{}],28:[function(b,e,f){e.exports=function(){return this}()},{}],29:[function(b,e,f){var g=b("wildemitter"),c;"undefined"!==typeof window&&(c=window.AudioContext||window.webkitAudioContext);var l=null;e.exports=function(b,e){var f=new g;if(!c)return f;e=e||{};var h=e.smoothing||.1,n=e.interval||50,t=e.threshold,
K=e.play;e=e.history||10;var k=!0;l||(l=new c);var m=l.createAnalyser();m.fftSize=512;m.smoothingTimeConstant=h;var p=new Float32Array(m.frequencyBinCount);b.jquery&&(b=b[0]);if(b instanceof HTMLAudioElement||b instanceof HTMLVideoElement){var r=l.createMediaElementSource(b);"undefined"===typeof K&&(K=!0)}else r=l.createMediaStreamSource(b);t=t||-50;r.connect(m);K&&m.connect(l.destination);f.speaking=!1;f.setThreshold=function(b){t=b};f.setInterval=function(b){n=b};f.stop=function(){k=!1;f.emit("volume_change",
-100,t);f.speaking&&(f.speaking=!1,f.emit("stopped_speaking"));m.disconnect();r.disconnect()};f.speakingHistory=[];for(b=0;b<e;b++)f.speakingHistory.push(0);var La=function(){setTimeout(function(){if(k){var b=-Infinity;m.getFloatFrequencyData(p);for(var e=4,g=p.length;e<g;e++)p[e]>b&&0>p[e]&&(b=p[e]);f.emit("volume_change",b,t);e=0;if(b>t&&!f.speaking){for(g=f.speakingHistory.length-3;g<f.speakingHistory.length;g++)e+=f.speakingHistory[g];2<=e&&(f.speaking=!0,f.emit("speaking"))}else if(b<t&&f.speaking){for(g=
0;g<f.speakingHistory.length;g++)e+=f.speakingHistory[g];0==e&&(f.speaking=!1,f.emit("stopped_speaking"))}f.speakingHistory.shift();f.speakingHistory.push(0+(b>t));La()}},n)};La();return f}},{wildemitter:65}],30:[function(b,e,f){(function(f){var g=b("isarray");e.exports=function(b){function e(b){if(!b)return!1;if(f.Buffer&&f.Buffer.isBuffer(b)||f.ArrayBuffer&&b instanceof ArrayBuffer||f.Blob&&b instanceof Blob||f.File&&b instanceof File)return!0;if(g(b))for(var c=0;c<b.length;c++){if(e(b[c]))return!0}else if(b&&
"object"==typeof b)for(c in b.toJSON&&(b=b.toJSON()),b)if(Object.prototype.hasOwnProperty.call(b,c)&&e(b[c]))return!0;return!1}return e(b)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{isarray:33}],31:[function(b,e,f){b=b("global");try{e.exports="XMLHttpRequest"in b&&"withCredentials"in new b.XMLHttpRequest}catch(g){e.exports=!1}},{global:28}],32:[function(b,e,f){var g=[].indexOf;e.exports=function(b,e){if(g)return b.indexOf(e);
for(var f=0;f<b.length;++f)if(b[f]===e)return f;return-1}},{}],33:[function(b,e,f){e.exports=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)}},{}],34:[function(b,e,f){(function(b){function e(b){if(e[b]!==t)return e[b];if("bug-string-char-index"==b)var f=!1;else if("json"==b)f=e("json-stringify")&&e("json-parse");else{var c;if("json-stringify"==b){f=B.stringify;var h="function"==typeof f&&q;if(h){(c=function(){return 1}).toJSON=c;try{h="0"===f(0)&&"0"===f(new Number)&&
'""'==f(new String)&&f(g)===t&&f(t)===t&&f()===t&&"1"===f(c)&&"[1]"==f([c])&&"[null]"==f([t])&&"null"==f(null)&&"[null,null,null]"==f([t,g,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==f({a:[c,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===f(null,c)&&"[\n 1,\n 2\n]"==f([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==f(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==f(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==f(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==f(new Date(-1))}catch(Tf){h=
!1}}f=h}if("json-parse"==b){f=B.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){c=f('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var l=5==c.a.length&&1===c.a[0];if(l){try{l=!f('"\t"')}catch(Tf){}if(l)try{l=1!==f("01")}catch(Tf){}if(l)try{l=1!==f("1.")}catch(Tf){}}}}catch(Tf){l=!1}f=l}}return e[b]=!!f}var g={}.toString,c,t,E="object"==typeof JSON&&JSON,B="object"==typeof f&&f&&!f.nodeType&&f;B&&E?(B.stringify=E.stringify,B.parse=E.parse):B=b.JSON=E||{};var q=new Date(-0xc782b5b800cec);
try{q=-109252==q.getUTCFullYear()&&0===q.getUTCMonth()&&1===q.getUTCDate()&&10==q.getUTCHours()&&37==q.getUTCMinutes()&&6==q.getUTCSeconds()&&708==q.getUTCMilliseconds()}catch(po){}if(!e("json")){var T=e("bug-string-char-index");if(!q)var K=Math.floor,k=[0,31,59,90,120,151,181,212,243,273,304,334],m=function(b,e){return k[e]+365*(b-1970)+K((b-1969+(e=+(1<e)))/4)-K((b-1901+e)/100)+K((b-1601+e)/400)};(c={}.hasOwnProperty)||(c=function(b){var e={};if((e.__proto__=null,e.__proto__={toString:1},e).toString!=
g)c=function(b){var e=this.__proto__;b=b in(this.__proto__=null,this);this.__proto__=e;return b};else{var f=e.constructor;c=function(b){var e=(this.constructor||f).prototype;return b in this&&!(b in e&&this[b]===e[b])}}e=null;return c.call(this,b)});var p={"boolean":1,number:1,string:1,undefined:1};var r=function(b,e){var f=0,h,l;(h=function(){this.valueOf=0}).prototype.valueOf=0;var n=new h;for(l in n)c.call(n,l)&&f++;h=n=null;f?r=2==f?function(b,e){var f={},h="[object Function]"==g.call(b),l;for(l in b)h&&
"prototype"==l||c.call(f,l)||!(f[l]=1)||!c.call(b,l)||e(l)}:function(b,e){var f="[object Function]"==g.call(b),h,l;for(h in b)f&&"prototype"==h||!c.call(b,h)||(l="constructor"===h)||e(h);(l||c.call(b,h="constructor"))&&e(h)}:(n="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),r=function(b,e){var f="[object Function]"==g.call(b),h,l;if(l=!f&&"function"!=typeof b.constructor)l=typeof b.hasOwnProperty,l="object"==l?!!b.hasOwnProperty:!p[l];l=
l?b.hasOwnProperty:c;for(h in b)f&&"prototype"==h||!l.call(b,h)||e(h);for(f=n.length;h=n[--f];l.call(b,h)&&e(h));});return r(b,e)};if(!e("json-stringify")){var La={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},u=function(b,e){return("000000"+(e||0)).slice(-b)},z=function(b){var e='"',f=0,g=b.length,c=10<g&&T,h;for(c&&(h=b.split(""));f<g;f++){var l=b.charCodeAt(f);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=La[l];break;default:e=32>l?e+("\\u00"+u(2,l.toString(16))):
e+(c?h[f]:T?b.charAt(f):b[f])}}return e+'"'},w=function(b,e,f,h,l,n,q){var B;try{var E=e[b]}catch(ro){}if("object"==typeof E&&E){var T=g.call(E);if("[object Date]"!=T||c.call(E,"toJSON"))"function"==typeof E.toJSON&&("[object Number]"!=T&&"[object String]"!=T&&"[object Array]"!=T||c.call(E,"toJSON"))&&(E=E.toJSON(b));else if(E>-1/0&&E<1/0){if(m){var k=K(E/864E5);for(T=K(k/365.2425)+1970-1;m(T+1,0)<=k;T++);for(B=K((k-m(T,0))/30.42);m(T,B+1)<=k;B++);k=1+k-m(T,B);var Ob=(E%864E5+864E5)%864E5;var p=K(Ob/
36E5)%24;var Lf=K(Ob/6E4)%60;var Fc=K(Ob/1E3)%60;Ob%=1E3}else T=E.getUTCFullYear(),B=E.getUTCMonth(),k=E.getUTCDate(),p=E.getUTCHours(),Lf=E.getUTCMinutes(),Fc=E.getUTCSeconds(),Ob=E.getUTCMilliseconds();E=(0>=T||1E4<=T?(0>T?"-":"+")+u(6,0>T?-T:T):u(4,T))+"-"+u(2,B+1)+"-"+u(2,k)+"T"+u(2,p)+":"+u(2,Lf)+":"+u(2,Fc)+"."+u(3,Ob)+"Z"}else E=null}f&&(E=f.call(e,b,E));if(null===E)return"null";T=g.call(E);if("[object Boolean]"==T)return""+E;if("[object Number]"==T)return E>-1/0&&E<1/0?""+E:"null";if("[object String]"==
T)return z(""+E);if("object"==typeof E){for(b=q.length;b--;)if(q[b]===E)throw TypeError();q.push(E);var La=[];e=n;n+=l;if("[object Array]"==T){B=0;for(b=E.length;B<b;B++)T=w(B,E,f,h,l,n,q),La.push(T===t?"null":T);b=La.length?l?"[\n"+n+La.join(",\n"+n)+"\n"+e+"]":"["+La.join(",")+"]":"[]"}else r(h||E,function(b){var e=w(b,E,f,h,l,n,q);e!==t&&La.push(z(b)+":"+(l?" ":"")+e)}),b=La.length?l?"{\n"+n+La.join(",\n"+n)+"\n"+e+"}":"{"+La.join(",")+"}":"{}";q.pop();return b}};B.stringify=function(b,e,f){var c;
if("function"==typeof e||"object"==typeof e&&e)if("[object Function]"==(c=g.call(e)))var h=e;else if("[object Array]"==c){var l={};for(var n=0,t=e.length,q;n<t;q=e[n++],(c=g.call(q),"[object String]"==c||"[object Number]"==c)&&(l[q]=1));}if(f)if("[object Number]"==(c=g.call(f))){if(0<(f-=f%1)){var B="";for(10<f&&(f=10);B.length<f;B+=" ");}}else"[object String]"==c&&(B=10>=f.length?f:f.slice(0,10));return w("",(q={},q[""]=b,q),h,l,B,"",[])}}if(!e("json-parse")){var x=String.fromCharCode,y={92:"\\",
34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},v,A,F=function(){v=A=null;throw SyntaxError();},H=function(){for(var b=A,e=b.length,f,g,c,h,l;v<e;)switch(l=b.charCodeAt(v),l){case 9:case 10:case 13:case 32:v++;break;case 123:case 125:case 91:case 93:case 58:case 44:return f=T?b.charAt(v):b[v],v++,f;case 34:f="@";for(v++;v<e;)if(l=b.charCodeAt(v),32>l)F();else if(92==l)switch(l=b.charCodeAt(++v),l){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:f+=y[l];v++;break;case 117:g=
++v;for(c=v+4;v<c;v++)l=b.charCodeAt(v),48<=l&&57>=l||97<=l&&102>=l||65<=l&&70>=l||F();f+=x("0x"+b.slice(g,v));break;default:F()}else{if(34==l)break;l=b.charCodeAt(v);for(g=v;32<=l&&92!=l&&34!=l;)l=b.charCodeAt(++v);f+=b.slice(g,v)}if(34==b.charCodeAt(v))return v++,f;F();default:g=v;45==l&&(h=!0,l=b.charCodeAt(++v));if(48<=l&&57>=l){for(48==l&&(l=b.charCodeAt(v+1),48<=l&&57>=l)&&F();v<e&&(l=b.charCodeAt(v),48<=l&&57>=l);v++);if(46==b.charCodeAt(v)){for(c=++v;c<e&&(l=b.charCodeAt(c),48<=l&&57>=l);c++);
c==v&&F();v=c}l=b.charCodeAt(v);if(101==l||69==l){l=b.charCodeAt(++v);43!=l&&45!=l||v++;for(c=v;c<e&&(l=b.charCodeAt(c),48<=l&&57>=l);c++);c==v&&F();v=c}return+b.slice(g,v)}h&&F();if("true"==b.slice(v,v+4))return v+=4,!0;if("false"==b.slice(v,v+5))return v+=5,!1;if("null"==b.slice(v,v+4))return v+=4,null;F()}return"$"},G=function(b){var e,f;"$"==b&&F();if("string"==typeof b){if("@"==(T?b.charAt(0):b[0]))return b.slice(1);if("["==b){for(e=[];;f||(f=!0)){b=H();if("]"==b)break;f&&(","==b?(b=H(),"]"==
b&&F()):F());","==b&&F();e.push(G(b))}return e}if("{"==b){for(e={};;f||(f=!0)){b=H();if("}"==b)break;f&&(","==b?(b=H(),"}"==b&&F()):F());","!=b&&"string"==typeof b&&"@"==(T?b.charAt(0):b[0])&&":"==H()||F();e[b.slice(1)]=G(H())}return e}F()}return b},C=function(b,e,f){f=D(b,e,f);f===t?delete b[e]:b[e]=f},D=function(b,e,f){var c=b[e],h;if("object"==typeof c&&c)if("[object Array]"==g.call(c))for(h=c.length;h--;)C(c,h,f);else r(c,function(b){C(c,b,f)});return f.call(b,e,c)};B.parse=function(b,e){var f;
v=0;A=""+b;b=G(H());"$"!=H()&&F();v=A=null;return e&&"[object Function]"==g.call(e)?D((f={},f[""]=b,f),"",e):b}}}})(this)},{}],35:[function(b,e,f){function g(b){var e=!0;b.getTracks().forEach(function(b){e="ended"===b.readyState&&e});return e}function c(){if("undefined"===typeof window||!window.navigator.mozGetUserMedia)return!1;var b=window.navigator.userAgent.match(/Firefox\/(\d+)\./);return 50>(b&&1<=b.length&&parseInt(b[1],10))}function l(b){E.call(this);var e=this.config={detectSpeakingEvents:!1,
audioFallback:!1,media:{audio:!0,video:!0},harkOptions:null,logger:B},f;for(f in b)b.hasOwnProperty(f)&&(this.config[f]=b[f]);this.logger=e.logger;this._log=this.logger.log.bind(this.logger,"LocalMedia:");this._logerror=this.logger.error.bind(this.logger,"LocalMedia:");this.localStreams=[];this.localScreens=[];navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||this._logerror("Your browser does not support local media capture.");this._audioMonitors=[];this.on("localStreamStopped",this._stopAudioMonitor.bind(this));
this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}f=b("util");var n=b("hark"),t=b("getscreenmedia"),E=b("wildemitter"),B=b("mockconsole");f.inherits(l,E);l.prototype.start=function(b,e){var f=this,c=b||this.config.media;this.emit("localStreamRequested",c);navigator.mediaDevices.getUserMedia(c).then(function(b){c.audio&&f.config.detectSpeakingEvents&&f._setupAudioMonitor(b,f.config.harkOptions);f.localStreams.push(b);b.getTracks().forEach(function(e){e.addEventListener("ended",function(){g(b)&&
f._removeStream(b)})});f.emit("localStream",b);if(e)return e(null,b)}).catch(function(b){if(f.config.audioFallback&&"NotFoundError"===b.name&&!1!==c.video)c.video=!1,f.start(c,e);else if(f.emit("localStreamRequestFailed",c),e)return e(b,null)})};l.prototype.stop=function(b){this.stopStream(b);this.stopScreenShare(b)};l.prototype.stopStream=function(b){var e=this;b?-1<this.localStreams.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),c()&&this._removeStream(b)):this.localStreams.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});
c()&&e._removeStream(b)})};l.prototype.startScreenShare=function(b,e){var f=this;this.emit("localScreenRequested");"function"!==typeof b||e||(e=b,b=null);t(b,function(b,g){b?f.emit("localScreenRequestFailed"):(f.localScreens.push(g),g.getTracks().forEach(function(b){b.addEventListener("ended",function(){var b=!0;g.getTracks().forEach(function(e){b="ended"===e.readyState&&b});b&&f._removeStream(g)})}),f.emit("localScreen",g));if(e)return e(b,g)})};l.prototype.stopScreenShare=function(b){var e=this;
b?-1<this.localScreens.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),c()&&this._removeStream(b)):this.localScreens.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});c()&&e._removeStream(b)})};l.prototype.mute=function(){this._audioEnabled(!1);this.emit("audioOff")};l.prototype.unmute=function(){this._audioEnabled(!0);this.emit("audioOn")};l.prototype.pauseVideo=function(){this._videoEnabled(!1);this.emit("videoOff")};l.prototype.resumeVideo=function(){this._videoEnabled(!0);
this.emit("videoOn")};l.prototype.pause=function(){this.mute();this.pauseVideo()};l.prototype.resume=function(){this.unmute();this.resumeVideo()};l.prototype._audioEnabled=function(b){this.localStreams.forEach(function(e){e.getAudioTracks().forEach(function(e){e.enabled=!!b})})};l.prototype._videoEnabled=function(b){this.localStreams.forEach(function(e){e.getVideoTracks().forEach(function(e){e.enabled=!!b})})};l.prototype.isAudioEnabled=function(){var b=!0;this.localStreams.forEach(function(e){e.getAudioTracks().forEach(function(e){b=
b&&e.enabled})});return b};l.prototype.isVideoEnabled=function(){var b=!0;this.localStreams.forEach(function(e){e.getVideoTracks().forEach(function(e){b=b&&e.enabled})});return b};l.prototype._removeStream=function(b){var e=this.localStreams.indexOf(b);-1<e?(this.localStreams.splice(e,1),this.emit("localStreamStopped",b)):(e=this.localScreens.indexOf(b),-1<e&&(this.localScreens.splice(e,1),this.emit("localScreenStopped",b)))};l.prototype._setupAudioMonitor=function(b,e){this._log("Setup audio");e=
n(b,e);var f=this,g;e.on("speaking",function(){f.emit("speaking")});e.on("stopped_speaking",function(){g&&clearTimeout(g);g=setTimeout(function(){f.emit("stoppedSpeaking")},1E3)});e.on("volume_change",function(b,e){f.emit("volumeChange",b,e)});this._audioMonitors.push({audio:e,stream:b})};l.prototype._stopAudioMonitor=function(b){var e=-1;this._audioMonitors.forEach(function(f,g){f.stream===b&&(e=g)});-1<e&&(this._audioMonitors[e].audio.stop(),this._audioMonitors.splice(e,1))};e.exports=l},{getscreenmedia:27,
hark:29,mockconsole:37,util:63,wildemitter:65}],36:[function(b,e,f){(function(b){function g(b,e){b.set(e[0],e[1]);return b}function c(b,e){b.add(e);return b}function n(b,e){for(var f=-1,g=b?b.length:0;++f<g&&!1!==e(b[f],f,b););return b}function t(b,e,f,g){var c=-1,h=b?b.length:0;for(g&&h&&(f=b[++c]);++c<h;)f=e(f,b[c],c,b);return f}function E(b){var e=!1;if(null!=b&&"function"!=typeof b.toString)try{e=!!(b+"")}catch(to){}return e}function B(b){var e=-1,f=Array(b.size);b.forEach(function(b,g){f[++e]=
[g,b]});return f}function q(b,e){return function(f){return b(e(f))}}function T(b){var e=-1,f=Array(b.size);b.forEach(function(b){f[++e]=b});return f}function K(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var g=b[e];this.set(g[0],g[1])}}function k(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var g=b[e];this.set(g[0],g[1])}}function m(b){var e=-1,f=b?b.length:0;for(this.clear();++e<f;){var g=b[e];this.set(g[0],g[1])}}function p(b){this.__data__=new k(b)}function r(b,e,f){var g=b[e];ba.call(b,
e)&&(g===f||g!==g&&f!==f)&&(void 0!==f||e in b)||(b[e]=f)}function u(b,e){for(var f=b.length;f--;){var g=b[f][0];if(g===e||g!==g&&e!==e)return f}return-1}function v(b,e){return b&&F(e,N(e),b)}function z(b,e,f,g,c,h,l){var t;g&&(t=h?g(b,c,h,l):g(b));if(void 0!==t)return t;if(!J(b))return b;if(c=va(b)){if(t=D(b),!e)return A(b,t)}else{var B=xa(b),q="[object Function]"==B||"[object GeneratorFunction]"==B;if(Da(b))return x(b,e);if("[object Object]"==B||"[object Arguments]"==B||q&&!h){if(E(b))return h?
b:{};t=I(q?{}:b);if(!e)return H(b,v(t,b))}else{if(!L[B])return h?b:{};t=O(b,B,z,e)}}l||(l=new p);if(h=l.get(b))return h;l.set(b,t);if(!c)var K=f?w(b,N,Ca):N(b);n(K||b,function(c,h){K&&(h=c,c=b[h]);r(t,h,z(c,e,f,g,h,b,l))});return t}function w(b,e,f){e=e(b);if(!va(b)){b=f(b);f=-1;for(var g=b.length,c=e.length;++f<g;)e[c+f]=b[f]}return e}function x(b,e){if(e)return b.slice();e=new b.constructor(b.length);b.copy(e);return e}function y(b){var e=new b.constructor(b.byteLength);(new ja(e)).set(new ja(b));
return e}function A(b,e){var f=-1,g=b.length;for(e||(e=Array(g));++f<g;)e[f]=b[f];return e}function F(b,e,f,g){f||(f={});for(var c=-1,h=e.length;++c<h;){var l=e[c],n=g?g(f[l],b[l],l,f,b):void 0;r(f,l,void 0===n?b[l]:n)}return f}function H(b,e){return F(b,Ca(b),e)}function G(b,e){b=b.__data__;var f=typeof e;return("string"==f||"number"==f||"symbol"==f||"boolean"==f?"__proto__"!==e:null===e)?b["string"==typeof e?"string":"hash"]:b.map}function C(b,e){b=null==b?void 0:b[e];e=!J(b)||ha&&ha in b?!1:(Q(b)||
E(b)?ia:aa).test(gd(b));return e?b:void 0}function D(b){var e=b.length,f=b.constructor(e);e&&"string"==typeof b[0]&&ba.call(b,"index")&&(f.index=b.index,f.input=b.input);return f}function I(b){"function"!=typeof b.constructor||ek(b)?b={}:(b=fa(b),b=J(b)?na(b):{});return b}function O(b,e,f,h){var l=b.constructor;switch(e){case "[object ArrayBuffer]":return y(b);case "[object Boolean]":case "[object Date]":return new l(+b);case "[object DataView]":return e=h?y(b.buffer):b.buffer,new b.constructor(e,
b.byteOffset,b.byteLength);case "[object Float32Array]":case "[object Float64Array]":case "[object Int8Array]":case "[object Int16Array]":case "[object Int32Array]":case "[object Uint8Array]":case "[object Uint8ClampedArray]":case "[object Uint16Array]":case "[object Uint32Array]":return e=h?y(b.buffer):b.buffer,new b.constructor(e,b.byteOffset,b.length);case "[object Map]":return e=h?f(B(b),!0):B(b),t(e,g,new b.constructor);case "[object Number]":case "[object String]":return new l(b);case "[object RegExp]":return e=
new b.constructor(b.source,R.exec(b)),e.lastIndex=b.lastIndex,e;case "[object Set]":return e=h?f(T(b),!0):T(b),t(e,c,new b.constructor);case "[object Symbol]":return ta?Object(ta.call(b)):{}}}function ek(b){var e=b&&b.constructor;return b===("function"==typeof e&&e.prototype||W)}function gd(b){if(null!=b){try{return ea.call(b)}catch(so){}return b+""}return""}function fk(b){var e;if(e=null!=b)e=b.length,e="number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e;return e&&!Q(b)}function Q(b){b=J(b)?X.call(b):
"";return"[object Function]"==b||"[object GeneratorFunction]"==b}function J(b){var e=typeof b;return!!b&&("object"==e||"function"==e)}function N(b){if(fk(b)){var e;(e=va(b))||(e=!!b&&"object"==typeof b&&fk(b)&&ba.call(b,"callee")&&(!ma.call(b,"callee")||"[object Arguments]"==X.call(b)));if(e){e=b.length;for(var f=String,g=-1,c=Array(e);++g<e;)c[g]=f(g);e=c}else e=[];f=e.length;g=!!f;for(var h in b){if(!(c=!ba.call(b,h))&&(c=g)&&!(c="length"==h)){c=h;var l=f;l=null==l?9007199254740991:l;c=!!l&&("number"==
typeof c||Z.test(c))&&-1<c&&0==c%1&&c<l}c||e.push(h)}b=e}else if(ek(b)){h=[];for(e in Object(b))ba.call(b,e)&&"constructor"!=e&&h.push(e);b=h}else b=S(b);return b}function P(){return[]}function U(){return!1}var R=/\w*$/,aa=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,L={};L["[object Arguments]"]=L["[object Array]"]=L["[object ArrayBuffer]"]=L["[object DataView]"]=L["[object Boolean]"]=L["[object Date]"]=L["[object Float32Array]"]=L["[object Float64Array]"]=L["[object Int8Array]"]=L["[object Int16Array]"]=
L["[object Int32Array]"]=L["[object Map]"]=L["[object Number]"]=L["[object Object]"]=L["[object RegExp]"]=L["[object Set]"]=L["[object String]"]=L["[object Symbol]"]=L["[object Uint8Array]"]=L["[object Uint8ClampedArray]"]=L["[object Uint16Array]"]=L["[object Uint32Array]"]=!0;L["[object Error]"]=L["[object Function]"]=L["[object WeakMap]"]=!1;var V="object"==typeof self&&self&&self.Object===Object&&self;b="object"==typeof b&&b&&b.Object===Object&&b||V||Function("return this")();var Y=(V="object"==
typeof f&&f&&!f.nodeType&&f)&&"object"==typeof e&&e&&!e.nodeType&&e;V=Y&&Y.exports===V;Y=Array.prototype;var da=Function.prototype,W=Object.prototype,M=b["__core-js_shared__"],ha=function(){var b=/[^.]+$/.exec(M&&M.keys&&M.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),ea=da.toString,ba=W.hasOwnProperty,X=W.toString,ia=RegExp("^"+ea.call(ba).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");da=V?b.Buffer:void 0;V=b.Symbol;var ja=
b.Uint8Array,fa=q(Object.getPrototypeOf,Object),na=Object.create,ma=W.propertyIsEnumerable,qa=Y.splice;Y=Object.getOwnPropertySymbols;da=da?da.isBuffer:void 0;var S=q(Object.keys,Object),ka=C(b,"DataView"),la=C(b,"Map"),oa=C(b,"Promise"),pa=C(b,"Set");b=C(b,"WeakMap");var ca=C(Object,"create"),wa=gd(ka),ra=gd(la),Ba=gd(oa),za=gd(pa),sa=gd(b),ta=(V=V?V.prototype:void 0)?V.valueOf:void 0;K.prototype.clear=function(){this.__data__=ca?ca(null):{}};K.prototype["delete"]=function(b){return this.has(b)&&
delete this.__data__[b]};K.prototype.get=function(b){var e=this.__data__;return ca?(b=e[b],"__lodash_hash_undefined__"===b?void 0:b):ba.call(e,b)?e[b]:void 0};K.prototype.has=function(b){var e=this.__data__;return ca?void 0!==e[b]:ba.call(e,b)};K.prototype.set=function(b,e){this.__data__[b]=ca&&void 0===e?"__lodash_hash_undefined__":e;return this};k.prototype.clear=function(){this.__data__=[]};k.prototype["delete"]=function(b){var e=this.__data__;b=u(e,b);if(0>b)return!1;b==e.length-1?e.pop():qa.call(e,
b,1);return!0};k.prototype.get=function(b){var e=this.__data__;b=u(e,b);return 0>b?void 0:e[b][1]};k.prototype.has=function(b){return-1<u(this.__data__,b)};k.prototype.set=function(b,e){var f=this.__data__,g=u(f,b);0>g?f.push([b,e]):f[g][1]=e;return this};m.prototype.clear=function(){this.__data__={hash:new K,map:new (la||k),string:new K}};m.prototype["delete"]=function(b){return G(this,b)["delete"](b)};m.prototype.get=function(b){return G(this,b).get(b)};m.prototype.has=function(b){return G(this,
b).has(b)};m.prototype.set=function(b,e){G(this,b).set(b,e);return this};p.prototype.clear=function(){this.__data__=new k};p.prototype["delete"]=function(b){return this.__data__["delete"](b)};p.prototype.get=function(b){return this.__data__.get(b)};p.prototype.has=function(b){return this.__data__.has(b)};p.prototype.set=function(b,e){var f=this.__data__;if(f instanceof k){f=f.__data__;if(!la||199>f.length)return f.push([b,e]),this;f=this.__data__=new m(f)}f.set(b,e);return this};var Ca=Y?q(Y,Object):
P,xa=function(b){return X.call(b)};if(ka&&"[object DataView]"!=xa(new ka(new ArrayBuffer(1)))||la&&"[object Map]"!=xa(new la)||oa&&"[object Promise]"!=xa(oa.resolve())||pa&&"[object Set]"!=xa(new pa)||b&&"[object WeakMap]"!=xa(new b))xa=function(b){var e=X.call(b);if(b=(b="[object Object]"==e?b.constructor:void 0)?gd(b):void 0)switch(b){case wa:return"[object DataView]";case ra:return"[object Map]";case Ba:return"[object Promise]";case za:return"[object Set]";case sa:return"[object WeakMap]"}return e};
var va=Array.isArray,Da=da||U;e.exports=function(b){return z(b,!0,!0)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],37:[function(b,e,f){b="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profileEnd time timeEnd trace warn".split(" ");f=b.length;for(var g=function(){},c={};f--;)c[b[f]]=g;e.exports=c},{}],38:[function(b,e,f){function g(b){if(b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(b)){var e=
parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case "years":case "year":case "y":return e*l;case "days":case "day":case "d":return 864E5*e;case "hours":case "hour":case "h":return 36E5*e;case "minutes":case "minute":case "m":return 6E4*e;case "seconds":case "second":case "s":return 1E3*e;case "ms":return e}}}function c(b,e,f){if(!(b<e))return b<1.5*e?Math.floor(b/e)+" "+f:Math.ceil(b/e)+" "+f+"s"}var l=315576E5;e.exports=function(b,e){e=e||{};return"string"==typeof b?g(b):e.long?c(b,864E5,"day")||
c(b,36E5,"hour")||c(b,6E4,"minute")||c(b,1E3,"second")||b+" ms":864E5<=b?Math.round(b/864E5)+"d":36E5<=b?Math.round(b/36E5)+"h":6E4<=b?Math.round(b/6E4)+"m":1E3<=b?Math.round(b/1E3)+"s":b+"ms"}},{}],39:[function(b,e,f){var g=Object.prototype.hasOwnProperty;f.keys=Object.keys||function(b){var e=[],f;for(f in b)g.call(b,f)&&e.push(f);return e};f.values=function(b){var e=[],f;for(f in b)g.call(b,f)&&e.push(b[f]);return e};f.merge=function(b,e){for(var f in e)g.call(e,f)&&(b[f]=e[f]);return b};f.length=
function(b){return f.keys(b).length};f.isEmpty=function(b){return 0==f.length(b)}},{}],40:[function(b,e,f){(function(b){var f=/^[\],:{}\s]*$/,g=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,c=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,t=/(?:^|:|,)(?:\s*\[)+/g,E=/^\s+/,B=/\s+$/;e.exports=function(e){if("string"!=typeof e||!e)return null;e=e.replace(E,"").replace(B,"");if(b.JSON&&JSON.parse)return JSON.parse(e);if(f.test(e.replace(g,"@").replace(c,"]").replace(t,"")))return(new Function("return "+
e))()}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],41:[function(b,e,f){f.encode=function(b){var e="",f;for(f in b)b.hasOwnProperty(f)&&(e.length&&(e+="&"),e+=encodeURIComponent(f)+"="+encodeURIComponent(b[f]));return e};f.decode=function(b){var e={};b=b.split("&");for(var f=0,g=b.length;f<g;f++){var c=b[f].split("=");e[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}return e}},{}],42:[function(b,e,f){var g=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
c="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");e.exports=function(b){b=g.exec(b||"");for(var e={},f=14;f--;)e[c[f]]=b[f]||"";return e}},{}],43:[function(b,e,f){function g(){throw Error("setTimeout has not been defined");}function c(){throw Error("clearTimeout has not been defined");}function l(b){if(T===setTimeout)return setTimeout(b,0);if((T===g||!T)&&setTimeout)return T=setTimeout,setTimeout(b,0);try{return T(b,0)}catch(Em){try{return T.call(null,
b,0)}catch(Fm){return T.call(this,b,0)}}}function n(b){if(K===clearTimeout)return clearTimeout(b);if((K===c||!K)&&clearTimeout)return K=clearTimeout,clearTimeout(b);try{return K(b)}catch(Em){try{return K.call(null,b)}catch(Fm){return K.call(this,b)}}}function t(){m&&p&&(m=!1,p.length?k=p.concat(k):r=-1,k.length&&E())}function E(){if(!m){var b=l(t);m=!0;for(var e=k.length;e;){p=k;for(k=[];++r<e;)p&&p[r].run();r=-1;e=k.length}p=null;m=!1;n(b)}}function B(b,e){this.fun=b;this.array=e}function q(){}b=
e.exports={};try{var T="function"===typeof setTimeout?setTimeout:g}catch(La){T=g}try{var K="function"===typeof clearTimeout?clearTimeout:c}catch(La){K=c}var k=[],m=!1,p,r=-1;b.nextTick=function(b){var e=Array(arguments.length-1);if(1<arguments.length)for(var f=1;f<arguments.length;f++)e[f-1]=arguments[f];k.push(new B(b,e));1!==k.length||m||l(E)};B.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=q;b.addListener=
q;b.once=q;b.off=q;b.removeListener=q;b.removeAllListeners=q;b.emit=q;b.prependListener=q;b.prependOnceListener=q;b.listeners=function(b){return[]};b.binding=function(b){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(b){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}],44:[function(b,e,f){function g(b,e){var f=this,g;l.call(this);b=b||{};b.iceServers=b.iceServers||[];this.enableChromeNativeSimulcast=!1;e&&e.optional&&
window.chrome&&null===navigator.appVersion.match(/Chromium\//)&&e.optional.forEach(function(b){b.enableChromeNativeSimulcast&&(f.enableChromeNativeSimulcast=!0)});this.enableMultiStreamHacks=!1;e&&e.optional&&window.chrome&&e.optional.forEach(function(b){b.enableMultiStreamHacks&&(f.enableMultiStreamHacks=!0)});this.restrictBandwidth=0;e&&e.optional&&e.optional.forEach(function(b){b.andyetRestrictBandwidth&&(f.restrictBandwidth=b.andyetRestrictBandwidth)});this.batchIceCandidates=0;e&&e.optional&&
e.optional.forEach(function(b){b.andyetBatchIce&&(f.batchIceCandidates=b.andyetBatchIce)});this.batchedIceCandidates=[];e&&e.optional&&window.chrome&&e.optional.forEach(function(b){b.andyetFasterICE&&(f.eliminateDuplicateCandidates=b.andyetFasterICE)});e&&e.optional&&e.optional.forEach(function(b){b.andyetDontSignalCandidates&&(f.dontSignalCandidates=b.andyetDontSignalCandidates)});this.assumeSetLocalSuccess=!1;e&&e.optional&&e.optional.forEach(function(b){b.andyetAssumeSetLocalSuccess&&(f.assumeSetLocalSuccess=
b.andyetAssumeSetLocalSuccess)});window.navigator.mozGetUserMedia&&e&&e.optional&&(this.wtFirefox=0,e.optional.forEach(function(b){b.andyetFirefoxMakesMeSad&&(f.wtFirefox=b.andyetFirefoxMakesMeSad,0<f.wtFirefox&&(f.firefoxcandidatebuffer=[]))}));this.pc=new RTCPeerConnection(b,e);this.getLocalStreams="function"===typeof this.pc.getLocalStreams?this.pc.getLocalStreams.bind(this.pc):function(){return[]};this.getSenders="function"===typeof this.pc.getSenders?this.pc.getSenders.bind(this.pc):function(){return[]};
this.getRemoteStreams="function"===typeof this.pc.getRemoteStreams?this.pc.getRemoteStreams.bind(this.pc):function(){return[]};this.getReceivers="function"===typeof this.pc.getReceivers?this.pc.getReceivers.bind(this.pc):function(){return[]};this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=function(b){"function"===typeof f.pc.removeStream?f.pc.removeStream.apply(f.pc,arguments):"function"===typeof f.pc.removeTrack&&b.getTracks().forEach(function(b){f.pc.removeTrack(b)})};"function"===
typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc));this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onremovetrack=this.emit.bind(this,"removeTrack");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);
this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:!1,sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};this.iceCredentials={local:{},remote:{}};for(g in b)this.config[g]=b[g];if(this.config.debug)this.on("*",function(){(b.logger||console).log("PeerConnection event:",arguments)});this.hadRemoteIPv6Candidate=this.hadLocalIPv6Candidate=this.hadRemoteRelayCandidate=this.hadLocalRelayCandidate=this.hadRemoteStunCandidate=
this.hadLocalStunCandidate=!1;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}f=b("util");var c=b("sdp-jingle-json"),l=b("wildemitter"),n=b("lodash.clonedeep");f.inherits(g,l);Object.defineProperty(g.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(g.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});g.prototype._role=function(){return this.isInitiator?"initiator":"responder"};g.prototype.addStream=
function(b){this.localStream=b;this.pc.addStream(b)};g.prototype._checkLocalCandidate=function(b){b=c.toCandidateJSON(b);"srflx"==b.type?this.hadLocalStunCandidate=!0:"relay"==b.type&&(this.hadLocalRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)};g.prototype._checkRemoteCandidate=function(b){b=c.toCandidateJSON(b);"srflx"==b.type?this.hadRemoteStunCandidate=!0:"relay"==b.type&&(this.hadRemoteRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)};g.prototype.processIce=
function(b,e){e=e||function(){};var f=this;if("closed"===this.pc.signalingState)return e();if(b.contents||b.jingle&&b.jingle.contents){var g=this.remoteDescription.contents.map(function(b){return b.name});(b.contents||b.jingle.contents).forEach(function(b){var h=b.transport||{},l=h.candidates||[],n=g.indexOf(b.name),t=b.name,B=f.remoteDescription.contents.find(function(e){return e.name===b.name}),q=function(){l.forEach(function(b){b=c.toCandidateSDP(b);f.pc.addIceCandidate(new RTCIceCandidate({candidate:b,
sdpMLineIndex:n,sdpMid:t}),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b)});e()};f.iceCredentials.remote[b.name]&&h.ufrag&&f.iceCredentials.remote[b.name].ufrag!==h.ufrag?B?(B.transport.ufrag=h.ufrag,B.transport.pwd=h.pwd,h={type:"offer",jingle:f.remoteDescription},h.sdp=c.toSessionSDP(h.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"}),f.pc.setRemoteDescription(new RTCSessionDescription(h),function(){q()},function(b){f.emit("error",b)})):f.emit("error",
"ice restart failed to find matching content"):q()})}else{b.candidate&&0!==b.candidate.candidate.indexOf("a=")&&(b.candidate.candidate="a="+b.candidate.candidate);if(this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(b.candidate),e();f.pc.addIceCandidate(new RTCIceCandidate(b.candidate),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b.candidate.candidate);e()}};g.prototype.offer=
function(b,e){var f=this,g=2===arguments.length,h=g&&b?b:{offerToReceiveAudio:1,offerToReceiveVideo:1};e=(e=g?e:b)||function(){};if("closed"===this.pc.signalingState)return e("Already closed");this.pc.createOffer(function(b){var g={type:"offer",sdp:b.sdp};f.assumeSetLocalSuccess&&(f.emit("offer",g),e(null,g));f._candidateBuffer=[];f.pc.setLocalDescription(b,function(){if(f.config.useJingle){var h=c.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"});h.sid=f.config.sid;f.localDescription=h;
h.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.local[b.name]={ufrag:e.ufrag,pwd:e.pwd})});g.jingle=h}g.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkLocalCandidate(b)});f.assumeSetLocalSuccess||(f.emit("offer",g),e(null,g))},function(b){f.emit("error",b);e(b)})},function(b){f.emit("error",b);e(b)},h)};g.prototype.handleOffer=function(b,e){e=e||function(){};var f=this;b.type="offer";if(b.jingle){this.enableChromeNativeSimulcast&&b.jingle.contents.forEach(function(b){"video"===
b.name&&(b.application.googConferenceFlag=!0)});this.enableMultiStreamHacks&&b.jingle.contents.forEach(function(b){if("video"===b.name){var e=b.application.sources||[];if(0===e.length||"3735928559"!==e[0].ssrc)e.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),b.application.sources=e}});if(0<f.restrictBandwidth&&2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name){var g=b.jingle.contents[1];g.application&&g.application.bandwidth&&
g.application.bandwidth.bandwidth||(b.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:f.restrictBandwidth.toString()},b.sdp=c.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"outgoing"}))}b.jingle.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.remote[b.name]={ufrag:e.ufrag,pwd:e.pwd})});b.sdp=c.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"});f.remoteDescription=b.jingle}b.sdp.split("\r\n").forEach(function(b){0===
b.indexOf("a=candidate:")&&f._checkRemoteCandidate(b)});f.pc.setRemoteDescription(new RTCSessionDescription(b),function(){e()},e)};g.prototype.answerAudioOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},b)};g.prototype.answerBroadcastOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},b)};g.prototype.answer=function(b,e){var f=2===arguments.length;this._answer(f&&b?b:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},
f?e:b)};g.prototype.handleAnswer=function(b,e){e=e||function(){};var f=this;b.jingle&&(b.sdp=c.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),direction:"incoming"}),f.remoteDescription=b.jingle,b.jingle.contents.forEach(function(b){var e=b.transport||{};e.ufrag&&(f.iceCredentials.remote[b.name]={ufrag:e.ufrag,pwd:e.pwd})}));b.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkRemoteCandidate(b)});f.pc.setRemoteDescription(new RTCSessionDescription(b),function(){f.wtFirefox&&
window.setTimeout(function(){f.firefoxcandidatebuffer.forEach(function(b){f.pc.addIceCandidate(new RTCIceCandidate(b),function(){},function(b){f.emit("error",b)});f._checkRemoteCandidate(b.candidate)});f.firefoxcandidatebuffer=null},f.wtFirefox);e(null)},e)};g.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};g.prototype._answer=function(b,e){e=e||function(){};var f=this;if(!this.pc.remoteDescription)throw Error("remoteDescription not set");
if("closed"===this.pc.signalingState)return e("Already closed");f.pc.createAnswer(function(b){var g=[];if(f.enableChromeNativeSimulcast&&(b.jingle=c.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"}),2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name)){var h=b.jingle.contents[1].application.sourceGroups||[],l=!1;h.forEach(function(b){"SIM"==b.semantics&&(l=!0)});if(!l&&b.jingle.contents[1].application.sources.length){var t=JSON.parse(JSON.stringify(b.jingle.contents[1].application.sources[0]));
t.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(t);g.push(b.jingle.contents[1].application.sources[0].ssrc);g.push(t.ssrc);h.push({semantics:"SIM",sources:g});g=JSON.parse(JSON.stringify(t));g.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(g);h.push({semantics:"FID",sources:[t.ssrc,g.ssrc]});b.jingle.contents[1].application.sourceGroups=h;b.sdp=c.toSessionSDP(b.jingle,{sid:f.config.sdpSessionID,role:f._role(),
direction:"outgoing"})}}var q={type:"answer",sdp:b.sdp};f.assumeSetLocalSuccess&&(h=n(q),f.emit("answer",h),e(null,h));f._candidateBuffer=[];f.pc.setLocalDescription(b,function(){if(f.config.useJingle){var g=c.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"});g.sid=f.config.sid;f.localDescription=g;q.jingle=g}f.enableChromeNativeSimulcast&&(q.jingle||(q.jingle=c.toSessionJSON(b.sdp,{role:f._role(),direction:"outgoing"})),q.jingle.contents[1].application.sources.forEach(function(b,e){b.parameters=
b.parameters.map(function(b){"msid"===b.key&&(b.value+="-"+Math.floor(e/2));return b})}),q.sdp=c.toSessionSDP(q.jingle,{sid:f.sdpSessionID,role:f._role(),direction:"outgoing"}));q.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&f._checkLocalCandidate(b)});f.assumeSetLocalSuccess||(g=n(q),f.emit("answer",g),e(null,g))},function(b){f.emit("error",b);e(b)})},function(b){f.emit("error",b);e(b)},b)};g.prototype._onIce=function(b){var e=this;if(b.candidate){if(!this.dontSignalCandidates){b=
b.candidate;var f={candidate:{candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex}};this._checkLocalCandidate(b.candidate);var g=c.toCandidateJSON(b.candidate);if(this.eliminateDuplicateCandidates&&"relay"===g.type){var h=this._candidateBuffer.filter(function(b){return"relay"===b.type}).map(function(b){return b.foundation+":"+b.component});var l=h.indexOf(g.foundation+":"+g.component);if(-1<l&&g.priority>>24>=h[l].priority>>24)return}if("max-bundle"===this.config.bundlePolicy&&(h=
this._candidateBuffer.filter(function(b){return g.type===b.type}).map(function(b){return b.address+":"+b.port}),l=h.indexOf(g.address+":"+g.port),-1<l))return;if("require"!==this.config.rtcpMuxPolicy||"2"!==g.component){this._candidateBuffer.push(g);if(e.config.useJingle&&(b.sdpMid||(b.sdpMid=e.pc.remoteDescription&&"offer"===e.pc.remoteDescription.type?e.remoteDescription.contents[b.sdpMLineIndex].name:e.localDescription.contents[b.sdpMLineIndex].name),e.iceCredentials.local[b.sdpMid]||c.toSessionJSON(e.pc.localDescription.sdp,
{role:e._role(),direction:"outgoing"}).contents.forEach(function(b){var f=b.transport||{};f.ufrag&&(e.iceCredentials.local[b.name]={ufrag:f.ufrag,pwd:f.pwd})}),f.jingle={contents:[{name:b.sdpMid,creator:e._role(),transport:{transportType:"iceUdp",ufrag:e.iceCredentials.local[b.sdpMid].ufrag,pwd:e.iceCredentials.local[b.sdpMid].pwd,candidates:[g]}}]},0<e.batchIceCandidates)){0===e.batchedIceCandidates.length&&window.setTimeout(function(){var b={};e.batchedIceCandidates.forEach(function(e){e=e.contents[0];
b[e.name]||(b[e.name]=e);b[e.name].transport.candidates.push(e.transport.candidates[0])});var f={jingle:{contents:[]}};Object.keys(b).forEach(function(e){f.jingle.contents.push(b[e])});e.batchedIceCandidates=[];e.emit("ice",f)},e.batchIceCandidates);e.batchedIceCandidates.push(f.jingle);return}this.emit("ice",f)}}}else this.emit("endOfCandidates")};g.prototype._onDataChannel=function(b){b=b.channel;this._remoteDataChannels.push(b);this.emit("addChannel",b)};g.prototype.createDataChannel=function(b,
e){b=this.pc.createDataChannel(b,e);this._localDataChannels.push(b);return b};g.prototype.getStats=function(){if("function"===typeof arguments[0]){var b=arguments[0];this.pc.getStats().then(function(e){b(null,e)},function(e){b(e)})}else return this.pc.getStats.apply(this.pc,arguments)};e.exports=g},{"lodash.clonedeep":36,"sdp-jingle-json":45,util:63,wildemitter:65}],45:[function(b,e,f){var g=b("./lib/tosdp"),c=b("./lib/tojson");f.toIncomingSDPOffer=function(b){return g.toSessionSDP(b,{role:"responder",
direction:"incoming"})};f.toOutgoingSDPOffer=function(b){return g.toSessionSDP(b,{role:"initiator",direction:"outgoing"})};f.toIncomingSDPAnswer=function(b){return g.toSessionSDP(b,{role:"initiator",direction:"incoming"})};f.toOutgoingSDPAnswer=function(b){return g.toSessionSDP(b,{role:"responder",direction:"outgoing"})};f.toIncomingMediaSDPOffer=function(b){return g.toMediaSDP(b,{role:"responder",direction:"incoming"})};f.toOutgoingMediaSDPOffer=function(b){return g.toMediaSDP(b,{role:"initiator",
direction:"outgoing"})};f.toIncomingMediaSDPAnswer=function(b){return g.toMediaSDP(b,{role:"initiator",direction:"incoming"})};f.toOutgoingMediaSDPAnswer=function(b){return g.toMediaSDP(b,{role:"responder",direction:"outgoing"})};f.toCandidateSDP=g.toCandidateSDP;f.toMediaSDP=g.toMediaSDP;f.toSessionSDP=g.toSessionSDP;f.toIncomingJSONOffer=function(b,e){return c.toSessionJSON(b,{role:"responder",direction:"incoming",creators:e})};f.toOutgoingJSONOffer=function(b,e){return c.toSessionJSON(b,{role:"initiator",
direction:"outgoing",creators:e})};f.toIncomingJSONAnswer=function(b,e){return c.toSessionJSON(b,{role:"initiator",direction:"incoming",creators:e})};f.toOutgoingJSONAnswer=function(b,e){return c.toSessionJSON(b,{role:"responder",direction:"outgoing",creators:e})};f.toIncomingMediaJSONOffer=function(b,e){return c.toMediaJSON(b,{role:"responder",direction:"incoming",creator:e})};f.toOutgoingMediaJSONOffer=function(b,e){return c.toMediaJSON(b,{role:"initiator",direction:"outgoing",creator:e})};f.toIncomingMediaJSONAnswer=
function(b,e){return c.toMediaJSON(b,{role:"initiator",direction:"incoming",creator:e})};f.toOutgoingMediaJSONAnswer=function(b,e){return c.toMediaJSON(b,{role:"responder",direction:"outgoing",creator:e})};f.toCandidateJSON=c.toCandidateJSON;f.toMediaJSON=c.toMediaJSON;f.toSessionJSON=c.toSessionJSON},{"./lib/tojson":48,"./lib/tosdp":49}],46:[function(b,e,f){f.lines=function(b){return b.split("\r\n").filter(function(b){return 0<b.length})};f.findLine=function(b,e,f){for(var g=b.length,c=0;c<e.length;c++)if(e[c].substr(0,
g)===b)return e[c];if(!f)return!1;for(e=0;e<f.length;e++)if(f[e].substr(0,g)===b)return f[e];return!1};f.findLines=function(b,e,f){for(var g=[],c=b.length,h=0;h<e.length;h++)e[h].substr(0,c)===b&&g.push(e[h]);if(g.length||!f)return g;for(e=0;e<f.length;e++)f[e].substr(0,c)===b&&g.push(f[e]);return g};f.mline=function(b){b=b.substr(2).split(" ");for(var e={media:b[0],port:b[1],proto:b[2],formats:[]},f=3;f<b.length;f++)b[f]&&e.formats.push(b[f]);return e};f.rtpmap=function(b){b=b.substr(9).split(" ");
var e={id:b.shift()};b=b[0].split("/");e.name=b[0];e.clockrate=b[1];e.channels=3==b.length?b[2]:"1";return e};f.sctpmap=function(b){b=b.substr(10).split(" ");return{number:b.shift(),protocol:b.shift(),streams:b.shift()}};f.fmtp=function(b){for(var e,f=b.substr(b.indexOf(" ")+1).split(";"),g=[],c=0;c<f.length;c++)e=f[c].split("="),b=e[0].trim(),e=e[1],b&&e?g.push({key:b,value:e}):b&&g.push({key:"",value:b});return g};f.crypto=function(b){b=b.substr(9).split(" ");return{tag:b[0],cipherSuite:b[1],keyParams:b[2],
sessionParams:b.slice(3).join(" ")}};f.fingerprint=function(b){b=b.substr(14).split(" ");return{hash:b[0],value:b[1]}};f.extmap=function(b){b=b.substr(9).split(" ");var e={},f=b.shift(),g=f.indexOf("/");0<=g?(e.id=f.substr(0,g),e.senders=f.substr(g+1)):(e.id=f,e.senders="sendrecv");e.uri=b.shift()||"";return e};f.rtcpfb=function(b){b=b.substr(10).split(" ");var e={};e.id=b.shift();e.type=b.shift();"trr-int"===e.type?e.value=b.shift():e.subtype=b.shift()||"";e.parameters=b;return e};f.candidate=function(b){b=
0===b.indexOf("a=candidate:")?b.substring(12).split(" "):b.substring(10).split(" ");for(var e={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:b[3],ip:b[4],port:b[5],type:b[7],generation:"0"},f=8;f<b.length;f+=2)"raddr"===b[f]?e.relAddr=b[f+1]:"rport"===b[f]?e.relPort=b[f+1]:"generation"===b[f]?e.generation=b[f+1]:"tcptype"===b[f]&&(e.tcpType=b[f+1]);e.network="1";return e};f.sourceGroups=function(b){for(var e=[],f=0;f<b.length;f++){var c=b[f].substr(13).split(" ");e.push({semantics:c.shift(),
sources:c})}return e};f.sources=function(b){for(var e=[],f={},c=0;c<b.length;c++){var g=b[c].substr(7).split(" "),E=g.shift();if(!f[E]){var B={ssrc:E,parameters:[]};e.push(B);f[E]=B}g=g.join(" ").split(":");B=g.shift();g=g.join(":")||null;f[E].parameters.push({key:B,value:g})}return e};f.groups=function(b){for(var e=[],f,c=0;c<b.length;c++)f=b[c].substr(8).split(" "),e.push({semantics:f.shift(),contents:f});return e};f.bandwidth=function(b){b=b.substr(2).split(":");var e={};e.type=b.shift();e.bandwidth=
b.shift();return e};f.msid=function(b){b=b.substr(7);var e=b.split(" ");return{msid:b,mslabel:e[0],label:e[1]}}},{}],47:[function(b,e,f){e.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",
responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],48:[function(b,e,f){var c=b("./senders"),h=b("./parsers"),l=Math.random();f._setIdCounter=function(b){l=b};f.toSessionJSON=function(b,e){var c,g=e.creators||[],l=e.role||"initiator";e=e.direction||"outgoing";
var n=b.split("\r\nm=");for(c=1;c<n.length;c++)n[c]="m="+n[c],c!==n.length-1&&(n[c]+="\r\n");var t=n.shift()+"\r\n",k=h.lines(t);b={};var m=[];for(c=0;c<n.length;c++)m.push(f.toMediaJSON(n[c],t,{role:l,direction:e,creator:g[c]||"initiator"}));b.contents=m;g=h.findLines("a=group:",k);g.length&&(b.groups=h.groups(g));return b};f.toMediaJSON=function(b,e,g){var l=g.creator||"initiator",n=g.role||"initiator",t=g.direction||"outgoing",E=h.lines(b);b=h.lines(e);e=h.mline(E[0]);l={creator:l,name:e.media,
application:{applicationType:"rtp",media:e.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==e.media&&(l.application={applicationType:"datachannel"},l.transport.sctp=[]);var k=l.application,m=l.transport;if(e=h.findLine("a=mid:",E))l.name=e.substr(6);h.findLine("a=sendrecv",E,b)?l.senders="both":h.findLine("a=sendonly",E,b)?l.senders=c[n][t].sendonly:h.findLine("a=recvonly",E,b)?l.senders=c[n][t].recvonly:
h.findLine("a=inactive",E,b)&&(l.senders="none");if("rtp"==k.applicationType){if(e=h.findLine("b=",E))k.bandwidth=h.bandwidth(e);if(e=h.findLine("a=ssrc:",E))k.ssrc=e.substr(7).split(" ")[0];h.findLines("a=rtpmap:",E).forEach(function(b){var e=h.rtpmap(b);e.parameters=[];e.feedback=[];h.findLines("a=fmtp:"+e.id,E).forEach(function(b){e.parameters=h.fmtp(b)});h.findLines("a=rtcp-fb:"+e.id,E).forEach(function(b){e.feedback.push(h.rtcpfb(b))});k.payloads.push(e)});h.findLines("a=crypto:",E,b).forEach(function(b){k.encryption.push(h.crypto(b))});
h.findLine("a=rtcp-mux",E)&&(k.mux=!0);h.findLines("a=rtcp-fb:*",E).forEach(function(b){k.feedback.push(h.rtcpfb(b))});h.findLines("a=extmap:",E).forEach(function(b){b=h.extmap(b);b.senders=c[n][t][b.senders];k.headerExtensions.push(b)});e=h.findLines("a=ssrc-group:",E);k.sourceGroups=h.sourceGroups(e||[]);e=h.findLines("a=ssrc:",E);var p=k.sources=h.sources(e||[]);if(e=h.findLine("a=msid:",E)){var r=h.msid(e);["msid","mslabel","label"].forEach(function(b){for(var e=0;e<p.length;e++){for(var f=!1,
c=0;c<p[e].parameters.length;c++)p[e].parameters[c].key===b&&(f=!0);f||p[e].parameters.push({key:b,value:r[b]})}})}h.findLine("a=x-google-flag:conference",E,b)&&(k.googConferenceFlag=!0)}e=h.findLines("a=fingerprint:",E,b);var u=h.findLine("a=setup:",E,b);e.forEach(function(b){b=h.fingerprint(b);u&&(b.setup=u.substr(8));m.fingerprints.push(b)});e=h.findLine("a=ice-ufrag:",E,b);g=h.findLine("a=ice-pwd:",E,b);e&&g&&(m.ufrag=e.substr(12),m.pwd=g.substr(10),m.candidates=[],h.findLines("a=candidate:",
E,b).forEach(function(b){m.candidates.push(f.toCandidateJSON(b))}));"datachannel"==k.applicationType&&h.findLines("a=sctpmap:",E).forEach(function(b){b=h.sctpmap(b);m.sctp.push(b)});return l};f.toCandidateJSON=function(b){b=h.candidate(b.split("\r\n")[0]);b.id=(l++).toString(36).substr(0,12);return b}},{"./parsers":46,"./senders":47}],49:[function(b,e,f){var c=b("./senders");f.toSessionSDP=function(b,e){var c=e.sid||b.sid||Date.now(),g=e.time||Date.now(),h=["v=0","o=- "+c+" "+g+" IN IP4 0.0.0.0",
"s=-","t=0 0"];c=b.contents||[];var l=!1;c.forEach(function(b){b.application.sources&&b.application.sources.length&&(l=!0)});l&&h.push("a=msid-semantic: WMS *");(b.groups||[]).forEach(function(b){h.push("a=group:"+b.semantics+" "+b.contents.join(" "))});c.forEach(function(b){h.push(f.toMediaSDP(b,e))});return h.join("\r\n")+"\r\n"};f.toMediaSDP=function(b,e){var g=[],h=e.role||"initiator",l=e.direction||"outgoing",B=b.application;e=b.transport;var q=B.payloads||[],k=e&&e.fingerprints||[],K=[];"datachannel"==
B.applicationType?(K.push("application"),K.push("1"),K.push("DTLS/SCTP"),e.sctp&&e.sctp.forEach(function(b){K.push(b.number)})):(K.push(B.media),K.push("1"),0<k.length?K.push("UDP/TLS/RTP/SAVPF"):B.encryption&&0<B.encryption.length?K.push("RTP/SAVPF"):K.push("RTP/AVPF"),q.forEach(function(b){K.push(b.id)}));g.push("m="+K.join(" "));g.push("c=IN IP4 0.0.0.0");B.bandwidth&&B.bandwidth.type&&B.bandwidth.bandwidth&&g.push("b="+B.bandwidth.type+":"+B.bandwidth.bandwidth);"rtp"==B.applicationType&&g.push("a=rtcp:1 IN IP4 0.0.0.0");
e&&(e.ufrag&&g.push("a=ice-ufrag:"+e.ufrag),e.pwd&&g.push("a=ice-pwd:"+e.pwd),k.forEach(function(b){g.push("a=fingerprint:"+b.hash+" "+b.value);b.setup&&g.push("a=setup:"+b.setup)}),e.sctp&&e.sctp.forEach(function(b){g.push("a=sctpmap:"+b.number+" "+b.protocol+" "+b.streams)}));"rtp"==B.applicationType&&g.push("a="+(c[h][l][b.senders]||"sendrecv"));g.push("a=mid:"+b.name);B.sources&&B.sources.length&&(B.sources[0].parameters||[]).forEach(function(b){"msid"===b.key&&g.push("a=msid:"+b.value)});B.mux&&
g.push("a=rtcp-mux");(B.encryption||[]).forEach(function(b){g.push("a=crypto:"+b.tag+" "+b.cipherSuite+" "+b.keyParams+(b.sessionParams?" "+b.sessionParams:""))});B.googConferenceFlag&&g.push("a=x-google-flag:conference");q.forEach(function(b){var e="a=rtpmap:"+b.id+" "+b.name+"/"+b.clockrate;b.channels&&"1"!=b.channels&&(e+="/"+b.channels);g.push(e);if(b.parameters&&b.parameters.length){e=["a=fmtp:"+b.id];var f=[];b.parameters.forEach(function(b){f.push((b.key?b.key+"=":"")+b.value)});e.push(f.join(";"));
g.push(e.join(" "))}b.feedback&&b.feedback.forEach(function(e){"trr-int"===e.type?g.push("a=rtcp-fb:"+b.id+" trr-int "+(e.value?e.value:"0")):g.push("a=rtcp-fb:"+b.id+" "+e.type+(e.subtype?" "+e.subtype:""))})});B.feedback&&B.feedback.forEach(function(b){"trr-int"===b.type?g.push("a=rtcp-fb:* trr-int "+(b.value?b.value:"0")):g.push("a=rtcp-fb:* "+b.type+(b.subtype?" "+b.subtype:""))});(B.headerExtensions||[]).forEach(function(b){g.push("a=extmap:"+b.id+(b.senders?"/"+c[h][l][b.senders]:"")+" "+b.uri)});
(B.sourceGroups||[]).forEach(function(b){g.push("a=ssrc-group:"+b.semantics+" "+b.sources.join(" "))});(B.sources||[]).forEach(function(b){for(var e=0;e<b.parameters.length;e++){var f=b.parameters[e];g.push("a=ssrc:"+(b.ssrc||B.ssrc)+" "+f.key+(f.value?":"+f.value:""))}});(e.candidates||[]).forEach(function(b){g.push(f.toCandidateSDP(b))});return g.join("\r\n")};f.toCandidateSDP=function(b){var e=[];e.push(b.foundation);e.push(b.component);e.push(b.protocol.toUpperCase());e.push(b.priority);e.push(b.ip);
e.push(b.port);var f=b.type;e.push("typ");e.push(f);("srflx"===f||"prflx"===f||"relay"===f)&&b.relAddr&&b.relPort&&(e.push("raddr"),e.push(b.relAddr),e.push("rport"),e.push(b.relPort));b.tcpType&&"TCP"==b.protocol.toUpperCase()&&(e.push("tcptype"),e.push(b.tcpType));e.push("generation");e.push(b.generation||"0");return"a=candidate:"+e.join(" ")}},{"./senders":47}],50:[function(b,e,f){e.exports=b("./lib/")},{"./lib/":51}],51:[function(b,e,f){function c(b,e){"object"==typeof b&&(e=b,b=void 0);e=e||
{};b=h(b);var f=b.source,c=b.id;e.forceNew||e["force new connection"]||!1===e.multiplex?(t("ignoring socket cache for %s",f),e=n(f,e)):(E[c]||(t("new io instance for %s",f),E[c]=n(f,e)),e=E[c]);return e.socket(b.path)}var h=b("./url"),l=b("socket.io-parser"),n=b("./manager"),t=b("debug")("socket.io-client");e.exports=f=c;var E=f.managers={};f.protocol=l.protocol;f.connect=c;f.Manager=b("./manager");f.Socket=b("./socket")},{"./manager":52,"./socket":54,"./url":55,debug:10,"socket.io-parser":57}],52:[function(b,
e,f){function c(b,e){if(!(this instanceof c))return new c(b,e);b&&"object"==typeof b&&(e=b,b=void 0);e=e||{};e.path=e.path||"/socket.io";this.nsps={};this.subs=[];this.opts=e;this.reconnection(!1!==e.reconnection);this.reconnectionAttempts(e.reconnectionAttempts||Infinity);this.reconnectionDelay(e.reconnectionDelay||1E3);this.reconnectionDelayMax(e.reconnectionDelayMax||5E3);this.randomizationFactor(e.randomizationFactor||.5);this.backoff=new k({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==e.timeout?2E4:e.timeout);this.readyState="closed";this.uri=b;this.connected=[];this.encoding=!1;this.packetBuffer=[];this.encoder=new n.Encoder;this.decoder=new n.Decoder;(this.autoConnect=!1!==e.autoConnect)&&this.open()}b("./url");var h=b("engine.io-client"),l=b("./socket");f=b("component-emitter");var n=b("socket.io-parser"),t=b("./on"),E=b("component-bind");b("object-component");var B=b("debug")("socket.io-client:manager"),q=b("indexof"),
k=b("backo2");e.exports=c;c.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var b in this.nsps)this.nsps[b].emit.apply(this.nsps[b],arguments)};c.prototype.updateSocketIds=function(){for(var b in this.nsps)this.nsps[b].id=this.engine.id};f(c.prototype);c.prototype.reconnection=function(b){if(!arguments.length)return this._reconnection;this._reconnection=!!b;return this};c.prototype.reconnectionAttempts=function(b){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=
b;return this};c.prototype.reconnectionDelay=function(b){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=b;this.backoff&&this.backoff.setMin(b);return this};c.prototype.randomizationFactor=function(b){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=b;this.backoff&&this.backoff.setJitter(b);return this};c.prototype.reconnectionDelayMax=function(b){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=b;this.backoff&&
this.backoff.setMax(b);return this};c.prototype.timeout=function(b){if(!arguments.length)return this._timeout;this._timeout=b;return this};c.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};c.prototype.open=c.prototype.connect=function(b){B("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;B("opening %s",this.uri);var e=this.engine=h(this.uri,this.opts),f=this;this.readyState="opening";this.skipReconnect=
!1;var c=t(e,"open",function(){f.onopen();b&&b()}),g=t(e,"error",function(e){B("connect_error");f.cleanup();f.readyState="closed";f.emitAll("connect_error",e);if(b){var c=Error("Connection error");c.data=e;b(c)}else f.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;B("connect attempt will timeout after %d",l);var n=setTimeout(function(){B("connect attempt timed out after %d",l);c.destroy();e.close();e.emit("error","timeout");f.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(n)}})}this.subs.push(c);
this.subs.push(g);return this};c.prototype.onopen=function(){B("open");this.cleanup();this.readyState="open";this.emit("open");var b=this.engine;this.subs.push(t(b,"data",E(this,"ondata")));this.subs.push(t(this.decoder,"decoded",E(this,"ondecoded")));this.subs.push(t(b,"error",E(this,"onerror")));this.subs.push(t(b,"close",E(this,"onclose")))};c.prototype.ondata=function(b){this.decoder.add(b)};c.prototype.ondecoded=function(b){this.emit("packet",b)};c.prototype.onerror=function(b){B("error",b);
this.emitAll("error",b)};c.prototype.socket=function(b){var e=this.nsps[b];if(!e){e=new l(this,b);this.nsps[b]=e;var f=this;e.on("connect",function(){e.id=f.engine.id;~q(f.connected,e)||f.connected.push(e)})}return e};c.prototype.destroy=function(b){b=q(this.connected,b);~b&&this.connected.splice(b,1);this.connected.length||this.close()};c.prototype.packet=function(b){B("writing packet %j",b);var e=this;e.encoding?e.packetBuffer.push(b):(e.encoding=!0,this.encoder.encode(b,function(b){for(var f=0;f<
b.length;f++)e.engine.write(b[f]);e.encoding=!1;e.processPacketQueue()}))};c.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var b=this.packetBuffer.shift();this.packet(b)}};c.prototype.cleanup=function(){for(var b;b=this.subs.shift();)b.destroy();this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};c.prototype.close=c.prototype.disconnect=function(){this.skipReconnect=!0;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};
c.prototype.onclose=function(b){B("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",b);this._reconnection&&!this.skipReconnect&&this.reconnect()};c.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var b=this;if(this.backoff.attempts>=this._reconnectionAttempts)B("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();B("will wait %dms before reconnect attempt",
e);this.reconnecting=!0;var f=setTimeout(function(){b.skipReconnect||(B("attempting reconnect"),b.emitAll("reconnect_attempt",b.backoff.attempts),b.emitAll("reconnecting",b.backoff.attempts),b.skipReconnect||b.open(function(e){e?(B("reconnect attempt error"),b.reconnecting=!1,b.reconnect(),b.emitAll("reconnect_error",e.data)):(B("reconnect success"),b.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(f)}})}};c.prototype.onreconnect=function(){var b=this.backoff.attempts;this.reconnecting=
!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",b)}},{"./on":53,"./socket":54,"./url":55,backo2:4,"component-bind":7,"component-emitter":8,debug:10,"engine.io-client":11,indexof:32,"object-component":39,"socket.io-parser":57}],53:[function(b,e,f){e.exports=function(b,e,f){b.on(e,f);return{destroy:function(){b.removeListener(e,f)}}}},{}],54:[function(b,e,f){function c(b,e){this.io=b;this.nsp=e;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&this.open();this.receiveBuffer=
[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0}var h=b("socket.io-parser");f=b("component-emitter");var l=b("to-array"),n=b("./on"),t=b("component-bind"),E=b("debug")("socket.io-client:socket"),B=b("has-binary");e.exports=c;var q={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},k=f.prototype.emit;f(c.prototype);c.prototype.subEvents=function(){if(!this.subs){var b=this.io;this.subs=
[n(b,"open",t(this,"onopen")),n(b,"packet",t(this,"onpacket")),n(b,"close",t(this,"onclose"))]}};c.prototype.open=c.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};c.prototype.send=function(){var b=l(arguments);b.unshift("message");this.emit.apply(this,b);return this};c.prototype.emit=function(b){if(q.hasOwnProperty(b))return k.apply(this,arguments),this;var e=l(arguments),f=h.EVENT;B(e)&&(f=h.BINARY_EVENT);
f={type:f,data:e};"function"==typeof e[e.length-1]&&(E("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),f.id=this.ids++);this.connected?this.packet(f):this.sendBuffer.push(f);return this};c.prototype.packet=function(b){b.nsp=this.nsp;this.io.packet(b)};c.prototype.onopen=function(){E("transport is open - connecting");"/"!=this.nsp&&this.packet({type:h.CONNECT})};c.prototype.onclose=function(b){E("close (%s)",b);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",
b)};c.prototype.onpacket=function(b){if(b.nsp==this.nsp)switch(b.type){case h.CONNECT:this.onconnect();break;case h.EVENT:this.onevent(b);break;case h.BINARY_EVENT:this.onevent(b);break;case h.ACK:this.onack(b);break;case h.BINARY_ACK:this.onack(b);break;case h.DISCONNECT:this.ondisconnect();break;case h.ERROR:this.emit("error",b.data)}};c.prototype.onevent=function(b){var e=b.data||[];E("emitting event %j",e);null!=b.id&&(E("attaching ack callback to event"),e.push(this.ack(b.id)));this.connected?
k.apply(this,e):this.receiveBuffer.push(e)};c.prototype.ack=function(b){var e=this,f=!1;return function(){if(!f){f=!0;var c=l(arguments);E("sending ack %j",c);var g=B(c)?h.BINARY_ACK:h.ACK;e.packet({type:g,id:b,data:c})}}};c.prototype.onack=function(b){E("calling ack %s with %j",b.id,b.data);this.acks[b.id].apply(this,b.data);delete this.acks[b.id]};c.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};c.prototype.emitBuffered=function(){var b;
for(b=0;b<this.receiveBuffer.length;b++)k.apply(this,this.receiveBuffer[b]);this.receiveBuffer=[];for(b=0;b<this.sendBuffer.length;b++)this.packet(this.sendBuffer[b]);this.sendBuffer=[]};c.prototype.ondisconnect=function(){E("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};c.prototype.destroy=function(){if(this.subs){for(var b=0;b<this.subs.length;b++)this.subs[b].destroy();this.subs=null}this.io.destroy(this)};c.prototype.close=c.prototype.disconnect=function(){this.connected&&
(E("performing disconnect (%s)",this.nsp),this.packet({type:h.DISCONNECT}));this.destroy();if(this.connected)this.onclose("io client disconnect");return this}},{"./on":53,"component-bind":7,"component-emitter":8,debug:10,"has-binary":30,"socket.io-parser":57,"to-array":59}],55:[function(b,e,f){(function(f){var c=b("parseuri"),g=b("debug")("socket.io-client:url");e.exports=function(b,e){var h=b;e=e||f.location;null==b&&(b=e.protocol+"//"+e.host);"string"==typeof b&&("/"==b.charAt(0)&&(b="/"==b.charAt(1)?
e.protocol+b:e.hostname+b),/^(https?|wss?):\/\//.test(b)||(g("protocol-less url %s",b),b="undefined"!=typeof e?e.protocol+"//"+b:"https://"+b),g("parse %s",b),h=c(b));h.port||(/^(http|ws)$/.test(h.protocol)?h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443"));h.path=h.path||"/";h.id=h.protocol+"://"+h.host+":"+h.port;h.href=h.protocol+"://"+h.host+(e&&e.port==h.port?"":":"+h.port);return h}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?
window:{})},{debug:10,parseuri:42}],56:[function(b,e,f){(function(e){var c=b("isarray"),g=b("./is-buffer");f.deconstructPacket=function(b){function e(b){if(!b)return b;if(g(b)){var h={_placeholder:!0,num:f.length};f.push(b);return h}if(c(b)){h=Array(b.length);for(var l=0;l<b.length;l++)h[l]=e(b[l]);return h}if("object"==typeof b&&!(b instanceof Date)){h={};for(l in b)h[l]=e(b[l]);return h}return b}var f=[];b.data=e(b.data);b.attachments=f.length;return{packet:b,buffers:f}};f.reconstructPacket=function(b,
e){function f(b){if(b&&b._placeholder)return e[b.num];if(c(b))for(var g=0;g<b.length;g++)b[g]=f(b[g]);else if(b&&"object"==typeof b)for(g in b)b[g]=f(b[g]);return b}b.data=f(b.data);b.attachments=void 0;return b};f.removeBlobs=function(b,f){function h(b,t,q){if(!b)return b;if(e.Blob&&b instanceof Blob||e.File&&b instanceof File){l++;var B=new FileReader;B.onload=function(){q?q[t]=this.result:n=this.result;--l||f(n)};B.readAsArrayBuffer(b)}else if(c(b))for(B=0;B<b.length;B++)h(b[B],B,b);else if(b&&
"object"==typeof b&&!g(b))for(B in b)h(b[B],B,b)}var l=0,n=b;h(n);l||f(n)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./is-buffer":58,isarray:33}],57:[function(b,e,f){function c(){}function h(b){var e=!1;var c=""+b.type;if(f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type)c+=b.attachments,c+="-";b.nsp&&"/"!=b.nsp&&(e=!0,c+=b.nsp);null!=b.id&&(e&&(c+=",",e=!1),c+=b.id);null!=b.data&&(e&&(c+=","),c+=B.stringify(b.data));E("encoded %j as %s",
b,c);return c}function l(b,e){q.removeBlobs(b,function(b){var f=q.deconstructPacket(b);b=h(f.packet);f=f.buffers;f.unshift(b);e(f)})}function n(){this.reconstructor=null}function t(b){this.reconPack=b;this.buffers=[]}var E=b("debug")("socket.io-parser"),B=b("json3");b("isarray");e=b("component-emitter");var q=b("./binary"),k=b("./is-buffer");f.protocol=4;f.types="CONNECT DISCONNECT EVENT BINARY_EVENT ACK BINARY_ACK ERROR".split(" ");f.CONNECT=0;f.DISCONNECT=1;f.EVENT=2;f.ACK=3;f.ERROR=4;f.BINARY_EVENT=
5;f.BINARY_ACK=6;f.Encoder=c;f.Decoder=n;c.prototype.encode=function(b,e){E("encoding packet %j",b);f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type?l(b,e):(b=h(b),e([b]))};e(n.prototype);n.prototype.add=function(b){if("string"==typeof b){a:{var e={},c=0;e.type=Number(b.charAt(0));if(null==f.types[e.type])b={type:f.ERROR,data:"parser error"};else{if(f.BINARY_EVENT==e.type||f.BINARY_ACK==e.type){for(var g="";"-"!=b.charAt(++c)&&(g+=b.charAt(c),c!=b.length););if(g!=Number(g)||"-"!=b.charAt(c))throw Error("Illegal attachments");
e.attachments=Number(g)}if("/"==b.charAt(c+1))for(e.nsp="";++c;){g=b.charAt(c);if(","==g)break;e.nsp+=g;if(c==b.length)break}else e.nsp="/";g=b.charAt(c+1);if(""!==g&&Number(g)==g){for(e.id="";++c;){g=b.charAt(c);if(null==g||Number(g)!=g){--c;break}e.id+=b.charAt(c);if(c==b.length)break}e.id=Number(e.id)}if(b.charAt(++c))try{e.data=B.parse(b.substr(c))}catch(Kh){b={type:f.ERROR,data:"parser error"};break a}E("decoded %s as %j",b,e);b=e}}f.BINARY_EVENT==b.type||f.BINARY_ACK==b.type?(this.reconstructor=
new t(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else if(k(b)||b.base64)if(this.reconstructor){if(b=this.reconstructor.takeBinaryData(b))this.reconstructor=null,this.emit("decoded",b)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+b);};n.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};t.prototype.takeBinaryData=function(b){this.buffers.push(b);
return this.buffers.length==this.reconPack.attachments?(b=q.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),b):null};t.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},{"./binary":56,"./is-buffer":58,"component-emitter":8,debug:10,isarray:33,json3:34}],58:[function(b,e,f){(function(b){e.exports=function(e){return b.Buffer&&b.Buffer.isBuffer(e)||b.ArrayBuffer&&e instanceof ArrayBuffer}}).call(this,"undefined"!==typeof global?global:"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{}],59:[function(b,e,f){e.exports=function(b,e){for(var f=[],c=(e=e||0)||0;c<b.length;c++)f[c-e]=b[c];return f}},{}],60:[function(b,e,f){(function(b){(function(c){function g(b){for(var e=[],f=0,c=b.length,g,h;f<c;)g=b.charCodeAt(f++),55296<=g&&56319>=g&&f<c?(h=b.charCodeAt(f++),56320==(h&64512)?e.push(((g&1023)<<10)+(h&1023)+65536):(e.push(g),f--)):e.push(g);return e}function h(b){if(55296<=b&&57343>=b)throw Error("Lone surrogate U+"+b.toString(16).toUpperCase()+
" is not a scalar value");}function t(){if(u>=r)throw Error("Invalid byte index");var b=p[u]&255;u++;if(128==(b&192))return b&63;throw Error("Invalid continuation byte");}function E(){if(u>r)throw Error("Invalid byte index");if(u==r)return!1;var b=p[u]&255;u++;if(0==(b&128))return b;if(192==(b&224)){var e=t();b=(b&31)<<6|e;if(128<=b)return b;throw Error("Invalid continuation byte");}if(224==(b&240)){e=t();var f=t();b=(b&15)<<12|e<<6|f;if(2048<=b)return h(b),b;throw Error("Invalid continuation byte");
}if(240==(b&248)){e=t();f=t();var c=t();b=(b&15)<<18|e<<12|f<<6|c;if(65536<=b&&1114111>=b)return b}throw Error("Invalid UTF-8 detected");}var B="object"==typeof f&&f,q="object"==typeof e&&e&&e.exports==B&&e,k="object"==typeof b&&b;if(k.global===k||k.window===k)c=k;var m=String.fromCharCode,p,r,u;k={version:"2.0.0",encode:function(b){b=g(b);for(var e=b.length,f=-1,c,l="";++f<e;){c=b[f];if(0==(c&4294967168))c=m(c);else{var n="";0==(c&4294965248)?n=m(c>>6&31|192):0==(c&4294901760)?(h(c),n=m(c>>12&15|
224),n+=m(c>>6&63|128)):0==(c&4292870144)&&(n=m(c>>18&7|240),n+=m(c>>12&63|128),n+=m(c>>6&63|128));c=n+=m(c&63|128)}l+=c}return l},decode:function(b){p=g(b);r=p.length;u=0;b=[];for(var e;!1!==(e=E());)b.push(e);e=b.length;for(var f=-1,c,h="";++f<e;)c=b[f],65535<c&&(c-=65536,h+=m(c>>>10&1023|55296),c=56320|c&1023),h+=m(c);return h}};if(B&&!B.nodeType)if(q)q.exports=k;else{c={}.hasOwnProperty;for(var v in k)c.call(k,v)&&(B[v]=k[v])}else c.utf8=k})(this)}).call(this,"undefined"!==typeof global?global:
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],61:[function(b,e,f){e.exports="function"===typeof Object.create?function(b,e){b.super_=e;b.prototype=Object.create(e.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,e){b.super_=e;var f=function(){};f.prototype=e.prototype;b.prototype=new f;b.prototype.constructor=b}},{}],62:[function(b,e,f){e.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===
typeof b.fill&&"function"===typeof b.readUInt8}},{}],63:[function(b,e,f){(function(e,c){function g(b,e){var c={seen:[],stylize:t};3<=arguments.length&&(c.depth=arguments[2]);4<=arguments.length&&(c.colors=arguments[3]);v(e)?c.showHidden=e:e&&f._extend(c,e);x(c.showHidden)&&(c.showHidden=!1);x(c.depth)&&(c.depth=2);x(c.colors)&&(c.colors=!1);x(c.customInspect)&&(c.customInspect=!0);c.colors&&(c.stylize=h);return B(c,b,c.depth)}function h(b,e){return(e=g.styles[e])?"\u001b["+g.colors[e][0]+"m"+b+"\u001b["+
g.colors[e][1]+"m":b}function t(b,e){return b}function E(b){var e={};b.forEach(function(b,f){e[b]=!0});return e}function B(b,e,c){if(b.customInspect&&e&&C(e.inspect)&&e.inspect!==f.inspect&&(!e.constructor||e.constructor.prototype!==e)){var g=e.inspect(c,b);w(g)||(g=B(b,g,c));return g}if(g=q(b,e))return g;var h=Object.keys(e),l=E(h);b.showHidden&&(h=Object.getOwnPropertyNames(e));if(H(e)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return k(e);if(0===h.length){if(C(e))return b.stylize("[Function"+
(e.name?": "+e.name:"")+"]","special");if(y(e))return b.stylize(RegExp.prototype.toString.call(e),"regexp");if(F(e))return b.stylize(Date.prototype.toString.call(e),"date");if(H(e))return k(e)}g="";var n=!1,t=["{","}"];u(e)&&(n=!0,t=["[","]"]);C(e)&&(g=" [Function"+(e.name?": "+e.name:"")+"]");y(e)&&(g=" "+RegExp.prototype.toString.call(e));F(e)&&(g=" "+Date.prototype.toUTCString.call(e));H(e)&&(g=" "+k(e));if(0===h.length&&(!n||0==e.length))return t[0]+g+t[1];if(0>c)return y(e)?b.stylize(RegExp.prototype.toString.call(e),
"regexp"):b.stylize("[Object]","special");b.seen.push(e);h=n?m(b,e,c,l,h):h.map(function(f){return p(b,e,c,l,f,n)});b.seen.pop();return r(h,g,t)}function q(b,e){if(x(e))return b.stylize("undefined","undefined");if(w(e))return e="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",b.stylize(e,"string");if(z(e))return b.stylize(""+e,"number");if(v(e))return b.stylize(""+e,"boolean");if(null===e)return b.stylize("null","null")}function k(b){return"["+Error.prototype.toString.call(b)+
"]"}function m(b,e,f,c,g){for(var h=[],l=0,n=e.length;l<n;++l)Object.prototype.hasOwnProperty.call(e,String(l))?h.push(p(b,e,f,c,String(l),!0)):h.push("");g.forEach(function(g){g.match(/^\d+$/)||h.push(p(b,e,f,c,g,!0))});return h}function p(b,e,f,c,g,h){var l,n;e=Object.getOwnPropertyDescriptor(e,g)||{value:e[g]};e.get?n=e.set?b.stylize("[Getter/Setter]","special"):b.stylize("[Getter]","special"):e.set&&(n=b.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(c,g)||(l="["+g+"]");n||
(0>b.seen.indexOf(e.value)?(n=null===f?B(b,e.value,null):B(b,e.value,f-1),-1<n.indexOf("\n")&&(n=h?n.split("\n").map(function(b){return"  "+b}).join("\n").substr(2):"\n"+n.split("\n").map(function(b){return"   "+b}).join("\n"))):n=b.stylize("[Circular]","special"));if(x(l)){if(h&&g.match(/^\d+$/))return n;l=JSON.stringify(""+g);l.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(l=l.substr(1,l.length-2),l=b.stylize(l,"name")):(l=l.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),l=b.stylize(l,
"string"))}return l+": "+n}function r(b,e,f){var c=0;return 60<b.reduce(function(b,e){c++;0<=e.indexOf("\n")&&c++;return b+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?f[0]+(""===e?"":e+"\n ")+" "+b.join(",\n  ")+" "+f[1]:f[0]+e+" "+b.join(", ")+" "+f[1]}function u(b){return Array.isArray(b)}function v(b){return"boolean"===typeof b}function z(b){return"number"===typeof b}function w(b){return"string"===typeof b}function x(b){return void 0===b}function y(b){return A(b)&&"[object RegExp]"===Object.prototype.toString.call(b)}
function A(b){return"object"===typeof b&&null!==b}function F(b){return A(b)&&"[object Date]"===Object.prototype.toString.call(b)}function H(b){return A(b)&&("[object Error]"===Object.prototype.toString.call(b)||b instanceof Error)}function C(b){return"function"===typeof b}function G(b){return 10>b?"0"+b.toString(10):b.toString(10)}function D(){var b=new Date,e=[G(b.getHours()),G(b.getMinutes()),G(b.getSeconds())].join(":");return[b.getDate(),J[b.getMonth()],e].join(" ")}var I=/%[sdj%]/g;f.format=
function(b){if(!w(b)){for(var e=[],f=0;f<arguments.length;f++)e.push(g(arguments[f]));return e.join(" ")}f=1;var c=arguments,h=c.length;e=String(b).replace(I,function(b){if("%%"===b)return"%";if(f>=h)return b;switch(b){case "%s":return String(c[f++]);case "%d":return Number(c[f++]);case "%j":try{return JSON.stringify(c[f++])}catch(qo){return"[Circular]"}default:return b}});for(var l=c[f];f<h;l=c[++f])e=null!==l&&A(l)?e+(" "+g(l)):e+(" "+l);return e};f.deprecate=function(b,g){if(x(c.process))return function(){return f.deprecate(b,
g).apply(this,arguments)};if(!0===e.noDeprecation)return b;var h=!1;return function(){if(!h){if(e.throwDeprecation)throw Error(g);e.traceDeprecation?console.trace(g):console.error(g);h=!0}return b.apply(this,arguments)}};var L={},O;f.debuglog=function(b){x(O)&&(O=e.env.NODE_DEBUG||"");b=b.toUpperCase();if(!L[b])if((new RegExp("\\b"+b+"\\b","i")).test(O)){var c=e.pid;L[b]=function(){var e=f.format.apply(f,arguments);console.error("%s %d: %s",b,c,e)}}else L[b]=function(){};return L[b]};f.inspect=g;
g.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};g.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};f.isArray=u;f.isBoolean=v;f.isNull=function(b){return null===b};f.isNullOrUndefined=function(b){return null==b};f.isNumber=z;f.isString=w;f.isSymbol=function(b){return"symbol"===
typeof b};f.isUndefined=x;f.isRegExp=y;f.isObject=A;f.isDate=F;f.isError=H;f.isFunction=C;f.isPrimitive=function(b){return null===b||"boolean"===typeof b||"number"===typeof b||"string"===typeof b||"symbol"===typeof b||"undefined"===typeof b};f.isBuffer=b("./support/isBuffer");var J="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");f.log=function(){console.log("%s - %s",D(),f.format.apply(f,arguments))};f.inherits=b("inherits");f._extend=function(b,e){if(!e||!A(e))return b;for(var f=Object.keys(e),
c=f.length;c--;)b[f[c]]=e[f[c]];return b}}).call(this,b("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":62,_process:43,inherits:61}],64:[function(b,e,f){if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){var c="moz";var h=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)c="webkit",h=navigator.userAgent.match(/Chrom(e|ium)/)&&
parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10);b=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;f=window.mozRTCIceCandidate||window.RTCIceCandidate;var l=window.mozRTCSessionDescription||window.RTCSessionDescription,n=window.webkitMediaStream||window.MediaStream,t="https:"===window.location.protocol&&("webkit"===c&&26<=h||"moz"===c&&33<=h),E=window.AudioContext||window.webkitAudioContext,B=document.createElement("video");B=B&&B.canPlayType&&
"probably"===B.canPlayType('video/webm; codecs="vp8", vorbis');var q=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;e.exports={prefix:c,browserVersion:h,support:!!b&&!!q,supportRTCPeerConnection:!!b,supportVp8:B,supportGetUserMedia:!!q,supportDataChannel:!!(b&&b.prototype&&b.prototype.createDataChannel),supportWebAudio:!(!E||!E.prototype.createMediaStreamSource),supportMediaStream:!(!n||!n.prototype.removeTrack),supportScreenSharing:!!t,AudioContext:E,
PeerConnection:b,SessionDescription:l,IceCandidate:f,MediaStream:n,getUserMedia:q}},{}],65:[function(b,e,f){function c(){}e.exports=c;c.mixin=function(b){b=b.prototype||b;b.isWildEmitter=!0;b.on=function(b,e,f){this.callbacks=this.callbacks||{};var c=3===arguments.length,g=c?arguments[2]:arguments[1];g._groupName=c?arguments[1]:void 0;(this.callbacks[b]=this.callbacks[b]||[]).push(g);return this};b.once=function(b,e,f){function c(){g.off(b,c);l.apply(this,arguments)}var g=this,h=3===arguments.length,
l=h?arguments[2]:arguments[1];this.on(b,h?arguments[1]:void 0,c);return this};b.releaseGroup=function(b){this.callbacks=this.callbacks||{};var e,f;for(e in this.callbacks){var c=this.callbacks[e];var g=0;for(f=c.length;g<f;g++)c[g]._groupName===b&&(c.splice(g,1),g--,f--)}return this};b.off=function(b,e){this.callbacks=this.callbacks||{};var f=this.callbacks[b];if(!f)return this;if(1===arguments.length)return delete this.callbacks[b],this;var c=f.indexOf(e);f.splice(c,1);0===f.length&&delete this.callbacks[b];
return this};b.emit=function(b){this.callbacks=this.callbacks||{};var e=[].slice.call(arguments,1),f=this.callbacks[b],c=this.getWildcardCallbacks(b),g;if(f){var h=f.slice();f=0;for(g=h.length;f<g&&h[f];++f)h[f].apply(this,e)}if(c)for(h=c.slice(),f=0,g=h.length;f<g&&h[f];++f)h[f].apply(this,[b].concat(e));return this};b.getWildcardCallbacks=function(b){this.callbacks=this.callbacks||{};var e,f=[];for(e in this.callbacks){var c=e.split("*");if("*"===e||2===c.length&&b.slice(0,c[0].length)===c[0])f=
f.concat(this.callbacks[e])}return f}};c.mixin(c)},{}],66:[function(b,e,f){function c(b,e,f){return e?new h(b,e):new h(b)}b=window;var h=b.WebSocket||b.MozWebSocket;e.exports=h?c:null;h&&(c.prototype=h.prototype)},{}],67:[function(b,e,f){function c(b){var e=!0;b.getTracks().forEach(function(b){e="ended"===b.readyState&&e});return e}function h(b){var e=this;t.call(this);this.id=b.id;this.parent=b.parent;this.type=b.type||"video";this.oneway=b.oneway||!1;this.sharemyscreen=b.sharemyscreen||!1;this.browserPrefix=
b.prefix;this.stream=b.stream;this.enableDataChannels=void 0===b.enableDataChannels?this.parent.config.enableDataChannels:b.enableDataChannels;this.receiveMedia=b.receiveMedia||this.parent.config.receiveMedia;this.channels={};this.sid=b.sid||Date.now().toString();this.pc=new n(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints);this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("endOfCandidates",function(b){e.send("endOfCandidates",b)});this.pc.on("offer",
function(b){e.parent.config.nick&&(b.nick=e.parent.config.nick);e.send("offer",b)});this.pc.on("answer",function(b){e.parent.config.nick&&(b.nick=e.parent.config.nick);e.send("answer",b)});this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this));this.pc.on("addChannel",this.handleDataChannelAdded.bind(this));this.pc.on("removeStream",this.handleStreamRemoved.bind(this));this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded"));this.pc.on("iceConnectionStateChange",this.emit.bind(this,
"iceConnectionStateChange"));this.pc.on("iceConnectionStateChange",function(){switch(e.pc.iceConnectionState){case "failed":"offer"===e.pc.pc.localDescription.type&&(e.parent.emit("iceFailed",e),e.send("connectivityError"))}});this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange"));this.logger=this.parent.logger;"screen"===b.type?this.parent.localScreens&&this.parent.localScreens[0]&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),this.pc.addStream(this.parent.localScreens[0]),
this.broadcaster=b.broadcaster):this.parent.localStreams.forEach(function(b){e.pc.addStream(b)});this.on("channelOpen",function(b){"https://simplewebrtc.com/protocol/filetransfer#inband-v1"===b.protocol&&(b.onmessage=function(f){f=JSON.parse(f.data);var c=new k.Receiver;c.receive(f,b);e.emit("fileTransfer",f,c);c.on("receivedFile",function(b,e){c.channel.close()})})});this.on("*",function(){e.parent.emit.apply(e.parent,arguments)})}f=b("util");var l=b("webrtcsupport"),n=b("rtcpeerconnection"),t=b("wildemitter"),
k=b("filetransfer");f.inherits(h,t);h.prototype.handleMessage=function(b){var e=this;this.logger.log("getting",b.type,b);b.prefix&&(this.browserPrefix=b.prefix);"offer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleOffer(b.payload,function(b){b||e.pc.answer(function(b,e){})})):"answer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleAnswer(b.payload)):"candidate"===b.type?this.pc.processIce(b.payload):"connectivityError"===
b.type?this.parent.emit("connectivityError",e):"mute"===b.type?this.parent.emit("mute",{id:b.from,name:b.payload.name}):"unmute"===b.type&&this.parent.emit("unmute",{id:b.from,name:b.payload.name})};h.prototype.send=function(b,e){e={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:b,payload:e,prefix:l.prefix};this.logger.log("sending",b,e);this.parent.emit("message",e)};h.prototype.sendDirectly=function(b,e,f){var c={type:e,payload:f};this.logger.log("sending via datachannel",
b,e,c);b=this.getDataChannel(b);if("open"!=b.readyState)return!1;f.func!==sb.location?b.send(JSON.stringify(c)):b.send(f[1].buffer);return!0};h.prototype._observeDataChannel=function(b){var e=this;b.binaryType="arraybuffer";b.onclose=this.emit.bind(this,"channelClose",b);b.onerror=this.emit.bind(this,"channelError",b);b.onmessage=function(f){var c=f.data;c=c.byteLength?{type:"nehhof",payload:{1:new Uint8Array(c),func:sb.location}}:JSON.parse(c);e.emit("channelMessage",e,b.label,c,b,f)};b.onopen=this.emit.bind(this,
"channelOpen",b)};h.prototype.getDataChannel=function(b,e){if(!l.supportDataChannel)return this.emit("error",Error("createDataChannel not supported"));var f=this.channels[b];e||(e={});if(f)return f;f=this.channels[b]=this.pc.createDataChannel(b,e);f.binaryType="arraybuffer";this._observeDataChannel(f);return f};h.prototype.onIceCandidate=function(b){if(!this.closed)if(b){var e=this.parent.config.peerConnectionConfig;"moz"===l.prefix&&e&&e.iceTransports&&b.candidate&&b.candidate.candidate&&0>b.candidate.candidate.indexOf(e.iceTransports)?
this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",e.iceTransports):this.send("candidate",b)}else this.logger.log("End of candidates.")};h.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc");this.pc.offer(this.receiveMedia,function(b,e){})};h.prototype.icerestart=function(){var b=this.receiveMedia;b.mandatory.IceRestart=!0;this.pc.offer(b,function(b,e){})};h.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())};
h.prototype.handleRemoteStreamAdded=function(b){var e=this;this.stream?this.logger.warn("Already have a remote stream"):(this.stream=b.stream,this.stream.getTracks().forEach(function(b){b.addEventListener("ended",function(){c(e.stream)&&e.end()})}),this.parent.emit("peerStreamAdded",this))};h.prototype.handleStreamRemoved=function(){var b=this.parent.peers.indexOf(this);-1<b&&(this.parent.peers.splice(b,1),this.closed=!0,this.parent.emit("peerStreamRemoved",this))};h.prototype.handleDataChannelAdded=
function(b){this.channels[b.label]=b;this._observeDataChannel(b)};h.prototype.sendFile=function(b){var e=new k.Sender,f=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:"https://simplewebrtc.com/protocol/filetransfer#inband-v1"});f.onopen=function(){f.send(JSON.stringify({size:b.size,name:b.name}));e.send(b,f)};f.onclose=function(){console.log("sender received transfer");e.emit("complete")};return e};e.exports=h},{filetransfer:26,rtcpeerconnection:44,util:63,webrtcsupport:64,wildemitter:65}],
68:[function(b,e,f){function c(b){var e=this,f=b||{},c=this.config={url:"https://sandbox.simplewebrtc.com:443/",socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}},g;var q=b.debug?b.logger||console:b.logger||k;this.logger=q;for(g in f)f.hasOwnProperty(g)&&
(this.config[g]=f[g]);this.capabilities=n;l.call(this);var E=null===this.config.connection?this.connection=new B(this.config):this.connection=this.config.connection;E.on("connect",function(){e.emit("connectionReady",E.getSessionid());e.sessionReady=!0;e.testReadiness()});E.on("message",function(b){var f=e.webrtc.getPeers(b.from,b.roomType);if("offer"===b.type){f.length&&f.forEach(function(e){e.sid==b.sid&&(c=e)});if(!c){var c=e.webrtc.createPeer({id:b.from,sid:b.sid,type:b.roomType,enableDataChannels:e.config.enableDataChannels&&
"screen"!==b.roomType,sharemyscreen:"screen"===b.roomType&&!b.broadcaster,broadcaster:"screen"!==b.roomType||b.broadcaster?null:e.connection.getSessionid()});e.emit("createdPeer",c)}c.handleMessage(b)}else f.length&&f.forEach(function(e){b.sid?e.sid===b.sid&&e.handleMessage(b):e.handleMessage(b)})});E.on("remove",function(b){b.id!==e.connection.getSessionid()&&e.webrtc.removePeers(b.id,b.type)});b.logger=this.logger;b.debug=!1;this.webrtc=new h(b);"mute unmute pauseVideo resumeVideo pause resume sendToAll sendDirectlyToAll getPeers".split(" ").forEach(function(b){e[b]=
e.webrtc[b].bind(e.webrtc)});this.webrtc.on("*",function(){e.emit.apply(e,arguments)});if(c.debug)this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:"));this.webrtc.on("localStream",function(){e.testReadiness()});this.webrtc.on("message",function(b){e.connection.emit("message",b)});this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this));this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this));this.config.adjustPeerVolume&&(this.webrtc.on("speaking",
this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1)));E.on("stunservers",function(b){e.webrtc.config.peerConnectionConfig.iceServers=b;e.emit("stunservers",b)});E.on("turnservers",function(b){e.webrtc.config.peerConnectionConfig.iceServers=e.webrtc.config.peerConnectionConfig.iceServers.concat(b);e.emit("turnservers",b)});this.webrtc.on("iceFailed",function(b){});this.webrtc.on("connectivityError",function(b){});this.webrtc.on("audioOn",
function(){e.webrtc.sendToAll("unmute",{name:"audio"})});this.webrtc.on("audioOff",function(){e.webrtc.sendToAll("mute",{name:"audio"})});this.webrtc.on("videoOn",function(){e.webrtc.sendToAll("unmute",{name:"video"})});this.webrtc.on("videoOff",function(){e.webrtc.sendToAll("mute",{name:"video"})});this.webrtc.on("localScreen",function(b){var f=document.createElement("video"),c=e.getRemoteVideoContainer();f.oncontextmenu=function(){return!1};f.id="localScreen";t(b,f);c&&c.appendChild(f);e.emit("localScreenAdded",
f);e.connection.emit("shareScreen");e.webrtc.peers.forEach(function(b){"video"===b.type&&(b=e.webrtc.createPeer({id:b.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:e.connection.getSessionid()}),e.emit("createdPeer",b),b.start())})});this.webrtc.on("localScreenStopped",function(b){e.getLocalScreen()&&e.stopScreenShare()});this.webrtc.on("channelMessage",function(b,f,c){"volume"==c.type&&e.emit("remoteVolumeChange",b,c.volume)});
this.config.autoRequestMedia&&this.startLocalVideo()}var h=b("./webrtc"),l=b("wildemitter"),n=b("webrtcsupport"),t=b("attachmediastream"),k=b("mockconsole"),B=b("./socketioconnection");c.prototype=Object.create(l.prototype,{constructor:{value:c}});c.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare();this.emit("leftRoom",this.roomName);this.roomName=void 0}};c.prototype.disconnect=
function(){this.connection.disconnect();delete this.connection};c.prototype.handlePeerStreamAdded=function(b){var e=this,f=this.getRemoteVideoContainer(),c=t(b.stream);b.videoEl=c;c.id=this.getDomId(b);f&&f.appendChild(c);this.emit("videoAdded",c,b);window.setTimeout(function(){e.webrtc.isAudioEnabled()||b.send("mute",{name:"audio"});e.webrtc.isVideoEnabled()||b.send("mute",{name:"video"})},250)};c.prototype.handlePeerStreamRemoved=function(b){var e=this.getRemoteVideoContainer(),f=b.videoEl;this.config.autoRemoveVideos&&
e&&f&&e.removeChild(f);f&&this.emit("videoRemoved",f,b)};c.prototype.getDomId=function(b){return[b.id,b.type,b.broadcaster?"broadcasting":"incoming"].join("_")};c.prototype.setVolumeForAll=function(b){this.webrtc.peers.forEach(function(e){e.videoEl&&(e.videoEl.volume=b)})};c.prototype.joinRoom=function(b,e){var f=this;this.roomName=b;this.connection.emit("join",b,function(c,g){console.log("join CB",c);if(c)f.emit("error",c);else{if(!g.xtra){Oa();cc();ne(u.errorLoading,"#ff0000");return}w.room=g.xtra;
var h,l;for(h in g.clients){var n=g.clients[h];for(l in n)if(n[l]){var t=f.webrtc.createPeer({id:h,type:l,enableDataChannels:f.config.enableDataChannels&&"screen"!==l,receiveMedia:{offerToReceiveAudio:"screen"!==l&&f.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:f.config.receiveMedia.offerToReceiveVideo}});f.emit("createdPeer",t);t.start()}}}e&&e(c,g);f.emit("joinedRoom",b)})};c.prototype.getEl=function(b){return"string"===typeof b?document.getElementById(b):b};c.prototype.startLocalVideo=
function(){var b=this;this.webrtc.start(this.config.media,function(e,f){e?b.emit("localMediaError",e):t(f,b.getLocalVideoContainer(),b.config.localVideo)})};c.prototype.stopLocalVideo=function(){this.webrtc.stop()};c.prototype.getLocalVideoContainer=function(){var b=this.getEl(this.config.localVideoEl);if(b&&"VIDEO"===b.tagName)return b.oncontextmenu=function(){return!1},b;if(b){var e=document.createElement("video");e.oncontextmenu=function(){return!1};b.appendChild(e);return e}};c.prototype.getRemoteVideoContainer=
function(){return this.getEl(this.config.remoteVideosEl)};c.prototype.shareScreen=function(b){this.webrtc.startScreenShare(b)};c.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]};c.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var b=document.getElementById("localScreen"),e=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&e&&b&&e.removeChild(b);b&&this.emit("videoRemoved",b);this.getLocalScreen()&&this.webrtc.stopScreenShare();
this.webrtc.peers.forEach(function(b){b.broadcaster&&b.end()})};c.prototype.testReadiness=function(){this.sessionReady&&(this.config.media.video||this.config.media.audio?0<this.webrtc.localStreams.length&&this.emit("readyToCall",this.connection.getSessionid()):this.emit("readyToCall",this.connection.getSessionid()))};c.prototype.createRoom=function(b,e){this.roomName=b;this.connection.emit("create",w.room,e)};c.prototype.sendFile=function(){if(!n.dataChannel)return this.emit("error",Error("DataChannelNotSupported"))};
e.exports=c},{"./socketioconnection":69,"./webrtc":70,attachmediastream:3,mockconsole:37,webrtcsupport:64,wildemitter:65}],69:[function(b,e,f){function c(b){this.connection=h.connect(b.url,b.socketio)}var h=b("socket.io-client");c.prototype.on=function(b,e){this.connection.on(b,e)};c.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};c.prototype.getSessionid=function(){return this.connection.id};c.prototype.disconnect=function(){return this.connection.disconnect()};e.exports=
c},{"socket.io-client":50}],70:[function(b,e,f){function c(b){var e=this,f=b||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:!0};var c;b=b.debug?b.logger||console:b.logger||l;this.logger=b;for(c in f)f.hasOwnProperty(c)&&(this.config[c]=f[c]);h.support||this.logger.error("Your browser doesn't seem to support WebRTC");this.peers=[];
n.call(this,this.config);this.on("speaking",function(){e.hardMuted||e.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"speaking"})))})});this.on("stoppedSpeaking",function(){e.hardMuted||e.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"stoppedSpeaking"})))})});this.on("volumeChange",function(b,f){e.hardMuted||e.peers.forEach(function(e){e.enableDataChannels&&
(e=e.getDataChannel("hark"),"open"==e.readyState&&e.send(JSON.stringify({type:"volume",volume:b})))})});if(this.config.debug)this.on("*",function(b,f,c){(e.config.logger===l?console:e.logger).log("event:",b,f,c)})}f=b("util");var h=b("webrtcsupport"),l=b("mockconsole"),n=b("localmedia"),t=b("./peer");f.inherits(c,n);c.prototype.createPeer=function(b){b.parent=this;b=new t(b);this.peers.push(b);return b};c.prototype.removePeers=function(b,e){this.getPeers(b,e).forEach(function(b){b.end()})};c.prototype.getPeers=
function(b,e){return this.peers.filter(function(f){return(!b||f.id===b)&&(!e||f.type===e)})};c.prototype.sendToAll=function(b,e){this.peers.forEach(function(f){f.send(b,e)})};c.prototype.sendDirectlyToAll=function(b,e,f){this.peers.forEach(function(c){c.enableDataChannels&&c.sendDirectly(b,e,f)})};e.exports=c},{"./peer":67,localmedia:35,mockconsole:37,util:63,webrtcsupport:64}]},{},[68])(68)})},F,sa,u={},w={name:localStorage.name,color:localStorage.color||"#ff0000"},Hc=function(){};console.log("%c nehhon %c POWER ",
"background: #00ffd4; color: #000; font-size:20px","background: #000; color: #00ffd4; font-size:20px");console.log("%c webmaster@nehhon.com ","background: #00ffd4; color: #000; font-size:20px");console.log("%c @nehhon ","background: #000; color: #00ffd4; font-size:20px");var r=function(d){return document.getElementById(d)},Za=function(d,b,e){void 0===localStorage[d]&&(localStorage[d]=b);e&&(r(e).value=localStorage[d])};void 0===localStorage.fullscreen&&(localStorage.fullscreen=!0);Za("favMusic","originalMusic");
Za("musicRange",80);Za("soundRange",45);Za("goldRes",400);Za("foodRes",400);Za("stoneRes",400);Za("woodRes",400);Za("infinity","true");Za("mapSize",256);Za("terrainType","grass");Za("water","0");Za("items","10");Za("peons","3");Za("gateways","1");Za("freePop","1");console.log=Hc;console.error=Hc;console.warn=Hc;console.info=Hc;"tza.red"!==location.hostname&&(location.href="https://tza.red");window.onbeforeunload=function(){return"Are you sure you want to quit?"};var Hm=function(d){d.parentNode.removeChild(d)},
ne=function(d,b){var e=document.getElementById("notifybar"),f=document.createElement("div");f.innerHTML=d;b&&(f.style.background=b);e.appendChild(f);setTimeout(Hm,11E3,f)};document.body.style.setProperty("--baksp","linear-gradient(60deg, rgba(55, 0, 56, 0.6) 0%, rgba(var(--lred),var(--lgreen),var(--lblue), 0.5) 100%), url(/nehhon/bak2.jpg) fixed repeat");document.body.style.setProperty("--bak2sp","url(/nehhon/bak.jpg) fixed repeat");var gk=function(d){d=parseInt(d.substr(1),16);return[d>>16&255,d>>
8&255,d&255]},Im=location;(function(){var d=!!window.opr||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),b="undefined"!==typeof InstallTrigger,e=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),f=!!document.documentMode,c=!f&&!!window.StyleMedia,h=!!window.chrome&&!!window.chrome.webstore,l;d?l="Opera":b?l="Firefox":e?l="Safari":f?l="IE":c?l="Edge":h&&(l="Chrome");w.navLang=localStorage.language||navigator.language||navigator.userLanguage;d=w.navLang.substr(0,2);
b={es:["Tzared","Juego de estrategia en tiempo real para navegadores web, juega solo o con amigos","tzared,jugar,multijugador,juego,online,navegador web,tzar"],it:["Tzared","Gioco di strategia in tempo reale per browser web, giocare da soli o con gli amici","tzared,giocare,multigiocatore,gioco,online,navigatore,tzar,web"],pl:["Tzared","Gra strategiczna w czasie rzeczywistym dla przegl\u0105darek internetowych, bawi\u0107 si\u0119 samotnie lub z przyjaci\u00f3\u0142mi","tzared,gra,multiplayer,online,tzar,przegl\u0105darka internetowa"],
ru:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u044f \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u043b\u044f \u0432\u0435\u0431-\u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u0432, \u0438\u0433\u0440\u0430\u0442\u044c \u0432 \u043e\u0434\u0438\u043d\u043e\u0447\u043a\u0443 \u0438\u043b\u0438 \u0441 \u0434\u0440\u0443\u0437\u044c\u044f\u043c\u0438","\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u044c\u0442\u0438\u043f\u043b\u0435\u0435\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u0435\u0440,\u043e\u0433\u043d\u0451\u043c \u0438 \u043c\u0435\u0447\u043e\u043c"],
pt:["Tzared","Jogo de estrat\u00e9gia em tempo real para navegadores da web, jogar sozinho ou com amigos","tzared,jogar,multiplayer,jogo,online,navegador web,tzar"],bg:["\u0426\u0430\u0440\u0435\u0434","\u0421\u0442\u0440\u0430\u0442\u0435\u0433\u0438\u0447\u0435\u0441\u043a\u0430 \u0438\u0433\u0440\u0430 \u0432 \u0440\u0435\u0430\u043b\u043d\u043e \u0432\u0440\u0435\u043c\u0435 \u0437\u0430 \u0443\u0435\u0431 \u0431\u0440\u0430\u0443\u0437\u044a\u0440\u0438, \u0438\u0433\u0440\u0430\u0439\u0442\u0435 \u0441\u0430\u043c\u0438 \u0438\u043b\u0438 \u0441 \u043f\u0440\u0438\u044f\u0442\u0435\u043b\u0438",
"\u0446\u0430\u0440\u0435\u0434,\u0438\u0433\u0440\u0430,\u043c\u0443\u043b\u0442\u0438\u043f\u043b\u0435\u0439\u044a\u0440,\u043e\u043d\u043b\u0430\u0439\u043d,\u0431\u0440\u0430\u0443\u0437\u044a\u0440"],de:["Tzared","Echtzeit-Strategiespiel f\u00fcr Webbrowser, alleine oder mit Freunden spielen","tzared,multiplayer,spiel,online,Webbrowser,tzar"],en:["Tzared","Real-time strategy game for web browsers, play alone or with friends","tzared,play,multiplayer,game,online,browser,tzar,web"]};b[d]||(d=
"en");document.getElementsByTagName("html")[0].lang=d;b=b[location.search.split("lang=")[1]||"en"];document.title=b[0];w.title=b[0];document.getElementsByTagName("meta").description=b[1];document.getElementsByTagName("meta").keywords=b[2];w.version="v31.9";w.versionDate=Date.now()-1538591268519;localStorage.version!==w.version&&(localStorage.version=w.version,ne("Updated to "+w.version));r("info").innerHTML="Work in progress - Beta "+w.version+" - Updated "+~~(w.versionDate/864E5)+" days ago";w.lang=
"en es it pt ru pl bg de".split(" ").indexOf(d);0>w.lang&&(w.lang=0);w.langstr=d;w.team=0;w.race=0;w.navigator=l;w.mx=151;w.onlineID=null;w.temperature=0;w.cdn="/nehhon/"})();u={open:"Open",loading:"Loading...",systemAlert:"System Message",notEnough:"Not enough %s",ok:"OK",yes:"Yes",no:"No",secure:"Are you sure?",gold:"Gold",stone:"Stone",wood:"Wood",food:"Food",mana:"Manna",warning:"Warning",play:"PLAY",grass:"Grass",snow:"Snow",close:"CLOSE",gameClosed:"The game was canceled by the server.",loadgraphics:"Downloading graphics...",
waitImages:"Downloading graphics",wait:"Wait",audioproblem:"Your browser is not compatible with Web Audio",defeated:"DEFEATED",victorious:"VICTORIOUS",options:"OPTIONS",refresh:"Refresh",back:"BACK",paused:"PAUSED",chatMsg:"CHAT MESSAGE",disconnect:"Disconnect",playerDisconnected:"%s has disconnected!",connectionError:"Connection error",noP2P:"Engine not loaded",startingResources:"Starting Resources",mapSize:"Map Size",menu:"MENU",quit:"QUIT",downloadAll:"Download all",continue:"Continue",backToGame:"BACK TO GAME",
initializing:"Initializing...",requires:"Requires",stop:"Stop",pickItems:"Pick items",move:"Move",stand:"Stand ground",explore:"Explore",patrol:"Patrol",guard:"Guard",errorLoading:"Error loading game.",waitingPlayers:"Waiting for players to connect",musicVolume:"Music Volume",soundVolume:"Sound Volume",common:"Common",popLimit:"Population limit reached",houseLimit:"Not enough houses",lightning:"Lightning",freeze:"Freeze",bless:"Bless",heal:"Heal",invisibility:"Invisibility",dcm:"Dig, chop or mine",
repair:"Repair building",menuBuild:"See what you can build",units:"Units",infinite:"Infinite",gameFull:"Sorry, the game is full.",terrainOption:"Terrain",playerDefeated:"%s has been defeated!",savegame:"SAVE GAME",loadRecord:"Recording",stats:"Stats",builds:"Builds",items:"Items",nature:"Nature",trees:"Trees",delete:"Delete",create:"Create",username:"Player Name",gameOptions:"GAME OPTIONS",nplayers:"Number of Players",gameName:"Enter Game Name",gamesFound:"Games Found",strSearch:"SEARCH| Search for existing games",
strCreate:"CREATE| Create a game",randomMap:"RANDOM MAP",strcusMap:"CUSTOM MAP",strSettings:"SETTINGS",mapMaking:"Map Making",terrain:"Terrain",save:"SAVE",accept:"ACCEPT",team:"Team",color:"Colour",offlinePlay:"For playing offline",AI:"AI Assist",kingdom:"Kingdom",attack:"Attack",defence:"Defence",health:"Health",maxHealth:"Max health",playing:"Playing",waiting:"Waiting",joining:"Joining...",random:"Random",cancel:"CANCEL",rules:"Rules",events:"Events",actions:"Actions",objAction:"Object action",
destroyObj:"Destroy object",defined:"Defined",undefined:"Undefined",destroy:"Destroy",capture:"Capture",moving:"Moving",add:"Add",objOrder:"Order",objZone:"Object in zone",zone:"Zone",editMap:"Edit",mapName:"Map name",water:"Water",description:"Map Description",author:"Author",fullscreen:"Automatic full screen",fullscreen2:"Full screen",versionError:"Incorrect game version.",language:"Language",english:"English",spanish:"Espa\u00f1ol",italian:"Italiano",portuguese:"Portugu\u00eas",russian:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",
polish:"Polski",bulgarian:"\u0431\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",german:"Deutsch",up:"Up",down:"Down",kick:"Kick",kicked:"You were kicked off by the server.",nospace:"Not enought space",peons:"Peasants",gateways:"Magic Gateways",computer:"Computer",addAI:"Add AI",race:"Race",date:"Date",freePop:"Free population",about:"About",loadTerrain:"Loading Terrain...",downloadmap:"Download savegame",timePlayed:"Played time"};var hk=Hc,jk=function(d){d--;var b=new XMLHttpRequest;b.open("GET",
"/nehhon/"+w.langstr+".json",!0);b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var e=JSON.parse(b.response);hk=function(){for(var b=A,d=0;d<b.length;d++){var f=b[d].name;e[f]&&(b[d].name=e[f])}for(d=0;d<C.length;d++)b=C[d],e[b.name[0]]&&e[b.name[1]]&&(b.name[0]=e[b.name[0]],b.name[1]=e[b.name[1]]);e=null};for(var d=[],g=0;0>g;g++)"undefined"!=typeof c[g]&&null!=c[g].tech&&(d.push(c[g].tech.name),
Object.freeze(c[g].tech));for(g=0;g<d.length;g++)d[g][0]=e[d[g][0]],d[g][1]=e[d[g][1]];d=Object.keys(u);for(g=0;g<d.length;g++){var h=d[g];void 0!=e[u[h]]&&(u[h]=e[u[h]])}Object.freeze(u);for(g=0;g<jb.length;g++)jb[g]=e[jb[g]];for(g=0;g<0*Mh.length;g++)Mh[g]=e[Mh[g]];Object.freeze(jb);ik()}};b.send()},ik=function(){for(var d=["refreshButton",u.refresh,"optionsButton",u.options,"startButton",u.play,"backButton",u.back,"closeButton",u.close,"quitButton",u.quit,"continueButton",u.continue],b=0,e=d.length;b<
e;b+=2)for(var f=document.getElementsByClassName(d[b]),c=0,h=f.length;c<h;c++)f[c].innerHTML=d[b+1];d=["alertok",u.ok,"sendMessageH2",u.chatMsg,"backToGameS",u.backToGame,"menueditor",u.menu,"gameMenu",u.menu,"selectBuilds",u.builds,"selectUnits",u.units,"selectItems",u.items,"selectNature",u.nature,"gamesFound",u.gamesFound,"strSearch",u.strSearch.split("| ")[1],"strCreate",u.strCreate.split("| ")[1],"strRandomMap",u.randomMap,"strcusMap",u.strcusMap,"strMapEditor",u.mapMaking,"h2rndMap",u.randomMap,
"mapProps",u.options,"mapRules",u.rules,"strSettings",u.strSettings,"about",u.about];b=0;for(e=d.length;b<e;b+=2)document.getElementById(d[b]).innerHTML=d[b+1]};0<w.lang?(jk(w.lang),jk.translated=!0):ik();var P=console.log,Jm=document.getElementById("alerttitle"),Km=document.getElementById("alerttext"),Lm=document.getElementById("alert"),Ic=function(d,b,e){Lm.style.display="block";Jm.innerHTML=b||u.warning;Km.innerHTML=d;e?document.getElementById("alertok").style.display="none":document.getElementById("alertok").style.display=
"block";r("basic").style.filter="blur(94px)"},Mm=[1E3,0,2E3,0],lk=function(d,b,e){var f=new XMLHttpRequest;f.open("GET",d,!0);f.responseType="arraybuffer";f.onload=function(){b.length?kk(f.response,0):kk(f.response,86507520);ka.check()};f.onprogress=e;f.send(1)},kk=function(d,b){var e=performance.now();d=new Uint16Array(d);var f=d.length,c=d[f-4]+65536*d[f-3],h=d[f-2]+65536*d[f-1];f-=2;for(var l=-1,n=ka.common,t=b;c<f;c++){var k=d[c];if(65533<k){65535==k?(k=d[c+1],c+=1):(k=d[c+1]+65536*d[c+2],c+=
2);for(var B=0;B<k&&!(n[t++]=l,t-b>=h);B++);}else{k=d[2*k]+65536*d[2*k+1];n[t++]=k;if(t-b>=h)break;l=k}}P("nh17:",performance.now()-e)},Jc=function(){var d=["icons.png","images.json","graphics.nh17","terrainDataGrass.json","grass.nh17"];d=d.concat(Nh);var b=d.length;Jc.max=b;for(var e=0;e<b;e++)Nm(w.cdn+d[e]);this.innerHTML="0%";this.disabled=!0;Jc.button=this};Jc.loaded=0;var Nm=function(d){var b=new XMLHttpRequest;b.open("GET",d,!0);b.responseType="arraybuffer";b.setRequestHeader("Content-type",
" text / plain; charset = dropbox - cors - hack");b.onload=function(){Jc.loaded++;Jc.button.innerHTML=~~(100*Jc.loaded/Jc.max+.5)+"%"};b.send("")},ka={size:512,load:0,xtra:[],common:1,xtraRes:[]},Y={page:0,length:8,leftButton:document.getElementById("aleft"),rightButton:document.getElementById("aright"),stock:document.getElementById("stock")},m,Sb=function(d){d.target.loadedSize||(Sb.total+=d.total,d.target.lastLoaded=0,d.target.loadedSize=!0);Sb.progress+=d.loaded-d.target.lastLoaded;d.target.lastLoaded=
d.loaded;r("loadingtext").innerHTML=u.loadgraphics+~~(100*Sb.progress/Sb.total)+"%"};ka.check=function(){ka.load++;if(ka.load===ka.images){var d=k.createTexture();k.activeTexture(k.TEXTURE0);var b=ka.info;k.bindTexture(k.TEXTURE_2D,d);k.texImage2D(k.TEXTURE_2D,0,k.RGBA32F,512,512,0,k.RGBA,k.FLOAT,b);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT);k.texParameteri(k.TEXTURE_2D,
k.TEXTURE_WRAP_T,k.REPEAT);k.bindTexture(k.TEXTURE_2D,null);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,d);k.uniform1i(k.getUniformLocation(Ba,"u_image1"),0);k.activeTexture(k.TEXTURE1);d=k.createTexture();k.bindTexture(k.TEXTURE_2D_ARRAY,d);k.texParameteri(k.TEXTURE_2D_ARRAY,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D_ARRAY,k.TEXTURE_MIN_FILTER,k.NEAREST);b=performance.now();k.texImage3D(k.TEXTURE_2D_ARRAY,0,k.RGBA,ka.size,ka.size,ka.common.length/(ka.size*ka.size),0,
k.RGBA,k.UNSIGNED_BYTE,new Uint8Array(ka.common.buffer));P("3dtex",performance.now()-b);ka.common=void 0;k.activeTexture(k.TEXTURE1);k.bindTexture(k.TEXTURE_2D_ARRAY,d);k.uniform1i(k.getUniformLocation(Ba,"img_common"),1);k.useProgram(za);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D_ARRAY,d);k.uniform1i(k.getUniformLocation(za,"img_common"),0);k.activeTexture(k.TEXTURE2);Om();Xb.check()}};var Pm=function(d){ka.common=new Uint32Array(86507520+Uf[p.terrainType].size);r("loadingtext").innerHTML=
u.waitImages;ka.images=Object.keys(d).length;ka.load=0;Sb.progress=0;Sb.total=0;Date.now();if(Y.icons)ka.check();else{var b=new XMLHttpRequest;b.open("GET",d.icons,!0);b.responseType="arraybuffer";b.onreadystatechange=function(){if(4===b.readyState&&200===b.status){var d=new Uint8Array(b.response);d=new Blob([d],{type:"image/png"});var e=new Image;e.src=URL.createObjectURL(d);Y.icons=e;ka.check();Date.now()}};b.onprogress=Sb;b.send(1)}if(m)ka.check();else{var e=new XMLHttpRequest;e.open("GET",d.imageJSON,
!0);e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(ka.check(),m=JSON.parse(e.response),h&&Oh())};e.onprogress=Sb;e.send(1)}lk(d.common,"common",Sb);d=w.cdn;ka.images+=2;r("terrainSelect")&&(localStorage.terrain=r("terrainSelect").value);var f=Uf[p.terrainType],c=new XMLHttpRequest,h=!1;c.open("GET",d+f.json,!0);c.onreadystatechange=function(){if(4==this.readyState&&200==this.status){ka.xtraRes[0]=JSON.parse(c.response);oc=ka.xtraRes[0];var b=oc.specialColor;oe=new Float32Array(dc(b[0]/
255,b[1]/255,b[2]/255,.9));ka.check();h=!0;b="rgb("+b[0]+","+b[1]+","+b[2]+")";r("msgs1").style.color=b;r("playersinfo").style.color=b;r("topinfo").style.color=b;m&&Oh()}};c.onprogress=Sb;c.send(!0);lk(d+f.main,0,!1)},Uf={grass:{json:"terrainDataGrass.json",main:"grass.nh17",size:9437184},snow:{json:"terrainDataSnow.json",main:"snow.nh17",size:4980736},last:""},oe;(function(){"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/sworker.js").then(function(d){console.log("CLIENT: service worker registration complete.")},
function(d){P(d);console.log("CLIENT: service worker registration failure.")}),navigator.serviceWorker.oncontrollerchange=function(){console.log("page controlled by:",navigator.serviceWorker.controller);location.reload(!0)}):console.log("CLIENT: service worker is not supported.")})();var sc,Gd,Vf,Kc,Wf,Ph,pe,mk,qe,nk,ok,J,Xf,re,$a,Qh,Fa,Ca,Hf={},Nh="ts1.mp3 ts2.mp3 ts3.mp3 ts4.mp3 ts5.mp3 ts6.mp3 ts7.mp3 ts8.mp3 ts9.mp3 ts10.mp3 sr1.mp3 sr2.mp3 sr3.mp3 sr4.mp3 sr5.mp3 sr6.mp3 sr7.mp3 sr8.mp3 sr9.mp3 sr10.mp3 1.mp3 2.mp3 3.mp3 4.mp3 5.mp3 6.mp3 7.mp3 8.mp3 9.mp3 10.mp3 INTRO.mp3 OUTRO.mp3 WIN1.mp3 WIN2.mp3 ATTACK.WAV BALLISTA.WAV BLDGDONE.WAV CHAT%20LOCATION.WAV TECHDONE.WAV UNITDONE.WAV CHAT.WAV E_CASTLE1.WAV E_CATHEDRAL1.WAV E_CATHEDRAL2.WAV E_FARM1.WAV E_CHURCH1.WAV E_FARM2.WAV E_HARBOR1.WAV E_LUMBER1.WAV E_MAGETOWER1.WAV E_MAGETOWER2.WAV E_MAGETOWER3.WAV E_MARKET1.WAV E_SHIPYARD1.WAV E_STABLES1.WAV E_STORAGE1.WAV E_OUTPOST1.WAV E_STORAGE2.WAV E_TAVERN1.WAV E_WARACADEMY1.WAV E_WORKSHOP1.WAV EVILCASTLE.WAV GATE1.WAV GATE2.WAV GATE3.WAV GATE4.WAV GATE5.WAV GATE6.WAV GATEWAY.WAV HOUSE1.WAV HOUSE2.WAV HOUSE3.WAV HOUSE4.WAV HOUSE5.WAV MERCHANT.WAV MINE1.WAV MONASTERY1.WAV MONASTERY2.WAV R_CATHEDRAL1.WAV R_CHURCH1.WAV SHAOLIN2.WAV SHAOLIN.WAV CHOP%201.WAV CHOP%202.WAV CHOP%203.WAV CHOP%204.WAV CHOP%205.WAV CHOP%206.WAV CHOP%207.WAV CHOP%208.WAV CHOP%209.WAV CHOP%2010.WAV CHOP%2011.WAV DIG%201.WAV DIG%202.WAV DIG%203.WAV MINE%201.WAV MINE%202.WAV MINE%203.WAV HIT%201.WAV HIT%202.WAV HIT%203.WAV HIT%204.WAV HIT%205.WAV HIT%206.WAV HIT%207.WAV GHOST1.WAV GHOST2.WAV GOLEM1.WAV GOLEM2.WAV H%20SWORD%201.WAV H%20SWORD%202.WAV H%20SWORD%203.WAV H%20SWORD%204.WAV H%20SWORD%205.WAV H%20SWORD%206.WAV H%20SWORD%207.WAV H%20SWORD%207.WAV H%20SWORD%208.WAV H%20SWORD%209.WAV H%20SWORD%2010.WAV H%20SWORD%2011.WAV H%20SWORD%2012.WAV HAND1.WAV HAND2.WAV HAND3.WAV HAND4.WAV MAGE%20ATTACK.WAV MESSIAH.WAV ORC%20SWORD%201.WAV ORC%20SWORD%202.WAV ORC%20SWORD%203.WAV ORC%20SWORD%204.WAV ORC%20SWORD%205.WAV ORC%20SWORD%206.WAV ORC%20SWORD%20V1.WAV ORC%20SWORD%20V2.WAV ORC%20SWORD%20V3.WAV SHIP%20CANNON%201.WAV SHIP%20CANNON%202.WAV SHIP%20CANNON%203.WAV SHIP%20CANNON%204.WAV SHIP%20CANNON%205.WAV SHIP%20CANNON%206.WAV SHIP%20CANNON%207.WAV SIEGE.WAV SWORD%201.WAV SWORD%202.WAV SWORD%203.WAV SWORD%204.WAV SWORD%205.WAV SWORD%206.WAV SWORD%207.WAV SWORD%208.WAV SWORD%209.WAV SWORD%2010.WAV SWORD%2011.WAV SWORD%2012.WAV SWORD%2013.WAV SWORD%2014.WAV SWORD%2015.WAV SWORD%2016.WAV V%20SWORD%201.WAV V%20SWORD%202.WAV V%20SWORD%203.WAV V%20SWORD%204.WAV V%20SWORD%205.WAV V%20SWORD%206.WAV V%20SWORD%207.WAV ADRAGON2.WAV ADRAGON3.WAV ARROW%201.WAV ARROW%202.WAV ARROW%203.WAV ARROW%204.WAV ARROW%205.WAV ARROW%206.WAV ARROW%20V1.WAV ARROW%20V2.WAV ARROW%20V3.WAV ARROW%20V4.WAV BEAR1.WAV BEAR2.WAV BEAR3.WAV BEAR4.WAV BEAR5.WAV MWORKSHOP.WAV DESTROY%20BUILDING.WAV DESTROY%20MINE.WAV LIGHTING2.WAV LIGHTING.WAV METEOR.WAV SMALL%20EXPLOSION.WAV WATER%20BLOP.WAV SPY%20KILL%201.WAV SPY%20KILL%203.WAV SPY%20KILL%202.WAV PRIEST%20ATTACK.WAV LIGHTNING.WAV INVISIBLE.WAV HEAL.WAV FREEZE.WAV FLAME%20BALL.WAV CURSE.WAV CRUSADE.WAV CONFUSION.WAV BLESS.WAV WHIRLPOOL.WAV TURN%20TO%20STONE.WAV TEACH.WAV SUMMON10.WAV SUMMON9.WAV SUMMON8.WAV SUMMON7.WAV SUMMON6.WAV SUMMON5.WAV SUMMON4.WAV SUMMON3.WAV SUMMON2.WAV SUMMON1.WAV REVEAL.WAV RESSURECT.WAV COWDIE1.WAV COWDIE2.WAV COWDIE1.WAV COWDIE3.WAV COWDIE4.WAV DIE%201.WAV DIE%202.WAV DIE%203.WAV DIE%204.WAV DIE%205.WAV DIE%206.WAV DIE%207.WAV DIE%208.WAV DIE%209.WAV DIE%2010.WAV DRAGON%20DIE%201.WAV DRAGON%20DIE%202.WAV GHOST1.WAV GHOST2.WAV GOLEM.WAV H%20DIE%201.WAV H%20DIE%202.WAV H%20DIE%203.WAV H%20DIE%204.WAV H%20DIE%205.WAV H%20DIE%206.WAV H%20DIE%207.WAV H%20DIE%208.WAV H%20DIE%209.WAV H%20DIE%2010.WAV MAGE.WAV ORC%20DIE%201.WAV ORC%20DIE%202.WAV SHIP%20SINK.WAV SIEGE%20DIE%201.WAV SIEGE%20DIE%202.WAV SIEGE%20DIE%203.WAV SIEGE%20DIE%204.WAV SKELETON%20DIE%201.WAV SKELETON%20DIE%202.WAV SKELETON%20DIE%203.WAV SKELETON%20DIE%204.WAV MESSIAH_ATTACK.WAV C%20DIE%201.WAV C%20DIE%202.WAV C%20DIE%203.WAV C%20DIE%204.WAV C%20DIE%205.WAV CAMELDIE1.WAV CAMELDIE2.WAV CAMELDIE3.WAV BAT%20ATTACK.WAV BAT%20CMD.WAV BAT%20DIE.WAV".split(" "),
pk,ie,je,Rh=function(){if(!sc){Q.prototype.loadBuffer=function(b,d){var e=new XMLHttpRequest;e.open("GET",f+b,!0);e.responseType="arraybuffer";e.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");var c=this;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&c.context.decodeAudioData(e.response).then(function(e){e&&Ka(e,b,d)})};e.send()};for(var d=0,b=Nh.length;d<b;d++){var e=Nh[d];Hf[e.split(".")[0].toLowerCase()]=e}Gd="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206 arrow%20v1 arrow%20v2 arrow%20v3 arrow%20v4".split(" ");
Vf="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206".split(" ");Kc="sword%201 sword%202 sword%203 sword%204 sword%205 sword%206 sword%207 sword%208 sword%209 sword%2010 sword%2011 sword%2012 sword%2013 sword%2014 sword%2015 sword%2016 v%20sword%201 v%20sword%202 v%20sword%203 v%20sword%204 v%20sword%205 v%20sword%206 v%20sword%207".split(" ");Wf=["siege"];Ph=["hand1","hand2","hand3","hand4"];pe="h%20sword%201 h%20sword%202 h%20sword%203 h%20sword%204 h%20sword%205 h%20sword%206 h%20sword%207 h%20sword%208 h%20sword%209 h%20sword%2010 h%20sword%2011 h%20sword%2012".split(" ");
mk=["ork%20sword%20v1","ork%20sword%20v2","ork%20sword%20v3"];qe="ship%20cannon%201 ship%20cannon%202 ship%20cannon%203 ship%20cannon%204 ship%20cannon%205 ship%20cannon%206 ship%20cannon%207".split(" ");nk=["ghost%201","ghost%202"];ok=["mage%20attack"];J=["destroy%20building"];Xf=["siege%20die%201","siege%20die%202","siege%20die%203","siege%20die%204"];re="h%20die%201 h%20die%202 h%20die%203 h%20die%204 h%20die%205 h%20die%206 h%20die%207 h%20die%208 h%20die%209 h%20die%2010".split(" ");$a="die%201 die%202 die%203 die%204 die%205 die%206 die%207 die%208 die%209 die%2010".split(" ");
Qh=["e_barrack1"];var f=w.cdn;"undefined"!==typeof AudioContext&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,sc=new AudioContext,ie=sc.createGain(),je=sc.createGain(),pk=new Q(sc,void 0,Ka),P("Sound: OK"),ie.gain.value=parseInt(localStorage.musicRange)/100,je.gain.value=parseInt(localStorage.soundRange)/100);Fa=function(){if(!p.editor){Fa.id++;r("musicSelect")&&(localStorage.favMusic=r("musicSelect").mversion.value);var b=Fa.list[localStorage.favMusic];b&&Ca(b[~~(b.length*
Math.random())],0,0,void 0,1,0,Fa.id)}};Fa.reset=function(){Fa.stop();Fa()};Fa.stop=function(){Fa.active&&(Fa.active.stop(),clearTimeout(Fa.intv))};Fa.id=0;Fa.list={originalMusic1:[1,2,3,4,5,6,7,8,9,10,"outro"],originalMusic:"ts1 ts2 ts3 ts4 ts5 ts6 ts7 ts8 ts9 ts10".split(" "),sharpRain:"sr1 sr2 sr3 sr4 sr5 sr6 sr7 sr8 sr9 sr10".split(" ")};Ca=function(b,d,e,f,c,k,B){var g=b;if((b=Hf[b])&&"loading"!==b&&!p.canceled){var h=-gb+(window.innerWidth-w.mx)/2,l=-Fb+window.innerHeight/2;if(b.duration){if(p.started)if(64<
p.now()-b.lastPlayed||!b.lastPlayed)b.lastPlayed=p.now();else return;if(!(!c&&"attack"!=g&&k&&600<Date.now()-k)){if(d){d=-h+32*d;e=-l+32*e;l=X;if(d*d+e*e>Math.pow(2E3,2))return!1;d/=80;e/=80;l/=8}else l=e=d=0;void 0!==f&&f!==w.kingdom||p.mute||(f=sc.createBufferSource(),f.buffer=b,c?(f.connect(ie),ie.connect(sc.destination),Fa.active=f,Fa.intv=setTimeout(Fa,~~(1E3*b.duration)+1E3)):(b=sc.createPanner(),b.panningModel="HRTF",b.setPosition(d,e,l),f.connect(b),b.connect(je),je.connect(sc.destination)),
f.start(0))}}else Hf[g]="loading",c={x:d,y:e,k:f,music:c,date:Date.now(),mid:B},pk.loadBuffer(b,c)}}}},se=function(d,b,e,f){d.img===f.url&&(Ca(b+~~(Math.random()*e+1),d.x32,d.y32),setTimeout(se,tb(f),d,b,e,f))};"use strict";var Qm=function(d){for(var b=[],e=0,f=[d.icons],c=0,h=f.length;c<h;c++)for(var l=f[c],n=0,t=l.length;n<t;n++)if(l[n]){var k=l[n];k.doneBy||(k.doneBy=[]);k.doneBy.put(d);b[e++]=k;k.xtra&&(f.put(k.xtra),h++)}d.habilities=b},Rm=function(d,b){return b.balanceTotal-d.balanceTotal},
Sh=function(d,b){return b.priority-d.priority},Yf=function(d,b){if(!d.url.attack||d.attackOnly&&!d.attackOnly[b.type])return 0;var e=25*~~(tb(d.url.attack)/25);d=d.attack*((te[d.type][b.type]||0)+1);d-=b.defence;1>d&&(d=1);return~~(b.health/d)*e},Qa=function(d){this.kingdom=d.k;this.aggressive=this.perfection=1;this.cantBuild={};this.houseLoading=0;this.mineGroup={};d.IAD=Qa.arr.length;Qa.arr.put(this)};Qa.prototype.valorateLost=function(d){this.script&&this.script.put({order:d.nu,obj:d,priority:1})};
var Th=function(d,b,e,f,c){var g=e.obj.cost;f[0]+=g[0];f[1]+=g[1];f[2]+=g[2];f[3]+=g[3];d[d.length]={order:e,priority:b.priority,name:e.obj.name,obj:e.obj,pTime:b.obj.time,required:1,doner:c};d.changed=!0},Uh=function(d,b,e,f){var c=[d],h=[],l={},n=f.target;h.put(d);for(var t=0;t<c.length;t++){var k=c[t];k.availables&&(k.availables=void 0);if((d=k.order)&&!l[k.order.id]){l[k.order.id]=1;var B=d.requireObj;if(B)for(var q=0,m=B.length;q<m;q++)if(d=B[q],d.tech)b[d.nu.id]||Th(c,k,d.nu,n);else{var p=e[d.type];
p.length||Th(c,k,d.nu,n)}if(B=d.doneBy)for(q=0,m=B.length;q<m;q++)d=B[q],p=e[d.type],p.length||d.race!=f.racestr||Th(c,k,d.nu,n,1);t&&!k.doner&&h.put(k)}}return h},Vh={food:2,wood:1,gold:0,stone:3},tc=function(d,b){d=d.order;var e=d.obj,f=tc.tech;e.build?f=tc.build:e.tech||(f=tc.unit);return f(d,b)};tc.unit=function(d,b){d=d.doneBy;if(b.pop<b.popMax)for(var e=0,f=d.length;e<f;e++)for(var c=b[d[e].type],h=0,l=c.length;h<l;h++){var n=c[h];if(n.free)return[n]}return!1};tc.tech=function(d,b){d=d.doneBy;
for(var e=0,f=d.length;e<f;e++)for(var c=b[d[e].type],h=0,l=c.length;h<l;h++){var n=c[h];if(n.free)return[n]}return!1};tc.build=function(d,b,e){d=d.doneBy;e=0;for(var f=d.length;e<f;e++)for(var c=b[d[e].type],h=0,l=c.length;h<l;h++){var n=c[h];if(n.free)return[n]}return!1};tc.sPeasant=function(d){for(var b=[10,79,64],e=[],f=0,c=0,h=b.length;c<h;c++)for(var l=d[b[c]],n=0,t=l.length;n<t;n++)l[n].free&&(e[f++]=l[n]);return e};var Lc=function(d,b,e){if(d){d=d.order;var f=d.obj,c=Lc.unit;f.tech?c=Lc.tech:
f.build&&(c=Lc.build);return c(d,b,e)}};Lc.build=function(d,b,e){var f=Qa.arr[b.IAD];if(4<=f.cantBuild[d.obj.type]&&b.stats.buildsLosed==f.buildsLosed)return!1;for(var c=[],h=d.doneBy,l=xa[b.k],n=0,t=h.length;n<t;n++)for(var k=l[h[n].type],B=0,q=k.length;B<q;B++){var m=z[k[B]];if(!m.func&&!m.in||e){c.put(m.id);break}}if(!c.length)return!1;e=F;m=d.obj;d=b.origin[0];h=b.origin[1];l=h-1;n=d-1;t=Qa.arr[b.IAD].reserved;if(k=t.added[m.type]){B=m.space;var p=m.rbase(),r=k%e,u=~~(k/e),v=B[B.length-1];q=(B.length-
1)/v*v;for(B=0;B<q&&!p(r+B%v+(~~(B/v)+u)*e);B++);if(B==q)for(t.added[m.type]=!1,B=0;B<q;B++)t[r+B%v+(~~(B/v)+u)*e]=0;else k=-1}else k=-1;0>k&&(k=Zf(d,h,80,l,n,b,m,900));if(0>k)return f.cantBuild[m.type]||(f.cantBuild[m.type]=0),f.cantBuild[m.type]++,f.buildsLosed=b.stats.buildsLosed,!1;f.cantBuild[m.type]&&(f.cantBuild[m.type]=0);O(Mc,[k,m.type],c);return!0};var Zf=function(d,b,e,f,c,h,l,n){var g=Qa.arr[h.IAD].reserved,k=F,m=l.space;l=l.validator.check;if(!l)return-1;for(var q=-1,p=e/2*(e/2),K=1,
r=d,u=b;0>q&&d-r<e/2;){--r;--u;for(var v=2*K+1,z=2*K+1,w=0,x=v*z;w<x;w++){var y=w%v,A=~~(w/v);if(!y||!A||y==v-1||A==z-1){y+=r;A+=u;var H=(y-d)*(y-d)+(A-b)*(A-b);if(H<p&&l(y,A,m,f,c,H<n,h.k,g)){q=y+A*k;break}}}K++}return q};Lc.tech=function(d,b,e){e=d.doneBy;b=xa[b.k];for(var f=[],c=0,h=e.length;c<h;c++)for(var l=b[e[c].type],n=0,t=l.length;n<t;n++){var k=z[l[n]];k.working||k.techStart||!k.built||f.put(k.id)}if(!f.length)return!1;O($f,[d.obj.id,d.id],f[0]);return!0};Lc.unit=function(d,b,e){e=d.doneBy;
b=xa[b.k];for(var f=[],c=0,h=e.length;c<h;c++)for(var l=b[e[c].type],n=0,t=l.length;n<t;n++){var k=z[l[n]];k.working||k.techStart||!1===k.built||f.put(k.id)}if(!f.length)return!1;O(ue,[d.obj.type,1,0],f[0]);return!0};Qa.prototype.leaveMeAloneIKnowWhatToDo=function(){performance.now();var d=H[this.kingdom],b=d.resources,e=xa[this.kingdom],f=F;if(d.origin){var c=d.origin[0],h=d.origin[1],l=d.race+"-"+b[0]+""+b[1]+""+b[2]+""+b[3];if(Qa.precooked[l])ua=Qa.precooked[l].slice(0);else{for(var n=h-1,t=c-
1,k=c-40,m=h-40,q=0,T=-1,K=6400,r=0;r<K;r++){var u=r%80+k,v=~~(r/80)+m;1600>(c-u)*(c-u)+(h-v)*(h-v)&&(!(u>=t&&u<=t+2)||v>=n&&v<=n+2)&&0===V[u+v*f]&&qa(u,v)&&q++}var w=[];performance.now();for(var y=0,x=0,G=A.length;x<G;x++){var D=A[x];if(!D.build&&!D.item&&!D.boat&&D.url.attack&&D.race==d.racestr&&8!=D.type&&void 0==D.res){w.put(D);D.balanceSum=0;D.bestBalance=-1;D.balanceDefence={};for(var I=Infinity,L=D.attDist,O=0;O<G;O++){var J=A[O];if(!J.build&&!J.item&&!J.boat&&J.race==d.racestr&&J.url.attack&&
8!=J.type&&void 0==D.res&&(y=Yf(J,D))){var Q=Yf(D,J);Q&&(y-=Q,y+=2E3*L,y<I&&(I=y,D.bestBalance=J),D.balanceSum+=y)}}D.balanceTotal=D.balanceSum}}w.sort(Rm);D=w[0];for(var N=1E3,U={},R=[],Y=0,aa=N;!U[D.type];)U[D.type]=1,R[Y++]=D,R[Y++]=N,J=D.bestBalance,N=~~(N*Yf(J,D)/Yf(D,J)+.5),aa+=N,D=J;R.nu=aa-N;P(R);for(var Z=d.target,da=C,ba=da.length,W=[],M=0;M<ba;M++){var X=da[M],ea;if(!(ea=!X.type||X.upgrade||X.type==ha||void 0!==Vh[X.value]&&d.resources[X.value]>=Z[X.value])){a:{for(var ja=X.nu.doneBy,ia=
0,la=ja.length;ia<la;ia++)if(ja[ia].race==d.racestr){var ka=!0;break a}ka=!1}ea=!ka}ea||W.put({order:X.nu,obj:X,original:1,priority:1E-10})}var fa=[];r=0;K=R.length;for(var na=R.nu;r<K;r+=2){var ma=~~(.5+R[r+1]/na*250)-e[R[r].type].length,S=R[r],oa=S.type;S=S.nu;for(var ca=0;ca<ma;ca++)W.put({order:S,priority:1-ca/ma,obj:S.obj,original:1})}var pa=0,wa=0,ra=d.target,ta={};wa++;ra[0]=0;ra[1]=0;ra[2]=0;ra[3]=0;r=pa=fa.length=0;for(K=W.length;r<K;r++){var Ca=W[r].priority,Ba=Uh(W[r],d.technology.investigated,
e,d);ca=0;for(var za=Ba.length;ca<za;ca++){S=Ba[ca];S.original||(S.priority=Ca);var sa=1;void 0!==S.priority&&(sa=S.priority);var va=S.obj;va.increase&&void 0!==Vh[va.value]&&(sa=va.increase*sa/b[Vh[va.value]]);sa/=va.time;S.priority=sa;if(!(0>=S.priority)){var Da=S.order.id;!ta[Da]||S.original?(ta[Da]=pa,fa[pa++]=S):fa[ta[Da]].priority+=S.priority}}}var Ga=!1;fa.sort(Sh);var Ha={},Ja={},Ea={},ua=[],Wa=A.length;for(r=0;r<Wa;Ea[r++]=0);for(r=0;r<fa.length;r++){var Ya=fa[r];S=Ya.order;var Fa=Ya.obj;
if(Ya.original||Ya.required)Ya.obj.tech||Ea[Ya.obj.type]++,ua.put(Ya);var Ua=S.doneBy,Ta=Fa.time;ca=0;for(K=Ua.length;ca<K;ca++){var Aa=Ua[ca],jb=Aa.time;if(Aa.race===d.racestr){if(Fa){for(var kb=Aa,ab=e[Aa.type],bb=Qa.process,qb=Ta,sb=ab.length,Sa=!1,cb=Infinity,db=0;db<sb;db++){var ib=z[ab[db]],Ka=0;ib.build&&(ib.working||ib.techStart||!ib.built)&&(ib.built?(Ka=(ib.c-p.cycle)*Nc.speed,Ka/=1E3):(Ka=ib.time*(ib.maxHealth-ib.health)/ib.maxHealth,ib.workers&&ib.workers.length&&(Ka/=ib.workers.length)));
ib.build||!ib.func&&!ib.in||(Ka=Infinity);ib.nato!=bb?(ib.nato=bb,ib.natoTime=0):Ka+=ib.natoTime;Ka<cb&&(cb=Ka,Sa=ib)}Sa&&cb<=kb.time?(Sa.natoTime+=qb,Ga=Sa):Ga=!1}if(!Ga){Ha[Aa.type]||(Ha[Aa.type]=[],Ja[Aa.type]=[]);var Oa=Ha[Aa.type],mb=Ja[Aa.type];Ea[Aa.type]||(Ea[Aa.type]=0);var xb=!1,Ia=0;for(za=Oa.length+1;Ia<za;Ia++){if(void 0==Oa[Ia]){var pb={order:Aa.nu,priority:0,obj:Aa};fa.put(pb);ua.put(pb);Oa[Ia]=0;mb[Ia]=pb;Ea[Aa.type]++;xb=!0}if(Oa[Ia]+Ta<=jb||xb){Oa[Ia]+=Ta;mb[Ia].priority+=Ya.priority;
break}}}}}}ua.sort(Sh);var hb=0;r=0;for(K=ua.length;r<K;r++)if(Ya=ua[r].obj,Ya.build){var Pa=Ya.space[Ya.space.length-1]+2,tb=(Ya.space.length-1)/Pa+2;hb+=Pa*tb}P(hb,q);if(hb>q){var Cb=q/hb*.7;r=0;for(K=A.length;r<K;r++)A[r].build&&(Ya=Ea[r])&&((Ya=~~(Ya*Cb))||(Ya=1),Ea[r]=Ya)}r=0;for(K=ua.length;r<K;r++)Ya=ua[r].obj,Ya.build&&(Ea[Ya.type]?Ea[Ya.type]--:ua[r]=0);for(var Ma=ua,Xa=new Uint32Array(14),Za=new Uint32Array(7),$a=new Uint32Array(7),gb=new Uint32Array(7),Fb=6.25,Bb=d.resources,Hb=[Za,gb,
Xa,$a],ya=0,Na=0,Db=0;3>Db;Db++){var ub=Bb[0],ob=Bb[1],yb=Bb[2],zb=Bb[3];Infinity==ub&&Infinity==ob&&Infinity==yb&&Infinity==zb&&(Fb=-1);var Jb=0,Kb=0,Lb=0,Mb=0;ya=0;for(Na=Ma.length;ya<Na;ya++)if(Ma[ya]){var Eb=Ma[ya].obj.cost;Jb+=Eb[0];Kb+=Eb[1];Lb+=Eb[2];Mb+=Eb[3]}if(Db){for(ya=0;ya<Xa.length;Xa[ya++]=0);for(ya=0;ya<Za.length;Za[ya++]=0);for(ya=0;ya<$a.length;$a[ya++]=0);for(ya=0;ya<gb.length;gb[ya++]=0);}var Gb=[],Qb={},Sb={},nb={pop:0,popMax:2E3},Ib=[[]];ya=0;for(Na=e.length;ya<Na;ya++){Ra=e[ya];
var Ub=[];nb[ya]=Ub;for(var vb=0,Nb=Ra.length;vb<Nb;vb++)Ub[vb]={free:1,type:ya}}for(var eb=0;9E3>eb;){var bc=10*ag(Za)/7,cc=10*ag(gb)/7,Wb=10*ag(Xa)/14,dc=10*ag($a)/7;ub+=10*Za[eb%Za.length];ob+=10*gb[eb%gb.length];yb+=10*Xa[eb%Xa.length];zb+=10*$a[eb%$a.length];var Tb=Ib[eb];if(Tb)for(ya=0,Na=Tb.length;ya<Na;ya++){var Va=Tb[ya],lb=Va.list;vb=0;for(Nb=lb.length;vb<Nb;vb++){var Ra=lb[vb];Ra.used||(Ra.used=!0,Gb.put(Ra.action));Ra.free=1}var ec=Va.action&&(Va.action.original||Va.action.required)?!0:
!1;if(Va.obj.tech){Qb[Va.obj.nu.id]=1;var Yb=Va.obj;"popLimit"==Yb.value&&(nb.popMax+=Yb.increase)}else Va.obj.build||nb.pop++,nb[Va.obj.type].put({free:1,type:Va.obj.type,action:Va.action,used:ec})}ya=0;for(Na=Ma.length;ya<Na;ya++)if(Ra=Ma[ya]){var $b=Ra.obj;if($b.peon||!(Wb<Fb)){var wb=$b.cost;if(!(wb[0]>ub||wb[1]>ob||wb[2]>yb||wb[3]>zb)&&1===Uh(Ra,Qb,nb,d).length&&(lb=tc(Ra,nb))){var Vb=Ra.obj.time+eb;Ib[Vb]||(Ib[Vb]=[]);if(Ra.obj.tech){if(Sb[Ra.order.id])continue;Sb[Ra.order.id]=1}Ma[ya]=void 0;
(Ra.original||Ra.required)&&Gb.put(Ra);for(var ac=0;ac<lb.length;lb[ac++].free=0);Ib[Vb].put({list:lb,obj:Ra.obj,action:Ra});ub-=wb[0];ob-=wb[1];yb-=wb[2];zb-=wb[3]}}}lb=tc.sPeasant(nb);ya=0;for(Na=lb.length;ya<Na;ya++){var Pb=qk(bc,cc,Wb,dc,ub,ob,yb,zb,Jb,Kb,Lb,Mb);if(0>Pb)break;2===Pb&&(ob-=200);Hb[Pb][eb%Hb[Pb].length]++;Ra=lb[ya];Ra.free=0;Ra.used||(Ra.used=!0,Gb.put(Ra.action))}eb++}Ma=Gb;Ma.sort(Sh)}for(var Ab=ua=Ma,Rb={},rb=0;rb<Ab.length;rb++)Ab[rb]&&!Ab[rb].obj.tech&&(Rb[Ab[rb].obj.name]||
(Rb[Ab[rb].obj.name]=0),Rb[Ab[rb].obj.name]++,"Blacksmith"==Ab[rb].obj.name&&P(Ab[rb]));P(Rb);Qa.precooked[l]=ua}this.script=ua;var Xb={},fc={added:Xb};this.reserved=fc;r=0;for(K=ua.length;r<K;r++)if((S=ua[r])&&(Fa=S.obj)&&Fa.build&&void 0==Xb[Fa.type]&&(T=Zf(c,h,80,n,t,d,Fa,900),-1<T)){u=T%f;v=~~(T/f);oa=Fa.type;Xb[Fa.type]=T;var Zb=Fa.space;Pa=Zb[Zb.length-1];tb=(Zb.length-1)/Pa;var gc=Pa*tb;for(ca=0;ca<gc;ca++)fc[u+ca%Pa+(~~(ca/Pa)+v)*f]=oa}}};var ag=function(d){for(var b=0,e=d.length,f=0;f<e;b+=
d[f++]);return b},qk=function(d,b,e,f,c,h,l,n,t,k,m,q){if(Infinity==c&&Infinity==h&&Infinity==l&&Infinity==n)return-1;if(6.25>e)return 200>h?1:2;c=t+q+m+k;h=d+b+e+f;d/=t/c*h;b/=k/c*h;e/=m/c*h;f/=q/c*h;return d<b&&d<e&&d<f?0:b<e&&b<f?1:e<f?2:3},Wh=function(){for(var d=0,b=Qa.arr,e=b.length;d<e;b[d++].maintenance());kb({func:Wh},Qa.time,1);Qa.process++},rk=function(d,b,e){for(var f=d.length,c=Infinity,h=0,l=0;l<f;l++){var n=z[d[l]],t=Math.pow(b-n.x32,2)+Math.pow(e-n.y32,2);t<c&&(c=t,h=n.id)}return h};
Qa.prototype.maintenance=function(){var d=this.script;if(d){var b=H[this.kingdom];if(b.origin){p.blocked=!0;var e=b.technology.investigated,f=xa[b.k],g=F,h={};if(b.values.pop+b.unitLoading+5>b.values.popMax&&b.values.popMax<=b.values.popLimit){for(var l=Cb[b.race].house.nu,n=0,t=0,k=b.building,m=k.length;t<m;t++){var q=z[k[t]];q.population&&(n+=q.population)}b.values.pop+b.unitLoading+5>b.values.popMax+n&&Lc({order:l,priority:1,obj:l.obj},b,!0)}k=b.resources;l=k[0];n=k[1];var T=k[2],r=k[3],u=[];if(Infinity!=
l||Infinity!=n||Infinity!=T||Infinity!=r){q=0==b.race?c.createPeon.obj:1==b.race?c.createPeon2.obj:c.createPeon1.obj;var v=0,w=0,y=0,x=0;t=0;for(m=d.length;t<m;t++)if(d[t]){var D=d[t].obj.cost;v+=D[0];w+=D[1];y+=D[2];x+=D[3]}var C=D=0,I=0,L=0,J=f[q.type];t=0;for(m=J.length;t<m;t++)if(q=z[J[t]],40==q.func)21==z[q.funcObj.u].type?D+=10/7:L+=10/7;else if(43==q.func)I+=10/14;else if(42==q.func)C+=10/7;else{if(19==q.func&&q.stock){var N=q.stock[1];0==N?D+=10/7:1==N?C+=10/7:2==N?I+=10/14:L+=10/7}(19!=q.func||
q.action)&&q.func||u.put(q)}}t=0;for(m=d.length;t<m;t++)!(q=d[t])||!q.order||h[q.order.id]||6.25>I&&!q.obj.peon||(J=Uh(q,e,f,b).length,N=q.obj.cost,N[0]>k[0]||N[1]>k[1]||N[2]>k[2]||N[3]>k[3]||1===J&&(Lc(q,b)?d[t]=0:h[q.order.id]=1));if(u.length)for(d=-Infinity,t=0,k=b.building,m=k.length;t<m;t++){q=z[k[t]];if(q.population)break;q=q.time*(1-q.health/q.maxHealth);q>d&&(d=q)}t=0;for(m=u.length;t<m;t++)if(q=u[t],k=qk(D,C,I,L,l,n,T,r,v,w,y,x),0==k)(k=rk(xa[0][21],q.x32,q.y32))&&sk(k,q,this,b);else if(1==
k)tk(q);else if(2==k){a:{k=f[20];d=k.length;for(e=0;e<d;e++)if(h=z[k[e]],!h.workers.length&&14E3<25*(p.cycle-h.lastUse)){h.lastUse=p.cycle+100;k=h;break a}k=void 0}if(k)O(uc,k.id,[q.id]);else{J=xa[b.k];k=F;N=Tb[2];d=[];d.length=N.length;e=0;for(h=N.length;e<h;d[e]=J[N[e++]]);J=Infinity;N=A[20].space;var R=-1;e=0;for(h=d.length;e<h;e++)for(var Q=d[e],U=0,V=Q.length;U<V;U++){var P=z[Q[U]],Y=P.x32-10,aa=P.y32-10,S=P.space[P.space.length-1],Z=P.x32+.5*S;P=P.y32+.5*(P.space.length-1)/S;for(S=0;400>S;S++){var X=
S%20,W=~~(S/20);X+=Y;W+=aa;var da=(X+1-Z)*(X+1-Z)+(W+1-P)*(W+1-P);da<J&&Xh(X,W,N)[1]&&(R=X+W*k,J=da)}}k=R;-1<k&&(O(Mc,[k,20],[q.id]),n-=200)}}else 3==k&&(k=rk(xa[0][22],q.x32,q.y32))&&sk(k,q,this,b);f=!1;x=Infinity;I=b.diplomacy;w=b.origin[0];y=b.origin[1];v=xa[b.k];t=1;for(m=H.length;t<m;t++)I[t]&&!H[t].death&&H[t].origin&&(q=H[t],D=q.origin[0]-w,C=q.origin[1]-y,b=D*D+C*C,b<x&&(x=b,f=q));if(f){b=[];t=D=0;for(m=v.length;t<m;t++)for(C=v[t],x=0,I=C.length;x<I;x++)q=z[C[x]],void 0!=q.func||q.standardFunc!=
G||q.death||q.build||(b[D++]=q.id);if(60<b.length){q=f.origin[0];v=f.origin[1];k=[40,0,-40,0,0,40,0,-40];x=Infinity;t=0;for(m=k.length;t<m;t+=2)if(D=k[t],C=k[t+1],D+=w+10*Math.sign(D),C+=y+10*Math.sign(C),(D-q)*(D-q)+(v-C)*(v-C)<x&&qa(D,C)){x=(D-q)*(D-q)+(v-C)*(v-C);var ba=D+C*g}m=ba%g;w=~~(ba/g);y=-1;D=Infinity;v=xa[f.k];t=0;for(length=v.length;t<length;t++)for(f=v[t],x=0,C=f.length;x<C;x++)q=z[f[x]],I=(q.x32-m)*(q.x32-m)+(q.y32-w)*(q.y32-w),I<D&&(D=I,y=q.x32+q.y32*g);-1<y&&O(Yh,[ba,y],b)}}p.blocked=
!1}}};var sk=function(d,b,e,f){var c=Cb[b.race].storage,h=z[d],l=z[e.mineGroup[d]];!l&&f.paypalTest(c.cost)?(h=Zf(h.x32+2,h.y32+2,20,0,0,f,c,0),-1<h&&O(Mc,[h,c.type],[b.id]),e.mineGroup[d]=f.building[f.building.length-1]):l&&!1===l.built?O(vc,l.id,[b.id]):O(uc,d,[b.id])},tk=function(d){for(var b=H[d.kingdom],e=xa[b.k],f=Tb[1],c=0,h=f.length;c<h;c++)for(var l=e[f[c]],n=0,t=l.length;n<t;n++){var k=z[l[n]];if(!k.castle){if(!1===k.built)return O(vc,k.id,[d.id]);if(k=uk(k.x32,k.y32,.075))return O(uc,k,
[d.id])}}l=b.building;c=0;for(h=l.length;c<h;c++)if(k=z[l[c]],1===k.storage)return O(vc,k.id,[d.id]);e=Cb[d.race].lumbermill;f=b.origin[0];l=b.origin[1];c=1;h=b.resources;n=e.cost;if(n[0]<h[0]&&n[1]<h[1]&&n[2]<h[2]&&n[3]<h[3])for(;80>c;){--f;--l;t=2*c+1;k=2*c+1;n=0;for(h=t*k;n<h;n++){var m=n%t,q=~~(n/t);if(!m||!q||m==t-1||q==k-1)if(m+=f,q+=l,-1<uk(m,q,.15,!0)&&(m=Zf(m,q,8,0,0,b,e,0),-1<m))return O(Mc,[m,e.type],[d.id])}c++}b=xa[0][7];c=b.length;h=Infinity;for(e=n=0;e<c;e++)f=z[b[e]],l=Math.pow(d.x32-
f.x32,2)+Math.pow(d.y32-f.y32,2),l<h&&(h=l,n=f.id);(b=n)&&O(uc,b,[d.id])},uk=function(d,b,e,f){var c=F,h=d,l=b;d-=5;b-=5;for(var n=0,t=-1,k=Infinity,m=0;100>m;m++){var q=m%10,p=~~(m/10);q+=d;p+=b;if(qa(q,p)){var r=z[V[q+p*c]];if(f&&1==r.storage)return-1;7===r.type&&(n++,q=Math.pow(q-h,2)+Math.pow(p-l,2),q<k&&(k=q,t=r.id))}}if(n/100>=e)return t},Yh=function(d,b){var e=F,f=d[0];d=d[1];var c=d%e;e=~~(d/e);for(var h=0,l=b.length;h<l;h++){var n=z[b[h]];6400<(n.x32-c)*(n.x32-c)+(n.y32-e)*(n.y32-e)?ca(-f,
n,ve,n.url.move):ca(-d,n,ve,n.url.move)}bg(!1,b);kb({func:vk,data:{list:b,xy:-d}},3E4,1)},vk=function(d){var b=d.list;d=d.xy;for(var e=0,f=b.length;e<f;e++){var c=z[b[e]];c.death||ca(d,c,ve,c.url.move)}},Zh=function(d){var b=d.x32+d.y32*F,e=H[d.kingdom].diplomacy;!d.invisible&&nc[b]&&(b=z[nc[b]],!b.freezed&&e[b.kingdom]&&wc(d.id,[b.id],0,Hd))},wd=function(d){var b=$h(d.id);return b?(wc(b,[d.id],0,Hd),!0):!1},$h=function(d,b){d=z[d];return WASMRadar(d.x32,d.y32,d.sight,d.id)},Sm=function(d){d.setupINTV(wk,
d.id,1E3)},wk=function(d){d=z[d];var b=d.free;b||(b=xk);var e=F,f=d.x32,c=d.y32,h=[];h.length=H.length;for(var l=h.length,n=0;n<l;h[n++]=0);n=0;for(var t=b.length;n<t;n+=2){var k=b[n]+f,m=b[n+1]+c;qa(k,m)&&(k=z[V[k+m*e]],k.nocapture||k.build||h[k.kingdom]++)}e=b=0;for(n=1;n<l;n++)h[n]>b&&(e=n,b=h[n]);b&&d.kingdom!=e&&d.changeKingdom(e);Va(d,1E3)},Mf,Tm=[1,1],yk=function(){return 25*(Date.now()-p.loadDate+p.pausedTime+p.deltaTime)/Nc.speed},lb=function(d){if(!(d&&p.online||lb.bySystem&&d))if(0===p.paused){p.paused=
1;void 0!=Mf&&clearInterval(Mf);var b=p.now();p.pausedTime+=Date.now();d||(lb.bySystem=1);p.now=function(){return b}}else p.pausedTime-=Date.now(),p.paused=0,lb.bySystem=0,d&&(document.getElementById("alert").style.display="none"),Mf=setInterval(Nc,Nc.speed),p.now=yk};lb.bySystem=0;lb.fast=!0;var ec=function(d,b){var e=!1;if(1>d){d*=-1;var f=~~(d/sa),c=d%sa}else e=d;d=0;for(var h=b.length;d<h;d++){var l=z[b[d]];l.build||l.cow&&l.workers.length||e==l.id||l.freezed||l.in||l.stoned||(l.action=null,l.distance=
0,l.mv&&null!=l.xf?(e?(l.xf=e,l.yf=!0):(l.xf=c,l.yf=f),l.nodes=void 0):l.x32==c&&l.y32==f?l.stay():(l.dix=(c-l.x32)/Math.abs(c-l.x32),l.diy=(f-l.y32)/Math.abs(f-l.y32),e?(l.xf=e,l.yf=!0):(l.xf=c,l.yf=f),l.mv=!0,l.setupINTV(we,l.id,0),ai(l),l.action=null))}},ai=function(d){d.stock&&0!==d.stock[0]?(d.mimg=d.url[d.stock[4].url],d.stock[3]===Oc&&(d.mimg=d.url.milk)):d.mimg=d.url.move};ec.cursor=7;ec.allowPos=1;var Va=function(d,b,e){b=~~(b/25)+p.cycle;e=dd[b];e||(e=[],dd[b]=e);var f=e.length;d.c=b;e[f]=
d.id;d.timestamp=p.now()},dd={},cg=function(d){var b=z[d[0]];if(!b.death){var e=d[1],f=d[2],c=d[3];b.cow&&"milk"==e&&b.workers&&b.workers.length||(b[e]+=H[b.kingdom].values[f],f=b[e+"Max"],b[e]>f&&2!==b.blocked&&(b[e]=f));"mana"==e&&(f=b.manaTask)&&f[2]<=b[e]&&(b.blockedAction(1),ca(f[1],b,Yb[f[0]],b.url.move),b.manaTask=void 0);M(b.id,1);kb({func:cg,data:d},c,1)}},kb=function(d,b,e){d.func.url||P(d.func);d.func=d.func.url;e&&(b=~~(b/25)+p.cycle);e=cd[b];e||(e=[],cd[b]=e);e.put(d)},cd={},we=function(d){d=
z[d];var b=F,e=!1;d.waiting&&ai(d);var f=d.y32,c=d.x32;bi(1,d,"zone");var h=Yb[d.action];Hb(d,32*f);var l=d.rbase(),n=l.write,t=c+f*b;Zh(d);if(d.id===l(t)){var k=d.size;if(2>k)n(t,d.radix);else for(var m=k*k,q=-b,p=0;p<m;p++){var r=p%k;0===r&&(q+=b);n(t+r+q,0)}}if(d.stop)return n(t,d.id),d.stay(),d.stop=void 0,0;if(d.kx||d.ky){var u=d.kx||0,v=d.ky||0;m=!1;if(0!==l(u+c+(v+f)*b))return d.aspettare()}else{h&&h.rev&&(m=h.rev(d))&&(d.action=m[0],h=Yb[d.action],d.xf=m[1],d.yf=!0);if(!0===d.yf){m=d.xf;var w=
z[m];if(!w||w.death&&(!h||!h.available))return n(t,d.id),d.stay();p=!0;q=!1;if(h&&h.available){q=h.available(d,w);if(!1===q)return d.aspettare();if("kill"===q)return n(t,d.id),d.stay();if(55===q)return n(t,d.id);p=q[2]}else w.death||(q=Pc(w,d,50,d.radix));d.xf!==m&&(w=z[d.xf]);if(!w||w.death||w.in)return n(t,d.id),d.stay();if(!p&&(x+y*b===t||h))return d.aspettare();var x=q[0],y=q[1];if(h&&h.distance){var A=h.distance;A=0>A?d.attDist:H[d.kingdom].values[A];q=ci(w,c,f);xe(c,f,q%F,~~(q/F),A)&&(e=2)}d==
w&&(e=2)}else{x=d.xf;y=d.yf;m=l(x+y*b);if(2<m&&(!h||h&&h.rev)){m=z[m];q=Pc(m,d,50,d.radix);if(!1===q)return n(t,d.id),d.stay();x=q[0];y=q[1]}h&&h.distance&&(A=h.distance,A=0>A?d.attDist:H[d.kingdom].values[A],xe(c,f,x,y,A)&&(e=2))}m=x+y*b;q=x;p=y;if(!e){v=WASMovement(c,f,q,p,d.radix,d.zLevel);void 0!==v?(u=-c+v%b,v=-f+~~(v/b)):v=u=1;if(1<Math.abs(u)||1<Math.abs(v))return d.aspettare();if(l(c+u+(f+v)*b)!==d.radix||!qa(c+u,f+v)){u=[c+1,f,c-1,f,c+1,f+1,c+1,f-1,c,f-1,c-1,f+1,c,f+1,c-1,f-1];v=F;r=Infinity;
for(var D,C=0;C<u.length;C+=2)0===l(u[C]+u[C+1]*v)&&qa(u[C],u[C+1])&&r>=(u[C]-q)*(u[C]-q)+(u[C+1]-p)*(u[C+1]-p)&&(r=(u[C]-q)*(u[C]-q)+(u[C+1]-p)*(u[C+1]-p),D=C);q=[u[D],u[D+1]];u=q[0]-c;v=q[1]-f;u=0<u?1:0>u?-1:0;v=0<v?1:0>v?-1:0;if(l(c+u+(f+v)*b)!==d.radix||!qa(c+u,f+v))return d.aspettare()}}}if(t==m||e)if(n(c+f*b,d.id),d.x32=c,d.y32=f,h){if(h.distance&&2!==e)return d.aspettare();d.stay(1);w||(w=x+y*b);d.action=void 0;h(w,d,A)}else d.stay();else{if(0===u&&0===v)return d.aspettare();d.setupDir(u,v);
e=d.spd;pa(d,d.mimg,-1,d.spd/d.__proto__.spd);d.dix=u*e;d.diy=v*e;f+=v;c+=u;d.x32=c;d.y32=f;d.distance++;Va(d,~~(32E3/e));Qc(d,u*e,v*e,0);t=c+f*b;if(2>k)n(t,d.id);else for(m=k*k,q=-b,p=0;p<m;p++)r=p%k,0===r&&(q+=b),n(t+r+q,d.id)}},zk=function(d){d/=1E3;var b=~~(d/60)%60,e=~~(d/3600);d=~~(d%60);1===(d+"").length&&(d="0"+d);0!=e?(e+=":",10>b&&(b="0"+b)):e="";return e+b+":"+d},Nc=function(){if(!p.editor){var d=p.cycle;p.now();var b=Date.now();if(p.demo){var e=p.record[d];if(e)for(var f=0;f<e.length;f+=
3)dg[e[f]](e[f+1],e[f+2])}if(e=cd[d]){for(f=0;f<e.length;f++){var c=e[f];Yb[c.func](c.data)}delete cd[d]}if(e=dd[d]){for(f=0;f<e.length;f++)c=z[e[f]],c.c===d&&(c.death?P("anti stall:",Yb[c.func].name,c.func,c):(c.c=void 0,Yb[c.func](c.funcObj)));delete dd[d]}p.cycle++;if(p.online&&0===p.cycle%(Cd.maxPing/25))var h=Cd();p.online&&0===p.cycle%640&&P(WASMsynchro());p.online&&0===p.cycle%80&&Kb();di+=Date.now()-b;0===p.cycle%40&&(r("topinfo").innerHTML="<span>CPU:"+(di/10).toFixed(2)+"%</span> <span>"+
~~(ei/fi+.5)+"FPS</span> <span>"+zk(p.now())+"</span>",ei=fi=di=0);!h&&!p.automatic&&p.now()-(p.cycle-1)*Nc.speed>=Nc.speed&&Nc()}};Nc.speed=25;var di=0,fi=0,ei=0,dc=function(d,b,e,f){return[d,b,e,f,d,b,e,f,d,b,e,f,d,b,e,f]},eg=new Float32Array(dc(1,0,0,.75)),Um=new Float32Array(dc(1,1,1,.5)),Ak=new Float32Array(dc(0,1,0,.75)),Vm=new Float32Array(dc(0,1,0,.9)),Wm=new Float32Array(dc(.3515625,.29296875,.21875,.9)),Bk=new Float32Array(dc(0,1,1,.9)),gi=new Float32Array(dc(1,1,1,.5)),Ck=new Float32Array(dc(.3,
.3,.3,.9)),Dk=new Float32Array(dc(.7,.2,.2,.9));Bk.noAlpha=1;Ck.noAlpha=1;Dk.noAlpha=1;var ea=function(d){var b=A[d];if(1===D.length){var e=D[0];O(ue,[d,4*Na.shift+1,Db],e)}else for(var f=0,c=4*Na.shift+1;f<c;f++){var h=D,l=Infinity;e=-1;for(var n=0,t=h.length;n<t;n++){var k=z[h[n]];if(!k.techStart&&!1!==k.built){var m=k.icons.indexOf(b.nu);m=(k.work&&k.work[m]||0)+(p.online&&k.usedCycle==p.cycle&&k.usedTimes||0);m<l&&(!Db||m)&&(l=m,e=k.id)}}0<e&&(h=z[e],h.usedCycle!=p.cycle&&(h.usedTimes=0,h.usedCycle=
p.cycle),h.usedTimes++,O(ue,[d,1,Db],e))}},ue=function(d,b){var e=d[0],f=d[1],c=d[2];d=A[e];b=z[b];var h=b.icons.indexOf(d.nu);if(!(0>h||void 0!==b.techID)){performance.now();if(0==c)for(c=0;c<f;c++){var l=H[b.kingdom],n=l.mod[e].cost||d.cost;if(l.paypal(n))break;b.waitlist||(b.waitlist=[]);b.waitlist.push(e,-h-1);b.work||(b.work={});b.work[h]||(b.work[h]=0);b.work[h]++;b.working=1;l.unitLoading++;2==b.waitlist.length&&(n=1E3*d.time,b.setupINTV(ye,b.id,n))}else{if(!b.work||!b.waitlist.length)return;
var t=b.waitlist;l=H[b.kingdom];for(c=0;c<f;c++){n=l.mod[e].cost||d.cost;l.setupResources(n,-1);n=t.lastIndexOf(e);if(0>n)break;t.splice(n,2);b.work[h]--;if(0==t.length){b.c=-1;b.working=0;break}l.unitLoading--;0===n&&(n=1E3*A[t[0]].time,b.setupINTV(ye,b.id,n))}}M(b.id)}},Ek=0,ye=function(d){d=z[d];if(d.death||d.waitlist&&!d.waitlist.length)return!1;var b=d.kingdom;b=H[b];var e=b.values.pop>=b.values.popMax?u.houseLimit:u.popLimit;if(b.values.pop>=b.values.popMax||b.values.pop>=b.values.popLimit)return document.getElementById("msgs1").getElementsByTagName("li"),
3E4<Date.now()-Ek&&b.k==w.kingdom&&Rc(e,0,5),Ek=Date.now(),b.onFreePop.put(d.id),!0;b.unitLoading--;b=d.waitlist[0];e=A[b];d.work[-d.waitlist[1]-1]--;d.waitlist.splice(0,2);0<d.waitlist.length?d.setupINTV(ye,d.id,1E3*e.time):d.working=0;ze(b,d);M(d.id);return!0},ab=function(){if(0==Db){var d=z[D[0]];O(fg,[d.mlistID[mb.nu],!0],d.id)}},bb=function(){if(0==Db){var d=z[D[0]];O(fg,[d.hlistID[mb.nu],!1],d.id)}},Fk=function(d,b,e){var f=1.6,c=0;1===b&&(e=0,f=3.6,c=620);return[c+~~(f*d[0]*b+.5)+120*e,~~(f*
d[1]*b+.5),~~(f*d[2]*b+.5),~~(f*d[3]*b+.5)]},fg=function(d,b){var e=d[0];d=d[1];b=z[b];var f=H[b.kingdom],c=H[b.kingdom];if(c.values.pop>=c.values.popMax&&b.kingdom===w.kingdom)return Rc(u.popLimit,0,5);if(d)var h=c.values.fameTech;c=4;var l=9*d;l||(l=1);if(d)var n=b.mlist,t=b.mlistID;else n=b.hlist,t=b.hlistID;var k=t.indexOf(e);if(!(0>k)){e=n[k].unit;var m=Fk(A[e].cost,l,h);if(f.paypal(m))return 0;n.splice(k,1);t.splice(k,1);Y.active==n&&la(n);for(f=0;f<l;f++)t=ze(e,b),h?t.level=c:d||(c=16,t.level=
c,n=Gk[t.race],t.name=n[t.id%n.length],Hk(t))}},ze=function(d,b,e,f){var c=F,h=b.kingdom;b.rnd||hi(b);var l=-1,n=-1;if(b.point&&!b.disallowPoint){var t=b.point[0],k=b.point[1];l=Ik(b,t,k,A[d].radix,A[d].rbase())[0]}else l=Ik(b,l,n,A[d].radix,A[d].rbase())[1],l=l[Jk(b,l.length)];n=~~(l/c);d=new Sc(d,h,l%c,n,0,!1,f);Ae(h);e||Ca("unitdone",0,0,d.kingdom);if(b.point&&(b=ii(t,k,d,!0),e=b[1],b[0]))b[0](e,[d.id]);return d},gg=0,hg=0,rb,Xa,me,U=function(d){aa=function(){};d=A[d];rb=!1;var b=L;pa(b,d.img);
b.active=!0;Xa=d;me=!1;document.addEventListener("mousemove",Jh);document.addEventListener("mousedown",Sf)},Sf=function(d){var b=Xa.validator,e=Xa.space,f=ra[Xa.img];0==d.button&&151<d.pageX?(d=fc(d.pageX-w.mx-.5*f[8]/X,d.pageY-.5*f[9]/X),f=~~(.03125*d[1]),d=~~(.03125*d[0]),b(d,f,e,w.kingdom)[1]&&(rb=!0,L.active=!0,L.x=-9999,L.y=-9999,document.removeEventListener("mousedown",Sf),O(Mc,[d+F*f,Xa.type,me],D),Na.shift&&(me?dk(me):U(Xa.type))),aa=function(){}):(L.active=!0,L.x=-9999,L.y=-9999,rb=!0,aa=
function(){},document.removeEventListener("mousedown",Sf))},Jh=function(d){var b=Xa.validator,e=Xa.space,f=ra[Xa.img];if(rb)document.removeEventListener("mousemove",Jh);else{var c=d.pageX,h=d.pageY;if(c!=gg||h!=hg)L.active=!0,gg=c,hg=h,c=fc(d.pageX-w.mx-.5*f[8]/X,d.pageY-.5*f[9]/X),h=~~(.03125*c[1]),c=~~(.03125*c[0]),d=32*c,f=32*h,(b=!b(c,h,e,Jb.k)[1])?b!=Tc&&(Tc=b,k.bindBuffer(k.ARRAY_BUFFER,Ma),k.bufferSubData(k.ARRAY_BUFFER,16*L.bufferID,eg)):b!=Tc&&(Tc=b,k.bindBuffer(k.ARRAY_BUFFER,Ma),k.bufferSubData(k.ARRAY_BUFFER,
16*L.bufferID,Ak)),L.x=d,L.y=f}},Mc=function(d,b){var e=d[0],f=e%sa,c=~~(e/sa),h=p.editor?w.kingdom:z[b[0]].kingdom;e=d[1];var l=A[e],n=l.cost,t=H[h];if(!l.validator(f,c,l.space,h)[1]||!p.editor&&t.paypal(n))return!1;d=new Sc(e,h,f,c,0,!p.editor,d[2]);if(!0===d.invalid||p.editor)return!1;d.waitlist=[];if(20===e)d.built=1,f=z[b[0]],ca(d.id,f,hd,f.url.move);else for(d.health=1,pa(d,d.bimg),d=d.id,e=0,c=b.length;e<c;e++)f=z[b[e]],f.buildList?(f.buildList.put(d),f.func!==ig.url&&(h=jg(f.buildList,f.x32,
f.y32))&&ca(h,f,id,f.url.move)):(f.buildList=[d],f.func!==ig.url&&ca(d,f,id,f.url.move))},Tc=null,ki=function(d){aa=function(){};d=A[d];rb=!1;var b=L;Xa=d;pa(b,d.img);document.addEventListener("mousemove",Kk);document.addEventListener("mousedown",ji)},ji=function(d){var b=F,e=ra[Xa.img];if(0==d.button&&151<d.pageX){d=fc(d.pageX-w.mx-.5*e[8]/X,d.pageY-.5*e[9]/X);var f=~~(.03125*d[1]);d=~~(.03125*d[0]);k.bindBuffer(k.ARRAY_BUFFER,Ma);k.bufferSubData(k.ARRAY_BUFFER,0,Wm);var c=ba[2];ba[2]=32;ba[5]=32;
ba[8]=32;ba[11]=32;L.wall=d+f*b;var h=d;document.addEventListener("mouseup",function t(d){Qb.forced=!1;d=Ha[3*w.kingdom];var e=Ha[3*w.kingdom+1],g=Ha[3*w.kingdom+2];x[0]=d;x[1]=e;x[2]=g;x[3]=.5;x[4]=d;x[5]=e;x[6]=g;x[7]=.5;x[8]=d;x[9]=e;x[10]=g;x[11]=.5;x[12]=d;x[13]=e;x[14]=g;x[15]=.5;k.bindBuffer(k.ARRAY_BUFFER,Ma);k.bufferSubData(k.ARRAY_BUFFER,0,x);ba[2]=c;ba[5]=c;ba[8]=c;ba[11]=c;var n=~~(ba[9]/32),m=~~(ba[10]/32);e=Math.abs(h-n);g=Math.abs(f-m);e&&--e;g&&--g;d=1;n=n<h?n:h;var p=m<f?m:f;m=[n+
p*b];for(var r=0;r<e+1;r++)m[d++]=n+r+p*b,g&&(m[d++]=n+r+(p+g)*b);for(r=1;r<g;r++)m[d++]=n+(p+r)*b,e&&(m[d++]=n+(p+r)*b+e);for(r=1;r<d;r++)e=m[r],rb=!0,aa=function(){aa=nb},Uc(2),O(Mc,[e,Xa.type],D);L.active=!0;L.x=-9999;L.y=-9999;Na.shift&&ki(Xa.type);document.removeEventListener("mouseup",t)});document.removeEventListener("mousedown",ji);rb=!0}else L.active=!0,L.x=-9999,L.y=-9999,rb=!0,aa=151<d.pageX?0:nb,document.removeEventListener("mousedown",ji)},Kk=function(d){var b=F,e=ra[Xa.img];if(rb)document.removeEventListener("mousemove",
Kk);else{var f=d.pageX,c=d.pageY;if(f!=gg||c!=hg){var h=!0;gg=f;hg=c;L.active=!0;d=fc(d.pageX-w.mx-.5*e[8]/X,d.pageY-.5*e[9]/X);e=~~(d[1]/32);d=~~(d[0]/32);f=32*d;c=32*e;0==V[d+e*b]&&(h=!1);h?h!=Tc&&(Tc=h,k.bindBuffer(k.ARRAY_BUFFER,Ma),k.bufferSubData(k.ARRAY_BUFFER,16*L.bufferID,eg)):h!=Tc&&(Tc=h,k.bindBuffer(k.ARRAY_BUFFER,Ma),k.bufferSubData(k.ARRAY_BUFFER,16*L.bufferID,Ak));L.x=f;L.y=c}}},li=function(d,b){d=0;for(var e=b.length;d<e;d++){var f=z[b[d]];f.xf?f.stop=1:f.stay()}},kg=function(d,b){d=
z[b[0]];d.techStart=0;d.c=void 0;b=d.techID;d.techID=void 0;if(b){var e=H[d.kingdom].technology.hidden;-1<b&&(e[b]=0);H[d.kingdom].setupResources(C[d.activeTech].cost,-1)}else if(d.lcost)H[d.kingdom].setupResources(d.lcost,-1);else return;M(d.id)},I=function(d){O($f,[d,mb.lastFunc.id],z[D[0]].id)},$f=function(d,b){var e=d[0];d=d[1];var f=C[e],c=z[b];f.upgrade&&(d=-1);if(void 0!==c.techID||c.waitlist&&c.waitlist.length||H[c.kingdom].paypal(f.cost))return!1;c.activeTech=e;c.techID=d;c.setupINTV(f.type,
[e,d,b],1E3*f.time);c.techStart=c.c-p.cycle;e=H[z[b].kingdom].technology.hidden;-1<d&&(e[d]=1);M(b)},ha=function(d){var b=d[1],e=z[d[2]];d=C[d[0]];xc(e,d,b)},lg=function(d){var b=d[1],e=z[d[2]];d=C[d[0]];var f=A[d.obj],c=H[e.kingdom].mod[f.type];mi(e);e.img=f.img;e.attack=c.attack||f.attack;e.health=e.health/e.maxHealth*f.health;e.maxHealth=f.health;e.__proto__=f;pb(e);xc(e,d,b)},mg=function(d){var b=d[1],e=z[d[2]];d=C[d[0]];if(d.actvintv)for(var f=d.actvintv,c=0,h=f.length;c<h;c++){var l=f[c];H[e.kingdom].technology.disabled[l.id]=
0;for(var n=l.builds,t=xa[e.kingdom],k=0,m=n.length;k<m;k++)for(var q=t[n[k]],p=0,r=q.length;p<r;p++)l(z[q[p]])}xc(e,d,b)},Sa=function(d,b){var e=d[1];b=z[d[2]];d=C[d[0]];H[b.kingdom].values[d.value]+=d.increase;"popMax"==d.value&&Ae(b.kingdom);xc(b,d,e)},Lk=function(d,b){var e=d[1];b=z[d[2]];d=C[d[0]];var f=d.group,c=H[b.kingdom],h=xa[c.k];c=c.mod;for(var l=0,n=f.length;l<n;l++)for(var t=c[f[l].type],k=h[f[l].type],m=0,q=d.values,p=q.length;m<p;m+=2){var r=q[m],u=q[m+1];t[r]||(t[r]=f[l][r]||0);for(var v=
0,w=k.length;v<w;v++)z[k[v]][r]+=u;t[r]+=u}xc(b,d,e)},ub=function(d,b){var e=d[1];b=z[d[2]];d=C[d[0]];var f=d.group,c=H[b.kingdom],h=c.mod;c=xa[c.k];for(var l=0,n=f.length;l<n;l++){var t=h[f[l].type];t[d.value]||(t[d.value]=f[l][d.value]||0);t[d.value]+=d.increase;t=c[f[l].type];for(var k=0,m=t.length;k<m;k++)z[t[k]][d.value]+=d.increase}xc(b,d,e)},ni=function(d,b){var e=d[1];b=z[d[2]];d=C[d[0]];for(var f=H[b.kingdom].mod,c=d.mulp,h=0,l=d.group.length;h<l;h++){var n=d.group[h],t=f[n.type].cost||n.cost;
f[n.type].cost=c?[~~(t[0]*c),~~(t[1]*c),~~(t[2]*c),~~(t[3]*c)]:[t[0]-d.decrease[0],t[1]-d.decrease[1],t[2]-d.decrease[2],t[3]-d.decrease[3]]}xc(b,d,e)},oi=function(d,b){var e=d[1];b=z[d[2]];d=C[d[0]];for(var f=H[b.kingdom].mod,c=0,h=d.decrease,l=h.length;c<l;c+=2){var n=h[c],t=h[c+1],k=f[n.type].cost||n.cost;f[n.type].cost=[k[0]-t[0],k[1]-t[1],k[2]-t[2],k[3]-t[3]]}xc(b,d,e)},xc=function(d,b,e){d.techStart=void 0;d.activeTech=void 0;d.techID=void 0;d.func=void 0;var f=H[d.kingdom].technology,c=f.disabled;
f.investigated[e]=1;Ca("techdone",0,0,d.kingdom);if(b=b.next){e=!1;f=0;for(var h=b.length;f<h;f++){var l=b[f].id;c[l]--;la.actv[l]&&(e=!0)}e&&la(Y.active)}d.standardFunc&&d.standardFunc(d);M(d.id)};"use strict";var Tb,Xm={icon:"food",img:"item_meat",url:"meat"},Ym={icon:"milk",img:"milk",url:"milk"},Zm={icon:"gold",img:"item_gold",url:"gold"},$m={icon:"stone",img:"item_stone",url:"stone"},Mk={icon:"wood",img:"item_tree",url:"tree"},an={icon:"food",img:"item_food",url:"food"},Be=function(d,b,e,f){d=
xa[d];var c=Tb[b];b=[];b.length=c.length;for(var h=0,l=c.length;h<l;b[h]=d[c[h++]]);d=Infinity;c=-1;for(h=0;h<b.length;h++){l=b[h];for(var n=l.length,t=0;t<n;t++){var k=z[l[t]];if(!1!==k.built){var m=k.x32,q=k.y32,p=k.space;k=p[p.length-1];p=(p.length-1)/k;k*=.5;p*=.5;m+=k;q+=p;k=.5*(k+p);m=Math.sqrt((m-e)*(m-e)+(q-f)*(q-f))-k;d>=m&&(d=m,c=l[t])}}}return c},ja,bn=function(d){if("string"==typeof d){for(var b=1,e=0,f=d.length;e<f;e++)b+=b*(d.charCodeAt(e)/65535)*(e+1);d=b+f}var c=4294967295-d,h=4294967295+
d;e=0;ja=function(){h+=e;c-=e++;h=36969*(h&65535)+(h>>16)&4294967295;c=18E3*(c&65535)+(c>>16)&4294967295;return((h<<16)+c&4294967295)/4294967295+.5}},Jk=function(d,b){d=d.rnd;var e=d[0],f=d[1],c=d[2];e+=c;f-=c;e=36969*(e&65535)+(e>>16)&4294967295;f=18E3*(f&65535)+(f>>16)&4294967295;d[0]=e;d[1]=f;d[2]++;return~~((((e<<16)+f&4294967295)/4294967295+.5)*b)},Uc=function(d){d!=cn&&(document.body.className="ncursor"+d)},cn=-1,Id=function(d,b){for(var e=0,f=b.length;e<f;e++){var c=z[b[e]];ca(d,c,Ce,c.url.move)}};
Id.spLevel=function(d){var b=0;2<ua[d]&&(b=ua[d]);return b};var Ce=function(d,b){b.stay55();if(b.inventory&&b.invMax===b.inventory.length||!d.item)return 1;ua[d.x32+d.y32*F]=d.radix;Hb(d,NaN);if(b.peon&&d.contain){var e=d.contain[1],f=d.contain[0];b.stock&&Nk(b);var c=Ok(b.x32,b.y32)||!1,h=d.contain[2];d.die(1);b.stock=[f,e,c,Ce.url,h];d=Be(b.kingdom,e,b.x32,b.y32);ca(d,b,yc,b.url[h.url]);M(b.id);return 1}b.addItem(d);M(b.id)},Nk=function(d){var b=Pk(d.x32,d.y32),e=~~(b/F);b%=F;b=new Sc(52,d.kingdom,
b,e,0);pa(b,m[d.stock[4].img]);b.contain=[d.stock[0],2,d.stock[4]]},pi=function(d,b){d=0;for(var e=b.length;d<e;d++){var f=z[b[d]];f.xf?f.stop=2:(f.stop=2,f.stay(),f.stop=void 0)}},Jd=function(d,b){var e=F;d=z[d];for(var f=0,c=b.length;f<c;f++){var h=z[b[f]];if(h.in){var l=h.rbase(),n=h.x32+h.y32*e;if(0!==l(n)||!d.build){n=d.build?ng(h,h.x32,h.y32):ng(h,d.x32,d.y32);if(!1===n)continue;h.x32=n%F;h.y32=~~(n/F)}h.item&&(d.attack-=h.attack||0,d.defence-=h.defence||0);h.url.idle&&pa(h,h.url.idle,1);l.write(n,
h.id);h.in=0;d.inventory.quit(h.id);l=1;h.z32&&(l=h.z32);Hb(h,32*h.y32*l)}}M(d.id,1)},De=function(d,b){d=z[d];if(1===d.invType)for(var e=0,f=b.length;e<f;e++){var c=z[b[e]];c==d||c.in||ca(d.id,c,qi,c.url.move)}},qi=function(d,b){var e=d.inventory;if(e.length<d.invMax){var f=b.x32,c=b.y32;b.stay55();b.rbase().write(f+c*F,b.radix);e.put(b.id);Hb(b,NaN);b.in=d.id;Ee(b.id);M(d.id)}else b.stay55()},vc=function(d,b){for(var e=b.length,f=0;f<e;f++){var c=z[b[f]];c.buildList=!1;ca(d,c,id,c.url.move)}},id=
function(d,b){if(d.dummy&&d.dummy.built)return b.stay55();if(d.health<d.maxHealth)b.dix=0,b.diy=0,b.mv=!0,b.setupDirBuild(d),pa(b,b.url.build,1),b.setupINTV(ig,{u:d.id,a:b.id},tb(b.img)),se(b,"hit%20",7,b.img);else{if(b.buildList&&(d=jg(b.buildList,b.x32,b.y32)))return ca(d,b,id,b.url.move),0;b.stay55()}},og=function(d,b){return b[d]&&13==z[b[d]].type||13==z[V[d]].type?!0:!1},ig=function(d){var b=z[d.u];d=z[d.a];var e=d.x32,f=d.y32,c=b.x32+b.y32*F;if(b.death)return d.stay();var h=b.maxHealth,l=h/
b.__proto__.time*H[d.kingdom].values.buildSpeed;b.health+=l;var n=b.health;if(0==b.built){if(1===b.health-l){for(var t=b.validator(b.x32,b.y32,b.space,b.kingdom)[0],k=b.id,B=b.validator.dimension,q=B.write,p=0,r=t.length;p<r;p++)if(2<B(t[p])){Va(d,tb(d.img));b.health-=l;return}l=Gb[b.kingdom];p=0;for(r=t.length;p<r;p++)q(t[p],k),l[t[p]]=void 0;xa[b.kingdom][b.type].put(b.id);zc(b)}t=~~(4*n/h);t>b.d&&(b.d=t,pa(b,b.img))}if(n>=h){n=b.health=h;M(b.id);if(!1===b.built){b.d=0;t=b.url;l=Gb[b.kingdom];13===
b.type&&(og(c-1,l)&&og(c+1,l)?(t=m.wood_horz,b.child=void 0):og(c+F,l)&&og(c-F,l)&&(t=m.wood_vert,b.child=void 0));b.built=1;b.img=t;pb(b);if(b.valid2)for(t=b.validator(b.x32,b.y32,b.space,b.kingdom)[2],q=b.validator.dimension.write,p=0,r=t.length;p<r;q(t[p++],0));Qk(b);Ca("bldgdone",0,0,b.kingdom);H[b.kingdom].building.quit(b.id);M(b.id);b.standardFunc&&b.standardFunc(b)}b.action=void 0;(c=d.buildList)&&c.quit(b.id);if(!c||d.buildList&&0===d.buildList.length)d.buildList=Rk(d),c=d.buildList;if(e=
jg(c,e,f))return ca(e,d,id,d.url.move),0;d.buildList.length=0;d.stay();d.stock&&d.stock[0]&&pa(d,d.url[d.stock[4].url])}else M(b.id),Va(d,tb(d.img));D[0]==b&&(Vc.innerHTML=n+"/"+h,Ta.value=n)},pg=function(d,b){if(2<d)for(var e=0,f=b.length;e<f;e++){var c=z[b[e]];ca(d,c,hd,c.url.move)}},uc=function(d,b){var e=d;d=z[d];if(d.field)for(f=0,d=b.length;f<d;f++)c=z[b[f]],ca(e,c,hd,c.url.move);else if(0===d.res||3===d.res){var f=0;for(d=b.length;f<d;f++){var c=z[b[f]];ca(e,c,qg,c.url.move)}}else if(1===d.res)for(f=
0,d=b.length;f<d;f++)c=z[b[f]],ca(e,c,jd,c.url.move);else if(2===d.res)for(f=0,d=b.length;f<d;f++)c=z[b[f]],ca(e,c,Oc,c.url.move)},ri=function(d,b){var e=A[d],f=b.length;d=H[z[b[0]].kingdom].mod[d];for(var c=0;c<f;c++){var h=z[b[c]];h.stay();mi(h);h.img=e.img;h.attack=d.attack||e.attack;h.health=h.health/h.maxHealth*e.health;h.maxHealth=e.health;h.defence=d.defence||e.defence;h.__proto__=e;pb(h);M(h.id)}},wc=function(d,b,e,f){e=f||Kd;if(!(3>d||(d=z[d],void 0!=d.res&&!d.cow||d.magicGateway))){f=0;
for(var c=b.length;f<c;f++){var h=z[b[f]];h==d||h.attackOnly&&!h.attackOnly[d.type]||h.bat&&d.build||d.stoned||(h.build?e(d,h):ca(d.id,h,e,h.url.move))}}},jd=function(d,b){if(0<d.health){var e=b.x32,f=b.y32;b.mv=!0;b.setupDir(d.x32-e,d.y32-f);pa(b,b.url.cut,1);b.dix=0;b.diy=0;se(b,"chop%20",11,b.img);b.setupINTV(Sk,{u:d.id,a:b.id},7E3);d.addWorker(b)}else b.stay55()},Sk=function(d){var b=F,e=z[d.u];d=z[d.a];var f=H[d.kingdom].values.wood;e.workers.quit(d.id);var c=Be(d.kingdom,1,d.x32,d.y32),h=z[c];
e.health-=f;d.mv=!1;M(e.id);if(1>e.health){f+=e.health;V[e.x32+e.y32*b]=0;b=bc(h.x32,h.y32);h=e.health=0;for(var l=e.workers.slice(0),n=l.length;h<n;h++){var t=z[l[h]];b?ca(b,t,jd,d.url.move):t.stay()}d.stock=[f,1,b,jd.url,Mk];d.mv=!1;ca(c,d,yc,d.url.tree);M(d.id,1);e.workers.length=0;e.die()}else d.stock=[f,1,e.id,jd.url,Mk],ca(c,d,yc,d.url.tree),M(d.id,1);if(0>c)return d.stay()},hd=function(d,b){b.mv=!0;b.setupDir(d.x32-b.x32,d.y32-b.y32);pa(b,b.url.dig,1);se(b,"dig%20",3,b.img);b.setupINTV(Tk,
{u:d.id,a:b.id},14E3);d.addWorker(b)},Tk=function(d){var b=z[d.u];d=z[d.a];var e=H[d.kingdom].values.food,f=d.x32,c=d.y32;b.lastUse=p.cycle;f=Be(d.kingdom,2,f,c);d.mv=!1;d.stock=[e,2,b.id,hd.url,an];ca(f,d,yc,d.url.food);M(d.id,1);if(0>f)return d.stay()},Oc=function(d,b){b.mv=!0;b.setupDir(d.x32-b.x32,d.y32-b.y32);pa(b,b.url.milk1,1);b.stock=[0,2,d.id,Oc.url,Ym];b.setupINTV(si,{u:d.id,a:b.id},1E3);d.addWorker(b);d.d=(8-b.d)%8;d.stay()},si=function(d){var b=z[d.u];d=z[d.a];b.milk-=3;var e=d.x32,f=
d.y32;d.stock[0]+=3;M(d.id,1);if(0>=b.milk||b.death){if(50<d.stock[0]&&(d.stock[0]=50),d.mv=!1,b=Be(d.kingdom,2,e,f),ca(b,d,yc,d.url.milk),0>b)return d.stay()}else Va(d,1E3)},ve=function(d,b){b.stay55()},Hd=function(d,b){Kd(d,b)},Kd=function(d,b){if(1!==d.death&&d!=b){if(d.dummy&&!H[b.kingdom].values.experience)return b.stay55();b.invisible&&Ld(b.id);if(!0!==b.build){b.mv=1;var e=d.x32-b.x32,f=d.y32-b.y32;d.space&&(f=ci(d,b.x32,b.y32),e=f%F-b.x32,f=~~(f/F)-b.y32);b.setupDir(e,f,b.d2attack);b.url.attack&&
pa(b,b.url.attack,1)}b.setupINTV(rg,{u:d.id,a:b.id},b.attackTime||tb(b.img),d);d.addWorker(b)}else b.stay55()};Kd.distance=-1;Hd.distance=-1;var ti=function(d,b){var e=H[d.kingdom];if(e.values.experience&&(!b||0!=e.diplomacy[b.kingdom]||b.dummy)){if(0==d.level||null==d.level)d.level=0,d.levelProgress=0;d.levelProgress++;d.levelProgress>=~~(d.level/e.values.experience)&&d.level<e.values.maxLevel&&(d.level++,d.health+=e.values.healthJump,d.maxHealth+=e.values.healthJump,d.levelProgress=0,d.attack+=
d.level,d.defence+=d.level%2,M(d.id,1))}},Hk=function(d){var b=d.level;d.attack+=b;d.defence+=~~(.5*b)},rg=function(d){var b=z[d.u];d=z[d.a];var e=d.attDist,f=b.x32-d.x32,c=b.y32-d.y32,h=b.x32,l=b.y32,n=!d.build;if(d.attackSound){var t=d.attackSound;Ca(t[~~(t.length*Math.random())],d.x32,d.y32)}n&&!b.build&&d.setupDir(f,c,d.d2attack);pa(d,d.img,1);if(b.death||d.level&&8<=d.level&&b.dummy||b.dummy&&d.level&&d.level>=H[d.kingdom].values.maxLevel)return d.stay();if(1<e&&!d.dragon){n=!0;var k=ra[d.attimg]}else n=
!1;if(b.build||xe(b.x32,b.y32,d.x32,d.y32,e)){b.onattack(d);e=d.attack*((te[d.type][b.type]||0)+1);if(n){b.space&&(c=ci(b,d.x32,d.y32),h=c%F,l=~~(c/F),f=h-d.x32,c=l-d.y32);var m=0;if(d.arrow||d.ball){n=Uk;t=.5-Math.atan2(-c,-f)/(2*Math.PI);1==t&&(t=0);var q=t;t=f;var r=c;var u=411/Math.sqrt(t*t+r*r);t*=u;r*=u;u=Math.sqrt(1024*f*f+c*c*1024)/Math.sqrt(t*t+r*r);d.ball&&(k[1]=k[0]/u)}else{var v=2;n=sg;var w=p.gravity;t=Math.PI/180*60;m=Math.cos(t);t=d.attackDeg;t*=Math.PI/180;r=Math.sin(t);t=Math.cos(t);
u=32*Math.sqrt(f*f+c*c);t*=Math.sqrt(w*u/(r*t*2));u/=t;r=-Math.sin(Math.atan2(-f,-c));f=-f;q=-c;0!=f&&0!=q&&(2<=Math.abs(q/f)&&(f=0),2<=Math.abs(f/q)&&(q=0));q=Math.sign(f)+Math.sign(q)*F;t*=r;m=Math.abs(w*m*r);r=(32*c-m*u*u*.5)/u}u=Math.round(1E3*u);w={x32:d.x32+.5,y32:d.y32+.5,img:k.url,mv:d.ball,d:0,rotation:-q+1.5,xf:h,yf:l,obj:b.id,attack:e,range:v};pb(w);Qc(w,t,r,m);kb({func:n,data:w},u,1)}w||b.damage(e,d);if(b.dummy){if(50<=d.dummyDamage||!d.dummyDamage)d.dummyDamage=0;d.dummyDamage+=e;50<=
d.dummyDamage&&ti(d,b)}b.death?(d.action=null,b.build||d.build||ti(d,b),wd(d)||d.stay()):Va(d,d.attackTime||tb(d.img))}else d.build&&(wd(d)||d.stay()),d.mv=!1,0!==d.state&&ca(b.id,d,Kd,d.url.move)},qg=function(d,b){0<d.health?(b.dix=0,b.diy=0,b.mv=1,b.setupDirBuild(d),pa(b,b.url.kirka,1),se(b,"mine%20",3,b.img),b.setupINTV(Vk,{u:d.id,a:b.id},7E3),d.addWorker(b)):b.stay()},Vk=function(d){var b=z[d.u];d=z[d.a];var e=b.res,f=H[d.kingdom].values[0==e?"gold":"stone"],c=d.x32,h=d.y32;b.health-=f/H[d.kingdom].values.miningPerf;
M(b.id);1>b.health&&(f=b.health+f,b.health=0,b.d=3,b.die());d.mv=!1;c=Be(d.kingdom,e,c,h);0==e?(d.stock=[f,e,b.id,qg.url,Zm],ca(c,d,yc,d.url.gold)):(d.stock=[f,e,b.id,qg.url,$m],ca(c,d,yc,d.url.stone));M(d.id,1);if(0>c)return d.stay()},ca=function(d,b,e,f){b.cow&&b.workers.length||b.freezed||b.in||b.stoned||(b.action=e.url,b.distance=0,b.nodes=void 0,0<d?(b.xf=d,b.yf=!0):(d*=-1,b.xf=d%F,b.yf=~~(d/F)),b.func!=we.url&&(f==b.url.move?ai(b):b.mimg=f,b.dix=0,b.diy=0,b.mv=!0,b.setupINTV(we,b.id,0)))},Fe=
function(d,b){if(z[b[0]].boat&&(d=-d,d=-ng(A[76],d%F,~~(d/F)),!d))return!1;tg(b,d,Wk)};Fe.allowPos=1;var Wk=function(d,b){P(d);Jd(b.id,b.inventory.slice(0));b.stay55()},ci=function(d,b,e){var f=d.space||Tm,c=f.length-1,h=f[c],l=d.x32;d=d.y32-1;for(var n=Infinity,t=0,k=0;k<c;k++){var m=k%h;m||d++;var q=(l+m-b)*(l+m-b)+(d-e)*(d-e);q<n&&f[k]&&(t=l+m+d*F,n=q)}return t},ng=function(d,b,e){var f=F,c=d.radix,h=d.rbase();for(d=2;60>=d;d+=2){b--;e--;for(var l=0;l<=d;){var n=b+l+f*e;if(h(n)===c)return n;n=
b+l+f*(e+d);if(h(n)===c)return n;l++}for(l=0;l<d-1;){l++;n=b+f*(e+l);if(h(n)===c)return n;n=b+d+f*(e+l);if(h(n)===c)return n}}return!1},Pk=function(d,b){var e=F,c,g=Md;for(c=2;60>=c;c+=2){d--;b--;for(var h=0;h<=c;){var l=d+h+e*b;if(0===g(l)&&0===V[l])return l;l=d+h+e*(b+c);if(0===g(l)&&0===V[l])return l;h++}for(h=0;h<c-1;){h++;l=d+e*(b+h);if(0===g(l)&&0===V[l])return l;l=d+c+e*(b+h);if(0===g(l)&&0===V[l])return l}}return!1},Pc=function(d,b,e,c){var f=b.x32,h=b.y32,l=F,n=f+h*l,t=d.x32,k=d.y32,m=d.space;
if(m){var q=m[m.length-1];m=(m.length-1)/q;d=d.free}else m=q=1,d=xk;b=b.rbase();for(var p,r=Infinity,u=-1,v=!1,w=0;w<e&&-1==u;){if(0==w&&d){for(var x=[],y=0,z=d.length;y<z;y+=2){var A=d[y]+t;p=d[y+1]+k;if(qa(A,p)&&(b(A+p*l)===c||A+p*l==n))a:{var C=x;A+=p*l;p=f;for(var D=h,H=F,G=Math.pow(A%H-p,2)+Math.pow(~~(A/H)-D,2),I=0,J=C.length;I<J;I++)if(Math.pow(C[I]%H-p,2)+Math.pow(~~(C[I]/H)-D,2)>G){C.splice(I,0,A);break a}C.put(A)}}x[0]&&(u=x[0]);if(-1<u){v=!0;break}if(1==e)break}w++;--t;--k;x=q+2*w;C=m+
2*w;y=0;for(z=x*C;y<z;y++)p=y%x,D=~~(y/x),p&&D&&p!=x-1&&D!=C-1||(p+=t,D+=k,A=p+D*l,b(A)==c&&qa(p,D)&&(p=(p-f)*(p-f)+(D-h)*(D-h),r>p&&(r=p,u=A)))}return-1<u?[u%l,~~(u/l),v]:!1},Ik=function(d,b,e,c,g){performance.now();var f=F,l=d.x32,n=d.y32,t=d.space,k=[],m=0;if(t){var q=t[t.length-1];t=(t.length-1)/q;var p=d.free}else t=q=1;d=-1==b?-Infinity:Infinity;for(var r=-1,u=0,v=0;0==k.length;){if(p&&0==v){for(var w=0,x=p.length;w<x;w+=2){var y=p[w]+l,z=p[w+1]+n;qa(y,z)&&g(y+z*f)===c&&(k[m++]=y+z*f,u=(y-b)*
(y-b)+(z-e)*(z-e),d>u&&(d=u,r=y+z*f))}if(k.length)break}v++;--l;--n;for(w=0;w<q+2*v;w++)g(l+n*f+w)==c&&qa(l+w,n)&&(k[m++]=l+w+n*f,u=(l+w-b)*(l+w-b)+(n-e)*(n-e),d>u&&(d=u,r=l+w+n*f)),g(l+(n+t+2*v-1)*f+w)==c&&qa(l+w,n+t+2*v-1)&&(k[m++]=l+(n+t+2*v-1)*f+w,u=(l+w-b)*(l+w-b)+(n+t+2*v-1-e)*(n+t+2*v-1-e),d>u&&(d=u,r=l+(n+t+2*v-1)*f+w));for(w=1;w<t+2*v-1;w++)g(l+(n+w)*f)==c&&qa(l,n+w)&&(k[m++]=l+(n+w)*f,u=(l-b)*(l-b)+(n+w-e)*(n+w-e),d>u&&(d=u,r=l+(n+w)*f)),g(l+q+2*v-1+(n+w)*f)==c&&qa(l+q+2*v-1,n+w)&&(k[m++]=
l+q+2*v-1+(n+w)*f,d>u&&(d=u,r=l+q+2*v-1+(n+w)*f))}return[r,k]},xk=[-1,0,-1,-1,0,-1,1,-1,1,0,1,1,0,1,-1,1],jg=function(d,b,e){for(var c=Infinity,g=!1,h=0,l=d.length;h<l;h++){var n=d[h],t=z[d[h]];if(0!=t.built||t.death)h--,l--,d.quit(n);else{var k=t.x32;t=t.y32;t=(k-b)*(k-b)+(t-e)*(t-e);c>=t&&(c=t,g=n)}}return g},ui=function(d,b){d=0;for(var e=b.length;d<e;d++){var c=z[b[d]];c.spd=c.__proto__.spd}},bg=function(d,b){d=Infinity;for(var e=0,c=b.length;e<c;e++){var g=z[b[e]];g.spd<d&&(d=g.spd)}ug(d,b)},
Ok=function(d,b){for(var e=F,c,g=Infinity,h=0,l=0;121>l;l++){var n=l%11-5,t=~~(l/11)-5,k=n*n+t*t;n+=d;t+=b;k<g&&(c=ua[n+e*t],0<c&&0==V[n+e*t]&&(c=z[c],c.contain&&(g=k,h=c.id)))}return h},vg=function(d,b){tg(b,d,yc)},yc=function(d,b){d=H[b.kingdom];var e=b.stock;d.resources[e[1]]+=e[0];d.stats.resources[e[1]]+=e[0];wg(b.kingdom);b.func=1;var c=Yb[e[3]],g=z[e[2]];if(c==Oc){var h=b.x32;for(var l=b.y32,n=F,t,k=Infinity,m=!1,q=0;961>q;q++){var r=q%31-15,u=~~(q/31)-15,v=r*r+u*u;r+=h;u+=l;v<k&&(t=ua[r+n*
u],0<t&&0===V[r+n*u]&&(t=z[t],t.contain&&"meat"==t.contain[2].url&&(k=v,m=t)))}if(h=m)c=Ce,g=h}else"meat"==e[4].url&&!1===e[2]&&(h=vi(b.x32,b.y32,!0))&&(c=Oc,g=h,e[2]=1);b.stock=void 0;if(!1===e[2])return b.stay();if(h=100<Math.pow(g.x32-b.x32,2)+Math.pow(g.y32-b.y32,2))a:{h=Tb[1];l=xa[b.kingdom];n=0;for(k=h.length;n<k;n++)if(m=h[n],1==A[m].storage&&l[m].length){h=!0;break a}h=!1}h&&void 0!==d.IAD&&1==e[1]?(p.blocked=!0,tk(b),p.blocked=!1):(ca(g.id,b,c,b.url.move),M(b.id,1))};uc.cursor=6;wc.cursor=
1;vc.cursor=9;Id.cursor=5;De.cursor=7;Fe.cursor=7;pg.cursor=6;vg.cursor=6;var Rk=function(d){var b=F,e=d.kingdom,c=d.x32,g=d.y32;c-=16;g-=16;for(var h={},l=[],n=0,k=Gb[e],m=0;1024>m;m++){d=m%32+c;var p=~~(m/32)+g;qa(d,p)&&(d=k[d+p*b],void 0!==d&&(d=z[d],d.kingdom!=e||!1!==d.built||h[d.id]||(l[n++]=d.id,h[d.id]=1)))}return l};jd.available=function(d,b){var e=H[d.kingdom].values.wood;if(b.death||1>b.health-e&&b.workers.length)b=bc(b.x32,b.y32),d.xf=b,b=z[b];return Pc(b,d,1,d.radix)};hd.available=function(d,
b){if(b.death)return"kill";d=b.x32+1;b=b.y32+1;return 0===V[d+b*F]?[d,b,1]:!1};id.available=function(d,b){var e=d.x32,c=d.y32;if(!b.death&&b.health<b.maxHealth){var g=Pc(b,d,1,d.radix);if(g[2])return g}d.buildList?(g=d.buildList,g.quit(b.id)):(d.buildList=Rk(d),g=d.buildList);b=jg(g,e,c);if(!b)return"kill";d.xf=b;b=z[b];return Pc(b,d,1,d.radix)};ve.rev=function(d){return 0===d.distance%3&&(d=$h(d.id,1))?[Hd.url,d]:!1};Hd.available=function(d,b){if(0===d.distance%3){var e=$h(d.id);e&&(d.xf=e,b=z[e])}return Pc(b,
d,5,d.radix)};Ce.available=function(d,b){if(b.death||b.in)if(b.contain)if(b=Ok(b.x32,b.y32))d.xf=b,b=z[b];else return(b=vi(d.x32,d.y32,!0))?(d.stay(),ca(b.id,d,Oc,d.url.move),55):"kill";else return"kill";d=b.x32;b=b.y32;return 0===V[d+b*F]?[d,b,1]:!1};Oc.available=function(d,b){if(b.workers.length||10>b.milk||b.death){b=vi(d.x32,d.y32);if(!b)return!1;d.xf=b.id}return b.xf?!1:Pc(b,d,5,d.radix)};qi.available=function(d,b){if(b.death)return"kill";var e=1;b.boat&&(e=2);return(d=Pc(b,d,e,d.radix))?(d[2]=
1,d):!1};var vi=function(d,b,e){for(var c=F,g,h=Infinity,l=!1,n=0;441>n;n++){g=n%21-10;var k=~~(n/21)-10,m=g*g+k*k;g+=d;k+=b;m<h&&(g=V[g+c*k],0<g&&(g=z[g],g.cow&&(!g.workers.length&&g.milk>=50/1.5||e)&&(h=m,l=g)))}return l},tg=function(d,b,e){for(var c=0,g=d.length;c<g;c++){var h=z[d[c]];ca(b,h,e,h.url.move)}},Ge=function(d,b){cb(b,d,xg)};Ge.noObj=1;var xg=function(d,b){He(b,-d,77,xg)},Ie=function(d,b){cb(b,d,yg)};Ie.noObj=1;var yg=function(d,b){He(b,-d,130,yg)},Je=function(d,b){cb(b,d,zg)};Je.noObj=
1;var zg=function(d,b){He(b,-d,78,zg)},Ke=function(d,b){cb(b,d,Ag)};Ke.noObj=1;Ke.cursor=10;var Ag=function(d,b){He(b,-d,132,Ag)},Le=function(d,b){cb(b,d,Bg)};Le.cursor=10;Le.noObj=1;var Bg=function(d,b){He(b,-d,131,Bg)},He=function(d,b,e,c){var f=F,h=H[d.kingdom],l=A[e],n=A[e].cost,k=d.mana>d.manaMax;if(Lb(d)||d.checkMana(n[4],b,c,n)){k||h.paypal(n);c=e;b*=-1;k=b%f;var m=~~(b/f),p=k,q=m,r=l.rbase(),u=~~(d.mana/n[4])+1;1<u&&(h.resources[0]-=n[0]*(u-1),d.mana-=n[4]*(u-1));for(h=0;h<u;h++)0!==r(b)&&
(e=ng(l,k,m),p=e%f,q=~~(e/f)),Ca("summon"+~~(10*Math.random()+1),p,q),e=new Sc(c,d.kingdom,p,q,0),e.setupChild(Ib.spawn);d.setupDir(-d.x32+e.x32,-d.y32+e.y32);d.setupSpellIMG()}else h.paypal(n);M(d.id)},xe=function(d,b,e,c,g){return~~Math.sqrt((d-e)*(d-e)+(b-c)*(b-c))<=g},Dg=function(d,b){cb(b,d,Cg)};Dg.cursor=0;var Cg=function(d,b){d.build||d.terrain||d.nofreeze||!Lb(b)&&!b.checkMana(50,d.id,Cg)||(d.freezed=1,d.stoned=1,Hb(d,32*d.y32),d.stay(),pa(d,d.img,0),d.setupChild(Ib.turnStone),Nd(d,Ck),Ee(d.id),
b.setupDir(-b.x32+d.x32,-b.y32+d.y32),b.setupSpellIMG(),Ca("turn%20to%20stone",b.x32,b.y32),kb({func:Xk,data:d.id},24E4,1))},Xk=function(d){d=z[d];d.freezed=0;zc(d);d.stoned=0},Eg=function(d,b){cb(b,d,Me)},Me=function(d,b){d.health<d.maxHealth&&!d.build?(b.setupDir(d.x32-b.x32,d.y32-b.y32),P("heal",tb(b.img)),b.setupSpellIMG(!0),b.setupINTV(Yk,{u:d.id,a:b.id},0),d.addWorker(b)):b.stay()},wi=function(){cb(list,obj,Zk)},Zk=function(){},Yk=function(d){var b=z[d.a];d=z[d.u];var e=H[b.kingdom].values.healingRange;
Ca("heal",b.x32,b.y32);if(!xe(d.x32,d.y32,b.x32,b.y32,e))return ca(d.id,b,Me,b.url.move);if(Lb(b)||b.checkMana(4,d.id,Me)){b.setupDir(d.x32-b.x32,d.y32-b.y32);d.health+=6;d.setupChild(Ib.heal);if(d.health>=d.maxHealth)return d.health=d.maxHealth,M(d.id,1),M(b.id,1),b.stay();M(d.id,1);M(b.id,1);Va(b,tb(b.url.spell))}},Ne=function(d,b){cb(b,d,Fg)};Ne.cursor=10;var xi=function(d,b){d=z[d];b=z[b];if(d.inventory.quit(b.id)){b=c[b.spell];d.icons==d.__proto__.icons&&(d.icons=d.icons.slice(0));d.icons.put(b);
var e=d.icons;e.olegal||(e.olegal={});e.olegal[b.id]=1;M(d.id)}},Od=function(d,b){var e=b[1];b=z[b[0]];z[d].nopotion||z[d].build||(ca(d,b,$k,b.url.move),b.actionItem=e)};Od.item=1;var $k=function(d,b){var e=z[b.actionItem];b.actionItem=void 0;e.attack&&(d.attack+=e.attack);e.defence&&(d.defence+=e.defence);e.mana&&(d.mana||(d.mana=0,d.manaMax=0,d.update?d.update.push("mana","manaSpeed",1E3):d.update=["mana","manaSpeed",1E3],kb({func:cg,data:[d.id,"mana","manaSpeed",1E3]},1E3,1)),d.manaMax+=e.mana,
d.mana+=e.mana);e.level&&(d.level||(d.level=0),d.level+=e.level);Ca("bless",d.x32,d.y32);b.inventory.quit(e.id);b.stay55();M(b.id);M(d.id)};Od.cursor=10;Eg.cursor=10;Ge.cursor=10;Ie.cursor=10;Je.cursor=10;var Gg=function(d,b){cb(b,d,yi)};Gg.cursor=1;var yi=function(d,b){if(d.isSpy&&d==b)b.stay55();else if(Lb(b)||b.checkMana(90,d.id,yi))b.setupDir(-b.x32+d.x32,-b.y32+d.y32),pa(b,b.url.attack,1),kb({func:al,data:[d,b]},tb(b.img)-25,1)},al=function(d){var b=d[1];d=d[0];d.die(1);var e=d.rbase().write;
e(b.x32+b.y32*F,b.radix);b.x32=d.x32;b.y32=d.y32;b.d=d.d;b.name=b.name;b.attack=d.attack;b.defence=d.defence;b.update=b.update;b.mana=0;b.manaMax=b.manaMax;e(b.x32+b.y32*F,b.id);Hb(b,32*b.y32);b.__proto__=d.__proto__;pa(b,b.url.idle);e=d.icons.slice(0);e.quit(c.menuBuilds);e.quit(c.menuBuilds1);e.quit(c.menuBuilds2);e.put(c.impersonate);e.put(c.revealSelf);b.icons=e;b.spy||(b.spy=b.kingdom);b.kingdom!==d.kingdom&&b.changeKingdom(d.kingdom);b.setupChild(Ib.impersonate);M(b.id)},zi=function(d){d=z[d];
if(d.spy){var b=A[2];d.attack=b.attack;d.defence=b.defence;d.__proto__=b;d.icons=b.icons;d.kingdom!==d.spy?d.changeKingdom(d.spy):d.stay();pa(d,d.url.idle);M(d.id);d.spy=void 0}};Ne.allowPos=1;var Fg=function(d,b){if(d.id){var e=d.id,c=d.x32;d=d.y32}else e=-d,c=d%F,d=~~(d/F);if(Lb(b)||b.checkMana(60,e,Fg)){b.setupDir(-b.x32+c,-b.y32+d);b.setupSpellIMG();e=8;c-=.5*e;d-=.5*e;var g=[];e+=1;var h=e*e;Ca("bless",b.x32,b.y32);for(b=0;b<h;b++)for(var l=1;3>l;l++){var n=z[(0,kd[l])(b%e+c+(~~(b/e)+d)*F)];
n.build||n.terrain||(n.setupChild(Ib.bless),n.blessed||(n.blessed=1,n.attack+=5,M(n.id,1),g.put(n)))}kb({func:bl,data:g},3E4,1)}},cb=function(d,b,e){if(d[1]&&z[d[1]].item){var c=d[1];d.length--;tg(d,b,e);z[d[0]].actionItem=c}else tg(d,b,e)},Lb=function(d){var b=d.actionItem;if(!b)return!1;b=z[b];b.attack&&(b.attack--,0===b.attack&&(d.inventory.quit(b.id),M(d.id)));return!0},bl=function(d){for(var b=0,e=d.length;b<e;b++){var c=d[b];c.blessed=void 0;c.attack-=5;M(c.id,1)}},Oe=function(d,b){cb(b,d,Hg)};
Oe.cursor=10;var Hg=function(d,b){d.freezed||!Lb(b)&&!b.checkMana(50,d.id,Hg)?b.stay55():(b.setupDir(-b.x32+d.x32,-b.y32+d.y32),d!==b&&b.setupSpellIMG(),Ca("invisible",d.x32,d.y32),d.invisible||(Nd(d,gi),d.invisible=1,d.stay()),M(d.id),kb({func:Ld,data:d.id},5E4,1))},Ld=function(d){d=z[d];d.death||(d.invisible=void 0,zc(d),Zh(d))},Jg=function(d,b){cb(b,d,Ig)};Jg.cursor=0;var Ig=function(d,b){if(Lb(b)||b.checkMana(50,d.id,Ig))b.setupDir(-b.x32+d.x32,-b.y32+d.y32),b.setupSpellIMG(),Ca("lightning",b.x32,
b.y32),d.damage(50,b)},Pe=function(d,b){cb(b,d,Kg)};Pe.cursor=0;Pe.noObj=1;var Kg=function(d,b){var e=F;if(d.id){var c=d.id,g=d.x32;d=d.y32}else c=-d,g=d%e,d=~~(d/e);if(Lb(b)||b.checkMana(50,c,Kg)){b.setupDir(-b.x32+g,-b.y32+d);b.setupSpellIMG();Ca("flame%20ball",g,d);var h=g-b.x32,l=d-b.y32,n=Math.sqrt(h*h+l*l);h/=n;l/=n;var k=b.x32+.5,m=b.y32+.5;c=[];g=[];var p=0;for(d=0;d<n;d++){var q=k+h*d;var r=m+l*d;g.put(q);g.put(r);q=~~q;r=~~r;c[p++]=q+r*e;c[p++]=~~(q+l)+~~(r+h)*e;c[p++]=~~(q-l)+~~(r-h)*e}for(d=
0;d<0*c.length;d++)h=c[d]%e,l=~~(c[d]/e),n=Object.assign({},Zb.food),n.x32=h,n.y32=l,n.z32=2,pb(n),gc.new(n,500);kb({func:Ai,data:{list:c,anim:g,i:2,a:b}},1E3,1)}},Lg=function(d,b){cb(b,d,Qe)};Lg.cursor=10;var Qe=function(d,b){b.setupDir(-b.x32+d.x32,-b.y32+d.y32);b.setupSpellIMG(!0);b.setupINTV(dn,{u:d.id,a:b.id},0);d.addWorker(b)},dn=function(d){var b=z[d.a];d=z[d.u];if(!xe(d.x32,d.y32,b.x32,b.y32,H[b.kingdom].values.teachDistance))return ca(d.id,b,Qe,b.url.move);if(d.level>=b.level)return b.stay();
if(Lb(b)||b.checkMana(10,d.id,Qe))Ca("teach",b.x32,b.y32),b.setupDir(d.x32-b.x32,d.y32-b.y32),d.setupChild(Ib.curse,!1,Vm),ti(d,!1),M(d.id,1),M(b.id,1),Va(b,tb(b.url.spell))},Re=function(d,b){cb(b,d,Mg)};Re.cursor=0;Re.noObj=1;var Mg=function(d,b){var e=F;if(d.id){var c=d.id,g=d.x32;d=d.y32}else c=-d,g=d%e,d=~~(d/e);if(Lb(b)||b.checkMana(70,c,Mg)){b.setupDir(-b.x32+g,-b.y32+d);b.setupSpellIMG();c=g;var h=d;g-=8;d-=8;for(var l=0;256>l;l++){var n=g+l%16,k=~~(l/16)+d,m=n+k*e;qa(n,k)&&64>=Math.pow(n-
c,2)+Math.pow(k-h,2)&&Ng[m]&&0===V[xy]&&(P(n,k),new Sc(60,b.kingdom,n,k,0))}}},Ai=function(d){var b=d.list,e=d.anim,c=d.i,g=d.a,h={x32:e[2*c],y32:e[2*c+1],d:0,img:m.flame_trail,mv:1,z32:2,alpha:!0};pb(h);gc.new(h,tb(h.img));for(h=0;3>h;h++){var l=z[V[b[h+3*c]]];l.health&&l.damage(96,g)}d.i++;d.i<.5*e.length&&kb({func:Ai,data:d},50,1)},Se=function(d,b){cb(b,d,Og)};Se.cursor=0;Se.noObj=1;var Og=function(d,b){if(d.id){var e=d.id,c=d.x32;d=d.y32}else e=-d,c=d%F,d=~~(d/F);if(Lb(b)||b.checkMana(60,e,Og))b.setupDir(-b.x32+
c,-b.y32+d),b.setupSpellIMG(),Ca("freeze",c,d),kb({func:cl,data:[c,d]},1E3,1)},Te=function(d,b){cb(b,d,Pg)};Te.cursor=0;Te.noObj=1;var Pg=function(d,b){if(d.id){var e=d.id,c=d.x32;d=d.y32}else e=-d,c=d%F,d=~~(d/F);if(Lb(b)||b.checkMana(70,e,Pg)){b.setupDir(-b.x32+c,-b.y32+d);b.setupSpellIMG();Ca("confusion",c,d);b=4;c-=.5*b;d-=.5*b;e=F;var g=[];b+=1;for(var h=b*b,l=0;l<h;l++)for(var n=1;3>n;n++){var k=z[(0,kd[n])(l%b+c+(~~(l/b)+d)*e)];k.build||k.terrain||k.stoned||(k.confused=1,k.invisible&&Ld(k),
Nd(k,Dk),k.stay(),g.put(k),Ee(k.id))}h&&1===D.length&&M(D[0]);g.length&&kb({func:dl,data:g},2E4,1)}},dl=function(d){for(var b=0,e=d.length;b<e;b++){var c=d[b];c.confused=void 0;c.death||(pa(c,c.img,1),zc(c),c.stay(),hb==c&&(hb=void 0,D[0]=c.id,M(c.id)))}},cl=function(d){var b=6,e=d[0]-.5*b,c=d[1]-.5*b,g=F,h=[];b+=1;var l=b*b;d={img:m.freeze_expl,d:0,mv:1,x32:d[0],y32:d[1]};pb(d);gc.new(d,tb(d.img));for(var n=0;n<l;n++)for(var k=1;3>k;k++)d=z[(0,kd[k])(n%b+e+(~~(n/b)+c)*g)],d.build||d.terrain||d.nofreeze||
d.stoned||(d.freezed=1,Hb(d,32*d.y32),d.stay(),pa(d,d.img,0),d.invisible&&Ld(d),Nd(d,Bk),d.health-=40,1>d.health&&(d.health=1),h.put(d),Ee(d.id));l&&1===D.length&&M(D[0]);kb({func:el,data:h},2E4,1)},el=function(d){for(var b=0,e=d.length;b<e;b++){var c=d[b];c.freezed=void 0;c.death||(pa(c,c.img,1),zc(c),hb==c&&(hb=void 0,D[0]=c.id,M(c.id)))}},Ue=function(d,b){cb(b,d,Qg)};Ue.cursor=0;Ue.noObj=1;var Qg=function(d,b){if(d.id){var e=d.id,c=d.x32;d=d.y32}else e=-d,c=d%F,d=~~(d/F);if(Lb(b)||b.checkMana(100,
e,Qg))b.setupDir(-b.x32+c,-b.y32+d),b.setupSpellIMG(),Bi(c,d,3,20,4500,b.id)},Bi=function(d,b,e,c,g,h){for(var f=m.fire_rain,n=p.gravity,k=Date.now(),r=Bi.rnd,B=Math.PI,q=performance.now(),u=0;u<c;u++){var v=2*r()*B,w=e*r(),y=d+w*Math.cos(v);v=b+w*Math.sin(v);w=~~(u/c*g);qa(y,v)&&kb({func:fl,data:{x32:y,y32:v-6,dix:0,diy:140,img:f,mv:1,d:0,timestamp:k,finnish:Infinity,aceleration:n,attack:40,xf:y,yf:v,range:2,kingdom:0,obj:h,crashTime:(Math.sqrt(19600+384*n)-140)/n*1E3}},w,1)}P(performance.now()-
q)},fl=function(d){kb({func:sg,data:d},d.crashTime,1);pb(d,0,d.diy,p.gravity)};Bi.rnd=function(){var d=4096,b=2048;return function(){b=36969*(b&65535)+(b>>16)&4294967295;d=18E3*(d&65535)+(d>>16)&4294967295;return((b<<16)+d&4294967295)/4294967296+.5}}();var Uk=function(d){z[d.obj].damage(d.attack,z[d.obj]);Ub(d);Ab.put(d.bufferID)},gl=function(d){d=z[d];d.bufferID&&(Ub(d),Ab.put(d.bufferID));Ng[d.x32+d.y32*F]=void 0},sg=function(d){var b=F,e=d.xf,c=d.yf,g=d.attack;d.mv=1;d.func=void 0;d.x32=e;d.y32=
c;Qc(d,0,0,0);Hb(d,2);e=~~e;c=~~c;var h=e+c*b,l=V[h];zb[h]?(d.img=m.expl_small_water,Ca("water%blop",d.x32,d.y32)):(d.img=m.expl_small_hole,Ca("small%20explosion",d.x32,d.y32));pa(d,d.img,1);gc.new(d,hl(ra[d.img]));if(zb[h]){if(l=ua[h],2<l){var n=z[l];n.damage(g,z[d.obj])}}else{2<l&&(n=z[l],n.damage(g,z[d.obj]));h=d.range;l=2*h+1;for(var k=0,p=l*l;k<p;k++){n=k%l-h;var B=~~(k/l)-h,q=~~Math.sqrt(n*n+B*B);q<h&&(n+=e,B+=c,n=V[n+B*b],2<n&&(n=z[n],n.damage(g*(1-q/h),z[d.obj])))}}},en=function(d){if(0<D.length){var b=
z[D[0]],e=0,c=0,g=0,h=0;void 0!==b.dix&&(d=.001*(d-b.timestamp),h=b.dix,g=b.diy,e=h*d,c=g*d);if(b.space){var l=b.space;d=l[l.length-1];l=(l.length-1)/d}else l=d=1;e+=32*(b.x32+.5*d-Math.sign(h))+.5*-tzar.width+.5;c+=32*(b.y32+.5*l-Math.sign(g))+.5*-tzar.height+.5;gb=~~-e;Fb=~~-c;Bd(-gb,-Fb)}},il=function(){};Me.distance="healingRange";xg.distance="createGolemRange";Fg.distance="blessDistance";Og.distance="freezeDistance";Pg.distance="confusionDistance";Hg.distance="invisibilityDistance";Ig.distance=
"lightningDistance";zg.distance="createBatDistance";yg.distance="createDragonDistance";Bg.distance="createCarpetDistance";Ag.distance="createJinnDistance";Cg.distance="turnToStoneDistance";Kg.distance="flameBoltDistance";Qg.distance="fireRainDistance";Mg.distance="freezeDistance";Qe.distance="teachDistance";var H=[];var hc=function(d,b,e,c,g,h,l){this.name=d;this.k=H.length;this.color=b;this.status="";this.stats={dmgInflicted:0,dmgTaken:0,resources:[0,0,0,0],score:0,unitsKilled:0,unitsLosed:0,buildsLosed:0,
buildsDestroyed:0,unitCount:new Uint32Array(A.length),unitCountMax:new Uint32Array(A.length),unitCountDeath:new Uint32Array(A.length),goldTraded:0,goldConverted:0,stoneTraded:0};this.team=l;this.resources=h||[5E4,5E4,5E4,5E4];this.values={gold:10,wood:10,food:10,stone:10,buildSpeed:1,experience:0,healthJump:0,maxLevel:4,pop:0,popMax:p.freePop||1,popLimit:200,healingRange:1,blessDistance:9,createGolemRange:5,freezeDistance:13,invisibilityDistance:9,createBatDistance:16,lightningDistance:12,createDragonDistance:4,
turnToStoneDistance:21,flameBoltDistance:19,fameTech:0,confusionDistance:13,manaSpeed:2,milkSpeed:2,cowSpeed:2,stealCow:0,miningPerf:1,fireRainDistance:15,createCarpetDistance:3,createJinnDistance:3,teachDistance:2};this.race=c;this.racestr=Rg[c];this.IA=g||0;this.building=[];this.diplomacy=e;this.control={};this.control[this.k]=1;this.onFreePop=[];d=[];d.length0function=fn;this.unitLoading=0;this.target=[0,0,0,0];this.crusade={number:0,list:d};this.technology={hidden:{},disabled:{},actived:{},investigated:{}};
this.mod=b=[];Mj[this.racestr]++;d=0;for(e=A.length;d<e;b[d++]={});H[H.length]=this;d=this.k;b=[];Gb[d]={};xa[d]=b;for(e=0;e<A.length;e++)b[e]=[];b=this.color;Ha[3*d]=b[0]/255;Ha[3*d+1]=b[1]/255;Ha[3*d+2]=b[2]/255};hc.prototype.setupResources=function(d,b){var e=this.resources;b||(b=1);e[0]-=d[0]*b;e[1]-=d[1]*b;e[2]-=d[2]*b;e[3]-=d[3]*b;wg(this.k)};var xa=[];var Gb=[];var Ha=[];hc.prototype.check=function(){if(this.values.pop)return!0;for(var d=gn,b=xa[this.k],e=0,c=A.length;e<c;e++)if(!d[e]&&0<b[e].length)return!0;
this.die()};hc.prototype.checkPopArray=function(){if(this.onFreePop.length)for(;!ye(this.onFreePop.shift())&&this.onFreePop.length;);};hc.prototype.die=function(){this.death||(this.death=1,this.status="defeated",Ci(),Rc(Di(u.playerDefeated,this.name),0,5))};hc.prototype.paypal=function(d){var b=this.resources,e=!1,c=this.k;b[0]<d[0]&&(Sg(c,u.gold),e=!0);b[1]<d[1]&&(Sg(c,u.wood),e=!0);b[2]<d[2]&&(Sg(c,u.food),e=!0);b[3]<d[3]&&(Sg(c,u.stone),e=!0);if(e)return e;b[0]-=d[0];b[1]-=d[1];b[2]-=d[2];b[3]-=
d[3];wg(this.k)};hc.prototype.paypalTest=function(d){var b=this.resources;return d[0]>b[0]||d[1]>b[1]||d[2]>b[2]||d[3]>b[3]?!1:!0};var Sg=function(d,b){d==w.kingdom&&Rc(Di(u.notEnough,b),0,5)},wg=function(d){if(d==w.kingdom){var b=H[d].resources;d=b[0];var e=b[1],c=b[2];b=b[3];Infinity==d&&(d="***");Infinity==e&&(e="***");Infinity==c&&(c="***");Infinity==b&&(b="***");hn.innerHTML=d;jn.innerHTML=e;kn.innerHTML=c;ln.innerHTML=b}},gn={13:1,20:1,21:1,22:1,27:1,32:1,35:1,36:1,43:1,44:1,55:1,56:1,57:1},
Jb;var jl=[];(function(){var d="",b=new Image;b.src="data:image/gif;base64,R0lGODlhIQB2AfcAAAAAABAIAAgAABEhACE6ABkbChAQAAgIABAQCO/vlN7epf/6hZSQUv76n721a//rY/XmhnNjECklEP7oecW1Y+7ZeP/rhvvrljEpCCgiB+/Wa97OjP/WSu3YhyEZAIhzLf/WWOnHWv7baL2lVt3Db/vsvUo3BGtSCGhVIdq1SnhjKdy4V62USuvIaPzad/felO/XlzopAGtaMe3Kd/zbiOjMhv/9+JxzGWNKECEZCP/JSuu5Sc6lSMynV4tzPdSyaK2UWjEhADopCNacKWNKGVdCGf/IVuu4VruUSPzJZ7qYU0IqABkQAGdFB2tKEFI6D5tzKMqVN9unSNyrVlRDI/nLd7JwACkZAOaUEDEhCMSMMZRrKYlkJ/u3SJt0M8yYRquDQO66Zu3MlrWcc5haAItSAf+lGUIqCGNCEJdjGXpTGJxrIfisOGtKGcSNOtacQruHOfu6VsiYVOm6dPvLh/rZqTohAHdHB3NKEFo6D0kxEJRjIc6MMalzKYRaIZxrKXlTIuCcP6x5M+umR1I6GX5aKdacSuqqVdedUollNK2HVUopAFQxBXtKEGtCEMmBJ7h2J3NKGdeNNMOCMWNBGZRjKf2rR86MOtaUQpdpMt6cSrqFQkk0GnVWL9OjZolVGeeQLJ5jIKdqJ4xaIeCTObd6NembRt6UQsWEPGlHIf+tUsuMQ9aUSppyRzEZAGU1BkopCHNCEDohCFIxECkZCPeXM3tKGdKDMIRSIZxjKlo6Gc6EOoxaKahwNt6USjUkE/zLmUIgACEQAIZLEtZ2H5ZUF2Y6ELlpIN9/KGtBGUUpEHVKIRkQCNaMRntCEHNCGZdZI86MUjoZAFQoBs5qIF0xECUZEE8hAHQ0CIQ9C5RHD65TFb5cGXY6EDEZCHtCGYRKIVIxGSkQAEohCEIfCVIpEKJEEUUpGWgnBzoZCEIzKzEQABkIAHMpCIw0CyEQCFsZAlEZBikQCDQZECEHAD4PATEQCGshEDEIAPNGKRkAABAAABkICBAICAgICP///yH5BAEAAP8ALAAAAAAhAHYBAAj/AP8JHEiwIEEBBhMqXPiP3QGEAwVAZKgQYoBwLAIMpIUCwESKE5lI/CeA0woU+wTSIvHk40IBD/9x+vHrnYB9+358EbdPwDsavfi5NMiEChcA/5i0QIKrzTsANeQoC+DzAhJvKYcK3AeoAheqAlbo0XNGlpIKR5axEyChwwo/U7UK+EWiAxRdgH5RGnWpD6ArwpCUWlaES40WX0pRompQwIcXLbR8ObKi1BdUcXatMsZuFCUuUtxKidLr11ABT5Ag+tIHjK5MYb5UilPqlK0rVwKkmiJFyyVBpgsyCRCAEpIvyubJC4CkCq9Rh3JhqiRSAJQvcPgIUgaTIIofMvL8/5hCKwfEHmEiDcq0CtosdklHjeoDaSpSgQKoWGjRowMYWh4JlEgYm4wyhR+buaKLAEwoQ4gfs9CikUBM/OBWCytEAuBESIThhyZbVGILOU+QJEAOhFBCyy/44QDDDFKsgJwwqRA0oBejiBJJMmecYSIAOSxjjzf4jeLCFNi9ocxugAyk3hSVhIILGmd4U6KJ77yTAzu/cMIOZXBQ4gcsRXyRhB4CPXEJHT2U4kUyeggzS0QCABAAHD0koUIP/HkjzwH/+ODCFz7qUQoNM3zBVB5X+GjQLGBQtkIHSTxDXAB5wGFBGEUUcUsVF8SWSzJZyJLQTZUc0cIMK7ghhAAZ/P9DySAWuBCHKYdcMMMUgkQSZxGnyiPFF27wIAUX9hgQQBu4DOKCrVLQUMURboySBxNonurFCmn4UYoWfsiT0l6TDBLHIWGEgeQfaAQhREXhrADHLLrgIsgswgiURySiuCEFK4dg4oYoz5yhlUDiRCEFJfZk0UYeNgkkizGfiCJKKajAkYstswTQpEKzVsIOO+Rk4Y1IAglzRh7OQFOKIKF8wmgWClHVhyRFBOARLbRMxI4wsDgSSh99jJKMLKfNxY4abgiii851fiQAO64Yc4woebiCckE5qFCFEnB8IcUWv2zdmDDDSCMRg40RIkgILVAmxRPvTJjQPuwA4FG+pzL/w8UkYGCXzC8BJkSVnSBloYssnMxSsgEHU2RQFjoH4I0wkUuuEAB4Z655RZ8rVAIgzIQeehx0RMKE6Z9XkcQspbNOESZ0xAG77BQFAoztseOukO6WlNO77waZUocls+RAvEKHHJ/88gk1X4sxtEBvUBh1sGGM8tYTNIgNtXzC/T9kVA99IOA/f0cJtYxPPB82gHLHP03QYAU93fOBzDE5bGLKK90byB1I4Q3zdS8PjGhCCaxgQOjdwQZWMAMtzIAFmlmPBmzIAiX+8YohlKEM81teGXg2kDLYgAZkCOBAmlCLWtxHhf/4IAxnSMMa2vCGOMyhDnfIwx768B82QEMN/2dgg3fN0BNhsAERZtgKRMDABsaYISvCAIMSPINIAczEEeRQhxK8woLWe8UOLrGCElzAFukIIB+O8IgpXGAOr0hHH6yXiyQkRgwwSMIdvGGx5anBCFNYhSjmMIcj3MAbgIDE8jQRBkQIYg3j2YEUZBELLRAPCUk4hBy4kAs5wEFh8nDEG6KAuyZkcgpwaEQvFCGIK3jjDIx4xA5wd4QjBPITjviDMITBjiysCAMvDF0f4iCFUkBDDx6QhTVmIY/CyY4eSZACKi5BjgA0QgtbkEUDZReFHexAHOKoRAPC0IZXLm8ZIBCHzvTgiVKlwhrLO4cx9oEUAGSAFnKYAhf6of9CABxAEDtIhCxMAMMA7OEMPSiGGmDIiDF0AAnQgOEBQFEDRgSzeyYoBqZ+yNGOevSjIA2pSAVygic0gXVLkFwT3BGPeIQOHYx4wkUL0gRzcCMe2KiH5tCBDnfo7R/kUIg79hcPdLhUcuiwqUvrwQiDtJQatQiEOdxBAKQO9RgR6GlCpsENZOgAGdxoRzAo8tSoTpUA7RhIPYo6VB3ooAuSaCpFuOpVsLZDrsFohzt4So0u6MAIICjGWBligra+Na7uYEQw3OGOf5iAG2z46wOksA10UAQdff1rYBlbD3MU4x/40EYtACuCB1SWIo+NrBEmy9MMcIMa7sAHPh6hAxD/GIEDoOAGNggrWtKaFh3C2AYoGCvbY7CBDaAgRjF2S9ha1Pa2oMgGPhhRC9hqY6/aSC4xZMHchZgAG9g4bnKLEQ/hgsIc1KCGOeqhjW6wFJwUwYY7skuM7b5iG1A9BlSJgQ5yoMMY2CiA5kyAjm24Nx5LcAc12BAIZBx3G8HARgbEEVTJYWMc4/gvNmiBDmKAQge1YEMXkGEOciDucxgex4QZUY/6dsEIx60FMnA3DmwwIwCMYIQ5zEGMOOiADSGuMOsC8F1s5HjHo+1CLUABCuIFYLc7tikpunAL4Q4Deozdhja2wQ1zwOMRw7gy8eABj20Uoxxchgc5lKGM5cGj/7NnCEA3wgqAJaQUeu2gypPRUY9pbMN6AchCBhAQjAybo3tkzkA83lEAIXcvB9gQRwGkMdJKW/rSBlHGDFhHAxZRJAdV2PTnfhCGbSbkHZqgQRg0hwgXaMLTDBEGL1ywK4qsIgxJyISpDSKMZEBCD0VIxEIooQxvbCMZuy6IN6YSgGQPJAuY24ezB+IndsDCCFFUSB6mAIt3sAOLmnsGJXRBhSIAQhB9EIUXEkGIZETI0Zr7hS5IMYELXKABF6hAC5JwhC+0wZes08UXBpEEC1igAQ2oVRICAYdKKAPeklvGwI0wgYM3YAJJiMMb4MALPUw7Ictwg7lEgHFTTCEJYf9wQy9SUZOA/yEQcQDBD/KRD3f4AA598MMTaPEO1inDW4OwRCvu4Y56qAMQe2iDMnIgD9Z5IxJ9MIUlOsGJeajj6J/QxS+Y8XGD0IISezhFF7rwB3VQAQqTiESEEADuz3ljFkDvgghEYIRBKGbpzADj52ThsJfL3QVGOAIXnpAFZuRddjl4Ai5IYQkjiICYfvA4M3ouO1n8IhKCGIQRkmCJLwBi6c32nTcI0Qdz1V0QRaBc1xkiC13AwQinJwQz2o67TCjDGKUwRR+MUQ0JWO8Qn3+HhNjxiVNA7xBfqIaQx5EHTKyCeGCYAiXSSJB08IIUgsBdKwyBC9oLRBm5sLv/7MCQiDYrJBWtyASm189+9tvBDq4QBwyfMApW9CEZ7EhJ98Cwik3EYRKrYFHdkwhV8AW4kASiYAqRMDLWIwc0gAu2cAi4oAm84DmjVgV5IIHNMApnMFOy4zWbAAiH8AyowAj0MCfQowRzEAmHUAi84AhXQFCycyUCUgWZgAu5gAbGcAWuIDtEcAjAIhDJcAg/wAuVoAbV4ArsIIOh8wRy4AJBIBBnsAoX8AOb4AXGEAz7YCqs4wMQgAhX8A9nUAoXQANToARqwAhUIzsmsAoJEAZjsQs00AAFWAnGsEu4kwdxkAATcASkEAYNoGqCEAvBIADZYjqUoAaHAAEYlyuq/2aAsCAAjsI6eTAKbnAIKFcFVRAGhvAHeSAMYYg7JuAIorAKU4AIYcAKXyAKO+iBnyMOjKAGfyAKvVAKm5ALjhAMAPAxuLMP0jANxjAMgiAI0OAIsPAzy+MRrjANwwAN0MB74uCKoaM3+jANxVAMdrAW0mg6nPMK9KA3zgQ9HgGOdmM94LiN7ZeO6riO7HhpvdALgJAKNdI9QFAKq7AKqggGhQBrvvMDM2AKvsAK94gKm5AJ50A8PwADdBAGAMkKqECQmyAInOA7JFACM3AIhzAIlXBurLAJBTmRsvMDJVADh7ADEPACiZAKuXePnYA7P2ADdRAGgzAHNqAA35AKnP+QCJ1ABbjDRSUQBhipATZwBLkAADc2ALgDBh1AA3FzBKkQAhuwCalQjrKDCPl2BILgD9TQC60QDa0gYL6TCj/QAodwDgDACZsADK3ADAiwPKmQCVQQO5nQCe/Qb9XglsFEBb9QBz8gCLYAQ79ABXy5ChukQr/QCTDgCaUQDoBJBWLgCZkAkgH0C4nwmJnAmIbZCmIgB51AldDzC62gCOqQAZ65PL/wCwdAHDN0Ke3Ymq75mrAZm7ApmbhDmwSRCqdQmOFgfp9DCKigC5kGCKUADsogAnCFmQwRB3GgBxeDC6aWBctwBtzwAA1gCZFAEV0wAQ1wDNWQDJRnEAeQBZD/YAkuUJ28aRCWUHGWgAzCoHeZJgi7kJ4NcAsKUQsNIAKmIAmiAJwMkQOUwC+3cAQQkAwGkQsL0AWQMArQoCGSkwM8MwvVMAu+QhCzoAbdMA16oE3uwzq4EAeqcJ7W06ElIALQAKLLE4E0cAvpUJq+MwtWMw4BsDoq9A4ZyqIU8XV/UAqScJ9GwIsDMQopQAKBMAkv0waHyDX+VApJUAITEAi8gJwDoQzHcAQlQAeDwAVTYaL/ACBMcABwMAinIApQShCyAAldkACJEAAHACQJoQx/gAzKcABuUApaOhDGIAnHAADdoA0kVBCzIAmWwAbcAADLkAx1+n1/wAS/wAeg/0ANBaEMcKAKpoAJnZAFAKAHhzoQyaAzlPAFpkAKkGBBunEJojALT2GUR6oQlKM3utALl0CnysMMB7AM5sMzY7oQv2A+DqML72B+zMCPxMMJB7B6slmsxnqsyNqO+0AfvoMOxcANxIAMknALx9AHoHgEgzAIxxA6jNAIj0AKRxCI0hIGkjAM7JAG5UmHpvA5mNMIXeAGaeAIS3AF4tAEWfMIoGAEFjcDbyA5IoEbxMEOTMAEAssEwuAEofAIjyAJSfAsUyA5+ReF//AJgjAJdwaKrrAIefAKd3AHogAH/fo5dyAGJWAJ1BAD/yAM4mAHMWAHgLFLBksRFisQV0ADSf8wCKGwCLgzCW/AB4GABsPxD3aQbq/wCnbwOVwABsYyAzRgK4MQBIUDGOIgo/8AB1uABqJAgwQhDksjBWFQBS5QBVGAOaIACYvwBGcQA4wgCF57CHFACqJwZwkBAMGwDccACX2xD0EgCpJgBC5gAWVYBdIyGsVAD/LHEPtwDdjwCX2wFsWQBpCgsNN6CZOQBp8QC9JwBVTLEAHADoygM0zgCuswDdfAU9LQE5wTDD34OewQAK6gfzPEN8k6u7Rbu7Z7u7ibu5rTB+LAhSr0LNPAN4VgqbuoBJ+FOyKwAq9gCAYXBqUwAxVAAz8wDdhwvKxTDCFgAUlwb67TAmEwA47/kA2LKzsNsABJAHtx0AWB0AMkQAl5EwvOwDoJB3tG0AWDQApTAAaYQxw/FTrl6wIZ1wWgQAqIsARrozcWWBAAbARxMAiSgAibsL/nKDthgK2kgAmIYAwSoY11gjtTsAluoAmlQBX0cAYqEBO+AwdKoASMIBH0Cgap4AqhiDtKoAiuQBUHgAcqsAAO0AEMQDxMIA514hEBIAwU8ASfcAUJ/DlXUAFPYLfXsBYBdAbbUAWmEAoC2D2u8AoAPAmfIMXdIwClUAWaAA0trEKycAhVAAmOgDkBZAe4EAY/8AmRqEJnAAdzIAiOcMMqxAhfMAqzQDl2nMRqaqO4kxtLrLuK/7zIjBxSsLAIROIEgMkCUqAOUDANAbQFH8ACK+ACbfAJAqEGLLBQvpMBbbACK9AFXOAov7ADR+s7A5ACPAACg2ALRiQNtHANy+MNn5AMsMAEJ2UQetAGbcAIsAAFn0MLJsAOdiBXBgEASAAIPdAK5ODMC+EIjjANWSACSDEWZSEQX0ACYcADK2AIMkIR2VAEKwA0D8AEe9EXfyEMAGAMSRACIdArM7wQAXAEI8AFM9AGXnAZmbEZ7JC8UoAEUfAJqWo4gGABSqABI6AHmyAbtGEbuNEHe4AHdWYQd2DCjKAJLoAEIr0CUiAFhFAERQgd0kEd7CAPApBsDDABLSAA5P/gLCtAGVPwB0TgA+mxHu3xHuxwDbsGAJsQAl2gN8swCFMgKVJgDHpAIAaCIMagIAshDVzQBVpwAFywADCCylOQCZSgB53gISAiIiTCEOGgN1CgBUUbBVGgDFygBt7wDlwQBjiiIzwyiQnxCgLACK7gCrvIBYSwCUXwBHP9JFEyJVWitQzRD81w0mYyFkygJmziJnAiJ5rzCrLwDD4hKIQyD4aCKIqCC4yi1wvxCvQkDrSQKZvSKZ8SKl8wKqXCOgbgDbNSK7eSK7vSK7/CED4ABipQEMziLNAiLdRiLdiyEMxwBF1gouRiLuiiLl/ALu6yENOQCG0ACwmxL/3yLwFJMzAFkzmguBATUzEXkzEb0zE+yjoqwzIuAzMycwXuyTo/EzRDUzRHk8gVQTVWgzVao98vgTZqIxGbuzx4g8CyC2h1YsiN/DkBAQA7";
var e=document.createElement("canvas"),c=e.getContext("2d");b.onload=function(){e.width=33;e.height=34;for(var f=0;11>f;f++)c.drawImage(b,0,34*f,33,34,0,0,33,34),jl[f]=e.toDataURL("image/png"),d+=".ncursor"+f+"{cursor:url('"+jl[f]+"'), default}",c.clearRect(0,0,33,34);document.getElementsByTagName("style")[0].innerHTML=d};Uc(2)})();var Ve=function(d,b){r(d).style.display="block";Ve.actived=d;b.actual="potion";b.id=0;b.amount=100;b.func()};Ve.actived="";var ia={potion:{bak:1,max:4,ord:["level","mana",
"attack","defence"]},sword:{bak:5,max:3,ord:["attack","attackBow","defence"]},book:{bak:8,max:18,ord:"fireRain lightning healing createCarpet createBat bless freeze confusion invisibility createGolem magicVision raiseDead turnToStone whirlpool createDragon flameBolt teach createJinn".split(" ")}};r("mgbook").onclick=function(){ia.actual="book";ia.id=0;ia.amount=c[ia.book.ord[ia.id]].obj.spcost[0];ia.func()};r("mgpotion").onclick=function(){ia.actual="potion";ia.id=0;ia.amount=100;ia.func()};r("mgsword").onclick=
function(){ia.actual="sword";ia.id=0;ia.amount=100;ia.func()};r("mgdecline").onclick=function(){r("magicworkshopmenu").style.display="none"};r("mgitem").onmousedown=function(d){var b=1;d.button&&(b*=-1);d=ia[ia.actual].max;0>ia.id+b&&(ia.id=d);ia.id=(ia.id+b)%d;"book"==ia.actual&&(ia.amount=c[ia.book.ord[ia.id]].obj.spcost[0]);ia.func()};r("mgaccept").onclick=function(){O(Ei,[ia.actual,ia.id,parseInt(r("mgamount").innerHTML)],D[0])};var Ei=function(d,b){b=z[b];var e=d[2],c=[e,0,0,0];Jb.paypal(c)||
(e=~~(250*e),"book"==d[0]&&(e*=2),b.setupINTV(kl,[d,b.id],e),b.lcost=c,b.techStart=b.c-p.cycle,M(b.id)&&(r("magicworkshopmenu").style.display="none"))},mn={defence:6,mana:0,level:2,health:1,attack:5},nn={attack:"sword",attackBow:"bow",defence:"shield"},on={attack:.5,mana:1,defence:.5,level:.2},kl=function(d){var b=z[d[1]],e=d[0][0],f=ia[e].ord[d[0][1]];d=d[0][2];b.lcost=void 0;"sword"==e&&(e=nn[f]);"attackBow"==f&&(f="attack");e=Object.assign({},Zb[e]);if(e.potion)e.d=mn[f],e[f]=~~(d*on[f]);else if(e.book){var g=
c[f],h=g.obj;e.spell=f;e.attack=~~(d/h.spcost[0]);e.name=h.name;e.iconID=g.iconIDbook}else e[f]=~~(.25*d),250<e[f]&&(e[f]=250);P(e);ze(52,b,!0,e);b.techStart=void 0;M(b.id)};r("mgamount").onmousedown=function(d){var b=10;"book"==ia.actual&&(b=c[ia.book.ord[ia.id]].obj.spcost[0]);var e=b;d.button&&(b*=-1);Na.shift&&(b*=5);ia.amount+=b;0>=ia.amount&&(ia.amount=e);r("mgamount").innerHTML=ia.amount};ia.func=function(){r("mgitem").style.backgroundPositionY=-48*(ia.id+ia[ia.actual].bak)+"px";r("mgamount").innerHTML=
ia.amount};var Tg=[0,0,0,0,0,0,0,0],Db,Pd,Ua=[document.getElementById("order1"),document.getElementById("order2"),document.getElementById("order3"),document.getElementById("order4"),document.getElementById("order5"),document.getElementById("order6"),document.getElementById("order7"),document.getElementById("order8")],ll=document.getElementById("bottominfo"),We=Ua[0],Xe=Ua[1],Ye=Ua[2],Ze=Ua[3],$e=Ua[4],af=Ua[5],bf=Ua[6],cf=Ua[7];We.addEventListener("mousedown",function(){We.style.transform="translate(2px,2px)"});
Xe.addEventListener("mousedown",function(){Xe.style.transform="translate(2px,2px)"});Ye.addEventListener("mousedown",function(){Ye.style.transform="translate(2px,2px)"});Ze.addEventListener("mousedown",function(){Ze.style.transform="translate(2px,2px)"});$e.addEventListener("mousedown",function(){$e.style.transform="translate(2px,2px)"});af.addEventListener("mousedown",function(){af.style.transform="translate(2px,2px)"});bf.addEventListener("mousedown",function(){bf.style.transform="translate(2px,2px)"});
cf.addEventListener("mousedown",function(){cf.style.transform="translate(2px,2px)"});We.addEventListener("mouseup",function(d){Db=d.button;mb(0)});Xe.addEventListener("mouseup",function(d){Db=d.button;mb(1)});Ye.addEventListener("mouseup",function(d){Db=d.button;mb(2)});Ze.addEventListener("mouseup",function(d){Db=d.button;mb(3)});$e.addEventListener("mouseup",function(d){Db=d.button;mb(4)});af.addEventListener("mouseup",function(d){Db=d.button;mb(5)});bf.addEventListener("mouseup",function(d){Db=
d.button;mb(6)});cf.addEventListener("mouseup",function(d){Db=d.button;mb(7)});document.getElementById("stock").addEventListener("click",function(d){(d=z[D[0]])&&ml(d)});var ml=function(d,b){if(0==Y.stockActive||b){if(b=d.inventory,b.length){var e=[];e.length=b.length;for(var c=0,g=b.length;c<g;e[c]=z[b[c++]]);la(e,d,1)}}else la(d.icons,d)};(function(){for(var d={},b=0,e=Ua.length;b<e;d={l:d.l},b++)d.l=b,Ua[b].addEventListener("mouseenter",function(b){return function(){var d=Y.displayed[b.l],e=z[D[0]];
if(e&&e.kingdom)var c=H[e.kingdom];if(d&&(void 0!==d.unit?(e=A[d.unit],e={name:e.name,cost:Fk(e.cost,d.hero||d.merc,c.values.fameTech)}):e=d.obj,Y.stockActive&&Wc(Y.active[b.l].id,1,1),e&&e.name)){var f=e.name,k="<span>";k=2==f.length?k+(f[0]+" - "+f[1]):k+f;if(f=e.cost){!e.tech&&c.mod[e.type]&&c.mod[e.type].cost&&(f=c.mod[e.type].cost);k+=" - (";for(var m=0;5>m;m++)f[m]&&(k+=f[m]+"<img class='resource' src='"+pn[m]+"' /> ");k=k.substring(0,k.length-1);k+=")"}k+="</span>";if(D.length){c=H[z[D[0]].kingdom];
if(c.technology.disabled[d.id]){f="<span class='red'>"+u.requires+": ";m=xa[c.k];var p=c.technology.investigated,q="",r=d.requireObj;if(r)for(var v=0,w=r.length;v<w;v++)c=r[v],c.tech?p[c.nu.id]||(q+=c.name[0]+", "):m[c.type].length||(q+=c.name+", ");q.length&&(q=q.substr(0,q.length-2));k+=f+q+"</span>"}e.type==ub&&(k+="<span class='increase'>+"+e.increase+"</span>");(e=Y.active.cut)&&e[d.objName]&&(k+="<span class='shotcut'>"+e[d.objName].toLocaleUpperCase()+"</span>");ll.innerHTML=k}}}}(d)),Ua[b].addEventListener("mouseout",
function(){Y.stockActive&&Wc(D[0],1,1);ll.innerHTML=""})})();var Fi=function(){history.pushState("",document.title,window.location.pathname)},cc=function(){p.online=0;location.hash="";r("MatchX").style.display="none";document.getElementById("index").style.display="block";document.getElementById("returnmenu").style.display="none";document.getElementById("game").style.display="none";document.getElementById("gameFinish").style.display="none";setTimeout(Fi,200)},mb=function(d){var b=Tg[d];mb.lastFunc=
b;mb.nu=d;if(Y.stockActive){b=z[D[0]];var e=z[b.inventory[d]];e&&(e.potion?Na.control?O(Od,b.id,[b.id,e.id]):(aa=Od,aa.item=e.id):e.spell?Na.control&&b.mana?O(xi,b.id,e.id):(c[e.spell](),aa.item=e.id):(O(Jd,b.id,[e.id]),M(b.id)))}else b&&b();mb.lastFunc=void 0;mb.nu=void 0;Ua[d].style.transform=""},ym=function(d){var b=[.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.27,.3,1,.5,.5,.5,1,.62,.62,.62,1,.74,.74,.74,1,.3+.58,.3+.58,.3+.58,1,.94,.94,.94,1,1,1,1,1,1.06,1.06,1.06,1,.3+.82,
.3+.82,.3+.82,1,1.08,1.08,1.08,1,1.04,1.04,1.04,1,1,1,1,1,.95,.95,.95,1,.3+.58,.8,.7,1,.3+.54,.72,.6,1,.7,.62,.5,1,.6,.55,.3+.15,1,.5,.44,.42,1,.4,.37,.35,1],e=new Date;null!=d&&(e=d);d=e.getMinutes()/60;e=e.getHours();document.getElementById("daynighticon").style.backgroundPosition="0 -"+36*e+"px";var c=[b[4*e],b[4*e+1],b[4*e+2],b[4*e+3]];e=(e+1)%24*4;c[0]+=(-c[0]+b[e])*d;c[1]+=(-c[1]+b[e+1])*d;c[2]+=(-c[2]+b[e+2])*d;c[3]+=(-c[3]+b[e+3])*d;return c},gb=0,Fb=0,ld=0,md=0,Bd=function(d,b){var e=tzar.width,
c=tzar.height,g=w.mx/32;d/=32;b/=32;var h=X*e*.03125,l=X*c*.03125,n=.03125*e,k=.03125*c,m=d+.5*(n-h),p=b+.5*(k-l);0>m?d=.5*-(n-h):m+h-g*X>F&&(d=F-h-.5*(n-h)+g*X);0>p?b=.5*-(k-l):p+l>sa&&(b=sa-l-.5*(k-l));h-w.mx>F&&(X=F/(.03125*e),P(X));l>sa&&(X=sa/(.03125*c),P(X));gb=32*-d;Fb=32*-b},nd=document.getElementById("minimap"),Ug=function(d){var b=d.pageX-parseInt(nd.style.left);d=d.pageY-parseInt(nd.style.top);var e=tzar.height*vb/(32*sa);b=~~(.5+(b-tzar.width*ic/(32*F)*.5)*F/ic);d=~~(.5+(d-.5*e)*sa/vb);
Bd(32*b,32*d);0==Pd&&document.removeEventListener("mousemove",Ug)};nd.addEventListener("mousedown",function(d){var b=d.pageX-4,e=d.pageY-31;0==d.button?(document.addEventListener("mouseup",function h(b){document.removeEventListener("mouseup",h);document.removeEventListener("mousemove",Ug)}),Pd=!0,Ug(d),document.addEventListener("mousemove",Ug)):2==d.button&&(b=~~(F*(d.pageX-4)/ic),e=~~(sa*(d.pageY-31)/vb),O(ec,b+e*F,D))});var Na={control:0,shift:0,esc:0},Ga=function(d,b){d&&!p.editor&&(d=Y.active,
b=qn[b],d&&d.cut&&(b=c[d.cut[b]]))&&(d=Jb.technology,Db=0,d.disabled[b.id]||d.hidden[b.id]||(mb.lastFunc=b,b(),mb.lastFunc=void 0))},$b={37:function(d){ld=d},40:function(d){md=-d},39:function(d){ld=-d},38:function(d){md=d},32:function(d){il=d?en:function(){}},46:function(d){d||O(df,Na.shift,D.slice(0))},16:function(d){Na.shift=d},17:function(d){Na.control=d},27:function(d){Na.esc=d},13:function(d){d&&!p.editor&&("displaynone"==Gi.className?(Gi.className="displayblock",Hi.focus(),$b.blocked=13):(Ii(),
Gi.className="displaynone",$b.blocked=null))},19:function(d){d||p.online||lb(1)},48:function(d){d&&Na.control&&(X=1,yh({deltaY:0}))},176:function(d){d&&(p.deltaTime+=3E4)},65:Ga,66:Ga,67:Ga,68:Ga,69:Ga,70:Ga,71:Ga,72:Ga,73:Ga,74:Ga,75:Ga,76:Ga,77:Ga,78:Ga,79:Ga,80:Ga,81:Ga,82:Ga,83:Ga,84:Ga,85:Ga,86:Ga,87:Ga,88:Ga,89:Ga,90:Ga,219:function(d){d&&nl(-1)},221:function(d){d&&nl(1)}},qn={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",
82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};$b.blocked=null;(function(){for(var d=[65,37,40,83,39,68,38,87],b=d.length=0,e=d.length;b<e;b+=2)$b[d[b]]=$b[d[b+1]]})();document.oncontextmenu=function(){return!1};var jc=document.getElementById("attackmenu"),od=document.getElementById("defencemenu"),pd=document.getElementById("levelmenu"),Qd=document.getElementById("kingdom"),Ta=document.getElementById("progressone"),Vg=document.getElementById("unitname"),Vc=document.getElementById("progressvalue");
document.getElementById("selectedobject");var df=function(d,b){if(b.length){d=d||p.editor?b.length:1;for(var e=0;e<d;e++)z[b[e]].die()}},Aa=function(d,b){d.sound&&!b&&(b=d.sound,Ca(b[~~(b.length*Math.random())]));pd.style.display="none";ef.style.display="none";Qd.style.display="block";Ta.style.display="block";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";od.style.display="none";Vg.innerHTML=d.name;ff(d);Qd.innerHTML=H[d.kingdom].name;d.attack?(jc.style.display=
"block",jc.innerHTML=d.attack):jc.style.display="none";b=d.health;var e=d.maxHealth;Infinity==b?(Ta.value=100,Ta.max=100,Vc.innerHTML=b):Ta.value=b;Infinity==e&&Infinity!=b?(Ta.max=100,Ta.value=1):Infinity!==e&&(Ta.max=e);d.inventory&&d.inventory.length&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=d.inventory.length);Vc.innerHTML=~~b+"/"+e;if(!kc(d,w))return la([]);d.point&&(b=d.point,db.x32=b[0],db.y32=b[1],Hb(db,96*(sa-1)),db.show=1);if(!1===
d.built)la([c.stopBuilding]),ff(d);else if(d.techStart)la([c.stopTech]),ff(d),manamenu.style.display="block",manamenu.style.backgroundPosition="0px -200px",manamenu.innerHTML=100-~~(100*(d.c-p.cycle)/d.techStart)+"%",Aa.intv&&clearInterval(Aa.intv),Aa.intv=setInterval(function(){D[0]==d.id?manamenu.innerHTML=100-~~(100*(d.c-p.cycle)/d.techStart)+"%":clearInterval(Aa.intv)},400);else{ce();if(d.working){e=d.work;var f=Y.page*Y.length;b=0;for(var g=Y.length;b<g;b++){var h=e[b+f];Ua[b].innerHTML=h?h:
""}manamenu.style.display="block";manamenu.style.backgroundPosition="0px -200px";var l=1E3*A[d.waitlist[0]].time;b=~~(100*(p.now()-d.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%";Aa.intv&&clearInterval(Aa.intv);Aa.intv=setInterval(function(){if(D[0]==d.id&&d.working){var b=~~(100*(p.now()-d.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%"}else clearInterval(Aa.intv)},400)}else for(b=0,e=Y.length;b<e;Ua[b++].innerHTML="");la(d.icons,d)}};Aa.intv=!1;var gf=function(){jc.style.display="none";
od.style.display="none";pd.style.display="none";Ta.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";Vg.innerHTML="";jc.innerHTML="";od.innerHTML="";manamenu.innerHTML="";pd.innerHTML="";Qd.innerHTML="";Vc.innerHTML="";Ta.value="";Vc.maxLength="";ef.style.display="none";We.innerHTML="";Xe.innerHTML="";Ye.innerHTML="";Ze.innerHTML="";$e.innerHTML="";af.innerHTML="";bf.innerHTML="";cf.innerHTML="";la([c.origin]);ol()},aa,hb,Ac,wb={},
ii=function(d,b,e,c){var f=e||z[D[0]],h=c?H[f.kingdom]:Jb;if("peon"==(e?f.clss:Ac))var l=!0;if(p.editor)return[nb,n];var n=d+b*F;if(!c&&aa!=nb)return[aa,n];d=V[n];b=0;if(!f)return[b,n];if(2<d||(d=qd[n])&&2<d){var k=z[d];k.invisible||(l&&k.storage&&f.stock?b=vg:l&&void 0!=k.res?b=uc:l&&k.health<k.maxHealth&&!h.diplomacy[k.kingdom]&&k.build&&!k.dummy||k.dummy&&!k.built?b=vc:h.diplomacy[k.kingdom]||k.dummy&&h.values.experience||k.confused?b=wc:1===k.invType&&!f.build&&!f.boat&&0<k.invMax&&kc(f,k)&&(b=
De))}else d=ua[n],2<d&&!f.build&&!f.boat&&(k=z[d],k.item?b=Id:k.field&&l?b=pg:1===k.invType&&!f.build&&!f.boat&&0<k.invMax&&kc(f,k)&&(b=De));0===b&&(f=Gb[f.kingdom],f[n]&&l?(d=f[n],b=vc):(k||(d=-n),b=ec,ec.cursor=2));return[b,d]},D=[];D.change=1;var pl,hn=document.getElementById("gold"),jn=document.getElementById("wood"),kn=document.getElementById("food"),ln=document.getElementById("stone"),ba,Ji;var Ki=!1;var fc=function(d,b){var e=X,c=tzar.width,g=tzar.height;d=d*e-gb+.5*(c-e*c);b=b*e-Fb+.5*(g-
e*g);return[d,b]},Qb=function(d){if(d){var b=d.pageX;d=d.pageY;Qb.lastX=b;Qb.lastY=d}else b=Qb.lastX,d=Qb.lastY;b=fc(b-w.mx,d);d=b[1];b=b[0];0==Ki?(window.removeEventListener("mousemove",Qb),Ji=!1):Ji=!0;if(1===ba[2]||Qb.forced)d=32*~~(d/32),b=32*~~(b/32);ba[4]=d;ba[6]=b;ba[9]=b;ba[10]=d},Li=function(d,b){for(var e=b.length,c=0;c<e;c++){var g=z[b[c]];g.build&&(V[d[0]+d[1]*F]==g.id?(g.point=void 0,D[0]==g.id&&(db.x32=2*F,Hb(db,128*F),db.show=0)):(g.point=d,db.x32=d[0],db.y32=d[1],D[0]==g.id&&(Hb(db,
96*(sa-1)),db.show=1)))}};document.onkeydown=function(d){return d.ctrlKey&&d.shiftKey?!1:{116:1,115:1,123:1}[d.keyCode]?!1:!0};var Nj=function(d){if(null==$b.blocked||$b.blocked==d.keyCode){var b=$b[d.keyCode];b&&b(1,d.keyCode)}},Oj=function(d){if(null==$b.blocked||$b.blocked==d.keyCode){var b=$b[d.keyCode];b&&b(0,d.keyCode)}},Pj=function(d){var b=window.innerWidth,e=window.innerHeight,c=d.pageX,g=d.pageY;if(screen.height-10<=e){if(1.2==Math.abs(ld)||0==ld)ld=1.2*((10>c)-(c>b-10));if(1.2==Math.abs(md)||
0==md)md=1.2*((10>g)-(g>e-10))}c=fc(c-w.mx,g);g=~~(.03125*c[1]);c=~~(.03125*c[0]);d.pageX<w.mx?Uc(2):(d=ii(c,g)[0],0==d||void 0==d.cursor?Uc(2):Uc(d.cursor))},Qj=function(d){if(!hf)if(d.pageX>w.menumx){if(0==d.button){window.addEventListener("mousemove",Qb);d=fc(d.pageX-w.mx,d.pageY);var b=d[1];d=d[0];void 0!=L.wall&&(d=L.wall,b=32*~~(d/F),d=d%F*32,Qb.forced=!0,L.wall=void 0);Ki=!0;ba[0]=d;ba[1]=b;ba[9]=ba[0];ba[10]=ba[1];ba[3]=ba[0];ba[7]=ba[1];Wg=!1}}else Wg=!0},Wg=!1,rn=function(d){if(d.pageX>
w.menumx&&d.pageY>w.menumy&&!Pd&&0==Wg){Ki=!1;var b=fc(d.pageX-w.mx,d.pageY),e=~~(b[1]/32);b=~~(b[0]/32);P(b,e);var c=sa;if(2==d.button&&!p.editor){if(aa!=nb){aa=nb;return}if(0<D.length)if(c=z[D[0]],1!=c.build||c.arrow){if(0===aa){aa=nb;return}c=ii(b,e);d=c[1];c=c[0];c==ec&&(b={x32:b,y32:e,d:0,mv:1,img:m.cursor},pb(b),gc.new(b,tb(b.img)));O(c,d,D)}else O(Li,[b,e],D);return!1}if(0==d.button){if(aa==nb)return nb();d=b+e*c;if(aa.spLevel)d=aa.spLevel(d);else{var g=0;2<qd[d]?g=qd[d]:2<V[d]?g=V[d]:2<ua[d]&&
(g=ua[d]);d=g}if(d)aa.allowPos&&z[d].build&&(d=-(b+e*c));else if(aa.allowPos||aa.noObj)d=-(b+e*c);else return aa=nb;aa.noObj&&3<=d&&(d=-(b+e*c));aa.item?(O(aa,d,[D[0],aa.item]),aa.item=void 0):O(aa,d,D);Na.shift||(aa=nb)}}Wg=!1},Rj=function(d){hf||(rn(d),Rd.actived&&Rd(),ba[0]=NaN,ba[1]=NaN,ba[9]=NaN,ba[10]=NaN,ba[3]=NaN,ba[7]=NaN,k.bindBuffer(k.ARRAY_BUFFER,Ec),k.bufferSubData(k.ARRAY_BUFFER,0,ba),Mb.actived&&Mb(),Pd&&(Pd=!1))},Ni=function(d){d=z[d];d.tempChild.quit(d.selectAnim);Ub(d.selectAnim);
Mi(d.selectAnim);d.selectAnim=void 0},ql=function(d,b){for(var e=~~(d/32),c=~~(b/32),g=b,h=d,l=NaN,n=F,k=0,m;3>k;k++){m=kd[k];var p=e,q=c;d=h;b=g;2<m(p+q*n)?(d=p,b=q,l=z[m(d+b*n)]):(.5<=b/32-q?q++:q--,2<m(p+q*n)?(d=p,b=q,l=z[m(d+b*n)]):(.5<=d/32-p?p++:p--,2<m(p+q*n)?(d=p,b=q,l=z[m(d+b*n)]):(q=~~(b/32),2<m(p+q*n)&&(d=p,b=q,l=z[m(d+b*n)]))))}return l},nb=function(){var d=F,b=ba[0],e=ba[1],c=ba[9],g=ba[10],h=~~(b/32),l=~~(e/32);if(Na.shift){var n=ql(b,e);if(n&&kc(n,w)&&!wb[n.id])return D[D.length]=n.id,
n.setupChild(Ib.select,1,oe),wb[n.id]=1,1<D.length?Xg(D):Wc(n.id)}var k=0;for(n=D.length;k<n;Ni(D[k++]));Ve.actived&&(r(Ve.actived).style.display="none");hb&&(Ni(hb.id),hb=void 0);D.length=0;Ac=-1;wb={};ef.style.display="none";We.innerHTML="";Xe.innerHTML="";Ye.innerHTML="";Ze.innerHTML="";$e.innerHTML="";af.innerHTML="";bf.innerHTML="";cf.innerHTML="";jc.className="";Y.page=0;db.show&&(db.x32=2*F,Hb(db,128*F),db.show=0);if(10>=Math.abs(e-g)&&10>=Math.abs(b-c)){if(n=ql(b,e),n.id||(n=Gb[w.kingdom][h+
l*d])&&(n=z[n]),n&&2<n.id&&(!n.invisible||kc(n,w)))if(wb[n.id]=1,D.length=0,n.setupChild(Ib.select,1,oe),kc(n,w)&&!p.demo){D[0]=n.id;Ac=null!=n.defence?n.clss:-2;if(256>Date.now()-pl){if(p.editor){sn(z[D[0]]);return}d=~~(X*tzar.width*.03125);b=~~(X*tzar.height*.03125);g=~~(.03125*-gb+.5*(~~(.03125*tzar.width)-d));h=~~(.03125*-Fb+.5*(~~(.03125*tzar.height)-b));b*=d;g+=h*F;for(k=0;k<b;k++)for(e=g+k%d+~~(k/d)*F,c=0;3>c;c++)h=kd[c](e),2<h&&(l=z[h],l.clss!=n.clss||wb[h]||!kc(l,n)||l.item||(l.setupChild(Ib.select,
1,oe),wb[h]=1,D.put(h)))}pl=Date.now();if(n.build)return Aa(n)}else return hb=n,Wc(n.id),!1}else if(!p.demo){b=~~(b/32);c=~~(c/32);e=~~(e/32);g=~~(g/32);b>=c&&(k=b,b=c,c=k);e>=g&&(k=e,e=g,g=k);c++;l=[1,1,1];var m=c-b;k=0;for(n=m*(g-e+1);k<n;k++)for(g=k%m+b,h=~~(k/m)+e,c=0;3>c;c++){var B=kd[c](g+h*d),q=z[B];q&&(q.selected=1,l[B]||(l[B]=1,q.build||!kc(q,w)||q.item||(D[D.length]=B,q.setupChild(Ib.select,1,oe),wb[B]=1)))}}1<D.length?Xg(D):1==D.length?Wc(D[0]):(la([]),gf(),Ac=-1,D.length=0)},rl=[manamenu,
manamenu1],sl={mana:{background:"0px -120px",progress:progressmana},food:{background:"0px -240px"},milk:{background:"0px -280px"},gold:{background:"0px -260px"},stone:{background:"0px -320px"},wood:{background:"0px -340px"}},pn=["/nehhon/gold.gif","/nehhon/wood.gif","/nehhon/food.gif","/nehhon/stone.gif","/nehhon/mana.gif"],ef=document.getElementById("unitSpeed"),Wc=function(d,b,e){manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";d=z[d];d.sound&&!e&&(e=
d.sound,Ca(e[~~(e.length*Math.random())]));Ac=d.clss;d.inventory&&d.inventory.length&&kc(d,w)&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=d.inventory.length);b||(kc(d,w)&&!p.demo?la(d.icons,d):Oi());Qd.style.display="block";Vg.innerHTML=d.name;d.attack&&d.item||void 0!==d.attack?(jc.innerHTML=d.attack,jc.style.display="block"):jc.style.display="none";d.defence&&d.item||void 0!==d.defence?(od.innerHTML=d.defence,od.style.display="block"):od.style.display=
"none";d.mana&&!d.manaTarget&&(manamenu.style.display="block",manamenu.innerHTML=d.mana,manamenu.style.backgroundPosition="0px -120px");b=0;var c=d.update;if(c){b=0;for(var g=c.length;b<g;b+=3){var h=c[b],l=sl[h];e=rl[b/3];e.innerHTML=d[h];e.style.display="block";e.style.backgroundPosition=l.background;"mana"==h&&d.manaTarget&&(e.innerHTML=~~(100*d.mana/d.manaTarget+.5)+"%",e.style.backgroundPosition="0px -200px");l.progress&&(l.progress.style.display="block",l.progress.value=d[h],l.progress.max=
d[h+"Max"])}}d.stock&&(c=d.stock,e=rl[b/3],e.style.display="block",e.style.backgroundPosition=sl[c[4].icon].background,e.innerHTML=c[0]);b=d.level?d.level:0;pd.innerHTML=b;pd.style.display="block";0===b&&(d.item||d.build)&&(pd.style.display="none");Qd.innerHTML=H[d.kingdom].name;Ta.style.display="block";tl(d);ff(d)},tl=function(d){var b=d.health;d=d.maxHealth;Infinity==b?(Ta.value=100,Ta.max=100,Vc.innerHTML=b):(Ta.value=b,Infinity==d?(Ta.max=100,Ta.value=1):Ta.max=d,Vc.innerHTML=~~b+"/"+d)},Xg=function(d,
b){var e=z[d[0]],c=0,g=0,h=e.clss,l=d.length,n={},k=[];k.cut={};for(var m={},p=0;p<l;p++){e=z[d[p]];c+=e.maxHealth;g+=e.health;Ac=h!=e.clss?-1:!0;if(e.work)for(var q=e.work,r=Object.keys(q),v=0,w=r.length;v<w;v++){var y=r[v];m[y]||(m[y]=0);m[y]+=q[y]}r=e.icons;q=r.length;if(void 0===e.techID&&!1!==e.built)for(v=0;v<q;v++)w=r[v].id,r[v].obj.tech||(void 0===n[w]?n[w]=1:n[w]++,n[w]===l&&(r.cut&&(w=r.cut,y=r[v].objName,w[y]&&(k.cut[y]=w[y],k.cut[w[y]]=y)),k.put(r[v])))}!0===Ac&&(Ac=e.clss);g=Infinity==
g?100:~~(g/c*100);Vc.innerHTML=g+"/100(%)";ul();Vg.innerHTML="";jc.style.display="none";od.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";pd.style.display="none";Qd.innerHTML=l+" "+u.units;Ta.style.display="block";Ta.value=g;Ta.max=100;if(!b)for(la(k),p=0,d=Y.page*Y.length,q=Y.length;p<q;p++)b=m[p+d],Ua[p].innerHTML=b?b:""},vl=function(){};new Float32Array(8);var Ma,yd,Ec,Ad,ge,X=1,wl={1:2560,101001:2048,101E3:2048,1001:2048,1E3:2048,
100:1536,10010100:1280,10100:1280,1001E4:1280,1E4:1280,10010010:256,10010110:256,10110:256,10111:256,10010111:256,110:512,111:512,11:512,10:512,111E5:2816,11E5:2816,11E6:2816,1E6:2816,1101E4:768,11110100:768,11010100:768,1111E4:768,1E7:3360,1E5:3072,1101E3:1792,1101001:1792,11101E3:1792,11101001:1792,101111:0,1011:0,1111:0,101011:0},tn=function(d){Ub(d);Ab.put(d.bufferID)},gc={table:{},dates:[],new:function(d,b,e){b=Math.floor(b)+p.now();var c=this.table;e||(e=tn);c[b]||(c[b]=[]);d.animFunc=e;c[b].put(d);
this.dates.add(b);this.needOrder=!0}},tb=function(d){d=ra[d];return 0>d[1]?m.delay[d[0]-d[1]-1]:~~(d[0]/d[1]*1E3)},Eb=new Float32Array(12),hi=function(d){var b=d.id+p.arje+d.x32+d.y32;d.rnd=[4294967295+b,4294967295-b,0]},Pi=function(d){d=z[d];d.mlist&&xl(d,!0);d.hlist&&xl(d,!1)},xl=function(d,b){if(b)var e=d.mlist,c=d.mlistID,g=Sd.mercenaries;else e=d.hlist,c=d.hlistID,g=Sd.heroes;e.unshift(g[Jk(d,g.length)]);b?c.unshift(d.mercID++):c.unshift(d.heroID++);8<e.length&&(e.length=8,c.length=8);Y.active==
e&&la(e);Va(d,5E4)},Qi=function(d){d=z[d];if(!H[d.kingdom].paypal(Mm)){var b=H[d.kingdom],e=b.technology.disabled;if(!e[c.createCrusaders.id]){var f=16+4*b.crusade.number;b.crusade.number++;32<f&&(f=32);b=b.crusade.list;b.length=f;for(var g=0;g<f;g++)(b[g]=ze(8,d,1)).deleteFromList=b;Ca("crusade",d.x32,d.y32);e[c.createCrusaders.id]=1;M(d.id)}}},fn=function(d){H[d.kingdom].technology.disabled[c.createCrusaders.id]=0},zd,nc={},ua,V,qd,Md=function(d){return ua[d]},rd=function(d){return V[d]},Ri=function(d){return qd[d]};
Md.write=function(d,b){ua[d]=b};rd.write=function(d,b){V[d]=b};Ri.write=function(d,b){qd[d]=b};var kd=[Md,rd,Ri],Oi=function(){for(var d=Y.displayed.length=0,b=Y.length;d<b;d++){var e=Ua[d];e.className="blocked";e.style.backgroundPosition="48px 96px";Tg[d]=Hc}Y.rightButton.className="blocked";Y.leftButton.className="blocked";Y.stock.className="blocked";Y.rightBlocked=1};Y.leftButton.onclick=function(){Y.page&&(Y.page--,la(Y.active,0,Y.stockActive))};Y.rightButton.onclick=function(){Y.rightBlocked||
(Y.page++,la(Y.active,0,Y.stockActive))};Y.displayed=[];var la=function(d,b,e){e=!!e;b||(b=NaN);var c=d.olegal||NaN;if(b.working&&!e)var g=1;Y.active=d;Y.displayed.length=0;var h=Jb.technology,l=Y.page,n=Y.length;Oi();!1!==e&&b?Y.stockActive=b:!1===e&&(Y.stockActive=!1);la.actv={};d.length<=l*n&&d.length&&(Y.page--,l--);for(var k=0,m=0,p;k<n;k++){p=d[k+l*n];if(!p)break;var q=Ua[m];if(!e&&(la.actv[p.id]=1,h.hidden[p.id]||p.obj.tech&&g)){n++;continue}q.style.backgroundPosition=48*e+"px "+(-e||1)*p.iconID*
48+"px";e||!h.disabled[p.id]||c[p.id]?(q.className="",Tg[m]=p):q.className="blocked";Y.displayed[m]=p;m++}d[k+l*n]&&(Y.rightButton.className="",Y.rightBlocked=0);0<l&&(Y.leftButton.className="");1===D.length&&(b=z[D[0]]);b.inventory&&0<b.inventory.length&&(Y.stock.className="")};la.actv={};var Gj,Ba,za,sh,Fj;var k=r("tzar").getContext("webgl2",{antialias:!0,alpha:!1});w.gl=!!k;if(k){var un=k.getExtension("WEBGL_lose_context");k.canvas.addEventListener("webglcontextlost",function(d){setTimeout(function(){un.restoreContext()},
2E3);d.preventDefault()},!1);k.canvas.addEventListener("webglcontextrestored",function(d){P("restored 2")},!1)}var Hj,th,uh,Ij,Jf,ph,oh,If,Kf,he,fe,xd,qh,rh,yb=function(){if(p.canceled)return 0;requestAnimationFrame(yb);var d=yb.fp1000,b=yb.delta,e=yb.now;performance.now();var c=e;yb.frameCount++;e=p.now();yb.now=e;b=(b+(e-c))/1E3;yb.delta=b;fi+=b;ei++;yb.fp1000=d+b;d=gc.table;c=gc.dates;gc.needOrder&&(c.sort(function(b,e){return b-e}),gc.needOrder=0);for(var g=0;c[g]<=e+17;g++){for(var h=d[c[g]],
l=0,n=h.length;l<n;l++){var m=h[l];m.animFunc(m)}delete d[c[g]];g--;c.shift()}if(0!=ld||0!=md)gb+=ld*b*640*X,Fb+=md*b*640*X,Bd(-gb,-Fb),Qb();il(e);vl();k.uniform1f(Hj,e);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);if(d=wa.length)k.bindFramebuffer(k.FRAMEBUFFER,fb),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Ij),b=wa,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.enable(k.BLEND),k.blendEquation(k.MAX),k.blendFunc(k.SRC_COLOR,k.SRC_COLOR),
k.bindTexture(k.TEXTURE_2D,sh),k.drawElements(k.TRIANGLES,d,k.UNSIGNED_INT,0),k.bindTexture(k.TEXTURE_2D,Lighttexture),k.disable(k.BLEND),k.bindFramebuffer(k.FRAMEBUFFER,null);yl(th);c=window.innerWidth;g=window.innerHeight;k.viewport(w.marx,g-vb-w.mary,ic,vb);k.uniform2f(Jf,32*F,32*sa);k.uniform2fv(he,[0,0]);k.uniform1i(Kf,1);k.uniform1f(zd,1);yl(th);k.viewport(w.mx,0,c,g);performance.now();k.useProgram(za);k.bindVertexArray(qh);k.uniform1f(ph,~~((.01*e+.5)%5));k.drawArrays(k.TRIANGLES,0,6);k.viewport(w.marx,
g-vb-w.mary,ic,vb);k.uniform1i(If,1);k.uniform2fv(fe,[0,0]);k.uniform1f(xd,ic/32/F);k.drawArrays(k.TRIANGLES,0,6);k.uniform1i(If,0);k.uniform2f(oh,c,g);k.uniform2fv(fe,[gb,Fb]);k.uniform1f(xd,1/X);k.viewport(w.mx,0,c,g);k.useProgram(Ba);k.bindVertexArray(rh);if(d=ma.length)k.enable(k.BLEND),k.blendEquation(k.FUNC_ADD),k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA),k.bindBuffer(k.ARRAY_BUFFER,Ec),c=tzar.width,g=tzar.height,e=-gb+.5*(c-X*c),b=-Fb+.5*(g-X*g),h=X*(c-w.mx),l=X*g,k.bufferSubData(k.ARRAY_BUFFER,
0,new Float32Array([e,b,24576,e+h,b,24576,e,b+l,24576,e+h,b+l,24576])),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,uh),b=ma,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.viewport(w.marx,g-vb-w.mary,ic,vb),k.drawElements(k.TRIANGLES,12,k.UNSIGNED_INT,0),k.uniform1i(Kf,0),k.uniform2f(Jf,c,g),k.uniform2fv(he,[gb,Fb]),k.uniform1f(zd,1/X),k.viewport(w.mx,0,c,g),k.bindBuffer(k.ARRAY_BUFFER,Ec),Ji&&!Si?k.bufferSubData(k.ARRAY_BUFFER,0,ba):k.bufferSubData(k.ARRAY_BUFFER,
0,new Float32Array([NaN,NaN,24576,NaN,4347,24576,5551,NaN,24576,NaN,NaN,24576])),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,uh),b=ma,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,b.typed,k.STATIC_DRAW)),k.drawElements(k.TRIANGLES,d,k.UNSIGNED_INT,0),k.disable(k.BLEND);L.active&&(e=L.x,b=L.y,d=96*F,L.wh?(c=L.wh[0]-ra[L.img][8],g=L.wh[1]-ra[L.img][9]):g=c=0,Ti(e,b,d,c,g,L.bufferID),L.active=!1);ad.update&&ad(1)},yl=function(d){var b=Z.length;b&&(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,
d),d=Z,d.changed&&(d.typed=new Uint32Array(d),d.changed=!1,k.bufferData(k.ELEMENT_ARRAY_BUFFER,d.typed,k.STATIC_DRAW)),k.drawElements(k.TRIANGLES,b,k.UNSIGNED_INT,0))},ee=!1,yh=function(d){if(!hf&&(d.clientX>w.menumx||Pd||!d.clientX)){d=.07*Math.sign(d.deltaY)*X;var b=(X+d)*tzar.height*.03125;(X+d)*tzar.width*.03125-(X+d)*w.mx/32>F||b>sa||(X+=d,.08>X&&(X=.08),Qb(),Bd(-gb,-Fb),k.useProgram(za),k.uniform1f(xd,1/X),k.useProgram(Ba),k.uniform1f(zd,1/X))}},zm=function(d){k.useProgram(za);k.uniform4fv(Fj,
d);k.useProgram(Ba);k.uniform4fv(Gj,d)};vl=function(){var d=[gb,Fb];k.useProgram(za);k.uniform2fv(fe,d);k.useProgram(Ba);k.uniform2fv(he,d)};"use strict";var qa=function(d,b){return d<F&&0<=d&&0<=b&&b<sa?!0:!1};Array.prototype.put=function(d){this[this.length]=d};var Ib,jf,Zb,Ui,Td=function(d,b,e,c){c&&0==Td.cols[c]&&(Td.list.push(c,d),Td.cols[c]=1)};Td.cols={};Td.list=[];var R=function(d){for(var b=Object.keys(d),e=0;e<b.length;e++)d[d[b[e]]]=b[e];return d};window.onerror=Td;var p={},ra=[],zl=function(d,
b,e,c){for(var f=ka.originalLength||0,h=Object.keys(d),l=0,n=h.length;l<n;l++){var k=h[l],m=d[k];if(Array.isArray(m)){d[k]=f;m.url=f;k=ra[f++]=m;var p=m.deltaY||0;k.id=c/4;for(var q=6,r=k.length;q<r;q+=6){var u=k[q-2],v=k[q-1],w=k[q+2],y=k[q+3];b[c++]=k[q]/e;b[c++]=(p+k[q+1])/e;b[c++]=u;b[c++]=v;b[c++]=(k[q]+w)/e;b[c++]=(k[q+1]+p)/e;b[c++]=u+w;b[c++]=v;b[c++]=k[q]/e;b[c++]=(k[q+1]+y+p)/e;b[c++]=u;b[c++]=v+y;b[c++]=(k[q]+w)/e;b[c++]=(k[q+1]+y+p)/e;b[c++]=u+w;b[c++]=v+y}}else for(var x=Object.keys(m),
z=0,A=x.length;z<A;z++)for(k=m[x[z]],k.id=c/4,k.url=f,m[x[z]]=f,ra[f++]=k,p=k.deltaY?k.deltaY:0,q=6,r=k.length;q<r;q+=6)u=k[q-2],v=k[q-1],w=k[q+2],y=k[q+3],b[c++]=k[q]/e,b[c++]=(p+k[q+1])/e,b[c++]=u,b[c++]=v,b[c++]=(k[q]+w)/e,b[c++]=(k[q+1]+p)/e,b[c++]=u+w,b[c++]=v,b[c++]=k[q]/e,b[c++]=(k[q+1]+y+p)/e,b[c++]=u,b[c++]=v+y,b[c++]=(k[q]+w)/e,b[c++]=(k[q+1]+y+p)/e,b[c++]=u+w,b[c++]=v+y}return c},N=function(d,b,e,c){var f=0,h=e.length-1,l=e[h];c=Gb[c];var n=[],k=0,m=!0;qa(d,b)&&qa(d+l-1,b+h/l-1)||(m=!1);
for(var p=F,q=0;q<h;q++){f==l&&(f=0,b++);if(e[q]){var r=d+f+p*b;c[r]&&(m=!1);if(0<V[r]||zb[r])m=!1;n[k++]=r}f++}return[n,m]};N.check=function(d,b,e,c,g,h,l,n){var f=e.length-1;e=e[f];var k=f/e;f=F;l=Gb[l];e+=2;--d;--b;k=e*(k+2);for(var m=0;m<k;m++){var q=d+m%e,p=b+~~(m/e),r=q+p*f;if(0<V[r]||zb[r]||h&&(q>=g&&q<=g+2||p>=c&&p<=c+2)||!qa(q,p)||l[r]||z[ua[r]].field||n[r])return!1}return!0};var Al=function(d,b,e){var c=0,g=e.length-1,h=e[g],l=[],n=[],k=0,m=!0;qa(d,b)&&qa(d+h-1,b+g/h-1)||(m=!1);for(var p=
0,q=0;q<g;q++){c==h&&(c=0,b++);var r=d+c+F*b;e[q]?(2<V[r]&&(m=!1),l[k++]=r):(n[p++]=r,2<V[r]&&(m=!1));c++}return[l,m,n]},Xh=function(d,b,e){var c=0,g=e.length-1,h=e[g],l=[],n=0,k=!0;qa(d,b)&&qa(d+h-1,b+g/h-1)||(k=!1);for(var m=0;m<g;m++){c==h&&(c=0,b++);var p=d+c+b*F;if(e[m]&&2<V[p]&&1==z[V[p]].build||0<ua[p])k=!1;l[n++]=p;c++}return[l,k]},Yg=function(d,b,e){var c=!1,g=0,h=[],l=0,n=e.length-1,k=e[n],m=0,p=!0;qa(d,b)&&qa(d+k-1,b+n/k-1)||(p=!1);for(var q=0;q<n;q++){m==k&&(m=0,b++);if(e[q]){var r=d+
m+F*b,u=V[r];2<u&&(p=!1);0<u?g++:c=!0;h[l++]=r}m++}g>.5*(n-1)&&c||(p=!1);return[h,p]},kf=function(d,b,e){e=!0;qa(d,b)||(e=!1);1!==ua[d+b*F]&&(e=!1);return[[d+b*F],e]},da=function(d,b,e){e=!0;qa(d,b)||(e=!1);0<V[d+b*F]&&(e=!1);return[[d+b*F],e]},Zg=function(d,b,e){e=!0;qa(d,b)||(e=!1);0<qd[d+b*F]&&(e=!1);return[[d+b*F],e]},Vb=function(d,b,e){e=!0;qa(d,b)||(e=!1);if(0<ua[d+b*F]||2==V[d+b*F]||1==V[d+b*F])e=!1;return[[d+b*F],e]};N.dimension=rd;kf.dimension=Md;Al.dimension=rd;Xh.dimension=Md;da.dimension=
rd;Zg.dimension=Ri;Vb.dimension=Md;Yg.dimension=rd;var vn=function(d){for(var b=Object.keys(d),e=0,c=b.length;e<c;e++)d[b[e]].deltaY=168960},L,C,xb,Cb,Oh=function(){L={img:0,x32:-1E3,y32:-1E3,rgb:[0,0,0,.5],d:0,active:!1};var d=8,b=9;if(!ee){wn();var e=[c.move,c.attack,c.guard,c.patrol,c.pickUp,c.explore,c.stop,c.stand,c.sameSpeed,c.restoreSpeed];jf={magic_creatures:[58,40,59,5,78,77,60,130,131,132,89,129]};for(var f=Object.keys(jf),g=0,h=f.length;g<h;g++){b=jf[f[g]];var l={};b.obj=l;for(var n=0,
k=b.length;n<k;l[b[n++]]=1);}Sd.mercenaries=[c.mercArcher,c.mercFootman,c.mercMaceman,c.mercLongbowman,c.mercPikeman,c.mercKnight,c.mercArcherAsian,c.mercSamurai,c.mercHourseSamurai,c.mercRonin,c.mercHorseArcher,c.mercChariot,c.mercFootmanArab,c.mercArcherArab,c.mercMacemanArab,c.mercPikemanArab,c.mercCavalry,c.mercEnichar,c.mercJihad];Sd.heroes=[c.mercArcher6,c.mercFootman6,c.mercMaceman6,c.mercLongbowman6,c.mercPikeman6,c.mercKnight6,c.mercArcherAsian6,c.mercSamurai6,c.mercHourseSamurai6,c.mercRonin6,
c.mercHorseArcher6,c.mercChariot6,c.mercFootmanArab6,c.mercArcherArab6,c.mercMacemanArab6,c.mercPikemanArab6,c.mercCavalry6,c.mercEnichar6,c.mercJihad6];f=Sd.mercenaries;g=0;for(h=f.length;g<h;f[g++].merc=9);f=Sd.heroes;g=0;for(h=f.length;g<h;f[g++].hero=1);l=m;l.build2x2[2]=1;l.build3x3[2]=1;l.build4x4[2]=1;l.build5x5[2]=1;l.build6x6[2]=1;l.items1[2]=1;l.build_harbor[2]=1;l.bridge_horz_build[2]=1;l.bridge_vert_build[2]=1;l.fields[0]=9;l.fields[2]=1;l.sexplosion[0]=13;l.sexplosion[1]=25;l.flame_trail[0]=
16;l.flame_trail[1]=25;g=0;for(f=l.asian_charriot.idle.length;g<f;g+=6)l.asian_charriot.idle[4+g]-=17;g=0;for(f=l.asian_charriot.attack.length;g<f;g+=6)l.asian_charriot.attack[4+g]-=17;g=0;for(f=l.asian_charriot.move.length;g<f;g+=6)l.asian_charriot.move[4+g]-=17;g=0;for(f=l.asian_charriot.die.length;g<f;g+=6)l.asian_charriot.die[4+g]-=17;g=0;for(f=l.flame_trail.length;g<f;g+=6)l.flame_trail[4+g]-=32,l.flame_trail[5+g]-=32;g=0;for(f=l.sexplosion.length;g<f;g+=6)l.sexplosion[4+g]-=48,l.sexplosion[5+
g]-=48;l.items1[1]=0;l.books[1]=0;l.potions[1]=0;l.troll.attack[1]=14;l.ork.attack[1]=14;l.dwarf.attack[1]=14;l.asian_mage.move[1]=14;l.arab_priest.attack=l.arab_priest.spell;l.asian_mage.spell=l.asian_mage.castspell;l.asian_mage.attack=l.asian_mage.castspell;l.asian_mage.spell[1]=13;l.arab_horse_archer.move=l.arab_horse.archer;l.arab_jwarrior.attack[1]=14;l.arab_peasant.attack=l.arab_peasant.attack1;l.arab_peasant.tree=l.arab_peasant.wood;l.asian_peasant.attack=l.asian_peasant.attack1;l.asian_peasant.cut=
l.asian_peasant.chop;l.asian_peasant.tree=l.asian_peasant.wood;l.asian_peasant.dig[1]=10;l.asian_peasant.dig[0]=11;l.asian_archer.die[1]=14;l.asian_ronin.attack=l.asian_ronin.attack1;g=0;for(f=l.asian_peasant.dig.length;g<f;g+=6)l.asian_peasant.dig[4+g]-=16,l.asian_peasant.dig[5+g]-=16;g=0;for(f=l.turn_to_stone.length;g<f;g+=6)l.turn_to_stone[4+g]-=56,l.turn_to_stone[5+g]-=64;l.arab_tcguild_c[4]=31;l.arab_tcguild_c[5]=85;l.dragon.idle=l.dragon.move;l.asian_samurai.attack=l.asian_samurai.attack1;l.asian_horsamurai.idle=
l.asian_horsamurai.idle1;l.asian_horsarcher.idle=l.asian_horsarcher.idle2;l.asian_priest.attack=l.asian_priest.attack1;l.asian_priest.spell=l.asian_priest.pray;l.asian_monk.attack[1]=12;l.euro_mage.attack=l.euro_mage.spell;l.euro_ghost.idle=l.euro_ghost.move;l.euro_priest.attack=l.euro_priest.spell;l.arab_mage.spell=l.arab_mage.attack;l.cursor[1]=15;l.star[1]=15;l.select[4]+=3;l.select[5]+=3;l.arab_houses_c[d]=96;l.asia_houses_c[d]=96;l.asia_houses_c[4]-=9;l.asia_houses_c[5]-=15;l.wood_build[2]=1;
l.res_gold[2]=1;l.res_gold_s[2]=1;l.res_stone[2]=1;l.res_stone_s[2]=1;l.bridge_horz1[4]=-9;l.bridge_horz1[5]=132;l.bridge_horz1[4]=-9;l.bridge_horz1[5]=132;l.euro_stable_c[4]+=18;l.euro_stable_c[5]-=10;l.euro_lumbermill_s[4]-=19;l.euro_lumbermill_s[5]-=17;l.wood_tower_c[4]=0;l.wood_tower_c[5]*=1;l.bat.idle=l.bat.move;l.galleon.idle[1]=7;l.galleon.die[1]=8;l.expl_small_water[1]=11;g=0;for(f=l.curse.length;g<f;g+=6)l.curse[5+g]-=48;g=0;for(f=l.impersonate.length;g<f;g+=6)l.impersonate[5+g]-=48;g=0;
for(f=l.bless.length;g<f;g+=6)l.bless[5+g]-=48;g=0;for(f=l.euro_barracks_c.length;g<f;g+=6)l.euro_barracks_c[4+g]+=50;g=0;for(f=l.healing.length;g<f;g+=6)l.healing[5+g]-=48;g=0;for(f=l.expl_small_hole.length;g<f;g+=6)l.expl_small_hole[4+g]-=4,l.expl_small_hole[5+g]-=34;Date.now();g=[c.createKnight,c.createHorseArcher1,c.createHorseArcher2,c.createHorseSamurai,c.createChariot,c.createEnichar,c.createCavalry];f=ka.size;h=new Float32Array(1048576);k=zl(m,h,f,0);ka.info=h;ka.ids=k/16;ka.originalLength=
ra.length;Zb={sword:{name:"Sword",iconID:16,img:m.items1,d:0,dMax:7,attack:1,type:52,sword:1},bow:{name:"Bow",iconID:4,img:m.items1,d:15,dMax:4,attack:1,type:52,sword:1},shield:{name:"Shield",iconID:1,img:m.items1,d:8,dMax:6,defence:1,type:52,shield:1},potion:{name:"Potion",iconID:11,img:m.potions,d:0,dMax:7,type:52,potion:1},book:{name:"Book",iconID:9,img:m.books,d:0,dMax:4,type:52,book:1},gold:{name:"Gold",iconID:20,img:m.item_gold,d:0,dMax:0,type:52},stone:{name:"Stone",iconID:22,img:m.item_stone,
d:0,dMax:0,type:52},food:{name:"Food",iconID:14,img:m.item_food,d:0,dMax:0,type:52},wood:{name:"Wood",iconID:15,img:m.item_tree,d:0,dMax:0,type:52},iron:{name:"Iron",iconID:21,img:m.item_iron,d:0,dMax:0,type:52}};Ui=[Zb.sword,Zb.potion,Zb.book,Zb.bow,Zb.shield];h=[c.move,c.attack,c.stop,c.stand,c.pickUp,c.explore,c.healing,c.bless];f=[c.attack,c.guard,c.patrol,c.explore,c.stop,c.stand,c.attackGround,c.steady,c.move];n=[c.buildAcademy,c.buildWorkshop,c.buildWorkshop1,c.buildAcademy1,c.buildWorkshop2,
c.buildAcademy2];d=[c.buildMerchands1,c.buildMerchands2,c.buildMerchands];Cb={euro:{},asia:{},arab:{},common:{}};A=[{name:"Footman",attack:6,defence:3,health:65,maxHealth:65,img:m.euro_footman.idle,attackSound:Kc,invType:0,invMax:8,validator:da,human:12,iconID:36,time:12,sight:5,url:m.euro_footman,icons:e,cost:[0,0,50,0],attDist:1,spd:50,dieSound:$a,clss:"footman",size:1,standardFunc:G,radix:0,zLevel:1,strID:"e_footman",race:"euro"},{name:"Pikeman",radix:0,attackSound:Kc,attack:8,defence:4,health:75,
maxHealth:75,img:m.euro_pikeman.idle,invType:0,dieSound:$a,invMax:8,validator:da,human:1,iconID:39,time:18,sight:5,url:m.euro_pikeman,icons:e,cost:[40,0,60,0],attDist:1,spd:50,standardFunc:G,clss:"e_pikeman",zLevel:1,size:1,strID:"e_pikeman",nu:c.createPikeman,race:"euro"},{name:"Spy",radix:0,attack:20,defence:0,mana:100,manaMax:100,health:50,maxHealth:50,img:m.euro_spy.idle,attackSound:["spy%20kill%201","spy%20kill%202","spy%20kill%203"],invType:0,invMax:8,validator:da,human:1,dieSound:$a,iconID:41,
time:30,sight:12,url:m.euro_spy,icons:[c.move,c.attack,c.guard,c.patrol,c.pickUp,c.explore,c.stop,c.stand,c.impersonate,c.revealSelf],zLevel:1,cost:[120,0,0,0],attDist:1,spd:50,clss:"spy",standardFunc:G,size:1,update:["mana","manaSpeed",1E3],isSpy:1,strID:"spy",nu:c.createSpy,race:"common"},{name:"Maceman",radix:0,attack:8,defence:0,health:120,maxHealth:120,img:m.euro_maceman.idle,attackSound:Kc,invType:0,invMax:8,validator:da,human:1,iconID:37,time:14,dieSound:$a,sight:5,zLevel:1,url:m.euro_maceman,
icons:e,cost:[0,0,120,0],attDist:1,spd:50,clss:"maceman",standardFunc:G,size:1,strID:"e_maceman",nu:c.createMaceman,race:"euro"},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:m.euro_archer1.idle,invType:0,invMax:8,validator:da,human:1,sight:10,dieSound:$a,arrow:!0,iconID:38,zLevel:1,time:12,url:m.euro_archer1,icons:e,cost:[0,20,40,0],attDist:7,spd:50,clss:"archer",standardFunc:G,attimg:m.arrow1,attackSound:Gd,size:1,strID:"e_archer",nu:c.createArcher,race:"euro"},{radix:0,name:"Wizard",
attackSound:ok,dieSound:["mage"],attack:5,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:m.euro_mage.idle,zLevel:1,invType:0,invMax:8,validator:da,human:1,iconID:42,time:30,sight:15,url:m.euro_mage,icons:[c.stop,c.pickUp,c.explore,c.lightning,c.createBat,c.freeze,c.createGolem,c.invisibility,c.stand,c.attack,c.move],cost:[150,0,0,0],attDist:10,attimg:m.flame_bolt,ball:1,spd:50,clss:"mage",standardFunc:G,size:1,update:["mana","manaSpeed",1E3],strID:"e_mage",nu:c.createMage,race:"euro"},
{radix:0,name:"Longbowman",attack:6,defence:2,health:50,maxHealth:50,img:m.euro_longbowman.idle,zLevel:1,invType:0,invMax:8,dieSound:$a,attackSound:Gd,arrow:!0,validator:da,race:"euro",human:1,iconID:35,time:18,sight:18,url:m.euro_longbowman,icons:e,cost:[50,0,90,0],attDist:12,spd:50,standardFunc:G,clss:"longbowman",size:1,d2attack:2,strID:"e_longbowman",attimg:m.arrow1,nu:c.createLongbowman},{radix:0,clss:"tree",name:"Tree",health:100,maxHealth:100,img:m.terrain_tree,invType:0,invMax:8,zLevel:1,
mMapcolor:[11,131,11],validator:da,child:[{img:m.terrain_tree_s,rgb:[0,0,0,.5],alpha:1,x:0,y:0}],iconID:23,url:m.terrain_tree,dimgInfinity:m.terrain_tree,dimgRND:3,icons:[],res:1,race:"common",build:!0,size:1,zolotoy:1,strID:"tree"},{radix:0,name:"Crusader",zLevel:1,dieSound:re,attackSound:pe,attack:14,defence:8,health:180,maxHealth:180,img:m.crus.idle,invType:0,invMax:8,validator:da,human:1,race:"euro",iconID:100,time:19,sight:5,url:m.crus,icons:e,cost:[0,0,0,0],attDist:1,spd:85,standardFunc:G,clss:"crusader",
size:1,strID:"crusader"},{radix:0,name:"Priest",attack:20,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:m.euro_priest.idle,invType:0,zLevel:1,invMax:8,validator:da,human:1,iconID:40,time:30,ball:1,sight:21,dieSound:$a,url:m.euro_priest,icons:h,attackOnly:jf.magic_creatures.obj,cost:[150,0,0,0],attDist:18,race:"euro",spd:50,standardFunc:G,clss:"priest",size:1,update:["mana","manaSpeed",1E3],strID:"e_priest",nu:c.createPriest,attimg:m.flame_bolt},{radix:0,name:"Peasant",attackSound:Ph,attack:5,
defence:0,health:50,maxHealth:50,img:m.euro_peasant.idle,invType:0,invMax:8,dieSound:$a,zLevel:1,validator:da,human:1,race:"euro",iconID:33,time:8,sight:5,url:m.euro_peasant,icons:[c.move,c.menuBuilds,c.repair,c.conquest,c.dcm,c.pickUp,c.explore,c.stop,c.stand,c.attack,c.bribe,c.sameSpeed,c.restoreSpeed],cost:[0,0,50,0],attDist:1,spd:50,clss:"peon",size:1,peon:1,strID:"e_peon",nu:c.createPeon,nocapture:1},{radix:0,clss:"cathedral",name:"Cathedral",dieSound:J,sound:["e_cathedral1","e_cathedral2"],
resistance:700,health:5E3,maxHealth:5E3,img:m.euro_cathedral,invType:0,invMax:8,race:"euro",zLevel:1,validator:N,bimg:m.build5x5,dimg:m.des_5x5,iconID:60,icons:[c.createCrusaders,c.techFanaticism,c.techEspionage,c.techInquisition,c.techHealing,c.techBless,c.techCrusade,c.techMedicine],time:90,sight:8,child:[{img:m.euro_cathedral_c,x:0,y:0},{img:m.euro_cathedral_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,5]),url:m.euro_cathedral,build:!0,
cost:[2E3,0,0,2E3],onbuild:[c.buildChurch],size:1,strID:"cathedral"},{radix:0,name:"Castle",clss:"castle",dieSound:J,sound:["e_castle1"],resistance:700,health:8E3,maxHealth:8E3,img:m.euro_castle,invType:1,invMax:50,race:"euro",zLevel:1,validator:N,bimg:m.build6x6,dimg:m.des_6x6,iconID:59,time:120,sight:12,child:[{img:m.euro_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:m.euro_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[c.createPeon,c.createSpy,c.emergeAllUnits,c.techFeudalism,c.techArchitecture,c.techLearning],
space:new Uint8Array([0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,7]),menu:Aa,url:m.euro_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1,strID:"e_castle"},{radix:0,name:"Wooden Wall",clss:"wall_wood",resistance:700,health:2E3,maxHealth:2E3,img:m.wood_tower,time:6,sight:1,zLevel:1,dieSound:J,validator:N,bimg:m.wood_build,dimgInfinity:m.wood_debris,iconID:49,icons:[],mx:0,race:"common",my:0,hframe:71,menu:Aa,url:m.wood_tower,
space:new Uint8Array([1,1]),wall:1,build:!0,cost:[0,20,0,0],size:1,strID:"woodwall",child:[{img:m.wood_tower_c,x:0,y:0}]},{radix:0,name:"Barracks",clss:"barracks",strID:"e_barrack",sound:Qh,generator:1,resistance:500,health:1400,maxHealth:1400,img:m.euro_barrack,invType:1,invMax:0,dieSound:J,time:60,sight:6,zLevel:1,race:"euro",validator:N,bimg:m.build5x5,dimg:m.des_5x5,child:[{img:m.euro_barracks_c,mv:!0},{img:m.euro_barrack_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:57,icons:[c.createFootman,c.createArcher,
c.createMaceman,c.createPikeman,c.createLongbowman,c.createKnight],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:m.euro_barrack,build:!0,cost:[0,200,0,200],size:1},{radix:0,strID:"e_lumber",name:"Lumber Mill",sound:["e_lumber1"],clss:"lumber_mill",resistance:500,health:800,maxHealth:800,img:m.euro_lumbermill,invType:1,invMax:0,time:30,race:"euro",sight:4,dieSound:J,zLevel:1,validator:N,bimg:m.build2x2,dimg:m.des_2x2,iconID:64,child:[{img:m.euro_lumbermill_c,x:0,y:0},
{alpha:!0,img:m.euro_lumbermill_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[c.techLongbow,c.techWoodCutting,c.techCrossbow],space:new Uint8Array([1,1,1,1,2]),hframe:98,url:m.euro_lumbermill,build:!0,cost:[0,100,0,0],storage:1,size:1},{radix:0,name:"Mage Tower",strID:"e_magetower",sound:["e_magetower1","e_magetower2","e_magetower3"],clss:"magictower",resistance:700,health:5E3,maxHealth:5E3,img:m.euro_magetower,invType:1,invMax:0,time:90,race:"euro",dieSound:J,sight:8,validator:N,bimg:m.build5x5,dimg:m.des_5x5,
zLevel:1,child:[{img:m.euro_magetower_c,x:0,y:0},{img:m.euro_magetower_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:71,icons:[c.createMage,c.techBat,c.techInvisibility,c.techLightning,c.techFreeze,c.techGolem],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.euro_magetower,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,strID:"e_waracademy",name:"Warriors Guild",sound:["e_waracademy1"],clss:"academy",resistance:700,health:5E3,maxHealth:5E3,img:m.euro_waracademy,invType:1,invMax:0,race:"euro",
time:90,sight:8,dieSound:J,zLevel:1,validator:N,bimg:m.build6x6,dimg:m.des_6x6,iconID:56,child:[{img:m.euro_waracademy_c,x:0,y:0,mv:!0},{img:m.euro_waracademy_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],icons:[c.techHeroism,c.techWarfare,c.techMercenaries,c.techSiegeTactics,c.techBodyBuilding,c.techLeadership,c.techTactics,c.techHeroes,c.techHonor,c.techFame],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,5]),url:m.euro_waracademy,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,name:"Storage",
strID:"e_storage",sound:["e_storage1","e_storage2"],clss:"storage",resistance:80,health:800,maxHealth:800,img:m.euro_storage,invType:1,invMax:0,time:30,dieSound:J,zLevel:1,sight:5,validator:N,bimg:m.build4x4,dimg:m.des_4x4,iconID:69,race:"euro",icons:[c.techGoldMining,c.techStoneMining],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:m.euro_storage,storage:0,build:!0,cost:[0,200,0,0],size:1,child:[{img:m.euro_storage_c,x:0,y:0},{img:m.euro_storage_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},
{radix:0,name:"Knight",strID:"e_knight",dieSound:re,clss:"knight",attackSound:pe,attack:12,defence:6,health:120,maxHealth:120,img:m.euro_knight.idle,invType:0,zLevel:1,race:"euro",invMax:8,validator:da,human:1,iconID:43,d2attack:2,time:22,sight:5,url:m.euro_knight,icons:e,cost:[120,0,70,0],attDist:1,spd:85,nu:c.createKnight,standardFunc:G,size:1},{radix:0,name:"Field",clss:"field",strID:"field",instantBuild:1,resistance:80,health:100,maxHealth:100,img:m.fields,invMax:0,validator:Xh,zLevel:1,iconID:104,
race:"common",icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:m.fields,build:!0,field:1,res:2,cost:[0,200,0,0],rndDirection:9,time:0,sight:1,z32:.5,size:1},{radix:0,name:"Golden rocks",mMapcolor:[148,148,0],strID:"gold",sound:["mine1"],clss:"golden_rocks",resistance:0,health:8E3,maxHealth:8E3,img:m.res_gold,invMax:0,validator:N,iconID:20,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.res_gold,build:!0,zLevel:1,race:"common",res:0,cost:[0,0,0,0],time:0,sight:2,dieSound:["destroy%20mine"],
size:1,zolotoy:1,child:[{img:m.res_gold_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:m.res_gold},{radix:0,name:"Rocks",strID:"stone",mMapcolor:[132,132,132],sound:["mine1"],clss:"rocks",dieSound:["destroy%20mine"],resistance:0,health:8E3,maxHealth:8E3,img:m.res_stone,invMax:0,validator:N,zLevel:1,iconID:22,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.res_stone,build:!0,res:3,cost:[0,0,0,0],race:"common",time:0,sight:2,size:1,zolotoy:1,child:[{img:m.res_stone_s,x:0,
y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:m.res_stone},{radix:0,name:"Farm",strID:"e_farm",sound:["e_farm1","e_farm2"],clss:"farm",resistance:0,health:800,maxHealth:800,img:m.euro_farm,invType:1,invMax:0,zLevel:1,validator:N,bimg:m.build4x4,dimg:m.des_4x4,iconID:61,dieSound:J,race:"euro",icons:[c.createCow,c.techCropRotation,c.techDomestication],space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Aa,url:m.euro_farm,build:!0,cost:[0,200,0,0],time:30,sight:5,storage:2,size:1,child:[{img:m.euro_farm_c,
x:0,y:0}]},{radix:0,name:"Merchants Guild",strID:"e_merchant",sound:["merchant"],clss:"merchants_guild",resistance:0,health:5E3,maxHealth:5E3,img:m.euro_tcguild,invType:1,invMax:0,validator:N,bimg:m.build6x6,zLevel:1,dimg:m.des_6x6,race:"euro",iconID:62,dieSound:J,icons:[c.techMapMaking,c.techTradeRoutes,c.techUsury,c.techSupplyStorage,c.techBribery,c.techTradeTaxes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),menu:Aa,url:m.euro_tcguild,build:!0,time:90,sight:8,cost:[2E3,
0,0,2E3],onbuild:[c.buildMarket],size:1,child:[{img:m.euro_tcguild_c,x:0,y:0},{img:m.euro_tcguild_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Church",clss:"church",strID:"e_church",sound:["e_church1"],resistance:0,health:800,maxHealth:800,img:m.euro_church,invType:1,invMax:0,dieSound:J,validator:N,bimg:m.build3x3,race:"euro",zLevel:1,dimg:m.des_3x3,iconID:139,icons:[c.createPriest],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),menu:Aa,url:m.euro_church,build:!0,cost:[0,0,200,200],time:40,sight:6,
size:1,child:[{img:m.euro_church_c,x:0,y:0},{img:m.euro_church_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Blacksmith",clss:"blacksmith",strID:"e_blacksmith",resistance:0,health:800,maxHealth:800,img:m.euro_blacksmith,invType:1,invMax:0,time:40,zLevel:1,sight:5,dieSound:J,validator:N,bimg:m.build4x4,race:"euro",dimg:m.des_4x4,child:[{img:m.euro_blacksmith_c,x:0,y:0}],iconID:58,icons:[c.techPlateArmor,c.techTemperIron,c.techScaleArmor,c.techHalberd,c.techChainMail],space:new Uint8Array([1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Aa,url:m.euro_blacksmith,build:!0,cost:[0,0,200,200],onbuild:n,size:1},{radix:0,name:"Cow",clss:"cow",nu:c.createCow,race:"common",strID:"cow",attack:0,defence:3,health:50,maxHealth:50,img:m.cow.idle,invType:0,invMax:8,zLevel:1,validator:da,iconID:99,time:20,dieSound:["cowdie1","cowdie2","cowdie3","cowdie4"],url:m.cow,icons:[c.move,c.stop],sight:3,cost:[0,0,300,0],attDist:0,spd:32,res:2,food:300,milk:50,milkMax:50,foodMax:600,size:1,cow:1,update:["milk","milkSpeed",
1E3,"food","cowSpeed",1E3]},{radix:0,name:"Stable",sound:["e_stables1"],clss:"stable",strID:"e_stable",onlyRequired:1,resistance:0,health:800,maxHealth:800,invType:1,invMax:0,race:"euro",zLevel:1,validator:N,bimg:m.build4x4,dimg:m.des_4x4,iconID:68,dieSound:J,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.euro_stables,build:!0,cost:[0,200,0,0],onbuild:g,size:1,time:40,sight:5,img:m.euro_stables,nu:c.createCow,child:[{img:m.euro_stable_c,x:0,y:0}]},{radix:0,name:"Workshop",sound:["e_workshop1"],
clss:"workshop",strID:"e_workshop",zLevel:1,resistance:0,health:800,maxHealth:800,img:m.euro_workshop,invType:1,invMax:0,dieSound:J,validator:N,bimg:m.build4x4,race:"euro",dimg:m.des_4x4,iconID:75,icons:[c.createCatapult,c.createHeavyCatapult,c.createBallist,c.techEngineering,c.techCannonTower],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:m.euro_workshop,build:!0,cost:[0,200,200,0],size:1,time:40,sight:5,child:[{img:m.euro_workshop_c,x:0,y:0}]},{radix:0,name:"Tavern",sound:["e_tavern1"],
clss:"tavern",strID:"e_tavern",dieSound:J,resistance:0,health:1E3,maxHealth:1E3,img:m.euro_tavern,invType:1,invMax:0,validator:N,race:"euro",bimg:m.build4x4,dimg:m.des_4x4,zLevel:1,iconID:70,icons:[c.createMercenaries,c.createHeroes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4]),url:m.euro_tavern,build:1,cost:[0,200,200,0],onbuild:d,actvintv:[c.iniMercenaries,c.iniHeroes],size:1,time:40,sight:5,child:[{img:m.euro_tavern_c,x:0,y:0}]},{name:"House",sound:["house1","house2","house3","house4",
"house5"],clss:"house",strID:"e_house",resistance:0,health:500,maxHealth:500,img:m.euro_houses,invType:1,invMax:0,validator:N,bimg:m.build3x3,dimg:m.des_3x3,race:"euro",iconID:73,zLevel:1,dieSound:J,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:m.euro_houses,build:!0,cost:[0,75,0,0],population:10,size:1,time:20,sight:4,child:[{img:m.euro_houses_c,x:0,y:0}]},{name:"Watch Tower",attackSound:Vf,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),clss:"watch_tower",strID:"watch_tower",attack:7,
health:400,maxHealth:400,img:m.euro_tower_wood_2,state:0,invType:1,race:"common",invMax:0,zLevel:1,dieSound:J,level:0,validator:N,child:[{img:m.euro_tower_wood_2_c,x:0,y:0},{alpha:!0,img:m.euro_tower_wood_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attimg:m.arrow1,attDist:8,bimg:m.build2x2,dimg:m.des_2x2,iconID:53,icons:[c.attack,c.stop,c.upgradeGuildTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_wood_2,build:!0,cost:[0,300,0,0],size:1,arrow:!0,time:10,sight:15,standardFunc:G},{name:"Market",sound:["e_market1"],
clss:"market",strID:"e_market",resistance:0,health:1400,maxHealth:1400,img:m.euro_market,invType:1,invMax:0,dieSound:J,zLevel:1,validator:N,bimg:m.build4x4,dimg:m.des_4x4,iconID:65,race:"euro",icons:[c.createCaravan],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,4]),url:m.euro_market,build:!0,cost:[0,200,200,0],size:1,time:60,sight:8,child:[{img:m.euro_market_c,x:0,y:0}]},{name:"Outpost",sound:["e_outpost1"],clss:"outpost",strID:"e_outpost",zLevel:1,resistance:0,health:2E3,maxHealth:2E3,img:m.euro_outpost,
invType:1,dieSound:J,invMax:50,validator:N,race:"euro",bimg:m.build4x4,dimg:m.des_4x4,iconID:66,icons:[c.emergeAllUnits],space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,4]),url:m.euro_outpost,build:!0,cost:[0,200,0,400],size:1,child:[{img:m.euro_outpost_c,x:0,y:0},{img:m.euro_outpost_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{name:"Bridge",clss:"bridge",strID:"bridge",resistance:0,health:1E4,maxHealth:1E4,img:m.bridge_horz,invMax:0,valid2:!0,validator:Al,bimg:m.bridge_horz_build,
race:"common",zLevel:1,dieSound:J,child:[{alpha:!0,img:m.bridge_horz_s,x:0,y:0,rgb:[0,0,0,.5]},{img:m.bridge_horz1,x:0,y:0,z:6}],time:22,sight:1,dimg:m.bridge_horz_demol,iconID:44,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,11]),url:m.bridge_horz,build:!0,cost:[0,200,0,400],size:1},{name:"Dummy",clss:"dummy",strID:"dummy",resistance:0,health:5E3,maxHealth:5E3,
img:m.dummy1,invMax:0,validator:da,bimg:m.dummy1_b,iconID:165,icons:[],mx:0,zLevel:1,my:16,hframe:65,race:"common",url:m.dummy1,dimg:m.dummy1_d,build:!0,cost:[0,300,0,0],dummy:!0,child:[{img:m.dummy1_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:10,sight:1},{name:"Catapult",strID:"catapult",dieSound:Xf,clss:"catapult",attackSound:Wf,defence:0,attack:10,health:110,maxHealth:110,img:m.catapult.idle,invMax:0,radix:0,validator:da,iconID:30,time:30,sight:20,race:"common",url:m.catapult,level:0,zLevel:1,icons:f,
cost:[0,600,0,0],nofreeze:1,arrow:!1,attDist:17,spd:40,standardFunc:G,size:1,attimg:m.cat_stone,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:c.createCatapult},{name:"Ballista",radix:0,strID:"ballista",attackSound:Wf,dieSound:Xf,clss:"ballista",defence:0,attack:60,health:75,maxHealth:75,img:m.ballista.idle,invMax:0,validator:da,iconID:31,time:30,sight:16,nofreeze:1,race:"common",zLevel:1,url:m.ballista,icons:f,cost:[0,800,0,0],attDist:13,spd:40,standardFunc:G,size:1,attimg:m.arrow_ballista1,space:new Uint8Array([1,
1,1,1,2]),attackDeg:30,nu:c.createBallist},{name:"Heavy Catapult",strID:"heavy_catapult",attackSound:Wf,defence:0,attack:25,health:250,maxHealth:250,img:m.h_catapult.idle,invMax:0,radix:0,validator:da,iconID:45,time:60,dieSound:Xf,sight:26,race:"common",url:m.h_catapult,zLevel:1,icons:f,standardFunc:G,cost:[0,1200,0,0],attDist:22,spd:40,nofreeze:1,clss:"heavy_catapult",size:1,attimg:m.cb_metal,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:c.createHeavyCatapult},{radix:0,name:"Ghost",strID:"ghost",
defence:0,attack:8,health:60,maxHealth:60,img:m.euro_ghost.idle,invType:0,invMax:8,dieSound:["ghost1","ghost2"],validator:da,iconID:178,zLevel:1,race:"common",time:15,attackSound:nk,sight:5,standardFunc:G,url:m.euro_ghost,icons:e,w:1,cost:[40,0,0,0],attDist:1,spd:80,clss:"ghost",size:1,nu:c.createGhost},{name:"Harbor",strID:"e_harbor",resistance:80,health:800,maxHealth:800,img:m.euro_harbor,invType:1,invMax:0,validator:Yg,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:m.build_harbor,dimg:m.des_harbor,
zLevel:1,race:"euro",dieSound:J,iconID:63,icons:[c.createFishingBoat,c.createXebec,c.createHulk,c.createGalleon,c.techLandingTactics],clss:"harbor",url:m.euro_harbor,storage:4,build:!0,cost:[0,200,200,0],child:[{img:m.euro_harbor_c,x:0,y:0},{img:m.euro_harbor_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{radix:0,name:"Messiah",strID:"messiah",attack:50,defence:10,mana:1E3,manaMax:1E3,health:1E3,maxHealth:1E3,img:m.messiah.idle,invType:0,invMax:0,race:"common",validator:da,human:1,iconID:169,
zLevel:1,attackSound:["messiah_attack"],dieSound:["messiah"],time:300,sight:26,url:m.messiah,standardFunc:G,icons:e,cost:[2E3,0,0,0],attDist:10,spd:50,clss:"messiah",size:1,update:["mana","manaSpeed",1E3]},{name:"Magic Gateway",sound:["gateway"],strID:"gateway",magicGateway:1,resistance:0,health:Infinity,maxHealth:Infinity,img:m.teleport,invMax:0,validator:N,bimg:m.build4x4,zLevel:1,dieSound:J,race:"common",iconID:180,clss:"magic_gateway",icons:[c.createOrk,c.createDwarf,c.createGhost,c.createSkeleton],
space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,5]),url:m.teleport,build:!0,cost:[0,0,0,0],size:1,time:10,sight:10,zolotoy:1,child:[{img:m.teleport_c,x:0,y:0},{alpha:!0,img:m.teleport_s,x:0,y:0,rgb:[0,0,0,.5]}],standardFunc:Sm},{name:"Guard Tower",strID:"guard_tower",race:"common",clss:"guard_tower",attackSound:Vf,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:12,health:1E3,maxHealth:1E3,img:m.euro_tower_wood,state:0,invType:1,invMax:0,dieSound:J,zLevel:1,validator:N,
child:[{img:m.euro_tower_wood_c,x:0,y:0},{alpha:!0,img:m.euro_tower_wood_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:12,bimg:m.build2x2,dimg:m.des_2x2,iconID:52,icons:[c.attack,c.stop,c.upgradeStoneTower,c.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_wood,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:m.arrow1,time:35,sight:16,standardFunc:G},{name:"Sword",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:Vb,iconID:16,url:m.items1,icons:[],cost:[0,
0,0,0],size:1,zLevel:0,z32:.5,radix:0,race:"common",item:1},{name:"Bow",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:Vb,iconID:4,url:m.items1,icons:[],cost:[0,0,0,0],size:1,z32:.5,zLevel:0,radix:0,race:"common",item:1},{name:"Shield",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:Vb,iconID:1,url:m.items1,icons:[],cost:[0,0,0,0],zLevel:0,race:"common",radix:0,size:1,z32:.5,item:1},{name:"Potion",attack:0,defence:0,health:25,maxHealth:25,
img:m.potions,state:0,invMax:0,validator:Vb,iconID:11,url:m.potions,icons:[],radix:0,race:"common",zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Book",attack:0,defence:0,health:25,maxHealth:25,img:m.book1,state:0,invMax:0,validator:Vb,iconID:9,zLevel:0,race:"common",radix:0,url:m.books,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Gold",health:1,maxHealth:1,img:m.item_gold,invMax:0,validator:Vb,iconID:20,radix:0,race:"common",zLevel:0,url:m.item_gold,icons:[],cost:[0,0,0,0],size:1,z32:.5,
item:1},{name:"Stone",health:1,maxHealth:1,img:m.item_stone,invMax:0,validator:Vb,iconID:22,race:"common",radix:0,url:m.item_stone,zLevel:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Food",health:15,maxHealth:15,img:m.item_food,invMax:0,mMapcolor:[0,255,255],validator:Vb,iconID:14,url:m.item_food,radix:0,race:"common",icons:[],zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{ignore:1,name:"Wood",health:1,maxHealth:1,img:m.item_wood,invMax:0,validator:Vb,iconID:15,url:m.item_wood,icons:[],
race:"common",radix:0,zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Iron",health:1,maxHealth:1,img:m.item_iron,invMax:0,validator:Vb,iconID:21,zLevel:0,race:"common",url:m.item_iron,radix:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Keep Tower",strID:"keep_tower",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:16,health:2E3,maxHealth:2E3,img:m.euro_tower_stone,state:0,invType:1,zLevel:1,attackSound:Vf,invMax:0,dieSound:J,validator:N,clss:"keep_tower",race:"common",child:[{alpha:!0,
img:m.euro_tower_stone_s,x:0,y:0,rgb:[0,0,0,.5]},{img:m.euro_tower_stone_c,x:0,y:0}],attDist:14,bimg:m.build2x2,dimg:m.des_2x2,standardFunc:G,iconID:54,icons:[c.attack,c.stop,c.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_stone,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:m.arrow_big1,time:40,sight:18},{name:"Cannon Tower",clss:"tower_stone2",strID:"tower_stone2",attackSound:qe,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:40,health:2500,maxHealth:2500,
img:m.euro_tower_stone_2,state:0,invType:1,invMax:0,dieSound:J,race:"common",validator:N,zLevel:1,child:[{img:m.euro_tower_stone_2_c,x:0,y:0},{alpha:!0,img:m.euro_tower_stone_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:10,bimg:m.build2x2,dimg:m.des_2x2,iconID:54,icons:[c.attack,c.stop],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_stone_2,build:!0,cost:[0,600,0,0],standardFunc:G,size:1,arrow:!1,attimg:m.hot_cannon,time:45,sight:18,attackDeg:30},{name:"Rocket Tower",strID:"tower_rocket",race:"asia",
clss:"tower_rocket",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),zLevel:1,attack:30,health:1400,maxHealth:1400,img:m.rocket_tower,state:0,invType:1,invMax:0,dieSound:J,validator:N,child:[{img:m.rocket_tower_c},{alpha:!0,img:m.rocket_tower_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:20,bimg:m.build2x2,dimg:m.des_2x2,iconID:186,icons:[],space:new Uint8Array([1,1,1,1,2]),url:m.rocket_tower,build:!0,cost:[0,600,0,0],standardFunc:G,size:1,arrow:!0,attimg:m.arrow_big1,time:60,sight:26},{radix:0,name:"Ork",
race:"common",strID:"ork",dieSound:["orc%20die%201","orc%20die%202"],attackSound:mk,attack:18,defence:2,health:75,maxHealth:75,img:m.ork.idle,invType:0,invMax:8,validator:da,zLevel:1,iconID:143,time:12,sight:5,url:m.ork,standardFunc:G,icons:e,cost:[60,0,0,0],attDist:1,spd:50,clss:"ork",size:1,nu:c.createOrk},{radix:0,name:"Dwarf",race:"common",attack:7,defence:7,health:120,maxHealth:120,img:m.dwarf.idle,invType:0,strID:"dwarf",invMax:8,zLevel:1,dieSound:$a,validator:da,iconID:185,time:12,sight:3,
url:m.dwarf,standardFunc:G,icons:e,cost:[80,0,0,0],attDist:1,spd:50,clss:"dwarf",size:1,nu:c.createDwarf},{radix:0,name:"Skeleton",strID:"skeleton",race:"common",dieSound:["skeleton%20die%201","skeleton%20die%202","skeleton%20die%203","skeleton%20die%204"],attack:4,defence:0,health:40,maxHealth:40,img:m.skeleton.idle,invType:0,zLevel:1,attackSound:Kc,invMax:8,nofreeze:1,validator:da,iconID:167,time:12,sight:3,url:m.skeleton,standardFunc:G,icons:e,cost:[0,0,30,0],attDist:1,spd:50,clss:"skeleton",size:1,
nu:c.createSkeleton},{radix:0,name:"Caravan",race:"euro",strID:"e_caravan",attack:0,defence:0,health:350,maxHealth:350,img:m.caravan.idle,invType:1,invMax:8,validator:da,iconID:34,zLevel:1,time:50,sight:7,url:m.caravan,icons:[c.move,c.trade,c.explore,c.stop,c.stand,c.unload],cost:[0,200,400,0],attDist:1,spd:75,clss:"caravan",size:1,nu:c.createCaravan},{name:"Castle",health:8E3,maxHealth:8E3,img:m.asia_castle,invType:1,strID:"a_castle",zLevel:1,race:"asia",invMax:50,validator:N,bimg:m.build6x6,dimg:m.des_6x6,
iconID:164,time:120,sight:12,dieSound:J,clss:"castle",child:[{img:m.asia_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:m.asia_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[c.createPeon1,c.createNinja,c.emergeAllUnits,c.techFeudalism,c.techArchitecture,c.techLearning,c.techBuddhism,c.techGreatWall],space:new Uint8Array([0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,8]),menu:Aa,url:m.asia_castle,build:!0,cost:[0,1500,0,1500],storage:-1,
castle:!0,population:20,size:1},{name:"Castle",dieSound:J,clss:"castle",strID:"r_castle",race:"arab",health:8E3,maxHealth:8E3,img:m.arab_castle,invType:1,invMax:50,validator:N,bimg:m.build6x6,dimg:m.des_6x6,zLevel:1,iconID:97,time:120,sight:12,child:[{img:m.arab_castle_c}],icons:[c.createPeon2,c.createSpy,c.emergeAllUnits,c.techFeudalism,c.techArchitecture,c.techLearning,c.techSlavery],space:new Uint8Array([0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,,8]),menu:Aa,url:m.arab_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{radix:0,name:"Peasant",attack:5,defence:0,health:50,maxHealth:50,img:m.asian_peasant.idle,invType:0,invMax:8,attackSound:Ph,race:"asia",validator:da,human:1,strID:"a_peon",iconID:132,dieSound:$a,zLevel:1,time:8,peon:1,sight:5,url:m.asian_peasant,icons:[c.move,c.menuBuilds1,c.repair,c.conquest,c.dcm,c.pickUp,c.explore,c.stop,c.stand,c.attack,c.sameSpeed,c.restoreSpeed],
cost:[0,0,40,0],attDist:1,spd:50,clss:"peon",nocapture:1,size:1},{radix:0,name:"Ninja",race:"asia",attack:12,defence:5,mana:100,manaMax:100,health:90,maxHealth:90,img:m.asian_ninja.idle,invType:0,invMax:8,attackSound:Kc,validator:da,human:1,iconID:133,strID:"ninja",dieSound:$a,zLevel:1,time:20,standardFunc:G,sight:10,url:m.asian_ninja,icons:[c.guard,c.patrol,c.pickUp,c.explore,c.stop,c.stand,c.invisibility,c.murder,c.move,c.attack,c.sameSpeed,c.restoreSpeed],cost:[120,0,0,0],attDist:1,spd:85,clss:"ninja",
size:1,update:["mana","manaSpeed",1E3]},{radix:0,name:"Ronin",attack:7,defence:0,health:45,maxHealth:45,img:m.asian_ronin.idle,invType:0,invMax:8,race:"asia",validator:da,human:1,standardFunc:G,iconID:141,strID:"ronin",dieSound:$a,zLevel:1,time:8,sight:5,url:m.asian_ronin,icons:e,cost:[0,0,40,0],attDist:1,spd:50,attackSound:Kc,clss:"a_footman",size:1},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:m.asian_archer.idle,invType:0,invMax:8,race:"asia",validator:da,human:1,strID:"a_archer",
dieSound:$a,zLevel:1,attimg:m.arrow1,iconID:136,arrow:1,attackSound:Gd,time:12,sight:10,url:m.asian_archer,icons:e,cost:[0,20,40,0],standardFunc:G,spd:50,clss:"archer",size:1,attDist:6},{radix:0,name:"Samurai",attack:10,defence:4,health:90,maxHealth:90,img:m.asian_samurai.idle,invType:0,race:"asia",strID:"samurai",invMax:8,attackSound:Kc,validator:da,human:1,iconID:142,time:20,standardFunc:G,zLevel:1,dieSound:$a,sight:6,url:m.asian_samurai,icons:e,cost:[50,0,150,0],attDist:1,spd:50,clss:"a_maceman",
size:1},{radix:0,name:"Horse Archer",attack:7,defence:0,health:75,maxHealth:75,img:m.asian_horsarcher.idle,invType:0,race:"asia",invMax:8,validator:da,human:1,attackSound:Gd,iconID:183,strID:"a_horse_archer",dieSound:re,time:20,standardFunc:G,sight:12,url:m.asian_horsarcher,zLevel:1,icons:e,arrow:1,attimg:m.arrow1,cost:[40,0,120,0],spd:85,clss:"horse_archer",size:1,attDist:7},{radix:0,name:"Horse Samurai",attack:14,defence:4,health:160,maxHealth:160,img:m.asian_horsamurai.idle,invType:0,invMax:8,
validator:da,human:1,iconID:135,race:"asia",standardFunc:G,attackSound:pe,time:22,zLevel:1,strID:"horse_samurai",dieSound:re,sight:5,url:m.asian_horsamurai,icons:e,cost:[75,0,120,0],attDist:1,spd:85,clss:"horse_samurai",size:1},{name:"Barracks",resistance:500,health:1400,maxHealth:1400,img:m.asia_barracks,invType:1,sound:Qh,invMax:0,time:60,dieSound:J,radix:0,sight:6,race:"asia",strID:"a_barrack",validator:N,zLevel:1,bimg:m.build5x5,dimg:m.des_5x5,child:[{img:m.asia_barracks_c,x:0,y:0,mv:!0},{img:m.asia_barracks_s,
x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:146,icons:[c.createRonin,c.createArcher1,c.createSamurai,c.createHorseArcher1,c.createHorseSamurai,c.createChariot],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:m.asia_barracks,build:!0,cost:[0,200,0,200],size:1,clss:"barracks"},{name:"Chariot",attack:4,defence:3,health:180,maxHealth:180,img:m.asian_charriot.idle,invType:0,radix:0,race:"asia",invMax:8,strID:"chariot",dieSound:["c%20die%201","c%20die%202","c%20die%203","c%20die%204",
"c%20die%205"],attackSound:pe,validator:da,human:1,zLevel:1,iconID:175,standardFunc:G,time:8,sight:5,url:m.asian_charriot,icons:e,cost:[0,200,150,0],attDist:1,spd:85,clss:"chariot",size:1},{radix:1,name:"Galleon",attackSound:qe,attack:35,attDist:12,race:"common",defence:0,health:1200,attackTime:2E3,maxHealth:1200,strID:"galleon",nu:c.createGalleon,img:m.galleon.idle,invType:1,invMax:24,dieSound:["ship%20sink"],zLevel:0,validator:kf,iconID:32,time:50,boat:!0,attimg:m.cb_metal,attackDeg:20,sight:16,
url:m.galleon,icons:[c.move,c.explore,c.unload,c.attack,c.attackGround,c.stop,c.stand,c.stop,c.stand,c.attack,c.steady,c.upgradeShip],cost:[0,1200,800,0],spd:50,nofreeze:1,clss:"galleon",standardFunc:G,size:1,peon:1},{radix:1,name:"Fishing Boat",attackSound:qe,attack:0,attDist:8,race:"common",defence:0,health:50,boat:!0,nu:c.createFishingBoat,maxHealth:50,img:m.boat.idle,invType:1,invMax:0,strID:"fishing_boat",dieSound:["ship%20sink"],zLevel:0,validator:kf,iconID:184,nofreeze:1,time:50,sight:16,url:m.boat,
icons:[c.move,c.explore,c.stop,c.stand,c.fishing],cost:[0,200,100,0],spd:65,clss:"fishing_boat",size:1},{radix:1,name:"Hulk",attackSound:qe,attack:18,attDist:10,race:"common",defence:0,health:700,maxHealth:700,strID:"hulk",img:m.hulk.idle,invType:1,attackTime:2E3,boat:!0,nu:c.createHulk,attackDeg:20,invMax:16,dieSound:["ship%20sink"],zLevel:0,validator:kf,iconID:128,time:30,sight:14,attimg:m.cb_metal,url:m.hulk,icons:[c.move,c.explore,c.unload,c.attack,c.attackGround,c.stop,c.stand,c.stop,c.stand,
c.attack,c.steady,c.upgradeShip],cost:[0,500,300,0],spd:65,nofreeze:1,clss:"hulk",standardFunc:G,size:1},{radix:1,name:"Pinque",attackSound:Gd,attack:10,race:"common",attDist:8,defence:0,health:300,boat:!0,maxHealth:300,img:m.xebec.idle,attimg:m.arrow1,arrow:!0,strID:"pinque",invType:1,invMax:8,dieSound:["ship%20sink"],zLevel:0,validator:kf,iconID:129,time:20,nofreeze:1,sight:12,url:m.xebec,icons:[c.move,c.explore,c.unload,c.attack,c.attackGround,c.stop,c.stand,c.stop,c.stand,c.attack,c.steady,c.upgradeShip],
cost:[0,300,200,0],spd:80,clss:"xebec",size:1,standardFunc:G,nu:c.createXebec},{radix:0,name:"Stone Golem",strID:"troll",defence:3,attack:25,health:400,maxHealth:400,img:m.troll.idle,invType:0,invMax:0,dieSound:["golem"],validator:da,iconID:144,race:"common",zLevel:1,nofreeze:1,attackSound:["golem1","golem2"],sight:10,standardFunc:G,url:m.troll,icons:e,w:1,cost:[120,0,0,0,600],attDist:1,spd:56,clss:"troll",size:1},{radix:0,name:"Bat",strID:"bat",defence:0,attack:3,health:20,maxHealth:20,img:m.bat.move,
invType:0,invMax:0,race:"common",bat:1,dieSound:["bat%20die"],validator:Zg,iconID:105,zLevel:2,attackSound:["bat%20attack"],sight:10,standardFunc:G,url:m.bat,icons:e,w:1,cost:[0,0,0,0,25],attDist:1,spd:128,clss:"bat",size:1,z32:1.5},{race:"arab",invType:0,invMax:8,iconID:138,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_peasant,img:m.arab_peasant.idle,spd:50,validator:da,human:1,icons:[c.move,c.menuBuilds2,c.repair,c.conquest,c.dcm,c.pickUp,c.explore,c.stop,c.stand,c.attack,c.convertJihad,
c.bribe,c.sameSpeed,c.restoreSpeed],name:"Peasant",clss:"peon",cost:[0,0,50,0],attDist:1,time:8,nocapture:1,peon:1,sight:5,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:172,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_footman,img:m.arab_footman.idle,standardFunc:G,spd:50,validator:da,human:1,attDist:1,icons:e,name:"Footman",clss:"footman",cost:[0,0,50,0],time:12,sight:5,health:50,attack:6,defence:1},{race:"arab",invType:0,invMax:8,iconID:170,zLevel:1,dieSound:[],
attackSound:[],size:1,radix:0,url:m.arab_archer,img:m.arab_archer.idle,spd:50,validator:da,standardFunc:G,human:1,attimg:m.arrow1,arrow:1,icons:e,name:"Archer",clss:"archer",cost:[0,20,40,0],time:12,sight:10,attDist:6,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:173,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_spearman,img:m.arab_spearman.idle,spd:50,validator:da,standardFunc:G,human:1,icons:e,name:"Spearman",clss:"pikeman",attDist:1,cost:[40,0,60,0],time:14,
sight:5,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:174,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,standardFunc:G,url:m.arab_satrap,img:m.arab_satrap.idle,spd:50,validator:da,human:1,icons:e,name:"Satrap",attDist:1,clss:"maceman",cost:[0,0,120,0],time:14,sight:5,health:120,attack:8,defence:0},{race:"arab",invType:0,invMax:8,iconID:171,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_cavalry,standardFunc:G,img:m.arab_cavalry.idle,spd:85,validator:da,human:1,
attDist:1,icons:e,name:"Cavalry",clss:"heavy_cavalry",cost:[60,0,100,0],time:14,sight:5,health:90,attack:10,defence:4},{race:"arab",invType:0,invMax:8,iconID:168,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_horse_archer,img:m.arab_horse_archer.idle,spd:85,validator:da,human:1,standardFunc:G,icons:e,name:"Horse Archer",clss:"horse_archer",cost:[50,0,100,0],time:14,attimg:m.arrow1,arrow:1,sight:12,attDist:7,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:179,zLevel:1,
dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_jwarrior,img:m.arab_jwarrior.idle,spd:50,validator:da,human:1,standardFunc:G,icons:e,name:"Jihad warrior",attDist:1,clss:"jihad_warrior",cost:[0,0,100,0],time:8,sight:5,health:75,attack:10,defence:2},{race:"arab",invType:0,invMax:8,iconID:176,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_priest,img:m.arab_priest.idle,standardFunc:G,spd:50,mana:100,validator:da,human:1,icons:h,name:"Priest",clss:"priest",cost:[150,0,0,0],time:30,
sight:21,attDist:18,health:60,attack:20,update:["mana","manaSpeed",1E3],manaMax:100,defence:0,attimg:m.flame_bolt,ball:1,attackOnly:jf.magic_creatures.obj},{race:"arab",invType:0,invMax:0,iconID:105,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:0,img:0,testing:1,illegal:1,spd:50,validator:da,human:1,icons:[],name:"Spy",clss:"spy",cost:150,time:30,sight:12,health:50,attack:20,defence:0},{race:"arab",invType:0,invMax:8,iconID:188,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,attimg:m.flame_bolt,
url:m.arab_mage,img:m.arab_mage.idle,spd:50,validator:da,human:1,icons:[c.stop,c.pickUp,c.explore,c.createCarpet,c.createJinn,c.fireRain,c.magicVision,c.raiseDead,c.attack,c.stand,c.move],standardFunc:G,name:"Mage",clss:"mage",ball:1,mana:100,manaMax:100,update:["mana","manaSpeed",1E3],cost:[150,0,0,0],time:30,sight:15,attDist:10,health:60,attack:8,defence:0},{race:"arab",invType:1,invMax:8,iconID:126,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_caravan,img:m.arab_caravan.idle,spd:75,
validator:da,human:1,icons:[],name:"Caravan",clss:"trader",cost:[0,0,500,0],time:30,sight:5,health:150},{race:"arab",invType:0,invMax:8,iconID:177,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_enichar,img:m.arab_enichar.idle,spd:85,validator:da,human:1,standardFunc:G,icons:e,name:"Enichar",attDist:1,clss:"enichar",cost:[80,0,120,0],time:25,sight:5,health:130,attack:18,defence:4},{race:"arab",invType:1,invMax:0,iconID:82,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),
bimg:m.build3x3,dimg:m.des_3x3,radix:0,population:10,url:m.arab_houses,validator:N,build:1,icons:[],child:[{img:m.arab_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],time:20,sight:4,resistance:50,health:500},{race:"arab",invType:1,invMax:0,iconID:85,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_lumbermill,validator:N,build:1,icons:[c.techWoodCutting,c.techCrossbow],child:[{img:m.arab_lumbermill_c}],name:"Lumber Mill",clss:"lumber",
cost:[0,100,0,0],storage:1,time:30,sight:4,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:96,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_storage,validator:N,build:1,storage:0,icons:[c.techGoldMining,c.techStoneMining],child:[{img:m.arab_storage_c},{alpha:!0,img:m.arab_storage_s,rgb:[0,0,0,.5]}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,
invMax:0,iconID:80,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_farm,validator:N,build:1,icons:[c.createCow,c.techCropRotation,c.techDomestication,c.techCowPoaching,c.ridingHorses,c.techHorseManShip],child:[{img:m.arab_farm_c}],name:"Farm",storage:2,clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:81,zLevel:1,dieSound:J,validator:Yg,space:new Uint8Array([1,
1,0,0,1,1,1,1,1,1,1,1,4]),bimg:m.build_harbor,dimg:m.des_harbor,radix:0,url:m.arab_harbour,build:1,icons:[c.createFishingBoat,c.createXebec,c.createHulk,c.techLandingTactics],child:[{img:m.arab_harbour_c},{alpha:!0,img:m.arab_harbour_s,rgb:[0,0,0,.5]}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:79,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_blacksmith,
validator:N,build:1,icons:[c.techTemperIron,c.techScaleArmor,c.techScimitar,c.techChainMail,c.techHalberd],child:[{img:m.arab_blacksmith_c},{alpha:!0,img:m.arab_blacksmith_s,rgb:[0,0,0,.5]}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],onbuild:n,time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:95,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_workshop,validator:N,build:1,icons:[c.createCatapult,
c.createBallist,c.techEngineering,c.techCannonTower],child:[{img:m.arab_workshop_c},{alpha:!0,img:m.arab_workshop_s,rgb:[0,0,0,.5]}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:140,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_church,validator:N,build:1,icons:[c.createPriest2],child:[{img:m.arab_church_c},{alpha:!0,img:m.arab_church_s,rgb:[0,0,
0,.5]}],name:"Church",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"arab",invType:1,invMax:0,iconID:92,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_tavern,validator:N,build:1,icons:[c.createMercenaries,c.createHeroes],child:[{img:m.arab_tavern_c}],name:"Tavern",clss:"tavern",cost:[0,200,200,0],onbuild:d,actvintv:[c.iniMercenaries,c.iniHeroes],time:40,sight:5,resistance:150,health:1E3},
{race:"arab",invType:1,invMax:0,iconID:87,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_market,validator:N,build:1,icons:[c.createCaravan2],child:[{img:m.arab_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:98,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:m.build5x5,dimg:m.des_5x5,
radix:0,url:m.arab_barracks,validator:N,build:1,icons:[c.createFootman2,c.createArcher2,c.createSatrap,c.createPikeman2,c.createHorseArcher2,c.createCavalry,c.createEnichar,c.createJihad],child:[{img:m.arab_barracks_c},{alpha:!0,img:m.arab_barracks_s,rgb:[0,0,0,.5]}],name:"Barracks",clss:"barrack",cost:[0,0,200,200],time:60,sight:6,resistance:500,health:1400},{race:"arab",invType:1,invMax:0,iconID:91,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,
radix:0,url:m.arab_stables,validator:N,build:1,icons:[],child:[{img:m.arab_stables_c}],name:"Stable",clss:"stable",cost:[0,200,200,0],time:40,onbuild:g,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:50,iconID:89,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_outpost,validator:N,build:1,icons:[c.emergeAllUnits],child:[{img:m.arab_outpost_c,mv:1},{alpha:!0,img:m.arab_outpost_s,rgb:[0,0,0,.5]}],name:"Outpost",
clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"arab",invType:1,invMax:0,iconID:105,zLevel:1,dieSound:J,space:23213123,bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:0,img:0,validator:N,build:1,icons:[],child:[{img:3213123}],name:"NULL",testing:1,clss:"castle",cost:[0,1500,0,1500],time:120,sight:12,resistance:1E3,health:8E3},{race:"arab",invType:1,invMax:0,iconID:88,zLevel:1,dieSound:J,space:new Uint8Array([0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
0,1,1,1,1,0,0,6]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_mosque,validator:N,build:1,icons:[c.techFanaticism,c.techEspionage,c.techHealing,c.techBless,c.techJihad],child:[{img:m.arab_mosque_c},{alpha:!0,img:m.arab_mosque_s,rgb:[0,0,0,.5]}],name:"Mosque",onbuild:[c.buildChurch2],clss:"mosque",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:86,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,4]),bimg:m.build4x4,
dimg:m.des_4x4,radix:0,url:m.arab_magetower,validator:N,build:1,icons:[c.createMage2,c.techCarpet,c.techMagicWorkshop,c.techFireRain,c.techMagicVision,c.techNecromancy,c.techJinn],child:[{img:m.arab_magetower_c},{alpha:!0,img:m.arab_magetower_s,rgb:[0,0,0,.5]}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:93,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5]),bimg:m.build5x5,
dimg:m.des_5x5,radix:0,url:m.arab_tc_guild,validator:N,build:1,icons:[c.techUsury,c.techTradeRoutes,c.techSupplyStorage,c.techBribery,c.techOreFloatation],child:[{img:m.arab_tcguild_c},{alpha:!0,img:m.arab_tc_guild_s,rgb:[0,0,0,.5]}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[c.buildMarket2],sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:94,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,
dimg:m.des_5x5,radix:0,url:m.arab_waracademy,validator:N,build:1,icons:[c.techHeroism,c.techWarfare,c.techMercenaries,c.techRiddingHorses,c.techBodyBuilding,c.techLeadership,c.techHeroes,c.techJanissary,c.techHonor,c.techFame],child:[{img:m.arab_waracademy_c},{alpha:!0,img:m.arab_waracademy_s,rgb:[0,0,0,.5]}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:158,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,
1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_magicworkshop,validator:N,build:1,icons:[c.createObjects],child:[{img:m.arab_magicworkshop_c},{alpha:!0,img:m.arab_magicworkshop_s,rgb:[0,0,0,.5]}],name:"Magic Workshop",disallowPoint:!0,clss:"magicworkshop",cost:[0,0,0,300],time:20,sight:5,resistance:200,health:1200},{race:"asia",invType:1,invMax:0,iconID:161,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,0,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.asia_houses,validator:N,
build:1,icons:[],child:[{img:m.asia_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],population:10,time:20,sight:4,resistance:50,health:500},{race:"asia",invType:1,invMax:0,iconID:149,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,storage:1,url:m.asia_lumbermill,validator:N,build:1,icons:[c.techWoodCutting,c.techCrossbow],child:[{img:m.asia_lumbermill_c},{img:m.asia_lumbermill_s,rgb:[0,0,0,.5],alpha:!0}],name:"Lumber Mill",clss:"lumber",
cost:[0,100,0,0],time:30,sight:4,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:154,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_storage,storage:0,validator:N,build:1,icons:[c.techGoldMining,c.techStoneMining],child:[{img:m.asia_storage_s,rgb:[0,0,0,.5],alpha:!0},{img:m.asia_storage_c}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,
invMax:0,iconID:147,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,storage:2,url:m.asia_farm,validator:N,build:1,icons:[c.techCropRotation,c.ridingHorses,c.irrigation],child:[{img:m.asia_farm_c}],name:"Farm",clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:148,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),validator:Yg,bimg:m.build_harbor,dimg:m.des_harbor,
radix:0,url:m.asia_harbor,build:1,icons:[c.createFishingBoat,c.createXebec,c.createHulk,c.techLandingTactics],child:[{img:m.asia_harbor_c},{img:m.asia_harbor_s,rgb:[0,0,0,.5],alpha:!0}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:145,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_blacksmith,validator:N,build:1,icons:[c.techTemperIron,
c.techScaleArmor,c.techArmoredChariot,c.techChainMail],child:[{img:m.asia_blacksmith_c},{img:m.asia_blacksmith_s,rgb:[0,0,0,.5],alpha:!0}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],time:40,sight:5,onbuild:n,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:157,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_workshop,validator:N,build:1,icons:[c.createCatapult,c.createBallist,c.techEngineering,
c.techCannonTower],child:[{img:m.asia_workshop_c,x:0,y:0},{img:m.asia_workshop_s,rgb:[0,0,0,.5],alpha:!0}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:162,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asian_monastery,validator:N,build:1,icons:[c.createMonk,c.createPriest1],child:[{img:m.asian_monastery_c},{img:m.asian_monastery_s,
rgb:[0,0,0,.5],alpha:!0}],name:"Monastery",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"asia",invType:1,invMax:0,iconID:155,zLevel:1,dieSound:J,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_tavern,validator:N,build:1,icons:[c.createMercenaries,c.createHeroes],child:[{img:m.asia_tavern_c},{img:m.asia_tavern_s,rgb:[0,0,0,.5],alpha:!0}],onbuild:d,name:"Tavern",clss:"tavern",actvintv:[c.iniMercenaries,
c.iniHeroes],cost:[0,200,200,0],time:40,sight:5,resistance:150,health:1E3},{race:"asia",invType:1,invMax:0,iconID:150,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_market,validator:N,build:1,icons:[],child:[{img:m.asia_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:153,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,0,1,1,1,
1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_stables,validator:N,build:1,icons:[],child:[{img:m.asia_stables_c,mv:!0},{img:m.asia_stables_s,rgb:[0,0,0,.5],alpha:!0}],name:"Stable",clss:"stable",onbuild:g,cost:[0,200,200,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:151,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.asia_outpost,validator:N,build:1,icons:[c.emergeAllUnits],
child:[{img:m.asia_outpost_c,mv:1},{img:m.asia_outpost_s,rgb:[0,0,0,.5],alpha:!0}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"asia",invType:1,invMax:0,iconID:163,zLevel:1,dieSound:J,space:new Uint8Array([0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,6]),bimg:m.build6x6,dimg:m.des_6x6,radix:0,url:m.asia_shao_lin,validator:N,build:1,icons:[c.techMeditation,c.techKungFu,c.techHealing,c.techPhilosophy,c.techNinjas,c.techMastery,
c.techTournaments,c.techMedicine],child:[{img:m.asia_shao_lin_c},{img:m.asia_shao_lin_s,rgb:[0,0,0,.5],alpha:!0}],name:"Shao Linn",onbuild:[c.buildChurch1],clss:"shaolinn",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:152,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_wizardguild,validator:N,build:1,icons:[c.createMage1,c.techConcentration,c.techWhirlpool,
c.techFlameBolt,c.techTurnToStone,c.techConfusion,c.techDragon],child:[{img:m.asia_wizardguild_c},{img:m.asia_wizardguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:159,zLevel:1,dieSound:J,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_tcguild,validator:N,build:1,icons:[c.techTradeRoutes,c.techUsury,
c.techJewelry,c.techSupplyStorage,c.techBanking,c.techChemistry,c.techSeaFood,c.techGunPowder,c.techRocketArrow],child:[{img:m.asia_tcguild_c,mv:!0},{img:m.asia_tcguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[c.buildMarket1],sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:156,zLevel:1,dieSound:J,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_warguild,
validator:N,build:1,icons:[c.techBushido,c.techHeroism,c.techWarfare,c.techMercenaries,c.techLeadership,c.techTactics,c.techHeroes,c.techHonor,c.techSunTzu],child:[{img:m.asia_warguild_c,mv:!0},{img:m.asia_warguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:0,invMax:0,iconID:166,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_priest,img:m.asian_priest.idle,spd:50,validator:da,human:1,
icons:[c.attack,c.stop,c.stand,c.pickUp,c.explore,c.healing,c.teach,c.move],name:"Priest",clss:"priest",cost:[170,0,0,0],time:30,sight:21,health:120,standardFunc:G,attDist:1,attack:10,defence:10,mana:100,update:["mana","manaSpeed",1E3],manaMax:100},{race:"asia",invType:0,invMax:0,iconID:187,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_monk,img:m.asian_monk.idle,spd:50,validator:da,human:1,icons:e,name:"Monk",standardFunc:G,clss:"monk",cost:[0,0,200,0],time:20,sight:5,health:90,attack:6,
defence:6,attDist:1},{race:"asia",invType:0,invMax:0,iconID:134,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_mage,img:m.asian_mage.idle,spd:50,attimg:m.flame_bolt,validator:da,standardFunc:G,human:1,icons:[c.stop,c.pickUp,c.explore,c.confusion,c.turnToStone,c.whirlpool,c.flameBolt,c.createDragon,c.attack,c.stand,c.move],name:"Mage",clss:"mage",cost:[150,0,0,0],ball:1,time:30,sight:15,mana:100,attDist:10,health:60,attack:8,defence:0,update:["mana","manaSpeed",1E3],manaMax:100},{radix:0,
name:"Dragon",strID:"dragon",defence:0,attack:25,health:300,maxHealth:300,img:m.dragon.idle,invType:0,invMax:0,dieSound:[],sSizex:2,sSizey:2,dragon:1,iconID:160,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:12,standardFunc:G,url:m.dragon,icons:e,cost:[80,0,0,0,800],attDist:2,spd:128,clss:"drg",size:1,z32:1.5,validator:Zg},{radix:0,name:"Carpet",strID:"carpet",defence:0,attack:0,health:90,maxHealth:90,img:m.carpet.idle,invType:1,invMax:8,dieSound:[],iconID:131,race:"common",zLevel:2,nofreeze:1,
attackSound:[],sight:8,url:m.carpet,icons:[c.move,c.unload,c.explore,c.stop,c.stand],cost:[80,0,0,0,500],attDist:2,spd:120,clss:"carpet",size:1,z32:1.5,validator:Zg},{radix:0,name:"Jinn",strID:"jinn",defence:5,attack:20,health:300,maxHealth:300,img:m.arab_jinn.idle,invType:0,invMax:0,dieSound:[],validator:da,iconID:182,race:"common",zLevel:1,nofreeze:1,attackSound:[],sight:8,standardFunc:G,url:m.arab_jinn,icons:e,w:1,cost:[80,0,0,0,300],attDist:1,spd:85,clss:"jinn",size:1}];te={};Vi={arr:[]};xb={euro:[],
asia:[],arab:[],common:[]};Bl=[];Tb=[[],[],[],[],[],[]];k=0;for(var v=A.length;k<v;k++){b=A[k];A[k].type=k;var B=b.space;b.name.split(" ").join("");b.population&&Bl.put(b);te[k]={};void 0!==b.storage&&(-1<b.storage?(0===b.storage&&Tb[3].put(k),Tb[b.storage].put(k)):(Tb[0].put(k),Tb[1].put(k),Tb[2].put(k),Tb[3].put(k)));Cb[b.race][b.name.toLowerCase().split(" ").join("")]=b;b.icons.menuName=b.strID;Vi[b.name]=k;Vi.arr.put(k);b.img||(b.img=b.url);b.maxHealth=b.health;b.race&&xb[b.race].put(b);g=0;f=
b.icons;for(h=f.length;g<h;g++)(n=f[g])&&n.obj&&(n.orderOrigin=b);if(B){g=[];b.free=g;d=B[B.length-1];b=(B.length-1)/d;var q=d+2;h=b+2;f=new Uint8Array(q*h);for(n=0;n<b;n++)for(var x=0;x<d;x++)f[(n+1)*q+x+1]=B[x+n*d];n=0;for(h*=q;n<h;n++)!f[n]&&(f[n+1]||f[n-1]||f[n+1+q]||f[n+1-q]||f[n-1+q]||f[n-1-q]||f[n+q]||f[n-q])&&(g.put(n%q-1),g.put(~~(n/q)-1))}}xb.euro=xb.euro.concat(xb.common);xb.asia=xb.asia.concat(xb.common);xb.arab=xb.arab.concat(xb.common);xb[0]=xb.euro;xb[1]=xb.arab;xb[2]=xb.asian;h=Cb.euro;
f=Cb.asia;n=Cb.arab;d=Cb.common;Cb[0]=Cb.euro;Cb[1]=Cb.arab;Cb[2]=Cb.asia;ee||(e.cut=R({a:"attack",g:"guard",r:"patrol",p:"pickUp",e:"explore",s:"stop",n:"stand"}),h.tavern.icons.cut=R({t:"trade1",g:"gamble",m:"createMercenaries",h:"createHeroes",l:"loan"}),h.castle.icons.cut=R({p:"createPeon",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning"}),f.castle.icons.cut=R({p:"createPeon1",n:"createNina",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",
b:"techBudhism",w:"techGreatwall"}),n.castle.icons.cut=R({p:"createPeon2",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",y:"techSlavery"}),h.barracks.icons.cut=R({f:"createFootman",a:"createArcher",m:"createMaceman",p:"createPikeman",l:"createLongbowman",k:"createKnight"}),f.barracks.icons.cut=R({r:"createRonin",a:"createArcher1",s:"createSamurai",h:"createHorseArcher1",o:"createHorseSamurai",c:"createChariot"}),n.barracks.icons.cut=R({f:"createFootman2",
a:"createArcher2",s:"createSatrap",p:"createPikeman2",h:"createHorseArcher2",c:"createCavalry",j:"createEnichar",d:"createJihad"}),h.magetower.icons.cut=R({m:"createMage"}),f.mageguild.icons.cut=R({m:"createMage1"}),n.mageguild.icons.cut=R({m:"createMage2"}),h.peasant.icons.cut=R({b:"menuBuilds",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",i:"bribe"}),n.peasant.icons.cut=R({b:"menuBuilds2",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",
a:"attack",j:"become_jihadw",i:"bribe"}),f.peasant.icons.cut=R({b:"menuBuilds1",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",t:"trade"}),h.priest.icons.cut=R({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),n.priest.icons.cut=R({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),f.priest.icons.cut=R({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",r:"raiseexp"}),h.wizard.icons.cut=R({m:"move",
a:"attack",s:"stop",n:"stand",l:"lightning",b:"createBat",f:"freeze",t:"createGolem",i:"invisibility"}),n.mage.icons.cut=R({m:"move",a:"attack",s:"stop",n:"stand",c:"spell_spawncarpet",j:"spell_spawnjin",r:"spell_firerain",v:"spell_magicvision",d:"raisedead"}),f.mage.icons.cut=R({m:"move",a:"attack",s:"stop",n:"stand",h:"spell_hypnotize",t:"spell_turntostone",w:"spell_whirlpool",f:"spell_flamebolt",d:"spell_spawndragon"}),d.spy.icons.cut=R({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",
n:"stand",s:"stop"}),f.monk.icons.cut=R({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"}),f.ninja.icons.cut=R({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand",c:"cloak",u:"murder"}),d.catapult.icons.cut=R({a:"attack",g:"guard",p:"patrol",e:"explore",s:"stop",n:"stand",r:"attack_ground",h:"hold_steady"}),h.market.icons.cut=R({c:"createCaravan"}),n.market.icons.cut=R({c:"createCaravan2"}),f.market.icons.cut=R({b:"market_items",s:"market_sell"}),
h.workshop.icons.cut=R({c:"createCatapult",h:"createHeavyCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),n.workshop.icons.cut=R({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),f.workshop.icons.cut=R({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),h.church.icons.cut=R({p:"createPriest"}),n.church.icons.cut=R({p:"createPriest2"}),f.monastery.icons.cut=R({m:"createMonk",p:"createPriest1"}),n.magicworkshop.icons.cut=
R({i:"build_item"}),g=R({c:"buildCastle",s:"buildStorage",b:"buildBarrack",k:"buildBlacksmith",f:"buildFarm",l:"buildLumbermill",p:"buildWorkshop",e:"buildCathedral",u:"buildChurch",n:"buildTavern",m:"buildMageTower",a:"buildStable",r:"buildHarbor",o:"buildOutpost",i:"buildFields",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse",g:"buildGateWood",y:"buildDummy"}),e=R({c:"buildCastle2",k:"buildBlacksmith2",f:"buildFarm2",n:"buildTavern2",b:"buildBarrack2",p:"buildWorkshop2",s:"buildStorage2",
a:"buildStable2",l:"buildLumbermill2",r:"buildHarbor2",o:"buildOutpost2",u:"buildChurch2",e:"buildMosque",i:"buildFields",m:"buildMageTower2",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse2",g:"buildGateWood"}),k=R({c:"buildCastle1",f:"buildFarm1",e:"buildShaolinn",n:"buildTavern1",b:"buildBarrack1",p:"buildWorkshop1",s:"buildStorage1",k:"buildBlacksmith1",a:"buildStable1",l:"buildLumbermill1",r:"buildHarbor1",o:"buildOutpost1",u:"buildChurch1",i:"buildFields",m:"buildMageTower1",
w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse1",g:"buildGateWood"}),lf.cut=k,mf.cut=k,nf.cut=g,of.cut=g,pf.cut=g,qf.cut=k,rf.cut=g,sf.cut=k,tf.cut=e,uf.cut=e,vf.cut=e,wf.cut=e,h.lumbermill.icons.cut=R({b:"techLongbow",w:"techWoodCutting",c:"techCrossbow"}),n.lumbermill.icons.cut=R({w:"techWoodCutting",c:"techCrossbow"}),f.lumbermill.icons.cut=R({w:"techWoodCutting",c:"techCrossbow"}),h.blacksmith.icons.cut=R({p:"techPlateArmor",t:"techTemperIron",s:"techScaleArmor",h:"techHalberd",
c:"techChainMail"}),n.blacksmith.icons.cut=R({t:"techTemperIron",a:"techScaleArmor",s:"techScimitar",c:"techChainMail",h:"techHalberd"}),f.blacksmith.icons.cut=R({t:"techTemperIron",a:"techScaleArmor",r:"techArmoredChariot",c:"techChainMail"}),h.outpost.icons.cut=R({e:"emergeAllUnits"}),n.outpost.icons.cut=R({e:"emergeAllUnits"}),f.outpost.icons.cut=R({e:"emergeAllUnits"}),d.watchtower.icons.cut=R({a:"attack",s:"stop",g:"upgradeGuildTower"}),d.guardtower.icons.cut=R({a:"attack",s:"stop",g:"upgradeStoneTower",
c:"upgradeCannonTower"}),d.keeptower.icons.cut=R({a:"attack",s:"stop",c:"upgradeCannonTower"}),d.cannontower.icons.cut=R({a:"attack",r:"attack_ground",s:"stop",h:"holdfire"}),f.rockettower.icons.cut=R({a:"attack",r:"attack_ground",s:"stop",f:"fireatwill"}),h.harbor.icons.cut=R({f:"createFishingBoat",x:"createXebec",h:"createHulk",g:"createGalleon",t:"te_landingtactics"}),n.harbor.icons.cut=R({f:"createFishingBoat",h:"createHulk",x:"createXebec",t:"te_landingtactics"}),f.harbor.icons.cut=R({f:"createFishingBoat",
h:"createHulk",x:"createXebec"}),h.farm.icons.cut=R({c:"createCow",f:"techCropRotation",d:"techDomestication"}),n.farm.icons.cut=R({c:"createCow",f:"techDomestication",d:"techDomestication",p:"techCowPoaching",r:"ridingHorses",h:"techHorseManShip"}),f.farm.icons.cut=R({f:"techDomestication",a:"ridingHorses",i:"irrigation"}),h.storage.icons.cut=R({g:"techGoldMining",s:"techStoneMining"}),n.storage.icons.cut=R({g:"techGoldMining",s:"techStoneMining"}),f.storage.icons.cut=R({g:"techGoldMining",s:"techStoneMining"}),
h.cathedral.icons.cut=R({c:"createCrusaders"}),d.magicgateway.icons.cut=R({o:"createOrk",d:"createDwarf",g:"createGhost",s:"createSkeleton"}));g=[h.knight,f.horsesamurai,n.cavalry,n.enichar,h.crusader,f.chariot,f.horsearcher,n.horsearcher];e=[f.horsesamurai,h.crusader,n.enichar];k=[h.knight,n.cavalry,f.chariot,f.horsearcher,n.horsearcher];b=[h.longbowman,n.archer,f.archer,h.archer];v=[d.catapult,d.ballista,d.heavycatapult];B=[d.galleon,d.hulk,d.pinque,d.fishingboat];q=[d.galleon,d.hulk,d.pinque];
x=[n.satrap,h.maceman];var z=[h.longbowman,n.archer,f.archer,h.archer,f.horsearcher,n.horsearcher,d.pinque,d.watchtower,d.keeptower,d.guardtower],D=[d.stonegolem,d.ork,d.dwarf,d.skeleton,d.ghost,d.dragon,d.jinn,d.bat,h.wizard,n.mage,f.mage],F=[h.peasant,f.peasant,n.peasant,h.footman,n.footman,f.ronin,h.pikeman,n.spearman,n.satrap,h.maceman,n.cavalry,n.jihadwarrior,d.spy,n.enichar,f.horsesamurai,f.monk,f.chariot,f.ninja,d.stonegolem,d.ork,d.dwarf,d.jinn,d.skeleton,d.ghost,h.knight,h.crusader],I=[d.watchtower,
d.keeptower,d.guardtower,d.cannontower],O=[d.cannontower,f.rockettower],P=[h.cathedral,h.castle,d.woodenwall,h.barracks,h.lumbermill,h.magetower,h.warriorsguild,h.storage,h.farm,h.merchantsguild,h.church,h.blacksmith,h.stable,h.workshop,h.tavern,h.house,d.watchtower,h.market,h.outpost,d.bridge,h.harbor,d.guardtower,d.keeptower,d.cannontower,f.rockettower,f.castle,n.castle,f.barracks,n.house,n.lumbermill,n.storage,n.farm,n.harbor,n.blacksmith,n.workshop,n.church,n.tavern,n.market,n.barracks,n.stable,
n.outpost,n.mosque,n.mageguild,n.merchantsguild,n.warriorsguild,n.magicworkshop,f.house,f.lumbermill,f.storage,f.farm,f.harbor,f.blacksmith,f.workshop,f.monastery,f.tavern,f.market,f.stable,f.outpost,f.shaolinn,f.mageguild,f.merchantsguild,f.warriorsguild],Q=[h.cathedral,h.castle,d.woodenwall,h.barracks,h.lumbermill,h.magetower,h.warriorsguild,h.storage,h.farm,h.merchantsguild,h.church,h.blacksmith,h.stable,h.workshop,h.tavern,h.house,d.watchtower,h.market,h.outpost,d.bridge,h.harbor,f.castle,n.castle,
f.barracks,n.house,n.lumbermill,n.storage,n.farm,n.harbor,n.blacksmith,n.workshop,n.church,n.tavern,n.market,n.barracks,n.stable,n.outpost,n.mosque,n.mageguild,n.merchantsguild,n.warriorsguild,n.magicworkshop,f.house,f.lumbermill,f.storage,f.farm,f.harbor,f.blacksmith,f.workshop,f.monastery,f.tavern,f.market,f.stable,f.outpost,f.shaolinn,f.mageguild,f.merchantsguild,f.warriorsguild],S=[d.catapult,d.heavycatapult],V=[h.pikeman,n.spearman],X=[f.monk,f.priest],W=[d.woodenwall],Y=[h.peasant,f.peasant,
n.peasant],aa=[h.wizard,n.mage,f.mage],Z=[h.footman,n.footman,f.ronin],ba=[h.priest,n.priest,f.priest];Ib={bless:{img:m.bless,d:0,mv:1},star:{img:m.star,d:0,mv:1},heal:{img:m.healing,d:0,mv:1},impersonate:{img:m.impersonate,d:0,mv:1},select:{img:m.select,d:0,mv:0,select:1,z32:.8},spawn:{img:m.spawn,d:0,mv:1},curse:{img:m.curse,d:0,mv:1},turnStone:{img:m.turn_to_stone,d:0,mv:1}};var M=function(b,e,d){for(var c=b.length,f=0,g=e.length;f<g;f++)for(var h=0;h<c;h++)te[b[h].type][e[f].type]=d};M(O,q,4);
M(q,q,3);M(q,Q,3);M(q,I,3);M(q,W,5);M(q,v,2);M(S,Q,4);M(S,B,4);M(S,I,6);M(S,v,4);M(S,W,9);M([f.samurai],e,.5);M([f.samurai],k,.3);M([f.ronin],Y,1);M(V,g,6);M(Z,V,1.5);M(Z,b,1.5);M(Z,[n.jihadwarrior],1);M([n.satrap],Y,2);M(x,v,1.5);M(z,[d.dragon],.75);M(z,[d.bat],1);M(z,[h.pikeman],-.75);M(z,x,1);M(z,[f.chariot],-.3);M(z,X,.5);M(aa,ba,4);M(ba,aa,3);M(ba,D,3);M(F,[d.bat],-.2);M(F,[d.dragon],-.5);M([d.stonegolem],P,1);M([d.dwarf],P,4);M(D,[f.priest],-.5);b=Ja;e=Object.keys(b);for(g=0;g<A.length;g++)for(v=
A[g],k=0;k<e.length;k++)v[e[k]]=b[e[k]];g=[h.archer,h.longbowman,f.archer,f.horsearcher,n.archer,n.horsearcher];e=[h.footman,h.maceman,h.knight,h.crusader,h.pikeman,n.jihadwarrior,n.cavalry,n.footman,n.enichar,h.peasant,n.peasant,n.satrap,n.spearman,d.spy,f.chariot,f.monk,f.samurai,f.ronin,f.horsesamurai,f.ninja,f.peasant,d.skeleton,d.ghost,d.ork,d.dwarf];k=[h.footman,h.maceman,h.knight,h.crusader,h.pikeman,n.jihadwarrior,n.cavalry,n.footman,n.enichar,h.peasant,n.peasant,n.satrap,n.spearman,d.spy,
f.chariot,f.monk,f.samurai,f.ronin,f.horsesamurai,f.ninja,f.peasant,h.archer,h.longbowman,f.archer,f.horsearcher,n.archer,n.horsearcher,h.wizard,n.mage,f.mage,h.priest,n.priest,f.priest,d.skeleton,d.ghost,d.ork,d.dwarf];C=[{name:["Longbow","Allows the production of longbowmen"],next:[c.createLongbowman],cost:[400,0,0,0],time:45,type:ha},{name:["Gold Mining","Increases gold production"],increase:2,value:"gold",cost:[400,0,0,0],time:20,type:Sa},{name:["Stone Mining","Increases stone production"],increase:2,
value:"stone",cost:[400,0,0,0],time:20,type:Sa},{name:["Wood Cutting","Increases wood production"],increase:2,value:"wood",cost:[400,0,0,0],time:20,type:Sa},{name:["Temper Iron","Increases hand-to-hand units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:e,next:[c.techHalberd],type:ub},{name:["Scale Armor","Increases unit's defense"],increase:1,value:"defence",cost:[400,0,0,0],time:30,group:k,next:[c.techChainMail],type:ub},{name:["Halberd","Allows the production of spear units"],
next:[c.createPikeman,c.createPikeman2],cost:[400,0,0,0],time:30,type:ha},{name:["Domestication","Allows the production of cows"],next:[c.createCow],cost:[300,0,0,0],time:20,type:ha},{name:["Crop Rotation","Increases the production of fields"],increase:2,value:"food",cost:[400,0,0,0],time:20,type:Sa,next:[c.irrigation]},{name:["Chain Mail","Increases unit's defense"],increase:2,value:"defence",cost:[400,0,0,0],time:30,group:k,type:ub},{name:["Plate Armor","Allows the production of knights"],next:[c.createKnight],
cost:[400,0,0,0],time:60,type:ha},{name:["Crossbow","Increases arrow units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:g,type:ub},{name:["Feudalism","Makes peasants cheaper"],cost:[300,0,0,0],time:30,decrease:[f.peasant,[0,0,8,0],h.peasant,[0,0,10,0],n.peasant,[0,0,10,0]],type:oi,next:[c.techSlavery]},{name:["Architecture","Peasants build faster, and allows stone wall, gate and towers"],increase:.5,value:"buildSpeed",cost:[300,0,0,0],time:30,type:Sa,next:[c.upgradeStoneTower,
c.techGreatWall,c.buildBridge]},{name:["Learning","Allows units to gather experience"],increase:1,value:"experience",cost:[400,0,0,0],time:30,type:Sa,next:[c.buildAcademy,c.buildAcademy1,c.buildAcademy2]},{name:["Convert Resources",""],cost:[400,0,0,0],time:30},{name:["Map Making","Allows the production of galleons"],cost:[800,0,0,0],time:30,type:ha,next:[c.createGalleon]},{name:["Trade Routes","Allows trading"],cost:[400,0,0,0],time:30,type:ha,next:[c.techTradeTaxes]},{name:["Trade Taxes","Increases trade profit"],
cost:[400,0,0,0],time:30},{name:["Usury","Allows the obtaining of loans in taverns"],cost:[300,0,0,0],time:30,type:mg,next:[c.techBanking]},{name:["Supply Storage","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Sa,value:"popLimit",next:[c.techSeaFood]},{name:["Bribery","Allows the bribing of enemy units"],cost:[600,0,0,0],time:60,type:ha,next:[c.bribe]},{name:["Heroism","Allows unlimited experience"],cost:[500,0,0,0],time:30,increase:Infinity,value:"maxLevel",type:Sa,
next:[c.techLeadership]},{name:["Warfare","Gain experience faster"],cost:[400,0,0,0],time:30,type:Sa,increase:1,value:"experience",next:[c.techTactics]},{name:["Tactics","Gain experience faster"],cost:[800,0,0,0],time:30,type:ha,next:[c.buildDummy,c.techSunTzu]},{name:["Mercenaries","Allows the recruitment of units in taverns"],cost:[600,0,0,0],time:30,type:mg,next:[c.techHeroes,c.createMercenaries],actvintv:[c.iniMercenaries]},{name:["Heroes' Quest","Allows the recruitment of heroes in taverns"],
cost:[800,0,0,0],time:30,type:mg,next:[c.techFame,c.createHeroes],actvintv:[c.iniHeroes]},{name:["Fame","Recruit better units from taverns"],cost:[500,0,0,0],time:30,value:"fameTech",increase:1,type:Sa},{name:["Siege Tactics","Allows the production of heavy catapults"],cost:[1200,0,0,0],time:60,type:ha,next:[c.createHeavyCatapult]},{name:["Body Building","Increases unit's hit points at every new level"],cost:[800,0,0,0],time:60,value:"healthJump",increase:5,type:Sa},{name:["Espionage","Allows the production of a spy"],
cost:[400,0,0,0],time:30,type:ha,next:[c.createSpy]},{name:["Fanaticism","Increases the building's resistance"],cost:[400,0,0,0],time:30,type:ub,group:[],increase:5,value:"resistance",next:[c.techCrusade,c.techJihad]},{name:["Crusade","Allows the preaching of a crusade"],cost:[1200,0,0,0],time:180,type:ha,next:[c.createCrusaders]},{name:["Inquisition","Increases priest attack"],cost:[400,0,0,0],time:30,type:ub,group:[h.priest,n.priest,f.priest],increase:5,value:"attack"},{name:["Healing","Allows healing of units"],
cost:[400,0,0,0],time:30,next:[c.techMedicine,c.healing],type:ha},{name:["Medicine","Allows remote healing of units"],cost:[500,0,0,0],time:30,value:"healingRange",increase:5,type:Sa},{name:["Bless","Temporarily increases unit attack skill"],cost:[400,0,0,0],time:30,type:ha,next:[c.bless]},{name:["Invisibility","Invisibility spell"],cost:[500,0,0,0],time:30,type:ha,next:[c.invisibility]},{name:["Bat","Researches bat summoning"],cost:[400,0,0,0],time:240,type:ha,next:[c.createBat]},{name:["Freeze",
"Freeze spell"],cost:[800,0,0,0],time:30,type:ha,next:[c.freeze]},{name:["Lightning","Lightning spell"],cost:[400,0,0,0],time:30,type:ha,next:[c.lightning]},{name:["Stone Golem","Researches stone golem summoning"],cost:[800,0,0,0],time:120,type:ha,next:[c.createGolem]},{name:"Upgrade to Guard Tower",cost:[0,600,0,0],time:20,type:lg,obj:44,upgrade:1},{name:"Upgrade to Stone Tower",cost:[0,0,0,500],time:30,type:lg,obj:55,upgrade:1},{name:"Upgrade to Cannon Tower",cost:[0,0,0,500],time:30,type:lg,obj:56,
upgrade:1},{name:["Buddhism"],cost:[400,0,0,0],time:30,type:ha,next:[c.buildCathedral1]},{name:["Cannon Tower","Allows the building of cannon towers"],next:[c.upgradeCannonTower],cost:[400,0,0,0],time:30,type:ha},{name:["Engineering","Increases siege weapon's attack"],increase:5,value:"attack",cost:[400,0,0,0],time:30,group:[d.ballista,d.catapult,d.heavycatapult],type:ub},{name:["Great Wall","Makes stone walls, towers and gates stronger"],cost:[600,0,0,0],time:30,type:ha},{name:["Art of Riding","Allows the production of horse archers"],
cost:[500,0,0,0],time:30,type:ha,next:[c.createHorseArcher1,c.createHorseArcher2,c.techHorseManShip]},{name:["Irrigation","Increases field production"],increase:4,value:"food",cost:[400,0,0,0],time:30,type:Sa},{name:["Armored Chariot","Allows the production of armored chariots"],cost:[500,0,0,0],time:60,type:ha,next:[c.createChariot]},{name:["Meditation","Makes monks cheaper"],cost:[300,0,0,0],time:30,decrease:[0,0,50,0],type:ni,next:[c.techPhilosophy],group:[f.monk]},{name:["Kung-Fu","Increases the attack of all kung-fu units"],
cost:[400,0,0,0],time:30,type:ub,increase:1,value:"attack",group:[f.peasant,f.ninja,f.monk,f.priest],next:[c.techMastery,c.techNinjas,c.techTournaments]},{name:["Tournaments","Allows sharing of experience between kung-fu units"],cost:[800,0,0,0],time:30,type:ha,next:[]},{name:["Philosophy","Allows the production of more experienced monks"],cost:[400,0,0,0],time:30,type:ub,increase:2,value:"level",group:[f.monk,f.priest],next:[c.createPriest1]},{name:["Ninjas","Allows the production of ninjas"],cost:[500,
0,0,0],time:30,type:ha,next:[c.createNinja]},{name:["Mastery","Allows priests to teach kung-fu units"],cost:[500,0,0,0],time:30,type:ha,next:[c.teach]},{name:["Concentration","Allows faster manna restoration"],cost:[600,0,0,0],time:80,type:ha,next:[c.techConfusion]},{name:["Confusion","Researches the Confusion spell"],cost:[400,0,0,0],time:30,type:ha,next:[c.confusion]},{name:["Whirlpool","Researches the Whirlpool spell"],cost:[300,0,0,0],time:30,type:ha,next:[c.whirlpool]},{name:["Dragon","Researches Dragon summoning"],
cost:[800,0,0,0],time:300,type:ha,next:[c.createDragon]},{name:["Turn to Stone","Researches the Turn to Stone spell"],cost:[300,0,0,0],time:30,type:ha,next:[c.turnToStone]},{name:["Flame Bolt","Researches the Flame Bolt spell"],cost:[400,0,0,0],time:30,type:ha,next:[c.techDragon,c.flameBolt]},{name:["Jewelry","Allows trading of items"],cost:[400,0,0,0],time:30,type:ha,next:[c.sellItems,c.buyItems]},{name:["Banking","Increases trade profit"],cost:[600,0,0,0],time:30,type:ha},{name:["Chemistry","Increases arrow units' attack power"],
cost:[500,0,0,0],time:30,type:ub,group:g,increase:1,value:"attack",next:[c.techGunPowder]},{name:["Sea Food","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Sa,value:"popLimit"},{name:["Gun Powder","Increases cannon tower's attack power"],cost:[500,0,0,0],time:30,type:ub,increase:10,value:"attack",group:[d.cannontower],next:[c.techRocketArrow]},{name:["Rocket Arrow","Allows the building of rocket tower"],cost:[800,0,0,0],time:30,type:ha,next:[c.buildRocketTower]},{name:["Bushido",
"Allows the production of horse samurai"],cost:[800,0,0,0],time:120,type:ha,next:[c.createHorseSamurai]},{name:["Leadership","Units around a hero gain experience"],cost:[600,0,0,0],time:30,type:ha,next:[c.techHonor]},{name:["Honor","Hero vs. hero attack bonus"],cost:[500,0,0,0],time:30,type:ha},{name:["Sun Tzu's Book","Increases the speed of learning"],cost:[800,0,0,0],time:30,type:Sa,increase:1,value:"experience"},{name:["Cow Poaching","Allows peasants to steal cows"],cost:[200,0,0,0],time:30,type:Sa,
increase:1,value:"stealCows"},{name:["Horsemanship","Makes mounted units cheaper"],cost:[500,0,0,0],time:30,type:ni,mulp:.75,group:[f.horsearcher,n.cavalry,n.horsearcher]},{name:["Scimitar","Increases sword attack power and allows the production of satraps"],cost:[400,0,0,0],time:30,type:ub,increase:1,value:"attack",group:e,next:[c.createSatrap]},{name:["Jihad","Allows the production of Jihad Warriors"],cost:[1200,0,0,0],time:30,type:ha,next:[c.createJihad,c.convertJihad]},{name:["Magic Carpet","Researches Magic Carpet summoning"],
cost:[300,0,0,0],time:30,type:ha,next:[c.createCarpet,c.techJinn]},{name:["Magic Workshop","Allows the building of a magic workshop"],cost:[1200,0,0,0],time:180,type:ha,next:[c.buildMagicWorkshop]},{name:["Rain of Fire",""],cost:[800,0,0,0],time:60,type:ha,next:[c.fireRain]},{name:["Magic Vision","Researches the Magic Vision spell"],cost:[400,0,0,0],time:30,type:ha,next:[c.magicVision]},{name:["Necromancy","Researches the Raise the Dead spell"],cost:[400,0,0,0],time:30,type:ha,next:[c.raiseDead]},
{name:["Jinn","Researches Jinn summoning"],cost:[600,0,0,0],time:300,type:ha,next:[c.createJinn]},{name:["Ore Enrichment","Increases mine production"],cost:[800,0,0,0],time:30,type:Sa,increase:1,value:"miningPerf"},{name:["Riding Horses","Increases the mounted units' attack and defense power"],cost:[500,0,0,0],time:30,type:Lk,values:["attack",2,"defence",1],group:[f.horsearcher,n.cavalry,n.horsearcher],next:[c.techJanissary]},{name:["Janissary","Allows the production of Janissaries"],cost:[1200,0,
0,0],time:120,type:ha,next:[c.createEnichar]},{name:["Slavery","Makes peasants cheaper"],cost:[200,0,0,0],time:30,decrease:[f.peasant,[0,0,7,0],h.peasant,[0,0,8,0],n.peasant,[0,0,8,0]],type:oi}];hk();c.buildMarket.disabled=1;Cl();k=0;for(v=A.length;k<v;k++)if(b=A[k],b.onbuild)for(f=b.onbuild,g=0,h=f.length;g<h;g++)n=f[g],n.obj.race==b.race&&(n.disabled=1,n.requireObj||(n.requireObj=[]),n.requireObj.put(b));g=0;for(h=C.length;g<h;g++)if(d=C[g],d.tech=1,d.id=g,d.next)for(f=d.next,n=0,k=f.length;n<k;n++)b=
f[n],b.disabled?(b.disabled++,b.requireObj.put(d)):(b.requireObj=[d],b.disabled=1);g=0;f=A;for(h=f.length;g<h;Qm(f[g++]));}if(Wi){d=8;b=9;g=0;for(h=ka.xtraRes.length;g<h;g++){l=ka.xtraRes[g].coords;vn(l);l.terrain_water[d]=512;l.terrain_water[b]=512;l.terrain_water[6]+=32;l.terrain_water[7]+=32;e=4;for(f=l.terrain_tree.length;e<f;e+=6)l.terrain_tree[e]-=32,l.terrain_tree[e+1]-=96;e=5;for(f=l.terrain_tree_s.length;e<f;e+=6)l.terrain_tree_s[e]-=32;l.terrain_tree[2]=1}zl(l,ka.info,ka.size,16*ka.ids);
g=A[7];g.img=l.terrain_tree;g.url=ra[l.terrain_tree];g.child[0].img=l.terrain_tree_s;Object.assign(m,l)}db={img:m.gath_point,x32:-10,y32:-10,d:0,mv:!0};vh=[db];new hc("",[255,255,255],[0],!0);if(p.custom)for(e=0==p.cycle?p.kingdomStart||p.kingdoms:p.kingdoms,g=0,h=e.length;g<h;g++)p.online&&na[g]&&!na[g].name&&(e[g].IA=!1),f=new hc("",e[g].color,[0],!0),Object.assign(f,e[g]),f.values.pop=0,null==f.resources[0]&&(f.resources[0]=Infinity),null==f.resources[1]&&(f.resources[1]=Infinity),null==f.resources[2]&&
(f.resources[2]=Infinity),null==f.resources[3]&&(f.resources[3]=Infinity);else for(g=0,h=ta.length;g<h;g++){l=ta[g];f=[0];for(n=0;n<h;n++)f[n+1]=ta[n].team==l.team?0:1;p.online&&l.id===w.onlineID&&(w.kingdom=g+1);new hc(l.name,gk(l.color),f,l.race,l.IA,[p.goldRes,p.woodRes,p.foodRes,p.stoneRes],l.team)}if(p.editor){if(fa("statButton"),fa("menu"),fa("resources"),Da("mapeditorinfotop"),Da("mapeditorinfo"),d=document.getElementById("mapeditorinfoUnits"),d.style.display="block",$g(),!sd.preload){sd.preload=
!0;l={};k={};f=A;n={euro:jb[0],arab:jb[1],asia:jb[2],common:u.common};l[jb[0]]=[];l[jb[1]]=[];l[jb[2]]=[];l[u.common]=[];k[jb[0]]=[];k[jb[1]]=[];k[jb[2]]=[];k[u.common]=[];g=0;for(h=f.length;g<h;g++)b=f[g],!b.race||b.illegal||7==b.type||b.item||(b.build?k[n[b.race]].put(g):l[n[b.race]].put(g));for(n=0;2>n;n++){f=Object.keys(l);v={};g=0;for(h=f.length;g<h;v={ul$17:v.ul$17},g++){B=document.createElement("h1");B.innerHTML=f[g];v.ul$17=document.createElement("ul");B.onclick=function(b){return function(){Ah(b.ul$17)}}(v);
v.ul$17.style.display="none";q=l[f[g]];x=Object.keys(q);z={};e=0;for(D=x.length;e<D;z={tcreate:z.tcreate},e++)b=document.createElement("li"),b.innerHTML=A[q[x[e]]].name,z.tcreate=q[x[e]],b.onclick=function(b){return function(){var e=b.tcreate;A[e].wall?ki(e):U(e)}}(z),v.ul$17.appendChild(b);d.appendChild(B);d.appendChild(v.ul$17)}l=k;d=r("mapeditorinfoBuilds")}f=Object.keys(Zb);d=r("mapeditorinfoItems");var ca=document.createElement("ul");l={};g=0;for(h=f.length;g<h;l={u$18:l.u$18},g++)b=document.createElement("li"),
l.u$18=Zb[f[g]],b.onclick=function(b){return function(){dk(b.u$18)}}(l),b.innerHTML=l.u$18.name,ca.appendChild(b);d.appendChild(ca);d=r("mapeditorinfoNature");B=document.createElement("h1");B.innerHTML=u.trees;ca=document.createElement("ul");B.onclick=function(){Ah(ca)};ca.style.display="none";b=document.createElement("li");ca.appendChild(b);d.appendChild(B);d.appendChild(ca);b.onclick=function(){Xi(xn)};b.innerHTML=u.delete;b=document.createElement("li");ca.appendChild(b);b.onclick=function(){Xi(Yi)};
b.innerHTML=u.create;B=document.createElement("h1");B.innerHTML=u.terrain;var ea=document.createElement("ul");B.onclick=function(){Ah(ea)};ea.style.display="none";d.appendChild(B);d.appendChild(ea);h=oc.texturesRandomMap;l={};g=0;for(h=h.length;g<h;l={l:l.l},g++)b=document.createElement("li"),ea.appendChild(b),b.innerHTML=g,l.l=g,b.onclick=function(b){return function(){Xi(Zi);Zi.active=b.l}}(l)}}else Da("menu"),Da("statButton"),Da("resources"),fa("mapeditorinfo"),fa("mapeditorinfotop");l=y.HEAPU8;
h=H.length;d=WASMDiplomacy(h);for(g=0;g<h;g++)for(f=H[g],f=f.diplomacy,n=0;n<h;n++)l[d+g*h+n]=f[n]&&1||0;Dl()},A,te,Vi,db,vh,Bl,xh=8,x=new Float32Array(16),Sc=function(d,b,e,c,g,h,l){var f=A[d];if(f.ignore)return f.invalid=!0,!1;if(h=h&&!f.instantBuild)this.built=!1;var k=H[b],m=k.mod[d],r=Object.keys(m);this.__proto__=f;this.kingdom=b;this.d=g;this.x32=e;this.y32=c;this.taskList=[];g=0;for(var q=r.length;g<q;this[r[g]]=m[r[g++]]);if(l)for(m=Object.keys(l),g=0,q=m.length;g<q;this[m[g]]=l[m[g++]]);
0<f.invMax&&(this.inventory=[]);20==f.type&&(this.lastUse=p.cycle);f.build||(this.mv=1);l=k.technology.disabled;m=f.actvintv;this.workers=[];this.id=q=z.length;f.rndDirection&&(this.d=q*e%f.rndDirection);this.build||this.item||this.cow||k.values.pop++;e=f.validator(e,c,f.space,b);if(e[1]||h){c=f.validator.dimension.write;r=e[0];if(h){var u=Gb[b];g=0;for(f=r.length;g<f;g++)u[r[g]]=q;k.building.put(q)}else for(g=0,f=r.length;g<f;c(r[g++],q));if(e[2]&&(r=e[2],!h))for(g=0,f=r.length;g<f;c(r[g++],0));
}else return this.invalid=!0,!1;z[q]=this;WASMUnit(b);h||xa[b][d].put(q);if(this.update&&!p.custom)for(d=this.update,g=0,q=d.length;g<q;g+=3)kb({func:cg,data:[this.id,d[g],d[g+1],d[g+2]]},d[g+2],1);if(m)for(d=0,f=m.length;d<f;d++)b=m[d],l[b.id]||b(this);h?(pb(this),w.kingdom==this.kingdom?Nd(this,Um):Nd(this,gi)):(pb(this),Zh(this));this.level&&!this.potion&&Hk(this);!this.standardFunc||this.func||p.editor||h||this.standardFunc(this);h=k.stats;h.unitCount[this.type]++;k=h.unitCount[this.type]-h.unitCountDeath[this.type];
k>h.unitCountMax[this.type]&&(h.unitCountMax[this.type]=k)},Qk=function(d){var b=H[d.kingdom];if(d.population){var e=d.population;b.values.popMax+=e;Ae(d.kingdom);for(var c=0;c<e;c++)b.checkPopArray()}if(d.onbuild)for(d=d.onbuild,e=b.technology,b=e.disabled,e=e.actived,c=0;c<d.length;c++){var g=d[c].id;e[g]||(e[g]=0);e[g]++;e[g]-1||(b[g]--,!b[g]&&la.actv[g]&&la(Y.active))}},Ab=[],W=new Float32Array(12),$i=function(d,b,e){var c=d.length;d[c]=b;d[c+1]=b+1;d[c+2]=b+2;d[c+3]=b+1;d[c+4]=b+2;d[c+5]=b+3;
d.changed=!0;e.typeBuffer=d;e.elemtId=c},Nd=function(d,b){var e=b[3];if(b.noAlpha)c=Z;else{d.alpha=!0;var c=ma}if(d.typeBuffer!==c){if(b==gi){if(Jb.diplomacy[d.kingdom]){Ub(d);return}b=new Float32Array(dc(Ha[3*d.kingdom],Ha[3*d.kingdom+1],Ha[3*d.kingdom+2],e+1))}Ub(d);$i(c,d.bufferID,d)}k.bindBuffer(k.ARRAY_BUFFER,Ma);k.bufferSubData(k.ARRAY_BUFFER,16*d.bufferID,b)},zc=function(d){var b=ah(d,d.kingdom),e=b[0],c=b[1],g=b[2];b=b[3];var h=d.bufferID;El(e,c,g,b,d.bufferID);1>b?(d.alpha=!0,e=ma):e=Z;d.typeBuffer!==
e&&(Ub(d),$i(e,h,d));if(d.child&&(!1!==d.built||!d.build))for(var l=d.child,k=0,m=l.length;k<m;k++)h+=4,b=ah(l[k],d.kingdom),e=b[0],c=b[1],g=b[2],b=b[3],El(e,c,g,b,h)},ah=function(d,b){if(null!=d.rgb){var e=d.rgb;d=e[0];var c=e[1];b=e[2];e=e[3]}else ra[d.img][3]?(d=Ha[3*b],c=Ha[3*b+1],b=Ha[3*b+2],e=2):(d.mMapcolor?(b=d.mMapcolor,d=b[0]/255,c=b[1]/255,b=b[2]/255):(d=Ha[3*b],c=Ha[3*b+1],b=Ha[3*b+2]),e=1);return[d,c,b,e]},Fl=function(){if(Ab.length){var d=Ab[Ab.length-1];Ab.length--}else d=xh,xh+=4;
return d},pb=function(d,b,e,c){void 0==b&&(c=e=b=0);var f=ra[d.img],h=1;if(d.bufferID){var l=d.bufferID;h=0}else l=Fl();d.bufferID=l;f||P(d);var n=f[2]*d.d*6+4,m=f[4+n],r=f[5+n];n=f[0];var u=f[1];0<=u&&(u*=.001);var q=f.id+4*d.d*f[2],v=-1;d.mv&&(v=p.now());x[0]=q;x[1]=v;x[2]=n;x[3]=u;x[4]=q+1;x[5]=v;x[6]=n;x[7]=u;x[8]=q+2;x[9]=v;x[10]=n;x[11]=u;x[12]=q+3;x[13]=v;x[14]=n;x[15]=u;var w=32*d.x32,y=32*d.y32;n=32*d.y32;null!=d&&null!=d.z32&&(n*=d.z32);var z=Z;k.bindBuffer(k.ARRAY_BUFFER,yd);k.bufferSubData(k.ARRAY_BUFFER,
16*l,x);k.bindBuffer(k.ARRAY_BUFFER,Ec);if(d.rotation){var A=d.rotation;A*=2*Math.PI;var D=.5*f[8];u=.5*f[9];f=-1*n;q=-D;v=-u;var C=0*W.length;W[C]=q*Math.cos(A)-u*Math.sin(A)+w;W[C+1]=u*Math.cos(A)+q*Math.sin(A)+y;W[C+2]=f;W[C+3]=q*Math.cos(A)-v*Math.sin(A)+w;W[C+4]=v*Math.cos(A)+q*Math.sin(A)+y;W[C+5]=f;W[C+6]=D*Math.cos(A)-u*Math.sin(A)+w;W[C+7]=u*Math.cos(A)+D*Math.sin(A)+y;W[C+8]=f;W[C+9]=D*Math.cos(A)-v*Math.sin(A)+w;W[C+10]=v*Math.cos(A)+D*Math.sin(A)+y;W[C+11]=f}else d.wh?(A=d.wh[0],D=d.wh[1],
A-=m,D-=r,W[0]=w,W[1]=y,W[2]=n,W[3]=w+A,W[4]=y,W[5]=n,W[6]=w,W[7]=y+D,W[8]=n,W[9]=w+A,W[10]=y+D):(W[0]=w,W[1]=y,W[2]=n,W[3]=w,W[4]=y,W[5]=n,W[6]=w,W[7]=y,W[8]=n,W[9]=w,W[10]=y),W[11]=n;k.bufferSubData(k.ARRAY_BUFFER,12*l,W);v=ah(d,d.kingdom);f=v[0];u=v[1];q=v[2];v=v[3];if(1>v||d.alpha)d.alpha=!0,z=ma;k.bindBuffer(k.ARRAY_BUFFER,Ma);x[0]=f;x[1]=u;x[2]=q;x[3]=v;x[4]=f;x[5]=u;x[6]=q;x[7]=v;x[8]=f;x[9]=u;x[10]=q;x[11]=v;x[12]=f;x[13]=u;x[14]=q;x[15]=v;k.bufferSubData(k.ARRAY_BUFFER,16*l,x);k.bindBuffer(k.ARRAY_BUFFER,
ge);A=p.now();x[0]=b;x[1]=e;x[2]=c;x[3]=A;x[4]=b;x[5]=e;x[6]=c;x[7]=A;x[8]=b;x[9]=e;x[10]=c;x[11]=A;x[12]=b;x[13]=e;x[14]=c;x[15]=A;k.bufferSubData(k.ARRAY_BUFFER,16*l,x);h&&$i(z,l,d);if(d.child&&!1!==d.built)for(b=n,e=d.child.length,c=[],d.childLoc=c,h=0;h<e;h++){z=d.child[h];f=ra[z.img];n=f[2]*d.d*6+4;A=f[4+n];D=f[5+n];n=f[0];u=f[1];0<=u&&(u*=.001);q=f.id+4*d.d;v=-1;z.mv&&(v=1);x[0]=q;x[1]=v;x[2]=n;x[3]=u;x[4]=q+1;x[5]=v;x[6]=n;x[7]=u;x[8]=q+2;x[9]=v;x[10]=n;x[11]=u;x[12]=q+3;x[13]=v;x[14]=n;x[15]=
u;v=ah(z,d.kingdom);f=v[0];u=v[1];q=v[2];v=v[3];C=w;var F=y;z.wh1&&(A=z.wh[0],D=z.wh[1]);z.center&&(C-=.5*~~(A-m),F-=.5*~~(D-r));l=Fl();k.bindBuffer(k.ARRAY_BUFFER,yd);k.bufferSubData(k.ARRAY_BUFFER,16*l,x);k.bindBuffer(k.ARRAY_BUFFER,Ma);x[0]=f;x[1]=u;x[2]=q;x[3]=v;x[4]=f;x[5]=u;x[6]=q;x[7]=v;x[8]=f;x[9]=u;x[10]=q;x[11]=v;x[12]=f;x[13]=u;x[14]=q;x[15]=v;k.bufferSubData(k.ARRAY_BUFFER,16*l,x);n=z.z?32*z.z+b:b;k.bindBuffer(k.ARRAY_BUFFER,Ec);W[0]=C;W[1]=F;W[2]=n;W[3]=C;W[4]=F;W[5]=n;W[6]=C;W[7]=F;
W[8]=n;W[9]=C;W[10]=F;W[11]=n;k.bufferSubData(k.ARRAY_BUFFER,12*l,W);k.bindBuffer(k.ARRAY_BUFFER,ge);x[0]=0;x[1]=0;x[2]=0;x[3]=0;x[4]=0;x[5]=0;x[6]=0;x[7]=0;x[8]=0;x[9]=0;x[10]=0;x[11]=0;x[12]=0;x[13]=0;x[14]=0;x[15]=0;k.bufferSubData(k.ARRAY_BUFFER,16*l,x);n=1>v?ma:z.light?wa:Z;c.put(n);A=n.length;c.put(A);n[A]=l;n[A+1]=l+1;n[A+2]=l+2;n[A+3]=l+1;n[A+4]=l+2;n[A+5]=l+3;n.changed=!0}},Qc=function(d,b,e,c){var f=p.now(),h=d.bufferID;x[0]=b;x[1]=e;x[2]=c;x[3]=f;x[4]=b;x[5]=e;x[6]=c;x[7]=f;x[8]=b;x[9]=
e;x[10]=c;x[11]=f;x[12]=b;x[13]=e;x[14]=c;x[15]=f;k.bindBuffer(k.ARRAY_BUFFER,ge);k.bufferSubData(k.ARRAY_BUFFER,16*h,x);k.bindBuffer(k.ARRAY_BUFFER,null);if(d.tempChild)for(f=0,d=d.tempChild,h=d.length;f<h;Qc(d[f++],b,e,c));},Ti=function(d,b,e,c,g,h){Eb[0]=d;Eb[1]=b;Eb[2]=e;Eb[3]=d+c;Eb[4]=b;Eb[5]=e;Eb[6]=d;Eb[7]=b+g;Eb[8]=e;Eb[9]=d+c;Eb[10]=b+g;Eb[11]=e;k.bindBuffer(k.ARRAY_BUFFER,Ec);k.bufferSubData(k.ARRAY_BUFFER,12*h,Eb);k.bindBuffer(k.ARRAY_BUFFER,null)},El=function(d,b,e,c,g){x[0]=d;x[1]=b;
x[2]=e;x[3]=c;x[4]=d;x[5]=b;x[6]=e;x[7]=c;x[8]=d;x[9]=b;x[10]=e;x[11]=c;x[12]=d;x[13]=b;x[14]=e;x[15]=c;k.bindBuffer(k.ARRAY_BUFFER,Ma);k.bufferSubData(k.ARRAY_BUFFER,16*g,x);k.bindBuffer(k.ARRAY_BUFFER,null)},Hb=function(d,b,e){void 0==e&&(e=32);d.z32&&(b*=d.z32);var c=d.x32*e;e*=d.y32;d.wh?Ti(c,e,b,d.wh[0]-ra[d.img][8],d.wh[1]-ra[d.img][9],d.bufferID):Ti(c,e,b,0,0,d.bufferID);if(d.tempChild)for(b=d.tempChild,c=0,e=b.length;c<e;c++){var g=b[c];g.x32=d.x32;g.y32=d.y32;Hb(g,32*d.y32)}},Ja={checkMana:function(d,
b,e,c){if(!this.mana)return!1;if(0>this.mana-d)return this.manaTask=[e.url,b,d],this.stay55(),d>this.manaMax&&c&&(this.blockedCost=c,b=this.setupChild(Ib.curse,1),this.blocked=2,this.blockedimg=b,this.manaTarget=d,k.bindBuffer(k.ARRAY_BUFFER,Ma),k.bufferSubData(k.ARRAY_BUFFER,16*this.bufferID,eg),k.bufferSubData(k.ARRAY_BUFFER,16*b.bufferID,eg)),!1;this.mana-=d;return!0}},kc=function(d,b){return p.editor?!0:d.freezed||d.confused?!1:H[d.spy||d.kingdom].control[b.spy||b.kingdom]};Ja.changeKingdom=function(d){xa[this.kingdom][this.type].quit(this.id);
wb[this.id]&&(wb[this.id]=0,D.quit(this.id),0==D.length&&(la([]),gf(),Ac=-1),Ni(this.id));this.kingdom=d;zc(this);this.childBuild&&(this.childBuild=0);if(!this.build||this.arrow)p.editor||this.stay();xa[d][this.type].put(this.id)};Ja.aspettare=function(){this.nodes=void 0;this.rbase().write(this.x32+this.y32*F,this.id);this.waiting=!0;pa(this,this.url.idle);Qc(this,0,0,0);Va(this,~~(32E3/this.spd))};Ja.addItem=function(d){var b=this.inventory;b&&(b[b.length]=d.id,d.in=this.id,d.sword||d.shield)&&
(d.attack&&(this.attack+=d.attack),d.defence&&(this.defence+=d.defence))};Ja.showInventory=function(){Oi();for(var d=this.inventory,b=0;8>b;b++){var e=d[b];if(!e)break;var c=Ua[b];c.style.backgroundPosition="0px "+48*e.iconID+"px";c.className="";Tg[b]=null}};Ja.deleteItem=function(d){this.inventory.quit(d.id);this.attack-=d.attack;this.defence-=d.defence};Ja.useItem=function(d){48==d.type&&(this.health+=d.lives,this.health>this.maxHealth&&(this.maxHealth=this.health),this.inventory.quit(d.id))};Ja.onattack=
function(d){!this.attack||this.freezed||this.death||this.item||this.func!=wd.url&&this.func||wc(d.id,[this.id],1)};Ja.setupINTV=function(d,b,e,c){this.funcObj=b;d.url||P(d,d.url);vd(this);this.changeFunc(d.url,c);this.deleteWorker();Va(this,e);return e};Ja.damage=function(d,b){if(!(this.zolotoy||this.death||this.stoned)){this.defence&&(d-=this.defence);1>d&&(d=1);this.health-=d;b=H[b.kingdom].stats;b.dmgInflicted+=d;var e=H[this.kingdom].stats;e.dmgTaken+=d;1>this.health?(this.build?(e.buildsLosed++,
b.buildsKilled++):(e.unitsLosed++,b.unitsKilled++),this.die()):M(this.id,1)}};var M=function(d,b){if(wb[d]||!1===d)return d=D.length,1===d?(d=z[D[0]],Y.stockActive==d&&d.inventory.length?(Wc(d.id,1,1),ml(d,1)):d.build?Aa(d,1):Wc(d.id,b)):1<d?Xg(D,b):tl(hb),!0};Ja.setupSpellIMG=function(d){this.invisible&&Ld(this.id);this.url.spell?(pa(this,this.url.spell,1),d||kb({func:Gl,data:this.id},tb(this.img),1)):this.stay()};var Gl=function(d){d=z[d];d.death||d.stay()};Ja.setupChild=function(d,b,e){var c={x32:this.x32,
y32:this.y32,d:d.d,img:d.img,mv:d.mv,parent:this.id,z32:d.z32};if((this.dix||this.diy)&&!this.waiting){var g=.001*(p.now()-this.timestamp);c.x32+=this.dix*g/32-Math.sign(this.dix);c.y32+=this.diy*g/32-Math.sign(this.diy)}if(d.select){if(this.space)d=this.space[this.space.length-1],h=(this.space.length-1)/d;else{d=this.sSizex||1;var h=this.sSizey||1}this.z32&&(c.z32=this.z32);c.wh=[32*d-3,32*h-3];this.selectAnim=c}pb(c);g&&Qc(c,this.dix,this.diy,0);e&&(k.bindBuffer(k.ARRAY_BUFFER,Ma),k.bufferSubData(k.ARRAY_BUFFER,
16*c.bufferID,e));this.tempChild||(this.tempChild=[]);this.tempChild.put(c);b||gc.new(c,tb(c.img),Hl);return c};var Hl=function(d){z[d.parent].tempChild.quit(d);Ub(d)};Ja.distance=0;var pa=function(d,b,e,c){d.img=b;ra[b]||P(b);(b=ra[b])||P(d);var f=b[0],h=b[1];0<=h&&(h*=.001);c&&(h*=c);b=b.id+4*d.d*b[2];c=-1;1===e?c=p.now():0>e&&(c=1);e=c;d=d.bufferID;x[0]=b;x[1]=e;x[2]=f;x[3]=h;x[4]=b+1;x[5]=e;x[6]=f;x[7]=h;x[8]=b+2;x[9]=e;x[10]=f;x[11]=h;x[12]=b+3;x[13]=e;x[14]=f;x[15]=h;k.bindBuffer(k.ARRAY_BUFFER,
yd);k.bufferSubData(k.ARRAY_BUFFER,16*d,x);k.bindBuffer(k.ARRAY_BUFFER,null)};Ja.setupDir=function(d,b,e){d=Math.sign(d);b=Math.sign(b);d=3*(b-1)+(d+1);2==d?this.d=1:-6==d?this.d=5:0==d?this.d=7:-4==d?this.d=3:-1==d?this.d=2:1==d?this.d=0:-5==d?this.d=4:-3==d&&(this.d=6);e&&(this.d=(this.d+e)%8)};Ja.setupDirBuild=function(d){var b=F,e=this.x32+this.y32*b;if(1==d.health&&0==d.built)c=Gb[d.kingdom],d=d.id,c[e+b]==d?this.d=0:c[e-b]==d?this.d=4:c[e+1]==d?this.d=2:c[e-1]==d?this.d=6:c[e+b+1]==d?this.d=
1:c[e-b+1]==d?this.d=3:c[e+b-1]==d?this.d=7:c[e-b-1]==d&&(this.d=5);else{d=d.id;var c=rd;c(e+b)==d?this.d=0:c(e-b)==d?this.d=4:c(e+1)==d?this.d=2:c(e-1)==d?this.d=6:c(e+b+1)==d?this.d=1:c(e-b+1)==d?this.d=3:c(e+b-1)==d?this.d=7:c(e-b-1)==d&&(this.d=5)}};Ja.spdMod=0;var ug=function(d,b){for(var e=b.length,c=0;c<e;c++){var g=z[b[c]];g.build||(g.spd=d)}};Ja.changeFunc=function(d,b){var e=this.func;this.func=d;if(xf){if(void 0!==this.workingOn)var c=z[this.workingOn];(e=Yb[e])&&e.rule&&bi(-1,this,e.rule,
c);(d=Yb[d])&&d.rule&&bi(1,this,d.rule,b)}};Ja.stay=function(d){this.mv=1;this.time=void 0;this.diy=this.dix=0;this.nodes=this.c=void 0;this.xf=null;Qc(this,0,0,0);if(!d){d=this.action==Kd.url||this.func==rg.url;this.changeFunc(void 0);this.stock&&0!==this.stock[0]?pa(this,this.img,NaN):pa(this,this.__proto__.img,1);this.buildList&&(this.buildList=void 0);this.deleteWorker();if(this.standardFunc&&2!==this.stop&&void 0==this.spy)return this.standardFunc(this);d&&wd(this)}};Ja.stay55=function(){this.changeFunc(void 0);
this.stock&&0!==this.stock[0]?pa(this,this.img,NaN):pa(this,this.__proto__.img,1);this.deleteWorker();this.standardFunc&&2!==this.stop&&void 0==this.spy&&this.standardFunc(this)};var yn=[],Ub=function(d){d.elemtId&&(Il(d.elemtId,d.typeBuffer),d.elemtId=void 0,d.typeBuffer=void 0)},mi=function(d){if(d.childLoc){d=d.childLoc;for(var b=0,e=d.length;b<e;b+=2)Il(d[b+1],d[b])}},Il=function(d,b){b[d]=NaN;b[d+1]=NaN;b[d+2]=NaN;b[d+3]=NaN;b[d+4]=NaN;b[d+5]=NaN;b.changed=!0;yn.put(d)};Ja.addWorker=function(d){this.workers.put(d.id);
d.workingOn=this.id};Ja.deleteWorker=function(){this.workingOn&&(z[this.workingOn].workers.quit(this.id),this.workingOn=0);this.actionItem&&(this.actionItem=void 0);this.blockedAction()};Ja.blockedAction=function(d){var b=this.blocked;if(Jl[b])Jl[b](this,d)};var Jl={2:function(d,b){d.blocked=void 0;zc(d);Hl(d.blockedimg);d.blockedimg=void 0;d.manaTarget=void 0;b||(H[d.kingdom].setupResources(d.blockedCost,-1),d.blockedCost=void 0)}},hl=function(d){return m.delay[-d[1]+d[0]-1]},Ee=function(d){var b=
D.length;D.quit(d);if(b!=D.length){var e=z[d];e.selectAnim=void 0;b=0;for(e=e.tempChild;b<e.length;b++){var c=e[b];Ub(c);var g=e.length;e.quit(c);g!=e.length&&b--}wb[d]=void 0;0==D.length?gf():1==D.length?z[d].build?Aa(z[d],1):Wc(d):Xg(D)}hb&&hb.id===d&&(gf(),hb.selectAnim&&(Ub(hb.selectAnim),hb.selectAnim=void 0),hb=void 0)};Ja.rbase=function(){return kd[this.zLevel]};var Ng,Mi=function(d){Ab.put(d.bufferID);if(d.child){var b=0;d=d.childLoc;for(var e=d.length;b<e;b+=2)Ab.put(d[b][d[b+1]])}};Ja.die=
function(d){if(!this.death){var b=F,e=this.id,c=this.kingdom,g=H[c];this.waitlist&&(g.unitLoading-=.5*this.waitlist.length);if(this.dieSound&&!p.editor){var h=this.dieSound;Ca(h[~~(h.length*Math.random())],this.x32,this.y32)}Ee(this.id);(this.freezed||this.invisible)&&zc(this);var l=this.x32,k=this.y32;this.death=1;1==this.zLevel&&(Ng[l+k*b]=1);this.c=void 0;var t=this.url.die||this.dimg;!1===this.built&&g.building.quit(this.id);void 0!=g.IAD&&g.k&&!this.item&&Qa.arr[g.IAD].valorateLost(this);if(this.food&&
!p.editor){var r=100,u=this.food/r,q=~~u,v=~~((u-q)*r);for(h=0;h<u;h++){h==q&&v&&(r=v);var w=Pk(l,k),y=~~(w/b);w%=b;w=new Sc(52,c,w,y,0);pa(w,m.item_meat);w.contain=[r,2,Xm]}}g.stats.unitCountDeath[this.type]++;h=this.x32;b=this.y32;d||p.editor?(Ub(this),Mi(this)):t?(this.mv=!0,pa(this,t,1),d=ra[this.img],t=d[1],t=0>t?hl(d):1E3*d[0]/t,kb({func:gl,data:this.id},t-25,1),Qc(this,0,0,0),void 0!==this.dix&&(d=.001*(p.now()-this.timestamp),this.x32+=this.dix*d/32-Math.sign(this.dix),this.y32+=this.diy*
d/32-Math.sign(this.diy))):this.dimgInfinity?(this.dimgRND&&(this.d=this.id%this.dimgRND),pa(this,this.dimgInfinity)):(Ub(this),Mi(this));mi(this);this.techStart&&kg(0,[this.id]);Hb(this,32*this.y32-36);this.x32=h;this.y32=b;this.build||this.item||this.cow||g.values.pop--;this.population&&this.built&&(g.values.popMax-=this.population);k=this.validator(l,k,this.space,this.kingdom);d=k[0];if(this.onbuild&&!p.editor)for(l=this.onbuild,t=g.technology,h=t.disabled,t=t.actived,b=0;b<l.length;b++)c=l[b].id,
t[c]--,0===t[c]&&h[c]++;l=this.validator.dimension;b=l.write;h=0;for(t=d.length;h<t;h++)c=d[h],zb[c]?b(c,zb[c]):b(c,0);if(1==this.health&&!this.built)for(c=Gb[this.kingdom],h=0,t=d.length;h<t;c[d[h++]]=void 0);if(k[2])for(d=k[2],h=0,t=d.length;h<t;h++)c=d[h],zb[c]?(2<l(c)&&z[l(c)].die(1),b(c,zb[c])):(2<l(c)&&z[l(c)].die(),b(c,0));xa[this.kingdom][this.type].quit(this.id);vd(this);if(this.workers){h=0;l=this.workers.slice(0);for(t=l.length;h<t;h++)k=z[l[h]],k.workingOn===e&&(k.workingOn=0,k.func!==
si.url&&k.stay());this.workers.length=0}this.deleteFromList&&(l=this.deleteFromList,l.quit(this),l.length||l.length0function(this));this.time=void 0;this.changeFunc(void 0);this.diy=this.dix=0;this.inventory&&0<this.inventory.length&&Jd(this.id,this.inventory.slice(0));this.stock&&Nk(this);p.editor||(g.check(),Ae(this.kingdom),g.checkPopArray());this.deleteWorker()}};Array.prototype.quit=function(d){d=this.indexOf(d);return-1<d?(this.splice(d,1),!0):!1};Array.prototype.add=function(d){0>this.indexOf(d)&&
(this[this.length]=d)};var jb=["European","Arab","Asian"],Gk={euro:"Lancelot Arthur Guivain Merlin Blackthorn Morin Golstuck Karambol Kelerick Rockmore Bridport Casevil Stirm Tonis Pelegrim Peresohn Pirk Pharn Gork".split(" "),arab:"Ibn Fadlan;Mohammad;Al Ferissa;Harun Al Rashid;Sindbad;Mellemad;Moarrac;Sakhavan;Bellefars;Mokhac;Norahz;Kerhetin;Maham;Dushesh;Direkh".split(";"),asia:"Ishida Toranaga Ichinzen Haiako Mozuki Hitachi Tosheba Harachiko Marasuma Korodzum Ishinghen Genghis Musa Echibo Ichikahr Yotokan Maraga".split(" "),
common:"Fistantilus Skenderbeg Raislin Tenis Morok Sokob Baras Haram Billihz Ynte Orgh Savael Birgos Savator Gandeh Gordor Fessh Gilmi Phergas".split(" ")},Mh=[u.gold,u.wood,u.food,u.stone,u.mana],Di=function(d,b,e){e&&(d=d.replace("%d",e));return d.replace("%s",b)},Sd={},aj,Bc,bh,yf=function(d){p.infinity=void 0;if(""!=r("mapconfiguration").innerHTML){d="mapx mapwidth goldRes goldValue woodRes woodValue foodRes foodValue stoneRes stoneValue infinity infiniteValue water waterValue terrainType terrainSelect items itemsValue peons peonValue gateways gatewaysValue freePop freePopValue".split(" ");
for(var b=0,e=d.length;b<e;b+=2){var c=document.getElementById(d[b+1]).value;"infinity"==d[b]?(c=document.getElementById(d[b+1]).checked,p[d[b]]=c):parseInt(c)?p[d[b]]=parseInt(c):p[d[b]]=c;localStorage[d[b]]=c}}else"true"==localStorage.infinity&&(p.infinity=!0),p.goldRes=parseInt(localStorage.goldRes),p.foodRes=parseInt(localStorage.foodRes),p.woodRes=parseInt(localStorage.woodRes),p.stoneRes=parseInt(localStorage.stoneRes),p.mapx=parseInt(localStorage.mapSize),p.water=parseInt(localStorage.water),
p.terrainType=localStorage.terrainType,p.items=parseInt(localStorage.items),p.peons=parseInt(localStorage.peons),p.gateways=parseInt(localStorage.gateways),p.freePop=parseInt(localStorage.freePop);p.infinity&&(p.goldRes=Infinity,p.foodRes=Infinity,p.woodRes=Infinity,p.stoneRes=Infinity);p.infinity=void 0;p.goldRes||(p.goldRes=Infinity);p.foodRes||(p.foodRes=Infinity);p.woodRes||(p.woodRes=Infinity);p.stoneRes||(p.stoneRes=Infinity);p.mapy=p.mapx;p.gravity=580.9/9.8*9.8;p.name="";p.arje=555555*Math.random()+
1;Kl(p);return p},Dl=function(){r("notifybottom").style.display="none";r("loadingtext").innerHTML=u.loading;if(p.rules){var d=p.rules,b={};xf={events:{defined:b,nodefined:{}}};for(var e={moving:1},f=0,g=0,h=d.length;g<h;g++){var l=d[g];l.activeEvents=0;for(var k=l.events,m=0,E=k.length;m<E;m++){var B=k[m];B.id=f++;var q=B.list,z=B.to,x=B.type,A=B.zone;B.rule=l;for(var C=B.activeEvents=0,D=q.length;C<D;C++){var G=q[C];b[G]||(b[G]={});G=b[G];if(e[x])G[x]||(G[x]=[]),G[x].put(B);else if("zone"==x){G[x]||
(G[x]=[]);for(var I=0;I<A.length;I++)G[x].push(B,A[I][0],A[I][1],A[I][2],A[I][3])}else{G[x]||(G[x]={defined:{}});G=G[x].defined;I=0;for(var J=z.length;I<J;I++)G[z[C]]||(G[z[C]]=[]),G[z[C]].put(B)}}}}}else xf=void 0;w.kingdom||(w.kingdom=1);p.online&&(zn(u.initializing),p.editor=0);p.mapx||yf();p.pausedTime=0;p.canceled=0;d=Object.keys(c);b=H.length;e=0;for(f=d.length;e<f;e++){g=c[d[e]];g.id=e;if(g.disabled)for(h=0;h<b;H[h++].technology.disabled[e]=g.disabled);if(g.hidden)for(h=0;h<b;H[h++].technology.hidden[e]=
1);}bh=performance.now();pc=document.getElementById("msgs1");p.online||(location.hash="");fa("playermenu");fa("index");Jb=H[w.kingdom];wg(w.kingdom);aj||(aj=JSON.parse(JSON.stringify(H.slice(1))));p.cycle?p.deltaTime=25*p.cycle:(p.players=H.length-1,p.date=Date.now(),p.cycle=0,p.kingdoms=H,p.deltaTime=0);p.loadDate=Date.now();p.online||Fi();p.now=yk;p.paused=0;p.pausedTime=0;p.zMax=96*p.mapy;lb();performance.now();p.allow14=!0;F=p.mapx;sa=p.mapy;p.temperature=25;d=p.temperature;0==w.temperature&&
(d+="&deg;C");document.getElementById("temperature").innerHTML=d;X=1;Ng={};p.online&&Da("content");r("loadingtext").innerHTML="Loading terrain";performance.now();if(!1!==p.arje){d=F;b=d*sa;e=Math.sqrt(b);var L;m=0;var M;C=new Int8Array(new ArrayBuffer(b));D=new Uint32Array([2,3,0,1,1,1,0,1,0,1,0,1,3,p.water,1,0,1,1,1,0,0,15,0,1]);for(bn(p.arje);m<b;C[m++]=0);G=D.length;for(m=0;m<G;m+=4)D[m+3]&&(D[m+1]=~~(e/D[m+1]));for(E=0;E<G;E+=4)for(B=D[E+1],q=D[E],z=D[E+2],m=0;m<B;m++)for(I=~~(ja()*b+.5),g=6*
ja()-3,h=6*ja()-3,z?(k=ja()*e,A=~~(ja()*(e/15))+4,l=~~(100*ja())/4,x=A/12):(k=128*ja(),A=~~(2.56*ja())+4,l=~~(100*ja())/2,x=1),f=I%d,I=~~(I/d),M=0;M<k;M++)for(100*ja()>l&&(g=(6*ja()-3)*x,h=(6*ja()-3)*x),f+=g,I+=h,J=0;J<A;J++)for(L=0;L<A;L++)if((J-A/2)*(J-A/2)+(L-A/2)*(L-A/2)<A*A/4){var N=~~f+J+(L+~~I)*d;N>=b?N%=b:0>N&&(N+=b);C[N]=q}performance.now();Bc=C}else Bc=p.terrain?new Int8Array(p.terrain):new Int8Array(F*sa);performance.now();performance.now();r("loadingtext").innerHTML="Creating map";e=F;
f=sa;d=WASMap(e);b=y.HEAPU32.buffer;e=e*f*4;ua=new Uint32Array(b,d,e/4);V=new Uint32Array(b,d+e,e/4);qd=new Uint32Array(b,d+2*e,e/4);nc={};performance.now();r("content").style.display="block";performance.now();if(!1===p.arje||p.allunits)v=p.allunits;else{d=Bc;b=p.mapx;m=p.mapy;performance.now();h=b*m;z=Math.sqrt(h);v=[];Ud={};l=An;k=Bn;e=Ud;f=Cn;E=[12,63,62];g=[];q=H.length;for(B=1;B<q;B++){D=!0;x=H[B];I=E[x.race];for(J=0;D&&25>J;){J++;A=~~(ja()*(b-15)+.5)+4;C=~~(ja()*(m-15)+.5)+4;D=!1;G=g.length;
for(x=0;x<G;x+=2)60>Math.sqrt((A-g[x])*(A-g[x])+(C-g[x+1])*(C-g[x+1]))&&(D=!0);D||(g.push(A+4,C+3),l(A+C*b,{type:I,kingdom:B}))}if(25==J){H.length=B;break}}E=2*(q-1);for(x=0;x<E;x+=2)C=2*Math.round(ja())-1,B=g[x]+10*(2*Math.round(ja())-1)+~~(3*ja()),A=g[x+1]+10*C+~~(3*ja()),q=g[x]+10*(2*Math.round(ja())-1)+~~(3*ja()),C=g[x+1]+10*-C+~~(3*ja()),0>B?B=0:B+4>F&&(B-=(B+4)%h),0>A?A=0:A+4>sa&&(A-=(A+4)%h),0>q?q=0:q+4>F&&(q-=(q+4)%h),0>C?C=0:C+4>sa&&(C-=(C+4)%h),Infinity!==p.goldRes&&l(B+A*b,{type:21}),Infinity!==
p.stoneRes&&l(q+C*b,{type:22});if(Infinity!==p.goldRes)for(B=0,q=10*F*sa/65536;B<q;B++)l(~~(ja()*h),{type:21});if(Infinity!==p.stoneRes)for(B=0,q=10*F*sa/65536;B<q;B++)l(~~(ja()*h),{type:22});q=1*~~(z/3.2);for(B=0;B<q;B++)for(D=~~(ja()*b+.5),G=~~(ja()*m+.5),I=~~(25*ja())+10,J=~~(25*ja())+10,x=0;55>x;x++)A=~~(ja()*I+~~(D+18*ja()-9)+.5),C=~~(ja()*J+~~(G+18*ja()-9)+.5),z=A+C*b,k(z)&&z<=h&&l(z,{type:7,d:~~(28*ja()+3)});q=parseInt(p.items);for(B=0;B<q;B++){z=~~(ja()*h+.5);x=Ui[~~(ja()*Ui.length)];m=Object.assign({},
x);m.d+=~~(x.dMax*ja());if(x.sword||x.potion)m.attack=~~(6*ja())+1;if(x.shield||x.potion)m.defence=~~(6*ja())+1;x.book&&(x=~~(ja()*ch.length),m.spell=ch[x],m.iconID=c[ch[x]].iconIDbook,m.name=u[m.spell],m.attack=~~(6*ja())+1);l(z,m)}q=parseInt(p.gateways);for(B=0;B<q;B++)z=~~(ja()*h),k(z)&&l(z,{type:43});for(x=0;x<E;x+=2)for(B=g[x]-25,A=g[x+1]-25,q=0;50>q;q++)for(C=0;50>C;C++)625>(q-25)*(q-25)+(C-25)*(C-25)&&(h=q+B+(C+A)*b,7===f(h).type&&(v.quit(e[h]),e[h]=void 0),1===oc.type[d[h]]&&(d[h]=0));performance.now()}p.movtable&&
!p.demo&&(dd=p.movtable,cd=p.movtable2);performance.now();r("loadingtext").innerHTML="Loading textures";vm(Bc);performance.now();performance.now();bj(Bc);performance.now();Xb.check()},Xb=function(){for(var d=["loading","playermenu","index"],b=d.length,e=0;e<b;document.getElementById(d[e++]).style.display="none");pb(db);pb(L);Ae(w.kingdom);Ci();gf();Ll();window.addEventListener("keydown",Nj);window.addEventListener("keyup",Oj);window.addEventListener("mousemove",Pj);window.addEventListener("wheel",
yh,!1);aa=nb;ba=new Float32Array(12);d=ra[m.blank].id;x[0]=d;x[1]=0;x[2]=1;x[3]=0;x[4]=d;x[5]=0;x[6]=1;x[7]=0;x[8]=d;x[9]=0;x[10]=1;x[11]=0;x[12]=d;x[13]=0;x[14]=1;x[15]=0;d=ma;d[0]=0;d[1]=1;d[2]=2;d[3]=1;d[4]=2;d[5]=3;k.bindBuffer(k.ARRAY_BUFFER,yd);k.bufferSubData(k.ARRAY_BUFFER,0,x);k.bindBuffer(k.ARRAY_BUFFER,Ma);e=3*w.kingdom;d=Ha[e];b=Ha[e+1];e=Ha[e+2];k.bufferSubData(k.ARRAY_BUFFER,0,new Float32Array([d,b,e,.5,d,b,e,.5,d,b,e,.5,d,b,e,.5]));d=96*F;ba[2]=d;ba[5]=d;ba[8]=d;ba[11]=d;window.addEventListener("mousedown",
Qj);window.addEventListener("mouseup",Rj);bh=performance.now()-bh;P("FULL: ",bh);Wi=!1;p.record||(p.record={});p.online?(Ic(bd(),u.waitingPlayers,1),w.admin?Xc():(P("live ready"),O(Xc,0,0))):zf();p.allow14=!1};Xb.check=function(){Xb.load++;Xb.load===Xb.target&&Xb()};Xb.target=2;var bd=function(){for(var d=Ea.length,b=Ea,e="",c=0;c<d;c++){var g=b[c];bd.obj[g.id]||g.id==w.onlineID||(e+="<br>"+g.nhinfo.name)}return e};bd.obj={};var Ml=function(){return w.gl?!1:(Ic("You can't run WEBGL 2<br>More info <a href='http://webglreport.com/?v=2'>here</a>",
"Error"),cc(),!0)},Kj=function(){var d=document.documentElement;d.requestFullscreen?d.requestFullscreen():d.msRequestFullscreen?d.msRequestFullscreen():d.mozRequestFullScreen?d.mozRequestFullScreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen()},Wi=!1,Vd=function(){if(!Ml())if(WASMap)if(Rh(),Xb.load=0,"true"==localStorage.fullscreen&&Kj(),p.editor?(w.marx=0,w.mary=60,w.menumy=60,vb=ic=171,w.mx=171,w.menumx=171):(w.mx=151,vb=ic=128,w.menumx=151,w.menumy=0,w.marx=4,w.mary=31),nd.style.width=
ic+"px",nd.style.height=vb+"px",nd.style.left=w.marx+"px",nd.style.top=w.mary+"px",Da("loading"),""==r("loading").innerHTML&&(r("loading").innerHTML='<p id="loadingtext"></p>\n<div>\n<div class="svgtzared"></div>\n<div id=\'logo\' class="svgnehhon"></div>\n<span id="netral">NEHHON NETRAL-H ENGINE</span>\n</div>'),origin=!1,void 0===p.arje&&yf(),Uf.last!==p.terrainType){ka.started=!0;var d=w.cdn;Pm({icons:d+"icons.png",imageJSON:d+"images.json",common:d+"graphics.nh17"});Uf.last=p.terrainType;Wi=!0}else Xb.check(),
Oh();else dh.waiting=!0},xf,Ci=function(){var d=document.getElementById("playersinfo");d.innerHTML="";if(!p.editor)for(var b=1,e=H.length;b<e;b++){var c=H[b],g=c.death?c.name.strike():c.name;d.innerHTML+=g+"<span id='score"+b+"'></span><div class='playercolor' style='background:rgb("+c.color[0]+","+c.color[1]+","+c.color[2]+")'></div><span class='ping'>"+(void 0!=H[b].ping&&" "+H[b].ping+"ms"||"")+"</span><br>"}},Ll=function(){var d=window.innerWidth-w.mx,b=window.innerHeight,e=H[w.kingdom].origin;
e?(d=32*e[0]-.5*d,b=32*e[1]-.5*b):b=d=0;Bd(~~d,~~b)},ff,ul,ol,Om=function(){var d=document.getElementById("selectedobject").getContext("webgl",{antialias:!1,depth:!1}),b=d.createShader(d.VERTEX_SHADER);d.shaderSource(b,"void main() {\ngl_Position = vec4(0 ,0, 0, 1);\ngl_PointSize=48.0;\n}");d.compileShader(b);var e=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(e,"precision mediump float;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nuniform float txtCoord;\nvoid main() {\ngl_FragColor = texture2D(u_image, (vec2(\tmod(txtCoord,21.0) ,floor(txtCoord/21.0) ) + gl_PointCoord)*(0.046875));\nif(gl_FragColor.r==gl_FragColor.g&&gl_FragColor.r==gl_FragColor.b) gl_FragColor*=u_color;\n}");
d.compileShader(e);var c=d.createProgram();d.attachShader(c,b);d.attachShader(c,e);d.linkProgram(c);d.useProgram(c);b=d.createTexture();d.bindTexture(d.TEXTURE_2D,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texImage2D(d.TEXTURE_2D,0,d.RGB,d.RGB,d.UNSIGNED_BYTE,Y.icons);var g=d.getUniformLocation(c,"u_color"),
h=d.getUniformLocation(c,"txtCoord");ff=function(b){if(ra[b.img][3]){var e=b.kingdom;d.uniform4f(g,Ha[3*e],Ha[3*e+1],Ha[3*e+2],1)}else d.uniform4f(g,1,1,1,1);d.uniform1f(h,b.iconID);d.drawArrays(d.POINTS,0,1)};ul=function(){d.uniform4f(g,1,1,1,1);d.uniform1f(h,189);d.drawArrays(d.POINTS,0,1)};ol=function(){d.uniform1f(h,0);d.uniform4f(g,0,0,0,0);d.drawArrays(d.POINTS,0,1)}},ic=128,vb=128,z=[{terrain:1},{terrain:1},{terrain:1}],zb={},bj=function(d){bj.using=!0;d=p.tr;var b=v;if(!p.custom&&b){for(var e=
p,c=b,g="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy".split(" "),h={},l=0;l<g.length;l++)h[g[l]]=l;g=[];var k=c.length;for(l=0;l<k;l++){var m=c[l],r=Object.keys(m),u={};g.put(u);for(var q=0,w=r.length;q<w;q++)u[h[r[q]]]=m[r[q]]}e.ini=g}p.demo&&(b=p.ini);if(b)for(e=
0,c=b.length;e<c;e++){h=b[e];if(void 0!==h.race){h.type=Dn[h.type+256*h.race];h.kingdom=d[h.kingdom];if(void 0==h.type)continue;l=A[h.type];if(13==h.type||l.build)h.d=0;h.resource&&(h.health=h.resource,h.maxHealth=h.resource);if(!h.health||void 0==h.kingdom)continue}h.death?(z.put(h),WASMfalseUnit()):h.cancell||(l=h.x32,g=h.y32,k=!1===h.built&&1===h.health?!0:!1,m=h.kingdom||0,h=new Sc(h.type,m,l,g,0,k,h),h.invalid||(k||p.cycle||Qk(h),h.castle&&(H[m].origin=[l+4,g+3])))}Ud=v=null;bj.using=!1},Ae=
function(d){d===w.kingdom&&(d=Jb.values.popMax<Jb.values.popLimit?Jb.values.popMax:Jb.values.popLimit,document.getElementById("pop").innerHTML=Jb.values.pop+"/"+d)};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(d){window.setTimeout(d,1E3/60)}}();var Ud=v=void 0;var An=function(d,b){Ud[d]||(b.x32=d%F,b.y32=~~(d/sa),v.put(b),Ud[d]=b)},Bn=function(d){return!v[d]},Cn=function(d){return Ud[d]||
NaN},Ea=[];window.addEventListener("offline",function(d){ne("Offline","#ff0000")});window.addEventListener("online",function(d){ne("Online","#00ff00")});var wh=function(){qb.leaveRoom();Ea.length=0},Wd={};(function(){for(var d=["returnmenu","index","Account","accountIframe"],b=0,e=d.length;b<e;Wd[d[b]]=document.getElementById(d[b++]));})();var En=function(){location.replace("#"+this.gameID+"Room")},Uj=function(d){Ea=[];P("connecting to",d,u.loading);r("game").style.display="block";r("gameName").innerHTML=
u.loading;r("returnmenu").style.display="none";r("index").style.display="none";Yc.innerHTML="";pc.innerHTML="";na=[];w.p2p?(qb.joinRoom(d,zh),Rh()):(qb||qc(),qc.func=function(){Uj(d)})},Fn={6400900:".",28462225:"a",29052100:"b",29648025:"c",3025E4:"d",30858025:"e",31472100:"f",32092225:"g",32718400:"h",33350625:"i",33988900:"j",34633225:"k",35283600:"l",35940025:"m",36602500:"n",37271025:"o",37945600:"p",38626225:"q",39312900:"r",40005625:"s",40704400:"t",41409225:"u",42120100:"v",42837025:"w",4356E4:"x",
44289025:"y",45024100:"z"},Gn=function(d){r("game").style.display="none";ta.length=0;p.online=0;oa=p.id=void 0;wh();cc();d.constructor==String&&Ic(d)},Mj={euro:0,arab:0,asia:0},ke=function(d,b,e){if(!p.started&&e){P("peerInfo",d);d.name=Wa(d.name);d.team=parseInt(d.team);0>d.team&&(d.team=0);d.team%=6;d.race=parseInt(d.race);if(0>d.race||2<d.race)d.race=0;b=d.version;e&&e.admin&&b!=w.version&&(cc(),qb.leaveRoom(),Ic(u.versionError+"<p> Admin version: "+parseFloat(b.substr(1))+"<br> Your version: "+
parseFloat(w.version.substr(1))));e.nhinfo=d;e.username=d.name;Xd()}},na,Wb=function(d,b,e){na=d;Xd()},Of=function(){return{version:w.version,color:w.color,team:w.team,race:w.race,name:w.name}},Pa=function(d,b){if(b.resend)if(d.destinatary)(b=Yd(d.destinatary))&&b.id!=w.onlineID&&(d.bridge=h.id,b.send(d));else{b=b.resend;for(var e=0,c=b.length;e<c;e++){var g=b[e];d.bridge=h.id;g.send(d)}}else{var h=b;void 0===d.length?void 0!==d.func&&(b=dg[d.func],Nl(b,d[1],d[2],h)||b(d[1],d[2],h)):(b=d[0],h.orderList[b]=
d,Pa.done[b]||(Pa.done[b]=0),Pa.done[b]++,Pa.done[b]==Ea.length&&Pa.func&&(Pa.func=!1,Cd(),lb()))}};Pa.done=[];var Yd=function(d){for(var b=0,e=Ea.length;b<e;b++){var c=Ea[b];if(c.id==d)return c}},qb,Pl=function(d){if(!r("usernameForm")){Pb();var b=localStorage.name||"Guest",e=localStorage.color||"#"+Math.floor(16777215*Math.random()).toString(16),c=document.createElement("div");c.id="usernameForm";c.innerHTML="\n            <div>\n            <h2>"+u.username+'</h2>\n            <div>\n<input type="color" id=\'usernameColor\' value="'+
e+'" /><input id=\'usernameVal\' type="text" value="'+Ol(b)+'" />\n</div>\n<br />\n</div>';b=document.createElement("button");b.innerHTML=u.continue;b.onclick=function(){w.name=Wa(r("usernameVal").value);w.color=r("usernameColor").value;localStorage.color=w.color;localStorage.name=w.name;document.body.removeChild(r("usernameForm"));d();Oa()};c.children[0].appendChild(b);document.body.appendChild(c)}},qc=function(){Ml()||(w.name?(Gm(),qb=new SimpleWebRTC({localVideoEl:"",remoteVideosEl:"",autoRequestMedia:!1,
receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},url:"https://solar.tza.red/"}),qb.on("channelMessage",function(d,b,e){"nehhof"==e.type&&Pa(e.payload,d)}),qb.on("error",function(d){"full"==d&&(cc(),ne(u.gameFull,"#ff0000"))}),qb.on("connectionReady",function(d){var b=qb.connection.connection;w.p2p=b;b.username=w.name;b.color=w.color;b.on("getRooms",function(b){var e=b.date,d=Object.keys(b),c=r("gameList");if(1<d.length){c.innerHTML="";for(var l=0,k=d.length;l<k;l++){var m=d[l],p=b[m];if("date"!=
m){var v=p.len;if(v){var q=document.createElement("tr"),w="";w=p.playing?w+("<td><div class='redCircle'></div>"+u.playing+"</td>"):w+("<td><div class='redCircle' style=\"background:rgba(0,255,0,.8); box-shadow:0px 0px 20px rgba(0,255,0,.8)\"></div>"+u.waiting+"</td></td>");w+="<td>"+Wa(p.description)+"</td><td>"+~~((e-p.date)/6E4)+" min ago</td><td>"+Wa(v)+"/"+Wa(p.max)+"</td>";q.innerHTML=w;q.gameID=m;p.playing||(q.onclick=En);c.appendChild(q)}}}}else c.innerHTML="<tr><td>No games found</td></tr>"});
w.onlineID=d;qc.func&&qc.func()}),qb.on("createdPeer",function(d){p.started||xm(d)})):Pl(qc))},Hn=function(){Rh();Oa();r("game").style.display="block";r("gameName").innerHTML=u.loading;r("returnmenu").style.display="none";r("index").style.display="none";Yc.innerHTML="";pc.innerHTML="";Ea=[];Dj();w.admin=1;w.room={description:r("gameFormName").value,max:parseInt(r("gameMax").value),public:!0};2>w.room.max&&(w.room.max=2);14<w.room.max&&(w.room.max=14);localStorage.gameDescription=w.room.description;
qb.createRoom(w.onlineID+"b",zh);p.online=1;ed(yf());document.body.removeChild(r("gameForm"));na=[w.onlineID];Xd()},Ql=function(){qb||qc();if(w.onlineID){Pb();var d=localStorage.gameDescription||w.name+"'s room",b=document.createElement("div");b.id="gameForm";b.innerHTML="\n<div>\n            <h2>"+u.gameOptions+"</h2>\n            "+u.gameName+': <input id=\'gameFormName\' type="text" value="'+d+'" maxlength="29" /><br />\n'+u.nplayers+': <input id="gameMax" type="number" value="6" max="14" min="2"/><br />\n            </div>';
d=document.createElement("button");d.innerHTML=u.continue;d.onclick=Hn;b.children[0].appendChild(d);document.body.appendChild(b)}else setTimeout(function(){location.hash=""},200),qc.func=Ql},Rl=function(d){for(var b="kingdom d type img x32 y32 name iconID attack defence level health maxHealth func funcObj workers workingOn inventory dix diy timestamp working rnd techID techStart activeTech levelProgress c mimg built xf yf action point waitlist mv work death freezed confused sword shield book spy stock".split(" "),
e=[],c=d.length,g=0;g<c;g++){var h=d[g],l=Object.keys(h),k={};e.put(k);for(var m=0,p=l.length;m<p;m++)k[b[l[m]]]=h[l[m]]}return e},Am=function(){Af.download=!1;Jj();Af.download=!0},Jj=function(){p.editor&&(p.arje=!1,r("mapDescription")&&(p.description=r("mapDescription").value,p.name=r("mapName").value,p.author=r("mapAuthor").value));delete p.terrain;var d=p,b=z,e=[];e.length=b.length-3;for(var c=3,g=b.length;c<g;c++){var h=b[c],l=A[h.type],k={0:h.kingdom,1:h.d,2:h.type,3:h.img,4:h.x32,5:h.y32};h.name!==
l.name&&(k[6]=h.name);h.iconID!==l.iconID&&(k[7]=h.iconID);h.attack!==l.attack&&(k[8]=h.attack);h.defence!==l.defence&&(k[9]=h.defence);h.level!==l.level&&(k[10]=h.level);h.health!==l.health&&(k[11]=h.health);h.maxHealth!==l.maxHealth&&(k[12]=h.maxHealth);h.func&&(k[13]=h.func);h.funcObj&&(k[14]=h.funcObj);h.workers&&h.workers.length&&(k[15]=h.workers);h.workingOn&&(k[16]=h.workingOn);h.inventory&&h.inventory.length&&(k[17]=h.inventory);h.dix&&(k[18]=h.dix);h.diy&&(k[19]=h.diy);h.timestamp&&(k[20]=
h.timestamp);h.working&&(k[21]=h.working);h.rnd&&(k[22]=h.rnd);h.techID&&(k[23]=h.techID);h.techStart&&(k[24]=h.techStart);h.activeTech&&(k[25]=h.activeTech);h.levelProgress&&(k[26]=h.levelProgress);h.c&&(k[27]=h.c);h.mimg&&(k[28]=h.mimg);void 0!==h.built&&(k[29]=h.built);void 0!==h.xf&&(k[30]=h.xf);void 0!==h.yf&&(k[31]=h.yf);void 0!==h.action&&(k[32]=h.action);h.point&&(k[33]=h.point);h.waitlist&&(k[34]=h.waitlist);h.mv&&(k[35]=h.mv);h.work&&(k[36]=h.work);h.death&&(k[37]=h.death);h.freezed&&(k[38]=
h.freezed);h.confused&&(k[39]=h.confused);h.sword&&(k[40]=h.sword);h.shield&&(k[41]=h.shield);h.book&&(k[42]=h.book);h.spy&&(k[43]=h.spy);h.stock&&(k[44]=h.stock);e[c-3]=k}d.allunits=e;p.movtable=dd;p.movtable2=cd;p.kingdomStart||p.editor||(p.kingdomStart=aj);p.kingdoms=H.slice(1);p.lastEdit=Date.now();Af(p);p.allunits=void 0},In=function(d){for(var b=d.length,e=new Uint8Array(b),c=0,g=-1,h=0,l=0;l<b;l++){var k=d[l];if(g===k)h||(e[c++]=255),h++;else{if(h){if(4>h){c--;for(var m=0;m<h;m++)e[c++]=g}else e[c++]=
h>>8&255,e[c++]=h&255;h=0}e[c++]=k}g=k}if(h)if(4>h)for(c--,m=0;m<h;m++)e[c++]=g;else e[c++]=h>>8&255,e[c++]=h&255;return e.slice(0,c)},Af=function(d){d=JSON.stringify(d);d=(new TextEncoder("utf-8")).encode(d);d=[new Uint8Array([55]),new Uint8Array((new Uint32Array([d.length])).buffer),d];0==p.arje&&d.put(In(Bc));d=new Blob(d,{type:"application/octet-binary"});if(Af.download){d=URL.createObjectURL(d);var b=document.createElement("a");document.body.appendChild(b);b.style="display: none";b.href=d;b.download=
"savegame.tzared";b.click()}else Jn({name:p.name,date:Date.now(),played:p.now()},d)};Af.download=!0;var Bf=[],O=function(d,b,e,c,g){if(void 0===d.location)return d();if(p.started&&!p.editor){var f=p.record;f[p.cycle]||(f[p.cycle]=[]);var l=f[p.cycle];f=l.length;l[f]=d.location;l[f+1]=b;e&&e.length&&(e=e.slice(0));l[f+2]=e}if(!p.blocked&&p.online&&Ea.length){if(55===g)var k=!1;g={func:d.location,1:b,2:e,active:k,rnd:4294967296*Math.random()};if(!p.started||d.fast)cj(g),d(b,e);else if(c)for(f=0,b=c.length;f<
b;f++)d=c[f],g.destinatary=d.id,d.bridge?d.bridge.sendDirectly("channelMessage","nehhof",g):d.sendDirectly("channelMessage","nehhof",g);else Bf.put(g)}else d(b,e)},Kn=function(){Ea.length&&(yf(),Xc.i=0,w.p2p.emit("gameStarted"),O(dj,oa?!1:p,0,0,0))},Xc=function(d,b,e){if(e){if(bd.obj[e.id])return;bd.obj[e.id]=1;d=bd();""==d?Ic(d,u.loading,1):Ic(d,u.waitingPlayers,1)}w.admin&&(Xc.i++,P(Xc.i,ta.length,e),Xc.i==ta.length-p.bots&&setTimeout(function(){O(zf)},100))};Xc.i=0;var cj=function(d){for(var b=
0,e=Ea.length;b<e;b++)Ea[b].sendDirectly("channelMessage","nehhof",d)},Nl=function(d,b,e,c){if(!c)return!1;(b=d.secureNH&&!d.secureNH(b,e,c))&&P(d,c);return b},td,ej,Cd=function(){if(!Pa.done[td]||Pa.done[td]<Ea.length)return Pa.func=!0,lb(),!0;for(var d=na,b=0,e=d.length;b<e;b++){if(d[b]==w.onlineID)var c=void 0,g=ej;else{c=Yd(d[b]);if(!c)continue;g=c.orderList[td]}for(var h=1,l=g.length;h<l;h++){var k=g[h],m=dg[k.func];Nl(m,k[1],k[2],c)||m(k[1],k[2],c)}}Pa.func=!1;cj(Bf);ej=Bf;td++;Bf=[td+1];return!1};
Cd.maxPing=200;var zf=function(){Oa();document.getElementById("alert").style.display="none";p.started=1;p.date=Date.now();lb();Fa();td=0;if(!p.custom||p.demo)for(var d=1,b=H.length;d<b;d++){var e=Cb[Rg[H[d].race]],c=e.peasant.type;if(e=z[xa[d][e.castle.type][0]])for(var g=0,h=p.peons;g<h;g++)ze(c,e,1)}Qa.arr=[];Qa.units=[];Qa.time=500;Qa.steps=0;Qa.process=0;if(!p.editor&&!p.demo){Qa.precooked=[];for(d=0;d<H.length;d++)H[d].IA&&new Qa(H[d]);d=0;b=Qa.arr;for(c=b.length;d<c;b[d++].leaveMeAloneIKnowWhatToDo());
Wh()}p.online&&(cj([0]),Bf=[1],ej=[0]);yb()};zf.fast=!0;var dj=function(d,b,e){b=[];e=na;p=!1!==d?d:oa;for(d=p.bots=0;d<e.length;d++){var c=e[d];c==w.onlineID?(b[d]=w,w.kingdom=d+1):(P(c),c.name?(p.bots++,b[d]=c,c.IA=1):(c=Yd(c),b[d]=c.nhinfo,c.kingdom=d+1));ta=b}Ca("bless");p.infinity&&(p.goldRes=Infinity,p.foodRes=Infinity,p.woodRes=Infinity,p.stoneRes=Infinity);p.infinity=void 0;p.goldRes||(p.goldRes=Infinity);p.foodRes||(p.foodRes=Infinity);p.woodRes||(p.woodRes=Infinity);p.stoneRes||(p.stoneRes=
Infinity);Vd()},hf=!1,Oa=function(){hf=!1;r("basic").style.filter=""},Pb=function(){hf=!0;r("basic").style.filter="blur(94px)"};var Sl=function(){Da("game");ta.length=0;p.id=void 0;p.online=0;oa=void 0;p.compressed=void 0;p.arje=void 0;wh();cc();w.admin=0};var fj=function(d,b,e){e&&(sb.arr=new Uint8Array(parseInt(d)),sb.i=0,r("showGameInfo").innerHTML="<table><tr><td>Downloading custom map</td><td id='cmappr'></td></tr></table>")},sb=function(d,b,e){e&&(sb.arr.set(d,sb.i),sb.i+=d.length,r("cmappr").innerHTML=
~~(100*sb.i/sb.arr.length+.5)+"%",sb.i==sb.arr.length&&Tl(sb.arr))};sb.step=1E4;var Tl=function(d){var b=gj(d);b.custom=!0;oa=b;oa.online=!0;oa.started=!1;oa.editor=!1;w.admin&&(oa.compressed=d);P("newmap",b);ed(b);Xd()},Ul=function(d){d=parseInt(d);if(2>d||!d)d=2;14<d&&(d=14);d!==w.room.max&&(w.p2p.emit("maxPlayers",d-(na.length-Ea.length-1)),O(Pf,d))},Pf=function(d){w.room.max=d;Xd()},Ln=function(){O(ed,p,!1);r("optionbutton").style.display="inline-table";fa("deleteCusMap")},zh=function(d){if((w.admin||
d)&&!p.id)if(d=qb.roomName,d+="Room",P("login"),Oa(),0!==qb.getPeers().length||w.admin){var b=w.room||NaN;p.id=d;p.online=1;Dj();w.admin&&(r("onlineTopInfo").innerHTML=' <button id="addAI" style="padding: 6px;">'+u.addAI+'</button><span style="float:right">'+u.nplayers+'<input id="nplayersO" min="2" type="number" max="14" value="'+w.room.max+'" /></span>',r("nplayersO").onchange=function(){var b=this.value;b<na.length&&(b=na.length);P(na.length,b);na.length!=b||Ea.length||b++;Ul(b);this.value=w.room.max},
r("addAI").onclick=function(){if(na.length<w.room.max&&(na.length+1!==w.room.max||Ea.length)){for(var b="#"+(~~(16777216*Math.random())).toString(16);7>b.length;)b+="0";na.put({name:"AI",race:0,team:5,color:b});w.p2p.emit("maxPlayers",w.room.max-(na.length-Ea.length-1));O(Wb,na,0)}});r("copyButton")&&(r("copyButton").onclick=function(){document.getElementById("onlineID").select();document.execCommand("Copy")},r("onlineID").value=location.origin+"/#"+p.id);r("gameName").innerHTML=Wa(b.description)||
"Online Game";fa("returnmenu");w.admin?(location.replace("#"+p.id),r("buttons").innerHTML='<button id="startbutton">'+u.play+'</button><button id="optionbutton">'+u.options+'</button><button id="closebutton">'+u.close+'</button><br><input id="maploadOnline" type="file" /> <label for= "maploadOnline">'+u.strcusMap+'</label> <button id="deleteCusMap">'+u.randomMap+"</button>",r("startbutton").onclick=Kn,r("optionbutton").onclick=Vl,r("closebutton").onclick=Sl,r("maploadOnline").accept=".tzared",r("maploadOnline").onchange=
Mn,fa("deleteCusMap"),r("deleteCusMap").onclick=Ln):(r("buttons").innerHTML='<button id="quitbutton">'+u.disconnect+"</button>",r("quitbutton").onclick=Gn);qb.connection.on("remove",Wl)}else location.hash="",cc()},Wl=function(d){if(d=Yd(d.id))if(Rc(Di(u.playerDisconnected,d.nhinfo&&d.nhinfo.name),0,5),p.online){if(p.started)for(var b=0;b<ta.length;b++)if(ta[b].id==d.id){H[b+1].die();break}Ea.quit(d);p.started?Pa.done[td]==Ea.length&&Pa.func&&(Pa.func=!1,Cd(),lb()):(w.admin&&(na.quit(d.id),O(Wb,na,
0)),d.admin&&(cc(),qb.leaveRoom(),Ic(u.gameClosed)))}},Kb=function(){0===Kb.active&&(O(hj),Kb.date=Date.now(),Kb.received=0,Kb.max=-Infinity,Kb.active=1)};Kb.active=0;var hj=function(d,b,e){e&&O(Xl,0,0,[e],0)};hj.fast=!0;var ij={},Xl=function(d,b,e){e&&(e.ping=~~(.5*(Date.now()-Kb.date)+.5),ij[e.id]?ij[e.id].put(e.ping):ij[e.id]=[e.ping],e.ping>Kb.max&&(Kb.max=e.ping),Kb.received++,Kb.received==Ea.length&&(Kb.active=0,p.started&&(H[e.kingdom].ping=e.ping,Ci())))},jj=function(d){var b=d.id;if(w.onlineID==
b)return Ic(d.sp&&u.nospace||u.kicked),Sl();if(d=Yd(b))d.end(),Wl(b)},kj=document.getElementsByClassName("ucolor"),lj=document.getElementsByClassName("username"),Yl=document.getElementsByClassName("race"),eh=document.getElementsByClassName("team"),ac=function(d){if(w.admin){ac.div&&(document.body.removeChild(ac.div),ac.div=void 0);var b=d.pageX;d=d.pageY;var e=this.i2,c=document.createElement("div");c.style.top=d+"px";c.style.left=b+"px";c.className="onlPlayer";ac.div=c;if(this.peer.name)b=document.createElement("button"),
b.onclick=function(){na.splice(e,1);w.p2p.emit("maxPlayers",w.room.max-(na.length-Ea.length-1));O(Wb,na,0);document.body.removeChild(c);ac.div=void 0},b.innerHTML=u.kick,c.appendChild(b);else{var g=this.peer&&this.peer.id;b=document.createElement("button");b.onclick=function(){var b=na.indexOf(g);na[b-1]&&(na[b]=na[b-1],na[b-1]=g,O(Wb,na,0),document.body.removeChild(c),ac.div=void 0)};b.innerHTML=u.up;c.appendChild(b);b=document.createElement("button");b.onclick=function(){var b=na.indexOf(g);na[b+
1]&&(na[b]=na[b+1],na[b+1]=g,O(Wb,na,0),document.body.removeChild(c),ac.div=void 0)};b.innerHTML=u.down;c.appendChild(b);w.onlineID!=g&&(b=document.createElement("button"),b.onclick=function(){O(jj,{id:g});document.body.removeChild(c);ac.div=void 0},b.innerHTML=u.kick,c.appendChild(b))}b=document.createElement("button");b.onclick=function(){document.body.removeChild(c);ac.div=void 0};b.innerHTML=u.close;c.appendChild(b);document.body.appendChild(c)}},Xd=function(){var d=document.getElementById("multiplayertable"),
b='<tr style="text-transform:uppercase"><td></td><td>'+u.username+"</td><td>"+u.race+"</td><td>"+u.team+"</td></tr>",e=na,c=w.room&&w.room.max||14;e&&c<e.length&&(c=e.length);for(var g=0;g<c;g++)b+='<tr><td class="ucolor"></td><td class="username">'+u.open+'</td><td class="race"></td><td class="team"></td></tr>';6>c&&(b+='<tr style="height: '+(260-46*c)+'px"></tr>');d.innerHTML=b;b=d.getElementsByTagName("tr");g=oa&&oa.kingdoms;var h=0;for(c=e.length;h<c;h++){if(e[h].name){m=e[h];p=w.admin;k=!0;var l=
b[h+1];l.onclick=ac;l.peer=m;l.i2=h;l.style.color="#fff900"}else{var k=!1;if(e[h]==w.onlineID)var m=w,p=!0;else{var v=Yd(e[h])||NaN;m=v.nhinfo;if(!m)return lj[h].innerHTML="...";p=!1}}g&&g[h]?(k=g[h],l=k.color,kj[h].style.background="rgb("+l[0]+","+l[1]+","+l[2]+")",lj[h].innerHTML=m.name,k.team&&(eh[h].innerHTML=k.team)):(l=gk(m.color),kj[h].style.background="rgb("+l[0]+","+l[1]+","+l[2]+")",lj[h].innerHTML=m.name,p?(eh[h].innerHTML="",l=document.createElement("button"),l.onmousedown=Zl,l.iteam=
m,l.innerHTML=m.team,eh[h].appendChild(l),k&&(l.style.color="#fff900"),l=document.createElement("button"),l.onmousedown=$l,l.iteam=m,l.innerHTML=jb[m.race],Yl[h].appendChild(l),k&&(l.style.color="#fff900"),k=document.createElement("input"),k.type="color",l=m.color,k.iteam=m,k.value="#"+(16777216+(l[0]<<16)+(l[1]<<8)+l[2]).toString(16).slice(1),kj[h].appendChild(k),k.onchange=am):(w.admin&&(b[h+1].onclick=ac,b[h+1].peer=v),eh[h].innerHTML=m.team,Yl[h].innerHTML=jb[m.race]))}r("msgs").style.height=
d.clientHeight-87+"px"},Kl=function(d){d.goldRes=parseInt(d.goldRes);d.foodRes=parseInt(d.foodRes);d.woodRes=parseInt(d.woodRes);d.stoneRes=parseInt(d.stoneRes);d.goldRes||(d.goldRes=Infinity);d.foodRes||(d.foodRes=Infinity);d.woodRes||(d.woodRes=Infinity);d.stoneRes||(d.stoneRes=Infinity);d.mapx=parseInt(d.mapx);(!d.mapx||32>d.mapx)&&(d.mapx=32);d.items=parseInt(d.items)||0;0>d.items&&(d.items=0);d.peons=parseInt(d.peons)||0;0>d.peons&&(d.peons=0);d.gateways=parseInt(d.gateways)||0;0>d.gateways&&
(d.gateways=0);d.water=parseInt(d.water)||0;0>d.water&&(d.water=0);d.freePop=parseInt(d.freePop)||0;d.terrainType=Wa(d.terrainType);d.description=Wa(d.description);d.author=Wa(d.author);d.name=Wa(d.name)},ed=function(d,b,e){Kl(d);d.goldRes||(d.goldRes=Infinity);d.foodRes||(d.foodRes=Infinity);d.woodRes||(d.woodRes=Infinity);d.stoneRes||(d.stoneRes=Infinity);b="<table><tbody>";d.custom?(e=new Date(d.date),e=e.getUTCDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),d=[u.mapName,d.name,u.mapSize,d.mapx,
u.description,d.description,u.terrainOption,d.terrainType,u.author,d.author,u.date,e],e=4):(oa&&(oa=void 0,Xd()),d=[u.gold,d.goldRes,u.mapSize,d.mapx,u.items,d.items,u.wood,d.woodRes,u.terrainOption,d.terrainType,u.peons,d.peons,u.food,d.foodRes,u.water,d.water,u.gateways,d.gateways,u.stone,d.stoneRes,u.freePop,d.freePop],e=6);for(var c=d.length,g=0;g<c;g+=2)g%e||(g&&(b+="</tr>"),b+="<tr>"),b+="<td>"+d[g]+":</td><td>"+d[g+1]+"</td>";b+="</tbody></table>";return r("showGameInfo").innerHTML=b},ta=[];
window.onhashchange=Tj;var pc=document.getElementById("msgs"),Yc=document.getElementById("msgs1"),Nf=document.getElementById("msginput"),Hi=document.getElementById("msginputGame"),Gi=document.getElementById("enterwindow");Nf.addEventListener("keyup",function(d){13==d.keyCode&&Ii()});var Rc=function(d,b,e){Ca("chat");e&&(b=p.started?Yc:pc,b.innerHTML=5!==e?b.innerHTML+("<li><span>"+e.username+" \u2014</span> "+Wa(d)+"</li>"):b.innerHTML+("<li>"+d+"</li>"),b.scrollTop=b.scrollHeight,p.started&&Dd())};
Rc.fast=!0;var Dd=function(){11==pc.children.length&&Yc.removeChild(Yc.children[0]);1==pc.children.length&&(Dd.intv=setInterval(Nn,16E3))},Nn=function(){Yc.removeChild(Yc.children[0]);0==pc.children.length&&clearInterval(Dd.intv)},Wa=function(d){return String(d).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Ol=function(d){return String(d).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},Ii=function(){if(p.started){var d=Yc,b=Hi.value;Hi.value=""}else d=pc,b=Nf.value,
Nf.value="";""!=b&&(b=Wa(b),d.innerHTML+="<li><span>"+w.name+" \u2014</span> "+b+"</li>",O(Rc,b,0,0,0),d.scrollTop=d.scrollHeight,p.started&&Dd())},dg=[dj,ec,uc,wc,pg,vc,Mc,Rc,ue,De,Id,Qi,Jd,df,li,kg,fg,Xc,hj,Xl,Li,zf,$f,Eg,Ne,Gg,zi,vg,Fe,Ge,Se,Oe,Jg,Je,pi,Od,ug,ui,bg,Ie,Dg,Te,Pe,wi,Ue,Le,Ke,Re,Lg,Ei,xi,ri,ed,ke,Wb,sb,jj,Pf,Yh,fj],bm=function(d,b,e){return e&&e.admin},Cf=function(d,b,e){return(e&&e.admin||!e)&&!p.started},S=function(d,b,e){d=b.length;e=H[e.kingdom].control;for(var c=0;c<d;c++)if(!e[z[b[c]].kingdom])return!1;
return!0},fh=function(d,b,e){d=H[e.kingdom].control;b=z[b];return d[b.kingdom]?!0:!1},mj=function(d,b,e){b=H[e.kingdom].control;d=z[d];return b[d.kingdom]?!0:!1};dj.secureNH=Cf;ec.secureNH=S;uc.secureNH=S;wc.secureNH=S;pg.secureNH=S;vc.secureNH=S;Mc.secureNH=S;ue.secureNH=S;De.secureNH=S;Id.secureNH=S;Qi.secureNH=mj;Jd.secureNH=S;df.secureNH=S;li.secureNH=S;kg.secureNH=S;fg.secureNH=fh;Li.secureNH=S;zf.secureNH=function(d,b,e){return e&&e.admin||!e};$f.secureNH=fh;Eg.secureNH=S;Ne.secureNH=S;Gg.secureNH=
S;zi.secureNH=mj;vg.secureNH=S;Fe.secureNH=S;Ge.secureNH=S;Se.secureNH=S;Oe.secureNH=S;Jg.secureNH=S;Je.secureNH=S;pi.secureNH=S;Od.secureNH=mj;ug.secureNH=S;ui.secureNH=S;bg.secureNH=S;Ie.secureNH=S;Dg.secureNH=S;Te.secureNH=S;Pe.secureNH=S;wi.secureNH=S;Ue.secureNH=S;Le.secureNH=S;Ke.secureNH=S;Re.secureNH=S;Lg.secureNH=S;Ei.secureNH=fh;xi.secureNH=fh;ri.secureNH=S;ed.secureNH=Cf;Wb.secureNH=Cf;jj.secureNH=Cf;Pf.secureNH=Cf;fj.secureNH=bm;sb.secureNH=bm;Yh.secureNH=function(d,b,e){return!e};(function(){for(var d=
dg,b=0,e=d.length;b<e;b++)d[b].location=b})();var cm=document.getElementsByClassName("ucolor1"),On=document.getElementsByClassName("username1"),Pn=document.getElementsByClassName("race1"),Qn=document.getElementsByClassName("team1"),Zl=function(d){var b=1;2==d.button&&(b=-1);if(p.online){d=this.iteam;d.team+=b;0>d.team&&(d.team=0);d.team%=6;this.innerHTML=d.team;if(d==w){O(ke,Of());return}return O(Wb,na,0)}d=this.iteam;ta[d].team+=b;0>ta[d].team&&(ta[d].team=0);this.innerHTML=ta[d].team},$l=function(d){if(p.online){d=
this.iteam;d.race=(d.race+1)%3;this.innerHTML=jb[d.race];if(d==w){O(ke,Of());return}return O(Wb,na,0)}d=ta[this.iteam];d.race=(d.race+1)%3;this.innerHTML=jb[d.race]},am=function(){P(this.value);this.parentElement.style.background=this.value;if(p.online){var d=this.iteam;d.color=this.value;if(d==w){O(ke,Of());return}return O(Wb,na,0)}w.color=this.value;ta[this.iteam].color=this.value},Rn=function(){lc.nu++;lc()},Sn=function(){lc.nu--;0>=lc.nu?lc.nu=1:ta.length--;lc()},Rg={0:"euro",1:"arab",2:"asia"},
dm=[["a","e","i","o","u"],"bcdfghjklmnpqrstvwxyz".split("")],lc=function(){if(w.name){document.getElementById("returnmenu").style.display="block";document.getElementById("oneplayertbody").innerHTML="";document.getElementById("oneplayertbody").innerHTML+='<tr><td></td><td id="addremove"><button id="addPlayer">+</button><button id="removePlayer">-</button></td><td></td><td></td></tr>';for(var d=lc.nu,b=0;b<d;b++)if(document.getElementById("oneplayertbody").innerHTML+='<tr><td class="ucolor1"></td><td class="username1"></td><td class="race1"><button></button></td><td class="team1"><button></button></td></tr>',
!ta[b]){for(var e="#"+(~~(16777216*Math.random())).toString(16);7>e.length;)e+="0";ta[b]={color:e,IA:1,race:~~(3*Math.random()),team:b}}document.getElementById("addPlayer").onclick=Rn;document.getElementById("removePlayer").onclick=Sn;ta[0].color=w.color;ta[0].name=w.name;ta[0].IA=0;for(b=e=ta[0].race=0;b<d;b++){var c=ta[b],g=Gk[Rg[c.race]];if(c.IA)if(e<g.length)c.name=g[e++];else{g=c;var h=~~(9*Math.random())+2,l=dm[1],k=l[~~(Math.random()*l.length)].toUpperCase();.85<Math.random()&&(k+=l[~~(Math.random()*
l.length)]);for(l=0;l<h;l++){var m=dm[l%2];k+=m[~~(Math.random()*m.length)];.8<Math.random()&&(k+=m[~~(Math.random()*m.length)])}g.name=k}cm[b].style.background=c.color;On[b].innerHTML=c.name;g=Qn[b].getElementsByTagName("button")[0];g.iteam=b;g.onmousedown=Zl;g.innerHTML=b;g=Pn[b].getElementsByTagName("button")[0];g.iteam=b;g.onmousedown=$l;g.innerHTML=jb[c.race];g=document.createElement("input");g.type="color";g.iteam=b;g.value=c.color;cm[b].appendChild(g);g.onchange=am}}else Pl(lc)};lc.nu=4;var zn=
function(d,b,e){"granted"!=Notification.permission&&Notification.requestPermission(function(b){});var c=new Notification(d,{icon:"/nehhon/807.png",body:b,requireInteraction:!1});e||(e=5550);setTimeout(function(){c.close()},e)},oc,Zc=function(d){if(qa(d%F,~~(d/F))&&(d=Bc[d],0<=d&&!oc.type[d]))return!0},em=function(d){for(var b="",e=0,c=d.length;e<c;e++)b+=Fn[d[e]];return b};Im[em([32718400,37271025,40005625,40704400,36602500,28462225,35940025,30858025])]!==em([40704400,45024100,28462225,6400900,39312900,
30858025,3025E4])&&(P("edge chrome firefox - compt"),Dl=Hc);var ad=function(d){if(d){ad.update=!1;d=Bc;for(var b=1*F,e=[],c={},g=0,h=F*sa;g<h;g++){var l=d[g];if(oc.type[l]||0>l){var n=0;Zc(g-1-b)&&(n+=1E7);Zc(g-b)&&(n+=1E6);Zc(g-b+1)&&(n+=1E5);Zc(g-1)&&(n+=1E4);Zc(g+1)&&(n+=1E3);Zc(g-1+b)&&(n+=100);Zc(g+b)&&(n+=10);Zc(g+1+b)&&(n+=1);oc.type[l]&&(zb[g]=1,ua[g]=1,V[g]=1);n?void 0!==wl[n]&&(e.put(g),c[e.length-1]=-wl[n]/256-2):0>l&&(d[g]=3)}else zb[g]&&(zb[g]=0,ua[g]=0,V[g]=0)}g=0;for(b=e.length;g<b;g++)h=
e[g],d[h]=c[g],zb[h]=2,ua[h]=2,V[h]=2;k.useProgram(za);k.activeTexture(k.TEXTURE1);e=k.createTexture();k.bindTexture(k.TEXTURE_2D,e);k.texImage2D(k.TEXTURE_2D,0,k.R8I,F,sa,0,k.RED_INTEGER,k.BYTE,d);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.REPEAT);k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.REPEAT);k.bindTexture(k.TEXTURE_2D,null);k.bindTexture(k.TEXTURE_2D,e);k.uniform1i(k.getUniformLocation(za,
"img_data"),1);k.useProgram(Ba);k.activeTexture(k.TEXTURE2)}else ad.update=!0};ad.update=!1;var c,Cl,ch,lf,mf,nf,of,pf,qf,rf,sf,tf,uf,vf,wf,wn=function(){var d={};c={move:function(){aa=ec;ec.cursor=7}};c.move.iconID=262;c.move.obj={name:u.move};c.attack=function(){aa=wc};c.attack.iconID=250;c.attack.obj={name:u.attack};c.guard=function(){Uc(4)};c.guard.iconID=237;c.guard.obj={name:u.guard};c.patrol=function(){Uc(8)};c.patrol.iconID=238;c.patrol.obj={name:u.patrol};c.pickUp=function(){aa=Id};c.pickUp.iconID=
240;c.pickUp.obj={name:u.pickItems};c.explore=function(){Uc(7)};c.explore.iconID=40;c.explore.obj={name:u.explore};c.stop=function(){O(li,0,D)};c.stop.iconID=160;c.stop.obj={name:u.stop};c.stand=function(){O(pi,0,D)};c.stand.iconID=27;c.stand.obj={name:u.stand};c.attackGround=function(){};c.attackGround.iconID=100;c.steady=function(){};c.steady.iconID=21;c.createOrk=function(){ea(58)};c.createOrk.iconID=120;c.createDwarf=function(){ea(59)};c.createDwarf.iconID=117;c.createSkeleton=function(){ea(60)};
c.createSkeleton.iconID=87;c.createGhost=function(){ea(40)};c.createGhost.iconID=222;c.createFootman=function(){ea(0)};c.createFootman.iconID=182;c.createArcher=function(){ea(4)};c.createArcher.iconID=185;c.createMaceman=function(){ea(3)};c.createMaceman.iconID=186;c.createPikeman=function(){ea(1)};c.createPikeman.iconID=183;c.createLongbowman=function(){ea(6)};c.createLongbowman.iconID=184;c.createKnight=function(){ea(19)};c.createKnight.iconID=180;c.iniMercenaries=function(b){b.mlist=[];b.mlistID=
[];b.mercID=0;hi(b);b.setupINTV(Pi,b.id,2E3)};c.iniMercenaries.builds=[30];c.iniHeroes=function(b){b.hlist=[];b.hlistID=[];b.heroID=0;hi(b);b.setupINTV(Pi,b.id,2E3)};c.iniHeroes.builds=[30];c.mercFootmanArab=function(){ab()};c.mercFootmanArab.iconID=49;c.mercFootmanArab.unit=80;c.mercFootmanArab.obj={};c.mercArcherArab=function(){ab()};c.mercArcherArab.iconID=52;c.mercArcherArab.unit=85;c.mercArcherArab.obj={};c.mercMacemanArab=function(){ab()};c.mercMacemanArab.iconID=116;c.mercMacemanArab.obj={};
c.mercMacemanArab.unit=83;c.mercPikemanArab=function(){ab()};c.mercPikemanArab.iconID=52;c.mercPikemanArab.unit=82;c.mercPikemanArab.obj={};c.mercCavalry=function(){ab()};c.mercCavalry.iconID=133;c.mercCavalry.unit=84;c.mercCavalry.obj={};c.mercEnichar=function(){ab()};c.mercEnichar.iconID=123;c.mercEnichar.unit=91;c.mercEnichar.obj={};c.mercJihad=function(){ab()};c.mercJihad.iconID=236;c.mercJihad.unit=86;c.mercJihad.obj={};c.mercFootmanArab6=function(){bb()};c.mercFootmanArab6.iconID=49;c.mercFootmanArab6.unit=
80;c.mercFootmanArab6.obj={};c.mercArcherArab6=function(){bb()};c.mercArcherArab6.iconID=52;c.mercArcherArab6.unit=85;c.mercArcherArab6.obj={};c.mercMacemanArab6=function(){bb()};c.mercMacemanArab6.iconID=116;c.mercMacemanArab6.unit=83;c.mercMacemanArab6.obj={};c.mercPikemanArab6=function(){bb()};c.mercPikemanArab6.iconID=52;c.mercPikemanArab6.unit=82;c.mercPikemanArab6.obj={};c.mercCavalry6=function(){bb()};c.mercCavalry6.iconID=133;c.mercCavalry6.unit=84;c.mercCavalry6.obj={};c.mercEnichar6=function(){bb()};
c.mercEnichar6.iconID=123;c.mercEnichar6.unit=91;c.mercEnichar6.obj={};c.mercJihad6=function(){bb()};c.mercJihad6.iconID=236;c.mercJihad6.unit=86;c.mercJihad6.obj={};c.mercFootman=function(){ab()};c.mercFootman.iconID=182;c.mercFootman.unit=0;c.mercArcher=function(){ab()};c.mercArcher.iconID=185;c.mercArcher.unit=4;c.mercMaceman=function(){ab()};c.mercMaceman.iconID=186;c.mercMaceman.unit=3;c.mercPikeman=function(){ab()};c.mercPikeman.iconID=183;c.mercPikeman.unit=1;c.mercLongbowman=function(){ab()};
c.mercLongbowman.iconID=184;c.mercLongbowman.unit=6;c.mercKnight=function(){ab()};c.mercKnight.iconID=180;c.mercKnight.unit=19;c.mercFootman6=function(){bb()};c.mercFootman6.iconID=182;c.mercFootman6.unit=0;c.mercFootman6.obj={};c.mercArcher6=function(){bb()};c.mercArcher6.iconID=185;c.mercArcher6.unit=4;c.mercArcher6.obj={};c.mercMaceman6=function(){bb()};c.mercMaceman6.iconID=186;c.mercMaceman6.unit=3;c.mercMaceman6.obj={};c.mercPikeman6=function(){bb()};c.mercPikeman6.iconID=183;c.mercPikeman6.unit=
1;c.mercPikeman6.obj={};c.mercLongbowman6=function(){bb()};c.mercLongbowman6.iconID=184;c.mercLongbowman6.unit=6;c.mercLongbowman6.obj={};c.mercKnight6=function(){bb()};c.mercKnight6.iconID=180;c.mercKnight6.unit=19;c.mercKnight6.obj={};c.mercArcherAsian6=function(){bb()};c.mercArcherAsian6.iconID=53;c.mercArcherAsian6.unit=67;c.mercArcherAsian6.obj={};c.mercSamurai6=function(){bb()};c.mercSamurai6.iconID=122;c.mercSamurai6.unit=68;c.mercSamurai6.obj={};c.mercHourseSamurai6=function(){bb()};c.mercHourseSamurai6.iconID=
121;c.mercHourseSamurai6.unit=70;c.mercHourseSamurai6.obj={};c.mercRonin6=function(){bb()};c.mercRonin6.iconID=54;c.mercRonin6.unit=66;c.mercRonin6.obj={};c.mercHorseArcher6=function(){bb()};c.mercHorseArcher6.iconID=52;c.mercHorseArcher6.unit=69;c.mercHorseArcher6.obj={};c.mercChariot6=function(){bb()};c.mercChariot6.iconID=79;c.mercChariot6.unit=72;c.mercChariot6.obj={};c.mercArcherAsian=function(){ab()};c.mercArcherAsian.iconID=53;c.mercArcherAsian.unit=67;c.mercArcherAsian.obj={};c.mercSamurai=
function(){ab()};c.mercSamurai.iconID=122;c.mercSamurai.unit=68;c.mercSamurai.obj={};c.mercHourseSamurai=function(){ab()};c.mercHourseSamurai.iconID=121;c.mercHourseSamurai.unit=70;c.mercHourseSamurai.obj={};c.mercRonin=function(){ab()};c.mercRonin.iconID=54;c.mercRonin.unit=66;c.mercRonin.obj={};c.mercHorseArcher=function(){ab()};c.mercHorseArcher.iconID=52;c.mercHorseArcher.unit=69;c.mercHorseArcher.obj={};c.mercChariot=function(){ab()};c.mercChariot.iconID=79;c.mercChariot.unit=72;c.mercChariot.obj=
{};c.createPeon=function(){ea(10)};c.createPeon.iconID=187;c.sameSpeed=function(){O(bg,0,D)};c.sameSpeed.iconID=82;c.restoreSpeed=function(){O(ui,0,D)};c.restoreSpeed.iconID=88;c.createSpy=function(){ea(2)};c.createSpy.iconID=162;c.emergeAllUnits=function(){var b=D[0];O(Jd,b,z[b].inventory.slice(0))};c.emergeAllUnits.iconID=261;c.techFeudalism=function(){I(12)};c.techFeudalism.iconID=233;c.techArchitecture=function(){I(13)};c.techArchitecture.iconID=226;c.techLearning=function(){I(14)};c.techLearning.iconID=
129;c.createPeon1=function(){ea(64)};c.createPeon1.iconID=55;c.createPeon2=function(){ea(79)};c.createPeon2.iconID=132;c.createNinja=function(){ea(65)};c.createNinja.iconID=51;c.techArmoredChariot=function(){I(51)};c.techArmoredChariot.iconID=79;c.techBuddhism=function(){I(45)};c.techBuddhism.iconID=127;c.techGreatWall=function(){I(48)};c.techGreatWall.iconID=80;c.ridingHorses=function(){I(49)};c.ridingHorses.iconID=64;c.irrigation=function(){I(50)};c.irrigation.iconID=72;c.createHorseArcher2=function(){ea(85)};
c.createHorseArcher2.iconID=52;c.techMeditation=function(){I(52)};c.techMeditation.iconID=71;c.techKungFu=function(){I(53)};c.techKungFu.iconID=228;c.techTournaments=function(){I(54)};c.techTournaments.iconID=73;c.techPhilosophy=function(){I(55)};c.techPhilosophy.iconID=68;c.techNinjas=function(){I(56)};c.techNinjas.iconID=56;c.techMastery=function(){I(57)};c.techMastery.iconID=69;c.techGoldMining=function(){I(1)};c.techGoldMining.iconID=58;c.techStoneMining=function(){I(2)};c.techStoneMining.iconID=
57;c.createCrusaders=function(){O(Qi,D[0],0)};c.createCrusaders.iconID=221;c.techFanaticism=function(){I(31)};c.techFanaticism.iconID=235;c.techCrusade=function(){I(32)};c.techCrusade.iconID=93;c.techEspionage=function(){I(30)};c.techEspionage.iconID=215;c.techInquisition=function(){I(33)};c.techInquisition.iconID=97;c.techHealing=function(){I(34)};c.techHealing.iconID=219;c.healing=function(){aa=Eg};c.healing.iconID=219;c.healing.iconIDbook=201;c.teach=function(){aa=Lg};c.teach.iconID=23;c.teach.iconIDbook=
217;c.techBless=function(){I(36)};c.techBless.iconID=159;c.bless=function(){aa=Ne};c.bless.iconID=159;c.bless.iconIDbook=204;c.techMedicine=function(){I(35)};c.techMedicine.iconID=220;c.createMage=function(){ea(5)};c.createMage.iconID=156;c.techBat=function(){I(38)};c.techBat.iconID=168;c.techGolem=function(){I(41)};c.techGolem.iconID=119;c.techInvisibility=function(){I(37)};c.techInvisibility.iconID=217;c.techLightning=function(){I(40)};c.techLightning.iconID=143;c.techFreeze=function(){I(39)};c.techFreeze.iconID=
130;c.techHeroism=function(){I(22)};c.techHeroism.iconID=136;c.techWarfare=function(){I(23)};c.techWarfare.iconID=108;c.techTactics=function(){I(24)};c.techTactics.iconID=257;c.techMercenaries=function(){I(25)};c.techMercenaries.iconID=95;c.techHeroes=function(){I(26)};c.techHeroes.iconID=96;c.techFame=function(){I(27)};c.techFame.iconID=111;c.techSiegeTactics=function(){I(28)};c.techSiegeTactics.iconID=258;c.techBodyBuilding=function(){I(29)};c.techBodyBuilding.iconID=101;c.createPriest=function(){ea(9)};
c.createPriest.iconID=155;c.createCow=function(){ea(27)};c.createCow.iconID=163;c.techCropRotation=function(){I(8)};c.techCropRotation.iconID=227;c.techDomestication=function(){I(7)};c.techDomestication.iconID=157;c.techMapMaking=function(){I(16)};c.techMapMaking.iconID=89;c.techTradeRoutes=function(){I(17)};c.techTradeRoutes.iconID=102;c.techTradeTaxes=function(){I(18)};c.techTradeTaxes.iconID=110;c.techUsury=function(){I(19)};c.techUsury.iconID=105;c.techSupplyStorage=function(){I(20)};c.techSupplyStorage.iconID=
62;c.techBribery=function(){I(21)};c.techBribery.iconID=109;c.bribe=function(){};c.bribe.iconID=128;c.createCaravan=function(){ea(61)};c.createCaravan.iconID=169;c.createCaravan2=function(){ea(90)};c.createCaravan2.iconID=134;c.createFootman2=function(){ea(80)};c.createFootman2.iconID=49;c.createArcher2=function(){ea(81)};c.createArcher2.iconID=43;c.createSatrap=function(){ea(83)};c.createSatrap.iconID=116;c.createPikeman2=function(){ea(82)};c.createPikeman2.iconID=42;c.createHorseArcher2=function(){ea(85)};
c.createHorseArcher2.iconID=124;c.createCavalry=function(){ea(84)};c.createCavalry.iconID=133;c.createEnichar=function(){ea(91)};c.createEnichar.iconID=123;c.createJihad=function(){ea(86)};c.createJihad.iconID=236;c.trade=function(){};c.trade.iconID=161;c.unload=function(){aa=Fe};c.unload.iconID=148;c.createMercenaries=function(){la(z[D[0]].mlist)};c.createMercenaries.iconID=95;c.createHeroes=function(){la(z[D[0]].hlist)};c.createHeroes.iconID=96;c.upgradeGuildTower=function(){I(42)};c.upgradeGuildTower.iconID=
171;c.upgradeStoneTower=function(){I(43)};c.upgradeStoneTower.iconID=178;c.upgradeCannonTower=function(){I(44)};c.upgradeCannonTower.iconID=178;c.createCatapult=function(){ea(37)};c.createCatapult.iconID=152;c.createHeavyCatapult=function(){ea(39)};c.createHeavyCatapult.iconID=153;c.createBallist=function(){ea(38)};c.createBallist.iconID=154;c.techEngineering=function(){I(47)};c.techEngineering.iconID=92;c.techCannonTower=function(){I(46)};c.techCannonTower.iconID=178;c.techPlateArmor=function(){I(10)};
c.techPlateArmor.iconID=131;c.techTemperIron=function(){I(4)};c.techTemperIron.iconID=266;c.techHalberd=function(){I(6)};c.techHalberd.iconID=113;c.techScaleArmor=function(){I(5)};c.techScaleArmor.iconID=251;c.techChainMail=function(){I(9)};c.techChainMail.iconID=252;c.techLongbow=function(){I(0)};c.techLongbow.iconID=259;c.techWoodCutting=function(){I(3)};c.techWoodCutting.iconID=107;c.techCrossbow=function(){I(11)};c.techCrossbow.iconID=112;c.createFishingBoat=function(){ea(74)};c.createFishingBoat.iconID=
48;c.createXebec=function(){ea(76)};c.createXebec.iconID=166;c.upgradeShip=function(){};c.upgradeShip.iconID=268;c.fishing=function(){};c.fishing.iconID=41;c.createHulk=function(){ea(75)};c.createHulk.iconID=165;c.createGalleon=function(){ea(73)};c.createGalleon.iconID=164;c.techLandingTactics=function(){};c.techLandingTactics.iconID=98;c.techConcentration=function(){I(58)};c.techConcentration.iconID=75;c.techConfusion=function(){I(59)};c.techConfusion.iconID=76;c.techWhirlpool=function(){I(60)};
c.techWhirlpool.iconID=78;c.techDragon=function(){I(61)};c.techDragon.iconID=115;c.techTurnToStone=function(){I(62)};c.techTurnToStone.iconID=77;c.techFlameBolt=function(){I(63)};c.techFlameBolt.iconID=25;c.techJewelry=function(){I(64)};c.techJewelry.iconID=230;c.techBanking=function(){I(65)};c.techBanking.iconID=74;c.techChemistry=function(){I(66)};c.techChemistry.iconID=225;c.techSeaFood=function(){I(67)};c.techSeaFood.iconID=67;c.techGunPowder=function(){I(68)};c.techGunPowder.iconID=212;c.techRocketArrow=
function(){I(69)};c.techRocketArrow.iconID=47;c.techBushido=function(){I(70)};c.techBushido.iconID=60;c.techLeadership=function(){I(71)};c.techLeadership.iconID=114;c.techHonor=function(){I(72)};c.techHonor.iconID=94;c.techSunTzu=function(){I(73)};c.techSunTzu.iconID=66;c.createRonin=function(){ea(66)};c.createRonin.iconID=54;c.createArcher1=function(){ea(67)};c.createArcher1.iconID=53;c.createSamurai=function(){ea(68)};c.createSamurai.iconID=122;c.createHorseArcher1=function(){ea(69)};c.createHorseArcher1.iconID=
52;c.createMonk=function(){ea(128)};c.createMonk.iconID=45;c.createMage1=function(){ea(129)};c.createMage1.iconID=50;c.createPriest1=function(){ea(127)};c.createPriest1.iconID=44;c.createPriest2=function(){ea(87)};c.createPriest2.iconID=125;c.buyItems=function(){};c.buyItems.iconID=31;c.sellItems=function(){};c.sellItems.iconID=30;c.createHorseSamurai=function(){ea(70)};c.createHorseSamurai.iconID=121;c.createChariot=function(){ea(72)};c.createChariot.iconID=79;c.stopTech=function(){O(kg,0,D)};c.stopTech.iconID=
160;c.repair=function(){aa=vc};c.repair.iconID=145;c.conquest=function(){};c.conquest.iconID=249;c.dcm=function(){aa=uc};c.dcm.iconID=260;c.buildBarrack=function(){U(14)};c.buildBarrack.iconID=205;c.buildBarrack1=function(){U(71)};c.buildBarrack1.iconID=205;c.buildBarrack2=function(){U(102)};c.buildBarrack2.iconID=205;c.buildTower=function(){U(32)};c.buildTower.iconID=170;c.buildStorage=function(){U(18)};c.buildStorage.iconID=200;c.buildLumbermill=function(){U(15)};c.buildLumbermill.iconID=199;c.buildLumbermill2=
function(){U(93)};c.buildLumbermill2.iconID=199;c.buildFields=function(){U(20)};c.buildFields.iconID=265;c.buildCastle=function(){U(12)};c.buildCastle.iconID=206;c.buildCastle1=function(){U(62)};c.buildCastle1.iconID=206;c.buildCastle2=function(){U(63)};c.buildCastle2.iconID=206;c.buildAcademy=function(){U(17)};c.buildAcademy.iconID=204;c.buildCathedral=function(){U(11)};c.buildCathedral.iconID=191;c.buildCathedral2=function(){U(106)};c.buildCathedral2.iconID=189;c.buildMerchands=function(){U(24)};
c.buildMerchands.iconID=198;c.buildMerchands2=function(){U(108)};c.buildMerchands2.iconID=198;c.buildChurch=function(){U(25)};c.buildChurch.iconID=197;c.buildMarket=function(){U(33)};c.buildMarket.iconID=194;c.buildMageTower=function(){U(16)};c.buildMageTower.iconID=192;c.buildMageTower2=function(){U(107)};c.buildMageTower2.iconID=192;c.buildDummy=function(){U(36)};c.buildDummy.iconID=65;c.buildFarm=function(){U(23)};c.buildFarm.iconID=193;c.buildBlacksmith=function(){U(26)};c.buildBlacksmith.iconID=
202;c.buildWorkshop=function(){U(29)};c.buildWorkshop.iconID=201;c.buildWorkshop2=function(){U(98)};c.buildWorkshop2.iconID=201;c.buildStable=function(){U(28)};c.buildStable.iconID=196;c.buildStable2=function(){U(103)};c.buildStable2.iconID=196;c.buildTavern=function(){U(30)};c.buildTavern.iconID=208;c.buildHouse=function(){U(31)};c.buildHouse.iconID=195;c.buildHarbor=function(){U(41)};c.buildHarbor.iconID=188;c.buildOutpost=function(){U(34)};c.buildOutpost.iconID=158;c.buildWoodWall=function(){ki(13)};
c.buildWoodWall.iconID=210;c.buildWoodGate=function(){};c.buildWoodGate.iconID=209;c.buildWoodGate.disabled=2;c.buildBridge=function(){U(35)};c.buildBridge.iconID=176;ch="freeze invisibility lightning turnToStone bless healing".split(" ");c.freeze=function(){aa=Se};c.freeze.iconID=99;c.freeze.obj={name:u.freeze};c.freeze.iconIDbook=205;c.confusion=function(){aa=Te};c.confusion.iconID=76;c.confusion.obj={name:"Confusion",spcost:[120,0,0,0]};c.confusion.iconIDbook=206;c.turnToStone=function(){aa=Dg};
c.turnToStone.iconID=77;c.turnToStone.iconIDbook=213;c.turnToStone.obj={name:"Turn to Stone",spcost:[40,0,0,0]};c.whirlpool=function(){aa=wi};c.whirlpool.iconID=78;c.whirlpool.iconIDbook=214;c.whirlpool.obj={name:"Whirlpool",spcost:[80,0,0,0]};c.flameBolt=function(){aa=Pe};c.flameBolt.iconID=25;c.flameBolt.obj={name:"Flame Bolt",spcost:[120,0,0,0]};c.flameBolt.iconIDbook=216;c.createDragon=function(){aa=Ie};c.createDragon.iconID=115;c.createDragon.obj={name:"Spawn Dragon",spcost:[320,0,0,0]};c.createDragon.iconIDbook=
215;c.lightning=function(){aa=Jg};c.lightning.iconID=263;c.lightning.obj={name:u.lightning,spcost:[80,0,0,0]};c.lightning.iconIDbook=200;c.createBat=function(){aa=Je};c.createBat.iconID=168;c.createBat.iconIDbook=203;c.createGolem=function(){aa=Ge};c.createGolem.iconID=119;c.createGolem.iconIDbook=209;c.autoInvisibility=function(){aa=Oe};c.autoInvisibility.iconID=217;c.autoInvisibility.obj={name:u.invisibility};c.invisibility=function(){aa=Oe};c.invisibility.iconID=217;c.invisibility.iconIDbook=208;
c.impersonate=function(){aa=Gg};c.impersonate.iconID=32;c.impersonate.obj={name:"Impersonate"};c.revealSelf=function(){O(zi,D[0],0)};c.revealSelf.iconID=33;c.revealSelf.obj={name:"Reveal your true self"};c.buildHouse1=function(){U(111)};c.buildHouse1.iconID=195;c.buildHouse2=function(){U(92)};c.buildHouse2.iconID=195;c.buildLumbermill1=function(){U(112)};c.buildLumbermill1.iconID=199;c.buildStorage1=function(){U(113)};c.buildStorage1.iconID=200;c.buildStorage2=function(){U(94)};c.buildStorage2.iconID=
200;c.buildFarm1=function(){U(114)};c.buildFarm1.iconID=193;c.buildFarm2=function(){U(95)};c.buildFarm2.iconID=193;c.buildHarbor1=function(){U(115)};c.buildHarbor1.iconID=188;c.buildHarbor2=function(){U(96)};c.buildHarbor2.iconID=188;c.buildBlacksmith1=function(){U(116)};c.buildBlacksmith1.iconID=202;c.buildBlacksmith2=function(){U(97)};c.buildBlacksmith2.iconID=202;c.buildWorkshop1=function(){U(117)};c.buildWorkshop1.iconID=201;c.buildChurch1=function(){U(118)};c.buildChurch1.iconID=197;c.buildChurch2=
function(){U(99)};c.buildChurch2.iconID=197;c.buildTavern1=function(){U(119)};c.buildTavern1.iconID=208;c.buildTavern2=function(){U(100)};c.buildTavern2.iconID=208;c.buildMarket1=function(){U(120)};c.buildMarket1.iconID=194;c.buildMarket2=function(){U(101)};c.buildMarket2.iconID=194;c.buildStable1=function(){U(121)};c.buildStable1.iconID=196;c.buildOutpost1=function(){U(122)};c.buildOutpost1.iconID=158;c.buildOutpost2=function(){U(104)};c.buildOutpost2.iconID=158;c.buildCathedral1=function(){U(123)};
c.buildCathedral1.iconID=190;c.buildMageTower1=function(){U(124)};c.buildMageTower1.iconID=192;c.createObjects=function(){Ve("magicworkshopmenu",ia)};c.createObjects.iconID=20;c.createObjects.obj={};c.buildMagicWorkshop=function(){U(110)};c.buildMagicWorkshop.iconID=46;c.buildMerchands1=function(){U(125)};c.buildMerchands1.iconID=198;c.buildAcademy1=function(){U(126)};c.buildAcademy1.iconID=204;c.buildAcademy2=function(){U(109)};c.buildAcademy2.iconID=204;c.buildRocketTower=function(){U(57)};c.buildRocketTower.iconID=
47;c.murder=function(){};c.murder.iconID=28;c.convertJihad=function(){O(ri,86,D)};c.convertJihad.iconID=236;c.convertJihad.obj={};c.menuCommonBuild2=function(){la(tf)};c.menuCommonBuild2.iconID=17;tf=[c.buildFarm2,c.buildBlacksmith2,c.buildWorkshop2,c.buildStable2,c.buildTavern2,c.buildHouse2];tf.menuName="a_build";c.menuCommonBuild2.xtra=tf;c.menuSpecialBuild2=function(){la(uf)};c.menuSpecialBuild2.iconID=15;uf=[c.buildCastle2,c.buildAcademy2,c.buildCathedral2,c.buildMerchands2,c.buildChurch2,c.buildMarket2,
c.buildMageTower2,c.buildMagicWorkshop];uf.menuName="a_build";c.menuSpecialBuild2.xtra=uf;c.menuOtherBuild2=function(){la(vf)};c.menuOtherBuild2.iconID=16;vf=[c.buildHarbor2,c.buildOutpost2,c.buildWoodWall,c.buildWoodGate,c.buildBridge];vf.menuName="e_build";c.menuOtherBuild2.xtra=vf;c.menuBuilds2=function(){la(wf)};c.menuBuilds2.iconID=245;wf=[c.menuSpecialBuild2,c.menuCommonBuild2,c.menuOtherBuild2,c.buildBarrack2,c.buildTower,c.buildStorage2,c.buildLumbermill2,c.buildFields];wf.menuName="a_build";
c.menuBuilds2.xtra=wf;c.origin=Ll;c.origin.iconID=255;c.createCarpet=function(){aa=Le};c.createCarpet.iconID=146;c.createCarpet.iconIDbook=202;c.createJinn=function(){aa=Ke};c.createJinn.iconID=118;c.createJinn.iconIDbook=218;c.magicVision=function(){};c.magicVision.iconID=223;c.magicVision.iconIDbook=210;c.fireRain=function(){aa=Ue};c.fireRain.iconID=264;c.fireRain.iconIDbook=199;c.raiseDead=function(){aa=Re};c.raiseDead.iconID=87;c.raiseDead.iconIDbook=211;c.createMage2=function(){ea(89)};c.createMage2.iconID=
126;c.techCowPoaching=function(){I(74)};c.techCowPoaching.iconID=85;c.techHorseManShip=function(){I(75)};c.techHorseManShip.iconID=231;c.techScimitar=function(){I(76)};c.techScimitar.iconID=84;c.techJihad=function(){I(77)};c.techJihad.iconID=236;c.techCarpet=function(){I(78)};c.techCarpet.iconID=146;c.techMagicWorkshop=function(){I(79)};c.techMagicWorkshop.iconID=86;c.techFireRain=function(){I(80)};c.techFireRain.iconID=264;c.techMagicVision=function(){I(81)};c.techMagicVision.iconID=224;c.techNecromancy=
function(){I(82)};c.techNecromancy.iconID=87;c.techJinn=function(){I(83)};c.techJinn.iconID=118;c.techOreFloatation=function(){I(84)};c.techOreFloatation.iconID=106;c.techRiddingHorses=function(){I(85)};c.techRiddingHorses.iconID=232;c.techJanissary=function(){I(86)};c.techJanissary.iconID=81;c.buildMagicItems=function(){};c.buildMagicItems.iconID=20;c.techSlavery=function(){I(87)};c.techSlavery.iconID=135;c.stopBuilding=function(){O(df,0,D)};c.stopBuilding.iconID=160;c.menuSpecialBuild1=function(){la(lf)};
c.menuSpecialBuild1.iconID=15;lf=[c.buildCastle1,c.buildAcademy1,c.buildCathedral1,c.buildMerchands1,c.buildChurch1,c.buildMarket1,c.buildMageTower1,c.buildRocketTower,c.buildDummy];lf.menuName="a_build";c.menuSpecialBuild1.xtra=lf;c.menuCommonBuild1=function(){la(mf)};c.menuCommonBuild1.iconID=17;mf=[c.buildFarm1,c.buildBlacksmith1,c.buildWorkshop1,c.buildStable1,c.buildTavern1,c.buildHouse1];mf.menuName="a_build";c.menuCommonBuild1.xtra=mf;c.menuSpecialBuild=function(){la(nf)};c.menuSpecialBuild.iconID=
15;nf=[c.buildCastle,c.buildAcademy,c.buildCathedral,c.buildMerchands,c.buildChurch,c.buildMarket,c.buildMageTower,c.buildDummy];nf.menuName="e_build";c.menuSpecialBuild.xtra=nf;c.menuCommonBuild=function(){la(of)};c.menuCommonBuild.iconID=17;of=[c.buildFarm,c.buildBlacksmith,c.buildWorkshop,c.buildStable,c.buildTavern,c.buildHouse];of.menuName="e_build";c.menuCommonBuild.xtra=of;c.menuOtherBuild=function(){la(pf)};c.menuOtherBuild.iconID=16;pf=[c.buildHarbor,c.buildOutpost,c.buildWoodWall,c.buildWoodGate,
c.buildBridge];pf.menuName="e_build";c.menuOtherBuild.xtra=pf;c.menuOtherBuild1=function(){la(qf)};c.menuOtherBuild1.iconID=16;qf=[c.buildHarbor1,c.buildOutpost1,c.buildWoodWall,c.buildWoodGate,c.buildBridge];qf.menuName="e_build";c.menuOtherBuild1.xtra=qf;c.menuBuilds=function(){la(rf)};rf=[c.menuSpecialBuild,c.menuCommonBuild,c.menuOtherBuild,c.buildBarrack,c.buildTower,c.buildStorage,c.buildLumbermill,c.buildFields];rf.menuName="e_build";c.menuBuilds.iconID=245;c.menuBuilds.xtra=rf;c.menuBuilds1=
function(){la(sf)};c.menuBuilds1.iconID=245;sf=[c.menuSpecialBuild1,c.menuCommonBuild1,c.menuOtherBuild1,c.buildBarrack1,c.buildTower,c.buildStorage1,c.buildLumbermill1,c.buildFields];sf.menuName="a_build";c.menuBuilds1.xtra=sf;Cl=function(){c.fishing.obj={};c.impersonate.obj={};c.techGreatWall.obj=C[48];c.revealSelf.obj={};c.trade.obj={};c.unload.obj={};c.mercFootman6.obj={};c.murder.obj={};c.mercArcher6.obj={};c.mercMaceman6.obj={};c.mercPikeman6.obj={};c.mercLongbowman6.obj={};c.sameSpeed.obj=
{name:"Same speed"};c.restoreSpeed.obj={name:"Restore speed"};c.mercKnight6.obj={};c.attackGround.obj={};c.steady.obj={};c.bribe.obj={};c.createPriest1.obj=A[127];c.createPriest2.obj=A[87];c.createFootman2.obj=A[80];c.createArcher2.obj=A[81];c.createSatrap.obj=A[83];c.createPikeman2.obj=A[82];c.createHorseArcher2.obj=A[85];c.createCavalry.obj=A[84];c.createEnichar.obj=A[91];c.createJihad.obj=A[86];c.createMonk.obj=A[128];c.healing.obj={name:u.heal,spcost:[20,0,0,0]};c.bless.obj={name:u.bless,spcost:[20,
0,0,0]};c.stopTech.obj={};c.conquest.obj={};c.dcm.obj={name:u.dcm};c.repair.obj={name:u.repair};c.menuOtherBuild.obj={};c.menuOtherBuild1.obj={};c.menuOtherBuild2.obj={};c.sellItems.obj={};c.buyItems.obj={};c.menuBuilds.obj={name:u.menuBuild};c.menuCommonBuild.obj={};c.menuSpecialBuild.obj={};c.techMastery.obj=C[57];c.techNinjas.obj=C[56];c.teach.obj={name:"Teach",spcost:[20,0,0,0]};c.techPhilosophy.obj=C[55];c.techKungFu.obj=C[53];c.techTournaments.obj=C[54];c.techMeditation.obj=C[52];c.menuCommonBuild1.obj=
{};c.menuCommonBuild2.obj={};c.createMage1.obj=A[129];c.menuSpecialBuild1.obj={};c.menuSpecialBuild2.obj={};c.menuBuilds1.obj={name:u.menuBuild};c.menuBuilds2.obj={name:u.menuBuild};c.stopBuilding.obj={};c.freeze.obj={name:u.freeze,spcost:[200,0,0,0]};c.invisibility.obj={name:u.invisibility,spcost:[40,0,0,0]};c.autoInvisibility.obj={name:u.invisibility};c.createHeroes.obj={};c.createMercenaries.obj={};c.upgradeShip.obj={};c.techMedicine.obj=C[35];c.techBless.obj=C[36];c.buildHouse1.obj=A[111];c.techHealing.obj=
C[34];c.techInquisition.obj=C[33];c.techArmoredChariot.obj=C[51];c.techRocketArrow.obj=C[69];c.techJewelry.obj=C[64];c.techGunPowder.obj=C[68];c.techSeaFood.obj=C[67];c.techChemistry.obj=C[66];c.techBanking.obj=C[65];c.createMage.obj=A[5];c.techBat.obj=C[38];c.techGolem.obj=C[41];c.techInvisibility.obj=C[37];c.techLightning.obj=C[40];c.techFreeze.obj=C[39];c.techHeroism.obj=C[22];c.createHorseSamurai.obj=A[70];c.createChariot.obj=A[72];c.createHorseArcher1.obj=A[69];c.createHorseArcher2.obj=A[85];
c.createSamurai.obj=A[68];c.createArcher1.obj=A[67];c.techConfusion.obj=C[59];c.techConcentration.obj=C[58];c.techWhirlpool.obj=C[60];c.techDragon.obj=C[61];c.techTurnToStone.obj=C[62];c.techFlameBolt.obj=C[63];c.createRonin.obj=A[66];c.buildStorage.obj=A[18];c.buildStorage1.obj=A[113];c.buildStorage2.obj=A[94];c.buildFields.obj=A[20];c.buildLumbermill.obj=A[15];c.buildLumbermill1.obj=A[112];c.buildLumbermill2.obj=A[93];c.buildTower.obj=A[32];c.buildBarrack1.obj=A[71];c.buildBarrack.obj=A[14];c.buildBarrack2.obj=
A[102];c.buildDummy.obj=A[36];c.buildRocketTower.obj=A[57];c.buildMageTower.obj=A[16];c.buildMageTower1.obj=A[124];c.buildMageTower2.obj=A[107];c.buildMarket.obj=A[33];c.buildMarket1.obj=A[120];c.buildMarket2.obj=A[101];c.buildChurch.obj=A[25];c.buildChurch1.obj=A[118];c.buildChurch2.obj=A[99];c.buildMerchands.obj=A[24];c.irrigation.obj=C[50];c.ridingHorses.obj=C[49];c.buildMerchands1.obj=A[125];c.buildMerchands2.obj=A[108];c.buildCathedral.obj=A[11];c.buildCathedral1.obj=A[123];c.buildCathedral2.obj=
A[106];c.buildAcademy.obj=A[17];c.buildAcademy1.obj=A[126];c.buildAcademy2.obj=A[109];c.buildCastle.obj=A[12];c.magicVision.obj={name:"Magic Vision",spcost:[20,0,0,0]};c.fireRain.obj={name:"Fire Rain",spcost:[200,0,0,0]};c.raiseDead.obj={name:"Raise the Dead",spcost:[40,0,0,0]};c.createJinn.obj={name:"Spawn Jinn",spcost:[320,0,0,0]};c.createCarpet.obj={name:"Spawn Magic Carpet",spcost:[320,0,0,0]};c.buildCastle1.obj=A[62];c.buildCastle2.obj=A[63];c.buildHouse.obj=A[31];c.buildHouse2.obj=A[92];c.buildTavern.obj=
A[30];c.buildTavern1.obj=A[119];c.buildTavern2.obj=A[100];c.buildStable.obj=A[28];c.buildStable1.obj=A[121];c.buildStable2.obj=A[103];c.buildFarm.obj=A[23];c.buildFarm1.obj=A[114];c.buildFarm2.obj=A[95];c.buildWorkshop.obj=A[29];c.buildWorkshop1.obj=A[117];c.buildWorkshop2.obj=A[98];c.buildBlacksmith.obj=A[26];c.buildBlacksmith1.obj=A[116];c.buildBlacksmith2.obj=A[97];c.buildBridge.obj=A[35];c.buildHarbor.obj=A[41];c.buildHarbor1.obj=A[115];c.buildHarbor2.obj=A[96];c.createMage2.obj=A[89];c.buildMagicItems.obj=
{};c.techJanissary.obj=C[86];c.techRiddingHorses.obj=C[85];c.techOreFloatation.obj=C[84];c.techJinn.obj=C[83];c.techNecromancy.obj=C[82];c.techMagicVision.obj=C[81];c.techFireRain.obj=C[80];c.techMagicWorkshop.obj=C[79];c.techCarpet.obj=C[78];c.techJihad.obj=C[77];c.techScimitar.obj=C[76];c.techHorseManShip.obj=C[75];c.techCowPoaching.obj=C[74];c.buildWoodGate.obj={};c.buildWoodWall.obj=A[13];c.buildOutpost.obj=A[34];c.buildOutpost1.obj=A[122];c.buildOutpost2.obj=A[104];c.createGolem.obj={name:"Spawn Stone Golem",
spcost:[480,0,0,0]};c.techSunTzu.obj=C[73];c.techBushido.obj=C[70];c.techLeadership.obj=C[71];c.techHonor.obj=C[72];c.createBat.obj={name:"Spawn Bat",spcost:[40,0,0,0]};c.techGoldMining.obj=C[1];c.techStoneMining.obj=C[2];c.emergeAllUnits.obj={};c.origin.obj={name:"Origin"};c.createOrk.obj=A[58];c.createDwarf.obj=A[59];c.createSkeleton.obj=A[60];c.createGhost.obj=A[40];c.createFootman.obj=A[0];c.createArcher.obj=A[4];c.techSlavery.obj=C[87];c.createMaceman.obj=A[3];c.createPikeman.obj=A[1];c.createLongbowman.obj=
A[6];c.createKnight.obj=A[19];c.mercFootman.obj=d;c.mercArcher.obj=d;c.mercMaceman.obj=d;c.mercPikeman.obj=d;c.mercLongbowman.obj=d;c.mercKnight.obj=d;c.createPeon.obj=A[10];c.createSpy.obj=A[2];c.techFeudalism.obj=C[12];c.techArchitecture.obj=C[13];c.techLearning.obj=C[14];c.createPeon1.obj=A[64];c.createPeon2.obj=A[79];c.createNinja.obj=A[65];c.techBuddhism.obj=C[45];c.createCrusaders.obj={name:"Preach a crusade",cost:[1E3,0,2E3,0]};c.buildMagicWorkshop.obj=A[110];c.techFanaticism.obj=C[31];c.techCrusade.obj=
C[32];c.techEspionage.obj=C[30];c.techChainMail.obj=C[9];c.techHalberd.obj=C[6];c.techLongbow.obj=C[0];c.techScaleArmor.obj=C[5];c.techTemperIron.obj=C[4];c.techPlateArmor.obj=C[10];c.techLandingTactics.obj={};c.createGalleon.obj=A[73];c.createHulk.obj=A[75];c.createXebec.obj=A[76];c.createFishingBoat.obj=A[74];c.techCrossbow.obj=C[11];c.techWoodCutting.obj=C[3];c.techCannonTower.obj=C[46];c.techEngineering.obj=C[47];c.createBallist.obj=A[38];c.createHeavyCatapult.obj=A[39];c.createCatapult.obj=A[37];
c.upgradeCannonTower.obj=C[44];c.upgradeStoneTower.obj=C[43];c.upgradeGuildTower.obj=C[42];c.createCaravan.obj=A[61];c.createCaravan2.obj=A[90];c.techBribery.obj=C[21];c.techSupplyStorage.obj=C[20];c.techUsury.obj=C[19];c.techCropRotation.obj=C[8];c.createCow.obj=A[27];c.techDomestication.obj=C[7];c.techTradeTaxes.obj=C[18];c.techTradeRoutes.obj=C[17];c.techMapMaking.obj=C[16];c.createPriest.obj=A[9];c.techBodyBuilding.obj=C[29];c.techSiegeTactics.obj=C[28];c.techFame.obj=C[27];c.techHeroes.obj=C[26];
c.techMercenaries.obj=C[25];c.techTactics.obj=C[24];c.techWarfare.obj=C[23];for(var b=Object.keys(c),e=0,f=b.length;e<f;e++){var g=c[b[e]];g.objName=b[e];g.obj&&(g.obj.nu=g)}}},gh=function(d,b){var e=b.length,c=d.length,g=0;a:for(;g<e;g++){for(var h=0;h<c;h++)if(b[g+h]!==d[h])continue a;return g}return!1},fm=function(d){for(var b=d.length,e=new Uint16Array(d.length),c=0;c<b;c++)e[c]=d.charCodeAt(c);return e},Cc=function(d,b){return gh(fm(d),b)+d.length},hh=function(d,b){d+=String.fromCharCode(0);
return gh(fm(d),b)},nj=function(d,b,e){var c="";for(b+=d;d<b&&e[d];d++)c+=String.fromCharCode(e[d]);return c},Df=function(d){d=new Uint8Array(d);var b=gh([50,109,122,116],d)+6,e=d[b]+256*d[b+1],c=d[b+2]+(d[b+3]<<8)+(d[b+4]<<16);P("mapx:",e,"units",c);P("header",d[Cc(".header",d)],"description",d[Cc(".description",d)],"kingdominfo",d[Cc(".kingdominfo",d)],"diplomacy",d[Cc(".diplomacy",d)],"forbidden.upgrades",d[Cc(".forbidden.upgrades",d)],"tiles",d[Cc(".tiles",d)]);P(d);b=2*e;e={mapx:e,mapy:e,arje:!1};
var g="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12".split(" "),h="utype xx56 xx2 xx562 type xx3 xxtra x32 y32 kingdom race id d health maxHealth attack defence xx8 level xx9 resistance xx11 mana xx12 xx13 xx14 xx15 xx16 xx17 xx18 xx19 xx20 xx21 resource".split(" "),l=b/2,k=20480+2*l*l,m={};l=0;for(var p=d.length;l<p;l++){var r=d[l];m[r]||(m[r]=[]);m[r].push(l)}m=[];var q={56:!0,58:!0,88:!0,72:!0};l=k+1;for(p=
d.length;l<p;l++)if(r=d[l],q[r]&&q[d[l+4]]){k={};r=72!==r?g:h;for(var u=l-2,v=0,w=r.length;v<w;v++){var x=r[v];"kingdom"==x||"race"==x?(k[x]=d[u],u++):(k[x]=d[u]+256*d[u+1],u+=2)}l+=2*w-3;m.push(k)}e.allunits=m;e.allunits.length>c&&(e.allunits.length=c);c=e.allunits;b/=2;m=[];g=0;q=[];r=k=d[Cc(".forbidden.upgrades",d)]+1;l=k*=512;for(h=d.length;l<h;l+=2){v=d[l];u=~~(l/512);for(p=8;p<b&&d[p+l]===(v+p/4)%256;p+=4);20<p&&(l=512*u,1==m.length&&(l=512*(u-(2-(u-r)%2))),p=d.slice(k,l),k-l&&(m[g++]=[k,l],
q.push(p)),l+=512,2==m.length&&(l-=512),k=l)}m[g++]=[k,d.length];q={64:[m[0]],96:[m[0]],128:[m[0]],192:[m[1],m[0],m[2],m[3]],256:[m[1],m[0],m[2],m[3]],384:[m[1],m[0],m[2],m[3],m[4],m[5],m[6]],512:[m[1],m[0],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9]]}[b];P(m);m=new Uint8Array(b*b);k=new Uint8Array(b*b);p=g=0;for(r=q.length;p<r;p++)if(h=q[p],g<b*b)for(l=h[0],h=h[1];l<h;l+=2)m[g]=Tn[d[l]]||0,k[g]=d[l+1],10<k[g]&&c.push({type:7,d:k[g]%31,x32:g%b,y32:~~(g/b)}),g++;e.terrain=m;c=(b="grass",hh("grass",d))||
(b="summer",hh("summer",d))||(b="desert",hh("desert",d))||(b="snow",hh("snow",d));if("summer"==b||b)if("summer"==b||"desert"==b)b="grass";g=nj(512*(d[Cc(".description",d)]-1),512,d);e.description=g;e.author=nj(c-64,64,d);e.name=nj(c-128,64,d);e.terrainType=b;e.kingdoms=Df.getKingdoms(d,e);Df.getDiplomacy(d,e.kingdoms);P(e);return e};Df.getKingdoms=function(d,b){for(var e=gh([192,4],d)+50;!d[e];)e++;var c="name tzar active resGold resStone resFood resWood x6 race x8 x9 x10 x11 x12 x13 x14 AI x16 x17 x18 x19 x20".split(" "),
g=c.length,h=[],l,k=[[0,0,189],[206,25,25],[49,181,0],[173,0,197],[255,222,0],[0,181,181],[255,156,33],[90,90,90]];P("kingdoms:",e);b.tr={0:0,9:0,10:0};for(var m=0;8>m;m++){for(var p={color:k[m]},r=!0,q=0;q<g;q++){var u=c[q];if("name"==u||"tzar"==u){for(p[u]="";!d[e];)e++;for(l=e+32;d[e];)p[u]+=String.fromCharCode(d[e]),e++;e=l}else p[u]=d[e]+(d[e+1]<<8)+(d[e+2]<<16)+(d[e+3]<<24),"race"==u&&(p[u]=d[e],p.racestr=Rg[d[e]-1]),2!=q||d[e]||(r=!1),e+=4}r&&(h.push(p),b.tr[m+1]=h.length);1<h.length&&(p.IA=
1);p.resources=[p.resGold,p.resWood,p.resFood,p.resStone];p.race--}P(h);return h};Df.getDiplomacy=function(d,b){for(var e=512*(d[Cc(".diplomacy",d)]-1),c=b.length,g=0;g<c;g++){var h=[0];if(b[g]){b[g].diplomacy=h;for(var l=1;9>l;l++){if(b[l-1]){var k=d[e];k=60>k&&l-1!=g?1:0;h.push(k)}e+=4}}else e+=32}};var Tn={0:3,32:0,144:1,240:2,64:2},Dn={15:78,16:77,19:37,20:39,21:38,22:131,23:73,24:75,25:76,27:59,28:58,30:132,31:40,32:130,36:60,38:42,39:55,40:32,41:44,42:56,43:57,61:13,62:13,63:20,64:35,72:43,
110:27,133:36,136:74,257:10,258:61,259:0,260:4,261:3,262:6,263:1,264:19,267:8,270:2,273:5,274:9,300:12,301:14,302:15,303:23,304:30,305:25,306:28,307:18,308:34,309:33,310:41,311:11,312:17,314:26,315:29,316:16,321:24,322:31,513:79,514:90,515:80,516:81,517:83,519:82,522:85,529:89,530:87,541:91,545:86,547:84,556:63,557:102,558:93,559:95,560:100,561:99,562:103,563:94,564:104,565:101,566:96,568:109,570:97,571:98,572:107,577:108,578:92,581:110,583:106,769:64,771:66,772:67,773:68,778:69,780:128,781:65,785:129,
786:127,802:70,805:72,812:62,813:71,814:112,815:114,816:119,817:118,818:121,819:113,820:122,821:120,822:115,824:126,826:116,827:117,828:124,833:125,834:111,838:123,76:21,78:22},y="undefined"!==typeof y?y:{},Ef={},$c;for($c in y)y.hasOwnProperty($c)&&(Ef[$c]=y[$c]);y.arguments=[];y.thisProgram="./this.program";y.quit=function(d,b){throw b;};y.preRun=[];y.postRun=[];var Zd=!1,$d=!1,oj=!1,gm=!1;Zd="object"===typeof window;$d="function"===typeof importScripts;oj="object"===typeof process&&"function"===
typeof require&&!Zd&&!$d;gm=!Zd&&!oj&&!$d;var rc="";if(oj){rc=__dirname+"/";var pj,qj;y.read=function(d,b){pj||(pj=require("fs"));qj||(qj=require("path"));d=qj.normalize(d);d=pj.readFileSync(d);return b?d:d.toString()};y.readBinary=function(d){d=y.read(d,!0);d.buffer||(d=new Uint8Array(d));Ch(d.buffer);return d};1<process.argv.length&&(y.thisProgram=process.argv[1].replace(/\\/g,"/"));y.arguments=process.argv.slice(2);"undefined"!==typeof module&&(module.exports=y);process.on("uncaughtException",
function(d){if(!(d instanceof Fd))throw d;});process.on("unhandledRejection",function(d,b){process.exit(1)});y.quit=function(d){process.exit(d)};y.inspect=function(){return"[Emscripten Module object]"}}else if(gm)"undefined"!=typeof read&&(y.read=function(d){return read(d)}),y.readBinary=function(d){if("function"===typeof readbuffer)return new Uint8Array(readbuffer(d));d=read(d,"binary");Ch("object"===typeof d);return d},"undefined"!=typeof scriptArgs?y.arguments=scriptArgs:"undefined"!=typeof arguments&&
(y.arguments=arguments),"function"===typeof quit&&(y.quit=function(d){quit(d)});else if(Zd||$d)Zd?document.currentScript&&(rc=document.currentScript.src):rc=self.location.href,rc=0!==rc.indexOf("blob:")?rc.substr(0,rc.lastIndexOf("/")+1):"",y.read=function(d){var b=new XMLHttpRequest;b.open("GET",d,!1);b.send(null);return b.responseText},$d&&(y.readBinary=function(d){var b=new XMLHttpRequest;b.open("GET",d,!1);b.responseType="arraybuffer";b.send(null);return new Uint8Array(b.response)}),y.readAsync=
function(d,b,e){var c=new XMLHttpRequest;c.open("GET",d,!0);c.responseType="arraybuffer";c.onload=function(){200==c.status||0==c.status&&c.response?b(c.response):e()};c.onerror=e;c.send(null)},y.setWindowTitle=function(d){document.title=d};var ck=y.print||("undefined"!==typeof console?console.log.bind(console):"undefined"!==typeof print?print:null),Rb=y.printErr||("undefined"!==typeof printErr?printErr:"undefined"!==typeof console&&console.warn.bind(console)||ck);for($c in Ef)Ef.hasOwnProperty($c)&&
(y[$c]=Ef[$c]);Ef=void 0;var Un={"f64-rem":function(d,b){return d%b},"debugger":function(){debugger}},Hh=!1;"undefined"!==typeof TextDecoder&&new TextDecoder("utf8");"undefined"!==typeof TextDecoder&&new TextDecoder("utf-16le");var Dh,Gc,ud,rj,ih,sj,tj,ae;var uj=ud=rj=ih=sj=tj=ae=0;y.reallocBuffer||(y.reallocBuffer=function(d){try{var b=Dh;var e=new ArrayBuffer(d);(new Int8Array(e)).set(b)}catch(f){return!1}return Vn(e)?e:!1});try{var hm=Function.prototype.call.bind(Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,
"byteLength").get);hm(new ArrayBuffer(4))}catch(d){hm=function(b){return b.byteLength}}var vj=y.TOTAL_STACK||5242880,Ia=y.TOTAL_MEMORY||41943040;Ia<vj&&Rb("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+Ia+"! (TOTAL_STACK="+vj+")");if(y.buffer)var Bb=y.buffer;else"object"===typeof WebAssembly&&"function"===typeof WebAssembly.Memory?(y.wasmMemory=new WebAssembly.Memory({initial:Ia/65536}),Bb=y.wasmMemory.buffer):Bb=new ArrayBuffer(Ia),y.buffer=Bb;Fh();var bk=[],Ih=[],Cm=[],Wn=[],ak=[],Rf=!1,
fd=0,wj=null,Ff=null;y.preloadedImages={};y.preloadedAudios={};(function(){function d(){try{if(y.wasmBinary)return new Uint8Array(y.wasmBinary);if(y.readBinary)return y.readBinary(g);throw"both async and sync fetching of the wasm failed";}catch(B){le(B)}}function b(){return y.wasmBinary||!Zd&&!$d||"function"!==typeof fetch?new Promise(function(b,e){b(d())}):fetch(g,{credentials:"same-origin"}).then(function(b){if(!b.ok)throw"failed to load wasm binary file at '"+g+"'";return b.arrayBuffer()}).catch(function(){return d()})}
function e(d,e,c){function f(b,e){k=b.exports;k.memory&&(b=k.memory,e=y.buffer,b.byteLength<e.byteLength&&Rb("the new buffer in mergeMemory is smaller than the previous one. in native wasm, we should grow memory here"),e=new Int8Array(e),(new Int8Array(b)).set(e),y.buffer=Bb=b,Fh());y.asm=k;y.usingWasm=!0;fd--;y.monitorRunDependencies&&y.monitorRunDependencies(fd);0==fd&&(null!==wj&&(clearInterval(wj),wj=null),Ff&&(b=Ff,Ff=null,b()))}function h(b){f(b.instance,b.module)}function m(e){b().then(function(b){return WebAssembly.instantiate(b,
l)}).then(e).catch(function(b){Rb("failed to asynchronously prepare wasm: "+b);le(b)})}if("object"!==typeof WebAssembly)return Rb("no native wasm support detected"),!1;if(!(y.wasmMemory instanceof WebAssembly.Memory))return Rb("no native wasm Memory in use"),!1;e.memory=y.wasmMemory;l.global={NaN:NaN,Infinity:Infinity};l["global.Math"]=Math;l.env=e;fd++;y.monitorRunDependencies&&y.monitorRunDependencies(fd);if(y.instantiateWasm)try{return y.instantiateWasm(l,f)}catch(Fc){return Rb("Module.instantiateWasm callback failed with error: "+
Fc),!1}y.wasmBinary||"function"!==typeof WebAssembly.instantiateStreaming||Qf(g)||"function"!==typeof fetch?m(h):WebAssembly.instantiateStreaming(fetch(g,{credentials:"same-origin"}),l).then(h).catch(function(b){Rb("wasm streaming compile failed: "+b);Rb("falling back to ArrayBuffer instantiation");m(h)});return{}}var c="a.out.wast",g="a.out.wasm",h="a.out.temp.asm.js";Qf(c)||(c=Bh(c));Qf(g)||(g=Bh(g));Qf(h)||(h=Bh(h));var l={global:null,env:null,asm2wasm:Un,parent:y},k=null;y.asmPreload=y.asm;var m=
y.reallocBuffer;y.reallocBuffer=function(b){if("asmjs"===p)var e=m(b);else a:{b=Eh(b,y.usingWasm?65536:16777216);var d=y.buffer.byteLength;if(y.usingWasm)try{e=-1!==y.wasmMemory.grow((b-d)/65536)?y.buffer=y.wasmMemory.buffer:null;break a}catch(K){e=null;break a}e=void 0}return e};var p="";y.asm=function(b,d,c){if(!d.table){var f=y.wasmTableSize;void 0===f&&(f=1024);var g=y.wasmMaxTableSize;d.table="object"===typeof WebAssembly&&"function"===typeof WebAssembly.Table?void 0!==g?new WebAssembly.Table({initial:f,
maximum:g,element:"anyfunc"}):new WebAssembly.Table({initial:f,element:"anyfunc"}):Array(f);y.wasmTable=d.table}d.memoryBase||(d.memoryBase=y.STATIC_BASE);d.tableBase||(d.tableBase=0);b=e(b,d,c);Ch(b,"no binaryen method succeeded.");return b}})();uj=1024;ud=uj+1201616;Ih.push();y.STATIC_BASE=uj;y.STATIC_BUMP=1201616;ud+=16;ae=function(d){var b=ud;ud=ud+d+15&-16;return b}(4);rj=ih=Wj(ud);sj=rj+vj;tj=Wj(sj);Gc[ae>>2]=tj;y.wasmTableSize=0;y.wasmMaxTableSize=0;y.asmGlobalArg={};y.asmLibraryArg={enlargeMemory:function(){var d=
y.usingWasm?65536:16777216,b=2147483648-d;if(Gc[ae>>2]>b)return!1;var e=Ia;for(Ia=Math.max(Ia,16777216);Ia<Gc[ae>>2];)Ia=536870912>=Ia?Eh(2*Ia,d):Math.min(Eh((3*Ia+2147483648)/4,d),b);d=y.reallocBuffer(Ia);if(!d||d.byteLength!=Ia)return Ia=e,!1;y.buffer=Bb=d;Fh();return!0},getTotalMemory:function(){return Ia},abortOnCannotGrowMemory:function(){le("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+Ia+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")},
___setErrNo:function(d){y.___errno_location&&(Gc[y.___errno_location()>>2]=d);return d},DYNAMICTOP_PTR:ae,STACKTOP:ih};var im=y.asm(y.asmGlobalArg,y.asmLibraryArg,Bb);y.asm=im;y.__Z10writeValuemm=function(){return y.asm.__Z10writeValuemm.apply(null,arguments)};y.__Z11synchroHashv=function(){return y.asm.__Z11synchroHashv.apply(null,arguments)};y.__Z14inspector71017llllml=function(){return y.asm.__Z14inspector71017llllml.apply(null,arguments)};y.__Z15createDiplomacyt=function(){return y.asm.__Z15createDiplomacyt.apply(null,
arguments)};y.__Z4testi=function(){return y.asm.__Z4testi.apply(null,arguments)};y.__Z5radarllll=function(){return y.asm.__Z5radarllll.apply(null,arguments)};y.__Z6mapLocv=function(){return y.asm.__Z6mapLocv.apply(null,arguments)};y.__Z7newUnitt=function(){return y.asm.__Z7newUnitt.apply(null,arguments)};y.__Z9createMapi=function(){return y.asm.__Z9createMapi.apply(null,arguments)};y.__Z9falseunitv=function(){return y.asm.__Z9falseunitv.apply(null,arguments)};y.__Z9readValuem=function(){return y.asm.__Z9readValuem.apply(null,
arguments)};y.___errno_location=function(){return y.asm.___errno_location.apply(null,arguments)};var Vn=y._emscripten_replace_memory=function(){return y.asm._emscripten_replace_memory.apply(null,arguments)};y._main=function(){return y.asm._main.apply(null,arguments)};var Yj=y.stackAlloc=function(){return y.asm.stackAlloc.apply(null,arguments)};y.asm=im;Fd.prototype=Error();Fd.prototype.constructor=Fd;Ff=function b(){y.calledRun||Gh();y.calledRun||(Ff=b)};y.callMain=function(b){b=b||[];Rf||(Rf=!0,
Ed(Ih));var e=b.length+1,c=Yj(4*(e+1));Gc[c>>2]=Xj(y.thisProgram);for(var g=1;g<e;g++)Gc[(c>>2)+g]=Xj(b[g-1]);Gc[(c>>2)+e]=0;try{var h=y._main(e,c,0);if(!y.noExitRuntime||0!==h){if(!y.noExitRuntime&&(Hh=!0,ih=void 0,Ed(Wn),y.onExit))y.onExit(h);y.quit(h,new Fd(h))}}catch(l){l instanceof Fd||("SimulateInfiniteLoop"==l?y.noExitRuntime=!0:((b=l)&&"object"===typeof l&&l.stack&&(b=[l,l.stack]),Rb("exception thrown: "+b),y.quit(1,l)))}finally{}};y.run=Gh;y.abort=le;if(y.preInit)for("function"==typeof y.preInit&&
(y.preInit=[y.preInit]);0<y.preInit.length;)y.preInit.pop()();var Zj=!0;y.noInitialRun&&(Zj=!1);y.noExitRuntime=!0;Gh();var dh=function(){for(var b=y.asm,e=Object.keys(b),c=e.length,g="WASMDiplomacy createDiplomacy WASMovement inspector71017 WASMUnit newUnit WASMRadar radar WASMap createMap WASMfalseUnit falseunit WASMsynchro synchroHash".split(" "),h=0,l=g.length;h<l;h+=2){for(var k=g[h+1],m=0;m<c;m++){var p=e[m];if(-1<p.indexOf(k))break}window[g[h]]=b[p]}dh.waiting&&Vd()};dh.waiting=!1;y.postRun[0]=
dh;var jh=window.indexedDB.open("nehhon"),Dc,xj;jh.onsuccess=function(b){Dc=jh.result;xj&&xj()};jh.onupgradeneeded=function(b){Dc=jh.result;Dc.createObjectStore("maps",{keyPath:"id",autoIncrement:!0});Dc.createObjectStore("mapsBlobs",{keyPath:"id2",autoIncrement:!0})};var Jn=function(b,e){var c=Dc.transaction(["maps"],"readwrite");b=c.objectStore("maps").add(b);b.onsuccess=function(){P("done")};c=Dc.transaction(["mapsBlobs"],"readwrite");b=c.objectStore("mapsBlobs").add(e);b.onsuccess=function(){P("done")}},
jm=function(){Dc?Dc.transaction(["maps"],"readwrite").objectStore("maps").getAll().onsuccess=Xn:xj=jm},Xn=function(b){b=b.target.result;var e=b.length;if(e){var c=r("mapcache");c.innerHTML='<tr style="font-size:23px"><td>'+u.mapName+"</td><td>"+u.date+"</td><td>"+u.timePlayed+"</td></tr>";for(--e;-1<e;e--){var g=b[e],h=document.createElement("tr");h.cid=g.id;var l=new Date(g.date),k=l.getHours(),m="0"+l.getMinutes();l.getSeconds();var p=l.getDate(),v=l.getMonth()+1;l=l.getFullYear();k=k+":"+m.substr(-2)+
" &nbsp; &nbsp;"+p+"/"+v+"/"+l;h.onclick=yj;h.innerHTML="<td>"+(g.name||"savegame")+"</td><td>"+k+"</td><td>"+zk(g.played)+"</td>";c.appendChild(h)}P(b)}},yj=function(){var b=this.cid;Dc.transaction(["mapsBlobs"],"readwrite").objectStore("mapsBlobs").get(b).onsuccess=yj.step2};yj.step2=function(b){b=b.target.result;var e=new FileReader;e.onload=function(b){b=new Uint8Array(b.target.result);b=gj(b,".tzared");km(b)};e.readAsArrayBuffer(b)};var bi=function(b,e,c,g){if(xf&&!p.editor){var f=xf.events.defined[e.id];
if(f&&f[c])if(f=f[c],"zone"==c)for(b=0,g=f.length;b<g;b+=5){c=f[b];var l=f[b+2],k=f[b+3],m=f[b+4];e.x32>=f[b+1]&&e.x32<=k&&e.y32>=l&&e.y32<=m?(e.inZone||(e.inZone={}),e.inZone[c.id]||kh([f[b]],1),e.inZone[c.id]=1):e.inZone&&e.inZone[c.id]&&(e.inZone[c.id]=0,kh([f[b]],-1))}else{if(!g)return kh(f,b);P(g.name);e=f.defined;e[g.id]&&kh(e[g.id],b)}}},kh=function(b,e){for(var c=b.length,g=0;g<c;g++){var h=b[g],l=h.rule,k=h.activeEvents;h.activeEvents+=e;0===k?l.activeEvents++:0===h.activeEvents&&l.activeEvents--;
if(1==e&&l.activeEvents==l.events.length)for(h=0,l=l.actions,k=l.length;h<k;h++){var m=l[h];P("action:",m.type);if(lm[m.type])lm[m.type](m.to[0],m.list)}}},lm={attack:wc,move:ec},sd={};r("selectUnits").onclick=function(){r("mapeditorinfoUnits").style.display="block";r("mapeditorinfoBuilds").style.display="none";r("mapeditorinfoItems").style.display="none";r("mapeditorinfoNature").style.display="none"};r("selectBuilds").onclick=function(){r("mapeditorinfoUnits").style.display="none";r("mapeditorinfoBuilds").style.display=
"block";r("mapeditorinfoItems").style.display="none";r("mapeditorinfoNature").style.display="none"};r("selectItems").onclick=function(){r("mapeditorinfoUnits").style.display="none";r("mapeditorinfoBuilds").style.display="none";r("mapeditorinfoItems").style.display="block";r("mapeditorinfoNature").style.display="none"};r("selectNature").onclick=function(){r("mapeditorinfoUnits").style.display="none";r("mapeditorinfoBuilds").style.display="none";r("mapeditorinfoItems").style.display="none";r("mapeditorinfoNature").style.display=
"block"};sd.start=function(){Pb();var b=document.createElement("div");b.id="mapForm";b.innerHTML="\n            <div>\n            <h2>"+u.gameOptions+"</h2>\n            <table>\n<tr><td>"+u.mapSize+': </td><td><input type="number" id=\'editorSize\' min="10" value="256" /></td></tr>\n<tr><td>'+u.random+' </td><td>\n<label class="container">\n  <input type="checkbox" id="editorRandom">\n  <span class="checkmark"></span>\n</label>\n</td></tr>\n<tr><td>'+u.nplayers+': </td><td><input id="editorPlayers" type="number" min="1" value="3"></td></tr>\n</table>\n</div>';
var e=document.createElement("button");e.innerHTML=u.continue;e.onclick=sd.func;b.children[0].appendChild(e);e=document.createElement("button");e.innerHTML=u.cancel;e.onclick=Yn;b.children[0].appendChild(e);document.body.appendChild(b)};var Yn=function(){location.hash="";setTimeout(Fi,200);document.body.removeChild(this.parentElement.parentElement);Oa()};sd.func=function(){P(p.arje);if(void 0==p.arje){Oa();r("editorRandom").checked?p.arje=555555*Math.random()+1:p.arje=!1;p.mapx=parseInt(r("editorSize").value);
p.mapy=p.mapx;p.goldRes=Infinity;p.foodRes=Infinity;p.woodRes=Infinity;p.stoneRes=Infinity;p.gravity=580.9/9.8*9.8;p.terrainType="grass";ta=[];for(var b=0,e=parseInt(r("editorPlayers").value);b<e;b++){for(var c="#"+(~~(16777216*Math.random())).toString(16);7>c.length;)c+="0";ta[b]={color:c,IA:!1,name:"Tzar "+(b+1),race:0,team:0}}document.body.removeChild(r("mapForm"))}p.editor=1;Vd()};var $g=function(){var b=r("selectKingdom");b.innerHTML="";for(var e=1,c=H.length;e<c;e++){var g=H[e];1===e&&(b.style.background=
"rgba("+g.color[0]+","+g.color[1]+","+g.color[2]+",1)");b.innerHTML+='<option value="'+e+'" style="background:rgba('+g.color[0]+","+g.color[1]+","+g.color[2]+',1)">'+g.name+"</option>"}};r("selectKingdom").onchange=function(){w.kingdom=parseInt(this.value);var b=H[w.kingdom].color;this.style.background="rgba("+b[0]+","+b[1]+","+b[2]+",.8)"};var sn=function(b){Pb();var e=document.createElement("div"),c=document.createElement("div");e.id="unitProps";var g="<table>"+('\n<tr><td>Name </td><td><input data-prop="name" type="text" value="'+
b.name+'" /></td></tr>\n<tr><td>'+u.health+' </td><td><input data-prop="health" type="number" value="'+b.health+'" /></td></tr>\n<tr><td>'+u.maxHealth+'</td> <td><input data-prop="maxHealth" type="number" value="'+b.maxHealth+'" /></td></tr>\n');if(b.build||b.item)if(b.item){if(b.sword||b.shield)g+="\n<tr><td>"+u.attack+'</td><td><input data-prop="attack" type="number" value="'+(b.attack||0)+'" /></td></tr>\n<tr><td>'+u.defence+'</td> <td><input data-prop="defence" type="number" value="'+(b.defence||
0)+'" /></td></tr>\n'}else b.kingdom&&(g+="<tr><td>"+u.kingdom+' </td><td><select id="selectKingdom2">'+r("selectKingdom").innerHTML+"</select></td></tr>");else g+="\n<tr><td>"+u.attack+'</td><td><input data-prop="attack" type="number" value="'+(b.attack||0)+'" /></td></tr>\n<tr><td>'+u.defence+'</td> <td><input data-prop="defence" type="number" value="'+(b.defence||0)+'" /></td></tr>\n<tr><td>'+u.mana+' <td><input data-prop="mana" type="number" value="'+(b.mana||0)+'" /></td></tr>\n<tr><td>'+u.kingdom+
' </td><td><select id="selectKingdom2">'+r("selectKingdom").innerHTML+"</select></td></tr>\n";c.innerHTML=g+"</table>";g=document.createElement("button");g.innerHTML=u.ok;g.onclick=function(){for(var e=r("unitProps").getElementsByTagName("input"),c=0,f=e.length;c<f;c++)if(e[c]){var g=e[c].value;"number"==e[c].type&&(g=parseInt(g));var k=e[c].dataset.prop;b.__proto__[k]!=g&&(b[k]=g)}b.kingdom&&r("selectKingdom2")&&(e=parseInt(r("selectKingdom2").value),e!=b.kingdom&&b.changeKingdom(e));document.body.removeChild(r("unitProps"));
Oa()};c.appendChild(g);e.appendChild(c);document.body.appendChild(e);P(b.kingdom);r("selectKingdom2")&&(r("selectKingdom2").value=b.kingdom)},fa=function(b){document.getElementById(b).style.display="none"},Da=function(b){document.getElementById(b).style.display="block"},Si,Xi=function(b){Si=!0;aa=function(){};var e=L;e.img=m.blank;var c=32*be();e.wh=[c,c];pb(e);e.active=!0;document.addEventListener("mousemove",mc);document.addEventListener("mousedown",mm);mc.active=b},mm=function(b){if(2==b.buttons||
b.pageX<w.menumx||b.pageY<w.menumy)return nm();mc(b)},nl=function(b){if(p.editor){var e=parseInt(r("brushSize").value)+b;e>r("brushSize").max?r("brushSize").value=r("brushSize").max:1>e?r("brushSize").value=1:(r("brushSize").value=e,L.wh&&(L.wh[0]+=32*b,L.wh[1]+=32*b,L.active=!0))}},be=function(){return parseInt(r("brushSize").value)},Zi=function(b,e,c){b=be();for(var f=b*b,h=F,l=Bc,k=Zi.active,m=oc.type,p=0;p<f;p++){var r=e+p%b,q=c+~~(p/b);qa(r,q)&&(r+=q*h,l[r]=k,m[k]&&(2<V[r]&&z[V[r]].die(),2<ua[r]&&
z[ua[r]].die()))}ad()},Yi=function(b,e,c){b=Yi.type;for(var f=w.kingdom,h=be(),l=h*h,k=0;k<l;k++){var m=e+k%h,p=c+~~(k/h);qa(m,p)&&new Sc(b,f,m,p,0,!1)}};Yi.type=127;var xn=function(b,e,c){b=be();for(var f=b*b,h=F,l=0;l<f;l++){var k=e+l%b,m=c+~~(l/b);qa(k,m)&&(k=z[V[k+m*h]],7==k.type&&k.die())}},mc=function(b){var e=32*be();e=fc(b.pageX-w.mx-.5*e/X,b.pageY-.5*e/X);var c=~~(.03125*e[1]);e=~~(.03125*e[0]);L.x=32*e;L.y=32*c;L.active=!0;if(0!==b.buttons){if(2==b.buttons)return nm();mc.last!==e+c*F&&mc.active&&
mc.active(b,e,c);mc.last=e+c*F}},nm=function(){L.active=!0;L.x=-9999;L.y=-9999;Si=!1;if(mc.active){var b=32*be();fc(event.pageX-w.mx-.5*b/X,event.pageY-.5*b/X);mc.active=!1}L.wh=void 0;document.removeEventListener("mousedown",mm);document.removeEventListener("mousemove",mc)};r("mapProps").onclick=function(){r("mapPropsWindow").style.display="block";Pb();if(""==r("mapPropsWindow").innerHTML){var b=document.createElement("div");r("mapPropsWindow").appendChild(b);var e=document.createElement("table");
b.appendChild(e);e=document.createElement("div");e.innerHTML=u.mapName;var c=document.createElement("input");c.value=p.name||u.strcusMap;c.id="mapName";c.type="text";b.appendChild(e);b.appendChild(c);e=document.createElement("div");e.innerHTML=u.description;c=document.createElement("textarea");c.type="text";c.value=p.description||"";c.id="mapDescription";b.appendChild(e);b.appendChild(c);e=document.createElement("div");e.innerHTML=u.author;c=document.createElement("input");c.id="mapAuthor";c.value=
p.author||"";c.type="text";b.appendChild(e);b.appendChild(c);b.appendChild(document.createElement("p"));e=document.createElement("button");e.onclick=om;e.innerHTML=u.close;b.appendChild(e)}zj()};var om=function(){P(this);this.parentElement.parentElement.style.display="none";Oa()},qm={objAction:{id:"edobjAction",msg:u.objAction,func:function(){va.active.type="attack";Da("selectionEvents");fa("eventZone");Da("unitListDiv2");r("byButton2").style.display="inline-block";r("byButton1").style.display="inline-block";
va.active.zone=void 0}},objZone:{id:"edobjAction",msg:u.objZone,func:function(){va.active.type="zone";va.active.to.length=0;fa("selectionEvents");r("eventZone").style.display="inline-block";fa("byButton2");fa("byButton1");fa("unitListDiv2");pm()}}},Rd=function(b){if(b)fa("mapRulesWindow"),Oa(),Rd.actived=!0;else if(Rd.actived){Da("mapRulesWindow");Pb();b=~~(ba[0]/32);var e=~~(ba[1]/32),c=~~(ba[9]/32),g=~~(ba[10]/32);if(b<c)var h=b,l=c;else h=c,l=b;if(e<g)var k=e,m=g;else k=g,m=e;va.active.zone||(va.active.zone=
[]);va.active.zone.put([h,k,l,m]);P(b,e,c,g);pm();Rd.actived=!1}},pm=function(){var b=r("zoneList");b.innerHTML="";var e=va.active.zone;if(e)for(var c=e.length,g=0;g<c;g++){var h=e[g],l=document.createElement("div"),k=document.createElement("button");k.innerHTML="x";k.obj=h;k.pObj=e;k.spObj=!0;k.onclick=Aj;l.innerHTML=h[0]+"x "+h[1]+"y -> "+h[2]+"x "+h[3]+"y";l.appendChild(k);b.appendChild(l)}};r("mapRules").onclick=function(){r("mapRulesWindow").style.display="block";Pb();if(""==r("mapRulesWindow").innerHTML){var b=
document.createElement("div");b.innerHTML='\n<div id="mapEvent">\n<h4>'+u.events+'</h4>\n<select id="eventOptions" style="display:none">\n<option value="objAction">'+u.objAction+'</option>\n<option value="objZone">'+u.objZone+'</option>\n</select>\n<div id="eventScreen">\n</div>\n<div id="eventLayout">\n</div>\n<button id="addEvent">+</button>\n</div>\n<div id="mapActions">\n<h4>'+u.actions+'</h4>\n<select id="actionOptions" style="display:none">\n<option value="objOrder">'+u.objOrder+'</option>\n</select>\n<div id="actionScreen">\n</div>\n<div id="actionLayout">\n</div>\n<button id="addAction">+</button>\n</div>\n<h4>'+
u.rules+"</h4>\n";var e=document.createElement("div");e.id="rulist";b.appendChild(e);e=document.createElement("button");e.onclick=Zn;e.innerHTML="+";b.appendChild(e);e.id="addRule";b.appendChild(document.createElement("p"));e=document.createElement("button");e.onclick=om;e.innerHTML=u.close;b.appendChild(e);r("mapRulesWindow").appendChild(b);r("addEvent").onclick=$n;r("addAction").onclick=ao;r("eventOptions").onchange=function(){var b=qm[this.value];va.div=b.id;Da(va.div);va.active.name=this.value;
b.func&&b.func();b=r("eventScreen").getElementsByTagName("button");for(var e=!1,c=0,f=b.length;c<f;c++){var g=b[c];if(g.sdiv)if("none"==g.style.display)g.sdiv.style.display="none";else{if(!e)g.onclick();e=!0}}lh(Nb.active,"eventLayout")};r("actionOptions").onchange=function(){ob.active.name=this.value;lh(Nb.active,"actionLayout")};b=document.createElement("div");b.id="edobjAction";var c=document.createElement("select");c.innerHTML='\n<option value="attack">'+u.attack+'</option>\n<option value="destroy">'+
u.destroy+'</option>\n<option value="moving">'+u.moving+'</option>\n<option value="capture">'+u.capture+"</option>\n";c.value="attack";c.id="selectionEvents";c.onchange=bo;var g=document.createElement("section"),h=document.createElement("section"),l=document.createElement("section"),k=document.createElement("section"),m=document.createElement("section");e=document.createElement("button");e.innerHTML=u.add;e.onclick=Rd;var p=document.createElement("div");p.className="unitList";p.id="zoneList";l.appendChild(e);
l.appendChild(p);p=document.createElement("div");p.className="unitList";p.id="unitListDiv";p.spType=va;e=document.createElement("button");e.innerHTML=u.add;e.onclick=function(){Mb(this)};e.button=p;e.style.margin="10px";g.appendChild(e);e=document.createElement("button");e.innerHTML=u.defined;e.onclick=eb;e.sdiv=g;b.appendChild(e);e.onclick();e=document.createElement("button");e.innerHTML=u.undefined;e.onclick=eb;e.sdiv=h;b.appendChild(e);g.appendChild(p);b.appendChild(g);b.appendChild(h);b.appendChild(document.createElement("p"));
b.appendChild(c);b.appendChild(document.createElement("p"));p=document.createElement("div");p.className="unitList";p.id="unitListDiv2";p.spType=va;e=document.createElement("button");e.innerHTML=u.add;e.onclick=function(){Mb(this)};e.button=p;e.style.margin="10px";k.appendChild(e);e=document.createElement("button");e.innerHTML=u.defined;e.onclick=eb;e.sdiv=k;e.id="byButton1";b.appendChild(e);e=document.createElement("button");e.innerHTML=u.undefined;e.onclick=eb;e.id="byButton2";e.sdiv=m;b.appendChild(e);
k.appendChild(p);e=document.createElement("button");e.innerHTML=u.zone;e.onclick=eb;e.sdiv=l;e.id="eventZone";e.style.display="none";b.appendChild(e);b.appendChild(l);b.appendChild(k);b.appendChild(m);r("eventScreen").appendChild(b);fa("mapEvent");fa("mapActions");b=document.createElement("div");b.id="edobjOrder";c=document.createElement("select");c.innerHTML='\n<option value="move">'+u.move+'</option>\n<option value="attack">'+u.attack+"</option>\n";c.value="move";c.id="selectionActions";c.onchange=
co;g=document.createElement("section");h=document.createElement("section");k=document.createElement("section");m=document.createElement("section");p=document.createElement("div");p.className="unitList";p.id="unitListDivAction";p.spType=ob;e=document.createElement("button");e.innerHTML=u.add;e.onclick=function(){Mb(this)};e.button=p;e.style.margin="10px";g.appendChild(e);e=document.createElement("button");e.innerHTML=u.defined;e.onclick=eb;e.sdiv=g;b.appendChild(e);e=document.createElement("button");
e.innerHTML=u.undefined;e.onclick=eb;e.sdiv=h;b.appendChild(e);g.appendChild(p);b.appendChild(g);b.appendChild(h);e.onclick();b.appendChild(document.createElement("p"));b.appendChild(c);b.appendChild(document.createElement("p"));p=document.createElement("div");p.className="unitList";p.id="unitListDivAction2";p.spType=ob;e=document.createElement("button");e.innerHTML=u.add;e.onclick=function(){Mb(this)};e.button=p;e.style.margin="10px";k.appendChild(e);e=document.createElement("button");e.innerHTML=
u.defined;e.onclick=eb;e.sdiv=k;e.id="toButton1";b.appendChild(e);e=document.createElement("button");e.innerHTML=u.undefined;e.onclick=eb;e.id="toButton2";e.sdiv=m;b.appendChild(e);k.appendChild(p);b.appendChild(k);b.appendChild(m);e.onclick();r("actionScreen").appendChild(b);fa("mapEvent");fa("mapActions")}};var rm={moving:1},bo=function(){rm[this.value]?(fa("byButton2"),fa("byButton1"),fa("unitListDiv2")):(Da("unitListDiv2"),r("byButton2").style.display="inline-block",r("byButton1").style.display=
"inline-block");va.active.type=this.value},co=function(){rm[this.value]?(fa("toButton2"),fa("toButton1"),fa("unitListDivAction2")):(Da("unitListDivAction2"),r("toButton2").style.display="inline-block",r("toButton1").style.display="inline-block");ob.active.type=this.value},Mb=function(b){if(b)fa("mapRulesWindow"),Oa(),Mb.actived=b.button;else if(Mb.actived){Da("mapRulesWindow");Pb();b=Mb.actived.spType.active;b="unitListDiv2"==Mb.actived.id||"unitListDivAction2"==Mb.actived.id?b.to:b.list;for(var e=
{},c=0,g=b.length;c<g;c++)e[b[c]]=1;c=0;for(g=D.length;c<g;c++)e[D[c]]||b.put(D[c]);Gf(Mb.actived,b);Mb.actived=!1}},Gf=function(b,e){b.innerHTML="";for(var c=0,g=e.length;c<g;c++){var h=document.createElement("div");h.innerHTML=z[e[c]].name;var l=document.createElement("button");l.onclick=Aj;l.innerHTML="x";l.pObj=e;l.spObj=!0;l.obj=e[c];h.appendChild(l);b.appendChild(h)}},eb=function(){eb.active&&(eb.active.className="");eb.active=this;this.className="spSelect";for(var b=this.parentElement.getElementsByTagName("section"),
e=0,c=b.length;e<c;e++)b[e].style.display="none";this.sdiv.style.display="block"},Nb=function(){var b=this.editorRule;b.deleted||(Da("mapEvent"),Da("mapActions"),fa("eventOptions"),Nb.active&&(Nb.div.className=""),this.className="spSelect",Nb.active=b,Nb.div=this,lh(b,"eventLayout"),lh(b,"actionLayout"),va.div&&fa(va.div),va.div1=void 0)},va=function(){var b=this.editorRule;b.deleted||(Da("eventOptions"),va.div1&&(va.div1.className=""),this.className="spSelect",va.active=b,r("selectionEvents").value=
b.type,va.div1=this,r("eventOptions").value=b.name,va.div=qm[b.name].id,Da(va.div),Gf(r("unitListDiv"),b.list),Gf(r("unitListDiv2"),b.to))},ob=function(){var b=this.editorRule;b.deleted||(Da("actionOptions"),ob.div1&&(ob.div1.className=""),this.className="spSelect",ob.active=b,r("selectionActions").value=b.type,ob.div1=this,r("actionOptions").value=b.name,ob.div="ed"+b.name,Da(ob.div),Gf(r("unitListDivAction"),b.list),Gf(r("unitListDivAction2"),b.to))},lh=function(b,e){r(e).innerHTML="";if("eventLayout"==
e){b=b.events;var c=va,g=Nb.active.events}else b=b.actions,c=ob,g=Nb.active.actions;for(var h=0,l=b.length;h<l;h++){var k=document.createElement("div");mh(k,b[h],c,g);r(e).appendChild(k)}},$n=function(){var b=Nb.active,e={name:"objAction",list:[],to:[],type:"attack"};b.events.put(e);var c=document.createElement("div");mh(c,e,va,b.events);r("eventLayout").appendChild(c);if(va.div1)va.div1.onclick()},ao=function(){var b=Nb.active,e={name:"objOrder",list:[],to:[],type:"move"};b.actions.put(e);var c=
document.createElement("div");mh(c,e,ob,b.actions);r("actionLayout").appendChild(c);if(ob.div1)ob.div1.onclick()},mh=function(b,e,c,g){b.innerHTML=e.events?e.name:u[e.name];b.onclick=c;b.editorRule=e;c=document.createElement("button");c.innerHTML="x";c.obj=e;c.pObj=g;c.onclick=Aj;b.appendChild(c)},Zn=function(){p.rules||(p.rules=[]);var b={name:"Rule"+p.rules.length,events:[],actions:[]};p.rules.put(b);var e=document.createElement("div");mh(e,b,Nb,p.rules);r("rulist").appendChild(e)},Aj=function(){this.pObj.quit(this.obj);
this.obj.deleted=!0;this.parentElement.parentElement.removeChild(this.parentElement);if(!this.spObj)if(this.pObj!==p.rules)Nb.div.onclick();else fa("mapEvent"),fa("mapActions")},zj=function(){var b=r("mapPropsWindow").getElementsByTagName("table")[0];b.innerHTML="";b.innerHTML+="<tr><td>"+u.color+"</td><td>"+u.username+"</td><td>"+u.gold+"</td><td>"+u.wood+"</td><td>"+u.food+"</td><td>"+u.stone+"</td><td>"+u.AI+"</td><td>"+u.team+"</td></tr>";for(var e=1,c=H.length;e<c;e++){var g=H[e],h=g.color,l=
g.resources;h="#"+(16777216+(h[0]<<16)+(h[1]<<8)+h[2]).toString(16).slice(1);b.innerHTML+='<tr><td><input style="background:'+h+'" type="color" value="'+h+'" /></td><td><input type="text" value="'+g.name+'"></td>\n\n<td><input type="text" class="res" value="'+(parseInt(l[0])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(l[1])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+(parseInt(l[2])||"\u221e")+'"></td>\n<td><input type="text" class="res" value="'+
(parseInt(l[3])||"\u221e")+'"></td>\n<td><label class="container">\n  <input type="checkbox">\n  <span class="checkmark"></span>\n</label></td><td><input type="number" min="0" value="'+g.team+'"></td></tr>'}b.innerHTML+="<tr><td><button id='editorAdd'>+</button><button id='editorDelete'>-</button></td></tr>";r("editorAdd").onclick=eo;r("editorDelete").onclick=fo;b=b.getElementsByTagName("input");e=0;for(c=H.length-1;e<c;e++)l=8*e,g=H[e+1],b[l].onchange=go,b[l+1].onchange=ho,b[l+2].onchange=nh,b[l+
3].onchange=nh,b[l+4].onchange=nh,b[l+5].onchange=nh,b[l+2].res=0,b[l+3].res=1,b[l+4].res=2,b[l+5].res=3,b[l+6].onchange=io,b[l+6].checked=g.IA,b[l+7].onchange=jo,b[l].team=e+1,b[l+1].team=e+1,b[l+2].team=e+1,b[l+3].team=e+1,b[l+4].team=e+1,b[l+5].team=e+1,b[l+6].team=e+1,b[l+7].team=e+1},nh=function(){var b=parseInt(this.value);b||(b=Infinity,this.value="\u221e");H[this.team].resources[this.res]=b},eo=function(){new hc("Tzar "+H.length,[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],
[0],0,!0,[p.goldRes,p.woodRes,p.foodRes,p.stoneRes],2);$g();zj()},fo=function(){if(2<H.length){for(var b=H.length-1,e=3,c=z.length;e<c;e++){var g=z[e];g.kingdom==b&&g.die()}H.length--;$g();zj()}},go=function(){var b=H[this.team],e=parseInt(this.value.substr(1),16),c=e>>16&255,g=e>>8&255;e&=255;b.color=[c,g,e];var h=this.team;b=xa[h];H[h].color=[c,g,e];h*=3;Ha[h]=c/255;Ha[h+1]=g/255;Ha[h+2]=e/255;c=0;for(g=b.length;c<g;c++){e=b[c];h=0;for(var l=e.length;h<l;h++)zc(z[e[h]])}$g()},ho=function(){H[this.team].name=
this.value},io=function(){H[this.team].IA=this.checked?!0:!1},jo=function(){var b=H[this.team];b.team=parseInt(this.value);for(var c=H.length,f=1;f<c;f++){var g=H[f];g.team!==b.team&&(g.diplomacy[b.k]=1,b.diplomacy[g.k]=1)}};ef.onchange=function(b){O(ug,parseInt(ef.value)/100,D)};var Sj=function(b){var c=b.length;O(fj,c);for(var f=sb.step,g=0;g<c;g+=f)O(sb,b.slice(g,g+f))},Mn=function(b){if(b=document.getElementById("maploadOnline").files[0]){b.name.split(".");var c=new FileReader;c.onload=function(){var b=
new Uint8Array(this.result);w.admin&&(fa("optionbutton"),Sj(b),Tl(b),P(oa),Ul(oa.kingdoms.length),r("nplayersO").value=w.room.max,r("deleteCusMap").style.display="inline-table")};c.readAsArrayBuffer(b)}},gj=function(b,c){if(c&&"wmp"==c)return Df(b);P(b[0]);var e=b[1]+(b[2]<<8)+(b[3]<<16)+(b[4]<<24);c=new TextDecoder("utf-8");c=JSON.parse(c.decode(b.slice(5,e+5)));if(!1===c.arje){b=b.slice(e+5,e+5+Math.pow(c.mapx,2));var g=Math.pow(c.mapx,2);e=b.length;g=g?new Uint8Array(g):[];for(var h=0,l=0;l<e;l++){var k=
b[l];if(255!==k)g[h++]=k;else{k=b[l-1];for(var m=(b[l+1]<<8)+b[l+2],p=0;p<m;p++)g[h++]=k;l+=2}}c.terrain=g}c.allunits&&(c.allunits=Rl(c.allunits));c.ini&&(c.ini=Rl(c.ini));return c},oa,km=function(b){Da("customMapcont");r("editCustom").style.display="inline-table";r("closeCustom").style.display="inline-table";oa=b;oa.kingdomStart?(r("seeStats").style.display="inline-table",r("playrecord").style.display="inline-table"):(r("seeStats").style.display="none",r("playrecord").style.display="none");null===
oa.goldRes&&(oa.goldRes=Infinity);null===oa.stoneRes&&(oa.stoneRes=Infinity);null===oa.foodRes&&(oa.foodRes=Infinity);null===oa.woodRes&&(oa.woodRes=Infinity);b=document.getElementById("custombody");b.innerHTML="";for(var c=oa.kingdoms,f=0,g=c.length;f<g;f++){var h=c[f],k=h.color,m=h.team;void 0==m&&(m="");b.innerHTML+="<tr><td style='background:rgb("+k[0]+","+k[1]+","+k[2]+')\' class="ucolor1"></td><td class="username1">'+h.name+'</td><td style="display:none" class="race1">'+h.race+'</td><td class="team1">'+
m+"</td></tr>"}fa("maploadlabel");fa("mapcache")},ko=function(b){var c={Blue:189,Red:13506841,Green:3257600,Purple:11337925,Yellow:16768512,Cyan:46517,Orange:16751649,Gray:5921370},f=b.split(["[Player"]),g=b.split("GameDuration =")[1].split("[")[0].split(" min")[0].split(" ")[1],h=[];b=[];for(var k=1,m=f.length;k<m;k++){var p=f[k].split("\n"),r={};h[k-1]=r;for(var u=0,q=p.length;u<q;u++){var v=p[u];v=v.split(" = ");if(v[1]&&u){v[1]=v[1].trim();"Color"==v[0]&&(v[1]=c[v[1]]);"Type"==w&&"Status"!==v[0]&&
b.put("N");v[1]=encodeURIComponent(v[1]);b.put(v[1]);r[v[0]]=v[1];var w=v[0]}}}c=h[0].Name+"'s Game";var x=new XMLHttpRequest;x.open("POST",baseUrl+"php/stats.php",!0);x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){200===x.status&&4===x.readyState&&(location.hash="MatchX"+x.responseText)};b=b.join("<");x.send("arr="+b+"&time="+6E4*g+"&name="+c+"&players="+h.length)},Bj=function(b,c){for(var e=0,g=0,h=b.length;g<h;g++)e+=c[b[g]];return e},Cj=
function(b,c,f){var e=["",f];performance.now();for(var h=0,k=b.length;h<k;h++){var m=b[h],p=m.stats,u=p.resources,v=p.unitCountMax,q=24*h+2,w=m.color,x=m.IA;x=x?"IA":"Human";e[q]=(w[0]<<16)+(w[1]<<8)+w[2];e[q+1]=m.name;e[q+1]=m.name;e[q+2]=x;e[q+3]=m.status;e[q+4]=m.team;e[q+5]=jb[m.race];e[q+6]=p.score;e[q+7]=u[0];e[q+8]=u[1];e[q+9]=u[2];e[q+10]=u[3];e[q+11]=p.dmgInflicted;e[q+12]=p.dmgTaken;e[q+13]=p.unitsKilled;e[q+14]=p.unitsLosed;e[q+15]=p.buildsDestroyed;e[q+16]=p.buildsLosed;e[q+17]=Bj([10,
79,64],v);e[q+18]=Bj([32,44],v);e[q+19]=Bj([55,56],v);e[q+20]=0;e[q+21]=0;e[q+22]=0;e[q+23]=0}sm(e,c);c&&setTimeout(function(){"block"==r("ingameStats").style.display&&Cj(b,c,f)},500)},sm=function(b,c){for(var e="<tr style='background:#000;'><td style='    padding-right: 150px;'>Name</td><td>Type</td><td>Status</td><td>Team</td><td>Race</td><td>Score</td><td>Gold</td><td>Wood</td><td>Food</td><td>Stone</td><td title='Damage Inflicted'>D.I</td><td title='Damage Taken'>D.T</td><td title='Units Killed'>U.K</td><td title='Units Losed'>U.L</td><td title='Buildings Destroyed'>B.D</td><td title='Buildings Losed'>B.L</td><td title='Maximum Peasants'>M.P</td><td title='Maximum Towers'>M.T</td><td title='Maximum Stone Towers'>M.S.T</td><td title='Gold Traded'>G.T</td><td title='Stone Traded'>S.T</td><td title='Gold Converted'>G.C</td><td title='Stone Converted'>S.C</td></tr>",
g=2,h=b.length;g<h;g++)if((g-2)%24)0!==(g-3)%24&&(k=~~((g-2)/24)%2?"style = 'background:rgba(0,0,0,0.45)'":"style = 'background:rgba(0,0,0,0.65)'"),e+="<td "+k+">"+Wa(decodeURIComponent(b[g]))+"</td>";else{g-2&&(e+="</tr>");k=parseInt(Wa(decodeURIComponent(b[g])));var k="style = 'background:rgba("+Math.floor(k/65536)+","+Math.floor(k/256)%256+","+k%256+",0.45)'";e+="<tr>"}e+="</tr>";c?(r("ingameStats").style.display="block",r("statsGame").innerHTML="<tbody>"+e+"</tbody>",c=r("statsGame").getElementsByTagName("td")):
(r("MatchX").style.display="block",r("returnmenu").style.display="block",r("statsTable").innerHTML="<tbody>"+e+"</tbody>",c=r("statsTable").getElementsByTagName("td"));b=[];g=0;for(h=c.length;g<h;g++)e=g%23,4<e&&23<g&&(b[e-5]||(b[e-5]=[]),b[e-5].put(c[g]));g=0;for(h=b.length;g<h;g++){c=b[g];c.sort(Dm);e=c.length;if(!c[1])break;c[0].innerHTML!=c[1].innerHTML&&(c[0].style.background="rgba(127,0,0,0.45)");c[e-1].innerHTML!=c[e-2].innerHTML&&(c[e-1].style.background="rgba(0,127,0,0.45)")}};r("statsLoad").onchange=
function(){var b=document.getElementById("statsLoad").files[0],c=new FileReader;c.onloadend=function(b){ko(b.target.result)};b&&c.readAsText(b,"ascii")};var Bm=function(b){var c=new XMLHttpRequest;c.open("POST",baseUrl+"php/loadstat.php",!0);c.setRequestHeader("Content-type","application/x-www-form-urlencoded");tm(c,function(b){sm(b.responseText.split("<"))});P(b);c.send("id="+b)},tm=function(b,c){b.onreadystatechange=function(){4===b.readyState&&(200===b.status?c(b):alert("Error: "+b.status))}},
Vl=function(){r("mapconfiguration").style.display="block";r("basic").style.filter="blur(94px)";if(""==r("mapconfiguration").innerHTML){for(var b="",c=["grass","snow"],f=0,g=c.length;f<g;f++)b+='<option value="'+c[f]+'" '+(c[f]==localStorage.terrain?"selected":"")+">"+u[c[f]]+"</option>";c="";"true"==localStorage.infinity&&(c="checked");r("mapconfiguration").innerHTML="<table>\n<tbody>\n<tr><td>"+u.mapSize+'</td><td><input id="mapwidth" type="number" value="'+localStorage.mapSize+'" step="32" min="32" /></td></tr>\n<tr><td><hr></td></tr>\n<tr><td>'+
u.startingResources+"</td></tr>\n<tr><td><hr></td></tr>\n<tr><td>"+u.infinite+'</td><td><label class="container">\n  <input id="infiniteValue" type="checkbox" '+c+'>\n  <span class="checkmark"></span>\n</label></td></tr>\n<tr><td>'+u.gold+'</td><td><input id="goldValue" type="number" value="'+localStorage.goldRes+'" step="250" /></td></tr>\n<tr><td>'+u.wood+'</td><td><input id="woodValue" type="number" value="'+localStorage.woodRes+'" step="250" /></td></tr>\n<tr><td>'+u.food+'</td><td><input id="foodValue" type="number" value="'+
localStorage.foodRes+'" step="250" /></td></tr>\n<tr><td>'+u.stone+'</td><td><input id="stoneValue" type="number" value="'+localStorage.stoneRes+'" step="250" /></td></tr>\n<tr><td><hr></td></tr>\n<tr><td>'+u.terrainOption+'</td></tr>\n<tr><td><select name="terrain" id="terrainSelect">\n'+b+"\n<tr><td>"+u.water+'</td><td><input type="number" value="'+localStorage.water+'" id="waterValue" min="0"/></td></tr>\n<tr><td>'+u.items+'</td><td><input type="number" value="'+localStorage.items+'" id="itemsValue" min="0"/></td></tr>\n<tr><td>'+
u.peons+'</td><td><input type="number" value="'+localStorage.peons+'" id="peonValue" min="0"/></td></tr>\n<tr><td>'+u.gateways+'</td><td><input type="number" value="'+localStorage.gateways+'" id="gatewaysValue" min="0" /></td></tr>\n<tr><td>'+u.freePop+'</td><td><input type="number" value="'+localStorage.freePop+'" id="freePopValue" /></td></tr>\n</select>\n</td>\n</tr>\n<tr><td></td></tr>\n<tr><td><button id="closeButton1" class="start">'+u.close+"</button></td></tr>\n</tbody>\n</table>";r("infiniteValue").onchange=
function(){var b=this.checked;r("goldValue").disabled=b;r("stoneValue").disabled=b;r("woodValue").disabled=b;r("foodValue").disabled=b};r("infiniteValue").onchange();r("closeButton1").onclick=function(){p.online&&O(ed,yf());r("mapconfiguration").style.display="none";Oa()}}};r("deleteUnit").onclick=function(){O(df,1,D.slice(0))};r("rotatebutton").onclick=function(){for(var b=D,c=0,f=b.length;c<f;c++){var g=z[b[c]];g.build||(g.d=(g.d+1)%8,pa(g,g.img))}};r("gameMenu").onclick=Ej;r("menueditor").onclick=
Ej;r("backToGameS").onclick=function(){Lj("ingameStats");Oa()};r("statButton").onclick=function(){Cj(H.slice(1),!0,p.now());Pb()};r("returnmenu1").onclick=cc;r("returnmenu").onclick=cc;r("refreshButton1").onclick=de;r("sendmsg").onclick=Ii;r("start1").onclick=Vl;r("start2").onclick=Vd;r("alertok").onclick=function(){r("alert").style.display="none";Oa()};r("createGame1").onclick=Ql;var lo=function(){P(this,this.checked);localStorage[this.localProp]=this.checked},um=function(){var b=this.value;"color"==
this.type?this.style.backgroundColor=b:"name"==this.localProp&&(b=Wa(b));w[this.localProp]=b;localStorage[this.localProp]=b},Vj={MatchHistory:function(){document.getElementById("returnmenu").style.display="block";var b=new XMLHttpRequest;b.open("GET",baseUrl+"php/latest.php",!0);tm(b,function(b){b=b.responseText.split("|");for(var c=b.length-1,e="",h=0;h<c;h+=5)e+="<tr id='statList"+Wa(decodeURIComponent(b[h]))+"'><td>"+Wa(decodeURIComponent(b[h+1]))+"</td><td>"+Wa(decodeURIComponent(b[h+2]))+"</td><td>"+
Wa(decodeURIComponent(b[h+3]))+"</td><td>"+parseInt(Wa(decodeURIComponent(b[h+4])))/6E4+" min</td></tr>";document.getElementById("matchtable").innerHTML="<tbody>"+e+"</tbody>";e={};for(h=0;h<c;e={l:e.l},h+=5)e.l=Wa(decodeURIComponent(b[h])),r("statList"+e.l).onclick=function(b){return function(){location.hash="MatchX"+b.l}}(e)});b.send(null)},GameList:de,RandomMap:lc,Twitter:function(){document.getElementById("returnmenu").style.display="block"},Account:function(){Wd.returnmenu.style.display="block";
""==Wd.Account.innerHTML&&(Wd.Account.innerHTML='<iframe id="accountIframe"></iframe>',Wd.accountIframe=document.getElementById("accountIframe"));Wd.accountIframe.src=baseUrl+w.langCodeUrl+"account/?iframe=1"},MapEditor:sd.start,CustomMap:function(){""==r("CustomMap").innerHTML&&(r("CustomMap").innerHTML="<h2>"+u.strcusMap+'</h2>\n<input id="mapload" type="file" />\n<label for="mapload" id="maploadlabel">Choose a file</label>\n<table id="mapcache"></table>\n<div id="customMapcont" style="display:none">\n<table class="players" id="customaptable">\n<tbody id="custombody">\n</tbody>\n</table>\n<button style="margin-left:40px" id="startCustom" class="start startButton">'+
u.play+'</button>\n<button style="margin-left:40px" id="playrecord" class="start">'+u.loadRecord+'</button>\n<button style="margin-left:40px" id="editCustom" class="start">'+u.editMap+'</button>\n<button style="margin-left:40px" id="seeStats" class="start">'+u.stats+'</button>\n<button style="margin-left:40px" id="closeCustom" class="start">'+u.close+"</button>\n</div>",r("closeCustom").onclick=function(){fa("customMapcont");r("maploadlabel").style.display="inline-block";r("mapcache").style.display=
"table"},r("startCustom").onclick=function(){p=Object.assign({},oa);p.editor=!1;p.custom=!0;p.online=!1;oa=void 0;fa("customMapcont");r("closeCustom").onclick();Vd(!1,!1)},r("editCustom").onclick=function(){p=Object.assign({},oa);p.custom=!0;p.online=!1;p.editor=!0;sd.func();oa=void 0;fa("customMapcont");r("closeCustom").onclick()},r("playrecord").onclick=function(){p=Object.assign({},oa);p.online=!1;p.custom=!0;p.demo=!0;p.cycle=0;p.editor=!1;oa=void 0;fa("customMapcont");Vd(!1,!1);r("closeCustom").onclick()},
r("seeStats").onclick=function(){Cj(oa.kingdoms,!1,25*oa.cycle);location.hash="MatchX"},r("mapload").accept=".tzared,.wmp",r("mapload").onchange=function(b){b=document.getElementById("mapload").files[0];P(b);var c=b.name.split(".");c=c[c.length-1];var f=new FileReader;f.onload=function(){var b=new Uint8Array(this.result);b=gj(b,c);km(b)};f.readAsArrayBuffer(b)});Da("returnmenu");jm()},Settings:function(){var b=r("Settings");if(""==b.innerHTML){var c=document.createElement("h2");c.innerHTML=u.strSettings;
b.appendChild(c);c=document.createElement("div");var f=document.createElement("span");f.innerHTML=u.color;c.appendChild(f);var g=document.createElement("input");g.type="color";g.value=localStorage.color;g.onchange=um;g.localProp="color";g.style.backgroundColor=localStorage.color;c.appendChild(g);f=document.createElement("span");f.innerHTML=u.username;c.appendChild(f);g=document.createElement("input");g.type="text";g.value=Ol(localStorage.name);g.onchange=um;g.localProp="name";c.appendChild(g);f=document.createElement("span");
f.innerHTML=u.language;c.appendChild(f);f=document.createElement("select");f.innerHTML='<option value="en">'+u.english+'</option>\n<option value="es">'+u.spanish+'</option>\n<option value="it">'+u.italian+'</option>\n<option value="pt">'+u.portuguese+'</option>\n<option value="ru">'+u.russian+'</option>\n<option value="pl">'+u.polish+'</option>\n<option value="bg">'+u.bulgarian+'</option>\n<option value="de">'+u.german+"</option>\n";f.value=w.langstr;f.onchange=function(){localStorage.language=this.value;
location.href=""};c.appendChild(f);f=document.createElement("span");f.innerHTML=u.offlinePlay;c.appendChild(f);f=document.createElement("button");f.innerHTML=u.downloadAll;f.onclick=Jc;c.appendChild(f);f=document.createElement("span");f.innerHTML=u.fullscreen;c.appendChild(f);var h=document.createElement("label");h.className="container";f=document.createElement("span");f.className="checkmark";g=document.createElement("input");g.type="checkbox";g.checked="true"==localStorage.fullscreen?!0:!1;g.onchange=
lo;g.localProp="fullscreen";h.appendChild(g);h.appendChild(f);c.appendChild(h);b.appendChild(c)}Da("returnmenu")},About:function(){var b=r("About");""==b.innerHTML&&(b.innerHTML='<div style="text-align:center;    user-select: text;"><div class="svgnehhon" style="background-repeat: no-repeat;height: 184px;background-position: center;"></div>\nFully programmed by Donov from <a href="https://nehhon.com" target="_blank">nehhon</a><p>\nContact:</p>\n<a href=\'mailto:webmaster@nehhon.com\' target="_blank">webmaster@nehhon.com</a> <br> <a href="https://twitter.com/TzaredGame" target="_blank">@TzaredGame</a>\n<p>Graphics, sound and game concept (Tzar) by Haemimont</p>\n</div>');
Da("returnmenu")}};r("about").onclick=function(){location.hash="About"};Tj();var Yb=[Hc,Fg,jd,hd,Me,xg,Og,Hg,zg,yg,Cg,Pg,Kg,Zk,Qg,Ag,Bg,Mg,Qe,we,wd,wk,cg,Wh,vk,Xk,sg,al,bl,Ld,Ai,cl,dl,el,fl,sg,Gl,Uk,gl,ye,Vk,ig,Sk,Tk,si,rg,Ce,yc,qi,id,hd,qg,jd,Oc,Hd,Kd,ha,function(b){var c=b[1],f=z[b[2]];b=C[b[0]];H[f.kingdom].technology.hidden[b.id.id]=0;xc(f,b,c);la.actv[b.id.id]&&M(!1)},lg,mg,Sa,Lk,ub,ni,oi,ve,Pi,kl,$k,yi,Ig,Yk,Wk];(function(){for(var b=0,c=Yb.length;b<c;b++)Yb[b].url=b})();we.rule="moving";rg.rule=
"attack"})();
