/*
 JSON v3.2.6 | http://bestiejs.github.io/json3 | Copyright 2012-2013, Kit Cambridge | http://kit.mit-license.org  https://mths.be/utf8js v2.0.0 by @mathias */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(F,oa,ma){F!=Array.prototype&&F!=Object.prototype&&(F[oa]=ma.value)};$jscomp.getGlobal=function(F){return"undefined"!=typeof window&&window===F?F:"undefined"!=typeof global&&null!=global?global:F};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var F=0;return function(oa){return $jscomp.SYMBOL_PREFIX+(oa||"")+F++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var F=$jscomp.global.Symbol.iterator;F||(F=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[F]&&$jscomp.defineProperty(Array.prototype,F,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(F){var oa=0;return $jscomp.iteratorPrototype(function(){return oa<F.length?{done:!1,value:F[oa++]}:{done:!0}})};$jscomp.iteratorPrototype=function(F){$jscomp.initSymbolIterator();F={next:F};F[$jscomp.global.Symbol.iterator]=function(){return this};return F};
$jscomp.iteratorFromArray=function(F,oa){$jscomp.initSymbolIterator();F instanceof String&&(F+="");var ma=0,Da={next:function(){if(ma<F.length){var Ca=ma++;return{value:oa(Ca,F[Ca]),done:!1}}Da.next=function(){return{done:!0,value:void 0}};return Da.next()}};Da[Symbol.iterator]=function(){return Da};return Da};
$jscomp.polyfill=function(F,oa,ma,Da){if(oa){ma=$jscomp.global;F=F.split(".");for(Da=0;Da<F.length-1;Da++){var Ca=F[Da];Ca in ma||(ma[Ca]={});ma=ma[Ca]}F=F[F.length-1];Da=ma[F];oa=oa(Da);oa!=Da&&null!=oa&&$jscomp.defineProperty(ma,F,{configurable:!0,writable:!0,value:oa})}};$jscomp.polyfill("Array.prototype.keys",function(F){return F?F:function(){return $jscomp.iteratorFromArray(this,function(F){return F})}},"es6","es3");
$jscomp.polyfill("Object.getOwnPropertySymbols",function(F){return F?F:function(){return[]}},"es6","es5");$jscomp.findInternal=function(F,oa,ma){F instanceof String&&(F=String(F));for(var Da=F.length,Ca=0;Ca<Da;Ca++){var G=F[Ca];if(oa.call(ma,G,Ca,F))return{i:Ca,v:G}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(F){return F?F:function(F,ma){return $jscomp.findInternal(this,F,ma).v}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(F){return F?F:function(){return $jscomp.iteratorFromArray(this,function(F,ma){return ma})}},"es8","es3");$jscomp.polyfill("Math.sign",function(F){return F?F:function(F){F=Number(F);return 0===F||isNaN(F)?F:0<F?1:-1}},"es6","es3");$jscomp.polyfill("Number.isFinite",function(F){return F?F:function(F){return"number"!==typeof F?!1:!isNaN(F)&&Infinity!==F&&-Infinity!==F}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(F){return F?F:function(F){return Number.isFinite(F)?F===Math.floor(F):!1}},"es6","es3");$jscomp.owns=function(F,oa){return Object.prototype.hasOwnProperty.call(F,oa)};$jscomp.polyfill("Object.assign",function(F){return F?F:function(F,ma){for(var oa=1;oa<arguments.length;oa++){var Ca=arguments[oa];if(Ca)for(var G in Ca)$jscomp.owns(Ca,G)&&(F[G]=Ca[G])}return F}},"es6","es3");
(function(){var F,oa,ma,Da;function Ca(g,c){var b=D,d;for(d=2;60>=d;d+=2){g--;c--;for(var f=0;f<=d;){if(2<U[g+f+b*c]&&1==z[U[g+f+b*c]].res)return U[g+f+b*c];if(2<U[g+f+b*(c+d)]&&1==z[U[g+f+b*(c+d)]].res)return U[g+f+b*(c+d)];f++}for(f=0;f<d-1;){f++;if(2<U[g+b*(c+f)]&&1==z[U[g+b*(c+f)]].res)return U[g+b*(c+f)];if(2<U[g+d+b*(c+f)]&&1==z[U[g+d+b*(c+f)]].res)return U[g+d+b*(c+f)]}}return!1}function G(g){g.setupINTV(se,g.id,0)}function mk(){for(var g=0,c=La.length;g<c;La[g++].className="");}function nk(g){h.getError()==
h.CONTEXT_LOST_WEBGL&&(h=document.getElementById("tzar").getContext("webgl2",{antialias:!1,alpha:!1}),O("restored"));oa=[];ma=[0,1,2,1,2,3];Da=[];ma.changed=!0;if(!$c){var c=h.createShader(h.VERTEX_SHADER);h.shaderSource(c,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec4 a_kingdom;\nin vec4 a_physic;\nuniform float zoom;\nuniform mediump int miniMap;\nuniform float now;\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform sampler2D u_image1;\nuniform sampler2D delay;\nuniform float zMax;\nout highp vec2 vTextureCoord;\nout vec4 v_kcolor;\nout float height;\n\nvec4 superArray(in highp uint position) {\n     return(texelFetch(u_image1, ivec2(\t\t(position%uint(512))\t\t,\tposition/uint(512)\t), 0));\n}\n\n\n\nvoid main() {\n\n\n\n    highp float  x;\n    float t;\n\thighp uint pos;\n\n\nif(a_texCoord.y>-.5&&miniMap==0){\nt=(now-a_texCoord.y);\nif(a_texCoord.w>=0.0){\npos=uint(floor(t * a_texCoord.w));         \n}else{\n\n\nint index=int(-a_texCoord.w);\nint len=int(a_texCoord.z);\nint i;\n\nfloat spt= mod(t,texelFetch(delay, ivec2(len-1+index, 0), 0).r);\n\n for(i=0;i<len;i++){\n\n\nif(texelFetch(delay, ivec2(i+index, 0), 0).r>spt) {\n\nbreak;\n }\n\n\n }\n\n pos=uint(i);\n\n\t\t\t\t  \n //pos=uint(4);\n}\n\n\n\tpos=uint(a_texCoord.x)+uint(4)*(pos%uint(a_texCoord.z));\n\n\n}else{\n\npos=uint(a_texCoord.x);\n\n}\n\n\n\n    vec4 coord = superArray(pos);\n\n\tpos=pos-pos%uint(4);\n\n\theight = (superArray(pos+uint(3)).w-superArray(pos).w)/512.0;\n\n    vec2 mxy=vec2(coord.p,coord.q);\n\n\n\t\tfloat z=a_position.z;\n\n\tif(z<0.0){\n\tz*=-1.0;\n\tmxy*=0.0;\n\n\t}\n\n\n\n    t = (now - a_physic.w) * 0.001;\n    mxy.x+=a_physic.x * t;\n\n\tfloat physicY=a_physic.y * t + a_physic.z * .5 * t * t;\n\n    mxy.y+=physicY;\n\n\nif(miniMap==1){\n\tz=0.0;\n}else{\n\tz=(1.0 - (physicY+z)/ zMax)*.9;\n}\n\n   gl_Position = vec4((((a_position.xy+mxy) + u_translation) / u_resolution * 2.0 - 1.0) * vec2(zoom, -zoom), (z), 1.0);\n\n   vTextureCoord=vec2(coord.s,coord.t);\n\n\n    v_kcolor=a_kingdom;\n\n\n}\n");
h.compileShader(c);var b=h.createShader(h.FRAGMENT_SHADER);h.shaderSource(b,"#version 300 es\nprecision mediump float;\n\n\n\nuniform sampler2D lightmap;\nuniform vec2 u_resolution;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform mediump int miniMap;\nin vec4 v_kcolor;\nin highp vec2 vTextureCoord;\nin float height;\nout vec4 COLOR;\n\nvoid main() {\n\n\nif(miniMap==0){\n\n\n\n\nvec2 txtFinal=vTextureCoord;\n\nif(txtFinal.x>=1.0){\ntxtFinal.y+=height*floor(txtFinal.x);\n}\n\n\nvec4 color=texture(img_common, vec3(txtFinal, int(txtFinal.y)));\n \n\nif(color.a<0.5) discard;\n\n\n\n\nif(v_kcolor.a<1.0){\ncolor*=v_kcolor;\n}else if(v_kcolor.a!=1.0){\n\nif(color.r==color.g&&color.r==color.b){\ncolor.rgb*=v_kcolor.rgb;\n}\ncolor.a*=v_kcolor.a-1.0;\n}\nvec4 light=vec4(1.0);\n\n\nlight = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+vec4(1.0,1.0,1.0,0.0)*u_ambient;\n\nCOLOR=color*light;\n\n}else{\nCOLOR=v_kcolor;\n}\n\n}");
h.compileShader(b);ea=h.createProgram();h.attachShader(ea,c);h.attachShader(ea,b);h.linkProgram(ea);h.useProgram(ea);c=h.getShaderInfoLog(c);console.log("Shader compiler log: "+c);c=h.getShaderInfoLog(b);console.log("Shader compiler log: "+c);c=h.createShader(h.VERTEX_SHADER);h.shaderSource(c,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\n\n\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform mediump int miniMap;\nuniform float zoom;\n\n\nvoid main() {\n\nfloat depth;\nif(miniMap==1){\ndepth=.03;\n}else{\ndepth=1.0;\n}\n\n   gl_Position = vec4(a_position.x, a_position.y, depth, 1.0);\n   \n\n}");
h.compileShader(c);b=h.createShader(h.FRAGMENT_SHADER);h.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nuniform float u_fps;\nuniform mediump int miniMap;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform vec2 borderCoords;\nuniform vec2 waterBorder;\nuniform vec2 u_translation;\nuniform vec2 u_resolution;\nuniform vec2 minimapMargin;\nuniform mediump isampler2D img_data;\nuniform sampler2D lightmap;\nout vec4 COLOR;\nuniform float zoom;\nuniform float mx;\nuniform float mapSize;\nuniform float terrainInfo[32];\nvec4 sptexture3D(in vec2 coords,in float height1) {\n \n\n \nif(coords.x>=1.0){\ncoords.y+=height1*floor(coords.x);\n}\n\n\n\n    return(\ttexture(img_common, vec3(coords,int(coords.y)))\t);\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\nvec4 color;\n\nvec2 xy =  vec2(gl_FragCoord.x,u_resolution.y-gl_FragCoord.y)/zoom;\n\nif(miniMap==1){\nxy+=minimapMargin/zoom;\n}else{\nxy+=-u_translation+vec2(mx,0.0)/zoom+0.5*(u_resolution-u_resolution/zoom);\n}\n\nvec2 xy32=xy/32.0;\n\nvec2 floorxy32=floor(xy32);\n\nvec2 xyr=xy32-floorxy32;\n\n\nvec2 xyb;\n\n\nfloat dx=0.0;\nfloat dy=0.0;\n\nif(xyr.x>0.5){dx=1.0;}\nif(xyr.y>0.5){dy=1.0;}\n\nvec2 oxy32=xy32;\n\n\nif(dx==1.0){\nxyb=vec2(borderCoords.x+floor(rand(floorxy32)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(-16.0,8.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.x+=dx;\n}\n}\n\nif(dy==1.0){\nxyb=vec2(borderCoords.x+floor(rand(1.5*floorxy32-3.0)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(8,-16.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.y+=dy;\n}\n}\n\n\nint type = texture(img_data,xy32/(mapSize)).r;\nint ntype = texture(img_data,oxy32/(mapSize)).r;\n\nif(type<0&&type!=ntype){\n\nif(ntype<0){\ntype=ntype;\n}else if(ntype==3){\ntype=ntype;\n}else{\ntype=1;\n}\n}\n\n\n\nfloat h;\nfloat w;\nvec2 xytxt;\nif(type<0){\n\ntype=-type-1;\nxytxt=waterBorder+vec2(float(type*8*32),0.0)/512.0;\nw=32.0;\nh=32.0;\ntype*=-1;\n}else{\nxytxt=vec2(terrainInfo[type*4],terrainInfo[type*4+1]);\nw=terrainInfo[type*4+2];\nh=terrainInfo[type*4+3];\n\nif(type==3) xytxt+=vec2(u_fps,0.0);\n}\n\n\nvec2 xyt=vec2(xytxt)+vec2(mod(xy.x,w),mod(xy.y,h))/512.0;\n\n\nif(type==3){ h=576.0; }\ncolor=sptexture3D(xyt,h/512.0);\n\nmediump vec4 light=vec4(1.0);\nif(miniMap==0) light = (texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+1.0)*u_ambient;\n\n\n\nCOLOR=color*light;\n\n\n\n}");
h.compileShader(b);wa=h.createProgram();h.attachShader(wa,c);h.attachShader(wa,b);h.linkProgram(wa);c=h.getShaderInfoLog(c);console.log("Shader1 compiler log T: "+c);c=h.getShaderInfoLog(b);console.log("Shader compiler log T: "+c)}b=h.getAttribLocation(ea,"a_position");c=h.getAttribLocation(ea,"a_texCoord");var d=h.getAttribLocation(ea,"a_kingdom"),f=h.getAttribLocation(ea,"a_physic"),k=m,l=cc.dir,q=[];q.length=4*l.length;for(var r=0,n=l.length;r<n;r++){var u=ta[k[l[r]]],K=u[7]+u.deltaY,v=u[8],ha=
u[9];q[4*r]=u[6]/512;q[4*r+1]=K/512;q[4*r+2]=v;q[4*r+3]=ha}O(q);r=1/512;h.useProgram(wa);n=h.getUniformLocation(wa,"minimapMargin");wd=h.getUniformLocation(wa,"u_translation");Vf=h.getUniformLocation(wa,"u_resolution");Wf=h.getUniformLocation(wa,"u_fps");var ad=h.getUniformLocation(wa,"u_ambient");bd=h.getUniformLocation(wa,"zoom");u=h.getUniformLocation(wa,"mx");l=h.getUniformLocation(wa,"mapSize");K=h.getUniformLocation(wa,"borderCoords");v=h.getUniformLocation(wa,"waterBorder");te=h.getUniformLocation(wa,
"miniMap");ha=h.getUniformLocation(wa,"terrainInfo");h.uniform2fv(K,[ta[k.terrain_border][6]*r,r*(ta[k.terrain_border].deltaY+ta[k.terrain_border][7])]);h.uniform2fv(v,[ta[k.waterborder][6]*r,r*(ta[k.waterborder].deltaY+ta[k.waterborder][7])]);h.uniform1i(te,0);h.uniform2fv(wd,[0,0]);h.uniform1f(Wf,-1);h.uniform1f(bd,1);h.uniform1f(u,-A.mx);h.uniform1f(l,D);h.uniform1fv(ha,q);p.editor?h.uniform2fv(n,[0,-60]):h.uniform2fv(n,[-4,-31]);k=h.getAttribLocation(wa,"a_position");Xf=h.createVertexArray();
h.bindVertexArray(Xf);q=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,q);h.bufferData(h.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,1,1,-1,1]),h.STATIC_DRAW);h.enableVertexAttribArray(k);h.vertexAttribPointer(k,2,h.FLOAT,!1,0,0);h.bindVertexArray(null);h.useProgram(ea);h.bindBuffer(h.ARRAY_BUFFER,null);k=D*Aa*3;Yf=h.createVertexArray();h.bindVertexArray(Yf);jb=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,jb);h.enableVertexAttribArray(d);h.vertexAttribPointer(d,4,h.FLOAT,!1,0,0);h.bufferData(h.ARRAY_BUFFER,
16*k,h.DYNAMIC_DRAW);cd=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,cd);h.enableVertexAttribArray(c);h.vertexAttribPointer(c,4,h.FLOAT,!1,0,0);h.bufferData(h.ARRAY_BUFFER,16*k,h.DYNAMIC_DRAW);qc=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,qc);h.enableVertexAttribArray(b);h.vertexAttribPointer(b,3,h.FLOAT,!1,0,0);h.bufferData(h.ARRAY_BUFFER,12*k,h.DYNAMIC_DRAW);xd=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,xd);h.enableVertexAttribArray(f);h.vertexAttribPointer(f,4,h.FLOAT,!1,0,0);h.bufferData(h.ARRAY_BUFFER,
16*k,h.DYNAMIC_DRAW);h.bindVertexArray(null);ue=h.getUniformLocation(ea,"u_resolution");var Ha=h.getUniformLocation(ea,"u_ambient");yd=h.getUniformLocation(ea,"u_translation");dd=h.getUniformLocation(ea,"zoom");Hh=h.getUniformLocation(ea,"now");ve=h.getUniformLocation(ea,"miniMap");b=h.getUniformLocation(ea,"zMax");h.uniform1f(b,p.zMax);h.uniform1i(ve,0);h.useProgram(ea);m.delay=[100,250,400,550,650,750,850,1E3,1150,5150,7650,10150,13650,17150,21150,25150,100,200,300,400,500,600,700,800,900,1E3,1100,
1200,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6500,7700,8900,10100,13600,17100,22100,8E3,8080,8160,8240,8320,8400,8480,100,200,300,400,500,600,700,800,900,1E3,1100,2400,3600,4800,6E3,7200,8400,11900,15400,20400,8E3,8077,8154,8231,8308,8385,8462,8539,8616,8693,8770,8847,8923,5E3,5072,5143,5215,5286,5358,5429,5501,5572,5644,5715,5787,5858,5929,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,3700,4900,7100,9600,12600,17100,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,
8833,8916,9E3,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,8833,8916,9E3,9080,5E3,5100,5200,5300,5400,5500,5600,5700,5850,6E3,70,140,210,280,350,420,490,560,630,700,770,840,910,980,4980,8980,12980,16980,20980,26980,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,4100,6300,8500,11E3,13500,17E3,20500,5E3,5100,5200,5300,5400,5500,5600,5700,5800,5900,6E3,125,230,335,431,546,606,666,731,857,952,1045,1139,1238,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,3300,
5800,8800,12E3,15500,5500,5600,5700,5800,5900,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6800,9800,12800,16300,19800,23800,28300,5E3,5100,5200,5300,5400,5500,5600,210,420,654,864,1074,1284,1494,108,244,380,516,652,788,924,1060,1196,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4100,6100,8100,11100,14100,17100,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5200,9E3,11E3,13800,17600,23400,7E3,7100,
7200,7300,7400,8200,8300,8400,8500,8600,9600,9700,9800,9900,1E4,80,160,210,360,610,1010,1510,100,200,300,400,500,3500,7500,13500,40,80,120,160,200,240,280,320,360,400,440,480,520,2520,3520,4520,5520,6520,8520,11520,107,214,321,428,535,642,749,856,963,1070,1177,1284,1391,1498,7323,13148,18973,24798,30623,36448,7E3,7170,7340,7510,7680,7980,8150,8320,8490,8660,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,6400,8900,11400,14900,18400,7E3,7200,7400,7600,7800,8E3,8200,125,250,375,500,
2E3,2125,2250,100,200,300,400,500,4E3,10500,100,200,300,400,500,600,700,800,900,8900,15900,21400,27400,33900,38900,44900,51900,800,1E3,1200,1400,1600,1800,2E3,2200,2400,2600,NaN,80,160,240,320,400,480,560,640,720,800,880,960,1040,5040,9040,12790,16540,19290,22040,25790,7671,7771,7871,7971,8071,8171,8271,100,200,300,400,500,600,700,800,900,1E3,1100,1200,6200,9700,13200,17200,21200,25200,29200,35200,100,200,300,400,500,600,9600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,11300,17300,
27300,37300,49300,64300,8E3,8228,8457,8685,8914,9142,9371,80,160,240,320,400,480,560,640,720,800,880,960,4960,8460,11460,14460,18460,22460,28460,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5400,8900,12900,16900,22900,28900,5E3,5143,5286,5429,5572,5715,5857,121,232,361,508,629,758,879,1018,1165,1425,1445,1465,1536,1692,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8300,11300,14800,18800,23300,29300,6E3,6171,6343,6514,6685,6857,7028,125,
250,375,500,625,750,875,1E3,1125,1250,1375,1500,6500,10500,13500,16500,19500,23E3,27E3,31500,8E3,8185,8370,8555,8740,8925,9108,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4300,7800,11300,15300,19300,23800,29800,1E4,10107,10214,10321,10428,10535,10643,10750,10857,10964,11071,11178,11285,11393,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4900,8400,12900,17400,22400,27400,
8E3,8250,8500,8750,9E3,9250,9500,9750,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,8300,11800,15800,19800,24300,29300,5E3,5157,5314,5471,5628,5785,5943,125,250,375,500,625,3125,3250,3375,100,200,300,400,500,600,4600,8600,14600,15600,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14400,18400,
22400,28400,180,360,540,720,900,1080,10080,100,200,350,500,600,700,800,950,1100,1250,1400,1550,1700,6200,8700,11700,15200,18700,22700,27700,6E3,6120,6240,6360,6480,6600,6720,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14900,18900,23400,29400,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,7400,10900,14900,19900,5E3,5100,5200,5300,5400,5500,5600,116,232,348,464,522,580,638,696,812,928,1044,1160,1276,1392,100,200,300,400,
500,600,700,800,900,1E3,1100,1200,5200,8700,11700,14700,18700,22700,28700,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,6900,10900,14400,18400,22400,27400,7E3,7100,7200,7300,7400,7500,7600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8600,10800,13E3,15500,19500,24E3,8E3,8100,8200,8300,8400,8500,8600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8800,12300,16300,20300,24300,29300,6E3,6100,6200,6300,6400,6500,6600,100,200,
300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1630,1730,1830,1930,2030,2130,2230,2330,5330,8330,11330,7E3,7150,7300,7450,7600,7750,7900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,5200,8700,12200,15700,20200,24700,29700,34700,8E3,8080,8163,8246,8330,8413,8496,8580,8663,8746,8830,8913,8996,9080,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,5599,5684,5770,5855,5941,6026,6112,125,250,375,500,625,
750,875,1E3,1125,1250,1375,1500,1625,5625,8625,11625,14625,18125,22125,26625,8E3,8185,8370,8555,8740,8925,9108,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,6100,10600,14600,18100,21600,26100,30600,35600,40600,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1700,6700,10700,11300,6E3,6200,6400,6600,6800,7E3,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,10400,100,
200,300,400,500,600,8600];b=m.delay;var ca=b.length;ta[m.expl_small_hole][1]=-ca;for(c=r=0;14>r;r++)c+=66,b[r+ca]=c;b.put(c+3E4);b=new Float32Array(b);Ih=function(g){h.useProgram(wa);h.uniform4fv(ad,g);h.useProgram(ea);h.uniform4fv(Ha,g)};Zf=function(g){if(!zd&&(g.clientX>A.menumx||ed||!g.clientX)){g=.07*Math.sign(g.deltaY)*fa;var c=(fa+g)*tzar.height*.03125;(fa+g)*tzar.width*.03125-(fa+g)*A.mx/32>D||c>Aa||(fa+=g,.08>fa&&(fa=.08),sb(),Ad(-vb,-Wa),h.useProgram(wa),h.uniform1f(bd,1/fa),h.useProgram(ea),
h.uniform1f(dd,1/fa))}};window.addEventListener("wheel",Zf,!1);Jh=function(){ca=[vb,Wa];h.useProgram(wa);h.uniform2fv(wd,ca);h.useProgram(ea);h.uniform2fv(yd,ca)};Ih(Kh());O(Kh());h.uniform1f(dd,1);h.uniform2fv(yd,[0,0]);var Ob=h.createFramebuffer(),ya;Bd=function(){var g=window.innerWidth,c=window.innerHeight;tzar.width=g;tzar.height=c;h.useProgram(wa);h.uniform2f(Vf,g,c);h.useProgram(ea);Ob.width=g;Ob.height=c;h.activeTexture(h.TEXTURE2);ya||(ya=h.createTexture());h.bindTexture(h.TEXTURE_2D,ya);
h.texImage2D(h.TEXTURE_2D,0,h.RGBA,g,c,0,h.RGBA,h.UNSIGNED_BYTE,null);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);h.bindFramebuffer(h.FRAMEBUFFER,Ob);h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,ya,0);h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT);h.bindFramebuffer(h.FRAMEBUFFER,
null);fa=1;h.uniform1f(dd,1/fa);h.uniform1i(h.getUniformLocation(ea,"lightmap"),2);h.useProgram(wa);h.uniform1i(h.getUniformLocation(wa,"lightmap"),2);h.uniform1f(bd,1/fa);h.useProgram(ea);h.uniform2f(ue,g,c);h.viewport(A.mx,0,g,c);Bd.changed=1;Ad(-vb,-Wa)};Bd.changed=0;window.addEventListener("resize",Bd,!1);Bd();h.blendEquation(h.FUNC_ADD);h.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA);h.disable(h.DITHER);h.disable(h.BLEND);performance.now();c=h.createTexture();d=R.info;O(t);h.bindTexture(h.TEXTURE_2D,
c);h.texImage2D(h.TEXTURE_2D,0,h.RGBA32F,512,512,0,h.RGBA,h.FLOAT,d);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT);h.bindTexture(h.TEXTURE_2D,null);h.activeTexture(h.TEXTURE0);h.bindTexture(h.TEXTURE_2D,c);h.uniform1i(h.getUniformLocation(ea,"u_image1"),0);h.activeTexture(h.TEXTURE1);c=h.createTexture();h.bindTexture(h.TEXTURE_2D_ARRAY,
c);h.texParameteri(h.TEXTURE_2D_ARRAY,h.TEXTURE_MAG_FILTER,h.NEAREST);h.texParameteri(h.TEXTURE_2D_ARRAY,h.TEXTURE_MIN_FILTER,h.NEAREST);d=R.common;f=d.length;u=R.xtra;r=0;for(n=u.length;r<n;f+=u[r++].length);O(R);h.texImage3D(h.TEXTURE_2D_ARRAY,0,h.RGBA,R.size,R.size,f/(4*R.size*R.size),0,h.RGBA,h.UNSIGNED_BYTE,null);f=d.length;h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,0,R.size,R.size,d.length/(4*R.size*R.size),h.RGBA,h.UNSIGNED_BYTE,d);r=0;for(n=u.length;r<n;r++)d=u[r],h.texSubImage3D(h.TEXTURE_2D_ARRAY,
0,0,0,f/1048576,R.size,R.size,d.length/(4*R.size*R.size),h.RGBA,h.UNSIGNED_BYTE,d),f+=d.length;O(f);h.activeTexture(h.TEXTURE1);h.bindTexture(h.TEXTURE_2D_ARRAY,c);h.uniform1i(h.getUniformLocation(ea,"img_common"),1);h.useProgram(wa);h.activeTexture(h.TEXTURE0);h.bindTexture(h.TEXTURE_2D_ARRAY,c);h.uniform1i(h.getUniformLocation(wa,"img_common"),0);yc(g);$c||(O(b),h.activeTexture(h.TEXTURE3),c=h.createTexture(),h.bindTexture(h.TEXTURE_2D,c),h.texImage2D(h.TEXTURE_2D,0,h.R16F,b.length,1,0,h.RED,h.FLOAT,
b),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.bindTexture(h.TEXTURE_2D,null),h.bindTexture(h.TEXTURE_2D,c),h.uniform1i(h.getUniformLocation(ea,"delay"),3),h.activeTexture(h.TEXTURE2),$f=h.createTexture(),h.bindTexture(h.TEXTURE_2D,$f),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,1,1,0,h.RGBA,h.UNSIGNED_BYTE,new Uint8Array([255,
255,255,255])),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.clearColor(0,0,0,1));h.bindFramebuffer(h.FRAMEBUFFER,Ob);Ob.width=1;Ob.height=1;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,ya,0);h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT);h.bindFramebuffer(h.FRAMEBUFFER,null);new Float32Array(8);
ag=h.createBuffer();bg=h.createBuffer();Lh=h.createBuffer();r=0;for(n=cg.length;r<n;r++)tb(cg[r]);h.enable(h.DEPTH_TEST);h.depthFunc(h.LEQUAL);eb.fp1000=1E3;eb.delta=0;eb.now=0;eb.frameCount=0;h.bindTexture(h.TEXTURE_2D,ya);$c=R.setup=!0}function fd(g,c,b){var d=c||fd,f=function(){d(g,c,b)};if(!Mh()){p.editor?(A.marx=0,A.mary=60,w("saveGame").innerHTML=y.save,A.menumy=60,Xa=Pb=171,A.mx=0,A.menumx=171):(A.mx=151,Xa=Pb=128,A.menumx=151,A.menumy=0,w("saveGame").innerHTML=y.savegame,A.marx=4,A.mary=31);
zc.style.width=Pb+"px";zc.style.height=Xa+"px";zc.style.left=A.marx+"px";zc.style.top=A.mary+"px";dc();w("loading").style.display="block";origin=!1;O(R.load,R.images);if(R.load<R.images||!R.images)return R.started||(w("qdgraphics")&&(w("qdgraphics").style.display="none"),Nh()),w("loadingtext").innerHTML=y.waitImages,Qb=f,!1;if(dg.last!==w("terrainSelect").value)return eg=!0,w("loadingtext").innerHTML="Downloading terrain",pk(),Qb=f,!1;qk();w("notifybottom").style.display="none";void 0===p.arje&&fg();
p.demo?w("saveGame").style.display="none":w("saveGame").style.display="block";O(J);if(b){var e=0==p.cycle?p.kingdomStart:p.kingdoms;f=0;for(q=e.length;f<q;f++){var l=new ec("",e[f].color,[0],!0);Object.assign(l,e[f]);null==l.resources[0]&&(l.resources[0]=Infinity);null==l.resources[1]&&(l.resources[1]=Infinity);null==l.resources[2]&&(l.resources[2]=Infinity);null==l.resources[3]&&(l.resources[3]=Infinity)}}else{f=0;for(var q=J.length;f<q;f++){e=J[f];l=[0];for(var r=0;r<q;r++)l[r+1]=J[r].team==e.team?
0:1;l.put(1);p.online&&e.id===A.onlineID&&(A.kingdom=f+1);new ec(e.name,e.color,l,e.race,e.IA,[p.goldRes,p.woodRes,p.foodRes,p.stoneRes],e.team)}}p.rules?rk(p.rules):Cd=void 0;A.kingdom||(A.kingdom=1);sk();return!0}}function Oh(){w("playingMenu").style.display="block";dc()}function tk(g){O("setup:",g);g.toSend=[];g.orderList=[];g.sendDirectly("channelMessage","nehhof",{});g.channels.channelMessage.onopen=function(){Ma.put(g);za("attack");gg();hg(1);O("DATACHANNEL OPEN");for(var c=0,b=J.length;c<b;c++)if(J[c].id==
g.id)g.username=J[c].name,fc[c]&&(fc[c].style.background="#00ff00",fc[c].style.boxShadow="0px 0px 30px 0px #00ff00");else if(J[c].id==A.onlineID){var d=J[c],f=A.color;O("sending");da(ig,f,0,[g],2);da(jg,d.team,0,[g],2);da(kg,d.race,0,[g],2);da(Ph,A.name,0,[g],2)}};g.channels.channelMessage.onerror=function(g){O(g)}}function Qh(){document.getElementById("buttons").innerHTML="";document.getElementById("onlineID").value="";document.getElementById("gameName").innerHTML=""}function lg(){A.p2p?(kb(),A.p2p.emit("getRooms"),
w("returnmenu").style.display="block"):(Qa||gc(),gc.func=lg)}function Rh(){var g=location,c=g.hash.substr(1);""==c&&(document.getElementById("returnmenu").style.display="none");if("MatchX"==c.substr(0,6))6<c.length&&uk(c.substr(6-c.length));else if("Room"==g.hash.substr(-4))g=g.hash.substr(1),A.admin||Sh(g.substr(0,g.length-4));else if(Th[c])Th[c]();else g.hash=""}function Uh(g){var c=new Date;g=new Uint32Array(g);for(var b,d=D,f=0;f<U.length;f++)U[f]!=g[f]&&(b=g[f],U[f]=b,b=z[b],b.x32=f%d,b.y32=
~~(f/d));console.log(new Date-c)}function Vh(g){g=new Uint32Array(g);console.log(g)}function Wh(g){g=document.getElementById(g);g.style.display="none"==g.style.display?"block":"none"}function mg(g){g.style.display="none"==g.style.display?"block":"none"}function Xh(g){T=function(){};Rb=!1;var c=N;c.d=g.d;ObjectsetupIMG(c,g.img);c.active=!0;Ya=t[52];Dd=g;document.addEventListener("mousemove",ng);document.addEventListener("mousedown",we)}function vk(g,c){return g.innerHTML-c.innerHTML}(function(g){"object"===
typeof exports&&"undefined"!==typeof module?module.exports=g():"function"===typeof define&&define.amd?define([],g):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).SimpleWebRTC=g()})(function(){return function f(c,b,d){function e(k,q){if(!b[k]){if(!c[k]){var r="function"==typeof require&&require;if(!q&&r)return r(k,!0);if(l)return l(k,!0);q=Error("Cannot find module '"+k+"'");throw q.code="MODULE_NOT_FOUND",q;}q=b[k]={exports:{}};c[k][0].call(q.exports,
function(b){var f=c[k][1][b];return e(f?f:b)},q,q.exports,f,c,b,d)}return b[k].exports}for(var l="function"==typeof require&&require,q=0;q<d.length;q++)e(d[q]);return e}({1:[function(c,b,d){function f(){}b.exports=function(c,b,d){function e(c,f){if(0>=e.count)throw Error("after called too many times");--e.count;c?(k=!0,b(c),b=d):0!==e.count||k||b(null,f)}var k=!1;d=d||f;e.count=c;return 0===c?b():e}},{}],2:[function(c,b,d){b.exports=function(c,b,d){var f=c.byteLength;b=b||0;d=d||f;if(c.slice)return c.slice(b,
d);0>b&&(b+=f);0>d&&(d+=f);d>f&&(d=f);if(b>=f||b>=d||0===f)return new ArrayBuffer(0);c=new Uint8Array(c);f=new Uint8Array(d-b);for(var e=0;b<d;b++,e++)f[e]=c[b];return f.buffer}},{}],3:[function(c,b,d){b.exports=function(c,b,d){var f,e=b;b={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};if(d)for(f in d)b[f]=d[f];e?"audio"===e.tagName.toLowerCase()&&(b.audio=!0):e=document.createElement(b.audio?"audio":"video");b.disableContextMenu&&(e.oncontextmenu=function(c){c.preventDefault()});
b.autoplay&&(e.autoplay="autoplay");b.muted&&(e.muted=!0);!b.audio&&b.mirror&&["","moz","webkit","o","ms"].forEach(function(c){e.style[c?c+"Transform":"transform"]="scaleX(-1)"});e.srcObject=c;return e}},{}],4:[function(c,b,d){function f(c){c=c||{};this.ms=c.min||100;this.max=c.max||1E4;this.factor=c.factor||2;this.jitter=0<c.jitter&&1>=c.jitter?c.jitter:0;this.attempts=0}b.exports=f;f.prototype.duration=function(){var c=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),
f=Math.floor(b*this.jitter*c);c=0==(Math.floor(10*b)&1)?c-f:c+f}return Math.min(c,this.max)|0};f.prototype.reset=function(){this.attempts=0};f.prototype.setMin=function(c){this.ms=c};f.prototype.setMax=function(c){this.max=c};f.prototype.setJitter=function(c){this.jitter=c}},{}],5:[function(c,b,d){(function(c){d.encode=function(b){b=new Uint8Array(b);var f,d=b.length,e="";for(f=0;f<d;f+=3)e+=c[b[f]>>2],e+=c[(b[f]&3)<<4|b[f+1]>>4],e+=c[(b[f+1]&15)<<2|b[f+2]>>6],e+=c[b[f+2]&63];2===d%3?e=e.substring(0,
e.length-1)+"=":1===d%3&&(e=e.substring(0,e.length-2)+"==");return e};d.decode=function(b){var f=.75*b.length,d=b.length,e=0;"="===b[b.length-1]&&(f--,"="===b[b.length-2]&&f--);var k=new ArrayBuffer(f),u=new Uint8Array(k);for(f=0;f<d;f+=4){var K=c.indexOf(b[f]);var v=c.indexOf(b[f+1]);var ha=c.indexOf(b[f+2]);var ad=c.indexOf(b[f+3]);u[e++]=K<<2|v>>4;u[e++]=(v&15)<<4|ha>>2;u[e++]=(ha&3)<<6|ad&63}return k}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],6:[function(c,b,d){(function(c){function f(c){for(var b=
0;b<c.length;b++){var f=c[b];if(f.buffer instanceof ArrayBuffer){var d=f.buffer;if(f.byteLength!==d.byteLength){var e=new Uint8Array(f.byteLength);e.set(new Uint8Array(d,f.byteOffset,f.byteLength));d=e.buffer}c[b]=d}}}function d(c,b){b=b||{};var d=new r;f(c);for(var e=0;e<c.length;e++)d.append(c[e]);return b.type?d.getBlob(b.type):d.getBlob()}function e(c,b){f(c);return new Blob(c,b||{})}var r=c.BlobBuilder||c.WebKitBlobBuilder||c.MSBlobBuilder||c.MozBlobBuilder;try{var n=2===(new Blob(["hi"])).size}catch(v){n=
!1}var u;if(u=n)try{u=2===(new Blob([new Uint8Array([1,2])])).size}catch(v){u=!1}var K=r&&r.prototype.append&&r.prototype.getBlob;c=n?u?c.Blob:e:K?d:void 0;b.exports=c}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],7:[function(c,b,d){var f=[].slice;b.exports=function(c,b){"string"==typeof b&&(b=c[b]);if("function"!=typeof b)throw Error("bind() requires a function");var d=f.call(arguments,2);return function(){return b.apply(c,
d.concat(f.call(arguments)))}}},{}],8:[function(c,b,d){function f(c){if(c){for(var b in f.prototype)c[b]=f.prototype[b];return c}}b.exports=f;f.prototype.on=f.prototype.addEventListener=function(c,b){this._callbacks=this._callbacks||{};(this._callbacks[c]=this._callbacks[c]||[]).push(b);return this};f.prototype.once=function(c,b){function f(){d.off(c,f);b.apply(this,arguments)}var d=this;this._callbacks=this._callbacks||{};f.fn=b;this.on(c,f);return this};f.prototype.off=f.prototype.removeListener=
f.prototype.removeAllListeners=f.prototype.removeEventListener=function(c,b){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var f=this._callbacks[c];if(!f)return this;if(1==arguments.length)return delete this._callbacks[c],this;for(var d,e=0;e<f.length;e++)if(d=f[e],d===b||d.fn===b){f.splice(e,1);break}return this};f.prototype.emit=function(c){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),f=this._callbacks[c];if(f){f=f.slice(0);for(var d=
0,e=f.length;d<e;++d)f[d].apply(this,b)}return this};f.prototype.listeners=function(c){this._callbacks=this._callbacks||{};return this._callbacks[c]||[]};f.prototype.hasListeners=function(c){return!!this.listeners(c).length}},{}],9:[function(c,b,d){b.exports=function(c,b){var f=function(){};f.prototype=b.prototype;c.prototype=new f;c.prototype.constructor=c}},{}],10:[function(c,b,d){function f(c){return f.enabled(c)?function(b){b instanceof Error&&(b=b.stack||b.message);var d=new Date,e=d-(f[c]||
d);f[c]=d;b=c+" "+b+" +"+f.humanize(e);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}b.exports=f;f.names=[];f.skips=[];f.enable=function(c){try{localStorage.debug=c}catch(n){}for(var b=(c||"").split(/[\s,]+/),d=b.length,e=0;e<d;e++)c=b[e].replace("*",".*?"),"-"===c[0]?f.skips.push(new RegExp("^"+c.substr(1)+"$")):f.names.push(new RegExp("^"+c+"$"))};f.disable=function(){f.enable("")};f.humanize=function(c){return 36E5<=c?(c/36E5).toFixed(1)+
"h":6E4<=c?(c/6E4).toFixed(1)+"m":1E3<=c?(c/1E3|0)+"s":c+"ms"};f.enabled=function(c){for(var b=0,d=f.skips.length;b<d;b++)if(f.skips[b].test(c))return!1;b=0;for(d=f.names.length;b<d;b++)if(f.names[b].test(c))return!0;return!1};try{window.localStorage&&f.enable(localStorage.debug)}catch(k){}},{}],11:[function(c,b,d){b.exports=c("./lib/")},{"./lib/":12}],12:[function(c,b,d){b.exports=c("./socket");b.exports.parser=c("engine.io-parser")},{"./socket":13,"engine.io-parser":24}],13:[function(c,b,d){(function(f){function d(c,
b){if(!(this instanceof d))return new d(c,b);b=b||{};c&&"object"==typeof c&&(b=c,c=null);c&&(c=K(c),b.host=c.host,b.secure="https"==c.protocol||"wss"==c.protocol,b.port=c.port,c.query&&(b.query=c.query));this.secure=null!=b.secure?b.secure:f.location&&"https:"==location.protocol;b.host&&(c=b.host.split(":"),b.hostname=c.shift(),c.length?b.port=c.pop():b.port||(b.port=this.secure?"443":"80"));this.agent=b.agent||!1;this.hostname=b.hostname||(f.location?location.hostname:"localhost");this.port=b.port||
(f.location&&location.port?location.port:this.secure?443:80);this.query=b.query||{};"string"==typeof this.query&&(this.query=ha.decode(this.query));this.upgrade=!1!==b.upgrade;this.path=(b.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!b.forceJSONP;this.jsonp=!1!==b.jsonp;this.forceBase64=!!b.forceBase64;this.enablesXDR=!!b.enablesXDR;this.timestampParam=b.timestampParam||"t";this.timestampRequests=b.timestampRequests;this.transports=b.transports||["polling","websocket"];this.readyState=
"";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=b.policyPort||843;this.rememberUpgrade=b.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=b.onlyBinaryUpgrades;this.pfx=b.pfx||null;this.key=b.key||null;this.passphrase=b.passphrase||null;this.cert=b.cert||null;this.ca=b.ca||null;this.ciphers=b.ciphers||null;this.rejectUnauthorized=b.rejectUnauthorized||null;this.open()}var e=c("./transports"),q=c("component-emitter"),r=c("debug")("engine.io-client:socket"),n=c("indexof"),
u=c("engine.io-parser"),K=c("parseuri"),v=c("parsejson"),ha=c("parseqs");b.exports=d;d.priorWebsocketSuccess=!1;q(d.prototype);d.protocol=u.protocol;d.Socket=d;d.Transport=c("./transport");d.transports=c("./transports");d.parser=c("engine.io-parser");d.prototype.createTransport=function(c){r('creating transport "%s"',c);var b=this.query,d={},f;for(f in b)b.hasOwnProperty(f)&&(d[f]=b[f]);d.EIO=u.protocol;d.transport=c;this.id&&(d.sid=this.id);return new e[c]({agent:this.agent,hostname:this.hostname,
port:this.port,secure:this.secure,path:this.path,query:d,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})};d.prototype.open=function(){if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))var c=
"websocket";else{if(0==this.transports.length){var b=this;setTimeout(function(){b.emit("error","No transports available")},0);return}c=this.transports[0]}this.readyState="opening";try{c=this.createTransport(c)}catch(ca){this.transports.shift();this.open();return}c.open();this.setTransport(c)};d.prototype.setTransport=function(c){r("setting transport %s",c.name);var b=this;this.transport&&(r("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=c;
c.on("drain",function(){b.onDrain()}).on("packet",function(c){b.onPacket(c)}).on("error",function(c){b.onError(c)}).on("close",function(){b.onClose("transport close")})};d.prototype.probe=function(c){function b(){if(v.onlyBinaryUpgrades){var b=!this.supportsBinary&&v.transport.supportsBinary;K=K||b}K||(r('probe transport "%s" opened',c),u.send([{type:"ping",data:"probe"}]),u.once("packet",function(b){K||("pong"==b.type&&"probe"==b.data?(r('probe transport "%s" pong',c),v.upgrading=!0,v.emit("upgrading",
u),u&&(d.priorWebsocketSuccess="websocket"==u.name,r('pausing current transport "%s"',v.transport.name),v.transport.pause(function(){K||"closed"==v.readyState||(r("changing transport and sending upgrade packet"),n(),v.setTransport(u),u.send([{type:"upgrade"}]),v.emit("upgrade",u),u=null,v.upgrading=!1,v.flush())}))):(r('probe transport "%s" failed',c),b=Error("probe error"),b.transport=u.name,v.emit("upgradeError",b)))}))}function f(){K||(K=!0,n(),u.close(),u=null)}function e(b){var d=Error("probe error: "+
b);d.transport=u.name;f();r('probe transport "%s" failed because of error: %s',c,b);v.emit("upgradeError",d)}function k(){e("transport closed")}function l(){e("socket closed")}function q(c){u&&c.name!=u.name&&(r('"%s" works - aborting "%s"',c.name,u.name),f())}function n(){u.removeListener("open",b);u.removeListener("error",e);u.removeListener("close",k);v.removeListener("close",l);v.removeListener("upgrading",q)}r('probing transport "%s"',c);var u=this.createTransport(c,{probe:1}),K=!1,v=this;d.priorWebsocketSuccess=
!1;u.once("open",b);u.once("error",e);u.once("close",k);this.once("close",l);this.once("upgrading",q);u.open()};d.prototype.onOpen=function(){r("socket open");this.readyState="open";d.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){r("starting upgrade probes");for(var c=0,b=this.upgrades.length;c<b;c++)this.probe(this.upgrades[c])}};d.prototype.onPacket=function(c){if("opening"==this.readyState||
"open"==this.readyState)switch(r('socket receive: type "%s", data "%s"',c.type,c.data),this.emit("packet",c),this.emit("heartbeat"),c.type){case "open":this.onHandshake(v(c.data));break;case "pong":this.setPing();break;case "error":var b=Error("server error");b.code=c.data;this.emit("error",b);break;case "message":this.emit("data",c.data),this.emit("message",c.data)}else r('packet received with socket readyState "%s"',this.readyState)};d.prototype.onHandshake=function(c){this.emit("handshake",c);
this.id=c.sid;this.transport.query.sid=c.sid;this.upgrades=this.filterUpgrades(c.upgrades);this.pingInterval=c.pingInterval;this.pingTimeout=c.pingTimeout;this.onOpen();"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};d.prototype.onHeartbeat=function(c){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){if("closed"!=b.readyState)b.onClose("ping timeout")},c||b.pingInterval+b.pingTimeout)};
d.prototype.setPing=function(){var c=this;clearTimeout(c.pingIntervalTimer);c.pingIntervalTimer=setTimeout(function(){r("writing ping packet - expecting pong within %sms",c.pingTimeout);c.ping();c.onHeartbeat(c.pingTimeout)},c.pingInterval)};d.prototype.ping=function(){this.sendPacket("ping")};d.prototype.onDrain=function(){for(var c=0;c<this.prevBufferLen;c++)if(this.callbackBuffer[c])this.callbackBuffer[c]();this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);
this.prevBufferLen=0;0==this.writeBuffer.length?this.emit("drain"):this.flush()};d.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(r("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};d.prototype.write=d.prototype.send=function(c,b){this.sendPacket("message",c,b);return this};d.prototype.sendPacket=function(c,b,d){"closing"!=
this.readyState&&"closed"!=this.readyState&&(c={type:c,data:b},this.emit("packetCreate",c),this.writeBuffer.push(c),this.callbackBuffer.push(d),this.flush())};d.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){var c=function(){f.once("upgrade",b);f.once("upgradeError",b)},b=function(){f.removeListener("upgrade",b);f.removeListener("upgradeError",b);d()},d=function(){f.onClose("forced close");r("socket closing - telling transport to close");f.transport.close()};this.readyState=
"closing";var f=this;if(this.writeBuffer.length)this.once("drain",function(){this.upgrading?c():d()});else this.upgrading?c():d()}return this};d.prototype.onError=function(c){r("socket error %j",c);d.priorWebsocketSuccess=!1;this.emit("error",c);this.onClose("transport error",c)};d.prototype.onClose=function(c,b){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){r('socket close with reason: "%s"',c);var d=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);
setTimeout(function(){d.writeBuffer=[];d.callbackBuffer=[];d.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",c,b)}};d.prototype.filterUpgrades=function(c){for(var b=[],d=0,f=c.length;d<f;d++)~n(this.transports,c[d])&&b.push(c[d]);return b}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./transport":14,
"./transports":15,"component-emitter":8,debug:21,"engine.io-parser":24,indexof:32,parsejson:40,parseqs:41,parseuri:23}],14:[function(c,b,d){function f(c){this.path=c.path;this.hostname=c.hostname;this.port=c.port;this.secure=c.secure;this.query=c.query;this.timestampParam=c.timestampParam;this.timestampRequests=c.timestampRequests;this.readyState="";this.agent=c.agent||!1;this.socket=c.socket;this.enablesXDR=c.enablesXDR;this.pfx=c.pfx;this.key=c.key;this.passphrase=c.passphrase;this.cert=c.cert;
this.ca=c.ca;this.ciphers=c.ciphers;this.rejectUnauthorized=c.rejectUnauthorized}var e=c("engine.io-parser");c=c("component-emitter");b.exports=f;c(f.prototype);f.timestamps=0;f.prototype.onError=function(c,b){c=Error(c);c.type="TransportError";c.description=b;this.emit("error",c);return this};f.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this};f.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),
this.onClose();return this};f.prototype.send=function(c){if("open"==this.readyState)this.write(c);else throw Error("Transport not open");};f.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};f.prototype.onData=function(c){c=e.decodePacket(c,this.socket.binaryType);this.onPacket(c)};f.prototype.onPacket=function(c){this.emit("packet",c)};f.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,"engine.io-parser":24}],15:[function(c,
b,d){(function(b){var f=c("xmlhttprequest"),e=c("./polling-xhr"),q=c("./polling-jsonp"),r=c("./websocket");d.polling=function(c){var d=!1,k=!1,l=!1!==c.jsonp;b.location&&(k="https:"==location.protocol,(d=location.port)||(d=k?443:80),d=c.hostname!=location.hostname||d!=c.port,k=c.secure!=k);c.xdomain=d;c.xscheme=k;if("open"in new f(c)&&!c.forceJSONP)return new e(c);if(!l)throw Error("JSONP disabled");return new q(c)};d.websocket=r}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(c,b,d){(function(d){function f(){}function e(c){q.call(this,c);this.query=this.query||{};K||(d.___eio||(d.___eio=[]),K=d.___eio);this.index=K.length;var b=this;K.push(function(c){b.onData(c)});this.query.j=this.index;d.document&&d.addEventListener&&d.addEventListener("beforeunload",function(){b.script&&(b.script.onerror=f)},!1)}var q=c("./polling"),r=c("component-inherit");
b.exports=e;var n=/\n/g,u=/\\n/g,K;r(e,q);e.prototype.supportsBinary=!1;e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.iframe=this.form=null);q.prototype.doClose.call(this)};e.prototype.doPoll=function(){var c=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.uri();b.onerror=function(b){c.onError("jsonp poll error",
b)};var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d);this.script=b;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var c=document.createElement("iframe");document.body.appendChild(c);document.body.removeChild(c)},100)};e.prototype.doWrite=function(c,b){function d(){f();b()}function f(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(og){e.onError("jsonp polling iframe removal error",og)}try{r=document.createElement('<iframe src="javascript:0" name="'+
e.iframeId+'">')}catch(og){r=document.createElement("iframe"),r.name=e.iframeId,r.src="javascript:0"}r.id=e.iframeId;e.form.appendChild(r);e.iframe=r}var e=this;if(!this.form){var k=document.createElement("form"),l=document.createElement("textarea"),q=this.iframeId="eio_iframe_"+this.index,r;k.className="socketio";k.style.position="absolute";k.style.top="-1000px";k.style.left="-1000px";k.target=q;k.method="POST";k.setAttribute("accept-charset","utf-8");l.name="d";k.appendChild(l);document.body.appendChild(k);
this.form=k;this.area=l}this.form.action=this.uri();f();c=c.replace(u,"\\\n");this.area.value=c.replace(n,"\\n");try{this.form.submit()}catch(og){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==e.iframe.readyState&&d()}:this.iframe.onload=d}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-inherit":9}],17:[function(c,b,d){(function(d){function f(){}function e(c){u.call(this,
c);if(d.location){var b="https:"==location.protocol,f=location.port;f||(f=b?443:80);this.xd=c.hostname!=d.location.hostname||f!=c.port;this.xs=c.secure!=b}}function q(c){this.method=c.method||"GET";this.uri=c.uri;this.xd=!!c.xd;this.xs=!!c.xs;this.async=!1!==c.async;this.data=void 0!=c.data?c.data:null;this.agent=c.agent;this.isBinary=c.isBinary;this.supportsBinary=c.supportsBinary;this.enablesXDR=c.enablesXDR;this.pfx=c.pfx;this.key=c.key;this.passphrase=c.passphrase;this.cert=c.cert;this.ca=c.ca;
this.ciphers=c.ciphers;this.rejectUnauthorized=c.rejectUnauthorized;this.create()}function r(){for(var c in q.requests)q.requests.hasOwnProperty(c)&&q.requests[c].abort()}var n=c("xmlhttprequest"),u=c("./polling"),K=c("component-emitter"),v=c("component-inherit"),ha=c("debug")("engine.io-client:polling-xhr");b.exports=e;b.exports.Request=q;v(e,u);e.prototype.supportsBinary=!0;e.prototype.request=function(c){c=c||{};c.uri=this.uri();c.xd=this.xd;c.xs=this.xs;c.agent=this.agent||!1;c.supportsBinary=
this.supportsBinary;c.enablesXDR=this.enablesXDR;c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;return new q(c)};e.prototype.doWrite=function(c,b){c=this.request({method:"POST",data:c,isBinary:"string"!==typeof c&&void 0!==c});var d=this;c.on("success",b);c.on("error",function(c){d.onError("xhr post error",c)});this.sendXhr=c};e.prototype.doPoll=function(){ha("xhr poll");var c=this.request(),
b=this;c.on("data",function(c){b.onData(c)});c.on("error",function(c){b.onError("xhr poll error",c)});this.pollXhr=c};K(q.prototype);q.prototype.create=function(){var c={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;var b=this.xhr=new n(c),f=this;try{ha("xhr open %s: %s",this.method,this.uri);b.open(this.method,
this.uri,this.async);this.supportsBinary&&(b.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?b.setRequestHeader("Content-type","application/octet-stream"):b.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Ob){}"withCredentials"in b&&(b.withCredentials=!0);this.hasXDR()?(b.onload=function(){f.onLoad()},b.onerror=function(){f.onError(b.responseText)}):b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status||1223==b.status)f.onLoad();else setTimeout(function(){f.onError(b.status)},
0)};ha("xhr data %s",this.data);b.send(this.data)}catch(Ob){setTimeout(function(){f.onError(Ob)},0);return}d.document&&(this.index=q.requestsCount++,q.requests[this.index]=this)};q.prototype.onSuccess=function(){this.emit("success");this.cleanup()};q.prototype.onData=function(c){this.emit("data",c);this.onSuccess()};q.prototype.onError=function(c){this.emit("error",c);this.cleanup(!0)};q.prototype.cleanup=function(c){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=
this.xhr.onerror=f:this.xhr.onreadystatechange=f;if(c)try{this.xhr.abort()}catch(Ha){}d.document&&delete q.requests[this.index];this.xhr=null}};q.prototype.onLoad=function(){try{try{var c=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(ca){}var b="application/octet-stream"===c?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(ca){this.onError(ca)}if(null!=b)this.onData(b)};q.prototype.hasXDR=function(){return"undefined"!==typeof d.XDomainRequest&&!this.xs&&this.enablesXDR};
q.prototype.abort=function(){this.cleanup()};d.document&&(q.requestsCount=0,q.requests={},d.attachEvent?d.attachEvent("onunload",r):d.addEventListener&&d.addEventListener("beforeunload",r,!1))}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-emitter":8,"component-inherit":9,debug:21,xmlhttprequest:20}],18:[function(c,b,d){function f(c){var b=c&&c.forceBase64;if(!n||b)this.supportsBinary=!1;e.call(this,
c)}var e=c("../transport"),l=c("parseqs"),q=c("engine.io-parser");d=c("component-inherit");var r=c("debug")("engine.io-client:polling");b.exports=f;var n=null!=(new (c("xmlhttprequest"))({xdomain:!1})).responseType;d(f,e);f.prototype.name="polling";f.prototype.doOpen=function(){this.poll()};f.prototype.pause=function(c){function b(){r("paused");d.readyState="paused";c()}var d=this;this.readyState="pausing";if(this.polling||!this.writable){var f=0;this.polling&&(r("we are currently polling - waiting to pause"),
f++,this.once("pollComplete",function(){r("pre-pause polling complete");--f||b()}));this.writable||(r("we are currently writing - waiting to pause"),f++,this.once("drain",function(){r("pre-pause writing complete");--f||b()}))}else b()};f.prototype.poll=function(){r("polling");this.polling=!0;this.doPoll();this.emit("poll")};f.prototype.onData=function(c){var b=this;r("polling got data %s",c);q.decodePayload(c,this.socket.binaryType,function(c,d,f){if("opening"==b.readyState)b.onOpen();if("close"==
c.type)return b.onClose(),!1;b.onPacket(c)});"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():r('ignoring poll - transport state "%s"',this.readyState))};f.prototype.doClose=function(){function c(){r("writing close packet");b.write([{type:"close"}])}var b=this;"open"==this.readyState?(r("transport open - closing"),c()):(r("transport not open - deferring close"),this.once("open",c))};f.prototype.write=function(c){var b=this;this.writable=!1;
var d=function(){b.writable=!0;b.emit("drain")};b=this;q.encodePayload(c,this.supportsBinary,function(c){b.doWrite(c,d)})};f.prototype.uri=function(){var c=this.query||{},b=this.secure?"https":"http",d="";!1!==this.timestampRequests&&(c[this.timestampParam]=+new Date+"-"+e.timestamps++);this.supportsBinary||c.sid||(c.b64=1);c=l.encode(c);this.port&&("https"==b&&443!=this.port||"http"==b&&80!=this.port)&&(d=":"+this.port);c.length&&(c="?"+c);return b+"://"+this.hostname+d+this.path+c}},{"../transport":14,
"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,xmlhttprequest:20}],19:[function(c,b,d){function f(c){c&&c.forceBase64&&(this.supportsBinary=!1);e.call(this,c)}var e=c("../transport"),l=c("engine.io-parser"),q=c("parseqs");d=c("component-inherit");var r=c("debug")("engine.io-client:websocket"),n=c("ws");b.exports=f;d(f,e);f.prototype.name="websocket";f.prototype.supportsBinary=!0;f.prototype.doOpen=function(){if(this.check()){var c=this.uri(),b={agent:this.agent};b.pfx=this.pfx;b.key=
this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;this.ws=new n(c,void 0,b);void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.binaryType="arraybuffer";this.addEventListeners()}};f.prototype.addEventListeners=function(){var c=this;this.ws.onopen=function(){c.onOpen()};this.ws.onclose=function(){c.onClose()};this.ws.onmessage=function(b){c.onData(b.data)};this.ws.onerror=function(b){c.onError("websocket error",
b)}};"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(f.prototype.onData=function(c){var b=this;setTimeout(function(){e.prototype.onData.call(b,c)},0)});f.prototype.write=function(c){var b=this;this.writable=!1;for(var d=0,f=c.length;d<f;d++)l.encodePacket(c[d],this.supportsBinary,function(c){try{b.ws.send(c)}catch(Ha){r("websocket closed before onclose event")}});setTimeout(function(){b.writable=!0;b.emit("drain")},0)};f.prototype.onClose=function(){e.prototype.onClose.call(this)};
f.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()};f.prototype.uri=function(){var c=this.query||{},b=this.secure?"wss":"ws",d="";this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(d=":"+this.port);this.timestampRequests&&(c[this.timestampParam]=+new Date);this.supportsBinary||(c.b64=1);c=q.encode(c);c.length&&(c="?"+c);return b+"://"+this.hostname+d+this.path+c};f.prototype.check=function(){return!!n&&!("__initialize"in n&&this.name===f.prototype.name)}},{"../transport":14,
"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,ws:66}],20:[function(c,b,d){var f=c("has-cors");b.exports=function(c){var b=c.xdomain,d=c.xscheme;c=c.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!b||f))return new XMLHttpRequest}catch(r){}try{if("undefined"!=typeof XDomainRequest&&!d&&c)return new XDomainRequest}catch(r){}if(!b)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(r){}}},{"has-cors":31}],21:[function(c,b,d){function f(){try{var c=localStorage.debug}catch(l){}return c}
d=b.exports=c("./debug");d.log=function(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)};d.formatArgs=function(){var c=arguments,b=this.useColors;c[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+c[0]+(b?"%c ":" ")+"+"+d.humanize(this.diff);if(!b)return c;b="color: "+this.color;c=[c[0],b,"color: inherit"].concat(Array.prototype.slice.call(c,1));var f=0,e=0;c[0].replace(/%[a-z%]/g,function(c){"%%"!==c&&(f++,"%c"===c&&(e=f))});
c.splice(e,0,b);return c};d.save=function(c){try{null==c?localStorage.removeItem("debug"):localStorage.debug=c}catch(l){}};d.load=f;d.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)};d.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");d.formatters.j=function(c){return JSON.stringify(c)};
d.enable(f())},{"./debug":22}],22:[function(c,b,d){d=b.exports=function(c){function b(){}function k(){var c=+new Date;k.diff=c-(e||c);k.prev=e;e=k.curr=c;null==k.useColors&&(k.useColors=d.useColors());null==k.color&&k.useColors&&(k.color=d.colors[f++%d.colors.length]);var b=Array.prototype.slice.call(arguments);b[0]=d.coerce(b[0]);"string"!==typeof b[0]&&(b=["%o"].concat(b));var l=0;b[0]=b[0].replace(/%([a-z%])/g,function(c,f){if("%%"===c)return c;l++;f=d.formatters[f];"function"===typeof f&&(c=f.call(k,
b[l]),b.splice(l,1),l--);return c});"function"===typeof d.formatArgs&&(b=d.formatArgs.apply(k,b));(k.log||d.log||console.log.bind(console)).apply(k,b)}b.enabled=!1;k.enabled=!0;var l=d.enabled(c)?k:b;l.namespace=c;return l};d.coerce=function(c){return c instanceof Error?c.stack||c.message:c};d.disable=function(){d.enable("")};d.enable=function(c){d.save(c);for(var b=(c||"").split(/[\s,]+/),f=b.length,e=0;e<f;e++)b[e]&&(c=b[e].replace(/\*/g,".*?"),"-"===c[0]?d.skips.push(new RegExp("^"+c.substr(1)+
"$")):d.names.push(new RegExp("^"+c+"$")))};d.enabled=function(c){var b;var f=0;for(b=d.skips.length;f<b;f++)if(d.skips[f].test(c))return!1;f=0;for(b=d.names.length;f<b;f++)if(d.names[f].test(c))return!0;return!1};d.humanize=c("ms");d.names=[];d.skips=[];d.formatters={};var f=0,e},{ms:38}],23:[function(c,b,d){var f=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
e="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");b.exports=function(c){var b=c,d=c.indexOf("["),k=c.indexOf("]");-1!=d&&-1!=k&&(c=c.substring(0,d)+c.substring(d,k).replace(/:/g,";")+c.substring(k,c.length));c=f.exec(c||"");for(var l={},K=14;K--;)l[e[K]]=c[K]||"";-1!=d&&-1!=k&&(l.source=b,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=
!0);return l}},{}],24:[function(c,b,d){(function(b){function f(c,b,f){if(!b)return d.encodeBase64Packet(c,f);var e=new FileReader;e.onload=function(){c.data=e.result;d.encodePacket(c,b,!0,f)};return e.readAsArrayBuffer(c.data)}function e(c,b,d){var f=Array(c.length);d=K(c.length,d);for(var e=function(c,d,e){b(d,function(b,d){f[c]=d;e(b,f)})},k=0;k<c.length;k++)e(k,c[k],d)}var q=c("./keys"),r=c("has-binary"),n=c("arraybuffer.slice"),u=c("base64-arraybuffer"),K=c("after"),v=c("utf8"),ha=navigator.userAgent.match(/Android/i),
h=/PhantomJS/i.test(navigator.userAgent),m=ha||h;d.protocol=3;var ca=d.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=q(ca),ya={type:"error",data:"parser error"},L=c("blob");d.encodePacket=function(c,e,k,l){"function"==typeof e&&(l=e,e=!1);"function"==typeof k&&(l=k,k=null);var q=void 0===c.data?void 0:c.data.buffer||c.data;if(b.ArrayBuffer&&q instanceof ArrayBuffer){if(e){k=c.data;e=new Uint8Array(k);k=new Uint8Array(1+k.byteLength);k[0]=ca[c.type];for(c=0;c<e.length;c++)k[c+
1]=e[c];c=l(k.buffer)}else c=d.encodeBase64Packet(c,l);return c}if(L&&q instanceof b.Blob)return e?m?c=f(c,e,l):(e=new Uint8Array(1),e[0]=ca[c.type],c=new L([e.buffer,c.data]),c=l(c)):c=d.encodeBase64Packet(c,l),c;if(q&&q.base64)return l("b"+d.packets[c.type]+c.data.data);e=ca[c.type];void 0!==c.data&&(e+=k?v.encode(String(c.data)):String(c.data));return l(""+e)};d.encodeBase64Packet=function(c,f){var e="b"+d.packets[c.type];if(L&&c.data instanceof L){var k=new FileReader;k.onload=function(){var c=
k.result.split(",")[1];f(e+c)};return k.readAsDataURL(c.data)}try{var l=String.fromCharCode.apply(null,new Uint8Array(c.data))}catch(cm){c=new Uint8Array(c.data);l=Array(c.length);for(var q=0;q<c.length;q++)l[q]=c[q];l=String.fromCharCode.apply(null,l)}e+=b.btoa(l);return f(e)};d.decodePacket=function(c,b,f){if("string"==typeof c||void 0===c){if("b"==c.charAt(0))return d.decodeBase64Packet(c.substr(1),b);if(f)try{c=v.decode(c)}catch(bm){return ya}f=c.charAt(0);return Number(f)==f&&p[f]?1<c.length?
{type:p[f],data:c.substring(1)}:{type:p[f]}:ya}f=(new Uint8Array(c))[0];c=n(c,1);L&&"blob"===b&&(c=new L([c]));return{type:p[f],data:c}};d.decodeBase64Packet=function(c,d){var f=p[c.charAt(0)];if(!b.ArrayBuffer)return{type:f,data:{base64:!0,data:c.substr(1)}};c=u.decode(c.substr(1));"blob"===d&&L&&(c=new L([c]));return{type:f,data:c}};d.encodePayload=function(c,b,f){"function"==typeof b&&(f=b,b=null);var k=r(c);if(b&&k)return L&&!m?d.encodePayloadAsBlob(c,f):d.encodePayloadAsArrayBuffer(c,f);if(!c.length)return f("0:");
e(c,function(c,f){d.encodePacket(c,k?b:!1,!0,function(c){f(null,c.length+":"+c)})},function(c,b){return f(b.join(""))})};d.decodePayload=function(c,b,f){if("string"!=typeof c)return d.decodePayloadAsBinary(c,b,f);"function"===typeof b&&(f=b,b=null);if(""==c)return f(ya,0,1);var e="";for(var k,l,q=0,r=c.length;q<r;q++)if(l=c.charAt(q),":"!=l)e+=l;else{if(""==e||e!=(k=Number(e)))return f(ya,0,1);l=c.substr(q+1,k);if(e!=l.length)return f(ya,0,1);if(l.length){e=d.decodePacket(l,b,!0);if(ya.type==e.type&&
ya.data==e.data)return f(ya,0,1);if(!1===f(e,q+k,r))return}q+=k;e=""}if(""!=e)return f(ya,0,1)};d.encodePayloadAsArrayBuffer=function(c,b){if(!c.length)return b(new ArrayBuffer(0));e(c,function(c,b){d.encodePacket(c,!0,!0,function(c){return b(null,c)})},function(c,d){c=d.reduce(function(c,b){b="string"===typeof b?b.length:b.byteLength;return c+b.toString().length+b+2},0);var f=new Uint8Array(c),e=0;d.forEach(function(c){var b="string"===typeof c,d=c;if(b){d=new Uint8Array(c.length);for(var k=0;k<
c.length;k++)d[k]=c.charCodeAt(k);d=d.buffer}b?f[e++]=0:f[e++]=1;c=d.byteLength.toString();for(k=0;k<c.length;k++)f[e++]=parseInt(c[k]);f[e++]=255;d=new Uint8Array(d);for(k=0;k<d.length;k++)f[e++]=d[k]});return b(f.buffer)})};d.encodePayloadAsBlob=function(c,b){e(c,function(c,b){d.encodePacket(c,!0,!0,function(c){var d=new Uint8Array(1);d[0]=1;if("string"===typeof c){for(var f=new Uint8Array(c.length),e=0;e<c.length;e++)f[e]=c.charCodeAt(e);c=f.buffer;d[0]=0}f=(c instanceof ArrayBuffer?c.byteLength:
c.size).toString();var k=new Uint8Array(f.length+1);for(e=0;e<f.length;e++)k[e]=parseInt(f[e]);k[f.length]=255;L&&(c=new L([d.buffer,k.buffer,c]),b(null,c))})},function(c,d){return b(new L(d))})};d.decodePayloadAsBinary=function(c,b,f){"function"===typeof b&&(f=b,b=null);for(var e=[],k=!1;0<c.byteLength;){for(var l=new Uint8Array(c),q=0===l[0],r="",u=1;255!=l[u];u++){if(310<r.length){k=!0;break}r+=l[u]}if(k)return f(ya,0,1);c=n(c,2+r.length);r=parseInt(r);l=n(c,0,r);if(q)try{l=String.fromCharCode.apply(null,
new Uint8Array(l))}catch(dm){for(q=new Uint8Array(l),l="",u=0;u<q.length;u++)l+=String.fromCharCode(q[u])}e.push(l);c=n(c,r)}var K=e.length;e.forEach(function(c,e){f(d.decodePacket(c,b,!0),e,K)})}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./keys":25,after:1,"arraybuffer.slice":2,"base64-arraybuffer":5,blob:6,"has-binary":30,utf8:60}],25:[function(c,b,d){b.exports=Object.keys||function(c){var b=[],d=Object.prototype.hasOwnProperty,
f;for(f in c)d.call(c,f)&&b.push(f);return b}},{}],26:[function(c,b,d){function f(c){l.call(this);c=c||{};this.config={chunksize:16384,pacing:0};for(var b in c)this.config[b]=c[b];this.channel=this.file=null}function e(){l.call(this);this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null}var l=c("wildemitter");c=c("util");c.inherits(f,l);f.prototype.send=function(c,b){var d=this;this.file=c;this.channel=b;var f="number"!==typeof b.bufferedAmountLowThreshold,e=0,k=function(){var l=
new window.FileReader;l.onload=function(){return function(l){d.channel.send(l.target.result);d.emit("progress",e,c.size,l.target.result);c.size>e+l.target.result.byteLength?f?window.setTimeout(k,d.config.pacing):b.bufferedAmount<=b.bufferedAmountLowThreshold&&window.setTimeout(k,0):(d.emit("progress",c.size,c.size,null),d.emit("sentFile"));e+=d.config.chunksize}}(c);var q=c.slice(e,e+d.config.chunksize);l.readAsArrayBuffer(q)};f||(b.bufferedAmountLowThreshold=8*this.config.chunksize,b.addEventListener("bufferedamountlow",
k));window.setTimeout(k,0)};c.inherits(e,l);e.prototype.receive=function(c,b){var d=this;c&&(this.metadata=c);this.channel=b;b.binaryType="arraybuffer";this.channel.onmessage=function(c){d.received+=c.data.byteLength;d.receiveBuffer.push(c.data);d.emit("progress",d.received,d.metadata.size,c.data);d.received===d.metadata.size?(d.emit("receivedFile",new window.Blob(d.receiveBuffer),d.metadata),d.receiveBuffer=[]):d.received>d.metadata.size&&(console.error("received more than expected, discarding..."),
d.receiveBuffer=[])}};b.exports={};b.exports.support="undefined"!==typeof window&&window&&window.File&&window.FileReader&&window.Blob;b.exports.Sender=f;b.exports.Receiver=e},{util:63,wildemitter:65}],27:[function(c,b,d){var f={};b.exports=function(c,b){var d=2===arguments.length,e=d?b:c;if("undefined"===typeof window||"http:"===window.location.protocol){var k=Error("NavigatorUserMediaError");k.name="HTTPS_REQUIRED";return e(k)}if(window.navigator.userAgent.match("Chrome")){var l=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],
10),K=33,v=!window.chrome.webstore;window.navigator.userAgent.match("Linux")&&(K=35);sessionStorage.getScreenMediaJSExtensionId?chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(b){b&&""!==b.sourceId?(c=d&&c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}},c.video.mandatory.chromeMediaSourceId=b.sourceId,window.navigator.mediaDevices.getUserMedia(c).then(function(c){e(null,
c)}).catch(function(c){e(c)})):(b=Error("NavigatorUserMediaError"),b.name="NotAllowedError",e(b))}):window.cefGetScreenMedia?window.cefGetScreenMedia(function(b){b?(c=d&&c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},c.video.mandatory.chromeMediaSourceId=b,window.navigator.mediaDevices.getUserMedia(c).then(function(c){e(null,c)}).catch(function(c){e(c)})):
(b=Error("cefGetScreenMediaError"),b.name="CEF_GETSCREENMEDIA_CANCELED",e(b))}):v||26<=l&&l<=K?(c=d&&c||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},window.navigator.mediaDevices.getUserMedia(c).then(function(c){e(null,c)}).catch(function(c){e(c)})):(l=window.setTimeout(function(){k=Error("NavigatorUserMediaError");k.name="EXTENSION_UNAVAILABLE";return e(k)},1E3),f[l]=[e,d?c:null],window.postMessage({type:"getScreen",
id:l},"*"))}else window.navigator.userAgent.match("Firefox")&&(33<=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)?(c=d&&c||{video:{mozMediaSource:"window",mediaSource:"window"}},window.navigator.mediaDevices.getUserMedia(c).then(function(c){e(null,c);var b=c.currentTime,d=window.setInterval(function(){c||window.clearInterval(d);if(c.currentTime==b&&(window.clearInterval(d),c.onended))c.onended();b=c.currentTime},500)}).catch(function(c){e(c)})):(k=Error("NavigatorUserMediaError"),
k.name="EXTENSION_UNAVAILABLE"))};"undefined"!==typeof window&&window.addEventListener("message",function(c){if(c.origin==window.location.origin)if("gotScreen"==c.data.type&&f[c.data.id]){var b=f[c.data.id],d=b[1],e=b[0];delete f[c.data.id];""===c.data.sourceId?(c=Error("NavigatorUserMediaError"),c.name="NotAllowedError",e(c)):(d=d||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},
d.video.mandatory.chromeMediaSourceId=c.data.sourceId,window.navigator.mediaDevices.getUserMedia(d).then(function(c){e(null,c)}).catch(function(c){e(c)}))}else"getScreenPending"==c.data.type&&window.clearTimeout(c.data.id)})},{}],28:[function(c,b,d){b.exports=function(){return this}()},{}],29:[function(c,b,d){var f=c("wildemitter"),e;"undefined"!==typeof window&&(e=window.AudioContext||window.webkitAudioContext);var l=null;b.exports=function(c,b){var d=new f;if(!e)return d;b=b||{};var k=b.smoothing||
.1,q=b.interval||50,r=b.threshold,ha=b.play;b=b.history||10;var h=!0;l||(l=new e);var m=l.createAnalyser();m.fftSize=512;m.smoothingTimeConstant=k;var ca=new Float32Array(m.frequencyBinCount);c.jquery&&(c=c[0]);if(c instanceof HTMLAudioElement||c instanceof HTMLVideoElement){var p=l.createMediaElementSource(c);"undefined"===typeof ha&&(ha=!0)}else p=l.createMediaStreamSource(c);r=r||-50;p.connect(m);ha&&m.connect(l.destination);d.speaking=!1;d.setThreshold=function(c){r=c};d.setInterval=function(c){q=
c};d.stop=function(){h=!1;d.emit("volume_change",-100,r);d.speaking&&(d.speaking=!1,d.emit("stopped_speaking"));m.disconnect();p.disconnect()};d.speakingHistory=[];for(c=0;c<b;c++)d.speakingHistory.push(0);var ya=function(){setTimeout(function(){if(h){var c=-Infinity;m.getFloatFrequencyData(ca);for(var b=4,f=ca.length;b<f;b++)ca[b]>c&&0>ca[b]&&(c=ca[b]);d.emit("volume_change",c,r);b=0;if(c>r&&!d.speaking){for(f=d.speakingHistory.length-3;f<d.speakingHistory.length;f++)b+=d.speakingHistory[f];2<=b&&
(d.speaking=!0,d.emit("speaking"))}else if(c<r&&d.speaking){for(f=0;f<d.speakingHistory.length;f++)b+=d.speakingHistory[f];0==b&&(d.speaking=!1,d.emit("stopped_speaking"))}d.speakingHistory.shift();d.speakingHistory.push(0+(c>r));ya()}},q)};ya();return d}},{wildemitter:65}],30:[function(c,b,d){(function(d){var f=c("isarray");b.exports=function(c){function b(c){if(!c)return!1;if(d.Buffer&&d.Buffer.isBuffer(c)||d.ArrayBuffer&&c instanceof ArrayBuffer||d.Blob&&c instanceof Blob||d.File&&c instanceof
File)return!0;if(f(c))for(var e=0;e<c.length;e++){if(b(c[e]))return!0}else if(c&&"object"==typeof c)for(e in c.toJSON&&(c=c.toJSON()),c)if(Object.prototype.hasOwnProperty.call(c,e)&&b(c[e]))return!0;return!1}return b(c)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{isarray:33}],31:[function(c,b,d){c=c("global");try{b.exports="XMLHttpRequest"in c&&"withCredentials"in new c.XMLHttpRequest}catch(f){b.exports=!1}},{global:28}],
32:[function(c,b,d){var f=[].indexOf;b.exports=function(c,b){if(f)return c.indexOf(b);for(var d=0;d<c.length;++d)if(c[d]===b)return d;return-1}},{}],33:[function(c,b,d){b.exports=Array.isArray||function(c){return"[object Array]"==Object.prototype.toString.call(c)}},{}],34:[function(c,b,d){(function(c){function b(c){if(b[c]!==r)return b[c];if("bug-string-char-index"==c)var d=!1;else if("json"==c)d=b("json-stringify")&&b("json-parse");else{var e;if("json-stringify"==c){d=u.stringify;var k="function"==
typeof d&&K;if(k){(e=function(){return 1}).toJSON=e;try{k="0"===d(0)&&"0"===d(new Number)&&'""'==d(new String)&&d(f)===r&&d(r)===r&&d()===r&&"1"===d(e)&&"[1]"==d([e])&&"[null]"==d([r])&&"null"==d(null)&&"[null,null,null]"==d([r,f,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==d({a:[e,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===d(null,e)&&"[\n 1,\n 2\n]"==d([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==d(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==d(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==
d(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==d(new Date(-1))}catch(hc){k=!1}}d=k}if("json-parse"==c){d=u.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){e=d('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var l=5==e.a.length&&1===e.a[0];if(l){try{l=!d('"\t"')}catch(hc){}if(l)try{l=1!==d("01")}catch(hc){}if(l)try{l=1!==d("1.")}catch(hc){}}}}catch(hc){l=!1}d=l}}return b[c]=!!d}var f={}.toString,e,r,n="object"==typeof JSON&&JSON,u="object"==typeof d&&d&&!d.nodeType&&d;u&&n?
(u.stringify=n.stringify,u.parse=n.parse):u=c.JSON=n||{};var K=new Date(-0xc782b5b800cec);try{K=-109252==K.getUTCFullYear()&&0===K.getUTCMonth()&&1===K.getUTCDate()&&10==K.getUTCHours()&&37==K.getUTCMinutes()&&6==K.getUTCSeconds()&&708==K.getUTCMilliseconds()}catch(em){}if(!b("json")){var v=b("bug-string-char-index");if(!K)var h=Math.floor,m=[0,31,59,90,120,151,181,212,243,273,304,334],Ha=function(c,b){return m[b]+365*(c-1970)+h((c-1969+(b=+(1<b)))/4)-h((c-1901+b)/100)+h((c-1601+b)/400)};(e={}.hasOwnProperty)||
(e=function(c){var b={};if((b.__proto__=null,b.__proto__={toString:1},b).toString!=f)e=function(c){var b=this.__proto__;c=c in(this.__proto__=null,this);this.__proto__=b;return c};else{var d=b.constructor;e=function(c){var b=(this.constructor||d).prototype;return c in this&&!(c in b&&this[c]===b[c])}}b=null;return e.call(this,c)});var ca={"boolean":1,number:1,string:1,undefined:1};var p=function(c,b){var d=0,k,l;(k=function(){this.valueOf=0}).prototype.valueOf=0;var q=new k;for(l in q)e.call(q,l)&&
d++;k=q=null;d?p=2==d?function(c,b){var d={},k="[object Function]"==f.call(c),l;for(l in c)k&&"prototype"==l||e.call(d,l)||!(d[l]=1)||!e.call(c,l)||b(l)}:function(c,b){var d="[object Function]"==f.call(c),k,l;for(k in c)d&&"prototype"==k||!e.call(c,k)||(l="constructor"===k)||b(k);(l||e.call(c,k="constructor"))&&b(k)}:(q="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),p=function(c,b){var d="[object Function]"==f.call(c),k,l;if(l=!d&&"function"!=
typeof c.constructor)l=typeof c.hasOwnProperty,l="object"==l?!!c.hasOwnProperty:!ca[l];l=l?c.hasOwnProperty:e;for(k in c)d&&"prototype"==k||!l.call(c,k)||b(k);for(d=q.length;k=q[--d];l.call(c,k)&&b(k));});return p(c,b)};if(!b("json-stringify")){var ya={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},L=function(c,b){return("000000"+(b||0)).slice(-c)},w=function(c){var b='"',d=0,f=c.length,e=10<f&&v,k;for(e&&(k=c.split(""));d<f;d++){var l=c.charCodeAt(d);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:b+=
ya[l];break;default:b=32>l?b+("\\u00"+L(2,l.toString(16))):b+(e?k[d]:v?c.charAt(d):c[d])}}return b+'"'},z=function(c,b,d,k,l,q,n){var u;try{var K=b[c]}catch(gm){}if("object"==typeof K&&K){var v=f.call(K);if("[object Date]"!=v||e.call(K,"toJSON"))"function"==typeof K.toJSON&&("[object Number]"!=v&&"[object String]"!=v&&"[object Array]"!=v||e.call(K,"toJSON"))&&(K=K.toJSON(c));else if(K>-1/0&&K<1/0){if(Ha){var ha=h(K/864E5);for(v=h(ha/365.2425)+1970-1;Ha(v+1,0)<=ha;v++);for(u=h((ha-Ha(v,0))/30.42);Ha(v,
u+1)<=ha;u++);ha=1+ha-Ha(v,u);var m=(K%864E5+864E5)%864E5;var ad=h(m/36E5)%24;var ca=h(m/6E4)%60;var ya=h(m/1E3)%60;m%=1E3}else v=K.getUTCFullYear(),u=K.getUTCMonth(),ha=K.getUTCDate(),ad=K.getUTCHours(),ca=K.getUTCMinutes(),ya=K.getUTCSeconds(),m=K.getUTCMilliseconds();K=(0>=v||1E4<=v?(0>v?"-":"+")+L(6,0>v?-v:v):L(4,v))+"-"+L(2,u+1)+"-"+L(2,ha)+"T"+L(2,ad)+":"+L(2,ca)+":"+L(2,ya)+"."+L(3,m)+"Z"}else K=null}d&&(K=d.call(b,c,K));if(null===K)return"null";v=f.call(K);if("[object Boolean]"==v)return""+
K;if("[object Number]"==v)return K>-1/0&&K<1/0?""+K:"null";if("[object String]"==v)return w(""+K);if("object"==typeof K){for(c=n.length;c--;)if(n[c]===K)throw TypeError();n.push(K);var t=[];b=q;q+=l;if("[object Array]"==v){u=0;for(c=K.length;u<c;u++)v=z(u,K,d,k,l,q,n),t.push(v===r?"null":v);c=t.length?l?"[\n"+q+t.join(",\n"+q)+"\n"+b+"]":"["+t.join(",")+"]":"[]"}else p(k||K,function(c){var b=z(c,K,d,k,l,q,n);b!==r&&t.push(w(c)+":"+(l?" ":"")+b)}),c=t.length?l?"{\n"+q+t.join(",\n"+q)+"\n"+b+"}":"{"+
t.join(",")+"}":"{}";n.pop();return c}};u.stringify=function(c,b,d){var e;if("function"==typeof b||"object"==typeof b&&b)if("[object Function]"==(e=f.call(b)))var k=b;else if("[object Array]"==e){var l={};for(var q=0,r=b.length,n;q<r;n=b[q++],(e=f.call(n),"[object String]"==e||"[object Number]"==e)&&(l[n]=1));}if(d)if("[object Number]"==(e=f.call(d))){if(0<(d-=d%1)){var u="";for(10<d&&(d=10);u.length<d;u+=" ");}}else"[object String]"==e&&(u=10>=d.length?d:d.slice(0,10));return z("",(n={},n[""]=c,
n),k,l,u,"",[])}}if(!b("json-parse")){var x=String.fromCharCode,y={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},t,A,D=function(){t=A=null;throw SyntaxError();},B=function(){for(var c=A,b=c.length,d,f,e,k,l;t<b;)switch(l=c.charCodeAt(t),l){case 9:case 10:case 13:case 32:t++;break;case 123:case 125:case 91:case 93:case 58:case 44:return d=v?c.charAt(t):c[t],t++,d;case 34:d="@";for(t++;t<b;)if(l=c.charCodeAt(t),32>l)D();else if(92==l)switch(l=c.charCodeAt(++t),l){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:d+=
y[l];t++;break;case 117:f=++t;for(e=t+4;t<e;t++)l=c.charCodeAt(t),48<=l&&57>=l||97<=l&&102>=l||65<=l&&70>=l||D();d+=x("0x"+c.slice(f,t));break;default:D()}else{if(34==l)break;l=c.charCodeAt(t);for(f=t;32<=l&&92!=l&&34!=l;)l=c.charCodeAt(++t);d+=c.slice(f,t)}if(34==c.charCodeAt(t))return t++,d;D();default:f=t;45==l&&(k=!0,l=c.charCodeAt(++t));if(48<=l&&57>=l){for(48==l&&(l=c.charCodeAt(t+1),48<=l&&57>=l)&&D();t<b&&(l=c.charCodeAt(t),48<=l&&57>=l);t++);if(46==c.charCodeAt(t)){for(e=++t;e<b&&(l=c.charCodeAt(e),
48<=l&&57>=l);e++);e==t&&D();t=e}l=c.charCodeAt(t);if(101==l||69==l){l=c.charCodeAt(++t);43!=l&&45!=l||t++;for(e=t;e<b&&(l=c.charCodeAt(e),48<=l&&57>=l);e++);e==t&&D();t=e}return+c.slice(f,t)}k&&D();if("true"==c.slice(t,t+4))return t+=4,!0;if("false"==c.slice(t,t+5))return t+=5,!1;if("null"==c.slice(t,t+4))return t+=4,null;D()}return"$"},F=function(c){var b,d;"$"==c&&D();if("string"==typeof c){if("@"==(v?c.charAt(0):c[0]))return c.slice(1);if("["==c){for(b=[];;d||(d=!0)){c=B();if("]"==c)break;d&&
(","==c?(c=B(),"]"==c&&D()):D());","==c&&D();b.push(F(c))}return b}if("{"==c){for(b={};;d||(d=!0)){c=B();if("}"==c)break;d&&(","==c?(c=B(),"}"==c&&D()):D());","!=c&&"string"==typeof c&&"@"==(v?c.charAt(0):c[0])&&":"==B()||D();b[c.slice(1)]=F(B())}return b}D()}return c},H=function(c,b,d){d=E(c,b,d);d===r?delete c[b]:c[b]=d},E=function(c,b,d){var e=c[b],k;if("object"==typeof e&&e)if("[object Array]"==f.call(e))for(k=e.length;k--;)H(e,k,d);else p(e,function(c){H(e,c,d)});return d.call(c,b,e)};u.parse=
function(c,b){var d;t=0;A=""+c;c=F(B());"$"!=B()&&D();t=A=null;return b&&"[object Function]"==f.call(b)?E((d={},d[""]=c,d),"",b):c}}}})(this)},{}],35:[function(c,b,d){function f(c){var b=!0;c.getTracks().forEach(function(c){b="ended"===c.readyState&&b});return b}function e(){if("undefined"===typeof window||!window.navigator.mozGetUserMedia)return!1;var c=window.navigator.userAgent.match(/Firefox\/(\d+)\./);return 50>(c&&1<=c.length&&parseInt(c[1],10))}function l(c){n.call(this);var b=this.config=
{detectSpeakingEvents:!1,audioFallback:!1,media:{audio:!0,video:!0},harkOptions:null,logger:u},d;for(d in c)c.hasOwnProperty(d)&&(this.config[d]=c[d]);this.logger=b.logger;this._log=this.logger.log.bind(this.logger,"LocalMedia:");this._logerror=this.logger.error.bind(this.logger,"LocalMedia:");this.localStreams=[];this.localScreens=[];navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||this._logerror("Your browser does not support local media capture.");this._audioMonitors=[];this.on("localStreamStopped",
this._stopAudioMonitor.bind(this));this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}d=c("util");var q=c("hark"),r=c("getscreenmedia"),n=c("wildemitter"),u=c("mockconsole");d.inherits(l,n);l.prototype.start=function(c,b){var d=this,e=c||this.config.media;this.emit("localStreamRequested",e);navigator.mediaDevices.getUserMedia(e).then(function(c){e.audio&&d.config.detectSpeakingEvents&&d._setupAudioMonitor(c,d.config.harkOptions);d.localStreams.push(c);c.getTracks().forEach(function(b){b.addEventListener("ended",
function(){f(c)&&d._removeStream(c)})});d.emit("localStream",c);if(b)return b(null,c)}).catch(function(c){if(d.config.audioFallback&&"NotFoundError"===c.name&&!1!==e.video)e.video=!1,d.start(e,b);else if(d.emit("localStreamRequestFailed",e),b)return b(c,null)})};l.prototype.stop=function(c){this.stopStream(c);this.stopScreenShare(c)};l.prototype.stopStream=function(c){var b=this;c?-1<this.localStreams.indexOf(c)&&(c.getTracks().forEach(function(c){c.stop()}),e()&&this._removeStream(c)):this.localStreams.forEach(function(c){c.getTracks().forEach(function(c){c.stop()});
e()&&b._removeStream(c)})};l.prototype.startScreenShare=function(c,b){var d=this;this.emit("localScreenRequested");"function"!==typeof c||b||(b=c,c=null);r(c,function(c,e){c?d.emit("localScreenRequestFailed"):(d.localScreens.push(e),e.getTracks().forEach(function(c){c.addEventListener("ended",function(){var c=!0;e.getTracks().forEach(function(b){c="ended"===b.readyState&&c});c&&d._removeStream(e)})}),d.emit("localScreen",e));if(b)return b(c,e)})};l.prototype.stopScreenShare=function(c){var b=this;
c?-1<this.localScreens.indexOf(c)&&(c.getTracks().forEach(function(c){c.stop()}),e()&&this._removeStream(c)):this.localScreens.forEach(function(c){c.getTracks().forEach(function(c){c.stop()});e()&&b._removeStream(c)})};l.prototype.mute=function(){this._audioEnabled(!1);this.emit("audioOff")};l.prototype.unmute=function(){this._audioEnabled(!0);this.emit("audioOn")};l.prototype.pauseVideo=function(){this._videoEnabled(!1);this.emit("videoOff")};l.prototype.resumeVideo=function(){this._videoEnabled(!0);
this.emit("videoOn")};l.prototype.pause=function(){this.mute();this.pauseVideo()};l.prototype.resume=function(){this.unmute();this.resumeVideo()};l.prototype._audioEnabled=function(c){this.localStreams.forEach(function(b){b.getAudioTracks().forEach(function(b){b.enabled=!!c})})};l.prototype._videoEnabled=function(c){this.localStreams.forEach(function(b){b.getVideoTracks().forEach(function(b){b.enabled=!!c})})};l.prototype.isAudioEnabled=function(){var c=!0;this.localStreams.forEach(function(b){b.getAudioTracks().forEach(function(b){c=
c&&b.enabled})});return c};l.prototype.isVideoEnabled=function(){var c=!0;this.localStreams.forEach(function(b){b.getVideoTracks().forEach(function(b){c=c&&b.enabled})});return c};l.prototype._removeStream=function(c){var b=this.localStreams.indexOf(c);-1<b?(this.localStreams.splice(b,1),this.emit("localStreamStopped",c)):(b=this.localScreens.indexOf(c),-1<b&&(this.localScreens.splice(b,1),this.emit("localScreenStopped",c)))};l.prototype._setupAudioMonitor=function(c,b){this._log("Setup audio");b=
q(c,b);var d=this,e;b.on("speaking",function(){d.emit("speaking")});b.on("stopped_speaking",function(){e&&clearTimeout(e);e=setTimeout(function(){d.emit("stoppedSpeaking")},1E3)});b.on("volume_change",function(c,b){d.emit("volumeChange",c,b)});this._audioMonitors.push({audio:b,stream:c})};l.prototype._stopAudioMonitor=function(c){var b=-1;this._audioMonitors.forEach(function(d,e){d.stream===c&&(b=e)});-1<b&&(this._audioMonitors[b].audio.stop(),this._audioMonitors.splice(b,1))};b.exports=l},{getscreenmedia:27,
hark:29,mockconsole:37,util:63,wildemitter:65}],36:[function(c,b,d){(function(c){function e(c,b){c.set(b[0],b[1]);return c}function f(c,b){c.add(b);return c}function q(c,b){for(var d=-1,e=c?c.length:0;++d<e&&!1!==b(c[d],d,c););return c}function r(c,b,d,e){var f=-1,k=c?c.length:0;for(e&&k&&(d=c[++f]);++f<k;)d=b(d,c[f],f,c);return d}function n(c){var b=!1;if(null!=c&&"function"!=typeof c.toString)try{b=!!(c+"")}catch(hm){}return b}function u(c){var b=-1,d=Array(c.size);c.forEach(function(c,e){d[++b]=
[e,c]});return d}function K(c,b){return function(d){return c(b(d))}}function v(c){var b=-1,d=Array(c.size);c.forEach(function(c){d[++b]=c});return d}function h(c){var b=-1,d=c?c.length:0;for(this.clear();++b<d;){var e=c[b];this.set(e[0],e[1])}}function m(c){var b=-1,d=c?c.length:0;for(this.clear();++b<d;){var e=c[b];this.set(e[0],e[1])}}function Ha(c){var b=-1,d=c?c.length:0;for(this.clear();++b<d;){var e=c[b];this.set(e[0],e[1])}}function ca(c){this.__data__=new m(c)}function p(c,b,d){var e=c[b];
da.call(c,b)&&(e===d||e!==e&&d!==d)&&(void 0!==d||b in c)||(c[b]=d)}function ya(c,b){for(var d=c.length;d--;){var e=c[d][0];if(e===b||e!==e&&b!==b)return d}return-1}function L(c,b){return c&&D(b,I(b),c)}function t(c,b,d,e,f,k,l){var r;e&&(r=k?e(c,f,k,l):e(c));if(void 0!==r)return r;if(!hc(c))return c;if(f=Ca(c)){if(r=H(c),!b)return y(c,r)}else{var u=ra(c),K="[object Function]"==u||"[object GeneratorFunction]"==u;if(Da(c))return z(c,b);if("[object Object]"==u||"[object Arguments]"==u||K&&!k){if(n(c))return k?
c:{};r=E(K?{}:c);if(!b)return A(c,L(r,c))}else{if(!G[u])return k?c:{};r=C(c,u,t,b)}}l||(l=new ca);if(k=l.get(c))return k;l.set(c,r);if(!f)var v=d?w(c,I,va):I(c);q(v||c,function(f,k){v&&(k=f,f=c[k]);p(r,k,t(f,b,d,e,k,c,l))});return r}function w(c,b,d){b=b(c);if(!Ca(c)){c=d(c);d=-1;for(var e=c.length,f=b.length;++d<e;)b[f+d]=c[d]}return b}function z(c,b){if(b)return c.slice();b=new c.constructor(c.length);c.copy(b);return b}function x(c){var b=new c.constructor(c.byteLength);(new aa(b)).set(new aa(c));
return b}function y(c,b){var d=-1,e=c.length;for(b||(b=Array(e));++d<e;)b[d]=c[d];return b}function D(c,b,d,e){d||(d={});for(var f=-1,k=b.length;++f<k;){var l=b[f],q=e?e(d[l],c[l],l,d,c):void 0;p(d,l,void 0===q?c[l]:q)}return d}function A(c,b){return D(c,va(c),b)}function B(c,b){c=c.__data__;var d=typeof b;return("string"==d||"number"==d||"symbol"==d||"boolean"==d?"__proto__"!==b:null===b)?c["string"==typeof b?"string":"hash"]:c.map}function F(c,b){c=null==c?void 0:c[b];b=!hc(c)||Y&&Y in c?!1:(O(c)||
n(c)?fa:P).test(Ac(c));return b?c:void 0}function H(c){var b=c.length,d=c.constructor(b);b&&"string"==typeof c[0]&&da.call(c,"index")&&(d.index=c.index,d.input=c.input);return d}function E(c){"function"!=typeof c.constructor||Yh(c)?c={}:(c=ja(c),c=hc(c)?ka(c):{});return c}function C(c,b,d,k){var l=c.constructor;switch(b){case "[object ArrayBuffer]":return x(c);case "[object Boolean]":case "[object Date]":return new l(+c);case "[object DataView]":return b=k?x(c.buffer):c.buffer,new c.constructor(b,
c.byteOffset,c.byteLength);case "[object Float32Array]":case "[object Float64Array]":case "[object Int8Array]":case "[object Int16Array]":case "[object Int32Array]":case "[object Uint8Array]":case "[object Uint8ClampedArray]":case "[object Uint16Array]":case "[object Uint32Array]":return b=k?x(c.buffer):c.buffer,new c.constructor(b,c.byteOffset,c.length);case "[object Map]":return b=k?d(u(c),!0):u(c),r(b,e,new c.constructor);case "[object Number]":case "[object String]":return new l(c);case "[object RegExp]":return b=
new c.constructor(c.source,V.exec(c)),b.lastIndex=c.lastIndex,b;case "[object Set]":return b=k?d(v(c),!0):v(c),r(b,f,new c.constructor);case "[object Symbol]":return qa?Object(qa.call(c)):{}}}function Yh(c){var b=c&&c.constructor;return c===("function"==typeof b&&b.prototype||R)}function Ac(c){if(null!=c){try{return X.call(c)}catch(Na){}return c+""}return""}function Zh(c){var b;if(b=null!=c)b=c.length,b="number"==typeof b&&-1<b&&0==b%1&&9007199254740991>=b;return b&&!O(c)}function O(c){c=hc(c)?S.call(c):
"";return"[object Function]"==c||"[object GeneratorFunction]"==c}function hc(c){var b=typeof c;return!!c&&("object"==b||"function"==b)}function I(c){if(Zh(c)){var b;(b=Ca(c))||(b=!!c&&"object"==typeof c&&Zh(c)&&da.call(c,"callee")&&(!ia.call(c,"callee")||"[object Arguments]"==S.call(c)));if(b){b=c.length;for(var d=String,e=-1,f=Array(b);++e<b;)f[e]=d(e);b=f}else b=[];d=b.length;e=!!d;for(var k in c){if(!(f=!da.call(c,k))&&(f=e)&&!(f="length"==k)){f=k;var l=d;l=null==l?9007199254740991:l;f=!!l&&("number"==
typeof f||T.test(f))&&-1<f&&0==f%1&&f<l}f||b.push(k)}c=b}else if(Yh(c)){k=[];for(b in Object(c))da.call(c,b)&&"constructor"!=b&&k.push(b);c=k}else c=pa(c);return c}function U(){return[]}function M(){return!1}var V=/\w*$/,P=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,G={};G["[object Arguments]"]=G["[object Array]"]=G["[object ArrayBuffer]"]=G["[object DataView]"]=G["[object Boolean]"]=G["[object Date]"]=G["[object Float32Array]"]=G["[object Float64Array]"]=G["[object Int8Array]"]=G["[object Int16Array]"]=
G["[object Int32Array]"]=G["[object Map]"]=G["[object Number]"]=G["[object Object]"]=G["[object RegExp]"]=G["[object Set]"]=G["[object String]"]=G["[object Symbol]"]=G["[object Uint8Array]"]=G["[object Uint8ClampedArray]"]=G["[object Uint16Array]"]=G["[object Uint32Array]"]=!0;G["[object Error]"]=G["[object Function]"]=G["[object WeakMap]"]=!1;var N="object"==typeof self&&self&&self.Object===Object&&self;c="object"==typeof c&&c&&c.Object===Object&&c||N||Function("return this")();var J=(N="object"==
typeof d&&d&&!d.nodeType&&d)&&"object"==typeof b&&b&&!b.nodeType&&b;N=J&&J.exports===N;J=Array.prototype;var Q=Function.prototype,R=Object.prototype,Z=c["__core-js_shared__"],Y=function(){var c=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),X=Q.toString,da=R.hasOwnProperty,S=R.toString,fa=RegExp("^"+X.call(da).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");Q=N?c.Buffer:void 0;N=c.Symbol;var aa=c.Uint8Array,
ja=K(Object.getPrototypeOf,Object),ka=Object.create,ia=R.propertyIsEnumerable,na=J.splice;J=Object.getOwnPropertySymbols;Q=Q?Q.isBuffer:void 0;var pa=K(Object.keys,Object),W=F(c,"DataView"),oa=F(c,"Map"),la=F(c,"Promise"),ma=F(c,"Set");c=F(c,"WeakMap");var ea=F(Object,"create"),wa=Ac(W),ta=Ac(oa),Aa=Ac(la),za=Ac(ma),ua=Ac(c),qa=(N=N?N.prototype:void 0)?N.valueOf:void 0;h.prototype.clear=function(){this.__data__=ea?ea(null):{}};h.prototype["delete"]=function(c){return this.has(c)&&delete this.__data__[c]};
h.prototype.get=function(c){var b=this.__data__;return ea?(c=b[c],"__lodash_hash_undefined__"===c?void 0:c):da.call(b,c)?b[c]:void 0};h.prototype.has=function(c){var b=this.__data__;return ea?void 0!==b[c]:da.call(b,c)};h.prototype.set=function(c,b){this.__data__[c]=ea&&void 0===b?"__lodash_hash_undefined__":b;return this};m.prototype.clear=function(){this.__data__=[]};m.prototype["delete"]=function(c){var b=this.__data__;c=ya(b,c);if(0>c)return!1;c==b.length-1?b.pop():na.call(b,c,1);return!0};m.prototype.get=
function(c){var b=this.__data__;c=ya(b,c);return 0>c?void 0:b[c][1]};m.prototype.has=function(c){return-1<ya(this.__data__,c)};m.prototype.set=function(c,b){var d=this.__data__,e=ya(d,c);0>e?d.push([c,b]):d[e][1]=b;return this};Ha.prototype.clear=function(){this.__data__={hash:new h,map:new (oa||m),string:new h}};Ha.prototype["delete"]=function(c){return B(this,c)["delete"](c)};Ha.prototype.get=function(c){return B(this,c).get(c)};Ha.prototype.has=function(c){return B(this,c).has(c)};Ha.prototype.set=
function(c,b){B(this,c).set(c,b);return this};ca.prototype.clear=function(){this.__data__=new m};ca.prototype["delete"]=function(c){return this.__data__["delete"](c)};ca.prototype.get=function(c){return this.__data__.get(c)};ca.prototype.has=function(c){return this.__data__.has(c)};ca.prototype.set=function(c,b){var d=this.__data__;if(d instanceof m){d=d.__data__;if(!oa||199>d.length)return d.push([c,b]),this;d=this.__data__=new Ha(d)}d.set(c,b);return this};var va=J?K(J,Object):U,ra=function(c){return S.call(c)};
if(W&&"[object DataView]"!=ra(new W(new ArrayBuffer(1)))||oa&&"[object Map]"!=ra(new oa)||la&&"[object Promise]"!=ra(la.resolve())||ma&&"[object Set]"!=ra(new ma)||c&&"[object WeakMap]"!=ra(new c))ra=function(c){var b=S.call(c);if(c=(c="[object Object]"==b?c.constructor:void 0)?Ac(c):void 0)switch(c){case wa:return"[object DataView]";case ta:return"[object Map]";case Aa:return"[object Promise]";case za:return"[object Set]";case ua:return"[object WeakMap]"}return b};var Ca=Array.isArray,Da=Q||M;b.exports=
function(c){return t(c,!0,!0)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],37:[function(c,b,d){c="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profileEnd time timeEnd trace warn".split(" ");d=c.length;for(var e=function(){},k={};d--;)k[c[d]]=e;b.exports=k},{}],38:[function(c,b,d){function e(c){if(c=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(c)){var b=
parseFloat(c[1]);switch((c[2]||"ms").toLowerCase()){case "years":case "year":case "y":return b*l;case "days":case "day":case "d":return 864E5*b;case "hours":case "hour":case "h":return 36E5*b;case "minutes":case "minute":case "m":return 6E4*b;case "seconds":case "second":case "s":return 1E3*b;case "ms":return b}}}function k(c,b,d){if(!(c<b))return c<1.5*b?Math.floor(c/b)+" "+d:Math.ceil(c/b)+" "+d+"s"}var l=315576E5;b.exports=function(c,b){b=b||{};return"string"==typeof c?e(c):b.long?k(c,864E5,"day")||
k(c,36E5,"hour")||k(c,6E4,"minute")||k(c,1E3,"second")||c+" ms":864E5<=c?Math.round(c/864E5)+"d":36E5<=c?Math.round(c/36E5)+"h":6E4<=c?Math.round(c/6E4)+"m":1E3<=c?Math.round(c/1E3)+"s":c+"ms"}},{}],39:[function(c,b,d){var e=Object.prototype.hasOwnProperty;d.keys=Object.keys||function(c){var b=[],d;for(d in c)e.call(c,d)&&b.push(d);return b};d.values=function(c){var b=[],d;for(d in c)e.call(c,d)&&b.push(c[d]);return b};d.merge=function(c,b){for(var d in b)e.call(b,d)&&(c[d]=b[d]);return c};d.length=
function(c){return d.keys(c).length};d.isEmpty=function(c){return 0==d.length(c)}},{}],40:[function(c,b,d){(function(c){var d=/^[\],:{}\s]*$/,e=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,f=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,n=/^\s+/,u=/\s+$/;b.exports=function(b){if("string"!=typeof b||!b)return null;b=b.replace(n,"").replace(u,"");if(c.JSON&&JSON.parse)return JSON.parse(b);if(d.test(b.replace(e,"@").replace(f,"]").replace(r,"")))return(new Function("return "+
b))()}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],41:[function(c,b,d){d.encode=function(c){var b="",d;for(d in c)c.hasOwnProperty(d)&&(b.length&&(b+="&"),b+=encodeURIComponent(d)+"="+encodeURIComponent(c[d]));return b};d.decode=function(c){var b={};c=c.split("&");for(var d=0,e=c.length;d<e;d++){var f=c[d].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return b}},{}],42:[function(c,b,d){var e=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
k="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");b.exports=function(c){c=e.exec(c||"");for(var b={},d=14;d--;)b[k[d]]=c[d]||"";return b}},{}],43:[function(c,b,d){function e(){throw Error("setTimeout has not been defined");}function k(){throw Error("clearTimeout has not been defined");}function l(c){if(v===setTimeout)return setTimeout(c,0);if((v===e||!v)&&setTimeout)return v=setTimeout,setTimeout(c,0);try{return v(c,0)}catch(L){try{return v.call(null,
c,0)}catch(ok){return v.call(this,c,0)}}}function q(c){if(h===clearTimeout)return clearTimeout(c);if((h===k||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(c);try{return h(c)}catch(L){try{return h.call(null,c)}catch(ok){return h.call(this,c)}}}function r(){Ha&&ca&&(Ha=!1,ca.length?m=ca.concat(m):p=-1,m.length&&n())}function n(){if(!Ha){var c=l(r);Ha=!0;for(var b=m.length;b;){ca=m;for(m=[];++p<b;)ca&&ca[p].run();p=-1;b=m.length}ca=null;Ha=!1;q(c)}}function u(c,b){this.fun=c;this.array=b}function K(){}
c=b.exports={};try{var v="function"===typeof setTimeout?setTimeout:e}catch(ya){v=e}try{var h="function"===typeof clearTimeout?clearTimeout:k}catch(ya){h=k}var m=[],Ha=!1,ca,p=-1;c.nextTick=function(c){var b=Array(arguments.length-1);if(1<arguments.length)for(var d=1;d<arguments.length;d++)b[d-1]=arguments[d];m.push(new u(c,b));1!==m.length||Ha||l(n)};u.prototype.run=function(){this.fun.apply(null,this.array)};c.title="browser";c.browser=!0;c.env={};c.argv=[];c.version="";c.versions={};c.on=K;c.addListener=
K;c.once=K;c.off=K;c.removeListener=K;c.removeAllListeners=K;c.emit=K;c.prependListener=K;c.prependOnceListener=K;c.listeners=function(c){return[]};c.binding=function(c){throw Error("process.binding is not supported");};c.cwd=function(){return"/"};c.chdir=function(c){throw Error("process.chdir is not supported");};c.umask=function(){return 0}},{}],44:[function(c,b,d){function e(c,b){var d=this,e;l.call(this);c=c||{};c.iceServers=c.iceServers||[];this.enableChromeNativeSimulcast=!1;b&&b.optional&&
window.chrome&&null===navigator.appVersion.match(/Chromium\//)&&b.optional.forEach(function(c){c.enableChromeNativeSimulcast&&(d.enableChromeNativeSimulcast=!0)});this.enableMultiStreamHacks=!1;b&&b.optional&&window.chrome&&b.optional.forEach(function(c){c.enableMultiStreamHacks&&(d.enableMultiStreamHacks=!0)});this.restrictBandwidth=0;b&&b.optional&&b.optional.forEach(function(c){c.andyetRestrictBandwidth&&(d.restrictBandwidth=c.andyetRestrictBandwidth)});this.batchIceCandidates=0;b&&b.optional&&
b.optional.forEach(function(c){c.andyetBatchIce&&(d.batchIceCandidates=c.andyetBatchIce)});this.batchedIceCandidates=[];b&&b.optional&&window.chrome&&b.optional.forEach(function(c){c.andyetFasterICE&&(d.eliminateDuplicateCandidates=c.andyetFasterICE)});b&&b.optional&&b.optional.forEach(function(c){c.andyetDontSignalCandidates&&(d.dontSignalCandidates=c.andyetDontSignalCandidates)});this.assumeSetLocalSuccess=!1;b&&b.optional&&b.optional.forEach(function(c){c.andyetAssumeSetLocalSuccess&&(d.assumeSetLocalSuccess=
c.andyetAssumeSetLocalSuccess)});window.navigator.mozGetUserMedia&&b&&b.optional&&(this.wtFirefox=0,b.optional.forEach(function(c){c.andyetFirefoxMakesMeSad&&(d.wtFirefox=c.andyetFirefoxMakesMeSad,0<d.wtFirefox&&(d.firefoxcandidatebuffer=[]))}));this.pc=new RTCPeerConnection(c,b);this.getLocalStreams="function"===typeof this.pc.getLocalStreams?this.pc.getLocalStreams.bind(this.pc):function(){return[]};this.getSenders="function"===typeof this.pc.getSenders?this.pc.getSenders.bind(this.pc):function(){return[]};
this.getRemoteStreams="function"===typeof this.pc.getRemoteStreams?this.pc.getRemoteStreams.bind(this.pc):function(){return[]};this.getReceivers="function"===typeof this.pc.getReceivers?this.pc.getReceivers.bind(this.pc):function(){return[]};this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=function(c){"function"===typeof d.pc.removeStream?d.pc.removeStream.apply(d.pc,arguments):"function"===typeof d.pc.removeTrack&&c.getTracks().forEach(function(c){d.pc.removeTrack(c)})};"function"===
typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc));this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onremovetrack=this.emit.bind(this,"removeTrack");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);
this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:!1,sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};this.iceCredentials={local:{},remote:{}};for(e in c)this.config[e]=c[e];if(this.config.debug)this.on("*",function(){(c.logger||console).log("PeerConnection event:",arguments)});this.hadRemoteIPv6Candidate=this.hadLocalIPv6Candidate=this.hadRemoteRelayCandidate=this.hadLocalRelayCandidate=this.hadRemoteStunCandidate=
this.hadLocalStunCandidate=!1;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}d=c("util");var k=c("sdp-jingle-json"),l=c("wildemitter"),q=c("lodash.clonedeep");d.inherits(e,l);Object.defineProperty(e.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(e.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});e.prototype._role=function(){return this.isInitiator?"initiator":"responder"};e.prototype.addStream=
function(c){this.localStream=c;this.pc.addStream(c)};e.prototype._checkLocalCandidate=function(c){c=k.toCandidateJSON(c);"srflx"==c.type?this.hadLocalStunCandidate=!0:"relay"==c.type&&(this.hadLocalRelayCandidate=!0);-1!=c.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)};e.prototype._checkRemoteCandidate=function(c){c=k.toCandidateJSON(c);"srflx"==c.type?this.hadRemoteStunCandidate=!0:"relay"==c.type&&(this.hadRemoteRelayCandidate=!0);-1!=c.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)};e.prototype.processIce=
function(c,b){b=b||function(){};var d=this;if("closed"===this.pc.signalingState)return b();if(c.contents||c.jingle&&c.jingle.contents){var e=this.remoteDescription.contents.map(function(c){return c.name});(c.contents||c.jingle.contents).forEach(function(c){var f=c.transport||{},l=f.candidates||[],q=e.indexOf(c.name),r=c.name,n=d.remoteDescription.contents.find(function(b){return b.name===c.name}),u=function(){l.forEach(function(c){c=k.toCandidateSDP(c);d.pc.addIceCandidate(new RTCIceCandidate({candidate:c,
sdpMLineIndex:q,sdpMid:r}),function(){},function(c){d.emit("error",c)});d._checkRemoteCandidate(c)});b()};d.iceCredentials.remote[c.name]&&f.ufrag&&d.iceCredentials.remote[c.name].ufrag!==f.ufrag?n?(n.transport.ufrag=f.ufrag,n.transport.pwd=f.pwd,f={type:"offer",jingle:d.remoteDescription},f.sdp=k.toSessionSDP(f.jingle,{sid:d.config.sdpSessionID,role:d._role(),direction:"incoming"}),d.pc.setRemoteDescription(new RTCSessionDescription(f),function(){u()},function(c){d.emit("error",c)})):d.emit("error",
"ice restart failed to find matching content"):u()})}else{c.candidate&&0!==c.candidate.candidate.indexOf("a=")&&(c.candidate.candidate="a="+c.candidate.candidate);if(this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(c.candidate),b();d.pc.addIceCandidate(new RTCIceCandidate(c.candidate),function(){},function(c){d.emit("error",c)});d._checkRemoteCandidate(c.candidate.candidate);b()}};e.prototype.offer=
function(c,b){var d=this,e=2===arguments.length,f=e&&c?c:{offerToReceiveAudio:1,offerToReceiveVideo:1};b=(b=e?b:c)||function(){};if("closed"===this.pc.signalingState)return b("Already closed");this.pc.createOffer(function(c){var e={type:"offer",sdp:c.sdp};d.assumeSetLocalSuccess&&(d.emit("offer",e),b(null,e));d._candidateBuffer=[];d.pc.setLocalDescription(c,function(){if(d.config.useJingle){var f=k.toSessionJSON(c.sdp,{role:d._role(),direction:"outgoing"});f.sid=d.config.sid;d.localDescription=f;
f.contents.forEach(function(c){var b=c.transport||{};b.ufrag&&(d.iceCredentials.local[c.name]={ufrag:b.ufrag,pwd:b.pwd})});e.jingle=f}e.sdp.split("\r\n").forEach(function(c){0===c.indexOf("a=candidate:")&&d._checkLocalCandidate(c)});d.assumeSetLocalSuccess||(d.emit("offer",e),b(null,e))},function(c){d.emit("error",c);b(c)})},function(c){d.emit("error",c);b(c)},f)};e.prototype.handleOffer=function(c,b){b=b||function(){};var d=this;c.type="offer";if(c.jingle){this.enableChromeNativeSimulcast&&c.jingle.contents.forEach(function(c){"video"===
c.name&&(c.application.googConferenceFlag=!0)});this.enableMultiStreamHacks&&c.jingle.contents.forEach(function(c){if("video"===c.name){var b=c.application.sources||[];if(0===b.length||"3735928559"!==b[0].ssrc)b.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),c.application.sources=b}});if(0<d.restrictBandwidth&&2<=c.jingle.contents.length&&"video"===c.jingle.contents[1].name){var e=c.jingle.contents[1];e.application&&e.application.bandwidth&&
e.application.bandwidth.bandwidth||(c.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:d.restrictBandwidth.toString()},c.sdp=k.toSessionSDP(c.jingle,{sid:d.config.sdpSessionID,role:d._role(),direction:"outgoing"}))}c.jingle.contents.forEach(function(c){var b=c.transport||{};b.ufrag&&(d.iceCredentials.remote[c.name]={ufrag:b.ufrag,pwd:b.pwd})});c.sdp=k.toSessionSDP(c.jingle,{sid:d.config.sdpSessionID,role:d._role(),direction:"incoming"});d.remoteDescription=c.jingle}c.sdp.split("\r\n").forEach(function(c){0===
c.indexOf("a=candidate:")&&d._checkRemoteCandidate(c)});d.pc.setRemoteDescription(new RTCSessionDescription(c),function(){b()},b)};e.prototype.answerAudioOnly=function(c){this._answer({mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},c)};e.prototype.answerBroadcastOnly=function(c){this._answer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},c)};e.prototype.answer=function(c,b){var d=2===arguments.length;this._answer(d&&c?c:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},
d?b:c)};e.prototype.handleAnswer=function(c,b){b=b||function(){};var d=this;c.jingle&&(c.sdp=k.toSessionSDP(c.jingle,{sid:d.config.sdpSessionID,role:d._role(),direction:"incoming"}),d.remoteDescription=c.jingle,c.jingle.contents.forEach(function(c){var b=c.transport||{};b.ufrag&&(d.iceCredentials.remote[c.name]={ufrag:b.ufrag,pwd:b.pwd})}));c.sdp.split("\r\n").forEach(function(c){0===c.indexOf("a=candidate:")&&d._checkRemoteCandidate(c)});d.pc.setRemoteDescription(new RTCSessionDescription(c),function(){d.wtFirefox&&
window.setTimeout(function(){d.firefoxcandidatebuffer.forEach(function(c){d.pc.addIceCandidate(new RTCIceCandidate(c),function(){},function(c){d.emit("error",c)});d._checkRemoteCandidate(c.candidate)});d.firefoxcandidatebuffer=null},d.wtFirefox);b(null)},b)};e.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};e.prototype._answer=function(c,b){b=b||function(){};var d=this;if(!this.pc.remoteDescription)throw Error("remoteDescription not set");
if("closed"===this.pc.signalingState)return b("Already closed");d.pc.createAnswer(function(c){var e=[];if(d.enableChromeNativeSimulcast&&(c.jingle=k.toSessionJSON(c.sdp,{role:d._role(),direction:"outgoing"}),2<=c.jingle.contents.length&&"video"===c.jingle.contents[1].name)){var f=c.jingle.contents[1].application.sourceGroups||[],l=!1;f.forEach(function(c){"SIM"==c.semantics&&(l=!0)});if(!l&&c.jingle.contents[1].application.sources.length){var r=JSON.parse(JSON.stringify(c.jingle.contents[1].application.sources[0]));
r.ssrc=""+Math.floor(4294967295*Math.random());c.jingle.contents[1].application.sources.push(r);e.push(c.jingle.contents[1].application.sources[0].ssrc);e.push(r.ssrc);f.push({semantics:"SIM",sources:e});e=JSON.parse(JSON.stringify(r));e.ssrc=""+Math.floor(4294967295*Math.random());c.jingle.contents[1].application.sources.push(e);f.push({semantics:"FID",sources:[r.ssrc,e.ssrc]});c.jingle.contents[1].application.sourceGroups=f;c.sdp=k.toSessionSDP(c.jingle,{sid:d.config.sdpSessionID,role:d._role(),
direction:"outgoing"})}}var n={type:"answer",sdp:c.sdp};d.assumeSetLocalSuccess&&(f=q(n),d.emit("answer",f),b(null,f));d._candidateBuffer=[];d.pc.setLocalDescription(c,function(){if(d.config.useJingle){var e=k.toSessionJSON(c.sdp,{role:d._role(),direction:"outgoing"});e.sid=d.config.sid;d.localDescription=e;n.jingle=e}d.enableChromeNativeSimulcast&&(n.jingle||(n.jingle=k.toSessionJSON(c.sdp,{role:d._role(),direction:"outgoing"})),n.jingle.contents[1].application.sources.forEach(function(c,b){c.parameters=
c.parameters.map(function(c){"msid"===c.key&&(c.value+="-"+Math.floor(b/2));return c})}),n.sdp=k.toSessionSDP(n.jingle,{sid:d.sdpSessionID,role:d._role(),direction:"outgoing"}));n.sdp.split("\r\n").forEach(function(c){0===c.indexOf("a=candidate:")&&d._checkLocalCandidate(c)});d.assumeSetLocalSuccess||(e=q(n),d.emit("answer",e),b(null,e))},function(c){d.emit("error",c);b(c)})},function(c){d.emit("error",c);b(c)},c)};e.prototype._onIce=function(c){var b=this;if(c.candidate){if(!this.dontSignalCandidates){c=
c.candidate;var d={candidate:{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex}};this._checkLocalCandidate(c.candidate);var e=k.toCandidateJSON(c.candidate);if(this.eliminateDuplicateCandidates&&"relay"===e.type){var f=this._candidateBuffer.filter(function(c){return"relay"===c.type}).map(function(c){return c.foundation+":"+c.component});var l=f.indexOf(e.foundation+":"+e.component);if(-1<l&&e.priority>>24>=f[l].priority>>24)return}if("max-bundle"===this.config.bundlePolicy&&(f=
this._candidateBuffer.filter(function(c){return e.type===c.type}).map(function(c){return c.address+":"+c.port}),l=f.indexOf(e.address+":"+e.port),-1<l))return;if("require"!==this.config.rtcpMuxPolicy||"2"!==e.component){this._candidateBuffer.push(e);if(b.config.useJingle&&(c.sdpMid||(c.sdpMid=b.pc.remoteDescription&&"offer"===b.pc.remoteDescription.type?b.remoteDescription.contents[c.sdpMLineIndex].name:b.localDescription.contents[c.sdpMLineIndex].name),b.iceCredentials.local[c.sdpMid]||k.toSessionJSON(b.pc.localDescription.sdp,
{role:b._role(),direction:"outgoing"}).contents.forEach(function(c){var d=c.transport||{};d.ufrag&&(b.iceCredentials.local[c.name]={ufrag:d.ufrag,pwd:d.pwd})}),d.jingle={contents:[{name:c.sdpMid,creator:b._role(),transport:{transportType:"iceUdp",ufrag:b.iceCredentials.local[c.sdpMid].ufrag,pwd:b.iceCredentials.local[c.sdpMid].pwd,candidates:[e]}}]},0<b.batchIceCandidates)){0===b.batchedIceCandidates.length&&window.setTimeout(function(){var c={};b.batchedIceCandidates.forEach(function(b){b=b.contents[0];
c[b.name]||(c[b.name]=b);c[b.name].transport.candidates.push(b.transport.candidates[0])});var d={jingle:{contents:[]}};Object.keys(c).forEach(function(b){d.jingle.contents.push(c[b])});b.batchedIceCandidates=[];b.emit("ice",d)},b.batchIceCandidates);b.batchedIceCandidates.push(d.jingle);return}this.emit("ice",d)}}}else this.emit("endOfCandidates")};e.prototype._onDataChannel=function(c){c=c.channel;this._remoteDataChannels.push(c);this.emit("addChannel",c)};e.prototype.createDataChannel=function(c,
b){c=this.pc.createDataChannel(c,b);this._localDataChannels.push(c);return c};e.prototype.getStats=function(){if("function"===typeof arguments[0]){var c=arguments[0];this.pc.getStats().then(function(b){c(null,b)},function(b){c(b)})}else return this.pc.getStats.apply(this.pc,arguments)};b.exports=e},{"lodash.clonedeep":36,"sdp-jingle-json":45,util:63,wildemitter:65}],45:[function(c,b,d){var e=c("./lib/tosdp"),k=c("./lib/tojson");d.toIncomingSDPOffer=function(c){return e.toSessionSDP(c,{role:"responder",
direction:"incoming"})};d.toOutgoingSDPOffer=function(c){return e.toSessionSDP(c,{role:"initiator",direction:"outgoing"})};d.toIncomingSDPAnswer=function(c){return e.toSessionSDP(c,{role:"initiator",direction:"incoming"})};d.toOutgoingSDPAnswer=function(c){return e.toSessionSDP(c,{role:"responder",direction:"outgoing"})};d.toIncomingMediaSDPOffer=function(c){return e.toMediaSDP(c,{role:"responder",direction:"incoming"})};d.toOutgoingMediaSDPOffer=function(c){return e.toMediaSDP(c,{role:"initiator",
direction:"outgoing"})};d.toIncomingMediaSDPAnswer=function(c){return e.toMediaSDP(c,{role:"initiator",direction:"incoming"})};d.toOutgoingMediaSDPAnswer=function(c){return e.toMediaSDP(c,{role:"responder",direction:"outgoing"})};d.toCandidateSDP=e.toCandidateSDP;d.toMediaSDP=e.toMediaSDP;d.toSessionSDP=e.toSessionSDP;d.toIncomingJSONOffer=function(c,b){return k.toSessionJSON(c,{role:"responder",direction:"incoming",creators:b})};d.toOutgoingJSONOffer=function(c,b){return k.toSessionJSON(c,{role:"initiator",
direction:"outgoing",creators:b})};d.toIncomingJSONAnswer=function(c,b){return k.toSessionJSON(c,{role:"initiator",direction:"incoming",creators:b})};d.toOutgoingJSONAnswer=function(c,b){return k.toSessionJSON(c,{role:"responder",direction:"outgoing",creators:b})};d.toIncomingMediaJSONOffer=function(c,b){return k.toMediaJSON(c,{role:"responder",direction:"incoming",creator:b})};d.toOutgoingMediaJSONOffer=function(c,b){return k.toMediaJSON(c,{role:"initiator",direction:"outgoing",creator:b})};d.toIncomingMediaJSONAnswer=
function(c,b){return k.toMediaJSON(c,{role:"initiator",direction:"incoming",creator:b})};d.toOutgoingMediaJSONAnswer=function(c,b){return k.toMediaJSON(c,{role:"responder",direction:"outgoing",creator:b})};d.toCandidateJSON=k.toCandidateJSON;d.toMediaJSON=k.toMediaJSON;d.toSessionJSON=k.toSessionJSON},{"./lib/tojson":48,"./lib/tosdp":49}],46:[function(c,b,d){d.lines=function(c){return c.split("\r\n").filter(function(c){return 0<c.length})};d.findLine=function(c,b,d){for(var e=c.length,f=0;f<b.length;f++)if(b[f].substr(0,
e)===c)return b[f];if(!d)return!1;for(b=0;b<d.length;b++)if(d[b].substr(0,e)===c)return d[b];return!1};d.findLines=function(c,b,d){for(var e=[],f=c.length,k=0;k<b.length;k++)b[k].substr(0,f)===c&&e.push(b[k]);if(e.length||!d)return e;for(b=0;b<d.length;b++)d[b].substr(0,f)===c&&e.push(d[b]);return e};d.mline=function(c){c=c.substr(2).split(" ");for(var b={media:c[0],port:c[1],proto:c[2],formats:[]},d=3;d<c.length;d++)c[d]&&b.formats.push(c[d]);return b};d.rtpmap=function(c){c=c.substr(9).split(" ");
var b={id:c.shift()};c=c[0].split("/");b.name=c[0];b.clockrate=c[1];b.channels=3==c.length?c[2]:"1";return b};d.sctpmap=function(c){c=c.substr(10).split(" ");return{number:c.shift(),protocol:c.shift(),streams:c.shift()}};d.fmtp=function(c){for(var b,d=c.substr(c.indexOf(" ")+1).split(";"),e=[],f=0;f<d.length;f++)b=d[f].split("="),c=b[0].trim(),b=b[1],c&&b?e.push({key:c,value:b}):c&&e.push({key:"",value:c});return e};d.crypto=function(c){c=c.substr(9).split(" ");return{tag:c[0],cipherSuite:c[1],keyParams:c[2],
sessionParams:c.slice(3).join(" ")}};d.fingerprint=function(c){c=c.substr(14).split(" ");return{hash:c[0],value:c[1]}};d.extmap=function(c){c=c.substr(9).split(" ");var b={},d=c.shift(),e=d.indexOf("/");0<=e?(b.id=d.substr(0,e),b.senders=d.substr(e+1)):(b.id=d,b.senders="sendrecv");b.uri=c.shift()||"";return b};d.rtcpfb=function(c){c=c.substr(10).split(" ");var b={};b.id=c.shift();b.type=c.shift();"trr-int"===b.type?b.value=c.shift():b.subtype=c.shift()||"";b.parameters=c;return b};d.candidate=function(c){c=
0===c.indexOf("a=candidate:")?c.substring(12).split(" "):c.substring(10).split(" ");for(var b={foundation:c[0],component:c[1],protocol:c[2].toLowerCase(),priority:c[3],ip:c[4],port:c[5],type:c[7],generation:"0"},d=8;d<c.length;d+=2)"raddr"===c[d]?b.relAddr=c[d+1]:"rport"===c[d]?b.relPort=c[d+1]:"generation"===c[d]?b.generation=c[d+1]:"tcptype"===c[d]&&(b.tcpType=c[d+1]);b.network="1";return b};d.sourceGroups=function(c){for(var b=[],d=0;d<c.length;d++){var e=c[d].substr(13).split(" ");b.push({semantics:e.shift(),
sources:e})}return b};d.sources=function(c){for(var b=[],d={},e=0;e<c.length;e++){var f=c[e].substr(7).split(" "),n=f.shift();if(!d[n]){var u={ssrc:n,parameters:[]};b.push(u);d[n]=u}f=f.join(" ").split(":");u=f.shift();f=f.join(":")||null;d[n].parameters.push({key:u,value:f})}return b};d.groups=function(c){for(var b=[],d,e=0;e<c.length;e++)d=c[e].substr(8).split(" "),b.push({semantics:d.shift(),contents:d});return b};d.bandwidth=function(c){c=c.substr(2).split(":");var b={};b.type=c.shift();b.bandwidth=
c.shift();return b};d.msid=function(c){c=c.substr(7);var b=c.split(" ");return{msid:c,mslabel:b[0],label:b[1]}}},{}],47:[function(c,b,d){b.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",
responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],48:[function(c,b,d){var e=c("./senders"),k=c("./parsers"),l=Math.random();d._setIdCounter=function(c){l=c};d.toSessionJSON=function(c,b){var e,f=b.creators||[],l=b.role||"initiator";b=b.direction||"outgoing";
var q=c.split("\r\nm=");for(e=1;e<q.length;e++)q[e]="m="+q[e],e!==q.length-1&&(q[e]+="\r\n");var r=q.shift()+"\r\n",h=k.lines(r);c={};var m=[];for(e=0;e<q.length;e++)m.push(d.toMediaJSON(q[e],r,{role:l,direction:b,creator:f[e]||"initiator"}));c.contents=m;f=k.findLines("a=group:",h);f.length&&(c.groups=k.groups(f));return c};d.toMediaJSON=function(c,b,f){var l=f.creator||"initiator",q=f.role||"initiator",n=f.direction||"outgoing",r=k.lines(c);c=k.lines(b);b=k.mline(r[0]);l={creator:l,name:b.media,
application:{applicationType:"rtp",media:b.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==b.media&&(l.application={applicationType:"datachannel"},l.transport.sctp=[]);var h=l.application,m=l.transport;if(b=k.findLine("a=mid:",r))l.name=b.substr(6);k.findLine("a=sendrecv",r,c)?l.senders="both":k.findLine("a=sendonly",r,c)?l.senders=e[q][n].sendonly:k.findLine("a=recvonly",r,c)?l.senders=e[q][n].recvonly:
k.findLine("a=inactive",r,c)&&(l.senders="none");if("rtp"==h.applicationType){if(b=k.findLine("b=",r))h.bandwidth=k.bandwidth(b);if(b=k.findLine("a=ssrc:",r))h.ssrc=b.substr(7).split(" ")[0];k.findLines("a=rtpmap:",r).forEach(function(c){var b=k.rtpmap(c);b.parameters=[];b.feedback=[];k.findLines("a=fmtp:"+b.id,r).forEach(function(c){b.parameters=k.fmtp(c)});k.findLines("a=rtcp-fb:"+b.id,r).forEach(function(c){b.feedback.push(k.rtcpfb(c))});h.payloads.push(b)});k.findLines("a=crypto:",r,c).forEach(function(c){h.encryption.push(k.crypto(c))});
k.findLine("a=rtcp-mux",r)&&(h.mux=!0);k.findLines("a=rtcp-fb:*",r).forEach(function(c){h.feedback.push(k.rtcpfb(c))});k.findLines("a=extmap:",r).forEach(function(c){c=k.extmap(c);c.senders=e[q][n][c.senders];h.headerExtensions.push(c)});b=k.findLines("a=ssrc-group:",r);h.sourceGroups=k.sourceGroups(b||[]);b=k.findLines("a=ssrc:",r);var p=h.sources=k.sources(b||[]);if(b=k.findLine("a=msid:",r)){var t=k.msid(b);["msid","mslabel","label"].forEach(function(c){for(var b=0;b<p.length;b++){for(var d=!1,
e=0;e<p[b].parameters.length;e++)p[b].parameters[e].key===c&&(d=!0);d||p[b].parameters.push({key:c,value:t[c]})}})}k.findLine("a=x-google-flag:conference",r,c)&&(h.googConferenceFlag=!0)}b=k.findLines("a=fingerprint:",r,c);var w=k.findLine("a=setup:",r,c);b.forEach(function(c){c=k.fingerprint(c);w&&(c.setup=w.substr(8));m.fingerprints.push(c)});b=k.findLine("a=ice-ufrag:",r,c);f=k.findLine("a=ice-pwd:",r,c);b&&f&&(m.ufrag=b.substr(12),m.pwd=f.substr(10),m.candidates=[],k.findLines("a=candidate:",
r,c).forEach(function(c){m.candidates.push(d.toCandidateJSON(c))}));"datachannel"==h.applicationType&&k.findLines("a=sctpmap:",r).forEach(function(c){c=k.sctpmap(c);m.sctp.push(c)});return l};d.toCandidateJSON=function(c){c=k.candidate(c.split("\r\n")[0]);c.id=(l++).toString(36).substr(0,12);return c}},{"./parsers":46,"./senders":47}],49:[function(c,b,d){var e=c("./senders");d.toSessionSDP=function(c,b){var e=b.sid||c.sid||Date.now(),f=b.time||Date.now(),k=["v=0","o=- "+e+" "+f+" IN IP4 0.0.0.0",
"s=-","t=0 0"];e=c.contents||[];var l=!1;e.forEach(function(c){c.application.sources&&c.application.sources.length&&(l=!0)});l&&k.push("a=msid-semantic: WMS *");(c.groups||[]).forEach(function(c){k.push("a=group:"+c.semantics+" "+c.contents.join(" "))});e.forEach(function(c){k.push(d.toMediaSDP(c,b))});return k.join("\r\n")+"\r\n"};d.toMediaSDP=function(c,b){var f=[],k=b.role||"initiator",l=b.direction||"outgoing",u=c.application;b=c.transport;var h=u.payloads||[],m=b&&b.fingerprints||[],ha=[];"datachannel"==
u.applicationType?(ha.push("application"),ha.push("1"),ha.push("DTLS/SCTP"),b.sctp&&b.sctp.forEach(function(c){ha.push(c.number)})):(ha.push(u.media),ha.push("1"),0<m.length?ha.push("UDP/TLS/RTP/SAVPF"):u.encryption&&0<u.encryption.length?ha.push("RTP/SAVPF"):ha.push("RTP/AVPF"),h.forEach(function(c){ha.push(c.id)}));f.push("m="+ha.join(" "));f.push("c=IN IP4 0.0.0.0");u.bandwidth&&u.bandwidth.type&&u.bandwidth.bandwidth&&f.push("b="+u.bandwidth.type+":"+u.bandwidth.bandwidth);"rtp"==u.applicationType&&
f.push("a=rtcp:1 IN IP4 0.0.0.0");b&&(b.ufrag&&f.push("a=ice-ufrag:"+b.ufrag),b.pwd&&f.push("a=ice-pwd:"+b.pwd),m.forEach(function(c){f.push("a=fingerprint:"+c.hash+" "+c.value);c.setup&&f.push("a=setup:"+c.setup)}),b.sctp&&b.sctp.forEach(function(c){f.push("a=sctpmap:"+c.number+" "+c.protocol+" "+c.streams)}));"rtp"==u.applicationType&&f.push("a="+(e[k][l][c.senders]||"sendrecv"));f.push("a=mid:"+c.name);u.sources&&u.sources.length&&(u.sources[0].parameters||[]).forEach(function(c){"msid"===c.key&&
f.push("a=msid:"+c.value)});u.mux&&f.push("a=rtcp-mux");(u.encryption||[]).forEach(function(c){f.push("a=crypto:"+c.tag+" "+c.cipherSuite+" "+c.keyParams+(c.sessionParams?" "+c.sessionParams:""))});u.googConferenceFlag&&f.push("a=x-google-flag:conference");h.forEach(function(c){var b="a=rtpmap:"+c.id+" "+c.name+"/"+c.clockrate;c.channels&&"1"!=c.channels&&(b+="/"+c.channels);f.push(b);if(c.parameters&&c.parameters.length){b=["a=fmtp:"+c.id];var d=[];c.parameters.forEach(function(c){d.push((c.key?
c.key+"=":"")+c.value)});b.push(d.join(";"));f.push(b.join(" "))}c.feedback&&c.feedback.forEach(function(b){"trr-int"===b.type?f.push("a=rtcp-fb:"+c.id+" trr-int "+(b.value?b.value:"0")):f.push("a=rtcp-fb:"+c.id+" "+b.type+(b.subtype?" "+b.subtype:""))})});u.feedback&&u.feedback.forEach(function(c){"trr-int"===c.type?f.push("a=rtcp-fb:* trr-int "+(c.value?c.value:"0")):f.push("a=rtcp-fb:* "+c.type+(c.subtype?" "+c.subtype:""))});(u.headerExtensions||[]).forEach(function(c){f.push("a=extmap:"+c.id+
(c.senders?"/"+e[k][l][c.senders]:"")+" "+c.uri)});(u.sourceGroups||[]).forEach(function(c){f.push("a=ssrc-group:"+c.semantics+" "+c.sources.join(" "))});(u.sources||[]).forEach(function(c){for(var b=0;b<c.parameters.length;b++){var d=c.parameters[b];f.push("a=ssrc:"+(c.ssrc||u.ssrc)+" "+d.key+(d.value?":"+d.value:""))}});(b.candidates||[]).forEach(function(c){f.push(d.toCandidateSDP(c))});return f.join("\r\n")};d.toCandidateSDP=function(c){var b=[];b.push(c.foundation);b.push(c.component);b.push(c.protocol.toUpperCase());
b.push(c.priority);b.push(c.ip);b.push(c.port);var d=c.type;b.push("typ");b.push(d);("srflx"===d||"prflx"===d||"relay"===d)&&c.relAddr&&c.relPort&&(b.push("raddr"),b.push(c.relAddr),b.push("rport"),b.push(c.relPort));c.tcpType&&"TCP"==c.protocol.toUpperCase()&&(b.push("tcptype"),b.push(c.tcpType));b.push("generation");b.push(c.generation||"0");return"a=candidate:"+b.join(" ")}},{"./senders":47}],50:[function(c,b,d){b.exports=c("./lib/")},{"./lib/":51}],51:[function(c,b,d){function e(c,b){"object"==
typeof c&&(b=c,c=void 0);b=b||{};c=k(c);var d=c.source,e=c.id;b.forceNew||b["force new connection"]||!1===b.multiplex?(r("ignoring socket cache for %s",d),b=q(d,b)):(n[e]||(r("new io instance for %s",d),n[e]=q(d,b)),b=n[e]);return b.socket(c.path)}var k=c("./url"),l=c("socket.io-parser"),q=c("./manager"),r=c("debug")("socket.io-client");b.exports=d=e;var n=d.managers={};d.protocol=l.protocol;d.connect=e;d.Manager=c("./manager");d.Socket=c("./socket")},{"./manager":52,"./socket":54,"./url":55,debug:10,
"socket.io-parser":57}],52:[function(c,b,d){function e(c,b){if(!(this instanceof e))return new e(c,b);c&&"object"==typeof c&&(b=c,c=void 0);b=b||{};b.path=b.path||"/socket.io";this.nsps={};this.subs=[];this.opts=b;this.reconnection(!1!==b.reconnection);this.reconnectionAttempts(b.reconnectionAttempts||Infinity);this.reconnectionDelay(b.reconnectionDelay||1E3);this.reconnectionDelayMax(b.reconnectionDelayMax||5E3);this.randomizationFactor(b.randomizationFactor||.5);this.backoff=new m({min:this.reconnectionDelay(),
max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==b.timeout?2E4:b.timeout);this.readyState="closed";this.uri=c;this.connected=[];this.encoding=!1;this.packetBuffer=[];this.encoder=new q.Encoder;this.decoder=new q.Decoder;(this.autoConnect=!1!==b.autoConnect)&&this.open()}c("./url");var k=c("engine.io-client"),l=c("./socket");d=c("component-emitter");var q=c("socket.io-parser"),r=c("./on"),n=c("component-bind");c("object-component");var u=c("debug")("socket.io-client:manager"),
h=c("indexof"),m=c("backo2");b.exports=e;e.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var c in this.nsps)this.nsps[c].emit.apply(this.nsps[c],arguments)};e.prototype.updateSocketIds=function(){for(var c in this.nsps)this.nsps[c].id=this.engine.id};d(e.prototype);e.prototype.reconnection=function(c){if(!arguments.length)return this._reconnection;this._reconnection=!!c;return this};e.prototype.reconnectionAttempts=function(c){if(!arguments.length)return this._reconnectionAttempts;
this._reconnectionAttempts=c;return this};e.prototype.reconnectionDelay=function(c){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=c;this.backoff&&this.backoff.setMin(c);return this};e.prototype.randomizationFactor=function(c){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=c;this.backoff&&this.backoff.setJitter(c);return this};e.prototype.reconnectionDelayMax=function(c){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=
c;this.backoff&&this.backoff.setMax(c);return this};e.prototype.timeout=function(c){if(!arguments.length)return this._timeout;this._timeout=c;return this};e.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};e.prototype.open=e.prototype.connect=function(c){u("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;u("opening %s",this.uri);var b=this.engine=k(this.uri,this.opts),d=this;this.readyState=
"opening";this.skipReconnect=!1;var e=r(b,"open",function(){d.onopen();c&&c()}),f=r(b,"error",function(b){u("connect_error");d.cleanup();d.readyState="closed";d.emitAll("connect_error",b);if(c){var e=Error("Connection error");e.data=b;c(e)}else d.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;u("connect attempt will timeout after %d",l);var q=setTimeout(function(){u("connect attempt timed out after %d",l);e.destroy();b.close();b.emit("error","timeout");d.emitAll("connect_timeout",
l)},l);this.subs.push({destroy:function(){clearTimeout(q)}})}this.subs.push(e);this.subs.push(f);return this};e.prototype.onopen=function(){u("open");this.cleanup();this.readyState="open";this.emit("open");var c=this.engine;this.subs.push(r(c,"data",n(this,"ondata")));this.subs.push(r(this.decoder,"decoded",n(this,"ondecoded")));this.subs.push(r(c,"error",n(this,"onerror")));this.subs.push(r(c,"close",n(this,"onclose")))};e.prototype.ondata=function(c){this.decoder.add(c)};e.prototype.ondecoded=function(c){this.emit("packet",
c)};e.prototype.onerror=function(c){u("error",c);this.emitAll("error",c)};e.prototype.socket=function(c){var b=this.nsps[c];if(!b){b=new l(this,c);this.nsps[c]=b;var d=this;b.on("connect",function(){b.id=d.engine.id;~h(d.connected,b)||d.connected.push(b)})}return b};e.prototype.destroy=function(c){c=h(this.connected,c);~c&&this.connected.splice(c,1);this.connected.length||this.close()};e.prototype.packet=function(c){u("writing packet %j",c);var b=this;b.encoding?b.packetBuffer.push(c):(b.encoding=
!0,this.encoder.encode(c,function(c){for(var d=0;d<c.length;d++)b.engine.write(c[d]);b.encoding=!1;b.processPacketQueue()}))};e.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var c=this.packetBuffer.shift();this.packet(c)}};e.prototype.cleanup=function(){for(var c;c=this.subs.shift();)c.destroy();this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};e.prototype.close=e.prototype.disconnect=function(){this.skipReconnect=!0;this.backoff.reset();this.readyState=
"closed";this.engine&&this.engine.close()};e.prototype.onclose=function(c){u("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",c);this._reconnection&&!this.skipReconnect&&this.reconnect()};e.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var c=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();
u("will wait %dms before reconnect attempt",b);this.reconnecting=!0;var d=setTimeout(function(){c.skipReconnect||(u("attempting reconnect"),c.emitAll("reconnect_attempt",c.backoff.attempts),c.emitAll("reconnecting",c.backoff.attempts),c.skipReconnect||c.open(function(b){b?(u("reconnect attempt error"),c.reconnecting=!1,c.reconnect(),c.emitAll("reconnect_error",b.data)):(u("reconnect success"),c.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(d)}})}};e.prototype.onreconnect=function(){var c=
this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",c)}},{"./on":53,"./socket":54,"./url":55,backo2:4,"component-bind":7,"component-emitter":8,debug:10,"engine.io-client":11,indexof:32,"object-component":39,"socket.io-parser":57}],53:[function(c,b,d){b.exports=function(c,b,d){c.on(b,d);return{destroy:function(){c.removeListener(b,d)}}}},{}],54:[function(c,b,d){function e(c,b){this.io=c;this.nsp=b;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&
this.open();this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0}var k=c("socket.io-parser");d=c("component-emitter");var l=c("to-array"),q=c("./on"),r=c("component-bind"),n=c("debug")("socket.io-client:socket"),u=c("has-binary");b.exports=e;var h={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},m=d.prototype.emit;d(e.prototype);e.prototype.subEvents=function(){if(!this.subs){var c=
this.io;this.subs=[q(c,"open",r(this,"onopen")),q(c,"packet",r(this,"onpacket")),q(c,"close",r(this,"onclose"))]}};e.prototype.open=e.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};e.prototype.send=function(){var c=l(arguments);c.unshift("message");this.emit.apply(this,c);return this};e.prototype.emit=function(c){if(h.hasOwnProperty(c))return m.apply(this,arguments),this;var b=l(arguments),d=k.EVENT;
u(b)&&(d=k.BINARY_EVENT);d={type:d,data:b};"function"==typeof b[b.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=b.pop(),d.id=this.ids++);this.connected?this.packet(d):this.sendBuffer.push(d);return this};e.prototype.packet=function(c){c.nsp=this.nsp;this.io.packet(c)};e.prototype.onopen=function(){n("transport is open - connecting");"/"!=this.nsp&&this.packet({type:k.CONNECT})};e.prototype.onclose=function(c){n("close (%s)",c);this.connected=!1;this.disconnected=!0;
delete this.id;this.emit("disconnect",c)};e.prototype.onpacket=function(c){if(c.nsp==this.nsp)switch(c.type){case k.CONNECT:this.onconnect();break;case k.EVENT:this.onevent(c);break;case k.BINARY_EVENT:this.onevent(c);break;case k.ACK:this.onack(c);break;case k.BINARY_ACK:this.onack(c);break;case k.DISCONNECT:this.ondisconnect();break;case k.ERROR:this.emit("error",c.data)}};e.prototype.onevent=function(c){var b=c.data||[];n("emitting event %j",b);null!=c.id&&(n("attaching ack callback to event"),
b.push(this.ack(c.id)));this.connected?m.apply(this,b):this.receiveBuffer.push(b)};e.prototype.ack=function(c){var b=this,d=!1;return function(){if(!d){d=!0;var e=l(arguments);n("sending ack %j",e);var f=u(e)?k.BINARY_ACK:k.ACK;b.packet({type:f,id:c,data:e})}}};e.prototype.onack=function(c){n("calling ack %s with %j",c.id,c.data);this.acks[c.id].apply(this,c.data);delete this.acks[c.id]};e.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};
e.prototype.emitBuffered=function(){var c;for(c=0;c<this.receiveBuffer.length;c++)m.apply(this,this.receiveBuffer[c]);this.receiveBuffer=[];for(c=0;c<this.sendBuffer.length;c++)this.packet(this.sendBuffer[c]);this.sendBuffer=[]};e.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};e.prototype.destroy=function(){if(this.subs){for(var c=0;c<this.subs.length;c++)this.subs[c].destroy();this.subs=null}this.io.destroy(this)};e.prototype.close=
e.prototype.disconnect=function(){this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:k.DISCONNECT}));this.destroy();if(this.connected)this.onclose("io client disconnect");return this}},{"./on":53,"component-bind":7,"component-emitter":8,debug:10,"has-binary":30,"socket.io-parser":57,"to-array":59}],55:[function(c,b,d){(function(d){var e=c("parseuri"),f=c("debug")("socket.io-client:url");b.exports=function(c,b){var k=c;b=b||d.location;null==c&&(c=b.protocol+"//"+b.host);"string"==
typeof c&&("/"==c.charAt(0)&&(c="/"==c.charAt(1)?b.protocol+c:b.hostname+c),/^(https?|wss?):\/\//.test(c)||(f("protocol-less url %s",c),c="undefined"!=typeof b?b.protocol+"//"+c:"https://"+c),f("parse %s",c),k=e(c));k.port||(/^(http|ws)$/.test(k.protocol)?k.port="80":/^(http|ws)s$/.test(k.protocol)&&(k.port="443"));k.path=k.path||"/";k.id=k.protocol+"://"+k.host+":"+k.port;k.href=k.protocol+"://"+k.host+(b&&b.port==k.port?"":":"+k.port);return k}}).call(this,"undefined"!==typeof global?global:"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{debug:10,parseuri:42}],56:[function(c,b,d){(function(b){var e=c("isarray"),f=c("./is-buffer");d.deconstructPacket=function(c){function b(c){if(!c)return c;if(f(c)){var k={_placeholder:!0,num:d.length};d.push(c);return k}if(e(c)){k=Array(c.length);for(var l=0;l<c.length;l++)k[l]=b(c[l]);return k}if("object"==typeof c&&!(c instanceof Date)){k={};for(l in c)k[l]=b(c[l]);return k}return c}var d=[];c.data=b(c.data);c.attachments=d.length;return{packet:c,
buffers:d}};d.reconstructPacket=function(c,b){function d(c){if(c&&c._placeholder)return b[c.num];if(e(c))for(var f=0;f<c.length;f++)c[f]=d(c[f]);else if(c&&"object"==typeof c)for(f in c)c[f]=d(c[f]);return c}c.data=d(c.data);c.attachments=void 0;return c};d.removeBlobs=function(c,d){function k(c,r,n){if(!c)return c;if(b.Blob&&c instanceof Blob||b.File&&c instanceof File){l++;var u=new FileReader;u.onload=function(){n?n[r]=this.result:q=this.result;--l||d(q)};u.readAsArrayBuffer(c)}else if(e(c))for(u=
0;u<c.length;u++)k(c[u],u,c);else if(c&&"object"==typeof c&&!f(c))for(u in c)k(c[u],u,c)}var l=0,q=c;k(q);l||d(q)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./is-buffer":58,isarray:33}],57:[function(c,b,d){function e(){}function k(c){var b=!1;var e=""+c.type;if(d.BINARY_EVENT==c.type||d.BINARY_ACK==c.type)e+=c.attachments,e+="-";c.nsp&&"/"!=c.nsp&&(b=!0,e+=c.nsp);null!=c.id&&(b&&(e+=",",b=!1),e+=c.id);null!=c.data&&(b&&
(e+=","),e+=u.stringify(c.data));n("encoded %j as %s",c,e);return e}function l(c,b){h.removeBlobs(c,function(c){var d=h.deconstructPacket(c);c=k(d.packet);d=d.buffers;d.unshift(c);b(d)})}function q(){this.reconstructor=null}function r(c){this.reconPack=c;this.buffers=[]}var n=c("debug")("socket.io-parser"),u=c("json3");c("isarray");b=c("component-emitter");var h=c("./binary"),m=c("./is-buffer");d.protocol=4;d.types="CONNECT DISCONNECT EVENT BINARY_EVENT ACK BINARY_ACK ERROR".split(" ");d.CONNECT=
0;d.DISCONNECT=1;d.EVENT=2;d.ACK=3;d.ERROR=4;d.BINARY_EVENT=5;d.BINARY_ACK=6;d.Encoder=e;d.Decoder=q;e.prototype.encode=function(c,b){n("encoding packet %j",c);d.BINARY_EVENT==c.type||d.BINARY_ACK==c.type?l(c,b):(c=k(c),b([c]))};b(q.prototype);q.prototype.add=function(c){if("string"==typeof c){a:{var b={},e=0;b.type=Number(c.charAt(0));if(null==d.types[b.type])c={type:d.ERROR,data:"parser error"};else{if(d.BINARY_EVENT==b.type||d.BINARY_ACK==b.type){for(var f="";"-"!=c.charAt(++e)&&(f+=c.charAt(e),
e!=c.length););if(f!=Number(f)||"-"!=c.charAt(e))throw Error("Illegal attachments");b.attachments=Number(f)}if("/"==c.charAt(e+1))for(b.nsp="";++e;){f=c.charAt(e);if(","==f)break;b.nsp+=f;if(e==c.length)break}else b.nsp="/";f=c.charAt(e+1);if(""!==f&&Number(f)==f){for(b.id="";++e;){f=c.charAt(e);if(null==f||Number(f)!=f){--e;break}b.id+=c.charAt(e);if(e==c.length)break}b.id=Number(b.id)}if(c.charAt(++e))try{b.data=u.parse(c.substr(e))}catch(Ob){c={type:d.ERROR,data:"parser error"};break a}n("decoded %s as %j",
c,b);c=b}}d.BINARY_EVENT==c.type||d.BINARY_ACK==c.type?(this.reconstructor=new r(c),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",c)):this.emit("decoded",c)}else if(m(c)||c.base64)if(this.reconstructor){if(c=this.reconstructor.takeBinaryData(c))this.reconstructor=null,this.emit("decoded",c)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+c);};q.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};
r.prototype.takeBinaryData=function(c){this.buffers.push(c);return this.buffers.length==this.reconPack.attachments?(c=h.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),c):null};r.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},{"./binary":56,"./is-buffer":58,"component-emitter":8,debug:10,isarray:33,json3:34}],58:[function(c,b,d){(function(c){b.exports=function(b){return c.Buffer&&c.Buffer.isBuffer(b)||c.ArrayBuffer&&b instanceof ArrayBuffer}}).call(this,
"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],59:[function(c,b,d){b.exports=function(c,b){for(var d=[],e=(b=b||0)||0;e<c.length;e++)d[e-b]=c[e];return d}},{}],60:[function(c,b,d){(function(c){(function(e){function f(c){for(var b=[],d=0,e=c.length,f,k;d<e;)f=c.charCodeAt(d++),55296<=f&&56319>=f&&d<e?(k=c.charCodeAt(d++),56320==(k&64512)?b.push(((f&1023)<<10)+(k&1023)+65536):(b.push(f),d--)):b.push(f);return b}function k(c){if(55296<=c&&
57343>=c)throw Error("Lone surrogate U+"+c.toString(16).toUpperCase()+" is not a scalar value");}function r(){if(ca>=t)throw Error("Invalid byte index");var c=p[ca]&255;ca++;if(128==(c&192))return c&63;throw Error("Invalid continuation byte");}function n(){if(ca>t)throw Error("Invalid byte index");if(ca==t)return!1;var c=p[ca]&255;ca++;if(0==(c&128))return c;if(192==(c&224)){var b=r();c=(c&31)<<6|b;if(128<=c)return c;throw Error("Invalid continuation byte");}if(224==(c&240)){b=r();var d=r();c=(c&
15)<<12|b<<6|d;if(2048<=c)return k(c),c;throw Error("Invalid continuation byte");}if(240==(c&248)){b=r();d=r();var e=r();c=(c&15)<<18|b<<12|d<<6|e;if(65536<=c&&1114111>=c)return c}throw Error("Invalid UTF-8 detected");}var u="object"==typeof d&&d,h="object"==typeof b&&b&&b.exports==u&&b,m="object"==typeof c&&c;if(m.global===m||m.window===m)e=m;var ha=String.fromCharCode,p,t,ca;m={version:"2.0.0",encode:function(c){c=f(c);for(var b=c.length,d=-1,e,l="";++d<b;){e=c[d];if(0==(e&4294967168))e=ha(e);else{var q=
"";0==(e&4294965248)?q=ha(e>>6&31|192):0==(e&4294901760)?(k(e),q=ha(e>>12&15|224),q+=ha(e>>6&63|128)):0==(e&4292870144)&&(q=ha(e>>18&7|240),q+=ha(e>>12&63|128),q+=ha(e>>6&63|128));e=q+=ha(e&63|128)}l+=e}return l},decode:function(c){p=f(c);t=p.length;ca=0;c=[];for(var b;!1!==(b=n());)c.push(b);b=c.length;for(var d=-1,e,k="";++d<b;)e=c[d],65535<e&&(e-=65536,k+=ha(e>>>10&1023|55296),e=56320|e&1023),k+=ha(e);return k}};if(u&&!u.nodeType)if(h)h.exports=m;else{e={}.hasOwnProperty;for(var w in m)e.call(m,
w)&&(u[w]=m[w])}else e.utf8=m})(this)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],61:[function(c,b,d){b.exports="function"===typeof Object.create?function(c,b){c.super_=b;c.prototype=Object.create(b.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}})}:function(c,b){c.super_=b;var d=function(){};d.prototype=b.prototype;c.prototype=new d;c.prototype.constructor=c}},{}],62:[function(c,b,d){b.exports=
function(c){return c&&"object"===typeof c&&"function"===typeof c.copy&&"function"===typeof c.fill&&"function"===typeof c.readUInt8}},{}],63:[function(c,b,d){(function(b,e){function f(c,b){var e={seen:[],stylize:r};3<=arguments.length&&(e.depth=arguments[2]);4<=arguments.length&&(e.colors=arguments[3]);z(b)?e.showHidden=b:b&&d._extend(e,b);D(e.showHidden)&&(e.showHidden=!1);D(e.depth)&&(e.depth=2);D(e.colors)&&(e.colors=!1);D(e.customInspect)&&(e.customInspect=!0);e.colors&&(e.stylize=k);return u(e,
c,e.depth)}function k(c,b){return(b=f.styles[b])?"\u001b["+f.colors[b][0]+"m"+c+"\u001b["+f.colors[b][1]+"m":c}function r(c,b){return c}function n(c){var b={};c.forEach(function(c,d){b[c]=!0});return b}function u(c,b,e){if(c.customInspect&&b&&E(b.inspect)&&b.inspect!==d.inspect&&(!b.constructor||b.constructor.prototype!==b)){var f=b.inspect(e,c);y(f)||(f=u(c,f,e));return f}if(f=h(c,b))return f;var k=Object.keys(b),l=n(k);c.showHidden&&(k=Object.getOwnPropertyNames(b));if(H(b)&&(0<=k.indexOf("message")||
0<=k.indexOf("description")))return m(b);if(0===k.length){if(E(b))return c.stylize("[Function"+(b.name?": "+b.name:"")+"]","special");if(A(b))return c.stylize(RegExp.prototype.toString.call(b),"regexp");if(F(b))return c.stylize(Date.prototype.toString.call(b),"date");if(H(b))return m(b)}f="";var q=!1,r=["{","}"];ca(b)&&(q=!0,r=["[","]"]);E(b)&&(f=" [Function"+(b.name?": "+b.name:"")+"]");A(b)&&(f=" "+RegExp.prototype.toString.call(b));F(b)&&(f=" "+Date.prototype.toUTCString.call(b));H(b)&&(f=" "+
m(b));if(0===k.length&&(!q||0==b.length))return r[0]+f+r[1];if(0>e)return A(b)?c.stylize(RegExp.prototype.toString.call(b),"regexp"):c.stylize("[Object]","special");c.seen.push(b);k=q?p(c,b,e,l,k):k.map(function(d){return t(c,b,e,l,d,q)});c.seen.pop();return w(k,f,r)}function h(c,b){if(D(b))return c.stylize("undefined","undefined");if(y(b))return b="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",c.stylize(b,"string");if(x(b))return c.stylize(""+b,"number");if(z(b))return c.stylize(""+
b,"boolean");if(null===b)return c.stylize("null","null")}function m(c){return"["+Error.prototype.toString.call(c)+"]"}function p(c,b,d,e,f){for(var k=[],l=0,q=b.length;l<q;++l)Object.prototype.hasOwnProperty.call(b,String(l))?k.push(t(c,b,d,e,String(l),!0)):k.push("");f.forEach(function(f){f.match(/^\d+$/)||k.push(t(c,b,d,e,f,!0))});return k}function t(c,b,d,e,f,k){var l,q;b=Object.getOwnPropertyDescriptor(b,f)||{value:b[f]};b.get?q=b.set?c.stylize("[Getter/Setter]","special"):c.stylize("[Getter]",
"special"):b.set&&(q=c.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(e,f)||(l="["+f+"]");q||(0>c.seen.indexOf(b.value)?(q=null===d?u(c,b.value,null):u(c,b.value,d-1),-1<q.indexOf("\n")&&(q=k?q.split("\n").map(function(c){return"  "+c}).join("\n").substr(2):"\n"+q.split("\n").map(function(c){return"   "+c}).join("\n"))):q=c.stylize("[Circular]","special"));if(D(l)){if(k&&f.match(/^\d+$/))return q;l=JSON.stringify(""+f);l.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(l=l.substr(1,l.length-
2),l=c.stylize(l,"name")):(l=l.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),l=c.stylize(l,"string"))}return l+": "+q}function w(c,b,d){var e=0;return 60<c.reduce(function(c,b){e++;0<=b.indexOf("\n")&&e++;return c+b.replace(/\u001b\[\d\d?m/g,"").length+1},0)?d[0]+(""===b?"":b+"\n ")+" "+c.join(",\n  ")+" "+d[1]:d[0]+b+" "+c.join(", ")+" "+d[1]}function ca(c){return Array.isArray(c)}function z(c){return"boolean"===typeof c}function x(c){return"number"===typeof c}function y(c){return"string"===
typeof c}function D(c){return void 0===c}function A(c){return B(c)&&"[object RegExp]"===Object.prototype.toString.call(c)}function B(c){return"object"===typeof c&&null!==c}function F(c){return B(c)&&"[object Date]"===Object.prototype.toString.call(c)}function H(c){return B(c)&&("[object Error]"===Object.prototype.toString.call(c)||c instanceof Error)}function E(c){return"function"===typeof c}function C(c){return 10>c?"0"+c.toString(10):c.toString(10)}function ba(){var c=new Date,b=[C(c.getHours()),
C(c.getMinutes()),C(c.getSeconds())].join(":");return[c.getDate(),N[c.getMonth()],b].join(" ")}var G=/%[sdj%]/g;d.format=function(c){if(!y(c)){for(var b=[],d=0;d<arguments.length;d++)b.push(f(arguments[d]));return b.join(" ")}d=1;var e=arguments,k=e.length;b=String(c).replace(G,function(c){if("%%"===c)return"%";if(d>=k)return c;switch(c){case "%s":return String(e[d++]);case "%d":return Number(e[d++]);case "%j":try{return JSON.stringify(e[d++])}catch(fm){return"[Circular]"}default:return c}});for(var l=
e[d];d<k;l=e[++d])b=null!==l&&B(l)?b+(" "+f(l)):b+(" "+l);return b};d.deprecate=function(c,f){if(D(e.process))return function(){return d.deprecate(c,f).apply(this,arguments)};if(!0===b.noDeprecation)return c;var k=!1;return function(){if(!k){if(b.throwDeprecation)throw Error(f);b.traceDeprecation?console.trace(f):console.error(f);k=!0}return c.apply(this,arguments)}};var O={},I;d.debuglog=function(c){D(I)&&(I=b.env.NODE_DEBUG||"");c=c.toUpperCase();if(!O[c])if((new RegExp("\\b"+c+"\\b","i")).test(I)){var e=
b.pid;O[c]=function(){var b=d.format.apply(d,arguments);console.error("%s %d: %s",c,e,b)}}else O[c]=function(){};return O[c]};d.inspect=f;f.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};f.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};d.isArray=ca;d.isBoolean=z;d.isNull=
function(c){return null===c};d.isNullOrUndefined=function(c){return null==c};d.isNumber=x;d.isString=y;d.isSymbol=function(c){return"symbol"===typeof c};d.isUndefined=D;d.isRegExp=A;d.isObject=B;d.isDate=F;d.isError=H;d.isFunction=E;d.isPrimitive=function(c){return null===c||"boolean"===typeof c||"number"===typeof c||"string"===typeof c||"symbol"===typeof c||"undefined"===typeof c};d.isBuffer=c("./support/isBuffer");var N="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");d.log=function(){console.log("%s - %s",
ba(),d.format.apply(d,arguments))};d.inherits=c("inherits");d._extend=function(c,b){if(!b||!B(b))return c;for(var d=Object.keys(b),e=d.length;e--;)c[d[e]]=b[d[e]];return c}}).call(this,c("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":62,_process:43,inherits:61}],64:[function(c,b,d){if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){var e="moz";var k=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],
10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)e="webkit",k=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10);c=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;d=window.mozRTCIceCandidate||window.RTCIceCandidate;var l=window.mozRTCSessionDescription||window.RTCSessionDescription,q=window.webkitMediaStream||window.MediaStream,r="https:"===window.location.protocol&&("webkit"===
e&&26<=k||"moz"===e&&33<=k),n=window.AudioContext||window.webkitAudioContext,u=document.createElement("video");u=u&&u.canPlayType&&"probably"===u.canPlayType('video/webm; codecs="vp8", vorbis');var h=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;b.exports={prefix:e,browserVersion:k,support:!!c&&!!h,supportRTCPeerConnection:!!c,supportVp8:u,supportGetUserMedia:!!h,supportDataChannel:!!(c&&c.prototype&&c.prototype.createDataChannel),supportWebAudio:!(!n||
!n.prototype.createMediaStreamSource),supportMediaStream:!(!q||!q.prototype.removeTrack),supportScreenSharing:!!r,AudioContext:n,PeerConnection:c,SessionDescription:l,IceCandidate:d,MediaStream:q,getUserMedia:h}},{}],65:[function(c,b,d){function e(){}b.exports=e;e.mixin=function(c){c=c.prototype||c;c.isWildEmitter=!0;c.on=function(c,b,d){this.callbacks=this.callbacks||{};var e=3===arguments.length,f=e?arguments[2]:arguments[1];f._groupName=e?arguments[1]:void 0;(this.callbacks[c]=this.callbacks[c]||
[]).push(f);return this};c.once=function(c,b,d){function e(){f.off(c,e);l.apply(this,arguments)}var f=this,k=3===arguments.length,l=k?arguments[2]:arguments[1];this.on(c,k?arguments[1]:void 0,e);return this};c.releaseGroup=function(c){this.callbacks=this.callbacks||{};var b,d;for(b in this.callbacks){var e=this.callbacks[b];var f=0;for(d=e.length;f<d;f++)e[f]._groupName===c&&(e.splice(f,1),f--,d--)}return this};c.off=function(c,b){this.callbacks=this.callbacks||{};var d=this.callbacks[c];if(!d)return this;
if(1===arguments.length)return delete this.callbacks[c],this;var e=d.indexOf(b);d.splice(e,1);0===d.length&&delete this.callbacks[c];return this};c.emit=function(c){this.callbacks=this.callbacks||{};var b=[].slice.call(arguments,1),d=this.callbacks[c],e=this.getWildcardCallbacks(c),f;if(d){var k=d.slice();d=0;for(f=k.length;d<f&&k[d];++d)k[d].apply(this,b)}if(e)for(k=e.slice(),d=0,f=k.length;d<f&&k[d];++d)k[d].apply(this,[c].concat(b));return this};c.getWildcardCallbacks=function(c){this.callbacks=
this.callbacks||{};var b,d=[];for(b in this.callbacks){var e=b.split("*");if("*"===b||2===e.length&&c.slice(0,e[0].length)===e[0])d=d.concat(this.callbacks[b])}return d}};e.mixin(e)},{}],66:[function(c,b,d){function e(c,b,d){return b?new k(c,b):new k(c)}c=function(){return this}();var k=c.WebSocket||c.MozWebSocket;b.exports=k?e:null;k&&(e.prototype=k.prototype)},{}],67:[function(c,b,d){function e(c){var b=!0;c.getTracks().forEach(function(c){b="ended"===c.readyState&&b});return b}function k(c){var b=
this;r.call(this);this.id=c.id;this.parent=c.parent;this.type=c.type||"video";this.oneway=c.oneway||!1;this.sharemyscreen=c.sharemyscreen||!1;this.browserPrefix=c.prefix;this.stream=c.stream;this.enableDataChannels=void 0===c.enableDataChannels?this.parent.config.enableDataChannels:c.enableDataChannels;this.receiveMedia=c.receiveMedia||this.parent.config.receiveMedia;this.channels={};this.sid=c.sid||Date.now().toString();this.pc=new q(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints);
this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("endOfCandidates",function(c){b.send("endOfCandidates",c)});this.pc.on("offer",function(c){b.parent.config.nick&&(c.nick=b.parent.config.nick);b.send("offer",c)});this.pc.on("answer",function(c){b.parent.config.nick&&(c.nick=b.parent.config.nick);b.send("answer",c)});this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this));this.pc.on("addChannel",this.handleDataChannelAdded.bind(this));this.pc.on("removeStream",this.handleStreamRemoved.bind(this));
this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded"));this.pc.on("iceConnectionStateChange",this.emit.bind(this,"iceConnectionStateChange"));this.pc.on("iceConnectionStateChange",function(){switch(b.pc.iceConnectionState){case "failed":"offer"===b.pc.pc.localDescription.type&&(b.parent.emit("iceFailed",b),b.send("connectivityError"))}});this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange"));this.logger=this.parent.logger;"screen"===c.type?this.parent.localScreens&&
this.parent.localScreens[0]&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),this.pc.addStream(this.parent.localScreens[0]),this.broadcaster=c.broadcaster):this.parent.localStreams.forEach(function(c){b.pc.addStream(c)});this.on("channelOpen",function(c){"https://simplewebrtc.com/protocol/filetransfer#inband-v1"===c.protocol&&(c.onmessage=function(d){d=JSON.parse(d.data);var e=new n.Receiver;e.receive(d,c);b.emit("fileTransfer",d,e);e.on("receivedFile",function(c,
b){e.channel.close()})})});this.on("*",function(){b.parent.emit.apply(b.parent,arguments)})}d=c("util");var l=c("webrtcsupport"),q=c("rtcpeerconnection"),r=c("wildemitter"),n=c("filetransfer");d.inherits(k,r);k.prototype.handleMessage=function(c){var b=this;this.logger.log("getting",c.type,c);c.prefix&&(this.browserPrefix=c.prefix);"offer"===c.type?(this.nick||(this.nick=c.payload.nick),delete c.payload.nick,this.pc.handleOffer(c.payload,function(c){c||b.pc.answer(function(c,b){})})):"answer"===c.type?
(this.nick||(this.nick=c.payload.nick),delete c.payload.nick,this.pc.handleAnswer(c.payload)):"candidate"===c.type?this.pc.processIce(c.payload):"connectivityError"===c.type?this.parent.emit("connectivityError",b):"mute"===c.type?this.parent.emit("mute",{id:c.from,name:c.payload.name}):"unmute"===c.type&&this.parent.emit("unmute",{id:c.from,name:c.payload.name})};k.prototype.send=function(c,b){b={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:c,payload:b,prefix:l.prefix};
this.logger.log("sending",c,b);this.parent.emit("message",b)};k.prototype.sendDirectly=function(c,b,d){d={type:b,payload:d};this.logger.log("sending via datachannel",c,b,d);c=this.getDataChannel(c);if("open"!=c.readyState)return!1;c.send(JSON.stringify(d));return!0};k.prototype._observeDataChannel=function(c){var b=this;c.onclose=this.emit.bind(this,"channelClose",c);c.onerror=this.emit.bind(this,"channelError",c);c.onmessage=function(d){b.emit("channelMessage",b,c.label,JSON.parse(d.data),c,d)};
c.onopen=this.emit.bind(this,"channelOpen",c)};k.prototype.getDataChannel=function(c,b){if(!l.supportDataChannel)return this.emit("error",Error("createDataChannel not supported"));var d=this.channels[c];b||(b={});if(d)return d;d=this.channels[c]=this.pc.createDataChannel(c,b);this._observeDataChannel(d);return d};k.prototype.onIceCandidate=function(c){if(!this.closed)if(c){var b=this.parent.config.peerConnectionConfig;"moz"===l.prefix&&b&&b.iceTransports&&c.candidate&&c.candidate.candidate&&0>c.candidate.candidate.indexOf(b.iceTransports)?
this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",b.iceTransports):this.send("candidate",c)}else this.logger.log("End of candidates.")};k.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc");this.pc.offer(this.receiveMedia,function(c,b){})};k.prototype.icerestart=function(){var c=this.receiveMedia;c.mandatory.IceRestart=!0;this.pc.offer(c,function(c,b){})};k.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())};
k.prototype.handleRemoteStreamAdded=function(c){var b=this;this.stream?this.logger.warn("Already have a remote stream"):(this.stream=c.stream,this.stream.getTracks().forEach(function(c){c.addEventListener("ended",function(){e(b.stream)&&b.end()})}),this.parent.emit("peerStreamAdded",this))};k.prototype.handleStreamRemoved=function(){var c=this.parent.peers.indexOf(this);-1<c&&(this.parent.peers.splice(c,1),this.closed=!0,this.parent.emit("peerStreamRemoved",this))};k.prototype.handleDataChannelAdded=
function(c){this.channels[c.label]=c;this._observeDataChannel(c)};k.prototype.sendFile=function(c){var b=new n.Sender,d=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:"https://simplewebrtc.com/protocol/filetransfer#inband-v1"});d.onopen=function(){d.send(JSON.stringify({size:c.size,name:c.name}));b.send(c,d)};d.onclose=function(){console.log("sender received transfer");b.emit("complete")};return b};b.exports=k},{filetransfer:26,rtcpeerconnection:44,util:63,webrtcsupport:64,wildemitter:65}],
68:[function(c,b,d){function e(c){var b=this,d=c||{},e=this.config={url:"https://sandbox.simplewebrtc.com:443/",socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}},f;var m=c.debug?c.logger||console:c.logger||n;this.logger=m;for(f in d)d.hasOwnProperty(f)&&
(this.config[f]=d[f]);this.capabilities=q;l.call(this);var u=null===this.config.connection?this.connection=new h(this.config):this.connection=this.config.connection;u.on("connect",function(){b.emit("connectionReady",u.getSessionid());b.sessionReady=!0;b.testReadiness()});u.on("message",function(c){var d=b.webrtc.getPeers(c.from,c.roomType);if("offer"===c.type){d.length&&d.forEach(function(b){b.sid==c.sid&&(e=b)});if(!e){var e=b.webrtc.createPeer({id:c.from,sid:c.sid,type:c.roomType,enableDataChannels:b.config.enableDataChannels&&
"screen"!==c.roomType,sharemyscreen:"screen"===c.roomType&&!c.broadcaster,broadcaster:"screen"!==c.roomType||c.broadcaster?null:b.connection.getSessionid()});b.emit("createdPeer",e)}e.handleMessage(c)}else d.length&&d.forEach(function(b){c.sid?b.sid===c.sid&&b.handleMessage(c):b.handleMessage(c)})});u.on("remove",function(c){c.id!==b.connection.getSessionid()&&b.webrtc.removePeers(c.id,c.type)});c.logger=this.logger;c.debug=!1;this.webrtc=new k(c);"mute unmute pauseVideo resumeVideo pause resume sendToAll sendDirectlyToAll getPeers".split(" ").forEach(function(c){b[c]=
b.webrtc[c].bind(b.webrtc)});this.webrtc.on("*",function(){b.emit.apply(b,arguments)});if(e.debug)this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:"));this.webrtc.on("localStream",function(){b.testReadiness()});this.webrtc.on("message",function(c){b.connection.emit("message",c)});this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this));this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this));this.config.adjustPeerVolume&&(this.webrtc.on("speaking",
this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1)));u.on("stunservers",function(c){b.webrtc.config.peerConnectionConfig.iceServers=c;b.emit("stunservers",c)});u.on("turnservers",function(c){b.webrtc.config.peerConnectionConfig.iceServers=b.webrtc.config.peerConnectionConfig.iceServers.concat(c);b.emit("turnservers",c)});this.webrtc.on("iceFailed",function(c){});this.webrtc.on("connectivityError",function(c){});this.webrtc.on("audioOn",
function(){b.webrtc.sendToAll("unmute",{name:"audio"})});this.webrtc.on("audioOff",function(){b.webrtc.sendToAll("mute",{name:"audio"})});this.webrtc.on("videoOn",function(){b.webrtc.sendToAll("unmute",{name:"video"})});this.webrtc.on("videoOff",function(){b.webrtc.sendToAll("mute",{name:"video"})});this.webrtc.on("localScreen",function(c){var d=document.createElement("video"),e=b.getRemoteVideoContainer();d.oncontextmenu=function(){return!1};d.id="localScreen";r(c,d);e&&e.appendChild(d);b.emit("localScreenAdded",
d);b.connection.emit("shareScreen");b.webrtc.peers.forEach(function(c){"video"===c.type&&(c=b.webrtc.createPeer({id:c.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:b.connection.getSessionid()}),b.emit("createdPeer",c),c.start())})});this.webrtc.on("localScreenStopped",function(c){b.getLocalScreen()&&b.stopScreenShare()});this.webrtc.on("channelMessage",function(c,d,e){"volume"==e.type&&b.emit("remoteVolumeChange",c,e.volume)});
this.config.autoRequestMedia&&this.startLocalVideo()}var k=c("./webrtc"),l=c("wildemitter"),q=c("webrtcsupport"),r=c("attachmediastream"),n=c("mockconsole"),h=c("./socketioconnection");e.prototype=Object.create(l.prototype,{constructor:{value:e}});e.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare();this.emit("leftRoom",this.roomName);this.roomName=void 0}};e.prototype.disconnect=
function(){this.connection.disconnect();delete this.connection};e.prototype.handlePeerStreamAdded=function(c){var b=this,d=this.getRemoteVideoContainer(),e=r(c.stream);c.videoEl=e;e.id=this.getDomId(c);d&&d.appendChild(e);this.emit("videoAdded",e,c);window.setTimeout(function(){b.webrtc.isAudioEnabled()||c.send("mute",{name:"audio"});b.webrtc.isVideoEnabled()||c.send("mute",{name:"video"})},250)};e.prototype.handlePeerStreamRemoved=function(c){var b=this.getRemoteVideoContainer(),d=c.videoEl;this.config.autoRemoveVideos&&
b&&d&&b.removeChild(d);d&&this.emit("videoRemoved",d,c)};e.prototype.getDomId=function(c){return[c.id,c.type,c.broadcaster?"broadcasting":"incoming"].join("_")};e.prototype.setVolumeForAll=function(c){this.webrtc.peers.forEach(function(b){b.videoEl&&(b.videoEl.volume=c)})};e.prototype.joinRoom=function(c,b){var d=this;this.roomName=c;this.connection.emit("join",c,function(e,f){console.log("join CB",e);O(f);if(e)d.emit("error",e);else{if(!f.xtra){kb();Sb();$h(y.errorLoading,"#ff0000");return}A.room=
f.xtra;var k,l;for(k in f.clients){var q=f.clients[k];for(l in q)if(q[l]){var r=d.webrtc.createPeer({id:k,type:l,enableDataChannels:d.config.enableDataChannels&&"screen"!==l,receiveMedia:{offerToReceiveAudio:"screen"!==l&&d.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:d.config.receiveMedia.offerToReceiveVideo}});d.emit("createdPeer",r);r.start()}}}b&&b(e,f);d.emit("joinedRoom",c)})};e.prototype.getEl=function(c){return"string"===typeof c?document.getElementById(c):c};e.prototype.startLocalVideo=
function(){var c=this;this.webrtc.start(this.config.media,function(b,d){b?c.emit("localMediaError",b):r(d,c.getLocalVideoContainer(),c.config.localVideo)})};e.prototype.stopLocalVideo=function(){this.webrtc.stop()};e.prototype.getLocalVideoContainer=function(){var c=this.getEl(this.config.localVideoEl);if(c&&"VIDEO"===c.tagName)return c.oncontextmenu=function(){return!1},c;if(c){var b=document.createElement("video");b.oncontextmenu=function(){return!1};c.appendChild(b);return b}};e.prototype.getRemoteVideoContainer=
function(){return this.getEl(this.config.remoteVideosEl)};e.prototype.shareScreen=function(c){this.webrtc.startScreenShare(c)};e.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]};e.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var c=document.getElementById("localScreen"),b=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&b&&c&&b.removeChild(c);c&&this.emit("videoRemoved",c);this.getLocalScreen()&&this.webrtc.stopScreenShare();
this.webrtc.peers.forEach(function(c){c.broadcaster&&c.end()})};e.prototype.testReadiness=function(){this.sessionReady&&(this.config.media.video||this.config.media.audio?0<this.webrtc.localStreams.length&&this.emit("readyToCall",this.connection.getSessionid()):this.emit("readyToCall",this.connection.getSessionid()))};e.prototype.createRoom=function(c,b){this.roomName=c;this.connection.emit("create",A.room,b)};e.prototype.sendFile=function(){if(!q.dataChannel)return this.emit("error",Error("DataChannelNotSupported"))};
b.exports=e},{"./socketioconnection":69,"./webrtc":70,attachmediastream:3,mockconsole:37,webrtcsupport:64,wildemitter:65}],69:[function(c,b,d){function e(c){this.connection=k.connect(c.url,c.socketio)}var k=c("socket.io-client");e.prototype.on=function(c,b){this.connection.on(c,b)};e.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};e.prototype.getSessionid=function(){return this.connection.id};e.prototype.disconnect=function(){return this.connection.disconnect()};b.exports=
e},{"socket.io-client":50}],70:[function(c,b,d){function e(c){var b=this,d=c||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:!0};var e;c=c.debug?c.logger||console:c.logger||l;this.logger=c;for(e in d)d.hasOwnProperty(e)&&(this.config[e]=d[e]);k.support||this.logger.error("Your browser doesn't seem to support WebRTC");this.peers=[];
q.call(this,this.config);this.on("speaking",function(){b.hardMuted||b.peers.forEach(function(c){c.enableDataChannels&&(c=c.getDataChannel("hark"),"open"==c.readyState&&c.send(JSON.stringify({type:"speaking"})))})});this.on("stoppedSpeaking",function(){b.hardMuted||b.peers.forEach(function(c){c.enableDataChannels&&(c=c.getDataChannel("hark"),"open"==c.readyState&&c.send(JSON.stringify({type:"stoppedSpeaking"})))})});this.on("volumeChange",function(c,d){b.hardMuted||b.peers.forEach(function(b){b.enableDataChannels&&
(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"volume",volume:c})))})});if(this.config.debug)this.on("*",function(c,d,e){(b.config.logger===l?console:b.logger).log("event:",c,d,e)})}d=c("util");var k=c("webrtcsupport"),l=c("mockconsole"),q=c("localmedia"),r=c("./peer");d.inherits(e,q);e.prototype.createPeer=function(c){c.parent=this;c=new r(c);this.peers.push(c);return c};e.prototype.removePeers=function(c,b){this.getPeers(c,b).forEach(function(c){c.end()})};e.prototype.getPeers=
function(c,b){return this.peers.filter(function(d){return(!c||d.id===c)&&(!b||d.type===b)})};e.prototype.sendToAll=function(c,b){this.peers.forEach(function(d){d.send(c,b)})};e.prototype.sendDirectlyToAll=function(c,b,d){this.peers.forEach(function(e){e.enableDataChannels&&e.sendDirectly(c,b,d)})};b.exports=e},{"./peer":67,localmedia:35,mockconsole:37,util:63,webrtcsupport:64}]},{},[68])(68)});var D,Aa,y={},A={name:"Guest"};console.log("%c nehhon %c POWER ","background: #00ffd4; color: #000; font-size:20px",
"background: #000; color: #00ffd4; font-size:20px");console.log("%c Author: Ruben ","background: #000; color: #00ffd4; font-size:20px");console.log("%c webmaster@nehhon.com ","background: #00ffd4; color: #000; font-size:20px");console.log("%c @nehhon ","background: #000; color: #00ffd4; font-size:20px");var w=function(b){return document.getElementById(b)},wk=!!window.opr||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),xk="undefined"!==typeof InstallTrigger,yk=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),
ai=!!document.documentMode,zk=!ai&&!!window.StyleMedia,Ak=!!window.chrome&&!!window.chrome.webstore,Bc;wk?Bc="Opera":xk?Bc="Firefox":yk?Bc="Safari":ai?Bc="IE":zk?Bc="Edge":Ak&&(Bc="Chrome");A.navLang=navigator.language||navigator.userLanguage;(function(){var b=A.navLang.substr(0,2),c={es:"Tzared",it:"Tzared",pl:"Tzared",ru:"\u0426\u0430\u0440\u0435\u0434",pt:"Tzared",bg:"\u0426\u0430\u0440\u0435\u0434",de:"Tzared"};c[b]?(window.history.pushState("","","/"+b+"/"+location.hash),document.getElementsByTagName("html")[0].lang=
b,document.getElementsByTagName("title")[0].innerHTML=c[b]):1<location.pathname.length&&(window.history.pushState("","","/"+location.hash),document.getElementsByTagName("html")[0].lang="en",document.getElementsByTagName("title")[0].innerHTML="Tzared")})();A.race=0;A.navigator=Bc;A.mx=151;A.onlineID=null;A.temperature=0;var Bk=location.pathname.split("/")[1],bi="en es it pt ru pl bg de".split(" ");A.lang=bi.indexOf(Bk);0>A.lang&&(A.lang=0);A.langCodeUrl=A.lang?bi[A.lang]+"/":"";var O=console.log,Ck=
document.getElementById("alerttitle"),Dk=document.getElementById("alerttext"),Ek=document.getElementById("alert"),gd=function(b,c,e){Ek.style.display="block";Ck.innerHTML=c||y.warning;Dk.innerHTML=b;e?document.getElementById("alertok").style.display="none":document.getElementById("alertok").style.display="block";w("basic").style.filter="blur(94px)"},Nh,di=function(b,c,e){var g=new XMLHttpRequest;g.open("GET",b,!0);g.responseType="arraybuffer";g.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");
g.onreadystatechange=function(){4==this.readyState&&200==this.status&&(c.length?R[c]=ci(g.response):R.xtra[c]=ci(g.response),R.load++,Qb&&R.load===R.images&&Qb())};e&&(g.onprogress=function(c){e(c)});g.send(!0)},ci=function(b){performance.now();b=new Uint16Array(b);var c=b.length,g=b[c-4]+65536*b[c-3],d=b[c-2]+65536*b[c-1];c-=2;var f=-1;d=new Uint8Array(4*d);for(var k=0;g<c;g++){var l=b[g];if(65533<l){65535==l?(l=b[g+1],g+=1):(l=b[g+1]+65536*b[g+2],g+=2);for(var q=0;q<l;q++)d[k++]=f&255,d[k++]=f>>
8&255,d[k++]=f>>16&255,d[k++]=f>>24&255}else l=b[2*l]+65536*b[2*l+1],d[k++]=l&255,d[k++]=l>>8&255,d[k++]=l>>16&255,d[k++]=l>>24&255,f=l}return d},R={size:512,load:0,xtra:[]},Qb;R.xtraRes=[];var X={page:0,length:8,leftButton:document.getElementById("aleft"),rightButton:document.getElementById("aright"),stock:document.getElementById("stock")},m;(function(){var b=0,c=0,e=function(g){g.target.loadedSize||(c+=g.total,g.target.lastLoaded=0,g.target.loadedSize=!0);b+=g.loaded-g.target.lastLoaded;g.target.lastLoaded=
g.loaded;w("loadingtext").innerHTML=y.loadgraphics+~~(100*b/c)+"%"},d=function(c){var b=!!c.icons;R.images=Object.keys(c).length;if(b){var g=new XMLHttpRequest;g.open("GET",c.icons,!0);g.responseType="arraybuffer";g.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");g.onreadystatechange=function(){if(4===g.readyState&&200===g.status){var c=new Uint8Array(g.response);c=new Blob([c],{type:"image/png"});var b=new Image;b.src=URL.createObjectURL(c);R.load++;X.icons=b;Qb&&
R.load===R.images&&Qb();Date.now()}};g.onprogress=function(c){e(c)};g.send("")}Date.now();var d=new XMLHttpRequest;d.open("GET",c.imageJSON,!0);b&&d.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");d.onreadystatechange=function(){4==this.readyState&&200==this.status&&(R.load++,Qb&&R.load===R.images&&Qb(),m=JSON.parse(d.response))};d.onprogress=function(c){e(c)};d.send(!0);di(c.common,"common",e)};(function(){var c=!1;"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),
navigator.serviceWorker.register("/sworker.js").then(function(){console.log("CLIENT: service worker registration complete.")},function(c){O(c);console.log("CLIENT: service worker registration failure.")})):console.log("CLIENT: service worker is not supported.");Nh=function(){R.started=!0;c||(c=!0,d({icons:"https://dl.dropboxusercontent.com/s/mpc0k7ep2l0v0j2/icons.png",imageJSON:"https://dl.dropboxusercontent.com/s/iea7wlmxml6pus0/images.json",common:"https://dl.dropboxusercontent.com/s/avpm3elzmphq5b1/graphics.nh17"}))}})()})();
var dg={grass:{json:"agjeb95idjel2dr/terrainData.json?v5",main:"xg1qh97bjrm61x0/grass.nh17"},snow:{json:"hwja6mugluokbkh/terrainData.json?v3",main:"1x2cwzm0i7v2sz8/terrain.nh17?v1"},last:""},xe,pk=function(){R.images+=2;var b=dg[w("terrainSelect").value];dg.last=w("terrainSelect").value;var c=new XMLHttpRequest;c.open("GET","https://dl.dropboxusercontent.com/s/"+b.json,!0);c.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");c.onreadystatechange=function(){if(4==this.readyState&&
200==this.status){R.xtraRes[0]=JSON.parse(c.response);cc=R.xtraRes[0];var b=cc.specialColor;xe=new Float32Array(Gb(b[0]/255,b[1]/255,b[2]/255,.9));R.load++;b="rgb("+b[0]+","+b[1]+","+b[2]+")";w("msgs1").style.color=b;w("playersinfo").style.color=b;w("topinfo").style.color=b;Qb&&R.load===R.images&&Qb()}};c.send(!0);di("https://dl.dropboxusercontent.com/s/"+b.main,0,!1)};if("undefined"!==typeof AudioContext){var ei=function(b,c,e){c=c.split("/")[1].split(".")[0].toLowerCase();ye[c]=b;!e||e.music&&e.mid!=
Ia.id||(za(c,e.x,e.y,e.k,e.music,e.date),e.date=0)},fi=function(b,c,e){this.context=b;this.urlList=c;this.onload=e;this.loadCount=0};fi.prototype.loadBuffer=function(b,c){var g=new XMLHttpRequest;g.open("GET",Fk+b,!0);g.responseType="arraybuffer";g.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");var d=this;g.onreadystatechange=function(){4===g.readyState&&200===g.status&&d.context.decodeAudioData(g.response).then(function(g){g&&ei(g,b,c)})};g.send()};var ye={},gi=
"kwf09yi8p5vq1px/Tzar%20Soundtrack%201.mp3 0d7r5b6yq8rvzxa/Tzar%20Soundtrack%202.mp3 6sc2lejtpq5hn1p/Tzar%20Soundtrack%203.mp3 0r454nszfs18sk8/Tzar%20Soundtrack%204.mp3 2qza05mvhvojepw/Tzar%20Soundtrack%205.mp3 55yuwxmo3ebav3v/Tzar%20Soundtrack%206.mp3 d9ifze8utu7b1d4/Tzar%20Soundtrack%207.mp3 ewnlwat5mpm3a6i/Tzar%20Soundtrack%208.mp3 emy8tmk7wrbxqik/Tzar%20Soundtrack%209.mp3 0ryt8t85pu140ys/Tzar%20Soundtrack%2010.mp3 ux3nmflf1efo0si/sr1.mp3 mb8leyhrlx3a8ep/sr2.mp3 uepj5sz037fs6jm/sr3.mp3 aqgug89aiyh78ym/sr4.mp3 v4mnk06t1cm5g2x/sr5.mp3 nnkkl7jddynbbg8/sr6.mp3 0foqk5c3t91c0ll/sr7.mp3 cacamdny4wwisyj/sr8.mp3 m8mbt8r1vlj2i9l/sr9.mp3 ubig3no0l96pnxp/sr10.mp3 jajip2pw72hwz5q/1.mp3 eub8hy6mtuw12vk/2.mp3 mml4nqhhj0ph30d/3.mp3 p72cdqjbjc7oa6v/4.mp3 m895z5a7e1stzg1/5.mp3 ya1yue1ti1ehyo8/6.mp3 lfq7ac9jvtcb8tr/7.mp3 onxh886y06v9c1m/8.mp3 u01v2nu5u1mooma/9.mp3 hfvvah4t7ngs942/10.mp3 zghe44ohag94non/INTRO.mp3 bjdukzb5x2d148f/OUTRO.mp3 m335ymfbydtah6n/WIN1.mp3 j0nl2nra3633p0m/WIN2.mp3 9igi2qh7ixqej07/ATTACK.WAV d48c9woeedsefpq/BALLISTA.WAV toc4s5nzofcrl7a/BLDGDONE.WAV c8k3wd0wmlgxzbj/CHAT%20LOCATION.WAV ser4l9wo87txp9k/TECHDONE.WAV 9f37sjm7co5ccuj/UNITDONE.WAV 6xn0s3j79267158/CHAT.WAV v39gv0xmfobxhm6/E_CASTLE1.WAV 2d9cjalgge5ig3g/E_CATHEDRAL1.WAV xmfkvzft63m3ivi/E_CATHEDRAL2.WAV vzzhxrrqftezh2b/E_FARM1.WAV ftrazbogpf8foip/E_CHURCH1.WAV 961xangoq096ta1/E_FARM2.WAV 5927kzdwz5znu6o/E_HARBOR1.WAV wwjtlgwpm230rqx/E_LUMBER1.WAV a4buxao1lfo5txs/E_MAGETOWER1.WAV mgcz1j57ijivnrx/E_MAGETOWER2.WAV mlqr06rsg0ebg5c/E_MAGETOWER3.WAV jcut9rj4pedruuf/E_MARKET1.WAV m7rpubt227a2mqm/E_SHIPYARD1.WAV dtlikm0f72bqts6/E_STABLES1.WAV 189t8l14j3gfbcd/E_STORAGE1.WAV 6u92t20jjl2ibax/E_OUTPOST1.WAV o6psq5jg611te7h/E_STORAGE2.WAV jpnp0pwsjfajpqh/E_TAVERN1.WAV omdobwnv6ijrdk6/E_WARACADEMY1.WAV xfph6w0wl72iy14/E_WORKSHOP1.WAV m9nzrabgjly054c/EVILCASTLE.WAV o1vdoiexa6q41kd/GATE1.WAV 0i8okhmc24fie1i/GATE2.WAV gcic4rgv7th76g5/GATE3.WAV 1gcczjnk6800a0w/GATE4.WAV s35f76gtwm27r2t/GATE5.WAV jkkktkeqcinw0qk/GATE6.WAV 0qsz059kx5x0fna/GATEWAY.WAV dx4ykguy0c2gkec/HOUSE1.WAV 0bu3c206awygol8/HOUSE2.WAV ixuujwh5i34jqyn/HOUSE3.WAV gtsdx7aq1qo1af9/HOUSE4.WAV y89q2pti77rnl62/HOUSE5.WAV slzdb82f2pq9efh/MERCHANT.WAV hxb9ppcht4b1agh/MINE1.WAV kmvph19wybjvtk3/MONASTERY1.WAV trjbjumhpdq2r6c/MONASTERY2.WAV xdzl5qyez51vp0i/R_CATHEDRAL1.WAV 0jfe5axwda2zy9m/R_CHURCH1.WAV jp0ya01e6lovbpv/SHAOLIN2.WAV sa97rwaqc4bczzg/SHAOLIN.WAV ba9yor9562k8rmk/CHOP%201.WAV 0yq403uktwmaskq/CHOP%202.WAV oumccxj3ppx74lb/CHOP%203.WAV zjlmh6oyt9z80vn/CHOP%204.WAV 8q3x45ooavhgdxf/CHOP%205.WAV tyyuf0ai2b7td9d/CHOP%206.WAV mxk7ilq612mco8y/CHOP%207.WAV vi1nql8csgxue0d/CHOP%208.WAV ptkzwv8er5r250q/CHOP%209.WAV e47rp6twlz7cvor/CHOP%2010.WAV swpbug0t56ool1r/CHOP%2011.WAV 2ddruqf84gi974h/DIG%201.WAV mdv1kf8bb7e6bwj/DIG%202.WAV u7h8iw95x8ufogy/DIG%203.WAV myb354s27trhsgb/MINE%201.WAV 3jca7grtu2uphde/MINE%202.WAV 0sgl0kc77mryj1j/MINE%203.WAV ry9mlisv1lqqp9d/HIT%201.WAV 2ufyfcq4wu9bk1i/HIT%202.WAV cqzlr7gy6mj0k66/HIT%203.WAV i86tqxj1sz91cru/HIT%204.WAV vf604r6t01qe6zd/HIT%205.WAV mnslicm4wy9wdj0/HIT%206.WAV p1ta2wlhfse37db/HIT%207.WAV emwp2hib6msgj22/GHOST1.WAV lrsl9rbxku5cjg7/GHOST2.WAV txbl2bb91s38dqx/GOLEM1.WAV pcfkaldpd7hfrjp/GOLEM2.WAV ivfai5ayu6q99yx/H%20SWORD%201.WAV gedtsneew008x4h/H%20SWORD%202.WAV 57xjkhtc93001et/H%20SWORD%203.WAV ni97b3dbi91yr8b/H%20SWORD%204.WAV 0ls1kz4but9zl51/H%20SWORD%205.WAV ks9mme9djnvdyi5/H%20SWORD%206.WAV hlinmaxi6xj6mv2/H%20SWORD%207.WAV hlinmaxi6xj6mv2/H%20SWORD%207.WAV dt4o378w3100sfu/H%20SWORD%208.WAV ks909spplow4fjz/H%20SWORD%209.WAV w2xfv47ffd7sb72/H%20SWORD%2010.WAV ypapwgz03m7utmq/H%20SWORD%2011.WAV zdcr00adm5qc6hs/H%20SWORD%2012.WAV y90qo1djcx5bzxa/HAND1.WAV 56vhwy7iiu9cpzy/HAND2.WAV 6zhms0m94qg4mvt/HAND3.WAV 41wm4r3cpgjaxly/HAND4.WAV tt4q17tzh6i7u1g/MAGE%20ATTACK.WAV ldhx6mr9upxefci/MESSIAH.WAV 07mie3az1eg1xxh/ORC%20SWORD%201.WAV 9v7spriyxf9szgh/ORC%20SWORD%202.WAV gcfojobbzl2drpn/ORC%20SWORD%203.WAV x0wz0zwpye9i5y3/ORC%20SWORD%204.WAV 2300jmtwppvm452/ORC%20SWORD%205.WAV 3yz2rottu8o8ggt/ORC%20SWORD%206.WAV x5s65vpufpj8t06/ORC%20SWORD%20V1.WAV 0nrb17mzbu3lxtc/ORC%20SWORD%20V2.WAV cypkkpihc1w1hcq/ORC%20SWORD%20V3.WAV y8umilh5cud7jih/SHIP%20CANNON%201.WAV 09kjxvpfn9bdprd/SHIP%20CANNON%202.WAV atj8b8w1k24aqfm/SHIP%20CANNON%203.WAV 6ju34h2pw3nhg7s/SHIP%20CANNON%204.WAV l18s2fbq9q6nzpm/SHIP%20CANNON%205.WAV vrgh4puvgdbpwae/SHIP%20CANNON%206.WAV tmbpku710qnx85q/SHIP%20CANNON%207.WAV 2nomenens1x41lf/SIEGE.WAV 8t9zd51oee3n6vw/SWORD%201.WAV gmwu6lxjaf4mxvv/SWORD%202.WAV tfjzh0u37b60xfc/SWORD%203.WAV s0w71lijsebscys/SWORD%204.WAV 63xcxvtf6fz4nmv/SWORD%205.WAV qpqihts3djiavqd/SWORD%206.WAV zw2cqwnqq5bo3aw/SWORD%207.WAV ub1hntg5qh5h58k/SWORD%208.WAV r4viyma73vblsf5/SWORD%209.WAV 8lxp86hri1yejyt/SWORD%2010.WAV r63199ryslobulc/SWORD%2011.WAV ph48z41qbgbaina/SWORD%2012.WAV o87veypm8qensdd/SWORD%2013.WAV fwapbo29d97mer1/SWORD%2014.WAV tyzv9eybfmt378i/SWORD%2015.WAV 0164fmqamf7yr9s/SWORD%2016.WAV c9renf4qsr56ab4/V%20SWORD%201.WAV gge4f1nb5o7m9qd/V%20SWORD%202.WAV wo0f0ul88unnh01/V%20SWORD%203.WAV q48z5txon4bv76v/V%20SWORD%204.WAV kibmb5mtp1oasan/V%20SWORD%205.WAV 360bl44ii251dus/V%20SWORD%206.WAV oya931j5cn584vn/V%20SWORD%207.WAV rgh3xwlvihecsur/ADRAGON2.WAV jafi9t4hdx4gjnu/ADRAGON3.WAV p7yau58i9x9tznf/ARROW%201.WAV 16jf0mu2c4902ad/ARROW%202.WAV 3gf1vmhszlzsvp6/ARROW%203.WAV hastp290kjpatul/ARROW%204.WAV rzf63kcptscqqb6/ARROW%205.WAV ueysrsca11dznn1/ARROW%206.WAV 2l7ncb4kro91hjp/ARROW%20V1.WAV 6z1zfcuve202wlt/ARROW%20V2.WAV 4al06dvukghp9p8/ARROW%20V3.WAV y3cj0obmsklz7kb/ARROW%20V4.WAV zopzovz1zdos9qn/BEAR1.WAV glbc40fzxrz7x4u/BEAR2.WAV mq7830e9lsw539i/BEAR3.WAV s5h4p53936jqf0m/BEAR4.WAV at4kj0gz88632rt/BEAR5.WAV uq2u4sgg8g6tmou/MWORKSHOP.WAV 09hjcqjlhkgwjsi/DESTROY%20BUILDING.WAV rxan7ebabmxn77z/DESTROY%20MINE.WAV pcwbjrjklna7q57/LIGHTING2.WAV uv2jv59kstujpap/LIGHTING.WAV 6omy17asgyyvcdg/METEOR.WAV r193yz5l7k7yb2i/SMALL%20EXPLOSION.WAV os6jelw7rx49obm/WATER%20BLOP.WAV tjdz2vmlil8c8ud/SPY%20KILL%201.WAV z9tqra8z2pj8fto/SPY%20KILL%203.WAV l85d5424o8s1tq3/SPY%20KILL%202.WAV 97k844atrp03l71/PRIEST%20ATTACK.WAV 2rs81eunjj79t8m/LIGHTNING.WAV i16vdcztiiyd9pl/INVISIBLE.WAV 01a581w494e6nc3/HEAL.WAV v0f62hdvhy2vhiw/FREEZE.WAV e9xkwqnmq1h3xii/FLAME%20BALL.WAV yn1958raqi2el4a/CURSE.WAV 455t0hvitbn4nns/CRUSADE.WAV 1wl7qmtar3y1j2v/CONFUSION.WAV fz21lqeozbq043o/BLESS.WAV xyq2n7ixn80pyn5/WHIRLPOOL.WAV 1t99pip34fvthkq/TURN%20TO%20STONE.WAV jdclsge6rjo7vgo/TEACH.WAV xt7pqtetzsvtgai/SUMMON10.WAV yxcdbheu9s6sqbp/SUMMON9.WAV oum26s9h0mkg6ya/SUMMON8.WAV 46cvrb8px83r1ze/SUMMON7.WAV of68oo8ne7cgdtw/SUMMON6.WAV 3awiprcaujqvohu/SUMMON5.WAV 5kq2b6q3d8ncpww/SUMMON4.WAV avx69olt3m6rrnr/SUMMON3.WAV m08n1qafeiyqe05/SUMMON2.WAV ui2kvbd47bfmx2b/SUMMON1.WAV k8qekk7sutmpcot/REVEAL.WAV 0q9fghfa9qhq5qw/RESSURECT.WAV cb1pq0ssnmj4jic/COWDIE1.WAV f7wgvizjaklyf7n/COWDIE2.WAV cb1pq0ssnmj4jic/COWDIE1.WAV y5zib4fpfywsurg/COWDIE3.WAV oy9j73ss27gix5z/COWDIE4.WAV 1eyn0em70qu0f2i/DIE%201.WAV 27kh2wyo2o9znoz/DIE%202.WAV u572ytnhxy4km3h/DIE%203.WAV 182gaz77ml2mei7/DIE%204.WAV wpvdhtxbe6yy29z/DIE%205.WAV un94l6ebn0l9y2p/DIE%206.WAV 3k2ph5z9vm6ytvz/DIE%207.WAV hjnvqvyet103hf7/DIE%208.WAV umjfyhfxku3dwvp/DIE%209.WAV x1evcyyuhwy2vd3/DIE%2010.WAV xzk59hp6c4wdk3t/DRAGON%20DIE%201.WAV ar7eck4ow8r5w3s/DRAGON%20DIE%202.WAV emwp2hib6msgj22/GHOST1.WAV lrsl9rbxku5cjg7/GHOST2.WAV 6at0jqhx4dza704/GOLEM.WAV h5ydq4j2zdpkiu8/H%20DIE%201.WAV 1bp2u30m504f314/H%20DIE%202.WAV r5kdxiuj8chfl55/H%20DIE%203.WAV 0gubmigjng965ss/H%20DIE%204.WAV 4xzstnrfwevpx21/H%20DIE%205.WAV pnrvg1i5b0jf50i/H%20DIE%206.WAV wkzig2jil3z2hgi/H%20DIE%207.WAV ue13nwsyc6t5ox9/H%20DIE%208.WAV dxk8rptrddombo8/H%20DIE%209.WAV tsdk3uma1x5rz2v/H%20DIE%2010.WAV i3x6klg1g1tx9xx/MAGE.WAV t7c9h3ntknga8i7/ORC%20DIE%201.WAV zwf40uvu5rdu1wy/ORC%20DIE%202.WAV p9gga0rk3ftkkdf/SHIP%20SINK.WAV 5ihoed06p5cm26r/SIEGE%20DIE%201.WAV tahsd6hynfrv1qg/SIEGE%20DIE%202.WAV xboh1sh4rbvx88r/SIEGE%20DIE%203.WAV 4chclvk26ech3mz/SIEGE%20DIE%204.WAV w401vbbvvj99msr/SKELETON%20DIE%201.WAV 0ff119o39785ttm/SKELETON%20DIE%202.WAV 6lxfa75vtxfl2bb/SKELETON%20DIE%203.WAV f3aokr2ngvqpfit/SKELETON%20DIE%204.WAV omfzz21cazinkkm/MESSIAH_ATTACK.WAV 1w2vexiw5aqtrw4/C%20DIE%201.WAV h32280ztxrrz5aa/C%20DIE%202.WAV rq5rgbwaynrdtfc/C%20DIE%203.WAV usywc7awecnolh0/C%20DIE%204.WAV x33opiu95eb78ie/C%20DIE%205.WAV 4lo6hly2n52aq5b/CAMELDIE1.WAV gwsglwtm1fg2eqf/CAMELDIE2.WAV u3mxrmlb10sje2u/CAMELDIE3.WAV nw0ipg198lvq519/BAT%20ATTACK.WAV hukqtscgut9xic7/BAT%20CMD.WAV 77915sxy83vzump/BAT%20DIE.WAV".split(" ");
(function(){for(var b=0,c=gi.length;b<c;b++){var e=gi[b];ye[e.split("/")[1].split(".")[0].toLowerCase()]=e}})();var Ed="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206 arrow%20v1 arrow%20v2 arrow%20v3 arrow%20v4".split(" "),pg="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206".split(" "),Cc="sword%201 sword%202 sword%203 sword%204 sword%205 sword%206 sword%207 sword%208 sword%209 sword%2010 sword%2011 sword%2012 sword%2013 sword%2014 sword%2015 sword%2016 v%20sword%201 v%20sword%202 v%20sword%203 v%20sword%204 v%20sword%205 v%20sword%206 v%20sword%207".split(" "),
qg=["siege"],hi=["hand1","hand2","hand3","hand4"],ze="h%20sword%201 h%20sword%202 h%20sword%203 h%20sword%204 h%20sword%205 h%20sword%206 h%20sword%207 h%20sword%208 h%20sword%209 h%20sword%2010 h%20sword%2011 h%20sword%2012".split(" "),Gk=["ork%20sword%20v1","ork%20sword%20v2","ork%20sword%20v3"],Ae="ship%20cannon%201 ship%20cannon%202 ship%20cannon%203 ship%20cannon%204 ship%20cannon%205 ship%20cannon%206 ship%20cannon%207".split(" "),Hk=["ghost%201","ghost%202"],Ik=["mage%20attack"],I=["destroy%20building"],
rg=["siege%20die%201","siege%20die%202","siege%20die%203","siege%20die%204"],Be="h%20die%201 h%20die%202 h%20die%203 h%20die%204 h%20die%205 h%20die%206 h%20die%207 h%20die%208 h%20die%209 h%20die%2010".split(" "),gb="die%201 die%202 die%203 die%204 die%205 die%206 die%207 die%208 die%209 die%2010".split(" "),ii=["e_barrack1"],Fk="https://dl.dropboxusercontent.com/s/";window.AudioContext=window.AudioContext||window.webkitAudioContext;var Dc=new AudioContext;var Ce=Dc.createGain();var De=Dc.createGain();
var Jk=new fi(Dc,void 0,ei);Ce.gain.value=parseInt(document.getElementById("musicRange").value)/100;De.gain.value=parseInt(document.getElementById("soundRange").value)/100;var Ia=function(){if(!p.editor){Ia.id++;localStorage.setItem("favMusic",musicSelect.mversion.value);var b=Ia.list[musicSelect.mversion.value];b&&za(b[~~(b.length*Math.random())],0,0,void 0,1,0,Ia.id)}};document.getElementById("musicRange").oninput=function(){Ce.gain.value=parseInt(document.getElementById("musicRange").value)/100};
document.getElementById("soundRange").oninput=function(){De.gain.value=parseInt(document.getElementById("soundRange").value)/100};Ia.reset=function(){Ia.stop();Ia()};Ia.stop=function(){Ia.active&&(Ia.active.stop(),clearTimeout(Ia.intv))};Ia.id=0;Ia.list={originalMusic1:[1,2,3,4,5,6,7,8,9,10,"outro"],originalMusic:"tzar%20soundtrack%201 tzar%20soundtrack%202 tzar%20soundtrack%203 tzar%20soundtrack%204 tzar%20soundtrack%205 tzar%20soundtrack%206 tzar%20soundtrack%207 tzar%20soundtrack%208 tzar%20soundtrack%209 tzar%20soundtrack%2010".split(" "),
sharpRain:"sr1 sr2 sr3 sr4 sr5 sr6 sr7 sr8 sr9 sr10".split(" ")};var za=function(b,c,e,d,f,k,l){var g=b;if((b=ye[b])&&"loading"!==b&&!p.canceled){var r=-vb+(window.innerWidth-A.mx)/2,n=-Wa+window.innerHeight/2;if(b.duration){if(p.started)if(64<p.now()-b.lastPlayed||!b.lastPlayed)b.lastPlayed=p.now();else return;!f&&"attack"!=g&&k&&600<Date.now()-k||(c?(c=(-r+32*c)/80,e=(-n+32*e)/80,n=fa/8):n=e=c=0,void 0!==d&&d!==A.kingdom||p.mute||(d=Dc.createBufferSource(),d.buffer=b,f?(d.connect(Ce),Ce.connect(Dc.destination),
Ia.active=d,Ia.intv=setTimeout(Ia,~~(1E3*b.duration)+1E3)):(b=Dc.createPanner(),b.panningModel="HRTF",b.setPosition(c,e,n),d.connect(b),b.connect(De),De.connect(Dc.destination)),d.start(0)))}else ye[g]="loading",f={x:c,y:e,k:d,music:f,date:Date.now(),mid:l},Jk.loadBuffer(b,f)}}}var Fd=function(b,c,e,d){b.img===d.url&&(za(c+~~(Math.random()*e+1),b.x32,b.y32),setTimeout(Fd,Ja(d),b,c,e,d))};(function(){for(var b=document.getElementById("musicSelect").getElementsByTagName("input"),c=0,e=b.length;c<e;c++)b[c].onchange=
Ia.reset})();var Kk=function(b){for(var c=[],g=0,d=[b.icons],f=0,k=d.length;f<k;f++)for(var l=d[f],q=0,r=l.length;q<r;q++)if(l[q]){var n=l[q];n.doneBy||(n.doneBy=[]);n.doneBy.put(b);c[g++]=n;n.xtra&&(d.put(n.xtra),k++)}b.habilities=c},Lk=function(b,c){return c.balanceTotal-b.balanceTotal},sg=function(b,c){return c.priority-b.priority},Mk=function(b,c){return b-c},Ee=function(b,c){if(!b.url.attack||b.attackOnly&&!b.attackOnly[c.type])return 0;var g=25*~~(Ja(b.url.attack)/25);b=b.attack*((hd[b.type][c.type]||
0)+1);b-=c.defence;1>b&&(b=1);return~~(c.health/b)*g},wb=function(b){this.kingdom=b.k;this.aggressive=this.perfection=1;wb.arr.put(this)};wb.prototype.valorateLost=function(b){this.script.put({order:b.nu,obj:b,priority:1})};var tg=function(b,c,e,d,f){var g=e.obj.cost;d[0]+=g[0];d[1]+=g[1];d[2]+=g[2];d[3]+=g[3];b[b.length]={order:e,priority:c.priority,name:e.obj.name,obj:e.obj,pTime:c.obj.time,required:1,doner:f};b.changed=!0},ug=function(b,c,e,d,f){var g=[b],l=[],q={},r=f.target;l.put(b);for(var n=
0;n<g.length;n++){var h=g[n];h.availables&&(h.availables=void 0);if((b=h.order)&&!q[h.order.id]&&(q[h.order.id]=1,!e[b.id])){var m=b.requireObj;if(m)for(var v=0,p=m.length;v<p;v++)if(b=m[v],b.tech)c[b.nu.id]||e[b.nu.id]||tg(g,h,b.nu,r);else{var t=d[b.type];t.length||tg(g,h,b.nu,r)}if(m=b.doneBy)for(v=0,p=m.length;v<p;v++)b=m[v],t=d[b.type],t.length||b.race!=f.racestr||tg(g,h,b.nu,r,1);n&&!h.doner&&l.put(h)}}return l},vg={food:2,wood:1,gold:0,stone:3},Gd=function(b,c){b=b.order;var g=Gd.tech;b.obj.build&&
(g=Gd.build);return g(b,c)};Gd.tech=function(b,c){b=b.doneBy;for(var g=0,d=b.length;g<d;g++)for(var f=c[b[g].type],k=0,l=f.length;k<l;k++)if(f[k].free)return f[k].free=0,[f[k]];return!1};Gd.build=function(b,c){b=b.doneBy;for(var g=0,d=b.length;g<d;g++)for(var f=c[b[g].type],k=0,l=f.length;k<l;k++)if(f[k].free)return f[k].free=0,[f[k]];return!1};var rc=function(b,c){if(b){var g=b.order,d=g.obj,f=rc.unit;d.tech?f=rc.tech:d.build&&(f=rc.build);return f(g,c,b)}};rc.build=function(b,c){for(var g=[],d=
b.doneBy,f=mb[c.k],k=0,l=d.length;k<l;k++)for(var q=f[d[k].type],r=0,n=q.length;r<n;r++){var h=z[q[r]];if(!h.func&&!h.in){g.put(h.id);break}}if(!g.length)return!1;d=D;h=b.obj;b=h.space;f=h.validator.check;q=c.origin[0];r=c.origin[1];n=r-1;var m=q-1,v=q-40,p=r-40,t=Infinity,w=-1;l=6400;for(k=0;k<l;k++){var ca=k%80+v,x=~~(k/80)+p,y=(q-ca)*(q-ca)+(r-x)*(r-x);1600>y&&y<t&&f(ca,x,b,n,m,900>y,c.k)&&(t=y,w=ca+x*d)}if(0>w)return!1;da(id,[w,h.type],g);return!0};rc.tech=function(b,c){var g=b.doneBy;c=mb[c.k];
for(var d=[],f=0,k=g.length;f<k;f++)for(var l=c[g[f].type],q=0,r=l.length;q<r;q++){var n=z[l[q]];n.working||n.techStart||!n.built||d.put(n.id)}if(!d.length)return!1;da(wg,[b.obj.id,b.id],d[0]);return!0};rc.unit=function(b,c,e){e=b.doneBy;c=mb[c.k];for(var g=[],f=0,k=e.length;f<k;f++)for(var l=c[e[f].type],q=0,r=l.length;q<r;q++){var n=z[l[q]];n.working||n.techStart||!n.built||g.put(n.id)}if(!g.length)return!1;da(Fe,[b.obj.type,1,0],g[0]);return!0};wb.prototype.leaveMeAloneIKnowWhatToDo=function(){performance.now();
var b=H[this.kingdom],c=b.resources,e=mb[this.kingdom],d=D,f=b.origin[0],k=b.origin[1],l=k-1,q=f-1,r=f-40,n=k-40;O(r,n);for(var h=0,m=6400,v=0;v<m;v++){var w=v%80+r,x=~~(v/80)+n;1600>(f-w)*(f-w)+(k-x)*(k-x)&&(!(w>=q&&w<=q+2)||x>=l&&x<=l+2)&&0===U[w+x*d]&&pa(w,x)&&h++}var y=[];performance.now();for(var ca=0,A=0,F=t.length;A<F;A++){var L=t[A];if(!L.build&&!L.item&&!L.boat&&L.url.attack&&L.race==b.racestr&&8!=L.type){y.put(L);L.balanceSum=0;L.bestBalance=-1;L.balanceDefence={};for(var E=Infinity,C=L.attDist,
G=0;G<F;G++){var I=t[G];if(!I.build&&!I.item&&!I.boat&&I.race==b.racestr&&I.url.attack&&8!=I.type&&(ca=Ee(I,L))){var N=Ee(L,I);N&&(ca-=N,ca+=2E3*C,ca<E&&(E=ca,L.bestBalance=I),L.balanceSum+=ca)}}}L.balanceTotal=L.balanceSum}y.sort(Lk);L=y[0];for(var M=1E3,V={},ba=[],P=0,T=M;!V[L.type];)V[L.type]=1,ba[P++]=L,ba[P++]=M,I=L.bestBalance,M=~~(M*Ee(I,L)/Ee(L,I)+.5),T+=M,L=I;ba.nu=T-M;for(var J=b.target,Q=B,da=Q.length,R=[],Y=0;Y<da;Y++){var X=Q[Y],S;if(!(S=!X.type||X.upgrade||X.type==Z||void 0!==vg[X.value]&&
b.resources[X.value]>=J[X.value])){a:{for(var aa=X.nu.doneBy,fa=0,ja=aa.length;fa<ja;fa++)if(aa[fa].race==b.racestr){var ka=!0;break a}ka=!1}S=!ka}S||R.put({order:X.nu,obj:X,original:1,priority:1E-10})}var ia=[];v=0;m=ba.length;for(var na=ba.nu;v<m;v+=2){var oa=~~(.5+ba[v+1]/na*250)-e[ba[v].type].length,W=ba[v];W=W.nu;for(var ea=0;ea<oa;ea++)priority=1-ea/oa,R.put({order:W,priority:priority,obj:W.obj,original:1})}var ma=0,wa=0,ra=b.target,ta={};wa++;ra[0]=0;ra[1]=0;ra[2]=0;ra[3]=0;v=ma=ia.length=
0;for(m=R.length;v<m;v++){var Aa=R[v].priority,za=ug(R[v],b.technology.actived,b.technology.hidden,e,b);ea=0;for(var qa=za.length;ea<qa;ea++){W=za[ea];W.original||(W.priority=Aa);var ua=1;void 0!==W.priority&&(ua=W.priority);var va=W.obj;va.increase&&void 0!==vg[va.value]&&(ua=va.increase*ua/c[vg[va.value]]);ua/=va.time;W.priority=ua;if(!(0>=W.priority)){var Ca=W.order.id;!ta[Ca]||W.original?(ta[Ca]=ma,ia[ma++]=W):ia[ta[Ca]].priority+=W.priority}}}var Da=!1;ia.sort(sg);var Fa={},Ka={},Ba={},sa=[],
Pa=t.length;for(v=0;v<Pa;Ba[v++]=0);for(v=0;v<ia.length;v++){var la=ia[v];W=la.order;var La=la.obj;if(la.original||la.required)la.obj.tech||Ba[la.obj.type]++,sa.put(la);var Ma=W.doneBy,Ia=La.time;ea=0;for(m=Ma.length;1>ea;ea++){var xa=Ma[ea],Sa=xa.time;if(La){for(var Ta=xa,Oa=e[xa.type],Ra=wb.process,ab=Ia,bb=Oa.length,Ga=!1,Qa=Infinity,Ua=0;Ua<bb;Ua++){var Na=z[Oa[Ua]],Ea=0;Na.build&&(Na.working||Na.techStart||!Na.built)&&(Na.built?(Ea=(Na.c-p.cycle)*sc.speed,Ea/=1E3):(Ea=Na.time*(Na.maxHealth-Na.health)/
Na.maxHealth,Na.workers&&Na.workers.length&&(Ea/=Na.workers.length)));Na.build||!Na.func&&!Na.in||(Ea=Infinity);Na.nato!=Ra?(Na.nato=Ra,Na.natoTime=0):Ea+=Na.natoTime;Ea<Qa&&(Qa=Ea,Ga=Na)}Ga&&Qa<=Ta.time?(Ga.natoTime+=ab,Da=Ga):Da=!1}if(!Da){Fa[xa.type]||(Fa[xa.type]=[],Ka[xa.type]=[]);var Ja=Fa[xa.type],Za=Ka[xa.type];Ba[xa.type]||(Ba[xa.type]=0);var ib=!1,lb=0;for(qa=Ja.length+1;lb<qa;lb++){if(void 0==Ja[lb]){var db={order:xa.nu,priority:0,obj:xa};ia.put(db);sa.put(db);Ja[lb]=0;Za[lb]=db;Ba[xa.type]++;
ib=!0}if(Ja[lb]+Ia<=Sa||ib){Ja[lb]+=Ia;Za[lb].priority+=la.priority;break}}}}}sa.sort(sg);var Va=0;v=0;for(m=sa.length;v<m;v++)if(la=sa[v].obj,la.build){var jb=la.space[la.space.length-1]+2;Va+=jb*((la.space.length-1)/jb+2)}O(Va,h);if(Va>h){var tb=h/Va*.7;v=0;for(m=t.length;v<m;v++)t[v].build&&(la=Ba[v])&&((la=~~(la*tb))||(la=1),Ba[v]=la)}v=0;for(m=sa.length;v<m;v++)la=sa[v].obj,la.build&&(Ba[la.type]?Ba[la.type]--:sa[v]=0);for(var kb=0;1>kb;kb++){var Ya=[],nb={},hb={},$a={},qb={},eb=[[]],gb=[0];
v=0;for(m=e.length;v<m;v++){qb[v]=0;la=e[v];var ub=[];$a[v]=ub;lb=0;for(qa=la.length;lb<qa;lb++)ub[lb]={free:1,type:v}}for(ma=0;ma<gb.length;ma++){var rb=gb[ma],vb=eb[rb];v=0;for(m=vb.length;v<m;v++){var Wa=vb[v],ob=Wa.list;lb=0;for(qa=ob.length;lb<qa;lb++)la=ob[lb],la.used||(qb[la.type]++,la.used=1,Ya.put(la.action)),la.free=1;Wa.obj.tech?nb[Wa.obj.nu.id]=1:$a[Wa.obj.type].put({free:1,type:Wa.obj.type,action:Wa.action})}v=0;for(m=sa.length;v<m;v++)if((la=sa[v])&&1===ug(la,nb,hb,$a,b).length&&(ob=
Gd(la,$a))){var pb=la.obj.time+rb;eb[pb]||(eb[pb]=[],gb.put(pb));if(la.obj.tech){if(hb[la.order.id])continue;hb[la.order.id]=1}(la.original||la.required)&&Ya.put(la);eb[pb].put({list:ob,obj:la.obj,action:la});sa[v]=void 0}gb.sort(Mk)}O(rb);for(var cb=Ya,sb={},Xa=0;Xa<cb.length;Xa++)cb[Xa]&&!cb[Xa].obj.tech&&(sb[cb[Xa].obj.name]||(sb[cb[Xa].obj.name]=0),sb[cb[Xa].obj.name]++);O(sb);sa=Ya;sa.sort(sg)}this.script=sa};var xg=function(){for(var b=0,c=wb.arr,e=c.length;b<e;c[b++].maintenance());Fa({func:xg},
wb.time,1);wb.process++};wb.prototype.maintenance=function(){var b=this.script,c=H[this.kingdom],e=c.technology,d=e.actived,f=e.hidden,k=mb[c.k];e=D;var l={};if(c.values.pop+c.unitLoading>c.values.popMax&&c.values.popMax<=c.values.popLimit){for(var q=ub[c.race].house.nu,r=1,n=0,h=Hd.length;n<h;n++)r+=k[Hd[n].type].length*Hd[n].population;r+c.unitLoading>c.values.popMax&&r<=c.values.popLimit&&rc({order:q,priority:1,obj:q.obj},c)}n=0;for(h=b.length;n<h;n++)(q=b[n])&&!l[q.order.id]&&1===ug(q,d,f,k,c).length&&
(rc(q,c)?b[n]=0:l[q.order.id]=1);b=!1;l=Infinity;var m=c.diplomacy;f=c.origin[0];k=c.origin[1];d=mb[c.k];n=1;for(h=H.length;n<h;n++)if(m[n]&&!H[n].death){q=H[n];r=q.origin[0]-f;var v=q.origin[1]-k;c=r*r+v*v;c<l&&(l=c,b=q)}if(b){c=[];n=r=0;for(h=d.length;n<h;n++)for(v=d[n],l=0,m=v.length;l<m;l++)q=z[v[l]],q.func==se.url&&(c[r++]=q.id);if(60<c.length){d=b.origin[0];m=b.origin[1];q=[40,0,-40,0,0,40,0,-40];l=Infinity;n=0;for(h=q.length;n<h;n+=2)if(r=q[n],v=q[n+1],r+=f+10*Math.sign(r),v+=k+10*Math.sign(v),
(r-d)*(r-d)+(m-v)*(m-v)<l&&pa(r,v)){l=(r-d)*(r-d)+(m-v)*(m-v);var p=r+v*e}h=p%e;f=~~(p/e);k=-1;r=Infinity;d=mb[b.k];n=0;for(length=d.length;n<length;n++)for(b=d[n],l=0,v=b.length;l<v;l++)q=z[b[l]],q.build&&q.built&&(m=(q.x32-h)*(q.x32-h)+(q.y32-f)*(q.y32-f),m<r&&(r=m,k=q.x32+q.y32*e));-1<k&&da(ji,[p,k],c)}}};var ji=function(b,c){var g=D,d=b[0];b=b[1];var f=b%g;g=~~(b/g);i=0;for(length=c.length;i<length;i++){var k=z[c[i]];6400<(k.x32-f)*(k.x32-f)+(k.y32-g)*(k.y32-g)?W(-d,k,Id,k.url.move):W(-b,k,Id,
k.url.move)}Fa({func:ki,data:{list:c,xy:-b}},3E4,1)},ki=function(b){var c=b.list;b=b.xy;for(var g=0,d=c.length;g<d;g++){var f=z[c[g]];f.death||W(b,f,Id,f.url.move)}},Nk=function(b,c,e,d){var g=D,k;for(k=2;60>=k;k+=2){b--;c--;for(var l=0;l<=k;){var q=U[b+l+g*c];if(2<q&&q!=d&&z[q].type==e)return q;q=U[b+l+g*(c+k)];if(2<q&&q!=d&&z[q].type==e)return q;l++}for(l=0;l<k-1;){l++;q=U[b+g*(c+l)];if(2<q&&q!=d&&z[q].type==e)return q;q=U[b+k+g*(c+l)];if(2<q&&q!=d&&z[q].type==e)return q}}return!1},se=function(b){b=
z[b];performance.now();var c=yg(b.id);if(c){var g=z[c];if(!b.build||jd(b.x32,b.y32,g.x32,g.y32,b.attDist))return Ec(c,[b.id],1)}xb(b,1E3)},yg=function(b){b=z[b];if(!b.freezed&&!b.invisible&&!1!==b.built){for(var c=b.x32,g=b.y32,d=H[b.kingdom].diplomacy,f=b.sight,k=D,l=2*f+1,q,r=!!b.confused,n=Infinity,h=!1,m=0,v=l*l;m<v;m++){var p=m%l-f,t=~~(m/l)-f,w=Math.sqrt(p*p+t*t);if(~~w<=f){p+=c;t+=g;for(var x=0;3>x;x++){q=Ra[x][p+k*t];var y=z[q];if((y&&y.kingdom&&(d[y.kingdom]||y.confused)||r)&&!(y.death||
y.invisible||b.attackOnly&&!b.attackOnly[y.type]||q==b.id||y.item)){var A=hd[b.type][y.type];A||(A=0);y=w*w+.05*y.health-(A+1)*b.attack;y<n&&(h=q,n=y)}}}}return h}},Ok=function(b){b.setupINTV(li,b.id,1E3)},li=function(b){b=z[b];var c=b.free;c||(c=mi);var g=D,d=b.x32,f=b.y32,k=[];k.length=H.length;for(var l=k.length,q=0;q<l;k[q++]=0);q=0;for(var r=c.length;q<r;q+=2){var n=c[q]+d,h=c[q+1]+f;pa(n,h)&&(n=z[U[n+h*g]],n.nocapture||n.build||k[n.kingdom]++)}g=c=0;for(q=1;q<l;q++)k[q]>c&&(g=q,c=k[q]);c&&b.kingdom!=
g&&b.changeKingdom(g);xb(b,1E3)},Ge,Pk=[1,1],ni=function(){return 25*(Date.now()-p.loadDate+p.pausedTime+p.deltaTime)/sc.speed},yb=function(b){if(!(b&&p.online||yb.bySystem&&b))if(0===p.paused){p.paused=1;void 0!=Ge&&clearInterval(Ge);var c=p.now();p.pausedTime+=Date.now();b||(yb.bySystem=1);p.now=function(){return c}}else p.pausedTime-=Date.now(),p.paused=0,yb.bySystem=0,b&&(document.getElementById("alert").style.display="none"),Ge=setInterval(sc,sc.speed),p.now=ni};yb.bySystem=0;var Hb=function(b,
c){var g=!1;if(1>b){b*=-1;var d=~~(b/Aa),f=b%Aa}else g=b;b=0;for(var k=c.length;b<k;b++){var l=z[c[b]];l.build||l.cow&&l.workers.length||g==l.id||(l.action=null,l.distance=0,l.mv&&null!=l.xf?g?(l.xf=g,l.yf=!0):(l.xf=f,l.yf=d):l.x32==f&&l.y32==d?l.stay():(l.dix=(f-l.x32)/Math.abs(f-l.x32),l.diy=(d-l.y32)/Math.abs(d-l.y32),g?(l.xf=g,l.yf=!0):(l.xf=f,l.yf=d),l.mv=!0,l.setupINTV(Jd,l.id,0),zg(l),l.action=null))}},zg=function(b){b.stock&&0!==b.stock[0]?(b.mimg=b.url[b.stock[4].url],b.stock[3]===Fc&&(b.mimg=
b.url.milk)):b.mimg=b.url.move};Hb.cursor=7;Hb.allowPos=1;var xb=function(b,c,e){c=~~(c/25)+p.cycle;e=Gc[c];e||(e=[],Gc[c]=e);var g=e.length;b.c=c;e[g]=b.id;b.timestamp=p.now()},Gc={},He=function(b){var c=z[b[0]];if(!c.death){var g=b[1],d=b[2],f=b[3];c.cow&&"milk"==g&&c.workers&&c.workers.length||(c[g]+=H[c.kingdom].values[d],d=c[g+"Max"],c[g]>d&&2!==c.blocked&&(c[g]=d));"mana"==g&&(d=c.manaTask)&&d[2]<=c[g]&&(O(d),W(d[1],c,ic[d[0]],c.url.move),c.manaTask=void 0,c.blockedAction(1));aa(c.id,1);Fa({func:He,
data:b},f,1)}},Fa=function(b,c,e){b.func.url||O(b.func);b.func=b.func.url;e&&(c=~~(c/25)+p.cycle);e=Hc[c];e||(e=[],Hc[c]=e);e.put(b)},Hc={},Jd=function(b){b=z[b];var c=D,g=!1;5===b.distance&&(b.distance=-1);b.waiting&&zg(b);var d=b.y32,f=b.x32,k=ic[b.action];ObjectsetupPosition(b,32*d);var l=Ra[b.zLevel],q=f+d*c;if(b.id===l[q]){var r=b.size;if(2>r)l[q]=b.radix;else for(var n=r*r,h=-c,m=0;m<n;m++){var v=m%r;0===v&&(h+=c);l[q+v+h]=0}}if(b.stop)return l[q]=b.id,b.stay(),b.stop=void 0,0;if(b.kx||b.ky){var p=
b.kx||0,t=b.ky||0;n=!1;if(0!==l[p+f+(t+d)*c])return b.aspettare()}else{k&&k.rev&&(n=k.rev(b))&&(b.action=n[0],k=ic[b.action],b.xf=n[1],b.yf=!0);if(!0===b.yf){n=b.xf;var w=z[n];if(!w||w.death&&(!k||!k.available))return l[q]=b.id,b.stay();m=!0;h=!1;if(k&&k.available){if(h=k.available(b,w),m=h[2],!1===h)return b.aspettare()}else w.death||(h=Tb(w,b,50,b.radix));b.xf!==n&&(w=z[b.xf]);if(!w||w.death||w.in)return l[q]=b.id,b.stay();if(!m&&(x+y*c===q||k))return b.aspettare();var x=h[0],y=h[1];if(k&&k.distance){var A=
k.distance;A=0>A?b.attDist:H[b.kingdom].values[A];h=Ag(w,f,d);jd(f,d,h%D,~~(h/D),A)&&(g=2)}b==w&&(g=2)}else{x=b.xf;y=b.yf;n=l[x+y*c];if(2<n&&(!k||k&&k.rev)){n=z[n];h=Tb(n,b,50,b.radix);if(!1===h)return l[q]=b.id,b.stay();x=h[0];y=h[1]}k&&k.distance&&(A=k.distance,A=0>A?b.attDist:H[b.kingdom].values[A],jd(f,d,x,y,A)&&(g=2))}n=x+y*c;if(!g){performance.now();a:{p=f;t=d;h=x;m=y;v=b.radix;var L=D,B=p+t*L,F=B,E=h+m*L,C;performance.now();var G=B+Za[~~(8*Ic(B%L-h,~~(B/L)-m)+.5)%8];for(C=0;24>C;C++){var I=
~~(8*Ic(B%L-h,~~(B/L)-m)+.5)%8;if(B===E)break;var O=l[B+Za[I]];if(O===v||1>=Math.abs(z[O].d-(I+2)%8)&&null!=z[O].xf)B+=Za[I];else if(l[B+Za[I+1]]===v)B+=Za[I+1];else if(O=I-1,-1===O&&(O=7),l[B+Za[O]]===v)B+=Za[O];else{B+=Za[I];break}Bg&&Ie(B%L,~~(B/L),"stone")}if(l[B]>v){I=[B];O=1;var ba=0,M={};M[B]=2;for(var N,V=Infinity,P=0;void 0!==(N=I[ba++]);){Bg&&Ie(N%L,~~(N/L),"food");C=N%L-h;var T=~~(N/L)-m;C=C*C+T*T;C<V&&(V=C,P=N);for(C=0;4>C;C++)if(B=N+oi[C],!M[B]&&l[B]!==v)for(E=0;8>E;E++)if(l[B+Za[E]]===
v){I[O++]=B;M[B]=2;break}}N=P;V=Infinity;for(E=0;8>E;E++)B=N+Za[E],l[B]===v&&(C=B%L-h,T=~~(B/L)-m,C=C*C+T*T,C<V&&(P=B,V=C));ba=0;O=1;I.length=0;I[0]=P;for(M[P]=1;void 0!==(N=I[ba++]);){Bg&&Ie(N%L,~~(N/L),"gold");B=N+Za[~~(8*Ic(N%L-p,~~(N/L)-t)+.5)%8];if(l[B]===v&&!M[B]){if(B==F){p=N;break a}I[O++]=B;M[B]=1}for(C=0;8>C;C++)if(B=N+Za[C],!M[B]&&l[B]===v)for(E=0;8>E;E++)if(2===M[B+Za[E]]){I[O++]=B;M[B]=1;break}}}p=G}t=~~((8*Ic(-(p%c)+f,-~~(p/c)+d)+.5)%8);p=pi[2*t];t=pi[2*t+1];if(l[f+p+(d+t)*c]!==b.radix||
!pa(f+p,d+t)){p=[f+1,d,f-1,d,f+1,d+1,f+1,d-1,f,d-1,f-1,d+1,f,d+1,f-1,d-1];t=x;h=y;m=D;v=Infinity;for(L=0;L<p.length;L+=2)if(0===l[p[L]+p[L+1]*m]&&pa(p[L],p[L+1])&&v>=(p[L]-t)*(p[L]-t)+(p[L+1]-h)*(p[L+1]-h)){v=(p[L]-t)*(p[L]-t)+(p[L+1]-h)*(p[L+1]-h);var U=L}h=[p[U],p[U+1]];p=h[0]-f;t=h[1]-d;p=0<p?1:0>p?-1:0;t=0<t?1:0>t?-1:0;if(l[f+p+(d+t)*c]!==b.radix){l[q]=b.id;b.stay();return}}}}if(q==n||g)if(l[f+d*c]=b.id,b.x32=f,b.y32=d,k){if(k.distance&&2!==g)return b.aspettare();b.stay(1);w||(w=x+y*c);b.action=
void 0;k(w,b,A)}else b.stay();else{if(0===p&&0===t)return b.aspettare();b.setupDir(p,t);g=b.spd;ObjectsetupIMG(b,b.mimg,-1,b.spd/b.__proto__.spd);b.dix=p*g;b.diy=t*g;d+=t;f+=p;b.x32=f;b.y32=d;b.distance++;xb(b,~~(32E3/g));ObjectsetupPhysics(b,p*g,t*g,0);q=f+d*c;if(2>r)l[q]=b.id;else for(n=r*r,h=-c,m=0;m<n;m++)v=m%r,0===v&&(h+=c),l[q+v+h]=b.id}},sc=function(){var b=p.cycle;p.now();if(p.demo){var c=p.record[b];if(c)for(var e=0;e<c.length;e+=3)Je[c[e]](c[e+1],c[e+2])}if(c=Hc[b]){for(e=0;e<c.length;e++){var d=
c[e];ic[d.func](d.data)}delete Hc[b]}if(c=Gc[b]){for(e=0;e<c.length;e++)d=z[c[e]],d.c===b&&(d.death&&O(d.func),d.c=void 0,ic[d.func](d.funcObj));delete Gc[b]}p.cycle++;if(p.online&&0===p.cycle%8)var f=Cg();!f&&!p.automatic&&p.now()-(p.cycle-1)*sc.speed>=sc.speed&&sc()};sc.speed=25;var Za,oi,Ie=function(b,c,e){e=Object.assign({},Ub[e]);e.x32=b;e.y32=c;e.z32=2;tb(e);Ib.new(e,500)},Bg,pi=[1,0,1,-1,0,-1,-1,-1,-1,0,-1,1,0,1,1,1],Ic=function(b,c){b=.5-Math.atan2(c,b)/(2*Math.PI);1==b&&(b=0);return b},Gb=
function(b,c,e,d){return[b,c,e,d,b,c,e,d,b,c,e,d,b,c,e,d]},Ke=new Float32Array(Gb(1,0,0,.75)),Qk=new Float32Array(Gb(1,1,1,.5)),qi=new Float32Array(Gb(0,1,0,.75)),Rk=new Float32Array(Gb(0,1,0,.9)),Sk=new Float32Array(Gb(.3515625,.29296875,.21875,.9)),ri=new Float32Array(Gb(0,1,1,.9)),Dg=new Float32Array(Gb(1,1,1,.5)),si=new Float32Array(Gb(.3,.3,.3,.9)),ti=new Float32Array(Gb(.7,.2,.2,.9));ri.noAlpha=1;si.noAlpha=1;ti.noAlpha=1;var S=function(b){da(Fe,[b,4*zb.shift+1,Ab],C[0])},Fe=function(b,c){var g=
b[0],d=b[1],f=b[2];b=t[g];c=z[c];var k=c.icons.indexOf(b.nu);if(!(0>k)){performance.now();if(0==f)for(f=0;f<d;f++){var l=H[c.kingdom],q=l.mod[g].cost||b.cost;if(l.paypal(q))return!1;c.waitlist||(c.waitlist=[]);c.waitlist.push(g,-k-1);c.work||(c.work={});c.work[k]||(c.work[k]=0);c.work[k]++;c.working=1;l.unitLoading++;2==c.waitlist.length&&(q=1E3*b.time,c.setupINTV(Kd,c.id,q))}else{if(!c.work)return;var r=c.waitlist;l=H[c.kingdom];for(f=0;f<d;f++){q=l.mod[g].cost||b.cost;l.setupResources(q,-1);q=r.lastIndexOf(g);
if(0>q)break;r.splice(q,2);O(c.work[k]);c.work[k]--;if(0==r.length){c.c=-1;c.working=0;break}l.unitLoading--;0===q&&(q=1E3*t[r[0]].time,c.setupINTV(Kd,c.id,q))}}aa(c.id)}},ui=0,Kd=function(b){b=z[b];var c=b.kingdom;c=H[c];var g=c.values.pop>=c.values.popMax?y.houseLimit:y.popLimit;if(c.values.pop>=c.values.popMax||c.values.pop>=c.values.popLimit)return document.getElementById("msgs1").getElementsByTagName("li"),3E4<Date.now()-ui&&c.k==A.kingdom&&Bb(g,0,5),ui=Date.now(),c.onFreePop.put(b.id);c.unitLoading--;
c=b.waitlist[0];g=t[c];b.work[-b.waitlist[1]-1]--;b.waitlist.splice(0,2);0<b.waitlist.length?b.setupINTV(Kd,b.id,1E3*g.time):b.working=0;Jc(c,b);aa(b.id)},xa=function(){if(0==Ab){var b=z[C[0]];da(Eg,[b.mlistID[nb.nu],!0],b.id)}},Sa=function(){if(0==Ab){var b=z[C[0]];da(Eg,[b.hlistID[nb.nu],!1],b.id)}},vi=function(b,c,e){var g=1.6,f=0;1===c&&(e=0,g=3.6,f=620);return[f+~~(g*b[0]*c+.5)+120*e,~~(g*b[1]*c+.5),~~(g*b[2]*c+.5),~~(g*b[3]*c+.5)]},Eg=function(b,c){var g=b[0];b=b[1];c=z[c];var d=H[c.kingdom];
if(d.values.pop>=d.values.popMax)return Bb(y.popLimit,0,5);if(b)var f=d.values.fameTech;d=4;var k=9*b;k||(k=1);if(b)var l=c.mlist,q=c.mlistID;else l=c.hlist,q=c.hlistID;var r=q.indexOf(g);if(!(0>r)){g=l[r].unit;l.splice(r,1);q.splice(r,1);q=vi(t[g].cost,k,f);if(H[c.kingdom].paypal(q))return 0;X.active==l&&na(l);for(q=0;q<k;q++)r=Jc(g,c),f?r.level=d:b||(d=16,r.level=d,l=wi[r.race],r.name=l[r.id%l.length],xi(r))}},Jc=function(b,c,e,d){var g=D,k=c.kingdom;c.rnd||Fg(c);var l=-1,q=-1;if(c.point&&!c.disallowPoint){var r=
c.point[0],h=c.point[1];l=yi(c,r,h,t[b].radix,t[b].rbase())[0]}else l=yi(c,l,q,t[b].radix,t[b].rbase())[1],l=l[zi(c,l.length)];q=~~(l/g);b=new tc(b,k,l%g,q,0,!1,d);Ld(k);e||za("unitdone",0,0,b.kingdom);if(c.point&&(c=Gg(r,h,b,!0),e=c[1],c[0]))c[0](e,[b.id]);return b},Le=0,Me=0,Rb,Ya,Dd,M=function(b){T=function(){};b=t[b];Rb=!1;var c=N;ObjectsetupIMG(c,b.img);c.active=!0;Ya=b;Dd=!1;document.addEventListener("mousemove",ng);document.addEventListener("mousedown",we)},we=function(b){var c=Ya.validator,
g=Ya.space,d=ta[Ya.img];if(0==b.button&&151<b.pageX){d=Vb(b.pageX-A.mx-.5*d[8]/fa,b.pageY-.5*d[9]/fa);var f=~~(.03125*d[1]);d=~~(.03125*d[0]);c(d,f,g,A.kingdom)[1]&&(Rb=!0,N.active=!0,N.x=-9999,N.y=-9999,T=151<b.pageX?0:hb,document.removeEventListener("mousedown",we),da(id,[d+D*f,Ya.type,Dd],C),zb.shift&&(Dd?Xh(Dd):M(Ya.type)));T=function(){}}else N.active=!0,N.x=-9999,N.y=-9999,Rb=!0,T=151<b.pageX?0:hb,document.removeEventListener("mousedown",we)},ng=function(b){var c=Ya.validator,g=Ya.space,d=ta[Ya.img];
if(Rb)document.removeEventListener("mousemove",ng);else{var f=b.pageX,k=b.pageY;if(f!=Le||k!=Me)N.active=!0,Le=f,Me=k,f=Vb(b.pageX-A.mx-.5*d[8]/fa,b.pageY-.5*d[9]/fa),k=~~(.03125*f[1]),f=~~(.03125*f[0]),b=32*f,d=32*k,(c=!c(f,k,g,ob.k)[1])?c!=uc&&(uc=c,h.bindBuffer(h.ARRAY_BUFFER,jb),h.bufferSubData(h.ARRAY_BUFFER,16*N.bufferID,Ke)):c!=uc&&(uc=c,h.bindBuffer(h.ARRAY_BUFFER,jb),h.bufferSubData(h.ARRAY_BUFFER,16*N.bufferID,qi)),N.x=b,N.y=d}},id=function(b,c){var g=b[0],d=g%Aa,f=~~(g/Aa),k=p.editor?A.kingdom:
z[c[0]].kingdom;g=b[1];var l=t[g].cost,q=H[k];if(!p.editor&&q.paypal(l))return!1;b=new tc(g,k,d,f,0,!p.editor,b[2]);if(!0===b.invalid||p.editor)return!1;b.waitlist=[];if(20===g)b.built=1,d=z[c[0]],W(b.id,d,Kc,d.url.move),T=function(){T=hb};else for(b.health=1,ObjectsetupIMG(b,b.bimg),b=b.id,g=0,f=c.length;g<f;g++)d=z[c[g]],d.buildList?(d.buildList.put(b),d.func!==Hg&&(k=Ne(d.buildList,d.x32,d.y32))&&W(k,d,Lc,d.url.move)):(d.buildList=[b],W(b,d,Lc,d.url.move))},uc=null,Jg=function(b){T=function(){};
b=t[b];Rb=!1;var c=N;Ya=b;ObjectsetupIMG(c,b.img);document.addEventListener("mousemove",Ai);document.addEventListener("mousedown",Ig)},Ig=function(b){var c=D,g=ta[Ya.img];if(0==b.button&&151<b.pageX){b=Vb(b.pageX-A.mx-.5*g[8]/fa,b.pageY-.5*g[9]/fa);var d=~~(.03125*b[1]);b=~~(.03125*b[0]);h.bindBuffer(h.ARRAY_BUFFER,jb);h.bufferSubData(h.ARRAY_BUFFER,0,Sk);var f=ja[2];ja[2]=32;ja[5]=32;ja[8]=32;ja[11]=32;N.wall=b+d*c;var k=b;document.addEventListener("mouseup",function r(b){sb.forced=!1;b=qa[3*A.kingdom];
var g=qa[3*A.kingdom+1],e=qa[3*A.kingdom+2];x[0]=b;x[1]=g;x[2]=e;x[3]=.5;x[4]=b;x[5]=g;x[6]=e;x[7]=.5;x[8]=b;x[9]=g;x[10]=e;x[11]=.5;x[12]=b;x[13]=g;x[14]=e;x[15]=.5;h.bindBuffer(h.ARRAY_BUFFER,jb);h.bufferSubData(h.ARRAY_BUFFER,0,x);ja[2]=f;ja[5]=f;ja[8]=f;ja[11]=f;var q=~~(ja[9]/32),m=~~(ja[10]/32);g=Math.abs(k-q);e=Math.abs(d-m);g&&--g;e&&--e;b=1;q=q<k?q:k;var p=m<d?m:d;m=[q+p*c];for(var t=0;t<g;t++)m[b++]=q+t+p*c+1,m[b++]=q+t+(p+e)*c;for(t=0;t<e;t++)m[b++]=q+(p+t)*c,m[b++]=q+(p+t+1)*c+g;for(t=
1;t<b;t++)g=m[t],Rb=!0,T=function(){T=hb},vc(2),da(id,[g,Ya.type],C);N.active=!0;N.x=-9999;N.y=-9999;zb.shift&&Jg(Ya.type);document.removeEventListener("mouseup",r)});document.removeEventListener("mousedown",Ig);Rb=!0}else N.active=!0,N.x=-9999,N.y=-9999,Rb=!0,T=151<b.pageX?0:hb,document.removeEventListener("mousedown",Ig)},Ai=function(b){var c=D,g=ta[Ya.img];if(Rb)document.removeEventListener("mousemove",Ai);else{var d=b.pageX,f=b.pageY;if(d!=Le||f!=Me){var k=!0;Le=d;Me=f;N.active=!0;b=Vb(b.pageX-
A.mx-.5*g[8]/fa,b.pageY-.5*g[9]/fa);g=~~(b[1]/32);b=~~(b[0]/32);d=32*b;f=32*g;0==U[b+g*c]&&(k=!1);k?k!=uc&&(uc=k,h.bindBuffer(h.ARRAY_BUFFER,jb),h.bufferSubData(h.ARRAY_BUFFER,16*N.bufferID,Ke)):k!=uc&&(uc=k,h.bindBuffer(h.ARRAY_BUFFER,jb),h.bufferSubData(h.ARRAY_BUFFER,16*N.bufferID,qi));N.x=d;N.y=f}}},Kg=function(b,c){b=0;for(var g=c.length;b<g;b++){var d=z[c[b]];d.xf?d.stop=1:d.stay()}},Oe=function(b,c){b=z[c[0]];b.techStart=0;b.c=void 0;if(c=b.techID){var g=H[b.kingdom].technology.hidden;-1<c&&
(g[c]=0);H[b.kingdom].setupResources(B[b.activeTech].cost,-1)}else H[b.kingdom].setupResources(b.lcost,-1)},E=function(b){var c=z[C[0]];if(H[c.kingdom].paypal(B[b].cost))return!1;da(wg,[b,nb.lastFunc.id],c.id)},wg=function(b,c){var g=b[0];b=b[1];var d=B[g],f=z[c];d.upgrade&&(b=-1);f.activeTech=g;f.techID=b;f.setupINTV(d.type,[g,b,c],1E3*d.time);f.techStart=f.c-p.cycle;g=H[z[c].kingdom].technology.hidden;-1<b&&(g[b]=1);aa(c)},Z=function(b){var c=b[1],g=z[b[2]];b=B[b[0]];jc(g,b,c)},Md=function(b){var c=
b[1],g=z[b[2]];b=B[b[0]];var d=t[b.obj],f=H[g.kingdom].mod[d.type];Bi(g);g.img=d.img;g.attack=f.attack||d.attack;g.health=g.health/g.maxHealth*d.health;g.maxHealth=d.health;g.__proto__=d;tb(g);jc(g,b,c)},Pe=function(b){var c=b[1],g=z[b[2]];b=B[b[0]];if(b.actvintv)for(var d=b.actvintv,f=0,k=d.length;f<k;f++){var l=d[f];H[g.kingdom].technology.disabled[l.id]=0;for(var q=l.builds,r=mb[g.kingdom],h=0,m=q.length;h<m;h++)for(var p=r[q[h]],v=0,t=p.length;v<t;v++)l(z[p[v]])}jc(g,b,c)},Ta=function(b,c){var g=
b[1];c=z[b[2]];b=B[b[0]];H[c.kingdom].values[b.value]+=b.increase;"popMax"==b.value&&Ld(c.kingdom);jc(c,b,g)},Ci=function(b,c){var g=b[1];c=z[b[2]];b=B[b[0]];for(var d=b.group,f=H[c.kingdom].mod,k=0,l=d.length;k<l;k++)for(var q=f[d[k].type],r=0,h=b.values,m=h.length;r<m;r+=2){var p=h[r],v=h[r+1];q[p]||(q[p]=d[k][p]||0);q[p]+=v}jc(c,b,g)},$a=function(b,c){var g=b[1];c=z[b[2]];b=B[b[0]];for(var d=b.group,f=H[c.kingdom].mod,k=0,l=d.length;k<l;k++){var q=f[d[k].type];q[b.value]||(q[b.value]=d[k][b.value]||
0);q[b.value]+=b.increase}jc(c,b,g)},Qe=function(b,c){var g=b[1];c=z[b[2]];b=B[b[0]];for(var d=H[c.kingdom].mod,f=b.mulp,k=0,l=b.group.length;k<l;k++){var q=b.group[k],r=d[q.type].cost||q.cost;d[q.type].cost=f?[~~(r[0]*f),~~(r[1]*f),~~(r[2]*f),~~(r[3]*f)]:[r[0]-b.decrease[0],r[1]-b.decrease[1],r[2]-b.decrease[2],r[3]-b.decrease[3]]}jc(c,b,g)},Lg=function(b,c){var g=b[1];c=z[b[2]];b=B[b[0]];for(var d=H[c.kingdom].mod,f=0,k=b.decrease,l=k.length;f<l;f+=2){var q=k[f],r=k[f+1],h=d[q.type].cost||q.cost;
d[q.type].cost=[h[0]-r[0],h[1]-r[1],h[2]-r[2],h[3]-r[3]]}jc(c,b,g)},jc=function(b,c,e){b.techStart=void 0;b.activeTech=void 0;b.techID=void 0;b.func=void 0;var g=H[b.kingdom].technology,f=g.disabled;g.investigated[e]=1;za("techdone",0,0,b.kingdom);if(c=c.next){e=!1;g=0;for(var k=c.length;g<k;g++){var l=c[g].id;f[l]--;na.actv[l]&&(e=!0)}e&&na(X.active)}aa(b.id)},Mc,Tk={icon:"food",img:"item_meat",url:"meat"},Uk={icon:"milk",img:"milk",url:"milk"},Vk={icon:"gold",img:"item_gold",url:"gold"},Wk={icon:"stone",
img:"item_stone",url:"stone"},Di={icon:"wood",img:"item_tree",url:"tree"},Xk={icon:"food",img:"item_food",url:"food"},Nd=function(b,c,e,d){b=mb[b];var g=Mc[c];c=[];c.length=g.length;for(var k=0,l=g.length;k<l;c[k]=b[g[k++]]);b=Infinity;g=-1;for(k=0;k<c.length;k++){l=c[k];for(var q=l.length,r=0;r<q;r++){var h=z[l[r]],m=h.x32,p=h.y32,v=h.space;h=v[v.length-1];v=(v.length-1)/h;h*=.5;v*=.5;m+=h;p+=v;h=.5*(h+v);m=Math.sqrt((m-e)*(m-e)+(p-d)*(p-d))-h;b>=m&&(b=m,g=l[r])}}return g},ia,Yk=function(b){if("string"==
typeof b){for(var c=1,g=0,d=b.length;g<d;g++)c+=c*(b.charCodeAt(g)/65535)*(g+1);b=c+d}var f=4294967295-b,k=4294967295+b;g=0;ia=function(){k+=g;f-=g++;k=36969*(k&65535)+(k>>16)&4294967295;f=18E3*(f&65535)+(f>>16)&4294967295;return((k<<16)+f&4294967295)/4294967295+.5}},zi=function(b,c){b=b.rnd;var g=b[0],d=b[1],f=b[2];g+=f;d-=f;g=36969*(g&65535)+(g>>16)&4294967295;d=18E3*(d&65535)+(d>>16)&4294967295;b[0]=g;b[1]=d;b[2]++;return~~((((g<<16)+d&4294967295)/4294967295+.5)*c)},vc=function(b){b!=Zk&&(document.body.className=
"ncursor"+b)},Zk=-1,kd=function(b,c){for(var g=0,d=c.length;g<d;g++){var f=z[c[g]];W(b,f,Od,f.url.move)}};kd.spLevel=function(b){var c=0;2<ra[b]&&(c=ra[b]);return c};var Od=function(b,c){c.stay55();if(c.inventory&&c.invMax===c.inventory.length||!b.item)return 1;ra[b.x32+b.y32*D]=b.radix;ObjectindexHide(b);if(c.peon&&b.contain){var g=b.contain[1],d=b.contain[0];c.stock&&Ei(c);var f=D;var k=Infinity;for(var l=!1,q=0;121>q;q++){var h=q%11-5;var m=~~(q/11)-5,u=h*h+m*m;h+=c.x32;m+=c.y32;u<k&&(h=ra[h+f*
m],0<h&&(h=z[h],h.contain&&(k=u,l=h.id)))}k=l;f=b.contain[2];b.die(1);c.stock=[d,g,k,Od,f];b=Nd(c.kingdom,g,c.x32,c.y32);W(b,c,kc,c.url[f.url]);aa(c.id);return 1}c.addItem(b);aa(c.id)},Ei=function(b){var c=Fi(b.x32,b.y32),g=~~(c/D);c%=D;c=new tc(52,b.kingdom,c,g,0);ObjectsetupIMG(c,m[b.stock[4].img]);c.contain=[b.stock[0],2,b.stock[4]]},Gi=function(b,c){b=0;for(var g=c.length;b<g;b++){var d=z[c[b]];d.xf?d.stop=2:(d.stop=2,d.stay(),d.stop=void 0)}},ld=function(b,c){var g=D;b=z[b];for(var d=0,f=c.length;d<
f;d++){var k=z[c[d]],l=Ra[k.zLevel],q=k.x32+k.y32*g;if(0!==l[q]||!b.build){q=b.build?Mg(k,k.x32,k.y32):Mg(k,b.x32,b.y32);if(!1===q)continue;k.x32=q%D;k.y32=~~(q/D)}k.item&&(b.attack-=k.attack||0,b.defence-=k.defence||0);k.url.idle&&ObjectsetupIMG(k,k.url.idle,1);l[q]=k.id;k.in=0;b.inventory.quit(k.id);ObjectindexShow(k)}aa(b.id,1)},Pd=function(b,c){b=z[b];if(1===b.invType)for(var g=0,d=c.length;g<d;g++){var f=z[c[g]];f!=b&&W(b.id,f,Ng,f.url.move)}},Ng=function(b,c){var g=b.inventory;if(g.length<b.invMax){var d=
c.x32,f=c.y32;c.rbase()[d+f*D]=c.radix;g.put(c.id);ObjectindexHide(c);c.in=b.id;Qd(c.id);aa(b.id)}else c.stay55()},md=function(b,c){for(var g=c.length,d=0;d<g;d++){var f=z[c[d]];f.buildList=!1;W(b,f,Lc,f.url.move)}},Lc=function(b,c){if(b.dummy&&b.dummy.built)return c.stay55();if(b.health<b.maxHealth)c.dix=0,c.diy=0,c.mv=!0,c.setupDirBuild(b),ObjectsetupIMG(c,c.url.build,1),c.setupINTV(Hg,{u:b.id,a:c.id},Ja(c.img)),Fd(c,"hit%20",7,c.img);else{if(c.buildList&&(b=Ne(c.buildList,c.x32,c.y32)))return W(b,
c,Lc,c.url.move),0;c.stay55()}},Hg=function(b){var c=z[b.u];b=z[b.a];var g=b.x32,d=b.y32,f=c.x32+c.y32*D;if(c.death)return b.stay();var k=c.maxHealth,l=k/c.time*H[b.kingdom].values.buildSpeed;if(1===c.health){for(var q=c.onbuild1,h=c.id,n=c.getRadix(),u=0,p=q.length;u<p;u++)if(2<n[q[u]]){xb(b,Ja(b.img));return}var v=Cb[c.kingdom];u=0;for(p=q.length;u<p;u++)n[q[u]]=h,v[q[u]]=void 0;lc(c)}c.health+=l;l=c.health;0==c.built&&(v=~~(4*l/k),v>c.d&&(c.d=v,ObjectsetupIMG(c,c.img)));if(l>=k){l=c.health=k;aa(c.id);
if(!c.built){c.d=0;q=c.url;v=Cb[c.kingdom];1343===c.type&&(v[f+1]&&13==z[v[f+1]].type&&v[f-1]&&13==z[v[f-1]].type?(q=m.wood_horz,c.child=void 0):v[f+D]&&13==z[v[f+D]].type&&v[f-D]&&13==z[v[f-D]].type&&(q=m.wood_vert,c.child=void 0));c.built=1;c.img=q;tb(c);if(q=c.onbuildValid)for(n=c.validator.dimension,u=0,p=q.length;u<p;n[q[u++]]=0);Hi(c);za("bldgdone",0,0,c.kingdom);aa(c.id)}c.action=void 0;(f=b.buildList)&&f.quit(c.id);if(!f||b.buildList&&0===b.buildList.length)b.buildList=Ii(b),f=b.buildList;
if(g=Ne(f,g,d))return W(g,b,Lc,b.url.move),0;b.buildList.length=0;b.stay();b.stock&&b.stock[0]&&ObjectsetupIMG(b,b.url[b.stock[4].url])}else aa(c.id),xb(b,Ja(b.img));C[0]==c&&(wc.innerHTML=l+"/"+k,Ka.value=l)},Re=function(b,c){if(2<b)for(var g=0,d=c.length;g<d;g++){var f=z[c[g]];W(b,f,Kc,f.url.move)}},Sd=function(b,c){var g=b;b=z[b];if(b.field)for(d=0,b=c.length;d<b;d++)f=z[c[d]],W(g,f,Kc,f.url.move);else if(0===b.res||3===b.res){var d=0;for(b=c.length;d<b;d++){var f=z[c[d]];W(g,f,Rd,f.url.move)}}else if(1===
b.res)for(d=0,b=c.length;d<b;d++)f=z[c[d]],W(g,f,Nc,f.url.move);else if(2===b.res)for(d=0,b=c.length;d<b;d++)f=z[c[d]],W(g,f,Fc,f.url.move)},Ec=function(b,c){var g=nd;if(!(3>b||(b=z[b],void 0!=b.res||b.magicGateway)))for(var d=0,f=c.length;d<f;d++){var k=z[c[d]];k==b||k.attackOnly&&!k.attackOnly[b.type]||k.bat&&b.build||b.stoned||(k.build?nd(b,k):W(b.id,k,g,k.url.move))}},Nc=function(b,c){if(0<b.health){var g=c.x32,d=c.y32;c.mv=!0;c.setupDir(b.x32-g,b.y32-d);ObjectsetupIMG(c,c.url.cut,1);c.dix=0;
c.diy=0;Fd(c,"chop%20",11,c.img);c.setupINTV(Ji,{u:b.id,a:c.id},7E3);b.addWorker(c)}else c.stay55()},Ji=function(b){var c=D,g=z[b.u];b=z[b.a];var d=H[b.kingdom].values.wood;g.workers.quit(b.id);var f=Nd(b.kingdom,1,b.x32,b.y32);g.health-=d;b.mv=!1;aa(g.id);if(1>g.health){d+=g.health;U[g.x32+g.y32*c]=0;c=z[f];c=Ca(c.x32,c.y32);for(var k=g.health=0,l=g.workers.slice(0),q=l.length;k<q;k++){var h=z[l[k]];c?W(c,h,Nc,b.url.move):h.stay()}b.stock=[d,1,c,Nc,Di];b.mv=!1;W(f,b,kc,b.url.tree);aa(b.id,1);g.workers.length=
0;g.die()}else b.stock=[d,1,g.id,Nc,Di],W(f,b,kc,b.url.tree),aa(b.id,1);if(0>f)return b.stay()},Kc=function(b,c){c.mv=!0;c.setupDir(b.x32-c.x32,b.y32-c.y32);ObjectsetupIMG(c,c.url.dig,1);Fd(c,"dig%20",3,c.img);c.setupINTV(Ki,{u:b.id,a:c.id},7E3)},Ki=function(b){var c=z[b.u];b=z[b.a];var g=H[b.kingdom].values.food,d=Nd(b.kingdom,2,b.x32,b.y32);b.mv=!1;b.stock=[g,2,c.id,Kc,Xk];W(d,b,kc,b.url.food);aa(b.id,1);if(0>d)return b.stay()},Fc=function(b,c){c.mv=!0;c.setupDir(b.x32-c.x32,b.y32-c.y32);ObjectsetupIMG(c,
c.url.milk1,1);c.stock=[0,2,b.id,Fc,Uk];c.setupINTV(Og,{u:b.id,a:c.id},1E3);b.addWorker(c);b.d=8-c.d;b.stay()},Og=function(b){var c=z[b.u];b=z[b.a];c.milk-=3;var g=b.x32,d=b.y32;b.stock[0]+=3;aa(b.id,1);if(0>=c.milk||c.death){if(50<b.stock[0]&&(b.stock[0]=50),b.mv=!1,c=Nd(b.kingdom,2,g,d),W(c,b,kc,b.url.milk),0>c)return b.stay()}else xb(b,1E3)},Id=function(b,c){c.stay55()},Se=function(b,c){nd(b,c)},nd=function(b,c){if(1!==b.death&&b!=c){if(b.dummy&&!H[c.kingdom].values.experience)return c.stay55();
c.invisible&&od(c.id);if(!0!==c.build){c.mv=1;var g=b.x32-c.x32,d=b.y32-c.y32;b.space&&(d=Ag(b,c.x32,c.y32),g=d%D-c.x32,d=~~(d/D)-c.y32);c.setupDir(g,d,c.d2attack);c.url.attack&&ObjectsetupIMG(c,c.url.attack,1)}c.setupINTV(Li,{u:b.id,a:c.id},Ja(c.img));b.addWorker(c)}else c.stay55()};nd.distance=-1;Se.distance=-1;var Pg=function(b,c){var g=H[b.kingdom];if(g.values.experience&&(!c||0!=g.diplomacy[c.kingdom]||c.dummy)){if(0==b.level||null==b.level)b.level=0,b.levelProgress=0;b.levelProgress++;b.levelProgress>=
~~(b.level/g.values.experience)&&b.level<g.values.maxLevel&&(b.level++,b.health+=g.values.healthJump,b.maxHealth+=g.values.healthJump,b.levelProgress=0,b.attack+=b.level,b.defence+=b.level%2,aa(b.id,1))}},xi=function(b){var c=b.level;b.attack+=c;b.defence+=~~(.5*c)},Li=function(b){var c=z[b.u];b=z[b.a];var g=b.attDist,d=c.x32-b.x32,f=c.y32-b.y32,k=c.x32,l=c.y32,q=!b.build;if(b.attackSound){var h=b.attackSound;za(h[~~(h.length*Math.random())],b.x32,b.y32)}q&&!c.build&&b.setupDir(d,f,b.d2attack);ObjectsetupIMG(b,
b.img,1);if(c.death||b.level&&8<=b.level&&c.dummy||c.dummy&&b.level&&b.level>=H[b.kingdom].values.maxLevel)return b.stay();if(1<g&&!b.dragon){q=!0;var m=b.attimg}else q=!1;if(c.build||jd(c.x32,c.y32,b.x32,b.y32,g)){c.onattack(b);g=b.attack*((hd[b.type][c.type]||0)+1);if(q){c.space&&(d=Ag(c,b.x32,b.y32),k=d%D,l=~~(d/D),d=k-b.x32,f=l-b.y32);q=0;if(b.arrow||b.ball){h=Mi;var u=Ic(-d,-f);var K=d;var v=f;var t=411/Math.sqrt(K*K+v*v);K*=t;v*=t;var w=Math.sqrt(1024*d*d+f*f*1024)/Math.sqrt(K*K+v*v);b.ball&&
(m[1]=m[0]/w)}else{var x=2;h=Te;q=K=p.gravity;u=Math.PI/180*60;t=Math.cos(u);u=b.attackDeg;u*=Math.PI/180;v=Math.sin(u);w=Math.cos(u);u=32*Math.sqrt(d*d+f*f);K=w*Math.sqrt(K*u/(v*w*2));w=u/K;v=-Math.sin(Math.atan2(-d,-f));u=Ic(-d,-f);K*=v;q=Math.abs(q*t*v);v=(32*f-q*w*w*.5)/w}w=Math.round(1E3*w);t={x32:b.x32+.5,y32:b.y32+.5,img:m,mv:b.ball,d:0,rotation:-u+1.5,xf:k,yf:l,obj:c.id,attack:g,range:x};tb(t);ObjectsetupPhysics(t,K,v,q);Fa({func:h,data:t},w,1)}t||c.damage(g,b);if(c.dummy){if(50<=b.dummyDamage||
!b.dummyDamage)b.dummyDamage=0;b.dummyDamage+=g;50<=b.dummyDamage&&Pg(b,c)}c.death?(b.stay(),b.action=null,c.build||b.build||Pg(b,c)):xb(b,Ja(b.img))}else b.mv=!1,0!==b.state&&W(c.id,b,nd,b.url.move)},Rd=function(b,c){0<b.health?(c.dix=0,c.diy=0,c.mv=1,c.setupDirBuild(b),ObjectsetupIMG(c,c.url.kirka,1),Fd(c,"mine%20",3,c.img),c.setupINTV(Ni,{u:b.id,a:c.id},7E3),b.addWorker(c)):c.stay()},Ni=function(b){var c=z[b.u];b=z[b.a];var g=c.res,d=H[b.kingdom].values[0==g?"gold":"stone"],f=b.x32,k=b.y32;c.health-=
d;aa(c.id);1>c.health&&(d=c.health+d,c.health=0,c.d=3,c.die());b.mv=!1;f=Nd(b.kingdom,g,f,k);0==g?(b.stock=[d,g,c.id,Rd,Vk],W(f,b,kc,b.url.gold)):(b.stock=[d,g,c.id,Rd,Wk],W(f,b,kc,b.url.stone));aa(b.id,1);if(0>f)return b.stay()},W=function(b,c,e,d){c.cow&&c.workers.length||(c.action=e.url,c.distance=0,0<b?(c.xf=b,c.yf=!0):(b*=-1,c.xf=b%D,c.yf=~~(b/D)),c.func!=Jd.url&&(d==c.url.move?zg(c):c.mimg=d,c.dix=0,c.diy=0,c.mv=!0,c.setupINTV(Jd,c.id,0)))},Ve=function(b,c){O(b);Ue(c,b,$k)};Ve.allowPos=1;var $k=
function(b,c){ld(c.id,c.inventory.slice(0));c.stay55()},Ag=function(b,c,e){var g=b.space||Pk,f=g.length-1,k=g[f],l=b.x32;b=b.y32-1;for(var q=Infinity,h=0,m=0;m<f;m++){var u=m%k;u||b++;var p=(l+u-c)*(l+u-c)+(b-e)*(b-e);p<q&&g[m]&&(h=l+u+b*D,q=p)}return h},Mg=function(b,c,e){var g=D,f=b.radix,k=Ra[b.zLevel];for(b=2;60>=b;b+=2){c--;e--;for(var l=0;l<=b;){var q=c+l+g*e;if(k[q]===f)return q;q=c+l+g*(e+b);if(k[q]===f)return q;l++}for(l=0;l<b-1;){l++;q=c+g*(e+l);if(k[q]===f)return q;q=c+b+g*(e+l);if(k[q]===
f)return q}}return!1},Fi=function(b,c){var g=D,d,f=ra;for(d=2;60>=d;d+=2){b--;c--;for(var k=0;k<=d;){var l=b+k+g*c;if(0===f[l]&&0===U[l])return l;l=b+k+g*(c+d);if(0===f[l]&&0===U[l])return l;k++}for(k=0;k<d-1;){k++;l=b+g*(c+k);if(0===f[l]&&0===U[l])return l;l=b+d+g*(c+k);if(0===f[l]&&0===U[l])return l}}return!1},Tb=function(b,c,e,d){var g=c.x32,k=c.y32,l=D,q=g+k*l,h=b.x32,m=b.y32,u=b.space;if(u){var p=u[u.length-1];u=(u.length-1)/p;b=b.free}else u=p=1,b=mi;c=c.rbase();for(var v,t=Infinity,w=-1,x=
!1,y=0;y<e&&-1==w;){if(0==y&&b){v=[];for(var A=0,B=b.length;A<B;A+=2){var L=b[A]+h,F=b[A+1]+m;if(pa(L,F)&&(c[L+F*l]===d||L+F*l==q))a:{var C=v;L+=F*l;F=g;for(var E=k,H=D,I=Math.pow(L%H-F,2)+Math.pow(~~(L/H)-E,2),G=0,O=C.length;G<O;G++)if(Math.pow(C[G]%H-F,2)+Math.pow(~~(C[G]/H)-E,2)>I){C.splice(G,0,L);break a}C.put(L)}}A=0;for(B=v.length;A<B;A++){L=v[A];C=L%l;F=~~(L/l);if(!(C=100<(g-C)*(g-C)+(k-F)*(k-F))){H=g;I=k;E=L%l;var N=~~(L/l);G=d;O=c;performance.now();C=D;var M=-C,V=+C,P=0,T=0;F=[];var U={};
U[H+I*C]=1;var J=E+N*C,X=0;E=!1;var R=0;b:do{N=J%C;var Q=~~(J/C);R++;N=(N-H)*(N-H)+(Q-I)*(Q-I);if(void 0==J||2>=N){E=!0;break b}U[J]=1;N=5>=N?0:1;Q=Za[~~(8*Ic(J%C-H,~~(J/C)-I)+.5*N)%8];if(O[J+Q]!==G&&null==z[O[J+Q]].xf||U[J+Q]){var da=!1;for(var Y=0;8>Y;Y++)if(Q=J+Za[Y],O[Q]==G&&!U[Q]&&(O[-1+M+Q]!=G||O[M+Q]!=G||O[1+M+Q]!=G||O[-1+Q]!=G||O[1+Q]!=G||O[-1+V+Q]!=G||O[V+Q]!=G||O[V+1+Q]!=G)){if(da&&12<X++)break;da=!0;F[P++]=Q;N=Q%C;Q=~~(Q/C);if(2>=(N-H)*(N-H)+(Q-I)*(Q-I)){E=!0;break b}}da||X--}else if(F[P++]=
J+Q,N=(J+Q)%C,Q=~~((J+Q)/C),2>=(N-H)*(N-H)+(Q-I)*(Q-I)){E=!0;break b}do J=F[T++];while(U[J])}while(T<=P);H=F;for(I=0;I<0*H.length;I++)N=H[I]%C,Q=~~(H[I]/C),G=new tc(0,1,N,Q,0),G.c=NaN,ObjectsetupPosition(G,32*D),G.x=32*G.x32+16,G.y=32*G.y32,Ib.new(G,2E3);C=E?F:!1;C=!1!==C}if(C){w=L;break}}if(-1<w){x=!0;break}if(1==e)break}y++;--h;--m;for(A=0;A<p+2*y;A++)c[h+m*l+A]==d&&pa(h+A,m)&&(v=(h+A-g)*(h+A-g)+(m-k)*(m-k),t>v&&(t=v,w=h+A+m*l)),c[h+(m+u+2*y-1)*l+A]==d&&pa(h+A,m+u+2*y-1)&&(v=(h+A-g)*(h+A-g)+(m+
u+2*y-1-k)*(m+u+2*y-1-k),t>v&&(t=v,w=h+(m+u+2*y-1)*l+A));for(A=1;A<u+2*y-1;A++)c[h+(m+A)*l]==d&&pa(h,m+A)&&(v=(h-g)*(h-g)+(m+A-k)*(m+A-k),t>v&&(t=v,w=h+(m+A)*l)),c[h+p+2*y-1+(m+A)*l]==d&&pa(h+p+2*y-1,m+A)&&(v=(h+p+2*y-1-g)*(h+p+2*y-1-g)+(m+A-k)*(m+A-k),t>v&&(t=v,w=h+p+2*y-1+(m+A)*l))}return-1<w?[w%l,~~(w/l),x]:!1},yi=function(b,c,e,d,f){performance.now();var g=D,l=b.x32,q=b.y32,h=b.space,m=[],u=0;if(h){var p=h[h.length-1];h=(h.length-1)/p;var v=b.free}else h=p=1;b=-1==c?-Infinity:Infinity;for(var t=
-1,w=0,y=0;0==m.length;){if(v&&0==y){for(var x=0,A=v.length;x<A;x+=2){var z=v[x]+l,B=v[x+1]+q;pa(z,B)&&f[z+B*g]===d&&(m[u++]=z+B*g,w=(z-c)*(z-c)+(B-e)*(B-e),b>w&&(b=w,t=z+B*g))}if(m.length)break}y++;--l;--q;for(x=0;x<p+2*y;x++)f[l+q*g+x]==d&&pa(l+x,q)&&(m[u++]=l+x+q*g,w=(l+x-c)*(l+x-c)+(q-e)*(q-e),b>w&&(b=w,t=l+x+q*g)),f[l+(q+h+2*y-1)*g+x]==d&&pa(l+x,q+h+2*y-1)&&(m[u++]=l+(q+h+2*y-1)*g+x,w=(l+x-c)*(l+x-c)+(q+h+2*y-1-e)*(q+h+2*y-1-e),b>w&&(b=w,t=l+(q+h+2*y-1)*g+x));for(x=1;x<h+2*y-1;x++)f[l+(q+x)*
g]==d&&pa(l,q+x)&&(m[u++]=l+(q+x)*g,w=(l-c)*(l-c)+(q+x-e)*(q+x-e),b>w&&(b=w,t=l+(q+x)*g)),f[l+p+2*y-1+(q+x)*g]==d&&pa(l+p+2*y-1,q+x)&&(m[u++]=l+p+2*y-1+(q+x)*g,b>w&&(b=w,t=l+p+2*y-1+(q+x)*g))}return[t,m]},mi=[-1,0,-1,-1,0,-1,1,-1,1,0,1,1,0,1,-1,1],Ne=function(b,c,e){for(var g=Infinity,f=!1,k=0,l=b.length;k<l;k++){var q=b[k],h=z[b[k]];if(0!=h.built||h.death)k--,l--,b.quit(q);else{var m=h.x32;h=h.y32;h=(m-c)*(m-c)+(h-e)*(h-e);g>=h&&(g=h,f=q)}}return f},Oi=function(b){for(var c=0,g=b.length;c<g;c++){var d=
z[b[c]];d.spd=d.__proto__.spd}},Pi=function(b){for(var c=Infinity,g=0,d=b.length;g<d;g++){var f=z[b[g]];O(f.spd);f.spd<c&&(c=f.spd)}Qg(c,b)},Rg=function(b,c){Ue(c,b,kc)},kc=function(b,c){b=H[c.kingdom];b.resources[c.stock[1]]+=c.stock[0];b.stats.resources[c.stock[1]]+=c.stock[0];We(c.kingdom);c.func=1;var g=c.stock[3];b=z[c.stock[2]];if(g==Fc){var d=D;for(var f,k=Infinity,l=!1,q=0;961>q;q++){var h=q%31-15,m=~~(q/31)-15,u=h*h+m*m;h+=c.x32;m+=c.y32;u<k&&(f=ra[h+d*m],0<f&&0===U[h+d*m]&&(f=z[f],f.contain&&
"meat"==f.contain[2].url&&(k=u,l=f)))}if(d=l)g=Od,b=d}else"meat"==c.stock[4].url&&!1===c.stock[2]&&(d=Qi(c.x32,c.y32,!0))&&(g=Fc,b=d,c.stock[2]=1);if(!1===c.stock[2])return c.stock=void 0,c.stay();c.stock=void 0;W(b.id,c,g,c.url.move);aa(c.id,1)};Sd.cursor=6;Ec.cursor=1;md.cursor=9;kd.cursor=5;Pd.cursor=7;Ve.cursor=7;Re.cursor=6;Rg.cursor=6;var Ii=function(b){var c=D,g=b.kingdom,d=b.x32,f=b.y32;d-=8;f-=8;for(var k={},l=[],q=0,h=Cb[g],m=0;256>m;m++){b=m%16+d;var u=~~(m/16)+f;pa(b,u)&&(b=h[b+u*c],void 0!==
b&&(b=z[b],b.kingdom!=g||!1!==b.built||k[b.id]||(l[q++]=b.id,k[b.id]=1)))}return l};Nc.available=function(b,c){var g=H[b.kingdom].values.wood;if(c.death||1>c.health-g&&c.workers.length)c=Ca(c.x32,c.y32),b.xf=c,c=z[c];return Tb(c,b,1,b.radix)};Rd.available=function(b,c){if(!c.death){var g=Tb(c,b,1,b.radix);if(g[2])return g}for(var d=c.x32,f=c.y32,k=0;5>k;){c=Nk(d,f,c.type,c.id);if(!1===c)break;c=z[c];g=Tb(c,b,1,b.radix);if(g[2])return b.xf=c.id,g;k++}return!1};Kc.available=function(b,c){if(c.death)return!1;
b=c.x32+1;c=c.y32+1;return 0===U[b+c*D]?[b,c,1]:!1};Lc.available=function(b,c){var g=b.x32,d=b.y32;if(!c.death){var f=Tb(c,b,1,b.radix);if(f[2])return f}b.buildList?(f=b.buildList,f.quit(c.id)):(b.buildList=Ii(b),f=b.buildList);c=Ne(f,g,d);if(!c)return!1;b.xf=c;c=z[c];return Tb(c,b,1,b.radix)};Id.rev=function(b){return(b=yg(b.id))?[Se.url,b]:!1};Se.available=function(b,c){var g=yg(b.id);g&&(b.xf=g,c=z[g]);return Tb(c,b,5,b.radix)};Od.available=function(b,c){if(c.death)return!1;b=c.x32;c=c.y32;return 0===
U[b+c*D]?[b,c,1]:!1};Fc.available=function(b,c){if(c.workers.length||c.milk<50/1.5||c.death){c=Qi(b.x32,b.y32);if(!c)return!1;b.xf=c.id}return Tb(c,b,5,b.radix)};Ng.available=function(b,c){if(c.death)return b.stay(),!1;var g=1;c.boat&&(g=2);return(b=Tb(c,b,g,b.radix))?(b[2]=1,b):!1};var Qi=function(b,c,e){for(var g=D,f,k=Infinity,l=!1,q=0;441>q;q++){f=q%21-10;var h=~~(q/21)-10,m=f*f+h*h;f+=b;h+=c;m<k&&(f=U[f+g*h],0<f&&(f=z[f],f.cow&&(!f.workers.length&&f.milk>=50/1.5||e)&&(k=m,l=f)))}return l},Ue=
function(b,c,e){for(var g=0,f=b.length;g<f;g++){var k=z[b[g]];W(c,k,e,k.url.move)}},Ye=function(b,c){ab(c,b,Xe)};Ye.noObj=1;var Xe=function(b,c){Td(c,-b,77,Xe)},$e=function(b,c){ab(c,b,Ze)};$e.noObj=1;var Ze=function(b,c){Td(c,-b,130,Ze)},bf=function(b,c){ab(c,b,af)};bf.noObj=1;var af=function(b,c){Td(c,-b,78,af)},df=function(b,c){ab(c,b,cf)};df.noObj=1;df.cursor=10;var cf=function(b,c){Td(c,-b,132,cf)},ff=function(b,c){ab(c,b,ef)};ff.cursor=10;ff.noObj=1;var ef=function(b,c){Td(c,-b,131,ef)},Td=
function(b,c,e,d){var g=D,k=H[b.kingdom],l=t[e],q=t[e].cost,h=b.mana>b.manaMax;if(Db(b)||b.checkMana(q[4],c,d,q)){h||k.paypal(q);d=e;c*=-1;h=c%g;var m=~~(c/g),u=h,p=m,v=Ra[l.zLevel],w=~~(b.mana/q[4])+1;1<w&&(k.resources[0]-=q[0]*(w-1),b.mana-=q[4]*(w-1));for(k=0;k<w;k++)0!==v[c]&&(e=Mg(l,h,m),u=e%g,p=~~(e/g)),za("summon"+~~(10*Math.random()+1),u,p),e=new tc(d,b.kingdom,u,p,0),e.setupChild(Jb.spawn);b.setupDir(-b.x32+e.x32,-b.y32+e.y32);b.setupSpellIMG()}else k.paypal(q);aa(b.id)},jd=function(b,c,
e,d,f){return~~Math.sqrt((b-e)*(b-e)+(c-d)*(c-d))<=f},Sg=function(b,c){ab(c,b,gf)};Sg.cursor=0;var gf=function(b,c){b.build||b.terrain||b.nofreeze||!Db(c)&&!c.checkMana(50,b.id,gf)||(b.freezed=1,b.stoned=1,ObjectsetupPosition(b,32*b.y32),b.stay(),ObjectsetupIMG(b,b.img,0),b.setupChild(Jb.turnStone),pd(b,si),Qd(b.id),c.setupDir(-c.x32+b.x32,-c.y32+b.y32),c.setupSpellIMG(),za("turn%20to%20stone",c.x32,c.y32),Fa({func:Ri,data:b.id},24E4,1))},Ri=function(b){b=z[b];b.freezed=0;lc(b);b.stoned=0},Tg=function(b,
c){ab(c,b,Ud)},Ud=function(b,c){b.health<b.maxHealth&&!b.build?(c.setupDir(b.x32-c.x32,b.y32-c.y32),O("heal",Ja(c.img)),c.setupSpellIMG(!0),c.setupINTV(al,{u:b.id,a:c.id},0),b.addWorker(c)):c.stay()},Ti=function(){ab(list,obj,Si)},Si=function(){},al=function(b){var c=z[b.a];b=z[b.u];var g=H[c.kingdom].values.healingRange;za("heal",c.x32,c.y32);if(!jd(b.x32,b.y32,c.x32,c.y32,g))return W(b.id,c,Ud,c.url.move);if(Db(c)||c.checkMana(4,b.id,Ud)){c.setupDir(b.x32-c.x32,b.y32-c.y32);b.health+=6;b.setupChild(Jb.heal);
if(b.health>=b.maxHealth)return b.health=b.maxHealth,aa(b.id,1),aa(c.id,1),c.stay();aa(b.id,1);aa(c.id,1);xb(c,Ja(c.url.spell))}},jf=function(b,c){ab(c,b,hf)};jf.cursor=10;var Ui=function(g,c){g=z[g];c=z[c];if(g.inventory.quit(c.id)){c=b[c.spell];g.icons==g.__proto__.icons&&(g.icons=g.icons.slice(0));g.icons.put(c);var e=g.icons;e.olegal||(e.olegal={});e.olegal[c.id]=1;aa(g.id)}},Vd=function(b,c){var g=c[1];c=z[c[0]];z[b].nopotion||z[b].build||(W(b,c,Vi,c.url.move),c.actionItem=g)};Vd.item=1;var Vi=
function(b,c){var g=z[c.actionItem];c.actionItem=void 0;g.attack&&(b.attack+=g.attack);g.defence&&(b.defence+=g.defence);g.mana&&(b.mana||(b.mana=0,b.manaMax=0,b.update?b.update.push("mana","manaSpeed",1E3):b.update=["mana","manaSpeed",1E3],Fa({func:He,data:[b.id,"mana","manaSpeed",1E3]},1E3,1)),b.manaMax+=g.mana,b.mana+=g.mana);g.level&&(b.level||(b.level=0),b.level+=g.level,b.attack+=g.level,b.defence+=~~g.level);za("bless",b.x32,b.y32);c.inventory.quit(g.id);c.stay55();aa(c.id)};Vd.cursor=10;Tg.cursor=
10;Ye.cursor=10;$e.cursor=10;bf.cursor=10;var Ug=function(b,c){ab(c,b,bl)};Ug.cursor=1;var bl=function(b,c){b.isSpy&&b==c?c.stay55():(c.setupDir(-c.x32+b.x32,-c.y32+b.y32),ObjectsetupIMG(c,c.url.attack,1),Fa({func:Wi,data:[b,c]},Ja(c.img)-25,1))},Wi=function(g){var c=g[1];g=g[0];g.die(1);var e=g.getRadix();e[c.x32+c.y32*D]=c.radix;c.x32=g.x32;c.y32=g.y32;c.d=g.d;c.name=c.name;c.attack=g.attack;c.defence=g.defence;c.update=c.update;c.mana=0;c.manaMax=c.manaMax;e[c.x32+c.y32*D]=c.id;ObjectsetupPosition(c,
32*c.y32);c.__proto__=g.__proto__;ObjectsetupIMG(c,c.url.idle);e=g.icons.slice(0);e.quit(b.menuBuilds);e.quit(b.menuBuilds1);e.quit(b.menuBuilds2);e.put(b.impersonate);e.put(b.revealSelf);c.icons=e;c.spy||(c.spy=c.kingdom);c.kingdom!==g.kingdom&&c.changeKingdom(g.kingdom);c.setupChild(Jb.impersonate);aa(c.id)},Xi=function(b){b=z[b];if(b.spy){var c=t[2];b.attack=c.attack;b.defence=c.defence;b.__proto__=c;b.icons=c.icons;b.kingdom!==b.spy?b.changeKingdom(b.spy):b.stay();ObjectsetupIMG(b,b.url.idle);
aa(b.id)}};jf.allowPos=1;var hf=function(b,c){if(b.id){var g=b.id,d=b.x32;b=b.y32}else g=-b,d=b%D,b=~~(b/D);if(Db(c)||c.checkMana(60,g,hf)){c.setupDir(-c.x32+d,-c.y32+b);c.setupSpellIMG();g=8;d-=.5*g;b-=.5*g;var f=[];g+=1;var k=g*g;za("bless",c.x32,c.y32);for(c=0;c<k;c++)for(var l=1;3>l;l++){var h=z[Ra[l][c%g+d+(~~(c/g)+b)*D]];h.build||h.terrain||(h.setupChild(Jb.bless),h.blessed||(h.blessed=1,h.attack+=5,aa(h.id,1),f.put(h)))}Fa({func:Yi,data:f},3E4,1)}},ab=function(b,c,e){if(b[1]&&z[b[1]].item){var g=
b[1];b.length--;Ue(b,c,e);z[b[0]].actionItem=g}else Ue(b,c,e)},Db=function(b){var c=b.actionItem;if(!c)return!1;c=z[c];c.attack&&(c.attack--,0===c.attack&&(b.inventory.quit(c.id),aa(b.id)));return!0},Yi=function(b){for(var c=0,g=b.length;c<g;c++){var d=b[c];d.blessed=void 0;d.attack-=5;aa(d.id,1)}},lf=function(b,c){ab(c,b,kf)};lf.cursor=10;var kf=function(b,c){b.freezed||!Db(c)&&!c.checkMana(50,b.id,kf)?c.stay55():(c.setupDir(-c.x32+b.x32,-c.y32+b.y32),c.setupSpellIMG(),za("invisible",b.x32,b.y32),
b.invisible||(pd(b,Dg),b.invisible=1,b.stay()),aa(b.id),Fa({func:od,data:b.id},5E4,1))},od=function(b){b=z[b];b.death||(b.invisible=void 0,lc(b))},Wg=function(b,c){ab(c,b,Vg)};Wg.cursor=0;var Vg=function(b,c){if(Db(c)||c.checkMana(50,b.id,Vg))c.setupDir(-c.x32+b.x32,-c.y32+b.y32),c.setupSpellIMG(),za("lightning",c.x32,c.y32),b.damage(50,c)},nf=function(b,c){ab(c,b,mf)};nf.cursor=0;nf.noObj=1;var mf=function(b,c){var g=D;if(b.id){var d=b.id,f=b.x32;b=b.y32}else d=-b,f=b%g,b=~~(b/g);if(Db(c)||c.checkMana(50,
d,mf)){c.setupDir(-c.x32+f,-c.y32+b);c.setupSpellIMG();za("flame%20ball",f,b);d=f-c.x32;f=b-c.y32;b=Math.sqrt(d*d+f*f);d/=b;f/=b;for(var k=c.x32+.5,l=c.y32+.5,h=[],m=[],n=0,u,p,v=0;v<b;v++)u=k+d*v,p=l+f*v,m.put(u),m.put(p),u=~~u,p=~~p,h[n++]=u+p*g,h[n++]=~~(u+f)+~~(p+d)*g,h[n++]=~~(u-f)+~~(p-d)*g;for(v=0;v<0*h.length;v++)Ie(h[v]%g,~~(h[v]/g),"food");Fa({func:Xg,data:{list:h,anim:m,i:2,a:c}},1E3,1)}},Yg=function(b,c){ab(c,b,Wd)};Yg.cursor=10;var Wd=function(b,c){c.setupDir(-c.x32+b.x32,-c.y32+b.y32);
c.setupSpellIMG(!0);c.setupINTV(cl,{u:b.id,a:c.id},0);b.addWorker(c)},cl=function(b){var c=z[b.a];b=z[b.u];if(!jd(b.x32,b.y32,c.x32,c.y32,H[c.kingdom].values.teachDistance))return W(b.id,c,Wd,c.url.move);if(b.level>=c.level)return c.stay();if(Db(c)||c.checkMana(10,b.id,Wd))za("teach",c.x32,c.y32),c.setupDir(b.x32-c.x32,b.y32-c.y32),b.setupChild(Jb.curse,!1,Rk),Pg(b,!1),aa(b.id,1),aa(c.id,1),xb(c,Ja(c.url.spell))},pf=function(b,c){ab(c,b,of)};pf.cursor=0;pf.noObj=1;var of=function(b,c){var g=D;if(b.id){var d=
b.id,f=b.x32;b=b.y32}else d=-b,f=b%g,b=~~(b/g);if(Db(c)||c.checkMana(70,d,of)){c.setupDir(-c.x32+f,-c.y32+b);c.setupSpellIMG();d=f;var k=b;f-=8;b-=8;for(var l=0;256>l;l++){var h=f+l%16,m=~~(l/16)+b,n=h+m*g;pa(h,m)&&64>=Math.pow(h-d,2)+Math.pow(m-k,2)&&qf[n]&&0===U[n]&&(O(h,m),new tc(60,c.kingdom,h,m,0))}}},Xg=function(b){var c=b.list,g=b.anim,d=b.i,f=b.a,k={x32:g[2*d],y32:g[2*d+1],d:0,img:m.flame_trail,mv:1,z32:2,alpha:!0};tb(k);Ib.new(k,Ja(k.img));for(k=0;3>k;k++){var l=z[U[c[k+3*d]]];l.health&&
l.damage(96,f)}b.i++;b.i<.5*g.length&&Fa({func:Xg,data:b},50,1)},sf=function(b,c){ab(c,b,rf)};sf.cursor=0;sf.noObj=1;var rf=function(b,c){if(b.id){var g=b.id,d=b.x32;b=b.y32}else g=-b,d=b%D,b=~~(b/D);if(Db(c)||c.checkMana(60,g,rf))c.setupDir(-c.x32+d,-c.y32+b),c.setupSpellIMG(),za("freeze",d,b),Fa({func:Zi,data:[d,b]},1E3,1)},uf=function(b,c){ab(c,b,tf)};uf.cursor=0;uf.noObj=1;var tf=function(b,c){if(b.id){var g=b.id,d=b.x32;b=b.y32}else g=-b,d=b%D,b=~~(b/D);if(Db(c)||c.checkMana(70,g,tf)){c.setupDir(-c.x32+
d,-c.y32+b);c.setupSpellIMG();za("confusion",d,b);c=4;d-=.5*c;b-=.5*c;g=D;var f=[];c+=1;for(var k=c*c,l=0;l<k;l++)for(var h=1;3>h;h++){var m=z[Ra[h][l%c+d+(~~(l/c)+b)*g]];m.build||m.terrain||m.stoned||(m.confused=1,m.invisible&&od(m),pd(m,ti),m.stay(),f.put(m),Qd(m.id))}k&&1===C.length&&aa(C[0]);f.length&&Fa({func:$i,data:f},2E4,1)}},$i=function(b){for(var c=0,g=b.length;c<g;c++){var d=b[c];d.confused=void 0;d.death||(ObjectsetupIMG(d,d.img,1),lc(d),d.stay(),ib==d&&(ib=void 0,C[0]=d.id,aa(d.id)))}},
Zi=function(b){var c=6,g=b[0]-.5*c,d=b[1]-.5*c,f=D,k=[];c+=1;var l=c*c;b={img:m.freeze_expl,d:0,mv:1,x32:b[0],y32:b[1]};tb(b);Ib.new(b,Ja(b.img));for(var h=0;h<l;h++)for(var r=1;3>r;r++)b=z[Ra[r][h%c+g+(~~(h/c)+d)*f]],b.build||b.terrain||b.nofreeze||b.stoned||(b.freezed=1,ObjectsetupPosition(b,32*b.y32),b.stay(),ObjectsetupIMG(b,b.img,0),b.invisible&&od(b),pd(b,ri),b.health-=40,1>b.health&&(b.health=1),k.put(b),Qd(b.id));l&&1===C.length&&aa(C[0]);Fa({func:aj,data:k},2E4,1)},aj=function(b){for(var c=
0,g=b.length;c<g;c++){var d=b[c];d.freezed=void 0;d.death||(ObjectsetupIMG(d,d.img,1),lc(d),ib==d&&(ib=void 0,C[0]=d.id,aa(d.id)))}},wf=function(b,c){O(c);ab(c,b,vf)};wf.cursor=0;wf.noObj=1;var vf=function(b,c){O(b,c);if(b.id){var g=b.id,d=b.x32;b=b.y32}else g=-b,d=b%D,b=~~(b/D);if(Db(c)||c.checkMana(100,g,vf))c.setupDir(-c.x32+d,-c.y32+b),c.setupSpellIMG(),Zg(d,b,3,20,4500,c.id)},Zg=function(b,c,e,d,f,k){for(var g=m.fire_rain,h=p.gravity,r=Date.now(),n=Zg.rnd,u=Math.PI,t=performance.now(),v=0;v<
d;v++){var w=2*n()*u,x=e*n(),y=b+x*Math.cos(w);w=c+x*Math.sin(w);x=~~(v/d*f);pa(y,w)&&Fa({func:bj,data:{x32:y,y32:w-6,dix:0,diy:140,img:g,mv:1,d:0,timestamp:r,finnish:Infinity,aceleration:h,attack:40,xf:y,yf:w,range:2,kingdom:0,obj:k,crashTime:(Math.sqrt(19600+384*h)-140)/h*1E3}},x,1)}O(performance.now()-t)},bj=function(b){Fa({func:Te,data:b},b.crashTime,1);tb(b,0,b.diy,p.gravity)};Zg.rnd=function(){var b=4096,c=2048;return function(){c=36969*(c&65535)+(c>>16)&4294967295;b=18E3*(b&65535)+(b>>16)&
4294967295;return((c<<16)+b&4294967295)/4294967296+.5}}();var Mi=function(b){z[b.obj].damage(b.attack,z[b.obj]);Eb(b);Wb.put(b.bufferID)},cj=function(b){b=z[b];b.bufferID&&(Eb(b),Wb.put(b.bufferID));qf[b.x32+b.y32*D]=void 0},Te=function(b){var c=D,g=b.xf,d=b.yf,f=b.attack;b.mv=1;b.func=void 0;b.x32=g;b.y32=d;ObjectsetupPhysics(b,0,0,0);ObjectsetupPosition(b,2);g=~~g;d=~~d;var k=g+d*c,l=U[k];Xb[k]?(b.img=m.expl_small_water,za("water%blop",b.x32,b.y32)):(b.img=m.expl_small_hole,za("small%20explosion",
b.x32,b.y32));ObjectsetupIMG(b,b.img,1);Ib.new(b,dj(ta[b.img]));if(2<l){var h=z[l];h.damage(f,z[b.obj])}k=b.range;l=2*k+1;for(var r=0,n=l*l;r<n;r++){h=r%l-k;var u=~~(r/l)-k,p=~~Math.sqrt(h*h+u*u);p<k&&(h+=g,u+=d,h=U[h+u*c],2<h&&(h=z[h],h.damage(f*(1-p/k),z[b.obj])))}},dl=function(b){if(0<C.length){var c=z[C[0]],g=0,d=0,f=0,k=0;void 0!==c.dix&&(b=.001*(b-c.timestamp),k=c.dix,f=c.diy,g=k*b,d=f*b);if(c.space){var l=c.space;b=l[l.length-1];l=(l.length-1)/b}else l=b=1;g+=32*(c.x32+.5*b-Math.sign(k))+.5*
-tzar.width+.5;d+=32*(c.y32+.5*l-Math.sign(f))+.5*-tzar.height+.5;vb=~~-g;Wa=~~-d}},ej=function(){};Ud.distance="healingRange";Xe.distance="createGolemRange";hf.distance="blessDistance";rf.distance="freezeDistance";tf.distance="confusionDistance";kf.distance="invisibilityDistance";Vg.distance="lightningDistance";af.distance="createBatDistance";Ze.distance="createDragonDistance";ef.distance="createCarpetDistance";cf.distance="createJinnDistance";gf.distance="turnToStoneDistance";mf.distance="flameBoltDistance";
vf.distance="fireRainDistance";of.distance="freezeDistance";Wd.distance="teachDistance";var H=[];var ec=function(b,c,e,d,f,k,l){this.name=b;this.k=H.length;this.color=c;this.status="";this.stats={dmgInflicted:0,dmgTaken:0,resources:[0,0,0,0],score:0,unitsKilled:0,unitsLosed:0,buildsLosed:0,buildsDestroyed:0,unitCount:new Uint32Array(t.length),unitCountMax:new Uint32Array(t.length),unitCountDeath:new Uint32Array(t.length),goldTraded:0,goldConverted:0,stoneTraded:0};this.team=l;this.resources=k||[5E4,
5E4,5E4,5E4];this.values={gold:10,wood:10,food:10,stone:10,buildSpeed:1,experience:0,healthJump:0,maxLevel:4,pop:0,popMax:1,popLimit:200,healingRange:1,blessDistance:9,createGolemRange:5,freezeDistance:13,invisibilityDistance:9,createBatDistance:16,lightningDistance:12,createDragonDistance:4,turnToStoneDistance:21,flameBoltDistance:19,fameTech:0,confusionDistance:13,manaSpeed:2,milkSpeed:2,cowSpeed:2,stealCow:0,miningPerf:1,fireRainDistance:15,createCarpetDistance:3,createJinnDistance:3,teachDistance:2};
this.race=d;this.racestr=$g[d];this.IA=f||0;this.diplomacy=e;this.control={};this.control[this.k]=1;this.onFreePop=[];b=[];b.length0function=el;this.unitLoading=0;this.target=[0,0,0,0];this.crusade={number:0,list:b};this.technology={hidden:{},disabled:{},actived:{},investigated:{}};this.mod=c=[];fj[this.racestr]++;b=0;for(e=t.length;b<e;c[b++]={});H[H.length]=this;b=this.k;c=[];Cb[b]={};mb[b]=c;for(e=0;e<t.length;e++)c[e]=[];H[0].diplomacy[b]=1;c=this.color;qa[3*b]=c[0]/255;qa[3*b+1]=c[1]/255;qa[3*
b+2]=c[2]/255};ec.prototype.setupResources=function(b,c){var g=this.resources;c||(c=1);g[0]-=b[0]*c;g[1]-=b[1]*c;g[2]-=b[2]*c;g[3]-=b[3]*c;We(this.k)};var mb=[];var Cb=[];var qa=[];ec.prototype.check=function(){for(var b=fl,c=mb[this.k],e=0,d=t.length;e<d;e++)if(!b[e]&&0<c[e].length)return!0;this.die()};ec.prototype.checkPopArray=function(){this.onFreePop.length&&Kd(this.onFreePop.shift())};ec.prototype.die=function(){this.k+1!=H.length&&(this.death=1,this.status="defeated",gj(),Bb(qd(y.playerDefeated,
this.name),0,5))};ec.prototype.paypal=function(b){var c=this.resources,g=!1;c[0]<b[0]&&(Bb(qd(y.notEnough,y.gold),0,5),g=!0);c[1]<b[1]&&(Bb(qd(y.notEnough,y.wood),0,5),g=!0);c[2]<b[2]&&(Bb(qd(y.notEnough,y.food),0,5),g=!0);c[3]<b[3]&&(Bb(qd(y.notEnough,y.stone),0,5),g=!0);if(g)return g;c[0]-=b[0];c[1]-=b[1];c[2]-=b[2];c[3]-=b[3];We(this.k)};var We=function(b){if(b==A.kingdom){var c=H[b].resources;b=c[0];var g=c[1],d=c[2];c=c[3];Infinity==b&&(b="***");Infinity==g&&(g="***");Infinity==d&&(d="***");
Infinity==c&&(c="***");gl.innerHTML=b;hl.innerHTML=g;il.innerHTML=d;jl.innerHTML=c}},fl={13:1,20:1,21:1,22:1,27:1,32:1,35:1,36:1,43:1,44:1,55:1,56:1,57:1},ob;var hj=[];(function(){var b="",c=new Image;c.src="data:image/gif;base64,R0lGODlhIQB2AfcAAAAAABAIAAgAABEhACE6ABkbChAQAAgIABAQCO/vlN7epf/6hZSQUv76n721a//rY/XmhnNjECklEP7oecW1Y+7ZeP/rhvvrljEpCCgiB+/Wa97OjP/WSu3YhyEZAIhzLf/WWOnHWv7baL2lVt3Db/vsvUo3BGtSCGhVIdq1SnhjKdy4V62USuvIaPzad/felO/XlzopAGtaMe3Kd/zbiOjMhv/9+JxzGWNKECEZCP/JSuu5Sc6lSMynV4tzPdSyaK2UWjEhADopCNacKWNKGVdCGf/IVuu4VruUSPzJZ7qYU0IqABkQAGdFB2tKEFI6D5tzKMqVN9unSNyrVlRDI/nLd7JwACkZAOaUEDEhCMSMMZRrKYlkJ/u3SJt0M8yYRquDQO66Zu3MlrWcc5haAItSAf+lGUIqCGNCEJdjGXpTGJxrIfisOGtKGcSNOtacQruHOfu6VsiYVOm6dPvLh/rZqTohAHdHB3NKEFo6D0kxEJRjIc6MMalzKYRaIZxrKXlTIuCcP6x5M+umR1I6GX5aKdacSuqqVdedUollNK2HVUopAFQxBXtKEGtCEMmBJ7h2J3NKGdeNNMOCMWNBGZRjKf2rR86MOtaUQpdpMt6cSrqFQkk0GnVWL9OjZolVGeeQLJ5jIKdqJ4xaIeCTObd6NembRt6UQsWEPGlHIf+tUsuMQ9aUSppyRzEZAGU1BkopCHNCEDohCFIxECkZCPeXM3tKGdKDMIRSIZxjKlo6Gc6EOoxaKahwNt6USjUkE/zLmUIgACEQAIZLEtZ2H5ZUF2Y6ELlpIN9/KGtBGUUpEHVKIRkQCNaMRntCEHNCGZdZI86MUjoZAFQoBs5qIF0xECUZEE8hAHQ0CIQ9C5RHD65TFb5cGXY6EDEZCHtCGYRKIVIxGSkQAEohCEIfCVIpEKJEEUUpGWgnBzoZCEIzKzEQABkIAHMpCIw0CyEQCFsZAlEZBikQCDQZECEHAD4PATEQCGshEDEIAPNGKRkAABAAABkICBAICAgICP///yH5BAEAAP8ALAAAAAAhAHYBAAj/AP8JHEiwIEEBBhMqXPiP3QGEAwVAZKgQYoBwLAIMpIUCwESKE5lI/CeA0woU+wTSIvHk40IBD/9x+vHrnYB9+358EbdPwDsavfi5NMiEChcA/5i0QIKrzTsANeQoC+DzAhJvKYcK3AeoAheqAlbo0XNGlpIKR5axEyChwwo/U7UK+EWiAxRdgH5RGnWpD6ArwpCUWlaES40WX0pRompQwIcXLbR8ObKi1BdUcXatMsZuFCUuUtxKidLr11ABT5Ag+tIHjK5MYb5UilPqlK0rVwKkmiJFyyVBpgsyCRCAEpIvyubJC4CkCq9Rh3JhqiRSAJQvcPgIUgaTIIofMvL8/5hCKwfEHmEiDcq0CtosdklHjeoDaSpSgQKoWGjRowMYWh4JlEgYm4wyhR+buaKLAEwoQ4gfs9CikUBM/OBWCytEAuBESIThhyZbVGILOU+QJEAOhFBCyy/44QDDDFKsgJwwqRA0oBejiBJJMmecYSIAOSxjjzf4jeLCFNi9ocxugAyk3hSVhIILGmd4U6KJ77yTAzu/cMIOZXBQ4gcsRXyRhB4CPXEJHT2U4kUyeggzS0QCABAAHD0koUIP/HkjzwH/+ODCFz7qUQoNM3zBVB5X+GjQLGBQtkIHSTxDXAB5wGFBGEUUcUsVF8SWSzJZyJLQTZUc0cIMK7ghhAAZ/P9DySAWuBCHKYdcMMMUgkQSZxGnyiPFF27wIAUX9hgQQBu4DOKCrVLQUMURboySBxNonurFCmn4UYoWfsiT0l6TDBLHIWGEgeQfaAQhREXhrADHLLrgIsgswgiURySiuCEFK4dg4oYoz5yhlUDiRCEFJfZk0UYeNgkkizGfiCJKKajAkYstswTQpEKzVsIOO+Rk4Y1IAglzRh7OQFOKIKF8wmgWClHVhyRFBOARLbRMxI4wsDgSSh99jJKMLKfNxY4abgiii851fiQAO64Yc4woebiCckE5qFCFEnB8IcUWv2zdmDDDSCMRg40RIkgILVAmxRPvTJjQPuwA4FG+pzL/w8UkYGCXzC8BJkSVnSBloYssnMxSsgEHU2RQFjoH4I0wkUuuEAB4Z655RZ8rVAIgzIQeehx0RMKE6Z9XkcQspbNOESZ0xAG77BQFAoztseOukO6WlNO77waZUocls+RAvEKHHJ/88gk1X4sxtEBvUBh1sGGM8tYTNIgNtXzC/T9kVA99IOA/f0cJtYxPPB82gHLHP03QYAU93fOBzDE5bGLKK90byB1I4Q3zdS8PjGhCCaxgQOjdwQZWMAMtzIAFmlmPBmzIAiX+8YohlKEM81teGXg2kDLYgAZkCOBAmlCLWtxHhf/4IAxnSMMa2vCGOMyhDnfIwx768B82QEMN/2dgg3fN0BNhsAERZtgKRMDABsaYISvCAIMSPINIAczEEeRQhxK8woLWe8UOLrGCElzAFukIIB+O8IgpXGAOr0hHH6yXiyQkRgwwSMIdvGGx5anBCFNYhSjmMIcj3MAbgIDE8jQRBkQIYg3j2YEUZBELLRAPCUk4hBy4kAs5wEFh8nDEG6KAuyZkcgpwaEQvFCGIK3jjDIx4xA5wd4QjBPITjviDMITBjiysCAMvDF0f4iCFUkBDDx6QhTVmIY/CyY4eSZACKi5BjgA0QgtbkEUDZReFHexAHOKoRAPC0IZXLm8ZIBCHzvTgiVKlwhrLO4cx9oEUAGSAFnKYAhf6of9CABxAEDtIhCxMAMMA7OEMPSiGGmDIiDF0AAnQgOEBQFEDRgSzeyYoBqZ+yNGOevSjIA2pSAVygic0gXVLkFwT3BGPeIQOHYx4wkUL0gRzcCMe2KiH5tCBDnfo7R/kUIg79hcPdLhUcuiwqUvrwQiDtJQatQiEOdxBAKQO9RgR6GlCpsENZOgAGdxoRzAo8tSoTpUA7RhIPYo6VB3ooAuSaCpFuOpVsLZDrsFohzt4So0u6MAIICjGWBligra+Na7uYEQw3OGOf5iAG2z46wOksA10UAQdff1rYBlbD3MU4x/40EYtACuCB1SWIo+NrBEmy9MMcIMa7sAHPh6hAxD/GIEDoOAGNggrWtKaFh3C2AYoGCvbY7CBDaAgRjF2S9ha1Pa2oMgGPhhRC9hqY6/aSC4xZMHchZgAG9g4bnKLEQ/hgsIc1KCGOeqhjW6wFJwUwYY7skuM7b5iG1A9BlSJgQ5yoMMY2CiA5kyAjm24Nx5LcAc12BAIZBx3G8HARgbEEVTJYWMc4/gvNmiBDmKAQge1YEMXkGEOciDucxgex4QZUY/6dsEIx60FMnA3DmwwIwCMYIQ5zEGMOOiADSGuMOsC8F1s5HjHo+1CLUABCuIFYLc7tikpunAL4Q4Deozdhja2wQ1zwOMRw7gy8eABj20Uoxxchgc5lKGM5cGj/7NnCEA3wgqAJaQUeu2gypPRUY9pbMN6AchCBhAQjAybo3tkzkA83lEAIXcvB9gQRwGkMdJKW/rSBlHGDFhHAxZRJAdV2PTnfhCGbSbkHZqgQRg0hwgXaMLTDBEGL1ywK4qsIgxJyISpDSKMZEBCD0VIxEIooQxvbCMZuy6IN6YSgGQPJAuY24ezB+IndsDCCFFUSB6mAIt3sAOLmnsGJXRBhSIAQhB9EIUXEkGIZETI0Zr7hS5IMYELXKABF6hAC5JwhC+0wZes08UXBpEEC1igAQ2oVRICAYdKKAPeklvGwI0wgYM3YAJJiMMb4MALPUw7Ictwg7lEgHFTTCEJYf9wQy9SUZOA/yEQcQDBD/KRD3f4AA598MMTaPEO1inDW4OwRCvu4Y56qAMQe2iDMnIgD9Z5IxJ9MIUlOsGJeajj6J/QxS+Y8XGD0IISezhFF7rwB3VQAQqTiESEEADuz3ljFkDvgghEYIRBKGbpzADj52ThsJfL3QVGOAIXnpAFZuRddjl4Ai5IYQkjiICYfvA4M3ouO1n8IhKCGIQRkmCJLwBi6c32nTcI0Qdz1V0QRaBc1xkiC13AwQinJwQz2o67TCjDGKUwRR+MUQ0JWO8Qn3+HhNjxiVNA7xBfqIaQx5EHTKyCeGCYAiXSSJB08IIUgsBdKwyBC9oLRBm5sLv/7MCQiDYrJBWtyASm189+9tvBDq4QBwyfMApW9CEZ7EhJ98Cwik3EYRKrYFHdkwhV8AW4kASiYAqRMDLWIwc0gAu2cAi4oAm84DmjVgV5IIHNMApnMFOy4zWbAAiH8AyowAj0MCfQowRzEAmHUAi84AhXQFCycyUCUgWZgAu5gAbGcAWuIDtEcAjAIhDJcAg/wAuVoAbV4ArsIIOh8wRy4AJBIBBnsAoX8AOb4AXGEAz7YCqs4wMQgAhX8A9nUAoXQANToARqwAhUIzsmsAoJEAZjsQs00AAFWAnGsEu4kwdxkAATcASkEAYNoGqCEAvBIADZYjqUoAaHAAEYlyuq/2aAsCAAjsI6eTAKbnAIKFcFVRAGhvAHeSAMYYg7JuAIorAKU4AIYcAKXyAKO+iBnyMOjKAGfyAKvVAKm5ALjhAMAPAxuLMP0jANxjAMgiAI0OAIsPAzy+MRrjANwwAN0MB74uCKoaM3+jANxVAMdrAW0mg6nPMK9KA3zgQ9HgGOdmM94LiN7ZeO6riO7HhpvdALgJAKNdI9QFAKq7AKqggGhQBrvvMDM2AKvsAK94gKm5AJ50A8PwADdBAGAMkKqECQmyAInOA7JFACM3AIhzAIlXBurLAJBTmRsvMDJVADh7ADEPACiZAKuXePnYA7P2ADdRAGgzAHNqAA35AKnP+QCJ1ABbjDRSUQBhipATZwBLkAADc2ALgDBh1AA3FzBKkQAhuwCalQjrKDCPl2BILgD9TQC60QDa0gYL6TCj/QAodwDgDACZsADK3ADAiwPKmQCVQQO5nQCe/Qb9XglsFEBb9QBz8gCLYAQ79ABXy5ChukQr/QCTDgCaUQDoBJBWLgCZkAkgH0C4nwmJnAmIbZCmIgB51AldDzC62gCOqQAZ65PL/wCwdAHDN0Ke3Ymq75mrAZm7ApmbhDmwSRCqdQmOFgfp9DCKigC5kGCKUADsogAnCFmQwRB3GgBxeDC6aWBctwBtzwAA1gCZFAEV0wAQ1wDNWQDJRnEAeQBZD/YAkuUJ28aRCWUHGWgAzCoHeZJgi7kJ4NcAsKUQsNIAKmIAmiAJwMkQOUwC+3cAQQkAwGkQsL0AWQMArQoCGSkwM8MwvVMAu+QhCzoAbdMA16oE3uwzq4EAeqcJ7W06ElIALQAKLLE4E0cAvpUJq+MwtWMw4BsDoq9A4ZyqIU8XV/UAqScJ9GwIsDMQopQAKBMAkv0waHyDX+VApJUAITEAi8gJwDoQzHcAQlQAeDwAVTYaL/ACBMcABwMAinIApQShCyAAldkACJEAAHACQJoQx/gAzKcABuUApaOhDGIAnHAADdoA0kVBCzIAmWwAbcAADLkAx1+n1/wAS/wAeg/0ANBaEMcKAKpoAJnZAFAKAHhzoQyaAzlPAFpkAKkGBBunEJojALT2GUR6oQlKM3utALl0CnysMMB7AM5sMzY7oQv2A+DqML72B+zMCPxMMJB7B6slmsxnqsyNqO+0AfvoMOxcANxIAMknALx9AHoHgEgzAIxxA6jNAIj0AKRxCI0hIGkjAM7JAG5UmHpvA5mNMIXeAGaeAIS3AF4tAEWfMIoGAEFjcDbyA5IoEbxMEOTMAEAssEwuAEofAIjyAJSfAsUyA5+ReF//AJgjAJdwaKrrAIefAKd3AHogAH/fo5dyAGJWAJ1BAD/yAM4mAHMWAHgLFLBksRFisQV0ADSf8wCKGwCLgzCW/AB4GABsPxD3aQbq/wCnbwOVwABsYyAzRgK4MQBIUDGOIgo/8AB1uABqJAgwQhDksjBWFQBS5QBVGAOaIACYvwBGcQA4wgCF57CHFACqJwZwkBAMGwDccACX2xD0EgCpJgBC5gAWVYBdIyGsVAD/LHEPtwDdjwCX2wFsWQBpCgsNN6CZOQBp8QC9JwBVTLEAHADoygM0zgCuswDdfAU9LQE5wTDD34OewQAK6gfzPEN8k6u7Rbu7Z7u7ibu5rTB+LAhSr0LNPAN4VgqbuoBJ+FOyKwAq9gCAYXBqUwAxVAAz8wDdhwvKxTDCFgAUlwb67TAmEwA47/kA2LKzsNsABJAHtx0AWB0AMkQAl5EwvOwDoJB3tG0AWDQApTAAaYQxw/FTrl6wIZ1wWgQAqIsARrozcWWBAAbARxMAiSgAibsL/nKDthgK2kgAmIYAwSoY11gjtTsAluoAmlQBX0cAYqEBO+AwdKoASMIBH0Cgap4AqhiDtKoAiuQBUHgAcqsAAO0AEMQDxMIA514hEBIAwU8ASfcAUJ/DlXUAFPYLfXsBYBdAbbUAWmEAoC2D2u8AoAPAmfIMXdIwClUAWaAA0trEKycAhVAAmOgDkBZAe4EAY/8AmRqEJnAAdzIAiOcMMqxAhfMAqzQDl2nMRqaqO4kxtLrLuK/7zIjBxSsLAIROIEgMkCUqAOUDANAbQFH8ACK+ACbfAJAqEGLLBQvpMBbbACK9AFXOAov7ADR+s7A5ACPAACg2ALRiQNtHANy+MNn5AMsMAEJ2UQetAGbcAIsAAFn0MLJsAOdiBXBgEASAAIPdAK5ODMC+EIjjANWSACSDEWZSEQX0ACYcADK2AIMkIR2VAEKwA0D8AEe9EXfyEMAGAMSRACIdArM7wQAXAEI8AFM9AGXnAZmbEZ7JC8UoAEUfAJqWo4gGABSqABI6AHmyAbtGEbuNEHe4AHdWYQd2DCjKAJLoAEIr0CUiAFhFAERQgd0kEd7CAPApBsDDABLSAA5P/gLCtAGVPwB0TgA+mxHu3xHuxwDbsGAJsQAl2gN8swCFMgKVJgDHpAIAaCIMagIAshDVzQBVpwAFywADCCylOQCZSgB53gISAiIiTCEOGgN1CgBUUbBVGgDFygBt7wDlwQBjiiIzwyiQnxCgLACK7gCrvIBYSwCUXwBHP9JFEyJVWitQzRD81w0mYyFkygJmziJnAiJ5rzCrLwDD4hKIQyD4aCKIqCC4yi1wvxCvQkDrSQKZvSKZ8SKl8wKqXCOgbgDbNSK7eSK7vSK7/CED4ABipQEMziLNAiLdRiLdiyEMxwBF1gouRiLuiiLl/ALu6yENOQCG0ACwmxL/3yLwFJMzAFkzmguBATUzEXkzEb0zE+yjoqwzIuAzMycwXuyTo/EzRDUzRHk8gVQTVWgzVao98vgTZqIxGbuzx4g8CyC2h1YsiN/DkBAQA7";
var e=document.createElement("canvas"),d=e.getContext("2d");c.onload=function(){e.width=33;e.height=34;for(var g=0;11>g;g++)d.drawImage(c,0,34*g,33,34,0,0,33,34),hj[g]=e.toDataURL("image/png"),b+=".ncursor"+g+"{cursor:url('"+hj[g]+"'), default}",d.clearRect(0,0,33,34);document.getElementsByTagName("style")[0].innerHTML=b};vc(2)})();var Xd=function(b,c){w(b).style.display="block";Xd.actived=b;c.actual="potion";c.id=0;c.amount=100;c.func()};Xd.actived="";var ka={potion:{bak:1,max:4,ord:["level","mana",
"attack","defence"]},sword:{bak:5,max:3,ord:["attack","attackBow","defence"]},book:{bak:8,max:18,ord:"fireRain lightning healing createCarpet createBat bless freeze confusion invisibility createGolem magicVision raiseDead turnToStone whirlpool createDragon flameBolt teach createJinn".split(" ")}};w("mgbook").onclick=function(){ka.actual="book";ka.id=0;ka.amount=b[ka.book.ord[ka.id]].obj.spcost[0];ka.func()};w("mgpotion").onclick=function(){ka.actual="potion";ka.id=0;ka.amount=100;ka.func()};w("mgsword").onclick=
function(){ka.actual="sword";ka.id=0;ka.amount=100;ka.func()};w("mgdecline").onclick=function(){w("magicworkshopmenu").style.display="none"};w("mgitem").onmousedown=function(g){var c=1;g.button&&(c*=-1);g=ka[ka.actual].max;0>ka.id+c&&(ka.id=g);ka.id=(ka.id+c)%g;"book"==ka.actual&&(ka.amount=b[ka.book.ord[ka.id]].obj.spcost[0]);ka.func()};w("mgaccept").onclick=function(){da(ij,[ka.actual,ka.id,parseInt(w("mgamount").innerHTML)],C[0])};var ij=function(b,c){c=z[c];var g=b[2],d=[g,0,0,0];ob.paypal(d)||
(g=~~(250*g),"book"==b[0]&&(g*=2),c.setupINTV(jj,[b,c.id],g),c.lcost=d,c.techStart=c.c-p.cycle,aa(c.id)&&(w("magicworkshopmenu").style.display="none"))},kl={defence:6,mana:0,level:2,health:1,attack:5},ll={attack:"sword",attackBow:"bow",defence:"shield"},ml={attack:.5,mana:1,defence:.5,level:.2},jj=function(g){var c=z[g[1]],e=g[0][0],d=ka[e].ord[g[0][1]];g=g[0][2];c.lcost=void 0;"sword"==e&&(e=ll[d]);"attackBow"==d&&(d="attack");e=Object.assign({},Ub[e]);if(e.potion)e.d=kl[d],e[d]=~~(g*ml[d]);else if(e.book){var f=
b[d],k=f.obj;e.spell=d;e.attack=~~(g/k.spcost[0]);e.name=k.name;e.iconID=f.iconIDbook}else e[d]=~~(.25*g),250<e[d]&&(e[d]=250);O(e);Jc(52,c,!0,e);c.techStart=void 0;aa(c.id)};w("mgamount").onmousedown=function(g){var c=10;"book"==ka.actual&&(c=b[ka.book.ord[ka.id]].obj.spcost[0]);var e=c;g.button&&(c*=-1);zb.shift&&(c*=5);ka.amount+=c;0>=ka.amount&&(ka.amount=e);w("mgamount").innerHTML=ka.amount};ka.func=function(){w("mgitem").style.backgroundPositionY=-48*(ka.id+ka[ka.actual].bak)+"px";w("mgamount").innerHTML=
ka.amount};var xf=[0,0,0,0,0,0,0,0],Ab,ed,La=[document.getElementById("order1"),document.getElementById("order2"),document.getElementById("order3"),document.getElementById("order4"),document.getElementById("order5"),document.getElementById("order6"),document.getElementById("order7"),document.getElementById("order8")],kj=document.getElementById("bottominfo"),yf=La[0],zf=La[1],Af=La[2],Bf=La[3],Cf=La[4],Df=La[5],Ef=La[6],Ff=La[7];yf.addEventListener("mousedown",function(){yf.style.transform="translate(2px,2px)"});
zf.addEventListener("mousedown",function(){zf.style.transform="translate(2px,2px)"});Af.addEventListener("mousedown",function(){Af.style.transform="translate(2px,2px)"});Bf.addEventListener("mousedown",function(){Bf.style.transform="translate(2px,2px)"});Cf.addEventListener("mousedown",function(){Cf.style.transform="translate(2px,2px)"});Df.addEventListener("mousedown",function(){Df.style.transform="translate(2px,2px)"});Ef.addEventListener("mousedown",function(){Ef.style.transform="translate(2px,2px)"});
Ff.addEventListener("mousedown",function(){Ff.style.transform="translate(2px,2px)"});yf.addEventListener("mouseup",function(b){Ab=b.button;nb(0)});zf.addEventListener("mouseup",function(b){Ab=b.button;nb(1)});Af.addEventListener("mouseup",function(b){Ab=b.button;nb(2)});Bf.addEventListener("mouseup",function(b){Ab=b.button;nb(3)});Cf.addEventListener("mouseup",function(b){Ab=b.button;nb(4)});Df.addEventListener("mouseup",function(b){Ab=b.button;nb(5)});Ef.addEventListener("mouseup",function(b){Ab=
b.button;nb(6)});Ff.addEventListener("mouseup",function(b){Ab=b.button;nb(7)});document.getElementById("stock").addEventListener("click",function(b){lj(z[C[0]])});var lj=function(b,c){if(0==X.stockActive||c){if(c=b.inventory,c.length){var g=[];g.length=c.length;for(var d=0,f=c.length;d<f;g[d]=z[c[d++]]);na(g,b,1)}}else na(b.icons,b)};(function(){for(var b={},c=0,e=La.length;c<e;b={l:b.l},c++)b.l=c,La[c].addEventListener("mouseenter",function(c){return function(){var b=X.displayed[c.l],d=z[C[0]];if(d&&
d.kingdom)var g=H[d.kingdom];if(b){if(void 0!==b.unit){d=t[b.unit];var e={name:d.name,cost:vi(d.cost,b.hero||b.merc,g.values.fameTech)}}else e=b.obj;X.stockActive&&Oc(X.active[c.l].id,1,1);if(e&&e.name){var h=e.name;d="<span>";d=2==h.length?d+(h[0]+" - "+h[1]):d+h;if(h=e.cost){!e.tech&&g.mod[e.type]&&g.mod[e.type].cost&&(h=g.mod[e.type].cost);d+=" - (";for(g=0;5>g;g++)h[g]&&(d+=h[g]+"<img class='resource' src='"+nl[g]+"' /> ");d=d.substring(0,d.length-1);d+=")"}d+="</span>";H[z[C[0]].kingdom].technology.disabled[b.id]&&
(d+="<span class='red'>"+y.requires+": "+b.require+"</span>");e.type==$a&&(d+="<span class='increase'>+"+e.increase+"</span>");(g=X.active.cut)&&g[b.objName]&&(d+="<span class='shotcut'>"+g[b.objName].toLocaleUpperCase()+"</span>");kj.innerHTML=d}}}}(b)),La[c].addEventListener("mouseout",function(){X.stockActive&&Oc(C[0],1,1);kj.innerHTML=""})})();var ah=function(){history.pushState("",document.title,window.location.pathname)},Sb=function(){p.online=0;location.hash="";w("MatchX").style.display="none";
document.getElementById("index").style.display="block";document.getElementById("returnmenu").style.display="none";document.getElementById("game").style.display="none";document.getElementById("chat").style.display="none";document.getElementById("gameFinish").style.display="none";setTimeout(ah,200)},nb=function(g){var c=xf[g];nb.lastFunc=c;nb.nu=g;if(X.stockActive){c=z[C[0]];var e=z[c.inventory[g]];e&&(e.potion?zb.control?da(Vd,c.id,[c.id,e.id]):(T=Vd,T.item=e.id):e.spell?zb.control&&c.mana?da(Ui,c.id,
e.id):(b[e.spell](),T.item=e.id):(da(ld,c.id,[e.id]),aa(c.id)))}else c&&c();nb.lastFunc=void 0;nb.nu=void 0;La[g].style.transform=""},Kh=function(b){var c=[.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.27,.3,1,.5,.5,.5,1,.62,.62,.62,1,.74,.74,.74,1,.3+.58,.3+.58,.3+.58,1,.94,.94,.94,1,1,1,1,1,1.06,1.06,1.06,1,.3+.82,.3+.82,.3+.82,1,1.08,1.08,1.08,1,1.04,1.04,1.04,1,1,1,1,1,.95,.95,.95,1,.3+.58,.8,.7,1,.3+.54,.72,.6,1,.7,.62,.5,1,.6,.55,.3+.15,1,.5,.44,.42,1,.4,.37,.35,1],g=new Date;
null!=b&&(g=b);b=g.getMinutes()/60;g=g.getHours();document.getElementById("daynighticon").style.backgroundPosition="0 -"+36*g+"px";var d=[c[4*g],c[4*g+1],c[4*g+2],c[4*g+3]];g=(g+1)%24*4;d[0]+=(-d[0]+c[g])*b;d[1]+=(-d[1]+c[g+1])*b;d[2]+=(-d[2]+c[g+2])*b;d[3]+=(-d[3]+c[g+3])*b;return d},vb=0,Wa=0,Pc=0,Qc=0,Ad=function(b,c){var g=tzar.width,d=tzar.height,f=A.mx/32;b/=32;c/=32;var k=fa*g*.03125,l=fa*d*.03125,h=.03125*g,m=.03125*d,n=b+.5*(h-k),u=c+.5*(m-l);0>n?b=.5*-(h-k):n+k-f*fa>D&&(b=D-k-.5*(h-k)+f*
fa);0>u?c=.5*-(m-l):u+l>Aa&&(c=Aa-l-.5*(m-l));k-A.mx>D&&(fa=D/(.03125*g),O(fa));l>Aa&&(fa=Aa/(.03125*d),O(fa));vb=32*-b;Wa=32*-c},zc=document.getElementById("minimap"),Gf=function(b){var c=b.pageX-parseInt(zc.style.left);b=b.pageY-parseInt(zc.style.top);var g=tzar.height*Xa/(32*Aa);c=~~(.5+(c-tzar.width*Pb/(32*D)*.5)*D/Pb);b=~~(.5+(b-.5*g)*Aa/Xa);Ad(32*c,32*b);0==ed&&document.removeEventListener("mousemove",Gf)};zc.addEventListener("mousedown",function(b){var c=b.pageX-4,g=b.pageY-31;0==b.button?
(document.addEventListener("mouseup",function k(c){document.removeEventListener("mouseup",k);document.removeEventListener("mousemove",Gf)}),ed=!0,Gf(b),document.addEventListener("mousemove",Gf)):2==b.button&&(c=~~(D*(b.pageX-4)/Pb),g=~~(Aa*(b.pageY-31)/Xa),da(Hb,c+g*D,C))});var zb={control:0,shift:0,esc:0},ua=function(g,c){g&&1==C.length&&(g=X.active,c=ol[c],g&&g.cut&&(c=b[g.cut[c]]))&&(g=ob.technology,Ab=0,g.disabled[c.id]||g.hidden[c.id]||c())},$h=function(b,c){var g=document.getElementById("notifybar"),
d=document.createElement("div");d.innerHTML=b;c&&(d.style.background=c);g.appendChild(d);setTimeout(pl,11E3,d)},pl=function(b){b.parentNode.removeChild(b)},Kb={37:function(b){Pc=b},40:function(b){Qc=-b},39:function(b){Pc=-b},38:function(b){Qc=b},32:function(b){ej=b?dl:function(){}},46:function(b){b||da(Yd,zb.shift,C.slice(0))},16:function(b){zb.shift=b},17:function(b){zb.control=b},27:function(b){zb.esc=b},13:function(b){b&&!p.editor&&("displaynone"==bh.className?(bh.className="displayblock",ch.focus(),
Kb.blocked=13):(dh(),bh.className="displaynone",Kb.blocked=null))},19:function(b){b||p.online||yb(1)},48:function(b){b&&zb.control&&(fa=1,Zf({deltaY:0}))},176:function(b){b&&(p.deltaTime+=3E4)},65:ua,66:ua,67:ua,68:ua,69:ua,70:ua,71:ua,72:ua,73:ua,74:ua,75:ua,76:ua,77:ua,78:ua,79:ua,80:ua,81:ua,82:ua,83:ua,84:ua,85:ua,86:ua,87:ua,88:ua,89:ua,90:ua,219:function(b){b&&mj(-1)},221:function(b){b&&mj(1)}},ol={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",
79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};Kb.blocked=null;(function(){for(var b=[65,37,40,83,39,68,38,87],c=b.length=0,e=b.length;c<e;c+=2)Kb[b[c]]=Kb[b[c+1]]})();window.addEventListener("beforeunload",function(b){return null});document.oncontextmenu=function(){return!1};var Yb=document.getElementById("attackmenu"),Rc=document.getElementById("defencemenu"),Sc=document.getElementById("levelmenu"),rd=document.getElementById("kingdom"),Ka=document.getElementById("progressone"),
Hf=document.getElementById("unitname"),wc=document.getElementById("progressvalue");document.getElementById("selectedobject");var Yd=function(b,c){if(c.length){b=b||p.editor?c.length:1;for(var g=0;g<b;g++)z[c[g]].die()}},Ba=function(g,c){g.sound&&!c&&(c=g.sound,za(c[~~(c.length*Math.random())]));Sc.style.display="none";Zd.style.display="none";rd.style.display="block";Ka.style.display="block";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";Rc.style.display=
"none";Hf.innerHTML=g.name;$d(g);rd.innerHTML=H[g.kingdom].name;g.attack?(Yb.style.display="block",Yb.innerHTML=g.attack):Yb.style.display="none";c=g.health;var e=g.maxHealth;Infinity==c?(Ka.value=100,Ka.max=100,wc.innerHTML=c):Ka.value=c;Infinity==e&&Infinity!=c?(Ka.max=100,Ka.value=1):Infinity!==e&&(Ka.max=e);g.inventory&&g.inventory.length&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=g.inventory.length);wc.innerHTML=~~c+"/"+e;if(!mc(g,A))return na([]);
g.point&&(c=g.point,bb.x32=c[0],bb.y32=c[1],ObjectsetupPosition(bb,96*(Aa-1)),bb.show=1);if(!1===g.built)na([b.stopBuilding]),$d(g);else if(g.techStart)na([b.stopTech]),$d(g),manamenu.style.display="block",manamenu.style.backgroundPosition="0px -200px",manamenu.innerHTML=100-~~(100*(g.c-p.cycle)/g.techStart)+"%",Ba.intv&&clearInterval(Ba.intv),Ba.intv=setInterval(function(){C[0]==g.id?manamenu.innerHTML=100-~~(100*(g.c-p.cycle)/g.techStart)+"%":clearInterval(Ba.intv)},400);else{mk();if(g.working){e=
g.work;var d=X.page*X.length;c=0;for(var f=X.length;c<f;c++){var k=e[c+d];La[c].innerHTML=k?k:""}manamenu.style.display="block";manamenu.style.backgroundPosition="0px -200px";var l=1E3*t[g.waitlist[0]].time;c=~~(100*(p.now()-g.timestamp)/l);100<c&&(c=100);manamenu.innerHTML=c+"%";Ba.intv&&clearInterval(Ba.intv);Ba.intv=setInterval(function(){if(C[0]==g.id&&g.working){var c=~~(100*(p.now()-g.timestamp)/l);100<c&&(c=100);manamenu.innerHTML=c+"%"}else clearInterval(Ba.intv)},400)}else for(c=0,e=X.length;c<
e;La[c++].innerHTML="");na(g.icons,g)}};Ba.intv=!1;var ae=function(){Yb.style.display="none";Rc.style.display="none";Sc.style.display="none";Ka.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";Hf.innerHTML="";Yb.innerHTML="";Rc.innerHTML="";manamenu.innerHTML="";Sc.innerHTML="";rd.innerHTML="";wc.innerHTML="";Ka.value="";wc.maxLength="";Zd.style.display="none";If();nj()},T,ib,Zb,Zf,nc={},Gg=function(b,c,e,d){var g=e||z[C[0]],k=d?H[g.kingdom]:
ob;if("peon"==(e?g.clss:Zb))var l=!0;if(p.editor)return[hb,h];var h=b+c*D;if(!d&&T!=hb)return[T,h];b=U[h];c=0;if(!g)return[c,h];if(2<b||(b=Tc[h])&&2<b){var m=z[b];m.invisible||(l&&m.storage&&g.stock?c=Rg:l&&void 0!=m.res?c=Sd:l&&m.health<m.maxHealth&&!k.diplomacy[m.kingdom]&&m.build&&!m.dummy||m.dummy&&!m.built?c=md:k.diplomacy[m.kingdom]||m.dummy&&k.values.experience||m.confused?c=Ec:1===m.invType&&!g.build&&!g.boat&&0<m.invMax&&mc(g,m)&&(c=Pd))}else b=ra[h],2<b&&!g.build&&!g.boat&&(m=z[b],m.item?
c=kd:m.field&&l?c=Re:1===m.invType&&!g.build&&!g.boat&&0<m.invMax&&mc(g,m)&&(c=Pd));0===c&&(g=Cb[g.kingdom],g[h]&&l?(b=g[h],c=md):(m||(b=-h),c=Hb,Hb.cursor=2));return[c,b]},C=[];C.change=1;var oj,gl=document.getElementById("gold"),hl=document.getElementById("wood"),il=document.getElementById("food"),jl=document.getElementById("stone"),ja,eh;var fh=!1;var Vb=function(b,c){var g=fa,d=tzar.width,f=tzar.height;b=b*g-vb+.5*(d-g*d);c=c*g-Wa+.5*(f-g*f);return[b,c]},sb=function(b){if(b){var c=b.pageX;b=b.pageY;
sb.lastX=c;sb.lastY=b}else c=sb.lastX,b=sb.lastY;c=Vb(c-A.mx,b);b=c[1];c=c[0];0==fh?(window.removeEventListener("mousemove",sb),eh=!1):eh=!0;if(1===ja[2]||sb.forced)b=32*~~(b/32),c=32*~~(c/32);ja[4]=b;ja[6]=c;ja[9]=c;ja[10]=b},pj=function(b,c){c=z[c];U[b[0]+b[1]*D]==c.id?(c.point=void 0,C[0]==c.id&&(bb.x32=2*D,ObjectsetupPosition(bb,128*D),bb.show=0)):(c.point=b,bb.x32=b[0],bb.y32=b[1],C[0]==c.id&&(ObjectsetupPosition(bb,96*(Aa-1)),bb.show=1))},qj=function(b){if(null==Kb.blocked||Kb.blocked==b.keyCode){var c=
Kb[b.keyCode];c&&c(1,b.keyCode)}},rj=function(b){if(null==Kb.blocked||Kb.blocked==b.keyCode){var c=Kb[b.keyCode];c&&c(0,b.keyCode)}},sj=function(b){var c=window.innerWidth,g=window.innerHeight,d=b.pageX,f=b.pageY;if(screen.height-10<=g){if(1.2==Math.abs(Pc)||0==Pc)Pc=1.2*((10>d)-(d>c-10));if(1.2==Math.abs(Qc)||0==Qc)Qc=1.2*((10>f)-(f>g-10))}d=Vb(d-A.mx,f);f=~~(.03125*d[1]);d=~~(.03125*d[0]);b.pageX<A.mx?vc(2):(b=Gg(d,f)[0],0==b||void 0==b.cursor?vc(2):vc(b.cursor))},tj=function(b){if(!zd)if(b.pageX>
A.menumx){if(0==b.button){window.addEventListener("mousemove",sb);b=Vb(b.pageX-A.mx,b.pageY);var c=b[1];b=b[0];void 0!=N.wall&&(b=N.wall,c=32*~~(b/D),b=b%D*32,sb.forced=!0,N.wall=void 0);fh=!0;ja[0]=b;ja[1]=c;ja[9]=ja[0];ja[10]=ja[1];ja[3]=ja[0];ja[7]=ja[1];Jf=!1}}else Jf=!0},Jf=!1,ql=function(b){if(b.pageX>A.menumx&&b.pageY>A.menumy&&!ed&&0==Jf){fh=!1;var c=Vb(b.pageX-A.mx,b.pageY),g=~~(c[1]/32);c=~~(c[0]/32);O(c,g);var d=Aa;if(2==b.button&&!p.editor){if(T!=hb){T=hb;return}if(0<C.length)if(d=z[C[0]],
1!=d.build||d.arrow){if(0===T){T=hb;return}d=Gg(c,g);b=d[1];d=d[0];d==Hb&&(c={x32:c,y32:g,d:0,mv:1,img:m.cursor},tb(c),Ib.new(c,Ja(c.img)));da(d,b,C)}else da(pj,[c,g],C[0]);return!1}if(0==b.button){if(T==hb)return hb();b=c+g*d;if(T.spLevel)b=T.spLevel(b);else{var f=0;2<Tc[b]?f=Tc[b]:2<U[b]?f=U[b]:2<ra[b]&&(f=ra[b]);b=f}if(b)T.allowPos&&z[b].build&&(b=-(c+g*d));else if(T.allowPos||T.noObj)b=-(c+g*d);else return T=hb;T.noObj&&3<=b&&(b=-(c+g*d));T.item?(da(T,b,[C[0],T.item]),T.item=void 0):da(T,b,C);
zb.shift||(T=hb)}}Jf=!1},uj=function(b){zd||(ql(b),ja[0]=NaN,ja[1]=NaN,ja[9]=NaN,ja[10]=NaN,ja[3]=NaN,ja[7]=NaN,h.bindBuffer(h.ARRAY_BUFFER,qc),h.bufferSubData(h.ARRAY_BUFFER,0,ja),pb.actived&&pb(),ed&&(ed=!1))},hh=function(b){b=z[b];b.tempChild.quit(b.selectAnim);Eb(b.selectAnim);gh(b.selectAnim);b.selectAnim=void 0},hb=function(){for(var b=0,c=C.length;b<c;hh(C[b++]));Xd.actived&&(w(Xd.actived).style.display="none");ib&&(hh(ib.id),ib=void 0);C.length=0;Zb=-1;nc={};Zd.style.display="none";yf.innerHTML=
"";zf.innerHTML="";Af.innerHTML="";Bf.innerHTML="";Cf.innerHTML="";Df.innerHTML="";Ef.innerHTML="";Ff.innerHTML="";Yb.className="";X.page=0;bb.show&&(bb.x32=2*D,ObjectsetupPosition(bb,128*D),bb.show=0);var e=D,d=ja[0],f=ja[1];b=ja[9];var k=ja[10];if(0===f-k&&0===d-b){k=~~(d/32);var l=~~(f/32),h=f,m=d,n=0;for(b=0;3>b;b++){c=Ra[b];var u=k,t=l;d=m;f=h;2<c[u+t*e]?(d=u,f=t,n=z[c[d+f*e]]):(.5<=f/32-t?t++:t--,2<c[u+t*e]?(d=u,f=t,n=z[c[d+f*e]]):(.5<=d/32-u?u++:u--,2<c[u+t*e]?(d=u,f=t,n=z[c[d+f*e]]):(t=~~(f/
32),2<c[u+t*e]&&(d=u,f=t,n=z[c[d+f*e]]))))}n.id||(n=Cb[A.kingdom][k+l*e])&&(n=z[n]);if(n&&2<n.id&&(!n.invisible||mc(n,A)))if(nc[n.id]=1,C.length=0,n.setupChild(Jb.select,1,xe),mc(n,A)&&!p.demo){C[0]=n.id;Zb=null!=n.defence?n.clss:-2;if(256>Date.now()-oj){if(p.editor){rl(z[C[0]]);return}if(!n.build)for(e=~~(fa*tzar.width*.03125),d=~~(fa*tzar.height*.03125),k=~~(.03125*-vb+.5*(~~(.03125*tzar.width)-e)),h=~~(.03125*-Wa+.5*(~~(.03125*tzar.height)-d)),d*=e,k+=h*D,b=0;b<d;b++)for(f=k+b%e+~~(b/e)*D,l=0;3>
l;l++)h=Ra[l][f],2<h&&(m=z[h],m.clss!=n.clss||nc[h]||!mc(m,n)||m.item||(m.setupChild(Jb.select,1,xe),nc[h]=1,C.put(h)))}oj=Date.now();if(n.build)return Ba(n)}else return ib=n,Oc(n.id),!1}else if(!p.demo)for(d=~~(d/32),b=~~(b/32),f=~~(f/32),k=~~(k/32),d>=b&&(n=d,d=b,b=n),f>=k&&(n=f,f=k,k=n),b++,n=[1,1,1],m=b-d,b=0,c=m*(k-f+1);b<c;b++)for(k=b%m+d,h=~~(b/m)+f,l=0;3>l;l++)u=Ra[l][k+h*e],t=z[u],t.selected=1,n[u]||(n[u]=1,t.build||!mc(t,A)||t.item||(C[C.length]=u,t.setupChild(Jb.select,1,xe),nc[u]=1));
1<C.length?ih(C):1==C.length?Oc(C[0]):(na([]),ae(),Zb=-1,C.length=0)},vj=[manamenu,manamenu1],wj={mana:{background:"0px -120px",progress:progressmana},food:{background:"0px -240px"},milk:{background:"0px -280px"},gold:{background:"0px -260px"},stone:{background:"0px -320px"},wood:{background:"0px -340px"}},nl=["https://i.imgur.com/toj2Nv3.gif","https://i.imgur.com/TwImKWn.gif","https://i.imgur.com/wFIu276.gif","https://i.imgur.com/kIWwIhG.gif","https://i.imgur.com/JBGA2KM.gif"],Zd=document.getElementById("unitSpeed"),
Oc=function(b,c,e){manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";b=z[b];b.sound&&!e&&(e=b.sound,za(e[~~(e.length*Math.random())]));Zb=b.clss;b.inventory&&b.inventory.length&&mc(b,A)&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=b.inventory.length);c||(mc(b,A)&&!p.demo?na(b.icons,b):If());rd.style.display="block";Hf.innerHTML=b.name;b.attack&&b.item||void 0!==b.attack?(Yb.innerHTML=b.attack,Yb.style.display=
"block"):Yb.style.display="none";b.defence&&b.item||void 0!==b.defence?(Rc.innerHTML=b.defence,Rc.style.display="block"):Rc.style.display="none";b.mana&&!b.manaTarget&&(manamenu.style.display="block",manamenu.innerHTML=b.mana,manamenu.style.backgroundPosition="0px -120px");c=0;var d=b.update;if(d){c=0;for(var g=d.length;c<g;c+=3){var k=d[c],l=wj[k];e=vj[c/3];e.innerHTML=b[k];e.style.display="block";e.style.backgroundPosition=l.background;"mana"==k&&b.manaTarget&&(e.innerHTML=~~(100*b.mana/b.manaTarget+
.5)+"%",e.style.backgroundPosition="0px -200px");l.progress&&(l.progress.style.display="block",l.progress.value=b[k],l.progress.max=b[k+"Max"])}}b.stock&&(d=b.stock,e=vj[c/3],e.style.display="block",e.style.backgroundPosition=wj[d[4].icon].background,e.innerHTML=d[0]);c=b.level?b.level:0;Sc.innerHTML=c;Sc.style.display="block";0===c&&(b.item||b.build)&&(Sc.style.display="none");rd.innerHTML=H[b.kingdom].name;Ka.style.display="block";xj(b);$d(b)},xj=function(b){var c=b.health;b=b.maxHealth;Infinity==
c?(Ka.value=100,Ka.max=100,wc.innerHTML=c):(Ka.value=c,Infinity==b?(Ka.max=100,Ka.value=1):Ka.max=b,wc.innerHTML=~~c+"/"+b)},ih=function(b,c){for(var g=z[b[0]],d=0,f=0,k=g.clss,l=b.length,h={},m=[],n=0;n<l;n++){g=z[b[n]];d+=g.maxHealth;f+=g.health;Zb=k!=g.clss?-1:!0;for(var u=g.icons,p=u.length,v=0;v<p;v++){var t=u[v].id;void 0===h[t]?h[t]=1:h[t]++;h[t]===l&&m.put(u[v])}}!0===Zb&&(Zb=g.clss);f=Infinity==f?100:~~(f/d*100);wc.innerHTML=f+"/100(%)";yj();Hf.innerHTML="";Yb.style.display="none";Rc.style.display=
"none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";Sc.style.display="none";rd.innerHTML=l+" "+y.units;Ka.style.display="block";Ka.value=f;Ka.max=100;c||(!0!==Zb?na(m):na(g.icons))},Jh=function(){};new Float32Array(8);var jb,cd,qc,Bd,xd,fa=1,zj={1:2560,101001:2048,101E3:2048,1001:2048,1E3:2048,100:1536,10010100:1280,10100:1280,1001E4:1280,1E4:1280,10010010:256,10010110:256,10110:256,10111:256,10010111:256,110:512,111:512,11:512,10:512,111E5:2816,11E5:2816,
11E6:2816,1E6:2816,1101E4:768,11110100:768,11010100:768,1111E4:768,1E7:3360,1E5:3072,1101E3:1792,1101001:1792,11101E3:1792,11101001:1792,101111:0,1011:0,1111:0,101011:0},sl=function(b){Eb(b);Wb.put(b.bufferID)},Ib={table:{},dates:[],new:function(b,c,e){c=Math.floor(c)+p.now();var d=this.table;e||(e=sl);d[c]||(d[c]=[]);b.animFunc=e;d[c].put(b);this.dates.add(c);this.needOrder=!0}},Ja=function(b){b=ta[b];return 0>b[1]?m.delay[b[0]-b[1]-1]:b[0]/b[1]*1E3},cb=new Float32Array(12),Fg=function(b){var c=
b.id+p.arje+b.x32+b.y32;b.rnd=[4294967295+c,4294967295-c,0]},jh=function(b){b=z[b];b.mlist&&Aj(b,!0);b.hlist&&Aj(b,!1)},Aj=function(b,c){if(c)var g=b.mlist,d=b.mlistID,f=sd.mercenaries;else g=b.hlist,d=b.hlistID,f=sd.heroes;g.unshift(f[zi(b,f.length)]);c?d.unshift(b.mercID++):d.unshift(b.heroID++);8<g.length&&(g.length=8,d.length=8);X.active==g&&na(g);xb(b,5E4)},kh=function(g){g=z[g];var c=H[g.kingdom],e=16+4*c.crusade.number;c.crusade.number++;32<e&&(e=32);var d=c.crusade.list;d.length=e;for(var f=
0;f<e;f++)(d[f]=Jc(8,g,1)).deleteFromList=d;za("crusade",g.x32,g.y32);c.technology.disabled[b.createCrusaders.id]=1;aa(g.id)},el=function(g){H[g.kingdom].technology.disabled[b.createCrusaders.id]=0},dd,U=[],ra=[],Tc=[],Ra=[];Ra.length=3;var If=function(){for(var b=X.displayed.length=0,c=X.length;b<c;b++){var e=La[b];e.className="blocked";e.style.backgroundPosition="48px 96px";xf[b]=lh}X.rightButton.className="blocked";X.leftButton.className="blocked";X.stock.className="blocked";X.rightBlocked=1};
X.leftButton.onclick=function(){X.page&&(X.page--,na(X.active,0,X.stockActive))};X.rightButton.onclick=function(){X.rightBlocked||(X.page++,na(X.active,0,X.stockActive))};X.displayed=[];var na=function(b,c,e){e=!!e;c||(c=NaN);var d=b.olegal||NaN;if(c.working&&!e)var g=1;X.active=b;X.displayed.length=0;var k=ob.technology,l=X.page,h=X.length;If();!1!==e&&c?X.stockActive=c:!1===e&&(X.stockActive=!1);na.actv={};b.length<=l*h&&b.length&&(X.page--,l--);for(var m=0,n=0,u;m<h;m++){u=b[m+l*h];if(!u)break;
var p=La[n];if(!e&&(na.actv[u.id]=1,k.hidden[u.id]||u.obj.tech&&g)){h++;continue}p.style.backgroundPosition=48*e+"px "+(-e||1)*u.iconID*48+"px";e||!k.disabled[u.id]||d[u.id]?(p.className="",xf[n]=u):p.className="blocked";X.displayed[n]=u;n++}b[m+l*h]&&(X.rightButton.className="",X.rightBlocked=0);0<l&&(X.leftButton.className="");1===C.length&&(c=z[C[0]]);c.inventory&&0<c.inventory.length&&(X.stock.className="")};na.actv={};var Ih,ea,wa,$f;var h=w("tzar").getContext("webgl2",{antialias:!0,alpha:!1});
A.gl=!!h;if(h){var tl=h.getExtension("WEBGL_lose_context");h.canvas.addEventListener("webglcontextlost",function(b){setTimeout(function(){tl.restoreContext()},2E3);b.preventDefault()},!1);h.canvas.addEventListener("webglcontextrestored",function(b){O("restored 2")},!1)}var Hh,ag,bg,Lh,ue,Wf,Vf,te,ve,yd,wd,bd,Xf,Yf,eb=function(){if(p.canceled)return 0;requestAnimationFrame(eb);var b=eb.fp1000,c=eb.delta,e=eb.now,d=eb.frameCount;performance.now();var f=e;eb.frameCount++;e=p.now();eb.now=e;c=(c+(e-f))/
1E3;eb.delta=c;if(!(d%8||p.editor)){d=p.now()/1E3;f=~~(d/60)%60;var k=~~(d/3600);d=~~(d%60);w("topinfo").innerHTML=~~(1/c)+"FPS "+k+":"+f+":"+d}eb.fp1000=b+c;b=Ib.table;d=Ib.dates;Ib.needOrder&&(d.sort(function(c,b){return c-b}),Ib.needOrder=0);for(f=0;d[f]<=e+17;f++){k=b[d[f]];for(var l=0,m=k.length;l<m;l++){var r=k[l];r.animFunc(r)}delete b[d[f]];f--;d.shift()}if(0!=Pc||0!=Qc)vb+=Pc*c*640*fa,Wa+=Qc*c*640*fa,Ad(-vb,-Wa),sb();ej(e);Jh();h.uniform1f(Hh,e);h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT);
if(b=Da.length)h.bindFramebuffer(h.FRAMEBUFFER,fb),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,Lh),c=Da,c.changed&&(c.typed=new Uint32Array(c),c.changed=!1,h.bufferData(h.ELEMENT_ARRAY_BUFFER,c.typed,h.STATIC_DRAW)),h.enable(h.BLEND),h.blendEquation(h.MAX),h.blendFunc(h.SRC_COLOR,h.SRC_COLOR),h.bindTexture(h.TEXTURE_2D,$f),h.drawElements(h.TRIANGLES,b,h.UNSIGNED_INT,0),h.bindTexture(h.TEXTURE_2D,Lighttexture),h.disable(h.BLEND),h.bindFramebuffer(h.FRAMEBUFFER,null);Bj(ag);d=window.innerWidth;f=window.innerHeight;
h.viewport(A.marx,f-Xa-A.mary,Pb,Xa);h.uniform2f(ue,32*D,32*Aa);h.uniform2fv(yd,[0,0]);h.uniform1i(ve,1);h.uniform1f(dd,1);Bj(ag);h.viewport(A.mx,0,d,f);performance.now();h.useProgram(wa);h.bindVertexArray(Xf);h.uniform1f(Wf,~~((.01*e+.5)%5));h.drawArrays(h.TRIANGLES,0,6);h.viewport(A.marx,f-Xa-A.mary,Pb,Xa);h.uniform1i(te,1);h.uniform2fv(wd,[0,0]);h.uniform1f(bd,Pb/32/D);h.drawArrays(h.TRIANGLES,0,6);h.uniform1i(te,0);h.uniform2f(Vf,d,f);h.uniform2fv(wd,[vb,Wa]);h.uniform1f(bd,1/fa);h.viewport(A.mx,
0,d,f);h.useProgram(ea);h.bindVertexArray(Yf);if(b=ma.length)h.enable(h.BLEND),h.blendEquation(h.FUNC_ADD),h.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA),h.bindBuffer(h.ARRAY_BUFFER,qc),d=tzar.width,f=tzar.height,e=-vb+.5*(d-fa*d),c=-Wa+.5*(f-fa*f),k=fa*(d-A.mx),l=fa*f,h.bufferSubData(h.ARRAY_BUFFER,0,new Float32Array([e,c,24576,e+k,c,24576,e,c+l,24576,e+k,c+l,24576])),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,bg),c=ma,c.changed&&(c.typed=new Uint32Array(c),c.changed=!1,h.bufferData(h.ELEMENT_ARRAY_BUFFER,
c.typed,h.STATIC_DRAW)),h.viewport(A.marx,f-Xa-A.mary,Pb,Xa),h.drawElements(h.TRIANGLES,12,h.UNSIGNED_INT,0),h.uniform1i(ve,0),h.uniform2f(ue,d,f),h.uniform2fv(yd,[vb,Wa]),h.uniform1f(dd,1/fa),h.viewport(A.mx,0,d,f),h.bindBuffer(h.ARRAY_BUFFER,qc),eh&&!mh?h.bufferSubData(h.ARRAY_BUFFER,0,ja):h.bufferSubData(h.ARRAY_BUFFER,0,new Float32Array([NaN,NaN,24576,NaN,4347,24576,5551,NaN,24576,NaN,NaN,24576])),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,bg),c=ma,c.changed&&(c.typed=new Uint32Array(c),c.changed=!1,
h.bufferData(h.ELEMENT_ARRAY_BUFFER,c.typed,h.STATIC_DRAW)),h.drawElements(h.TRIANGLES,b,h.UNSIGNED_INT,0),h.disable(h.BLEND);N.active&&(e=N.x,c=N.y,b=96*D,N.wh?(d=N.wh[0]-ta[N.img][8],f=N.wh[1]-ta[N.img][9]):f=d=0,nh(e,c,b,d,f,N.bufferID),N.active=!1);yc.update&&yc(1)},Bj=function(b){var c=oa.length;c&&(h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,b),b=oa,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,h.bufferData(h.ELEMENT_ARRAY_BUFFER,b.typed,h.STATIC_DRAW)),h.drawElements(h.TRIANGLES,c,h.UNSIGNED_INT,
0))},$c=!1,pa=function(b,c){return b<D&&0<=b&&0<=c&&c<Aa?!0:!1};Array.prototype.put=function(b){this[this.length]=b};var lh=function(){},Jb,be,Ub,oh,Uc=function(b,c,e,d){d&&0==Uc.cols[d]&&(Uc.list.push(d,b),Uc.cols[d]=1)};Uc.cols={};Uc.list=[];var P=function(b){for(var c=Object.keys(b),g=0;g<c.length;g++)b[b[c[g]]]=c[g];return b};window.onerror=Uc;var p={},ta=[],vl=function(b,c,e,d){for(var g=0,k=Object.keys(b),l=0,h=k.length;l<h;l++){var m=k[l],n=b[m];if(Array.isArray(n)){b[m]=g;n.url=g;m=ta[g++]=
n;var u=n.deltaY?n.deltaY:0;m.id=d/4;for(var p=6,v=m.length;p<v;p+=6){var t=m[p-2],w=m[p-1],x=m[p+2],y=m[p+3];c[d++]=m[p]/e;c[d++]=(u+m[p+1])/e;c[d++]=t;c[d++]=w;c[d++]=(m[p]+x)/e;c[d++]=(m[p+1]+u)/e;c[d++]=t+x;c[d++]=w;c[d++]=m[p]/e;c[d++]=(m[p+1]+y+u)/e;c[d++]=t;c[d++]=w+y;c[d++]=(m[p]+x)/e;c[d++]=(m[p+1]+y+u)/e;c[d++]=t+x;c[d++]=w+y}}else for(var A=Object.keys(n),z=0,B=A.length;z<B;z++)for(m=n[A[z]],m.id=d/4,m.url=g,n[A[z]]=g,ta[g++]=m,u=m.deltaY?m.deltaY:0,p=6,v=m.length;p<v;p+=6)t=m[p-2],w=m[p-
1],x=m[p+2],y=m[p+3],c[d++]=m[p]/e,c[d++]=(u+m[p+1])/e,c[d++]=t,c[d++]=w,c[d++]=(m[p]+x)/e,c[d++]=(m[p+1]+u)/e,c[d++]=t+x,c[d++]=w,c[d++]=m[p]/e,c[d++]=(m[p+1]+y+u)/e,c[d++]=t,c[d++]=w+y,c[d++]=(m[p]+x)/e,c[d++]=(m[p+1]+y+u)/e,c[d++]=t+x,c[d++]=w+y}return d},V=function(b,c,e,d){var g=0,k=e.length-1,l=e[k];d=Cb[d];var h=[],m=0,n=!0;pa(b,c)&&pa(b+l-1,c+k/l-1)||(n=!1);for(var u=D,p=0;p<k;p++){g==l&&(g=0,c++);if(e[p]){var v=b+g+u*c;d[v]&&(n=!1);if(0<U[v]||Xb[v])n=!1;h[m++]=v}g++}return[h,n]};V.check=
function(b,c,e,d,f,k,l){var g=e.length-1;e=e[g];var h=g/e;g=D;l=Cb[l];e+=2;--b;--c;h=e*(h+2);for(var m=0;m<h;m++){var u=b+m%e,p=c+~~(m/e),v=u+p*g;if(0<U[v]||Xb[v]||k&&(u>=f&&u<=f+2||p>=d&&p<=d+2)||!pa(u,p)||l[v])return!1}return!0};var Cj=function(b,c,e){var d=0,g=e.length-1,k=e[g],l=[],h=[],m=0,n=!0;pa(b,c)&&pa(b+k-1,c+g/k-1)||(n=!1);for(var u=0,p=0;p<g;p++){d==k&&(d=0,c++);var v=b+d+D*c;e[p]?(2<U[v]&&(n=!1),l[m++]=v):(h[u++]=v,2<U[v]&&(n=!1));d++}return[l,n,h]},Dj=function(b,c,e){var d=0,g=e.length-
1,k=e[g],l=[],h=0,m=!0;pa(b,c)&&pa(b+k-1,c+g/k-1)||(m=!1);for(var n=0;n<g;n++){d==k&&(d=0,c++);var u=b+d+c*D;if(e[n]&&2<U[u]&&1==z[U[u]].build||0<ra[u])m=!1;l[h++]=u;d++}return[l,m]},Kf=function(b,c,e){var d=!1,g=0,k=[],l=0,h=e.length-1,m=e[h],n=0,u=!0;pa(b,c)&&pa(b+m-1,c+h/m-1)||(u=!1);for(var p=0;p<h;p++){n==m&&(n=0,c++);if(e[p]){var v=b+n+D*c,t=U[v];2<t&&(u=!1);0<t?g++:d=!0;k[l++]=v}n++}g>.5*(h-1)&&d||(u=!1);return[k,u]},ce=function(b,c,e){e=!0;pa(b,c)||(e=!1);1!==ra[b+c*D]&&(e=!1);return[[b+c*
D],e]},Q=function(b,c,e){e=!0;pa(b,c)||(e=!1);0<U[b+c*D]&&(e=!1);return[[b+c*D],e]},Lf=function(b,c,e){e=!0;pa(b,c)||(e=!1);0<Tc[b+c*D]&&(e=!1);return[[b+c*D],e]},Lb=function(b,c,e){e=!0;pa(b,c)||(e=!1);if(0<ra[b+c*D]||2==U[b+c*D]||1==U[b+c*D])e=!1;return[[b+c*D],e]},wl=function(b){for(var c=Object.keys(b),g=R.common.length/1048576,d=0,f=c.length;d<f;d++)b[c[d]].deltaY=512*g},N,B,Ua,ub,qk=function(){N={img:0,x32:-1E3,y32:-1E3,rgb:[0,0,0,.5],d:0,active:!1};var g=8,c=9;if(!$c){xl();var e=[b.move,b.attack,
b.guard,b.patrol,b.pickUp,b.explore,b.stop,b.stand,b.sameSpeed,b.restoreSpeed];be={magic_creatures:[58,40,59,5,78,77,60,130,131,132,89,129]};for(var d=Object.keys(be),f=0,k=d.length;f<k;f++){var l=be[d[f]],h={};l.obj=h;for(var r=0,n=l.length;r<n;h[l[r++]]=1);}sd.mercenaries=[b.mercArcher,b.mercFootman,b.mercMaceman,b.mercLongbowman,b.mercPikeman,b.mercKnight,b.mercArcherAsian,b.mercSamurai,b.mercHourseSamurai,b.mercRonin,b.mercHorseArcher,b.mercChariot,b.mercFootmanArab,b.mercArcherArab,b.mercMacemanArab,
b.mercPikemanArab,b.mercCavalry,b.mercEnichar,b.mercJihad];sd.heroes=[b.mercArcher6,b.mercFootman6,b.mercMaceman6,b.mercLongbowman6,b.mercPikeman6,b.mercKnight6,b.mercArcherAsian6,b.mercSamurai6,b.mercHourseSamurai6,b.mercRonin6,b.mercHorseArcher6,b.mercChariot6,b.mercFootmanArab6,b.mercArcherArab6,b.mercMacemanArab6,b.mercPikemanArab6,b.mercCavalry6,b.mercEnichar6,b.mercJihad6];d=sd.mercenaries;f=0;for(k=d.length;f<k;d[f++].merc=9);d=sd.heroes;f=0;for(k=d.length;f<k;d[f++].hero=1);n=m;n.build2x2[2]=
1;n.build3x3[2]=1;n.build4x4[2]=1;n.build5x5[2]=1;n.build6x6[2]=1;n.items1[2]=1;n.build_harbor[2]=1;n.bridge_horz_build[2]=1;n.bridge_vert_build[2]=1;n.sexplosion[0]=13;n.sexplosion[1]=25;n.flame_trail[0]=16;n.flame_trail[1]=25;f=0;for(l=n.flame_trail.length;f<l;f+=6)n.flame_trail[4+f]-=32,n.flame_trail[5+f]-=32;f=0;for(l=n.sexplosion.length;f<l;f+=6)n.sexplosion[4+f]-=48,n.sexplosion[5+f]-=48;n.items1[1]=0;n.books[1]=0;n.potions[1]=0;n.troll.attack[1]=14;n.ork.attack[1]=14;n.dwarf.attack[1]=14;n.asian_mage.move[1]=
14;n.arab_priest.attack=n.arab_priest.spell;n.asian_mage.spell=n.asian_mage.castspell;n.asian_mage.attack=n.asian_mage.castspell;n.asian_mage.spell[1]=13;n.arab_horse_archer.move=n.arab_horse.archer;n.arab_jwarrior.attack[1]=14;n.arab_peasant.attack=n.arab_peasant.attack1;n.arab_peasant.tree=n.arab_peasant.wood;n.asian_peasant.attack=n.asian_peasant.attack1;n.asian_peasant.cut=n.asian_peasant.chop;n.asian_peasant.tree=n.asian_peasant.wood;n.asian_peasant.dig[1]=14;n.asian_archer.die[1]=14;n.asian_ronin.attack=
n.asian_ronin.attack1;f=0;for(l=n.turn_to_stone.length;f<l;f+=6)n.turn_to_stone[4+f]-=56,n.turn_to_stone[5+f]-=64;n.arab_tcguild_c[4]=31;n.arab_tcguild_c[5]=85;n.dragon.idle=n.dragon.move;n.asian_samurai.attack=n.asian_samurai.attack1;n.asian_horsamurai.idle=n.asian_horsamurai.idle1;n.asian_horsarcher.idle=n.asian_horsarcher.idle2;n.asian_priest.attack=n.asian_priest.attack1;n.asian_priest.spell=n.asian_priest.pray;n.asian_monk.attack[1]=12;n.euro_mage.attack=n.euro_mage.spell;n.euro_ghost.idle=n.euro_ghost.move;
n.euro_priest.attack=n.euro_priest.spell;n.arab_mage.spell=n.arab_mage.attack;n.cursor[1]=15;n.star[1]=15;n.select[4]+=3;n.select[5]+=3;n.arab_houses_c[g]=96;n.asia_houses_c[g]=96;n.asia_houses_c[4]-=9;n.asia_houses_c[5]-=15;n.wood_build[2]=1;n.res_gold[2]=1;n.res_gold_s[2]=1;n.res_stone[2]=1;n.res_stone_s[2]=1;n.bridge_horz1[4]=-9;n.bridge_horz1[5]=132;n.bridge_horz1[4]=-9;n.bridge_horz1[5]=132;n.euro_stable_c[4]+=18;n.euro_stable_c[5]-=10;n.euro_lumbermill_s[4]-=19;n.euro_lumbermill_s[5]-=17;n.wood_tower_c[4]=
0;n.wood_tower_c[5]*=1;n.bat.idle=n.bat.move;f=0;for(l=n.curse.length;f<l;f+=6)n.curse[5+f]-=48;f=0;for(l=n.impersonate.length;f<l;f+=6)n.impersonate[5+f]-=48;f=0;for(l=n.bless.length;f<l;f+=6)n.bless[5+f]-=48;f=0;for(l=n.euro_barracks_c.length;f<l;f+=6)n.euro_barracks_c[4+f]+=50;f=0;for(l=n.healing.length;f<l;f+=6)n.healing[5+f]-=48;f=0;for(l=n.expl_small_hole.length;f<l;f+=6)n.expl_small_hole[4+f]-=4,n.expl_small_hole[5+f]-=34;Date.now();d=[b.createKnight,b.createHorseArcher1,b.createHorseArcher2,
b.createHorseSamurai,b.createChariot,b.createEnichar,b.createCavalry]}if(eg){eg=!1;O("TErrain changed");f=0;for(k=R.xtra.length;f<k;f++){n=R.xtraRes[f].coords;wl(n);n.terrain_water[g]=512;n.terrain_water[c]=512;n.terrain_water[6]+=32;n.terrain_water[7]+=32;r=0;for(l=n.terrain_tree.length;r<l;r+=6)n.terrain_tree[4+r]-=32,n.terrain_tree[5+r]-=96;r=0;for(l=n.terrain_tree_s.length;r<l;r+=6)n.terrain_tree_s[5+r]-=32;n.terrain_tree[2]=1;Object.assign(m,n)}g=R.size;k=new Float32Array(1048576);n=vl(m,k,g,
0);R.info=k;R.ids=n/16}if(!$c){Ub={sword:{name:"Sword",iconID:16,img:m.items1,d:0,dMax:7,attack:1,type:52,sword:1},bow:{name:"Bow",iconID:4,img:m.items1,d:15,dMax:4,attack:1,type:52,sword:1},shield:{name:"Shield",iconID:1,img:m.items1,d:8,dMax:6,defence:1,type:52,shield:1},potion:{name:"Potion",iconID:11,img:m.potions,d:0,dMax:7,type:52,potion:1},book:{name:"Book",iconID:9,img:m.books,d:0,dMax:4,type:52,book:1},gold:{name:"Gold",iconID:20,img:m.item_gold,d:0,dMax:0,type:52},stone:{name:"Stone",iconID:22,
img:m.item_stone,d:0,dMax:0,type:52},food:{name:"Food",iconID:14,img:m.item_food,d:0,dMax:0,type:52},wood:{name:"Wood",iconID:15,img:m.item_tree,d:0,dMax:0,type:52},iron:{name:"Iron",iconID:21,img:m.item_iron,d:0,dMax:0,type:52}};oh=[Ub.sword,Ub.potion,Ub.book,Ub.bow,Ub.shield];k=[b.move,b.attack,b.stop,b.stand,b.pickUp,b.explore,b.healing,b.bless];g=[b.attack,b.guard,b.patrol,b.explore,b.stop,b.stand,b.attackGround,b.steady,b.move];c=[b.buildAcademy,b.buildWorkshop,b.buildWorkshop1,b.buildAcademy1,
b.buildWorkshop2,b.buildAcademy2];f=[b.buildMerchands1,b.buildMerchands2,b.buildMerchands];ub={euro:{},asia:{},arab:{},common:{}};t=[{name:"Footman",attack:6,defence:3,health:65,maxHealth:65,img:m.euro_footman.idle,attackSound:Cc,invType:0,invMax:8,validator:Q,human:12,iconID:36,time:12,sight:5,url:m.euro_footman,icons:e,cost:[0,0,50,0],attDist:1,spd:50,dieSound:gb,clss:"footman",size:1,standardFunc:G,radix:0,zLevel:1,strID:"e_footman",race:"euro"},{name:"Pikeman",radix:0,attackSound:Cc,attack:8,
defence:4,health:75,maxHealth:75,img:m.euro_pikeman.idle,invType:0,dieSound:gb,invMax:8,validator:Q,human:1,iconID:39,time:18,sight:5,url:m.euro_pikeman,icons:e,cost:[40,0,60,0],attDist:1,spd:50,standardFunc:G,clss:"e_pikeman",zLevel:1,size:1,strID:"e_pikeman",nu:b.createPikeman,race:"euro"},{name:"Spy",radix:0,attack:20,defence:0,mana:100,manaMax:100,health:50,maxHealth:50,img:m.euro_spy.idle,attackSound:["spy%20kill%201","spy%20kill%202","spy%20kill%203"],invType:0,invMax:8,validator:Q,human:1,
dieSound:gb,iconID:41,time:30,sight:12,url:m.euro_spy,icons:[b.move,b.attack,b.guard,b.patrol,b.pickUp,b.explore,b.stop,b.stand,b.impersonate,b.revealSelf],zLevel:1,cost:[120,0,0,0],attDist:1,spd:50,clss:"spy",standardFunc:G,size:1,update:["mana","manaSpeed",1E3],isSpy:1,strID:"spy",nu:b.createSpy,race:"common"},{name:"Maceman",radix:0,attack:8,defence:0,health:120,maxHealth:120,img:m.euro_maceman.idle,attackSound:Cc,invType:0,invMax:8,validator:Q,human:1,iconID:37,time:14,dieSound:gb,sight:5,zLevel:1,
url:m.euro_maceman,icons:e,cost:[0,0,120,0],attDist:1,spd:50,clss:"maceman",standardFunc:G,size:1,strID:"e_maceman",nu:b.createMaceman,race:"euro"},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:m.euro_archer1.idle,invType:0,invMax:8,validator:Q,human:1,sight:10,dieSound:gb,arrow:!0,iconID:38,zLevel:1,time:12,url:m.euro_archer1,icons:e,cost:[0,20,40,0],attDist:7,spd:50,clss:"archer",standardFunc:G,attimg:m.arrow1,attackSound:Ed,size:1,strID:"e_archer",nu:b.createArcher,race:"euro"},
{radix:0,name:"Wizard",attackSound:Ik,dieSound:["mage"],attack:5,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:m.euro_mage.idle,zLevel:1,invType:0,invMax:8,validator:Q,human:1,iconID:42,time:30,sight:15,url:m.euro_mage,icons:[b.stop,b.pickUp,b.explore,b.lightning,b.createBat,b.freeze,b.createGolem,b.invisibility,b.stand,b.attack,b.move],cost:[150,0,0,0],attDist:10,attimg:m.flame_bolt,ball:1,spd:50,clss:"mage",standardFunc:G,size:1,update:["mana","manaSpeed",1E3],strID:"e_mage",nu:b.createMage,
race:"euro"},{radix:0,name:"Longbowman",attack:6,defence:2,health:50,maxHealth:50,img:m.euro_longbowman.idle,zLevel:1,invType:0,invMax:8,dieSound:gb,attackSound:Ed,arrow:!0,validator:Q,race:"euro",human:1,iconID:35,time:18,sight:18,url:m.euro_longbowman,icons:e,cost:[50,0,90,0],attDist:12,spd:50,standardFunc:G,clss:"longbowman",size:1,d2attack:2,strID:"e_longbowman",attimg:m.arrow1,nu:b.createLongbowman},{radix:0,clss:"tree",name:"Tree",health:100,maxHealth:100,img:m.terrain_tree,invType:0,invMax:8,
zLevel:1,mMapcolor:[11,131,11],validator:Q,child:[{img:m.terrain_tree_s,rgb:[0,0,0,.5],alpha:1,x:0,y:0}],iconID:23,url:m.terrain_tree,dimgInfinity:m.terrain_tree,dimgRND:3,icons:[],res:1,race:"common",build:!0,size:1,zolotoy:1,strID:"tree"},{radix:0,name:"Crusader",zLevel:1,dieSound:Be,attackSound:ze,attack:14,defence:8,health:180,maxHealth:180,img:m.crus.idle,invType:0,invMax:8,validator:Q,human:1,race:"euro",iconID:100,time:19,sight:5,url:m.crus,icons:e,cost:[0,0,0,0],attDist:1,spd:85,standardFunc:G,
clss:"crusader",size:1,strID:"crusader"},{radix:0,name:"Priest",attack:20,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:m.euro_priest.idle,invType:0,zLevel:1,invMax:8,validator:Q,human:1,iconID:40,time:30,ball:1,sight:21,dieSound:gb,url:m.euro_priest,icons:k,attackOnly:be.magic_creatures.obj,cost:[150,0,0,0],attDist:18,race:"euro",spd:50,standardFunc:G,clss:"priest",size:1,update:["mana","manaSpeed",1E3],strID:"e_priest",nu:b.createPriest,attimg:m.flame_bolt},{radix:0,name:"Peasant",attackSound:hi,
attack:5,defence:0,health:50,maxHealth:50,img:m.euro_peasant.idle,invType:0,invMax:8,dieSound:gb,zLevel:1,validator:Q,human:1,race:"euro",iconID:33,time:8,sight:5,url:m.euro_peasant,icons:[b.move,b.menuBuilds,b.repair,b.conquest,b.dcm,b.pickUp,b.explore,b.stop,b.stand,b.attack,b.bribe,b.sameSpeed,b.restoreSpeed],cost:[0,0,50,0],attDist:1,spd:50,clss:"peon",size:1,peon:1,strID:"e_peon",nu:b.createPeon,nocapture:1},{radix:0,clss:"cathedral",name:"Cathedral",dieSound:I,sound:["e_cathedral1","e_cathedral2"],
resistance:700,health:5E3,maxHealth:5E3,img:m.euro_cathedral,invType:0,invMax:8,race:"euro",zLevel:1,validator:V,bimg:m.build5x5,dimg:m.des_5x5,iconID:60,icons:[b.createCrusaders,b.techFanaticism,b.techEspionage,b.techInquisition,b.techHealing,b.techBless,b.techCrusade,b.techMedicine],time:90,sight:8,child:[{img:m.euro_cathedral_c,x:0,y:0},{img:m.euro_cathedral_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,5]),url:m.euro_cathedral,build:!0,
cost:[2E3,0,0,2E3],onbuild:[b.buildChurch],size:1,strID:"cathedral"},{radix:0,name:"Castle",clss:"castle",dieSound:I,sound:["e_castle1"],resistance:700,health:8E3,maxHealth:8E3,img:m.euro_castle,invType:1,invMax:50,race:"euro",zLevel:1,validator:V,bimg:m.build6x6,dimg:m.des_6x6,iconID:59,time:120,sight:12,child:[{img:m.euro_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:m.euro_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[b.createPeon,b.createSpy,b.emergeAllUnits,b.techFeudalism,b.techArchitecture,b.techLearning],
space:new Uint8Array([0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,7]),menu:Ba,url:m.euro_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1,strID:"e_castle"},{radix:0,name:"Wooden Wall",clss:"wall_wood",resistance:700,health:2E3,maxHealth:2E3,img:m.wood_tower,time:6,sight:1,zLevel:1,dieSound:I,validator:Q,bimg:m.wood_build,dimgInfinity:m.wood_debris,iconID:49,icons:[],mx:0,race:"common",my:0,hframe:71,menu:Ba,url:m.wood_tower,
wall:1,build:!0,cost:[0,0,20,0],size:1,strID:"woodwall",child:[{img:m.wood_tower_c,x:0,y:0}]},{radix:0,name:"Barracks",clss:"barracks",strID:"e_barrack",sound:ii,generator:1,resistance:500,health:1400,maxHealth:1400,img:m.euro_barrack,invType:1,invMax:0,dieSound:I,time:60,sight:6,zLevel:1,race:"euro",validator:V,bimg:m.build5x5,dimg:m.des_5x5,child:[{img:m.euro_barracks_c,mv:!0},{img:m.euro_barrack_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:57,icons:[b.createFootman,b.createArcher,b.createMaceman,
b.createPikeman,b.createLongbowman,b.createKnight],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:m.euro_barrack,build:!0,cost:[0,200,0,200],size:1},{radix:0,strID:"e_lumber",name:"Lumber Mill",sound:["e_lumber1"],clss:"lumber_mill",resistance:500,health:800,maxHealth:800,img:m.euro_lumbermill,invType:1,invMax:0,time:30,race:"euro",sight:4,dieSound:I,zLevel:1,validator:V,bimg:m.build2x2,dimg:m.des_2x2,iconID:64,child:[{img:m.euro_lumbermill_c,x:0,y:0},{alpha:!0,img:m.euro_lumbermill_s,
x:0,y:0,rgb:[0,0,0,.5]}],icons:[b.techLongbow,b.techWoodCutting,b.techCrossbow],space:new Uint8Array([1,1,1,1,2]),hframe:98,url:m.euro_lumbermill,build:!0,cost:[0,100,0,0],storage:1,size:1},{radix:0,name:"Mage Tower",strID:"e_magetower",sound:["e_magetower1","e_magetower2","e_magetower3"],clss:"magictower",resistance:700,health:5E3,maxHealth:5E3,img:m.euro_magetower,invType:1,invMax:0,time:90,race:"euro",dieSound:I,sight:8,validator:V,bimg:m.build5x5,dimg:m.des_5x5,zLevel:1,child:[{img:m.euro_magetower_c,
x:0,y:0},{img:m.euro_magetower_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:71,icons:[b.createMage,b.techBat,b.techInvisibility,b.techLightning,b.techFreeze,b.techGolem],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.euro_magetower,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,strID:"e_waracademy",name:"Warriors Guild",sound:["e_waracademy1"],clss:"academy",resistance:700,health:5E3,maxHealth:5E3,img:m.euro_waracademy,invType:1,invMax:0,race:"euro",time:90,sight:8,dieSound:I,zLevel:1,
validator:V,bimg:m.build6x6,dimg:m.des_6x6,iconID:56,child:[{img:m.euro_waracademy_c,x:0,y:0,mv:!0},{img:m.euro_waracademy_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],icons:[b.techHeroism,b.techWarfare,b.techMercenaries,b.techSiegeTactics,b.techBodyBuilding,b.techLeadership,b.techTactics,b.techHeroes,b.techHonor,b.techFame],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,5]),url:m.euro_waracademy,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,name:"Storage",strID:"e_storage",sound:["e_storage1",
"e_storage2"],clss:"storage",resistance:80,health:800,maxHealth:800,img:m.euro_storage,invType:1,invMax:0,time:30,dieSound:I,zLevel:1,sight:5,validator:V,bimg:m.build4x4,dimg:m.des_4x4,iconID:69,race:"euro",icons:[b.techGoldMining,b.techStoneMining],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:m.euro_storage,storage:0,build:!0,cost:[0,200,0,0],size:1,child:[{img:m.euro_storage_c,x:0,y:0},{img:m.euro_storage_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Knight",strID:"e_knight",
dieSound:Be,clss:"knight",attackSound:ze,attack:12,defence:6,health:120,maxHealth:120,img:m.euro_knight.idle,invType:0,zLevel:1,race:"euro",invMax:8,validator:Q,human:1,iconID:43,d2attack:2,time:22,sight:5,url:m.euro_knight,icons:e,cost:[120,0,70,0],attDist:1,spd:85,nu:b.createKnight,standardFunc:G,size:1},{radix:0,name:"Field",clss:"field",strID:"field",instantBuild:1,resistance:80,health:100,maxHealth:100,img:m.fields,invMax:0,validator:Dj,zLevel:1,iconID:104,race:"common",icons:[],space:new Uint8Array([1,
1,1,1,1,1,1,1,1,3]),url:m.fields,build:!0,field:1,res:2,cost:[0,200,0,0],rndDirection:9,time:0,sight:1,z32:.5,size:1},{radix:0,name:"Golden rocks",mMapcolor:[148,148,0],strID:"gold",sound:["mine1"],clss:"golden_rocks",resistance:0,health:6E3,maxHealth:6E3,img:m.res_gold,invMax:0,validator:V,iconID:20,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.res_gold,build:!0,zLevel:1,race:"common",res:0,cost:[0,0,0,0],time:0,sight:2,dieSound:["destroy%20mine"],size:1,zolotoy:1,child:[{img:m.res_gold_s,
x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:m.res_gold},{radix:0,name:"Rocks",strID:"stone",mMapcolor:[132,132,132],sound:["mine1"],clss:"rocks",dieSound:["destroy%20mine"],resistance:0,health:6E3,maxHealth:6E3,img:m.res_stone,invMax:0,validator:V,zLevel:1,iconID:22,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.res_stone,build:!0,res:3,cost:[0,0,0,0],race:"common",time:0,sight:2,size:1,zolotoy:1,child:[{img:m.res_stone_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:m.res_stone},
{radix:0,name:"Farm",strID:"e_farm",sound:["e_farm1","e_farm2"],clss:"farm",resistance:0,health:800,maxHealth:800,img:m.euro_farm,invType:1,invMax:0,zLevel:1,validator:V,bimg:m.build4x4,dimg:m.des_4x4,iconID:61,dieSound:I,race:"euro",icons:[b.createCow,b.techCropRotation,b.techDomestication],space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Ba,url:m.euro_farm,build:!0,cost:[0,200,0,0],time:30,sight:5,storage:2,size:1,child:[{img:m.euro_farm_c,x:0,y:0}]},{radix:0,name:"Merchants Guild",
strID:"e_merchant",sound:["merchant"],clss:"merchants_guild",resistance:0,health:5E3,maxHealth:5E3,img:m.euro_tcguild,invType:1,invMax:0,validator:V,bimg:m.build6x6,zLevel:1,dimg:m.des_6x6,race:"euro",iconID:62,dieSound:I,icons:[b.techMapMaking,b.techTradeRoutes,b.techUsury,b.techSupplyStorage,b.techBribery,b.techTradeTaxes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),menu:Ba,url:m.euro_tcguild,build:!0,time:90,sight:8,cost:[2E3,0,0,2E3],onbuild:[b.buildMarket],size:1,
child:[{img:m.euro_tcguild_c,x:0,y:0},{img:m.euro_tcguild_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Church",clss:"church",strID:"e_church",sound:["e_church1"],resistance:0,health:800,maxHealth:800,img:m.euro_church,invType:1,invMax:0,dieSound:I,validator:V,bimg:m.build3x3,race:"euro",zLevel:1,dimg:m.des_3x3,iconID:139,icons:[b.createPriest],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),menu:Ba,url:m.euro_church,build:!0,cost:[0,0,200,200],time:40,sight:6,size:1,child:[{img:m.euro_church_c,
x:0,y:0},{img:m.euro_church_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Blacksmith",clss:"blacksmith",strID:"e_blacksmith",resistance:0,health:800,maxHealth:800,img:m.euro_blacksmith,invType:1,invMax:0,time:40,zLevel:1,sight:5,dieSound:I,validator:V,bimg:m.build4x4,race:"euro",dimg:m.des_4x4,child:[{img:m.euro_blacksmith_c,x:0,y:0}],iconID:58,icons:[b.techPlateArmor,b.techTemperIron,b.techScaleArmor,b.techHalberd,b.techChainMail],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Ba,
url:m.euro_blacksmith,build:!0,cost:[0,0,200,200],onbuild:c,size:1},{radix:0,name:"Cow",clss:"cow",nu:b.createCow,race:"common",strID:"cow",attack:0,defence:3,health:50,maxHealth:50,img:m.cow.idle,invType:0,invMax:8,zLevel:1,validator:Q,iconID:99,time:20,dieSound:["cowdie1","cowdie2","cowdie3","cowdie4"],url:m.cow,icons:[b.move,b.stop],sight:3,cost:[0,0,300,0],attDist:0,spd:32,res:2,food:300,milk:50,milkMax:50,foodMax:600,size:1,cow:1,update:["milk","milkSpeed",1E3,"food","cowSpeed",1E3]},{radix:0,
name:"Stable",sound:["e_stables1"],clss:"stable",strID:"e_stable",onlyRequired:1,resistance:0,health:800,maxHealth:800,invType:1,invMax:0,race:"euro",zLevel:1,validator:V,bimg:m.build4x4,dimg:m.des_4x4,iconID:68,dieSound:I,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,4]),url:m.euro_stables,build:!0,cost:[0,200,0,0],onbuild:d,size:1,time:40,sight:5,img:m.euro_stables,nu:b.createCow,child:[{img:m.euro_stable_c,x:0,y:0}]},{radix:0,name:"Workshop",sound:["e_workshop1"],clss:"workshop",strID:"e_workshop",
zLevel:1,resistance:0,health:800,maxHealth:800,img:m.euro_workshop,invType:1,invMax:0,dieSound:I,validator:V,bimg:m.build4x4,race:"euro",dimg:m.des_4x4,iconID:75,icons:[b.createCatapult,b.createHeavyCatapult,b.createBallist,b.techEngineering,b.techCannonTower],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:m.euro_workshop,build:!0,cost:[0,200,200,0],size:1,time:40,sight:5,child:[{img:m.euro_workshop_c,x:0,y:0}]},{radix:0,name:"Tavern",sound:["e_tavern1"],clss:"tavern",strID:"e_tavern",
dieSound:I,resistance:0,health:1E3,maxHealth:1E3,img:m.euro_tavern,invType:1,invMax:0,validator:V,race:"euro",bimg:m.build4x4,dimg:m.des_4x4,zLevel:1,iconID:70,icons:[b.createMercenaries,b.createHeroes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4]),url:m.euro_tavern,build:1,cost:[0,200,200,0],onbuild:f,actvintv:[b.iniMercenaries,b.iniHeroes],size:1,time:40,sight:5,child:[{img:m.euro_tavern_c,x:0,y:0}]},{name:"House",sound:["house1","house2","house3","house4","house5"],clss:"house",strID:"e_house",
resistance:0,health:75,maxHealth:75,img:m.euro_houses,invType:1,invMax:0,validator:V,bimg:m.build3x3,dimg:m.des_3x3,race:"euro",iconID:73,zLevel:1,dieSound:I,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:m.euro_houses,build:!0,cost:[0,75,0,0],population:10,size:1,time:20,sight:4,child:[{img:m.euro_houses_c,x:0,y:0}]},{name:"Watch Tower",attackSound:pg,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),clss:"watch_tower",strID:"watch_tower",attack:7,health:400,maxHealth:400,img:m.euro_tower_wood_2,
state:0,invType:1,race:"common",invMax:0,zLevel:1,dieSound:I,level:0,validator:V,child:[{img:m.euro_tower_wood_2_c,x:0,y:0},{alpha:!0,img:m.euro_tower_wood_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attimg:m.arrow1,attDist:8,bimg:m.build2x2,dimg:m.des_2x2,iconID:53,icons:[b.attack,b.stop,b.upgradeGuildTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_wood_2,build:!0,cost:[0,300,0,0],size:1,arrow:!0,time:10,sight:15,standardFunc:G},{name:"Market",sound:["e_market1"],clss:"market",strID:"e_market",resistance:0,
health:1400,maxHealth:1400,img:m.euro_market,invType:1,invMax:0,dieSound:I,zLevel:1,validator:V,bimg:m.build4x4,dimg:m.des_4x4,iconID:65,race:"euro",icons:[b.createCaravan],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,4]),url:m.euro_market,build:!0,cost:[0,200,200,0],size:1,time:60,sight:8,child:[{img:m.euro_market_c,x:0,y:0}]},{name:"Outpost",sound:["e_outpost1"],clss:"outpost",strID:"e_outpost",zLevel:1,resistance:0,health:2E3,maxHealth:2E3,img:m.euro_outpost,invType:1,dieSound:I,invMax:50,
validator:V,race:"euro",bimg:m.build4x4,dimg:m.des_4x4,iconID:66,icons:[b.emergeAllUnits],space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,4]),url:m.euro_outpost,build:!0,cost:[0,200,0,400],size:1,child:[{img:m.euro_outpost_c,x:0,y:0},{img:m.euro_outpost_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{name:"Bridge",clss:"bridge",strID:"bridge",resistance:0,health:1E4,maxHealth:1E4,img:m.bridge_horz,invMax:0,validator:Cj,bimg:m.bridge_horz_build,race:"common",zLevel:1,dieSound:I,child:[{alpha:!0,
img:m.bridge_horz_s,x:0,y:0,rgb:[0,0,0,.5]},{img:m.bridge_horz1,x:0,y:0,z:6}],time:22,sight:1,dimg:m.bridge_horz_demol,iconID:44,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,11]),url:m.bridge_horz,build:!0,cost:[0,200,0,400],size:1},{name:"Dummy",clss:"dummy",strID:"dummy",resistance:0,health:5E3,maxHealth:5E3,img:m.dummy1,invMax:0,validator:Q,bimg:m.dummy1_b,
iconID:165,icons:[],mx:0,zLevel:1,my:16,hframe:65,race:"common",url:m.dummy1,dimg:m.dummy1_d,build:!0,cost:[0,300,0,0],dummy:!0,child:[{img:m.dummy1_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:10,sight:1},{name:"Catapult",strID:"catapult",dieSound:rg,clss:"catapult",attackSound:qg,defence:0,attack:10,health:110,maxHealth:110,img:m.catapult.idle,invMax:0,radix:0,validator:Q,iconID:30,time:30,sight:20,race:"common",url:m.catapult,level:0,zLevel:1,icons:g,cost:[0,600,0,0],nofreeze:1,arrow:!1,attDist:17,
spd:40,standardFunc:G,size:1,attimg:m.cat_stone,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:b.createCatapult},{name:"Ballista",radix:0,strID:"ballista",attackSound:qg,dieSound:rg,clss:"ballista",defence:0,attack:60,health:75,maxHealth:75,img:m.ballista.idle,invMax:0,validator:Q,iconID:31,time:30,sight:16,nofreeze:1,race:"common",zLevel:1,url:m.ballista,icons:g,cost:[0,800,0,0],attDist:13,spd:40,standardFunc:G,size:1,attimg:m.arrow_ballista1,space:new Uint8Array([1,1,1,1,2]),attackDeg:30,nu:b.createBallist},
{name:"Heavy Catapult",strID:"heavy_catapult",attackSound:qg,defence:0,attack:25,health:250,maxHealth:250,img:m.h_catapult.idle,invMax:0,radix:0,validator:Q,iconID:45,time:60,dieSound:rg,sight:26,race:"common",url:m.h_catapult,zLevel:1,icons:g,standardFunc:G,cost:[0,1200,0,0],attDist:22,spd:40,nofreeze:1,clss:"heavy_catapult",size:1,attimg:m.cb_metal,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:b.createHeavyCatapult},{radix:0,name:"Ghost",strID:"ghost",defence:0,attack:8,health:60,maxHealth:60,
img:m.euro_ghost.idle,invType:0,invMax:8,dieSound:["ghost1","ghost2"],validator:Q,iconID:178,zLevel:1,race:"common",time:15,attackSound:Hk,sight:5,standardFunc:G,url:m.euro_ghost,icons:e,w:1,cost:[40,0,0,0],attDist:1,spd:80,clss:"ghost",size:1,nu:b.createGhost},{name:"Harbor",strID:"e_harbor",resistance:80,health:800,maxHealth:800,img:m.euro_harbor,invType:1,invMax:0,validator:Kf,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:m.build_harbor,dimg:m.des_harbor,zLevel:1,race:"euro",dieSound:I,
iconID:63,icons:[b.createFishingBoat,b.createXebec,b.createHulk,b.createGalleon,b.techLandingTactics],clss:"harbor",url:m.euro_harbor,storage:4,build:!0,cost:[0,200,200,0],child:[{img:m.euro_harbor_c,x:0,y:0},{img:m.euro_harbor_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{radix:0,name:"Messiah",strID:"messiah",attack:50,defence:10,mana:1E3,manaMax:1E3,health:1E3,maxHealth:1E3,img:m.messiah.idle,invType:0,invMax:0,race:"common",validator:Q,human:1,iconID:169,zLevel:1,attackSound:["messiah_attack"],
dieSound:["messiah"],time:300,sight:26,url:m.messiah,standardFunc:G,icons:e,cost:[2E3,0,0,0],attDist:10,spd:50,clss:"messiah",size:1,update:["mana","manaSpeed",1E3]},{name:"Magic Gateway",sound:["gateway"],strID:"gateway",magicGateway:1,resistance:0,health:Infinity,maxHealth:Infinity,img:m.teleport,invMax:0,validator:V,bimg:m.build4x4,zLevel:1,dieSound:I,race:"common",iconID:180,clss:"magic_gateway",icons:[b.createOrk,b.createDwarf,b.createGhost,b.createSkeleton],space:new Uint8Array([0,1,1,1,0,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,5]),url:m.teleport,build:!0,cost:[0,0,0,0],size:1,time:10,sight:10,zolotoy:1,child:[{img:m.teleport_c,x:0,y:0},{alpha:!0,img:m.teleport_s,x:0,y:0,rgb:[0,0,0,.5]}],standardFunc:Ok},{name:"Guard Tower",strID:"guard_tower",race:"common",clss:"guard_tower",attackSound:pg,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:12,health:1E3,maxHealth:1E3,img:m.euro_tower_wood,state:0,invType:1,invMax:0,dieSound:I,zLevel:1,validator:V,child:[{img:m.euro_tower_wood_c,
x:0,y:0},{alpha:!0,img:m.euro_tower_wood_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:12,bimg:m.build2x2,dimg:m.des_2x2,iconID:52,icons:[b.attack,b.stop,b.upgradeStoneTower,b.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_wood,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:m.arrow1,time:35,sight:16,standardFunc:G},{name:"Sword",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:Lb,iconID:16,url:m.items1,icons:[],cost:[0,0,0,0],size:1,zLevel:0,z32:.5,
radix:0,race:"common",item:1},{name:"Bow",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:Lb,iconID:4,url:m.items1,icons:[],cost:[0,0,0,0],size:1,z32:.5,zLevel:0,radix:0,race:"common",item:1},{name:"Shield",attack:0,defence:0,health:25,maxHealth:25,img:m.items1,state:0,invMax:0,validator:Lb,iconID:1,url:m.items1,icons:[],cost:[0,0,0,0],zLevel:0,race:"common",radix:0,size:1,z32:.5,item:1},{name:"Potion",attack:0,defence:0,health:25,maxHealth:25,img:m.potions,state:0,
invMax:0,validator:Lb,iconID:11,url:m.potions,icons:[],radix:0,race:"common",zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Book",attack:0,defence:0,health:25,maxHealth:25,img:m.book1,state:0,invMax:0,validator:Lb,iconID:9,zLevel:0,race:"common",radix:0,url:m.books,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Gold",health:1,maxHealth:1,img:m.item_gold,invMax:0,validator:Lb,iconID:20,radix:0,race:"common",zLevel:0,url:m.item_gold,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Stone",
health:1,maxHealth:1,img:m.item_stone,invMax:0,validator:Lb,iconID:22,race:"common",radix:0,url:m.item_stone,zLevel:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Food",health:15,maxHealth:15,img:m.item_food,invMax:0,mMapcolor:[0,255,255],validator:Lb,iconID:14,url:m.item_food,radix:0,race:"common",icons:[],zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Wood",health:1,maxHealth:1,img:m.item_wood,invMax:0,validator:Lb,iconID:15,url:m.item_wood,icons:[],race:"common",radix:0,zLevel:0,
cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Iron",health:1,maxHealth:1,img:m.item_iron,invMax:0,validator:Lb,iconID:21,zLevel:0,race:"common",url:m.item_iron,radix:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Keep Tower",strID:"keep_tower",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:16,health:2E3,maxHealth:2E3,img:m.euro_tower_stone,state:0,invType:1,zLevel:1,attackSound:pg,invMax:0,dieSound:I,validator:V,clss:"keep_tower",race:"common",child:[{alpha:!0,img:m.euro_tower_stone_s,
x:0,y:0,rgb:[0,0,0,.5]},{img:m.euro_tower_stone_c,x:0,y:0}],attDist:14,bimg:m.build2x2,dimg:m.des_2x2,standardFunc:G,iconID:54,icons:[b.attack,b.stop,b.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_stone,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:m.arrow_big1,time:40,sight:18},{name:"Cannon Tower",clss:"tower_stone2",strID:"tower_stone2",attackSound:Ae,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:40,health:2500,maxHealth:2500,img:m.euro_tower_stone_2,
state:0,invType:1,invMax:0,dieSound:I,race:"common",validator:V,zLevel:1,child:[{img:m.euro_tower_stone_2_c,x:0,y:0},{alpha:!0,img:m.euro_tower_stone_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:10,bimg:m.build2x2,dimg:m.des_2x2,iconID:54,icons:[b.attack,b.stop],space:new Uint8Array([1,1,1,1,2]),url:m.euro_tower_stone_2,build:!0,cost:[0,600,0,0],standardFunc:G,size:1,arrow:!1,attimg:m.hot_cannon,time:45,sight:18,attackDeg:30},{name:"Rocket Tower",strID:"tower_rocket",race:"asia",clss:"tower_rocket",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),
zLevel:1,attack:30,health:1400,maxHealth:1400,img:m.rocket_tower,state:0,invType:1,invMax:0,dieSound:I,validator:V,child:[{img:m.rocket_tower_c},{alpha:!0,img:m.rocket_tower_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:20,bimg:m.build2x2,dimg:m.des_2x2,iconID:186,icons:[],space:new Uint8Array([1,1,1,1,2]),url:m.rocket_tower,build:!0,cost:[0,600,0,0],standardFunc:G,size:1,arrow:!0,attimg:m.arrow_big1,time:60,sight:26},{radix:0,name:"Ork",race:"common",strID:"ork",dieSound:["orc%20die%201","orc%20die%202"],attackSound:Gk,
attack:18,defence:2,health:75,maxHealth:75,img:m.ork.idle,invType:0,invMax:8,validator:Q,zLevel:1,iconID:143,time:12,sight:5,url:m.ork,standardFunc:G,icons:e,cost:[60,0,0,0],attDist:1,spd:50,clss:"ork",size:1,nu:b.createOrk},{radix:0,name:"Dwarf",race:"common",attack:7,defence:7,health:120,maxHealth:120,img:m.dwarf.idle,invType:0,strID:"dwarf",invMax:8,zLevel:1,dieSound:gb,validator:Q,iconID:185,time:12,sight:3,url:m.dwarf,standardFunc:G,icons:e,cost:[80,0,0,0],attDist:1,spd:50,clss:"dwarf",size:1,
nu:b.createDwarf},{radix:0,name:"Skeleton",strID:"skeleton",race:"common",dieSound:["skeleton%20die%201","skeleton%20die%202","skeleton%20die%203","skeleton%20die%204"],attack:4,defence:0,health:40,maxHealth:40,img:m.skeleton.idle,invType:0,zLevel:1,attackSound:Cc,invMax:8,nofreeze:1,validator:Q,iconID:167,time:12,sight:3,url:m.skeleton,standardFunc:G,icons:e,cost:[0,0,30,0],attDist:1,spd:50,clss:"skeleton",size:1,nu:b.createSkeleton},{radix:0,name:"Caravan",race:"euro",strID:"e_caravan",attack:0,
defence:0,health:350,maxHealth:350,img:m.caravan.idle,invType:1,invMax:8,validator:Q,iconID:34,zLevel:1,time:50,sight:7,url:m.caravan,icons:[b.move,b.trade,b.explore,b.stop,b.stand,b.unload],cost:[0,200,400,0],attDist:1,spd:75,clss:"caravan",size:1,nu:b.createCaravan},{name:"Castle",health:8E3,maxHealth:8E3,img:m.asia_castle,invType:1,strID:"a_castle",zLevel:1,race:"asia",invMax:50,validator:V,bimg:m.build6x6,dimg:m.des_6x6,iconID:164,time:120,sight:12,dieSound:I,clss:"castle",child:[{img:m.asia_castle_c,
x:0,y:0,mv:!0},{alpha:!0,img:m.asia_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[b.createPeon1,b.createNinja,b.emergeAllUnits,b.techFeudalism,b.techArchitecture,b.techLearning,b.techBuddhism,b.techGreatWall],space:new Uint8Array([0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,8]),menu:Ba,url:m.asia_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{name:"Castle",dieSound:I,clss:"castle",strID:"r_castle",
race:"arab",health:8E3,maxHealth:8E3,img:m.arab_castle,invType:1,invMax:50,validator:V,bimg:m.build6x6,dimg:m.des_6x6,zLevel:1,iconID:97,time:120,sight:12,child:[{img:m.arab_castle_c}],icons:[b.createPeon2,b.createSpy,b.emergeAllUnits,b.techFeudalism,b.techArchitecture,b.techLearning,b.techSlavery],space:new Uint8Array([0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,,8]),menu:Ba,url:m.arab_castle,build:!0,cost:[0,1500,
0,1500],storage:-1,castle:!0,population:20,size:1},{radix:0,name:"Peasant",attack:5,defence:0,health:50,maxHealth:50,img:m.asian_peasant.idle,invType:0,invMax:8,attackSound:hi,race:"asia",validator:Q,human:1,strID:"a_peon",iconID:132,dieSound:gb,zLevel:1,time:8,peon:1,sight:5,url:m.asian_peasant,icons:[b.move,b.menuBuilds1,b.repair,b.conquest,b.dcm,b.pickUp,b.explore,b.stop,b.stand,b.attack,b.sameSpeed,b.restoreSpeed],cost:[0,0,40,0],attDist:1,spd:50,clss:"peon",nocapture:1,size:1},{radix:0,name:"Ninja",
race:"asia",attack:12,defence:5,mana:100,manaMax:100,health:90,maxHealth:90,img:m.asian_ninja.idle,invType:0,invMax:8,attackSound:Cc,validator:Q,human:1,iconID:133,strID:"ninja",dieSound:gb,zLevel:1,time:20,standardFunc:G,sight:10,url:m.asian_ninja,icons:[b.guard,b.patrol,b.pickUp,b.explore,b.stop,b.stand,b.invisibility,b.murder,b.move,b.attack,b.sameSpeed,b.restoreSpeed],cost:[120,0,0,0],attDist:1,spd:85,clss:"ninja",size:1,update:["mana","manaSpeed",1E3]},{radix:0,name:"Ronin",attack:7,defence:0,
health:45,maxHealth:45,img:m.asian_ronin.idle,invType:0,invMax:8,race:"asia",validator:Q,human:1,standardFunc:G,iconID:141,strID:"ronin",dieSound:gb,zLevel:1,time:8,sight:5,url:m.asian_ronin,icons:e,cost:[0,0,40,0],attDist:1,spd:50,attackSound:Cc,clss:"a_footman",size:1},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:m.asian_archer.idle,invType:0,invMax:8,race:"asia",validator:Q,human:1,strID:"a_archer",dieSound:gb,zLevel:1,attimg:m.arrow1,iconID:136,arrow:1,attackSound:Ed,time:12,
sight:10,url:m.asian_archer,icons:e,cost:[0,20,40,0],standardFunc:G,spd:50,clss:"archer",size:1,attDist:6},{radix:0,name:"Samurai",attack:10,defence:4,health:90,maxHealth:90,img:m.asian_samurai.idle,invType:0,race:"asia",strID:"samurai",invMax:8,attackSound:Cc,validator:Q,human:1,iconID:142,time:20,standardFunc:G,zLevel:1,dieSound:gb,sight:6,url:m.asian_samurai,icons:e,cost:[50,0,150,0],attDist:1,spd:50,clss:"a_maceman",size:1},{radix:0,name:"Horse Archer",attack:7,defence:0,health:75,maxHealth:75,
img:m.asian_horsarcher.idle,invType:0,race:"asia",invMax:8,validator:Q,human:1,attackSound:Ed,iconID:183,strID:"a_horse_archer",dieSound:Be,time:20,standardFunc:G,sight:12,url:m.asian_horsarcher,zLevel:1,icons:e,arrow:1,attimg:m.arrow1,cost:[40,0,120,0],spd:85,clss:"horse_archer",size:1,attDist:7},{radix:0,name:"Horse Samurai",attack:14,defence:4,health:160,maxHealth:160,img:m.asian_horsamurai.idle,invType:0,invMax:8,validator:Q,human:1,iconID:135,race:"asia",standardFunc:G,attackSound:ze,time:22,
zLevel:1,strID:"horse_samurai",dieSound:Be,sight:5,url:m.asian_horsamurai,icons:e,cost:[75,0,120,0],attDist:1,spd:85,clss:"horse_samurai",size:1},{name:"Barracks",resistance:500,health:1400,maxHealth:1400,img:m.asia_barracks,invType:1,sound:ii,invMax:0,time:60,dieSound:I,radix:0,sight:6,race:"asia",strID:"a_barrack",validator:V,zLevel:1,bimg:m.build5x5,dimg:m.des_5x5,child:[{img:m.asia_barracks_c,x:0,y:0,mv:!0},{img:m.asia_barracks_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:146,icons:[b.createRonin,
b.createArcher1,b.createSamurai,b.createHorseArcher1,b.createHorseSamurai,b.createChariot],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:m.asia_barracks,build:!0,cost:[0,200,0,200],size:1,clss:"barracks"},{name:"Chariot",attack:4,defence:3,health:180,maxHealth:180,img:m.asian_charriot.idle,invType:0,radix:0,race:"asia",invMax:8,strID:"chariot",dieSound:["c%20die%201","c%20die%202","c%20die%203","c%20die%204","c%20die%205"],attackSound:ze,validator:Q,human:1,zLevel:1,
iconID:175,standardFunc:G,time:8,sight:5,url:m.asian_charriot,icons:e,cost:[0,200,150,0],attDist:1,spd:85,clss:"chariot",size:1},{radix:1,name:"Galleon",attackSound:Ae,attack:35,attDist:12,race:"common",defence:0,health:1200,maxHealth:1200,strID:"galleon",nu:b.createGalleon,img:m.galleon.idle,invType:1,invMax:24,dieSound:["ship%20sink"],zLevel:0,validator:ce,iconID:32,time:50,boat:!0,attimg:m.cb_metal,attackDeg:20,sight:16,url:m.galleon,icons:[b.move,b.explore,b.unload,b.attack,b.attackGround,b.stop,
b.stand,b.stop,b.stand,b.attack,b.steady,b.upgradeShip],cost:[0,1200,800,0],spd:50,nofreeze:1,clss:"galleon",standardFunc:G,size:1,peon:1},{radix:1,name:"Fishing Boat",attackSound:Ae,attack:1,attDist:8,race:"common",defence:0,health:50,boat:!0,nu:b.createFishingBoat,maxHealth:50,img:m.boat.idle,invType:1,invMax:0,strID:"fishing_boat",dieSound:["ship%20sink"],zLevel:0,validator:ce,iconID:184,nofreeze:1,time:50,sight:16,url:m.boat,icons:[b.move,b.explore,b.stop,b.stand,b.fishing],cost:[0,200,100,0],
spd:65,clss:"fishing_boat",size:1},{radix:1,name:"Hulk",attackSound:Ae,attack:18,attDist:10,race:"common",defence:0,health:700,maxHealth:700,strID:"hulk",img:m.hulk.idle,invType:1,boat:!0,nu:b.createHulk,attackDeg:20,invMax:16,dieSound:["ship%20sink"],zLevel:0,validator:ce,iconID:128,time:30,sight:14,attimg:m.cb_metal,url:m.hulk,icons:[b.move,b.explore,b.unload,b.attack,b.attackGround,b.stop,b.stand,b.stop,b.stand,b.attack,b.steady,b.upgradeShip],cost:[0,500,300,0],spd:65,nofreeze:1,clss:"hulk",standardFunc:G,
size:1},{radix:1,name:"Pinque",attackSound:Ed,attack:10,race:"common",attDist:8,defence:0,health:300,boat:!0,maxHealth:300,img:m.xebec.idle,attimg:m.arrow1,arrow:!0,strID:"pinque",invType:1,invMax:8,dieSound:["ship%20sink"],zLevel:0,validator:ce,iconID:129,time:20,nofreeze:1,sight:12,url:m.xebec,icons:[b.move,b.explore,b.unload,b.attack,b.attackGround,b.stop,b.stand,b.stop,b.stand,b.attack,b.steady,b.upgradeShip],cost:[0,300,200,0],spd:80,clss:"xebec",size:1,standardFunc:G,nu:b.createXebec},{radix:0,
name:"Stone Golem",strID:"troll",defence:3,attack:25,health:400,maxHealth:400,img:m.troll.idle,invType:0,invMax:0,dieSound:["golem"],validator:Q,iconID:144,race:"common",zLevel:1,nofreeze:1,attackSound:["golem1","golem2"],sight:10,standardFunc:G,url:m.troll,icons:e,w:1,cost:[120,0,0,0,600],attDist:1,spd:56,clss:"troll",size:1},{radix:0,name:"Bat",strID:"bat",defence:0,attack:3,health:20,maxHealth:20,img:m.bat.move,invType:0,invMax:0,race:"common",bat:1,dieSound:["bat%20die"],validator:Lf,iconID:105,
zLevel:2,attackSound:["bat%20attack"],sight:10,standardFunc:G,url:m.bat,icons:e,w:1,cost:[0,0,0,0,25],attDist:1,spd:128,clss:"bat",size:1,z32:1.5},{race:"arab",invType:0,invMax:8,iconID:138,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_peasant,img:m.arab_peasant.idle,spd:50,validator:Q,human:1,icons:[b.move,b.menuBuilds2,b.repair,b.conquest,b.dcm,b.pickUp,b.explore,b.stop,b.stand,b.attack,b.convertJihad,b.bribe,b.sameSpeed,b.restoreSpeed],name:"Peasant",clss:"peon",cost:[0,0,50,0],
attDist:1,time:8,nocapture:1,peon:1,sight:5,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:172,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_footman,img:m.arab_footman.idle,standardFunc:G,spd:50,validator:Q,human:1,attDist:1,icons:e,name:"Footman",clss:"footman",cost:[0,0,50,0],time:12,sight:5,health:50,attack:6,defence:1},{race:"arab",invType:0,invMax:8,iconID:170,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_archer,img:m.arab_archer.idle,spd:50,
validator:Q,standardFunc:G,human:1,attimg:m.arrow1,arrow:1,icons:e,name:"Archer",clss:"archer",cost:[0,20,40,0],time:12,sight:10,attDist:6,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:173,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_spearman,img:m.arab_spearman.idle,spd:50,validator:Q,standardFunc:G,human:1,icons:e,name:"Spearman",clss:"pikeman",attDist:1,cost:[40,0,60,0],time:14,sight:5,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:174,
zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,standardFunc:G,url:m.arab_satrap,img:m.arab_satrap.idle,spd:50,validator:Q,human:1,icons:e,name:"Satrap",attDist:1,clss:"maceman",cost:[0,0,120,0],time:14,sight:5,health:120,attack:8,defence:0},{race:"arab",invType:0,invMax:8,iconID:171,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_cavalry,standardFunc:G,img:m.arab_cavalry.idle,spd:85,validator:Q,human:1,attDist:1,icons:e,name:"Cavalry",clss:"heavy_cavalry",cost:[60,0,100,0],time:14,
sight:5,health:90,attack:10,defence:4},{race:"arab",invType:0,invMax:8,iconID:168,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_horse_archer,img:m.arab_horse_archer.idle,spd:85,validator:Q,human:1,standardFunc:G,icons:e,name:"Horse Archer",clss:"horse_archer",cost:[50,0,100,0],time:14,attimg:m.arrow1,arrow:1,sight:12,attDist:7,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:179,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_jwarrior,img:m.arab_jwarrior.idle,
spd:50,validator:Q,human:1,standardFunc:G,icons:e,name:"Jihad warrior",attDist:1,clss:"jihad_warrior",cost:[0,0,100,0],time:8,sight:5,health:75,attack:10,defence:2},{race:"arab",invType:0,invMax:8,iconID:176,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_priest,img:m.arab_priest.idle,standardFunc:G,spd:50,mana:100,validator:Q,human:1,icons:k,name:"Priest",clss:"priest",cost:[150,0,0,0],time:30,sight:21,attDist:18,health:60,attack:20,update:["mana","manaSpeed",1E3],manaMax:100,defence:0,
attimg:m.flame_bolt,ball:1,attackOnly:be.magic_creatures.obj},{race:"arab",invType:0,invMax:0,iconID:105,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:0,img:0,testing:1,illegal:1,spd:50,validator:Q,human:1,icons:[],name:"Spy",clss:"spy",cost:150,time:30,sight:12,health:50,attack:20,defence:0},{race:"arab",invType:0,invMax:8,iconID:188,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,attimg:m.flame_bolt,url:m.arab_mage,img:m.arab_mage.idle,spd:50,validator:Q,human:1,icons:[b.stop,b.pickUp,
b.explore,b.createCarpet,b.createJinn,b.fireRain,b.magicVision,b.raiseDead,b.attack,b.stand,b.move],standardFunc:G,name:"Mage",clss:"mage",ball:1,mana:100,manaMax:100,update:["mana","manaSpeed",1E3],cost:[150,0,0,0],time:30,sight:15,attDist:10,health:60,attack:8,defence:0},{race:"arab",invType:1,invMax:8,iconID:126,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_caravan,img:m.arab_caravan.idle,spd:75,validator:Q,human:1,icons:[],name:"Caravan",clss:"trader",cost:[0,0,500,0],time:30,
sight:5,health:150},{race:"arab",invType:0,invMax:8,iconID:177,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.arab_enichar,img:m.arab_enichar.idle,spd:85,validator:Q,human:1,standardFunc:G,icons:e,name:"Enichar",attDist:1,clss:"enichar",cost:[80,0,120,0],time:25,sight:5,health:130,attack:18,defence:4},{race:"arab",invType:1,invMax:0,iconID:82,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,population:10,url:m.arab_houses,validator:V,
build:1,icons:[],child:[{img:m.arab_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],time:20,sight:4,resistance:50,health:500},{race:"arab",invType:1,invMax:0,iconID:85,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_lumbermill,validator:V,build:1,icons:[b.techWoodCutting,b.techCrossbow],child:[{img:m.arab_lumbermill_c}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],storage:1,time:30,sight:4,resistance:80,health:800},{race:"arab",
invType:1,invMax:0,iconID:96,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_storage,validator:V,build:1,storage:0,icons:[b.techGoldMining,b.techStoneMining],child:[{img:m.arab_storage_c},{alpha:!0,img:m.arab_storage_s,rgb:[0,0,0,.5]}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:80,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_farm,validator:V,build:1,icons:[b.createCow,b.techCropRotation,b.techDomestication,b.techCowPoaching,b.ridingHorses,b.techHorseManShip],child:[{img:m.arab_farm_c}],name:"Farm",storage:2,clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:81,zLevel:1,dieSound:I,validator:Kf,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:m.build_harbor,dimg:m.des_harbor,radix:0,
url:m.arab_harbour,build:1,icons:[b.createFishingBoat,b.createXebec,b.createHulk,b.techLandingTactics],child:[{img:m.arab_harbour_c},{alpha:!0,img:m.arab_harbour_s,rgb:[0,0,0,.5]}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:79,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_blacksmith,validator:V,build:1,icons:[b.techTemperIron,b.techScaleArmor,b.techScimitar,
b.techChainMail,b.techHalberd],child:[{img:m.arab_blacksmith_c},{alpha:!0,img:m.arab_blacksmith_s,rgb:[0,0,0,.5]}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],onbuild:c,time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:95,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_workshop,validator:V,build:1,icons:[b.createCatapult,b.createBallist,b.techEngineering,b.techCannonTower],child:[{img:m.arab_workshop_c},
{alpha:!0,img:m.arab_workshop_s,rgb:[0,0,0,.5]}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:140,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_church,validator:V,build:1,icons:[b.createPriest2],child:[{img:m.arab_church_c},{alpha:!0,img:m.arab_church_s,rgb:[0,0,0,.5]}],name:"Church",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,
health:1E3},{race:"arab",invType:1,invMax:0,iconID:92,zLevel:1,dieSound:I,space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_tavern,validator:V,build:1,icons:[b.createMercenaries,b.createHeroes],child:[{img:m.arab_tavern_c}],name:"Tavern",clss:"tavern",cost:[0,200,200,0],onbuild:f,actvintv:[b.iniMercenaries,b.iniHeroes],time:40,sight:5,resistance:150,health:1E3},{race:"arab",invType:1,invMax:0,iconID:87,zLevel:1,dieSound:I,space:new Uint8Array([1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_market,validator:V,build:1,icons:[b.createCaravan2],child:[{img:m.arab_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:98,zLevel:1,dieSound:I,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_barracks,validator:V,build:1,icons:[b.createFootman2,b.createArcher2,
b.createSatrap,b.createPikeman2,b.createHorseArcher2,b.createCavalry,b.createEnichar,b.createJihad],child:[{img:m.arab_barracks_c},{alpha:!0,img:m.arab_barracks_s,rgb:[0,0,0,.5]}],name:"Barracks",clss:"barrack",cost:[0,0,200,200],time:60,sight:6,resistance:500,health:1400},{race:"arab",invType:1,invMax:0,iconID:91,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_stables,validator:V,build:1,icons:[],child:[{img:m.arab_stables_c}],
name:"Stable",clss:"stable",cost:[0,200,200,0],time:40,onbuild:d,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:50,iconID:89,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_outpost,validator:V,build:1,icons:[b.emergeAllUnits],child:[{img:m.arab_outpost_c,mv:1},{alpha:!0,img:m.arab_outpost_s,rgb:[0,0,0,.5]}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"arab",
invType:1,invMax:0,iconID:105,zLevel:1,dieSound:I,space:23213123,bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:0,img:0,validator:V,build:1,icons:[],child:[{img:3213123}],name:"NULL",testing:1,clss:"castle",cost:[0,1500,0,1500],time:120,sight:12,resistance:1E3,health:8E3},{race:"arab",invType:1,invMax:0,iconID:88,zLevel:1,dieSound:I,space:new Uint8Array([0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,6]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_mosque,validator:V,build:1,
icons:[b.techFanaticism,b.techEspionage,b.techHealing,b.techBless,b.techJihad],child:[{img:m.arab_mosque_c},{alpha:!0,img:m.arab_mosque_s,rgb:[0,0,0,.5]}],name:"Mosque",onbuild:[b.buildChurch2],clss:"mosque",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:86,zLevel:1,dieSound:I,space:new Uint8Array([0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.arab_magetower,validator:V,build:1,icons:[b.createMage2,b.techCarpet,
b.techMagicWorkshop,b.techFireRain,b.techMagicVision,b.techNecromancy,b.techJinn],child:[{img:m.arab_magetower_c},{alpha:!0,img:m.arab_magetower_s,rgb:[0,0,0,.5]}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:93,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_tc_guild,validator:V,build:1,icons:[b.techUsury,b.techTradeRoutes,
b.techSupplyStorage,b.techBribery,b.techOreFloatation],child:[{img:m.arab_tcguild_c},{alpha:!0,img:m.arab_tc_guild_s,rgb:[0,0,0,.5]}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[b.buildMarket2],sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:94,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.arab_waracademy,validator:V,build:1,icons:[b.techHeroism,b.techWarfare,
b.techMercenaries,b.techRiddingHorses,b.techBodyBuilding,b.techLeadership,b.techHeroes,b.techJanissary,b.techHonor,b.techFame],child:[{img:m.arab_waracademy_c},{alpha:!0,img:m.arab_waracademy_s,rgb:[0,0,0,.5]}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:158,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.arab_magicworkshop,validator:V,build:1,
icons:[b.createObjects],child:[{img:m.arab_magicworkshop_c},{alpha:!0,img:m.arab_magicworkshop_s,rgb:[0,0,0,.5]}],name:"Magic Workshop",disallowPoint:!0,clss:"magicworkshop",cost:[0,0,0,300],time:20,sight:5,resistance:200,health:1200},{race:"asia",invType:1,invMax:0,iconID:161,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,0,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.asia_houses,validator:V,build:1,icons:[],child:[{img:m.asia_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],population:10,
time:20,sight:4,resistance:50,health:500},{race:"asia",invType:1,invMax:0,iconID:149,zLevel:1,dieSound:I,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,storage:1,url:m.asia_lumbermill,validator:V,build:1,icons:[b.techWoodCutting,b.techCrossbow],child:[{img:m.asia_lumbermill_c},{img:m.asia_lumbermill_s,rgb:[0,0,0,.5],alpha:!0}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],time:30,sight:4,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:154,zLevel:1,
dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_storage,storage:0,validator:V,build:1,icons:[b.techGoldMining,b.techStoneMining],child:[{img:m.asia_storage_s,rgb:[0,0,0,.5],alpha:!0},{img:m.asia_storage_c}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:147,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,4]),bimg:m.build4x4,
dimg:m.des_4x4,radix:0,storage:2,url:m.asia_farm,validator:V,build:1,icons:[b.techCropRotation,b.ridingHorses,b.irrigation],child:[{img:m.asia_farm_c}],name:"Farm",clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:148,zLevel:1,dieSound:I,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),validator:Kf,bimg:m.build_harbor,dimg:m.des_harbor,radix:0,url:m.asia_harbor,build:1,icons:[b.createFishingBoat,b.createXebec,b.createHulk,b.techLandingTactics],
child:[{img:m.asia_harbor_c},{img:m.asia_harbor_s,rgb:[0,0,0,.5],alpha:!0}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:145,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_blacksmith,validator:V,build:1,icons:[b.techTemperIron,b.techScaleArmor,b.techArmoredChariot,b.techChainMail],child:[{img:m.asia_blacksmith_c},{img:m.asia_blacksmith_s,
rgb:[0,0,0,.5],alpha:!0}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],time:40,sight:5,onbuild:c,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:157,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_workshop,validator:V,build:1,icons:[b.createCatapult,b.createBallist,b.techEngineering,b.techCannonTower],child:[{img:m.asia_workshop_c,x:0,y:0},{img:m.asia_workshop_s,rgb:[0,0,0,.5],alpha:!0}],name:"Workshop",
clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:162,zLevel:1,dieSound:I,space:new Uint8Array([0,1,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asian_monastery,validator:V,build:1,icons:[b.createMonk,b.createPriest1],child:[{img:m.asian_monastery_c},{img:m.asian_monastery_s,rgb:[0,0,0,.5],alpha:!0}],name:"Monastery",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},
{race:"asia",invType:1,invMax:0,iconID:155,zLevel:1,dieSound:I,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_tavern,validator:V,build:1,icons:[b.createMercenaries,b.createHeroes],child:[{img:m.asia_tavern_c},{img:m.asia_tavern_s,rgb:[0,0,0,.5],alpha:!0}],onbuild:f,name:"Tavern",clss:"tavern",actvintv:[b.iniMercenaries,b.iniHeroes],cost:[0,200,200,0],time:40,sight:5,resistance:150,health:1E3},{race:"asia",invType:1,invMax:0,iconID:150,zLevel:1,
dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_market,validator:V,build:1,icons:[],child:[{img:m.asia_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:153,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:m.build4x4,dimg:m.des_4x4,radix:0,url:m.asia_stables,validator:V,build:1,icons:[],child:[{img:m.asia_stables_c,
mv:!0},{img:m.asia_stables_s,rgb:[0,0,0,.5],alpha:!0}],name:"Stable",clss:"stable",onbuild:d,cost:[0,200,200,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:151,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:m.build3x3,dimg:m.des_3x3,radix:0,url:m.asia_outpost,validator:V,build:1,icons:[b.emergeAllUnits],child:[{img:m.asia_outpost_c,mv:1},{img:m.asia_outpost_s,rgb:[0,0,0,.5],alpha:!0}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,
sight:8,resistance:500,health:2E3},{race:"asia",invType:1,invMax:0,iconID:163,zLevel:1,dieSound:I,space:new Uint8Array([0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,6]),bimg:m.build6x6,dimg:m.des_6x6,radix:0,url:m.asia_shao_lin,validator:V,build:1,icons:[b.techMeditation,b.techKungFu,b.techHealing,b.techPhilosophy,b.techNinjas,b.techMastery,b.techTournaments,b.techMedicine],child:[{img:m.asia_shao_lin_c},{img:m.asia_shao_lin_s,rgb:[0,0,0,.5],alpha:!0}],name:"Shao Linn",
onbuild:[b.buildChurch1],clss:"shaolinn",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:152,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_wizardguild,validator:V,build:1,icons:[b.createMage1,b.techConcentration,b.techWhirlpool,b.techFlameBolt,b.techTurnToStone,b.techConfusion,b.techDragon],child:[{img:m.asia_wizardguild_c},{img:m.asia_wizardguild_s,
rgb:[0,0,0,.5],alpha:!0}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:159,zLevel:1,dieSound:I,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_tcguild,validator:V,build:1,icons:[b.techTradeRoutes,b.techUsury,b.techJewelry,b.techSupplyStorage,b.techBanking,b.techChemistry,b.techSeaFood,b.techGunPowder,b.techRocketArrow],child:[{img:m.asia_tcguild_c,
mv:!0},{img:m.asia_tcguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[b.buildMarket1],sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:156,zLevel:1,dieSound:I,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:m.build5x5,dimg:m.des_5x5,radix:0,url:m.asia_warguild,validator:V,build:1,icons:[b.techBushido,b.techHeroism,b.techWarfare,b.techMercenaries,b.techLeadership,b.techTactics,b.techHeroes,
b.techHonor,b.techSunTzu],child:[{img:m.asia_warguild_c,mv:!0},{img:m.asia_warguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:0,invMax:0,iconID:166,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_priest,img:m.asian_priest.idle,spd:50,validator:Q,human:1,icons:[b.attack,b.stop,b.stand,b.pickUp,b.explore,b.healing,b.teach,b.move],name:"Priest",clss:"priest",cost:[170,0,0,0],time:30,
sight:21,health:120,standardFunc:G,attDist:1,attack:10,defence:10,mana:100,update:["mana","manaSpeed",1E3],manaMax:100},{race:"asia",invType:0,invMax:0,iconID:187,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_monk,img:m.asian_monk.idle,spd:50,validator:Q,human:1,icons:e,name:"Monk",standardFunc:G,clss:"monk",cost:[0,0,200,0],time:20,sight:5,health:90,attack:6,defence:6,attDist:1},{race:"asia",invType:0,invMax:0,iconID:134,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:m.asian_mage,
img:m.asian_mage.idle,spd:50,attimg:m.flame_bolt,validator:Q,standardFunc:G,human:1,icons:[b.stop,b.pickUp,b.explore,b.confusion,b.turnToStone,b.whirlpool,b.flameBolt,b.createDragon,b.attack,b.stand,b.move],name:"Mage",clss:"mage",cost:[150,0,0,0],ball:1,time:30,sight:15,mana:100,attDist:10,health:60,attack:8,defence:0,update:["mana","manaSpeed",1E3],manaMax:100},{radix:0,name:"Dragon",strID:"dragon",defence:0,attack:25,health:300,maxHealth:300,img:m.dragon.idle,invType:0,invMax:0,dieSound:[],sSizex:2,
sSizey:2,dragon:1,iconID:160,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:12,standardFunc:G,url:m.dragon,icons:e,cost:[80,0,0,0,800],attDist:2,spd:128,clss:"drg",size:1,z32:1.5,validator:Lf},{radix:0,name:"Carpet",strID:"carpet",defence:0,attack:0,health:90,maxHealth:90,img:m.carpet.idle,invType:1,invMax:8,dieSound:[],iconID:131,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:8,url:m.carpet,icons:[b.move,b.unload,b.explore,b.stop,b.stand],cost:[80,0,0,0,500],attDist:2,spd:120,clss:"carpet",
size:1,z32:1.5,validator:Lf},{radix:0,name:"Jinn",strID:"jinn",defence:5,attack:20,health:300,maxHealth:300,img:m.arab_jinn.idle,invType:0,invMax:0,dieSound:[],validator:Q,iconID:182,race:"common",zLevel:1,nofreeze:1,attackSound:[],sight:8,standardFunc:G,url:m.arab_jinn,icons:e,w:1,cost:[80,0,0,0,300],attDist:1,spd:85,clss:"jinn",size:1}];hd={};ph={arr:[]};Ua={euro:[],asia:[],arab:[],common:[]};Hd=[];Mc=[[],[],[],[],[],[]];n=0;for(h=t.length;n<h;n++){l=t[n];t[n].type=n;var u=l.space;l.name.split(" ").join("");
l.population&&Hd.put(l);hd[n]={};void 0!==l.storage&&(-1<l.storage?Mc[l.storage].put(n):(Mc[0].put(n),Mc[1].put(n),Mc[2].put(n),Mc[3].put(n)));ub[l.race][l.name.toLowerCase().split(" ").join("")]=l;l.icons.menuName=l.strID;ph[l.name]=n;ph.arr.put(n);l.img||(l.img=l.url);l.maxHealth=l.health;l.race&&Ua[l.race].put(l);f=0;d=l.icons;for(k=d.length;f<k;f++)(g=d[f])&&g.obj&&(g.orderOrigin=l);if(u){f=[];l.free=f;g=u[u.length-1];c=(u.length-1)/g;l=g+2;k=c+2;d=new Uint8Array(l*k);for(r=0;r<c;r++)for(var p=
0;p<g;p++)d[(r+1)*l+p+1]=u[p+r*g];r=0;for(k*=l;r<k;r++)!d[r]&&(d[r+1]||d[r-1]||d[r+1+l]||d[r+1-l]||d[r-1+l]||d[r-1-l]||d[r+l]||d[r-l])&&(f.put(r%l-1),f.put(~~(r/l)-1))}}Ua.euro=Ua.euro.concat(Ua.common);Ua.asia=Ua.asia.concat(Ua.common);Ua.arab=Ua.arab.concat(Ua.common);Ua[0]=Ua.euro;Ua[1]=Ua.arab;Ua[2]=Ua.asian;d=ub.euro;k=ub.asia;g=ub.arab;c=ub.common;ub[0]=ub.euro;ub[1]=ub.arab;ub[2]=ub.asia;$c||(e.cut=P({a:"attack",g:"guard",r:"patrol",p:"pickUp",e:"explore",s:"stop",n:"stand"}),d.tavern.icons.cut=
P({t:"trade1",g:"gamble",m:"createMercenaries",h:"createHeroes",l:"loan"}),d.castle.icons.cut=P({p:"createPeon",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning"}),k.castle.icons.cut=P({p:"createPeon1",n:"createNina",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",b:"techBudhism",w:"techGreatwall"}),g.castle.icons.cut=P({p:"createPeon2",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",y:"techSlavery"}),
d.barracks.icons.cut=P({f:"createFootman",a:"createArcher",m:"createMaceman",p:"createPikeman",l:"createLongbowman",k:"createKnight"}),k.barracks.icons.cut=P({r:"createRonin",a:"createArcher2",s:"createSamurai",h:"createHorseArcher1",o:"createHorseSamurai",c:"createChariot"}),g.barracks.icons.cut=P({f:"createFootman2",a:"createArcher2",s:"createSatrap",p:"createSpearman",h:"createHorsearcher2",c:"createCavalry",j:"createJanissary",d:"createJihadWarrior"}),d.magetower.icons.cut=P({m:"createMage"}),
k.mageguild.icons.cut=P({m:"createMage1"}),g.mageguild.icons.cut=P({m:"createMage2"}),d.peasant.icons.cut=P({b:"menuBuilds",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",i:"bribe"}),g.peasant.icons.cut=P({b:"menuBuilds2",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",j:"become_jihadw",i:"bribe"}),k.peasant.icons.cut=P({b:"menuBuilds1",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",t:"trade"}),
d.priest.icons.cut=P({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),g.priest.icons.cut=P({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"}),k.priest.icons.cut=P({m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",r:"raiseexp"}),d.wizard.icons.cut=P({m:"move",a:"attack",s:"stop",n:"stand",l:"lightning",b:"createBat",f:"freeze",t:"createGolem",i:"invisibility"}),g.mage.icons.cut=P({m:"move",a:"attack",s:"stop",n:"stand",c:"spell_spawncarpet",
j:"spell_spawnjin",r:"spell_firerain",v:"spell_magicvision",d:"raisedead"}),k.mage.icons.cut=P({m:"move",a:"attack",s:"stop",n:"stand",h:"spell_hypnotize",t:"spell_turntostone",w:"spell_whirlpool",f:"spell_flamebolt",d:"spell_spawndragon"}),c.spy.icons.cut=P({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",n:"stand",s:"stop"}),k.monk.icons.cut=P({a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"}),k.ninja.icons.cut=P({a:"attack",g:"guard",r:"patrol",p:"pick_item",
e:"explore",s:"stop",n:"stand",c:"cloak",u:"murder"}),c.catapult.icons.cut=P({a:"attack",g:"guard",p:"patrol",e:"explore",s:"stop",n:"stand",r:"attack_ground",h:"hold_steady"}),d.market.icons.cut=P({c:"createCaravan"}),g.market.icons.cut=P({c:"createCaravan2"}),k.market.icons.cut=P({b:"market_items",s:"market_sell"}),d.workshop.icons.cut=P({c:"createCatapult",h:"createHeavyCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),g.workshop.icons.cut=P({c:"createCatapult",b:"createBallista",
e:"techEngineering",t:"techCannonTower"}),k.workshop.icons.cut=P({c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"}),d.church.icons.cut=P({p:"createPriest"}),g.church.icons.cut=P({p:"createPriest2"}),k.monastery.icons.cut=P({m:"createMonk",p:"createPriest1"}),g.magicworkshop.icons.cut=P({i:"build_item"}),e=P({c:"buildCastle",s:"buildStorage",b:"buildBarrack",k:"buildBlacksmith",f:"buildFarm",l:"buildLumbermill",p:"buildWorkshop",e:"buildCathedral",u:"buildChurch",n:"buildTavern",
m:"buildMageTower",a:"buildStable",r:"buildHarbor",o:"buildOutpost",i:"buildFields",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse",g:"buildGateWood",y:"buildDummy"}),f=P({c:"buildCastle2",k:"buildBlacksmith2",f:"buildFarm2",n:"buildTavern2",b:"buildBarrack2",p:"buildWorkshop2",s:"buildStorage2",a:"buildStable2",l:"buildLumbermill2",r:"buildHarbor2",o:"buildOutpost2",u:"buildChurch2",e:"buildMosque",i:"buildFields",m:"buildMageTower2",w:"buildWoodWall",d:"buildBridge",t:"buildTower",
h:"buildHouse2",g:"buildGateWood"}),n=P({c:"buildCastle1",f:"buildFarm1",e:"buildShaolinn",n:"buildTavern1",b:"buildBarrack1",p:"buildWorkshop1",s:"buildStorage1",k:"buildBlacksmith1",a:"buildStable1",l:"buildLumbermill1",r:"buildHarbor1",o:"buildOutpost1",u:"buildChurch1",i:"buildFields",m:"buildMageTower1",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse1",g:"buildGateWood"}),de.cut=n,ee.cut=n,fe.cut=e,ge.cut=e,he.cut=e,ie.cut=n,je.cut=e,ke.cut=n,le.cut=f,me.cut=f,ne.cut=f,oe.cut=
f,d.lumbermill.icons.cut=P({b:"techLongbow",w:"techWoodCutting",c:"techCrossbow"}),g.lumbermill.icons.cut=P({w:"techWoodCutting",c:"techCrossbow"}),k.lumbermill.icons.cut=P({w:"techWoodCutting",c:"techCrossbow"}),d.blacksmith.icons.cut=P({p:"techPlateArmor",t:"techTemperIron",s:"techScaleArmor",h:"techHalberd",c:"techChainMail"}),g.blacksmith.icons.cut=P({t:"techTemperIron",a:"techScaleArmor",s:"techScimitar",c:"techChainMail",h:"techHalberd"}),k.blacksmith.icons.cut=P({t:"techTemperIron",a:"techScaleArmor",
r:"techArmoredChariot",c:"techChainMail"}),d.outpost.icons.cut=P({e:"emergeAllUnits"}),g.outpost.icons.cut=P({e:"emergeAllUnits"}),k.outpost.icons.cut=P({e:"emergeAllUnits"}),c.watchtower.icons.cut=P({a:"attack",s:"stop",g:"upgradeGuildTower"}),c.guardtower.icons.cut=P({a:"attack",s:"stop",g:"upgradeStoneTower",c:"upgradeCannonTower"}),c.keeptower.icons.cut=P({a:"attack",s:"stop",c:"upgradeCannonTower"}),c.cannontower.icons.cut=P({a:"attack",r:"attack_ground",s:"stop",h:"holdfire"}),k.rockettower.icons.cut=
P({a:"attack",r:"attack_ground",s:"stop",f:"fireatwill"}),d.harbor.icons.cut=P({f:"createFishingBoat",x:"createXebec",h:"createHulk",g:"createGalleon",t:"te_landingtactics"}),g.harbor.icons.cut=P({f:"createFishingBoat",h:"createHulk",x:"createXebec",t:"te_landingtactics"}),k.harbor.icons.cut=P({f:"createFishingBoat",h:"createHulk",x:"createXebec"}),d.farm.icons.cut=P({c:"createCow",f:"techCropRotation",d:"techDomestication"}),g.farm.icons.cut=P({c:"createCow",f:"techDomestication",d:"techDomestication",
p:"techCowPoaching",r:"ridingHorses",h:"techHorseManShip"}),k.farm.icons.cut=P({f:"techDomestication",a:"ridingHorses",i:"irrigation"}),d.storage.icons.cut=P({g:"techGoldMining",s:"techStoneMining"}),g.storage.icons.cut=P({g:"techGoldMining",s:"techStoneMining"}),k.storage.icons.cut=P({g:"techGoldMining",s:"techStoneMining"}),d.cathedral.icons.cut=P({c:"createCrusaders"}),c.magicgateway.icons.cut=P({o:"createOrk",d:"createDwarf",g:"createGhost",s:"createSkeleton"}));e=[d.knight,k.horsesamurai,g.cavalry,
g.enichar,d.crusader,k.chariot,k.horsearcher,g.horsearcher];f=[k.horsesamurai,d.crusader,g.enichar];n=[d.knight,g.cavalry,k.chariot,k.horsearcher,g.horsearcher];l=[d.longbowman,g.archer,k.archer,d.archer];r=[c.catapult,c.ballista,c.heavycatapult];h=[c.galleon,c.hulk,c.pinque,c.fishingboat];u=[c.galleon,c.hulk,c.pinque];p=[g.satrap,d.maceman];var v=[d.longbowman,g.archer,k.archer,d.archer,k.horsearcher,g.horsearcher,c.pinque,c.watchtower,c.keeptower,c.guardtower],w=[c.stonegolem,c.ork,c.dwarf,c.skeleton,
c.ghost,c.dragon,c.jinn,c.bat,d.wizard,g.mage,k.mage],x=[d.peasant,k.peasant,g.peasant,d.footman,g.footman,k.ronin,d.pikeman,g.spearman,g.satrap,d.maceman,g.cavalry,g.jihadwarrior,c.spy,g.enichar,k.horsesamurai,k.monk,k.chariot,k.ninja,c.stonegolem,c.ork,c.dwarf,c.jinn,c.skeleton,c.ghost,d.knight,d.crusader],y=[c.watchtower,c.keeptower,c.guardtower,c.cannontower],A=[c.cannontower,k.rockettower],z=[d.cathedral,d.castle,c.woodenwall,d.barracks,d.lumbermill,d.magetower,d.warriorsguild,d.storage,d.farm,
d.merchantsguild,d.church,d.blacksmith,d.stable,d.workshop,d.tavern,d.house,c.watchtower,d.market,d.outpost,c.bridge,d.harbor,c.guardtower,c.keeptower,c.cannontower,k.rockettower,k.castle,g.castle,k.barracks,g.house,g.lumbermill,g.storage,g.farm,g.harbor,g.blacksmith,g.workshop,g.church,g.tavern,g.market,g.barracks,g.stable,g.outpost,g.mosque,g.mageguild,g.merchantsguild,g.warriorsguild,g.magicworkshop,k.house,k.lumbermill,k.storage,k.farm,k.harbor,k.blacksmith,k.workshop,k.monastery,k.tavern,k.market,
k.stable,k.outpost,k.shaolinn,k.mageguild,k.merchantsguild,k.warriorsguild],D=[d.cathedral,d.castle,c.woodenwall,d.barracks,d.lumbermill,d.magetower,d.warriorsguild,d.storage,d.farm,d.merchantsguild,d.church,d.blacksmith,d.stable,d.workshop,d.tavern,d.house,c.watchtower,d.market,d.outpost,c.bridge,d.harbor,k.castle,g.castle,k.barracks,g.house,g.lumbermill,g.storage,g.farm,g.harbor,g.blacksmith,g.workshop,g.church,g.tavern,g.market,g.barracks,g.stable,g.outpost,g.mosque,g.mageguild,g.merchantsguild,
g.warriorsguild,g.magicworkshop,k.house,k.lumbermill,k.storage,k.farm,k.harbor,k.blacksmith,k.workshop,k.monastery,k.tavern,k.market,k.stable,k.outpost,k.shaolinn,k.mageguild,k.merchantsguild,k.warriorsguild],C=[c.catapult,c.heavycatapult],F=[d.pikeman,g.spearman],H=[k.monk,k.priest],E=[c.woodenwall],M=[d.peasant,k.peasant,g.peasant],J=[d.wizard,g.mage,k.mage],T=[d.footman,g.footman,k.ronin],U=[d.priest,g.priest,k.priest];Jb={bless:{img:m.bless,d:0,mv:1},star:{img:m.star,d:0,mv:1},heal:{img:m.healing,
d:0,mv:1},impersonate:{img:m.impersonate,d:0,mv:1},select:{img:m.select,d:0,mv:0,select:1,z32:.8},spawn:{img:m.spawn,d:0,mv:1},curse:{img:m.curse,d:0,mv:1},turnStone:{img:m.turn_to_stone,d:0,mv:1}};var ba=function(b,c,d){for(var g=b.length,e=0,f=c.length;e<f;e++)for(var k=0;k<g;k++)hd[b[k].type][c[e].type]=d};ba(A,u,4);ba(u,u,3);ba(u,D,3);ba(u,y,3);ba(u,E,5);ba(u,r,2);ba(C,D,4);ba(C,h,4);ba(C,y,6);ba(C,r,4);ba(C,E,9);ba([k.samurai],f,.5);ba([k.samurai],n,.3);ba([k.ronin],M,1);ba(F,e,6);ba(T,F,1.5);
ba(T,l,1.5);ba(T,[g.jihadwarrior],1);ba([g.satrap],M,2);ba(p,r,1.5);ba(v,[c.dragon],.75);ba(v,[c.bat],1);ba(v,[d.pikeman],-.75);ba(v,p,1);ba(v,[k.chariot],-.3);ba(v,H,.5);ba(J,U,4);ba(U,J,3);ba(U,w,3);ba(x,[c.bat],-.2);ba(x,[c.dragon],-.5);ba([c.stonegolem],z,1);ba([c.dwarf],z,4);ba(w,[k.priest],-.5);bb={img:m.gath_point,x32:-10,y32:-10,d:0,mv:!0};cg=[bb];l=va;e=Object.keys(l);for(f=0;f<t.length;f++)for(r=t[f],n=0;n<e.length;n++)r[e[n]]=l[e[n]];e=[d.archer,d.longbowman,k.archer,k.horsearcher,g.archer,
g.horsearcher];f=[d.footman,d.maceman,d.knight,d.crusader,d.pikeman,g.jihadwarrior,g.cavalry,g.footman,g.enichar,d.peasant,g.peasant,g.satrap,g.spearman,c.spy,k.chariot,k.monk,k.samurai,k.ronin,k.horsesamurai,k.ninja,k.peasant,c.skeleton,c.ghost,c.ork,c.dwarf];n=[d.footman,d.maceman,d.knight,d.crusader,d.pikeman,g.jihadwarrior,g.cavalry,g.footman,g.enichar,d.peasant,g.peasant,g.satrap,g.spearman,c.spy,k.chariot,k.monk,k.samurai,k.ronin,k.horsesamurai,k.ninja,k.peasant,d.archer,d.longbowman,k.archer,
k.horsearcher,g.archer,g.horsearcher,d.wizard,g.mage,k.mage,d.priest,g.priest,k.priest,c.skeleton,c.ghost,c.ork,c.dwarf];B=[{name:["Longbow","Allows the production of longbowmen"],next:[b.createLongbowman],cost:[400,0,0,0],time:45,type:Z},{name:["Gold Mining","Increases gold production"],increase:2,value:"gold",cost:[400,0,0,0],time:20,type:Ta},{name:["Stone Mining","Increases stone production"],increase:2,value:"stone",cost:[400,0,0,0],time:20,type:Ta},{name:["Wood Cutting","Increases wood production"],
increase:2,value:"wood",cost:[400,0,0,0],time:20,type:Ta},{name:["Temper Iron","Increases hand-to-hand units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:f,next:[b.techHalberd],type:$a},{name:["Scale Armor","Increases unit's defense"],increase:1,value:"defence",cost:[400,0,0,0],time:30,group:n,next:[b.techChainMail],type:$a},{name:["Halberd","Allows the production of spear units"],next:[b.createPikeman,b.createPikeman2],cost:[400,0,0,0],time:30,type:Z},{name:["Domestication",
"Allows the production of cows"],next:[b.createCow],cost:[300,0,0,0],time:20,type:Z},{name:["Crop Rotation","Increases the production of fields"],increase:2,value:"food",cost:[400,0,0,0],time:20,type:Ta,next:[b.irrigation]},{name:["Chain Mail","Increases unit's defense"],increase:2,value:"defence",cost:[400,0,0,0],time:30,group:n,type:$a},{name:["Plate Armor","Allows the production of knights"],next:[b.createKnight],cost:[400,0,0,0],time:60,type:Z},{name:["Crossbow","Increases arrow units' attack power"],
increase:2,value:"attack",cost:[400,0,0,0],time:30,group:e,type:$a},{name:["Feudalism","Makes peasants cheaper"],cost:[300,0,0,0],time:30,decrease:[k.peasant,[0,0,8,0],d.peasant,[0,0,10,0],g.peasant,[0,0,10,0]],type:Lg,next:[b.techSlavery]},{name:["Architecture","Peasants build faster, and allows stone wall, gate and towers"],increase:.5,value:"buildSpeed",cost:[300,0,0,0],time:30,type:Ta,next:[b.upgradeStoneTower,b.techGreatWall,b.buildBridge]},{name:["Learning","Allows units to gather experience"],
increase:1,value:"experience",cost:[400,0,0,0],time:30,type:Ta,next:[b.buildAcademy,b.buildAcademy1,b.buildAcademy2]},{name:["Convert Resources",""],cost:[400,0,0,0],time:30},{name:["Map Making","Allows the production of galleons"],cost:[800,0,0,0],time:30,type:Z},{name:["Trade Routes","Allows trading"],cost:[400,0,0,0],time:30,type:Z,next:[b.techTradeTaxes]},{name:["Trade Taxes","Increases trade profit"],cost:[400,0,0,0],time:30},{name:["Usury","Allows the obtaining of loans in taverns"],cost:[300,
0,0,0],time:30,type:Pe,changeicon:38,next:[b.techBanking]},{name:["Supply Storage","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Ta,value:"popLimit",next:[b.techSeaFood]},{name:["Bribery","Allows the bribing of enemy units"],cost:[600,0,0,0],time:60,type:Z,next:[b.bribe]},{name:["Heroism","Allows unlimited experience"],cost:[500,0,0,0],time:30,increase:Infinity,value:"maxLevel",type:Ta,next:[b.techLeadership]},{name:["Warfare","Gain experience faster"],cost:[400,0,0,
0],time:30,type:Ta,increase:1,value:"experience",next:[b.techTactics]},{name:["Tactics","Gain experience faster"],cost:[800,0,0,0],time:30,type:Z,next:[b.buildDummy,b.techSunTzu]},{name:["Mercenaries","Allows the recruitment of units in taverns"],cost:[600,0,0,0],time:30,type:Pe,next:[b.techHeroes,b.createMercenaries],actvintv:[b.iniMercenaries]},{name:["Heroes' Quest","Allows the recruitment of heroes in taverns"],cost:[800,0,0,0],time:30,type:Pe,next:[b.techFame,b.createHeroes],actvintv:[b.iniHeroes]},
{name:["Fame","Recruit better units from taverns"],cost:[500,0,0,0],time:30,value:"fameTech",increase:1,type:Ta},{name:["Siege Tactics","Allows the production of heavy catapults"],cost:[1200,0,0,0],time:60,type:Z,next:[b.createHeavyCatapult]},{name:["Body Building","Increases unit's hit points at every new level"],cost:[800,0,0,0],time:60,value:"healthJump",increase:5,type:Ta},{name:["Espionage","Allows the production of a spy"],cost:[400,0,0,0],time:30,type:Z,next:[b.createSpy]},{name:["Fanaticism",
"Increases the building's resistance"],cost:[400,0,0,0],time:30,type:$a,group:[],increase:5,value:"resistance",next:[b.techCrusade,b.techJihad]},{name:["Crusade","Allows the preaching of a crusade"],cost:[1200,0,0,0],time:180,type:Z,next:[b.createCrusaders]},{name:["Inquisition","Increases priest attack"],cost:[400,0,0,0],time:30,type:$a,group:[d.priest,g.priest,k.priest],increase:5,value:"attack"},{name:["Healing","Allows healing of units"],cost:[400,0,0,0],time:30,next:[b.techMedicine,b.healing],
type:Z},{name:["Medicine","Allows remote healing of units"],cost:[500,0,0,0],time:30,value:"healingRange",increase:5,type:Ta},{name:["Bless","Temporarily increases unit attack skill"],cost:[400,0,0,0],time:30,type:Z,next:[b.bless]},{name:["Invisibility","Invisibility spell"],cost:[500,0,0,0],time:30,type:Z,next:[b.invisibility]},{name:["Bat","Researches bat summoning"],cost:[400,0,0,0],time:240,type:Z,next:[b.createBat]},{name:["Freeze","Freeze spell"],cost:[800,0,0,0],time:30,type:Z,next:[b.freeze]},
{name:["Lightning","Lightning spell"],cost:[400,0,0,0],time:30,type:Z,next:[b.lightning]},{name:["Stone Golem","Researches stone golem summoning"],cost:[800,0,0,0],time:120,type:Z,next:[b.createGolem]},{name:"Upgrade to Guard Tower",cost:[0,600,0,0],time:20,type:Md,obj:44,upgrade:1},{name:"Upgrade to Stone Tower",cost:[0,0,0,500],time:30,type:Md,obj:55,upgrade:1},{name:"Upgrade to Cannon Tower",cost:[0,0,0,500],time:30,type:Md,obj:56,upgrade:1},{name:["Buddhism"],cost:[400,0,0,0],time:30,type:Z,next:[b.buildCathedral1]},
{name:["Cannon Tower","Allows the building of cannon towers"],next:[b.upgradeCannonTower],cost:[400,0,0,0],time:30,type:Z},{name:["Engineering","Increases siege weapon's attack"],increase:5,value:"attack",cost:[400,0,0,0],time:30,group:[c.ballista,c.catapult,c.heavycatapult],type:$a},{name:["Great Wall","Makes stone walls, towers and gates stronger"],cost:[600,0,0,0],time:30,type:Z},{name:["Art of Riding","Allows the production of horse archers"],cost:[500,0,0,0],time:30,type:Z,next:[b.createHorseArcher1,
b.createHorseArcher2,b.techHorseManShip]},{name:["Irrigation","Increases field production"],increase:4,value:"food",cost:[400,0,0,0],time:30,type:Ta},{name:["Armored Chariot","Allows the production of armored chariots"],cost:[500,0,0,0],time:60,type:Z,next:[b.createChariot]},{name:["Meditation","Makes monks cheaper"],cost:[300,0,0,0],time:30,decrease:[0,0,50,0],type:Qe,next:[b.techPhilosophy],group:[k.monk]},{name:["Kung-Fu","Increases the attack of all kung-fu units"],cost:[400,0,0,0],time:30,type:$a,
increase:1,value:"attack",group:[k.peasant,k.ninja,k.monk,k.priest],next:[b.techMastery,b.techNinjas,b.techTournaments]},{name:["Tournaments","Allows sharing of experience between kung-fu units"],cost:[800,0,0,0],time:30,type:Z,next:[]},{name:["Philosophy","Allows the production of more experienced monks"],cost:[400,0,0,0],time:30,type:$a,increase:2,value:"level",group:[k.monk,k.priest],next:[b.createPriest1]},{name:["Ninjas","Allows the production of ninjas"],cost:[500,0,0,0],time:30,type:Z,next:[b.createNinja]},
{name:["Mastery","Allows priests to teach kung-fu units"],cost:[500,0,0,0],time:30,type:Z,next:[b.teach]},{name:["Concentration","Allows faster manna restoration"],cost:[600,0,0,0],time:80,type:Z,next:[b.techConfusion]},{name:["Confusion","Researches the Confusion spell"],cost:[400,0,0,0],time:30,type:Z,next:[b.confusion]},{name:["Whirlpool","Researches the Whirlpool spell"],cost:[300,0,0,0],time:30,type:Z,next:[b.whirlpool]},{name:["Dragon","Researches Dragon summoning"],cost:[800,0,0,0],time:300,
type:Z,next:[b.createDragon]},{name:["Turn to Stone","Researches the Turn to Stone spell"],cost:[300,0,0,0],time:30,type:Z,next:[b.turnToStone]},{name:["Flame Bolt","Researches the Flame Bolt spell"],cost:[400,0,0,0],time:30,type:Z,next:[b.techDragon,b.flameBolt]},{name:["Jewelry","Allows trading of items"],cost:[400,0,0,0],time:30,type:Z,next:[b.sellItems,b.buyItems]},{name:["Banking","Increases trade profit"],cost:[600,0,0,0],time:30,type:Z},{name:["Chemistry","Increases arrow units' attack power"],
cost:[500,0,0,0],time:30,type:$a,group:e,increase:1,value:"attack",next:[b.techGunPowder]},{name:["Sea Food","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Ta,value:"popLimit"},{name:["Gun Powder","Increases cannon tower's attack power"],cost:[500,0,0,0],time:30,type:$a,increase:10,value:"attack",group:[c.cannontower],next:[b.techRocketArrow]},{name:["Rocket Arrow","Allows the building of rocket tower"],cost:[800,0,0,0],time:30,type:Z,next:[b.buildRocketTower]},{name:["Bushido",
"Allows the production of horse samurai"],cost:[800,0,0,0],time:120,type:Z,next:[b.createHorseSamurai]},{name:["Leadership","Units around a hero gain experience"],cost:[600,0,0,0],time:30,type:Z,next:[b.techHonor]},{name:["Honor","Hero vs. hero attack bonus"],cost:[500,0,0,0],time:30,type:Z},{name:["Sun Tzu's Book","Increases the speed of learning"],cost:[800,0,0,0],time:30,type:Ta,increase:1,value:"experience"},{name:["Cow Poaching","Allows peasants to steal cows"],cost:[200,0,0,0],time:30,type:Ta,
increase:1,value:"stealCows"},{name:["Horsemanship","Makes mounted units cheaper"],cost:[500,0,0,0],time:30,type:Qe,mulp:.75,group:[k.horsearcher,g.cavalry,g.horsearcher]},{name:["Scimitar","Increases sword attack power and allows the production of satraps"],cost:[400,0,0,0],time:30,type:$a,increase:1,value:"attack",group:f,next:[b.createSatrap]},{name:["Jihad","Allows the production of Jihad Warriors"],cost:[1200,0,0,0],time:30,type:Z,next:[b.createJihad,b.convertJihad]},{name:["Magic Carpet","Researches Magic Carpet summoning"],
cost:[300,0,0,0],time:30,type:Z,next:[b.createCarpet,b.techJinn]},{name:["Magic Workshop","Allows the building of a magic workshop"],cost:[1200,0,0,0],time:180,type:Z,next:[b.buildMagicWorkshop]},{name:["Rain of Fire",""],cost:[800,0,0,0],time:60,type:Z,next:[b.fireRain]},{name:["Magic Vision","Researches the Magic Vision spell"],cost:[400,0,0,0],time:30,type:Z,next:[b.magicVision]},{name:["Necromancy","Researches the Raise the Dead spell"],cost:[400,0,0,0],time:30,type:Z,next:[b.raiseDead]},{name:["Jinn",
"Researches Jinn summoning"],cost:[600,0,0,0],time:300,type:Z,next:[b.createJinn]},{name:["Ore Enrichment","Increases mine production"],cost:[800,0,0,0],time:30,type:Ta,increase:1,value:"miningPerf"},{name:["Riding Horses","Increases the mounted units' attack and defense power"],cost:[500,0,0,0],time:30,type:Ci,values:["attack",2,"defence",1],group:[k.horsearcher,g.cavalry,g.horsearcher],next:[b.techJanissary]},{name:["Janissary","Allows the production of Janissaries"],cost:[1200,0,0,0],time:120,
type:Z,next:[b.createEnichar]},{name:["Slavery","Makes peasants cheaper"],cost:[200,0,0,0],time:30,decrease:[k.peasant,[0,0,7,0],d.peasant,[0,0,8,0],g.peasant,[0,0,8,0]],type:Lg}];Ej();b.buildMarket.disabled=1;Fj();n=0;for(h=t.length;n<h;n++)if(l=t[n],l.onbuild)for(d=l.onbuild,f=0,k=d.length;f<k;f++)g=d[f],g.obj.race==l.race&&(g.disabled=1,g.require=l.name,g.requireObj||(g.requireObj=[]),g.requireObj.put(l));f=0;for(k=B.length;f<k;f++)if(g=B[f],g.tech=1,g.id=f,g.next)for(d=g.next,r=0,n=d.length;r<
n;r++)l=d[r],l.disabled?(l.disabled++,l.require+=", "+g.name[0],l.requireObj.put(g)):(l.requireObj=[g],l.disabled=1,l.require=g.name[0]);f=0;d=t;for(k=d.length;f<k;Kk(d[f++]));}new ec("",[255,255,255],[0],!0)},t,hd,ph,bb,cg,Hd,qh=8,x=new Float32Array(16),tc=function(b,c,e,d,f,k,l){var g=t[b];if(k=k&&!g.instantBuild)this.built=!1;var h=H[c],m=h.mod[b],u=Object.keys(m);this.__proto__=g;this.kingdom=c;this.d=f;this.x32=e;this.y32=d;this.taskList=[];f=0;for(var w=u.length;f<w;this[u[f]]=m[u[f++]]);if(l)for(m=
Object.keys(l),f=0,w=m.length;f<w;this[m[f]]=l[m[f++]]);0<g.invMax&&(this.inventory=[]);g.build||(this.mv=1);l=h.technology.disabled;m=g.actvintv;this.workers=[];this.id=w=z.length;g.rndDirection&&(this.d=w*e%g.rndDirection);this.build||h.values.pop++;e=g.validator(e,d,g.space,c);if(e[1]){d=g.validator.dimension;u=e[0];if(k){d=ra;this.onbuild1=u;var v=Cb[c];f=0;for(g=u.length;f<g;f++)v[u[f]]=w}else for(f=0,g=u.length;f<g;d[u[f++]]=w);if(e[2])if(u=e[2],k){O(u);f=0;for(g=u.length;f<g;d[u[f++]]=w);this.onbuildValid=
u}else for(f=0,g=u.length;f<g;d[u[f++]]=0);}else return this.invalid=!0,!1;z[w]=this;mb[c][b].put(w);if(this.update&&!p.custom)for(b=this.update,f=0,w=b.length;f<w;f+=3)Fa({func:He,data:[this.id,b[f],b[f+1],b[f+2]]},b[f+2],1);if(m)for(b=0,g=m.length;b<g;b++)c=m[b],l[c.id]||c(this);k?(tb(this),A.kingdom==this.kingdom?pd(this,Qk):pd(this,Dg)):tb(this);this.level&&!this.potion&&xi(this);!this.standardFunc||this.func||p.editor||this.standardFunc(this);k=h.stats;k.unitCount[this.type]++;h=k.unitCount[this.type]-
k.unitCountDeath[this.type];h>k.unitCountMax[this.type]&&(k.unitCountMax[this.type]=h)},Hi=function(b){var c=H[b.kingdom];if(b.population){var g=b.population;c.values.popMax+=g;Ld(b.kingdom);for(var d=0;d<g;d++)c.checkPopArray()}if(b.onbuild)for(b=b.onbuild,g=c.technology,c=g.disabled,g=g.actived,d=0;d<b.length;d++){var f=b[d].id;g[f]||(g[f]=0);g[f]++;g[f]-1||(c[f]--,!c[f]&&na.actv[f]&&na(X.active))}},Wb=[],Y=new Float32Array(12),rh=function(b,c,e){var d=b.length;b[d]=c;b[d+1]=c+1;b[d+2]=c+2;b[d+
3]=c+1;b[d+4]=c+2;b[d+5]=c+3;b.changed=!0;e.typeBuffer=b;e.elemtId=d},pd=function(b,c){var g=c[3];if(c.noAlpha)d=oa;else{b.alpha=!0;var d=ma}if(b.typeBuffer!==d){if(c==Dg){if(ob.diplomacy[b.kingdom]){Eb(b);return}c=new Float32Array(Gb(qa[3*b.kingdom],qa[3*b.kingdom+1],qa[3*b.kingdom+2],g+1))}Eb(b);rh(d,b.bufferID,b)}h.bindBuffer(h.ARRAY_BUFFER,jb);h.bufferSubData(h.ARRAY_BUFFER,16*b.bufferID,c)},lc=function(b){var c=Mf(b,b.kingdom),g=c[0],d=c[1],f=c[2];c=c[3];var k=b.bufferID;Gj(g,d,f,c,b.bufferID);
1>c?(b.alpha=!0,g=ma):g=oa;b.typeBuffer!==g&&(Eb(b),rh(g,k,b));if(b.child&&(!1!==b.built||!b.build))for(var l=b.child,h=0,m=l.length;h<m;h++)k+=4,c=Mf(l[h],b.kingdom),g=c[0],d=c[1],f=c[2],c=c[3],Gj(g,d,f,c,k)},Mf=function(b,c){if(null!=b.rgb){var g=b.rgb;b=g[0];var d=g[1];c=g[2];g=g[3]}else ta[b.img][3]?(b=qa[3*c],d=qa[3*c+1],c=qa[3*c+2],g=2):(b.mMapcolor?(c=b.mMapcolor,b=c[0]/255,d=c[1]/255,c=c[2]/255):(b=qa[3*c],d=qa[3*c+1],c=qa[3*c+2]),g=1);return[b,d,c,g]},Hj=function(){if(Wb.length){var b=Wb[Wb.length-
1];Wb.length--}else b=qh,qh+=4;return b},tb=function(b,c,e,d){void 0==c&&(d=e=c=0);var g=ta[b.img],k=1;if(b.bufferID){var l=b.bufferID;k=0}else l=Hj();b.bufferID=l;var m=g[2]*b.d*6+4,r=g[4+m],n=g[5+m];m=g[0];var u=g[1];0<=u&&(u*=.001);var t=g.id+4*b.d*g[2],v=-1;b.mv&&(v=p.now());x[0]=t;x[1]=v;x[2]=m;x[3]=u;x[4]=t+1;x[5]=v;x[6]=m;x[7]=u;x[8]=t+2;x[9]=v;x[10]=m;x[11]=u;x[12]=t+3;x[13]=v;x[14]=m;x[15]=u;var w=32*b.x32,y=32*b.y32;m=32*b.y32;null!=b&&null!=b.z32&&(m*=b.z32);var A=oa;h.bindBuffer(h.ARRAY_BUFFER,
cd);h.bufferSubData(h.ARRAY_BUFFER,16*l,x);h.bindBuffer(h.ARRAY_BUFFER,qc);if(b.rotation){var z=b.rotation;z*=2*Math.PI;var B=.5*g[8];u=.5*g[9];g=-1*m;t=-B;v=-u;var D=0*Y.length;Y[D]=t*Math.cos(z)-u*Math.sin(z)+w;Y[D+1]=u*Math.cos(z)+t*Math.sin(z)+y;Y[D+2]=g;Y[D+3]=t*Math.cos(z)-v*Math.sin(z)+w;Y[D+4]=v*Math.cos(z)+t*Math.sin(z)+y;Y[D+5]=g;Y[D+6]=B*Math.cos(z)-u*Math.sin(z)+w;Y[D+7]=u*Math.cos(z)+B*Math.sin(z)+y;Y[D+8]=g;Y[D+9]=B*Math.cos(z)-v*Math.sin(z)+w;Y[D+10]=v*Math.cos(z)+B*Math.sin(z)+y;Y[D+
11]=g}else b.wh?(z=b.wh[0],B=b.wh[1],z-=r,B-=n,Y[0]=w,Y[1]=y,Y[2]=m,Y[3]=w+z,Y[4]=y,Y[5]=m,Y[6]=w,Y[7]=y+B,Y[8]=m,Y[9]=w+z,Y[10]=y+B):(Y[0]=w,Y[1]=y,Y[2]=m,Y[3]=w,Y[4]=y,Y[5]=m,Y[6]=w,Y[7]=y,Y[8]=m,Y[9]=w,Y[10]=y),Y[11]=m;h.bufferSubData(h.ARRAY_BUFFER,12*l,Y);v=Mf(b,b.kingdom);g=v[0];u=v[1];t=v[2];v=v[3];if(1>v||b.alpha)b.alpha=!0,A=ma;h.bindBuffer(h.ARRAY_BUFFER,jb);x[0]=g;x[1]=u;x[2]=t;x[3]=v;x[4]=g;x[5]=u;x[6]=t;x[7]=v;x[8]=g;x[9]=u;x[10]=t;x[11]=v;x[12]=g;x[13]=u;x[14]=t;x[15]=v;h.bufferSubData(h.ARRAY_BUFFER,
16*l,x);h.bindBuffer(h.ARRAY_BUFFER,xd);z=p.now();x[0]=c;x[1]=e;x[2]=d;x[3]=z;x[4]=c;x[5]=e;x[6]=d;x[7]=z;x[8]=c;x[9]=e;x[10]=d;x[11]=z;x[12]=c;x[13]=e;x[14]=d;x[15]=z;h.bufferSubData(h.ARRAY_BUFFER,16*l,x);k&&rh(A,l,b);if(b.child&&!1!==b.built)for(c=m,e=b.child.length,d=[],b.childLoc=d,k=0;k<e;k++){A=b.child[k];g=ta[A.img];m=g[2]*b.d*6+4;z=g[4+m];B=g[5+m];m=g[0];u=g[1];0<=u&&(u*=.001);t=g.id+4*b.d;v=-1;A.mv&&(v=1);x[0]=t;x[1]=v;x[2]=m;x[3]=u;x[4]=t+1;x[5]=v;x[6]=m;x[7]=u;x[8]=t+2;x[9]=v;x[10]=m;
x[11]=u;x[12]=t+3;x[13]=v;x[14]=m;x[15]=u;v=Mf(A,b.kingdom);g=v[0];u=v[1];t=v[2];v=v[3];D=w;var C=y;A.wh1&&(z=A.wh[0],B=A.wh[1]);A.center&&(D-=.5*~~(z-r),C-=.5*~~(B-n));l=Hj();h.bindBuffer(h.ARRAY_BUFFER,cd);h.bufferSubData(h.ARRAY_BUFFER,16*l,x);h.bindBuffer(h.ARRAY_BUFFER,jb);x[0]=g;x[1]=u;x[2]=t;x[3]=v;x[4]=g;x[5]=u;x[6]=t;x[7]=v;x[8]=g;x[9]=u;x[10]=t;x[11]=v;x[12]=g;x[13]=u;x[14]=t;x[15]=v;h.bufferSubData(h.ARRAY_BUFFER,16*l,x);m=A.z?32*A.z+c:c;h.bindBuffer(h.ARRAY_BUFFER,qc);Y[0]=D;Y[1]=C;Y[2]=
m;Y[3]=D;Y[4]=C;Y[5]=m;Y[6]=D;Y[7]=C;Y[8]=m;Y[9]=D;Y[10]=C;Y[11]=m;h.bufferSubData(h.ARRAY_BUFFER,12*l,Y);h.bindBuffer(h.ARRAY_BUFFER,xd);x[0]=0;x[1]=0;x[2]=0;x[3]=0;x[4]=0;x[5]=0;x[6]=0;x[7]=0;x[8]=0;x[9]=0;x[10]=0;x[11]=0;x[12]=0;x[13]=0;x[14]=0;x[15]=0;h.bufferSubData(h.ARRAY_BUFFER,16*l,x);m=1>v?ma:A.light?Da:oa;d.put(m);z=m.length;d.put(z);m[z]=l;m[z+1]=l+1;m[z+2]=l+2;m[z+3]=l+1;m[z+4]=l+2;m[z+5]=l+3;m.changed=!0}};ObjectsetupPhysics=function(b,c,e,d){var g=p.now(),k=b.bufferID;x[0]=c;x[1]=e;
x[2]=d;x[3]=g;x[4]=c;x[5]=e;x[6]=d;x[7]=g;x[8]=c;x[9]=e;x[10]=d;x[11]=g;x[12]=c;x[13]=e;x[14]=d;x[15]=g;h.bindBuffer(h.ARRAY_BUFFER,xd);h.bufferSubData(h.ARRAY_BUFFER,16*k,x);h.bindBuffer(h.ARRAY_BUFFER,null);if(b.tempChild)for(g=0,b=b.tempChild,k=b.length;g<k;ObjectsetupPhysics(b[g++],c,e,d));};var nh=function(b,c,e,d,f,k){cb[0]=b;cb[1]=c;cb[2]=e;cb[3]=b+d;cb[4]=c;cb[5]=e;cb[6]=b;cb[7]=c+f;cb[8]=e;cb[9]=b+d;cb[10]=c+f;cb[11]=e;h.bindBuffer(h.ARRAY_BUFFER,qc);h.bufferSubData(h.ARRAY_BUFFER,12*k,cb);
h.bindBuffer(h.ARRAY_BUFFER,null)},Gj=function(b,c,e,d,f){x[0]=b;x[1]=c;x[2]=e;x[3]=d;x[4]=b;x[5]=c;x[6]=e;x[7]=d;x[8]=b;x[9]=c;x[10]=e;x[11]=d;x[12]=b;x[13]=c;x[14]=e;x[15]=d;h.bindBuffer(h.ARRAY_BUFFER,jb);h.bufferSubData(h.ARRAY_BUFFER,16*f,x);h.bindBuffer(h.ARRAY_BUFFER,null)};ObjectsetupPosition=function(b,c,e){void 0==e&&(e=32);b.z32&&(c*=b.z32);var d=b.x32*e;e*=b.y32;b.wh?nh(d,e,c,b.wh[0]-ta[b.img][8],b.wh[1]-ta[b.img][9],b.bufferID):nh(d,e,c,0,0,b.bufferID);if(b.tempChild)for(c=b.tempChild,
d=0,e=c.length;d<e;d++){var g=c[d];g.x32=b.x32;g.y32=b.y32;ObjectsetupPosition(g,32*b.y32)}};ObjectindexHide=function(b){ObjectsetupPosition(b,NaN)};ObjectindexShow=function(b){var c=1;b.z32&&(c=b.z32);ObjectsetupPosition(b,32*b.y32*c)};var va={getRadix:function(){return Ra[this.zLevel]},checkMana:function(b,c,e,d){if(!this.mana)return!1;if(0>this.mana-b)return this.manaTask=[e.url,c,b],this.stay55(),b>this.manaMax&&d&&(this.blockedCost=d,c=this.setupChild(Jb.curse,1),this.blocked=2,this.blockedimg=
c,this.manaTarget=b,h.bindBuffer(h.ARRAY_BUFFER,jb),h.bufferSubData(h.ARRAY_BUFFER,16*this.bufferID,Ke),h.bufferSubData(h.ARRAY_BUFFER,16*c.bufferID,Ke)),!1;this.mana-=b;return!0}},mc=function(b,c){return p.editor?!0:b.freezed||b.confused?!1:H[b.spy||b.kingdom].control[c.spy||c.kingdom]};va.changeKingdom=function(b){mb[this.kingdom][this.type].quit(this.id);nc[this.id]&&(nc[this.id]=0,C.quit(this.id),0==C.length&&(na([]),ae(),Zb=-1),hh(this.id));this.kingdom=b;lc(this);this.childBuild&&(this.childBuild=
0);this.build&&!this.arrow||this.stay();mb[b][this.type].put(this.id)};va.aspettare=function(){this.getRadix()[this.x32+this.y32*D]=this.id;this.waiting=!0;ObjectsetupIMG(this,this.url.idle);ObjectsetupPhysics(this,0,0,0);xb(this,~~(32E3/this.spd))};va.addItem=function(b){var c=this.inventory;c&&(c[c.length]=b.id,b.sword||b.shield)&&(b.attack&&(this.attack+=b.attack),b.defence&&(this.defence+=b.defence))};va.showInventory=function(){If();for(var b=this.inventory,c=0;8>c;c++){var e=b[c];if(!e)break;
var d=La[c];d.style.backgroundPosition="0px "+48*e.iconID+"px";d.className="";xf[c]=null}};va.deleteItem=function(b){this.inventory.quit(b.id);this.attack-=b.attack;this.defence-=b.defence};va.useItem=function(b){48==b.type&&(this.health+=b.lives,this.health>this.maxHealth&&(this.maxHealth=this.health),this.inventory.quit(b.id))};va.onattack=function(b){!this.attack||this.freezed||this.death||this.func!=se.url&&this.func||Ec(b.id,[this.id],1)};ObjectsetupINTV1=function(b,c,e){this.data=c;this.func=
b.url;this.time=~~(.04*e);Fa(this,e);return e};va.setupINTV=function(b,c,e){this.funcObj=c;b.url||O(b,b.url);this.changeFunc(b.url);this.deleteWorker();xb(this,e);return e};va.damage=function(b,c){if(!(this.zolotoy||this.death||this.stoned)){this.defence&&(b-=this.defence);1>b&&(b=1);this.health-=b;c=H[c.kingdom].stats;c.dmgInflicted+=b;var g=H[this.kingdom].stats;g.dmgTaken+=b;1>this.health?(this.build?(g.buildsLosed++,c.buildsKilled++):(g.unitsLosed++,c.unitsKilled++),this.die()):aa(this.id,1)}};
var aa=function(b,c){if(nc[b]||!1===b)return b=C.length,1===b?(b=z[C[0]],X.stockActive==b&&b.inventory.length?(Oc(b.id,1,1),lj(b,1)):b.build?Ba(b,1):Oc(b.id,c)):1<b?ih(C,c):xj(ib),!0};va.setupSpellIMG=function(b){this.invisible&&od(this.id);this.url.spell&&ObjectsetupIMG(this,this.url.spell,1);b||Fa({func:Ij,data:this.id},Ja(this.img),1)};var Ij=function(b){b=z[b];b.death||b.stay()};va.setupChild=function(b,c,e){var d={x32:this.x32,y32:this.y32,d:b.d,img:b.img,mv:b.mv,parent:this.id,z32:b.z32};if((this.dix||
this.diy)&&!this.waiting){var g=.001*(p.now()-this.timestamp);d.x32+=this.dix*g/32-Math.sign(this.dix);d.y32+=this.diy*g/32-Math.sign(this.diy)}if(b.select){if(this.space)b=this.space[this.space.length-1],k=(this.space.length-1)/b;else{b=this.sSizex||1;var k=this.sSizey||1}this.z32&&(d.z32=this.z32);d.wh=[32*b-3,32*k-3];this.selectAnim=d}tb(d);g&&ObjectsetupPhysics(d,this.dix,this.diy,0);e&&(h.bindBuffer(h.ARRAY_BUFFER,jb),h.bufferSubData(h.ARRAY_BUFFER,16*d.bufferID,e));this.tempChild||(this.tempChild=
[]);this.tempChild.put(d);c||Ib.new(d,Ja(d.img),Jj);return d};var Jj=function(b){z[b.parent].tempChild.quit(b);Eb(b)};va.distance=0;ObjectsetupIMG=function(b,c,e,d){b.img=c;c=ta[c];var g=c[0],k=c[1];0<=k&&(k*=.001);d&&(k*=d);c=c.id+4*b.d*c[2];d=-1;1===e?d=p.now():0>e&&(d=1);e=d;b=b.bufferID;x[0]=c;x[1]=e;x[2]=g;x[3]=k;x[4]=c+1;x[5]=e;x[6]=g;x[7]=k;x[8]=c+2;x[9]=e;x[10]=g;x[11]=k;x[12]=c+3;x[13]=e;x[14]=g;x[15]=k;h.bindBuffer(h.ARRAY_BUFFER,cd);h.bufferSubData(h.ARRAY_BUFFER,16*b,x);h.bindBuffer(h.ARRAY_BUFFER,
null)};va.setupDir=function(b,c,e){b=Math.sign(b);c=Math.sign(c);b=3*(c-1)+(b+1);2==b?this.d=1:-6==b?this.d=5:0==b?this.d=7:-4==b?this.d=3:-1==b?this.d=2:1==b?this.d=0:-5==b?this.d=4:-3==b&&(this.d=6);e&&(this.d=(this.d+e)%8)};va.setupDirBuild=function(b){var c=U;1==b.health&&0==b.built&&(c=Cb[b.kingdom]);b=b.id;var g=D,d=this.x32+this.y32*g;c[d+g]==b?this.d=0:c[d-g]==b?this.d=4:c[d+1]==b?this.d=2:c[d-1]==b?this.d=6:c[d+g+1]==b?this.d=1:c[d-g+1]==b?this.d=3:c[d+g-1]==b?this.d=7:c[d-g-1]==b&&(this.d=
5)};va.spdMod=0;var Qg=function(b,c){c=c.length;for(var g=0;g<c;g++){var d=z[C[g]];d.build||(d.spd=b)}};va.changeFunc=function(b){var c=this.func;this.func=b;if(Cd){if(void 0!==this.workingOn)var g=z[this.workingOn];(c=ic[c])&&c.rule&&Kj(-1,this,c.rule,g);(b=ic[b])&&b.rule&&Kj(1,this,b.rule,g)}};va.stay=function(b){this.mv=1;this.time=void 0;this.changeFunc(void 0);this.diy=this.dix=0;this.c=void 0;this.xf=null;ObjectsetupPhysics(this,0,0,0);b||(this.stock&&0!==this.stock[0]?ObjectsetupIMG(this,this.img,
NaN):ObjectsetupIMG(this,this.__proto__.img,1),this.deleteWorker(),this.standardFunc&&2!==this.stop&&this.standardFunc(this))};va.stay55=function(){this.stock&&0!==this.stock[0]?ObjectsetupIMG(this,this.img,NaN):ObjectsetupIMG(this,this.__proto__.img,1);this.deleteWorker();this.standardFunc&&this.standardFunc(this)};var yl=[],Eb=function(b){b.elemtId&&(Lj(b.elemtId,b.typeBuffer),b.elemtId=void 0,b.typeBuffer=void 0)},Bi=function(b){if(b.childLoc){b=b.childLoc;for(var c=0,g=b.length;c<g;c+=2)Lj(b[c+
1],b[c])}},Lj=function(b,c){c[b]=NaN;c[b+1]=NaN;c[b+2]=NaN;c[b+3]=NaN;c[b+4]=NaN;c[b+5]=NaN;c.changed=!0;yl.put(b)};va.addWorker=function(b){this.workers.put(b.id);b.workingOn=this.id};va.deleteWorker=function(){this.workingOn&&(z[this.workingOn].workers.quit(this.id),this.workingOn=0);this.actionItem&&(this.actionItem=void 0);this.blockedAction()};va.blockedAction=function(b){var c=this.blocked;if(Mj[c])Mj[c](this,b)};var Mj={2:function(b,c){b.blocked=void 0;lc(b);Jj(b.blockedimg);b.blockedimg=void 0;
b.manaTarget=void 0;c||(H[b.kingdom].setupResources(b.blockedCost,-1),b.blockedCost=void 0)}},dj=function(b){return m.delay[-b[1]+b[0]-1]},Qd=function(b){var c=C.length;C.quit(b);if(c!=C.length){var g=z[b];g.selectAnim=void 0;c=0;for(g=g.tempChild;c<g.length;c++){var d=g[c];Eb(d);var f=g.length;g.quit(d);f!=g.length&&c--}nc[b]=void 0;0==C.length?ae():1==C.length?Oc(b):ih(C)}ib&&ib.id===b&&(ae(),ib.selectAnim&&(Eb(ib.selectAnim),ib.selectAnim=void 0),ib=void 0)};va.base=function(b){return Ra[this.zLevel][b]};
va.rbase=function(){return Ra[this.zLevel]};var qf,gh=function(b){Wb.put(b.bufferID);if(b.child){var c=0;b=b.childLoc;for(var g=b.length;c<g;c+=2)Wb.put(b[c][b[c+1]])}};va.die=function(b){if(!this.death){var c=D,g=this.id,d=this.kingdom,f=H[d];this.waitlist&&(f.unitLoading-=.5*this.waitlist.length);if(this.dieSound&&!p.editor){var k=this.dieSound;za(k[~~(k.length*Math.random())],this.x32,this.y32)}Qd(this.id);(this.freezed||this.invisible)&&lc(this);var l=this.x32,h=this.y32;this.death=1;1==this.zLevel&&
(qf[l+h*c]=1);this.c=void 0;var r=this.url.die||this.dimg;f.IA&&f.IA.valorateLost&&f.IA.valorateLost(this);if(this.food&&!p.editor){var n=100,u=this.food/n,t=~~u,v=~~((u-t)*n);for(k=0;k<u;k++){k==t&&v&&(n=v);var w=Fi(l,h),x=~~(w/c);w%=c;w=new tc(52,d,w,x,0);ObjectsetupIMG(w,m.item_meat);w.contain=[n,2,Tk]}}f.stats.unitCountDeath[this.type]++;k=this.x32;c=this.y32;b||p.editor?(Eb(this),gh(this)):r?(this.mv=!0,ObjectsetupIMG(this,r,1),b=ta[this.img],r=b[1],r=0>r?dj(b):1E3*b[0]/r,Fa({func:cj,data:this.id},
r-25,1),ObjectsetupPhysics(this,0,0,0),void 0!==this.dix&&(b=.001*(p.now()-this.timestamp),this.x32+=this.dix*b/32-Math.sign(this.dix),this.y32+=this.diy*b/32-Math.sign(this.diy))):this.dimgInfinity?(this.dimgRND&&(this.d=this.id%this.dimgRND),ObjectsetupIMG(this,this.dimgInfinity)):(Eb(this),gh(this));Bi(this);this.techStart&&Oe(0,[this.id]);ObjectsetupPosition(this,32*this.y32-36);this.x32=k;this.y32=c;this.build||f.values.pop--;this.population&&this.built&&(f.values.popMax-=this.population);h=
this.validator(l,h,this.space,this.kingdom);b=h[0];if(this.onbuild&&!p.editor)for(l=this.onbuild,r=f.technology,k=r.disabled,r=r.actived,c=0;c<l.length;c++)d=l[c].id,r[d]--,0===r[d]&&k[d]++;l=this.validator.dimension;k=0;for(r=b.length;k<r;k++)c=b[k],l[c]=Xb[c]?Xb[c]:0;if(1==this.health&&!this.built)for(c=Cb[this.kingdom],k=0,r=b.length;k<r;c[b[k++]]=void 0);if(h[2])for(b=h[2],k=0,r=b.length;k<r;k++)c=b[k],Xb[c]?(2<l[c]&&z[l[c]].die(1),l[c]=Xb[c]):(2<l[c]&&z[l[c]].die(),l[c]=0);mb[this.kingdom][this.type].quit(this.id);
if(this.workers){k=0;l=this.workers.slice(0);for(r=l.length;k<r;k++)h=z[l[k]],h.workingOn===g&&(h.workingOn=0,h.func!==Og.url&&h.stay());this.workers.length=0}this.deleteFromList&&(l=this.deleteFromList,l.quit(this),l.length||l.length0function(this));this.time=void 0;this.changeFunc(void 0);this.diy=this.dix=0;this.inventory&&0<this.inventory.length&&ld(this.id,this.inventory.slice(0));this.stock&&Ei(this);p.editor||(f.check(),Ld(this.kingdom),f.checkPopArray());this.deleteWorker()}};Array.prototype.quit=
function(b){b=this.indexOf(b);return-1<b?(this.splice(b,1),!0):!1};Array.prototype.add=function(b){0>this.indexOf(b)&&(this[this.length]=b)};var Oa=["European","Arab","Asian"];y={open:"Open",loading:"Loading...",systemAlert:"System Message",notEnough:"Not enough %s",ok:"OK",yes:"Yes",no:"No",secure:"Are you sure?",gold:"Gold",stone:"Stone",wood:"Wood",food:"Food",mana:"Manna",warning:"Warning",play:"PLAY",close:"CLOSE",gameClosed:"The game was canceled by the server.",loadgraphics:"Downloading graphics...",
waitImages:"Downloading graphics",wait:"Wait",audioproblem:"Your browser is not compatible with Web Audio",defeated:"DEFEATED",victorious:"VICTORIOUS",options:"OPTIONS",refresh:"Refresh",back:"BACK",paused:"PAUSED",chatMsg:"CHAT MESSAGE",disconnect:"Disconnect",playerDisconnected:"%s has disconnected!",connectionError:"Connection error",noP2P:"Engine not loaded",startingResources:"Starting Resources",mapSize:"Map Size",menu:"MENU",quit:"QUIT",continue:"Continue",backToGame:"BACK TO GAME",initializing:"Initializing...",
requires:"Requires",stop:"Stop",pickItems:"Pick items",move:"Move",stand:"Stand ground",explore:"Explore",patrol:"Patrol",guard:"Guard",extension:"Do you want download 'Tzared boost' extension?",errorLoading:"Error loading game.",waitingPlayers:"Waiting for players to connect",musicVolume:"Music Volume",soundVolume:"Sound Volume",common:"Common",popLimit:"Population limit reached",houseLimit:"Not enough houses",lightning:"Lightning",freeze:"Freeze",bless:"Bless",heal:"Heal",invisibility:"Invisibility",
dcm:"Dig, chop or mine",repair:"Repair building",menuBuild:"See what you can build",units:"Units",infinite:"Infinite",gameFull:"Sorry, the game is full.",terrainOption:"Terrain",playerDefeated:"%s has been defeated!",savegame:"SAVE GAME",loadRecord:"Recording",stats:"Stats",builds:"Builds",items:"Items",nature:"Nature",trees:"Trees",delete:"Delete",create:"Create",username:"Player Name",gameOptions:"GAME OPTIONS",nplayers:"Number of Players",gameName:"Enter Game Name",gamesFound:"Games Found",strSearch:"SEARCH| Search for existing games",
strCreate:"CREATE| Create a game",randomMap:"RANDOM MAP",strcusMap:"CUSTOM MAP",mapMaking:"Map Making",terrain:"Terrain",save:"SAVE",accept:"ACCEPT",team:"Team",color:"Colour",AI:"AI Assist",kingdom:"Kingdom",attack:"Attack",defence:"Defence",health:"Health",maxHealth:"Max health",playing:"Playing",waiting:"Waiting",joining:"Joining...",random:"Random",cancel:"CANCEL",rules:"Rules",events:"Events",actions:"Actions",objAction:"Object action",destroyObj:"Destroy object",defined:"Defined",undefined:"Undefined",
underAttack:"Attacked by",destroyed:"Destroyed by",captured:"Captured by",moving:"Moving",add:"Add",objOrder:"Order"};var wi={euro:"Lancelot Arthur Guivain Merlin Blackthorn Morin Golstuck Karambol Kelerick Rockmore Bridport Casevil Stirm Tonis Pelegrim Peresohn Pirk Pharn Gork".split(" "),arab:"Ibn Fadlan;Mohammad;Al Ferissa;Harun Al Rashid;Sindbad;Mellemad;Moarrac;Sakhavan;Bellefars;Mokhac;Norahz;Kerhetin;Maham;Dushesh;Direkh".split(";"),asia:"Ishida Toranaga Ichinzen Haiako Mozuki Hitachi Tosheba Harachiko Marasuma Korodzum Ishinghen Genghis Musa Echibo Ichikahr Yotokan Maraga".split(" "),
common:"Fistantilus Skenderbeg Raislin Tenis Morok Sokob Baras Haram Billihz Ynte Orgh Savael Birgos Savator Gandeh Gordor Fessh Gilmi Phergas".split(" ")},sh=[y.gold,y.wood,y.food,y.stone,y.mana],qd=function(b,c,e){e&&(b=b.replace("%d",e));return b.replace("%s",c)},sd={},Ej=lh,Oj=function(g){g--;var c=new XMLHttpRequest;c.open("GET","https://dl.dropboxusercontent.com/s/ssnjwy6sm462q89/dictionary.json?v1=1",!0);c.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");c.onreadystatechange=
function(){if(4==c.readyState&&200==c.status){var e=JSON.parse(c.response);Ej=function(){for(var b=t,c=0;c<b.length;c++){var d=b[c].name;e[d]&&(b[c].name=e[d][g])}for(c=0;c<B.length;c++)b=B[c],e[b.name[0]]&&e[b.name[1]]&&(b.name[0]=e[b.name[0]][g],b.name[1]=e[b.name[1]][g]);e=null};for(var d=[],f=0;0>f;f++)"undefined"!=typeof b[f]&&null!=b[f].tech&&(d.push(b[f].tech.name),Object.freeze(b[f].tech));for(f=0;f<d.length;f++)d[f][0]=e[d[f][0]][g],d[f][1]=e[d[f][1]][g];d=Object.keys(y);for(f=0;f<d.length;f++){var k=
d[f];void 0!=e[y[k]]&&(y[k]=e[y[k]][g])}Object.freeze(y);for(f=0;f<Oa.length;f++)Oa[f]=e[Oa[f]][g];for(f=0;f<0*sh.length;f++)sh[f]=e[sh[f]][g];Object.freeze(Oa);Nj()}};c.send()};0<A.lang&&(Oj(A.lang),Oj.translated=!0);var Nj=function(){for(var b=["refreshButton",y.refresh,"optionsButton",y.options,"startButton",y.play,"backButton",y.back,"closeButton",y.close,"quitButton",y.quit,"continueButton",y.continue],c=0,e=b.length;c<e;c+=2)for(var d=document.getElementsByClassName(b[c]),f=0,k=d.length;f<k;f++)d[f].innerHTML=
b[c+1];b=["alertok",y.ok,"sendMessageH2",y.chatMsg,"mapsizeOption",y.mapSize,"startingResourcesOption",y.startingResources,"goldWord",y.gold,"stoneWord",y.stone,"foodWord",y.food,"woodWord",y.wood,"gameMenu",y.menu,"infiniteWord",y.infinite,"backToGame",y.backToGame,"backToGameS",y.backToGame,"musicVolume",y.musicVolume,"soundVolume",y.soundVolume,"menueditor",y.menu,"terrainOption",y.terrainOption,"saveGame",y.savegame,"playrecord",y.loadRecord,"seeStats",y.stats,"selectBuilds",y.builds,"selectUnits",
y.units,"selectItems",y.items,"selectNature",y.nature,"gamesFound",y.gamesFound,"strSearch",y.strSearch.split("| ")[1],"strCreate",y.strCreate.split("| ")[1],"strRandomMap",y.randomMap,"strcusMap",y.strcusMap,"strMapEditor",y.mapMaking,"h2cusmap",y.strcusMap,"h2rndMap",y.randomMap,"mapProps",y.options,"mapRules",y.rules];c=0;for(e=b.length;c<e;c+=2)document.getElementById(b[c]).innerHTML=b[c+1]};Nj();var th,Mb={},$b,fg=function(){for(var b="mapx mapwidth goldRes goldValue woodRes woodValue foodRes foodValue stoneRes stoneValue infinity infiniteValue".split(" "),
c=0,e=b.length;c<e;c+=2){var d=document.getElementById(b[c+1]).value;O(d);"infinity"==b[c]?(d=document.getElementById(b[c+1]).checked,p[b[c]]=d):p[b[c]]=parseInt(d)}p.infinity&&(p.goldRes=Infinity,p.foodRes=Infinity,p.woodRes=Infinity,p.stoneRes=Infinity);p.mapy=p.mapx;p.gravity=parseFloat(document.getElementById("mapgravity").value)*(580.9/9.8);p.name="";p.arje=555555*Math.random()+1;O(p.arje,"arje")},sk=function(){p.online&&(Pj(y.initializing),p.editor=0);p.mapx||fg();p.pausedTime=0;p.canceled=
0;for(var g=Object.keys(b),c=H.length,e=0,d=g.length;e<d;e++){var f=b[g[e]];f.id=e;if(f.disabled)for(var k=0;k<c;H[k++].technology.disabled[e]=f.disabled);if(f.hidden)for(k=0;k<c;H[k++].technology.hidden[e]=1);}var l=performance.now();oc=document.getElementById("msgs1");p.online||(location.hash="");sa("playermenu");sa("index");db("menu");db("statButton");sa("mapeditorinfo");sa("mapeditorinfotop");db("resources");ob=H[A.kingdom];We(A.kingdom);th||(th=JSON.parse(JSON.stringify(H.slice(1))));setTimeout(function(){p.cycle?
p.deltaTime=25*p.cycle:(p.players=H.length-1,p.date=Date.now(),p.cycle=0,p.kingdoms=H,p.deltaTime=0);p.loadDate=Date.now();p.online||ah();p.now=ni;p.paused=0;p.pausedTime=0;p.zMax=96*p.mapy;yb();performance.now();p.allow14=!0;D=p.mapx;Aa=p.mapy;p.temperature=25;var c=p.temperature;0==A.temperature&&(c+="&deg;C");document.getElementById("temperature").innerHTML=c;fa=1;zl();ae();qf={};var d=D;c=-d;d=+d;Za=[1,1+c,c,-1+c,-1,-1+d,d,d+1];oi=[c,-1,1,d];p.online&&db("content");c=["chat","loading","playermenu",
"index"];d=c.length;for(var g=0;g<d;document.getElementById(c[g++]).style.display="none");w("loadingtext").innerHTML="Loading terrain";c=performance.now();if(!1!==p.arje)if(p.terrain)$b=new Int8Array(p.terrain);else{d=performance.now();var e=D,f=e*Aa,k=Math.sqrt(f),t,B,C=0,E,I;g=new Int8Array(new ArrayBuffer(f));var G=new Uint32Array([2,3,0,1,1,1,0,1,0,1,0,1,1,1,1,0,0,15,0,1]);for(Yk(p.arje);C<f;g[C++]=0);var L=G.length;for(C=0;C<L;C+=4)G[C+3]&&(G[C+1]=~~(k/G[C+1]));for(E=0;E<L;E+=4){var M=G[E+1];
var J=G[E];var P=G[E+2];for(C=0;C<M;C++){var X=~~(ia()*f+.5);var R=6*ia()-3;var Y=6*ia()-3;if(P){var S=ia()*k;var ba=~~(ia()*(k/15))+4;var W=~~(100*ia())/4;var Z=ba/12}else S=128*ia(),ba=~~(2.56*ia())+4,W=~~(100*ia())/2,Z=1;var aa=X%e;X=~~(X/e);for(I=0;I<S;I++)for(100*ia()>W&&(R=(6*ia()-3)*Z,Y=(6*ia()-3)*Z),aa+=R,X+=Y,t=0;t<ba;t++)for(B=0;B<ba;B++)if((t-ba/2)*(t-ba/2)+(B-ba/2)*(B-ba/2)<ba*ba/4){var ea=~~aa+t+(B+~~X)*e;ea>=f?ea%=f:0>ea&&(ea+=f);g[ea]=J}}}e=performance.now();O("randomtxt1",e-d);O("drawTerrain: ",
performance.now()-e);$b=g}else $b=new Int8Array(new ArrayBuffer(p.mapx*p.mapy));Mb.randomtxt=performance.now()-c;O("randomtxt: ",Mb.randomtxt);c=performance.now();w("loadingtext").innerHTML="Creating map";d=D*Aa*4;U=new Uint32Array(d);ra=new Uint32Array(d);Tc=new Uint32Array(d);V.dimension=U;ce.dimension=ra;Cj.dimension=U;Dj.dimension=ra;Q.dimension=U;Lf.dimension=Tc;Lb.dimension=ra;Kf.dimension=U;Ra[0]=ra;Ra[1]=U;Ra[2]=Tc;Mb.createMap=performance.now()-c;O("createMap: ",Mb.createMap);w("content").style.display=
"block";c=performance.now();O(p.allunits);if(!1!==p.arje)if(p.allunits)F=p.allunits;else{d=$b;g=p.mapx;P=p.mapy;e=performance.now();R=g*P;E=Math.sqrt(R);F=[];td={};Y=Al;M=Bl;f=td;k=Cl;W=[12,63,62];aa=[];C=H.length;for(S=1;S<C;S++){G=!0;J=H[S];X=W[J.race];for(t=0;G&&25>t;){t++;Z=~~(ia()*(g-15)+.5)+4;ba=~~(ia()*(P-15)+.5)+4;G=!1;L=aa.length;for(J=0;J<L;J+=2)60>Math.sqrt((Z-aa[J])*(Z-aa[J])+(ba-aa[J+1])*(ba-aa[J+1]))&&(G=!0);G||(aa.push(Z+4,ba+3),Y(Z+ba*g,{type:X,kingdom:S}))}if(25==t){H.length=S;break}}W=
2*(C-1);C=1*~~(E/3.2);for(S=0;S<C;S++)for(G=~~(ia()*g+.5),L=~~(ia()*P+.5),X=~~(25*ia())+10,t=~~(25*ia())+10,J=0;55>J;J++)Z=~~(ia()*X+~~(G+18*ia()-9)+.5),ba=~~(ia()*t+~~(L+18*ia()-9)+.5),Z+=ba*g,M(Z)&&Z<=R&&Y(Z,{type:7,d:~~(28*ia()+3)});C=40*~~(E/256);for(S=0;S<C;S++){Z=~~(ia()*R+.5);P=oh[~~(ia()*oh.length)];J=Object.assign({},P);J.d+=~~(P.dMax*ia());if(P.sword||P.potion)J.attack=~~(6*ia())+1;if(P.shield||P.potion)J.defence=~~(6*ia())+1;P.book&&(P=~~(ia()*Nf.length),J.spell=Nf[P],J.iconID=b[Nf[P]].iconIDbook,
J.name=y[J.spell],J.attack=~~(6*ia())+1);Y(Z,J)}C=3*~~(E/256);for(S=0;S<C;S++)Z=~~(ia()*R),M(Z)&&Y(Z,{type:43});P=!!p.infinity;for(J=0;J<W*(1-P);J+=2)M=2*Math.round(ia())-1,S=aa[J]+10*(2*Math.round(ia())-1)+~~(3*ia()),E=aa[J+1]+10*M+~~(3*ia()),C=aa[J]+10*(2*Math.round(ia())-1)+~~(3*ia()),M=aa[J+1]+10*-M+~~(3*ia()),0>S?S=0:S+4>D&&(S-=(S+4)%R),0>E?E=0:E+4>Aa&&(E-=(E+4)%R),0>C?C=0:C+4>D&&(C-=(C+4)%R),0>M?M=0:M+4>Aa&&(M-=(M+4)%R),Y(S+E*g,{type:21}),Y(C+M*g,{type:22});for(J=0;J<W;J+=2)for(S=aa[J]-25,E=
aa[J+1]-25,C=0;50>C;C++)for(M=0;50>M;M++)625>(C-25)*(C-25)+(M-25)*(M-25)&&(R=C+S+(M+E)*g,7===k(R).type&&(f[R].cancell=1),1===cc.type[d[R]]&&(d[R]=0));O("random:",performance.now()-e);Mb.random=performance.now()-e}else F=[];p.movtable&&!p.demo&&(Gc=p.movtable,Hc=p.movtable2);d=performance.now();w("loadingtext").innerHTML="Loading textures";nk($b);Mb.setupGL=performance.now()-d;O("setupGL: ",Mb.setupGL);d=performance.now();e=$b;f=cc.type;k=D*Aa;for(g=0;g<k;g++)f[e[g]]?(ra[g]=1,U[g]=1,Xb[g]=1):0>e[g]&&
(Xb[g]=2,ra[g]=2,U[g]=2);e=F;p.custom||(p.ini=e);p.demo&&(e=p.ini);g=0;for(f=e.length;g<f;g++)W=e[g],W.death?z.put(W):W.cancell||(k=W.x32,aa=W.y32,R=!1===W.built&&1===W.health?!0:!1,Y=W.kingdom||0,W=new tc(W.type,Y,k,aa,0,R,W),R||Hi(W),W.castle&&(H[Y].origin=[k+4,aa+3]));td=F=null;O("positioned:",performance.now()-d);Mb.positioned=performance.now()-d;Mb.setupGL=performance.now()-c;O("setupGL: ",Mb.setupGL);tb(bb);tb(N);Ld(A.kingdom);gj();g=window.innerWidth-A.mx;c=window.innerHeight;(d=H[A.kingdom].origin)?
(g=32*d[0]-.5*g,c=32*d[1]-.5*c):c=g=0;Ad(~~g,~~c);window.addEventListener("keydown",qj);window.addEventListener("keyup",rj);window.addEventListener("mousemove",sj);T=hb;ja=new Float32Array(12);c=ta[m.blank].id;x[0]=c;x[1]=0;x[2]=1;x[3]=0;x[4]=c;x[5]=0;x[6]=1;x[7]=0;x[8]=c;x[9]=0;x[10]=1;x[11]=0;x[12]=c;x[13]=0;x[14]=1;x[15]=0;c=ma;c[0]=0;c[1]=1;c[2]=2;c[3]=1;c[4]=2;c[5]=3;h.bindBuffer(h.ARRAY_BUFFER,cd);h.bufferSubData(h.ARRAY_BUFFER,0,x);h.bindBuffer(h.ARRAY_BUFFER,jb);g=3*A.kingdom;c=qa[g];d=qa[g+
1];g=qa[g+2];h.bufferSubData(h.ARRAY_BUFFER,0,new Float32Array([c,d,g,.5,c,d,g,.5,c,d,g,.5,c,d,g,.5]));c=96*D;ja[2]=c;ja[5]=c;ja[8]=c;ja[11]=c;window.addEventListener("mousedown",tj);window.addEventListener("mouseup",uj);O("FULL: ",performance.now()-l);p.record||(p.record={});p.online?(gd(pe(),y.waitingPlayers,1),A.admin?Vc():da(Vc,0,0)):Of();p.allow14=!1;Uc.list.push(0,JSON.stringify(Mb))},300)},pe=function(){for(var b=J.length,c=J,e="",d=0;d<b;d++)pe.obj[c[d].id]||c[d].id==A.onlineID||(e+="<br>"+
c[d].name);return e};pe.obj={};var Mh=function(){return A.gl?!1:(gd("You can't run WEBGL 2<br>More info <a href='http://webglreport.com/?v=2'>here</a>","Error"),Sb(),!0)},eg=!1,Cd,rk=function(b){var c={};Cd={events:{defined:c,nodefined:{}},list:[]};for(var g={moving:1},d=0,f=b.length;d<f;d++){var k=b[d];k.activeEvents=0;for(var l=k.events,h=0,m=l.length;h<m;h++){var n=l[h],p=n.list,t=n.by;n=n.type;for(var v=0,w=p.length;v<w;v++){var x=p[v];c[x]||(c[x]={});x=c[x];if(g[n])x[n]||(x[n]=[]),x[n].put(k);
else{x[n]||(x[n]={defined:{}});x=x[n].defined;for(var y=0,z=t.length;y<z;y++)x[t[v]]||(x[t[v]]=[]),x[t[v]].put(k)}}}}},gj=function(){var b=document.getElementById("playersinfo");b.innerHTML="";if(!p.editor)for(var c=1,e=H.length;c<e;c++){var d=H[c];O(d);var f=d.death?d.name.strike():d.name;b.innerHTML+=f+"<span id='score"+c+"'> 0/0</span><div class='playercolor' style='background:rgb("+d.color[0]+","+d.color[1]+","+d.color[2]+")'></div><br>"}},$d,yj,nj,zl=function(){var b=document.getElementById("selectedobject").getContext("webgl",
{antialias:!1,depth:!1}),c=b.createShader(b.VERTEX_SHADER);b.shaderSource(c,"void main() {\ngl_Position = vec4(0 ,0, 0, 1);\ngl_PointSize=48.0;\n}");b.compileShader(c);var e=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(e,"precision mediump float;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nuniform float txtCoord;\nvoid main() {\ngl_FragColor = texture2D(u_image, (vec2(\tmod(txtCoord,21.0) ,floor(txtCoord/21.0) ) + gl_PointCoord)*(0.046875));\nif(gl_FragColor.r==gl_FragColor.g&&gl_FragColor.r==gl_FragColor.b) gl_FragColor*=u_color;\n}");
b.compileShader(e);var d=b.createProgram();b.attachShader(d,c);b.attachShader(d,e);b.linkProgram(d);b.useProgram(d);c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texImage2D(b.TEXTURE_2D,0,b.RGB,b.RGB,b.UNSIGNED_BYTE,X.icons);var f=b.getUniformLocation(d,"u_color"),
k=b.getUniformLocation(d,"txtCoord");$d=function(c){if(ta[c.img][3]){var d=c.kingdom;b.uniform4f(f,qa[3*d],qa[3*d+1],qa[3*d+2],1)}else b.uniform4f(f,1,1,1,1);b.uniform1f(k,c.iconID);b.drawArrays(b.POINTS,0,1)};yj=function(){b.uniform4f(f,1,1,1,1);b.uniform1f(k,189);b.drawArrays(b.POINTS,0,1)};nj=function(){b.uniform1f(k,0);b.uniform4f(f,0,0,0,0);b.drawArrays(b.POINTS,0,1)}},Pb=128,Xa=128,z=[{terrain:1},{terrain:1},{terrain:1}],Xb={},Ld=function(b){b===A.kingdom&&(b=ob.values.popMax<ob.values.popLimit?
ob.values.popMax:ob.values.popLimit,document.getElementById("pop").innerHTML=ob.values.pop+"/"+b)};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();var td=F=void 0;var Al=function(b,c){td[b]||(c.x32=b%D,c.y32=~~(b/Aa),F.put(c),td[b]=c)},Bl=function(b){return!F[b]},Cl=function(b){return td[b]||NaN},Ma=[],uh=function(){O("123");Qa.leaveRoom();Ma.length=0},ud={};
(function(){for(var b=["returnmenu","index","Account","accountIframe"],c=0,e=b.length;c<e;ud[b[c]]=document.getElementById(b[c++]));})();var Dl=function(){location.replace("#"+this.gameID+"Room")},Sh=function(b){Ma=[];O("connecting to",b,y.loading);w("game").style.display="block";w("gameName").innerHTML=y.loading;w("returnmenu").style.display="none";w("index").style.display="none";pc.innerHTML="";oc.innerHTML="";A.p2p?Qa.joinRoom(b,hg):(Qa||gc(),gc.func=function(){Sh(b)})},El=function(b){w("game").style.display=
"none";J.length=0;p.online=0;uh();Sb();b.constructor==String&&gd(b)},fj={euro:0,arab:0,asia:0},Ph=function(b,c,e){if(e){c=vh(e.id);var d=c[1];c=c[0];b=Va(b);c.username||(Qj[d].innerHTML=b,c.name=b,e.username=b,Pj(y.joining,b,1E3))}},qb=function(b,c){if(c.resend)if(b.destinatary)(c=Wc(b.destinatary))&&c.id!=A.onlineID&&(b.bridge=k.id,c.send(b));else{c=c.resend;for(var g=0,d=c.length;g<d;g++){var f=c[g];b.bridge=k.id;f.send(b)}}else{var k=c;b.bridge&&(k=Wc(b.bridge));if(void 0===b.length){if(void 0!==
b.func)(0,Je[b.func])(b[1],b[2],k)}else c=b[0],k.orderList[c]=b,qb.done[c]||(qb.done[c]=0),qb.done[c]++,qb.done[c]==Ma.length&&qb.func&&(qb.func=!1,Cg(),yb())}};qb.done=[];var Xc=function(b,c,e){e&&(O(e.id,"CAN connect"),Xc.ids[b]||(Xc.ids[b]=1,A.admin||clearTimeout(Xc.intv[b]),O("MAKE BRIDGE"),Wc(b).bridge=e,da(Rj,b,0,[e],0)))};Xc.ids={};Xc.intv={};var Rj=function(b,c,e){e&&(O("BRIDGE"),e.resend||(e.resend=[]),e.resend.put(Wc(b)))},Wc=function(b){for(var c=0,g=Ma.length;c<g;c++){var d=Ma[c];if(d.id==
b)return d}},Qa,Sj=function(b){if(!w("usernameForm")){dc();var c=localStorage.username||"",g=localStorage.color||"#"+Math.floor(16777215*Math.random()).toString(16),d=document.createElement("div");d.id="usernameForm";d.innerHTML="\n            <div>\n            <h2>"+y.username+'</h2>\n            <div>\n<input type="color" id=\'usernameColor\' value="'+g+'" /><input id=\'usernameVal\' type="text" value="'+c+'" />\n</div>\n<br />\n</div>';c=document.createElement("button");c.innerHTML=y.continue;
c.onclick=function(){A.name=Va(w("usernameVal").value);A.color=w("usernameColor").value;localStorage.color=A.color;localStorage.username=A.name;document.body.removeChild(w("usernameForm"));b();kb()};d.children[0].appendChild(c);document.body.appendChild(d)}},gc=function(){Mh()||("Guest"!==A.name&&A.name?(Qa=new SimpleWebRTC({localVideoEl:"",remoteVideosEl:"",autoRequestMedia:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},url:"https://solar.tza.red/"}),Qa.on("channelMessage",function(b,
c,e){"nehhof"==e.type&&(c=JSON.parse(e.payload),qb(c,b))}),Qa.on("error",function(b){"full"==b&&(Sb(),$h(y.gameFull,"#ff0000"))}),Qa.on("connectionReady",function(b){var c=Qa.connection.connection;A.p2p=c;c.username=A.name;c.color=A.color;c.on("getRooms",function(b){var c=Object.keys(b),g=w("gameList");if(0<c.length){g.innerHTML="";for(var e=0,l=c.length;e<l;e++){var h=c[e],m=b[h],n=m.len;if(n){var p=document.createElement("tr"),t="";t=m.playing?t+("<td><div class='redCircle'></div>"+y.playing+"</td>"):
t+("<td><div class='redCircle' style=\"background:rgba(0,255,0,.8)\"></div>"+y.waiting+"</td></td>");t+="<td>"+Va(m.description)+"</td><td>"+~~((Date.now()-m.date)/6E4)+" min ago</td><td>"+Va(n)+"/"+Va(m.max)+"</td>";p.innerHTML=t;p.gameID=h;m.playing||(p.onclick=Dl);g.appendChild(p)}}}else g.innerHTML="<tr><td>No games found</td></tr>"});A.onlineID=b;gc.func&&gc.func()}),Qa.on("createdPeer",function(b){p.started||tk(b)})):Sj(gc))},Fl=function(){kb();w("game").style.display="block";w("gameName").innerHTML=
y.loading;w("returnmenu").style.display="none";w("index").style.display="none";pc.innerHTML="";oc.innerHTML="";Ma=[];Qh();A.admin=1;A.room={description:w("gameFormName").value,max:parseInt(w("gameMax").value),public:!0};2>A.room.max&&(A.room.max=2);14<A.room.max&&(A.room.max=14);localStorage.gameDescription=A.room.description;Qa.createRoom(A.onlineID+"b",hg);p.online=1;document.body.removeChild(w("gameForm"))},Tj=function(){Qa||gc();if(A.onlineID){dc();var b=localStorage.gameDescription||A.name+"'s room",
c=document.createElement("div");c.id="gameForm";c.innerHTML="\n<div>\n            <h2>"+y.gameOptions+"</h2>\n            "+y.gameName+': <input id=\'gameFormName\' type="text" value="'+b+'" maxlength="29" /><br />\n'+y.nplayers+': <input id="gameMax" type="number" value="6" max="14" min="2"/><br />\n            </div>';b=document.createElement("button");b.innerHTML=y.continue;b.onclick=Fl;c.children[0].appendChild(b);document.body.appendChild(c)}else setTimeout(function(){location.hash=""},200),
gc.func=Tj},Uj=function(b,c){c=JSON.stringify(c);b.sendDirectly("channelMessage","nehhof",c)},qe=[],da=function(b,c,e,d,f){var g;if(!0===f&&p.online&&Ma.length)e.change&&(e=e.slice(0)),Ga(function(){da(b,c,e,d,55)});else if(void 0===b.location)b();else{if(p.started&&!p.editor){var l=p.record;l[p.cycle]||(l[p.cycle]=[]);var h=l[p.cycle];l=h.length;h[l]=b.location;h[l+1]=c;e.length&&(e=e.slice(0));h[l+2]=e}if(p.online&&Ma.length)if(55===f&&(g=!1),h={func:b.location,1:c,2:e,active:g,rnd:4294967296*Math.random()},
p.started&&b!=yb&&b!=Of&&b!=Bb)if(d)for(l=0,g=d.length;l<g;l++)f=d[l],h.destinatary=f.id,f.bridge?Uj(f.bridge,h):Uj(f,h);else qe.put(h);else wh(h),b(c,e);else b(c,e)}},Gl=function(){if(Ma.length){fg();Vc.i=0;A.p2p.emit("gameStarted");for(var b={},c=0,e=J.length;c<e;c++)b[J[c].id]=c;da(xh,p,b,0,0)}},Vc=function(b,c,e){e&&(pe.obj[e.id]=1,b=pe(),""==b?gd(b,y.loading,1):gd(b,y.waitingPlayers,1));A.admin&&(Vc.i++,Vc.i==J.length&&setTimeout(function(){da(Of,0,0,0,!0)},100))};Vc.i=0;var wh=function(b){b=
JSON.stringify(b);for(var c=0,e=Ma.length;c<e;c++)Ma[c].sendDirectly("channelMessage","nehhof",b)},Yc,yh,Cg=function(){if(!qb.done[Yc]||qb.done[Yc]<Ma.length)return qb.func=!0,yb(),!0;for(var b=0,c=J.length;b<c;b++){var e=Wc(J[b].id);if(b==A.kingdom-1)var d=yh;else{if(!e)continue;d=e.orderList[Yc]}for(var f=1,k=d.length;f<k;f++){var l=d[f];Je[l.func](l[1],l[2],e)}}qb.func=!1;wh(qe);yh=qe;Yc++;qe=[Yc+1];return!1},Of=function(){document.getElementById("alert").style.display="none";p.started=1;p.date=
Date.now();yb();Ia();kb();Yc=0;if(!p.custom||p.demo)for(var b=1,c=H.length;b<c;b++){var e=ub[$g[H[b].race]],d=e.peasant.type;if(e=z[mb[b][e.castle.type][0]])Jc(d,e,1),Jc(d,e,1),Jc(d,e,1)}wb.arr=[];wb.units=[];wb.time=500;wb.steps=0;wb.process=0;if(!p.editor&&!p.demo){for(b=1;b<H.length;b++)H[b].IA&&Infinity==p.goldRes&&new wb(H[b]);b=0;c=wb.arr;for(d=c.length;b<d;c[b++].leaveMeAloneIKnowWhatToDo());xg()}p.online&&(wh([0]),qe=[1],yh=[0]);eb()},xh=function(b,c,e){if(e&&e.admin){e=[J[0]];for(var d=0,
g=J.length;d<g;d++)e[c[J[d].id]]=J[d];J=e}za("bless");p=b;p.infinity&&(p.goldRes=Infinity,p.woodRes=Infinity,p.foodRes=Infinity,p.stoneRes=Infinity);fd()},zd=!1,kb=function(){zd=!1;w("basic").style.filter="blur(0px)";setTimeout(function(){"blur(0px)"==w("basic").style.filter&&(w("basic").style.filter="")},500)},dc=function(){zd=!0;w("basic").style.filter="blur(94px)"};var Hl=function(){db("game");J.length=0;p.online=0;uh();Sb();A.admin=0};var hg=function(b){if(A.admin||b)if(b=Qa.roomName,b+="Room",
O("login"),kb(),0!==Qa.getPeers().length||A.admin){var c=A.room||NaN;O(b);p.id=b;p.online=1;Qh();db("chat");w("gameName").innerHTML=Va(c.description)||"Online Game";w("onlineID").value=location.origin+"/#"+p.id;sa("returnmenu");gg();A.admin?(location.replace("#"+p.id),w("buttons").innerHTML='<button id="startbutton">'+y.play+'</button><button id="optionbutton">'+y.options+'</button><button id="closebutton">'+y.close+"</button>",w("startbutton").onclick=Gl,w("optionbutton").onclick=Vj,w("closebutton").onclick=
Hl):(w("buttons").innerHTML='<button id="quitbutton">'+y.disconnect+"</button>",w("quitbutton").onclick=El);Qa.connection.on("remove",function(b){if(b=Wc(b.id))if(Bb(qd(y.playerDisconnected,b.username),0,5),p.online){if(p.started)for(var c=0;c<J.length;c++)if(J[c].id==b.id){H[c+1].die();break}Ma.quit(b);p.started?qb.done[Yc]==Ma.length&&qb.func&&(qb.func=!1,Cg(),yb()):(gg(),b.admin&&(Sb(),Qa.leaveRoom(),gd(y.gameClosed)))}})}else location.hash="",Sb()},Ga=function(b){Ga.func.put(b);0===Ga.active&&
(da(Wj,0,0,0,0),Ga.date=Date.now(),Ga.received=0,Ga.max=-Infinity,Ga.active=1)};Ga.func=[];Ga.active=0;var Wj=function(b,c,e){e&&da(Xj,0,0,[e],0)},zh={},Xj=function(b,c,e){if(e&&(e.ping=~~(.5*(Date.now()-Ga.date)+.5),zh[e.id]?zh[e.id].put(e.ping):zh[e.id]=[e.ping],e.ping>Ga.max&&(Ga.max=e.ping),Ga.received++,Ga.received==Ma.length)){b=performance.now();c=0;for(e=Ga.func.length;c<e;Ga.func[c++]());O(-b+performance.now());Ga.func.length=0;Ga.active=0}},Ah=document.getElementsByClassName("ucolor"),Qj=
document.getElementsByClassName("username"),Bh=document.getElementsByClassName("race"),Pf=document.getElementsByClassName("team"),fc=document.getElementsByClassName("isconnected"),kg=function(b,c,e){e&&(c=vh(e.id),e=c[1],c=c[0],c.race=b%3,c.race||(c.race=0),Bh[e].innerHTML=Oa[c.race])},vh=function(b){for(var c=0,e=J.length;c<e;c++){var d=J[c];if(d.id==b)return[d,c]}},ig=function(b,c,e){if(e){O(b);c=b.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);c||(b="ffffff",c=["ffffff","ff","ff","ff"]);e.color=
b;e=vh(e.id);var d=e[1];e=e[0];Ah[d].style.background=b;e.color=[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]}},jg=function(b,c,e){b=parseInt(b);if(isNaN(b)||!b)b=0;(b%=5)||(b=0);if(e){c=e.id;e=0;for(var d=J.length;e<d;e++){var g=J[e];if(g.id==c){g.team=b;Pf[e].innerHTML=b;break}}}},gg=function(){O("setup MENU");var b=document.getElementById("multiplayertable");b.innerHTML="";for(var c=A.room?A.room.max:14,e=0;e<c;e++)b.innerHTML+='<tr><td class="ucolor"></td><td class="username">'+y.open+
'</td><td class="race"></td><td class="team"></td><td class="isconnected"></td></tr>';b=Qa.roomName;b=b.substr(0,b.length-1);var d=[A.p2p];e=0;for(c=Ma.length;e<c;e++){var f=Ma[e];f.admin?d.unshift(f):d.put(f)}for(c=0;c<d.length;c++){f=d[c];J[c]&&J[c].id==f.id?e=J[c]:(e=parseInt((f.color||"ffffff").substr(1),16),e={color:[e>>16&255,e>>8&255,e&255],ia:0,name:f.username,race:0,team:1,id:f.id,cID:c});f&&f.id?(fc[c].style.background="#00ff00",fc[c].style.boxShadow="0px 0px 30px 0px #00ff00"):(fc[c].style.background=
"#ff0000",fc[c].style.boxShadow="0px 0px 30px 0px #ff0000");Ah[c].style.background="rgb("+e.color[0]+","+e.color[1]+","+e.color[2]+")";Qj[c].innerHTML=e.name;e.id==b&&(f.admin=!0);if(A.onlineID==e.id){Pf[c].innerHTML="";f=document.createElement("button");f.onmousedown=Yj;f.iteam=c;f.innerHTML=e.team;Pf[c].appendChild(f);f=document.createElement("button");f.onmousedown=Zj;f.iteam=c;f.innerHTML=Oa[e.race];Bh[c].appendChild(f);f=document.createElement("input");f.type="color";var k=e.color;f.iteam=c;
f.value="#"+(16777216+(k[0]<<16)+(k[1]<<8)+k[2]).toString(16).slice(1);Ah[c].appendChild(f);f.onchange=ak;fc[c].style.background="#00ff00";fc[c].style.boxShadow="0px 0px 30px 0px #00ff00"}else Pf[c].innerHTML=e.team,Bh[c].innerHTML=Oa[e.race];J[c]=e}J.length=d.length},J=[];window.onhashchange=Rh;var oc=document.getElementById("msgs"),pc=document.getElementById("msgs1"),Qf=document.getElementById("msginput"),ch=document.getElementById("msginputGame"),bh=document.getElementById("enterwindow");Qf.addEventListener("keyup",
function(b){13==b.keyCode&&dh()});var Bb=function(b,c,e){za("chat");e&&(p.started?(c=pc,Rf()):c=oc,c.innerHTML=5!==e?c.innerHTML+("<li><span>"+e.username+" \u2014</span> "+Va(b)+"</li>"):c.innerHTML+("<li>"+b+"</li>"),c.scrollTop=c.scrollHeight)},Rf=function(){11==oc.children.length&&pc.removeChild(pc.children[0]);1==oc.children.length&&(Rf.intv=setInterval(function(){pc.children[0]&&(pc.removeChild(pc.children[0]),0==oc.children.length&&clearInterval(Rf.intv))},16E3))},Va=function(b){return String(b).replace(/</g,
"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},dh=function(){if(p.started){var b=pc,c=ch.value;ch.value="";Rf()}else b=oc,c=Qf.value,Qf.value="";""!=c&&(c=Va(c),b.innerHTML+="<li><span>"+A.name+" \u2014</span> "+c+"</li>",da(Bb,c,0,0,0),b.scrollTop=b.scrollHeight)},Je=[xh,Hb,Sd,Ec,Re,md,id,Uh,Vh,Bb,Fe,Pd,kd,kh,ld,Yd,Kg,Oe,Eg,Vc,yb,Wj,Xj,jg,pj,function(b,c,e){e&&(b=Wc(b))&&b.open&&(O("I CAN connect"),da(Xc,b.id,0,[e],0))},Xc,Rj,Of,wg,Tg,jf,Ug,Xi,Rg,Ve,Ye,sf,lf,Wg,bf,Gi,Vd,ig,function(b,c){c=
z[c];var e=b[0];b=b[1];var d=D;!1!==e&&(c.kx=e);!1!==b&&(c.ky=b);e=-(c.x32+e+(b+c.y32)*d);c.stop=c.kx||c.ky?!1:!0;Number.isInteger(c.xf)||Hb(e,[c.id])},Qg,Oi,Pi,kg,$e,Sg,uf,nf,Ti,wf,ff,df,pf,Yg,ij,Ui,ji,Ph];localStorage.favMusic&&(musicSelect.mversion.value=localStorage.favMusic);xh.antiHack=0;Hb.antiHack=0;Sd.antiHack=0;Ec.antiHack=0;Re.antiHack=0;md.antiHack=0;id.antiHack=0;Z.antiHack=0;Qe.antiHack=0;Ta.antiHack=0;$a.antiHack=0;Z.antiHack=0;Uh.antiHack=0;Vh.antiHack=0;Bb.antiHack=0;Fe.antiHack=
0;Pd.antiHack=0;kd.antiHack=0;Md.antiHack=0;kh.antiHack=0;ld.antiHack=0;Yd.antiHack=0;Kg.antiHack=0;Oe.antiHack=0;(function(){for(var b=Je,c=0,e=b.length;c<e;c++)b[c].location=c})();var Vj=function(){w("mapconfiguration").style.display="block";w("basic").style.filter="blur(94px)"},bk=document.getElementsByClassName("ucolor1"),Il=document.getElementsByClassName("username1"),Jl=document.getElementsByClassName("race1"),Kl=document.getElementsByClassName("team1"),Yj=function(b){var c=1;2==b.button&&(c=
-1);b=this.iteam;J[b].team+=c;0>J[b].team&&(J[b].team=0);this.innerHTML=J[b].team;p.online&&(c=parseInt(this.innerHTML),c%=6,0==c&&(c=1),this.innerHTML=c,da(jg,c,0,0,2),J[b].team=c)},Zj=function(b){b=J[this.iteam];b.race=(b.race+1)%3;this.innerHTML=Oa[b.race];da(kg,b.race,0,0,2)},ak=function(){this.parentElement.style.background=this.value;var b=this.value.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);J[this.iteam].color=[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)];Ma.length&&da(ig,
this.value,0,0,2)},Ll=function(){ac.nu++;ac()},Ml=function(){ac.nu--;0>=ac.nu?ac.nu=1:J.length--;ac()},$g={0:"euro",1:"arab",2:"asia"},ck=[["a","e","i","o","u"],"bcdfghjklmnpqrstvwxyz".split("")],ac=function(){if("Guest"!==A.name&&A.name){document.getElementById("returnmenu").style.display="block";document.getElementById("oneplayertbody").innerHTML="";document.getElementById("oneplayertbody").innerHTML+='<tr><td></td><td id="addremove"><button id="addPlayer">+</button><button id="removePlayer">-</button></td><td></td><td></td></tr>';
for(var b=ac.nu,c=0;c<b;c++)if(document.getElementById("oneplayertbody").innerHTML+='<tr><td class="ucolor1"></td><td class="username1"></td><td class="race1"><button></button></td><td class="team1"><button></button></td></tr>',!J[c]){var e=~~(16777216*Math.random());J[c]={color:[e>>16&255,e>>8&255,e&255],IA:1,race:~~(3*Math.random()),team:c}}document.getElementById("addPlayer").onclick=Ll;document.getElementById("removePlayer").onclick=Ml;e=parseInt(A.color.substr(1),16);J[0].color=[e>>16&255,e>>
8&255,e&255];J[0].name=A.name;for(c=e=J[0].IA=0;c<b;c++){var d=J[c],f=wi[$g[d.race]];if(d.IA)if(e<f.length)d.name=f[e++];else{f=d;var k=~~(9*Math.random())+2,l=ck[1],h=l[~~(Math.random()*l.length)].toUpperCase();.85<Math.random()&&(h+=l[~~(Math.random()*l.length)]);for(l=0;l<k;l++){var m=ck[l%2];h+=m[~~(Math.random()*m.length)];.8<Math.random()&&(h+=m[~~(Math.random()*m.length)])}f.name=h}bk[c].style.background="rgb("+d.color[0]+","+d.color[1]+","+d.color[2]+")";Il[c].innerHTML=d.name;f=Kl[c].getElementsByTagName("button")[0];
f.iteam=c;f.onmousedown=Yj;f.innerHTML=c;f=Jl[c].getElementsByTagName("button")[0];f.iteam=c;f.onmousedown=Zj;f.innerHTML=Oa[d.race];d=J[c].color;f=document.createElement("input");f.type="color";f.iteam=c;f.value="#"+(16777216+(d[0]<<16)+(d[1]<<8)+d[2]).toString(16).slice(1);bk[c].appendChild(f);f.onchange=ak}}else Sj(ac)};ac.nu=4;var Pj=function(b,c,e){"granted"!=Notification.permission&&Notification.requestPermission(function(b){});var d=new Notification(b,{icon:"https://i.imgur.com/SWtWteN.png",
body:c,requireInteraction:!0});e||(e=7550);setTimeout(function(){d.close()},e)},cc,xc=function(b){if(pa(b%D,~~(b/D))&&(b=$b[b],0<=b&&!cc.type[b]))return!0},yc=function(b){if(b){yc.update=!1;b=$b;for(var c=D,e=[],d={},g=0,k=D*Aa;g<k;g++){var l=b[g];if(cc.type[l]||0>l){var m=0;xc(g-1-c)&&(m+=1E7);xc(g-c)&&(m+=1E6);xc(g-c+1)&&(m+=1E5);xc(g-1)&&(m+=1E4);xc(g+1)&&(m+=1E3);xc(g-1+c)&&(m+=100);xc(g+c)&&(m+=10);xc(g+1+c)&&(m+=1);m?void 0!==zj[m]&&(e.add(g),d[e.length-1]=-zj[m]/256-1):0>l&&(b[g]=3)}}g=0;for(len=
e.length;g<len;b[e[g]]=d[g++]);h.useProgram(wa);h.activeTexture(h.TEXTURE1);c=h.createTexture();h.bindTexture(h.TEXTURE_2D,c);h.texImage2D(h.TEXTURE_2D,0,h.R8I,D,Aa,0,h.RED_INTEGER,h.BYTE,b);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT);h.bindTexture(h.TEXTURE_2D,null);h.bindTexture(h.TEXTURE_2D,c);h.uniform1i(h.getUniformLocation(wa,
"img_data"),1);h.useProgram(ea);h.activeTexture(h.TEXTURE2)}else yc.update=!0};yc.update=!1;var b,Fj,Nf,de,ee,fe,ge,he,ie,je,ke,le,me,ne,oe,xl=function(){var g={};b={move:function(){T=Hb;Hb.cursor=7}};b.move.iconID=262;b.move.obj={name:y.move};b.attack=function(){T=Ec};b.attack.iconID=250;b.attack.obj={name:y.attack};b.guard=function(){vc(4)};b.guard.iconID=237;b.guard.obj={name:y.guard};b.patrol=function(){vc(8)};b.patrol.iconID=238;b.patrol.obj={name:y.patrol};b.pickUp=function(){T=kd};b.pickUp.iconID=
240;b.pickUp.obj={name:y.pickItems};b.explore=function(){vc(7)};b.explore.iconID=40;b.explore.obj={name:y.explore};b.stop=function(){da(Kg,0,C)};b.stop.iconID=160;b.stop.obj={name:y.stop};b.stand=function(){da(Gi,0,C)};b.stand.iconID=27;b.stand.obj={name:y.stand};b.attackGround=function(){};b.attackGround.iconID=100;b.steady=function(){};b.steady.iconID=21;b.createOrk=function(){S(58)};b.createOrk.iconID=120;b.createDwarf=function(){S(59)};b.createDwarf.iconID=117;b.createSkeleton=function(){S(60)};
b.createSkeleton.iconID=87;b.createGhost=function(){S(40)};b.createGhost.iconID=222;b.createFootman=function(){S(0)};b.createFootman.iconID=182;b.createArcher=function(){S(4)};b.createArcher.iconID=185;b.createMaceman=function(){S(3)};b.createMaceman.iconID=186;b.createPikeman=function(){S(1)};b.createPikeman.iconID=183;b.createLongbowman=function(){S(6)};b.createLongbowman.iconID=184;b.createKnight=function(){S(19)};b.createKnight.iconID=180;b.iniMercenaries=function(b){b.mlist=[];b.mlistID=[];b.mercID=
0;Fg(b);b.setupINTV(jh,b.id,2E3)};b.iniMercenaries.builds=[30];b.iniHeroes=function(b){b.hlist=[];b.hlistID=[];b.heroID=0;Fg(b);b.setupINTV(jh,b.id,2E3)};b.iniHeroes.builds=[30];b.mercFootmanArab=function(){xa()};b.mercFootmanArab.iconID=49;b.mercFootmanArab.unit=80;b.mercFootmanArab.obj={};b.mercArcherArab=function(){xa()};b.mercArcherArab.iconID=52;b.mercArcherArab.unit=85;b.mercArcherArab.obj={};b.mercMacemanArab=function(){xa()};b.mercMacemanArab.iconID=116;b.mercMacemanArab.obj={};b.mercMacemanArab.unit=
83;b.mercPikemanArab=function(){xa()};b.mercPikemanArab.iconID=52;b.mercPikemanArab.unit=82;b.mercPikemanArab.obj={};b.mercCavalry=function(){xa()};b.mercCavalry.iconID=133;b.mercCavalry.unit=84;b.mercCavalry.obj={};b.mercEnichar=function(){xa()};b.mercEnichar.iconID=123;b.mercEnichar.unit=91;b.mercEnichar.obj={};b.mercJihad=function(){xa()};b.mercJihad.iconID=236;b.mercJihad.unit=86;b.mercJihad.obj={};b.mercFootmanArab6=function(){Sa()};b.mercFootmanArab6.iconID=49;b.mercFootmanArab6.unit=80;b.mercFootmanArab6.obj=
{};b.mercArcherArab6=function(){Sa()};b.mercArcherArab6.iconID=52;b.mercArcherArab6.unit=85;b.mercArcherArab6.obj={};b.mercMacemanArab6=function(){Sa()};b.mercMacemanArab6.iconID=116;b.mercMacemanArab6.unit=83;b.mercMacemanArab6.obj={};b.mercPikemanArab6=function(){Sa()};b.mercPikemanArab6.iconID=52;b.mercPikemanArab6.unit=82;b.mercPikemanArab6.obj={};b.mercCavalry6=function(){Sa()};b.mercCavalry6.iconID=133;b.mercCavalry6.unit=84;b.mercCavalry6.obj={};b.mercEnichar6=function(){Sa()};b.mercEnichar6.iconID=
123;b.mercEnichar6.unit=91;b.mercEnichar6.obj={};b.mercJihad6=function(){Sa()};b.mercJihad6.iconID=236;b.mercJihad6.unit=86;b.mercJihad6.obj={};b.mercFootman=function(){xa()};b.mercFootman.iconID=182;b.mercFootman.unit=0;b.mercArcher=function(){xa()};b.mercArcher.iconID=185;b.mercArcher.unit=4;b.mercMaceman=function(){xa()};b.mercMaceman.iconID=186;b.mercMaceman.unit=3;b.mercPikeman=function(){xa()};b.mercPikeman.iconID=183;b.mercPikeman.unit=1;b.mercLongbowman=function(){xa()};b.mercLongbowman.iconID=
184;b.mercLongbowman.unit=6;b.mercKnight=function(){xa()};b.mercKnight.iconID=180;b.mercKnight.unit=19;b.mercFootman6=function(){Sa()};b.mercFootman6.iconID=182;b.mercFootman6.unit=0;b.mercFootman6.obj={};b.mercArcher6=function(){Sa()};b.mercArcher6.iconID=185;b.mercArcher6.unit=4;b.mercArcher6.obj={};b.mercMaceman6=function(){Sa()};b.mercMaceman6.iconID=186;b.mercMaceman6.unit=3;b.mercMaceman6.obj={};b.mercPikeman6=function(){Sa()};b.mercPikeman6.iconID=183;b.mercPikeman6.unit=1;b.mercPikeman6.obj=
{};b.mercLongbowman6=function(){Sa()};b.mercLongbowman6.iconID=184;b.mercLongbowman6.unit=6;b.mercLongbowman6.obj={};b.mercKnight6=function(){Sa()};b.mercKnight6.iconID=180;b.mercKnight6.unit=19;b.mercKnight6.obj={};b.mercArcherAsian6=function(){Sa()};b.mercArcherAsian6.iconID=53;b.mercArcherAsian6.unit=67;b.mercArcherAsian6.obj={};b.mercSamurai6=function(){Sa()};b.mercSamurai6.iconID=122;b.mercSamurai6.unit=68;b.mercSamurai6.obj={};b.mercHourseSamurai6=function(){Sa()};b.mercHourseSamurai6.iconID=
121;b.mercHourseSamurai6.unit=70;b.mercHourseSamurai6.obj={};b.mercRonin6=function(){Sa()};b.mercRonin6.iconID=54;b.mercRonin6.unit=66;b.mercRonin6.obj={};b.mercHorseArcher6=function(){Sa()};b.mercHorseArcher6.iconID=52;b.mercHorseArcher6.unit=69;b.mercHorseArcher6.obj={};b.mercChariot6=function(){Sa()};b.mercChariot6.iconID=79;b.mercChariot6.unit=72;b.mercChariot6.obj={};b.mercArcherAsian=function(){xa()};b.mercArcherAsian.iconID=53;b.mercArcherAsian.unit=67;b.mercArcherAsian.obj={};b.mercSamurai=
function(){xa()};b.mercSamurai.iconID=122;b.mercSamurai.unit=68;b.mercSamurai.obj={};b.mercHourseSamurai=function(){xa()};b.mercHourseSamurai.iconID=121;b.mercHourseSamurai.unit=70;b.mercHourseSamurai.obj={};b.mercRonin=function(){xa()};b.mercRonin.iconID=54;b.mercRonin.unit=66;b.mercRonin.obj={};b.mercHorseArcher=function(){xa()};b.mercHorseArcher.iconID=52;b.mercHorseArcher.unit=69;b.mercHorseArcher.obj={};b.mercChariot=function(){xa()};b.mercChariot.iconID=79;b.mercChariot.unit=72;b.mercChariot.obj=
{};b.createPeon=function(){S(10)};b.createPeon.iconID=187;b.sameSpeed=function(){da(Pi,C)};b.sameSpeed.iconID=82;b.restoreSpeed=function(){da(Oi,C)};b.restoreSpeed.iconID=88;b.createSpy=function(){S(2)};b.createSpy.iconID=162;b.emergeAllUnits=function(){var b=C[0];da(ld,b,z[b].inventory.slice(0))};b.emergeAllUnits.iconID=261;b.techFeudalism=function(){E(12)};b.techFeudalism.iconID=233;b.techArchitecture=function(){E(13)};b.techArchitecture.iconID=226;b.techLearning=function(){E(14)};b.techLearning.iconID=
129;b.createPeon1=function(){S(64)};b.createPeon1.iconID=55;b.createPeon2=function(){S(79)};b.createPeon2.iconID=132;b.createNinja=function(){S(65)};b.createNinja.iconID=51;b.techArmoredChariot=function(){E(51)};b.techArmoredChariot.iconID=79;b.techBuddhism=function(){E(45)};b.techBuddhism.iconID=127;b.techGreatWall=function(){E(48)};b.techGreatWall.iconID=80;b.ridingHorses=function(){E(49)};b.ridingHorses.iconID=64;b.irrigation=function(){E(50)};b.irrigation.iconID=72;b.createHorseArcher2=function(){S(85)};
b.createHorseArcher2.iconID=52;b.techMeditation=function(){E(52)};b.techMeditation.iconID=71;b.techKungFu=function(){E(53)};b.techKungFu.iconID=228;b.techTournaments=function(){E(54)};b.techTournaments.iconID=73;b.techPhilosophy=function(){E(55)};b.techPhilosophy.iconID=68;b.techNinjas=function(){E(56)};b.techNinjas.iconID=56;b.techMastery=function(){E(57)};b.techMastery.iconID=69;b.techGoldMining=function(){E(1)};b.techGoldMining.iconID=58;b.techStoneMining=function(){E(2)};b.techStoneMining.iconID=
57;b.createCrusaders=function(){da(kh,C[0],0)};b.createCrusaders.iconID=221;b.techFanaticism=function(){E(31)};b.techFanaticism.iconID=235;b.techCrusade=function(){E(32)};b.techCrusade.iconID=93;b.techEspionage=function(){E(30)};b.techEspionage.iconID=215;b.techInquisition=function(){E(33)};b.techInquisition.iconID=97;b.techHealing=function(){E(34)};b.techHealing.iconID=219;b.healing=function(){T=Tg};b.healing.iconID=219;b.healing.iconIDbook=201;b.teach=function(){T=Yg};b.teach.iconID=23;b.teach.iconIDbook=
217;b.techBless=function(){E(36)};b.techBless.iconID=159;b.bless=function(){T=jf};b.bless.iconID=159;b.bless.iconIDbook=204;b.techMedicine=function(){E(35)};b.techMedicine.iconID=220;b.createMage=function(){S(5)};b.createMage.iconID=156;b.techBat=function(){E(38)};b.techBat.iconID=168;b.techGolem=function(){E(41)};b.techGolem.iconID=119;b.techInvisibility=function(){E(37)};b.techInvisibility.iconID=217;b.techLightning=function(){E(40)};b.techLightning.iconID=143;b.techFreeze=function(){E(39)};b.techFreeze.iconID=
130;b.techHeroism=function(){E(22)};b.techHeroism.iconID=136;b.techWarfare=function(){E(23)};b.techWarfare.iconID=108;b.techTactics=function(){E(24)};b.techTactics.iconID=257;b.techMercenaries=function(){E(25)};b.techMercenaries.iconID=95;b.techHeroes=function(){E(26)};b.techHeroes.iconID=96;b.techFame=function(){E(27)};b.techFame.iconID=111;b.techSiegeTactics=function(){E(28)};b.techSiegeTactics.iconID=258;b.techBodyBuilding=function(){E(29)};b.techBodyBuilding.iconID=101;b.createPriest=function(){S(9)};
b.createPriest.iconID=155;b.createCow=function(){S(27)};b.createCow.iconID=163;b.techCropRotation=function(){E(8)};b.techCropRotation.iconID=227;b.techDomestication=function(){E(7)};b.techDomestication.iconID=157;b.techMapMaking=function(){E(16)};b.techMapMaking.iconID=89;b.techTradeRoutes=function(){E(17)};b.techTradeRoutes.iconID=102;b.techTradeTaxes=function(){E(18)};b.techTradeTaxes.iconID=110;b.techUsury=function(){E(19)};b.techUsury.iconID=105;b.techSupplyStorage=function(){E(20)};b.techSupplyStorage.iconID=
62;b.techBribery=function(){E(21)};b.techBribery.iconID=109;b.bribe=function(){};b.bribe.iconID=128;b.createCaravan=function(){S(61)};b.createCaravan.iconID=169;b.createCaravan2=function(){S(90)};b.createCaravan2.iconID=134;b.createFootman2=function(){S(80)};b.createFootman2.iconID=49;b.createArcher2=function(){S(81)};b.createArcher2.iconID=43;b.createSatrap=function(){S(83)};b.createSatrap.iconID=116;b.createPikeman2=function(){S(82)};b.createPikeman2.iconID=42;b.createHorseArcher2=function(){S(85)};
b.createHorseArcher2.iconID=124;b.createCavalry=function(){S(84)};b.createCavalry.iconID=133;b.createEnichar=function(){S(91)};b.createEnichar.iconID=123;b.createJihad=function(){S(86)};b.createJihad.iconID=236;b.trade=function(){};b.trade.iconID=161;b.unload=function(){T=Ve};b.unload.iconID=148;b.createMercenaries=function(){na(z[C[0]].mlist)};b.createMercenaries.iconID=95;b.createHeroes=function(){na(z[C[0]].hlist)};b.createHeroes.iconID=96;b.upgradeGuildTower=function(){E(42)};b.upgradeGuildTower.iconID=
171;b.upgradeStoneTower=function(){E(43)};b.upgradeStoneTower.iconID=178;b.upgradeCannonTower=function(){E(44)};b.upgradeCannonTower.iconID=178;b.createCatapult=function(){S(37)};b.createCatapult.iconID=152;b.createHeavyCatapult=function(){S(39)};b.createHeavyCatapult.iconID=153;b.createBallist=function(){S(38)};b.createBallist.iconID=154;b.techEngineering=function(){E(47)};b.techEngineering.iconID=92;b.techCannonTower=function(){E(46)};b.techCannonTower.iconID=178;b.techPlateArmor=function(){E(10)};
b.techPlateArmor.iconID=131;b.techTemperIron=function(){E(4)};b.techTemperIron.iconID=266;b.techHalberd=function(){E(6)};b.techHalberd.iconID=113;b.techScaleArmor=function(){E(5)};b.techScaleArmor.iconID=251;b.techChainMail=function(){E(9)};b.techChainMail.iconID=252;b.techLongbow=function(){E(0)};b.techLongbow.iconID=259;b.techWoodCutting=function(){E(3)};b.techWoodCutting.iconID=107;b.techCrossbow=function(){E(11)};b.techCrossbow.iconID=112;b.createFishingBoat=function(){S(74)};b.createFishingBoat.iconID=
48;b.createXebec=function(){S(76)};b.createXebec.iconID=166;b.upgradeShip=function(){};b.upgradeShip.iconID=268;b.fishing=function(){};b.fishing.iconID=41;b.createHulk=function(){S(75)};b.createHulk.iconID=165;b.createGalleon=function(){S(73)};b.createGalleon.iconID=164;b.techLandingTactics=function(){};b.techLandingTactics.iconID=98;b.techConcentration=function(){E(58)};b.techConcentration.iconID=75;b.techConfusion=function(){E(59)};b.techConfusion.iconID=76;b.techWhirlpool=function(){E(60)};b.techWhirlpool.iconID=
78;b.techDragon=function(){E(61)};b.techDragon.iconID=115;b.techTurnToStone=function(){E(62)};b.techTurnToStone.iconID=77;b.techFlameBolt=function(){E(63)};b.techFlameBolt.iconID=25;b.techJewelry=function(){E(64)};b.techJewelry.iconID=230;b.techBanking=function(){E(65)};b.techBanking.iconID=74;b.techChemistry=function(){E(66)};b.techChemistry.iconID=225;b.techSeaFood=function(){E(67)};b.techSeaFood.iconID=67;b.techGunPowder=function(){E(68)};b.techGunPowder.iconID=212;b.techRocketArrow=function(){E(69)};
b.techRocketArrow.iconID=47;b.techBushido=function(){E(70)};b.techBushido.iconID=60;b.techLeadership=function(){E(71)};b.techLeadership.iconID=114;b.techHonor=function(){E(72)};b.techHonor.iconID=94;b.techSunTzu=function(){E(73)};b.techSunTzu.iconID=66;b.createRonin=function(){S(66)};b.createRonin.iconID=54;b.createArcher1=function(){S(67)};b.createArcher1.iconID=53;b.createSamurai=function(){S(68)};b.createSamurai.iconID=122;b.createHorseArcher1=function(){S(69)};b.createHorseArcher1.iconID=52;b.createMonk=
function(){S(128)};b.createMonk.iconID=45;b.createMage1=function(){S(129)};b.createMage1.iconID=50;b.createPriest1=function(){S(127)};b.createPriest1.iconID=44;b.createPriest2=function(){S(87)};b.createPriest2.iconID=125;b.buyItems=function(){};b.buyItems.iconID=31;b.sellItems=function(){};b.sellItems.iconID=30;b.createHorseSamurai=function(){S(70)};b.createHorseSamurai.iconID=121;b.createChariot=function(){S(72)};b.createChariot.iconID=79;b.stopTech=function(){da(Oe,0,C);Ba(z[C[0]])};b.stopTech.iconID=
160;b.repair=function(){T=md};b.repair.iconID=145;b.conquest=function(){};b.conquest.iconID=249;b.dcm=function(){T=Sd};b.dcm.iconID=260;b.buildBarrack=function(){M(14)};b.buildBarrack.iconID=205;b.buildBarrack1=function(){M(71)};b.buildBarrack1.iconID=205;b.buildBarrack2=function(){M(102)};b.buildBarrack2.iconID=205;b.buildTower=function(){M(32)};b.buildTower.iconID=170;b.buildStorage=function(){M(18)};b.buildStorage.iconID=200;b.buildLumbermill=function(){M(15)};b.buildLumbermill.iconID=199;b.buildLumbermill2=
function(){M(93)};b.buildLumbermill2.iconID=199;b.buildFields=function(){M(20)};b.buildFields.iconID=265;b.buildCastle=function(){M(12)};b.buildCastle.iconID=206;b.buildCastle1=function(){M(62)};b.buildCastle1.iconID=206;b.buildCastle2=function(){M(63)};b.buildCastle2.iconID=206;b.buildAcademy=function(){M(17)};b.buildAcademy.iconID=204;b.buildCathedral=function(){M(11)};b.buildCathedral.iconID=191;b.buildCathedral2=function(){M(106)};b.buildCathedral2.iconID=189;b.buildMerchands=function(){M(24)};
b.buildMerchands.iconID=198;b.buildMerchands2=function(){M(108)};b.buildMerchands2.iconID=198;b.buildChurch=function(){M(25)};b.buildChurch.iconID=197;b.buildMarket=function(){M(33)};b.buildMarket.iconID=194;b.buildMageTower=function(){M(16)};b.buildMageTower.iconID=192;b.buildMageTower2=function(){M(107)};b.buildMageTower2.iconID=192;b.buildDummy=function(){M(36)};b.buildDummy.iconID=65;b.buildFarm=function(){M(23)};b.buildFarm.iconID=193;b.buildBlacksmith=function(){M(26)};b.buildBlacksmith.iconID=
202;b.buildWorkshop=function(){M(29)};b.buildWorkshop.iconID=201;b.buildWorkshop2=function(){M(98)};b.buildWorkshop2.iconID=201;b.buildStable=function(){M(28)};b.buildStable.iconID=196;b.buildStable2=function(){M(103)};b.buildStable2.iconID=196;b.buildTavern=function(){M(30)};b.buildTavern.iconID=208;b.buildHouse=function(){M(31)};b.buildHouse.iconID=195;b.buildHarbor=function(){M(41)};b.buildHarbor.iconID=188;b.buildOutpost=function(){M(34)};b.buildOutpost.iconID=158;b.buildWoodWall=function(){Jg(13)};
b.buildWoodWall.iconID=210;b.buildWoodGate=function(){};b.buildWoodGate.iconID=209;b.buildWoodGate.disabled=2;b.buildBridge=function(){M(35)};b.buildBridge.iconID=176;Nf="freeze invisibility lightning turnToStone bless healing".split(" ");b.freeze=function(){T=sf};b.freeze.iconID=99;b.freeze.obj={name:y.freeze};b.freeze.iconIDbook=205;b.confusion=function(){T=uf};b.confusion.iconID=76;b.confusion.obj={name:"Confusion",spcost:[120,0,0,0]};b.confusion.iconIDbook=206;b.turnToStone=function(){T=Sg};b.turnToStone.iconID=
77;b.turnToStone.iconIDbook=213;b.turnToStone.obj={name:"Turn to Stone",spcost:[40,0,0,0]};b.whirlpool=function(){T=Ti};b.whirlpool.iconID=78;b.whirlpool.iconIDbook=214;b.whirlpool.obj={name:"Whirlpool",spcost:[80,0,0,0]};b.flameBolt=function(){T=nf};b.flameBolt.iconID=25;b.flameBolt.obj={name:"Flame Bolt",spcost:[120,0,0,0]};b.flameBolt.iconIDbook=216;b.createDragon=function(){T=$e};b.createDragon.iconID=115;b.createDragon.obj={name:"Spawn Dragon",spcost:[320,0,0,0]};b.createDragon.iconIDbook=215;
b.lightning=function(){T=Wg};b.lightning.iconID=263;b.lightning.obj={name:y.lightning,spcost:[80,0,0,0]};b.lightning.iconIDbook=200;b.createBat=function(){T=bf};b.createBat.iconID=168;b.createBat.iconIDbook=203;b.createGolem=function(){T=Ye};b.createGolem.iconID=119;b.createGolem.iconIDbook=209;b.autoInvisibility=function(){T=lf};b.autoInvisibility.iconID=217;b.autoInvisibility.obj={name:y.invisibility};b.invisibility=function(){T=lf};b.invisibility.iconID=217;b.invisibility.iconIDbook=208;b.impersonate=
function(){T=Ug};b.impersonate.iconID=32;b.impersonate.obj={name:"Impersonate"};b.revealSelf=function(){da(Xi,C[0],0)};b.revealSelf.iconID=33;b.revealSelf.obj={name:"Reveal your true self"};b.buildHouse1=function(){M(111)};b.buildHouse1.iconID=195;b.buildHouse2=function(){M(92)};b.buildHouse2.iconID=195;b.buildLumbermill1=function(){M(112)};b.buildLumbermill1.iconID=199;b.buildStorage1=function(){M(113)};b.buildStorage1.iconID=200;b.buildStorage2=function(){M(94)};b.buildStorage2.iconID=200;b.buildFarm1=
function(){M(114)};b.buildFarm1.iconID=193;b.buildFarm2=function(){M(95)};b.buildFarm2.iconID=193;b.buildHarbor1=function(){M(115)};b.buildHarbor1.iconID=188;b.buildHarbor2=function(){M(96)};b.buildHarbor2.iconID=188;b.buildBlacksmith1=function(){M(116)};b.buildBlacksmith1.iconID=202;b.buildBlacksmith2=function(){M(97)};b.buildBlacksmith2.iconID=202;b.buildWorkshop1=function(){M(117)};b.buildWorkshop1.iconID=201;b.buildChurch1=function(){M(118)};b.buildChurch1.iconID=197;b.buildChurch2=function(){M(99)};
b.buildChurch2.iconID=197;b.buildTavern1=function(){M(119)};b.buildTavern1.iconID=208;b.buildTavern2=function(){M(100)};b.buildTavern2.iconID=208;b.buildMarket1=function(){M(120)};b.buildMarket1.iconID=194;b.buildMarket2=function(){M(101)};b.buildMarket2.iconID=194;b.buildStable1=function(){M(121)};b.buildStable1.iconID=196;b.buildOutpost1=function(){M(122)};b.buildOutpost1.iconID=158;b.buildOutpost2=function(){M(104)};b.buildOutpost2.iconID=158;b.buildCathedral1=function(){M(123)};b.buildCathedral1.iconID=
190;b.buildMageTower1=function(){M(124)};b.buildMageTower1.iconID=192;b.createObjects=function(){Xd("magicworkshopmenu",ka)};b.createObjects.iconID=20;b.createObjects.obj={};b.buildMagicWorkshop=function(){M(110)};b.buildMagicWorkshop.iconID=46;b.buildMerchands1=function(){M(125)};b.buildMerchands1.iconID=198;b.buildAcademy1=function(){M(126)};b.buildAcademy1.iconID=204;b.buildAcademy2=function(){M(109)};b.buildAcademy2.iconID=204;b.buildRocketTower=function(){M(57)};b.buildRocketTower.iconID=47;
b.murder=function(){M(57)};b.murder.iconID=28;b.convertJihad=function(){};b.convertJihad.iconID=236;b.convertJihad.obj={};b.menuCommonBuild2=function(){na(le)};b.menuCommonBuild2.iconID=17;le=[b.buildFarm2,b.buildBlacksmith2,b.buildWorkshop2,b.buildStable2,b.buildTavern2,b.buildHouse2];le.menuName="a_build";b.menuCommonBuild2.xtra=le;b.menuSpecialBuild2=function(){na(me)};b.menuSpecialBuild2.iconID=15;me=[b.buildCastle2,b.buildAcademy2,b.buildCathedral2,b.buildMerchands2,b.buildChurch2,b.buildMarket2,
b.buildMageTower2,b.buildMagicWorkshop];me.menuName="a_build";b.menuSpecialBuild2.xtra=me;b.menuOtherBuild2=function(){na(ne)};b.menuOtherBuild2.iconID=16;ne=[b.buildHarbor2,b.buildOutpost2,b.buildWoodWall,b.buildWoodGate,b.buildBridge];ne.menuName="e_build";b.menuOtherBuild2.xtra=ne;b.menuBuilds2=function(){na(oe)};b.menuBuilds2.iconID=245;oe=[b.menuSpecialBuild2,b.menuCommonBuild2,b.menuOtherBuild2,b.buildBarrack2,b.buildTower,b.buildStorage2,b.buildLumbermill2,b.buildFields];oe.menuName="a_build";
b.menuBuilds2.xtra=oe;b.createCarpet=function(){T=ff};b.createCarpet.iconID=146;b.createCarpet.iconIDbook=202;b.createJinn=function(){T=df};b.createJinn.iconID=118;b.createJinn.iconIDbook=218;b.magicVision=function(){};b.magicVision.iconID=223;b.magicVision.iconIDbook=210;b.fireRain=function(){T=wf};b.fireRain.iconID=264;b.fireRain.iconIDbook=199;b.raiseDead=function(){T=pf};b.raiseDead.iconID=87;b.raiseDead.iconIDbook=211;b.createMage2=function(){S(89)};b.createMage2.iconID=126;b.techCowPoaching=
function(){E(74)};b.techCowPoaching.iconID=85;b.techHorseManShip=function(){E(75)};b.techHorseManShip.iconID=231;b.techScimitar=function(){E(76)};b.techScimitar.iconID=84;b.techJihad=function(){E(77)};b.techJihad.iconID=236;b.techCarpet=function(){E(78)};b.techCarpet.iconID=146;b.techMagicWorkshop=function(){E(79)};b.techMagicWorkshop.iconID=86;b.techFireRain=function(){E(80)};b.techFireRain.iconID=264;b.techMagicVision=function(){E(81)};b.techMagicVision.iconID=224;b.techNecromancy=function(){E(82)};
b.techNecromancy.iconID=87;b.techJinn=function(){E(83)};b.techJinn.iconID=118;b.techOreFloatation=function(){E(84)};b.techOreFloatation.iconID=106;b.techRiddingHorses=function(){E(85)};b.techRiddingHorses.iconID=232;b.techJanissary=function(){E(86)};b.techJanissary.iconID=81;b.buildMagicItems=function(){};b.buildMagicItems.iconID=20;b.techSlavery=function(){E(87)};b.techSlavery.iconID=135;b.stopBuilding=function(){da(Yd,0,C)};b.stopBuilding.iconID=160;b.menuSpecialBuild1=function(){na(de)};b.menuSpecialBuild1.iconID=
15;de=[b.buildCastle1,b.buildAcademy1,b.buildCathedral1,b.buildMerchands1,b.buildChurch1,b.buildMarket1,b.buildMageTower1,b.buildRocketTower,b.buildDummy];de.menuName="a_build";b.menuSpecialBuild1.xtra=de;b.menuCommonBuild1=function(){na(ee)};b.menuCommonBuild1.iconID=17;ee=[b.buildFarm1,b.buildBlacksmith1,b.buildWorkshop1,b.buildStable1,b.buildTavern1,b.buildHouse1];ee.menuName="a_build";b.menuCommonBuild1.xtra=ee;b.menuSpecialBuild=function(){na(fe)};b.menuSpecialBuild.iconID=15;fe=[b.buildCastle,
b.buildAcademy,b.buildCathedral,b.buildMerchands,b.buildChurch,b.buildMarket,b.buildMageTower,b.buildDummy];fe.menuName="e_build";b.menuSpecialBuild.xtra=fe;b.menuCommonBuild=function(){na(ge)};b.menuCommonBuild.iconID=17;ge=[b.buildFarm,b.buildBlacksmith,b.buildWorkshop,b.buildStable,b.buildTavern,b.buildHouse];ge.menuName="e_build";b.menuCommonBuild.xtra=ge;b.menuOtherBuild=function(){na(he)};b.menuOtherBuild.iconID=16;he=[b.buildHarbor,b.buildOutpost,b.buildWoodWall,b.buildWoodGate,b.buildBridge];
he.menuName="e_build";b.menuOtherBuild.xtra=he;b.menuOtherBuild1=function(){na(ie)};b.menuOtherBuild1.iconID=16;ie=[b.buildHarbor1,b.buildOutpost1,b.buildWoodWall,b.buildWoodGate,b.buildBridge];ie.menuName="e_build";b.menuOtherBuild1.xtra=ie;b.menuBuilds=function(){na(je)};je=[b.menuSpecialBuild,b.menuCommonBuild,b.menuOtherBuild,b.buildBarrack,b.buildTower,b.buildStorage,b.buildLumbermill,b.buildFields];je.menuName="e_build";b.menuBuilds.iconID=245;b.menuBuilds.xtra=je;b.menuBuilds1=function(){na(ke)};
b.menuBuilds1.iconID=245;ke=[b.menuSpecialBuild1,b.menuCommonBuild1,b.menuOtherBuild1,b.buildBarrack1,b.buildTower,b.buildStorage1,b.buildLumbermill1,b.buildFields];ke.menuName="a_build";b.menuBuilds1.xtra=ke;Fj=function(){b.fishing.obj={};b.impersonate.obj={};b.techGreatWall.obj=B[48];b.revealSelf.obj={};b.trade.obj={};b.unload.obj={};b.mercFootman6.obj={};b.murder.obj={};b.mercArcher6.obj={};b.mercMaceman6.obj={};b.mercPikeman6.obj={};b.mercLongbowman6.obj={};b.sameSpeed.obj={name:"Same speed"};
b.restoreSpeed.obj={name:"Restore speed"};b.mercKnight6.obj={};b.attackGround.obj={};b.steady.obj={};b.bribe.obj={};b.createPriest1.obj=t[127];b.createPriest2.obj=t[87];b.createFootman2.obj=t[80];b.createArcher2.obj=t[81];b.createSatrap.obj=t[83];b.createPikeman2.obj=t[82];b.createHorseArcher2.obj=t[85];b.createCavalry.obj=t[84];b.createEnichar.obj=t[91];b.createJihad.obj=t[86];b.createMonk.obj=t[128];b.healing.obj={name:y.heal,spcost:[20,0,0,0]};b.bless.obj={name:y.bless,spcost:[20,0,0,0]};b.stopTech.obj=
{};b.conquest.obj={};b.dcm.obj={name:y.dcm};b.repair.obj={name:y.repair};b.menuOtherBuild.obj={};b.menuOtherBuild1.obj={};b.menuOtherBuild2.obj={};b.sellItems.obj={};b.buyItems.obj={};b.menuBuilds.obj={name:y.menuBuild};b.menuCommonBuild.obj={};b.menuSpecialBuild.obj={};b.techMastery.obj=B[57];b.techNinjas.obj=B[56];b.teach.obj={name:"Teach",spcost:[20,0,0,0]};b.techPhilosophy.obj=B[55];b.techKungFu.obj=B[53];b.techTournaments.obj=B[54];b.techMeditation.obj=B[52];b.menuCommonBuild1.obj={};b.menuCommonBuild2.obj=
{};b.createMage1.obj=t[129];b.menuSpecialBuild1.obj={};b.menuSpecialBuild2.obj={};b.menuBuilds1.obj={name:y.menuBuild};b.menuBuilds2.obj={name:y.menuBuild};b.stopBuilding.obj={};b.freeze.obj={name:y.freeze,spcost:[200,0,0,0]};b.invisibility.obj={name:y.invisibility,spcost:[40,0,0,0]};b.autoInvisibility.obj={name:y.invisibility};b.createHeroes.obj={};b.createMercenaries.obj={};b.upgradeShip.obj={};b.techMedicine.obj=B[35];b.techBless.obj=B[36];b.buildHouse1.obj=t[111];b.techHealing.obj=B[34];b.techInquisition.obj=
B[33];b.techArmoredChariot.obj=B[51];b.techRocketArrow.obj=B[69];b.techJewelry.obj=B[64];b.techGunPowder.obj=B[68];b.techSeaFood.obj=B[67];b.techChemistry.obj=B[66];b.techBanking.obj=B[65];b.createMage.obj=t[5];b.techBat.obj=B[38];b.techGolem.obj=B[41];b.techInvisibility.obj=B[37];b.techLightning.obj=B[40];b.techFreeze.obj=B[39];b.techHeroism.obj=B[22];b.createHorseSamurai.obj=t[70];b.createChariot.obj=t[72];b.createHorseArcher1.obj=t[69];b.createHorseArcher2.obj=t[85];b.createSamurai.obj=t[68];b.createArcher1.obj=
t[67];b.techConfusion.obj=B[59];b.techConcentration.obj=B[58];b.techWhirlpool.obj=B[60];b.techDragon.obj=B[61];b.techTurnToStone.obj=B[62];b.techFlameBolt.obj=B[63];b.createRonin.obj=t[66];b.buildStorage.obj=t[18];b.buildStorage1.obj=t[113];b.buildStorage2.obj=t[94];b.buildFields.obj=t[20];b.buildLumbermill.obj=t[15];b.buildLumbermill1.obj=t[112];b.buildLumbermill2.obj=t[93];b.buildTower.obj=t[32];b.buildBarrack1.obj=t[71];b.buildBarrack.obj=t[14];b.buildBarrack2.obj=t[102];b.buildDummy.obj=t[36];
b.buildRocketTower.obj=t[57];b.buildMageTower.obj=t[16];b.buildMageTower1.obj=t[124];b.buildMageTower2.obj=t[107];b.buildMarket.obj=t[33];b.buildMarket1.obj=t[120];b.buildMarket2.obj=t[101];b.buildChurch.obj=t[25];b.buildChurch1.obj=t[118];b.buildChurch2.obj=t[99];b.buildMerchands.obj=t[24];b.irrigation.obj=B[50];b.ridingHorses.obj=B[49];b.buildMerchands1.obj=t[125];b.buildMerchands2.obj=t[108];b.buildCathedral.obj=t[11];b.buildCathedral1.obj=t[123];b.buildCathedral2.obj=t[106];b.buildAcademy.obj=
t[17];b.buildAcademy1.obj=t[126];b.buildAcademy2.obj=t[109];b.buildCastle.obj=t[12];b.magicVision.obj={name:"Magic Vision",spcost:[20,0,0,0]};b.fireRain.obj={name:"Fire Rain",spcost:[200,0,0,0]};b.raiseDead.obj={name:"Raise the Dead",spcost:[40,0,0,0]};b.createJinn.obj={name:"Spawn Jinn",spcost:[320,0,0,0]};b.createCarpet.obj={name:"Spawn Magic Carpet",spcost:[320,0,0,0]};b.buildCastle1.obj=t[62];b.buildCastle2.obj=t[63];b.buildHouse.obj=t[31];b.buildHouse2.obj=t[92];b.buildTavern.obj=t[30];b.buildTavern1.obj=
t[119];b.buildTavern2.obj=t[100];b.buildStable.obj=t[28];b.buildStable1.obj=t[121];b.buildStable2.obj=t[103];b.buildFarm.obj=t[23];b.buildFarm1.obj=t[114];b.buildFarm2.obj=t[95];b.buildWorkshop.obj=t[29];b.buildWorkshop1.obj=t[117];b.buildWorkshop2.obj=t[98];b.buildBlacksmith.obj=t[26];b.buildBlacksmith1.obj=t[116];b.buildBlacksmith2.obj=t[97];b.buildBridge.obj=t[35];b.buildHarbor.obj=t[41];b.buildHarbor1.obj=t[115];b.buildHarbor2.obj=t[96];b.createMage2.obj=t[89];b.buildMagicItems.obj={};b.techJanissary.obj=
B[86];b.techRiddingHorses.obj=B[85];b.techOreFloatation.obj=B[84];b.techJinn.obj=B[83];b.techNecromancy.obj=B[82];b.techMagicVision.obj=B[81];b.techFireRain.obj=B[80];b.techMagicWorkshop.obj=B[79];b.techCarpet.obj=B[78];b.techJihad.obj=B[77];b.techScimitar.obj=B[76];b.techHorseManShip.obj=B[75];b.techCowPoaching.obj=B[74];b.buildWoodGate.obj={};b.buildWoodWall.obj=t[13];b.buildOutpost.obj=t[34];b.buildOutpost1.obj=t[122];b.buildOutpost2.obj=t[104];b.createGolem.obj={name:"Spawn Stone Golem",spcost:[480,
0,0,0]};b.techSunTzu.obj=B[73];b.techBushido.obj=B[70];b.techLeadership.obj=B[71];b.techHonor.obj=B[72];b.createBat.obj={name:"Spawn Bat",spcost:[40,0,0,0]};b.techGoldMining.obj=B[1];b.techStoneMining.obj=B[2];b.emergeAllUnits.obj={};b.createOrk.obj=t[58];b.createDwarf.obj=t[59];b.createSkeleton.obj=t[60];b.createGhost.obj=t[40];b.createFootman.obj=t[0];b.createArcher.obj=t[4];b.techSlavery.obj=B[87];b.createMaceman.obj=t[3];b.createPikeman.obj=t[1];b.createLongbowman.obj=t[6];b.createKnight.obj=
t[19];b.mercFootman.obj=g;b.mercArcher.obj=g;b.mercMaceman.obj=g;b.mercPikeman.obj=g;b.mercLongbowman.obj=g;b.mercKnight.obj=g;b.createPeon.obj=t[10];b.createSpy.obj=t[2];b.techFeudalism.obj=B[12];b.techArchitecture.obj=B[13];b.techLearning.obj=B[14];b.createPeon1.obj=t[64];b.createPeon2.obj=t[79];b.createNinja.obj=t[65];b.techBuddhism.obj=B[45];b.createCrusaders.obj={};b.buildMagicWorkshop.obj=t[110];b.techFanaticism.obj=B[31];b.techCrusade.obj=B[32];b.techEspionage.obj=B[30];b.techChainMail.obj=
B[9];b.techHalberd.obj=B[6];b.techLongbow.obj=B[0];b.techScaleArmor.obj=B[5];b.techTemperIron.obj=B[4];b.techPlateArmor.obj=B[10];b.techLandingTactics.obj={};b.createGalleon.obj=t[73];b.createHulk.obj=t[75];b.createXebec.obj=t[76];b.createFishingBoat.obj=t[74];b.techCrossbow.obj=B[11];b.techWoodCutting.obj=B[3];b.techCannonTower.obj=B[46];b.techEngineering.obj=B[47];b.createBallist.obj=t[38];b.createHeavyCatapult.obj=t[39];b.createCatapult.obj=t[37];b.upgradeCannonTower.obj=B[44];b.upgradeStoneTower.obj=
B[43];b.upgradeGuildTower.obj=B[42];b.createCaravan.obj=t[61];b.createCaravan2.obj=t[90];b.techBribery.obj=B[21];b.techSupplyStorage.obj=B[20];b.techUsury.obj=B[19];b.techCropRotation.obj=B[8];b.createCow.obj=t[27];b.techDomestication.obj=B[7];b.techTradeTaxes.obj=B[18];b.techTradeRoutes.obj=B[17];b.techMapMaking.obj=B[16];b.createPriest.obj=t[9];b.techBodyBuilding.obj=B[29];b.techSiegeTactics.obj=B[28];b.techFame.obj=B[27];b.techHeroes.obj=B[26];b.techMercenaries.obj=B[25];b.techTactics.obj=B[24];
b.techWarfare.obj=B[23];for(var c=Object.keys(b),e=0,d=c.length;e<d;e++){var f=b[c[e]];f.objName=c[e];f.obj&&(f.obj.nu=f)}}},Kj=function(b,c,e,d){if(Cd&&!p.editor&&(c=Cd.events.defined[c.id])&&c[e]&&!d)for(e=c[e],d=e.length,c=0;c<d;c++){var g=e[c];g.activeEvents+=b;g.activeEvents==g.events.length&&O("go")}},Zc={};w("selectUnits").onclick=function(){w("mapeditorinfoUnits").style.display="block";w("mapeditorinfoBuilds").style.display="none";w("mapeditorinfoItems").style.display="none";w("mapeditorinfoNature").style.display=
"none"};w("selectBuilds").onclick=function(){w("mapeditorinfoUnits").style.display="none";w("mapeditorinfoBuilds").style.display="block";w("mapeditorinfoItems").style.display="none";w("mapeditorinfoNature").style.display="none"};w("selectItems").onclick=function(){w("mapeditorinfoUnits").style.display="none";w("mapeditorinfoBuilds").style.display="none";w("mapeditorinfoItems").style.display="block";w("mapeditorinfoNature").style.display="none"};w("selectNature").onclick=function(){w("mapeditorinfoUnits").style.display=
"none";w("mapeditorinfoBuilds").style.display="none";w("mapeditorinfoItems").style.display="none";w("mapeditorinfoNature").style.display="block"};Zc.start=function(){dc();var b=document.createElement("div");b.id="mapForm";b.innerHTML="\n            <div>\n            <h2>"+y.gameOptions+"</h2>\n            <table>\n<tr><td>"+y.mapSize+': </td><td><input type="number" id=\'editorSize\' min="10" value="256" /></td></tr>\n<tr><td>'+y.random+' </td><td>\n<label class="container">\n  <input type="checkbox" id="editorRandom">\n  <span class="checkmark"></span>\n</label>\n</td></tr>\n<tr><td>'+
y.nplayers+': </td><td><input id="editorPlayers" type="number" min="1" value="3"></td></tr>\n</table>\n</div>';var c=document.createElement("button");c.innerHTML=y.continue;c.onclick=Zc.func;b.children[0].appendChild(c);c=document.createElement("button");c.innerHTML=y.cancel;c.onclick=Nl;b.children[0].appendChild(c);document.body.appendChild(b)};var Nl=function(){location.hash="";setTimeout(ah,200);document.body.removeChild(this.parentElement.parentElement);kb()};Zc.func=function(){if(void 0==p.arje){kb();
w("editorRandom").checked?p.arje=555555*Math.random()+1:p.arje=!1;p.mapx=parseInt(w("editorSize").value);p.mapy=p.mapx;p.goldRes=Infinity;p.foodRes=Infinity;p.woodRes=Infinity;p.stoneRes=Infinity;J=[];for(var b=0,c=parseInt(w("editorPlayers").value);b<c;b++)J[b]={color:[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],IA:!0,name:"Tzar "+(b+1),race:0,team:0};document.body.removeChild(w("mapForm"))}p.editor=1;if(fd(0,Zc.func)){w("statButton").style.display="none";w("menu").style.display=
"none";w("resources").style.display="none";w("mapeditorinfotop").style.display="block";w("mapeditorinfo").style.display="block";var e=document.getElementById("mapeditorinfoUnits");e.style.display="block";Sf();if(!Zc.preload){Zc.preload=!0;var d={},f={},k=t,l={euro:Oa[0],arab:Oa[1],asia:Oa[2],common:y.common};d[Oa[0]]=[];d[Oa[1]]=[];d[Oa[2]]=[];d[y.common]=[];f[Oa[0]]=[];f[Oa[1]]=[];f[Oa[2]]=[];f[y.common]=[];b=0;for(c=k.length;b<c;b++){var h=k[b];!h.race||h.illegal||7==h.type||h.item||(h.build?f[l[h.race]].put(b):
d[l[h.race]].put(b))}for(h=0;2>h;h++){k=Object.keys(d);var m={};b=0;for(c=k.length;b<c;m={ul$19:m.ul$19},b++){var n=document.createElement("h1");n.innerHTML=k[b];m.ul$19=document.createElement("ul");n.onclick=function(b){return function(){mg(b.ul$19)}}(m);m.ul$19.style.display="none";for(var u=d[k[b]],x=Object.keys(u),v={},z=0,A=x.length;z<A;v={tcreate:v.tcreate},z++)l=document.createElement("li"),l.innerHTML=t[u[x[z]]].name,v.tcreate=u[x[z]],l.onclick=function(b){return function(){var c=b.tcreate;
t[c].wall?Jg(c):M(c)}}(v),m.ul$19.appendChild(l);e.appendChild(n);e.appendChild(m.ul$19)}d=f;e=w("mapeditorinfoBuilds")}k=Object.keys(Ub);e=w("mapeditorinfoItems");ul=document.createElement("ul");d={};b=0;for(c=k.length;b<c;d={u$20:d.u$20},b++)l=document.createElement("li"),d.u$20=Ub[k[b]],l.onclick=function(b){return function(){Xh(b.u$20)}}(d),l.innerHTML=d.u$20.name,ul.appendChild(l);e.appendChild(ul);e=w("mapeditorinfoNature");n=document.createElement("h1");n.innerHTML=y.trees;ul=document.createElement("ul");
n.onclick=function(){mg(ul)};ul.style.display="none";l=document.createElement("li");ul.appendChild(l);e.appendChild(n);e.appendChild(ul);l.onclick=function(){Ch(Ol)};l.innerHTML=y.delete;l=document.createElement("li");ul.appendChild(l);l.onclick=function(){Ch(Pl)};l.innerHTML=y.create;n=document.createElement("h1");n.innerHTML=y.terrain;var B=document.createElement("ul");n.onclick=function(){mg(B)};B.style.display="none";e.appendChild(n);e.appendChild(B);c=cc.texturesRandomMap;e={};b=0;for(c=c.length;b<
c;e={l:e.l},b++)l=document.createElement("li"),B.appendChild(l),l.innerHTML=b,e.l=b,l.onclick=function(b){return function(){Ch(Dh);Dh.active=b.l}}(e)}}};var Sf=function(){var b=w("selectKingdom");b.innerHTML="";for(var c=1,e=H.length;c<e;c++){var d=H[c];1===c&&(b.style.background="rgba("+d.color[0]+","+d.color[1]+","+d.color[2]+",1)");b.innerHTML+='<option value="'+c+'" style="background:rgba('+d.color[0]+","+d.color[1]+","+d.color[2]+',1)">'+d.name+"</option>"}};w("selectKingdom").onchange=function(){A.kingdom=
parseInt(this.value);var b=H[A.kingdom].color;this.style.background="rgba("+b[0]+","+b[1]+","+b[2]+",.8)"};var rl=function(b){dc();var c=document.createElement("div"),e=document.createElement("div");c.id="unitProps";var d="<table>"+('\n<tr><td>Name </td><td><input data-prop="name" type="text" value="'+b.name+'" /></td></tr>\n<tr><td>'+y.health+' </td><td><input data-prop="health" type="number" value="'+b.health+'" /></td></tr>\n<tr><td>'+y.maxHealth+'</td> <td><input data-prop="maxHealth" type="number" value="'+
b.maxHealth+'" /></td></tr>\n');if(b.build||b.item)if(b.item){if(b.sword||b.shield)d+="\n<tr><td>"+y.attack+'</td><td><input data-prop="attack" type="number" value="'+(b.attack||0)+'" /></td></tr>\n<tr><td>'+y.defence+'</td> <td><input data-prop="defence" type="number" value="'+(b.defence||0)+'" /></td></tr>\n'}else d+="<tr><td>"+y.kingdom+' </td><td><select id="selectKingdom2">'+w("selectKingdom").innerHTML+"</select></td></tr>";else d+="\n<tr><td>"+y.attack+'</td><td><input data-prop="attack" type="number" value="'+
(b.attack||0)+'" /></td></tr>\n<tr><td>'+y.defence+'</td> <td><input data-prop="defence" type="number" value="'+(b.defence||0)+'" /></td></tr>\n<tr><td>'+y.mana+' <td><input data-prop="mana" type="number" value="'+(b.mana||0)+'" /></td></tr>\n<tr><td>'+y.kingdom+' </td><td><select id="selectKingdom2">'+w("selectKingdom").innerHTML+"</select></td></tr>\n";e.innerHTML=d+"</table>";d=document.createElement("button");d.innerHTML=y.ok;d.onclick=function(){for(var c=w("unitProps").getElementsByTagName("input"),
d=0,e=c.length;d<e;d++)if(c[d]){var g=c[d].value;"number"==c[d].type&&(g=parseInt(g));var h=c[d].dataset.prop;b.__proto__[h]!=g&&(b[h]=g)}c=parseInt(w("selectKingdom2").value);c!=b.kingdom&&b.changeKingdom(c);document.body.removeChild(w("unitProps"));kb()};e.appendChild(d);c.appendChild(e);document.body.appendChild(c);O(b.kingdom);w("selectKingdom2")&&(w("selectKingdom2").value=b.kingdom)},sa=function(b){document.getElementById(b).style.display="none"},db=function(b){document.getElementById(b).style.display=
"block"},mh,Ch=function(b){mh=!0;T=function(){};var c=N;c.img=m.blank;var e=32*vd();c.wh=[e,e];tb(c);c.active=!0;document.addEventListener("mousemove",bc);document.addEventListener("mousedown",dk);bc.active=b},dk=function(b){if(2==b.buttons||b.pageX<A.menumx||b.pageY<A.menumy)return ek();bc(b)},mj=function(b){if(p.editor){var c=parseInt(w("brushSize").value)+b;c>w("brushSize").max?w("brushSize").value=w("brushSize").max:1>c?w("brushSize").value=1:(w("brushSize").value=c,N.wh&&(N.wh[0]+=32*b,N.wh[1]+=
32*b,N.active=!0))}},vd=function(){return parseInt(w("brushSize").value)},Dh=function(b,c,e){b=vd();for(var d=b*b,g=D,k=$b,l=Dh.active,h=cc.type,m=0;m<d;m++){var n=c+m%b,p=e+~~(m/b);pa(n,p)&&(n+=p*g,k[n]=l,h[l]&&(2<U[n]&&z[U[n]].die(),2<ra[n]&&z[ra[n]].die()))}yc()},Pl=function(b,c,e){b=vd();for(var d=b*b,g=D,k=0;k<d;k++){var l=c+k%b,h=e+~~(k/b);pa(l,h)&&(0===U[l+h*g]?.2>Math.random()&&id([l+h*g,7,{d:3+~~(28*Math.random())}]):(l=z[U[l+h*g]],7==l.type&&l.die()))}},Ol=function(b,c,e){b=vd();for(var d=
b*b,g=D,k=0;k<d;k++){var l=c+k%b,h=e+~~(k/b);pa(l,h)&&(l=z[U[l+h*g]],7==l.type&&l.die())}},bc=function(b){var c=32*vd();c=Vb(b.pageX-A.mx-.5*c/fa,b.pageY-.5*c/fa);var e=~~(.03125*c[1]);c=~~(.03125*c[0]);N.x=32*c;N.y=32*e;N.active=!0;if(0!==b.buttons){if(2==b.buttons)return ek();bc.last!==c+e*D&&bc.active&&bc.active(b,c,e);bc.last=c+e*D}},ek=function(){N.active=!0;N.x=-9999;N.y=-9999;mh=!1;if(bc.active){var b=32*vd();Vb(event.pageX-A.mx-.5*b/fa,event.pageY-.5*b/fa);bc.active=!1}N.wh=void 0;document.removeEventListener("mousedown",
dk);document.removeEventListener("mousemove",bc)};w("mapProps").onclick=function(){w("mapPropsWindow").style.display="block";dc();if(""==w("mapPropsWindow").innerHTML){var b=document.createElement("div");w("mapPropsWindow").appendChild(b);var c=document.createElement("table"),e=document.createElement("button");e.onclick=fk;e.innerHTML=y.close;b.appendChild(c);b.appendChild(e)}Eh()};var fk=function(){O(this);this.parentElement.parentElement.style.display="none";kb()};w("mapRules").onclick=function(){w("mapRulesWindow").style.display=
"block";dc();if(""==w("mapRulesWindow").innerHTML){for(var b="",c=0,e=gk.length;c<e;c++){var d=gk[c];b+='<option value="'+d.name+'">'+y[d.name]+"</option>"}var f="";c=0;for(e=hk.length;c<e;c++)d=hk[c],f+='<option value="'+d.name+'">'+y[d.name]+"</option>";c=document.createElement("div");c.innerHTML='\n<div id="mapEvent">\n<h4>'+y.events+'</h4>\n<select id="eventOptions" style="display:none">\n'+b+'\n</select>\n<div id="eventScreen">\n</div>\n<div id="eventLayout">\n</div>\n<button id="addEvent">+</button>\n</div>\n<div id="mapActions">\n<h4>'+
y.actions+'</h4>\n<select id="actionOptions" style="display:none">\n'+f+'\n</select>\n<div id="actionScreen">\n</div>\n<div id="actionLayout">\n</div>\n<button id="addAction">+</button>\n</div>\n<h4>'+y.rules+"</h4>\n";b=document.createElement("div");b.id="rulist";c.appendChild(b);b=document.createElement("button");b.onclick=Ql;b.innerHTML="+";c.appendChild(b);b.id="addRule";c.appendChild(document.createElement("p"));b=document.createElement("button");b.onclick=fk;b.innerHTML=y.close;c.appendChild(b);
w("mapRulesWindow").appendChild(c);w("addEvent").onclick=Rl;w("addAction").onclick=Sl;w("eventOptions").onchange=function(){Pa.div="ed"+this.value;O(Pa.div);db(Pa.div);Pa.active.name=this.value;Tf(Fb.active,"eventLayout")};w("actionOptions").onchange=function(){rb.active.name=this.value;Tf(Fb.active,"actionLayout")};c=document.createElement("div");c.id="edobjAction";f=document.createElement("select");f.innerHTML='\n<option value="attacked">'+y.underAttack+'</option>\n<option value="destroyed">'+y.destroyed+
'</option>\n<option value="moving">'+y.moving+'</option>\n<option value="captured">'+y.captured+"</option>\n";f.value="attacked";f.id="selectionEvents";f.onchange=Tl;e=document.createElement("section");d=document.createElement("section");var k=document.createElement("section"),l=document.createElement("section"),h=document.createElement("div");h.className="unitList";h.id="unitListDiv";h.spType=Pa;b=document.createElement("button");b.innerHTML=y.add;b.onclick=function(){pb(this)};b.button=h;b.style.margin=
"10px";e.appendChild(b);b=document.createElement("button");b.innerHTML=y.defined;b.onclick=Nb;b.sdiv=e;c.appendChild(b);b=document.createElement("button");b.innerHTML=y.undefined;b.onclick=Nb;b.sdiv=d;c.appendChild(b);e.appendChild(h);c.appendChild(e);c.appendChild(d);b.onclick();c.appendChild(document.createElement("p"));c.appendChild(f);c.appendChild(document.createElement("p"));h=document.createElement("div");h.className="unitList";h.id="unitListDiv2";h.spType=Pa;b=document.createElement("button");
b.innerHTML=y.add;b.onclick=function(){pb(this)};b.button=h;b.style.margin="10px";k.appendChild(b);b=document.createElement("button");b.innerHTML=y.defined;b.onclick=Nb;b.sdiv=k;b.id="byButton1";c.appendChild(b);b=document.createElement("button");b.innerHTML=y.undefined;b.onclick=Nb;b.id="byButton2";b.sdiv=l;c.appendChild(b);k.appendChild(h);c.appendChild(k);c.appendChild(l);b.onclick();w("eventScreen").appendChild(c);sa("mapEvent");sa("mapActions");c=document.createElement("div");c.id="edobjOrder";
f=document.createElement("select");f.innerHTML='\n<option value="move">'+y.move+'</option>\n<option value="attack">'+y.attack+"</option>\n";f.value="move";f.id="selectionActions";f.onchange=Ul;e=document.createElement("section");d=document.createElement("section");k=document.createElement("section");l=document.createElement("section");h=document.createElement("div");h.className="unitList";h.id="unitListDivAction";h.spType=rb;b=document.createElement("button");b.innerHTML=y.add;b.onclick=function(){pb(this)};
b.button=h;b.style.margin="10px";e.appendChild(b);b=document.createElement("button");b.innerHTML=y.defined;b.onclick=Nb;b.sdiv=e;c.appendChild(b);b=document.createElement("button");b.innerHTML=y.undefined;b.onclick=Nb;b.sdiv=d;c.appendChild(b);e.appendChild(h);c.appendChild(e);c.appendChild(d);b.onclick();c.appendChild(document.createElement("p"));c.appendChild(f);c.appendChild(document.createElement("p"));h=document.createElement("div");h.className="unitList";h.id="unitListDivAction2";h.spType=rb;
b=document.createElement("button");b.innerHTML=y.add;b.onclick=function(){pb(this)};b.button=h;b.style.margin="10px";k.appendChild(b);b=document.createElement("button");b.innerHTML=y.defined;b.onclick=Nb;b.sdiv=k;b.id="toButton1";c.appendChild(b);b=document.createElement("button");b.innerHTML=y.undefined;b.onclick=Nb;b.id="toButton2";b.sdiv=l;c.appendChild(b);k.appendChild(h);c.appendChild(k);c.appendChild(l);b.onclick();w("actionScreen").appendChild(c);sa("mapEvent");sa("mapActions")}};var ik={moving:1},
Tl=function(){ik[this.value]?(sa("byButton2"),sa("byButton1"),sa("unitListDiv2")):(db("unitListDiv2"),w("byButton2").style.display="inline-block",w("byButton1").style.display="inline-block");Pa.active.type=this.value},Ul=function(){ik[this.value]?(sa("toButton2"),sa("toButton1"),sa("unitListDivAction2")):(db("unitListDivAction2"),w("toButton2").style.display="inline-block",w("toButton1").style.display="inline-block");rb.active.type=this.value},pb=function(b){if(b)sa("mapRulesWindow"),kb(),pb.actived=
b.button;else if(pb.actived){db("mapRulesWindow");dc();b=pb.actived.spType.active;b="unitListDiv2"==pb.actived.id||"unitListDivAction2"==pb.actived.id?b.by:b.list;for(var c={},e=0,d=b.length;e<d;e++)c[b[e]]=1;e=0;for(d=C.length;e<d;e++)c[C[e]]||b.put(C[e]);re(pb.actived,b);pb.actived=!1}},re=function(b,c){b.innerHTML="";for(var e=0,d=c.length;e<d;e++){var f=document.createElement("div");f.innerHTML=z[c[e]].name;var g=document.createElement("button");g.onclick=jk;g.innerHTML="x";g.pObj=c;g.spObj=!0;
g.obj=c[e];f.appendChild(g);b.appendChild(f)}},Nb=function(){Nb.active&&(Nb.active.className="");Nb.active=this;this.className="spSelect";for(var b=this.parentElement.getElementsByTagName("section"),c=0,e=b.length;c<e;c++)b[c].style.display="none";this.sdiv.style.display="block"},Fb=function(){var b=this.editorRule;b.deleted||(db("mapEvent"),db("mapActions"),sa("eventOptions"),Fb.active&&(Fb.div.className=""),this.className="spSelect",Fb.active=b,Fb.div=this,Tf(b,"eventLayout"),Tf(b,"actionLayout"),
Pa.div&&sa(Pa.div),Pa.div1=void 0)},Pa=function(){var b=this.editorRule;b.deleted||(db("eventOptions"),Pa.div1&&(Pa.div1.className=""),this.className="spSelect",Pa.active=b,w("selectionEvents").value=b.type,Pa.div1=this,w("eventOptions").value=b.name,Pa.div="ed"+b.name,db(Pa.div),re(w("unitListDiv"),b.list),re(w("unitListDiv2"),b.by))},rb=function(){var b=this.editorRule;b.deleted||(db("actionOptions"),rb.div1&&(rb.div1.className=""),this.className="spSelect",rb.active=b,w("selectionActions").value=
b.type,rb.div1=this,w("actionOptions").value=b.name,rb.div="ed"+b.name,db(rb.div),re(w("unitListDivAction"),b.list),re(w("unitListDivAction2"),b.by))},Tf=function(b,c){w(c).innerHTML="";if("eventLayout"==c){b=b.events;var e=Pa,d=Fb.active.events}else b=b.actions,e=rb,d=Fb.active.actions;for(var f=0,g=b.length;f<g;f++){var l=document.createElement("div");Uf(l,b[f],e,d);w(c).appendChild(l)}},Rl=function(){var b=Fb.active,c={name:"objAction",list:[],zone:[],by:[],type:"attacked"};b.events.put(c);var e=
document.createElement("div");Uf(e,c,Pa,b.events);w("eventLayout").appendChild(e);if(Pa.div1)Pa.div1.onclick()},Sl=function(){var b=Fb.active,c={name:"objOrder",list:[],zone:[],by:[],type:"move"};b.actions.put(c);var e=document.createElement("div");Uf(e,c,rb,b.actions);w("actionLayout").appendChild(e);if(rb.div1)rb.div1.onclick()},Uf=function(b,c,e,d){b.innerHTML=c.events?c.name:y[c.name];b.onclick=e;b.editorRule=c;e=document.createElement("button");e.innerHTML="x";e.obj=c;e.pObj=d;e.onclick=jk;b.appendChild(e)},
Ql=function(){p.rules||(p.rules=[]);var b={name:"Rule"+p.rules.length,events:[],actions:[]};p.rules.put(b);var c=document.createElement("div");Uf(c,b,Fb,p.rules);w("rulist").appendChild(c)},gk=[{name:"objAction"}],hk=[{name:"objOrder"}],jk=function(){this.pObj.quit(this.obj);this.obj.deleted=!0;this.parentElement.parentElement.removeChild(this.parentElement);if(!this.spObj)if(this.pObj!==p.rules)Fb.div.onclick();else sa("mapEvent"),sa("mapActions")};w("infiniteValue").onchange=function(){var b=this.checked;
w("goldValue").disabled=b;w("stoneValue").disabled=b;w("woodValue").disabled=b;w("foodValue").disabled=b};w("infiniteValue").onchange();var Eh=function(){var b=w("mapPropsWindow").getElementsByTagName("table")[0];b.innerHTML="";b.innerHTML+="<tr><td>"+y.color+"</td><td>"+y.username+"</td><td>"+y.AI+"</td><td>"+y.team+"</td></tr>";for(var c=1,e=H.length;c<e;c++){var d=H[c],f=d.color;f="#"+(16777216+(f[0]<<16)+(f[1]<<8)+f[2]).toString(16).slice(1);b.innerHTML+='<tr><td><input style="background:'+f+
'" type="color" value="'+f+'" /></td><td><input type="text" value="'+d.name+'"></td><td><label class="container">\n  <input type="checkbox">\n  <span class="checkmark"></span>\n</label></td><td><input type="number" min="0" value="'+d.team+'"></td></tr>'}b.innerHTML+="<tr><td><button id='editorAdd'>+</button><button id='editorDelete'>-</button></td></tr>";w("editorAdd").onclick=Vl;w("editorDelete").onclick=Wl;b=b.getElementsByTagName("input");c=0;for(e=H.length-1;c<e;c++)f=4*c,d=H[c+1],b[f].onchange=
Xl,b[f+1].onchange=Yl,b[f+2].onchange=Zl,b[f+2].checked=d.IA,b[f+3].onchange=$l,b[f].team=c+1,b[f+1].team=c+1,b[f+2].team=c+1,b[f+3].team=c+1},Vl=function(){new ec("Tzar "+H.length,[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],[0],0,!0,[p.goldRes,p.woodRes,p.foodRes,p.stoneRes],2);Sf();Eh()},Wl=function(){if(2<H.length){for(var b=H.length-1,c=3,e=z.length;c<e;c++){var d=z[c];d.kingdom==b&&d.die()}H.length--;Sf();Eh()}},Xl=function(){var b=H[this.team],c=parseInt(this.value.substr(1),
16),e=c>>16&255,d=c>>8&255;c&=255;b.color=[e,d,c];var f=this.team;b=mb[f];H[f].color=[e,d,c];f*=3;qa[f]=e/255;qa[f+1]=d/255;qa[f+2]=c/255;e=0;for(d=b.length;e<d;e++){c=b[e];f=0;for(var k=c.length;f<k;f++)lc(z[c[f]])}Sf()},Yl=function(){H[this.team].name=this.value},Zl=function(){H[this.team].IA=this.checked?!0:!1},$l=function(){H[this.team].team=parseInt(this.value)};Zd.onchange=function(b){da(Qg,parseInt(Zd.value)/100,C)};w("mapload").onchange=function(){var b=document.getElementById("mapload").files[0],
c=new FileReader;c.onloadend=function(b){b=b.target.result;w("customMapcont").style.display="block";Ea=JSON.parse(b);Ea.kingdomStart?(w("seeStats").style.display="inline-table",w("playrecord").style.display="inline-table"):(w("seeStats").style.display="none",w("playrecord").style.display="none");null===Ea.goldRes&&(Ea.goldRes=Infinity);null===Ea.stoneRes&&(Ea.stoneRes=Infinity);null===Ea.foodRes&&(Ea.foodRes=Infinity);null===Ea.woodRes&&(Ea.woodRes=Infinity);b=document.getElementById("custombody");
b.innerHTML="";var c=Ea.kingdoms;O(c);for(var e=0,g=c.length;e<g;e++){var l=c[e];O(l);var h=l.color;b.innerHTML+="<tr><td style='background:rgb("+h[0]+","+h[1]+","+h[2]+')\' class="ucolor1"></td><td class="username1">'+l.name+'</td><td style="display:none" class="race1">'+l.race+'</td><td class="team1">'+l.team+"</td></tr>"}};b&&c.readAsText(b)};var Ea,am=function(b){var c={Blue:189,Red:13506841,Green:3257600,Purple:11337925,Yellow:16768512,Cyan:46517,Orange:16751649,Gray:5921370},e=b.split(["[Player"]),
d=b.split("GameDuration =")[1].split("[")[0].split(" min")[0].split(" ")[1],f=[];b=[];for(var g=1,l=e.length;g<l;g++){var h=e[g].split("\n"),m={};f[g-1]=m;for(var n=0,p=h.length;n<p;n++){var t=h[n];t=t.split(" = ");if(t[1]&&n){t[1]=t[1].trim();"Color"==t[0]&&(t[1]=c[t[1]]);"Type"==v&&"Status"!==t[0]&&b.put("N");t[1]=encodeURIComponent(t[1]);b.put(t[1]);m[t[0]]=t[1];var v=t[0]}}}c=f[0].Name+"'s Game";var w=new XMLHttpRequest;w.open("POST","http://127.0.0.1/php/stats.php",!0);w.setRequestHeader("Content-type",
"application/x-www-form-urlencoded");w.onreadystatechange=function(){200===w.status&&4===w.readyState&&(location.hash="MatchX"+w.responseText)};b=b.join("<");w.send("arr="+b+"&time="+6E4*d+"&name="+c+"&players="+f.length)},Fh=function(b,c){for(var e=0,d=0,f=b.length;d<f;d++)e+=c[b[d]];return e},Gh=function(b,c,e){var d=["",e];performance.now();for(var f=1,g=b.length;f<g;f++){var l=b[f],h=l.stats,m=h.resources,n=h.unitCountMax,p=24*(f-1)+2,t=l.color,v=l.IA;v=v?"IA":"Human";d[p]=(t[0]<<16)+(t[1]<<8)+
t[2];d[p+1]=l.name;d[p+1]=l.name;d[p+2]=v;d[p+3]=l.status;d[p+4]=l.team;d[p+5]=Oa[l.race];d[p+6]=h.score;d[p+7]=m[0];d[p+8]=m[1];d[p+9]=m[2];d[p+10]=m[3];d[p+11]=h.dmgInflicted;d[p+12]=h.dmgTaken;d[p+13]=h.unitsKilled;d[p+14]=h.unitsLosed;d[p+15]=h.buildsDestroyed;d[p+16]=h.buildsLosed;d[p+17]=Fh([10,79,64],n);d[p+18]=Fh([32,44],n);d[p+19]=Fh([55,56],n);d[p+20]=0;d[p+21]=0;d[p+22]=0;d[p+23]=0}kk(d,c);c&&setTimeout(function(){"block"==w("ingameStats").style.display&&Gh(b,c,e)},500)},kk=function(b,
c){for(var e="<tr style='background:#000;'><td style='    padding-right: 150px;'>Name</td><td>Type</td><td>Status</td><td>Team</td><td>Race</td><td>Score</td><td>Gold</td><td>Wood</td><td>Food</td><td>Stone</td><td title='Damage Inflicted'>D.I</td><td title='Damage Taken'>D.T</td><td title='Units Killed'>U.K</td><td title='Units Losed'>U.L</td><td title='Buildings Destroyed'>B.D</td><td title='Buildings Losed'>B.L</td><td title='Maximum Peasants'>M.P</td><td title='Maximum Towers'>M.T</td><td title='Maximum Stone Towers'>M.S.T</td><td title='Gold Traded'>G.T</td><td title='Stone Traded'>S.T</td><td title='Gold Converted'>G.C</td><td title='Stone Converted'>S.C</td></tr>",
d=2,f=b.length;d<f;d++)if((d-2)%24)0!==(d-3)%24&&(g=~~((d-2)/24)%2?"style = 'background:rgba(0,0,0,0.45)'":"style = 'background:rgba(0,0,0,0.65)'"),e+="<td "+g+">"+Va(decodeURIComponent(b[d]))+"</td>";else{d-2&&(e+="</tr>");g=parseInt(Va(decodeURIComponent(b[d])));var g="style = 'background:rgba("+Math.floor(g/65536)+","+Math.floor(g/256)%256+","+g%256+",0.45)'";e+="<tr>"}e+="</tr>";c?(w("ingameStats").style.display="block",w("statsGame").innerHTML="<tbody>"+e+"</tbody>",c=w("statsGame").getElementsByTagName("td")):
(w("MatchX").style.display="block",w("returnmenu").style.display="block",w("statsTable").innerHTML="<tbody>"+e+"</tbody>",c=w("statsTable").getElementsByTagName("td"));b=[];d=0;for(f=c.length;d<f;d++)e=d%23,4<e&&23<d&&(b[e-5]||(b[e-5]=[]),b[e-5].put(c[d]));d=0;for(f=b.length;d<f;d++){c=b[d];c.sort(vk);e=c.length;if(!c[1])break;c[0].innerHTML!=c[1].innerHTML&&(c[0].style.background="rgba(127,0,0,0.45)");c[e-1].innerHTML!=c[e-2].innerHTML&&(c[e-1].style.background="rgba(0,127,0,0.45)")}};w("statsLoad").onchange=
function(){var b=document.getElementById("statsLoad").files[0],c=new FileReader;c.onloadend=function(b){am(b.target.result)};b&&c.readAsText(b,"ascii")};var uk=function(b){var c=new XMLHttpRequest;c.open("POST","http://127.0.0.1/php/loadstat.php",!0);c.setRequestHeader("Content-type","application/x-www-form-urlencoded");lk(c,function(b){kk(b.responseText.split("<"))});O(b);c.send("id="+b)},lk=function(b,c){b.onreadystatechange=function(){4===b.readyState&&(200===b.status?c(b):alert("Error: "+b.status))}};
w("deleteUnit").onclick=function(){da(Yd,1,C.slice(0))};w("rotatebutton").onclick=function(){for(var b=C,c=0,e=b.length;c<e;c++){var d=z[b[c]];d.build||(d.d=(d.d+1)%8,ObjectsetupIMG(d,d.img))}};w("gameMenu").onclick=Oh;w("menueditor").onclick=Oh;w("quitButton1").onclick=function(){Wh("playingMenu");p.online&&uh();J.length=0;C=[];ib=void 0;clearInterval(Ge);H=[];qh=8;kb();p={canceled:!0};J.length=0;z=[{terrain:1},{terrain:1},{terrain:1}];Hc={};Gc={};Xb={};Wb.length=0;mb=[];Cb=[];qa=[];A.admin=!1;ob=
A.kingdom=void 0;fj={euro:0,arab:0,asia:0};Ia.stop();oc=document.getElementById("msgs");Qf=document.getElementById("msginput");window.removeEventListener("mousemove",sb);window.removeEventListener("keydown",qj);window.removeEventListener("keyup",rj);window.removeEventListener("mousemove",sj);window.removeEventListener("mousedown",tj);window.removeEventListener("mouseup",uj);Sb();document.getElementById("playermenu").style.display="block";document.getElementById("playingMenu").style.display="none"};
w("backToGame").onclick=function(){w("playingMenu").style.display="none";kb()};w("backToGameS").onclick=function(){Wh("ingameStats")};w("statButton").onclick=function(){Gh(H,!0,p.now())};w("returnmenu1").onclick=Sb;w("returnmenu").onclick=Sb;w("refreshButton1").onclick=lg;w("sendmsg").onclick=dh;w("start1").onclick=Vj;w("start2").onclick=fd;w("alertok").onclick=function(){w("alert").style.display="none";kb()};w("saveGame").onclick=function(){var b=document.createElement("a");document.body.appendChild(b);
b.style="display: none";var c=p,e=z,d=[];d.length=e.length-3;for(var f=3,k=e.length;f<k;f++){var h=e[f],m=t[h.type],r={kingdom:h.kingdom,d:h.d,type:h.type,img:h.img,x32:h.x32,y32:h.y32};h.name!==m.name&&(r.name=h.name);h.iconID!==m.iconID&&(r.iconID=h.iconID);h.attack!==m.attack&&(r.attack=h.attack);h.defence!==m.defence&&(r.defence=h.defence);h.level!==m.level&&(r.level=h.level);h.health!==m.health&&(r.health=h.health);h.maxHealth!==m.maxHealth&&(r.maxHealth=h.maxHealth);h.func&&(r.func=h.func);
h.funcObj&&(r.funcObj=h.funcObj);h.workers&&h.workers.length&&(r.workers=h.workers);h.workingOn&&(r.workingOn=h.workingOn);h.inventory&&h.inventory.length&&(r.inventory=h.inventory);h.dix&&(r.dix=h.dix);h.diy&&(r.diy=h.diy);h.timestamp&&(r.timestamp=h.timestamp);h.working&&(r.working=h.working);h.rnd&&(r.rnd=h.rnd);h.techID&&(r.techID=h.techID);h.techStart&&(r.techStart=h.techStart);h.activeTech&&(r.activeTech=h.activeTech);h.levelProgress&&(r.levelProgress=h.levelProgress);h.c&&(r.c=h.c);h.mimg&&
(r.mimg=h.mimg);void 0!==h.built&&(r.built=h.built);void 0!==h.xf&&(r.xf=h.xf);void 0!==h.yf&&(r.yf=h.yf);void 0!==h.action&&(r.action=h.action);h.point&&(r.point=h.point);h.waitlist&&(r.waitlist=h.waitlist);h.mv&&(r.mv=h.mv);h.work&&(r.work=h.work);h.death&&(r.death=h.death);h.freezed&&(r.freezed=h.freezed);h.confused&&(r.confused=h.confused);h.sword&&(r.sword=h.sword);h.shield&&(r.shield=h.shield);h.book&&(r.book=h.book);d[f-3]=r}c.allunits=d;p.movtable=Gc;p.movtable2=Hc;p.kingdomStart||p.editor||
(p.kingdomStart=th);p.terrain||(p.terrain=Array.prototype.slice.call($b));p.kingdoms=H.slice(1);c=JSON.stringify(p);c=new Blob([c],{type:"application/json"});c=URL.createObjectURL(c);b.href=c;b.download="savegame.tzared";b.click();p.allunits=void 0};w("closeButton1").onclick=function(){w("mapconfiguration").style.display="none";kb()};w("createGame1").onclick=Tj;w("copyButton").onclick=function(){document.getElementById("onlineID").select();document.execCommand("Copy")};w("startCustom").onclick=function(){p=
Object.assign({},Ea);p.editor=!1;p.custom=!0;p.online=!1;Ea=void 0;fd(!1,!1,!0)};w("playrecord").onclick=function(){p=Object.assign({},Ea);p.online=!1;p.custom=!0;p.demo=!0;p.cycle=0;p.editor=!1;Ea=void 0;fd(!1,!1,!0)};w("seeStats").onclick=function(){Gh(Ea.kingdoms,!1,25*Ea.cycle);location.hash="MatchX"};var Th={MatchHistory:function(){document.getElementById("returnmenu").style.display="block";var b=new XMLHttpRequest;b.open("GET","http://127.0.0.1/php/latest.php",!0);lk(b,function(b){b=b.responseText.split("|");
for(var c=b.length-1,d="",f=0;f<c;f+=5)d+="<tr id='statList"+Va(decodeURIComponent(b[f]))+"'><td>"+Va(decodeURIComponent(b[f+1]))+"</td><td>"+Va(decodeURIComponent(b[f+2]))+"</td><td>"+Va(decodeURIComponent(b[f+3]))+"</td><td>"+parseInt(Va(decodeURIComponent(b[f+4])))/6E4+" min</td></tr>";document.getElementById("matchtable").innerHTML="<tbody>"+d+"</tbody>";d={};for(f=0;f<c;d={l:d.l},f+=5)d.l=Va(decodeURIComponent(b[f])),w("statList"+d.l).onclick=function(b){return function(){location.hash="MatchX"+
b.l}}(d)});b.send(null)},GameList:lg,RandomMap:ac,Twitter:function(){document.getElementById("returnmenu").style.display="block"},Account:function(){ud.returnmenu.style.display="block";""==ud.Account.innerHTML&&(ud.Account.innerHTML='<iframe id="accountIframe"></iframe>',ud.accountIframe=document.getElementById("accountIframe"));ud.accountIframe.src="http://127.0.0.1/"+A.langCodeUrl+"account/?iframe=1"},MapEditor:Zc.start,CustomMap:function(){document.getElementById("returnmenu").style.display="block"}};
Rh();var ic=[lh,hf,Nc,Kc,Ud,Xe,rf,kf,af,Ze,gf,tf,mf,Si,vf,cf,ef,of,Wd,Jd,se,li,He,xg,ki,Ri,Te,Wi,Yi,od,Xg,Zi,$i,aj,bj,Te,Ij,Mi,cj,Kd,Ni,Hg,Ji,Ki,Og,Li,Od,kc,Ng,Lc,Kc,Rd,Nc,Fc,Se,nd,Z,function(b){var c=b[1],e=z[b[2]];b=B[b[0]];H[e.kingdom].technology.hidden[b.id.id]=0;jc(e,b,c);na.actv[b.id.id]&&aa(!1)},Md,Pe,Ta,Ci,$a,Qe,Lg,Id,jh,jj,Vi];(function(){for(var b=0,c=ic.length;b<c;b++)ic[b].url=b})();Jd.rule="moving"})();
