/*
 JSON v3.2.6 | http://bestiejs.github.io/json3 | Copyright 2012-2013, Kit Cambridge | http://kit.mit-license.org  https://mths.be/utf8js v2.0.0 by @mathias */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(D,aa,ca){D!=Array.prototype&&D!=Object.prototype&&(D[aa]=ca.value)};$jscomp.getGlobal=function(D){return"undefined"!=typeof window&&window===D?D:"undefined"!=typeof global&&null!=global?global:D};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var D=0;return function(aa){return $jscomp.SYMBOL_PREFIX+(aa||"")+D++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var D=$jscomp.global.Symbol.iterator;D||(D=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[D]&&$jscomp.defineProperty(Array.prototype,D,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(D){var aa=0;return $jscomp.iteratorPrototype(function(){return aa<D.length?{done:!1,value:D[aa++]}:{done:!0}})};$jscomp.iteratorPrototype=function(D){$jscomp.initSymbolIterator();D={next:D};D[$jscomp.global.Symbol.iterator]=function(){return this};return D};
$jscomp.iteratorFromArray=function(D,aa){$jscomp.initSymbolIterator();D instanceof String&&(D+="");var ca=0,Ca={next:function(){if(ca<D.length){var Aa=ca++;return{value:aa(Aa,D[Aa]),done:!1}}Ca.next=function(){return{done:!0,value:void 0}};return Ca.next()}};Ca[Symbol.iterator]=function(){return Ca};return Ca};
$jscomp.polyfill=function(D,aa,ca,Ca){if(aa){ca=$jscomp.global;D=D.split(".");for(Ca=0;Ca<D.length-1;Ca++){var Aa=D[Ca];Aa in ca||(ca[Aa]={});ca=ca[Aa]}D=D[D.length-1];Ca=ca[D];aa=aa(Ca);aa!=Ca&&null!=aa&&$jscomp.defineProperty(ca,D,{configurable:!0,writable:!0,value:aa})}};$jscomp.polyfill("Array.prototype.keys",function(D){return D?D:function(){return $jscomp.iteratorFromArray(this,function(D){return D})}},"es6","es3");
$jscomp.polyfill("Object.getOwnPropertySymbols",function(D){return D?D:function(){return[]}},"es6","es5");$jscomp.findInternal=function(D,aa,ca){D instanceof String&&(D=String(D));for(var Ca=D.length,Aa=0;Aa<Ca;Aa++){var W=D[Aa];if(aa.call(ca,W,Aa,D))return{i:Aa,v:W}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(D){return D?D:function(D,ca){return $jscomp.findInternal(this,D,ca).v}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(D){return D?D:function(){return $jscomp.iteratorFromArray(this,function(D,ca){return ca})}},"es8","es3");$jscomp.polyfill("Math.sign",function(D){return D?D:function(D){D=Number(D);return 0===D||isNaN(D)?D:0<D?1:-1}},"es6","es3");$jscomp.polyfill("Number.isFinite",function(D){return D?D:function(D){return"number"!==typeof D?!1:!isNaN(D)&&Infinity!==D&&-Infinity!==D}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(D){return D?D:function(D){return Number.isFinite(D)?D===Math.floor(D):!1}},"es6","es3");$jscomp.owns=function(D,aa){return Object.prototype.hasOwnProperty.call(D,aa)};$jscomp.polyfill("Object.assign",function(D){return D?D:function(D,ca){for(var aa=1;aa<arguments.length;aa++){var Aa=arguments[aa];if(Aa)for(var W in Aa)$jscomp.owns(Aa,W)&&(D[W]=Aa[W])}return D}},"es6","es3");
(function(){var D,aa,ca,Ca;function Aa(f,b){var a=y,c;for(c=2;60>=c;c+=2){f--;b--;for(var d=0;d<=c;){if(2<Y[f+d+a*b]&&1==B[Y[f+d+a*b]].res)return Y[f+d+a*b];if(2<Y[f+d+a*(b+c)]&&1==B[Y[f+d+a*(b+c)]].res)return Y[f+d+a*(b+c)];d++}for(d=0;d<c-1;){d++;if(2<Y[f+a*(b+d)]&&1==B[Y[f+a*(b+d)]].res)return Y[f+a*(b+d)];if(2<Y[f+c+a*(b+d)]&&1==B[Y[f+c+a*(b+d)]].res)return Y[f+c+a*(b+d)]}}return!1}function W(f){f.setupINTV(Rd,f.id,0)}function xj(f){za=[];Sd=[];var b=J[0].diplomacy;eb=[];qb=[];for(var a=f.length,
c=0;c<a;c++){var d=[];qb[c]={};eb[c]=d;for(var h=0;h<x.length;h++)d[h]=[];b[c]=1;d=f[c].color;za.push(d[0]/255,d[1]/255,d[2]/255);Sd.push(d[0],d[1],d[2])}za=new Float32Array(za);Sd=new Uint8Array(Sd)}function yj(){for(var f=0,b=Ia.length;f<b;Ia[f++].className="");}function zj(f){g.getError()==g.CONTEXT_LOST_WEBGL&&(g=document.getElementById("tzar").getContext("webgl2",{antialias:!1,alpha:!1}),K("restored"));var b=y;aa=[];ca=[0,1,2,1,2,3];Ca=[];ca.changed=!0;var a=y*qa;if(!fd){var c=g.createShader(g.VERTEX_SHADER);
g.shaderSource(c,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec4 a_kingdom;\nin vec4 a_physic;\nuniform float zoom;\nuniform mediump int miniMap;\nuniform float now;\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform sampler2D u_image1;\nuniform sampler2D delay;\nuniform float zMax;\nout highp vec2 vTextureCoord;\nout vec4 v_kcolor;\nout float height;\n\nvec4 superArray(in highp uint position) {\n     return(texelFetch(u_image1, ivec2(\t\t(position%uint(512))\t\t,\tposition/uint(512)\t), 0));\n}\n\n\n\nvoid main() {\n\n\n\n    highp float  x;\n    float t;\n\thighp uint pos;\n\n\nif(a_texCoord.y>-.5&&miniMap==0){\nt=(now-a_texCoord.y);\nif(a_texCoord.w>=0.0){\npos=uint(floor(t * a_texCoord.w));         \n}else{\n\n\nint index=int(-a_texCoord.w);\nint len=int(a_texCoord.z);\nint i;\n\nfloat spt= mod(t,texelFetch(delay, ivec2(len-1+index, 0), 0).r);\n\n for(i=0;i<len;i++){\n\n\nif(texelFetch(delay, ivec2(i+index, 0), 0).r>spt) {\n\nbreak;\n }\n\n\n }\n\n pos=uint(i);\n\n\t\t\t\t  \n //pos=uint(4);\n}\n\n\n\tpos=uint(a_texCoord.x)+uint(4)*(pos%uint(a_texCoord.z));\n\n\n}else{\n\npos=uint(a_texCoord.x);\n\n}\n\n\n\n    vec4 coord = superArray(pos);\n\n\tpos=pos-pos%uint(4);\n\n\theight = (superArray(pos+uint(3)).w-superArray(pos).w)/512.0;\n\n    vec2 mxy=vec2(coord.p,coord.q);\n\n\n\t\tfloat z=a_position.z;\n\n\tif(z<0.0){\n\tz*=-1.0;\n\tmxy*=0.0;\n\n\t}\n\n\n\n    t = (now - a_physic.w) * 0.001;\n    mxy.x+=a_physic.x * t;\n\n\tfloat physicY=a_physic.y * t + a_physic.z * .5 * t * t;\n\n    mxy.y+=physicY;\n\n\nif(miniMap==1){\n\tz=0.0;\n}else{\n\tz=(1.0 - (physicY+z)/ zMax)*.9;\n}\n\n   gl_Position = vec4((((a_position.xy+mxy) + u_translation) / u_resolution * 2.0 - 1.0) * vec2(zoom, -zoom), (z), 1.0);\n\n   vTextureCoord=vec2(coord.s,coord.t);\n\n\n    v_kcolor=a_kingdom;\n\n\n}\n");
g.compileShader(c);var d=g.createShader(g.FRAGMENT_SHADER);g.shaderSource(d,"#version 300 es\nprecision mediump float;\n\n\n\nuniform sampler2D lightmap;\nuniform vec2 u_resolution;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform mediump int miniMap;\nin vec4 v_kcolor;\nin highp vec2 vTextureCoord;\nin float height;\nout vec4 COLOR;\n\nvoid main() {\n\n\nif(miniMap==0){\n\n\n\n\nvec2 txtFinal=vTextureCoord;\n\nif(txtFinal.x>=1.0){\ntxtFinal.y+=height*floor(txtFinal.x);\n}\n\n\nvec4 color=texture(img_common, vec3(txtFinal, int(txtFinal.y)));\n \n\nif(color.a<0.5) discard;\n\n\n\n\nif(v_kcolor.a<1.0){\ncolor*=v_kcolor;\n}else if(v_kcolor.a!=1.0){\n\nif(color.r==color.g&&color.r==color.b){\ncolor.rgb*=v_kcolor.rgb;\n}\ncolor.a*=v_kcolor.a-1.0;\n}\nvec4 light=vec4(1.0);\n\n\nlight = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+vec4(1.0,1.0,1.0,0.0)*u_ambient;\n\nCOLOR=color*light;\n\n}else{\nCOLOR=v_kcolor;\n}\n\n}");
g.compileShader(d);la=g.createProgram();g.attachShader(la,c);g.attachShader(la,d);g.linkProgram(la);g.useProgram(la);c=g.getShaderInfoLog(c);console.log("Shader compiler log: "+c);c=g.getShaderInfoLog(d);console.log("Shader compiler log: "+c);c=g.createShader(g.VERTEX_SHADER);g.shaderSource(c,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\n\n\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform mediump int miniMap;\nuniform float zoom;\n\n\nvoid main() {\n\nfloat depth;\nif(miniMap==1){\ndepth=.03;\n}else{\ndepth=1.0;\n}\n\n   gl_Position = vec4(a_position.x, a_position.y, depth, 1.0);\n   \n\n}");
g.compileShader(c);d=g.createShader(g.FRAGMENT_SHADER);g.shaderSource(d,"#version 300 es\nprecision mediump float;\n\nuniform float u_fps;\nuniform mediump int miniMap;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform vec2 borderCoords;\nuniform vec2 waterBorder;\nuniform vec2 u_translation;\nuniform vec2 u_resolution;\nuniform mediump isampler2D img_data;\nuniform sampler2D lightmap;\nout vec4 COLOR;\nuniform float zoom;\nuniform float mx;\nuniform float mapSize;\nuniform float terrainInfo[32];\nvec4 sptexture3D(in vec2 coords,in float height1) {\n \n\n \nif(coords.x>=1.0){\ncoords.y+=height1*floor(coords.x);\n}\n\n\n\n    return(\ttexture(img_common, vec3(coords,int(coords.y)))\t);\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\nvec4 color;\n\nvec2 xy =  vec2(gl_FragCoord.x,u_resolution.y-gl_FragCoord.y)/zoom;\n\nif(miniMap==1){\nxy+=vec2(-4.0,-31.0)/zoom;\n}else{\nxy+=-u_translation+vec2(mx,0.0)/zoom+0.5*(u_resolution-u_resolution/zoom);\n}\n\nvec2 xy32=xy/32.0;\n\nvec2 floorxy32=floor(xy32);\n\nvec2 xyr=xy32-floorxy32;\n\n\nvec2 xyb;\n\n\nfloat dx=0.0;\nfloat dy=0.0;\n\nif(xyr.x>0.5){dx=1.0;}\nif(xyr.y>0.5){dy=1.0;}\n\nvec2 oxy32=xy32;\n\n\nif(dx==1.0){\nxyb=vec2(borderCoords.x+floor(rand(floorxy32)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(-16.0,8.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.x+=dx;\n}\n}\n\nif(dy==1.0){\nxyb=vec2(borderCoords.x+floor(rand(1.5*floorxy32-3.0)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(8,-16.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.y+=dy;\n}\n}\n\n\nint type = texture(img_data,xy32/(mapSize)).r;\nint ntype = texture(img_data,oxy32/(mapSize)).r;\n\nif(type<0&&type!=ntype){\n\nif(ntype<0){\ntype=ntype;\n}else if(ntype==3){\ntype=ntype;\n}else{\ntype=1;\n}\n}\n\n\n\nfloat h;\nfloat w;\nvec2 xytxt;\nif(type<0){\n\ntype=-type-1;\nxytxt=waterBorder+vec2(float(type*8*32),0.0)/512.0;\nw=32.0;\nh=32.0;\ntype*=-1;\n}else{\nxytxt=vec2(terrainInfo[type*4],terrainInfo[type*4+1]);\nw=terrainInfo[type*4+2];\nh=terrainInfo[type*4+3];\n\nif(type==3) xytxt+=vec2(u_fps,0.0);\n}\n\n\nvec2 xyt=vec2(xytxt)+vec2(mod(xy.x,w),mod(xy.y,h))/512.0;\n\n\nif(type==3){ h=576.0; }\ncolor=sptexture3D(xyt,h/512.0);\n\nmediump vec4 light=vec4(1.0);\nif(miniMap==0) light = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+1.0;\n\n\n\nCOLOR=color*light*u_ambient;\n\n\n\n}");
g.compileShader(d);ba=g.createProgram();g.attachShader(ba,c);g.attachShader(ba,d);g.linkProgram(ba);c=g.getShaderInfoLog(c);console.log("Shader1 compiler log T: "+c);c=g.getShaderInfoLog(d);console.log("Shader compiler log T: "+c)}d=g.getAttribLocation(la,"a_position");c=g.getAttribLocation(la,"a_texCoord");var h=g.getAttribLocation(la,"a_kingdom"),l=g.getAttribLocation(la,"a_physic"),t=k,p=gd.dir,m=[];m.length=4*p.length;for(var n=0,q=p.length;n<q;n++){var r=ta[t[p[n]]],U=r[7]+r.deltaY;var Da=r[8];
var Ra=r[9];m[4*n]=r[6]/512;m[4*n+1]=U/512;m[4*n+2]=Da;m[4*n+3]=Ra}K(m);r=1/512;p=[];U={};q={1:2560,101001:2048,101E3:2048,1001:2048,1E3:2048,100:1536,10010100:1280,10100:1280,1001E4:1280,1E4:1280,10010010:256,10010110:256,10110:256,10111:256,10010111:256,110:512,111:512,11:512,10:512,111E5:2816,11E5:2816,11E6:2816,1E6:2816,1101E4:768,11110100:768,11010100:768,1111E4:768,1E7:3360,1E5:3072,1101E3:1792,1101001:1792,11101E3:1792,11101001:1792,101111:0,1011:0,1111:0,101011:0};for(n=0;n<a;n++)Da=f[n],
3==Da&&(Da=0,3!=f[n-1-b]&&(Da+=1E7),3!=f[n-b]&&(Da+=1E6),3!=f[n-b+1]&&(Da+=1E5),3!=f[n-1]&&(Da+=1E4),3!=f[n+1]&&(Da+=1E3),3!=f[n-1+b]&&(Da+=100),3!=f[n+b]&&(Da+=10),3!=f[n+1+b]&&(Da+=1),Da&&void 0!==q[Da]&&(p.add(n),U[p.length-1]=-q[Da]/256-1));n=0;for(q=p.length;n<q;f[p[n]]=U[n++]);g.useProgram(ba);hd=g.getUniformLocation(ba,"u_translation");sf=g.getUniformLocation(ba,"u_resolution");tf=g.getUniformLocation(ba,"u_fps");var O=g.getUniformLocation(ba,"u_ambient");Mc=g.getUniformLocation(ba,"zoom");
b=g.getUniformLocation(ba,"mx");a=g.getUniformLocation(ba,"mapSize");n=g.getUniformLocation(ba,"borderCoords");q=g.getUniformLocation(ba,"waterBorder");Td=g.getUniformLocation(ba,"miniMap");p=g.getUniformLocation(ba,"terrainInfo");g.uniform2fv(n,[ta[t.terrain_border][6]*r,r*(ta[t.terrain_border].deltaY+ta[t.terrain_border][7])]);g.uniform2fv(q,[ta[t.waterborder][6]*r,r*(ta[t.waterborder].deltaY+ta[t.waterborder][7])]);g.uniform1i(Td,0);g.uniform2fv(hd,[0,0]);g.uniform1f(tf,-1);g.uniform1f(Mc,1);g.uniform1f(b,
-A.mx);g.uniform1f(a,y);g.uniform1fv(p,m);b=g.getAttribLocation(ba,"a_position");uf=g.createVertexArray();g.bindVertexArray(uf);a=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,a);g.bufferData(g.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,1,1,-1,1]),g.STATIC_DRAW);g.enableVertexAttribArray(b);g.vertexAttribPointer(b,2,g.FLOAT,!1,0,0);g.bindVertexArray(null);g.useProgram(la);g.bindBuffer(g.ARRAY_BUFFER,null);b=y*qa*3;vf=g.createVertexArray();g.bindVertexArray(vf);Ya=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,
Ya);g.enableVertexAttribArray(h);g.vertexAttribPointer(h,4,g.FLOAT,!1,0,0);g.bufferData(g.ARRAY_BUFFER,16*b,g.DYNAMIC_DRAW);Nc=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,Nc);g.enableVertexAttribArray(c);g.vertexAttribPointer(c,4,g.FLOAT,!1,0,0);g.bufferData(g.ARRAY_BUFFER,16*b,g.DYNAMIC_DRAW);Sb=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,Sb);g.enableVertexAttribArray(d);g.vertexAttribPointer(d,3,g.FLOAT,!1,0,0);g.bufferData(g.ARRAY_BUFFER,12*b,g.DYNAMIC_DRAW);id=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,
id);g.enableVertexAttribArray(l);g.vertexAttribPointer(l,4,g.FLOAT,!1,0,0);g.bufferData(g.ARRAY_BUFFER,16*b,g.DYNAMIC_DRAW);g.bindVertexArray(null);Ud=g.getUniformLocation(la,"u_resolution");var v=g.getUniformLocation(la,"u_ambient");jd=g.getUniformLocation(la,"u_translation");Oc=g.getUniformLocation(la,"zoom");bh=g.getUniformLocation(la,"now");Vd=g.getUniformLocation(la,"miniMap");d=g.getUniformLocation(la,"zMax");g.uniform1f(d,u.zMax);g.uniform1i(Vd,0);g.useProgram(la);k.delay=[100,250,400,550,
650,750,850,1E3,1150,5150,7650,10150,13650,17150,21150,25150,100,200,300,400,500,600,700,800,900,1E3,1100,1200,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6500,7700,8900,10100,13600,17100,22100,8E3,8080,8160,8240,8320,8400,8480,100,200,300,400,500,600,700,800,900,1E3,1100,2400,3600,4800,6E3,7200,8400,11900,15400,20400,8E3,8077,8154,8231,8308,8385,8462,8539,8616,8693,8770,8847,8923,5E3,5072,5143,5215,5286,5358,5429,5501,5572,5644,5715,5787,5858,5929,100,200,300,400,500,600,700,800,
900,1E3,1100,1200,1300,1400,3700,4900,7100,9600,12600,17100,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,8833,8916,9E3,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,8833,8916,9E3,9080,5E3,5100,5200,5300,5400,5500,5600,5700,5850,6E3,70,140,210,280,350,420,490,560,630,700,770,840,910,980,4980,8980,12980,16980,20980,26980,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,4100,6300,8500,11E3,13500,17E3,20500,5E3,5100,5200,5300,5400,5500,5600,5700,5800,5900,6E3,125,
230,335,431,546,606,666,731,857,952,1045,1139,1238,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,3300,5800,8800,12E3,15500,5500,5600,5700,5800,5900,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6800,9800,12800,16300,19800,23800,28300,5E3,5100,5200,5300,5400,5500,5600,210,420,654,864,1074,1284,1494,108,244,380,516,652,788,924,1060,1196,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4100,6100,8100,11100,14100,17100,6E3,6100,6200,6300,6400,
6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5200,9E3,11E3,13800,17600,23400,7E3,7100,7200,7300,7400,8200,8300,8400,8500,8600,9600,9700,9800,9900,1E4,80,160,210,360,610,1010,1510,100,200,300,400,500,3500,7500,13500,40,80,120,160,200,240,280,320,360,400,440,480,520,2520,3520,4520,5520,6520,8520,11520,107,214,321,428,535,642,749,856,963,1070,1177,1284,1391,1498,7323,13148,18973,24798,30623,36448,7E3,7170,7340,7510,7680,7980,8150,8320,8490,8660,100,200,300,400,500,600,700,800,
900,1E3,1100,1200,1300,1400,4400,6400,8900,11400,14900,18400,7E3,7200,7400,7600,7800,8E3,8200,125,250,375,500,2E3,2125,2250,100,200,300,400,500,4E3,10500,100,200,300,400,500,600,700,800,900,8900,15900,21400,27400,33900,38900,44900,51900,800,1E3,1200,1400,1600,1800,2E3,2200,2400,2600,NaN,80,160,240,320,400,480,560,640,720,800,880,960,1040,5040,9040,12790,16540,19290,22040,25790,7671,7771,7871,7971,8071,8171,8271,100,200,300,400,500,600,700,800,900,1E3,1100,1200,6200,9700,13200,17200,21200,25200,29200,
35200,100,200,300,400,500,600,9600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,11300,17300,27300,37300,49300,64300,8E3,8228,8457,8685,8914,9142,9371,80,160,240,320,400,480,560,640,720,800,880,960,4960,8460,11460,14460,18460,22460,28460,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5400,8900,12900,16900,22900,28900,5E3,5143,5286,5429,5572,5715,5857,121,232,361,508,629,758,879,1018,1165,1425,1445,1465,1536,1692,100,200,300,400,500,600,
700,800,900,1E3,1100,1200,1300,5300,8300,11300,14800,18800,23300,29300,6E3,6171,6343,6514,6685,6857,7028,125,250,375,500,625,750,875,1E3,1125,1250,1375,1500,6500,10500,13500,16500,19500,23E3,27E3,31500,8E3,8185,8370,8555,8740,8925,9108,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4300,7800,11300,15300,19300,23800,29800,1E4,10107,10214,10321,10428,10535,10643,10750,10857,10964,11071,11178,11285,11393,190,369,547,726,904,1073,1241,1325,1398,1429,1586,
1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4900,8400,12900,17400,22400,27400,8E3,8250,8500,8750,9E3,9250,9500,9750,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,8300,11800,15800,19800,24300,29300,5E3,5157,5314,5471,5628,5785,5943,125,250,375,500,625,3125,3250,3375,100,200,300,400,500,600,4600,8600,14600,15600,14E3,14143,14286,
14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14400,18400,22400,28400,180,360,540,720,900,1080,10080,100,200,350,500,600,700,800,950,1100,1250,1400,1550,1700,6200,8700,11700,15200,18700,22700,27700,6E3,6120,6240,6360,6480,6600,6720,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14900,18900,23400,29400,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,7400,10900,14900,19900,5E3,
5100,5200,5300,5400,5500,5600,116,232,348,464,522,580,638,696,812,928,1044,1160,1276,1392,100,200,300,400,500,600,700,800,900,1E3,1100,1200,5200,8700,11700,14700,18700,22700,28700,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,6900,10900,14400,18400,22400,27400,7E3,7100,7200,7300,7400,7500,7600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8600,10800,13E3,15500,19500,24E3,8E3,8100,8200,8300,8400,8500,8600,100,200,300,400,500,600,700,800,
900,1E3,1100,1200,1300,5300,8800,12300,16300,20300,24300,29300,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1630,1730,1830,1930,2030,2130,2230,2330,5330,8330,11330,7E3,7150,7300,7450,7600,7750,7900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,5200,8700,12200,15700,20200,24700,29700,34700,8E3,8080,8163,8246,8330,8413,8496,8580,8663,8746,8830,8913,8996,9080,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,
21800,26300,5E3,5086,5171,5257,5342,5428,5513,5599,5684,5770,5855,5941,6026,6112,125,250,375,500,625,750,875,1E3,1125,1250,1375,1500,1625,5625,8625,11625,14625,18125,22125,26625,8E3,8185,8370,8555,8740,8925,9108,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,6100,10600,14600,18100,21600,26100,30600,35600,40600,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1700,6700,10700,11300,
6E3,6200,6400,6600,6800,7E3,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,10400,100,200,300,400,500,600,8600];d=k.delay;var ra=d.length;ta[k.expl_small_hole][1]=-ra;for(c=n=0;14>n;n++)c+=66,d[n+ra]=c;d.put(c+3E4);d=new Float32Array(d);ch=function(f){g.useProgram(ba);g.uniform4fv(O,f);g.useProgram(la);g.uniform4fv(v,f)};yf=function(f){if(f.clientX>A.menumx||Pc||!f.clientX){f=.07*Math.sign(f.deltaY)*da;var b=(da+f)*tzar.height*.03125;(da+f)*tzar.width*.03125-(da+f)*A.mx/32>y||b>qa||
(da+=f,.08>da&&(da=.08),sb(),kd(-gb,-rb),g.useProgram(ba),g.uniform1f(Mc,1/da),g.useProgram(la),g.uniform1f(Oc,1/da))}};window.addEventListener("wheel",yf,!1);dh=function(){ra=[gb,rb];g.useProgram(ba);g.uniform2fv(hd,ra);g.useProgram(la);g.uniform2fv(jd,ra)};ch(eh());K(eh());g.uniform1f(Oc,1);g.uniform2fv(jd,[0,0]);var N=g.createFramebuffer(),ac;ld=function(){var f=window.innerWidth,b=window.innerHeight;tzar.width=f;tzar.height=b;g.useProgram(ba);g.uniform2f(sf,f,b);g.useProgram(la);N.width=f;N.height=
b;g.activeTexture(g.TEXTURE2);ac||(ac=g.createTexture());g.bindTexture(g.TEXTURE_2D,ac);g.texImage2D(g.TEXTURE_2D,0,g.RGBA,f,b,0,g.RGBA,g.UNSIGNED_BYTE,null);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.bindFramebuffer(g.FRAMEBUFFER,N);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,
ac,0);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);g.bindFramebuffer(g.FRAMEBUFFER,null);da=1;g.uniform1f(Oc,1/da);g.uniform1i(g.getUniformLocation(la,"lightmap"),2);g.useProgram(ba);g.uniform1i(g.getUniformLocation(ba,"lightmap"),2);g.uniform1f(Mc,1/da);g.useProgram(la);g.uniform2f(Ud,f,b);g.viewport(A.mx,0,f,b);ld.changed=1;kd(-gb,-rb)};ld.changed=0;window.addEventListener("resize",ld,!1);ld();g.blendEquation(g.FUNC_ADD);g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA);g.disable(g.DITHER);g.disable(g.BLEND);
performance.now();c=g.createTexture();h=P.info;K(x);g.bindTexture(g.TEXTURE_2D,c);g.texImage2D(g.TEXTURE_2D,0,g.RGBA32F,512,512,0,g.RGBA,g.FLOAT,h);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT);g.bindTexture(g.TEXTURE_2D,null);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,c);g.uniform1i(g.getUniformLocation(la,
"u_image1"),0);g.activeTexture(g.TEXTURE1);c=g.createTexture();g.bindTexture(g.TEXTURE_2D_ARRAY,c);g.texParameteri(g.TEXTURE_2D_ARRAY,g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D_ARRAY,g.TEXTURE_MIN_FILTER,g.NEAREST);h=P.common;l=h.length;r=P.xtra;n=0;for(q=r.length;n<q;l+=r[n++].length);K(P);g.texImage3D(g.TEXTURE_2D_ARRAY,0,g.RGBA,P.size,P.size,l/(4*P.size*P.size),0,g.RGBA,g.UNSIGNED_BYTE,null);l=h.length;g.texSubImage3D(g.TEXTURE_2D_ARRAY,0,0,0,0,P.size,P.size,h.length/(4*P.size*
P.size),g.RGBA,g.UNSIGNED_BYTE,h);n=0;for(q=r.length;n<q;n++)h=r[n],g.texSubImage3D(g.TEXTURE_2D_ARRAY,0,0,0,l/1048576,P.size,P.size,h.length/(4*P.size*P.size),g.RGBA,g.UNSIGNED_BYTE,h),l+=h.length;K(l);g.activeTexture(g.TEXTURE1);g.bindTexture(g.TEXTURE_2D_ARRAY,c);g.uniform1i(g.getUniformLocation(la,"img_common"),1);g.useProgram(ba);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D_ARRAY,c);g.uniform1i(g.getUniformLocation(ba,"img_common"),0);g.useProgram(ba);g.activeTexture(g.TEXTURE1);c=
g.createTexture();g.bindTexture(g.TEXTURE_2D,c);g.texImage2D(g.TEXTURE_2D,0,g.R8I,y,qa,0,g.RED_INTEGER,g.BYTE,f);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT);g.bindTexture(g.TEXTURE_2D,null);g.bindTexture(g.TEXTURE_2D,c);g.uniform1i(g.getUniformLocation(ba,"img_data"),1);g.useProgram(la);g.activeTexture(g.TEXTURE2);
fd||(K(d),g.activeTexture(g.TEXTURE3),c=g.createTexture(),g.bindTexture(g.TEXTURE_2D,c),g.texImage2D(g.TEXTURE_2D,0,g.R16F,d.length,1,0,g.RED,g.FLOAT,d),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT),g.bindTexture(g.TEXTURE_2D,null),g.bindTexture(g.TEXTURE_2D,c),g.uniform1i(g.getUniformLocation(la,"delay"),3),g.activeTexture(g.TEXTURE2),
zf=g.createTexture(),g.bindTexture(g.TEXTURE_2D,zf),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT),g.clearColor(0,0,0,1));g.bindFramebuffer(g.FRAMEBUFFER,N);N.width=1;N.height=1;g.framebufferTexture2D(g.FRAMEBUFFER,
g.COLOR_ATTACHMENT0,g.TEXTURE_2D,ac,0);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);g.bindFramebuffer(g.FRAMEBUFFER,null);new Float32Array(8);Af=g.createBuffer();Bf=g.createBuffer();fh=g.createBuffer();n=0;for(q=Cf.length;n<q;n++)Sa(Cf[n]);g.enable(g.DEPTH_TEST);g.depthFunc(g.LEQUAL);Za.fp1000=1E3;Za.delta=0;Za.now=0;Za.frameCount=0;g.bindTexture(g.TEXTURE_2D,ac);fd=P.setup=!0}function Qc(f,b,a){f=b||Qc;K(f);if(A.gl){u.editor?(A.marx=0,A.mary=60,A.menumy=60,$a=Tb=171,A.mx=0,A.menumx=171):(A.mx=
151,$a=Tb=128,A.menumx=151,A.menumy=0,A.marx=4,A.mary=31);kc.style.width=Tb+"px";kc.style.height=$a+"px";kc.style.left=A.marx+"px";kc.style.top=A.mary+"px";w("loading").style.display="block";origin=!1;K(P.load,P.images);if(P.load<P.images||!P.images)return P.started||(w("qdgraphics")&&(w("qdgraphics").style.display="none"),gh()),w("loadingtext").innerHTML=z.waitImages,Gb=f,!1;if(Df.last!==w("terrainSelect").value)return Ef=!0,w("loadingtext").innerHTML="Downloading terrain",Aj(),Gb=f,!1;Bj();w("notifybottom").style.display=
"none";void 0==u.arje&&Ff();u.demo?w("saveGame").style.display="none":w("saveGame").style.display="block";K(C);if(!a){a=0;for(f=C.length;a<f;a++){b=C[a];for(var c=[0],d=0;d<f;d++)c[d+1]=C[d].team==b.team?0:1;c.put(1);u.online&&b.id===A.onlineID&&(A.kingdom=a+1);new bc(b.name,b.color,c,b.race,b.IA,[u.goldRes,u.woodRes,u.foodRes,u.stoneRes],b.team)}new bc("",[255,255,255],[0],!0)}A.kingdom||(A.kingdom=1);Cj();return!0}lc("You can't run WEBGL 2<br>More info <a href='http://webglreport.com/?v=2'>here</a>",
"Error")}function Gf(){Hf("playingMenu")}function Dj(f){K("setup:",f);f.toSend=[];f.orderList=[];f.sendDirectly("channelMessage","nehhof",{});f.channels.channelMessage.onopen=function(){K("DATACHANNEL OPEN");for(var b=0,a=C.length;b<a;b++)if(C[b].id==f.id)f.username=C[b].name,Ub[b]&&(Ub[b].style.background="#00ff00",Ub[b].style.boxShadow="0px 0px 30px 0px #00ff00");else if(C[b].id==A.onlineID){var c=C[b],d=c.color;K("sending");d="#"+(16777216+(d[0]<<16)+(d[1]<<8)+d[2]).toString(16).slice(1);ea(If,
d,0,[f],2);ea(Jf,c.team,0,[f],2);ea(Kf,c.race,0,[f],2);ea(hh,A.name,0,[f],2)}};f.channels.channelMessage.onerror=function(f){K(f)}}function ih(){document.getElementById("buttons").innerHTML="";document.getElementById("onlineID").value="";document.getElementById("gameName").innerHTML=""}function Lf(){A.p2p?(Rc(),A.p2p.emit("getRooms"),w("returnmenu").style.display="block"):(Fa||Hb(),Hb.func=Lf)}function jh(){var f=location,b=f.hash.substr(1);""==b&&(document.getElementById("returnmenu").style.display=
"none");if("MatchX"==b.substr(0,6))6<b.length&&Ej(b.substr(6-b.length));else if("Room"==f.hash.substr(-4))f=f.hash.substr(1),A.admin||kh(f.substr(0,f.length-4));else if(lh[b])lh[b]();else f.hash=""}function mh(f){var b=new Date;f=new Uint32Array(f);for(var a,c=y,d=0;d<Y.length;d++)Y[d]!=f[d]&&(a=f[d],Y[d]=a,a=B[a],a.x32=d%c,a.y32=~~(d/c));console.log(new Date-b)}function nh(f){f=new Uint32Array(f);console.log(f)}function Hf(f){f=document.getElementById(f);f.style.display="none"==f.style.display?"block":
"none"}function oh(f){f.style.display="none"==f.style.display?"block":"none"}function ph(f){L=function(){};Ib=!1;var b=fa;b.d=f.d;ObjectsetupIMG(b,f.img);b.active=!0;hb=x[52];md=f;document.addEventListener("mousemove",Mf);document.addEventListener("mousedown",Wd)}function Fj(f,b){return f.innerHTML-b.innerHTML}var y,qa,z={},A={name:"Guest"};console.log("%c nehhon %c POWER ","background: #000; color: #00ffff; font-size:35px","background: #00ffff; color: #000; font-size:35px");console.log("%c Author: Ruben ",
"background: #00ffff; color: #000; font-size:35px");console.log("%c webmaster@nehhon.com ","background: #00ffff; color: #000; font-size:35px");console.log("%c @nehhon ","background: #00ffff; color: #000; font-size:35px");var Gj=!!window.opr||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),Hj="undefined"!==typeof InstallTrigger,Ij=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),qh=!!document.documentMode,Jj=!qh&&!!window.StyleMedia,Kj=!!window.chrome&&!!window.chrome.webstore,
mc;Gj?mc="Opera":Hj?mc="Firefox":Ij?mc="Safari":qh?mc="IE":Jj?mc="Edge":Kj&&(mc="Chrome");A.navLang=navigator.language||navigator.userLanguage;(function(){var f=A.navLang.substr(0,2);({es:1,it:1,pl:1,ru:1,pt:1,bg:1,de:1})[f]&&(window.history.pushState("","","/"+f+"/"+location.hash),document.getElementsByTagName("html")[0].lang=f)})();A.race=0;A.navigator=mc;A.mx=151;A.onlineID=null;A.temperature=0;var Lj=location.pathname.split("/")[1],rh="en es it pt ru pl bg de".split(" ");A.lang=rh.indexOf(Lj);
0>A.lang&&(A.lang=0);A.langCodeUrl=A.lang?rh[A.lang]+"/":"";var K=console.log,Mj=document.getElementById("alerttitle"),Nj=document.getElementById("alerttext"),Oj=document.getElementById("alert"),lc=function(f,b,a){Oj.style.display="block";Mj.innerHTML=b||z.warning;Nj.innerHTML=f;a?document.getElementById("alertok").style.display="none":document.getElementById("alertok").style.display="block";w("basic").style.filter="blur(94px)"},gh,th=function(f,b,a){var c=new XMLHttpRequest;c.open("GET",f,!0);c.responseType=
"arraybuffer";c.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");c.onreadystatechange=function(){4==this.readyState&&200==this.status&&(b.length?P[b]=sh(c.response):P.xtra[b]=sh(c.response),P.load++,Gb&&P.load===P.images&&Gb())};a&&(c.onprogress=function(f){a(f)});c.send(!0)},sh=function(f){performance.now();f=new Uint16Array(f);var b=f.length,a=f[b-4]+65536*f[b-3],c=f[b-2]+65536*f[b-1];b-=2;var d=-1;c=new Uint8Array(4*c);for(var h=0;a<b;a++){var l=f[a];if(65533<l){65535==
l?(l=f[a+1],a+=1):(l=f[a+1]+65536*f[a+2],a+=2);for(var t=0;t<l;t++)c[h++]=d&255,c[h++]=d>>8&255,c[h++]=d>>16&255,c[h++]=d>>24&255}else l=f[2*l]+65536*f[2*l+1],c[h++]=l&255,c[h++]=l>>8&255,c[h++]=l>>16&255,c[h++]=l>>24&255,d=l}return c},P={size:512,load:0,xtra:[]},Gb;P.xtraRes=[];var H={page:0,length:8,leftButton:document.getElementById("aleft"),rightButton:document.getElementById("aright"),stock:document.getElementById("stock")},k;(function(){var f=0,b=0,a=function(a){a.target.loadedSize||(b+=a.total,
a.target.lastLoaded=0,a.target.loadedSize=!0);f+=a.loaded-a.target.lastLoaded;a.target.lastLoaded=a.loaded;c.innerHTML=z.loadgraphics+" "+~~(100*f/b)+"%";c.style.display=f>=b?"none":"block"},c=document.getElementById("notifybottom"),d=function(f){var b=!!f.icons;P.images=Object.keys(f).length;if(b){var d=new XMLHttpRequest;d.open("GET",f.icons,!0);d.responseType="arraybuffer";d.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");d.onreadystatechange=function(){if(4===
d.readyState&&200===d.status){var f=new Uint8Array(d.response);f=new Blob([f],{type:"image/png"});var b=new Image;b.src=URL.createObjectURL(f);P.load++;H.icons=b;Gb&&P.load===P.images&&Gb();Date.now()}};d.onprogress=function(f){a(f)};d.send("")}Date.now();var c=new XMLHttpRequest;c.open("GET",f.imageJSON,!0);b&&c.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");c.onreadystatechange=function(){4==this.readyState&&200==this.status&&(P.load++,Gb&&P.load===P.images&&Gb(),
k=JSON.parse(c.response))};c.onprogress=function(f){a(f)};c.send(!0);th(f.common,"common",a)};(function(){var f=!1;"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/sworker.js").then(function(){console.log("CLIENT: service worker registration complete.")},function(f){K(f);console.log("CLIENT: service worker registration failure.")})):console.log("CLIENT: service worker is not supported.");gh=function(){P.started=!0;f||(f=
!0,d({icons:"https://dl.dropboxusercontent.com/s/mpc0k7ep2l0v0j2/icons.png",imageJSON:"https://dl.dropboxusercontent.com/s/iea7wlmxml6pus0/images.json",common:"https://dl.dropboxusercontent.com/s/avpm3elzmphq5b1/graphics.nh17"}))}})();setTimeout(function(){P.load<P.images&&(c.style.display="block")},1200)})();var Df={grass:{json:"agjeb95idjel2dr/terrainData.json?v5",main:"xg1qh97bjrm61x0/grass.nh17"},snow:{json:"hwja6mugluokbkh/terrainData.json?v3",main:"1x2cwzm0i7v2sz8/terrain.nh17?v1"},last:""},
Xd,Aj=function(){P.images+=2;var f=Df[w("terrainSelect").value];Df.last=w("terrainSelect").value;var b=new XMLHttpRequest;b.open("GET","https://dl.dropboxusercontent.com/s/"+f.json,!0);b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onreadystatechange=function(){if(4==this.readyState&&200==this.status){P.xtraRes[0]=JSON.parse(b.response);gd=P.xtraRes[0];var f=gd.specialColor;Xd=new Float32Array(wb(f[0]/255,f[1]/255,f[2]/255,.9));P.load++;f="rgb("+f[0]+","+f[1]+
","+f[2]+")";w("msgs1").style.color=f;w("playersinfo").style.color=f;w("topinfo").style.color=f;Gb&&P.load===P.images&&Gb()}};b.send(!0);th("https://dl.dropboxusercontent.com/s/"+f.main,0,!1)}(function(f){"object"===typeof exports&&"undefined"!==typeof module?module.exports=f():"function"===typeof define&&define.amd?define([],f):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).SimpleWebRTC=f()})(function(){return function d(b,a,c){function e(h,
t){if(!a[h]){if(!b[h]){var p="function"==typeof require&&require;if(!t&&p)return p(h,!0);if(l)return l(h,!0);t=Error("Cannot find module '"+h+"'");throw t.code="MODULE_NOT_FOUND",t;}t=a[h]={exports:{}};b[h][0].call(t.exports,function(a){var d=b[h][1][a];return e(d?d:a)},t,t.exports,d,b,a,c)}return a[h].exports}for(var l="function"==typeof require&&require,t=0;t<c.length;t++)e(c[t]);return e}({1:[function(b,a,c){function d(){}a.exports=function(b,a,c){function e(b,d){if(0>=e.count)throw Error("after called too many times");
--e.count;b?(h=!0,a(b),a=c):0!==e.count||h||a(null,d)}var h=!1;c=c||d;e.count=b;return 0===b?a():e}},{}],2:[function(b,a,c){a.exports=function(b,a,c){var d=b.byteLength;a=a||0;c=c||d;if(b.slice)return b.slice(a,c);0>a&&(a+=d);0>c&&(c+=d);c>d&&(c=d);if(a>=d||a>=c||0===d)return new ArrayBuffer(0);b=new Uint8Array(b);d=new Uint8Array(c-a);for(var e=0;a<c;a++,e++)d[e]=b[a];return d.buffer}},{}],3:[function(b,a,c){a.exports=function(b,a,c){var d,e=a;a={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};
if(c)for(d in c)a[d]=c[d];e?"audio"===e.tagName.toLowerCase()&&(a.audio=!0):e=document.createElement(a.audio?"audio":"video");a.disableContextMenu&&(e.oncontextmenu=function(b){b.preventDefault()});a.autoplay&&(e.autoplay="autoplay");a.muted&&(e.muted=!0);!a.audio&&a.mirror&&["","moz","webkit","o","ms"].forEach(function(b){e.style[b?b+"Transform":"transform"]="scaleX(-1)"});e.srcObject=b;return e}},{}],4:[function(b,a,c){function d(b){b=b||{};this.ms=b.min||100;this.max=b.max||1E4;this.factor=b.factor||
2;this.jitter=0<b.jitter&&1>=b.jitter?b.jitter:0;this.attempts=0}a.exports=d;d.prototype.duration=function(){var b=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),d=Math.floor(a*this.jitter*b);b=0==(Math.floor(10*a)&1)?b-d:b+d}return Math.min(b,this.max)|0};d.prototype.reset=function(){this.attempts=0};d.prototype.setMin=function(b){this.ms=b};d.prototype.setMax=function(b){this.max=b};d.prototype.setJitter=function(b){this.jitter=b}},{}],5:[function(b,a,c){(function(b){c.encode=
function(a){a=new Uint8Array(a);var c,d=a.length,e="";for(c=0;c<d;c+=3)e+=b[a[c]>>2],e+=b[(a[c]&3)<<4|a[c+1]>>4],e+=b[(a[c+1]&15)<<2|a[c+2]>>6],e+=b[a[c+2]&63];2===d%3?e=e.substring(0,e.length-1)+"=":1===d%3&&(e=e.substring(0,e.length-2)+"==");return e};c.decode=function(a){var c=.75*a.length,d=a.length,e=0;"="===a[a.length-1]&&(c--,"="===a[a.length-2]&&c--);var h=new ArrayBuffer(c),n=new Uint8Array(h);for(c=0;c<d;c+=4){var q=b.indexOf(a[c]);var r=b.indexOf(a[c+1]);var U=b.indexOf(a[c+2]);var Da=
b.indexOf(a[c+3]);n[e++]=q<<2|r>>4;n[e++]=(r&15)<<4|U>>2;n[e++]=(U&3)<<6|Da&63}return h}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],6:[function(b,a,c){(function(b){function c(b){for(var a=0;a<b.length;a++){var c=b[a];if(c.buffer instanceof ArrayBuffer){var d=c.buffer;if(c.byteLength!==d.byteLength){var e=new Uint8Array(c.byteLength);e.set(new Uint8Array(d,c.byteOffset,c.byteLength));d=e.buffer}b[a]=d}}}function d(b,a){a=a||{};var d=new p;c(b);for(var e=0;e<b.length;e++)d.append(b[e]);
return a.type?d.getBlob(a.type):d.getBlob()}function e(b,a){c(b);return new Blob(b,a||{})}var p=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder;try{var m=2===(new Blob(["hi"])).size}catch(r){m=!1}var n;if(n=m)try{n=2===(new Blob([new Uint8Array([1,2])])).size}catch(r){n=!1}var q=p&&p.prototype.append&&p.prototype.getBlob;b=m?n?b.Blob:e:q?d:void 0;a.exports=b}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},
{}],7:[function(b,a,c){var d=[].slice;a.exports=function(b,a){"string"==typeof a&&(a=b[a]);if("function"!=typeof a)throw Error("bind() requires a function");var c=d.call(arguments,2);return function(){return a.apply(b,c.concat(d.call(arguments)))}}},{}],8:[function(b,a,c){function d(b){if(b){for(var a in d.prototype)b[a]=d.prototype[a];return b}}a.exports=d;d.prototype.on=d.prototype.addEventListener=function(b,a){this._callbacks=this._callbacks||{};(this._callbacks[b]=this._callbacks[b]||[]).push(a);
return this};d.prototype.once=function(b,a){function c(){d.off(b,c);a.apply(this,arguments)}var d=this;this._callbacks=this._callbacks||{};c.fn=a;this.on(b,c);return this};d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(b,a){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var c=this._callbacks[b];if(!c)return this;if(1==arguments.length)return delete this._callbacks[b],this;for(var d,e=0;e<
c.length;e++)if(d=c[e],d===a||d.fn===a){c.splice(e,1);break}return this};d.prototype.emit=function(b){this._callbacks=this._callbacks||{};var a=[].slice.call(arguments,1),c=this._callbacks[b];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,a)}return this};d.prototype.listeners=function(b){this._callbacks=this._callbacks||{};return this._callbacks[b]||[]};d.prototype.hasListeners=function(b){return!!this.listeners(b).length}},{}],9:[function(b,a,c){a.exports=function(b,a){var c=function(){};
c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b}},{}],10:[function(b,a,c){function d(b){return d.enabled(b)?function(a){a instanceof Error&&(a=a.stack||a.message);var c=new Date,e=c-(d[b]||c);d[b]=c;a=b+" "+a+" +"+d.humanize(e);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}a.exports=d;d.names=[];d.skips=[];d.enable=function(b){try{localStorage.debug=b}catch(m){}for(var a=(b||"").split(/[\s,]+/),c=a.length,e=0;e<c;e++)b=
a[e].replace("*",".*?"),"-"===b[0]?d.skips.push(new RegExp("^"+b.substr(1)+"$")):d.names.push(new RegExp("^"+b+"$"))};d.disable=function(){d.enable("")};d.humanize=function(b){return 36E5<=b?(b/36E5).toFixed(1)+"h":6E4<=b?(b/6E4).toFixed(1)+"m":1E3<=b?(b/1E3|0)+"s":b+"ms"};d.enabled=function(b){for(var a=0,c=d.skips.length;a<c;a++)if(d.skips[a].test(b))return!1;a=0;for(c=d.names.length;a<c;a++)if(d.names[a].test(b))return!0;return!1};try{window.localStorage&&d.enable(localStorage.debug)}catch(h){}},
{}],11:[function(b,a,c){a.exports=b("./lib/")},{"./lib/":12}],12:[function(b,a,c){a.exports=b("./socket");a.exports.parser=b("engine.io-parser")},{"./socket":13,"engine.io-parser":24}],13:[function(b,a,c){(function(c){function d(b,a){if(!(this instanceof d))return new d(b,a);a=a||{};b&&"object"==typeof b&&(a=b,b=null);b&&(b=q(b),a.host=b.host,a.secure="https"==b.protocol||"wss"==b.protocol,a.port=b.port,b.query&&(a.query=b.query));this.secure=null!=a.secure?a.secure:c.location&&"https:"==location.protocol;
a.host&&(b=a.host.split(":"),a.hostname=b.shift(),b.length?a.port=b.pop():a.port||(a.port=this.secure?"443":"80"));this.agent=a.agent||!1;this.hostname=a.hostname||(c.location?location.hostname:"localhost");this.port=a.port||(c.location&&location.port?location.port:this.secure?443:80);this.query=a.query||{};"string"==typeof this.query&&(this.query=U.decode(this.query));this.upgrade=!1!==a.upgrade;this.path=(a.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!a.forceJSONP;this.jsonp=!1!==
a.jsonp;this.forceBase64=!!a.forceBase64;this.enablesXDR=!!a.enablesXDR;this.timestampParam=a.timestampParam||"t";this.timestampRequests=a.timestampRequests;this.transports=a.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=a.policyPort||843;this.rememberUpgrade=a.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=a.onlyBinaryUpgrades;this.pfx=a.pfx||null;this.key=a.key||null;this.passphrase=a.passphrase||null;this.cert=
a.cert||null;this.ca=a.ca||null;this.ciphers=a.ciphers||null;this.rejectUnauthorized=a.rejectUnauthorized||null;this.open()}var e=b("./transports"),t=b("component-emitter"),p=b("debug")("engine.io-client:socket"),m=b("indexof"),n=b("engine.io-parser"),q=b("parseuri"),r=b("parsejson"),U=b("parseqs");a.exports=d;d.priorWebsocketSuccess=!1;t(d.prototype);d.protocol=n.protocol;d.Socket=d;d.Transport=b("./transport");d.transports=b("./transports");d.parser=b("engine.io-parser");d.prototype.createTransport=
function(b){p('creating transport "%s"',b);var a=this.query,c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);c.EIO=n.protocol;c.transport=b;this.id&&(c.sid=this.id);return new e[b]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:c,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,
key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})};d.prototype.open=function(){if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))var b="websocket";else{if(0==this.transports.length){var a=this;setTimeout(function(){a.emit("error","No transports available")},0);return}b=this.transports[0]}this.readyState="opening";try{b=this.createTransport(b)}catch(O){this.transports.shift();
this.open();return}b.open();this.setTransport(b)};d.prototype.setTransport=function(b){p("setting transport %s",b.name);var a=this;this.transport&&(p("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=b;b.on("drain",function(){a.onDrain()}).on("packet",function(b){a.onPacket(b)}).on("error",function(b){a.onError(b)}).on("close",function(){a.onClose("transport close")})};d.prototype.probe=function(b){function a(){if(r.onlyBinaryUpgrades){var a=
!this.supportsBinary&&r.transport.supportsBinary;q=q||a}q||(p('probe transport "%s" opened',b),n.send([{type:"ping",data:"probe"}]),n.once("packet",function(a){q||("pong"==a.type&&"probe"==a.data?(p('probe transport "%s" pong',b),r.upgrading=!0,r.emit("upgrading",n),n&&(d.priorWebsocketSuccess="websocket"==n.name,p('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){q||"closed"==r.readyState||(p("changing transport and sending upgrade packet"),m(),r.setTransport(n),n.send([{type:"upgrade"}]),
r.emit("upgrade",n),n=null,r.upgrading=!1,r.flush())}))):(p('probe transport "%s" failed',b),a=Error("probe error"),a.transport=n.name,r.emit("upgradeError",a)))}))}function c(){q||(q=!0,m(),n.close(),n=null)}function e(a){var d=Error("probe error: "+a);d.transport=n.name;c();p('probe transport "%s" failed because of error: %s',b,a);r.emit("upgradeError",d)}function h(){e("transport closed")}function l(){e("socket closed")}function t(b){n&&b.name!=n.name&&(p('"%s" works - aborting "%s"',b.name,n.name),
c())}function m(){n.removeListener("open",a);n.removeListener("error",e);n.removeListener("close",h);r.removeListener("close",l);r.removeListener("upgrading",t)}p('probing transport "%s"',b);var n=this.createTransport(b,{probe:1}),q=!1,r=this;d.priorWebsocketSuccess=!1;n.once("open",a);n.once("error",e);n.once("close",h);this.once("close",l);this.once("upgrading",t);n.open()};d.prototype.onOpen=function(){p("socket open");this.readyState="open";d.priorWebsocketSuccess="websocket"==this.transport.name;
this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){p("starting upgrade probes");for(var b=0,a=this.upgrades.length;b<a;b++)this.probe(this.upgrades[b])}};d.prototype.onPacket=function(b){if("opening"==this.readyState||"open"==this.readyState)switch(p('socket receive: type "%s", data "%s"',b.type,b.data),this.emit("packet",b),this.emit("heartbeat"),b.type){case "open":this.onHandshake(r(b.data));break;case "pong":this.setPing();break;case "error":var a=Error("server error");
a.code=b.data;this.emit("error",a);break;case "message":this.emit("data",b.data),this.emit("message",b.data)}else p('packet received with socket readyState "%s"',this.readyState)};d.prototype.onHandshake=function(b){this.emit("handshake",b);this.id=b.sid;this.transport.query.sid=b.sid;this.upgrades=this.filterUpgrades(b.upgrades);this.pingInterval=b.pingInterval;this.pingTimeout=b.pingTimeout;this.onOpen();"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),
this.on("heartbeat",this.onHeartbeat))};d.prototype.onHeartbeat=function(b){clearTimeout(this.pingTimeoutTimer);var a=this;a.pingTimeoutTimer=setTimeout(function(){if("closed"!=a.readyState)a.onClose("ping timeout")},b||a.pingInterval+a.pingTimeout)};d.prototype.setPing=function(){var b=this;clearTimeout(b.pingIntervalTimer);b.pingIntervalTimer=setTimeout(function(){p("writing ping packet - expecting pong within %sms",b.pingTimeout);b.ping();b.onHeartbeat(b.pingTimeout)},b.pingInterval)};d.prototype.ping=
function(){this.sendPacket("ping")};d.prototype.onDrain=function(){for(var b=0;b<this.prevBufferLen;b++)if(this.callbackBuffer[b])this.callbackBuffer[b]();this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0==this.writeBuffer.length?this.emit("drain"):this.flush()};d.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(p("flushing %d packets in socket",this.writeBuffer.length),
this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};d.prototype.write=d.prototype.send=function(b,a){this.sendPacket("message",b,a);return this};d.prototype.sendPacket=function(b,a,c){"closing"!=this.readyState&&"closed"!=this.readyState&&(b={type:b,data:a},this.emit("packetCreate",b),this.writeBuffer.push(b),this.callbackBuffer.push(c),this.flush())};d.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){var b=function(){d.once("upgrade",
a);d.once("upgradeError",a)},a=function(){d.removeListener("upgrade",a);d.removeListener("upgradeError",a);c()},c=function(){d.onClose("forced close");p("socket closing - telling transport to close");d.transport.close()};this.readyState="closing";var d=this;if(this.writeBuffer.length)this.once("drain",function(){this.upgrading?b():c()});else this.upgrading?b():c()}return this};d.prototype.onError=function(b){p("socket error %j",b);d.priorWebsocketSuccess=!1;this.emit("error",b);this.onClose("transport error",
b)};d.prototype.onClose=function(b,a){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){p('socket close with reason: "%s"',b);var c=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){c.writeBuffer=[];c.callbackBuffer=[];c.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",b,a)}};d.prototype.filterUpgrades=
function(b){for(var a=[],c=0,d=b.length;c<d;c++)~m(this.transports,b[c])&&a.push(b[c]);return a}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./transport":14,"./transports":15,"component-emitter":8,debug:21,"engine.io-parser":24,indexof:32,parsejson:40,parseqs:41,parseuri:23}],14:[function(b,a,c){function d(b){this.path=b.path;this.hostname=b.hostname;this.port=b.port;this.secure=b.secure;this.query=b.query;this.timestampParam=
b.timestampParam;this.timestampRequests=b.timestampRequests;this.readyState="";this.agent=b.agent||!1;this.socket=b.socket;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized}var e=b("engine.io-parser");b=b("component-emitter");a.exports=d;b(d.prototype);d.timestamps=0;d.prototype.onError=function(b,a){b=Error(b);b.type="TransportError";b.description=a;this.emit("error",
b);return this};d.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this};d.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),this.onClose();return this};d.prototype.send=function(b){if("open"==this.readyState)this.write(b);else throw Error("Transport not open");};d.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};d.prototype.onData=function(b){b=
e.decodePacket(b,this.socket.binaryType);this.onPacket(b)};d.prototype.onPacket=function(b){this.emit("packet",b)};d.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,"engine.io-parser":24}],15:[function(b,a,c){(function(a){var d=b("xmlhttprequest"),e=b("./polling-xhr"),t=b("./polling-jsonp"),p=b("./websocket");c.polling=function(b){var c=!1,h=!1,l=!1!==b.jsonp;a.location&&(h="https:"==location.protocol,(c=location.port)||(c=h?443:80),c=b.hostname!=
location.hostname||c!=b.port,h=b.secure!=h);b.xdomain=c;b.xscheme=h;if("open"in new d(b)&&!b.forceJSONP)return new e(b);if(!l)throw Error("JSONP disabled");return new t(b)};c.websocket=p}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(b,a,c){(function(c){function d(){}function e(b){t.call(this,b);this.query=this.query||{};q||(c.___eio||(c.___eio=
[]),q=c.___eio);this.index=q.length;var a=this;q.push(function(b){a.onData(b)});this.query.j=this.index;c.document&&c.addEventListener&&c.addEventListener("beforeunload",function(){a.script&&(a.script.onerror=d)},!1)}var t=b("./polling"),p=b("component-inherit");a.exports=e;var m=/\n/g,n=/\\n/g,q;p(e,t);e.prototype.supportsBinary=!1;e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),
this.iframe=this.form=null);t.prototype.doClose.call(this)};e.prototype.doPoll=function(){var b=this,a=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);a.async=!0;a.src=this.uri();a.onerror=function(a){b.onError("jsonp poll error",a)};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c);this.script=a;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var b=document.createElement("iframe");
document.body.appendChild(b);document.body.removeChild(b)},100)};e.prototype.doWrite=function(b,a){function c(){d();a()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(xf){e.onError("jsonp polling iframe removal error",xf)}try{p=document.createElement('<iframe src="javascript:0" name="'+e.iframeId+'">')}catch(xf){p=document.createElement("iframe"),p.name=e.iframeId,p.src="javascript:0"}p.id=e.iframeId;e.form.appendChild(p);e.iframe=p}var e=this;if(!this.form){var h=document.createElement("form"),
l=document.createElement("textarea"),t=this.iframeId="eio_iframe_"+this.index,p;h.className="socketio";h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=t;h.method="POST";h.setAttribute("accept-charset","utf-8");l.name="d";h.appendChild(l);document.body.appendChild(h);this.form=h;this.area=l}this.form.action=this.uri();d();b=b.replace(n,"\\\n");this.area.value=b.replace(m,"\\n");try{this.form.submit()}catch(xf){}this.iframe.attachEvent?this.iframe.onreadystatechange=
function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-inherit":9}],17:[function(b,a,c){(function(c){function d(){}function e(b){n.call(this,b);if(c.location){var a="https:"==location.protocol,d=location.port;d||(d=a?443:80);this.xd=b.hostname!=c.location.hostname||d!=b.port;this.xs=b.secure!=a}}function t(b){this.method=b.method||"GET";this.uri=
b.uri;this.xd=!!b.xd;this.xs=!!b.xs;this.async=!1!==b.async;this.data=void 0!=b.data?b.data:null;this.agent=b.agent;this.isBinary=b.isBinary;this.supportsBinary=b.supportsBinary;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized;this.create()}function p(){for(var b in t.requests)t.requests.hasOwnProperty(b)&&t.requests[b].abort()}var m=b("xmlhttprequest"),n=b("./polling"),
q=b("component-emitter"),r=b("component-inherit"),U=b("debug")("engine.io-client:polling-xhr");a.exports=e;a.exports.Request=t;r(e,n);e.prototype.supportsBinary=!0;e.prototype.request=function(b){b=b||{};b.uri=this.uri();b.xd=this.xd;b.xs=this.xs;b.agent=this.agent||!1;b.supportsBinary=this.supportsBinary;b.enablesXDR=this.enablesXDR;b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;return new t(b)};
e.prototype.doWrite=function(b,a){b=this.request({method:"POST",data:b,isBinary:"string"!==typeof b&&void 0!==b});var c=this;b.on("success",a);b.on("error",function(b){c.onError("xhr post error",b)});this.sendXhr=b};e.prototype.doPoll=function(){U("xhr poll");var b=this.request(),a=this;b.on("data",function(b){a.onData(b)});b.on("error",function(b){a.onError("xhr poll error",b)});this.pollXhr=b};q(t.prototype);t.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};
b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var a=this.xhr=new m(b),d=this;try{U("xhr open %s: %s",this.method,this.uri);a.open(this.method,this.uri,this.async);this.supportsBinary&&(a.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?a.setRequestHeader("Content-type","application/octet-stream"):a.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(wf){}"withCredentials"in
a&&(a.withCredentials=!0);this.hasXDR()?(a.onload=function(){d.onLoad()},a.onerror=function(){d.onError(a.responseText)}):a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status||1223==a.status)d.onLoad();else setTimeout(function(){d.onError(a.status)},0)};U("xhr data %s",this.data);a.send(this.data)}catch(wf){setTimeout(function(){d.onError(wf)},0);return}c.document&&(this.index=t.requestsCount++,t.requests[this.index]=this)};t.prototype.onSuccess=function(){this.emit("success");this.cleanup()};
t.prototype.onData=function(b){this.emit("data",b);this.onSuccess()};t.prototype.onError=function(b){this.emit("error",b);this.cleanup(!0)};t.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d;if(b)try{this.xhr.abort()}catch(Ra){}c.document&&delete t.requests[this.index];this.xhr=null}};t.prototype.onLoad=function(){try{try{var b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(O){}var a=
"application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(O){this.onError(O)}if(null!=a)this.onData(a)};t.prototype.hasXDR=function(){return"undefined"!==typeof c.XDomainRequest&&!this.xs&&this.enablesXDR};t.prototype.abort=function(){this.cleanup()};c.document&&(t.requestsCount=0,t.requests={},c.attachEvent?c.attachEvent("onunload",p):c.addEventListener&&c.addEventListener("beforeunload",p,!1))}).call(this,"undefined"!==typeof global?global:"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-emitter":8,"component-inherit":9,debug:21,xmlhttprequest:20}],18:[function(b,a,c){function d(b){var a=b&&b.forceBase64;if(!m||a)this.supportsBinary=!1;e.call(this,b)}var e=b("../transport"),l=b("parseqs"),t=b("engine.io-parser");c=b("component-inherit");var p=b("debug")("engine.io-client:polling");a.exports=d;var m=null!=(new (b("xmlhttprequest"))({xdomain:!1})).responseType;c(d,e);d.prototype.name="polling";d.prototype.doOpen=
function(){this.poll()};d.prototype.pause=function(b){function a(){p("paused");c.readyState="paused";b()}var c=this;this.readyState="pausing";if(this.polling||!this.writable){var d=0;this.polling&&(p("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){p("pre-pause polling complete");--d||a()}));this.writable||(p("we are currently writing - waiting to pause"),d++,this.once("drain",function(){p("pre-pause writing complete");--d||a()}))}else a()};d.prototype.poll=function(){p("polling");
this.polling=!0;this.doPoll();this.emit("poll")};d.prototype.onData=function(b){var a=this;p("polling got data %s",b);t.decodePayload(b,this.socket.binaryType,function(b,c,d){if("opening"==a.readyState)a.onOpen();if("close"==b.type)return a.onClose(),!1;a.onPacket(b)});"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():p('ignoring poll - transport state "%s"',this.readyState))};d.prototype.doClose=function(){function b(){p("writing close packet");
a.write([{type:"close"}])}var a=this;"open"==this.readyState?(p("transport open - closing"),b()):(p("transport not open - deferring close"),this.once("open",b))};d.prototype.write=function(b){var a=this;this.writable=!1;var c=function(){a.writable=!0;a.emit("drain")};a=this;t.encodePayload(b,this.supportsBinary,function(b){a.doWrite(b,c)})};d.prototype.uri=function(){var b=this.query||{},a=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(b[this.timestampParam]=+new Date+"-"+e.timestamps++);
this.supportsBinary||b.sid||(b.b64=1);b=l.encode(b);this.port&&("https"==a&&443!=this.port||"http"==a&&80!=this.port)&&(c=":"+this.port);b.length&&(b="?"+b);return a+"://"+this.hostname+c+this.path+b}},{"../transport":14,"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,xmlhttprequest:20}],19:[function(b,a,c){function d(b){b&&b.forceBase64&&(this.supportsBinary=!1);e.call(this,b)}var e=b("../transport"),l=b("engine.io-parser"),t=b("parseqs");c=b("component-inherit");var p=b("debug")("engine.io-client:websocket"),
m=b("ws");a.exports=d;c(d,e);d.prototype.name="websocket";d.prototype.supportsBinary=!0;d.prototype.doOpen=function(){if(this.check()){var b=this.uri(),a={agent:this.agent};a.pfx=this.pfx;a.key=this.key;a.passphrase=this.passphrase;a.cert=this.cert;a.ca=this.ca;a.ciphers=this.ciphers;a.rejectUnauthorized=this.rejectUnauthorized;this.ws=new m(b,void 0,a);void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.binaryType="arraybuffer";this.addEventListeners()}};d.prototype.addEventListeners=function(){var b=
this;this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(){b.onClose()};this.ws.onmessage=function(a){b.onData(a.data)};this.ws.onerror=function(a){b.onError("websocket error",a)}};"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(d.prototype.onData=function(b){var a=this;setTimeout(function(){e.prototype.onData.call(a,b)},0)});d.prototype.write=function(b){var a=this;this.writable=!1;for(var c=0,d=b.length;c<d;c++)l.encodePacket(b[c],this.supportsBinary,function(b){try{a.ws.send(b)}catch(Ra){p("websocket closed before onclose event")}});
setTimeout(function(){a.writable=!0;a.emit("drain")},0)};d.prototype.onClose=function(){e.prototype.onClose.call(this)};d.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()};d.prototype.uri=function(){var b=this.query||{},a=this.secure?"wss":"ws",c="";this.port&&("wss"==a&&443!=this.port||"ws"==a&&80!=this.port)&&(c=":"+this.port);this.timestampRequests&&(b[this.timestampParam]=+new Date);this.supportsBinary||(b.b64=1);b=t.encode(b);b.length&&(b="?"+b);return a+"://"+this.hostname+
c+this.path+b};d.prototype.check=function(){return!!m&&!("__initialize"in m&&this.name===d.prototype.name)}},{"../transport":14,"component-inherit":9,debug:21,"engine.io-parser":24,parseqs:41,ws:66}],20:[function(b,a,c){var d=b("has-cors");a.exports=function(b){var a=b.xdomain,c=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!a||d))return new XMLHttpRequest}catch(p){}try{if("undefined"!=typeof XDomainRequest&&!c&&b)return new XDomainRequest}catch(p){}if(!a)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(p){}}},
{"has-cors":31}],21:[function(b,a,c){function d(){try{var b=localStorage.debug}catch(l){}return b}c=a.exports=b("./debug");c.log=function(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)};c.formatArgs=function(){var b=arguments,a=this.useColors;b[0]=(a?"%c":"")+this.namespace+(a?" %c":" ")+b[0]+(a?"%c ":" ")+"+"+c.humanize(this.diff);if(!a)return b;a="color: "+this.color;b=[b[0],a,"color: inherit"].concat(Array.prototype.slice.call(b,
1));var d=0,e=0;b[0].replace(/%[a-z%]/g,function(b){"%%"!==b&&(d++,"%c"===b&&(e=d))});b.splice(e,0,a);return b};c.save=function(b){try{null==b?localStorage.removeItem("debug"):localStorage.debug=b}catch(l){}};c.load=d;c.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)};c.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");
c.formatters.j=function(b){return JSON.stringify(b)};c.enable(d())},{"./debug":22}],22:[function(b,a,c){c=a.exports=function(b){function a(){}function h(){var b=+new Date;h.diff=b-(e||b);h.prev=e;e=h.curr=b;null==h.useColors&&(h.useColors=c.useColors());null==h.color&&h.useColors&&(h.color=c.colors[d++%c.colors.length]);var a=Array.prototype.slice.call(arguments);a[0]=c.coerce(a[0]);"string"!==typeof a[0]&&(a=["%o"].concat(a));var l=0;a[0]=a[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;
l++;d=c.formatters[d];"function"===typeof d&&(b=d.call(h,a[l]),a.splice(l,1),l--);return b});"function"===typeof c.formatArgs&&(a=c.formatArgs.apply(h,a));(h.log||c.log||console.log.bind(console)).apply(h,a)}a.enabled=!1;h.enabled=!0;var l=c.enabled(b)?h:a;l.namespace=b;return l};c.coerce=function(b){return b instanceof Error?b.stack||b.message:b};c.disable=function(){c.enable("")};c.enable=function(b){c.save(b);for(var a=(b||"").split(/[\s,]+/),d=a.length,e=0;e<d;e++)a[e]&&(b=a[e].replace(/\*/g,
".*?"),"-"===b[0]?c.skips.push(new RegExp("^"+b.substr(1)+"$")):c.names.push(new RegExp("^"+b+"$")))};c.enabled=function(b){var a;var d=0;for(a=c.skips.length;d<a;d++)if(c.skips[d].test(b))return!1;d=0;for(a=c.names.length;d<a;d++)if(c.names[d].test(b))return!0;return!1};c.humanize=b("ms");c.names=[];c.skips=[];c.formatters={};var d=0,e},{ms:38}],23:[function(b,a,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
e="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");a.exports=function(b){var a=b,c=b.indexOf("["),h=b.indexOf("]");-1!=c&&-1!=h&&(b=b.substring(0,c)+b.substring(c,h).replace(/:/g,";")+b.substring(h,b.length));b=d.exec(b||"");for(var l={},q=14;q--;)l[e[q]]=b[q]||"";-1!=c&&-1!=h&&(l.source=a,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=
!0);return l}},{}],24:[function(b,a,c){(function(a){function d(b,a,d){if(!a)return c.encodeBase64Packet(b,d);var e=new FileReader;e.onload=function(){b.data=e.result;c.encodePacket(b,a,!0,d)};return e.readAsArrayBuffer(b.data)}function e(b,a,c){var d=Array(b.length);c=q(b.length,c);for(var e=function(b,c,e){a(c,function(a,c){d[b]=c;e(a,d)})},h=0;h<b.length;h++)e(h,b[h],c)}var t=b("./keys"),p=b("has-binary"),m=b("arraybuffer.slice"),n=b("base64-arraybuffer"),q=b("after"),r=b("utf8"),U=navigator.userAgent.match(/Android/i),
g=/PhantomJS/i.test(navigator.userAgent),k=U||g;c.protocol=3;var O=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},u=t(O),ra={type:"error",data:"parser error"},N=b("blob");c.encodePacket=function(b,e,h,l){"function"==typeof e&&(l=e,e=!1);"function"==typeof h&&(l=h,h=null);var t=void 0===b.data?void 0:b.data.buffer||b.data;if(a.ArrayBuffer&&t instanceof ArrayBuffer){if(e){h=b.data;e=new Uint8Array(h);h=new Uint8Array(1+h.byteLength);h[0]=O[b.type];for(b=0;b<e.length;b++)h[b+1]=
e[b];b=l(h.buffer)}else b=c.encodeBase64Packet(b,l);return b}if(N&&t instanceof a.Blob)return e?k?b=d(b,e,l):(e=new Uint8Array(1),e[0]=O[b.type],b=new N([e.buffer,b.data]),b=l(b)):b=c.encodeBase64Packet(b,l),b;if(t&&t.base64)return l("b"+c.packets[b.type]+b.data.data);e=O[b.type];void 0!==b.data&&(e+=h?r.encode(String(b.data)):String(b.data));return l(""+e)};c.encodeBase64Packet=function(b,d){var e="b"+c.packets[b.type];if(N&&b.data instanceof N){var h=new FileReader;h.onload=function(){var b=h.result.split(",")[1];
d(e+b)};return h.readAsDataURL(b.data)}try{var l=String.fromCharCode.apply(null,new Uint8Array(b.data))}catch(Nf){b=new Uint8Array(b.data);l=Array(b.length);for(var t=0;t<b.length;t++)l[t]=b[t];l=String.fromCharCode.apply(null,l)}e+=a.btoa(l);return d(e)};c.decodePacket=function(b,a,d){if("string"==typeof b||void 0===b){if("b"==b.charAt(0))return c.decodeBase64Packet(b.substr(1),a);if(d)try{b=r.decode(b)}catch(Yk){return ra}d=b.charAt(0);return Number(d)==d&&u[d]?1<b.length?{type:u[d],data:b.substring(1)}:
{type:u[d]}:ra}d=(new Uint8Array(b))[0];b=m(b,1);N&&"blob"===a&&(b=new N([b]));return{type:u[d],data:b}};c.decodeBase64Packet=function(b,c){var d=u[b.charAt(0)];if(!a.ArrayBuffer)return{type:d,data:{base64:!0,data:b.substr(1)}};b=n.decode(b.substr(1));"blob"===c&&N&&(b=new N([b]));return{type:d,data:b}};c.encodePayload=function(b,a,d){"function"==typeof a&&(d=a,a=null);var h=p(b);if(a&&h)return N&&!k?c.encodePayloadAsBlob(b,d):c.encodePayloadAsArrayBuffer(b,d);if(!b.length)return d("0:");e(b,function(b,
d){c.encodePacket(b,h?a:!1,!0,function(b){d(null,b.length+":"+b)})},function(b,a){return d(a.join(""))})};c.decodePayload=function(b,a,d){if("string"!=typeof b)return c.decodePayloadAsBinary(b,a,d);"function"===typeof a&&(d=a,a=null);if(""==b)return d(ra,0,1);var e="";for(var h,l,t=0,p=b.length;t<p;t++)if(l=b.charAt(t),":"!=l)e+=l;else{if(""==e||e!=(h=Number(e)))return d(ra,0,1);l=b.substr(t+1,h);if(e!=l.length)return d(ra,0,1);if(l.length){e=c.decodePacket(l,a,!0);if(ra.type==e.type&&ra.data==e.data)return d(ra,
0,1);if(!1===d(e,t+h,p))return}t+=h;e=""}if(""!=e)return d(ra,0,1)};c.encodePayloadAsArrayBuffer=function(b,a){if(!b.length)return a(new ArrayBuffer(0));e(b,function(b,a){c.encodePacket(b,!0,!0,function(b){return a(null,b)})},function(b,c){b=c.reduce(function(b,a){a="string"===typeof a?a.length:a.byteLength;return b+a.toString().length+a+2},0);var d=new Uint8Array(b),e=0;c.forEach(function(b){var a="string"===typeof b,c=b;if(a){c=new Uint8Array(b.length);for(var h=0;h<b.length;h++)c[h]=b.charCodeAt(h);
c=c.buffer}a?d[e++]=0:d[e++]=1;b=c.byteLength.toString();for(h=0;h<b.length;h++)d[e++]=parseInt(b[h]);d[e++]=255;c=new Uint8Array(c);for(h=0;h<c.length;h++)d[e++]=c[h]});return a(d.buffer)})};c.encodePayloadAsBlob=function(b,a){e(b,function(b,a){c.encodePacket(b,!0,!0,function(b){var c=new Uint8Array(1);c[0]=1;if("string"===typeof b){for(var d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);b=d.buffer;c[0]=0}d=(b instanceof ArrayBuffer?b.byteLength:b.size).toString();var h=new Uint8Array(d.length+
1);for(e=0;e<d.length;e++)h[e]=parseInt(d[e]);h[d.length]=255;N&&(b=new N([c.buffer,h.buffer,b]),a(null,b))})},function(b,c){return a(new N(c))})};c.decodePayloadAsBinary=function(b,a,d){"function"===typeof a&&(d=a,a=null);for(var e=[],h=!1;0<b.byteLength;){for(var l=new Uint8Array(b),t=0===l[0],p="",n=1;255!=l[n];n++){if(310<p.length){h=!0;break}p+=l[n]}if(h)return d(ra,0,1);b=m(b,2+p.length);p=parseInt(p);l=m(b,0,p);if(t)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(Zk){for(t=new Uint8Array(l),
l="",n=0;n<t.length;n++)l+=String.fromCharCode(t[n])}e.push(l);b=m(b,p)}var q=e.length;e.forEach(function(b,e){d(c.decodePacket(b,a,!0),e,q)})}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./keys":25,after:1,"arraybuffer.slice":2,"base64-arraybuffer":5,blob:6,"has-binary":30,utf8:60}],25:[function(b,a,c){a.exports=Object.keys||function(b){var a=[],c=Object.prototype.hasOwnProperty,d;for(d in b)c.call(b,d)&&a.push(d);return a}},
{}],26:[function(b,a,c){function d(b){l.call(this);b=b||{};this.config={chunksize:16384,pacing:0};for(var a in b)this.config[a]=b[a];this.channel=this.file=null}function e(){l.call(this);this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null}var l=b("wildemitter");b=b("util");b.inherits(d,l);d.prototype.send=function(b,a){var c=this;this.file=b;this.channel=a;var d="number"!==typeof a.bufferedAmountLowThreshold,e=0,h=function(){var l=new window.FileReader;l.onload=function(){return function(l){c.channel.send(l.target.result);
c.emit("progress",e,b.size,l.target.result);b.size>e+l.target.result.byteLength?d?window.setTimeout(h,c.config.pacing):a.bufferedAmount<=a.bufferedAmountLowThreshold&&window.setTimeout(h,0):(c.emit("progress",b.size,b.size,null),c.emit("sentFile"));e+=c.config.chunksize}}(b);var t=b.slice(e,e+c.config.chunksize);l.readAsArrayBuffer(t)};d||(a.bufferedAmountLowThreshold=8*this.config.chunksize,a.addEventListener("bufferedamountlow",h));window.setTimeout(h,0)};b.inherits(e,l);e.prototype.receive=function(b,
a){var c=this;b&&(this.metadata=b);this.channel=a;a.binaryType="arraybuffer";this.channel.onmessage=function(b){c.received+=b.data.byteLength;c.receiveBuffer.push(b.data);c.emit("progress",c.received,c.metadata.size,b.data);c.received===c.metadata.size?(c.emit("receivedFile",new window.Blob(c.receiveBuffer),c.metadata),c.receiveBuffer=[]):c.received>c.metadata.size&&(console.error("received more than expected, discarding..."),c.receiveBuffer=[])}};a.exports={};a.exports.support="undefined"!==typeof window&&
window&&window.File&&window.FileReader&&window.Blob;a.exports.Sender=d;a.exports.Receiver=e},{util:63,wildemitter:65}],27:[function(b,a,c){var d={};a.exports=function(b,a){var c=2===arguments.length,e=c?a:b;if("undefined"===typeof window||"http:"===window.location.protocol){var h=Error("NavigatorUserMediaError");h.name="HTTPS_REQUIRED";return e(h)}if(window.navigator.userAgent.match("Chrome")){var l=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),q=33,r=!window.chrome.webstore;window.navigator.userAgent.match("Linux")&&
(q=35);sessionStorage.getScreenMediaJSExtensionId?chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(a){a&&""!==a.sourceId?(b=c&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}},b.video.mandatory.chromeMediaSourceId=a.sourceId,window.navigator.mediaDevices.getUserMedia(b).then(function(b){e(null,b)}).catch(function(b){e(b)})):(a=Error("NavigatorUserMediaError"),
a.name="NotAllowedError",e(a))}):window.cefGetScreenMedia?window.cefGetScreenMedia(function(a){a?(b=c&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},b.video.mandatory.chromeMediaSourceId=a,window.navigator.mediaDevices.getUserMedia(b).then(function(b){e(null,b)}).catch(function(b){e(b)})):(a=Error("cefGetScreenMediaError"),a.name="CEF_GETSCREENMEDIA_CANCELED",
e(a))}):r||26<=l&&l<=q?(b=c&&b||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){e(null,b)}).catch(function(b){e(b)})):(l=window.setTimeout(function(){h=Error("NavigatorUserMediaError");h.name="EXTENSION_UNAVAILABLE";return e(h)},1E3),d[l]=[e,c?b:null],window.postMessage({type:"getScreen",id:l},"*"))}else window.navigator.userAgent.match("Firefox")&&
(33<=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)?(b=c&&b||{video:{mozMediaSource:"window",mediaSource:"window"}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){e(null,b);var a=b.currentTime,c=window.setInterval(function(){b||window.clearInterval(c);if(b.currentTime==a&&(window.clearInterval(c),b.onended))b.onended();a=b.currentTime},500)}).catch(function(b){e(b)})):(h=Error("NavigatorUserMediaError"),h.name="EXTENSION_UNAVAILABLE"))};"undefined"!==typeof window&&
window.addEventListener("message",function(b){if(b.origin==window.location.origin)if("gotScreen"==b.data.type&&d[b.data.id]){var a=d[b.data.id],c=a[1],e=a[0];delete d[b.data.id];""===b.data.sourceId?(b=Error("NavigatorUserMediaError"),b.name="NotAllowedError",e(b)):(c=c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},c.video.mandatory.chromeMediaSourceId=
b.data.sourceId,window.navigator.mediaDevices.getUserMedia(c).then(function(b){e(null,b)}).catch(function(b){e(b)}))}else"getScreenPending"==b.data.type&&window.clearTimeout(b.data.id)})},{}],28:[function(b,a,c){a.exports=function(){return this}()},{}],29:[function(b,a,c){var d=b("wildemitter"),e;"undefined"!==typeof window&&(e=window.AudioContext||window.webkitAudioContext);var l=null;a.exports=function(b,a){var c=new d;if(!e)return c;a=a||{};var h=a.smoothing||.1,t=a.interval||50,p=a.threshold,
U=a.play;a=a.history||10;var g=!0;l||(l=new e);var k=l.createAnalyser();k.fftSize=512;k.smoothingTimeConstant=h;var O=new Float32Array(k.frequencyBinCount);b.jquery&&(b=b[0]);if(b instanceof HTMLAudioElement||b instanceof HTMLVideoElement){var u=l.createMediaElementSource(b);"undefined"===typeof U&&(U=!0)}else u=l.createMediaStreamSource(b);p=p||-50;u.connect(k);U&&k.connect(l.destination);c.speaking=!1;c.setThreshold=function(b){p=b};c.setInterval=function(b){t=b};c.stop=function(){g=!1;c.emit("volume_change",
-100,p);c.speaking&&(c.speaking=!1,c.emit("stopped_speaking"));k.disconnect();u.disconnect()};c.speakingHistory=[];for(b=0;b<a;b++)c.speakingHistory.push(0);var ra=function(){setTimeout(function(){if(g){var b=-Infinity;k.getFloatFrequencyData(O);for(var a=4,d=O.length;a<d;a++)O[a]>b&&0>O[a]&&(b=O[a]);c.emit("volume_change",b,p);a=0;if(b>p&&!c.speaking){for(d=c.speakingHistory.length-3;d<c.speakingHistory.length;d++)a+=c.speakingHistory[d];2<=a&&(c.speaking=!0,c.emit("speaking"))}else if(b<p&&c.speaking){for(d=
0;d<c.speakingHistory.length;d++)a+=c.speakingHistory[d];0==a&&(c.speaking=!1,c.emit("stopped_speaking"))}c.speakingHistory.shift();c.speakingHistory.push(0+(b>p));ra()}},t)};ra();return c}},{wildemitter:65}],30:[function(b,a,c){(function(c){var d=b("isarray");a.exports=function(b){function a(b){if(!b)return!1;if(c.Buffer&&c.Buffer.isBuffer(b)||c.ArrayBuffer&&b instanceof ArrayBuffer||c.Blob&&b instanceof Blob||c.File&&b instanceof File)return!0;if(d(b))for(var e=0;e<b.length;e++){if(a(b[e]))return!0}else if(b&&
"object"==typeof b)for(e in b.toJSON&&(b=b.toJSON()),b)if(Object.prototype.hasOwnProperty.call(b,e)&&a(b[e]))return!0;return!1}return a(b)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{isarray:33}],31:[function(b,a,c){b=b("global");try{a.exports="XMLHttpRequest"in b&&"withCredentials"in new b.XMLHttpRequest}catch(d){a.exports=!1}},{global:28}],32:[function(b,a,c){var d=[].indexOf;a.exports=function(b,a){if(d)return b.indexOf(a);
for(var c=0;c<b.length;++c)if(b[c]===a)return c;return-1}},{}],33:[function(b,a,c){a.exports=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)}},{}],34:[function(b,a,c){(function(b){function a(b){if(a[b]!==p)return a[b];if("bug-string-char-index"==b)var c=!1;else if("json"==b)c=a("json-stringify")&&a("json-parse");else{var e;if("json-stringify"==b){c=n.stringify;var h="function"==typeof c&&q;if(h){(e=function(){return 1}).toJSON=e;try{h="0"===c(0)&&"0"===c(new Number)&&
'""'==c(new String)&&c(d)===p&&c(p)===p&&c()===p&&"1"===c(e)&&"[1]"==c([e])&&"[null]"==c([p])&&"null"==c(null)&&"[null,null,null]"==c([p,d,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==c({a:[e,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===c(null,e)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==c(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==c(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==c(new Date(-1))}catch(Vb){h=
!1}}c=h}if("json-parse"==b){c=n.parse;if("function"==typeof c)try{if(0===c("0")&&!c(!1)){e=c('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var l=5==e.a.length&&1===e.a[0];if(l){try{l=!c('"\t"')}catch(Vb){}if(l)try{l=1!==c("01")}catch(Vb){}if(l)try{l=1!==c("1.")}catch(Vb){}}}}catch(Vb){l=!1}c=l}}return a[b]=!!c}var d={}.toString,e,p,m="object"==typeof JSON&&JSON,n="object"==typeof c&&c&&!c.nodeType&&c;n&&m?(n.stringify=m.stringify,n.parse=m.parse):n=b.JSON=m||{};var q=new Date(-0xc782b5b800cec);
try{q=-109252==q.getUTCFullYear()&&0===q.getUTCMonth()&&1===q.getUTCDate()&&10==q.getUTCHours()&&37==q.getUTCMinutes()&&6==q.getUTCSeconds()&&708==q.getUTCMilliseconds()}catch($k){}if(!a("json")){var r=a("bug-string-char-index");if(!q)var U=Math.floor,g=[0,31,59,90,120,151,181,212,243,273,304,334],k=function(b,a){return g[a]+365*(b-1970)+U((b-1969+(a=+(1<a)))/4)-U((b-1901+a)/100)+U((b-1601+a)/400)};(e={}.hasOwnProperty)||(e=function(b){var a={};if((a.__proto__=null,a.__proto__={toString:1},a).toString!=
d)e=function(b){var a=this.__proto__;b=b in(this.__proto__=null,this);this.__proto__=a;return b};else{var c=a.constructor;e=function(b){var a=(this.constructor||c).prototype;return b in this&&!(b in a&&this[b]===a[b])}}a=null;return e.call(this,b)});var O={"boolean":1,number:1,string:1,undefined:1};var u=function(b,a){var c=0,h,l;(h=function(){this.valueOf=0}).prototype.valueOf=0;var t=new h;for(l in t)e.call(t,l)&&c++;h=t=null;c?u=2==c?function(b,a){var c={},h="[object Function]"==d.call(b),l;for(l in b)h&&
"prototype"==l||e.call(c,l)||!(c[l]=1)||!e.call(b,l)||a(l)}:function(b,a){var c="[object Function]"==d.call(b),h,l;for(h in b)c&&"prototype"==h||!e.call(b,h)||(l="constructor"===h)||a(h);(l||e.call(b,h="constructor"))&&a(h)}:(t="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),u=function(b,a){var c="[object Function]"==d.call(b),h,l;if(l=!c&&"function"!=typeof b.constructor)l=typeof b.hasOwnProperty,l="object"==l?!!b.hasOwnProperty:!O[l];l=
l?b.hasOwnProperty:e;for(h in b)c&&"prototype"==h||!l.call(b,h)||a(h);for(c=t.length;h=t[--c];l.call(b,h)&&a(h));});return u(b,a)};if(!a("json-stringify")){var ra={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},N=function(b,a){return("000000"+(a||0)).slice(-b)},v=function(b){var a='"',c=0,d=b.length,e=10<d&&r,h;for(e&&(h=b.split(""));c<d;c++){var l=b.charCodeAt(c);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:a+=ra[l];break;default:a=32>l?a+("\\u00"+N(2,l.toString(16))):
a+(e?h[c]:r?b.charAt(c):b[c])}}return a+'"'},B=function(b,a,c,h,l,t,m){var n;try{var q=a[b]}catch(bl){}if("object"==typeof q&&q){var r=d.call(q);if("[object Date]"!=r||e.call(q,"toJSON"))"function"==typeof q.toJSON&&("[object Number]"!=r&&"[object String]"!=r&&"[object Array]"!=r||e.call(q,"toJSON"))&&(q=q.toJSON(b));else if(q>-1/0&&q<1/0){if(k){var g=U(q/864E5);for(r=U(g/365.2425)+1970-1;k(r+1,0)<=g;r++);for(n=U((g-k(r,0))/30.42);k(r,n+1)<=g;n++);g=1+g-k(r,n);var Da=(q%864E5+864E5)%864E5;var Ra=
U(Da/36E5)%24;var O=U(Da/6E4)%60;var ra=U(Da/1E3)%60;Da%=1E3}else r=q.getUTCFullYear(),n=q.getUTCMonth(),g=q.getUTCDate(),Ra=q.getUTCHours(),O=q.getUTCMinutes(),ra=q.getUTCSeconds(),Da=q.getUTCMilliseconds();q=(0>=r||1E4<=r?(0>r?"-":"+")+N(6,0>r?-r:r):N(4,r))+"-"+N(2,n+1)+"-"+N(2,g)+"T"+N(2,Ra)+":"+N(2,O)+":"+N(2,ra)+"."+N(3,Da)+"Z"}else q=null}c&&(q=c.call(a,b,q));if(null===q)return"null";r=d.call(q);if("[object Boolean]"==r)return""+q;if("[object Number]"==r)return q>-1/0&&q<1/0?""+q:"null";if("[object String]"==
r)return v(""+q);if("object"==typeof q){for(b=m.length;b--;)if(m[b]===q)throw TypeError();m.push(q);var y=[];a=t;t+=l;if("[object Array]"==r){n=0;for(b=q.length;n<b;n++)r=B(n,q,c,h,l,t,m),y.push(r===p?"null":r);b=y.length?l?"[\n"+t+y.join(",\n"+t)+"\n"+a+"]":"["+y.join(",")+"]":"[]"}else u(h||q,function(b){var a=B(b,q,c,h,l,t,m);a!==p&&y.push(v(b)+":"+(l?" ":"")+a)}),b=y.length?l?"{\n"+t+y.join(",\n"+t)+"\n"+a+"}":"{"+y.join(",")+"}":"{}";m.pop();return b}};n.stringify=function(b,a,c){var e;if("function"==
typeof a||"object"==typeof a&&a)if("[object Function]"==(e=d.call(a)))var h=a;else if("[object Array]"==e){var l={};for(var t=0,p=a.length,m;t<p;m=a[t++],(e=d.call(m),"[object String]"==e||"[object Number]"==e)&&(l[m]=1));}if(c)if("[object Number]"==(e=d.call(c))){if(0<(c-=c%1)){var n="";for(10<c&&(c=10);n.length<c;n+=" ");}}else"[object String]"==e&&(n=10>=c.length?c:c.slice(0,10));return B("",(m={},m[""]=b,m),h,l,n,"",[])}}if(!a("json-parse")){var x=String.fromCharCode,w={92:"\\",34:'"',47:"/",
98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},y,A,z=function(){y=A=null;throw SyntaxError();},E=function(){for(var b=A,a=b.length,c,d,e,h,l;y<a;)switch(l=b.charCodeAt(y),l){case 9:case 10:case 13:case 32:y++;break;case 123:case 125:case 91:case 93:case 58:case 44:return c=r?b.charAt(y):b[y],y++,c;case 34:c="@";for(y++;y<a;)if(l=b.charCodeAt(y),32>l)z();else if(92==l)switch(l=b.charCodeAt(++y),l){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:c+=w[l];y++;break;case 117:d=++y;for(e=
y+4;y<e;y++)l=b.charCodeAt(y),48<=l&&57>=l||97<=l&&102>=l||65<=l&&70>=l||z();c+=x("0x"+b.slice(d,y));break;default:z()}else{if(34==l)break;l=b.charCodeAt(y);for(d=y;32<=l&&92!=l&&34!=l;)l=b.charCodeAt(++y);c+=b.slice(d,y)}if(34==b.charCodeAt(y))return y++,c;z();default:d=y;45==l&&(h=!0,l=b.charCodeAt(++y));if(48<=l&&57>=l){for(48==l&&(l=b.charCodeAt(y+1),48<=l&&57>=l)&&z();y<a&&(l=b.charCodeAt(y),48<=l&&57>=l);y++);if(46==b.charCodeAt(y)){for(e=++y;e<a&&(l=b.charCodeAt(e),48<=l&&57>=l);e++);e==y&&
z();y=e}l=b.charCodeAt(y);if(101==l||69==l){l=b.charCodeAt(++y);43!=l&&45!=l||y++;for(e=y;e<a&&(l=b.charCodeAt(e),48<=l&&57>=l);e++);e==y&&z();y=e}return+b.slice(d,y)}h&&z();if("true"==b.slice(y,y+4))return y+=4,!0;if("false"==b.slice(y,y+5))return y+=5,!1;if("null"==b.slice(y,y+4))return y+=4,null;z()}return"$"},D=function(b){var a,c;"$"==b&&z();if("string"==typeof b){if("@"==(r?b.charAt(0):b[0]))return b.slice(1);if("["==b){for(a=[];;c||(c=!0)){b=E();if("]"==b)break;c&&(","==b?(b=E(),"]"==b&&z()):
z());","==b&&z();a.push(D(b))}return a}if("{"==b){for(a={};;c||(c=!0)){b=E();if("}"==b)break;c&&(","==b?(b=E(),"}"==b&&z()):z());","!=b&&"string"==typeof b&&"@"==(r?b.charAt(0):b[0])&&":"==E()||z();a[b.slice(1)]=D(E())}return a}z()}return b},I=function(b,a,c){c=J(b,a,c);c===p?delete b[a]:b[a]=c},J=function(b,a,c){var e=b[a],h;if("object"==typeof e&&e)if("[object Array]"==d.call(e))for(h=e.length;h--;)I(e,h,c);else u(e,function(b){I(e,b,c)});return c.call(b,a,e)};n.parse=function(b,a){var c;y=0;A=
""+b;b=D(E());"$"!=E()&&z();y=A=null;return a&&"[object Function]"==d.call(a)?J((c={},c[""]=b,c),"",a):b}}}})(this)},{}],35:[function(b,a,c){function d(b){var a=!0;b.getTracks().forEach(function(b){a="ended"===b.readyState&&a});return a}function e(){if("undefined"===typeof window||!window.navigator.mozGetUserMedia)return!1;var b=window.navigator.userAgent.match(/Firefox\/(\d+)\./);return 50>(b&&1<=b.length&&parseInt(b[1],10))}function l(b){m.call(this);var a=this.config={detectSpeakingEvents:!1,audioFallback:!1,
media:{audio:!0,video:!0},harkOptions:null,logger:n},c;for(c in b)b.hasOwnProperty(c)&&(this.config[c]=b[c]);this.logger=a.logger;this._log=this.logger.log.bind(this.logger,"LocalMedia:");this._logerror=this.logger.error.bind(this.logger,"LocalMedia:");this.localStreams=[];this.localScreens=[];navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||this._logerror("Your browser does not support local media capture.");this._audioMonitors=[];this.on("localStreamStopped",this._stopAudioMonitor.bind(this));
this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}c=b("util");var t=b("hark"),p=b("getscreenmedia"),m=b("wildemitter"),n=b("mockconsole");c.inherits(l,m);l.prototype.start=function(b,a){var c=this,e=b||this.config.media;this.emit("localStreamRequested",e);navigator.mediaDevices.getUserMedia(e).then(function(b){e.audio&&c.config.detectSpeakingEvents&&c._setupAudioMonitor(b,c.config.harkOptions);c.localStreams.push(b);b.getTracks().forEach(function(a){a.addEventListener("ended",function(){d(b)&&
c._removeStream(b)})});c.emit("localStream",b);if(a)return a(null,b)}).catch(function(b){if(c.config.audioFallback&&"NotFoundError"===b.name&&!1!==e.video)e.video=!1,c.start(e,a);else if(c.emit("localStreamRequestFailed",e),a)return a(b,null)})};l.prototype.stop=function(b){this.stopStream(b);this.stopScreenShare(b)};l.prototype.stopStream=function(b){var a=this;b?-1<this.localStreams.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),e()&&this._removeStream(b)):this.localStreams.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});
e()&&a._removeStream(b)})};l.prototype.startScreenShare=function(b,a){var c=this;this.emit("localScreenRequested");"function"!==typeof b||a||(a=b,b=null);p(b,function(b,d){b?c.emit("localScreenRequestFailed"):(c.localScreens.push(d),d.getTracks().forEach(function(b){b.addEventListener("ended",function(){var b=!0;d.getTracks().forEach(function(a){b="ended"===a.readyState&&b});b&&c._removeStream(d)})}),c.emit("localScreen",d));if(a)return a(b,d)})};l.prototype.stopScreenShare=function(b){var a=this;
b?-1<this.localScreens.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),e()&&this._removeStream(b)):this.localScreens.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});e()&&a._removeStream(b)})};l.prototype.mute=function(){this._audioEnabled(!1);this.emit("audioOff")};l.prototype.unmute=function(){this._audioEnabled(!0);this.emit("audioOn")};l.prototype.pauseVideo=function(){this._videoEnabled(!1);this.emit("videoOff")};l.prototype.resumeVideo=function(){this._videoEnabled(!0);
this.emit("videoOn")};l.prototype.pause=function(){this.mute();this.pauseVideo()};l.prototype.resume=function(){this.unmute();this.resumeVideo()};l.prototype._audioEnabled=function(b){this.localStreams.forEach(function(a){a.getAudioTracks().forEach(function(a){a.enabled=!!b})})};l.prototype._videoEnabled=function(b){this.localStreams.forEach(function(a){a.getVideoTracks().forEach(function(a){a.enabled=!!b})})};l.prototype.isAudioEnabled=function(){var b=!0;this.localStreams.forEach(function(a){a.getAudioTracks().forEach(function(a){b=
b&&a.enabled})});return b};l.prototype.isVideoEnabled=function(){var b=!0;this.localStreams.forEach(function(a){a.getVideoTracks().forEach(function(a){b=b&&a.enabled})});return b};l.prototype._removeStream=function(b){var a=this.localStreams.indexOf(b);-1<a?(this.localStreams.splice(a,1),this.emit("localStreamStopped",b)):(a=this.localScreens.indexOf(b),-1<a&&(this.localScreens.splice(a,1),this.emit("localScreenStopped",b)))};l.prototype._setupAudioMonitor=function(b,a){this._log("Setup audio");a=
t(b,a);var c=this,d;a.on("speaking",function(){c.emit("speaking")});a.on("stopped_speaking",function(){d&&clearTimeout(d);d=setTimeout(function(){c.emit("stoppedSpeaking")},1E3)});a.on("volume_change",function(b,a){c.emit("volumeChange",b,a)});this._audioMonitors.push({audio:a,stream:b})};l.prototype._stopAudioMonitor=function(b){var a=-1;this._audioMonitors.forEach(function(c,d){c.stream===b&&(a=d)});-1<a&&(this._audioMonitors[a].audio.stop(),this._audioMonitors.splice(a,1))};a.exports=l},{getscreenmedia:27,
hark:29,mockconsole:37,util:63,wildemitter:65}],36:[function(b,a,c){(function(b){function d(b,a){b.set(a[0],a[1]);return b}function e(b,a){b.add(a);return b}function t(b,a){for(var c=-1,d=b?b.length:0;++c<d&&!1!==a(b[c],c,b););return b}function p(b,a,c,d){var e=-1,h=b?b.length:0;for(d&&h&&(c=b[++e]);++e<h;)c=a(c,b[e],e,b);return c}function m(b){var a=!1;if(null!=b&&"function"!=typeof b.toString)try{a=!!(b+"")}catch(cl){}return a}function n(b){var a=-1,c=Array(b.size);b.forEach(function(b,d){c[++a]=
[d,b]});return c}function q(b,a){return function(c){return b(a(c))}}function r(b){var a=-1,c=Array(b.size);b.forEach(function(b){c[++a]=b});return c}function g(b){var a=-1,c=b?b.length:0;for(this.clear();++a<c;){var d=b[a];this.set(d[0],d[1])}}function k(b){var a=-1,c=b?b.length:0;for(this.clear();++a<c;){var d=b[a];this.set(d[0],d[1])}}function Ra(b){var a=-1,c=b?b.length:0;for(this.clear();++a<c;){var d=b[a];this.set(d[0],d[1])}}function O(b){this.__data__=new k(b)}function u(b,a,c){var d=b[a];
S.call(b,a)&&(d===c||d!==d&&c!==c)&&(void 0!==c||a in b)||(b[a]=c)}function ra(b,a){for(var c=b.length;c--;){var d=b[c][0];if(d===a||d!==d&&a!==a)return c}return-1}function N(b,a){return b&&A(a,M(a),b)}function y(b,a,c,d,e,h,l){var p;d&&(p=h?d(b,e,h,l):d(b));if(void 0!==p)return p;if(!Vb(b))return b;if(e=Aa(b)){if(p=I(b),!a)return w(b,p)}else{var n=wa(b),q="[object Function]"==n||"[object GeneratorFunction]"==n;if(Ca(b))return B(b,a);if("[object Object]"==n||"[object Arguments]"==n||q&&!h){if(m(b))return h?
b:{};p=J(q?{}:b);if(!a)return z(b,N(p,b))}else{if(!C[n])return h?b:{};p=F(b,n,y,a)}}l||(l=new O);if(h=l.get(b))return h;l.set(b,p);if(!e)var r=c?v(b,M,za):M(b);t(r||b,function(e,h){r&&(h=e,e=b[h]);u(p,h,y(e,a,c,d,h,b,l))});return p}function v(b,a,c){a=a(b);if(!Aa(b)){b=c(b);c=-1;for(var d=b.length,e=a.length;++c<d;)a[e+c]=b[c]}return a}function B(b,a){if(a)return b.slice();a=new b.constructor(b.length);b.copy(a);return a}function x(b){var a=new b.constructor(b.byteLength);(new ia(a)).set(new ia(b));
return a}function w(b,a){var c=-1,d=b.length;for(a||(a=Array(d));++c<d;)a[c]=b[c];return a}function A(b,a,c,d){c||(c={});for(var e=-1,h=a.length;++e<h;){var l=a[e],t=d?d(c[l],b[l],l,c,b):void 0;u(c,l,void 0===t?b[l]:t)}return c}function z(b,a){return A(b,za(b),a)}function E(b,a){b=b.__data__;var c=typeof a;return("string"==c||"number"==c||"symbol"==c||"boolean"==c?"__proto__"!==a:null===a)?b["string"==typeof a?"string":"hash"]:b.map}function D(b,a){b=null==b?void 0:b[a];a=!Vb(b)||ea&&ea in b?!1:(K(b)||
m(b)?fa:L).test(nc(b));return a?b:void 0}function I(b){var a=b.length,c=b.constructor(a);a&&"string"==typeof b[0]&&S.call(b,"index")&&(c.index=b.index,c.input=b.input);return c}function J(b){"function"!=typeof b.constructor||uh(b)?b={}:(b=X(b),b=Vb(b)?ka(b):{});return b}function F(b,a,c,h){var l=b.constructor;switch(a){case "[object ArrayBuffer]":return x(b);case "[object Boolean]":case "[object Date]":return new l(+b);case "[object DataView]":return a=h?x(b.buffer):b.buffer,new b.constructor(a,b.byteOffset,
b.byteLength);case "[object Float32Array]":case "[object Float64Array]":case "[object Int8Array]":case "[object Int16Array]":case "[object Int32Array]":case "[object Uint8Array]":case "[object Uint8ClampedArray]":case "[object Uint16Array]":case "[object Uint32Array]":return a=h?x(b.buffer):b.buffer,new b.constructor(a,b.byteOffset,b.length);case "[object Map]":return a=h?c(n(b),!0):n(b),p(a,d,new b.constructor);case "[object Number]":case "[object String]":return new l(b);case "[object RegExp]":return a=
new b.constructor(b.source,Y.exec(b)),a.lastIndex=b.lastIndex,a;case "[object Set]":return a=h?c(r(b),!0):r(b),p(a,e,new b.constructor);case "[object Symbol]":return va?Object(va.call(b)):{}}}function uh(b){var a=b&&b.constructor;return b===("function"==typeof a&&a.prototype||V)}function nc(b){if(null!=b){try{return Z.call(b)}catch(Ja){}return b+""}return""}function vh(b){var a;if(a=null!=b)a=b.length,a="number"==typeof a&&-1<a&&0==a%1&&9007199254740991>=a;return a&&!K(b)}function K(b){b=Vb(b)?da.call(b):
"";return"[object Function]"==b||"[object GeneratorFunction]"==b}function Vb(b){var a=typeof b;return!!b&&("object"==a||"function"==a)}function M(b){if(vh(b)){var a;(a=Aa(b))||(a=!!b&&"object"==typeof b&&vh(b)&&S.call(b,"callee")&&(!ha.call(b,"callee")||"[object Arguments]"==da.call(b)));if(a){a=b.length;for(var c=String,d=-1,e=Array(a);++d<a;)e[d]=c(d);a=e}else a=[];c=a.length;d=!!c;for(var h in b){if(!(e=!S.call(b,h))&&(e=d)&&!(e="length"==h)){e=h;var l=c;l=null==l?9007199254740991:l;e=!!l&&("number"==
typeof e||W.test(e))&&-1<e&&0==e%1&&e<l}e||a.push(h)}b=a}else if(uh(b)){h=[];for(a in Object(b))S.call(b,a)&&"constructor"!=a&&h.push(a);b=h}else b=ma(b);return b}function G(){return[]}function T(){return!1}var Y=/\w*$/,L=/^\[object .+?Constructor\]$/,W=/^(?:0|[1-9]\d*)$/,C={};C["[object Arguments]"]=C["[object Array]"]=C["[object ArrayBuffer]"]=C["[object DataView]"]=C["[object Boolean]"]=C["[object Date]"]=C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=
C["[object Int32Array]"]=C["[object Map]"]=C["[object Number]"]=C["[object Object]"]=C["[object RegExp]"]=C["[object Set]"]=C["[object String]"]=C["[object Symbol]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0;C["[object Error]"]=C["[object Function]"]=C["[object WeakMap]"]=!1;var P="object"==typeof self&&self&&self.Object===Object&&self;b="object"==typeof b&&b&&b.Object===Object&&b||P||Function("return this")();var Q=(P="object"==
typeof c&&c&&!c.nodeType&&c)&&"object"==typeof a&&a&&!a.nodeType&&a;P=Q&&Q.exports===P;Q=Array.prototype;var R=Function.prototype,V=Object.prototype,H=b["__core-js_shared__"],ea=function(){var b=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),Z=R.toString,S=V.hasOwnProperty,da=V.toString,fa=RegExp("^"+Z.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");R=P?b.Buffer:void 0;P=b.Symbol;var ia=b.Uint8Array,
X=q(Object.getPrototypeOf,Object),ka=Object.create,ha=V.propertyIsEnumerable,oa=Q.splice;Q=Object.getOwnPropertySymbols;R=R?R.isBuffer:void 0;var ma=q(Object.keys,Object),aa=D(b,"DataView"),ca=D(b,"Map"),ja=D(b,"Promise"),la=D(b,"Set");b=D(b,"WeakMap");var ba=D(Object,"create"),qa=nc(aa),xa=nc(ca),na=nc(ja),sa=nc(la),ta=nc(b),va=(P=P?P.prototype:void 0)?P.valueOf:void 0;g.prototype.clear=function(){this.__data__=ba?ba(null):{}};g.prototype["delete"]=function(b){return this.has(b)&&delete this.__data__[b]};
g.prototype.get=function(b){var a=this.__data__;return ba?(b=a[b],"__lodash_hash_undefined__"===b?void 0:b):S.call(a,b)?a[b]:void 0};g.prototype.has=function(b){var a=this.__data__;return ba?void 0!==a[b]:S.call(a,b)};g.prototype.set=function(b,a){this.__data__[b]=ba&&void 0===a?"__lodash_hash_undefined__":a;return this};k.prototype.clear=function(){this.__data__=[]};k.prototype["delete"]=function(b){var a=this.__data__;b=ra(a,b);if(0>b)return!1;b==a.length-1?a.pop():oa.call(a,b,1);return!0};k.prototype.get=
function(b){var a=this.__data__;b=ra(a,b);return 0>b?void 0:a[b][1]};k.prototype.has=function(b){return-1<ra(this.__data__,b)};k.prototype.set=function(b,a){var c=this.__data__,d=ra(c,b);0>d?c.push([b,a]):c[d][1]=a;return this};Ra.prototype.clear=function(){this.__data__={hash:new g,map:new (ca||k),string:new g}};Ra.prototype["delete"]=function(b){return E(this,b)["delete"](b)};Ra.prototype.get=function(b){return E(this,b).get(b)};Ra.prototype.has=function(b){return E(this,b).has(b)};Ra.prototype.set=
function(b,a){E(this,b).set(b,a);return this};O.prototype.clear=function(){this.__data__=new k};O.prototype["delete"]=function(b){return this.__data__["delete"](b)};O.prototype.get=function(b){return this.__data__.get(b)};O.prototype.has=function(b){return this.__data__.has(b)};O.prototype.set=function(b,a){var c=this.__data__;if(c instanceof k){c=c.__data__;if(!ca||199>c.length)return c.push([b,a]),this;c=this.__data__=new Ra(c)}c.set(b,a);return this};var za=Q?q(Q,Object):G,wa=function(b){return da.call(b)};
if(aa&&"[object DataView]"!=wa(new aa(new ArrayBuffer(1)))||ca&&"[object Map]"!=wa(new ca)||ja&&"[object Promise]"!=wa(ja.resolve())||la&&"[object Set]"!=wa(new la)||b&&"[object WeakMap]"!=wa(new b))wa=function(b){var a=da.call(b);if(b=(b="[object Object]"==a?b.constructor:void 0)?nc(b):void 0)switch(b){case qa:return"[object DataView]";case xa:return"[object Map]";case na:return"[object Promise]";case sa:return"[object Set]";case ta:return"[object WeakMap]"}return a};var Aa=Array.isArray,Ca=R||T;
a.exports=function(b){return y(b,!0,!0)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],37:[function(b,a,c){b="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profileEnd time timeEnd trace warn".split(" ");c=b.length;for(var d=function(){},e={};c--;)e[b[c]]=d;a.exports=e},{}],38:[function(b,a,c){function d(b){if(b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(b)){var a=
parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case "years":case "year":case "y":return a*l;case "days":case "day":case "d":return 864E5*a;case "hours":case "hour":case "h":return 36E5*a;case "minutes":case "minute":case "m":return 6E4*a;case "seconds":case "second":case "s":return 1E3*a;case "ms":return a}}}function e(b,a,c){if(!(b<a))return b<1.5*a?Math.floor(b/a)+" "+c:Math.ceil(b/a)+" "+c+"s"}var l=315576E5;a.exports=function(b,a){a=a||{};return"string"==typeof b?d(b):a.long?e(b,864E5,"day")||
e(b,36E5,"hour")||e(b,6E4,"minute")||e(b,1E3,"second")||b+" ms":864E5<=b?Math.round(b/864E5)+"d":36E5<=b?Math.round(b/36E5)+"h":6E4<=b?Math.round(b/6E4)+"m":1E3<=b?Math.round(b/1E3)+"s":b+"ms"}},{}],39:[function(b,a,c){var d=Object.prototype.hasOwnProperty;c.keys=Object.keys||function(b){var a=[],c;for(c in b)d.call(b,c)&&a.push(c);return a};c.values=function(b){var a=[],c;for(c in b)d.call(b,c)&&a.push(b[c]);return a};c.merge=function(b,a){for(var c in a)d.call(a,c)&&(b[c]=a[c]);return b};c.length=
function(b){return c.keys(b).length};c.isEmpty=function(b){return 0==c.length(b)}},{}],40:[function(b,a,c){(function(b){var c=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,p=/(?:^|:|,)(?:\s*\[)+/g,m=/^\s+/,n=/\s+$/;a.exports=function(a){if("string"!=typeof a||!a)return null;a=a.replace(m,"").replace(n,"");if(b.JSON&&JSON.parse)return JSON.parse(a);if(c.test(a.replace(d,"@").replace(e,"]").replace(p,"")))return(new Function("return "+
a))()}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],41:[function(b,a,c){c.encode=function(b){var a="",c;for(c in b)b.hasOwnProperty(c)&&(a.length&&(a+="&"),a+=encodeURIComponent(c)+"="+encodeURIComponent(b[c]));return a};c.decode=function(b){var a={};b=b.split("&");for(var c=0,d=b.length;c<d;c++){var e=b[c].split("=");a[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return a}},{}],42:[function(b,a,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
e="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");a.exports=function(b){b=d.exec(b||"");for(var a={},c=14;c--;)a[e[c]]=b[c]||"";return a}},{}],43:[function(b,a,c){function d(){throw Error("setTimeout has not been defined");}function e(){throw Error("clearTimeout has not been defined");}function l(b){if(r===setTimeout)return setTimeout(b,0);if((r===d||!r)&&setTimeout)return r=setTimeout,setTimeout(b,0);try{return r(b,0)}catch(N){try{return r.call(null,
b,0)}catch(ac){return r.call(this,b,0)}}}function t(b){if(g===clearTimeout)return clearTimeout(b);if((g===e||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(b);try{return g(b)}catch(N){try{return g.call(null,b)}catch(ac){return g.call(this,b)}}}function p(){Ra&&O&&(Ra=!1,O.length?k=O.concat(k):u=-1,k.length&&m())}function m(){if(!Ra){var b=l(p);Ra=!0;for(var a=k.length;a;){O=k;for(k=[];++u<a;)O&&O[u].run();u=-1;a=k.length}O=null;Ra=!1;t(b)}}function n(b,a){this.fun=b;this.array=a}function q(){}
b=a.exports={};try{var r="function"===typeof setTimeout?setTimeout:d}catch(ra){r=d}try{var g="function"===typeof clearTimeout?clearTimeout:e}catch(ra){g=e}var k=[],Ra=!1,O,u=-1;b.nextTick=function(b){var a=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)a[c-1]=arguments[c];k.push(new n(b,a));1!==k.length||Ra||l(m)};n.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=q;b.addListener=
q;b.once=q;b.off=q;b.removeListener=q;b.removeAllListeners=q;b.emit=q;b.prependListener=q;b.prependOnceListener=q;b.listeners=function(b){return[]};b.binding=function(b){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(b){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}],44:[function(b,a,c){function d(b,a){var c=this,d;l.call(this);b=b||{};b.iceServers=b.iceServers||[];this.enableChromeNativeSimulcast=!1;a&&a.optional&&
window.chrome&&null===navigator.appVersion.match(/Chromium\//)&&a.optional.forEach(function(b){b.enableChromeNativeSimulcast&&(c.enableChromeNativeSimulcast=!0)});this.enableMultiStreamHacks=!1;a&&a.optional&&window.chrome&&a.optional.forEach(function(b){b.enableMultiStreamHacks&&(c.enableMultiStreamHacks=!0)});this.restrictBandwidth=0;a&&a.optional&&a.optional.forEach(function(b){b.andyetRestrictBandwidth&&(c.restrictBandwidth=b.andyetRestrictBandwidth)});this.batchIceCandidates=0;a&&a.optional&&
a.optional.forEach(function(b){b.andyetBatchIce&&(c.batchIceCandidates=b.andyetBatchIce)});this.batchedIceCandidates=[];a&&a.optional&&window.chrome&&a.optional.forEach(function(b){b.andyetFasterICE&&(c.eliminateDuplicateCandidates=b.andyetFasterICE)});a&&a.optional&&a.optional.forEach(function(b){b.andyetDontSignalCandidates&&(c.dontSignalCandidates=b.andyetDontSignalCandidates)});this.assumeSetLocalSuccess=!1;a&&a.optional&&a.optional.forEach(function(b){b.andyetAssumeSetLocalSuccess&&(c.assumeSetLocalSuccess=
b.andyetAssumeSetLocalSuccess)});window.navigator.mozGetUserMedia&&a&&a.optional&&(this.wtFirefox=0,a.optional.forEach(function(b){b.andyetFirefoxMakesMeSad&&(c.wtFirefox=b.andyetFirefoxMakesMeSad,0<c.wtFirefox&&(c.firefoxcandidatebuffer=[]))}));this.pc=new RTCPeerConnection(b,a);this.getLocalStreams="function"===typeof this.pc.getLocalStreams?this.pc.getLocalStreams.bind(this.pc):function(){return[]};this.getSenders="function"===typeof this.pc.getSenders?this.pc.getSenders.bind(this.pc):function(){return[]};
this.getRemoteStreams="function"===typeof this.pc.getRemoteStreams?this.pc.getRemoteStreams.bind(this.pc):function(){return[]};this.getReceivers="function"===typeof this.pc.getReceivers?this.pc.getReceivers.bind(this.pc):function(){return[]};this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=function(b){"function"===typeof c.pc.removeStream?c.pc.removeStream.apply(c.pc,arguments):"function"===typeof c.pc.removeTrack&&b.getTracks().forEach(function(b){c.pc.removeTrack(b)})};"function"===
typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc));this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onremovetrack=this.emit.bind(this,"removeTrack");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);
this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:!1,sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};this.iceCredentials={local:{},remote:{}};for(d in b)this.config[d]=b[d];if(this.config.debug)this.on("*",function(){(b.logger||console).log("PeerConnection event:",arguments)});this.hadRemoteIPv6Candidate=this.hadLocalIPv6Candidate=this.hadRemoteRelayCandidate=this.hadLocalRelayCandidate=this.hadRemoteStunCandidate=
this.hadLocalStunCandidate=!1;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}c=b("util");var e=b("sdp-jingle-json"),l=b("wildemitter"),t=b("lodash.clonedeep");c.inherits(d,l);Object.defineProperty(d.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(d.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});d.prototype._role=function(){return this.isInitiator?"initiator":"responder"};d.prototype.addStream=
function(b){this.localStream=b;this.pc.addStream(b)};d.prototype._checkLocalCandidate=function(b){b=e.toCandidateJSON(b);"srflx"==b.type?this.hadLocalStunCandidate=!0:"relay"==b.type&&(this.hadLocalRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)};d.prototype._checkRemoteCandidate=function(b){b=e.toCandidateJSON(b);"srflx"==b.type?this.hadRemoteStunCandidate=!0:"relay"==b.type&&(this.hadRemoteRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)};d.prototype.processIce=
function(b,a){a=a||function(){};var c=this;if("closed"===this.pc.signalingState)return a();if(b.contents||b.jingle&&b.jingle.contents){var d=this.remoteDescription.contents.map(function(b){return b.name});(b.contents||b.jingle.contents).forEach(function(b){var h=b.transport||{},l=h.candidates||[],t=d.indexOf(b.name),p=b.name,m=c.remoteDescription.contents.find(function(a){return a.name===b.name}),n=function(){l.forEach(function(b){b=e.toCandidateSDP(b);c.pc.addIceCandidate(new RTCIceCandidate({candidate:b,
sdpMLineIndex:t,sdpMid:p}),function(){},function(b){c.emit("error",b)});c._checkRemoteCandidate(b)});a()};c.iceCredentials.remote[b.name]&&h.ufrag&&c.iceCredentials.remote[b.name].ufrag!==h.ufrag?m?(m.transport.ufrag=h.ufrag,m.transport.pwd=h.pwd,h={type:"offer",jingle:c.remoteDescription},h.sdp=e.toSessionSDP(h.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"}),c.pc.setRemoteDescription(new RTCSessionDescription(h),function(){n()},function(b){c.emit("error",b)})):c.emit("error",
"ice restart failed to find matching content"):n()})}else{b.candidate&&0!==b.candidate.candidate.indexOf("a=")&&(b.candidate.candidate="a="+b.candidate.candidate);if(this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(b.candidate),a();c.pc.addIceCandidate(new RTCIceCandidate(b.candidate),function(){},function(b){c.emit("error",b)});c._checkRemoteCandidate(b.candidate.candidate);a()}};d.prototype.offer=
function(b,a){var c=this,d=2===arguments.length,h=d&&b?b:{offerToReceiveAudio:1,offerToReceiveVideo:1};a=(a=d?a:b)||function(){};if("closed"===this.pc.signalingState)return a("Already closed");this.pc.createOffer(function(b){var d={type:"offer",sdp:b.sdp};c.assumeSetLocalSuccess&&(c.emit("offer",d),a(null,d));c._candidateBuffer=[];c.pc.setLocalDescription(b,function(){if(c.config.useJingle){var h=e.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"});h.sid=c.config.sid;c.localDescription=h;
h.contents.forEach(function(b){var a=b.transport||{};a.ufrag&&(c.iceCredentials.local[b.name]={ufrag:a.ufrag,pwd:a.pwd})});d.jingle=h}d.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&c._checkLocalCandidate(b)});c.assumeSetLocalSuccess||(c.emit("offer",d),a(null,d))},function(b){c.emit("error",b);a(b)})},function(b){c.emit("error",b);a(b)},h)};d.prototype.handleOffer=function(b,a){a=a||function(){};var c=this;b.type="offer";if(b.jingle){this.enableChromeNativeSimulcast&&b.jingle.contents.forEach(function(b){"video"===
b.name&&(b.application.googConferenceFlag=!0)});this.enableMultiStreamHacks&&b.jingle.contents.forEach(function(b){if("video"===b.name){var a=b.application.sources||[];if(0===a.length||"3735928559"!==a[0].ssrc)a.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),b.application.sources=a}});if(0<c.restrictBandwidth&&2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name){var d=b.jingle.contents[1];d.application&&d.application.bandwidth&&
d.application.bandwidth.bandwidth||(b.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:c.restrictBandwidth.toString()},b.sdp=e.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"outgoing"}))}b.jingle.contents.forEach(function(b){var a=b.transport||{};a.ufrag&&(c.iceCredentials.remote[b.name]={ufrag:a.ufrag,pwd:a.pwd})});b.sdp=e.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"});c.remoteDescription=b.jingle}b.sdp.split("\r\n").forEach(function(b){0===
b.indexOf("a=candidate:")&&c._checkRemoteCandidate(b)});c.pc.setRemoteDescription(new RTCSessionDescription(b),function(){a()},a)};d.prototype.answerAudioOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},b)};d.prototype.answerBroadcastOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},b)};d.prototype.answer=function(b,a){var c=2===arguments.length;this._answer(c&&b?b:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},
c?a:b)};d.prototype.handleAnswer=function(b,a){a=a||function(){};var c=this;b.jingle&&(b.sdp=e.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"}),c.remoteDescription=b.jingle,b.jingle.contents.forEach(function(b){var a=b.transport||{};a.ufrag&&(c.iceCredentials.remote[b.name]={ufrag:a.ufrag,pwd:a.pwd})}));b.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&c._checkRemoteCandidate(b)});c.pc.setRemoteDescription(new RTCSessionDescription(b),function(){c.wtFirefox&&
window.setTimeout(function(){c.firefoxcandidatebuffer.forEach(function(b){c.pc.addIceCandidate(new RTCIceCandidate(b),function(){},function(b){c.emit("error",b)});c._checkRemoteCandidate(b.candidate)});c.firefoxcandidatebuffer=null},c.wtFirefox);a(null)},a)};d.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};d.prototype._answer=function(b,a){a=a||function(){};var c=this;if(!this.pc.remoteDescription)throw Error("remoteDescription not set");
if("closed"===this.pc.signalingState)return a("Already closed");c.pc.createAnswer(function(b){var d=[];if(c.enableChromeNativeSimulcast&&(b.jingle=e.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"}),2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name)){var h=b.jingle.contents[1].application.sourceGroups||[],l=!1;h.forEach(function(b){"SIM"==b.semantics&&(l=!0)});if(!l&&b.jingle.contents[1].application.sources.length){var p=JSON.parse(JSON.stringify(b.jingle.contents[1].application.sources[0]));
p.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(p);d.push(b.jingle.contents[1].application.sources[0].ssrc);d.push(p.ssrc);h.push({semantics:"SIM",sources:d});d=JSON.parse(JSON.stringify(p));d.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(d);h.push({semantics:"FID",sources:[p.ssrc,d.ssrc]});b.jingle.contents[1].application.sourceGroups=h;b.sdp=e.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),
direction:"outgoing"})}}var m={type:"answer",sdp:b.sdp};c.assumeSetLocalSuccess&&(h=t(m),c.emit("answer",h),a(null,h));c._candidateBuffer=[];c.pc.setLocalDescription(b,function(){if(c.config.useJingle){var d=e.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"});d.sid=c.config.sid;c.localDescription=d;m.jingle=d}c.enableChromeNativeSimulcast&&(m.jingle||(m.jingle=e.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"})),m.jingle.contents[1].application.sources.forEach(function(b,a){b.parameters=
b.parameters.map(function(b){"msid"===b.key&&(b.value+="-"+Math.floor(a/2));return b})}),m.sdp=e.toSessionSDP(m.jingle,{sid:c.sdpSessionID,role:c._role(),direction:"outgoing"}));m.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&c._checkLocalCandidate(b)});c.assumeSetLocalSuccess||(d=t(m),c.emit("answer",d),a(null,d))},function(b){c.emit("error",b);a(b)})},function(b){c.emit("error",b);a(b)},b)};d.prototype._onIce=function(b){var a=this;if(b.candidate){if(!this.dontSignalCandidates){b=
b.candidate;var c={candidate:{candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex}};this._checkLocalCandidate(b.candidate);var d=e.toCandidateJSON(b.candidate);if(this.eliminateDuplicateCandidates&&"relay"===d.type){var h=this._candidateBuffer.filter(function(b){return"relay"===b.type}).map(function(b){return b.foundation+":"+b.component});var l=h.indexOf(d.foundation+":"+d.component);if(-1<l&&d.priority>>24>=h[l].priority>>24)return}if("max-bundle"===this.config.bundlePolicy&&(h=
this._candidateBuffer.filter(function(b){return d.type===b.type}).map(function(b){return b.address+":"+b.port}),l=h.indexOf(d.address+":"+d.port),-1<l))return;if("require"!==this.config.rtcpMuxPolicy||"2"!==d.component){this._candidateBuffer.push(d);if(a.config.useJingle&&(b.sdpMid||(b.sdpMid=a.pc.remoteDescription&&"offer"===a.pc.remoteDescription.type?a.remoteDescription.contents[b.sdpMLineIndex].name:a.localDescription.contents[b.sdpMLineIndex].name),a.iceCredentials.local[b.sdpMid]||e.toSessionJSON(a.pc.localDescription.sdp,
{role:a._role(),direction:"outgoing"}).contents.forEach(function(b){var c=b.transport||{};c.ufrag&&(a.iceCredentials.local[b.name]={ufrag:c.ufrag,pwd:c.pwd})}),c.jingle={contents:[{name:b.sdpMid,creator:a._role(),transport:{transportType:"iceUdp",ufrag:a.iceCredentials.local[b.sdpMid].ufrag,pwd:a.iceCredentials.local[b.sdpMid].pwd,candidates:[d]}}]},0<a.batchIceCandidates)){0===a.batchedIceCandidates.length&&window.setTimeout(function(){var b={};a.batchedIceCandidates.forEach(function(a){a=a.contents[0];
b[a.name]||(b[a.name]=a);b[a.name].transport.candidates.push(a.transport.candidates[0])});var c={jingle:{contents:[]}};Object.keys(b).forEach(function(a){c.jingle.contents.push(b[a])});a.batchedIceCandidates=[];a.emit("ice",c)},a.batchIceCandidates);a.batchedIceCandidates.push(c.jingle);return}this.emit("ice",c)}}}else this.emit("endOfCandidates")};d.prototype._onDataChannel=function(b){b=b.channel;this._remoteDataChannels.push(b);this.emit("addChannel",b)};d.prototype.createDataChannel=function(b,
a){b=this.pc.createDataChannel(b,a);this._localDataChannels.push(b);return b};d.prototype.getStats=function(){if("function"===typeof arguments[0]){var b=arguments[0];this.pc.getStats().then(function(a){b(null,a)},function(a){b(a)})}else return this.pc.getStats.apply(this.pc,arguments)};a.exports=d},{"lodash.clonedeep":36,"sdp-jingle-json":45,util:63,wildemitter:65}],45:[function(b,a,c){var d=b("./lib/tosdp"),e=b("./lib/tojson");c.toIncomingSDPOffer=function(b){return d.toSessionSDP(b,{role:"responder",
direction:"incoming"})};c.toOutgoingSDPOffer=function(b){return d.toSessionSDP(b,{role:"initiator",direction:"outgoing"})};c.toIncomingSDPAnswer=function(b){return d.toSessionSDP(b,{role:"initiator",direction:"incoming"})};c.toOutgoingSDPAnswer=function(b){return d.toSessionSDP(b,{role:"responder",direction:"outgoing"})};c.toIncomingMediaSDPOffer=function(b){return d.toMediaSDP(b,{role:"responder",direction:"incoming"})};c.toOutgoingMediaSDPOffer=function(b){return d.toMediaSDP(b,{role:"initiator",
direction:"outgoing"})};c.toIncomingMediaSDPAnswer=function(b){return d.toMediaSDP(b,{role:"initiator",direction:"incoming"})};c.toOutgoingMediaSDPAnswer=function(b){return d.toMediaSDP(b,{role:"responder",direction:"outgoing"})};c.toCandidateSDP=d.toCandidateSDP;c.toMediaSDP=d.toMediaSDP;c.toSessionSDP=d.toSessionSDP;c.toIncomingJSONOffer=function(b,a){return e.toSessionJSON(b,{role:"responder",direction:"incoming",creators:a})};c.toOutgoingJSONOffer=function(b,a){return e.toSessionJSON(b,{role:"initiator",
direction:"outgoing",creators:a})};c.toIncomingJSONAnswer=function(b,a){return e.toSessionJSON(b,{role:"initiator",direction:"incoming",creators:a})};c.toOutgoingJSONAnswer=function(b,a){return e.toSessionJSON(b,{role:"responder",direction:"outgoing",creators:a})};c.toIncomingMediaJSONOffer=function(b,a){return e.toMediaJSON(b,{role:"responder",direction:"incoming",creator:a})};c.toOutgoingMediaJSONOffer=function(b,a){return e.toMediaJSON(b,{role:"initiator",direction:"outgoing",creator:a})};c.toIncomingMediaJSONAnswer=
function(b,a){return e.toMediaJSON(b,{role:"initiator",direction:"incoming",creator:a})};c.toOutgoingMediaJSONAnswer=function(b,a){return e.toMediaJSON(b,{role:"responder",direction:"outgoing",creator:a})};c.toCandidateJSON=e.toCandidateJSON;c.toMediaJSON=e.toMediaJSON;c.toSessionJSON=e.toSessionJSON},{"./lib/tojson":48,"./lib/tosdp":49}],46:[function(b,a,c){c.lines=function(b){return b.split("\r\n").filter(function(b){return 0<b.length})};c.findLine=function(b,a,c){for(var d=b.length,e=0;e<a.length;e++)if(a[e].substr(0,
d)===b)return a[e];if(!c)return!1;for(a=0;a<c.length;a++)if(c[a].substr(0,d)===b)return c[a];return!1};c.findLines=function(b,a,c){for(var d=[],e=b.length,h=0;h<a.length;h++)a[h].substr(0,e)===b&&d.push(a[h]);if(d.length||!c)return d;for(a=0;a<c.length;a++)c[a].substr(0,e)===b&&d.push(c[a]);return d};c.mline=function(b){b=b.substr(2).split(" ");for(var a={media:b[0],port:b[1],proto:b[2],formats:[]},c=3;c<b.length;c++)b[c]&&a.formats.push(b[c]);return a};c.rtpmap=function(b){b=b.substr(9).split(" ");
var a={id:b.shift()};b=b[0].split("/");a.name=b[0];a.clockrate=b[1];a.channels=3==b.length?b[2]:"1";return a};c.sctpmap=function(b){b=b.substr(10).split(" ");return{number:b.shift(),protocol:b.shift(),streams:b.shift()}};c.fmtp=function(b){for(var a,c=b.substr(b.indexOf(" ")+1).split(";"),d=[],e=0;e<c.length;e++)a=c[e].split("="),b=a[0].trim(),a=a[1],b&&a?d.push({key:b,value:a}):b&&d.push({key:"",value:b});return d};c.crypto=function(b){b=b.substr(9).split(" ");return{tag:b[0],cipherSuite:b[1],keyParams:b[2],
sessionParams:b.slice(3).join(" ")}};c.fingerprint=function(b){b=b.substr(14).split(" ");return{hash:b[0],value:b[1]}};c.extmap=function(b){b=b.substr(9).split(" ");var a={},c=b.shift(),d=c.indexOf("/");0<=d?(a.id=c.substr(0,d),a.senders=c.substr(d+1)):(a.id=c,a.senders="sendrecv");a.uri=b.shift()||"";return a};c.rtcpfb=function(b){b=b.substr(10).split(" ");var a={};a.id=b.shift();a.type=b.shift();"trr-int"===a.type?a.value=b.shift():a.subtype=b.shift()||"";a.parameters=b;return a};c.candidate=function(b){b=
0===b.indexOf("a=candidate:")?b.substring(12).split(" "):b.substring(10).split(" ");for(var a={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:b[3],ip:b[4],port:b[5],type:b[7],generation:"0"},c=8;c<b.length;c+=2)"raddr"===b[c]?a.relAddr=b[c+1]:"rport"===b[c]?a.relPort=b[c+1]:"generation"===b[c]?a.generation=b[c+1]:"tcptype"===b[c]&&(a.tcpType=b[c+1]);a.network="1";return a};c.sourceGroups=function(b){for(var a=[],c=0;c<b.length;c++){var e=b[c].substr(13).split(" ");a.push({semantics:e.shift(),
sources:e})}return a};c.sources=function(b){for(var a=[],c={},e=0;e<b.length;e++){var d=b[e].substr(7).split(" "),m=d.shift();if(!c[m]){var n={ssrc:m,parameters:[]};a.push(n);c[m]=n}d=d.join(" ").split(":");n=d.shift();d=d.join(":")||null;c[m].parameters.push({key:n,value:d})}return a};c.groups=function(b){for(var a=[],c,e=0;e<b.length;e++)c=b[e].substr(8).split(" "),a.push({semantics:c.shift(),contents:c});return a};c.bandwidth=function(b){b=b.substr(2).split(":");var a={};a.type=b.shift();a.bandwidth=
b.shift();return a};c.msid=function(b){b=b.substr(7);var a=b.split(" ");return{msid:b,mslabel:a[0],label:a[1]}}},{}],47:[function(b,a,c){a.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",
responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],48:[function(b,a,c){var e=b("./senders"),h=b("./parsers"),l=Math.random();c._setIdCounter=function(b){l=b};c.toSessionJSON=function(b,a){var e,d=a.creators||[],l=a.role||"initiator";a=a.direction||"outgoing";
var t=b.split("\r\nm=");for(e=1;e<t.length;e++)t[e]="m="+t[e],e!==t.length-1&&(t[e]+="\r\n");var p=t.shift()+"\r\n",g=h.lines(p);b={};var k=[];for(e=0;e<t.length;e++)k.push(c.toMediaJSON(t[e],p,{role:l,direction:a,creator:d[e]||"initiator"}));b.contents=k;d=h.findLines("a=group:",g);d.length&&(b.groups=h.groups(d));return b};c.toMediaJSON=function(b,a,d){var l=d.creator||"initiator",t=d.role||"initiator",m=d.direction||"outgoing",p=h.lines(b);b=h.lines(a);a=h.mline(p[0]);l={creator:l,name:a.media,
application:{applicationType:"rtp",media:a.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==a.media&&(l.application={applicationType:"datachannel"},l.transport.sctp=[]);var g=l.application,k=l.transport;if(a=h.findLine("a=mid:",p))l.name=a.substr(6);h.findLine("a=sendrecv",p,b)?l.senders="both":h.findLine("a=sendonly",p,b)?l.senders=e[t][m].sendonly:h.findLine("a=recvonly",p,b)?l.senders=e[t][m].recvonly:
h.findLine("a=inactive",p,b)&&(l.senders="none");if("rtp"==g.applicationType){if(a=h.findLine("b=",p))g.bandwidth=h.bandwidth(a);if(a=h.findLine("a=ssrc:",p))g.ssrc=a.substr(7).split(" ")[0];h.findLines("a=rtpmap:",p).forEach(function(b){var a=h.rtpmap(b);a.parameters=[];a.feedback=[];h.findLines("a=fmtp:"+a.id,p).forEach(function(b){a.parameters=h.fmtp(b)});h.findLines("a=rtcp-fb:"+a.id,p).forEach(function(b){a.feedback.push(h.rtcpfb(b))});g.payloads.push(a)});h.findLines("a=crypto:",p,b).forEach(function(b){g.encryption.push(h.crypto(b))});
h.findLine("a=rtcp-mux",p)&&(g.mux=!0);h.findLines("a=rtcp-fb:*",p).forEach(function(b){g.feedback.push(h.rtcpfb(b))});h.findLines("a=extmap:",p).forEach(function(b){b=h.extmap(b);b.senders=e[t][m][b.senders];g.headerExtensions.push(b)});a=h.findLines("a=ssrc-group:",p);g.sourceGroups=h.sourceGroups(a||[]);a=h.findLines("a=ssrc:",p);var O=g.sources=h.sources(a||[]);if(a=h.findLine("a=msid:",p)){var u=h.msid(a);["msid","mslabel","label"].forEach(function(b){for(var a=0;a<O.length;a++){for(var c=!1,
e=0;e<O[a].parameters.length;e++)O[a].parameters[e].key===b&&(c=!0);c||O[a].parameters.push({key:b,value:u[b]})}})}h.findLine("a=x-google-flag:conference",p,b)&&(g.googConferenceFlag=!0)}a=h.findLines("a=fingerprint:",p,b);var ra=h.findLine("a=setup:",p,b);a.forEach(function(b){b=h.fingerprint(b);ra&&(b.setup=ra.substr(8));k.fingerprints.push(b)});a=h.findLine("a=ice-ufrag:",p,b);d=h.findLine("a=ice-pwd:",p,b);a&&d&&(k.ufrag=a.substr(12),k.pwd=d.substr(10),k.candidates=[],h.findLines("a=candidate:",
p,b).forEach(function(b){k.candidates.push(c.toCandidateJSON(b))}));"datachannel"==g.applicationType&&h.findLines("a=sctpmap:",p).forEach(function(b){b=h.sctpmap(b);k.sctp.push(b)});return l};c.toCandidateJSON=function(b){b=h.candidate(b.split("\r\n")[0]);b.id=(l++).toString(36).substr(0,12);return b}},{"./parsers":46,"./senders":47}],49:[function(b,a,c){var e=b("./senders");c.toSessionSDP=function(b,a){var e=a.sid||b.sid||Date.now(),d=a.time||Date.now(),h=["v=0","o=- "+e+" "+d+" IN IP4 0.0.0.0",
"s=-","t=0 0"];e=b.contents||[];var l=!1;e.forEach(function(b){b.application.sources&&b.application.sources.length&&(l=!0)});l&&h.push("a=msid-semantic: WMS *");(b.groups||[]).forEach(function(b){h.push("a=group:"+b.semantics+" "+b.contents.join(" "))});e.forEach(function(b){h.push(c.toMediaSDP(b,a))});return h.join("\r\n")+"\r\n"};c.toMediaSDP=function(b,a){var d=[],h=a.role||"initiator",l=a.direction||"outgoing",n=b.application;a=b.transport;var g=n.payloads||[],k=a&&a.fingerprints||[],U=[];"datachannel"==
n.applicationType?(U.push("application"),U.push("1"),U.push("DTLS/SCTP"),a.sctp&&a.sctp.forEach(function(b){U.push(b.number)})):(U.push(n.media),U.push("1"),0<k.length?U.push("UDP/TLS/RTP/SAVPF"):n.encryption&&0<n.encryption.length?U.push("RTP/SAVPF"):U.push("RTP/AVPF"),g.forEach(function(b){U.push(b.id)}));d.push("m="+U.join(" "));d.push("c=IN IP4 0.0.0.0");n.bandwidth&&n.bandwidth.type&&n.bandwidth.bandwidth&&d.push("b="+n.bandwidth.type+":"+n.bandwidth.bandwidth);"rtp"==n.applicationType&&d.push("a=rtcp:1 IN IP4 0.0.0.0");
a&&(a.ufrag&&d.push("a=ice-ufrag:"+a.ufrag),a.pwd&&d.push("a=ice-pwd:"+a.pwd),k.forEach(function(b){d.push("a=fingerprint:"+b.hash+" "+b.value);b.setup&&d.push("a=setup:"+b.setup)}),a.sctp&&a.sctp.forEach(function(b){d.push("a=sctpmap:"+b.number+" "+b.protocol+" "+b.streams)}));"rtp"==n.applicationType&&d.push("a="+(e[h][l][b.senders]||"sendrecv"));d.push("a=mid:"+b.name);n.sources&&n.sources.length&&(n.sources[0].parameters||[]).forEach(function(b){"msid"===b.key&&d.push("a=msid:"+b.value)});n.mux&&
d.push("a=rtcp-mux");(n.encryption||[]).forEach(function(b){d.push("a=crypto:"+b.tag+" "+b.cipherSuite+" "+b.keyParams+(b.sessionParams?" "+b.sessionParams:""))});n.googConferenceFlag&&d.push("a=x-google-flag:conference");g.forEach(function(b){var a="a=rtpmap:"+b.id+" "+b.name+"/"+b.clockrate;b.channels&&"1"!=b.channels&&(a+="/"+b.channels);d.push(a);if(b.parameters&&b.parameters.length){a=["a=fmtp:"+b.id];var c=[];b.parameters.forEach(function(b){c.push((b.key?b.key+"=":"")+b.value)});a.push(c.join(";"));
d.push(a.join(" "))}b.feedback&&b.feedback.forEach(function(a){"trr-int"===a.type?d.push("a=rtcp-fb:"+b.id+" trr-int "+(a.value?a.value:"0")):d.push("a=rtcp-fb:"+b.id+" "+a.type+(a.subtype?" "+a.subtype:""))})});n.feedback&&n.feedback.forEach(function(b){"trr-int"===b.type?d.push("a=rtcp-fb:* trr-int "+(b.value?b.value:"0")):d.push("a=rtcp-fb:* "+b.type+(b.subtype?" "+b.subtype:""))});(n.headerExtensions||[]).forEach(function(b){d.push("a=extmap:"+b.id+(b.senders?"/"+e[h][l][b.senders]:"")+" "+b.uri)});
(n.sourceGroups||[]).forEach(function(b){d.push("a=ssrc-group:"+b.semantics+" "+b.sources.join(" "))});(n.sources||[]).forEach(function(b){for(var a=0;a<b.parameters.length;a++){var c=b.parameters[a];d.push("a=ssrc:"+(b.ssrc||n.ssrc)+" "+c.key+(c.value?":"+c.value:""))}});(a.candidates||[]).forEach(function(b){d.push(c.toCandidateSDP(b))});return d.join("\r\n")};c.toCandidateSDP=function(b){var a=[];a.push(b.foundation);a.push(b.component);a.push(b.protocol.toUpperCase());a.push(b.priority);a.push(b.ip);
a.push(b.port);var c=b.type;a.push("typ");a.push(c);("srflx"===c||"prflx"===c||"relay"===c)&&b.relAddr&&b.relPort&&(a.push("raddr"),a.push(b.relAddr),a.push("rport"),a.push(b.relPort));b.tcpType&&"TCP"==b.protocol.toUpperCase()&&(a.push("tcptype"),a.push(b.tcpType));a.push("generation");a.push(b.generation||"0");return"a=candidate:"+a.join(" ")}},{"./senders":47}],50:[function(b,a,c){a.exports=b("./lib/")},{"./lib/":51}],51:[function(b,a,c){function e(b,a){"object"==typeof b&&(a=b,b=void 0);a=a||
{};b=h(b);var c=b.source,e=b.id;a.forceNew||a["force new connection"]||!1===a.multiplex?(p("ignoring socket cache for %s",c),a=t(c,a)):(m[e]||(p("new io instance for %s",c),m[e]=t(c,a)),a=m[e]);return a.socket(b.path)}var h=b("./url"),l=b("socket.io-parser"),t=b("./manager"),p=b("debug")("socket.io-client");a.exports=c=e;var m=c.managers={};c.protocol=l.protocol;c.connect=e;c.Manager=b("./manager");c.Socket=b("./socket")},{"./manager":52,"./socket":54,"./url":55,debug:10,"socket.io-parser":57}],52:[function(b,
a,c){function e(b,a){if(!(this instanceof e))return new e(b,a);b&&"object"==typeof b&&(a=b,b=void 0);a=a||{};a.path=a.path||"/socket.io";this.nsps={};this.subs=[];this.opts=a;this.reconnection(!1!==a.reconnection);this.reconnectionAttempts(a.reconnectionAttempts||Infinity);this.reconnectionDelay(a.reconnectionDelay||1E3);this.reconnectionDelayMax(a.reconnectionDelayMax||5E3);this.randomizationFactor(a.randomizationFactor||.5);this.backoff=new k({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==a.timeout?2E4:a.timeout);this.readyState="closed";this.uri=b;this.connected=[];this.encoding=!1;this.packetBuffer=[];this.encoder=new t.Encoder;this.decoder=new t.Decoder;(this.autoConnect=!1!==a.autoConnect)&&this.open()}b("./url");var h=b("engine.io-client"),l=b("./socket");c=b("component-emitter");var t=b("socket.io-parser"),p=b("./on"),m=b("component-bind");b("object-component");var n=b("debug")("socket.io-client:manager"),g=b("indexof"),
k=b("backo2");a.exports=e;e.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var b in this.nsps)this.nsps[b].emit.apply(this.nsps[b],arguments)};e.prototype.updateSocketIds=function(){for(var b in this.nsps)this.nsps[b].id=this.engine.id};c(e.prototype);e.prototype.reconnection=function(b){if(!arguments.length)return this._reconnection;this._reconnection=!!b;return this};e.prototype.reconnectionAttempts=function(b){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=
b;return this};e.prototype.reconnectionDelay=function(b){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=b;this.backoff&&this.backoff.setMin(b);return this};e.prototype.randomizationFactor=function(b){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=b;this.backoff&&this.backoff.setJitter(b);return this};e.prototype.reconnectionDelayMax=function(b){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=b;this.backoff&&
this.backoff.setMax(b);return this};e.prototype.timeout=function(b){if(!arguments.length)return this._timeout;this._timeout=b;return this};e.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};e.prototype.open=e.prototype.connect=function(b){n("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;n("opening %s",this.uri);var a=this.engine=h(this.uri,this.opts),c=this;this.readyState="opening";this.skipReconnect=
!1;var e=p(a,"open",function(){c.onopen();b&&b()}),d=p(a,"error",function(a){n("connect_error");c.cleanup();c.readyState="closed";c.emitAll("connect_error",a);if(b){var e=Error("Connection error");e.data=a;b(e)}else c.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;n("connect attempt will timeout after %d",l);var t=setTimeout(function(){n("connect attempt timed out after %d",l);e.destroy();a.close();a.emit("error","timeout");c.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(t)}})}this.subs.push(e);
this.subs.push(d);return this};e.prototype.onopen=function(){n("open");this.cleanup();this.readyState="open";this.emit("open");var b=this.engine;this.subs.push(p(b,"data",m(this,"ondata")));this.subs.push(p(this.decoder,"decoded",m(this,"ondecoded")));this.subs.push(p(b,"error",m(this,"onerror")));this.subs.push(p(b,"close",m(this,"onclose")))};e.prototype.ondata=function(b){this.decoder.add(b)};e.prototype.ondecoded=function(b){this.emit("packet",b)};e.prototype.onerror=function(b){n("error",b);
this.emitAll("error",b)};e.prototype.socket=function(b){var a=this.nsps[b];if(!a){a=new l(this,b);this.nsps[b]=a;var c=this;a.on("connect",function(){a.id=c.engine.id;~g(c.connected,a)||c.connected.push(a)})}return a};e.prototype.destroy=function(b){b=g(this.connected,b);~b&&this.connected.splice(b,1);this.connected.length||this.close()};e.prototype.packet=function(b){n("writing packet %j",b);var a=this;a.encoding?a.packetBuffer.push(b):(a.encoding=!0,this.encoder.encode(b,function(b){for(var c=0;c<
b.length;c++)a.engine.write(b[c]);a.encoding=!1;a.processPacketQueue()}))};e.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var b=this.packetBuffer.shift();this.packet(b)}};e.prototype.cleanup=function(){for(var b;b=this.subs.shift();)b.destroy();this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};e.prototype.close=e.prototype.disconnect=function(){this.skipReconnect=!0;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};
e.prototype.onclose=function(b){n("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",b);this._reconnection&&!this.skipReconnect&&this.reconnect()};e.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var b=this;if(this.backoff.attempts>=this._reconnectionAttempts)n("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var a=this.backoff.duration();n("will wait %dms before reconnect attempt",
a);this.reconnecting=!0;var c=setTimeout(function(){b.skipReconnect||(n("attempting reconnect"),b.emitAll("reconnect_attempt",b.backoff.attempts),b.emitAll("reconnecting",b.backoff.attempts),b.skipReconnect||b.open(function(a){a?(n("reconnect attempt error"),b.reconnecting=!1,b.reconnect(),b.emitAll("reconnect_error",a.data)):(n("reconnect success"),b.onreconnect())}))},a);this.subs.push({destroy:function(){clearTimeout(c)}})}};e.prototype.onreconnect=function(){var b=this.backoff.attempts;this.reconnecting=
!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",b)}},{"./on":53,"./socket":54,"./url":55,backo2:4,"component-bind":7,"component-emitter":8,debug:10,"engine.io-client":11,indexof:32,"object-component":39,"socket.io-parser":57}],53:[function(b,a,c){a.exports=function(b,a,c){b.on(a,c);return{destroy:function(){b.removeListener(a,c)}}}},{}],54:[function(b,a,c){function e(b,a){this.io=b;this.nsp=a;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&this.open();this.receiveBuffer=
[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0}var h=b("socket.io-parser");c=b("component-emitter");var l=b("to-array"),t=b("./on"),p=b("component-bind"),m=b("debug")("socket.io-client:socket"),n=b("has-binary");a.exports=e;var g={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},k=c.prototype.emit;c(e.prototype);e.prototype.subEvents=function(){if(!this.subs){var b=this.io;this.subs=
[t(b,"open",p(this,"onopen")),t(b,"packet",p(this,"onpacket")),t(b,"close",p(this,"onclose"))]}};e.prototype.open=e.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};e.prototype.send=function(){var b=l(arguments);b.unshift("message");this.emit.apply(this,b);return this};e.prototype.emit=function(b){if(g.hasOwnProperty(b))return k.apply(this,arguments),this;var a=l(arguments),c=h.EVENT;n(a)&&(c=h.BINARY_EVENT);
c={type:c,data:a};"function"==typeof a[a.length-1]&&(m("emitting packet with ack id %d",this.ids),this.acks[this.ids]=a.pop(),c.id=this.ids++);this.connected?this.packet(c):this.sendBuffer.push(c);return this};e.prototype.packet=function(b){b.nsp=this.nsp;this.io.packet(b)};e.prototype.onopen=function(){m("transport is open - connecting");"/"!=this.nsp&&this.packet({type:h.CONNECT})};e.prototype.onclose=function(b){m("close (%s)",b);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",
b)};e.prototype.onpacket=function(b){if(b.nsp==this.nsp)switch(b.type){case h.CONNECT:this.onconnect();break;case h.EVENT:this.onevent(b);break;case h.BINARY_EVENT:this.onevent(b);break;case h.ACK:this.onack(b);break;case h.BINARY_ACK:this.onack(b);break;case h.DISCONNECT:this.ondisconnect();break;case h.ERROR:this.emit("error",b.data)}};e.prototype.onevent=function(b){var a=b.data||[];m("emitting event %j",a);null!=b.id&&(m("attaching ack callback to event"),a.push(this.ack(b.id)));this.connected?
k.apply(this,a):this.receiveBuffer.push(a)};e.prototype.ack=function(b){var a=this,c=!1;return function(){if(!c){c=!0;var e=l(arguments);m("sending ack %j",e);var d=n(e)?h.BINARY_ACK:h.ACK;a.packet({type:d,id:b,data:e})}}};e.prototype.onack=function(b){m("calling ack %s with %j",b.id,b.data);this.acks[b.id].apply(this,b.data);delete this.acks[b.id]};e.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};e.prototype.emitBuffered=function(){var b;
for(b=0;b<this.receiveBuffer.length;b++)k.apply(this,this.receiveBuffer[b]);this.receiveBuffer=[];for(b=0;b<this.sendBuffer.length;b++)this.packet(this.sendBuffer[b]);this.sendBuffer=[]};e.prototype.ondisconnect=function(){m("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};e.prototype.destroy=function(){if(this.subs){for(var b=0;b<this.subs.length;b++)this.subs[b].destroy();this.subs=null}this.io.destroy(this)};e.prototype.close=e.prototype.disconnect=function(){this.connected&&
(m("performing disconnect (%s)",this.nsp),this.packet({type:h.DISCONNECT}));this.destroy();if(this.connected)this.onclose("io client disconnect");return this}},{"./on":53,"component-bind":7,"component-emitter":8,debug:10,"has-binary":30,"socket.io-parser":57,"to-array":59}],55:[function(b,a,c){(function(c){var e=b("parseuri"),d=b("debug")("socket.io-client:url");a.exports=function(b,a){var h=b;a=a||c.location;null==b&&(b=a.protocol+"//"+a.host);"string"==typeof b&&("/"==b.charAt(0)&&(b="/"==b.charAt(1)?
a.protocol+b:a.hostname+b),/^(https?|wss?):\/\//.test(b)||(d("protocol-less url %s",b),b="undefined"!=typeof a?a.protocol+"//"+b:"https://"+b),d("parse %s",b),h=e(b));h.port||(/^(http|ws)$/.test(h.protocol)?h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443"));h.path=h.path||"/";h.id=h.protocol+"://"+h.host+":"+h.port;h.href=h.protocol+"://"+h.host+(a&&a.port==h.port?"":":"+h.port);return h}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?
window:{})},{debug:10,parseuri:42}],56:[function(b,a,c){(function(a){var e=b("isarray"),d=b("./is-buffer");c.deconstructPacket=function(b){function a(b){if(!b)return b;if(d(b)){var h={_placeholder:!0,num:c.length};c.push(b);return h}if(e(b)){h=Array(b.length);for(var l=0;l<b.length;l++)h[l]=a(b[l]);return h}if("object"==typeof b&&!(b instanceof Date)){h={};for(l in b)h[l]=a(b[l]);return h}return b}var c=[];b.data=a(b.data);b.attachments=c.length;return{packet:b,buffers:c}};c.reconstructPacket=function(b,
a){function c(b){if(b&&b._placeholder)return a[b.num];if(e(b))for(var d=0;d<b.length;d++)b[d]=c(b[d]);else if(b&&"object"==typeof b)for(d in b)b[d]=c(b[d]);return b}b.data=c(b.data);b.attachments=void 0;return b};c.removeBlobs=function(b,c){function h(b,p,m){if(!b)return b;if(a.Blob&&b instanceof Blob||a.File&&b instanceof File){l++;var n=new FileReader;n.onload=function(){m?m[p]=this.result:t=this.result;--l||c(t)};n.readAsArrayBuffer(b)}else if(e(b))for(n=0;n<b.length;n++)h(b[n],n,b);else if(b&&
"object"==typeof b&&!d(b))for(n in b)h(b[n],n,b)}var l=0,t=b;h(t);l||c(t)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./is-buffer":58,isarray:33}],57:[function(b,a,c){function e(){}function h(b){var a=!1;var e=""+b.type;if(c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type)e+=b.attachments,e+="-";b.nsp&&"/"!=b.nsp&&(a=!0,e+=b.nsp);null!=b.id&&(a&&(e+=",",a=!1),e+=b.id);null!=b.data&&(a&&(e+=","),e+=n.stringify(b.data));m("encoded %j as %s",
b,e);return e}function l(b,a){g.removeBlobs(b,function(b){var c=g.deconstructPacket(b);b=h(c.packet);c=c.buffers;c.unshift(b);a(c)})}function t(){this.reconstructor=null}function p(b){this.reconPack=b;this.buffers=[]}var m=b("debug")("socket.io-parser"),n=b("json3");b("isarray");a=b("component-emitter");var g=b("./binary"),k=b("./is-buffer");c.protocol=4;c.types="CONNECT DISCONNECT EVENT BINARY_EVENT ACK BINARY_ACK ERROR".split(" ");c.CONNECT=0;c.DISCONNECT=1;c.EVENT=2;c.ACK=3;c.ERROR=4;c.BINARY_EVENT=
5;c.BINARY_ACK=6;c.Encoder=e;c.Decoder=t;e.prototype.encode=function(b,a){m("encoding packet %j",b);c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?l(b,a):(b=h(b),a([b]))};a(t.prototype);t.prototype.add=function(b){if("string"==typeof b){a:{var a={},e=0;a.type=Number(b.charAt(0));if(null==c.types[a.type])b={type:c.ERROR,data:"parser error"};else{if(c.BINARY_EVENT==a.type||c.BINARY_ACK==a.type){for(var d="";"-"!=b.charAt(++e)&&(d+=b.charAt(e),e!=b.length););if(d!=Number(d)||"-"!=b.charAt(e))throw Error("Illegal attachments");
a.attachments=Number(d)}if("/"==b.charAt(e+1))for(a.nsp="";++e;){d=b.charAt(e);if(","==d)break;a.nsp+=d;if(e==b.length)break}else a.nsp="/";d=b.charAt(e+1);if(""!==d&&Number(d)==d){for(a.id="";++e;){d=b.charAt(e);if(null==d||Number(d)!=d){--e;break}a.id+=b.charAt(e);if(e==b.length)break}a.id=Number(a.id)}if(b.charAt(++e))try{a.data=n.parse(b.substr(e))}catch(wf){b={type:c.ERROR,data:"parser error"};break a}m("decoded %s as %j",b,a);b=a}}c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?(this.reconstructor=
new p(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else if(k(b)||b.base64)if(this.reconstructor){if(b=this.reconstructor.takeBinaryData(b))this.reconstructor=null,this.emit("decoded",b)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+b);};t.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};p.prototype.takeBinaryData=function(b){this.buffers.push(b);
return this.buffers.length==this.reconPack.attachments?(b=g.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),b):null};p.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},{"./binary":56,"./is-buffer":58,"component-emitter":8,debug:10,isarray:33,json3:34}],58:[function(b,a,c){(function(b){a.exports=function(a){return b.Buffer&&b.Buffer.isBuffer(a)||b.ArrayBuffer&&a instanceof ArrayBuffer}}).call(this,"undefined"!==typeof global?global:"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{}],59:[function(b,a,c){a.exports=function(b,a){for(var c=[],e=(a=a||0)||0;e<b.length;e++)c[e-a]=b[e];return c}},{}],60:[function(b,a,c){(function(b){(function(e){function d(b){for(var a=[],c=0,e=b.length,d,h;c<e;)d=b.charCodeAt(c++),55296<=d&&56319>=d&&c<e?(h=b.charCodeAt(c++),56320==(h&64512)?a.push(((d&1023)<<10)+(h&1023)+65536):(a.push(d),c--)):a.push(d);return a}function h(b){if(55296<=b&&57343>=b)throw Error("Lone surrogate U+"+b.toString(16).toUpperCase()+
" is not a scalar value");}function p(){if(O>=y)throw Error("Invalid byte index");var b=u[O]&255;O++;if(128==(b&192))return b&63;throw Error("Invalid continuation byte");}function m(){if(O>y)throw Error("Invalid byte index");if(O==y)return!1;var b=u[O]&255;O++;if(0==(b&128))return b;if(192==(b&224)){var a=p();b=(b&31)<<6|a;if(128<=b)return b;throw Error("Invalid continuation byte");}if(224==(b&240)){a=p();var c=p();b=(b&15)<<12|a<<6|c;if(2048<=b)return h(b),b;throw Error("Invalid continuation byte");
}if(240==(b&248)){a=p();c=p();var e=p();b=(b&15)<<18|a<<12|c<<6|e;if(65536<=b&&1114111>=b)return b}throw Error("Invalid UTF-8 detected");}var n="object"==typeof c&&c,g="object"==typeof a&&a&&a.exports==n&&a,k="object"==typeof b&&b;if(k.global===k||k.window===k)e=k;var U=String.fromCharCode,u,y,O;k={version:"2.0.0",encode:function(b){b=d(b);for(var a=b.length,c=-1,e,l="";++c<a;){e=b[c];if(0==(e&4294967168))e=U(e);else{var t="";0==(e&4294965248)?t=U(e>>6&31|192):0==(e&4294901760)?(h(e),t=U(e>>12&15|
224),t+=U(e>>6&63|128)):0==(e&4292870144)&&(t=U(e>>18&7|240),t+=U(e>>12&63|128),t+=U(e>>6&63|128));e=t+=U(e&63|128)}l+=e}return l},decode:function(b){u=d(b);y=u.length;O=0;b=[];for(var a;!1!==(a=m());)b.push(a);a=b.length;for(var c=-1,e,h="";++c<a;)e=b[c],65535<e&&(e-=65536,h+=U(e>>>10&1023|55296),e=56320|e&1023),h+=U(e);return h}};if(n&&!n.nodeType)if(g)g.exports=k;else{e={}.hasOwnProperty;for(var v in k)e.call(k,v)&&(n[v]=k[v])}else e.utf8=k})(this)}).call(this,"undefined"!==typeof global?global:
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],61:[function(b,a,c){a.exports="function"===typeof Object.create?function(b,a){b.super_=a;b.prototype=Object.create(a.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,a){b.super_=a;var c=function(){};c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b}},{}],62:[function(b,a,c){a.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===
typeof b.fill&&"function"===typeof b.readUInt8}},{}],63:[function(b,a,c){(function(a,e){function d(b,a){var e={seen:[],stylize:p};3<=arguments.length&&(e.depth=arguments[2]);4<=arguments.length&&(e.colors=arguments[3]);v(a)?e.showHidden=a:a&&c._extend(e,a);x(e.showHidden)&&(e.showHidden=!1);x(e.depth)&&(e.depth=2);x(e.colors)&&(e.colors=!1);x(e.customInspect)&&(e.customInspect=!0);e.colors&&(e.stylize=h);return n(e,b,e.depth)}function h(b,a){return(a=d.styles[a])?"\u001b["+d.colors[a][0]+"m"+b+"\u001b["+
d.colors[a][1]+"m":b}function p(b,a){return b}function m(b){var a={};b.forEach(function(b,c){a[b]=!0});return a}function n(b,a,e){if(b.customInspect&&a&&D(a.inspect)&&a.inspect!==c.inspect&&(!a.constructor||a.constructor.prototype!==a)){var d=a.inspect(e,b);N(d)||(d=n(b,d,e));return d}if(d=g(b,a))return d;var h=Object.keys(a),l=m(h);b.showHidden&&(h=Object.getOwnPropertyNames(a));if(E(a)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return k(a);if(0===h.length){if(D(a))return b.stylize("[Function"+
(a.name?": "+a.name:"")+"]","special");if(w(a))return b.stylize(RegExp.prototype.toString.call(a),"regexp");if(z(a))return b.stylize(Date.prototype.toString.call(a),"date");if(E(a))return k(a)}d="";var t=!1,p=["{","}"];O(a)&&(t=!0,p=["[","]"]);D(a)&&(d=" [Function"+(a.name?": "+a.name:"")+"]");w(a)&&(d=" "+RegExp.prototype.toString.call(a));z(a)&&(d=" "+Date.prototype.toUTCString.call(a));E(a)&&(d=" "+k(a));if(0===h.length&&(!t||0==a.length))return p[0]+d+p[1];if(0>e)return w(a)?b.stylize(RegExp.prototype.toString.call(a),
"regexp"):b.stylize("[Object]","special");b.seen.push(a);h=t?U(b,a,e,l,h):h.map(function(c){return u(b,a,e,l,c,t)});b.seen.pop();return y(h,d,p)}function g(b,a){if(x(a))return b.stylize("undefined","undefined");if(N(a))return a="'"+JSON.stringify(a).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",b.stylize(a,"string");if(B(a))return b.stylize(""+a,"number");if(v(a))return b.stylize(""+a,"boolean");if(null===a)return b.stylize("null","null")}function k(b){return"["+Error.prototype.toString.call(b)+
"]"}function U(b,a,c,e,d){for(var h=[],l=0,t=a.length;l<t;++l)Object.prototype.hasOwnProperty.call(a,String(l))?h.push(u(b,a,c,e,String(l),!0)):h.push("");d.forEach(function(d){d.match(/^\d+$/)||h.push(u(b,a,c,e,d,!0))});return h}function u(b,a,c,e,d,h){var l,t;a=Object.getOwnPropertyDescriptor(a,d)||{value:a[d]};a.get?t=a.set?b.stylize("[Getter/Setter]","special"):b.stylize("[Getter]","special"):a.set&&(t=b.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(e,d)||(l="["+d+"]");t||
(0>b.seen.indexOf(a.value)?(t=null===c?n(b,a.value,null):n(b,a.value,c-1),-1<t.indexOf("\n")&&(t=h?t.split("\n").map(function(b){return"  "+b}).join("\n").substr(2):"\n"+t.split("\n").map(function(b){return"   "+b}).join("\n"))):t=b.stylize("[Circular]","special"));if(x(l)){if(h&&d.match(/^\d+$/))return t;l=JSON.stringify(""+d);l.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(l=l.substr(1,l.length-2),l=b.stylize(l,"name")):(l=l.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),l=b.stylize(l,
"string"))}return l+": "+t}function y(b,a,c){var e=0;return 60<b.reduce(function(b,a){e++;0<=a.indexOf("\n")&&e++;return b+a.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===a?"":a+"\n ")+" "+b.join(",\n  ")+" "+c[1]:c[0]+a+" "+b.join(", ")+" "+c[1]}function O(b){return Array.isArray(b)}function v(b){return"boolean"===typeof b}function B(b){return"number"===typeof b}function N(b){return"string"===typeof b}function x(b){return void 0===b}function w(b){return A(b)&&"[object RegExp]"===Object.prototype.toString.call(b)}
function A(b){return"object"===typeof b&&null!==b}function z(b){return A(b)&&"[object Date]"===Object.prototype.toString.call(b)}function E(b){return A(b)&&("[object Error]"===Object.prototype.toString.call(b)||b instanceof Error)}function D(b){return"function"===typeof b}function I(b){return 10>b?"0"+b.toString(10):b.toString(10)}function J(){var b=new Date,a=[I(b.getHours()),I(b.getMinutes()),I(b.getSeconds())].join(":");return[b.getDate(),M[b.getMonth()],a].join(" ")}var C=/%[sdj%]/g;c.format=
function(b){if(!N(b)){for(var a=[],c=0;c<arguments.length;c++)a.push(d(arguments[c]));return a.join(" ")}c=1;var e=arguments,h=e.length;a=String(b).replace(C,function(b){if("%%"===b)return"%";if(c>=h)return b;switch(b){case "%s":return String(e[c++]);case "%d":return Number(e[c++]);case "%j":try{return JSON.stringify(e[c++])}catch(al){return"[Circular]"}default:return b}});for(var l=e[c];c<h;l=e[++c])a=null!==l&&A(l)?a+(" "+d(l)):a+(" "+l);return a};c.deprecate=function(b,d){if(x(e.process))return function(){return c.deprecate(b,
d).apply(this,arguments)};if(!0===a.noDeprecation)return b;var h=!1;return function(){if(!h){if(a.throwDeprecation)throw Error(d);a.traceDeprecation?console.trace(d):console.error(d);h=!0}return b.apply(this,arguments)}};var F={},K;c.debuglog=function(b){x(K)&&(K=a.env.NODE_DEBUG||"");b=b.toUpperCase();if(!F[b])if((new RegExp("\\b"+b+"\\b","i")).test(K)){var e=a.pid;F[b]=function(){var a=c.format.apply(c,arguments);console.error("%s %d: %s",b,e,a)}}else F[b]=function(){};return F[b]};c.inspect=d;
d.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};d.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};c.isArray=O;c.isBoolean=v;c.isNull=function(b){return null===b};c.isNullOrUndefined=function(b){return null==b};c.isNumber=B;c.isString=N;c.isSymbol=function(b){return"symbol"===
typeof b};c.isUndefined=x;c.isRegExp=w;c.isObject=A;c.isDate=z;c.isError=E;c.isFunction=D;c.isPrimitive=function(b){return null===b||"boolean"===typeof b||"number"===typeof b||"string"===typeof b||"symbol"===typeof b||"undefined"===typeof b};c.isBuffer=b("./support/isBuffer");var M="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");c.log=function(){console.log("%s - %s",J(),c.format.apply(c,arguments))};c.inherits=b("inherits");c._extend=function(b,a){if(!a||!A(a))return b;for(var c=Object.keys(a),
e=c.length;e--;)b[c[e]]=a[c[e]];return b}}).call(this,b("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":62,_process:43,inherits:61}],64:[function(b,a,c){if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){var e="moz";var h=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)e="webkit",h=navigator.userAgent.match(/Chrom(e|ium)/)&&
parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10);b=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;c=window.mozRTCIceCandidate||window.RTCIceCandidate;var l=window.mozRTCSessionDescription||window.RTCSessionDescription,t=window.webkitMediaStream||window.MediaStream,p="https:"===window.location.protocol&&("webkit"===e&&26<=h||"moz"===e&&33<=h),m=window.AudioContext||window.webkitAudioContext,n=document.createElement("video");n=n&&n.canPlayType&&
"probably"===n.canPlayType('video/webm; codecs="vp8", vorbis');var g=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;a.exports={prefix:e,browserVersion:h,support:!!b&&!!g,supportRTCPeerConnection:!!b,supportVp8:n,supportGetUserMedia:!!g,supportDataChannel:!!(b&&b.prototype&&b.prototype.createDataChannel),supportWebAudio:!(!m||!m.prototype.createMediaStreamSource),supportMediaStream:!(!t||!t.prototype.removeTrack),supportScreenSharing:!!p,AudioContext:m,
PeerConnection:b,SessionDescription:l,IceCandidate:c,MediaStream:t,getUserMedia:g}},{}],65:[function(b,a,c){function e(){}a.exports=e;e.mixin=function(b){b=b.prototype||b;b.isWildEmitter=!0;b.on=function(b,a,c){this.callbacks=this.callbacks||{};var e=3===arguments.length,d=e?arguments[2]:arguments[1];d._groupName=e?arguments[1]:void 0;(this.callbacks[b]=this.callbacks[b]||[]).push(d);return this};b.once=function(b,a,c){function e(){d.off(b,e);l.apply(this,arguments)}var d=this,h=3===arguments.length,
l=h?arguments[2]:arguments[1];this.on(b,h?arguments[1]:void 0,e);return this};b.releaseGroup=function(b){this.callbacks=this.callbacks||{};var a,c;for(a in this.callbacks){var e=this.callbacks[a];var d=0;for(c=e.length;d<c;d++)e[d]._groupName===b&&(e.splice(d,1),d--,c--)}return this};b.off=function(b,a){this.callbacks=this.callbacks||{};var c=this.callbacks[b];if(!c)return this;if(1===arguments.length)return delete this.callbacks[b],this;var e=c.indexOf(a);c.splice(e,1);0===c.length&&delete this.callbacks[b];
return this};b.emit=function(b){this.callbacks=this.callbacks||{};var a=[].slice.call(arguments,1),c=this.callbacks[b],e=this.getWildcardCallbacks(b),d;if(c){var h=c.slice();c=0;for(d=h.length;c<d&&h[c];++c)h[c].apply(this,a)}if(e)for(h=e.slice(),c=0,d=h.length;c<d&&h[c];++c)h[c].apply(this,[b].concat(a));return this};b.getWildcardCallbacks=function(b){this.callbacks=this.callbacks||{};var a,c=[];for(a in this.callbacks){var e=a.split("*");if("*"===a||2===e.length&&b.slice(0,e[0].length)===e[0])c=
c.concat(this.callbacks[a])}return c}};e.mixin(e)},{}],66:[function(b,a,c){function e(b,a,c){return a?new h(b,a):new h(b)}b=function(){return this}();var h=b.WebSocket||b.MozWebSocket;a.exports=h?e:null;h&&(e.prototype=h.prototype)},{}],67:[function(b,a,c){function e(b){var a=!0;b.getTracks().forEach(function(b){a="ended"===b.readyState&&a});return a}function h(b){var a=this;p.call(this);this.id=b.id;this.parent=b.parent;this.type=b.type||"video";this.oneway=b.oneway||!1;this.sharemyscreen=b.sharemyscreen||
!1;this.browserPrefix=b.prefix;this.stream=b.stream;this.enableDataChannels=void 0===b.enableDataChannels?this.parent.config.enableDataChannels:b.enableDataChannels;this.receiveMedia=b.receiveMedia||this.parent.config.receiveMedia;this.channels={};this.sid=b.sid||Date.now().toString();this.pc=new t(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints);this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("endOfCandidates",function(b){a.send("endOfCandidates",
b)});this.pc.on("offer",function(b){a.parent.config.nick&&(b.nick=a.parent.config.nick);a.send("offer",b)});this.pc.on("answer",function(b){a.parent.config.nick&&(b.nick=a.parent.config.nick);a.send("answer",b)});this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this));this.pc.on("addChannel",this.handleDataChannelAdded.bind(this));this.pc.on("removeStream",this.handleStreamRemoved.bind(this));this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded"));this.pc.on("iceConnectionStateChange",
this.emit.bind(this,"iceConnectionStateChange"));this.pc.on("iceConnectionStateChange",function(){switch(a.pc.iceConnectionState){case "failed":"offer"===a.pc.pc.localDescription.type&&(a.parent.emit("iceFailed",a),a.send("connectivityError"))}});this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange"));this.logger=this.parent.logger;"screen"===b.type?this.parent.localScreens&&this.parent.localScreens[0]&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),
this.pc.addStream(this.parent.localScreens[0]),this.broadcaster=b.broadcaster):this.parent.localStreams.forEach(function(b){a.pc.addStream(b)});this.on("channelOpen",function(b){"https://simplewebrtc.com/protocol/filetransfer#inband-v1"===b.protocol&&(b.onmessage=function(c){c=JSON.parse(c.data);var e=new m.Receiver;e.receive(c,b);a.emit("fileTransfer",c,e);e.on("receivedFile",function(b,a){e.channel.close()})})});this.on("*",function(){a.parent.emit.apply(a.parent,arguments)})}c=b("util");var l=
b("webrtcsupport"),t=b("rtcpeerconnection"),p=b("wildemitter"),m=b("filetransfer");c.inherits(h,p);h.prototype.handleMessage=function(b){var a=this;this.logger.log("getting",b.type,b);b.prefix&&(this.browserPrefix=b.prefix);"offer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleOffer(b.payload,function(b){b||a.pc.answer(function(b,a){})})):"answer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleAnswer(b.payload)):"candidate"===
b.type?this.pc.processIce(b.payload):"connectivityError"===b.type?this.parent.emit("connectivityError",a):"mute"===b.type?this.parent.emit("mute",{id:b.from,name:b.payload.name}):"unmute"===b.type&&this.parent.emit("unmute",{id:b.from,name:b.payload.name})};h.prototype.send=function(b,a){a={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:b,payload:a,prefix:l.prefix};this.logger.log("sending",b,a);this.parent.emit("message",a)};h.prototype.sendDirectly=function(b,a,c){c=
{type:a,payload:c};this.logger.log("sending via datachannel",b,a,c);b=this.getDataChannel(b);if("open"!=b.readyState)return!1;b.send(JSON.stringify(c));return!0};h.prototype._observeDataChannel=function(b){var a=this;b.onclose=this.emit.bind(this,"channelClose",b);b.onerror=this.emit.bind(this,"channelError",b);b.onmessage=function(c){a.emit("channelMessage",a,b.label,JSON.parse(c.data),b,c)};b.onopen=this.emit.bind(this,"channelOpen",b)};h.prototype.getDataChannel=function(b,a){if(!l.supportDataChannel)return this.emit("error",
Error("createDataChannel not supported"));var c=this.channels[b];a||(a={});if(c)return c;c=this.channels[b]=this.pc.createDataChannel(b,a);this._observeDataChannel(c);return c};h.prototype.onIceCandidate=function(b){if(!this.closed)if(b){var a=this.parent.config.peerConnectionConfig;"moz"===l.prefix&&a&&a.iceTransports&&b.candidate&&b.candidate.candidate&&0>b.candidate.candidate.indexOf(a.iceTransports)?this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",a.iceTransports):
this.send("candidate",b)}else this.logger.log("End of candidates.")};h.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc");this.pc.offer(this.receiveMedia,function(b,a){})};h.prototype.icerestart=function(){var b=this.receiveMedia;b.mandatory.IceRestart=!0;this.pc.offer(b,function(b,a){})};h.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())};h.prototype.handleRemoteStreamAdded=function(b){var a=this;this.stream?this.logger.warn("Already have a remote stream"):
(this.stream=b.stream,this.stream.getTracks().forEach(function(b){b.addEventListener("ended",function(){e(a.stream)&&a.end()})}),this.parent.emit("peerStreamAdded",this))};h.prototype.handleStreamRemoved=function(){var b=this.parent.peers.indexOf(this);-1<b&&(this.parent.peers.splice(b,1),this.closed=!0,this.parent.emit("peerStreamRemoved",this))};h.prototype.handleDataChannelAdded=function(b){this.channels[b.label]=b;this._observeDataChannel(b)};h.prototype.sendFile=function(b){var a=new m.Sender,
c=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:"https://simplewebrtc.com/protocol/filetransfer#inband-v1"});c.onopen=function(){c.send(JSON.stringify({size:b.size,name:b.name}));a.send(b,c)};c.onclose=function(){console.log("sender received transfer");a.emit("complete")};return a};a.exports=h},{filetransfer:26,rtcpeerconnection:44,util:63,webrtcsupport:64,wildemitter:65}],68:[function(b,a,c){function e(b){var a=this,c=b||{},e=this.config={url:"https://sandbox.simplewebrtc.com:443/",
socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}},d;var k=b.debug?b.logger||console:b.logger||m;this.logger=k;for(d in c)c.hasOwnProperty(d)&&(this.config[d]=c[d]);this.capabilities=t;l.call(this);var n=null===this.config.connection?this.connection=
new g(this.config):this.connection=this.config.connection;n.on("connect",function(){a.emit("connectionReady",n.getSessionid());a.sessionReady=!0;a.testReadiness()});n.on("message",function(b){var c=a.webrtc.getPeers(b.from,b.roomType);if("offer"===b.type){c.length&&c.forEach(function(a){a.sid==b.sid&&(e=a)});if(!e){var e=a.webrtc.createPeer({id:b.from,sid:b.sid,type:b.roomType,enableDataChannels:a.config.enableDataChannels&&"screen"!==b.roomType,sharemyscreen:"screen"===b.roomType&&!b.broadcaster,
broadcaster:"screen"!==b.roomType||b.broadcaster?null:a.connection.getSessionid()});a.emit("createdPeer",e)}e.handleMessage(b)}else c.length&&c.forEach(function(a){b.sid?a.sid===b.sid&&a.handleMessage(b):a.handleMessage(b)})});n.on("remove",function(b){b.id!==a.connection.getSessionid()&&a.webrtc.removePeers(b.id,b.type)});b.logger=this.logger;b.debug=!1;this.webrtc=new h(b);"mute unmute pauseVideo resumeVideo pause resume sendToAll sendDirectlyToAll getPeers".split(" ").forEach(function(b){a[b]=
a.webrtc[b].bind(a.webrtc)});this.webrtc.on("*",function(){a.emit.apply(a,arguments)});if(e.debug)this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:"));this.webrtc.on("localStream",function(){a.testReadiness()});this.webrtc.on("message",function(b){a.connection.emit("message",b)});this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this));this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this));this.config.adjustPeerVolume&&(this.webrtc.on("speaking",
this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1)));n.on("stunservers",function(b){a.webrtc.config.peerConnectionConfig.iceServers=b;a.emit("stunservers",b)});n.on("turnservers",function(b){a.webrtc.config.peerConnectionConfig.iceServers=a.webrtc.config.peerConnectionConfig.iceServers.concat(b);a.emit("turnservers",b)});this.webrtc.on("iceFailed",function(b){});this.webrtc.on("connectivityError",function(b){});this.webrtc.on("audioOn",
function(){a.webrtc.sendToAll("unmute",{name:"audio"})});this.webrtc.on("audioOff",function(){a.webrtc.sendToAll("mute",{name:"audio"})});this.webrtc.on("videoOn",function(){a.webrtc.sendToAll("unmute",{name:"video"})});this.webrtc.on("videoOff",function(){a.webrtc.sendToAll("mute",{name:"video"})});this.webrtc.on("localScreen",function(b){var c=document.createElement("video"),e=a.getRemoteVideoContainer();c.oncontextmenu=function(){return!1};c.id="localScreen";p(b,c);e&&e.appendChild(c);a.emit("localScreenAdded",
c);a.connection.emit("shareScreen");a.webrtc.peers.forEach(function(b){"video"===b.type&&(b=a.webrtc.createPeer({id:b.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:a.connection.getSessionid()}),a.emit("createdPeer",b),b.start())})});this.webrtc.on("localScreenStopped",function(b){a.getLocalScreen()&&a.stopScreenShare()});this.webrtc.on("channelMessage",function(b,c,e){"volume"==e.type&&a.emit("remoteVolumeChange",b,e.volume)});
this.config.autoRequestMedia&&this.startLocalVideo()}var h=b("./webrtc"),l=b("wildemitter"),t=b("webrtcsupport"),p=b("attachmediastream"),m=b("mockconsole"),g=b("./socketioconnection");e.prototype=Object.create(l.prototype,{constructor:{value:e}});e.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare();this.emit("leftRoom",this.roomName);this.roomName=void 0}};e.prototype.disconnect=
function(){this.connection.disconnect();delete this.connection};e.prototype.handlePeerStreamAdded=function(b){var a=this,c=this.getRemoteVideoContainer(),e=p(b.stream);b.videoEl=e;e.id=this.getDomId(b);c&&c.appendChild(e);this.emit("videoAdded",e,b);window.setTimeout(function(){a.webrtc.isAudioEnabled()||b.send("mute",{name:"audio"});a.webrtc.isVideoEnabled()||b.send("mute",{name:"video"})},250)};e.prototype.handlePeerStreamRemoved=function(b){var a=this.getRemoteVideoContainer(),c=b.videoEl;this.config.autoRemoveVideos&&
a&&c&&a.removeChild(c);c&&this.emit("videoRemoved",c,b)};e.prototype.getDomId=function(b){return[b.id,b.type,b.broadcaster?"broadcasting":"incoming"].join("_")};e.prototype.setVolumeForAll=function(b){this.webrtc.peers.forEach(function(a){a.videoEl&&(a.videoEl.volume=b)})};e.prototype.joinRoom=function(b,a){var c=this;this.roomName=b;this.connection.emit("join",b,function(e,d){console.log("join CB",e);if(e)c.emit("error",e);else{A.room=d.xtra;var h,l;for(h in d.clients){var t=d.clients[h];for(l in t)if(t[l]){var p=
c.webrtc.createPeer({id:h,type:l,enableDataChannels:c.config.enableDataChannels&&"screen"!==l,receiveMedia:{offerToReceiveAudio:"screen"!==l&&c.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:c.config.receiveMedia.offerToReceiveVideo}});c.emit("createdPeer",p);p.start()}}}a&&a(e,d);c.emit("joinedRoom",b)})};e.prototype.getEl=function(b){return"string"===typeof b?document.getElementById(b):b};e.prototype.startLocalVideo=function(){var b=this;this.webrtc.start(this.config.media,function(a,
c){a?b.emit("localMediaError",a):p(c,b.getLocalVideoContainer(),b.config.localVideo)})};e.prototype.stopLocalVideo=function(){this.webrtc.stop()};e.prototype.getLocalVideoContainer=function(){var b=this.getEl(this.config.localVideoEl);if(b&&"VIDEO"===b.tagName)return b.oncontextmenu=function(){return!1},b;if(b){var a=document.createElement("video");a.oncontextmenu=function(){return!1};b.appendChild(a);return a}};e.prototype.getRemoteVideoContainer=function(){return this.getEl(this.config.remoteVideosEl)};
e.prototype.shareScreen=function(b){this.webrtc.startScreenShare(b)};e.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]};e.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var b=document.getElementById("localScreen"),a=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&a&&b&&a.removeChild(b);b&&this.emit("videoRemoved",b);this.getLocalScreen()&&this.webrtc.stopScreenShare();this.webrtc.peers.forEach(function(b){b.broadcaster&&
b.end()})};e.prototype.testReadiness=function(){this.sessionReady&&(this.config.media.video||this.config.media.audio?0<this.webrtc.localStreams.length&&this.emit("readyToCall",this.connection.getSessionid()):this.emit("readyToCall",this.connection.getSessionid()))};e.prototype.createRoom=function(b,a){this.roomName=b;this.connection.emit("create",A.room,a)};e.prototype.sendFile=function(){if(!t.dataChannel)return this.emit("error",Error("DataChannelNotSupported"))};a.exports=e},{"./socketioconnection":69,
"./webrtc":70,attachmediastream:3,mockconsole:37,webrtcsupport:64,wildemitter:65}],69:[function(b,a,c){function e(b){this.connection=h.connect(b.url,b.socketio)}var h=b("socket.io-client");e.prototype.on=function(b,a){this.connection.on(b,a)};e.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};e.prototype.getSessionid=function(){return this.connection.id};e.prototype.disconnect=function(){return this.connection.disconnect()};a.exports=e},{"socket.io-client":50}],70:[function(b,
a,c){function e(b){var a=this,c=b||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:!0};var e;b=b.debug?b.logger||console:b.logger||l;this.logger=b;for(e in c)c.hasOwnProperty(e)&&(this.config[e]=c[e]);h.support||this.logger.error("Your browser doesn't seem to support WebRTC");this.peers=[];t.call(this,this.config);this.on("speaking",
function(){a.hardMuted||a.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"speaking"})))})});this.on("stoppedSpeaking",function(){a.hardMuted||a.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"stoppedSpeaking"})))})});this.on("volumeChange",function(b,c){a.hardMuted||a.peers.forEach(function(a){a.enableDataChannels&&(a=a.getDataChannel("hark"),
"open"==a.readyState&&a.send(JSON.stringify({type:"volume",volume:b})))})});if(this.config.debug)this.on("*",function(b,c,e){(a.config.logger===l?console:a.logger).log("event:",b,c,e)})}c=b("util");var h=b("webrtcsupport"),l=b("mockconsole"),t=b("localmedia"),p=b("./peer");c.inherits(e,t);e.prototype.createPeer=function(b){b.parent=this;b=new p(b);this.peers.push(b);return b};e.prototype.removePeers=function(b,a){this.getPeers(b,a).forEach(function(b){b.end()})};e.prototype.getPeers=function(b,a){return this.peers.filter(function(c){return(!b||
c.id===b)&&(!a||c.type===a)})};e.prototype.sendToAll=function(b,a){this.peers.forEach(function(c){c.send(b,a)})};e.prototype.sendDirectlyToAll=function(b,a,c){this.peers.forEach(function(e){e.enableDataChannels&&e.sendDirectly(b,a,c)})};a.exports=e},{"./peer":67,localmedia:35,mockconsole:37,util:63,webrtcsupport:64}]},{},[68])(68)});if("undefined"!==typeof AudioContext){var wh=function(a,b,e){b=b.split("/")[1].split(".")[0].toLowerCase();Yd[b]=a;!e||e.music&&e.mid!=Ga.id||(xa(b,e.x,e.y,e.k,e.music,
e.date),e.date=0)},xh=function(a,b,e){this.context=a;this.urlList=b;this.onload=e;this.loadCount=0};xh.prototype.loadBuffer=function(a,b){var f=new XMLHttpRequest;f.open("GET",Pj+a,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");var c=this;f.onreadystatechange=function(){4===f.readyState&&200===f.status&&c.context.decodeAudioData(f.response).then(function(f){f&&wh(f,a,b)})};f.send()};var Yd={},yh="kwf09yi8p5vq1px/Tzar%20Soundtrack%201.mp3 0d7r5b6yq8rvzxa/Tzar%20Soundtrack%202.mp3 6sc2lejtpq5hn1p/Tzar%20Soundtrack%203.mp3 0r454nszfs18sk8/Tzar%20Soundtrack%204.mp3 2qza05mvhvojepw/Tzar%20Soundtrack%205.mp3 55yuwxmo3ebav3v/Tzar%20Soundtrack%206.mp3 d9ifze8utu7b1d4/Tzar%20Soundtrack%207.mp3 ewnlwat5mpm3a6i/Tzar%20Soundtrack%208.mp3 emy8tmk7wrbxqik/Tzar%20Soundtrack%209.mp3 0ryt8t85pu140ys/Tzar%20Soundtrack%2010.mp3 ux3nmflf1efo0si/sr1.mp3 mb8leyhrlx3a8ep/sr2.mp3 uepj5sz037fs6jm/sr3.mp3 aqgug89aiyh78ym/sr4.mp3 v4mnk06t1cm5g2x/sr5.mp3 nnkkl7jddynbbg8/sr6.mp3 0foqk5c3t91c0ll/sr7.mp3 cacamdny4wwisyj/sr8.mp3 m8mbt8r1vlj2i9l/sr9.mp3 ubig3no0l96pnxp/sr10.mp3 jajip2pw72hwz5q/1.mp3 eub8hy6mtuw12vk/2.mp3 mml4nqhhj0ph30d/3.mp3 p72cdqjbjc7oa6v/4.mp3 m895z5a7e1stzg1/5.mp3 ya1yue1ti1ehyo8/6.mp3 lfq7ac9jvtcb8tr/7.mp3 onxh886y06v9c1m/8.mp3 u01v2nu5u1mooma/9.mp3 hfvvah4t7ngs942/10.mp3 zghe44ohag94non/INTRO.mp3 bjdukzb5x2d148f/OUTRO.mp3 m335ymfbydtah6n/WIN1.mp3 j0nl2nra3633p0m/WIN2.mp3 9igi2qh7ixqej07/ATTACK.WAV d48c9woeedsefpq/BALLISTA.WAV toc4s5nzofcrl7a/BLDGDONE.WAV c8k3wd0wmlgxzbj/CHAT%20LOCATION.WAV ser4l9wo87txp9k/TECHDONE.WAV 9f37sjm7co5ccuj/UNITDONE.WAV 6xn0s3j79267158/CHAT.WAV v39gv0xmfobxhm6/E_CASTLE1.WAV 2d9cjalgge5ig3g/E_CATHEDRAL1.WAV xmfkvzft63m3ivi/E_CATHEDRAL2.WAV vzzhxrrqftezh2b/E_FARM1.WAV ftrazbogpf8foip/E_CHURCH1.WAV 961xangoq096ta1/E_FARM2.WAV 5927kzdwz5znu6o/E_HARBOR1.WAV wwjtlgwpm230rqx/E_LUMBER1.WAV a4buxao1lfo5txs/E_MAGETOWER1.WAV mgcz1j57ijivnrx/E_MAGETOWER2.WAV mlqr06rsg0ebg5c/E_MAGETOWER3.WAV jcut9rj4pedruuf/E_MARKET1.WAV m7rpubt227a2mqm/E_SHIPYARD1.WAV dtlikm0f72bqts6/E_STABLES1.WAV 189t8l14j3gfbcd/E_STORAGE1.WAV 6u92t20jjl2ibax/E_OUTPOST1.WAV o6psq5jg611te7h/E_STORAGE2.WAV jpnp0pwsjfajpqh/E_TAVERN1.WAV omdobwnv6ijrdk6/E_WARACADEMY1.WAV xfph6w0wl72iy14/E_WORKSHOP1.WAV m9nzrabgjly054c/EVILCASTLE.WAV o1vdoiexa6q41kd/GATE1.WAV 0i8okhmc24fie1i/GATE2.WAV gcic4rgv7th76g5/GATE3.WAV 1gcczjnk6800a0w/GATE4.WAV s35f76gtwm27r2t/GATE5.WAV jkkktkeqcinw0qk/GATE6.WAV 0qsz059kx5x0fna/GATEWAY.WAV dx4ykguy0c2gkec/HOUSE1.WAV 0bu3c206awygol8/HOUSE2.WAV ixuujwh5i34jqyn/HOUSE3.WAV gtsdx7aq1qo1af9/HOUSE4.WAV y89q2pti77rnl62/HOUSE5.WAV slzdb82f2pq9efh/MERCHANT.WAV hxb9ppcht4b1agh/MINE1.WAV kmvph19wybjvtk3/MONASTERY1.WAV trjbjumhpdq2r6c/MONASTERY2.WAV xdzl5qyez51vp0i/R_CATHEDRAL1.WAV 0jfe5axwda2zy9m/R_CHURCH1.WAV jp0ya01e6lovbpv/SHAOLIN2.WAV sa97rwaqc4bczzg/SHAOLIN.WAV ba9yor9562k8rmk/CHOP%201.WAV 0yq403uktwmaskq/CHOP%202.WAV oumccxj3ppx74lb/CHOP%203.WAV zjlmh6oyt9z80vn/CHOP%204.WAV 8q3x45ooavhgdxf/CHOP%205.WAV tyyuf0ai2b7td9d/CHOP%206.WAV mxk7ilq612mco8y/CHOP%207.WAV vi1nql8csgxue0d/CHOP%208.WAV ptkzwv8er5r250q/CHOP%209.WAV e47rp6twlz7cvor/CHOP%2010.WAV swpbug0t56ool1r/CHOP%2011.WAV 2ddruqf84gi974h/DIG%201.WAV mdv1kf8bb7e6bwj/DIG%202.WAV u7h8iw95x8ufogy/DIG%203.WAV myb354s27trhsgb/MINE%201.WAV 3jca7grtu2uphde/MINE%202.WAV 0sgl0kc77mryj1j/MINE%203.WAV ry9mlisv1lqqp9d/HIT%201.WAV 2ufyfcq4wu9bk1i/HIT%202.WAV cqzlr7gy6mj0k66/HIT%203.WAV i86tqxj1sz91cru/HIT%204.WAV vf604r6t01qe6zd/HIT%205.WAV mnslicm4wy9wdj0/HIT%206.WAV p1ta2wlhfse37db/HIT%207.WAV emwp2hib6msgj22/GHOST1.WAV lrsl9rbxku5cjg7/GHOST2.WAV txbl2bb91s38dqx/GOLEM1.WAV pcfkaldpd7hfrjp/GOLEM2.WAV ivfai5ayu6q99yx/H%20SWORD%201.WAV gedtsneew008x4h/H%20SWORD%202.WAV 57xjkhtc93001et/H%20SWORD%203.WAV ni97b3dbi91yr8b/H%20SWORD%204.WAV 0ls1kz4but9zl51/H%20SWORD%205.WAV ks9mme9djnvdyi5/H%20SWORD%206.WAV hlinmaxi6xj6mv2/H%20SWORD%207.WAV hlinmaxi6xj6mv2/H%20SWORD%207.WAV dt4o378w3100sfu/H%20SWORD%208.WAV ks909spplow4fjz/H%20SWORD%209.WAV w2xfv47ffd7sb72/H%20SWORD%2010.WAV ypapwgz03m7utmq/H%20SWORD%2011.WAV zdcr00adm5qc6hs/H%20SWORD%2012.WAV y90qo1djcx5bzxa/HAND1.WAV 56vhwy7iiu9cpzy/HAND2.WAV 6zhms0m94qg4mvt/HAND3.WAV 41wm4r3cpgjaxly/HAND4.WAV tt4q17tzh6i7u1g/MAGE%20ATTACK.WAV ldhx6mr9upxefci/MESSIAH.WAV 07mie3az1eg1xxh/ORC%20SWORD%201.WAV 9v7spriyxf9szgh/ORC%20SWORD%202.WAV gcfojobbzl2drpn/ORC%20SWORD%203.WAV x0wz0zwpye9i5y3/ORC%20SWORD%204.WAV 2300jmtwppvm452/ORC%20SWORD%205.WAV 3yz2rottu8o8ggt/ORC%20SWORD%206.WAV x5s65vpufpj8t06/ORC%20SWORD%20V1.WAV 0nrb17mzbu3lxtc/ORC%20SWORD%20V2.WAV cypkkpihc1w1hcq/ORC%20SWORD%20V3.WAV y8umilh5cud7jih/SHIP%20CANNON%201.WAV 09kjxvpfn9bdprd/SHIP%20CANNON%202.WAV atj8b8w1k24aqfm/SHIP%20CANNON%203.WAV 6ju34h2pw3nhg7s/SHIP%20CANNON%204.WAV l18s2fbq9q6nzpm/SHIP%20CANNON%205.WAV vrgh4puvgdbpwae/SHIP%20CANNON%206.WAV tmbpku710qnx85q/SHIP%20CANNON%207.WAV 2nomenens1x41lf/SIEGE.WAV 8t9zd51oee3n6vw/SWORD%201.WAV gmwu6lxjaf4mxvv/SWORD%202.WAV tfjzh0u37b60xfc/SWORD%203.WAV s0w71lijsebscys/SWORD%204.WAV 63xcxvtf6fz4nmv/SWORD%205.WAV qpqihts3djiavqd/SWORD%206.WAV zw2cqwnqq5bo3aw/SWORD%207.WAV ub1hntg5qh5h58k/SWORD%208.WAV r4viyma73vblsf5/SWORD%209.WAV 8lxp86hri1yejyt/SWORD%2010.WAV r63199ryslobulc/SWORD%2011.WAV ph48z41qbgbaina/SWORD%2012.WAV o87veypm8qensdd/SWORD%2013.WAV fwapbo29d97mer1/SWORD%2014.WAV tyzv9eybfmt378i/SWORD%2015.WAV 0164fmqamf7yr9s/SWORD%2016.WAV c9renf4qsr56ab4/V%20SWORD%201.WAV gge4f1nb5o7m9qd/V%20SWORD%202.WAV wo0f0ul88unnh01/V%20SWORD%203.WAV q48z5txon4bv76v/V%20SWORD%204.WAV kibmb5mtp1oasan/V%20SWORD%205.WAV 360bl44ii251dus/V%20SWORD%206.WAV oya931j5cn584vn/V%20SWORD%207.WAV rgh3xwlvihecsur/ADRAGON2.WAV jafi9t4hdx4gjnu/ADRAGON3.WAV p7yau58i9x9tznf/ARROW%201.WAV 16jf0mu2c4902ad/ARROW%202.WAV 3gf1vmhszlzsvp6/ARROW%203.WAV hastp290kjpatul/ARROW%204.WAV rzf63kcptscqqb6/ARROW%205.WAV ueysrsca11dznn1/ARROW%206.WAV 2l7ncb4kro91hjp/ARROW%20V1.WAV 6z1zfcuve202wlt/ARROW%20V2.WAV 4al06dvukghp9p8/ARROW%20V3.WAV y3cj0obmsklz7kb/ARROW%20V4.WAV zopzovz1zdos9qn/BEAR1.WAV glbc40fzxrz7x4u/BEAR2.WAV mq7830e9lsw539i/BEAR3.WAV s5h4p53936jqf0m/BEAR4.WAV at4kj0gz88632rt/BEAR5.WAV uq2u4sgg8g6tmou/MWORKSHOP.WAV 09hjcqjlhkgwjsi/DESTROY%20BUILDING.WAV rxan7ebabmxn77z/DESTROY%20MINE.WAV pcwbjrjklna7q57/LIGHTING2.WAV uv2jv59kstujpap/LIGHTING.WAV 6omy17asgyyvcdg/METEOR.WAV r193yz5l7k7yb2i/SMALL%20EXPLOSION.WAV os6jelw7rx49obm/WATER%20BLOP.WAV tjdz2vmlil8c8ud/SPY%20KILL%201.WAV z9tqra8z2pj8fto/SPY%20KILL%203.WAV l85d5424o8s1tq3/SPY%20KILL%202.WAV 97k844atrp03l71/PRIEST%20ATTACK.WAV 2rs81eunjj79t8m/LIGHTNING.WAV i16vdcztiiyd9pl/INVISIBLE.WAV 01a581w494e6nc3/HEAL.WAV v0f62hdvhy2vhiw/FREEZE.WAV e9xkwqnmq1h3xii/FLAME%20BALL.WAV yn1958raqi2el4a/CURSE.WAV 455t0hvitbn4nns/CRUSADE.WAV 1wl7qmtar3y1j2v/CONFUSION.WAV fz21lqeozbq043o/BLESS.WAV xyq2n7ixn80pyn5/WHIRLPOOL.WAV 1t99pip34fvthkq/TURN%20TO%20STONE.WAV jdclsge6rjo7vgo/TEACH.WAV xt7pqtetzsvtgai/SUMMON10.WAV yxcdbheu9s6sqbp/SUMMON9.WAV oum26s9h0mkg6ya/SUMMON8.WAV 46cvrb8px83r1ze/SUMMON7.WAV of68oo8ne7cgdtw/SUMMON6.WAV 3awiprcaujqvohu/SUMMON5.WAV 5kq2b6q3d8ncpww/SUMMON4.WAV avx69olt3m6rrnr/SUMMON3.WAV m08n1qafeiyqe05/SUMMON2.WAV ui2kvbd47bfmx2b/SUMMON1.WAV k8qekk7sutmpcot/REVEAL.WAV 0q9fghfa9qhq5qw/RESSURECT.WAV cb1pq0ssnmj4jic/COWDIE1.WAV f7wgvizjaklyf7n/COWDIE2.WAV cb1pq0ssnmj4jic/COWDIE1.WAV y5zib4fpfywsurg/COWDIE3.WAV oy9j73ss27gix5z/COWDIE4.WAV 1eyn0em70qu0f2i/DIE%201.WAV 27kh2wyo2o9znoz/DIE%202.WAV u572ytnhxy4km3h/DIE%203.WAV 182gaz77ml2mei7/DIE%204.WAV wpvdhtxbe6yy29z/DIE%205.WAV un94l6ebn0l9y2p/DIE%206.WAV 3k2ph5z9vm6ytvz/DIE%207.WAV hjnvqvyet103hf7/DIE%208.WAV umjfyhfxku3dwvp/DIE%209.WAV x1evcyyuhwy2vd3/DIE%2010.WAV xzk59hp6c4wdk3t/DRAGON%20DIE%201.WAV ar7eck4ow8r5w3s/DRAGON%20DIE%202.WAV emwp2hib6msgj22/GHOST1.WAV lrsl9rbxku5cjg7/GHOST2.WAV 6at0jqhx4dza704/GOLEM.WAV h5ydq4j2zdpkiu8/H%20DIE%201.WAV 1bp2u30m504f314/H%20DIE%202.WAV r5kdxiuj8chfl55/H%20DIE%203.WAV 0gubmigjng965ss/H%20DIE%204.WAV 4xzstnrfwevpx21/H%20DIE%205.WAV pnrvg1i5b0jf50i/H%20DIE%206.WAV wkzig2jil3z2hgi/H%20DIE%207.WAV ue13nwsyc6t5ox9/H%20DIE%208.WAV dxk8rptrddombo8/H%20DIE%209.WAV tsdk3uma1x5rz2v/H%20DIE%2010.WAV i3x6klg1g1tx9xx/MAGE.WAV t7c9h3ntknga8i7/ORC%20DIE%201.WAV zwf40uvu5rdu1wy/ORC%20DIE%202.WAV p9gga0rk3ftkkdf/SHIP%20SINK.WAV 5ihoed06p5cm26r/SIEGE%20DIE%201.WAV tahsd6hynfrv1qg/SIEGE%20DIE%202.WAV xboh1sh4rbvx88r/SIEGE%20DIE%203.WAV 4chclvk26ech3mz/SIEGE%20DIE%204.WAV w401vbbvvj99msr/SKELETON%20DIE%201.WAV 0ff119o39785ttm/SKELETON%20DIE%202.WAV 6lxfa75vtxfl2bb/SKELETON%20DIE%203.WAV f3aokr2ngvqpfit/SKELETON%20DIE%204.WAV omfzz21cazinkkm/MESSIAH_ATTACK.WAV 1w2vexiw5aqtrw4/C%20DIE%201.WAV h32280ztxrrz5aa/C%20DIE%202.WAV rq5rgbwaynrdtfc/C%20DIE%203.WAV usywc7awecnolh0/C%20DIE%204.WAV x33opiu95eb78ie/C%20DIE%205.WAV 4lo6hly2n52aq5b/CAMELDIE1.WAV gwsglwtm1fg2eqf/CAMELDIE2.WAV u3mxrmlb10sje2u/CAMELDIE3.WAV nw0ipg198lvq519/BAT%20ATTACK.WAV hukqtscgut9xic7/BAT%20CMD.WAV 77915sxy83vzump/BAT%20DIE.WAV".split(" ");
(function(){for(var a=0,b=yh.length;a<b;a++){var e=yh[a];Yd[e.split("/")[1].split(".")[0].toLowerCase()]=e}})();var nd="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206 arrow%20v1 arrow%20v2 arrow%20v3 arrow%20v4".split(" "),Of="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206".split(" "),oc="sword%201 sword%202 sword%203 sword%204 sword%205 sword%206 sword%207 sword%208 sword%209 sword%2010 sword%2011 sword%2012 sword%2013 sword%2014 sword%2015 sword%2016 v%20sword%201 v%20sword%202 v%20sword%203 v%20sword%204 v%20sword%205 v%20sword%206 v%20sword%207".split(" "),
Pf=["siege"],zh=["hand1","hand2","hand3","hand4"],Zd="h%20sword%201 h%20sword%202 h%20sword%203 h%20sword%204 h%20sword%205 h%20sword%206 h%20sword%207 h%20sword%208 h%20sword%209 h%20sword%2010 h%20sword%2011 h%20sword%2012".split(" "),Qj=["ork%20sword%20v1","ork%20sword%20v2","ork%20sword%20v3"],$d="ship%20cannon%201 ship%20cannon%202 ship%20cannon%203 ship%20cannon%204 ship%20cannon%205 ship%20cannon%206 ship%20cannon%207".split(" "),Rj=["ghost%201","ghost%202"],Sj=["mage%20attack"],M=["destroy%20building"],
Qf=["siege%20die%201","siege%20die%202","siege%20die%203","siege%20die%204"],ae="h%20die%201 h%20die%202 h%20die%203 h%20die%204 h%20die%205 h%20die%206 h%20die%207 h%20die%208 h%20die%209 h%20die%2010".split(" "),lb="die%201 die%202 die%203 die%204 die%205 die%206 die%207 die%208 die%209 die%2010".split(" "),Ah=["e_barrack1"],Pj="https://dl.dropboxusercontent.com/s/";window.AudioContext=window.AudioContext||window.webkitAudioContext;var pc=new AudioContext;var be=pc.createGain();var ce=pc.createGain();
var Tj=new xh(pc,void 0,wh);be.gain.value=parseInt(document.getElementById("musicRange").value)/100;ce.gain.value=parseInt(document.getElementById("soundRange").value)/100;var Ga=function(){if(!u.editor){Ga.id++;localStorage.setItem("favMusic",musicSelect.mversion.value);var a=Ga.list[musicSelect.mversion.value];a&&xa(a[~~(a.length*Math.random())],0,0,void 0,1,0,Ga.id)}};document.getElementById("musicRange").oninput=function(){be.gain.value=parseInt(document.getElementById("musicRange").value)/100};
document.getElementById("soundRange").oninput=function(){ce.gain.value=parseInt(document.getElementById("soundRange").value)/100};Ga.reset=function(){Ga.stop();Ga()};Ga.stop=function(){Ga.active&&(Ga.active.stop(),clearTimeout(Ga.intv))};Ga.id=0;Ga.list={originalMusic1:[1,2,3,4,5,6,7,8,9,10,"outro"],originalMusic:"tzar%20soundtrack%201 tzar%20soundtrack%202 tzar%20soundtrack%203 tzar%20soundtrack%204 tzar%20soundtrack%205 tzar%20soundtrack%206 tzar%20soundtrack%207 tzar%20soundtrack%208 tzar%20soundtrack%209 tzar%20soundtrack%2010".split(" "),
sharpRain:"sr1 sr2 sr3 sr4 sr5 sr6 sr7 sr8 sr9 sr10".split(" ")};var xa=function(a,b,e,c,d,h,l){var f=a;if((a=Yd[a])&&"loading"!==a&&!u.canceled){var p=-gb+(window.innerWidth-A.mx)/2,m=-rb+window.innerHeight/2;if(a.duration){if(u.started)if(64<u.now()-a.lastPlayed||!a.lastPlayed)a.lastPlayed=u.now();else return;!d&&"attack"!=f&&h&&600<Date.now()-h||(b?(b=(-p+32*b)/80,e=(-m+32*e)/80,m=da/8):m=e=b=0,void 0!==c&&c!==A.kingdom||u.mute||(c=pc.createBufferSource(),c.buffer=a,d?(c.connect(be),be.connect(pc.destination),
Ga.active=c,Ga.intv=setTimeout(Ga,~~(1E3*a.duration)+1E3)):(a=pc.createPanner(),a.panningModel="HRTF",a.setPosition(b,e,m),c.connect(a),a.connect(ce),ce.connect(pc.destination)),c.start(0)))}else Yd[f]="loading",d={x:b,y:e,k:c,music:d,date:Date.now(),mid:l},Tj.loadBuffer(a,d)}}}var od=function(a,b,e,c){a.img===c.url&&(xa(b+~~(Math.random()*e+1),a.x32,a.y32),setTimeout(od,Ta(c),a,b,e,c))};(function(){for(var a=document.getElementById("musicSelect").getElementsByTagName("input"),b=0,e=a.length;b<e;b++)a[b].onchange=
Ga.reset})();var Uj=function(a){for(var b=[],f=0,c=[a.icons],d=0,h=c.length;d<h;d++)for(var l=c[d],t=0,p=l.length;t<p;t++)if(l[t]){var m=l[t];m.doneBy||(m.doneBy=[]);m.doneBy.put(a);b[f++]=m;m.xtra&&(c.put(m.xtra),h++)}a.habilities=b},Vj=function(a,b){return b.balanceTotal-a.balanceTotal},Rf=function(a,b){return b.priority-a.priority},Wj=function(a,b){return a-b},de=function(a,b){if(!a.url.attack||a.attackOnly&&!a.attackOnly[b.type])return 0;var f=25*~~(Ta(a.url.attack)/25);a=a.attack*((Sc[a.type][b.type]||
0)+1);a-=b.defence;1>a&&(a=1);return~~(b.health/a)*f},tb=function(a){this.kingdom=a.k;this.aggressive=this.perfection=1;tb.arr.put(this)};tb.prototype.valorateLost=function(a){this.script.put({order:a.nu,obj:a,priority:1})};var Sf=function(a,b,e,c,d){var f=e.obj.cost;c[0]+=f[0];c[1]+=f[1];c[2]+=f[2];c[3]+=f[3];a[a.length]={order:e,priority:b.priority,name:e.obj.name,obj:e.obj,pTime:b.obj.time,required:1,doner:d};a.changed=!0},Tf=function(a,b,e,c,d){var f=[a],l=[],t={},p=d.target;l.put(a);for(var m=
0;m<f.length;m++){var g=f[m];g.availables&&(g.availables=void 0);if((a=g.order)&&!t[g.order.id]&&(t[g.order.id]=1,!e[a.id])){var k=a.requireObj;if(k)for(var r=0,U=k.length;r<U;r++)if(a=k[r],a.tech)b[a.nu.id]||e[a.nu.id]||Sf(f,g,a.nu,p);else{var u=c[a.type];u.length||Sf(f,g,a.nu,p)}if(k=a.doneBy)for(r=0,U=k.length;r<U;r++)a=k[r],u=c[a.type],u.length||a.race!=d.racestr||Sf(f,g,a.nu,p,1);m&&!g.doner&&l.put(g)}}return l},Uf={food:2,wood:1,gold:0,stone:3},pd=function(a,b){a=a.order;var f=pd.tech;a.obj.build&&
(f=pd.build);return f(a,b)};pd.tech=function(a,b){a=a.doneBy;for(var f=0,c=a.length;f<c;f++)for(var d=b[a[f].type],h=0,l=d.length;h<l;h++)if(d[h].free)return d[h].free=0,[d[h]];return!1};pd.build=function(a,b){a=a.doneBy;for(var f=0,c=a.length;f<c;f++)for(var d=b[a[f].type],h=0,l=d.length;h<l;h++)if(d[h].free)return d[h].free=0,[d[h]];return!1};var cc=function(a,b){if(a){var f=a.order,c=f.obj,d=cc.unit;c.tech?d=cc.tech:c.build&&(d=cc.build);return d(f,b,a)}};cc.build=function(a,b){for(var f=[],c=
a.doneBy,d=eb[b.k],h=0,l=c.length;h<l;h++)for(var t=d[c[h].type],p=0,m=t.length;p<m;p++){var g=B[t[p]];if(!g.func&&!g.in){f.put(g.id);break}}if(!f.length)return!1;c=y;g=a.obj;a=g.space;d=g.validator.check;t=b.origin[0];p=b.origin[1];m=p-1;var k=t-1,r=t-40,U=p-40,u=Infinity,v=-1;l=6400;for(h=0;h<l;h++){var O=h%80+r,x=~~(h/80)+U,w=(t-O)*(t-O)+(p-x)*(p-x);1600>w&&w<u&&d(O,x,a,m,k,900>w,b.k)&&(u=w,v=O+x*c)}if(0>v)return!1;ea(Tc,[v,g.type],f);return!0};cc.tech=function(a,b){var f=a.doneBy;b=eb[b.k];for(var c=
[],d=0,h=f.length;d<h;d++)for(var l=b[f[d].type],t=0,p=l.length;t<p;t++){var g=B[l[t]];g.working||g.techStart||!g.built||c.put(g.id)}if(!c.length)return!1;ea(Vf,[a.obj.id,a.id],c[0]);return!0};cc.unit=function(a,b,e){e=a.doneBy;b=eb[b.k];for(var f=[],d=0,h=e.length;d<h;d++)for(var l=b[e[d].type],t=0,p=l.length;t<p;t++){var g=B[l[t]];g.working||g.techStart||!g.built||f.put(g.id)}if(!f.length)return!1;ea(ee,[a.obj.type,1,0],f[0]);return!0};tb.prototype.leaveMeAloneIKnowWhatToDo=function(){performance.now();
var a=J[this.kingdom],b=a.resources,e=eb[this.kingdom],c=y,d=a.origin[0],h=a.origin[1],l=h-1,t=d-1,p=d-40,g=h-40;K(p,g);for(var k=0,q=6400,r=0;r<q;r++){var U=r%80+p,v=~~(r/80)+g;1600>(d-U)*(d-U)+(h-v)*(h-v)&&(!(U>=t&&U<=t+2)||v>=l&&v<=l+2)&&0===Y[U+v*c]&&oa(U,v)&&k++}var w=[];performance.now();for(var O=0,A=0,z=x.length;A<z;A++){var N=x[A];if(!N.build&&!N.item&&!N.boat&&N.url.attack&&N.race==a.racestr&&8!=N.type){w.put(N);N.balanceSum=0;N.bestBalance=-1;N.balanceDefence={};for(var D=Infinity,I=N.attDist,
F=0;F<z;F++){var C=x[F];if(!C.build&&!C.item&&!C.boat&&C.race==a.racestr&&C.url.attack&&8!=C.type&&(O=de(C,N))){var M=de(N,C);M&&(O-=M,O+=2E3*I,O<D&&(D=O,N.bestBalance=C),N.balanceSum+=O)}}}N.balanceTotal=N.balanceSum}w.sort(Vj);N=w[0];for(var G=1E3,Nf={},ub=[],T=0,P=G;!Nf[N.type];)Nf[N.type]=1,ub[T++]=N,ub[T++]=G,C=N.bestBalance,G=~~(G*de(C,N)/de(N,C)+.5),P+=G,N=C;ub.nu=P-G;for(var L=a.target,W=E,Q=W.length,S=[],V=0;V<Q;V++){var H=W[V],da;if(!(da=!H.type||H.upgrade||H.type==R||void 0!==Uf[H.value]&&
a.resources[H.value]>=L[H.value])){a:{for(var ea=H.nu.doneBy,Z=0,ia=ea.length;Z<ia;Z++)if(ea[Z].race==a.racestr){var fa=!0;break a}fa=!1}da=!fa}da||S.put({order:H.nu,obj:H,original:1,priority:1E-10})}var X=[];r=0;q=ub.length;for(var ka=ub.nu;r<q;r+=2){var ha=~~(.5+ub[r+1]/ka*250)-e[ub[r].type].length,ca=ub[r];ca=ca.nu;for(var aa=0;aa<ha;aa++)priority=1-aa/ha,S.put({order:ca,priority:priority,obj:ca.obj,original:1})}var ba=0,ma=0,la=a.target,qa={};ma++;la[0]=0;la[1]=0;la[2]=0;la[3]=0;r=ba=X.length=
0;for(q=S.length;r<q;r++){var xa=S[r].priority,wa=Tf(S[r],a.technology.actived,a.technology.hidden,e,a);aa=0;for(var na=wa.length;aa<na;aa++){ca=wa[aa];ca.original||(ca.priority=xa);var sa=1;void 0!==ca.priority&&(sa=ca.priority);var ta=ca.obj;ta.increase&&void 0!==Uf[ta.value]&&(sa=ta.increase*sa/b[Uf[ta.value]]);sa/=ta.time;ca.priority=sa;if(!(0>=ca.priority)){var va=ca.order.id;!qa[va]||ca.original?(qa[va]=ba,X[ba++]=ca):X[qa[va]].priority+=ca.priority}}}var za=!1;X.sort(Rf);var Aa={},Ca={},ya=
{},pa=[],Ka=x.length;for(r=0;r<Ka;ya[r++]=0);for(r=0;r<X.length;r++){var ja=X[r];ca=ja.order;var Ha=ja.obj;if(ja.original||ja.required)ja.obj.tech||ya[ja.obj.type]++,pa.put(ja);var Ia=ca.doneBy,Ga=Ha.time;aa=0;for(q=Ia.length;1>aa;aa++){var ua=Ia[aa],Na=ua.time;if(Ha){for(var Oa=ua,La=e[ua.type],Ma=tb.process,Ua=Ga,Wa=La.length,Ea=!1,Pa=Infinity,Qa=0;Qa<Wa;Qa++){var Ja=B[La[Qa]],Ba=0;Ja.build&&(Ja.working||Ja.techStart||!Ja.built)&&(Ja.built?(Ba=(Ja.c-u.cycle)*dc.speed,Ba/=1E3):(Ba=Ja.time*(Ja.maxHealth-
Ja.health)/Ja.maxHealth,Ja.workers&&Ja.workers.length&&(Ba/=Ja.workers.length)));Ja.build||!Ja.func&&!Ja.in||(Ba=Infinity);Ja.nato!=Ma?(Ja.nato=Ma,Ja.natoTime=0):Ba+=Ja.natoTime;Ba<Pa&&(Pa=Ba,Ea=Ja)}Ea&&Pa<=Oa.time?(Ea.natoTime+=Ua,za=Ea):za=!1}if(!za){Aa[ua.type]||(Aa[ua.type]=[],Ca[ua.type]=[]);var Fa=Aa[ua.type],Ta=Ca[ua.type];ya[ua.type]||(ya[ua.type]=0);var bb=!1,ib=0;for(na=Fa.length+1;ib<na;ib++){if(void 0==Fa[ib]){var Ya={order:ua.nu,priority:0,obj:ua};X.put(Ya);pa.put(Ya);Fa[ib]=0;Ta[ib]=
Ya;ya[ua.type]++;bb=!0}if(Fa[ib]+Ga<=Na||bb){Fa[ib]+=Ga;Ta[ib].priority+=ja.priority;break}}}}}pa.sort(Rf);var Sa=0;r=0;for(q=pa.length;r<q;r++)if(ja=pa[r].obj,ja.build){var hb=ja.space[ja.space.length-1]+2;Sa+=hb*((ja.space.length-1)/hb+2)}K(Sa,k);if(Sa>k){var pb=k/Sa*.7;r=0;for(q=x.length;r<q;r++)x[r].build&&(ja=ya[r])&&((ja=~~(ja*pb))||(ja=1),ya[r]=ja)}r=0;for(q=pa.length;r<q;r++)ja=pa[r].obj,ja.build&&(ya[ja.type]?ya[ja.type]--:pa[r]=0);for(var jb=0;1>jb;jb++){var Va=[],kb={},db={},Za={},lb={},
ab=[[]],gb=[0];r=0;for(q=e.length;r<q;r++){lb[r]=0;ja=e[r];var rb=[];Za[r]=rb;ib=0;for(na=ja.length;ib<na;ib++)rb[ib]={free:1,type:r}}for(ba=0;ba<gb.length;ba++){var qb=gb[ba],sb=ab[qb];r=0;for(q=sb.length;r<q;r++){var $a=sb[r],mb=$a.list;ib=0;for(na=mb.length;ib<na;ib++)ja=mb[ib],ja.used||(lb[ja.type]++,ja.used=1,Va.put(ja.action)),ja.free=1;$a.obj.tech?kb[$a.obj.nu.id]=1:Za[$a.obj.type].put({free:1,type:$a.obj.type,action:$a.action})}r=0;for(q=pa.length;r<q;r++)if((ja=pa[r])&&1===Tf(ja,kb,db,Za,
a).length&&(mb=pd(ja,Za))){var nb=ja.obj.time+qb;ab[nb]||(ab[nb]=[],gb.put(nb));if(ja.obj.tech){if(db[ja.order.id])continue;db[ja.order.id]=1}(ja.original||ja.required)&&Va.put(ja);ab[nb].put({list:mb,obj:ja.obj,action:ja});pa[r]=void 0}gb.sort(Wj)}K(qb);for(var cb=Va,ob={},Xa=0;Xa<cb.length;Xa++)cb[Xa]&&!cb[Xa].obj.tech&&(ob[cb[Xa].obj.name]||(ob[cb[Xa].obj.name]=0),ob[cb[Xa].obj.name]++);K(ob);pa=Va;pa.sort(Rf)}this.script=pa};var Wf=function(){for(var a=0,b=tb.arr,e=b.length;a<e;b[a++].maintenance());
ya({func:Wf},tb.time,1);tb.process++};tb.prototype.maintenance=function(){var a=this.script,b=J[this.kingdom],e=b.technology,c=e.actived,d=e.hidden,h=eb[b.k];e=y;var l={};if(b.values.pop+b.unitLoading>b.values.popMax&&b.values.popMax<=b.values.popLimit){for(var t=ab[b.race].house.nu,p=1,g=0,k=qd.length;g<k;g++)p+=h[qd[g].type].length*qd[g].population;p+b.unitLoading>b.values.popMax&&p<=b.values.popLimit&&cc({order:t,priority:1,obj:t.obj},b)}g=0;for(k=a.length;g<k;g++)(t=a[g])&&!l[t.order.id]&&1===
Tf(t,c,d,h,b).length&&(cc(t,b)?a[g]=0:l[t.order.id]=1);a=!1;l=Infinity;var q=b.diplomacy;d=b.origin[0];h=b.origin[1];c=eb[b.k];g=1;for(k=J.length-1;g<k;g++)if(q[g]&&!J[g].death){t=J[g];p=t.origin[0]-d;var r=t.origin[1]-h;b=p*p+r*r;b<l&&(l=b,a=t)}if(a){b=[];g=p=0;for(k=c.length;g<k;g++)for(r=c[g],l=0,q=r.length;l<q;l++)t=B[r[l]],t.func==Rd.url&&(b[p++]=t.id);if(60<b.length){c=a.origin[0];q=a.origin[1];t=[40,0,-40,0,0,40,0,-40];l=Infinity;g=0;for(k=t.length;g<k;g+=2)if(p=t[g],r=t[g+1],p+=d+10*Math.sign(p),
r+=h+10*Math.sign(r),(p-c)*(p-c)+(q-r)*(q-r)<l&&oa(p,r)){l=(p-c)*(p-c)+(q-r)*(q-r);var U=p+r*e}k=U%e;d=~~(U/e);h=-1;p=Infinity;c=eb[a.k];g=0;for(length=c.length;g<length;g++)for(a=c[g],l=0,r=a.length;l<r;l++)t=B[a[l]],t.build&&t.built&&(q=(t.x32-k)*(t.x32-k)+(t.y32-d)*(t.y32-d),q<p&&(p=q,h=t.x32+t.y32*e));-1<h&&ea(Bh,[U,h],b)}}};var Bh=function(a,b){var f=y,c=a[0];a=a[1];var d=a%f;f=~~(a/f);i=0;for(length=b.length;i<length;i++){var h=B[b[i]];6400<(h.x32-d)*(h.x32-d)+(h.y32-f)*(h.y32-f)?ma(-c,h,rd,
h.url.move):ma(-a,h,rd,h.url.move)}ya({func:Ch,data:{list:b,xy:-a}},3E4,1)},Ch=function(a){var b=a.list;a=a.xy;for(var f=0,c=b.length;f<c;f++){var d=B[b[f]];d.death||ma(a,d,rd,d.url.move)}},Xj=function(a,b,e,c){var f=y,h;for(h=2;60>=h;h+=2){a--;b--;for(var l=0;l<=h;){var t=Y[a+l+f*b];if(2<t&&t!=c&&B[t].type==e)return t;t=Y[a+l+f*(b+h)];if(2<t&&t!=c&&B[t].type==e)return t;l++}for(l=0;l<h-1;){l++;t=Y[a+f*(b+l)];if(2<t&&t!=c&&B[t].type==e)return t;t=Y[a+h+f*(b+l)];if(2<t&&t!=c&&B[t].type==e)return t}}return!1},
Rd=function(a){a=B[a];performance.now();var b=Xf(a.id);if(b)return qc(b,[a.id],1);mb(a,1E3)},Xf=function(a){a=B[a];if(!a.freezed&&!a.invisible){for(var b=a.x32,f=a.y32,c=J[a.kingdom].diplomacy,d=a.sight,h=y,l=2*d+1,t,p=!!a.confused,g=Infinity,k=!1,q=0,r=l*l;q<r;q++){var U=q%l-d,u=~~(q/l)-d,v=Math.sqrt(U*U+u*u);if(~~v<=d){U+=b;u+=f;for(var O=0;3>O;O++){t=Ua[O][U+h*u];var x=B[t];if((x&&x.kingdom&&c[x.kingdom]||p)&&!(x.death||x.invisible||a.attackOnly&&!a.attackOnly[x.type]||t==a.id||x.item)){var w=
Sc[a.type][x.type];w||(w=0);x=v*v+.05*x.health-(w+1)*a.attack;x<g&&(k=t,g=x)}}}}return k}},Yj=function(a){a.setupINTV(Dh,a.id,1E3)},Dh=function(a){a=B[a];var b=a.free;b||(b=Eh);var f=y,c=a.x32,d=a.y32,h=[];h.length=J.length;for(var l=h.length,t=0;t<l;h[t++]=0);t=0;for(var g=b.length;t<g;t+=2){var k=b[t]+c,n=b[t+1]+d;oa(k,n)&&(k=B[Y[k+n*f]],k.nocapture||k.build||h[k.kingdom]++)}f=b=0;for(t=1;t<l;t++)h[t]>b&&(f=t,b=h[t]);b&&a.kingdom!=f&&a.changeKingdom(f);mb(a,1E3)},fe,Zj=[1,1],Fh=function(){return 25*
(Date.now()-u.loadDate+u.pausedTime+u.deltaTime)/dc.speed},nb=function(a){if(!(a&&u.online||nb.bySystem&&a))if(0===u.paused){u.paused=1;void 0!=fe&&clearInterval(fe);var b=u.now();u.pausedTime+=Date.now();a?lc("",z.paused,1):nb.bySystem=1;u.now=function(){return b}}else u.pausedTime-=Date.now(),u.paused=0,nb.bySystem=0,a&&(document.getElementById("alert").style.display="none"),fe=setInterval(dc,dc.speed),u.now=Fh};nb.bySystem=0;var xb=function(a,b){var f=!1;if(1>a){a*=-1;var c=~~(a/qa),d=a%qa}else f=
a;a=0;for(var h=b.length;a<h;a++){var l=B[b[a]];l.build||l.cow&&l.workers.length||f==l.id||(l.action=null,l.distance=0,l.mv&&null!=l.xf?f?(l.xf=f,l.yf=!0):(l.xf=d,l.yf=c):l.x32==d&&l.y32==c?l.stay():(l.dix=(d-l.x32)/Math.abs(d-l.x32),l.diy=(c-l.y32)/Math.abs(c-l.y32),f?(l.xf=f,l.yf=!0):(l.xf=d,l.yf=c),l.mv=!0,l.setupINTV(ge,l.id,0),Yf(l),l.action=null))}},Yf=function(a){a.stock&&0!==a.stock[0]?(a.mimg=a.url[a.stock[4].url],a.stock[3]===rc&&(a.mimg=a.url.milk)):a.mimg=a.url.move};xb.cursor=7;xb.allowPos=
1;var mb=function(a,b,e){b=~~(b/25)+u.cycle;e=sc[b];e||(e=[],sc[b]=e);var f=e.length;a.c=b;e[f]=a.id;a.timestamp=u.now()},sc={},he=function(a){var b=B[a[0]];if(!b.death){var f=a[1],c=a[2],d=a[3];b.cow&&"milk"==f&&b.workers&&b.workers.length||(b[f]+=J[b.kingdom].values[c],c=b[f+"Max"],b[f]>c&&2!==b.blocked&&(b[f]=c));"mana"==f&&(c=b.manaTask)&&c[2]<=b[f]&&(K(c),ma(c[1],b,tc[c[0]],b.url.move),b.manaTask=void 0,b.blockedAction(1));Z(b.id,1);ya({func:he,data:a},d,1)}},ya=function(a,b,e){a.func.url||K(a.func);
a.func=a.func.url;e&&(b=~~(b/25)+u.cycle);e=uc[b];e||(e=[],uc[b]=e);e.put(a)},uc={},ge=function(a){a=B[a];var b=y,f=!1;5===a.distance&&(a.distance=-1);a.waiting&&Yf(a);var c=a.y32,d=a.x32,h=tc[a.action];ObjectsetupPosition(a,32*c);var l=Ua[a.zLevel],t=d+c*b;if(a.id===l[t]){var g=a.size;if(2>g)l[t]=a.radix;else for(var k=g*g,n=-b,q=0;q<k;q++){var r=q%g;0===r&&(n+=b);l[t+r+n]=0}}if(a.stop)return l[t]=a.id,a.stay(),a.stop=void 0,0;if(a.kx||a.ky){var u=a.kx||0,v=a.ky||0;k=!1;if(0!==l[u+d+(v+c)*b])return a.aspettare()}else{h&&
h.rev&&(k=h.rev(a))&&(a.action=k[0],h=tc[a.action],a.xf=k[1],a.yf=!0);if(!0===a.yf){k=a.xf;var x=B[k];if(!x||x.death&&(!h||!h.available))return l[t]=a.id,a.stay();q=!0;n=!1;if(h&&h.available){if(n=h.available(a,x),q=n[2],!1===n)return a.aspettare()}else x.death||(n=Jb(x,a,50,a.radix));a.xf!==k&&(x=B[a.xf]);if(!x||x.death||x.in)return l[t]=a.id,a.stay();if(!q&&(O+w*b===t||h))return a.aspettare();var O=n[0],w=n[1];if(h&&h.distance){var A=h.distance;A=0>A?a.attDist:J[a.kingdom].values[A];n=Zf(x,d,c);
sd(d,c,n%y,~~(n/y),A)&&(f=2)}a==x&&(f=2)}else{O=a.xf;w=a.yf;k=l[O+w*b];if(2<k&&(!h||h&&h.rev)){k=B[k];n=Jb(k,a,50,a.radix);if(!1===n)return l[t]=a.id,a.stay();O=n[0];w=n[1]}h&&h.distance&&(A=h.distance,A=0>A?a.attDist:J[a.kingdom].values[A],sd(d,c,O,w,A)&&(f=2))}k=O+w*b;if(!f){performance.now();a:{u=d;v=c;n=O;q=w;r=a.radix;var N=y,z=u+v*N,E=z,D=n+q*N,C;performance.now();var I=z+bb[~~(8*vc(z%N-n,~~(z/N)-q)+.5)%8];for(C=0;24>C;C++){var F=~~(8*vc(z%N-n,~~(z/N)-q)+.5)%8;if(z===D)break;var K=l[z+bb[F]];
if(K===r||1>=Math.abs(B[K].d-(F+2)%8)&&null!=B[K].xf)z+=bb[F];else if(l[z+bb[F+1]]===r)z+=bb[F+1];else if(K=F-1,-1===K&&(K=7),l[z+bb[K]]===r)z+=bb[K];else{z+=bb[F];break}$f&&ie(z%N,~~(z/N),"stone")}if(l[z]>r){F=[z];K=1;var ub=0,M={};M[z]=2;for(var G,T=Infinity,P=0;void 0!==(G=F[ub++]);){$f&&ie(G%N,~~(G/N),"food");C=G%N-n;var L=~~(G/N)-q;C=C*C+L*L;C<T&&(T=C,P=G);for(C=0;4>C;C++)if(z=G+Gh[C],!M[z]&&l[z]!==r)for(D=0;8>D;D++)if(l[z+bb[D]]===r){F[K++]=z;M[z]=2;break}}G=P;T=Infinity;for(D=0;8>D;D++)z=G+
bb[D],l[z]===r&&(C=z%N-n,L=~~(z/N)-q,C=C*C+L*L,C<T&&(P=z,T=C));ub=0;K=1;F.length=0;F[0]=P;for(M[P]=1;void 0!==(G=F[ub++]);){$f&&ie(G%N,~~(G/N),"gold");z=G+bb[~~(8*vc(G%N-u,~~(G/N)-v)+.5)%8];if(l[z]===r&&!M[z]){if(z==E){u=G;break a}F[K++]=z;M[z]=1}for(C=0;8>C;C++)if(z=G+bb[C],!M[z]&&l[z]===r)for(D=0;8>D;D++)if(2===M[z+bb[D]]){F[K++]=z;M[z]=1;break}}}u=I}v=~~((8*vc(-(u%b)+d,-~~(u/b)+c)+.5)%8);u=Hh[2*v];v=Hh[2*v+1];if(l[d+u+(c+v)*b]!==a.radix||!oa(d+u,c+v)){u=[d+1,c,d-1,c,d+1,c+1,d+1,c-1,d,c-1,d-1,c+
1,d,c+1,d-1,c-1];v=O;n=w;q=y;r=Infinity;for(N=0;N<u.length;N+=2)if(0===l[u[N]+u[N+1]*q]&&oa(u[N],u[N+1])&&r>=(u[N]-v)*(u[N]-v)+(u[N+1]-n)*(u[N+1]-n)){r=(u[N]-v)*(u[N]-v)+(u[N+1]-n)*(u[N+1]-n);var Y=N}n=[u[Y],u[Y+1]];u=n[0]-d;v=n[1]-c;u=0<u?1:0>u?-1:0;v=0<v?1:0>v?-1:0;if(l[d+u+(c+v)*b]!==a.radix){l[t]=a.id;a.stay();return}}}}if(t==k||f)if(l[d+c*b]=a.id,a.x32=d,a.y32=c,h){if(h.distance&&2!==f)return a.aspettare();a.stay(1);x||(x=O+w*b);a.action=void 0;h(x,a,A)}else a.stay();else{if(0===u&&0===v)return a.aspettare();
a.setupDir(u,v);f=a.spd;ObjectsetupIMG(a,a.mimg,-1,a.spd/a.__proto__.spd);a.dix=u*f;a.diy=v*f;c+=v;d+=u;a.x32=d;a.y32=c;a.distance++;mb(a,~~(32E3/f));ObjectsetupPhysics(a,u*f,v*f,0);t=d+c*b;if(2>g)l[t]=a.id;else for(k=g*g,n=-b,q=0;q<k;q++)r=q%g,0===r&&(n+=b),l[t+r+n]=a.id}},dc=function(){var a=u.cycle;u.now();if(u.demo){var b=u.record[a];if(b)for(var e=0;e<b.length;e+=3)je[b[e]](b[e+1],b[e+2])}if(b=uc[a]){for(e=0;e<b.length;e++){var c=b[e];tc[c.func](c.data)}delete uc[a]}if(b=sc[a]){for(e=0;e<b.length;e++)c=
B[b[e]],c.c===a&&(c.death&&K(c.func),c.c=void 0,tc[c.func](c.funcObj));delete sc[a]}u.cycle++;if(u.online&&0===u.cycle%8)var d=ag();!d&&!u.automatic&&u.now()-(u.cycle-1)*dc.speed>=dc.speed&&dc()};dc.speed=25;var bb,Gh,ie=function(a,b,e){e=Object.assign({},Kb[e]);e.x32=a;e.y32=b;e.z32=2;Sa(e);yb.new(e,500)},$f,Hh=[1,0,1,-1,0,-1,-1,-1,-1,0,-1,1,0,1,1,1],vc=function(a,b){a=.5-Math.atan2(b,a)/(2*Math.PI);1==a&&(a=0);return a},wb=function(a,b,e,c){return[a,b,e,c,a,b,e,c,a,b,e,c,a,b,e,c]},ke=new Float32Array(wb(1,
0,0,.75)),ak=new Float32Array(wb(1,1,1,.5)),Ih=new Float32Array(wb(0,1,0,.75)),bk=new Float32Array(wb(0,1,0,.9)),ck=new Float32Array(wb(.3515625,.29296875,.21875,.9)),Jh=new Float32Array(wb(0,1,1,.9)),bg=new Float32Array(wb(1,1,1,.5)),Kh=new Float32Array(wb(.3,.3,.3,.9)),Lh=new Float32Array(wb(.7,.2,.2,.9));Jh.noAlpha=1;Kh.noAlpha=1;Lh.noAlpha=1;var S=function(a){ea(ee,[a,4*cb.shift+1,ob],F[0])},ee=function(a,b){var f=a[0],c=a[1],d=a[2];a=x[f];b=B[b];var h=b.icons.indexOf(a.nu);if(!(0>h)){performance.now();
if(0==d)for(d=0;d<c;d++){var l=J[b.kingdom],t=l.mod[f].cost||a.cost;if(l.paypal(t))return!1;b.waitlist||(b.waitlist=[]);b.waitlist.push(f,-h-1);b.work||(b.work={});b.work[h]||(b.work[h]=0);b.work[h]++;b.working=1;l.unitLoading++;2==b.waitlist.length&&(t=1E3*a.time,b.setupINTV(td,b.id,t))}else{if(!b.work)return;var g=b.waitlist;l=J[b.kingdom];for(d=0;d<c;d++){t=l.mod[f].cost||a.cost;l.setupResources(t,-1);t=g.lastIndexOf(f);if(0>t)break;g.splice(t,2);K(b.work[h]);b.work[h]--;if(0==g.length){b.c=-1;
b.working=0;break}l.unitLoading--;0===t&&(t=1E3*x[g[0]].time,b.setupINTV(td,b.id,t))}}Z(b.id)}},Mh=0,td=function(a){a=B[a];var b=a.kingdom;b=J[b];var f=b.values.pop>=b.values.popMax?z.houseLimit:z.popLimit;if(b.values.pop>=b.values.popMax||b.values.pop>=b.values.popLimit)return document.getElementById("msgs1").getElementsByTagName("li"),3E4<Date.now()-Mh&&b.k==A.kingdom&&zb(f,0,5),Mh=Date.now(),b.onFreePop.put(a.id);b.unitLoading--;b=a.waitlist[0];f=x[b];a.work[-a.waitlist[1]-1]--;a.waitlist.splice(0,
2);0<a.waitlist.length?a.setupINTV(td,a.id,1E3*f.time):a.working=0;wc(b,a);Z(a.id)},ua=function(){if(0==ob){var a=B[F[0]];ea(cg,[a.mlistID[pb.nu],!0],a.id)}},Na=function(){if(0==ob){var a=B[F[0]];ea(cg,[a.hlistID[pb.nu],!1],a.id)}},Nh=function(a,b,e){var f=1.6,d=0;1===b&&(e=0,f=3.6,d=620);return[d+~~(f*a[0]*b+.5)+120*e,~~(f*a[1]*b+.5),~~(f*a[2]*b+.5),~~(f*a[3]*b+.5)]},cg=function(a,b){var f=a[0];a=a[1];b=B[b];var c=J[b.kingdom];if(c.values.pop>=c.values.popMax)return zb(z.popLimit,0,5);if(a)var d=
c.values.fameTech;c=4;var h=9*a;h||(h=1);if(a)var l=b.mlist,t=b.mlistID;else l=b.hlist,t=b.hlistID;var g=t.indexOf(f);if(!(0>g)){f=l[g].unit;l.splice(g,1);t.splice(g,1);t=Nh(x[f].cost,h,d);if(J[b.kingdom].paypal(t))return 0;H.active==l&&ha(l);for(t=0;t<h;t++)g=wc(f,b),d?g.level=c:a||(c=16,g.level=c,l=Oh[g.race],g.name=l[g.id%l.length],Ph(g))}},wc=function(a,b,e,c){var f=y,h=b.kingdom;b.rnd||dg(b);var l=-1,t=-1;if(b.point&&!b.disallowPoint){var g=b.point[0],k=b.point[1];l=Qh(b,g,k,x[a].radix,x[a].rbase())[0]}else l=
Qh(b,l,t,x[a].radix,x[a].rbase())[1],l=l[Rh(b,l.length)];t=~~(l/f);a=new ec(a,h,l%f,t,0,!1,c);ud(h);e||xa("unitdone",0,0,a.kingdom);if(b.point&&(b=eg(g,k,a),e=b[1],b[0]))b[0](e,[a.id]);return a},le=0,me=0,Ib,hb,md,G=function(a){L=function(){};a=x[a];Ib=!1;var b=fa;ObjectsetupIMG(b,a.img);b.active=!0;hb=a;md=!1;document.addEventListener("mousemove",Mf);document.addEventListener("mousedown",Wd)},Wd=function(a){var b=hb.validator,f=hb.space,c=ta[hb.img];if(0==a.button&&151<a.pageX){c=Lb(a.pageX-A.mx-
.5*c[8]/da,a.pageY-.5*c[9]/da);var d=~~(.03125*c[1]);c=~~(.03125*c[0]);b(c,d,f,A.kingdom)[1]&&(Ib=!0,fa.active=!0,fa.x=-9999,fa.y=-9999,L=151<a.pageX?0:jb,document.removeEventListener("mousedown",Wd),ea(Tc,[c+y*d,hb.type,md],F),cb.shift&&(md?ph(md):G(hb.type)));L=function(){}}else fa.active=!0,fa.x=-9999,fa.y=-9999,Ib=!0,L=151<a.pageX?0:jb,document.removeEventListener("mousedown",Wd)},Mf=function(a){var b=hb.validator,f=hb.space,c=ta[hb.img];if(Ib)document.removeEventListener("mousemove",Mf);else{var d=
a.pageX,h=a.pageY;if(d!=le||h!=me)fa.active=!0,le=d,me=h,d=Lb(a.pageX-A.mx-.5*c[8]/da,a.pageY-.5*c[9]/da),h=~~(.03125*d[1]),d=~~(.03125*d[0]),a=32*d,c=32*h,(b=!b(d,h,f,Va.k)[1])?b!=fc&&(fc=b,g.bindBuffer(g.ARRAY_BUFFER,Ya),g.bufferSubData(g.ARRAY_BUFFER,16*fa.bufferID,ke)):b!=fc&&(fc=b,g.bindBuffer(g.ARRAY_BUFFER,Ya),g.bufferSubData(g.ARRAY_BUFFER,16*fa.bufferID,Ih)),fa.x=a,fa.y=c}},Tc=function(a,b){var f=a[0],c=f%qa,d=~~(f/qa),h=u.editor?1:B[b[0]].kingdom;f=a[1];var l=x[f].cost,t=J[h];if(!u.editor&&
t.paypal(l))return!1;a=new ec(f,h,c,d,0,!u.editor,a[2]);if(!0===a.invalid||u.editor)return!1;a.waitlist=[];if(20===f)a.built=1,c=B[b[0]],ma(a.id,c,xc,c.url.move),L=function(){L=jb};else for(a.health=1,ObjectsetupIMG(a,a.bimg),a=a.id,f=0,d=b.length;f<d;f++)c=B[b[f]],c.buildList?(c.buildList.put(a),c.func!==fg&&(h=ne(c.buildList,c.x32,c.y32))&&ma(h,c,yc,c.url.move)):(c.buildList=[a],ma(a,c,yc,c.url.move))},fc=null,hg=function(a){L=function(){};a=x[a];Ib=!1;var b=fa;hb=a;ObjectsetupIMG(b,a.img);document.addEventListener("mousemove",
Sh);document.addEventListener("mousedown",gg)},gg=function(a){var b=y,f=ta[hb.img];if(0==a.button&&151<a.pageX){a=Lb(a.pageX-A.mx-.5*f[8]/da,a.pageY-.5*f[9]/da);var c=~~(.03125*a[1]);a=~~(.03125*a[0]);g.bindBuffer(g.ARRAY_BUFFER,Ya);g.bufferSubData(g.ARRAY_BUFFER,0,ck);var d=ia[2];ia[2]=32;ia[5]=32;ia[8]=32;ia[11]=32;fa.wall=a+c*b;var h=a;document.addEventListener("mouseup",function p(a){sb.forced=!1;a=za[3*A.kingdom];var f=za[3*A.kingdom+1],e=za[3*A.kingdom+2];v[0]=a;v[1]=f;v[2]=e;v[3]=.5;v[4]=a;
v[5]=f;v[6]=e;v[7]=.5;v[8]=a;v[9]=f;v[10]=e;v[11]=.5;v[12]=a;v[13]=f;v[14]=e;v[15]=.5;g.bindBuffer(g.ARRAY_BUFFER,Ya);g.bufferSubData(g.ARRAY_BUFFER,0,v);ia[2]=d;ia[5]=d;ia[8]=d;ia[11]=d;var t=~~(ia[9]/32),k=~~(ia[10]/32);f=Math.abs(h-t);e=Math.abs(c-k);f&&--f;e&&--e;a=1;t=t<h?t:h;var u=k<c?k:c;k=[t+u*b];for(var y=0;y<f;y++)k[a++]=t+y+u*b+1,k[a++]=t+y+(u+e)*b;for(y=0;y<e;y++)k[a++]=t+(u+y)*b,k[a++]=t+(u+y+1)*b+f;for(y=1;y<a;y++)f=k[y],Ib=!0,L=function(){L=jb},gc(2),ea(Tc,[f,hb.type],F);fa.active=
!0;fa.x=-9999;fa.y=-9999;cb.shift&&hg(hb.type);document.removeEventListener("mouseup",p)});document.removeEventListener("mousedown",gg);Ib=!0}else fa.active=!0,fa.x=-9999,fa.y=-9999,Ib=!0,L=151<a.pageX?0:jb,document.removeEventListener("mousedown",gg)},Sh=function(a){var b=y,f=ta[hb.img];if(Ib)document.removeEventListener("mousemove",Sh);else{var c=a.pageX,d=a.pageY;if(c!=le||d!=me){var h=!0;le=c;me=d;fa.active=!0;a=Lb(a.pageX-A.mx-.5*f[8]/da,a.pageY-.5*f[9]/da);f=~~(a[1]/32);a=~~(a[0]/32);c=32*a;
d=32*f;0==Y[a+f*b]&&(h=!1);h?h!=fc&&(fc=h,g.bindBuffer(g.ARRAY_BUFFER,Ya),g.bufferSubData(g.ARRAY_BUFFER,16*fa.bufferID,ke)):h!=fc&&(fc=h,g.bindBuffer(g.ARRAY_BUFFER,Ya),g.bufferSubData(g.ARRAY_BUFFER,16*fa.bufferID,Ih));fa.x=c;fa.y=d}}},ig=function(a,b){a=0;for(var f=b.length;a<f;a++){var c=B[b[a]];c.xf?c.stop=1:c.stay()}},oe=function(a,b){a=B[b[0]];a.techStart=0;a.c=void 0;if(b=a.techID){var f=J[a.kingdom].technology.hidden;-1<b&&(f[b]=0);J[a.kingdom].setupResources(E[a.activeTech].cost,-1)}else J[a.kingdom].setupResources(a.lcost,
-1)},I=function(a){var b=B[F[0]];if(J[b.kingdom].paypal(E[a].cost))return!1;ea(Vf,[a,pb.lastFunc.id],b.id)},Vf=function(a,b){var f=a[0];a=a[1];var c=E[f],d=B[b];c.upgrade&&(a=-1);d.activeTech=f;d.techID=a;d.setupINTV(c.type,[f,a,b],1E3*c.time);d.techStart=d.c-u.cycle;f=J[B[b].kingdom].technology.hidden;-1<a&&(f[a]=1);Z(b)},R=function(a){var b=a[1],f=B[a[2]];a=E[a[0]];Wb(f,a,b)},vd=function(a){var b=a[1],f=B[a[2]];a=E[a[0]];var c=x[a.obj],d=J[f.kingdom].mod[c.type];Th(f);f.img=c.img;f.attack=d.attack||
c.attack;f.health=f.health/f.maxHealth*c.health;f.maxHealth=c.health;f.__proto__=c;Sa(f);Wb(f,a,b)},pe=function(a){var b=a[1],f=B[a[2]];a=E[a[0]];if(a.actvintv)for(var c=a.actvintv,d=0,h=c.length;d<h;d++){var l=c[d];J[f.kingdom].technology.disabled[l.id]=0;for(var t=l.builds,g=eb[f.kingdom],k=0,n=t.length;k<n;k++)for(var q=g[t[k]],r=0,u=q.length;r<u;r++)l(B[q[r]])}Wb(f,a,b)},Oa=function(a,b){var f=a[1];b=B[a[2]];a=E[a[0]];J[b.kingdom].values[a.value]+=a.increase;"popMax"==a.value&&ud(b.kingdom);Wb(b,
a,f)},Uh=function(a,b){var f=a[1];b=B[a[2]];a=E[a[0]];for(var c=a.group,d=J[b.kingdom].mod,h=0,l=c.length;h<l;h++)for(var t=d[c[h].type],g=0,k=a.values,n=k.length;g<n;g+=2){var q=k[g],r=k[g+1];t[q]||(t[q]=c[h][q]||0);t[q]+=r}Wb(b,a,f)},kb=function(a,b){var f=a[1];b=B[a[2]];a=E[a[0]];for(var c=a.group,d=J[b.kingdom].mod,h=0,l=c.length;h<l;h++){var t=d[c[h].type];t[a.value]||(t[a.value]=c[h][a.value]||0);t[a.value]+=a.increase}Wb(b,a,f)},qe=function(a,b){var f=a[1];b=B[a[2]];a=E[a[0]];for(var c=J[b.kingdom].mod,
d=a.mulp,h=0,l=a.group.length;h<l;h++){var t=a.group[h],g=c[t.type].cost||t.cost;c[t.type].cost=d?[~~(g[0]*d),~~(g[1]*d),~~(g[2]*d),~~(g[3]*d)]:[g[0]-a.decrease[0],g[1]-a.decrease[1],g[2]-a.decrease[2],g[3]-a.decrease[3]]}Wb(b,a,f)},jg=function(a,b){var f=a[1];b=B[a[2]];a=E[a[0]];for(var c=J[b.kingdom].mod,d=0,h=a.decrease,l=h.length;d<l;d+=2){var t=h[d],g=h[d+1],k=c[t.type].cost||t.cost;c[t.type].cost=[k[0]-g[0],k[1]-g[1],k[2]-g[2],k[3]-g[3]]}Wb(b,a,f)},Wb=function(a,b,e){a.techStart=void 0;a.activeTech=
void 0;a.techID=void 0;a.func=void 0;var f=J[a.kingdom].technology,d=f.disabled;f.investigated[e]=1;xa("techdone",0,0,a.kingdom);if(b=b.next){e=!1;f=0;for(var h=b.length;f<h;f++){var l=b[f].id;d[l]--;ha.actv[l]&&(e=!0)}e&&ha(H.active)}Z(a.id)},dk=[[12,62,63,18],[12,62,63,15],[12,62,63,23],[12,62,63,18]],ek={icon:"food",img:"item_meat",url:"meat"},fk={icon:"milk",img:"milk",url:"milk"},gk={icon:"gold",img:"item_gold",url:"gold"},hk={icon:"stone",img:"item_stone",url:"stone"},Vh={icon:"wood",img:"item_tree",
url:"tree"},ik={icon:"food",img:"item_food",url:"food"},wd=function(a,b,e,c){a=eb[a];var f=dk[b];b=[];b.length=f.length;for(var h=0,l=f.length;h<l;b[h]=a[f[h++]]);a=Infinity;f=-1;for(h=0;h<b.length;h++){l=b[h];for(var g=l.length,k=0;k<g;k++){var m=B[l[k]],n=m.x32,q=m.y32,r=m.space;m=r[r.length-1];r=(r.length-1)/m;m*=.5;r*=.5;n+=m;q+=r;m=.5*(m+r);n=Math.sqrt((n-e)*(n-e)+(q-c)*(q-c))-m;a>=n&&(a=n,f=l[k])}}return f},ka,jk=function(a){if("string"==typeof a){for(var b=1,f=0,c=a.length;f<c;f++)b+=b*(a.charCodeAt(f)/
65535)*(f+1);a=b+c}var d=4294967295-a,h=4294967295+a;f=0;ka=function(){h+=f;d-=f++;h=36969*(h&65535)+(h>>16)&4294967295;d=18E3*(d&65535)+(d>>16)&4294967295;return((h<<16)+d&4294967295)/4294967295+.5}},Rh=function(a,b){a=a.rnd;var f=a[0],c=a[1],d=a[2];f+=d;c-=d;f=36969*(f&65535)+(f>>16)&4294967295;c=18E3*(c&65535)+(c>>16)&4294967295;a[0]=f;a[1]=c;a[2]++;return~~((((f<<16)+c&4294967295)/4294967295+.5)*b)},gc=function(a){a!=kk&&(document.body.className="ncursor"+a)},kk=-1,Uc=function(a,b){for(var f=
0,c=b.length;f<c;f++){var d=B[b[f]];ma(a,d,xd,d.url.move)}};Uc.spLevel=function(a){var b=0;2<pa[a]&&(b=pa[a]);return b};var xd=function(a,b){b.stay55();if(b.inventory&&b.invMax===b.inventory.length||!a.item)return 1;pa[a.x32+a.y32*y]=a.radix;ObjectindexHide(a);if(b.peon&&a.contain){var f=a.contain[1],c=a.contain[0];b.stock&&Wh(b);var d=y;var h=Infinity;for(var l=!1,g=0;121>g;g++){var k=g%11-5;var m=~~(g/11)-5,n=k*k+m*m;k+=b.x32;m+=b.y32;n<h&&(k=pa[k+d*m],0<k&&(k=B[k],k.contain&&(h=n,l=k.id)))}h=l;
d=a.contain[2];a.die(1);b.stock=[c,f,h,xd,d];a=wd(b.kingdom,f,b.x32,b.y32);ma(a,b,Xb,b.url[d.url]);Z(b.id);return 1}b.addItem(a);Z(b.id)},Wh=function(a){var b=Xh(a.x32,a.y32),f=~~(b/y);b%=y;b=new ec(52,a.kingdom,b,f,0);ObjectsetupIMG(b,k[a.stock[4].img]);b.contain=[a.stock[0],2,a.stock[4]]},Yh=function(a,b){a=0;for(var f=b.length;a<f;a++){var c=B[b[a]];c.xf?c.stop=2:(c.stop=2,c.stay(),c.stop=void 0)}},Vc=function(a,b){var f=y;a=B[a];for(var c=0,d=b.length;c<d;c++){var h=B[b[c]],l=Ua[h.zLevel],g=h.x32+
h.y32*f;if(0!==l[g]||!a.build){g=a.build?kg(h,h.x32,h.y32):kg(h,a.x32,a.y32);if(!1===g)continue;h.x32=g%y;h.y32=~~(g/y)}h.item&&(a.attack-=h.attack||0,a.defence-=h.defence||0);h.url.idle&&ObjectsetupIMG(h,h.url.idle,1);l[g]=h.id;h.in=0;a.inventory.quit(h.id);ObjectindexShow(h)}Z(a.id,1)},yd=function(a,b){a=B[a];if(1===a.invType)for(var f=0,c=b.length;f<c;f++){var d=B[b[f]];d!=a&&ma(a.id,d,lg,d.url.move)}},lg=function(a,b){var f=a.inventory;if(f.length<a.invMax){var c=b.x32,d=b.y32;b.rbase()[c+d*y]=
b.radix;f.put(b.id);ObjectindexHide(b);b.in=a.id;zd(b.id);Z(a.id)}else b.stay55()},Wc=function(a,b){for(var f=b.length,c=0;c<f;c++){var d=B[b[c]];d.buildList=!1;ma(a,d,yc,d.url.move)}},yc=function(a,b){if(a.dummy&&a.dummy.built)return b.stay55();if(a.health<a.maxHealth)b.dix=0,b.diy=0,b.mv=!0,b.setupDirBuild(a),ObjectsetupIMG(b,b.url.build,1),b.setupINTV(fg,{u:a.id,a:b.id},Ta(b.img)),od(b,"hit%20",7,b.img);else{if(b.buildList&&(a=ne(b.buildList,b.x32,b.y32)))return ma(a,b,yc,b.url.move),0;b.stay55()}},
fg=function(a){var b=B[a.u];a=B[a.a];var f=a.x32,c=a.y32,d=b.x32+b.y32*y;if(b.death)return a.stay();var h=b.maxHealth,l=h/b.time*J[a.kingdom].values.buildSpeed;if(1===b.health){for(var g=b.onbuild1,p=b.id,m=b.getRadix(),n=0,q=g.length;n<q;n++)if(2<m[g[n]]){mb(a,Ta(a.img));return}var r=qb[b.kingdom];n=0;for(q=g.length;n<q;n++)m[g[n]]=p,r[g[n]]=void 0;hc(b)}b.health+=l;p=b.health;0==b.built&&1>(p-1)/l%(h/l/4)&&(b.d++,ObjectsetupIMG(b,b.img));if(p>=h){p=b.health=h;Z(b.id);if(!b.built){b.d=0;l=b.url;
r=qb[b.kingdom];1343===b.type&&(r[d+1]&&13==B[r[d+1]].type&&r[d-1]&&13==B[r[d-1]].type?(l=k.wood_horz,b.child=void 0):r[d+y]&&13==B[r[d+y]].type&&r[d-y]&&13==B[r[d-y]].type&&(l=k.wood_vert,b.child=void 0));b.built=1;b.img=l;Sa(b);if(g=b.onbuildValid)for(m=b.validator.dimension,n=0,q=g.length;n<q;m[g[n++]]=0);Zh(b);xa("bldgdone",0,0,b.kingdom);Z(b.id)}b.action=void 0;(d=a.buildList)&&d.quit(b.id);if(!d||a.buildList&&0===a.buildList.length)a.buildList=$h(a),d=a.buildList;if(f=ne(d,f,c))return ma(f,
a,yc,a.url.move),0;a.buildList.length=0;a.stay();a.stock&&a.stock[0]&&ObjectsetupIMG(a,a.url[a.stock[4].url])}else Z(b.id),mb(a,Ta(a.img));F[0]==b&&(ic.innerHTML=p+"/"+h,Ka.value=p)},re=function(a,b){if(2<a)for(var f=0,c=b.length;f<c;f++){var d=B[b[f]];ma(a,d,xc,d.url.move)}},Bd=function(a,b){var f=a;a=B[a];if(a.field)for(c=0,a=b.length;c<a;c++)d=B[b[c]],ma(f,d,xc,d.url.move);else if(0===a.res||3===a.res){var c=0;for(a=b.length;c<a;c++){var d=B[b[c]];ma(f,d,Ad,d.url.move)}}else if(1===a.res)for(c=
0,a=b.length;c<a;c++)d=B[b[c]],ma(f,d,zc,d.url.move);else if(2===a.res)for(c=0,a=b.length;c<a;c++)d=B[b[c]],ma(f,d,rc,d.url.move)},qc=function(a,b,e){e=e?Cd:Xc;if(!(3>a||(a=B[a],void 0!=a.res||a.magicGateway)))for(var f=0,d=b.length;f<d;f++){var h=B[b[f]];h==a||h.attackOnly&&!h.attackOnly[a.type]||h.bat&&a.build||a.stoned||(h.build?Xc(a,h):ma(a.id,h,e,h.url.move))}},zc=function(a,b){if(0<a.health){var f=b.x32,c=b.y32;b.mv=!0;b.setupDir(a.x32-f,a.y32-c);ObjectsetupIMG(b,b.url.cut,1);b.dix=0;b.diy=
0;od(b,"chop%20",11,b.img);b.setupINTV(ai,{u:a.id,a:b.id},7E3);a.addWorker(b)}else b.stay55()},ai=function(a){var b=y,f=B[a.u];a=B[a.a];var c=J[a.kingdom].values.wood;f.workers.quit(a.id);var d=wd(a.kingdom,1,a.x32,a.y32);f.health-=c;a.mv=!1;Z(f.id);if(1>f.health){c+=f.health;Y[f.x32+f.y32*b]=0;b=B[d];b=Aa(b.x32,b.y32);for(var h=f.health=0,l=f.workers.slice(0),g=l.length;h<g;h++){var k=B[l[h]];K(k);b?ma(b,k,zc,a.url.move):k.stay()}a.stock=[c,1,b,zc,Vh];a.mv=!1;ma(d,a,Xb,a.url.tree);Z(a.id,1);f.workers.length=
0;f.die()}else a.stock=[c,1,f.id,zc,Vh],ma(d,a,Xb,a.url.tree),Z(a.id,1);if(0>d)return a.stay()},xc=function(a,b){b.mv=!0;b.setupDir(a.x32-b.x32,a.y32-b.y32);ObjectsetupIMG(b,b.url.dig,1);od(b,"dig%20",3,b.img);b.setupINTV(bi,{u:a.id,a:b.id},7E3)},bi=function(a){var b=B[a.u];a=B[a.a];var f=J[a.kingdom].values.food,c=wd(a.kingdom,2,a.x32,a.y32);a.mv=!1;a.stock=[f,2,b.id,xc,ik];ma(c,a,Xb,a.url.food);Z(a.id,1);if(0>c)return a.stay()},rc=function(a,b){b.mv=!0;b.setupDir(a.x32-b.x32,a.y32-b.y32);ObjectsetupIMG(b,
b.url.milk1,1);b.stock=[0,2,a.id,rc,fk];b.setupINTV(mg,{u:a.id,a:b.id},1E3);a.addWorker(b);a.d=8-b.d;a.stay()},mg=function(a){var b=B[a.u];a=B[a.a];b.milk-=3;var f=a.x32,c=a.y32;a.stock[0]+=3;Z(a.id,1);if(0>=b.milk||b.death){if(50<a.stock[0]&&(a.stock[0]=50),a.mv=!1,b=wd(a.kingdom,2,f,c),ma(b,a,Xb,a.url.milk),0>b)return a.stay()}else mb(a,1E3)},rd=function(a,b){b.stay55()},Cd=function(a,b){Xc(a,b)},Xc=function(a,b){if(1!==a.death&&a!=b){if(a.dummy&&!J[b.kingdom].values.experience)return b.stay55();
b.invisible&&Yc(b.id);if(!0!==b.build){b.mv=1;var f=a.x32-b.x32,c=a.y32-b.y32;a.space&&(c=Zf(a,b.x32,b.y32),f=c%y-b.x32,c=~~(c/y)-b.y32);b.setupDir(f,c,b.d2attack);b.url.attack&&ObjectsetupIMG(b,b.url.attack,1)}b.setupINTV(ci,{u:a.id,a:b.id},Ta(b.img));a.addWorker(b)}else b.stay55()};Xc.distance=-1;Cd.distance=-1;var ng=function(a,b){var f=J[a.kingdom];if(f.values.experience&&(!b||0!=f.diplomacy[b.kingdom]||b.dummy)){if(0==a.level||null==a.level)a.level=0,a.levelProgress=0;a.levelProgress++;a.levelProgress>=
~~(a.level/f.values.experience)&&a.level<f.values.maxLevel&&(a.level++,a.health+=f.values.healthJump,a.maxHealth+=f.values.healthJump,a.levelProgress=0,a.attack+=a.level,a.defence+=a.level%2,Z(a.id,1))}},Ph=function(a){var b=a.level;a.attack+=b;a.defence+=~~(.5*b)},ci=function(a){var b=B[a.u];a=B[a.a];var f=a.attDist,c=b.x32-a.x32,d=b.y32-a.y32,h=b.x32,l=b.y32,g=!a.build;if(a.attackSound){var k=a.attackSound;xa(k[~~(k.length*Math.random())],a.x32,a.y32)}g&&!b.build&&a.setupDir(c,d,a.d2attack);ObjectsetupIMG(a,
a.img,1);if(b.death||a.level&&8<=a.level&&b.dummy||b.dummy&&a.level&&a.level>=J[a.kingdom].values.maxLevel)return a.stay();if(1<f&&!a.dragon){g=!0;var m=a.attimg}else g=!1;if(b.build||sd(b.x32,b.y32,a.x32,a.y32,f)){b.onattack(a);f=a.attack*((Sc[a.type][b.type]||0)+1);if(g){b.space&&(c=Zf(b,a.x32,a.y32),h=c%y,l=~~(c/y),c=h-a.x32,d=l-a.y32);g=0;if(a.arrow||a.ball){k=di;var n=vc(-c,-d);var q=c;var r=d;var v=411/Math.sqrt(q*q+r*r);q*=v;r*=v;var x=Math.sqrt(1024*c*c+d*d*1024)/Math.sqrt(q*q+r*r);a.ball&&
(m[1]=m[0]/x)}else{var z=2;k=se;g=q=u.gravity;n=Math.PI/180*60;v=Math.cos(n);n=a.attackDeg;n*=Math.PI/180;r=Math.sin(n);x=Math.cos(n);n=32*Math.sqrt(c*c+d*d);q=x*Math.sqrt(q*n/(r*x*2));x=n/q;r=-Math.sin(Math.atan2(-c,-d));n=vc(-c,-d);q*=r;g=Math.abs(g*v*r);r=(32*d-g*x*x*.5)/x}x=Math.round(1E3*x);v={x32:a.x32+.5,y32:a.y32+.5,img:m,mv:a.ball,d:0,rotation:-n+1.5,xf:h,yf:l,obj:b.id,attack:f,range:z};Sa(v);ObjectsetupPhysics(v,q,r,g);ya({func:k,data:v},x,1)}v||b.damage(f,a);if(b.dummy){if(50<=a.dummyDamage||
!a.dummyDamage)a.dummyDamage=0;a.dummyDamage+=f;50<=a.dummyDamage&&ng(a,b)}b.death?(a.stay(),a.action=null,b.build||a.build||ng(a,b)):mb(a,Ta(a.img))}else a.mv=!1,0!==a.state&&ma(b.id,a,Xc,a.url.move)},Ad=function(a,b){0<a.health?(b.dix=0,b.diy=0,b.mv=1,b.setupDirBuild(a),ObjectsetupIMG(b,b.url.kirka,1),od(b,"mine%20",3,b.img),b.setupINTV(ei,{u:a.id,a:b.id},7E3),a.addWorker(b)):b.stay()},ei=function(a){var b=B[a.u];a=B[a.a];var f=b.res,c=J[a.kingdom].values[0==f?"gold":"stone"],d=a.x32,h=a.y32;b.health-=
c;Z(b.id);1>b.health&&(c=b.health+c,b.health=0,b.d=3,b.die());a.mv=!1;d=wd(a.kingdom,f,d,h);0==f?(a.stock=[c,f,b.id,Ad,gk],ma(d,a,Xb,a.url.gold)):(a.stock=[c,f,b.id,Ad,hk],ma(d,a,Xb,a.url.stone));Z(a.id,1);if(0>d)return a.stay()},ma=function(a,b,e,c){b.cow&&b.workers.length||(b.action=e.url,b.distance=0,0<a?(b.xf=a,b.yf=!0):(a*=-1,b.xf=a%y,b.yf=~~(a/y)),b.func!=ge.url&&(c==b.url.move?Yf(b):b.mimg=c,b.dix=0,b.diy=0,b.mv=!0,b.setupINTV(ge,b.id,0)))},ue=function(a,b){K(a);te(b,a,lk)};ue.allowPos=1;var lk=
function(a,b){Vc(b.id,b.inventory.slice(0));b.stay55()},Zf=function(a,b,e){var f=a.space||Zj,d=f.length-1,h=f[d],l=a.x32;a=a.y32-1;for(var g=Infinity,k=0,m=0;m<d;m++){var n=m%h;n||a++;var q=(l+n-b)*(l+n-b)+(a-e)*(a-e);q<g&&f[m]&&(k=l+n+a*y,g=q)}return k},kg=function(a,b,e){var f=y,d=a.radix,h=Ua[a.zLevel];for(a=2;60>=a;a+=2){b--;e--;for(var l=0;l<=a;){var g=b+l+f*e;if(h[g]===d)return g;g=b+l+f*(e+a);if(h[g]===d)return g;l++}for(l=0;l<a-1;){l++;g=b+f*(e+l);if(h[g]===d)return g;g=b+a+f*(e+l);if(h[g]===
d)return g}}return!1},Xh=function(a,b){var f=y,c,d=pa;for(c=2;60>=c;c+=2){a--;b--;for(var h=0;h<=c;){var l=a+h+f*b;if(0===d[l]&&0===Y[l])return l;l=a+h+f*(b+c);if(0===d[l]&&0===Y[l])return l;h++}for(h=0;h<c-1;){h++;l=a+f*(b+h);if(0===d[l]&&0===Y[l])return l;l=a+c+f*(b+h);if(0===d[l]&&0===Y[l])return l}}return!1},Dd=function(a,b){var f=a%y;a=~~(a/y);var c=b%y;b=~~(b/y);var d=Dd.x,h=Dd.y;return(f-d)*(f-d)+(a-h)*(a-h)-((c-d)*(c-d)+(b-h)*(b-h))},Jb=function(a,b,e,c){var f=b.x32,h=b.y32,l=y,g=f+h*l,k=
a.x32,m=a.y32,n=a.space;if(n){var q=n[n.length-1];n=(n.length-1)/q;a=a.free}else n=q=1,a=Eh;b=b.rbase();for(var r,u=Infinity,v=-1,x=!1,O=0,z=0;O<e&&-1==v;){if(0==O&&a){r=[];for(var w=0,A=a.length;w<A;w+=2){var D=a[w]+k,E=a[w+1]+m;!oa(D,E)||b[D+E*l]!==c&&D+E*l!=g||(r[z++]=D+E*l)}Dd.x=f;Dd.y=h;r.sort(Dd);for(w=0;w<z;w++){D=r[w];A=D%l;E=~~(D/l);if(!(A=100<(f-A)*(f-A)+(h-E)*(h-E))){var C=f,F=h,I=D%l,J=~~(D/l),K=c,G=b;performance.now();A=y;var M=-A,T=+A,P=0,L=0;E=[];var Y={};Y[C+F*A]=1;var H=I+J*A,W=0;
I=!1;var S=0;b:do{J=H%A;var Q=~~(H/A);S++;J=(J-C)*(J-C)+(Q-F)*(Q-F);if(void 0==H||2>=J){I=!0;break b}Y[H]=1;J=5>=J?0:1;Q=bb[~~(8*vc(H%A-C,~~(H/A)-F)+.5*J)%8];if(G[H+Q]!==K&&null==B[G[H+Q]].xf||Y[H+Q]){var V=!1;for(var R=0;8>R;R++)if(Q=H+bb[R],G[Q]==K&&!Y[Q]&&(G[-1+M+Q]!=K||G[M+Q]!=K||G[1+M+Q]!=K||G[-1+Q]!=K||G[1+Q]!=K||G[-1+T+Q]!=K||G[T+Q]!=K||G[T+1+Q]!=K)){if(V&&12<W++)break;V=!0;E[P++]=Q;J=Q%A;Q=~~(Q/A);if(2>=(J-C)*(J-C)+(Q-F)*(Q-F)){I=!0;break b}}V||W--}else if(E[P++]=H+Q,J=(H+Q)%A,Q=~~((H+Q)/
A),2>=(J-C)*(J-C)+(Q-F)*(Q-F)){I=!0;break b}do H=E[L++];while(Y[H])}while(L<=P);C=E;for(F=0;F<0*C.length;F++)J=C[F]%A,Q=~~(C[F]/A),K=new ec(0,1,J,Q,0),K.c=NaN,ObjectsetupPosition(K,32*y),K.x=32*K.x32+16,K.y=32*K.y32,yb.new(K,2E3);A=I?E:!1;A=!1!==A}if(A){v=D;break}}if(-1<v){x=!0;break}if(1==e)break}O++;--k;--m;for(w=0;w<q+2*O;w++)b[k+m*l+w]==c&&oa(k+w,m)&&(r=(k+w-f)*(k+w-f)+(m-h)*(m-h),u>r&&(u=r,v=k+w+m*l)),b[k+(m+n+2*O-1)*l+w]==c&&oa(k+w,m+n+2*O-1)&&(r=(k+w-f)*(k+w-f)+(m+n+2*O-1-h)*(m+n+2*O-1-h),
u>r&&(u=r,v=k+(m+n+2*O-1)*l+w));for(w=1;w<n+2*O-1;w++)b[k+(m+w)*l]==c&&oa(k,m+w)&&(r=(k-f)*(k-f)+(m+w-h)*(m+w-h),u>r&&(u=r,v=k+(m+w)*l)),b[k+q+2*O-1+(m+w)*l]==c&&oa(k+q+2*O-1,m+w)&&(r=(k+q+2*O-1-f)*(k+q+2*O-1-f)+(m+w-h)*(m+w-h),u>r&&(u=r,v=k+q+2*O-1+(m+w)*l))}return-1<v?[v%l,~~(v/l),x]:!1},Qh=function(a,b,e,c,d){performance.now();var f=y,l=a.x32,g=a.y32,k=a.space,m=[],n=0;if(k){var q=k[k.length-1];k=(k.length-1)/q;var r=a.free}else k=q=1;a=-1==b?-Infinity:Infinity;for(var u=-1,v=0,x=0;0==m.length;){if(r&&
0==x){for(var w=0,B=r.length;w<B;w+=2){var z=r[w]+l,A=r[w+1]+g;oa(z,A)&&d[z+A*f]===c&&(m[n++]=z+A*f,v=(z-b)*(z-b)+(A-e)*(A-e),a>v&&(a=v,u=z+A*f))}if(m.length)break}x++;--l;--g;for(w=0;w<q+2*x;w++)d[l+g*f+w]==c&&oa(l+w,g)&&(m[n++]=l+w+g*f,v=(l+w-b)*(l+w-b)+(g-e)*(g-e),a>v&&(a=v,u=l+w+g*f)),d[l+(g+k+2*x-1)*f+w]==c&&oa(l+w,g+k+2*x-1)&&(m[n++]=l+(g+k+2*x-1)*f+w,v=(l+w-b)*(l+w-b)+(g+k+2*x-1-e)*(g+k+2*x-1-e),a>v&&(a=v,u=l+(g+k+2*x-1)*f+w));for(w=1;w<k+2*x-1;w++)d[l+(g+w)*f]==c&&oa(l,g+w)&&(m[n++]=l+(g+
w)*f,v=(l-b)*(l-b)+(g+w-e)*(g+w-e),a>v&&(a=v,u=l+(g+w)*f)),d[l+q+2*x-1+(g+w)*f]==c&&oa(l+q+2*x-1,g+w)&&(m[n++]=l+q+2*x-1+(g+w)*f,a>v&&(a=v,u=l+q+2*x-1+(g+w)*f))}return[u,m]},Eh=[-1,0,-1,-1,0,-1,1,-1,1,0,1,1,0,1,-1,1],ne=function(a,b,e){for(var f=Infinity,d=!1,h=0,l=a.length;h<l;h++){var g=a[h],k=B[a[h]];if(0!=k.built||k.death)h--,l--,a.quit(g);else{var m=k.x32;k=k.y32;k=(m-b)*(m-b)+(k-e)*(k-e);f>=k&&(f=k,d=g)}}return d},fi=function(a){for(var b=0,f=a.length;b<f;b++){var c=B[a[b]];c.spd=c.__proto__.spd}},
gi=function(a){for(var b=Infinity,f=0,c=a.length;f<c;f++){var d=B[a[f]];K(d.spd);d.spd<b&&(b=d.spd)}og(b,a)},pg=function(a,b){te(b,a,Xb)},Xb=function(a,b){a=J[b.kingdom];a.resources[b.stock[1]]+=b.stock[0];a.stats.resources[b.stock[1]]+=b.stock[0];ve(b.kingdom);b.func=1;var f=b.stock[3];a=B[b.stock[2]];if(f==rc){var c=y;for(var d,h=Infinity,l=!1,g=0;961>g;g++){var k=g%31-15,m=~~(g/31)-15,n=k*k+m*m;k+=b.x32;m+=b.y32;n<h&&(d=pa[k+c*m],0<d&&0===Y[k+c*m]&&(d=B[d],d.contain&&"meat"==d.contain[2].url&&
(h=n,l=d)))}if(c=l)f=xd,a=c}else"meat"==b.stock[4].url&&!1===b.stock[2]&&(c=hi(b.x32,b.y32,!0))&&(f=rc,a=c,b.stock[2]=1);if(!1===b.stock[2])return b.stock=void 0,b.stay();b.stock=void 0;ma(a.id,b,f,b.url.move);Z(b.id,1)};Bd.cursor=6;qc.cursor=1;Wc.cursor=9;Uc.cursor=5;yd.cursor=7;ue.cursor=7;re.cursor=6;pg.cursor=6;var $h=function(a){var b=y,f=a.kingdom,c=a.x32,d=a.y32;c-=8;d-=8;for(var h={},l=[],g=0,k=qb[f],m=0;256>m;m++){a=m%16+c;var n=~~(m/16)+d;oa(a,n)&&(a=k[a+n*b],void 0!==a&&(a=B[a],a.kingdom!=
f||!1!==a.built||h[a.id]||(l[g++]=a.id,h[a.id]=1)))}return l};zc.available=function(a,b){var f=J[a.kingdom].values.wood;if(b.death||1>b.health-f&&b.workers.length)b=Aa(b.x32,b.y32),a.xf=b,b=B[b];return Jb(b,a,1,a.radix)};Ad.available=function(a,b){if(!b.death){var f=Jb(b,a,1,a.radix);if(f[2])return f}for(var c=b.x32,d=b.y32,h=0;5>h;){b=Xj(c,d,b.type,b.id);if(!1===b)break;b=B[b];f=Jb(b,a,1,a.radix);if(f[2])return a.xf=b.id,f;h++}return!1};xc.available=function(a,b){if(b.death)return!1;a=b.x32+1;b=
b.y32+1;return 0===Y[a+b*y]?[a,b,1]:!1};yc.available=function(a,b){var f=a.x32,c=a.y32;if(!b.death){var d=Jb(b,a,1,a.radix);if(d[2])return d}a.buildList?(d=a.buildList,d.quit(b.id)):(a.buildList=$h(a),d=a.buildList);b=ne(d,f,c);if(!b)return!1;a.xf=b;b=B[b];return Jb(b,a,1,a.radix)};rd.rev=function(a){return(a=Xf(a.id))?[Cd.url,a]:!1};Cd.available=function(a,b){var f=Xf(a.id);f&&(a.xf=f,b=B[f]);return Jb(b,a,5,a.radix)};xd.available=function(a,b){if(b.death)return!1;a=b.x32;b=b.y32;return 0===Y[a+
b*y]?[a,b,1]:!1};rc.available=function(a,b){if(b.workers.length||b.milk<50/1.5||b.death){b=hi(a.x32,a.y32);if(!b)return!1;a.xf=b.id}return Jb(b,a,5,a.radix)};lg.available=function(a,b){if(b.death)return a.stay(),!1;var f=1;b.boat&&(f=2);return(a=Jb(b,a,f,a.radix))?(a[2]=1,a):!1};var hi=function(a,b,e){for(var c=y,f,h=Infinity,l=!1,g=0;441>g;g++){f=g%21-10;var k=~~(g/21)-10,m=f*f+k*k;f+=a;k+=b;m<h&&(f=Y[f+c*k],0<f&&(f=B[f],f.cow&&(!f.workers.length&&f.milk>=50/1.5||e)&&(h=m,l=f)))}return l},te=function(a,
b,e){for(var c=0,f=a.length;c<f;c++){var h=B[a[c]];ma(b,h,e,h.url.move)}},xe=function(a,b){Wa(b,a,we)};xe.noObj=1;var we=function(a,b){Ed(b,-a,77,we)},ze=function(a,b){Wa(b,a,ye)};ze.noObj=1;var ye=function(a,b){Ed(b,-a,130,ye)},Be=function(a,b){Wa(b,a,Ae)};Be.noObj=1;var Ae=function(a,b){Ed(b,-a,78,Ae)},De=function(a,b){Wa(b,a,Ce)};De.noObj=1;De.cursor=10;var Ce=function(a,b){Ed(b,-a,132,Ce)},Fe=function(a,b){Wa(b,a,Ee)};Fe.cursor=10;Fe.noObj=1;var Ee=function(a,b){Ed(b,-a,131,Ee)},Ed=function(a,
b,e,c){var f=y,h=J[a.kingdom],l=x[e],g=x[e].cost,k=a.mana>a.manaMax;if(Xa(a)||a.checkMana(g[4],b,c,g)){k||h.paypal(g);c=e;b*=-1;k=b%f;var m=~~(b/f),n=k,q=m,r=Ua[l.zLevel],u=~~(a.mana/g[4])+1;1<u&&(h.resources[0]-=g[0]*(u-1),a.mana-=g[4]*(u-1));for(h=0;h<u;h++)0!==r[b]&&(e=kg(l,k,m),n=e%f,q=~~(e/f)),xa("summon"+~~(10*Math.random()+1),n,q),e=new ec(c,a.kingdom,n,q,0),e.setupChild(Ab.spawn);a.setupDir(-a.x32+e.x32,-a.y32+e.y32);a.setupSpellIMG()}else h.paypal(g);Z(a.id)},sd=function(a,b,e,c,d){return~~Math.sqrt((a-
e)*(a-e)+(b-c)*(b-c))<=d},qg=function(a,b){Wa(b,a,Ge)};qg.cursor=0;var Ge=function(a,b){a.build||a.terrain||a.nofreeze||!Xa(b)&&!b.checkMana(50,a.id,Ge)||(a.freezed=1,a.stoned=1,ObjectsetupPosition(a,32*a.y32),a.stay(),ObjectsetupIMG(a,a.img,0),a.setupChild(Ab.turnStone),Zc(a,Kh),zd(a.id),b.setupDir(-b.x32+a.x32,-b.y32+a.y32),b.setupSpellIMG(),xa("turn%20to%20stone",b.x32,b.y32),ya({func:ii,data:a.id},24E4,1))},ii=function(a){a=B[a];a.freezed=0;hc(a);a.stoned=0},rg=function(a,b){Wa(b,a,Fd)},Fd=function(a,
b){a.health<a.maxHealth&&!a.build?(b.setupDir(a.x32-b.x32,a.y32-b.y32),K("heal",Ta(b.img)),b.setupSpellIMG(!0),b.setupINTV(mk,{u:a.id,a:b.id},0),a.addWorker(b)):b.stay()},ki=function(){Wa(list,obj,ji)},ji=function(){},mk=function(a){var b=B[a.a];a=B[a.u];var f=J[b.kingdom].values.healingRange;xa("heal",b.x32,b.y32);if(!sd(a.x32,a.y32,b.x32,b.y32,f))return ma(a.id,b,Fd,b.url.move);if(Xa(b)||b.checkMana(4,a.id,Fd)){b.setupDir(a.x32-b.x32,a.y32-b.y32);a.health+=6;a.setupChild(Ab.heal);if(a.health>=a.maxHealth)return a.health=
a.maxHealth,Z(a.id,1),Z(b.id,1),b.stay();Z(a.id,1);Z(b.id,1);mb(b,Ta(b.url.spell))}},Ie=function(a,b){Wa(b,a,He)};Ie.cursor=10;var li=function(f,b){f=B[f];b=B[b];if(f.inventory.quit(b.id)){b=a[b.spell];f.icons==f.__proto__.icons&&(f.icons=f.icons.slice(0));f.icons.put(b);var e=f.icons;e.olegal||(e.olegal={});e.olegal[b.id]=1;Z(f.id)}},Gd=function(a,b){var f=b[1];b=B[b[0]];B[a].nopotion||B[a].build||(ma(a,b,mi,b.url.move),b.actionItem=f)};Gd.item=1;var mi=function(a,b){var f=B[b.actionItem];b.actionItem=
void 0;f.attack&&(a.attack+=f.attack);f.defence&&(a.defence+=f.defence);f.mana&&(a.mana||(a.mana=0,a.manaMax=0,a.update?a.update.push("mana","manaSpeed",1E3):a.update=["mana","manaSpeed",1E3],ya({func:he,data:[a.id,"mana","manaSpeed",1E3]},1E3,1)),a.manaMax+=f.mana,a.mana+=f.mana);f.level&&(a.level||(a.level=0),a.level+=f.level,a.attack+=f.level,a.defence+=~~f.level);xa("bless",a.x32,a.y32);b.inventory.quit(f.id);b.stay55();Z(b.id)};Gd.cursor=10;rg.cursor=10;xe.cursor=10;ze.cursor=10;Be.cursor=10;
var sg=function(a,b){Wa(b,a,nk)};sg.cursor=1;var nk=function(a,b){a.isSpy&&a==b?b.stay55():(b.setupDir(-b.x32+a.x32,-b.y32+a.y32),ObjectsetupIMG(b,b.url.attack,1),ya({func:ni,data:[a,b]},Ta(b.img)-25,1))},ni=function(f){var b=f[1];f=f[0];f.die(1);var e=f.getRadix();e[b.x32+b.y32*y]=b.radix;b.x32=f.x32;b.y32=f.y32;b.d=f.d;b.name=b.name;b.attack=f.attack;b.defence=f.defence;b.update=b.update;b.mana=0;b.manaMax=b.manaMax;e[b.x32+b.y32*y]=b.id;ObjectsetupPosition(b,32*b.y32);b.__proto__=f.__proto__;ObjectsetupIMG(b,
b.url.idle);e=f.icons.slice(0);e.quit(a.menuBuilds);e.quit(a.menuBuilds1);e.quit(a.menuBuilds2);e.put(a.impersonate);e.put(a.revealSelf);b.icons=e;b.spy||(b.spy=b.kingdom);b.kingdom!==f.kingdom&&b.changeKingdom(f.kingdom);b.setupChild(Ab.impersonate);Z(b.id)},oi=function(a){a=B[a];if(a.spy){var b=x[2];a.attack=b.attack;a.defence=b.defence;a.__proto__=b;a.icons=b.icons;a.kingdom!==a.spy?a.changeKingdom(a.spy):a.stay();ObjectsetupIMG(a,a.url.idle);Z(a.id)}};Ie.allowPos=1;var He=function(a,b){if(a.id){var f=
a.id,c=a.x32;a=a.y32}else f=-a,c=a%y,a=~~(a/y);if(Xa(b)||b.checkMana(60,f,He)){b.setupDir(-b.x32+c,-b.y32+a);b.setupSpellIMG();f=8;c-=.5*f;a-=.5*f;var d=[];f+=1;var h=f*f;xa("bless",b.x32,b.y32);for(b=0;b<h;b++)for(var l=1;3>l;l++){var g=B[Ua[l][b%f+c+(~~(b/f)+a)*y]];g.build||g.terrain||(g.setupChild(Ab.bless),g.blessed||(g.blessed=1,g.attack+=5,Z(g.id,1),d.put(g)))}ya({func:pi,data:d},3E4,1)}},Wa=function(a,b,e){if(a[1]&&B[a[1]].item){var c=a[1];a.length--;te(a,b,e);B[a[0]].actionItem=c}else te(a,
b,e)},Xa=function(a){var b=a.actionItem;if(!b)return!1;b=B[b];b.attack&&(b.attack--,0===b.attack&&(a.inventory.quit(b.id),Z(a.id)));return!0},pi=function(a){for(var b=0,f=a.length;b<f;b++){var c=a[b];c.blessed=void 0;c.attack-=5;Z(c.id,1)}},Ke=function(a,b){Wa(b,a,Je)};Ke.cursor=10;var Je=function(a,b){a.freezed||!Xa(b)&&!b.checkMana(50,a.id,Je)?b.stay55():(b.setupDir(-b.x32+a.x32,-b.y32+a.y32),b.setupSpellIMG(),xa("invisible",a.x32,a.y32),a.invisible||(Zc(a,bg),a.invisible=1,a.stay()),Z(a.id),ya({func:Yc,
data:a.id},5E4,1))},Yc=function(a){a=B[a];a.death||(a.invisible=void 0,hc(a))},ug=function(a,b){Wa(b,a,tg)};ug.cursor=0;var tg=function(a,b){if(Xa(b)||b.checkMana(50,a.id,tg))b.setupDir(-b.x32+a.x32,-b.y32+a.y32),b.setupSpellIMG(),xa("lightning",b.x32,b.y32),a.damage(50,b)},Me=function(a,b){Wa(b,a,Le)};Me.cursor=0;Me.noObj=1;var Le=function(a,b){var f=y;if(a.id){var c=a.id,d=a.x32;a=a.y32}else c=-a,d=a%f,a=~~(a/f);if(Xa(b)||b.checkMana(50,c,Le)){b.setupDir(-b.x32+d,-b.y32+a);b.setupSpellIMG();xa("flame%20ball",
d,a);c=d-b.x32;d=a-b.y32;a=Math.sqrt(c*c+d*d);c/=a;d/=a;for(var h=b.x32+.5,l=b.y32+.5,g=[],k=[],m=0,n,q,r=0;r<a;r++)n=h+c*r,q=l+d*r,k.put(n),k.put(q),n=~~n,q=~~q,g[m++]=n+q*f,g[m++]=~~(n+d)+~~(q+c)*f,g[m++]=~~(n-d)+~~(q-c)*f;for(r=0;r<0*g.length;r++)ie(g[r]%f,~~(g[r]/f),"food");ya({func:vg,data:{list:g,anim:k,i:2,a:b}},1E3,1)}},wg=function(a,b){Wa(b,a,Hd)};wg.cursor=10;var Hd=function(a,b){b.setupDir(-b.x32+a.x32,-b.y32+a.y32);b.setupSpellIMG(!0);b.setupINTV(ok,{u:a.id,a:b.id},0);a.addWorker(b)},
ok=function(a){var b=B[a.a];a=B[a.u];if(!sd(a.x32,a.y32,b.x32,b.y32,J[b.kingdom].values.teachDistance))return ma(a.id,b,Hd,b.url.move);if(a.level>=b.level)return b.stay();if(Xa(b)||b.checkMana(10,a.id,Hd))xa("teach",b.x32,b.y32),b.setupDir(a.x32-b.x32,a.y32-b.y32),a.setupChild(Ab.curse,!1,bk),ng(a,!1),Z(a.id,1),Z(b.id,1),mb(b,Ta(b.url.spell))},Oe=function(a,b){Wa(b,a,Ne)};Oe.cursor=0;Oe.noObj=1;var Ne=function(a,b){var f=y;if(a.id){var c=a.id,d=a.x32;a=a.y32}else c=-a,d=a%f,a=~~(a/f);if(Xa(b)||b.checkMana(70,
c,Ne)){b.setupDir(-b.x32+d,-b.y32+a);b.setupSpellIMG();c=d;var h=a;d-=8;a-=8;for(var l=0;256>l;l++){var g=d+l%16,k=~~(l/16)+a,m=g+k*f;oa(g,k)&&64>=Math.pow(g-c,2)+Math.pow(k-h,2)&&Pe[m]&&0===Y[m]&&(K(g,k),new ec(60,b.kingdom,g,k,0))}}},vg=function(a){var b=a.list,f=a.anim,c=a.i,d=a.a,h={x32:f[2*c],y32:f[2*c+1],d:0,img:k.flame_trail,mv:1,z32:2,alpha:!0};Sa(h);yb.new(h,Ta(h.img));for(h=0;3>h;h++){var l=B[Y[b[h+3*c]]];l.health&&l.damage(96,d)}a.i++;a.i<.5*f.length&&ya({func:vg,data:a},50,1)},Re=function(a,
b){Wa(b,a,Qe)};Re.cursor=0;Re.noObj=1;var Qe=function(a,b){if(a.id){var f=a.id,c=a.x32;a=a.y32}else f=-a,c=a%y,a=~~(a/y);if(Xa(b)||b.checkMana(60,f,Qe))b.setupDir(-b.x32+c,-b.y32+a),b.setupSpellIMG(),xa("freeze",c,a),ya({func:qi,data:[c,a]},1E3,1)},Te=function(a,b){Wa(b,a,Se)};Te.cursor=0;Te.noObj=1;var Se=function(a,b){if(a.id){var f=a.id,c=a.x32;a=a.y32}else f=-a,c=a%y,a=~~(a/y);if(Xa(b)||b.checkMana(70,f,Se)){b.setupDir(-b.x32+c,-b.y32+a);b.setupSpellIMG();xa("confusion",c,a);b=4;c-=.5*b;a-=.5*
b;f=y;var d=[];b+=1;for(var h=b*b,l=0;l<h;l++)for(var g=1;3>g;g++){var k=B[Ua[g][l%b+c+(~~(l/b)+a)*f]];k.build||k.terrain||k.stoned||(k.confused=1,k.invisible&&Yc(k),Zc(k,Lh),k.stay(),k.oking=k.kingdom,k.kingdom=J.length-1,d.put(k),zd(k.id))}h&&1===F.length&&Z(F[0]);d.length&&ya({func:ri,data:d},2E4,1)}},ri=function(a){for(var b=0,f=a.length;b<f;b++){var c=a[b];c.confused=void 0;c.kingdom=c.oking;c.oking=void 0;c.death||(ObjectsetupIMG(c,c.img,1),hc(c),c.stay(),Pa==c&&(Pa=void 0,F[0]=c.id,Z(c.id)))}},
qi=function(a){var b=6,f=a[0]-.5*b,c=a[1]-.5*b,d=y,h=[];b+=1;var l=b*b;a={img:k.freeze_expl,d:0,mv:1,x32:a[0],y32:a[1]};Sa(a);yb.new(a,Ta(a.img));for(var g=0;g<l;g++)for(var p=1;3>p;p++)a=B[Ua[p][g%b+f+(~~(g/b)+c)*d]],a.build||a.terrain||a.nofreeze||a.stoned||(a.freezed=1,ObjectsetupPosition(a,32*a.y32),a.stay(),ObjectsetupIMG(a,a.img,0),a.invisible&&Yc(a),Zc(a,Jh),a.health-=40,1>a.health&&(a.health=1),h.put(a),zd(a.id));l&&1===F.length&&Z(F[0]);ya({func:si,data:h},2E4,1)},si=function(a){for(var b=
0,f=a.length;b<f;b++){var c=a[b];c.freezed=void 0;c.death||(ObjectsetupIMG(c,c.img,1),hc(c),Pa==c&&(Pa=void 0,F[0]=c.id,Z(c.id)))}},Ve=function(a,b){K(b);Wa(b,a,Ue)};Ve.cursor=0;Ve.noObj=1;var Ue=function(a,b){K(a,b);if(a.id){var f=a.id,c=a.x32;a=a.y32}else f=-a,c=a%y,a=~~(a/y);if(Xa(b)||b.checkMana(100,f,Ue))b.setupDir(-b.x32+c,-b.y32+a),b.setupSpellIMG(),xg(c,a,3,20,4500,b.id)},xg=function(a,b,e,c,d,h){for(var f=k.fire_rain,g=u.gravity,p=Date.now(),m=xg.rnd,n=Math.PI,q=performance.now(),r=0;r<c;r++){var v=
2*m()*n,w=e*m(),x=a+w*Math.cos(v);v=b+w*Math.sin(v);w=~~(r/c*d);oa(x,v)&&ya({func:ti,data:{x32:x,y32:v-6,dix:0,diy:140,img:f,mv:1,d:0,timestamp:p,finnish:Infinity,aceleration:g,attack:40,xf:x,yf:v,range:2,kingdom:0,obj:h,crashTime:(Math.sqrt(19600+384*g)-140)/g*1E3}},w,1)}K(performance.now()-q)},ti=function(a){ya({func:se,data:a},a.crashTime,1);Sa(a,0,a.diy,u.gravity)};xg.rnd=function(){var a=4096,b=2048;return function(){b=36969*(b&65535)+(b>>16)&4294967295;a=18E3*(a&65535)+(a>>16)&4294967295;return((b<<
16)+a&4294967295)/4294967296+.5}}();var di=function(a){B[a.obj].damage(a.attack,B[a.obj]);vb(a);Yb.put(a.bufferID)},ui=function(a){a=B[a];a.bufferID&&(vb(a),Yb.put(a.bufferID));Pe[a.x32+a.y32*y]=void 0},se=function(a){var b=y,f=a.xf,c=a.yf,d=a.attack;a.mv=1;a.func=void 0;a.x32=f;a.y32=c;ObjectsetupPhysics(a,0,0,0);ObjectsetupPosition(a,2);f=~~f;c=~~c;var h=f+c*b,l=Y[h];Mb[h]?(a.img=k.expl_small_water,xa("water%blop",a.x32,a.y32)):(a.img=k.expl_small_hole,xa("small%20explosion",a.x32,a.y32));ObjectsetupIMG(a,
a.img,1);yb.new(a,vi(ta[a.img]));if(2<l){var g=B[l];g.damage(d,B[a.obj])}h=a.range;l=2*h+1;for(var p=0,m=l*l;p<m;p++){g=p%l-h;var n=~~(p/l)-h,q=~~Math.sqrt(g*g+n*n);q<h&&(g+=f,n+=c,g=Y[g+n*b],2<g&&(g=B[g],g.damage(d*(1-q/h),B[a.obj])))}},pk=function(a){if(0<F.length){var b=B[F[0]],f=0,c=0,d=0,h=0;void 0!==b.dix&&(a=.001*(a-b.timestamp),h=b.dix,d=b.diy,f=h*a,c=d*a);if(b.space){var l=b.space;a=l[l.length-1];l=(l.length-1)/a}else l=a=1;f+=32*(b.x32+.5*a-Math.sign(h))+.5*-tzar.width+.5;c+=32*(b.y32+.5*
l-Math.sign(d))+.5*-tzar.height+.5;gb=~~-f;rb=~~-c}},wi=function(){};Fd.distance="healingRange";we.distance="createGolemRange";He.distance="blessDistance";Qe.distance="freezeDistance";Se.distance="confusionDistance";Je.distance="invisibilityDistance";tg.distance="lightningDistance";Ae.distance="createBatDistance";ye.distance="createDragonDistance";Ee.distance="createCarpetDistance";Ce.distance="createJinnDistance";Ge.distance="turnToStoneDistance";Le.distance="flameBoltDistance";Ue.distance="fireRainDistance";
Ne.distance="freezeDistance";Hd.distance="teachDistance";var eb;var J=[];var bc=function(a,b,e,c,d,h,l){this.name=a;this.k=J.length;this.color=b;this.status="";this.stats={dmgInflicted:0,dmgTaken:0,resources:[0,0,0,0],score:0,unitsKilled:0,unitsLosed:0,buildsLosed:0,buildsDestroyed:0,unitCount:new Uint32Array(x.length),unitCountMax:new Uint32Array(x.length),unitCountDeath:new Uint32Array(x.length),goldTraded:0,goldConverted:0,stoneTraded:0};this.team=l;this.resources=h||[5E4,5E4,5E4,5E4];this.values=
{gold:10,wood:10,food:10,stone:10,buildSpeed:1,experience:0,healthJump:0,maxLevel:4,pop:0,popMax:1,popLimit:200,healingRange:1,blessDistance:9,createGolemRange:5,freezeDistance:13,invisibilityDistance:9,createBatDistance:16,lightningDistance:12,createDragonDistance:4,turnToStoneDistance:21,flameBoltDistance:19,fameTech:0,confusionDistance:13,manaSpeed:2,milkSpeed:2,cowSpeed:2,stealCow:0,miningPerf:1,fireRainDistance:15,createCarpetDistance:3,createJinnDistance:3,teachDistance:2};this.race=c;this.racestr=
yg[c];this.IA=d||0;this.diplomacy=e;this.control={};this.control[this.k]=1;this.onFreePop=[];a=[];a.length0function=qk;this.unitLoading=0;this.target=[0,0,0,0];this.crusade={number:0,list:a};this.technology={hidden:{},disabled:{},actived:{},investigated:{}};this.mod=a=[];xi[this.racestr]++;b=0;for(e=x.length;b<e;a[b++]={});J[J.length]=this};bc.prototype.setupResources=function(a,b){var f=this.resources;b||(b=1);f[0]-=a[0]*b;f[1]-=a[1]*b;f[2]-=a[2]*b;f[3]-=a[3]*b;ve(this.k)};var za,Sd,qb;bc.prototype.check=
function(){for(var a=rk,b=eb[this.k],e=0,c=x.length;e<c;e++)if(!a[e]&&0<b[e].length)return!0;this.die()};bc.prototype.checkPopArray=function(){this.onFreePop.length&&td(this.onFreePop.shift())};bc.prototype.die=function(){this.k+1!=J.length&&(this.death=1,this.status="defeated",yi(),zb($c(z.playerDefeated,this.name),0,5))};bc.prototype.paypal=function(a){var b=this.resources,f=!1;b[0]<a[0]&&(zb($c(z.notEnough,z.gold),0,5),f=!0);b[1]<a[1]&&(zb($c(z.notEnough,z.wood),0,5),f=!0);b[2]<a[2]&&(zb($c(z.notEnough,
z.food),0,5),f=!0);b[3]<a[3]&&(zb($c(z.notEnough,z.stone),0,5),f=!0);if(f)return f;b[0]-=a[0];b[1]-=a[1];b[2]-=a[2];b[3]-=a[3];ve(this.k)};var ve=function(a){if(a==A.kingdom){var b=J[a].resources;a=b[0];var f=b[1],c=b[2];b=b[3];Infinity==a&&(a="***");Infinity==f&&(f="***");Infinity==c&&(c="***");Infinity==b&&(b="***");sk.innerHTML=a;tk.innerHTML=f;uk.innerHTML=c;vk.innerHTML=b}},rk={13:1,20:1,21:1,22:1,27:1,32:1,35:1,36:1,43:1,44:1,55:1,56:1,57:1},Va;var zi=[];(function(){var a="",b=new Image;b.src=
"data:image/gif;base64,R0lGODlhIQB2AfcAAAAAABAIAAgAABEhACE6ABkbChAQAAgIABAQCO/vlN7epf/6hZSQUv76n721a//rY/XmhnNjECklEP7oecW1Y+7ZeP/rhvvrljEpCCgiB+/Wa97OjP/WSu3YhyEZAIhzLf/WWOnHWv7baL2lVt3Db/vsvUo3BGtSCGhVIdq1SnhjKdy4V62USuvIaPzad/felO/XlzopAGtaMe3Kd/zbiOjMhv/9+JxzGWNKECEZCP/JSuu5Sc6lSMynV4tzPdSyaK2UWjEhADopCNacKWNKGVdCGf/IVuu4VruUSPzJZ7qYU0IqABkQAGdFB2tKEFI6D5tzKMqVN9unSNyrVlRDI/nLd7JwACkZAOaUEDEhCMSMMZRrKYlkJ/u3SJt0M8yYRquDQO66Zu3MlrWcc5haAItSAf+lGUIqCGNCEJdjGXpTGJxrIfisOGtKGcSNOtacQruHOfu6VsiYVOm6dPvLh/rZqTohAHdHB3NKEFo6D0kxEJRjIc6MMalzKYRaIZxrKXlTIuCcP6x5M+umR1I6GX5aKdacSuqqVdedUollNK2HVUopAFQxBXtKEGtCEMmBJ7h2J3NKGdeNNMOCMWNBGZRjKf2rR86MOtaUQpdpMt6cSrqFQkk0GnVWL9OjZolVGeeQLJ5jIKdqJ4xaIeCTObd6NembRt6UQsWEPGlHIf+tUsuMQ9aUSppyRzEZAGU1BkopCHNCEDohCFIxECkZCPeXM3tKGdKDMIRSIZxjKlo6Gc6EOoxaKahwNt6USjUkE/zLmUIgACEQAIZLEtZ2H5ZUF2Y6ELlpIN9/KGtBGUUpEHVKIRkQCNaMRntCEHNCGZdZI86MUjoZAFQoBs5qIF0xECUZEE8hAHQ0CIQ9C5RHD65TFb5cGXY6EDEZCHtCGYRKIVIxGSkQAEohCEIfCVIpEKJEEUUpGWgnBzoZCEIzKzEQABkIAHMpCIw0CyEQCFsZAlEZBikQCDQZECEHAD4PATEQCGshEDEIAPNGKRkAABAAABkICBAICAgICP///yH5BAEAAP8ALAAAAAAhAHYBAAj/AP8JHEiwIEEBBhMqXPiP3QGEAwVAZKgQYoBwLAIMpIUCwESKE5lI/CeA0woU+wTSIvHk40IBD/9x+vHrnYB9+358EbdPwDsavfi5NMiEChcA/5i0QIKrzTsANeQoC+DzAhJvKYcK3AeoAheqAlbo0XNGlpIKR5axEyChwwo/U7UK+EWiAxRdgH5RGnWpD6ArwpCUWlaES40WX0pRompQwIcXLbR8ObKi1BdUcXatMsZuFCUuUtxKidLr11ABT5Ag+tIHjK5MYb5UilPqlK0rVwKkmiJFyyVBpgsyCRCAEpIvyubJC4CkCq9Rh3JhqiRSAJQvcPgIUgaTIIofMvL8/5hCKwfEHmEiDcq0CtosdklHjeoDaSpSgQKoWGjRowMYWh4JlEgYm4wyhR+buaKLAEwoQ4gfs9CikUBM/OBWCytEAuBESIThhyZbVGILOU+QJEAOhFBCyy/44QDDDFKsgJwwqRA0oBejiBJJMmecYSIAOSxjjzf4jeLCFNi9ocxugAyk3hSVhIILGmd4U6KJ77yTAzu/cMIOZXBQ4gcsRXyRhB4CPXEJHT2U4kUyeggzS0QCABAAHD0koUIP/HkjzwH/+ODCFz7qUQoNM3zBVB5X+GjQLGBQtkIHSTxDXAB5wGFBGEUUcUsVF8SWSzJZyJLQTZUc0cIMK7ghhAAZ/P9DySAWuBCHKYdcMMMUgkQSZxGnyiPFF27wIAUX9hgQQBu4DOKCrVLQUMURboySBxNonurFCmn4UYoWfsiT0l6TDBLHIWGEgeQfaAQhREXhrADHLLrgIsgswgiURySiuCEFK4dg4oYoz5yhlUDiRCEFJfZk0UYeNgkkizGfiCJKKajAkYstswTQpEKzVsIOO+Rk4Y1IAglzRh7OQFOKIKF8wmgWClHVhyRFBOARLbRMxI4wsDgSSh99jJKMLKfNxY4abgiii851fiQAO64Yc4woebiCckE5qFCFEnB8IcUWv2zdmDDDSCMRg40RIkgILVAmxRPvTJjQPuwA4FG+pzL/w8UkYGCXzC8BJkSVnSBloYssnMxSsgEHU2RQFjoH4I0wkUuuEAB4Z655RZ8rVAIgzIQeehx0RMKE6Z9XkcQspbNOESZ0xAG77BQFAoztseOukO6WlNO77waZUocls+RAvEKHHJ/88gk1X4sxtEBvUBh1sGGM8tYTNIgNtXzC/T9kVA99IOA/f0cJtYxPPB82gHLHP03QYAU93fOBzDE5bGLKK90byB1I4Q3zdS8PjGhCCaxgQOjdwQZWMAMtzIAFmlmPBmzIAiX+8YohlKEM81teGXg2kDLYgAZkCOBAmlCLWtxHhf/4IAxnSMMa2vCGOMyhDnfIwx768B82QEMN/2dgg3fN0BNhsAERZtgKRMDABsaYISvCAIMSPINIAczEEeRQhxK8woLWe8UOLrGCElzAFukIIB+O8IgpXGAOr0hHH6yXiyQkRgwwSMIdvGGx5anBCFNYhSjmMIcj3MAbgIDE8jQRBkQIYg3j2YEUZBELLRAPCUk4hBy4kAs5wEFh8nDEG6KAuyZkcgpwaEQvFCGIK3jjDIx4xA5wd4QjBPITjviDMITBjiysCAMvDF0f4iCFUkBDDx6QhTVmIY/CyY4eSZACKi5BjgA0QgtbkEUDZReFHexAHOKoRAPC0IZXLm8ZIBCHzvTgiVKlwhrLO4cx9oEUAGSAFnKYAhf6of9CABxAEDtIhCxMAMMA7OEMPSiGGmDIiDF0AAnQgOEBQFEDRgSzeyYoBqZ+yNGOevSjIA2pSAVygic0gXVLkFwT3BGPeIQOHYx4wkUL0gRzcCMe2KiH5tCBDnfo7R/kUIg79hcPdLhUcuiwqUvrwQiDtJQatQiEOdxBAKQO9RgR6GlCpsENZOgAGdxoRzAo8tSoTpUA7RhIPYo6VB3ooAuSaCpFuOpVsLZDrsFohzt4So0u6MAIICjGWBligra+Na7uYEQw3OGOf5iAG2z46wOksA10UAQdff1rYBlbD3MU4x/40EYtACuCB1SWIo+NrBEmy9MMcIMa7sAHPh6hAxD/GIEDoOAGNggrWtKaFh3C2AYoGCvbY7CBDaAgRjF2S9ha1Pa2oMgGPhhRC9hqY6/aSC4xZMHchZgAG9g4bnKLEQ/hgsIc1KCGOeqhjW6wFJwUwYY7skuM7b5iG1A9BlSJgQ5yoMMY2CiA5kyAjm24Nx5LcAc12BAIZBx3G8HARgbEEVTJYWMc4/gvNmiBDmKAQge1YEMXkGEOciDucxgex4QZUY/6dsEIx60FMnA3DmwwIwCMYIQ5zEGMOOiADSGuMOsC8F1s5HjHo+1CLUABCuIFYLc7tikpunAL4Q4Deozdhja2wQ1zwOMRw7gy8eABj20Uoxxchgc5lKGM5cGj/7NnCEA3wgqAJaQUeu2gypPRUY9pbMN6AchCBhAQjAybo3tkzkA83lEAIXcvB9gQRwGkMdJKW/rSBlHGDFhHAxZRJAdV2PTnfhCGbSbkHZqgQRg0hwgXaMLTDBEGL1ywK4qsIgxJyISpDSKMZEBCD0VIxEIooQxvbCMZuy6IN6YSgGQPJAuY24ezB+IndsDCCFFUSB6mAIt3sAOLmnsGJXRBhSIAQhB9EIUXEkGIZETI0Zr7hS5IMYELXKABF6hAC5JwhC+0wZes08UXBpEEC1igAQ2oVRICAYdKKAPeklvGwI0wgYM3YAJJiMMb4MALPUw7Ictwg7lEgHFTTCEJYf9wQy9SUZOA/yEQcQDBD/KRD3f4AA598MMTaPEO1inDW4OwRCvu4Y56qAMQe2iDMnIgD9Z5IxJ9MIUlOsGJeajj6J/QxS+Y8XGD0IISezhFF7rwB3VQAQqTiESEEADuz3ljFkDvgghEYIRBKGbpzADj52ThsJfL3QVGOAIXnpAFZuRddjl4Ai5IYQkjiICYfvA4M3ouO1n8IhKCGIQRkmCJLwBi6c32nTcI0Qdz1V0QRaBc1xkiC13AwQinJwQz2o67TCjDGKUwRR+MUQ0JWO8Qn3+HhNjxiVNA7xBfqIaQx5EHTKyCeGCYAiXSSJB08IIUgsBdKwyBC9oLRBm5sLv/7MCQiDYrJBWtyASm189+9tvBDq4QBwyfMApW9CEZ7EhJ98Cwik3EYRKrYFHdkwhV8AW4kASiYAqRMDLWIwc0gAu2cAi4oAm84DmjVgV5IIHNMApnMFOy4zWbAAiH8AyowAj0MCfQowRzEAmHUAi84AhXQFCycyUCUgWZgAu5gAbGcAWuIDtEcAjAIhDJcAg/wAuVoAbV4ArsIIOh8wRy4AJBIBBnsAoX8AOb4AXGEAz7YCqs4wMQgAhX8A9nUAoXQANToARqwAhUIzsmsAoJEAZjsQs00AAFWAnGsEu4kwdxkAATcASkEAYNoGqCEAvBIADZYjqUoAaHAAEYlyuq/2aAsCAAjsI6eTAKbnAIKFcFVRAGhvAHeSAMYYg7JuAIorAKU4AIYcAKXyAKO+iBnyMOjKAGfyAKvVAKm5ALjhAMAPAxuLMP0jANxjAMgiAI0OAIsPAzy+MRrjANwwAN0MB74uCKoaM3+jANxVAMdrAW0mg6nPMK9KA3zgQ9HgGOdmM94LiN7ZeO6riO7HhpvdALgJAKNdI9QFAKq7AKqggGhQBrvvMDM2AKvsAK94gKm5AJ50A8PwADdBAGAMkKqECQmyAInOA7JFACM3AIhzAIlXBurLAJBTmRsvMDJVADh7ADEPACiZAKuXePnYA7P2ADdRAGgzAHNqAA35AKnP+QCJ1ABbjDRSUQBhipATZwBLkAADc2ALgDBh1AA3FzBKkQAhuwCalQjrKDCPl2BILgD9TQC60QDa0gYL6TCj/QAodwDgDACZsADK3ADAiwPKmQCVQQO5nQCe/Qb9XglsFEBb9QBz8gCLYAQ79ABXy5ChukQr/QCTDgCaUQDoBJBWLgCZkAkgH0C4nwmJnAmIbZCmIgB51AldDzC62gCOqQAZ65PL/wCwdAHDN0Ke3Ymq75mrAZm7ApmbhDmwSRCqdQmOFgfp9DCKigC5kGCKUADsogAnCFmQwRB3GgBxeDC6aWBctwBtzwAA1gCZFAEV0wAQ1wDNWQDJRnEAeQBZD/YAkuUJ28aRCWUHGWgAzCoHeZJgi7kJ4NcAsKUQsNIAKmIAmiAJwMkQOUwC+3cAQQkAwGkQsL0AWQMArQoCGSkwM8MwvVMAu+QhCzoAbdMA16oE3uwzq4EAeqcJ7W06ElIALQAKLLE4E0cAvpUJq+MwtWMw4BsDoq9A4ZyqIU8XV/UAqScJ9GwIsDMQopQAKBMAkv0waHyDX+VApJUAITEAi8gJwDoQzHcAQlQAeDwAVTYaL/ACBMcABwMAinIApQShCyAAldkACJEAAHACQJoQx/gAzKcABuUApaOhDGIAnHAADdoA0kVBCzIAmWwAbcAADLkAx1+n1/wAS/wAeg/0ANBaEMcKAKpoAJnZAFAKAHhzoQyaAzlPAFpkAKkGBBunEJojALT2GUR6oQlKM3utALl0CnysMMB7AM5sMzY7oQv2A+DqML72B+zMCPxMMJB7B6slmsxnqsyNqO+0AfvoMOxcANxIAMknALx9AHoHgEgzAIxxA6jNAIj0AKRxCI0hIGkjAM7JAG5UmHpvA5mNMIXeAGaeAIS3AF4tAEWfMIoGAEFjcDbyA5IoEbxMEOTMAEAssEwuAEofAIjyAJSfAsUyA5+ReF//AJgjAJdwaKrrAIefAKd3AHogAH/fo5dyAGJWAJ1BAD/yAM4mAHMWAHgLFLBksRFisQV0ADSf8wCKGwCLgzCW/AB4GABsPxD3aQbq/wCnbwOVwABsYyAzRgK4MQBIUDGOIgo/8AB1uABqJAgwQhDksjBWFQBS5QBVGAOaIACYvwBGcQA4wgCF57CHFACqJwZwkBAMGwDccACX2xD0EgCpJgBC5gAWVYBdIyGsVAD/LHEPtwDdjwCX2wFsWQBpCgsNN6CZOQBp8QC9JwBVTLEAHADoygM0zgCuswDdfAU9LQE5wTDD34OewQAK6gfzPEN8k6u7Rbu7Z7u7ibu5rTB+LAhSr0LNPAN4VgqbuoBJ+FOyKwAq9gCAYXBqUwAxVAAz8wDdhwvKxTDCFgAUlwb67TAmEwA47/kA2LKzsNsABJAHtx0AWB0AMkQAl5EwvOwDoJB3tG0AWDQApTAAaYQxw/FTrl6wIZ1wWgQAqIsARrozcWWBAAbARxMAiSgAibsL/nKDthgK2kgAmIYAwSoY11gjtTsAluoAmlQBX0cAYqEBO+AwdKoASMIBH0Cgap4AqhiDtKoAiuQBUHgAcqsAAO0AEMQDxMIA514hEBIAwU8ASfcAUJ/DlXUAFPYLfXsBYBdAbbUAWmEAoC2D2u8AoAPAmfIMXdIwClUAWaAA0trEKycAhVAAmOgDkBZAe4EAY/8AmRqEJnAAdzIAiOcMMqxAhfMAqzQDl2nMRqaqO4kxtLrLuK/7zIjBxSsLAIROIEgMkCUqAOUDANAbQFH8ACK+ACbfAJAqEGLLBQvpMBbbACK9AFXOAov7ADR+s7A5ACPAACg2ALRiQNtHANy+MNn5AMsMAEJ2UQetAGbcAIsAAFn0MLJsAOdiBXBgEASAAIPdAK5ODMC+EIjjANWSACSDEWZSEQX0ACYcADK2AIMkIR2VAEKwA0D8AEe9EXfyEMAGAMSRACIdArM7wQAXAEI8AFM9AGXnAZmbEZ7JC8UoAEUfAJqWo4gGABSqABI6AHmyAbtGEbuNEHe4AHdWYQd2DCjKAJLoAEIr0CUiAFhFAERQgd0kEd7CAPApBsDDABLSAA5P/gLCtAGVPwB0TgA+mxHu3xHuxwDbsGAJsQAl2gN8swCFMgKVJgDHpAIAaCIMagIAshDVzQBVpwAFywADCCylOQCZSgB53gISAiIiTCEOGgN1CgBUUbBVGgDFygBt7wDlwQBjiiIzwyiQnxCgLACK7gCrvIBYSwCUXwBHP9JFEyJVWitQzRD81w0mYyFkygJmziJnAiJ5rzCrLwDD4hKIQyD4aCKIqCC4yi1wvxCvQkDrSQKZvSKZ8SKl8wKqXCOgbgDbNSK7eSK7vSK7/CED4ABipQEMziLNAiLdRiLdiyEMxwBF1gouRiLuiiLl/ALu6yENOQCG0ACwmxL/3yLwFJMzAFkzmguBATUzEXkzEb0zE+yjoqwzIuAzMycwXuyTo/EzRDUzRHk8gVQTVWgzVao98vgTZqIxGbuzx4g8CyC2h1YsiN/DkBAQA7";
var e=document.createElement("canvas"),c=e.getContext("2d");b.onload=function(){e.width=33;e.height=34;for(var f=0;11>f;f++)c.drawImage(b,0,34*f,33,34,0,0,33,34),zi[f]=e.toDataURL("image/png"),a+=".ncursor"+f+"{cursor:url('"+zi[f]+"'), default}",c.clearRect(0,0,33,34);document.getElementsByTagName("style")[0].innerHTML=a};gc(2)})();var w=function(a){return document.getElementById(a)},Id=function(a,b){w(a).style.display="block";Id.actived=a;b.actual="potion";b.id=0;b.amount=100;b.func()};Id.actived=
"";var X={potion:{bak:1,max:4,ord:["level","mana","attack","defence"]},sword:{bak:5,max:3,ord:["attack","attackBow","defence"]},book:{bak:8,max:18,ord:"fireRain lightning healing createCarpet createBat bless freeze confusion invisibility createGolem magicVision raiseDead turnToStone whirlpool createDragon flameBolt teach createJinn".split(" ")}};w("mgbook").onclick=function(){X.actual="book";X.id=0;X.amount=a[X.book.ord[X.id]].obj.spcost[0];X.func()};w("mgpotion").onclick=function(){X.actual="potion";
X.id=0;X.amount=100;X.func()};w("mgsword").onclick=function(){X.actual="sword";X.id=0;X.amount=100;X.func()};w("mgdecline").onclick=function(){w("magicworkshopmenu").style.display="none"};w("mgitem").onmousedown=function(f){var b=1;f.button&&(b*=-1);f=X[X.actual].max;0>X.id+b&&(X.id=f);X.id=(X.id+b)%f;"book"==X.actual&&(X.amount=a[X.book.ord[X.id]].obj.spcost[0]);X.func()};w("mgaccept").onclick=function(){ea(Ai,[X.actual,X.id,parseInt(w("mgamount").innerHTML)],F[0])};var Ai=function(a,b){b=B[b];var f=
a[2],c=[f,0,0,0];Va.paypal(c)||(f=~~(250*f),"book"==a[0]&&(f*=2),b.setupINTV(Bi,[a,b.id],f),b.lcost=c,b.techStart=b.c-u.cycle,Z(b.id)&&(w("magicworkshopmenu").style.display="none"))},wk={defence:6,mana:0,level:2,health:1,attack:5},xk={attack:"sword",attackBow:"bow",defence:"shield"},yk={attack:.5,mana:1,defence:.5,level:.2},Bi=function(f){var b=B[f[1]],e=f[0][0],c=X[e].ord[f[0][1]];f=f[0][2];b.lcost=void 0;"sword"==e&&(e=xk[c]);"attackBow"==c&&(c="attack");e=Object.assign({},Kb[e]);if(e.potion)e.d=
wk[c],e[c]=~~(f*yk[c]);else if(e.book){var d=a[c],h=d.obj;e.spell=c;e.attack=~~(f/h.spcost[0]);e.name=h.name;e.iconID=d.iconIDbook}else e[c]=~~(.25*f),250<e[c]&&(e[c]=250);K(e);wc(52,b,!0,e);b.techStart=void 0;Z(b.id)};w("mgamount").onmousedown=function(f){var b=10;"book"==X.actual&&(b=a[X.book.ord[X.id]].obj.spcost[0]);var e=b;f.button&&(b*=-1);cb.shift&&(b*=5);X.amount+=b;0>=X.amount&&(X.amount=e);w("mgamount").innerHTML=X.amount};X.func=function(){w("mgitem").style.backgroundPositionY=-48*(X.id+
X[X.actual].bak)+"px";w("mgamount").innerHTML=X.amount};var We=[0,0,0,0,0,0,0,0],ob,Pc,Ia=[document.getElementById("order1"),document.getElementById("order2"),document.getElementById("order3"),document.getElementById("order4"),document.getElementById("order5"),document.getElementById("order6"),document.getElementById("order7"),document.getElementById("order8")],Ci=document.getElementById("bottominfo"),Xe=Ia[0],Ye=Ia[1],Ze=Ia[2],$e=Ia[3],af=Ia[4],bf=Ia[5],cf=Ia[6],df=Ia[7];Xe.addEventListener("mousedown",
function(){Xe.style.transform="translate(2px,2px)"});Ye.addEventListener("mousedown",function(){Ye.style.transform="translate(2px,2px)"});Ze.addEventListener("mousedown",function(){Ze.style.transform="translate(2px,2px)"});$e.addEventListener("mousedown",function(){$e.style.transform="translate(2px,2px)"});af.addEventListener("mousedown",function(){af.style.transform="translate(2px,2px)"});bf.addEventListener("mousedown",function(){bf.style.transform="translate(2px,2px)"});cf.addEventListener("mousedown",
function(){cf.style.transform="translate(2px,2px)"});df.addEventListener("mousedown",function(){df.style.transform="translate(2px,2px)"});Xe.addEventListener("mouseup",function(a){ob=a.button;pb(0)});Ye.addEventListener("mouseup",function(a){ob=a.button;pb(1)});Ze.addEventListener("mouseup",function(a){ob=a.button;pb(2)});$e.addEventListener("mouseup",function(a){ob=a.button;pb(3)});af.addEventListener("mouseup",function(a){ob=a.button;pb(4)});bf.addEventListener("mouseup",function(a){ob=a.button;
pb(5)});cf.addEventListener("mouseup",function(a){ob=a.button;pb(6)});df.addEventListener("mouseup",function(a){ob=a.button;pb(7)});document.getElementById("stock").addEventListener("click",function(a){Di(B[F[0]])});var Di=function(a,b){if(0==H.stockActive||b){if(b=a.inventory,b.length){var f=[];f.length=b.length;for(var c=0,d=b.length;c<d;f[c]=B[b[c++]]);ha(f,a,1)}}else ha(a.icons,a)};(function(){for(var a={},b=0,e=Ia.length;b<e;a={l:a.l},b++)a.l=b,Ia[b].addEventListener("mouseenter",function(b){return function(){var a=
H.displayed[b.l],c=B[F[0]];if(c&&c.kingdom)var f=J[c.kingdom];if(a){if(void 0!==a.unit){c=x[a.unit];var e={name:c.name,cost:Nh(c.cost,a.hero||a.merc,f.values.fameTech)}}else e=a.obj;H.stockActive&&Ac(H.active[b.l].id,1,1);if(e&&e.name){var g=e.name;c="<span>";c=2==g.length?c+(g[0]+" - "+g[1]):c+g;if(g=e.cost){!e.tech&&f.mod[e.type]&&f.mod[e.type].cost&&(g=f.mod[e.type].cost);c+=" - (";for(f=0;5>f;f++)g[f]&&(c+=g[f]+"<img class='resource' src='"+zk[f]+"' /> ");c=c.substring(0,c.length-1);c+=")"}c+=
"</span>";J[B[F[0]].kingdom].technology.disabled[a.id]&&(c+="<span class='red'>"+z.requires+": "+a.require+"</span>");e.type==kb&&(c+="<span class='increase'>+"+e.increase+"</span>");(f=ef[B[F[0]].strID])&&f[a.objName]&&(c+="<span class='shotcut'>"+f[a.objName].toLocaleUpperCase()+"</span>");Ci.innerHTML=c}}}}(a)),Ia[b].addEventListener("mouseout",function(){H.stockActive&&Ac(F[0],1,1);Ci.innerHTML=""})})();var Ei=function(){history.pushState("",document.title,window.location.pathname)},Bc=function(){u.online=
0;location.hash="";w("MatchX").style.display="none";document.getElementById("index").style.display="block";document.getElementById("returnmenu").style.display="none";document.getElementById("game").style.display="none";document.getElementById("chat").style.display="none";document.getElementById("gameFinish").style.display="none";setTimeout(Ei,200)},pb=function(f){var b=We[f];pb.lastFunc=b;pb.nu=f;if(H.stockActive){b=B[F[0]];var e=B[b.inventory[f]];e&&(e.potion?cb.control?ea(Gd,b.id,[b.id,e.id]):(L=
Gd,L.item=e.id):e.spell?cb.control&&b.mana?ea(li,b.id,e.id):(a[e.spell](),L.item=e.id):(ea(Vc,b.id,[e.id]),Z(b.id)))}else b&&b();pb.lastFunc=void 0;pb.nu=void 0;Ia[f].style.transform=""},eh=function(a){var b=[.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.27,.3,1,.5,.5,.5,1,.62,.62,.62,1,.74,.74,.74,1,.3+.58,.3+.58,.3+.58,1,.94,.94,.94,1,1,1,1,1,1.06,1.06,1.06,1,.3+.82,.3+.82,.3+.82,1,1.08,1.08,1.08,1,1.04,1.04,1.04,1,1,1,1,1,.95,.95,.95,1,.3+.58,.8,.7,1,.3+.54,.72,.6,1,.7,.62,.5,
1,.6,.55,.3+.15,1,.5,.44,.42,1,.4,.37,.35,1],f=new Date;null!=a&&(f=a);a=f.getMinutes()/60;f=f.getHours();document.getElementById("daynighticon").style.backgroundPosition="0 -"+36*f+"px";var c=[b[4*f],b[4*f+1],b[4*f+2],b[4*f+3]];f=(f+1)%24*4;c[0]+=(-c[0]+b[f])*a;c[1]+=(-c[1]+b[f+1])*a;c[2]+=(-c[2]+b[f+2])*a;c[3]+=(-c[3]+b[f+3])*a;return c},gb=0,rb=0,Cc=0,Dc=0,kd=function(a,b){var f=tzar.width,c=tzar.height,d=A.mx/32;a/=32;b/=32;var h=da*f*.03125,l=da*c*.03125,g=.03125*f,k=.03125*c,m=a+.5*(g-h),n=
b+.5*(k-l);0>m?a=.5*-(g-h):m+h-d*da>y&&(a=y-h-.5*(g-h)+d*da);0>n?b=.5*-(k-l):n+l>qa&&(b=qa-l-.5*(k-l));h-A.mx>y&&(da=y/(.03125*f),K(da));l>qa&&(da=qa/(.03125*c),K(da));gb=32*-a;rb=32*-b},kc=document.getElementById("minimap"),ff=function(a){var b=a.pageX-parseInt(kc.style.left);a=a.pageY-parseInt(kc.style.top);var f=tzar.height*$a/(32*qa);b=~~(.5+(b-tzar.width*Tb/(32*y)*.5)*y/Tb);a=~~(.5+(a-.5*f)*qa/$a);kd(32*b,32*a);0==Pc&&document.removeEventListener("mousemove",ff)};kc.addEventListener("mousedown",
function(a){var b=a.pageX-4,f=a.pageY-31;0==a.button?(document.addEventListener("mouseup",function h(b){document.removeEventListener("mouseup",h);document.removeEventListener("mousemove",ff)}),Pc=!0,ff(a),document.addEventListener("mousemove",ff)):2==a.button&&(b=~~(y*(a.pageX-4)/Tb),f=~~(qa*(a.pageY-31)/$a),ea(xb,b+f*y,F))});var cb={control:0,shift:0,esc:0},na=function(f,b){if(f&&1==F.length){if(f=H.active)f=f.menuName;b=Ak[b];if(f=ef[f])f=a[f[b]],-1!==H.active.indexOf(f)&&(b=Va.technology,ob=0,
b.disabled[f.id]||b.hidden[f.id]||f())}},Bb={37:function(a){Cc=a},40:function(a){Dc=-a},39:function(a){Cc=-a},38:function(a){Dc=a},32:function(a){wi=a?pk:function(){}},46:function(a){a||ea(Jd,cb.shift,F.slice(0))},16:function(a){cb.shift=a},17:function(a){cb.control=a},27:function(a){cb.esc=a},13:function(a){a&&!u.editor&&("displaynone"==zg.className?(zg.className="displayblock",Ag.focus(),Bb.blocked=13):(Bg(),zg.className="displaynone",Bb.blocked=null))},19:function(a){a||u.online||nb(1)},48:function(a){a&&
cb.control&&(da=1,yf({deltaY:0}))},176:function(a){a&&(u.deltaTime+=3E4)},65:na,66:na,67:na,68:na,69:na,70:na,71:na,72:na,73:na,74:na,75:na,76:na,77:na,78:na,79:na,80:na,81:na,82:na,83:na,84:na,85:na,86:na,87:na,88:na,89:na,90:na},Ak={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};Bb.blocked=null;(function(){for(var a=[65,37,40,83,39,68,38,87],b=a.length=0,e=a.length;b<
e;b+=2)Bb[a[b]]=Bb[a[b+1]]})();window.addEventListener("beforeunload",function(a){A.admin&&Fi();return null});document.oncontextmenu=function(){return!1};var Nb=document.getElementById("attackmenu"),Ec=document.getElementById("defencemenu"),Fc=document.getElementById("levelmenu"),ad=document.getElementById("kingdom"),Ka=document.getElementById("progressone"),gf=document.getElementById("unitname"),ic=document.getElementById("progressvalue");document.getElementById("selectedobject");var Jd=function(a,
b){if(b.length){a=a||u.editor?b.length:1;for(var f=0;f<a;f++)B[b[f]].die()}},Ha=function(f,b){f.sound&&!b&&(b=f.sound,xa(b[~~(b.length*Math.random())]));Fc.style.display="none";Kd.style.display="none";ad.style.display="block";Ka.style.display="block";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";Ec.style.display="none";gf.innerHTML=f.name;Ld(f);ad.innerHTML=J[f.kingdom].name;f.attack?(Nb.style.display="block",Nb.innerHTML=f.attack):Nb.style.display=
"none";b=f.health;var e=f.maxHealth;Infinity==b?(Ka.value=100,Ka.max=100,ic.innerHTML=b):Ka.value=b;Infinity==e&&Infinity!=b?(Ka.max=100,Ka.value=1):Infinity!==e&&(Ka.max=e);f.inventory&&f.inventory.length&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=f.inventory.length);ic.innerHTML=~~b+"/"+e;if(!Ob(f,A))return ha([]);f.point&&(b=f.point,Ea.x32=b[0],Ea.y32=b[1],ObjectsetupPosition(Ea,96*(qa-1)),Ea.show=1);if(!1===f.built)ha([a.stopBuilding]),
Ld(f);else if(f.techStart)ha([a.stopTech]),Ld(f),manamenu.style.display="block",manamenu.style.backgroundPosition="0px -200px",manamenu.innerHTML=100-~~(100*(f.c-u.cycle)/f.techStart)+"%",Ha.intv&&clearInterval(Ha.intv),Ha.intv=setInterval(function(){F[0]==f.id?manamenu.innerHTML=100-~~(100*(f.c-u.cycle)/f.techStart)+"%":clearInterval(Ha.intv)},400);else{yj();if(f.working){e=f.work;var c=H.page*H.length;b=0;for(var d=H.length;b<d;b++){var h=e[b+c];Ia[b].innerHTML=h?h:""}manamenu.style.display="block";
manamenu.style.backgroundPosition="0px -200px";var l=1E3*x[f.waitlist[0]].time;b=~~(100*(u.now()-f.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%";Ha.intv&&clearInterval(Ha.intv);Ha.intv=setInterval(function(){if(F[0]==f.id&&f.working){var b=~~(100*(u.now()-f.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%"}else clearInterval(Ha.intv)},400)}else for(b=0,e=H.length;b<e;Ia[b++].innerHTML="");ha(f.icons,f)}};Ha.intv=!1;var Md=function(){Nb.style.display="none";Ec.style.display="none";Fc.style.display=
"none";Ka.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";gf.innerHTML="";Nb.innerHTML="";Ec.innerHTML="";manamenu.innerHTML="";Fc.innerHTML="";ad.innerHTML="";ic.innerHTML="";Ka.value="";ic.maxLength="";Kd.style.display="none";hf();Gi()},L,Pa,Pb,yf,Qb={},eg=function(a,b,e){var c=e||B[F[0]];if("peon"==(e?c.clss:Pb))var f=!0;if(u.editor)return[jb,h];var h=a+b*y;if(L!=jb)return[L,h];a=Y[h];b=0;if(!c)return[b,h];if(2<a||(a=Gc[h])&&2<
a){var l=B[a];l.invisible||(f&&l.storage&&c.stock?b=pg:f&&void 0!=l.res?b=Bd:f&&l.health<l.maxHealth&&!Va.diplomacy[l.kingdom]&&l.build&&!l.dummy||l.dummy&&!l.built?b=Wc:Va.diplomacy[l.kingdom]||l.dummy&&Va.values.experience?b=qc:1===l.invType&&!c.build&&!c.boat&&0<l.invMax&&Ob(c,l)&&(b=yd))}else a=pa[h],2<a&&!c.build&&!c.boat&&(l=B[a],l.item?b=Uc:l.field&&f?b=re:1===l.invType&&!c.build&&!c.boat&&0<l.invMax&&Ob(c,l)&&(b=yd));0===b&&(c=qb[A.kingdom],c[h]&&f?(a=c[h],b=Wc):(l||(a=-h),b=xb,xb.cursor=
2));return[b,a]},F=[];F.change=1;var Hi,sk=document.getElementById("gold"),tk=document.getElementById("wood"),uk=document.getElementById("food"),vk=document.getElementById("stone"),ia,Cg;var Dg=!1;var Lb=function(a,b){var f=da,c=tzar.width,d=tzar.height;a=a*f-gb+.5*(c-f*c);b=b*f-rb+.5*(d-f*d);return[a,b]},sb=function(a){if(a){var b=a.pageX;a=a.pageY;sb.lastX=b;sb.lastY=a}else b=sb.lastX,a=sb.lastY;b=Lb(b-A.mx,a);a=b[1];b=b[0];0==Dg?(window.removeEventListener("mousemove",sb),Cg=!1):Cg=!0;if(1===ia[2]||
sb.forced)a=32*~~(a/32),b=32*~~(b/32);ia[4]=a;ia[6]=b;ia[9]=b;ia[10]=a},Ii=function(a,b){b=B[b];Y[a[0]+a[1]*y]==b.id?(b.point=void 0,F[0]==b.id&&(Ea.x32=2*y,ObjectsetupPosition(Ea,128*y),Ea.show=0)):(b.point=a,Ea.x32=a[0],Ea.y32=a[1],F[0]==b.id&&(ObjectsetupPosition(Ea,96*(qa-1)),Ea.show=1))},Ji=function(a){if(null==Bb.blocked||Bb.blocked==a.keyCode){var b=Bb[a.keyCode];K(a.keyCode);b&&b(1,a.keyCode)}},Ki=function(a){if(null==Bb.blocked||Bb.blocked==a.keyCode){var b=Bb[a.keyCode];b&&b(0,a.keyCode)}},
Li=function(a){var b=window.innerWidth,f=window.innerHeight,c=a.pageX,d=a.pageY;if(screen.height-10<=f){if(1.2==Math.abs(Cc)||0==Cc)Cc=1.2*((10>c)-(c>b-10));if(1.2==Math.abs(Dc)||0==Dc)Dc=1.2*((10>d)-(d>f-10))}c=Lb(c-A.mx,d);d=~~(.03125*c[1]);c=~~(.03125*c[0]);a.pageX<A.mx?gc(2):(a=eg(c,d)[0],0==a||void 0==a.cursor?gc(2):gc(a.cursor))},Mi=function(a){if(a.pageX>A.menumx){if(0==a.button){window.addEventListener("mousemove",sb);a=Lb(a.pageX-A.mx,a.pageY);var b=a[1];a=a[0];void 0!=fa.wall&&(a=fa.wall,
b=32*~~(a/y),a=a%y*32,sb.forced=!0,fa.wall=void 0);Dg=!0;ia[0]=a;ia[1]=b;ia[9]=ia[0];ia[10]=ia[1];ia[3]=ia[0];ia[7]=ia[1];jf=!1}}else jf=!0},jf=!1,Bk=function(a){if(a.pageX>A.menumx&&a.pageY>A.menumy&&!Pc&&0==jf){Dg=!1;var b=Lb(a.pageX-A.mx,a.pageY),f=~~(b[1]/32);b=~~(b[0]/32);K(b,f);var c=qa;if(2==a.button&&!u.editor){if(L!=jb){L=jb;return}if(0<F.length)if(c=B[F[0]],1!=c.build||c.arrow){if(0===L){L=jb;return}c=eg(b,f);a=c[1];c=c[0];c==xb&&(b={x32:b,y32:f,d:0,mv:1,img:k.cursor},Sa(b),yb.new(b,Ta(b.img)));
ea(c,a,F)}else ea(Ii,[b,f],F[0]);return!1}if(0==a.button){if(L==jb)return jb();a=b+f*c;if(L.spLevel)a=L.spLevel(a);else{var d=0;2<Gc[a]?d=Gc[a]:2<Y[a]?d=Y[a]:2<pa[a]&&(d=pa[a]);a=d}if(a)L.allowPos&&B[a].build&&(a=-(b+f*c));else if(L.allowPos||L.noObj)a=-(b+f*c);else return L=jb;L.noObj&&3<=a&&(a=-(b+f*c));L.item?(ea(L,a,[F[0],L.item]),L.item=void 0):ea(L,a,F);cb.shift||(L=jb)}}jf=!1},Ni=function(a){Bk(a);ia[0]=NaN;ia[1]=NaN;ia[9]=NaN;ia[10]=NaN;ia[3]=NaN;ia[7]=NaN;g.bindBuffer(g.ARRAY_BUFFER,Sb);
g.bufferSubData(g.ARRAY_BUFFER,0,ia);Pc&&(Pc=!1)},Oi=function(a){a=B[a];a.tempChild.quit(a.selectAnim);vb(a.selectAnim);a.selectAnim=void 0},jb=function(){for(var a=0,b=F.length;a<b;Oi(F[a++]));Id.actived&&(w(Id.actived).style.display="none");Pa&&(Oi(Pa.id),Pa=void 0);F.length=0;Pb=-1;Qb={};Kd.style.display="none";Xe.innerHTML="";Ye.innerHTML="";Ze.innerHTML="";$e.innerHTML="";af.innerHTML="";bf.innerHTML="";cf.innerHTML="";df.innerHTML="";Nb.className="";H.page=0;Ea.show&&(Ea.x32=2*y,ObjectsetupPosition(Ea,
128*y),Ea.show=0);var e=y,c=ia[0],d=ia[1];a=ia[9];var h=ia[10];if(0===d-h&&0===c-a){h=~~(c/32);var l=~~(d/32),g=d,k=c,m=0;for(a=0;3>a;a++){b=Ua[a];var n=h,q=l;c=k;d=g;2<b[n+q*e]?(c=n,d=q,m=B[b[c+d*e]]):(.5<=d/32-q?q++:q--,2<b[n+q*e]?(c=n,d=q,m=B[b[c+d*e]]):(.5<=c/32-n?n++:n--,2<b[n+q*e]?(c=n,d=q,m=B[b[c+d*e]]):(q=~~(d/32),2<b[n+q*e]&&(c=n,d=q,m=B[b[c+d*e]]))))}m.id||(m=qb[A.kingdom][h+l*e])&&(m=B[m]);if(m&&2<m.id&&(!m.invisible||Ob(m,A)))if(Qb[m.id]=1,F.length=0,m.setupChild(Ab.select,1,Xd),Ob(m,
A)&&!u.demo){F[0]=m.id;Pb=null!=m.defence?m.clss:-2;if(m.build)return Ha(m);if(256>Date.now()-Hi)for(e=~~(da*tzar.width*.03125),c=~~(da*tzar.height*.03125),h=~~(.03125*-gb+.5*(~~(.03125*tzar.width)-e)),g=~~(.03125*-rb+.5*(~~(.03125*tzar.height)-c)),c*=e,h+=g*y,a=0;a<c;a++)for(d=h+a%e+~~(a/e)*y,l=0;3>l;l++)g=Ua[l][d],2<g&&(k=B[g],k.clss!=m.clss||Qb[g]||!Ob(k,m)||k.item||(k.setupChild(Ab.select,1,Xd),Qb[g]=1,F.put(g)));Hi=Date.now()}else return Pa=m,Ac(m.id),!1}else if(!u.demo)for(c=~~(c/32),a=~~(a/
32),d=~~(d/32),h=~~(h/32),c>=a&&(m=c,c=a,a=m),d>=h&&(m=d,d=h,h=m),a++,m=[1,1,1],k=a-c,a=0,b=k*(h-d+1);a<b;a++)for(h=a%k+c,g=~~(a/k)+d,l=0;3>l;l++)n=Ua[l][h+g*e],q=B[n],q.selected=1,m[n]||(m[n]=1,q.build||!Ob(q,A)||q.item||(F[F.length]=n,q.setupChild(Ab.select,1,Xd),Qb[n]=1));1<F.length?Eg(F):1==F.length?Ac(F[0]):(ha([]),Md(),Pb=-1,F.length=0)},Pi=[manamenu,manamenu1],Qi={mana:{background:"0px -120px",progress:progressmana},food:{background:"0px -240px"},milk:{background:"0px -280px"},gold:{background:"0px -260px"},
stone:{background:"0px -320px"},wood:{background:"0px -340px"}},zk=["https://i.imgur.com/toj2Nv3.gif","https://i.imgur.com/TwImKWn.gif","https://i.imgur.com/wFIu276.gif","https://i.imgur.com/kIWwIhG.gif","https://i.imgur.com/JBGA2KM.gif"],Kd=document.getElementById("unitSpeed"),Ac=function(a,b,e){manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";a=B[a];a.sound&&!e&&(e=a.sound,xa(e[~~(e.length*Math.random())]));Pb=a.clss;a.inventory&&a.inventory.length&&
Ob(a,A)&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=a.inventory.length);b||(Ob(a,A)&&!u.demo?ha(a.icons,a):hf());ad.style.display="block";gf.innerHTML=a.name;a.attack&&a.item||void 0!==a.attack?(Nb.innerHTML=a.attack,Nb.style.display="block"):Nb.style.display="none";a.defence&&a.item||void 0!==a.defence?(Ec.innerHTML=a.defence,Ec.style.display="block"):Ec.style.display="none";a.mana&&!a.manaTarget&&(manamenu.style.display="block",manamenu.innerHTML=
a.mana,manamenu.style.backgroundPosition="0px -120px");b=0;var c=a.update;if(c){b=0;for(var f=c.length;b<f;b+=3){var h=c[b],l=Qi[h];e=Pi[b/3];e.innerHTML=a[h];e.style.display="block";e.style.backgroundPosition=l.background;"mana"==h&&a.manaTarget&&(e.innerHTML=~~(100*a.mana/a.manaTarget+.5)+"%",e.style.backgroundPosition="0px -200px");l.progress&&(l.progress.style.display="block",l.progress.value=a[h],l.progress.max=a[h+"Max"])}}a.stock&&(c=a.stock,e=Pi[b/3],e.style.display="block",e.style.backgroundPosition=
Qi[c[4].icon].background,e.innerHTML=c[0]);b=a.level?a.level:0;Fc.innerHTML=b;Fc.style.display="block";0===b&&(a.item||a.build)&&(Fc.style.display="none");ad.innerHTML=J[a.kingdom].name;Ka.style.display="block";Ri(a);Ld(a)},Ri=function(a){var b=a.health;a=a.maxHealth;Infinity==b?(Ka.value=100,Ka.max=100,ic.innerHTML=b):(Ka.value=b,Infinity==a?(Ka.max=100,Ka.value=1):Ka.max=a,ic.innerHTML=~~b+"/"+a)},Eg=function(a,b){for(var f=B[a[0]],c=0,d=0,h=f.clss,l=a.length,g={},k=[],m=0;m<l;m++){f=B[a[m]];c+=
f.maxHealth;d+=f.health;Pb=h!=f.clss?-1:!0;for(var n=f.icons,q=n.length,r=0;r<q;r++){var u=n[r].id;void 0===g[u]?g[u]=1:g[u]++;g[u]===l&&k.put(n[r])}}!0===Pb&&(Pb=f.clss);d=Infinity==d?100:~~(d/c*100);ic.innerHTML=d+"/100(%)";Si();gf.innerHTML="";Nb.style.display="none";Ec.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";Fc.style.display="none";ad.innerHTML=l+" "+z.units;Ka.style.display="block";Ka.value=d;Ka.max=100;b||(!0!==Pb?ha(k):
ha(f.icons))},dh=function(){};new Float32Array(8);var Ya,Nc,Sb,ld,id,da=1,Ck=function(a){vb(a);Yb.put(a.bufferID)},yb={table:{},dates:[],new:function(a,b,e){b=Math.floor(b)+u.now();var c=this.table;e||(e=Ck);c[b]||(c[b]=[]);a.animFunc=e;c[b].put(a);this.dates.add(b);this.needOrder=!0}},Ta=function(a){a=ta[a];return 0>a[1]?k.delay[a[0]-a[1]-1]:a[0]/a[1]*1E3},sa=new Float32Array(12),dg=function(a){var b=a.id+u.arje+a.x32+a.y32;a.rnd=[4294967295+b,4294967295-b,0]},Fg=function(a){a=B[a];a.mlist&&Ti(a,
!0);a.hlist&&Ti(a,!1)},Ti=function(a,b){if(b)var f=a.mlist,c=a.mlistID,d=bd.mercenaries;else f=a.hlist,c=a.hlistID,d=bd.heroes;f.unshift(d[Rh(a,d.length)]);b?c.unshift(a.mercID++):c.unshift(a.heroID++);8<f.length&&(f.length=8,c.length=8);H.active==f&&ha(f);mb(a,5E4)},Gg=function(f){f=B[f];var b=J[f.kingdom],e=16+4*b.crusade.number;b.crusade.number++;32<e&&(e=32);var c=b.crusade.list;c.length=e;for(var d=0;d<e;d++)(c[d]=wc(8,f,1)).deleteFromList=c;xa("crusade",f.x32,f.y32);b.technology.disabled[a.createCrusaders.id]=
1;Z(f.id)},qk=function(f){J[f.kingdom].technology.disabled[a.createCrusaders.id]=0},Oc,Y=[],pa=[],Gc=[],Ua=[];Ua.length=3;var hf=function(){for(var a=H.displayed.length=0,b=H.length;a<b;a++){var e=Ia[a];e.className="blocked";e.style.backgroundPosition="48px 96px";We[a]=Hg}H.rightButton.className="blocked";H.leftButton.className="blocked";H.stock.className="blocked";H.rightBlocked=1};H.leftButton.onclick=function(){H.page&&(H.page--,ha(H.active,0,H.stockActive))};H.rightButton.onclick=function(){H.rightBlocked||
(H.page++,ha(H.active,0,H.stockActive))};H.displayed=[];var ha=function(a,b,e){e=!!e;b||(b=NaN);var c=a.olegal||NaN;if(b.working&&!e)var f=1;H.active=a;H.displayed.length=0;var h=Va.technology,l=H.page,g=H.length;hf();!1!==e&&b?H.stockActive=b:!1===e&&(H.stockActive=!1);ha.actv={};a.length<=l*g&&a.length&&(H.page--,l--);for(var k=0,m=0,n;k<g;k++){n=a[k+l*g];if(!n)break;var q=Ia[m];if(!e&&(ha.actv[n.id]=1,h.hidden[n.id]||n.obj.tech&&f)){g++;continue}q.style.backgroundPosition=48*e+"px "+(-e||1)*n.iconID*
48+"px";e||!h.disabled[n.id]||c[n.id]?(q.className="",We[m]=n):q.className="blocked";H.displayed[m]=n;m++}a[k+l*g]&&(H.rightButton.className="",H.rightBlocked=0);0<l&&(H.leftButton.className="");1===F.length&&(b=B[F[0]]);b.inventory&&0<b.inventory.length&&(H.stock.className="")};ha.actv={};var ch,la,ba,zf;var g=document.getElementById("tzar").getContext("webgl2",{antialias:!0,alpha:!1});A.gl=!!g;if(g){var Dk=g.getExtension("WEBGL_lose_context");g.canvas.addEventListener("webglcontextlost",function(a){setTimeout(function(){Dk.restoreContext()},
2E3);a.preventDefault()},!1);g.canvas.addEventListener("webglcontextrestored",function(a){K("restored 2")},!1)}var bh,Af,Bf,fh,Ud,tf,sf,Td,Vd,jd,hd,Mc,uf,vf,Za=function(){if(u.canceled)return 0;requestAnimationFrame(Za);var a=Za.fp1000,b=Za.delta,e=Za.now,c=Za.frameCount;performance.now();var d=e;Za.frameCount++;e=u.now();Za.now=e;b=(b+(e-d))/1E3;Za.delta=b;if(!(c%8||u.editor)){c=u.now()/1E3;d=~~(c/60)%60;var h=~~(c/3600);c=~~(c%60);w("topinfo").innerHTML=~~(1/b)+"fps "+h+":"+d+":"+c}Za.fp1000=a+
b;a=yb.table;c=yb.dates;yb.needOrder&&(c.sort(function(a,b){return a-b}),yb.needOrder=0);for(d=0;c[d]<=e+17;d++){h=a[c[d]];for(var l=0,k=h.length;l<k;l++){var p=h[l];p.animFunc(p)}delete a[c[d]];d--;c.shift()}if(0!=Cc||0!=Dc)gb+=Cc*b*640*da,rb+=Dc*b*640*da,kd(-gb,-rb),sb();wi(e);dh();g.uniform1f(bh,e);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);if(b=Ca.length)g.bindFramebuffer(g.FRAMEBUFFER,fb),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,fh),d=Ca,d.changed&&(d.typed=new Uint32Array(d),d.changed=!1,g.bufferData(g.ELEMENT_ARRAY_BUFFER,
d.typed,g.STATIC_DRAW)),g.enable(g.BLEND),g.blendEquation(g.MAX),g.blendFunc(g.SRC_COLOR,g.SRC_COLOR),g.bindTexture(g.TEXTURE_2D,zf),g.drawElements(g.TRIANGLES,b,g.UNSIGNED_INT,0),g.bindTexture(g.TEXTURE_2D,Lighttexture),g.disable(g.BLEND),g.bindFramebuffer(g.FRAMEBUFFER,null);Ui(Af);a=window.innerWidth;c=window.innerHeight;g.viewport(A.marx,c-$a-A.mary,Tb,$a);g.uniform2f(Ud,32*y,32*qa);g.uniform2fv(jd,[0,0]);g.uniform1i(Vd,1);g.uniform1f(Oc,1);Ui(Af);g.viewport(A.mx,0,a,c);performance.now();g.useProgram(ba);
g.bindVertexArray(uf);g.uniform1f(tf,~~((.01*e+.5)%5));g.drawArrays(g.TRIANGLES,0,6);g.viewport(A.marx,c-$a-A.mary,Tb,$a);g.uniform1i(Td,1);g.uniform2fv(hd,[0,0]);g.uniform1f(Mc,4/y);g.drawArrays(g.TRIANGLES,0,6);g.uniform1i(Td,0);g.uniform2f(sf,a,c);g.uniform2fv(hd,[gb,rb]);g.uniform1f(Mc,1/da);g.viewport(A.mx,0,a,c);g.useProgram(la);g.bindVertexArray(vf);if(b=ca.length)g.enable(g.BLEND),g.blendEquation(g.FUNC_ADD),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),g.bindBuffer(g.ARRAY_BUFFER,Sb),a=
tzar.width,c=tzar.height,e=-gb+.5*(a-da*a),d=-rb+.5*(c-da*c),h=da*(a-A.mx),l=da*c,g.bufferSubData(g.ARRAY_BUFFER,0,new Float32Array([e,d,24576,e+h,d,24576,e,d+l,24576,e+h,d+l,24576])),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,Bf),d=ca,d.changed&&(d.typed=new Uint32Array(d),d.changed=!1,g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.typed,g.STATIC_DRAW)),g.viewport(A.marx,c-$a-A.mary,Tb,$a),g.drawElements(g.TRIANGLES,12,g.UNSIGNED_INT,0),g.uniform1i(Vd,0),g.uniform2f(Ud,a,c),g.uniform2fv(jd,[gb,rb]),g.uniform1f(Oc,
1/da),g.viewport(A.mx,0,a,c),g.bindBuffer(g.ARRAY_BUFFER,Sb),Cg&&!Ig?g.bufferSubData(g.ARRAY_BUFFER,0,ia):g.bufferSubData(g.ARRAY_BUFFER,0,new Float32Array([NaN,NaN,24576,NaN,4347,24576,5551,NaN,24576,NaN,NaN,24576])),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,Bf),d=ca,d.changed&&(d.typed=new Uint32Array(d),d.changed=!1,g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.typed,g.STATIC_DRAW)),g.drawElements(g.TRIANGLES,b,g.UNSIGNED_INT,0),g.disable(g.BLEND);fa.active&&(e=fa.x,d=fa.y,b=96*y,sa[0]=e,sa[1]=d,sa[2]=b,sa[3]=
e,sa[4]=d,sa[5]=b,sa[6]=e,sa[7]=d,sa[8]=b,sa[9]=e,sa[10]=d,sa[11]=b,e=fa.bufferID,g.bindBuffer(g.ARRAY_BUFFER,Sb),g.bufferSubData(g.ARRAY_BUFFER,12*e,sa),fa.active=!1)},Ui=function(a){var b=aa.length;b&&(g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,a),a=aa,a.changed&&(a.typed=new Uint32Array(a),a.changed=!1,g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.typed,g.STATIC_DRAW)),g.drawElements(g.TRIANGLES,b,g.UNSIGNED_INT,0))},fd=!1,oa=function(a,b){return a<y&&0<=a&&0<=b&&b<qa?!0:!1};Array.prototype.put=function(a){this[this.length]=
a};var Hg=function(){},Ab,Nd,Kb,Jg,Hc=function(a,b,e,c){c&&0==Hc.cols[c]&&(Hc.list.push(c,a),Hc.cols[c]=1)};Hc.cols={};Hc.list=[];window.onerror=Hc;var u={},ta=[],Ek=function(a,b,e,c){for(var f=0,h=Object.keys(a),l=0,g=h.length;l<g;l++){var k=h[l],m=a[k];if(Array.isArray(m)){a[k]=f;m.url=f;k=ta[f++]=m;var n=m.deltaY?m.deltaY:0;k.id=c/4;for(var q=6,r=k.length;q<r;q+=6){var u=k[q-2],v=k[q-1],w=k[q+2],x=k[q+3];b[c++]=k[q]/e;b[c++]=(n+k[q+1])/e;b[c++]=u;b[c++]=v;b[c++]=(k[q]+w)/e;b[c++]=(k[q+1]+n)/e;
b[c++]=u+w;b[c++]=v;b[c++]=k[q]/e;b[c++]=(k[q+1]+x+n)/e;b[c++]=u;b[c++]=v+x;b[c++]=(k[q]+w)/e;b[c++]=(k[q+1]+x+n)/e;b[c++]=u+w;b[c++]=v+x}}else for(var y=Object.keys(m),z=0,B=y.length;z<B;z++)for(k=m[y[z]],k.id=c/4,k.url=f,m[y[z]]=f,ta[f++]=k,n=k.deltaY?k.deltaY:0,q=6,r=k.length;q<r;q+=6)u=k[q-2],v=k[q-1],w=k[q+2],x=k[q+3],b[c++]=k[q]/e,b[c++]=(n+k[q+1])/e,b[c++]=u,b[c++]=v,b[c++]=(k[q]+w)/e,b[c++]=(k[q+1]+n)/e,b[c++]=u+w,b[c++]=v,b[c++]=k[q]/e,b[c++]=(k[q+1]+x+n)/e,b[c++]=u,b[c++]=v+x,b[c++]=(k[q]+
w)/e,b[c++]=(k[q+1]+x+n)/e,b[c++]=u+w,b[c++]=v+x}return c},T=function(a,b,e,c){var f=0,h=e.length-1,l=e[h];c=qb[c];var g=[],k=0,m=!0;oa(a,b)&&oa(a+l-1,b+h/l-1)||(m=!1);for(var n=y,q=0;q<h;q++){f==l&&(f=0,b++);if(e[q]){var r=a+f+n*b;c[r]&&(m=!1);if(0<Y[r]||Mb[r])m=!1;g[k++]=r}f++}return[g,m]};T.check=function(a,b,e,c,d,h,l){var f=e.length-1;e=e[f];var g=f/e;f=y;l=qb[l];e+=2;--a;--b;g=e*(g+2);for(var k=0;k<g;k++){var n=a+k%e,q=b+~~(k/e),r=n+q*f;if(0<Y[r]||Mb[r]||h&&(n>=d&&n<=d+2||q>=c&&q<=c+2)||!oa(n,
q)||l[r])return!1}return!0};var Vi=function(a,b,e){var c=0,f=e.length-1,h=e[f],l=[],g=[],k=0,m=!0;oa(a,b)&&oa(a+h-1,b+f/h-1)||(m=!1);for(var n=0,q=0;q<f;q++){c==h&&(c=0,b++);var r=a+c+y*b;e[q]?(2<Y[r]&&(m=!1),l[k++]=r):(g[n++]=r,2<Y[r]&&(m=!1));c++}return[l,m,g]},Wi=function(a,b,e){var c=0,f=e.length-1,h=e[f],l=[],g=0,k=!0;oa(a,b)&&oa(a+h-1,b+f/h-1)||(k=!1);for(var m=0;m<f;m++){c==h&&(c=0,b++);var n=a+c+b*y;if(e[m]&&2<Y[n]&&1==B[Y[n]].build||0<pa[n])k=!1;l[g++]=n;c++}return[l,k]},kf=function(a,b,
e){var c=!1,f=0,h=[],l=0,g=e.length-1,k=e[g],m=0,n=!0;oa(a,b)&&oa(a+k-1,b+g/k-1)||(n=!1);for(var q=0;q<g;q++){m==k&&(m=0,b++);if(e[q]){var r=a+m+y*b,u=Y[r];2<u&&(n=!1);0<u?f++:c=!0;h[l++]=r}m++}f>.5*(g-1)&&c||(n=!1);return[h,n]},Od=function(a,b,e){e=!0;oa(a,b)||(e=!1);1!==pa[a+b*y]&&(e=!1);return[[a+b*y],e]},Q=function(a,b,e){e=!0;oa(a,b)||(e=!1);0<Y[a+b*y]&&(e=!1);return[[a+b*y],e]},lf=function(a,b,e){e=!0;oa(a,b)||(e=!1);0<Gc[a+b*y]&&(e=!1);return[[a+b*y],e]},Cb=function(a,b,e){e=!0;oa(a,b)||(e=
!1);if(0<pa[a+b*y]||2==Y[a+b*y]||1==Y[a+b*y])e=!1;return[[a+b*y],e]},Fk=function(a){for(var b=Object.keys(a),f=P.common.length/1048576,c=0,d=b.length;c<d;c++)a[b[c]].deltaY=512*f},fa,E,Qa,ab,Bj=function(){fa={img:0,x32:-1E3,y32:-1E3,rgb:[0,0,0,.5],d:0,active:!1};var f=8,b=9;if(!fd){Gk();var e=[a.move,a.attack,a.guard,a.patrol,a.pickUp,a.explore,a.stop,a.stand,a.sameSpeed,a.restoreSpeed];Nd={magic_creatures:[58,40,59,5,78,77,60,130,131,132,89,129]};for(var c=Object.keys(Nd),d=0,h=c.length;d<h;d++){var l=
Nd[c[d]],g={};l.obj=g;for(var p=0,m=l.length;p<m;g[l[p++]]=1);}bd.mercenaries=[a.mercArcher,a.mercFootman,a.mercMaceman,a.mercLongbowman,a.mercPikeman,a.mercKnight,a.mercArcherAsian,a.mercSamurai,a.mercHourseSamurai,a.mercRonin,a.mercHorseArcher,a.mercChariot,a.mercFootmanArab,a.mercArcherArab,a.mercMacemanArab,a.mercPikemanArab,a.mercCavalry,a.mercEnichar,a.mercJihad];bd.heroes=[a.mercArcher6,a.mercFootman6,a.mercMaceman6,a.mercLongbowman6,a.mercPikeman6,a.mercKnight6,a.mercArcherAsian6,a.mercSamurai6,
a.mercHourseSamurai6,a.mercRonin6,a.mercHorseArcher6,a.mercChariot6,a.mercFootmanArab6,a.mercArcherArab6,a.mercMacemanArab6,a.mercPikemanArab6,a.mercCavalry6,a.mercEnichar6,a.mercJihad6];c=bd.mercenaries;d=0;for(h=c.length;d<h;c[d++].merc=9);c=bd.heroes;d=0;for(h=c.length;d<h;c[d++].hero=1);m=k;m.build2x2[2]=1;m.build3x3[2]=1;m.build4x4[2]=1;m.build5x5[2]=1;m.build6x6[2]=1;m.items1[2]=1;m.build_harbor[2]=1;m.bridge_horz_build[2]=1;m.bridge_vert_build[2]=1;m.sexplosion[0]=13;m.sexplosion[1]=25;m.flame_trail[0]=
16;m.flame_trail[1]=25;d=0;for(p=m.flame_trail.length;d<p;d+=6)m.flame_trail[4+d]-=32,m.flame_trail[5+d]-=32;d=0;for(p=m.sexplosion.length;d<p;d+=6)m.sexplosion[4+d]-=48,m.sexplosion[5+d]-=48;m.items1[1]=0;m.books[1]=0;m.potions[1]=0;m.troll.attack[1]=14;m.ork.attack[1]=14;m.dwarf.attack[1]=14;m.asian_mage.move[1]=14;m.arab_priest.attack=m.arab_priest.spell;m.asian_mage.spell=m.asian_mage.castspell;m.asian_mage.attack=m.asian_mage.castspell;m.asian_mage.spell[1]=13;m.arab_horse_archer.move=m.arab_horse.archer;
m.arab_jwarrior.attack[1]=14;m.arab_peasant.attack=m.arab_peasant.attack1;m.arab_peasant.tree=m.arab_peasant.wood;m.asian_peasant.attack=m.asian_peasant.attack1;m.asian_peasant.cut=m.asian_peasant.chop;m.asian_peasant.tree=m.asian_peasant.wood;m.asian_peasant.dig[1]=14;m.asian_archer.die[1]=14;m.asian_ronin.attack=m.asian_ronin.attack1;d=0;for(p=m.turn_to_stone.length;d<p;d+=6)m.turn_to_stone[4+d]-=56,m.turn_to_stone[5+d]-=64;m.arab_tcguild_c[4]=31;m.arab_tcguild_c[5]=85;m.dragon.idle=m.dragon.move;
m.asian_samurai.attack=m.asian_samurai.attack1;m.asian_horsamurai.idle=m.asian_horsamurai.idle1;m.asian_horsarcher.idle=m.asian_horsarcher.idle2;m.asian_priest.attack=m.asian_priest.attack1;m.asian_priest.spell=m.asian_priest.pray;m.asian_monk.attack[1]=12;m.euro_mage.attack=m.euro_mage.spell;m.euro_ghost.idle=m.euro_ghost.move;m.euro_priest.attack=m.euro_priest.spell;m.arab_mage.spell=m.arab_mage.attack;m.cursor[1]=15;m.star[1]=15;m.select[4]+=3;m.select[5]+=3;m.arab_houses_c[f]=96;m.asia_houses_c[f]=
96;m.asia_houses_c[4]-=9;m.asia_houses_c[5]-=15;m.wood_build[2]=1;m.res_gold[2]=1;m.res_gold_s[2]=1;m.res_stone[2]=1;m.res_stone_s[2]=1;m.bridge_horz1[4]=-9;m.bridge_horz1[5]=132;m.bridge_horz1[4]=-9;m.bridge_horz1[5]=132;m.euro_stable_c[4]+=18;m.euro_stable_c[5]-=10;m.euro_lumbermill_s[4]-=19;m.euro_lumbermill_s[5]-=17;m.wood_tower_c[4]=0;m.wood_tower_c[5]*=1;m.bat.idle=m.bat.move;d=0;for(p=m.curse.length;d<p;d+=6)m.curse[5+d]-=48;d=0;for(p=m.impersonate.length;d<p;d+=6)m.impersonate[5+d]-=48;d=
0;for(p=m.bless.length;d<p;d+=6)m.bless[5+d]-=48;d=0;for(p=m.euro_barracks_c.length;d<p;d+=6)m.euro_barracks_c[4+d]+=50;d=0;for(p=m.healing.length;d<p;d+=6)m.healing[5+d]-=48;d=0;for(p=m.expl_small_hole.length;d<p;d+=6)m.expl_small_hole[4+d]-=4,m.expl_small_hole[5+d]-=34;Date.now();c=[a.createKnight,a.createHorseArcher1,a.createHorseArcher2,a.createHorseSamurai,a.createChariot,a.createEnichar,a.createCavalry]}if(Ef){Ef=!1;K("TErrain changed");d=0;for(h=P.xtra.length;d<h;d++){m=P.xtraRes[d].coords;
Fk(m);m.terrain_water[f]=512;m.terrain_water[b]=512;m.terrain_water[6]+=32;m.terrain_water[7]+=32;l=0;for(p=m.terrain_tree.length;l<p;l+=6)m.terrain_tree[4+l]-=32,m.terrain_tree[5+l]-=96;l=0;for(p=m.terrain_tree_s.length;l<p;l+=6)m.terrain_tree_s[5+l]-=32;m.terrain_tree[2]=1;Object.assign(k,m)}f=P.size;h=new Float32Array(1048576);m=Ek(k,h,f,0);P.info=h;P.ids=m/16}if(!fd){Kb={sword:{name:"Sword",iconID:16,img:k.items1,d:0,dMax:7,attack:1,type:52,sword:1},bow:{name:"Bow",iconID:4,img:k.items1,d:15,
dMax:4,attack:1,type:52,sword:1},shield:{name:"Shield",iconID:1,img:k.items1,d:8,dMax:6,defence:1,type:52,shield:1},potion:{name:"Potion",iconID:11,img:k.potions,d:0,dMax:7,type:52,potion:1},book:{name:"Book",iconID:9,img:k.books,d:0,dMax:4,type:52,book:1},gold:{name:"Gold",iconID:20,img:k.item_gold,d:0,dMax:0,type:52},stone:{name:"Stone",iconID:22,img:k.item_stone,d:0,dMax:0,type:52},food:{name:"Food",iconID:14,img:k.item_food,d:0,dMax:0,type:52},wood:{name:"Wood",iconID:15,img:k.item_tree,d:0,dMax:0,
type:52},iron:{name:"Iron",iconID:21,img:k.item_iron,d:0,dMax:0,type:52}};Jg=[Kb.sword,Kb.potion,Kb.book,Kb.bow,Kb.shield];h=[a.move,a.attack,a.stop,a.stand,a.pickUp,a.explore,a.healing,a.bless];f=[a.attack,a.guard,a.patrol,a.explore,a.stop,a.stand,a.attackGround,a.steady,a.move];b=[a.buildAcademy,a.buildWorkshop,a.buildWorkshop1,a.buildAcademy1,a.buildWorkshop2,a.buildAcademy2];d=[a.buildMerchands1,a.buildMerchands2,a.buildMerchands];ab={euro:{},asia:{},arab:{},common:{}};x=[{name:"Footman",attack:6,
defence:3,health:65,maxHealth:65,img:k.euro_footman.idle,attackSound:oc,invType:0,invMax:8,validator:Q,human:12,iconID:36,time:12,sight:5,url:k.euro_footman,icons:e,cost:[0,0,50,0],attDist:1,spd:50,dieSound:lb,clss:"footman",size:1,standardFunc:W,radix:0,zLevel:1,strID:"e_footman",race:"euro"},{name:"Pikeman",radix:0,attackSound:oc,attack:8,defence:4,health:75,maxHealth:75,img:k.euro_pikeman.idle,invType:0,dieSound:lb,invMax:8,validator:Q,human:1,iconID:39,time:18,sight:5,url:k.euro_pikeman,icons:e,
cost:[40,0,60,0],attDist:1,spd:50,standardFunc:W,clss:"e_pikeman",zLevel:1,size:1,strID:"e_pikeman",nu:a.createPikeman,race:"euro"},{name:"Spy",radix:0,attack:20,defence:0,mana:100,manaMax:100,health:50,maxHealth:50,img:k.euro_spy.idle,attackSound:["spy%20kill%201","spy%20kill%202","spy%20kill%203"],invType:0,invMax:8,validator:Q,human:1,dieSound:lb,iconID:41,time:30,sight:12,url:k.euro_spy,icons:[a.move,a.attack,a.guard,a.patrol,a.pickUp,a.explore,a.stop,a.stand,a.impersonate,a.revealSelf],zLevel:1,
cost:[120,0,0,0],attDist:1,spd:50,clss:"spy",standardFunc:W,size:1,update:["mana","manaSpeed",1E3],isSpy:1,strID:"spy",nu:a.createSpy,race:"common"},{name:"Maceman",radix:0,attack:8,defence:0,health:120,maxHealth:120,img:k.euro_maceman.idle,attackSound:oc,invType:0,invMax:8,validator:Q,human:1,iconID:37,time:14,dieSound:lb,sight:5,zLevel:1,url:k.euro_maceman,icons:e,cost:[0,0,120,0],attDist:1,spd:50,clss:"maceman",standardFunc:W,size:1,strID:"e_maceman",nu:a.createMaceman,race:"euro"},{radix:0,name:"Archer",
attack:5,defence:0,health:50,maxHealth:50,img:k.euro_archer1.idle,invType:0,invMax:8,validator:Q,human:1,sight:10,dieSound:lb,arrow:!0,iconID:38,zLevel:1,time:12,url:k.euro_archer1,icons:e,cost:[0,20,40,0],attDist:7,spd:50,clss:"archer",standardFunc:W,attimg:k.arrow1,attackSound:nd,size:1,strID:"e_archer",nu:a.createArcher,race:"euro"},{radix:0,name:"Wizard",attackSound:Sj,dieSound:["mage"],attack:5,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:k.euro_mage.idle,zLevel:1,invType:0,invMax:8,
validator:Q,human:1,iconID:42,time:30,sight:15,url:k.euro_mage,icons:[a.stop,a.pickUp,a.explore,a.lightning,a.createBat,a.freeze,a.createGolem,a.invisibility,a.stand,a.attack,a.move],cost:[150,0,0,0],attDist:10,attimg:k.flame_bolt,ball:1,spd:50,clss:"mage",standardFunc:W,size:1,update:["mana","manaSpeed",1E3],strID:"e_mage",nu:a.createMage,race:"euro"},{radix:0,name:"Longbowman",attack:6,defence:2,health:50,maxHealth:50,img:k.euro_longbowman.idle,zLevel:1,invType:0,invMax:8,dieSound:lb,attackSound:nd,
arrow:!0,validator:Q,race:"euro",human:1,iconID:35,time:18,sight:18,url:k.euro_longbowman,icons:e,cost:[50,0,90,0],attDist:12,spd:50,standardFunc:W,clss:"longbowman",size:1,d2attack:2,strID:"e_longbowman",attimg:k.arrow1,nu:a.createLongbowman},{radix:0,clss:"tree",name:"Tree",health:100,maxHealth:100,img:k.terrain_tree,invType:0,invMax:8,zLevel:1,mMapcolor:[11,131,11],validator:Q,child:[{img:k.terrain_tree_s,rgb:[0,0,0,.5],alpha:1,x:0,y:0}],iconID:23,url:k.terrain_tree,dimgInfinity:k.terrain_tree,
dimgRND:3,icons:[],res:1,race:"common",build:!0,size:1,zolotoy:1,strID:"tree"},{radix:0,name:"Crusader",zLevel:1,dieSound:ae,attackSound:Zd,attack:14,defence:8,health:180,maxHealth:180,img:k.crus.idle,invType:0,invMax:8,validator:Q,human:1,race:"euro",iconID:100,time:19,sight:5,url:k.crus,icons:e,cost:[0,0,0,0],attDist:1,spd:85,standardFunc:W,clss:"crusader",size:1,strID:"crusader"},{radix:0,name:"Priest",attack:20,defence:0,mana:100,manaMax:100,health:60,maxHealth:60,img:k.euro_priest.idle,invType:0,
zLevel:1,invMax:8,validator:Q,human:1,iconID:40,time:30,ball:1,sight:21,dieSound:lb,url:k.euro_priest,icons:h,attackOnly:Nd.magic_creatures.obj,cost:[150,0,0,0],attDist:18,race:"euro",spd:50,standardFunc:W,clss:"priest",size:1,update:["mana","manaSpeed",1E3],strID:"e_priest",nu:a.createPriest,attimg:k.flame_bolt},{radix:0,name:"Peasant",attackSound:zh,attack:5,defence:0,health:50,maxHealth:50,img:k.euro_peasant.idle,invType:0,invMax:8,dieSound:lb,zLevel:1,validator:Q,human:1,race:"euro",iconID:33,
time:8,sight:5,url:k.euro_peasant,icons:[a.move,a.menuBuilds,a.repair,a.conquest,a.dcm,a.pickUp,a.explore,a.stop,a.stand,a.attack,a.bribe,a.sameSpeed,a.restoreSpeed],cost:[0,0,50,0],attDist:1,spd:50,clss:"peon",size:1,peon:1,strID:"e_peon",nu:a.createPeon,nocapture:1},{radix:0,clss:"cathedral",name:"Cathedral",dieSound:M,sound:["e_cathedral1","e_cathedral2"],resistance:700,health:5E3,maxHealth:5E3,img:k.euro_cathedral,invType:0,invMax:8,race:"euro",zLevel:1,validator:T,bimg:k.build5x5,dimg:k.des_5x5,
iconID:60,icons:[a.createCrusaders,a.techFanaticism,a.techEspionage,a.techInquisition,a.techHealing,a.techBless,a.techCrusade,a.techMedicine],time:90,sight:8,child:[{img:k.euro_cathedral_c,x:0,y:0},{img:k.euro_cathedral_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,5]),url:k.euro_cathedral,build:!0,cost:[2E3,0,0,2E3],onbuild:[a.buildChurch],size:1,strID:"cathedral"},{radix:0,name:"Castle",clss:"castle",dieSound:M,sound:["e_castle1"],resistance:700,
health:8E3,maxHealth:8E3,img:k.euro_castle,invType:1,invMax:50,race:"euro",zLevel:1,validator:T,bimg:k.build6x6,dimg:k.des_6x6,iconID:59,time:120,sight:12,child:[{img:k.euro_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:k.euro_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[a.createPeon,a.createSpy,a.emergeAllUnits,a.techFeudalism,a.techArchitecture,a.techLearning],space:new Uint8Array([0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,7]),menu:Ha,url:k.euro_castle,
build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1,strID:"e_castle"},{radix:0,name:"Wooden Wall",clss:"wall_wood",resistance:700,health:2E3,maxHealth:2E3,img:k.wood_tower,time:6,sight:1,zLevel:1,dieSound:M,validator:Q,bimg:k.wood_build,dimgInfinity:k.wood_debris,iconID:49,icons:[],mx:0,race:"common",my:0,hframe:71,menu:Ha,url:k.wood_tower,wall:1,build:!0,cost:[0,0,20,0],size:1,strID:"woodwall",child:[{img:k.wood_tower_c,x:0,y:0}]},{radix:0,name:"Barracks",clss:"barracks",strID:"e_barrack",
sound:Ah,generator:1,resistance:500,health:1400,maxHealth:1400,img:k.euro_barrack,invType:1,invMax:0,dieSound:M,time:60,sight:6,zLevel:1,race:"euro",validator:T,bimg:k.build5x5,dimg:k.des_5x5,child:[{img:k.euro_barracks_c,mv:!0},{img:k.euro_barrack_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:57,icons:[a.createFootman,a.createArcher,a.createMaceman,a.createPikeman,a.createLongbowman,a.createKnight],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:k.euro_barrack,build:!0,
cost:[0,200,0,200],size:1},{radix:0,strID:"e_lumber",name:"Lumber Mill",sound:["e_lumber1"],clss:"lumber_mill",resistance:500,health:800,maxHealth:800,img:k.euro_lumbermill,invType:1,invMax:0,time:30,race:"euro",sight:4,dieSound:M,zLevel:1,validator:T,bimg:k.build2x2,dimg:k.des_2x2,iconID:64,child:[{img:k.euro_lumbermill_c,x:0,y:0},{alpha:!0,img:k.euro_lumbermill_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[a.techLongbow,a.techWoodCutting,a.techCrossbow],space:new Uint8Array([1,1,1,1,2]),hframe:98,url:k.euro_lumbermill,
build:!0,cost:[0,100,0,0],storage:1,size:1},{radix:0,name:"Mage Tower",strID:"e_magetower",sound:["e_magetower1","e_magetower2","e_magetower3"],clss:"magictower",resistance:700,health:5E3,maxHealth:5E3,img:k.euro_magetower,invType:1,invMax:0,time:90,race:"euro",dieSound:M,sight:8,validator:T,bimg:k.build5x5,dimg:k.des_5x5,zLevel:1,child:[{img:k.euro_magetower_c,x:0,y:0},{img:k.euro_magetower_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:71,icons:[a.createMage,a.techBat,a.techInvisibility,a.techLightning,
a.techFreeze,a.techGolem],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.euro_magetower,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,strID:"e_waracademy",name:"Warriors Guild",sound:["e_waracademy1"],clss:"academy",resistance:700,health:5E3,maxHealth:5E3,img:k.euro_waracademy,invType:1,invMax:0,race:"euro",time:90,sight:8,dieSound:M,zLevel:1,validator:T,bimg:k.build6x6,dimg:k.des_6x6,iconID:56,child:[{img:k.euro_waracademy_c,x:0,y:0,mv:!0},{img:k.euro_waracademy_s,x:0,y:0,rgb:[0,
0,0,.5],alpha:!0}],icons:[a.techHeroism,a.techWarfare,a.techMercenaries,a.techSiegeTactics,a.techBodyBuilding,a.techLeadership,a.techTactics,a.techHeroes,a.techHonor,a.techFame],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,5]),url:k.euro_waracademy,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,name:"Storage",strID:"e_storage",sound:["e_storage1","e_storage2"],clss:"storage",resistance:80,health:800,maxHealth:800,img:k.euro_storage,invType:1,invMax:0,time:30,dieSound:M,zLevel:1,
sight:5,validator:T,bimg:k.build4x4,dimg:k.des_4x4,iconID:69,race:"euro",icons:[a.techGoldMining,a.techStoneMining],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:k.euro_storage,storage:0,build:!0,cost:[0,200,0,0],size:1,child:[{img:k.euro_storage_c,x:0,y:0},{img:k.euro_storage_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Knight",strID:"e_knight",dieSound:ae,clss:"knight",attackSound:Zd,attack:12,defence:6,health:120,maxHealth:120,img:k.euro_knight.idle,invType:0,zLevel:1,race:"euro",
invMax:8,validator:Q,human:1,iconID:43,d2attack:2,time:22,sight:5,url:k.euro_knight,icons:e,cost:[120,0,70,0],attDist:1,spd:85,nu:a.createKnight,standardFunc:W,size:1},{radix:0,name:"Field",clss:"field",strID:"field",instantBuild:1,resistance:80,health:100,maxHealth:100,img:k.fields,invMax:0,validator:Wi,zLevel:1,iconID:104,race:"common",icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:k.fields,build:!0,field:1,res:2,cost:[0,200,0,0],rndDirection:9,time:0,sight:1,z32:.5,size:1},{radix:0,name:"Golden rocks",
mMapcolor:[148,148,0],strID:"gold",sound:["mine1"],clss:"golden_rocks",resistance:0,health:6E3,maxHealth:6E3,img:k.res_gold,invMax:0,validator:T,iconID:20,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.res_gold,build:!0,zLevel:1,race:"common",res:0,cost:[0,0,0,0],time:0,sight:2,dieSound:["destroy%20mine"],size:1,zolotoy:1,child:[{img:k.res_gold_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:k.res_gold},{radix:0,name:"Rocks",strID:"stone",mMapcolor:[132,132,132],sound:["mine1"],
clss:"rocks",dieSound:["destroy%20mine"],resistance:0,health:6E3,maxHealth:6E3,img:k.res_stone,invMax:0,validator:T,zLevel:1,iconID:22,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.res_stone,build:!0,res:3,cost:[0,0,0,0],race:"common",time:0,sight:2,size:1,zolotoy:1,child:[{img:k.res_stone_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:k.res_stone},{radix:0,name:"Farm",strID:"e_farm",sound:["e_farm1","e_farm2"],clss:"farm",resistance:0,health:800,maxHealth:800,img:k.euro_farm,
invType:1,invMax:0,zLevel:1,validator:T,bimg:k.build4x4,dimg:k.des_4x4,iconID:61,dieSound:M,race:"euro",icons:[a.createCow,a.techCropRotation,a.techDomestication],space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Ha,url:k.euro_farm,build:!0,cost:[0,200,0,0],time:30,sight:5,storage:2,size:1,child:[{img:k.euro_farm_c,x:0,y:0}]},{radix:0,name:"Merchants Guild",strID:"e_merchant",sound:["merchant"],clss:"merchants_guild",resistance:0,health:5E3,maxHealth:5E3,img:k.euro_tcguild,invType:1,
invMax:0,validator:T,bimg:k.build6x6,zLevel:1,dimg:k.des_6x6,race:"euro",iconID:62,dieSound:M,icons:[a.techMapMaking,a.techTradeRoutes,a.techUsury,a.techSupplyStorage,a.techBribery,a.techTradeTaxes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),menu:Ha,url:k.euro_tcguild,build:!0,time:90,sight:8,cost:[2E3,0,0,2E3],onbuild:[a.buildMarket],size:1,child:[{img:k.euro_tcguild_c,x:0,y:0},{img:k.euro_tcguild_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Church",clss:"church",
strID:"e_church",sound:["e_church1"],resistance:0,health:800,maxHealth:800,img:k.euro_church,invType:1,invMax:0,dieSound:M,validator:T,bimg:k.build3x3,race:"euro",zLevel:1,dimg:k.des_3x3,iconID:139,icons:[a.createPriest],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),menu:Ha,url:k.euro_church,build:!0,cost:[0,0,200,200],time:40,sight:6,size:1,child:[{img:k.euro_church_c,x:0,y:0},{img:k.euro_church_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Blacksmith",clss:"blacksmith",strID:"e_blacksmith",
resistance:0,health:800,maxHealth:800,img:k.euro_blacksmith,invType:1,invMax:0,time:40,zLevel:1,sight:5,dieSound:M,validator:T,bimg:k.build4x4,race:"euro",dimg:k.des_4x4,child:[{img:k.euro_blacksmith_c,x:0,y:0}],iconID:58,icons:[a.techPlateArmor,a.techTemperIron,a.techScaleArmor,a.techHalberd,a.techChainMail],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Ha,url:k.euro_blacksmith,build:!0,cost:[0,0,200,200],onbuild:b,size:1},{radix:0,name:"Cow",clss:"cow",nu:a.createCow,race:"common",
strID:"cow",attack:0,defence:3,health:50,maxHealth:50,img:k.cow.idle,invType:0,invMax:8,zLevel:1,validator:Q,iconID:99,time:20,dieSound:["cowdie1","cowdie2","cowdie3","cowdie4"],url:k.cow,icons:[a.move,a.stop],sight:3,cost:[0,0,300,0],attDist:0,spd:32,res:2,food:300,milk:50,milkMax:50,foodMax:600,size:1,cow:1,update:["milk","milkSpeed",1E3,"food","cowSpeed",1E3]},{radix:0,name:"Stable",sound:["e_stables1"],clss:"stable",strID:"e_stable",onlyRequired:1,resistance:0,health:800,maxHealth:800,invType:1,
invMax:0,race:"euro",zLevel:1,validator:T,bimg:k.build4x4,dimg:k.des_4x4,iconID:68,dieSound:M,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.euro_stables,build:!0,cost:[0,200,0,0],onbuild:c,size:1,time:40,sight:5,img:k.euro_stables,nu:a.createCow,child:[{img:k.euro_stable_c,x:0,y:0}]},{radix:0,name:"Workshop",sound:["e_workshop1"],clss:"workshop",strID:"e_workshop",zLevel:1,resistance:0,health:800,maxHealth:800,img:k.euro_workshop,invType:1,invMax:0,dieSound:M,validator:T,bimg:k.build4x4,
race:"euro",dimg:k.des_4x4,iconID:75,icons:[a.createCatapult,a.createHeavyCatapult,a.createBallist,a.techEngineering,a.techCannonTower],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:k.euro_workshop,build:!0,cost:[0,200,200,0],size:1,time:40,sight:5,child:[{img:k.euro_workshop_c,x:0,y:0}]},{radix:0,name:"Tavern",sound:["e_tavern1"],clss:"tavern",strID:"e_tavern",dieSound:M,resistance:0,health:1E3,maxHealth:1E3,img:k.euro_tavern,invType:1,invMax:0,validator:T,race:"euro",bimg:k.build4x4,
dimg:k.des_4x4,zLevel:1,iconID:70,icons:[a.createMercenaries,a.createHeroes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4]),url:k.euro_tavern,build:1,cost:[0,200,200,0],onbuild:d,actvintv:[a.iniMercenaries,a.iniHeroes],size:1,time:40,sight:5,child:[{img:k.euro_tavern_c,x:0,y:0}]},{name:"House",sound:["house1","house2","house3","house4","house5"],clss:"house",strID:"e_house",resistance:0,health:75,maxHealth:75,img:k.euro_houses,invType:1,invMax:0,validator:T,bimg:k.build3x3,dimg:k.des_3x3,
race:"euro",iconID:73,zLevel:1,dieSound:M,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:k.euro_houses,build:!0,cost:[0,75,0,0],population:10,size:1,time:20,sight:4,child:[{img:k.euro_houses_c,x:0,y:0}]},{name:"Watch Tower",attackSound:Of,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),clss:"watch_tower",strID:"watch_tower",attack:7,health:400,maxHealth:400,img:k.euro_tower_wood_2,state:0,invType:1,race:"common",invMax:0,zLevel:1,dieSound:M,level:0,validator:T,child:[{img:k.euro_tower_wood_2_c,
x:0,y:0},{alpha:!0,img:k.euro_tower_wood_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attimg:k.arrow1,attDist:8,bimg:k.build2x2,dimg:k.des_2x2,iconID:53,icons:[a.attack,a.stop,a.upgradeGuildTower],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_wood_2,build:!0,cost:[0,300,0,0],size:1,arrow:!0,time:10,sight:15,standardFunc:W},{name:"Market",sound:["e_market1"],clss:"market",strID:"e_market",resistance:0,health:1400,maxHealth:1400,img:k.euro_market,invType:1,invMax:0,dieSound:M,zLevel:1,validator:T,bimg:k.build4x4,
dimg:k.des_4x4,iconID:65,race:"euro",icons:[a.createCaravan],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,4]),url:k.euro_market,build:!0,cost:[0,200,200,0],size:1,time:60,sight:8,child:[{img:k.euro_market_c,x:0,y:0}]},{name:"Outpost",sound:["e_outpost1"],clss:"outpost",strID:"e_outpost",zLevel:1,resistance:0,health:2E3,maxHealth:2E3,img:k.euro_outpost,invType:1,dieSound:M,invMax:50,validator:T,race:"euro",bimg:k.build4x4,dimg:k.des_4x4,iconID:66,icons:[a.emergeAllUnits],space:new Uint8Array([0,
1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,4]),url:k.euro_outpost,build:!0,cost:[0,200,0,400],size:1,child:[{img:k.euro_outpost_c,x:0,y:0},{img:k.euro_outpost_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{name:"Bridge",clss:"bridge",strID:"bridge",resistance:0,health:1E4,maxHealth:1E4,img:k.bridge_horz,invMax:0,validator:Vi,bimg:k.bridge_horz_build,race:"common",zLevel:1,dieSound:M,child:[{alpha:!0,img:k.bridge_horz_s,x:0,y:0,rgb:[0,0,0,.5]},{img:k.bridge_horz1,x:0,y:0,z:6}],time:22,sight:1,dimg:k.bridge_horz_demol,
iconID:44,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,11]),url:k.bridge_horz,build:!0,cost:[0,200,0,400],size:1},{name:"Dummy",clss:"dummy",strID:"dummy",resistance:0,health:5E3,maxHealth:5E3,img:k.dummy1,invMax:0,validator:Q,bimg:k.dummy1_b,iconID:165,icons:[],mx:0,zLevel:1,my:16,hframe:65,race:"common",url:k.dummy1,dimg:k.dummy1_d,build:!0,cost:[0,300,0,0],
dummy:!0,child:[{img:k.dummy1_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:10,sight:1},{name:"Catapult",strID:"catapult",dieSound:Qf,clss:"catapult",attackSound:Pf,defence:0,attack:10,health:110,maxHealth:110,img:k.catapult.idle,invMax:0,radix:0,validator:Q,iconID:30,time:30,sight:20,race:"common",url:k.catapult,level:0,zLevel:1,icons:f,cost:[0,600,0,0],nofreeze:1,arrow:!1,attDist:17,spd:40,standardFunc:W,size:1,attimg:k.cat_stone,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:a.createCatapult},{name:"Ballista",
radix:0,strID:"ballista",attackSound:Pf,dieSound:Qf,clss:"ballista",defence:0,attack:60,health:75,maxHealth:75,img:k.ballista.idle,invMax:0,validator:Q,iconID:31,time:30,sight:16,nofreeze:1,race:"common",zLevel:1,url:k.ballista,icons:f,cost:[0,800,0,0],attDist:13,spd:40,standardFunc:W,size:1,attimg:k.arrow_ballista1,space:new Uint8Array([1,1,1,1,2]),attackDeg:30,nu:a.createBallist},{name:"Heavy Catapult",strID:"heavy_catapult",attackSound:Pf,defence:0,attack:25,health:250,maxHealth:250,img:k.h_catapult.idle,
invMax:0,radix:0,validator:Q,iconID:45,time:60,dieSound:Qf,sight:26,race:"common",url:k.h_catapult,zLevel:1,icons:f,standardFunc:W,cost:[0,1200,0,0],attDist:22,spd:40,nofreeze:1,clss:"heavy_catapult",size:1,attimg:k.cb_metal,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:a.createHeavyCatapult},{radix:0,name:"Ghost",strID:"ghost",defence:0,attack:8,health:60,maxHealth:60,img:k.euro_ghost.idle,invType:0,invMax:8,dieSound:["ghost1","ghost2"],validator:Q,iconID:178,zLevel:1,race:"common",time:15,attackSound:Rj,
sight:5,standardFunc:W,url:k.euro_ghost,icons:e,w:1,cost:[40,0,0,0],attDist:1,spd:80,clss:"ghost",size:1,nu:a.createGhost},{name:"Harbor",strID:"e_harbor",resistance:80,health:800,maxHealth:800,img:k.euro_harbor,invType:1,invMax:0,validator:kf,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:k.build_harbor,dimg:k.des_harbor,zLevel:1,race:"euro",dieSound:M,iconID:63,icons:[a.createFishingBoat,a.createXebec,a.createHulk,a.createGalleon,a.techLandingTactics],clss:"harbor",url:k.euro_harbor,storage:4,
build:!0,cost:[0,200,200,0],child:[{img:k.euro_harbor_c,x:0,y:0},{img:k.euro_harbor_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{radix:0,name:"Messiah",strID:"messiah",attack:50,defence:10,mana:1E3,manaMax:1E3,health:1E3,maxHealth:1E3,img:k.messiah.idle,invType:0,invMax:0,race:"common",validator:Q,human:1,iconID:169,zLevel:1,attackSound:["messiah_attack"],dieSound:["messiah"],time:300,sight:26,url:k.messiah,standardFunc:W,icons:e,cost:[2E3,0,0,0],attDist:10,spd:50,clss:"messiah",size:1,update:["mana",
"manaSpeed",1E3]},{name:"Magic Gateway",sound:["gateway"],strID:"gateway",magicGateway:1,resistance:0,health:Infinity,maxHealth:Infinity,img:k.teleport,invMax:0,validator:T,bimg:k.build4x4,zLevel:1,dieSound:M,race:"common",iconID:180,clss:"magic_gateway",icons:[a.createOrk,a.createDwarf,a.createGhost,a.createSkeleton],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,5]),url:k.teleport,build:!0,cost:[0,0,0,0],size:1,time:10,sight:10,zolotoy:1,child:[{img:k.teleport_c,x:0,y:0},
{alpha:!0,img:k.teleport_s,x:0,y:0,rgb:[0,0,0,.5]}],standardFunc:Yj},{name:"Guard Tower",strID:"guard_tower",race:"common",clss:"guard_tower",attackSound:Of,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:12,health:1E3,maxHealth:1E3,img:k.euro_tower_wood,state:0,invType:1,invMax:0,dieSound:M,zLevel:1,validator:T,child:[{img:k.euro_tower_wood_c,x:0,y:0},{alpha:!0,img:k.euro_tower_wood_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:12,bimg:k.build2x2,dimg:k.des_2x2,iconID:52,icons:[a.attack,a.stop,
a.upgradeStoneTower,a.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_wood,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:k.arrow1,time:35,sight:16,standardFunc:W},{name:"Sword",attack:0,defence:0,health:25,maxHealth:25,img:k.items1,state:0,invMax:0,validator:Cb,iconID:16,url:k.items1,icons:[],cost:[0,0,0,0],size:1,zLevel:0,z32:.5,radix:0,race:"common",item:1},{name:"Bow",attack:0,defence:0,health:25,maxHealth:25,img:k.items1,state:0,invMax:0,validator:Cb,iconID:4,url:k.items1,
icons:[],cost:[0,0,0,0],size:1,z32:.5,zLevel:0,radix:0,race:"common",item:1},{name:"Shield",attack:0,defence:0,health:25,maxHealth:25,img:k.items1,state:0,invMax:0,validator:Cb,iconID:1,url:k.items1,icons:[],cost:[0,0,0,0],zLevel:0,race:"common",radix:0,size:1,z32:.5,item:1},{name:"Potion",attack:0,defence:0,health:25,maxHealth:25,img:k.potions,state:0,invMax:0,validator:Cb,iconID:11,url:k.potions,icons:[],radix:0,race:"common",zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Book",attack:0,defence:0,
health:25,maxHealth:25,img:k.book1,state:0,invMax:0,validator:Cb,iconID:9,zLevel:0,race:"common",radix:0,url:k.books,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Gold",health:1,maxHealth:1,img:k.item_gold,invMax:0,validator:Cb,iconID:20,radix:0,race:"common",zLevel:0,url:k.item_gold,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Stone",health:1,maxHealth:1,img:k.item_stone,invMax:0,validator:Cb,iconID:22,race:"common",radix:0,url:k.item_stone,zLevel:0,icons:[],cost:[0,0,0,0],size:1,
z32:.5,item:1},{name:"Food",health:15,maxHealth:15,img:k.item_food,invMax:0,mMapcolor:[0,255,255],validator:Cb,iconID:14,url:k.item_food,radix:0,race:"common",icons:[],zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Wood",health:1,maxHealth:1,img:k.item_wood,invMax:0,validator:Cb,iconID:15,url:k.item_wood,icons:[],race:"common",radix:0,zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Iron",health:1,maxHealth:1,img:k.item_iron,invMax:0,validator:Cb,iconID:21,zLevel:0,race:"common",url:k.item_iron,
radix:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Keep Tower",strID:"keep_tower",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:16,health:2E3,maxHealth:2E3,img:k.euro_tower_stone,state:0,invType:1,zLevel:1,attackSound:Of,invMax:0,dieSound:M,validator:T,clss:"keep_tower",race:"common",child:[{alpha:!0,img:k.euro_tower_stone_s,x:0,y:0,rgb:[0,0,0,.5]},{img:k.euro_tower_stone_c,x:0,y:0}],attDist:14,bimg:k.build2x2,dimg:k.des_2x2,standardFunc:W,iconID:54,icons:[a.attack,a.stop,
a.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_stone,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:k.arrow_big1,time:40,sight:18},{name:"Cannon Tower",clss:"tower_stone2",strID:"tower_stone2",attackSound:$d,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:40,health:2500,maxHealth:2500,img:k.euro_tower_stone_2,state:0,invType:1,invMax:0,dieSound:M,race:"common",validator:T,zLevel:1,child:[{img:k.euro_tower_stone_2_c,x:0,y:0},{alpha:!0,img:k.euro_tower_stone_2_s,
x:0,y:0,rgb:[0,0,0,.5]}],attDist:10,bimg:k.build2x2,dimg:k.des_2x2,iconID:54,icons:[a.attack,a.stop],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_stone_2,build:!0,cost:[0,600,0,0],standardFunc:W,size:1,arrow:!1,attimg:k.hot_cannon,time:45,sight:18,attackDeg:30},{name:"Rocket Tower",strID:"tower_rocket",race:"asia",clss:"tower_rocket",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),zLevel:1,attack:30,health:1400,maxHealth:1400,img:k.rocket_tower,state:0,invType:1,invMax:0,dieSound:M,validator:T,
child:[{img:k.rocket_tower_c},{alpha:!0,img:k.rocket_tower_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:20,bimg:k.build2x2,dimg:k.des_2x2,iconID:186,icons:[],space:new Uint8Array([1,1,1,1,2]),url:k.rocket_tower,build:!0,cost:[0,600,0,0],standardFunc:W,size:1,arrow:!0,attimg:k.arrow_big1,time:60,sight:26},{radix:0,name:"Ork",race:"common",strID:"ork",dieSound:["orc%20die%201","orc%20die%202"],attackSound:Qj,attack:18,defence:2,health:75,maxHealth:75,img:k.ork.idle,invType:0,invMax:8,validator:Q,zLevel:1,iconID:143,
time:12,sight:5,url:k.ork,standardFunc:W,icons:e,cost:[60,0,0,0],attDist:1,spd:50,clss:"ork",size:1,nu:a.createOrk},{radix:0,name:"Dwarf",race:"common",attack:7,defence:7,health:120,maxHealth:120,img:k.dwarf.idle,invType:0,strID:"dwarf",invMax:8,zLevel:1,dieSound:lb,validator:Q,iconID:185,time:12,sight:3,url:k.dwarf,standardFunc:W,icons:e,cost:[80,0,0,0],attDist:1,spd:50,clss:"dwarf",size:1,nu:a.createDwarf},{radix:0,name:"Skeleton",strID:"skeleton",race:"common",dieSound:["skeleton%20die%201","skeleton%20die%202",
"skeleton%20die%203","skeleton%20die%204"],attack:4,defence:0,health:40,maxHealth:40,img:k.skeleton.idle,invType:0,zLevel:1,attackSound:oc,invMax:8,nofreeze:1,validator:Q,iconID:167,time:12,sight:3,url:k.skeleton,standardFunc:W,icons:e,cost:[0,0,30,0],attDist:1,spd:50,clss:"skeleton",size:1,nu:a.createSkeleton},{radix:0,name:"Caravan",race:"euro",strID:"e_caravan",attack:0,defence:0,health:350,maxHealth:350,img:k.caravan.idle,invType:1,invMax:8,validator:Q,iconID:34,zLevel:1,time:50,sight:7,url:k.caravan,
icons:[a.move,a.trade,a.explore,a.stop,a.stand,a.unload],cost:[0,200,400,0],attDist:1,spd:75,clss:"caravan",size:1,nu:a.createCaravan},{name:"Castle",health:8E3,maxHealth:8E3,img:k.asia_castle,invType:1,strID:"a_castle",zLevel:1,race:"asia",invMax:50,validator:T,bimg:k.build6x6,dimg:k.des_6x6,iconID:164,time:120,sight:12,dieSound:M,clss:"castle",child:[{img:k.asia_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:k.asia_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[a.createPeon1,a.createNinja,a.emergeAllUnits,a.techFeudalism,
a.techArchitecture,a.techLearning,a.techBuddhism,a.techGreatWall],space:new Uint8Array([0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,8]),menu:Ha,url:k.asia_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{name:"Castle",dieSound:M,clss:"castle",strID:"r_castle",race:"arab",health:8E3,maxHealth:8E3,img:k.arab_castle,invType:1,invMax:50,validator:T,bimg:k.build6x6,dimg:k.des_6x6,zLevel:1,
iconID:97,time:120,sight:12,child:[{img:k.arab_castle_c}],icons:[a.createPeon2,a.createSpy,a.emergeAllUnits,a.techFeudalism,a.techArchitecture,a.techLearning,a.techSlavery],space:new Uint8Array([0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,,8]),menu:Ha,url:k.arab_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{radix:0,name:"Peasant",attack:5,defence:0,health:50,maxHealth:50,img:k.asian_peasant.idle,
invType:0,invMax:8,attackSound:zh,race:"asia",validator:Q,human:1,strID:"a_peon",iconID:132,dieSound:lb,zLevel:1,time:8,peon:1,sight:5,url:k.asian_peasant,icons:[a.move,a.menuBuilds1,a.repair,a.conquest,a.dcm,a.pickUp,a.explore,a.stop,a.stand,a.attack,a.sameSpeed,a.restoreSpeed],cost:[0,0,40,0],attDist:1,spd:50,clss:"peon",nocapture:1,size:1},{radix:0,name:"Ninja",race:"asia",attack:12,defence:5,mana:100,manaMax:100,health:90,maxHealth:90,img:k.asian_ninja.idle,invType:0,invMax:8,attackSound:oc,validator:Q,
human:1,iconID:133,strID:"ninja",dieSound:lb,zLevel:1,time:20,standardFunc:W,sight:10,url:k.asian_ninja,icons:[a.guard,a.patrol,a.pickUp,a.explore,a.stop,a.stand,a.invisibility,a.murder,a.move,a.attack,a.sameSpeed,a.restoreSpeed],cost:[120,0,0,0],attDist:1,spd:85,clss:"ninja",size:1,update:["mana","manaSpeed",1E3]},{radix:0,name:"Ronin",attack:7,defence:0,health:45,maxHealth:45,img:k.asian_ronin.idle,invType:0,invMax:8,race:"asia",validator:Q,human:1,standardFunc:W,iconID:141,strID:"ronin",dieSound:lb,
zLevel:1,time:8,sight:5,url:k.asian_ronin,icons:e,cost:[0,0,40,0],attDist:1,spd:50,attackSound:oc,clss:"a_footman",size:1},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:k.asian_archer.idle,invType:0,invMax:8,race:"asia",validator:Q,human:1,strID:"a_archer",dieSound:lb,zLevel:1,attimg:k.arrow1,iconID:136,arrow:1,attackSound:nd,time:12,sight:10,url:k.asian_archer,icons:e,cost:[0,20,40,0],standardFunc:W,spd:50,clss:"archer",size:1,attDist:6},{radix:0,name:"Samurai",attack:10,defence:4,
health:90,maxHealth:90,img:k.asian_samurai.idle,invType:0,race:"asia",strID:"samurai",invMax:8,attackSound:oc,validator:Q,human:1,iconID:142,time:20,standardFunc:W,zLevel:1,dieSound:lb,sight:6,url:k.asian_samurai,icons:e,cost:[50,0,150,0],attDist:1,spd:50,clss:"a_maceman",size:1},{radix:0,name:"Horse Archer",attack:7,defence:0,health:75,maxHealth:75,img:k.asian_horsarcher.idle,invType:0,race:"asia",invMax:8,validator:Q,human:1,attackSound:nd,iconID:183,strID:"a_horse_archer",dieSound:ae,time:20,standardFunc:W,
sight:12,url:k.asian_horsarcher,zLevel:1,icons:e,arrow:1,attimg:k.arrow1,cost:[40,0,120,0],spd:85,clss:"horse_archer",size:1,attDist:7},{radix:0,name:"Horse Samurai",attack:14,defence:4,health:160,maxHealth:160,img:k.asian_horsamurai.idle,invType:0,invMax:8,validator:Q,human:1,iconID:135,race:"asia",standardFunc:W,attackSound:Zd,time:22,zLevel:1,strID:"horse_samurai",dieSound:ae,sight:5,url:k.asian_horsamurai,icons:e,cost:[75,0,120,0],attDist:1,spd:85,clss:"horse_samurai",size:1},{name:"Barracks",
resistance:500,health:1400,maxHealth:1400,img:k.asia_barracks,invType:1,sound:Ah,invMax:0,time:60,dieSound:M,radix:0,sight:6,race:"asia",strID:"a_barrack",validator:T,zLevel:1,bimg:k.build5x5,dimg:k.des_5x5,child:[{img:k.asia_barracks_c,x:0,y:0,mv:!0},{img:k.asia_barracks_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:146,icons:[a.createRonin,a.createArcher1,a.createSamurai,a.createHorseArcher1,a.createHorseSamurai,a.createChariot],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,5]),url:k.asia_barracks,build:!0,cost:[0,200,0,200],size:1,clss:"barracks"},{name:"Chariot",attack:4,defence:3,health:180,maxHealth:180,img:k.asian_charriot.idle,invType:0,radix:0,race:"asia",invMax:8,strID:"chariot",dieSound:["c%20die%201","c%20die%202","c%20die%203","c%20die%204","c%20die%205"],attackSound:Zd,validator:Q,human:1,zLevel:1,iconID:175,standardFunc:W,time:8,sight:5,url:k.asian_charriot,icons:e,cost:[0,200,150,0],attDist:1,spd:85,clss:"chariot",size:1},{radix:1,name:"Galleon",attackSound:$d,
attack:35,attDist:12,race:"common",defence:0,health:1200,maxHealth:1200,strID:"galleon",nu:a.createGalleon,img:k.galleon.idle,invType:1,invMax:24,dieSound:["ship%20sink"],zLevel:0,validator:Od,iconID:32,time:50,boat:!0,attimg:k.cb_metal,attackDeg:20,sight:16,url:k.galleon,icons:[a.move,a.explore,a.unload,a.attack,a.attackGround,a.stop,a.stand,a.stop,a.stand,a.attack,a.steady,a.upgradeShip],cost:[0,1200,800,0],spd:50,nofreeze:1,clss:"galleon",standardFunc:W,size:1,peon:1},{radix:1,name:"Fishing Boat",
attackSound:$d,attack:1,attDist:8,race:"common",defence:0,health:50,boat:!0,nu:a.createFishingBoat,maxHealth:50,img:k.boat.idle,invType:1,invMax:0,strID:"fishing_boat",dieSound:["ship%20sink"],zLevel:0,validator:Od,iconID:184,nofreeze:1,time:50,sight:16,url:k.boat,icons:[a.move,a.explore,a.stop,a.stand,a.fishing],cost:[0,200,100,0],spd:65,clss:"fishing_boat",size:1},{radix:1,name:"Hulk",attackSound:$d,attack:18,attDist:10,race:"common",defence:0,health:700,maxHealth:700,strID:"hulk",img:k.hulk.idle,
invType:1,boat:!0,nu:a.createHulk,attackDeg:20,invMax:16,dieSound:["ship%20sink"],zLevel:0,validator:Od,iconID:128,time:30,sight:14,attimg:k.cb_metal,url:k.hulk,icons:[a.move,a.explore,a.unload,a.attack,a.attackGround,a.stop,a.stand,a.stop,a.stand,a.attack,a.steady,a.upgradeShip],cost:[0,500,300,0],spd:65,nofreeze:1,clss:"hulk",standardFunc:W,size:1},{radix:1,name:"Pinque",attackSound:nd,attack:10,race:"common",attDist:8,defence:0,health:300,boat:!0,maxHealth:300,img:k.xebec.idle,attimg:k.arrow1,
arrow:!0,strID:"pinque",invType:1,invMax:8,dieSound:["ship%20sink"],zLevel:0,validator:Od,iconID:129,time:20,nofreeze:1,sight:12,url:k.xebec,icons:[a.move,a.explore,a.unload,a.attack,a.attackGround,a.stop,a.stand,a.stop,a.stand,a.attack,a.steady,a.upgradeShip],cost:[0,300,200,0],spd:80,clss:"xebec",size:1,standardFunc:W,nu:a.createXebec},{radix:0,name:"Stone Golem",strID:"troll",defence:3,attack:25,health:400,maxHealth:400,img:k.troll.idle,invType:0,invMax:0,dieSound:["golem"],validator:Q,iconID:144,
race:"common",zLevel:1,nofreeze:1,attackSound:["golem1","golem2"],sight:10,standardFunc:W,url:k.troll,icons:e,w:1,cost:[120,0,0,0,600],attDist:1,spd:56,clss:"troll",size:1},{radix:0,name:"Bat",strID:"bat",defence:0,attack:3,health:20,maxHealth:20,img:k.bat.move,invType:0,invMax:0,race:"common",bat:1,dieSound:["bat%20die"],validator:lf,iconID:105,zLevel:2,attackSound:["bat%20attack"],sight:10,standardFunc:W,url:k.bat,icons:e,w:1,cost:[0,0,0,0,25],attDist:1,spd:128,clss:"bat",size:1,z32:1.5},{race:"arab",
invType:0,invMax:8,iconID:138,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_peasant,img:k.arab_peasant.idle,spd:50,validator:Q,human:1,icons:[a.move,a.menuBuilds2,a.repair,a.conquest,a.dcm,a.pickUp,a.explore,a.stop,a.stand,a.attack,a.convertJihad,a.bribe,a.sameSpeed,a.restoreSpeed],name:"Peasant",clss:"peon",cost:[0,0,50,0],attDist:1,time:8,nocapture:1,peon:1,sight:5,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:172,zLevel:1,dieSound:[],attackSound:[],size:1,
radix:0,url:k.arab_footman,img:k.arab_footman.idle,standardFunc:W,spd:50,validator:Q,human:1,attDist:1,icons:e,name:"Footman",clss:"footman",cost:[0,0,50,0],time:12,sight:5,health:50,attack:6,defence:1},{race:"arab",invType:0,invMax:8,iconID:170,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_archer,img:k.arab_archer.idle,spd:50,validator:Q,standardFunc:W,human:1,attimg:k.arrow1,arrow:1,icons:e,name:"Archer",clss:"archer",cost:[0,20,40,0],time:12,sight:10,attDist:6,health:50,attack:5,
defence:0},{race:"arab",invType:0,invMax:8,iconID:173,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_spearman,img:k.arab_spearman.idle,spd:50,validator:Q,standardFunc:W,human:1,icons:e,name:"Spearman",clss:"pikeman",attDist:1,cost:[40,0,60,0],time:14,sight:5,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:174,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,standardFunc:W,url:k.arab_satrap,img:k.arab_satrap.idle,spd:50,validator:Q,human:1,icons:e,name:"Satrap",
attDist:1,clss:"maceman",cost:[0,0,120,0],time:14,sight:5,health:120,attack:8,defence:0},{race:"arab",invType:0,invMax:8,iconID:171,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_cavalry,standardFunc:W,img:k.arab_cavalry.idle,spd:85,validator:Q,human:1,attDist:1,icons:e,name:"Cavalry",clss:"heavy_cavalry",cost:[60,0,100,0],time:14,sight:5,health:90,attack:10,defence:4},{race:"arab",invType:0,invMax:8,iconID:168,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_horse_archer,
img:k.arab_horse_archer.idle,spd:85,validator:Q,human:1,standardFunc:W,icons:e,name:"Horse Archer",clss:"horse_archer",cost:[50,0,100,0],time:14,attimg:k.arrow1,arrow:1,sight:12,attDist:7,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:179,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_jwarrior,img:k.arab_jwarrior.idle,spd:50,validator:Q,human:1,standardFunc:W,icons:e,name:"Jihad warrior",attDist:1,clss:"jihad_warrior",cost:[0,0,100,0],time:8,sight:5,health:75,
attack:10,defence:2},{race:"arab",invType:0,invMax:8,iconID:176,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_priest,img:k.arab_priest.idle,standardFunc:W,spd:50,mana:100,validator:Q,human:1,icons:h,name:"Priest",clss:"priest",cost:[150,0,0,0],time:30,sight:21,attDist:18,health:60,attack:20,update:["mana","manaSpeed",1E3],manaMax:100,defence:0,attimg:k.flame_bolt,ball:1,attackOnly:Nd.magic_creatures.obj},{race:"arab",invType:0,invMax:0,iconID:105,zLevel:1,dieSound:[],attackSound:[],
size:1,radix:0,url:0,img:0,testing:1,illegal:1,spd:50,validator:Q,human:1,icons:[],name:"Spy",clss:"spy",cost:150,time:30,sight:12,health:50,attack:20,defence:0},{race:"arab",invType:0,invMax:8,iconID:188,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,attimg:k.flame_bolt,url:k.arab_mage,img:k.arab_mage.idle,spd:50,validator:Q,human:1,icons:[a.stop,a.pickUp,a.explore,a.createCarpet,a.createJinn,a.fireRain,a.magicVision,a.raiseDead,a.attack,a.stand,a.move],standardFunc:W,name:"Mage",clss:"mage",
ball:1,mana:100,manaMax:100,update:["mana","manaSpeed",1E3],cost:[150,0,0,0],time:30,sight:15,attDist:10,health:60,attack:8,defence:0},{race:"arab",invType:1,invMax:8,iconID:126,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_caravan,img:k.arab_caravan.idle,spd:75,validator:Q,human:1,icons:[],name:"Caravan",clss:"trader",cost:[0,0,500,0],time:30,sight:5,health:150},{race:"arab",invType:0,invMax:8,iconID:177,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_enichar,img:k.arab_enichar.idle,
spd:85,validator:Q,human:1,standardFunc:W,icons:e,name:"Enichar",attDist:1,clss:"enichar",cost:[80,0,120,0],time:25,sight:5,health:130,attack:18,defence:4},{race:"arab",invType:1,invMax:0,iconID:82,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,population:10,url:k.arab_houses,validator:T,build:1,icons:[],child:[{img:k.arab_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],time:20,sight:4,resistance:50,health:500},{race:"arab",invType:1,invMax:0,
iconID:85,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_lumbermill,validator:T,build:1,icons:[a.techWoodCutting,a.techCrossbow],child:[{img:k.arab_lumbermill_c}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],storage:1,time:30,sight:4,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:96,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_storage,
validator:T,build:1,storage:0,icons:[a.techGoldMining,a.techStoneMining],child:[{img:k.arab_storage_c},{alpha:!0,img:k.arab_storage_s,rgb:[0,0,0,.5]}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:80,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_farm,validator:T,build:1,icons:[a.createCow,a.techCropRotation,a.techDomestication,a.techCowPoaching,
a.ridingHorses,a.techHorseManShip],child:[{img:k.arab_farm_c}],name:"Farm",storage:2,clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:81,zLevel:1,dieSound:M,validator:kf,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:k.build_harbor,dimg:k.des_harbor,radix:0,url:k.arab_harbour,build:1,icons:[a.createFishingBoat,a.createXebec,a.createHulk,a.techLandingTactics],child:[{img:k.arab_harbour_c},{alpha:!0,img:k.arab_harbour_s,rgb:[0,0,0,
.5]}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:79,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_blacksmith,validator:T,build:1,icons:[a.techTemperIron,a.techScaleArmor,a.techScimitar,a.techChainMail,a.techHalberd],child:[{img:k.arab_blacksmith_c},{alpha:!0,img:k.arab_blacksmith_s,rgb:[0,0,0,.5]}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,
150,0],onbuild:b,time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:95,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_workshop,validator:T,build:1,icons:[a.createCatapult,a.createBallist,a.techEngineering,a.techCannonTower],child:[{img:k.arab_workshop_c},{alpha:!0,img:k.arab_workshop_s,rgb:[0,0,0,.5]}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},
{race:"arab",invType:1,invMax:0,iconID:140,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_church,validator:T,build:1,icons:[a.createPriest2],child:[{img:k.arab_church_c},{alpha:!0,img:k.arab_church_s,rgb:[0,0,0,.5]}],name:"Church",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"arab",invType:1,invMax:0,iconID:92,zLevel:1,dieSound:M,space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4]),bimg:k.build4x4,
dimg:k.des_4x4,radix:0,url:k.arab_tavern,validator:T,build:1,icons:[a.createMercenaries,a.createHeroes],child:[{img:k.arab_tavern_c}],name:"Tavern",clss:"tavern",cost:[0,200,200,0],onbuild:d,actvintv:[a.iniMercenaries,a.iniHeroes],time:40,sight:5,resistance:150,health:1E3},{race:"arab",invType:1,invMax:0,iconID:87,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_market,validator:T,build:1,icons:[a.createCaravan2],child:[{img:k.arab_market_c}],
name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:98,zLevel:1,dieSound:M,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_barracks,validator:T,build:1,icons:[a.createFootman2,a.createArcher2,a.createSatrap,a.createPikeman2,a.createHorseArcher2,a.createCavalry,a.createEnichar,a.createJihad],child:[{img:k.arab_barracks_c},{alpha:!0,img:k.arab_barracks_s,
rgb:[0,0,0,.5]}],name:"Barracks",clss:"barrack",cost:[0,0,200,200],time:60,sight:6,resistance:500,health:1400},{race:"arab",invType:1,invMax:0,iconID:91,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_stables,validator:T,build:1,icons:[],child:[{img:k.arab_stables_c}],name:"Stable",clss:"stable",cost:[0,200,200,0],time:40,onbuild:c,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:50,iconID:89,zLevel:1,dieSound:M,
space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_outpost,validator:T,build:1,icons:[a.emergeAllUnits],child:[{img:k.arab_outpost_c,mv:1},{alpha:!0,img:k.arab_outpost_s,rgb:[0,0,0,.5]}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"arab",invType:1,invMax:0,iconID:105,zLevel:1,dieSound:M,space:23213123,bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:0,img:0,validator:T,build:1,icons:[],child:[{img:3213123}],
name:"NULL",testing:1,clss:"castle",cost:[0,1500,0,1500],time:120,sight:12,resistance:1E3,health:8E3},{race:"arab",invType:1,invMax:0,iconID:88,zLevel:1,dieSound:M,space:new Uint8Array([0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,6]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_mosque,validator:T,build:1,icons:[a.techFanaticism,a.techEspionage,a.techHealing,a.techBless,a.techJihad],child:[{img:k.arab_mosque_c},{alpha:!0,img:k.arab_mosque_s,rgb:[0,0,0,.5]}],name:"Mosque",
onbuild:[a.buildChurch2],clss:"mosque",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:86,zLevel:1,dieSound:M,space:new Uint8Array([0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_magetower,validator:T,build:1,icons:[a.createMage2,a.techCarpet,a.techMagicWorkshop,a.techFireRain,a.techMagicVision,a.techNecromancy,a.techJinn],child:[{img:k.arab_magetower_c},{alpha:!0,img:k.arab_magetower_s,rgb:[0,0,0,.5]}],name:"Mage Guild",
clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:93,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_tc_guild,validator:T,build:1,icons:[a.techUsury,a.techTradeRoutes,a.techSupplyStorage,a.techBribery,a.techOreFloatation],child:[{img:k.arab_tcguild_c},{alpha:!0,img:k.arab_tc_guild_s,rgb:[0,0,0,.5]}],name:"Merchants Guild",clss:"tcguild",
cost:[2E3,0,0,2E3],time:90,onbuild:[a.buildMarket2],sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:94,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_waracademy,validator:T,build:1,icons:[a.techHeroism,a.techWarfare,a.techMercenaries,a.techRiddingHorses,a.techBodyBuilding,a.techLeadership,a.techHeroes,a.techJanissary,a.techHonor,a.techFame],child:[{img:k.arab_waracademy_c},
{alpha:!0,img:k.arab_waracademy_s,rgb:[0,0,0,.5]}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:158,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_magicworkshop,validator:T,build:1,icons:[a.createObjects],child:[{img:k.arab_magicworkshop_c},{alpha:!0,img:k.arab_magicworkshop_s,rgb:[0,0,0,.5]}],name:"Magic Workshop",disallowPoint:!0,clss:"magicworkshop",
cost:[0,0,0,300],time:20,sight:5,resistance:200,health:1200},{race:"asia",invType:1,invMax:0,iconID:161,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,0,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.asia_houses,validator:T,build:1,icons:[],child:[{img:k.asia_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],population:10,time:20,sight:4,resistance:50,health:500},{race:"asia",invType:1,invMax:0,iconID:149,zLevel:1,dieSound:M,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,
dimg:k.des_3x3,radix:0,storage:1,url:k.asia_lumbermill,validator:T,build:1,icons:[a.techWoodCutting,a.techCrossbow],child:[{img:k.asia_lumbermill_c},{img:k.asia_lumbermill_s,rgb:[0,0,0,.5],alpha:!0}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],time:30,sight:4,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:154,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_storage,storage:0,validator:T,build:1,
icons:[a.techGoldMining,a.techStoneMining],child:[{img:k.asia_storage_s,rgb:[0,0,0,.5],alpha:!0},{img:k.asia_storage_c}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:147,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,storage:2,url:k.asia_farm,validator:T,build:1,icons:[a.techCropRotation,a.ridingHorses,a.irrigation],child:[{img:k.asia_farm_c}],name:"Farm",
clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:148,zLevel:1,dieSound:M,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),validator:kf,bimg:k.build_harbor,dimg:k.des_harbor,radix:0,url:k.asia_harbor,build:1,icons:[a.createFishingBoat,a.createXebec,a.createHulk,a.techLandingTactics],child:[{img:k.asia_harbor_c},{img:k.asia_harbor_s,rgb:[0,0,0,.5],alpha:!0}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},
{race:"asia",invType:1,invMax:0,iconID:145,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_blacksmith,validator:T,build:1,icons:[a.techTemperIron,a.techScaleArmor,a.techArmoredChariot,a.techChainMail],child:[{img:k.asia_blacksmith_c},{img:k.asia_blacksmith_s,rgb:[0,0,0,.5],alpha:!0}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],time:40,sight:5,onbuild:b,resistance:80,health:800},{race:"asia",
invType:1,invMax:0,iconID:157,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_workshop,validator:T,build:1,icons:[a.createCatapult,a.createBallist,a.techEngineering,a.techCannonTower],child:[{img:k.asia_workshop_c,x:0,y:0},{img:k.asia_workshop_s,rgb:[0,0,0,.5],alpha:!0}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:162,zLevel:1,dieSound:M,
space:new Uint8Array([0,1,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asian_monastery,validator:T,build:1,icons:[a.createMonk,a.createPriest1],child:[{img:k.asian_monastery_c},{img:k.asian_monastery_s,rgb:[0,0,0,.5],alpha:!0}],name:"Monastery",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"asia",invType:1,invMax:0,iconID:155,zLevel:1,dieSound:M,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,
dimg:k.des_4x4,radix:0,url:k.asia_tavern,validator:T,build:1,icons:[a.createMercenaries,a.createHeroes],child:[{img:k.asia_tavern_c},{img:k.asia_tavern_s,rgb:[0,0,0,.5],alpha:!0}],onbuild:d,name:"Tavern",clss:"tavern",actvintv:[a.iniMercenaries,a.iniHeroes],cost:[0,200,200,0],time:40,sight:5,resistance:150,health:1E3},{race:"asia",invType:1,invMax:0,iconID:150,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_market,validator:T,
build:1,icons:[],child:[{img:k.asia_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:153,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_stables,validator:T,build:1,icons:[],child:[{img:k.asia_stables_c,mv:!0},{img:k.asia_stables_s,rgb:[0,0,0,.5],alpha:!0}],name:"Stable",clss:"stable",onbuild:c,cost:[0,200,200,0],time:40,sight:5,
resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:151,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.asia_outpost,validator:T,build:1,icons:[a.emergeAllUnits],child:[{img:k.asia_outpost_c,mv:1},{img:k.asia_outpost_s,rgb:[0,0,0,.5],alpha:!0}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"asia",invType:1,invMax:0,iconID:163,zLevel:1,dieSound:M,space:new Uint8Array([0,0,1,
1,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,6]),bimg:k.build6x6,dimg:k.des_6x6,radix:0,url:k.asia_shao_lin,validator:T,build:1,icons:[a.techMeditation,a.techKungFu,a.techHealing,a.techPhilosophy,a.techNinjas,a.techMastery,a.techTournaments,a.techMedicine],child:[{img:k.asia_shao_lin_c},{img:k.asia_shao_lin_s,rgb:[0,0,0,.5],alpha:!0}],name:"Shao Linn",onbuild:[a.buildChurch1],clss:"shaolinn",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:1,
invMax:0,iconID:152,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_wizardguild,validator:T,build:1,icons:[a.createMage1,a.techConcentration,a.techWhirlpool,a.techFlameBolt,a.techTurnToStone,a.techConfusion,a.techDragon],child:[{img:k.asia_wizardguild_c},{img:k.asia_wizardguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},
{race:"asia",invType:1,invMax:0,iconID:159,zLevel:1,dieSound:M,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_tcguild,validator:T,build:1,icons:[a.techTradeRoutes,a.techUsury,a.techJewelry,a.techSupplyStorage,a.techBanking,a.techChemistry,a.techSeaFood,a.techGunPowder,a.techRocketArrow],child:[{img:k.asia_tcguild_c,mv:!0},{img:k.asia_tcguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,
0,2E3],time:90,onbuild:[a.buildMarket1],sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:156,zLevel:1,dieSound:M,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_warguild,validator:T,build:1,icons:[a.techBushido,a.techHeroism,a.techWarfare,a.techMercenaries,a.techLeadership,a.techTactics,a.techHeroes,a.techHonor,a.techSunTzu],child:[{img:k.asia_warguild_c,mv:!0},{img:k.asia_warguild_s,rgb:[0,0,0,
.5],alpha:!0}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:0,invMax:0,iconID:166,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.asian_priest,img:k.asian_priest.idle,spd:50,validator:Q,human:1,icons:[a.attack,a.stop,a.stand,a.pickUp,a.explore,a.healing,a.teach,a.move],name:"Priest",clss:"priest",cost:[170,0,0,0],time:30,sight:21,health:120,standardFunc:W,attDist:1,attack:10,defence:10,mana:100,update:["mana","manaSpeed",
1E3],manaMax:100},{race:"asia",invType:0,invMax:0,iconID:187,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.asian_monk,img:k.asian_monk.idle,spd:50,validator:Q,human:1,icons:e,name:"Monk",standardFunc:W,clss:"monk",cost:[0,0,200,0],time:20,sight:5,health:90,attack:6,defence:6,attDist:1},{race:"asia",invType:0,invMax:0,iconID:134,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.asian_mage,img:k.asian_mage.idle,spd:50,attimg:k.flame_bolt,validator:Q,standardFunc:W,human:1,icons:[a.stop,
a.pickUp,a.explore,a.confusion,a.turnToStone,a.whirlpool,a.flameBolt,a.createDragon,a.attack,a.stand,a.move],name:"Mage",clss:"mage",cost:[150,0,0,0],ball:1,time:30,sight:15,mana:100,attDist:10,health:60,attack:8,defence:0,update:["mana","manaSpeed",1E3],manaMax:100},{radix:0,name:"Dragon",strID:"dragon",defence:0,attack:25,health:300,maxHealth:300,img:k.dragon.idle,invType:0,invMax:0,dieSound:[],sSizex:2,sSizey:2,dragon:1,iconID:160,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:12,standardFunc:W,
url:k.dragon,icons:e,cost:[80,0,0,0,800],attDist:2,spd:128,clss:"drg",size:1,z32:1.5,validator:lf},{radix:0,name:"Carpet",strID:"carpet",defence:0,attack:0,health:90,maxHealth:90,img:k.carpet.idle,invType:1,invMax:8,dieSound:[],iconID:131,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:8,url:k.carpet,icons:[a.move,a.unload,a.explore,a.stop,a.stand],cost:[80,0,0,0,500],attDist:2,spd:120,clss:"carpet",size:1,z32:1.5,validator:lf},{radix:0,name:"Jinn",strID:"jinn",defence:5,attack:20,health:300,
maxHealth:300,img:k.arab_jinn.idle,invType:0,invMax:0,dieSound:[],validator:Q,iconID:182,race:"common",zLevel:1,nofreeze:1,attackSound:[],sight:8,standardFunc:W,url:k.arab_jinn,icons:e,w:1,cost:[80,0,0,0,300],attDist:1,spd:85,clss:"jinn",size:1}];Sc={};Kg={arr:[]};Qa={euro:[],asia:[],arab:[],common:[]};qd=[];m=0;for(l=x.length;m<l;m++){e=x[m];x[m].type=m;g=e.space;e.name.split(" ").join("");e.population&&qd.put(e);Sc[m]={};ab[e.race][e.name.toLowerCase().split(" ").join("")]=e;e.icons.menuName=e.strID;
Kg[e.name]=m;Kg.arr.put(m);e.img||(e.img=e.url);e.maxHealth=e.health;e.race&&Qa[e.race].put(e);d=0;c=e.icons;for(h=c.length;d<h;d++)(f=c[d])&&f.obj&&(f.orderOrigin=e);if(g){d=[];e.free=d;f=g[g.length-1];b=(g.length-1)/f;e=f+2;h=b+2;c=new Uint8Array(e*h);for(p=0;p<b;p++)for(var n=0;n<f;n++)c[(p+1)*e+n+1]=g[n+p*f];p=0;for(h*=e;p<h;p++)!c[p]&&(c[p+1]||c[p-1]||c[p+1+e]||c[p+1-e]||c[p-1+e]||c[p-1-e]||c[p+e]||c[p-e])&&(d.put(p%e-1),d.put(~~(p/e)-1))}}Qa.euro=Qa.euro.concat(Qa.common);Qa.asia=Qa.asia.concat(Qa.common);
Qa.arab=Qa.arab.concat(Qa.common);Qa[0]=Qa.euro;Qa[1]=Qa.arab;Qa[2]=Qa.asian;c=ab.euro;h=ab.asia;f=ab.arab;b=ab.common;ab[0]=ab.euro;ab[1]=ab.arab;ab[2]=ab.asia;d=[c.knight,h.horsesamurai,f.cavalry,f.enichar,c.crusader,h.chariot,h.horsearcher,f.horsearcher];m=[h.horsesamurai,c.crusader,f.enichar];e=[c.knight,f.cavalry,h.chariot,h.horsearcher,f.horsearcher];p=[c.longbowman,f.archer,h.archer,c.archer];l=[b.catapult,b.ballista,b.heavycatapult];g=[b.galleon,b.hulk,b.pinque,b.fishingboat];n=[b.galleon,
b.hulk,b.pinque];var q=[f.satrap,c.maceman],r=[c.longbowman,f.archer,h.archer,c.archer,h.horsearcher,f.horsearcher,b.pinque,b.watchtower,b.keeptower,b.guardtower],u=[b.stonegolem,b.ork,b.dwarf,b.skeleton,b.ghost,b.dragon,b.jinn,b.bat,c.wizard,f.mage,h.mage],v=[c.peasant,h.peasant,f.peasant,c.footman,f.footman,h.ronin,c.pikeman,f.spearman,f.satrap,c.maceman,f.cavalry,f.jihadwarrior,b.spy,f.enichar,h.horsesamurai,h.monk,h.chariot,h.ninja,b.stonegolem,b.ork,b.dwarf,b.jinn,b.skeleton,b.ghost,c.knight,
c.crusader],w=[b.watchtower,b.keeptower,b.guardtower,b.cannontower],y=[b.cannontower,h.rockettower],z=[c.cathedral,c.castle,b.woodenwall,c.barracks,c.lumbermill,c.magetower,c.warriorsguild,c.storage,c.farm,c.merchantsguild,c.church,c.blacksmith,c.stable,c.workshop,c.tavern,c.house,b.watchtower,c.market,c.outpost,b.bridge,c.harbor,b.guardtower,b.keeptower,b.cannontower,h.rockettower,h.castle,f.castle,h.barracks,f.house,f.lumbermill,f.storage,f.farm,f.harbor,f.blacksmith,f.workshop,f.church,f.tavern,
f.market,f.barracks,f.stable,f.outpost,f.mosque,f.mageguild,f.merchantsguild,f.warriorsguild,f.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],B=[c.cathedral,c.castle,b.woodenwall,c.barracks,c.lumbermill,c.magetower,c.warriorsguild,c.storage,c.farm,c.merchantsguild,c.church,c.blacksmith,c.stable,c.workshop,c.tavern,c.house,b.watchtower,c.market,c.outpost,b.bridge,
c.harbor,h.castle,f.castle,h.barracks,f.house,f.lumbermill,f.storage,f.farm,f.harbor,f.blacksmith,f.workshop,f.church,f.tavern,f.market,f.barracks,f.stable,f.outpost,f.mosque,f.mageguild,f.merchantsguild,f.warriorsguild,f.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],A=[b.catapult,b.heavycatapult],D=[c.pikeman,f.spearman],C=[h.monk,h.priest],F=[b.woodenwall],
J=[c.peasant,h.peasant,f.peasant],I=[c.wizard,f.mage,h.mage],G=[c.footman,f.footman,h.ronin],H=[c.priest,f.priest,h.priest];Ab={bless:{img:k.bless,d:0,mv:1},star:{img:k.star,d:0,mv:1},heal:{img:k.healing,d:0,mv:1},impersonate:{img:k.impersonate,d:0,mv:1},select:{img:k.select,d:0,mv:0,select:1,z32:.8},spawn:{img:k.spawn,d:0,mv:1},curse:{img:k.curse,d:0,mv:1},turnStone:{img:k.turn_to_stone,d:0,mv:1}};var L=function(a,b,c){for(var f=a.length,d=0,e=b.length;d<e;d++)for(var h=0;h<f;h++)Sc[a[h].type][b[d].type]=
c};L(y,n,4);L(n,n,3);L(n,B,3);L(n,w,3);L(n,F,5);L(n,l,2);L(A,B,4);L(A,g,4);L(A,w,6);L(A,l,4);L(A,F,9);L([h.samurai],m,.5);L([h.samurai],e,.3);L([h.ronin],J,1);L(D,d,6);L(G,D,1.5);L(G,p,1.5);L(G,[f.jihadwarrior],1);L([f.satrap],J,2);L(q,l,1.5);L(r,[b.dragon],.75);L(r,[b.bat],1);L(r,[c.pikeman],-.75);L(r,q,1);L(r,[h.chariot],-.3);L(r,C,.5);L(I,H,4);L(H,I,3);L(H,u,3);L(v,[b.bat],-.2);L(v,[b.dragon],-.5);L([b.stonegolem],z,1);L([b.dwarf],z,4);L(u,[h.priest],-.5);Ea={img:k.gath_point,x32:-10,y32:-10,d:0,
mv:!0};Cf=[Ea];e=va;p=Object.keys(e);for(d=0;d<x.length;d++)for(l=x[d],m=0;m<p.length;m++)l[p[m]]=e[p[m]];d=[c.archer,c.longbowman,h.archer,h.horsearcher,f.archer,f.horsearcher];m=[c.footman,c.maceman,c.knight,c.crusader,c.pikeman,f.jihadwarrior,f.cavalry,f.footman,f.enichar,c.peasant,f.peasant,f.satrap,f.spearman,b.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,b.skeleton,b.ghost,b.ork,b.dwarf];e=[c.footman,c.maceman,c.knight,c.crusader,c.pikeman,f.jihadwarrior,f.cavalry,
f.footman,f.enichar,c.peasant,f.peasant,f.satrap,f.spearman,b.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,c.archer,c.longbowman,h.archer,h.horsearcher,f.archer,f.horsearcher,c.wizard,f.mage,h.mage,c.priest,f.priest,h.priest,b.skeleton,b.ghost,b.ork,b.dwarf];E=[{name:["Longbow","Allows the production of longbowmen"],next:[a.createLongbowman],cost:[400,0,0,0],time:45,type:R},{name:["Gold Mining","Increases gold production"],increase:2,value:"gold",cost:[400,0,0,0],time:20,
type:Oa},{name:["Stone Mining","Increases stone production"],increase:2,value:"stone",cost:[400,0,0,0],time:20,type:Oa},{name:["Wood Cutting","Increases wood production"],increase:2,value:"wood",cost:[400,0,0,0],time:20,type:Oa},{name:["Temper Iron","Increases hand-to-hand units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:m,next:[a.techHalberd],type:kb},{name:["Scale Armor","Increases unit's defense"],increase:1,value:"defence",cost:[400,0,0,0],time:30,group:e,next:[a.techChainMail],
type:kb},{name:["Halberd","Allows the production of spear units"],next:[a.createPikeman,a.createPikeman2],cost:[400,0,0,0],time:30,type:R},{name:["Domestication","Allows the production of cows"],next:[a.createCow],cost:[300,0,0,0],time:20,type:R},{name:["Crop Rotation","Increases the production of fields"],increase:2,value:"food",cost:[400,0,0,0],time:20,type:Oa,next:[a.irrigation]},{name:["Chain Mail","Increases unit's defense"],increase:2,value:"defence",cost:[400,0,0,0],time:30,group:e,type:kb},
{name:["Plate Armor","Allows the production of knights"],next:[a.createKnight],cost:[400,0,0,0],time:60,type:R},{name:["Crossbow","Increases arrow units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:d,type:kb},{name:["Feudalism","Makes peasants cheaper"],cost:[300,0,0,0],time:30,decrease:[h.peasant,[0,0,8,0],c.peasant,[0,0,10,0],f.peasant,[0,0,10,0]],type:jg,next:[a.techSlavery]},{name:["Architecture","Peasants build faster, and allows stone wall, gate and towers"],increase:.5,
value:"buildSpeed",cost:[300,0,0,0],time:30,type:Oa,next:[a.upgradeStoneTower,a.techGreatWall,a.buildBridge]},{name:["Learning","Allows units to gather experience"],increase:1,value:"experience",cost:[400,0,0,0],time:30,type:Oa,next:[a.buildAcademy,a.buildAcademy1,a.buildAcademy2]},{name:["Convert Resources",""],cost:[400,0,0,0],time:30},{name:["Map Making","Allows the production of galleons"],cost:[800,0,0,0],time:30,type:R},{name:["Trade Routes","Allows trading"],cost:[400,0,0,0],time:30,type:R,
next:[a.techTradeTaxes]},{name:["Trade Taxes","Increases trade profit"],cost:[400,0,0,0],time:30},{name:["Usury","Allows the obtaining of loans in taverns"],cost:[300,0,0,0],time:30,type:pe,changeicon:38,next:[a.techBanking]},{name:["Supply Storage","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Oa,value:"popLimit",next:[a.techSeaFood]},{name:["Bribery","Allows the bribing of enemy units"],cost:[600,0,0,0],time:60,type:R,next:[a.bribe]},{name:["Heroism","Allows unlimited experience"],
cost:[500,0,0,0],time:30,increase:Infinity,value:"maxLevel",type:Oa,next:[a.techLeadership]},{name:["Warfare","Gain experience faster"],cost:[400,0,0,0],time:30,type:Oa,increase:1,value:"experience",next:[a.techTactics]},{name:["Tactics","Gain experience faster"],cost:[800,0,0,0],time:30,type:R,next:[a.buildDummy,a.techSunTzu]},{name:["Mercenaries","Allows the recruitment of units in taverns"],cost:[600,0,0,0],time:30,type:pe,next:[a.techHeroes,a.createMercenaries],actvintv:[a.iniMercenaries]},{name:["Heroes' Quest",
"Allows the recruitment of heroes in taverns"],cost:[800,0,0,0],time:30,type:pe,next:[a.techFame,a.createHeroes],actvintv:[a.iniHeroes]},{name:["Fame","Recruit better units from taverns"],cost:[500,0,0,0],time:30,value:"fameTech",increase:1,type:Oa},{name:["Siege Tactics","Allows the production of heavy catapults"],cost:[1200,0,0,0],time:60,type:R,next:[a.createHeavyCatapult]},{name:["Body Building","Increases unit's hit points at every new level"],cost:[800,0,0,0],time:60,value:"healthJump",increase:5,
type:Oa},{name:["Espionage","Allows the production of a spy"],cost:[400,0,0,0],time:30,type:R,next:[a.createSpy]},{name:["Fanaticism","Increases the building's resistance"],cost:[400,0,0,0],time:30,type:kb,group:[],increase:5,value:"resistance",next:[a.techCrusade,a.techJihad]},{name:["Crusade","Allows the preaching of a crusade"],cost:[1200,0,0,0],time:180,type:R,next:[a.createCrusaders]},{name:["Inquisition","Increases priest attack"],cost:[400,0,0,0],time:30,type:kb,group:[c.priest,f.priest,h.priest],
increase:5,value:"attack"},{name:["Healing","Allows healing of units"],cost:[400,0,0,0],time:30,next:[a.techMedicine,a.healing],type:R},{name:["Medicine","Allows remote healing of units"],cost:[500,0,0,0],time:30,value:"healingRange",increase:5,type:Oa},{name:["Bless","Temporarily increases unit attack skill"],cost:[400,0,0,0],time:30,type:R,next:[a.bless]},{name:["Invisibility","Invisibility spell"],cost:[500,0,0,0],time:30,type:R,next:[a.invisibility]},{name:["Bat","Researches bat summoning"],cost:[400,
0,0,0],time:240,type:R,next:[a.createBat]},{name:["Freeze","Freeze spell"],cost:[800,0,0,0],time:30,type:R,next:[a.freeze]},{name:["Lightning","Lightning spell"],cost:[400,0,0,0],time:30,type:R,next:[a.lightning]},{name:["Stone Golem","Researches stone golem summoning"],cost:[800,0,0,0],time:120,type:R,next:[a.createGolem]},{name:"Upgrade to Guard Tower",cost:[0,600,0,0],time:20,type:vd,obj:44,upgrade:1},{name:"Upgrade to Stone Tower",cost:[0,0,0,500],time:30,type:vd,obj:55,upgrade:1},{name:"Upgrade to Cannon Tower",
cost:[0,0,0,500],time:30,type:vd,obj:56,upgrade:1},{name:["Buddhism"],cost:[400,0,0,0],time:30,type:R,next:[a.buildCathedral1]},{name:["Cannon Tower","Allows the building of cannon towers"],next:[a.upgradeCannonTower],cost:[400,0,0,0],time:30,type:R},{name:["Engineering","Increases siege weapon's attack"],increase:5,value:"attack",cost:[400,0,0,0],time:30,group:[b.ballista,b.catapult,b.heavycatapult],type:kb},{name:["Great Wall","Makes stone walls, towers and gates stronger"],cost:[600,0,0,0],time:30,
type:R},{name:["Art of Riding","Allows the production of horse archers"],cost:[500,0,0,0],time:30,type:R,next:[a.createHorseArcher1,a.createHorseArcher2,a.techHorseManShip]},{name:["Irrigation","Increases field production"],increase:4,value:"food",cost:[400,0,0,0],time:30,type:Oa},{name:["Armored Chariot","Allows the production of armored chariots"],cost:[500,0,0,0],time:60,type:R,next:[a.createChariot]},{name:["Meditation","Makes monks cheaper"],cost:[300,0,0,0],time:30,decrease:[0,0,50,0],type:qe,
next:[a.techPhilosophy],group:[h.monk]},{name:["Kung-Fu","Increases the attack of all kung-fu units"],cost:[400,0,0,0],time:30,type:kb,increase:1,value:"attack",group:[h.peasant,h.ninja,h.monk,h.priest],next:[a.techMastery,a.techNinjas,a.techTournaments]},{name:["Tournaments","Allows sharing of experience between kung-fu units"],cost:[800,0,0,0],time:30,type:R,next:[]},{name:["Philosophy","Allows the production of more experienced monks"],cost:[400,0,0,0],time:30,type:kb,increase:2,value:"level",
group:[h.monk,h.priest],next:[a.createPriest1]},{name:["Ninjas","Allows the production of ninjas"],cost:[500,0,0,0],time:30,type:R,next:[a.createNinja]},{name:["Mastery","Allows priests to teach kung-fu units"],cost:[500,0,0,0],time:30,type:R,next:[a.teach]},{name:["Concentration","Allows faster manna restoration"],cost:[600,0,0,0],time:80,type:R,next:[a.techConfusion]},{name:["Confusion","Researches the Confusion spell"],cost:[400,0,0,0],time:30,type:R,next:[a.confusion]},{name:["Whirlpool","Researches the Whirlpool spell"],
cost:[300,0,0,0],time:30,type:R,next:[a.whirlpool]},{name:["Dragon","Researches Dragon summoning"],cost:[800,0,0,0],time:300,type:R,next:[a.createDragon]},{name:["Turn to Stone","Researches the Turn to Stone spell"],cost:[300,0,0,0],time:30,type:R,next:[a.turnToStone]},{name:["Flame Bolt","Researches the Flame Bolt spell"],cost:[400,0,0,0],time:30,type:R,next:[a.techDragon,a.flameBolt]},{name:["Jewelry","Allows trading of items"],cost:[400,0,0,0],time:30,type:R,next:[a.sellItems,a.buyItems]},{name:["Banking",
"Increases trade profit"],cost:[600,0,0,0],time:30,type:R},{name:["Chemistry","Increases arrow units' attack power"],cost:[500,0,0,0],time:30,type:kb,group:d,increase:1,value:"attack",next:[a.techGunPowder]},{name:["Sea Food","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Oa,value:"popLimit"},{name:["Gun Powder","Increases cannon tower's attack power"],cost:[500,0,0,0],time:30,type:kb,increase:10,value:"attack",group:[b.cannontower],next:[a.techRocketArrow]},{name:["Rocket Arrow",
"Allows the building of rocket tower"],cost:[800,0,0,0],time:30,type:R,next:[a.buildRocketTower]},{name:["Bushido","Allows the production of horse samurai"],cost:[800,0,0,0],time:120,type:R,next:[a.createHorseSamurai]},{name:["Leadership","Units around a hero gain experience"],cost:[600,0,0,0],time:30,type:R,next:[a.techHonor]},{name:["Honor","Hero vs. hero attack bonus"],cost:[500,0,0,0],time:30,type:R},{name:["Sun Tzu's Book","Increases the speed of learning"],cost:[800,0,0,0],time:30,type:Oa,increase:1,
value:"experience"},{name:["Cow Poaching","Allows peasants to steal cows"],cost:[200,0,0,0],time:30,type:Oa,increase:1,value:"stealCows"},{name:["Horsemanship","Makes mounted units cheaper"],cost:[500,0,0,0],time:30,type:qe,mulp:.75,group:[h.horsearcher,f.cavalry,f.horsearcher]},{name:["Scimitar","Increases sword attack power and allows the production of satraps"],cost:[400,0,0,0],time:30,type:kb,increase:1,value:"attack",group:m,next:[a.createSatrap]},{name:["Jihad","Allows the production of Jihad Warriors"],
cost:[1200,0,0,0],time:30,type:R,next:[a.createJihad,a.convertJihad]},{name:["Magic Carpet","Researches Magic Carpet summoning"],cost:[300,0,0,0],time:30,type:R,next:[a.createCarpet,a.techJinn]},{name:["Magic Workshop","Allows the building of a magic workshop"],cost:[1200,0,0,0],time:180,type:R,next:[a.buildMagicWorkshop]},{name:["Rain of Fire",""],cost:[800,0,0,0],time:60,type:R,next:[a.fireRain]},{name:["Magic Vision","Researches the Magic Vision spell"],cost:[400,0,0,0],time:30,type:R,next:[a.magicVision]},
{name:["Necromancy","Researches the Raise the Dead spell"],cost:[400,0,0,0],time:30,type:R,next:[a.raiseDead]},{name:["Jinn","Researches Jinn summoning"],cost:[600,0,0,0],time:300,type:R,next:[a.createJinn]},{name:["Ore Enrichment","Increases mine production"],cost:[800,0,0,0],time:30,type:Oa,increase:1,value:"miningPerf"},{name:["Riding Horses","Increases the mounted units' attack and defense power"],cost:[500,0,0,0],time:30,type:Uh,values:["attack",2,"defence",1],group:[h.horsearcher,f.cavalry,
f.horsearcher],next:[a.techJanissary]},{name:["Janissary","Allows the production of Janissaries"],cost:[1200,0,0,0],time:120,type:R,next:[a.createEnichar]},{name:["Slavery","Makes peasants cheaper"],cost:[200,0,0,0],time:30,decrease:[h.peasant,[0,0,7,0],c.peasant,[0,0,8,0],f.peasant,[0,0,8,0]],type:jg}];Xi();a.buildMarket.disabled=1;Yi();m=0;for(l=x.length;m<l;m++)if(e=x[m],e.onbuild)for(c=e.onbuild,d=0,h=c.length;d<h;d++)f=c[d],f.obj.race==e.race&&(f.disabled=1,f.require=e.name,f.requireObj||(f.requireObj=
[]),f.requireObj.put(e));d=0;for(h=E.length;d<h;d++)if(f=E[d],f.tech=1,f.id=d,f.next)for(c=f.next,p=0,m=c.length;p<m;p++)e=c[p],e.disabled?(e.disabled++,e.require+=", "+f.name[0],e.requireObj.put(f)):(e.requireObj=[f],e.disabled=1,e.require=f.name[0]);d=0;c=x;for(h=c.length;d<h;Uj(c[d++]));}new bc("",[255,255,255],[0],!0)},x,Sc,Kg,Ea,Cf,qd,Lg=8,v=new Float32Array(16),ec=function(a,b,e,c,d,h,l){var f=x[a];if(h=h&&!f.instantBuild)this.built=!1;var g=J[b],k=g.mod[a],n=Object.keys(k);this.__proto__=f;
this.kingdom=b;this.d=d;this.x32=e;this.y32=c;this.taskList=[];d=0;for(var q=n.length;d<q;this[n[d]]=k[n[d++]]);if(l)for(k=Object.keys(l),d=0,q=k.length;d<q;this[k[d]]=l[k[d++]]);0<f.invMax&&(this.inventory=[]);f.build||(this.mv=1);l=g.technology.disabled;k=f.actvintv;this.workers=[];this.id=q=B.length;f.rndDirection&&(this.d=q*e%f.rndDirection);this.build||g.values.pop++;e=f.validator(e,c,f.space,b);if(e[1]){c=f.validator.dimension;n=e[0];if(h){c=pa;this.onbuild1=n;var r=qb[b];d=0;for(f=n.length;d<
f;d++)r[n[d]]=q}else for(d=0,f=n.length;d<f;c[n[d++]]=q);if(e[2])if(n=e[2],h){K(n);d=0;for(f=n.length;d<f;c[n[d++]]=q);this.onbuildValid=n}else for(d=0,f=n.length;d<f;c[n[d++]]=0);}else return this.invalid=!0,!1;B[q]=this;eb[b][a].put(q);if(this.update&&!u.custom)for(a=this.update,d=0,q=a.length;d<q;d+=3)ya({func:he,data:[this.id,a[d],a[d+1],a[d+2]]},a[d+2],1);if(k)for(a=0,f=k.length;a<f;a++)b=k[a],l[b.id]||b(this);h?(Sa(this),A.kingdom==this.kingdom?(K(h),Zc(this,ak)):Zc(this,bg)):Sa(this);this.level&&
!this.potion&&Ph(this);!this.standardFunc||this.func||u.editor||this.standardFunc(this);h=g.stats;h.unitCount[this.type]++;g=h.unitCount[this.type]-h.unitCountDeath[this.type];g>h.unitCountMax[this.type]&&(h.unitCountMax[this.type]=g)},Zh=function(a){var b=J[a.kingdom];if(a.population){var f=a.population;b.values.popMax+=f;ud(a.kingdom);for(var c=0;c<f;c++)b.checkPopArray()}if(a.onbuild)for(a=a.onbuild,f=b.technology,b=f.disabled,f=f.actived,c=0;c<a.length;c++){var d=a[c].id;f[d]||(f[d]=0);f[d]++;
f[d]-1||(b[d]--,!b[d]&&ha.actv[d]&&ha(H.active))}},Yb=[],V=new Float32Array(12),Mg=function(a,b,e){var c=a.length;a[c]=b;a[c+1]=b+1;a[c+2]=b+2;a[c+3]=b+1;a[c+4]=b+2;a[c+5]=b+3;a.changed=!0;e.typeBuffer=a;e.elemtId=c},Zc=function(a,b){var f=b[3];if(b.noAlpha)c=aa;else{a.alpha=!0;var c=ca}if(a.typeBuffer!==c){if(b==bg){if(Va.diplomacy[a.kingdom]){vb(a);return}b=new Float32Array(wb(za[3*a.kingdom],za[3*a.kingdom+1],za[3*a.kingdom+2],f+1))}vb(a);Mg(c,a.bufferID,a)}g.bindBuffer(g.ARRAY_BUFFER,Ya);g.bufferSubData(g.ARRAY_BUFFER,
16*a.bufferID,b)},hc=function(a){var b=mf(a,a.kingdom),f=b[0],c=b[1],d=b[2];b=b[3];var h=a.bufferID;Zi(f,c,d,b,a.bufferID);1>b?(a.alpha=!0,f=ca):f=aa;a.typeBuffer!==f&&(vb(a),Mg(f,h,a));if(a.child&&(!1!==a.built||!a.build))for(var l=a.child,g=0,k=l.length;g<k;g++)h+=4,b=mf(l[g],a.kingdom),f=b[0],c=b[1],d=b[2],b=b[3],Zi(f,c,d,b,h)},mf=function(a,b){if(null!=a.rgb){var f=a.rgb;a=f[0];var c=f[1];b=f[2];f=f[3]}else ta[a.img][3]?(a=za[3*b],c=za[3*b+1],b=za[3*b+2],f=2):(a.mMapcolor?(b=a.mMapcolor,a=b[0]/
255,c=b[1]/255,b=b[2]/255):(a=za[3*b],c=za[3*b+1],b=za[3*b+2]),f=1);return[a,c,b,f]},$i=function(){if(Yb.length){var a=Yb[Yb.length-1];Yb.length--}else a=Lg,Lg+=4;return a},Sa=function(a,b,e,c){void 0==b&&(c=e=b=0);var f=ta[a.img],h=1;if(a.bufferID){var l=a.bufferID;h=0}else l=$i();a.bufferID=l;var k=f[2]*a.d*6+4,p=f[4+k],m=f[5+k];k=f[0];var n=f[1];0<=n&&(n*=.001);var q=f.id+4*a.d*f[2],r=-1;a.mv&&(r=u.now());v[0]=q;v[1]=r;v[2]=k;v[3]=n;v[4]=q+1;v[5]=r;v[6]=k;v[7]=n;v[8]=q+2;v[9]=r;v[10]=k;v[11]=n;
v[12]=q+3;v[13]=r;v[14]=k;v[15]=n;var w=32*a.x32,x=32*a.y32;k=32*a.y32;null!=a&&null!=a.z32&&(k*=a.z32);var y=aa;g.bindBuffer(g.ARRAY_BUFFER,Nc);g.bufferSubData(g.ARRAY_BUFFER,16*l,v);g.bindBuffer(g.ARRAY_BUFFER,Sb);if(a.rotation){var z=a.rotation;z*=2*Math.PI;var B=.5*f[8];n=.5*f[9];f=-1*k;q=-B;r=-n;var A=0*V.length;V[A]=q*Math.cos(z)-n*Math.sin(z)+w;V[A+1]=n*Math.cos(z)+q*Math.sin(z)+x;V[A+2]=f;V[A+3]=q*Math.cos(z)-r*Math.sin(z)+w;V[A+4]=r*Math.cos(z)+q*Math.sin(z)+x;V[A+5]=f;V[A+6]=B*Math.cos(z)-
n*Math.sin(z)+w;V[A+7]=n*Math.cos(z)+B*Math.sin(z)+x;V[A+8]=f;V[A+9]=B*Math.cos(z)-r*Math.sin(z)+w;V[A+10]=r*Math.cos(z)+B*Math.sin(z)+x;V[A+11]=f}else a.wh?(z=a.wh[0],B=a.wh[1],z-=p,B-=m,V[0]=w,V[1]=x,V[2]=k,V[3]=w+z,V[4]=x,V[5]=k,V[6]=w,V[7]=x+B,V[8]=k,V[9]=w+z,V[10]=x+B):(V[0]=w,V[1]=x,V[2]=k,V[3]=w,V[4]=x,V[5]=k,V[6]=w,V[7]=x,V[8]=k,V[9]=w,V[10]=x),V[11]=k;g.bufferSubData(g.ARRAY_BUFFER,12*l,V);r=mf(a,a.kingdom);f=r[0];n=r[1];q=r[2];r=r[3];if(1>r||a.alpha)a.alpha=!0,y=ca;g.bindBuffer(g.ARRAY_BUFFER,
Ya);v[0]=f;v[1]=n;v[2]=q;v[3]=r;v[4]=f;v[5]=n;v[6]=q;v[7]=r;v[8]=f;v[9]=n;v[10]=q;v[11]=r;v[12]=f;v[13]=n;v[14]=q;v[15]=r;g.bufferSubData(g.ARRAY_BUFFER,16*l,v);g.bindBuffer(g.ARRAY_BUFFER,id);z=u.now();v[0]=b;v[1]=e;v[2]=c;v[3]=z;v[4]=b;v[5]=e;v[6]=c;v[7]=z;v[8]=b;v[9]=e;v[10]=c;v[11]=z;v[12]=b;v[13]=e;v[14]=c;v[15]=z;g.bufferSubData(g.ARRAY_BUFFER,16*l,v);h&&Mg(y,l,a);if(a.child&&!1!==a.built)for(b=k,e=a.child.length,c=[],a.childLoc=c,h=0;h<e;h++){y=a.child[h];f=ta[y.img];k=f[2]*a.d*6+4;z=f[4+k];
B=f[5+k];k=f[0];n=f[1];0<=n&&(n*=.001);q=f.id+4*a.d;r=-1;y.mv&&(r=1);v[0]=q;v[1]=r;v[2]=k;v[3]=n;v[4]=q+1;v[5]=r;v[6]=k;v[7]=n;v[8]=q+2;v[9]=r;v[10]=k;v[11]=n;v[12]=q+3;v[13]=r;v[14]=k;v[15]=n;r=mf(y,a.kingdom);f=r[0];n=r[1];q=r[2];r=r[3];A=w;var D=x;y.wh1&&(z=y.wh[0],B=y.wh[1]);y.center&&(A-=.5*~~(z-p),D-=.5*~~(B-m));l=$i();g.bindBuffer(g.ARRAY_BUFFER,Nc);g.bufferSubData(g.ARRAY_BUFFER,16*l,v);g.bindBuffer(g.ARRAY_BUFFER,Ya);v[0]=f;v[1]=n;v[2]=q;v[3]=r;v[4]=f;v[5]=n;v[6]=q;v[7]=r;v[8]=f;v[9]=n;v[10]=
q;v[11]=r;v[12]=f;v[13]=n;v[14]=q;v[15]=r;g.bufferSubData(g.ARRAY_BUFFER,16*l,v);k=y.z?32*y.z+b:b;g.bindBuffer(g.ARRAY_BUFFER,Sb);V[0]=A;V[1]=D;V[2]=k;V[3]=A;V[4]=D;V[5]=k;V[6]=A;V[7]=D;V[8]=k;V[9]=A;V[10]=D;V[11]=k;g.bufferSubData(g.ARRAY_BUFFER,12*l,V);g.bindBuffer(g.ARRAY_BUFFER,id);v[0]=0;v[1]=0;v[2]=0;v[3]=0;v[4]=0;v[5]=0;v[6]=0;v[7]=0;v[8]=0;v[9]=0;v[10]=0;v[11]=0;v[12]=0;v[13]=0;v[14]=0;v[15]=0;g.bufferSubData(g.ARRAY_BUFFER,16*l,v);k=1>r?ca:y.light?Ca:aa;c.put(k);z=k.length;c.put(z);k[z]=
l;k[z+1]=l+1;k[z+2]=l+2;k[z+3]=l+1;k[z+4]=l+2;k[z+5]=l+3;k.changed=!0}};ObjectsetupPhysics=function(a,b,e,c){var f=u.now(),h=a.bufferID;v[0]=b;v[1]=e;v[2]=c;v[3]=f;v[4]=b;v[5]=e;v[6]=c;v[7]=f;v[8]=b;v[9]=e;v[10]=c;v[11]=f;v[12]=b;v[13]=e;v[14]=c;v[15]=f;g.bindBuffer(g.ARRAY_BUFFER,id);g.bufferSubData(g.ARRAY_BUFFER,16*h,v);g.bindBuffer(g.ARRAY_BUFFER,null);if(a.tempChild)for(f=0,a=a.tempChild,h=a.length;f<h;ObjectsetupPhysics(a[f++],b,e,c));};var aj=function(a,b,e,c,d,h){sa[0]=a;sa[1]=b;sa[2]=e;sa[3]=
a+c;sa[4]=b;sa[5]=e;sa[6]=a;sa[7]=b+d;sa[8]=e;sa[9]=a+c;sa[10]=b+d;sa[11]=e;g.bindBuffer(g.ARRAY_BUFFER,Sb);g.bufferSubData(g.ARRAY_BUFFER,12*h,sa);g.bindBuffer(g.ARRAY_BUFFER,null)},Zi=function(a,b,e,c,d){v[0]=a;v[1]=b;v[2]=e;v[3]=c;v[4]=a;v[5]=b;v[6]=e;v[7]=c;v[8]=a;v[9]=b;v[10]=e;v[11]=c;v[12]=a;v[13]=b;v[14]=e;v[15]=c;g.bindBuffer(g.ARRAY_BUFFER,Ya);g.bufferSubData(g.ARRAY_BUFFER,16*d,v);g.bindBuffer(g.ARRAY_BUFFER,null)};ObjectsetupPosition=function(a,b){a.z32&&(b*=a.z32);var f=32*a.x32,c=32*
a.y32;a.wh?aj(f,c,b,a.wh[0]-ta[a.img][8],a.wh[1]-ta[a.img][9],a.bufferID):aj(f,c,b,0,0,a.bufferID);if(a.tempChild)for(b=a.tempChild,f=0,c=b.length;f<c;f++){var d=b[f];d.x32=a.x32;d.y32=a.y32;ObjectsetupPosition(d,32*a.y32)}};ObjectindexHide=function(a){ObjectsetupPosition(a,NaN)};ObjectindexShow=function(a){var b=1;a.z32&&(b=a.z32);ObjectsetupPosition(a,32*a.y32*b)};var va={getRadix:function(){return Ua[this.zLevel]},checkMana:function(a,b,e,c){if(!this.mana)return!1;if(0>this.mana-a)return this.manaTask=
[e.url,b,a],this.stay55(),a>this.manaMax&&c&&(this.blockedCost=c,b=this.setupChild(Ab.curse,1),this.blocked=2,this.blockedimg=b,this.manaTarget=a,g.bindBuffer(g.ARRAY_BUFFER,Ya),g.bufferSubData(g.ARRAY_BUFFER,16*this.bufferID,ke),g.bufferSubData(g.ARRAY_BUFFER,16*b.bufferID,ke)),!1;this.mana-=a;return!0}},Ob=function(a,b){return u.editor?!0:a.freezed||a.confused?!1:J[a.spy||a.kingdom].control[b.spy||b.kingdom]};va.changeKingdom=function(a){eb[this.kingdom][this.type].quit(this.id);if(Qb[this.id]){Qb[this.id]=
0;var b=!0;F.quit(this.id);0==F.length&&(ha([]),Md(),Pb=-1)}this.kingdom=a;hc(this);this.childBuild&&(this.childBuild=0);this.build&&!this.arrow||this.stay();eb[a][this.type].put(this.id);b&&(Ob(this,A)&&F.put(this.id),Qb[this.id]=1,Pa=this,Z(this.id))};va.aspettare=function(){this.getRadix()[this.x32+this.y32*y]=this.id;this.waiting=!0;ObjectsetupIMG(this,this.url.idle);ObjectsetupPhysics(this,0,0,0);mb(this,~~(32E3/this.spd))};va.addItem=function(a){var b=this.inventory;b&&(b[b.length]=a.id,a.sword||
a.shield)&&(a.attack&&(this.attack+=a.attack),a.defence&&(this.defence+=a.defence))};va.showInventory=function(){hf();for(var a=this.inventory,b=0;8>b;b++){var e=a[b];if(!e)break;var c=Ia[b];c.style.backgroundPosition="0px "+48*e.iconID+"px";c.className="";We[b]=null}};va.deleteItem=function(a){this.inventory.quit(a.id);this.attack-=a.attack;this.defence-=a.defence};va.useItem=function(a){48==a.type&&(this.health+=a.lives,this.health>this.maxHealth&&(this.maxHealth=this.health),this.inventory.quit(a.id))};
va.onattack=function(a){!this.attack||this.freezed||this.death||this.func!=Rd.url&&this.func||qc(a.id,[this.id],1)};ObjectsetupINTV1=function(a,b,e){this.data=b;this.func=a.url;this.time=~~(.04*e);ya(this,e);return e};va.setupINTV=function(a,b,e){this.funcObj=b;a.url||K(a,a.url);this.func=a.url;this.deleteWorker();mb(this,e);return e};va.damage=function(a,b){if(!(this.zolotoy||this.death||this.stoned)){this.defence&&(a-=this.defence);1>a&&(a=1);this.health-=a;b=J[b.kingdom].stats;b.dmgInflicted+=
a;var f=J[this.kingdom].stats;f.dmgTaken+=a;1>this.health?(this.build?(f.buildsLosed++,b.buildsKilled++):(f.unitsLosed++,b.unitsKilled++),this.die()):Z(this.id,1)}};var Z=function(a,b){if(Qb[a]||!1===a)return a=F.length,1===a?(a=B[F[0]],H.stockActive==a&&a.inventory.length?(Ac(a.id,1,1),Di(a,1)):a.build?Ha(a,1):Ac(a.id,b)):1<a?Eg(F,b):Ri(Pa),!0};va.setupSpellIMG=function(a){this.invisible&&Yc(this.id);this.url.spell&&ObjectsetupIMG(this,this.url.spell,1);a||ya({func:bj,data:this.id},Ta(this.img),
1)};var bj=function(a){a=B[a];a.death||a.stay()};va.setupChild=function(a,b,e){var c={x32:this.x32,y32:this.y32,d:a.d,img:a.img,mv:a.mv,parent:this.id,z32:a.z32};if((this.dix||this.diy)&&!this.waiting){var f=.001*(u.now()-this.timestamp);c.x32+=this.dix*f/32-Math.sign(this.dix);c.y32+=this.diy*f/32-Math.sign(this.diy)}if(a.select){if(this.space)a=this.space[this.space.length-1],h=(this.space.length-1)/a;else{a=this.sSizex||1;var h=this.sSizey||1}this.z32&&(c.z32=this.z32);c.wh=[32*a-3,32*h-3];this.selectAnim=
c}Sa(c);f&&ObjectsetupPhysics(c,this.dix,this.diy,0);e&&(g.bindBuffer(g.ARRAY_BUFFER,Ya),g.bufferSubData(g.ARRAY_BUFFER,16*c.bufferID,e));this.tempChild||(this.tempChild=[]);this.tempChild.put(c);b||yb.new(c,Ta(c.img),cj);return c};var cj=function(a){B[a.parent].tempChild.quit(a);vb(a)};va.distance=0;ObjectsetupIMG=function(a,b,e,c){a.img=b;b=ta[b];var f=b[0],h=b[1];0<=h&&(h*=.001);c&&(h*=c);b=b.id+4*a.d*b[2];c=-1;1===e?c=u.now():0>e&&(c=1);e=c;a=a.bufferID;v[0]=b;v[1]=e;v[2]=f;v[3]=h;v[4]=b+1;v[5]=
e;v[6]=f;v[7]=h;v[8]=b+2;v[9]=e;v[10]=f;v[11]=h;v[12]=b+3;v[13]=e;v[14]=f;v[15]=h;g.bindBuffer(g.ARRAY_BUFFER,Nc);g.bufferSubData(g.ARRAY_BUFFER,16*a,v);g.bindBuffer(g.ARRAY_BUFFER,null)};va.setupDir=function(a,b,e){a=Math.sign(a);b=Math.sign(b);a=3*(b-1)+(a+1);2==a?this.d=1:-6==a?this.d=5:0==a?this.d=7:-4==a?this.d=3:-1==a?this.d=2:1==a?this.d=0:-5==a?this.d=4:-3==a&&(this.d=6);e&&(this.d=(this.d+e)%8)};va.setupDirBuild=function(a){var b=Y;1==a.health&&0==a.built&&(b=qb[a.kingdom]);a=a.id;var f=
y,c=this.x32+this.y32*f;b[c+f]==a?this.d=0:b[c-f]==a?this.d=4:b[c+1]==a?this.d=2:b[c-1]==a?this.d=6:b[c+f+1]==a?this.d=1:b[c-f+1]==a?this.d=3:b[c+f-1]==a?this.d=7:b[c-f-1]==a&&(this.d=5)};va.spdMod=0;var og=function(a,b){b=b.length;for(var f=0;f<b;f++){var c=B[F[f]];c.build||(c.spd=a)}};va.stay=function(a){this.mv=1;this.func=this.time=void 0;this.diy=this.dix=0;this.c=void 0;this.xf=null;ObjectsetupPhysics(this,0,0,0);a||(this.stock&&0!==this.stock[0]?ObjectsetupIMG(this,this.img,NaN):ObjectsetupIMG(this,
this.__proto__.img,1),this.deleteWorker(),this.standardFunc&&2!==this.stop&&this.standardFunc(this))};va.stay55=function(){this.stock&&0!==this.stock[0]?ObjectsetupIMG(this,this.img,NaN):ObjectsetupIMG(this,this.__proto__.img,1);this.deleteWorker();this.standardFunc&&this.standardFunc(this)};var Hk=[],vb=function(a){a.elemtId&&(dj(a.elemtId,a.typeBuffer),a.elemtId=void 0,a.typeBuffer=void 0)},Th=function(a){if(a.childLoc){a=a.childLoc;for(var b=0,f=a.length;b<f;b+=2)dj(a[b+1],a[b])}},dj=function(a,
b){b[a]=NaN;b[a+1]=NaN;b[a+2]=NaN;b[a+3]=NaN;b[a+4]=NaN;b[a+5]=NaN;b.changed=!0;Hk.put(a)};va.addWorker=function(a){this.workers.put(a.id);a.workingOn=this.id};va.deleteWorker=function(){this.workingOn&&(B[this.workingOn].workers.quit(this.id),this.workingOn=0);this.actionItem&&(this.actionItem=void 0);this.blockedAction()};va.blockedAction=function(a){var b=this.blocked;if(ej[b])ej[b](this,a)};var ej={2:function(a,b){a.blocked=void 0;hc(a);cj(a.blockedimg);a.blockedimg=void 0;a.manaTarget=void 0;
b||(J[a.kingdom].setupResources(a.blockedCost,-1),a.blockedCost=void 0)}},vi=function(a){return k.delay[-a[1]+a[0]-1]},zd=function(a){var b=F.length;F.quit(a);if(b!=F.length){var f=B[a];f.selectAnim=void 0;b=0;for(f=f.tempChild;b<f.length;b++){var c=f[b];vb(c);var d=f.length;f.quit(c);d!=f.length&&b--}Qb[a]=void 0;0==F.length?Md():1==F.length?Ac(a):Eg(F)}Pa&&Pa.id===a&&(Md(),Pa.selectAnim&&(vb(Pa.selectAnim),Pa.selectAnim=void 0),Pa=void 0)};va.base=function(a){return Ua[this.zLevel][a]};va.rbase=
function(){return Ua[this.zLevel]};var Pe;va.die=function(a){if(!this.death){var b=y,f=this.id,c=this.kingdom,d=J[c];this.waitlist&&(d.unitLoading-=.5*this.waitlist.length);if(this.dieSound&&!u.editor){var h=this.dieSound;xa(h[~~(h.length*Math.random())],this.x32,this.y32)}zd(this.id);(this.freezed||this.invisible)&&hc(this);var l=this.x32,g=this.y32;this.death=1;1==this.zLevel&&(Pe[l+g*b]=1);this.c=void 0;var p=this.url.die||this.dimg;Th(this);d.IA&&d.IA.valorateLost&&d.IA.valorateLost(this);if(this.food&&
!u.editor){var m=100,n=this.food/m,q=~~n,r=~~((n-q)*m);for(h=0;h<n;h++){h==q&&r&&(m=r);var v=Xh(l,g),w=~~(v/b);v%=b;v=new ec(52,c,v,w,0);ObjectsetupIMG(v,k.item_meat);v.contain=[m,2,ek]}}d.stats.unitCountDeath[this.type]++;h=this.x32;b=this.y32;a||u.editor?(vb(this),Yb.put(this.bufferID)):p?(this.mv=!0,ObjectsetupIMG(this,p,1),a=ta[this.img],p=a[1],p=0>p?vi(a):1E3*a[0]/p,ya({func:ui,data:this.id},p-25,1),ObjectsetupPhysics(this,0,0,0),void 0!==this.dix&&(a=.001*(u.now()-this.timestamp),this.x32+=
this.dix*a/32-Math.sign(this.dix),this.y32+=this.diy*a/32-Math.sign(this.diy))):this.dimgInfinity?(this.dimgRND&&(this.d=this.id%this.dimgRND),ObjectsetupIMG(this,this.dimgInfinity)):(vb(this),Yb.put(this.bufferID));this.techStart&&oe(0,[this.id]);ObjectsetupPosition(this,32*this.y32-36);this.x32=h;this.y32=b;this.build||d.values.pop--;this.population&&this.built&&(d.values.popMax-=this.population);g=this.validator(l,g,this.space,this.kingdom);a=g[0];if(this.onbuild&&!u.editor)for(l=this.onbuild,
p=d.technology,h=p.disabled,p=p.actived,b=0;b<l.length;b++)c=l[b].id,p[c]--,0===p[c]&&h[c]++;l=this.validator.dimension;h=0;for(p=a.length;h<p;h++)b=a[h],l[b]=Mb[b]?Mb[b]:0;if(1==this.health&&!this.built)for(b=qb[this.kingdom],h=0,p=a.length;h<p;b[a[h++]]=void 0);if(g[2])for(a=g[2],h=0,p=a.length;h<p;h++)b=a[h],Mb[b]?(2<l[b]&&B[l[b]].die(1),l[b]=Mb[b]):(2<l[b]&&B[l[b]].die(),l[b]=0);eb[this.kingdom][this.type].quit(this.id);if(this.workers){h=0;l=this.workers.slice(0);for(p=l.length;h<p;h++)g=B[l[h]],
g.workingOn===f&&(g.workingOn=0,g.func!==mg.url&&g.stay());this.workers.length=0}this.deleteFromList&&(l=this.deleteFromList,l.quit(this),l.length||l.length0function(this));this.func=this.time=void 0;this.diy=this.dix=0;this.inventory&&0<this.inventory.length&&Vc(this.id,this.inventory.slice(0));this.stock&&Wh(this);u.editor||(d.check(),ud(this.kingdom),d.checkPopArray());this.deleteWorker()}};Array.prototype.quit=function(a){a=this.indexOf(a);return-1<a?(this.splice(a,1),!0):!1};Array.prototype.add=
function(a){0>this.indexOf(a)&&(this[this.length]=a)};var La=["European","Arab","Asian"];z={open:"Open",loading:"Loading...",systemAlert:"System Message",notEnough:"Not enough %s",ok:"OK",yes:"Yes",no:"No",secure:"Are you sure?",gold:"Gold",stone:"Stone",wood:"Wood",food:"Food",mana:"Mana",warning:"Warning",play:"PLAY",close:"CLOSE",gameClosed:"The game was canceled by the server.",loadgraphics:"Downloading graphics...",waitImages:"Downloading graphics",wait:"Wait",audioproblem:"Your browser is not compatible with Web Audio",
defeated:"DEFEATED",victorious:"VICTORIOUS",options:"OPTIONS",refresh:"Refresh",back:"BACK",paused:"PAUSED",chatMsg:"CHAT MESSAGE",disconnect:"Disconnect",playerDisconnected:"%s has disconnected!",connectionError:"Connection error",noP2P:"Engine not loaded",startingResources:"Starting Resources",mapSize:"Map Size",menu:"MENU",quit:"QUIT",continue:"Continue",backToGame:"BACK TO GAME",initializing:"Initializing...",requires:"Requires",attack:"Attack enemy",stop:"Stop",pickItems:"Pick items",move:"Move",
stand:"Stand ground",explore:"Explore",patrol:"Patrol",guard:"Guard",extension:"Do you want download 'Tzared boost' extension?",errorLoading:"Error loading game.",waitingPlayers:"Waiting for players to connect",musicVolume:"Music Volume",soundVolume:"Sound Volume",common:"Common",popLimit:"Population limit reached",houseLimit:"Not enough houses",lightning:"Lightning",freeze:"Freeze",bless:"Bless",heal:"Heal",invisibility:"Invisibility",dcm:"Dig, chop or mine",repair:"Repair building",menuBuild:"See what you can build",
units:"Units",infinite:"Infinite",gameFull:"Sorry, the game is full.",terrainOption:"Terrain",playerDefeated:"%s has been defeated!",savegame:"SAVE GAME",loadRecord:"Recording",stats:"Stats",builds:"Builds",items:"Items",nature:"Nature",trees:"Trees",delete:"Delete",create:"Create",username:"Player Name",gameOptions:"GAME OPTIONS",nplayers:"Number of Players",gameName:"Enter Game Name",gamesFound:"Games Found",strSearch:"SEARCH| Search for existing games",strCreate:"CREATE| Create a game",randomMap:"RANDOM MAP",
strcusMap:"CUSTOM MAP",mapMaking:"Map Making"};var Oh={euro:"Lancelot Arthur Guivain Merlin Blackthorn Morin Golstuck Karambol Kelerick Rockmore Bridport Casevil Stirm Tonis Pelegrim Peresohn Pirk Pharn Gork".split(" "),arab:"Ibn Fadlan;Mohammad;Al Ferissa;Harun Al Rashid;Sindbad;Mellemad;Moarrac;Sakhavan;Bellefars;Mokhac;Norahz;Kerhetin;Maham;Dushesh;Direkh".split(";"),asia:"Ishida Toranaga Ichinzen Haiako Mozuki Hitachi Tosheba Harachiko Marasuma Korodzum Ishinghen Genghis Musa Echibo Ichikahr Yotokan Maraga".split(" "),
common:"Fistantilus Skenderbeg Raislin Tenis Morok Sokob Baras Haram Billihz Ynte Orgh Savael Birgos Savator Gandeh Gordor Fessh Gilmi Phergas".split(" ")},Ng=[z.gold,z.wood,z.food,z.stone,z.mana],$c=function(a,b,e){e&&(a=a.replace("%d",e));return a.replace("%s",b)},bd={},Xi=Hg,gj=function(f){f--;var b=new XMLHttpRequest;b.open("GET","https://dl.dropboxusercontent.com/s/ssnjwy6sm462q89/dictionary.json?v1=1",!0);b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onreadystatechange=
function(){if(4==b.readyState&&200==b.status){var e=JSON.parse(b.response);Xi=function(){for(var a=x,b=0;b<a.length;b++){var c=a[b].name;e[c]&&(a[b].name=e[c][f])}for(b=0;b<E.length;b++)a=E[b],e[a.name[0]]&&e[a.name[1]]&&(a.name[0]=e[a.name[0]][f],a.name[1]=e[a.name[1]][f]);e=null};for(var c=[],d=0;0>d;d++)"undefined"!=typeof a[d]&&null!=a[d].tech&&(c.push(a[d].tech.name),Object.freeze(a[d].tech));for(d=0;d<c.length;d++)c[d][0]=e[c[d][0]][f],c[d][1]=e[c[d][1]][f];c=Object.keys(z);for(d=0;d<c.length;d++){var h=
c[d];void 0!=e[z[h]]&&(z[h]=e[z[h]][f])}Object.freeze(z);for(d=0;d<La.length;d++)La[d]=e[La[d]][f];for(d=0;d<0*Ng.length;d++)Ng[d]=e[Ng[d]][f];Object.freeze(La);fj()}};b.send()};0<A.lang&&(gj(A.lang),gj.translated=!0);var fj=function(){for(var a=["refreshButton",z.refresh,"optionsButton",z.options,"startButton",z.play,"backButton",z.back,"closeButton",z.close,"quitButton",z.quit,"continueButton",z.continue],b=0,e=a.length;b<e;b+=2)for(var c=document.getElementsByClassName(a[b]),d=0,h=c.length;d<h;d++)c[d].innerHTML=
a[b+1];a=["alertok",z.ok,"sendMessageH2",z.chatMsg,"mapsizeOption",z.mapSize,"startingResourcesOption",z.startingResources,"goldWord",z.gold,"stoneWord",z.stone,"foodWord",z.food,"woodWord",z.wood,"gameMenu",z.menu,"infiniteWord",z.infinite,"backToGame",z.backToGame,"backToGameS",z.backToGame,"musicVolume",z.musicVolume,"soundVolume",z.soundVolume,"menueditor",z.menu,"terrainOption",z.terrainOption,"saveGame",z.savegame,"playrecord",z.loadRecord,"seeStats",z.stats,"selectBuilds",z.builds,"selectUnits",
z.units,"selectItems",z.items,"selectNature",z.nature,"gamesFound",z.gamesFound,"strSearch",z.strSearch.split("| ")[1],"strCreate",z.strCreate.split("| ")[1],"strRandomMap",z.randomMap,"strcusMap",z.strcusMap,"strMapEditor",z.mapMaking];b=0;for(e=a.length;b<e;b+=2)document.getElementById(a[b]).innerHTML=a[b+1]};fj();var Db={},cd,Ff=function(){for(var a="mapx mapwidth goldRes goldValue woodRes woodValue foodRes foodValue stoneRes stoneValue infinity infiniteValue".split(" "),b=0,e=a.length;b<e;b+=
2){var c=document.getElementById(a[b+1]).value;K(c);"infinity"==a[b]?(c=document.getElementById(a[b+1]).checked,u[a[b]]=c):u[a[b]]=parseInt(c)}u.infinity&&(u.goldRes=Infinity,u.foodRes=Infinity,u.woodRes=Infinity,u.stoneRes=Infinity);u.mapy=u.mapx;u.gravity=parseFloat(document.getElementById("mapgravity").value)*(580.9/9.8);u.name="";u.arje=555555*Math.random()+1;K(u.arje,"arje")},Cj=function(){u.online&&(Ik(z.initializing),u.editor=0);u.mapx||Ff();u.pausedTime=0;u.canceled=0;for(var f=Object.keys(a),
b=J.length,e=0,c=f.length;e<c;e++){var d=a[f[e]];d.id=e;if(d.disabled)for(var h=0;h<b;J[h++].technology.disabled[e]=d.disabled);if(d.hidden)for(h=0;h<b;J[h++].technology.hidden[e]=1);}var l=performance.now();Zb=document.getElementById("msgs1");u.online||(location.hash="");w("playermenu").style.display="none";w("index").style.display="none";w("menu").style.display="block";w("statButton").style.display="block";w("mapeditorinfo").style.display="none";w("mapeditorinfotop").style.display="none";w("resources").style.display=
"block";xj(J);Va=J[A.kingdom];ve(A.kingdom);setTimeout(function(){u.cycle?u.deltaTime=25*u.cycle:(u.players=J.length-1,u.date=Date.now(),u.cycle=0,u.kingdoms=J,u.deltaTime=0);u.loadDate=Date.now();u.online||Ei();u.now=Fh;u.paused=0;u.pausedTime=0;u.zMax=96*u.mapy;nb();performance.now();u.allow14=!0;y=u.mapx;qa=u.mapy;u.temperature=25;var b=u.temperature;0==A.temperature&&(b+="&deg;C");document.getElementById("temperature").innerHTML=b;da=1;Jk();Md();Pe={};var c=y;b=-c;c=+c;bb=[1,1+b,b,-1+b,-1,-1+
c,c,c+1];Gh=[b,-1,1,c];u.online&&(document.getElementById("content").style.display="block");b=["chat","loading","playermenu","index"];c=b.length;for(var d=0;d<c;document.getElementById(b[d++]).style.display="none");w("loadingtext").innerHTML="Loading terrain";b=performance.now();if(u.terrain)cd=new Int8Array(u.terrain);else{c=performance.now();var f=y,e=f*qa,h=Math.sqrt(e),x,E,C=0,F,I;d=new Int8Array(new ArrayBuffer(e));var G=new Uint32Array([2,3,0,1,1,1,0,1,0,1,0,1,1,1,1,0,0,15,0,1]);for(jk(u.arje);C<
e;d[C++]=0);var N=G.length;for(C=0;C<N;C+=4)G[C+3]&&(G[C+1]=~~(h/G[C+1]));for(F=0;F<N;F+=4){var M=G[F+1];var H=G[F];var P=G[F+2];for(C=0;C<M;C++){var W=~~(ka()*e+.5);var S=6*ka()-3;var V=6*ka()-3;if(P){var R=ka()*h;var Z=~~(ka()*(h/15))+4;var X=~~(100*ka())/4;var aa=Z/12}else R=128*ka(),Z=~~(2.56*ka())+4,X=~~(100*ka())/2,aa=1;var ba=W%f;W=~~(W/f);for(I=0;I<R;I++)for(100*ka()>X&&(S=(6*ka()-3)*aa,V=(6*ka()-3)*aa),ba+=S,W+=V,x=0;x<Z;x++)for(E=0;E<Z;E++)if((x-Z/2)*(x-Z/2)+(E-Z/2)*(E-Z/2)<Z*Z/4){var ha=
~~ba+x+(E+~~W)*f;ha>=e?ha%=e:0>ha&&(ha+=e);d[ha]=H}}}f=performance.now();K("randomtxt1",f-c);K("drawTerrain: ",performance.now()-f);cd=d}Db.randomtxt=performance.now()-b;K("randomtxt: ",Db.randomtxt);b=performance.now();w("loadingtext").innerHTML="Creating map";c=y*qa*4;Y=new Uint32Array(c);pa=new Uint32Array(c);Gc=new Uint32Array(c);T.dimension=Y;Od.dimension=pa;Vi.dimension=Y;Wi.dimension=pa;Q.dimension=Y;lf.dimension=Gc;Cb.dimension=pa;kf.dimension=Y;Ua[0]=pa;Ua[1]=Y;Ua[2]=Gc;Db.createMap=performance.now()-
b;K("createMap: ",Db.createMap);w("content").style.display="block";b=performance.now();K(u.allunits);if(u.allunits)D=u.allunits;else{c=cd;d=u.mapx;P=u.mapy;f=performance.now();S=d*P;F=Math.sqrt(S);D=[];dd={};V=Kk;M=Lk;e=dd;h=Mk;X=[12,63,62];ba=[];C=J.length-1;for(R=1;R<C;R++){G=!0;H=J[R];W=X[H.race];for(x=0;G&&25>x;){x++;aa=~~(ka()*(d-15)+.5)+4;Z=~~(ka()*(P-15)+.5)+4;G=!1;N=ba.length;for(H=0;H<N;H+=2)60>Math.sqrt((aa-ba[H])*(aa-ba[H])+(Z-ba[H+1])*(Z-ba[H+1]))&&(G=!0);G||(ba.push(aa+4,Z+3),V(aa+Z*
d,{type:W,kingdom:R}))}if(25==x){J.length=R;break}}X=2*(C-1);C=1*~~(F/3.2);for(R=0;R<C;R++)for(G=~~(ka()*d+.5),N=~~(ka()*P+.5),W=~~(25*ka())+10,x=~~(25*ka())+10,H=0;55>H;H++)aa=~~(ka()*W+~~(G+18*ka()-9)+.5),Z=~~(ka()*x+~~(N+18*ka()-9)+.5),aa+=Z*d,M(aa)&&aa<=S&&V(aa,{type:7,d:~~(28*ka()+3)});C=40*~~(F/256);for(R=0;R<C;R++){aa=~~(ka()*S+.5);P=Jg[~~(ka()*Jg.length)];H=Object.assign({},P);H.d+=~~(P.dMax*ka());if(P.sword||P.potion)H.attack=~~(6*ka())+1;if(P.shield||P.potion)H.defence=~~(6*ka())+1;P.book&&
(P=~~(ka()*nf.length),H.spell=nf[P],H.iconID=a[nf[P]].iconIDbook,H.name=z[H.spell],H.attack=~~(6*ka())+1);V(aa,H)}C=3*~~(F/256);for(R=0;R<C;R++)aa=~~(ka()*S),M(aa)&&V(aa,{type:43});P=!!u.infinity;for(H=0;H<X*(1-P);H+=2)M=2*Math.round(ka())-1,R=ba[H]+10*(2*Math.round(ka())-1)+~~(3*ka()),F=ba[H+1]+10*M+~~(3*ka()),C=ba[H]+10*(2*Math.round(ka())-1)+~~(3*ka()),M=ba[H+1]+10*-M+~~(3*ka()),0>R?R=0:R+4>y&&(R-=(R+4)%S),0>F?F=0:F+4>qa&&(F-=(F+4)%S),0>C?C=0:C+4>y&&(C-=(C+4)%S),0>M?M=0:M+4>qa&&(M-=(M+4)%S),V(R+
F*d,{type:21}),V(C+M*d,{type:22});for(H=0;H<X;H+=2)for(R=ba[H]-25,F=ba[H+1]-25,C=0;50>C;C++)for(M=0;50>M;M++)625>(C-25)*(C-25)+(M-25)*(M-25)&&(S=C+R+(M+F)*d,7===h(S).type&&(e[S].cancell=1),1===gd.type[c[S]]&&(c[S]=0));K("random:",performance.now()-f);Db.random=performance.now()-f}u.movtable&&!u.demo&&(sc=u.movtable,uc=u.movtable2);c=performance.now();w("loadingtext").innerHTML="Loading textures";zj(cd);Db.setupGL=performance.now()-c;K("setupGL: ",Db.setupGL);c=performance.now();f=cd;e=gd.type;h=y*
qa;for(d=0;d<h;d++)e[f[d]]?(pa[d]=1,Y[d]=1,Mb[d]=1):0>f[d]&&(Mb[d]=2,pa[d]=2,Y[d]=2);f=D;u.custom||(u.ini=f);u.demo&&(f=u.ini);d=0;for(e=f.length;d<e;d++)X=f[d],X.death?B.put(X):X.cancell||(h=X.x32,ba=X.y32,S=!1===X.built&&1===X.health?!0:!1,V=X.kingdom||0,X=new ec(X.type,V,h,ba,0,S,X),S||Zh(X),X.castle&&(J[V].origin=[h+4,ba+3]));dd=D=null;K("positioned:",performance.now()-c);Db.positioned=performance.now()-c;Db.setupGL=performance.now()-b;K("setupGL: ",Db.setupGL);Sa(Ea);Sa(fa);ud(A.kingdom);yi();
b=J[A.kingdom].origin;kd(~~(32*b[0]-.5*(window.innerWidth-A.mx)),~~(32*b[1]-.5*window.innerHeight));window.addEventListener("keydown",Ji);window.addEventListener("keyup",Ki);window.addEventListener("mousemove",Li);L=jb;ia=new Float32Array(12);b=ta[k.blank].id;v[0]=b;v[1]=0;v[2]=1;v[3]=0;v[4]=b;v[5]=0;v[6]=1;v[7]=0;v[8]=b;v[9]=0;v[10]=1;v[11]=0;v[12]=b;v[13]=0;v[14]=1;v[15]=0;b=ca;b[0]=0;b[1]=1;b[2]=2;b[3]=1;b[4]=2;b[5]=3;g.bindBuffer(g.ARRAY_BUFFER,Nc);g.bufferSubData(g.ARRAY_BUFFER,0,v);g.bindBuffer(g.ARRAY_BUFFER,
Ya);d=3*A.kingdom;b=za[d];c=za[d+1];d=za[d+2];g.bufferSubData(g.ARRAY_BUFFER,0,new Float32Array([b,c,d,.5,b,c,d,.5,b,c,d,.5,b,c,d,.5]));b=96*y;ia[2]=b;ia[5]=b;ia[8]=b;ia[11]=b;window.addEventListener("mousedown",Mi);window.addEventListener("mouseup",Ni);K("FULL: ",performance.now()-l);u.record||(u.record={});u.online?(lc(Pd(),z.waitingPlayers,1),K(A.admin,"e21e21e"),A.admin?(K(88888888),Ic()):ea(Ic,0,0)):of();u.allow14=!1;Hc.list.push(0,JSON.stringify(Db))},300)},Pd=function(){for(var a=C.length,
b=C,e="",c=0;c<a;c++)Pd.obj[b[c].id]||b[c].id==A.onlineID||(e+="<br>"+b[c].name);return e};Pd.obj={};var Ef=!1,yi=function(){var a=document.getElementById("playersinfo");a.innerHTML="";for(var b=1,e=J.length-1;b<e;b++){var c=J[b];K(c);var d=c.death?c.name.strike():c.name;a.innerHTML+=d+"<span id='score"+b+"'> 0/0</span><div class='playercolor' style='background:rgb("+c.color[0]+","+c.color[1]+","+c.color[2]+")'></div><br>"}},Ld,Si,Gi,Jk=function(){var a=document.getElementById("selectedobject").getContext("webgl",
{antialias:!1,depth:!1}),b=a.createShader(a.VERTEX_SHADER);a.shaderSource(b,"void main() {\ngl_Position = vec4(0 ,0, 0, 1);\ngl_PointSize=48.0;\n}");a.compileShader(b);var e=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(e,"precision mediump float;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nuniform float txtCoord;\nvoid main() {\ngl_FragColor = texture2D(u_image, (vec2(\tmod(txtCoord,21.0) ,floor(txtCoord/21.0) ) + gl_PointCoord)*(0.046875));\nif(gl_FragColor.r==gl_FragColor.g&&gl_FragColor.r==gl_FragColor.b) gl_FragColor*=u_color;\n}");
a.compileShader(e);var c=a.createProgram();a.attachShader(c,b);a.attachShader(c,e);a.linkProgram(c);a.useProgram(c);b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texImage2D(a.TEXTURE_2D,0,a.RGB,a.RGB,a.UNSIGNED_BYTE,H.icons);var d=a.getUniformLocation(c,"u_color"),
h=a.getUniformLocation(c,"txtCoord");Ld=function(b){if(ta[b.img][3]){var c=b.kingdom;a.uniform4f(d,za[3*c],za[3*c+1],za[3*c+2],1)}else a.uniform4f(d,1,1,1,1);a.uniform1f(h,b.iconID);a.drawArrays(a.POINTS,0,1)};Si=function(){a.uniform4f(d,1,1,1,1);a.uniform1f(h,189);a.drawArrays(a.POINTS,0,1)};Gi=function(){a.uniform1f(h,0);a.uniform4f(d,0,0,0,0);a.drawArrays(a.POINTS,0,1)}},Tb=128,$a=128,B=[{terrain:1},{terrain:1},{terrain:1}],Mb={},ud=function(a){a===A.kingdom&&(a=Va.values.popMax<Va.values.popLimit?
Va.values.popMax:Va.values.popLimit,document.getElementById("pop").innerHTML=Va.values.pop+"/"+a)};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();var dd=D=void 0;var Kk=function(a,b){dd[a]||(b.x32=a%y,b.y32=~~(a/qa),D.put(b),dd[a]=b)},Lk=function(a){return!D[a]},Mk=function(a){return dd[a]||NaN},wa=[],Og=function(){K("123");Fa.leaveRoom();wa.length=0},ed={};
(function(){for(var a=["returnmenu","index","Account","accountIframe"],b=0,e=a.length;b<e;ed[a[b]]=document.getElementById(a[b++]));})();var Nk=function(){location.replace("#"+this.gameID+"Room")},kh=function(a){wa=[];K("connecting to",a,z.loading);w("game").style.display="block";w("gameName").innerHTML=z.loading;w("returnmenu").style.display="none";w("index").style.display="none";jc.innerHTML="";Zb.innerHTML="";A.p2p?Fa.joinRoom(a,hj):(Fa||Hb(),Hb.func=function(){kh(a)})},Ok=function(a){w("game").style.display=
"none";C.length=0;u.online=0;Og();Bc();a.constructor==String&&lc(a)},xi={euro:0,arab:0,asia:0},hh=function(a,b,e){if(e){K(a,e);b=Pg(e.id);var c=b[1];b=b[0];ij[c].innerHTML=a;b.username||(b.name=a,e.username=a)}},db=function(a,b){if(b.resend)if(a.destinatary)(b=Jc(a.destinatary))&&b.id!=A.onlineID&&(a.bridge=f.id,b.send(a));else{b=b.resend;for(var e=0,c=b.length;e<c;e++){var d=b[e];a.bridge=f.id;d.send(a)}}else{var f=b;a.bridge&&(f=Jc(a.bridge));if(void 0===a.length){if(void 0!==a.func)(0,je[a.func])(a[1],
a[2],f)}else b=a[0],f.orderList[b]=a,db.done[b]||(db.done[b]=0),db.done[b]++,db.done[b]==wa.length&&db.func&&(db.func=!1,ag(),nb())}};db.done=[];var Kc=function(a,b,e){e&&(K(e.id,"CAN connect"),Kc.ids[a]||(Kc.ids[a]=1,A.admin||clearTimeout(Kc.intv[a]),K("MAKE BRIDGE"),Jc(a).bridge=e,ea(jj,a,0,[e],0)))};Kc.ids={};Kc.intv={};var jj=function(a,b,e){e&&(K("BRIDGE"),e.resend||(e.resend=[]),e.resend.put(Jc(a)))},Jc=function(a){for(var b=0,e=wa.length;b<e;b++){var c=wa[b];if(c.id==a)return c}},Fa,Pk=function(){A.name=
w("usernameVal").value;localStorage.username=A.name;document.body.removeChild(w("usernameForm"));Hb();Hb.func||Rc()},Hb=function(){if("Guest"!==A.name&&A.name)Fa=new SimpleWebRTC({localVideoEl:"",remoteVideosEl:"",autoRequestMedia:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},url:"https://solar.tza.red/"}),Fa.on("channelMessage",function(a,b,d){"nehhof"==d.type&&(b=JSON.parse(d.payload),db(b,a))}),Fa.on("connectionReady",function(a){var b=Fa.connection.connection;A.p2p=b;b.username=
A.name;b.on("getRooms",function(a){var b=Object.keys(a),c=w("gameList");if(0<b.length){c.innerHTML="";for(var d=0,e=b.length;d<e;d++){var f=b[d],g=a[f];if(!g.playing){var k=g.len;if(k){var r=document.createElement("tr");r.innerHTML="<td>"+g.description+"</td><td>"+k+"/"+g.max+"</td>";r.gameID=f;r.onclick=Nk;c.appendChild(r)}}}}else c.innerHTML='<tr style="background:rgba(24, 24, 24, 0.7);"><td>No games found</td></tr>'});A.onlineID=a;Hb.func&&Hb.func()}),Fa.on("createdPeer",function(a){u.started||
(wa.put(a),xa("attack"),Dj(a),Qg())});else if(!w("usernameForm")){w("basic").style.filter="blur(94px)";var a=localStorage.username||"",b=document.createElement("div");b.id="usernameForm";b.innerHTML="\n            <div>\n            <h2>"+z.username+'</h2>\n            <input id=\'usernameVal\' type="text" value="'+a+'" /><br />\n            </div>\n            ';a=document.createElement("button");a.innerHTML=z.continue;a.onclick=Pk;b.children[0].appendChild(a);document.body.appendChild(b)}},Qk=function(){Rc();
w("game").style.display="block";w("gameName").innerHTML=z.loading;w("returnmenu").style.display="none";w("index").style.display="none";jc.innerHTML="";Zb.innerHTML="";wa=[];ih();A.admin=1;A.room={description:w("gameFormName").value,max:parseInt(w("gameMax").value),public:!0};Fa.createRoom(A.onlineID+"b",hj);u.online=1;document.body.removeChild(w("gameForm"))},kj=function(){Fa||Hb();if(A.onlineID){w("basic").style.filter="blur(94px)";var a=document.createElement("div");a.id="gameForm";a.innerHTML=
"\n<div>\n            <h2>"+z.gameOptions+"</h2>\n            "+z.gameName+': <input id=\'gameFormName\' type="text" value="'+A.name+'\'s room" maxlength="29" /><br />\n'+z.nplayers+': <input id="gameMax" type="number" value="6" max="14" min="2"/><br />\n            </div>';var b=document.createElement("button");b.innerHTML=z.continue;b.onclick=Qk;a.children[0].appendChild(b);document.body.appendChild(a)}else setTimeout(function(){location.hash=""},200),Hb.func=kj},Rg=function(a,b){b=JSON.stringify(b);
a.sendDirectly("channelMessage","nehhof",b)},Qd=[],ea=function(a,b,e,c,d){if(!0===d&&u.online&&wa.length)e.change&&(e=e.slice(0)),Ma(function(){ea(a,b,e,c,55)});else if(void 0===a.location)a();else{if(u.started&&!u.editor){var f=u.record;f[u.cycle]||(f[u.cycle]=[]);var g=f[u.cycle];f=g.length;g[f]=a.location;g[f+1]=b;e.length&&(e=e.slice(0));g[f+2]=e}if(u.online&&wa.length){if(55===d)var k=!1;var p={func:a.location,1:b,2:e,active:k,rnd:4294967296*Math.random()};if(a==nb||a==of){k=Ma.max;p.active=
!1;f=0;for(d=wa.length;f<d;f++)g=wa[f],g.bridge||setTimeout(function(a){Rg(a,p)},k-g.ping,g);setTimeout(function(){a(b,e)},k)}else if(u.started)if(c)for(f=0,d=c.length;f<d;f++)g=c[f],p.destinatary=g.id,g.bridge?Rg(g.bridge,p):Rg(g,p);else Qd.put(p);else Sg(p),a(b,e)}else a(b,e)}},Rk=function(){if(wa.length){Ff();Ic.i=0;A.p2p.emit("gameStarted");for(var a={},b=0,e=C.length;b<e;b++)a[C[b].id]=b;ea(Tg,u,a,0,0)}},Ic=function(a,b,e){e&&(Pd.obj[e.id]=1,a=Pd(),""==a?lc(a,z.loading,1):lc(a,z.waitingPlayers,
1));A.admin&&(Ic.i++,Ic.i==C.length&&setTimeout(function(){ea(of,0,0,0,!0)},2500))};Ic.i=0;var Sg=function(a){a=JSON.stringify(a);for(var b=0,e=wa.length;b<e;b++)wa[b].sendDirectly("channelMessage","nehhof",a)},Lc,Ug,ag=function(){if(!db.done[Lc]||db.done[Lc]<wa.length)return db.func=!0,nb(),!0;for(var a=0,b=C.length;a<b;a++){var e=Jc(C[a].id);if(a==A.kingdom-1)var c=Ug;else{if(!e)continue;c=e.orderList[Lc]}for(var d=1,h=c.length;d<h;d++){var g=c[d];je[g.func](g[1],g[2],e)}}db.func=!1;Sg(Qd);Ug=Qd;
Lc++;Qd=[Lc+1];return!1},of=function(){document.getElementById("alert").style.display="none";u.started=1;u.date=Date.now();nb();Ga();Lc=0;if(!u.custom||u.demo)for(var a=1,b=J.length-1;a<b;a++){var e=ab[yg[J[a].race]],c=e.peasant.type;if(e=B[eb[a][e.castle.type][0]])wc(c,e,1),wc(c,e,1),wc(c,e,1)}tb.arr=[];tb.units=[];tb.time=500;tb.steps=0;tb.process=0;if(!u.editor&&!u.demo){for(a=1;a<J.length-1;a++)J[a].IA&&Infinity==u.goldRes&&new tb(J[a]);a=0;b=tb.arr;for(c=b.length;a<c;b[a++].leaveMeAloneIKnowWhatToDo());
Wf()}u.online&&(Sg([0]),Qd=[1],Ug=[0]);Za()},Tg=function(a,b,e){if(e&&e.admin){e=[C[0]];for(var c=0,d=C.length;c<d;c++)e[b[C[c].id]]=C[c];C=e}xa("bless");u=a;u.infinity&&(u.goldRes=Infinity,u.woodRes=Infinity,u.foodRes=Infinity,u.stoneRes=Infinity);Qc()},Rc=function(){w("basic").style.filter="blur(0px)";setTimeout(function(){return w("basic").style.filter=""},500)};var Fi=function(){w("game").style.display="none";Og();Bc();A.admin=0};var hj=function(){var a=Fa.roomName;a+="Room";K("login");Rc();if(0!==
Fa.getPeers().length||A.admin){var b=A.room||NaN;K(a);u.id=a;u.online=1;ih();w("chat").style.display="block";w("gameName").innerHTML=b.description||"Online Game";w("onlineID").value=location.origin+"/#"+u.id;w("returnmenu").style.display="none";Qg();A.admin?(location.replace("#"+u.id),w("buttons").innerHTML='<button id="startbutton">'+z.play+'</button><button id="optionbutton">'+z.options+'</button><button id="closebutton">'+z.close+"</button>",w("startbutton").onclick=Rk,w("optionbutton").onclick=
lj,w("closebutton").onclick=Fi):(w("buttons").innerHTML='<button id="quitbutton">'+z.disconnect+"</button>",w("quitbutton").onclick=Ok);Fa.connection.on("remove",function(a){if(a=Jc(a.id))if(zb($c(z.playerDisconnected,a.username),0,5),u.online){if(u.started)for(var b=0;b<C.length;b++)if(C[b].id==a.id){J[b+1].die();break}wa.quit(a);u.started?db.done[Lc]==wa.length&&db.func&&(db.func=!1,ag(),nb()):(Qg(),a.admin&&(Bc(),Fa.leaveRoom(),lc(z.gameClosed)))}})}else location.hash="",Bc()},Ma=function(a){Ma.func.put(a);
0===Ma.active&&(ea(mj,0,0,0,0),Ma.date=Date.now(),Ma.received=0,Ma.max=-Infinity,Ma.active=1)};Ma.func=[];Ma.active=0;var mj=function(a,b,e){e&&ea(nj,0,0,[e],0)},Vg={},nj=function(a,b,e){if(e&&(e.ping=~~(.5*(Date.now()-Ma.date)+.5),Vg[e.id]?Vg[e.id].put(e.ping):Vg[e.id]=[e.ping],e.ping>Ma.max&&(Ma.max=e.ping),Ma.received++,Ma.received==wa.length)){a=performance.now();b=0;for(e=Ma.func.length;b<e;Ma.func[b++]());K(-a+performance.now());Ma.func.length=0;Ma.active=0}},Wg=document.getElementsByClassName("ucolor"),
ij=document.getElementsByClassName("username"),Xg=document.getElementsByClassName("race"),pf=document.getElementsByClassName("team"),Ub=document.getElementsByClassName("isconnected"),Kf=function(a,b,e){e&&(b=Pg(e.id),e=b[1],b=b[0],b.race=a%3,Xg[e].innerHTML=La[b.race])},Pg=function(a){for(var b=0,e=C.length;b<e;b++){var c=C[b];if(c.id==a)return[c,b]}},If=function(a,b,e){if(e){b=a.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);e=Pg(e.id);var c=e[1];e=e[0];Wg[c].style.background=a;e.color=[parseInt(b[1],
16),parseInt(b[2],16),parseInt(b[3],16)]}},Jf=function(a,b,e){a=parseInt(a);if(isNaN(a)||!a)a=0;a%=5;if(e){b=e.id;e=0;for(var c=C.length;e<c;e++){var d=C[e];if(d.id==b){d.team=a;pf[e].innerHTML=a;break}}}},Qg=function(){K("setup MENU");var a=document.getElementById("multiplayertable");a.innerHTML="";for(var b=A.room?A.room.max:14,e=0;e<b;e++)a.innerHTML+='<tr><td class="ucolor"></td><td class="username">'+z.open+'</td><td class="race"></td><td class="team"></td><td class="isconnected"></td></tr>';
a=Fa.roomName;a=a.substr(0,a.length-1);var c=[A.p2p];e=0;for(b=wa.length;e<b;e++){var d=wa[e];d.admin?c.unshift(d):c.put(d)}for(b=0;b<c.length;b++){d=c[b];e=C[b]&&C[b].id==d.id?C[b]:{color:[128,128,128],ia:0,name:d.username,race:0,team:0,id:d.id,cID:b};d&&d.id?(Ub[b].style.background="#00ff00",Ub[b].style.boxShadow="0px 0px 30px 0px #00ff00"):(Ub[b].style.background="#ff0000",Ub[b].style.boxShadow="0px 0px 30px 0px #ff0000");Wg[b].style.background="rgb("+e.color[0]+","+e.color[1]+","+e.color[2]+")";
ij[b].innerHTML=e.name;e.id==a&&(d.admin=!0);if(A.onlineID==e.id){pf[b].innerHTML="";d=document.createElement("button");d.onmousedown=oj;d.iteam=b;d.innerHTML=e.team;pf[b].appendChild(d);d=document.createElement("button");d.onmousedown=pj;d.iteam=b;d.innerHTML=La[e.race];Xg[b].appendChild(d);d=document.createElement("input");d.type="color";var h=e.color;d.iteam=b;d.value="#"+(16777216+(h[0]<<16)+(h[1]<<8)+h[2]).toString(16).slice(1);Wg[b].appendChild(d);d.onchange=qj;Ub[b].style.background="#00ff00";
Ub[b].style.boxShadow="0px 0px 30px 0px #00ff00"}else pf[b].innerHTML=e.team,Xg[b].innerHTML=La[e.race];C[b]=e}C.length=c.length},C=[];window.onhashchange=jh;var Zb=document.getElementById("msgs"),jc=document.getElementById("msgs1"),qf=document.getElementById("msginput"),Ag=document.getElementById("msginputGame"),zg=document.getElementById("enterwindow");qf.addEventListener("keyup",function(a){13==a.keyCode&&Bg()});var zb=function(a,b,e){xa("chat");e&&(u.started?(b=jc,rf()):b=Zb,K(e),b.innerHTML=
5!==e?b.innerHTML+("<li><span>"+e.username+" \u2014</span> "+Rb(a)+"</li>"):b.innerHTML+("<li>"+a+"</li>"),b.scrollTop=b.scrollHeight)},rf=function(){11==Zb.children.length&&jc.removeChild(jc.children[0]);1==Zb.children.length&&(rf.intv=setInterval(function(){jc.removeChild(jc.children[0]);0==Zb.children.length&&clearInterval(rf.intv)},3E4))},Rb=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Bg=function(){if(u.started){var a=jc,
b=Ag.value;Ag.value="";rf()}else a=Zb,b=qf.value,qf.value="";""!=b&&(b=Rb(b),a.innerHTML+="<li><span>"+A.name+" \u2014</span> "+b+"</li>",ea(zb,b,0,0,0),a.scrollTop=a.scrollHeight)},je=[Tg,xb,Bd,qc,re,Wc,Tc,mh,nh,zb,ee,yd,Uc,Gg,Vc,Jd,ig,oe,cg,Ic,nb,mj,nj,Jf,Ii,function(a,b,e){e&&(a=Jc(a))&&a.open&&(K("I CAN connect"),ea(Kc,a.id,0,[e],0))},Kc,jj,of,Vf,rg,Ie,sg,oi,pg,ue,xe,Re,Ke,ug,Be,Yh,Gd,If,function(a,b){b=B[b];var e=a[0];a=a[1];var c=y;!1!==e&&(b.kx=e);!1!==a&&(b.ky=a);e=-(b.x32+e+(a+b.y32)*c);
b.stop=b.kx||b.ky?!1:!0;Number.isInteger(b.xf)||xb(e,[b.id])},og,fi,gi,Kf,ze,qg,Te,Me,ki,Ve,Fe,De,Oe,wg,Ai,li,Bh,hh];localStorage.favMusic&&(musicSelect.mversion.value=localStorage.favMusic);Tg.antiHack=0;xb.antiHack=0;Bd.antiHack=0;qc.antiHack=0;re.antiHack=0;Wc.antiHack=0;Tc.antiHack=0;R.antiHack=0;qe.antiHack=0;Oa.antiHack=0;kb.antiHack=0;R.antiHack=0;mh.antiHack=0;nh.antiHack=0;zb.antiHack=0;ee.antiHack=0;yd.antiHack=0;Uc.antiHack=0;vd.antiHack=0;Gg.antiHack=0;Vc.antiHack=0;Jd.antiHack=0;ig.antiHack=
0;oe.antiHack=0;(function(){for(var a=je,b=0,e=a.length;b<e;b++)a[b].location=b})();var lj=function(){w("mapconfiguration").style.display="block";w("basic").style.filter="blur(94px)"},rj=document.getElementsByClassName("ucolor1"),Sk=document.getElementsByClassName("username1"),Tk=document.getElementsByClassName("race1"),Uk=document.getElementsByClassName("team1"),oj=function(a){var b=1;2==a.button&&(b=-1);a=this.iteam;C[a].team+=b;0>C[a].team&&(C[a].team=0);this.innerHTML=C[a].team;u.online&&(b=parseInt(this.innerHTML),
this.innerHTML=b%=5,ea(Jf,b,0,0,2),C[a].team=b)},pj=function(a){a=C[this.iteam];a.race=(a.race+1)%3;this.innerHTML=La[a.race];ea(Kf,a.race,0,0,2)},qj=function(){this.parentElement.style.background=this.value;var a=this.value.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);C[this.iteam].color=[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)];wa.length&&ea(If,this.value,0,0,2)},Vk=function(){$b.nu++;$b()},Wk=function(){$b.nu--;0>=$b.nu?$b.nu=1:C.length--;$b()},yg={0:"euro",1:"arab",2:"asia"},
sj=[["a","e","i","o","u"],"bcdfghjklmnpqrstvwxyz".split("")],$b=function(){document.getElementById("returnmenu").style.display="block";document.getElementById("oneplayertbody").innerHTML="";document.getElementById("oneplayertbody").innerHTML+='<tr><td></td><td id="addremove"><button id="addPlayer">+</button><button id="removePlayer">-</button></td><td></td><td></td></tr>';for(var a=$b.nu,b=0;b<a;b++)if(document.getElementById("oneplayertbody").innerHTML+='<tr><td class="ucolor1"></td><td class="username1"></td><td class="race1"><button></button></td><td class="team1"><button></button></td></tr>',
!C[b]){var e=~~(16777216*Math.random());C[b]={color:[e>>16&255,e>>8&255,e&255],IA:1,race:~~(3*Math.random()),team:b}}document.getElementById("addPlayer").onclick=Vk;document.getElementById("removePlayer").onclick=Wk;C[0].color=[0,0,189];C[0].name=A.name;for(b=e=C[0].IA=0;b<a;b++){var c=C[b],d=Oh[yg[c.race]];if(c.IA)if(e<d.length)c.name=d[e++];else{d=c;var h=~~(9*Math.random())+2,g=sj[1],k=g[~~(Math.random()*g.length)].toUpperCase();.85<Math.random()&&(k+=g[~~(Math.random()*g.length)]);for(g=0;g<h;g++){var p=
sj[g%2];k+=p[~~(Math.random()*p.length)];.8<Math.random()&&(k+=p[~~(Math.random()*p.length)])}d.name=k}rj[b].style.background="rgb("+c.color[0]+","+c.color[1]+","+c.color[2]+")";Sk[b].innerHTML=c.name;d=Uk[b].getElementsByTagName("button")[0];d.iteam=b;d.onmousedown=oj;d.innerHTML=b;d=Tk[b].getElementsByTagName("button")[0];d.iteam=b;d.onmousedown=pj;d.innerHTML=La[c.race];c=C[b].color;d=document.createElement("input");d.type="color";d.iteam=b;d.value="#"+(16777216+(c[0]<<16)+(c[1]<<8)+c[2]).toString(16).slice(1);
rj[b].appendChild(d);d.onchange=qj}};$b.nu=4;var Ik=function(a,b,e){var c=new Notification(a,{icon:"https://pbs.twimg.com/profile_images/861248696176062464/ANKhddMo_400x400.jpg",body:b,requireInteraction:!0});e||(e=5E3);setTimeout(function(){c.close()},e)},gd,a,Yi,nf,Gk=function(){var f={};a={move:function(){L=xb;xb.cursor=7}};a.move.iconID=262;a.move.obj={name:z.move};a.attack=function(){L=qc};a.attack.iconID=250;a.attack.obj={name:z.attack};a.guard=function(){gc(4)};a.guard.iconID=237;a.guard.obj=
{name:z.guard};a.patrol=function(){gc(8)};a.patrol.iconID=238;a.patrol.obj={name:z.patrol};a.pickUp=function(){L=Uc};a.pickUp.iconID=240;a.pickUp.obj={name:z.pickItems};a.explore=function(){gc(7)};a.explore.iconID=40;a.explore.obj={name:z.explore};a.stop=function(){ea(ig,0,F)};a.stop.iconID=160;a.stop.obj={name:z.stop};a.stand=function(){ea(Yh,0,F)};a.stand.iconID=27;a.stand.obj={name:z.stand};a.attackGround=function(){};a.attackGround.iconID=100;a.steady=function(){};a.steady.iconID=21;a.createOrk=
function(){S(58)};a.createOrk.iconID=120;a.createDwarf=function(){S(59)};a.createDwarf.iconID=117;a.createSkeleton=function(){S(60)};a.createSkeleton.iconID=87;a.createGhost=function(){S(40)};a.createGhost.iconID=222;a.createFootman=function(){S(0)};a.createFootman.iconID=182;a.createArcher=function(){S(4)};a.createArcher.iconID=185;a.createMaceman=function(){S(3)};a.createMaceman.iconID=186;a.createPikeman=function(){S(1)};a.createPikeman.iconID=183;a.createLongbowman=function(){S(6)};a.createLongbowman.iconID=
184;a.createKnight=function(){S(19)};a.createKnight.iconID=180;a.iniMercenaries=function(a){a.mlist=[];a.mlistID=[];a.mercID=0;dg(a);a.setupINTV(Fg,a.id,2E3)};a.iniMercenaries.builds=[30];a.iniHeroes=function(a){a.hlist=[];a.hlistID=[];a.heroID=0;dg(a);a.setupINTV(Fg,a.id,2E3)};a.iniHeroes.builds=[30];a.mercFootmanArab=function(){ua()};a.mercFootmanArab.iconID=49;a.mercFootmanArab.unit=80;a.mercFootmanArab.obj={};a.mercArcherArab=function(){ua()};a.mercArcherArab.iconID=52;a.mercArcherArab.unit=85;
a.mercArcherArab.obj={};a.mercMacemanArab=function(){ua()};a.mercMacemanArab.iconID=116;a.mercMacemanArab.obj={};a.mercMacemanArab.unit=83;a.mercPikemanArab=function(){ua()};a.mercPikemanArab.iconID=52;a.mercPikemanArab.unit=82;a.mercPikemanArab.obj={};a.mercCavalry=function(){ua()};a.mercCavalry.iconID=133;a.mercCavalry.unit=84;a.mercCavalry.obj={};a.mercEnichar=function(){ua()};a.mercEnichar.iconID=123;a.mercEnichar.unit=91;a.mercEnichar.obj={};a.mercJihad=function(){ua()};a.mercJihad.iconID=236;
a.mercJihad.unit=86;a.mercJihad.obj={};a.mercFootmanArab6=function(){Na()};a.mercFootmanArab6.iconID=49;a.mercFootmanArab6.unit=80;a.mercFootmanArab6.obj={};a.mercArcherArab6=function(){Na()};a.mercArcherArab6.iconID=52;a.mercArcherArab6.unit=85;a.mercArcherArab6.obj={};a.mercMacemanArab6=function(){Na()};a.mercMacemanArab6.iconID=116;a.mercMacemanArab6.unit=83;a.mercMacemanArab6.obj={};a.mercPikemanArab6=function(){Na()};a.mercPikemanArab6.iconID=52;a.mercPikemanArab6.unit=82;a.mercPikemanArab6.obj=
{};a.mercCavalry6=function(){Na()};a.mercCavalry6.iconID=133;a.mercCavalry6.unit=84;a.mercCavalry6.obj={};a.mercEnichar6=function(){Na()};a.mercEnichar6.iconID=123;a.mercEnichar6.unit=91;a.mercEnichar6.obj={};a.mercJihad6=function(){Na()};a.mercJihad6.iconID=236;a.mercJihad6.unit=86;a.mercJihad6.obj={};a.mercFootman=function(){ua()};a.mercFootman.iconID=182;a.mercFootman.unit=0;a.mercArcher=function(){ua()};a.mercArcher.iconID=185;a.mercArcher.unit=4;a.mercMaceman=function(){ua()};a.mercMaceman.iconID=
186;a.mercMaceman.unit=3;a.mercPikeman=function(){ua()};a.mercPikeman.iconID=183;a.mercPikeman.unit=1;a.mercLongbowman=function(){ua()};a.mercLongbowman.iconID=184;a.mercLongbowman.unit=6;a.mercKnight=function(){ua()};a.mercKnight.iconID=180;a.mercKnight.unit=19;a.mercFootman6=function(){Na()};a.mercFootman6.iconID=182;a.mercFootman6.unit=0;a.mercFootman6.obj={};a.mercArcher6=function(){Na()};a.mercArcher6.iconID=185;a.mercArcher6.unit=4;a.mercArcher6.obj={};a.mercMaceman6=function(){Na()};a.mercMaceman6.iconID=
186;a.mercMaceman6.unit=3;a.mercMaceman6.obj={};a.mercPikeman6=function(){Na()};a.mercPikeman6.iconID=183;a.mercPikeman6.unit=1;a.mercPikeman6.obj={};a.mercLongbowman6=function(){Na()};a.mercLongbowman6.iconID=184;a.mercLongbowman6.unit=6;a.mercLongbowman6.obj={};a.mercKnight6=function(){Na()};a.mercKnight6.iconID=180;a.mercKnight6.unit=19;a.mercKnight6.obj={};a.mercArcherAsian6=function(){Na()};a.mercArcherAsian6.iconID=53;a.mercArcherAsian6.unit=67;a.mercArcherAsian6.obj={};a.mercSamurai6=function(){Na()};
a.mercSamurai6.iconID=122;a.mercSamurai6.unit=68;a.mercSamurai6.obj={};a.mercHourseSamurai6=function(){Na()};a.mercHourseSamurai6.iconID=121;a.mercHourseSamurai6.unit=70;a.mercHourseSamurai6.obj={};a.mercRonin6=function(){Na()};a.mercRonin6.iconID=54;a.mercRonin6.unit=66;a.mercRonin6.obj={};a.mercHorseArcher6=function(){Na()};a.mercHorseArcher6.iconID=52;a.mercHorseArcher6.unit=69;a.mercHorseArcher6.obj={};a.mercChariot6=function(){Na()};a.mercChariot6.iconID=79;a.mercChariot6.unit=72;a.mercChariot6.obj=
{};a.mercArcherAsian=function(){ua()};a.mercArcherAsian.iconID=53;a.mercArcherAsian.unit=67;a.mercArcherAsian.obj={};a.mercSamurai=function(){ua()};a.mercSamurai.iconID=122;a.mercSamurai.unit=68;a.mercSamurai.obj={};a.mercHourseSamurai=function(){ua()};a.mercHourseSamurai.iconID=121;a.mercHourseSamurai.unit=70;a.mercHourseSamurai.obj={};a.mercRonin=function(){ua()};a.mercRonin.iconID=54;a.mercRonin.unit=66;a.mercRonin.obj={};a.mercHorseArcher=function(){ua()};a.mercHorseArcher.iconID=52;a.mercHorseArcher.unit=
69;a.mercHorseArcher.obj={};a.mercChariot=function(){ua()};a.mercChariot.iconID=79;a.mercChariot.unit=72;a.mercChariot.obj={};a.createPeon=function(){S(10)};a.createPeon.iconID=187;a.sameSpeed=function(){ea(gi,F)};a.sameSpeed.iconID=82;a.restoreSpeed=function(){ea(fi,F)};a.restoreSpeed.iconID=88;a.createSpy=function(){S(2)};a.createSpy.iconID=162;a.emergeAllUnits=function(){var a=F[0];ea(Vc,a,B[a].inventory.slice(0))};a.emergeAllUnits.iconID=261;a.techFeudalism=function(){I(12)};a.techFeudalism.iconID=
233;a.techArchitecture=function(){I(13)};a.techArchitecture.iconID=226;a.techLearning=function(){I(14)};a.techLearning.iconID=129;a.createPeon1=function(){S(64)};a.createPeon1.iconID=55;a.createPeon2=function(){S(79)};a.createPeon2.iconID=132;a.createNinja=function(){S(65)};a.createNinja.iconID=51;a.techArmoredChariot=function(){I(51)};a.techArmoredChariot.iconID=79;a.techBuddhism=function(){I(45)};a.techBuddhism.iconID=127;a.techGreatWall=function(){I(48)};a.techGreatWall.iconID=80;a.ridingHorses=
function(){I(49)};a.ridingHorses.iconID=64;a.irrigation=function(){I(50)};a.irrigation.iconID=72;a.createHorseArcher2=function(){S(85)};a.createHorseArcher2.iconID=52;a.techMeditation=function(){I(52)};a.techMeditation.iconID=71;a.techKungFu=function(){I(53)};a.techKungFu.iconID=228;a.techTournaments=function(){I(54)};a.techTournaments.iconID=73;a.techPhilosophy=function(){I(55)};a.techPhilosophy.iconID=68;a.techNinjas=function(){I(56)};a.techNinjas.iconID=56;a.techMastery=function(){I(57)};a.techMastery.iconID=
69;a.techGoldMining=function(){I(1)};a.techGoldMining.iconID=58;a.techStoneMining=function(){I(2)};a.techStoneMining.iconID=57;a.createCrusaders=function(){ea(Gg,F[0],0)};a.createCrusaders.iconID=221;a.techFanaticism=function(){I(31)};a.techFanaticism.iconID=235;a.techCrusade=function(){I(32)};a.techCrusade.iconID=93;a.techEspionage=function(){I(30)};a.techEspionage.iconID=215;a.techInquisition=function(){I(33)};a.techInquisition.iconID=97;a.techHealing=function(){I(34)};a.techHealing.iconID=219;
a.healing=function(){L=rg};a.healing.iconID=219;a.healing.iconIDbook=201;a.teach=function(){L=wg};a.teach.iconID=23;a.teach.iconIDbook=217;a.techBless=function(){I(36)};a.techBless.iconID=159;a.bless=function(){L=Ie};a.bless.iconID=159;a.bless.iconIDbook=204;a.techMedicine=function(){I(35)};a.techMedicine.iconID=220;a.createMage=function(){S(5)};a.createMage.iconID=156;a.techBat=function(){I(38)};a.techBat.iconID=168;a.techGolem=function(){I(41)};a.techGolem.iconID=119;a.techInvisibility=function(){I(37)};
a.techInvisibility.iconID=217;a.techLightning=function(){I(40)};a.techLightning.iconID=143;a.techFreeze=function(){I(39)};a.techFreeze.iconID=130;a.techHeroism=function(){I(22)};a.techHeroism.iconID=136;a.techWarfare=function(){I(23)};a.techWarfare.iconID=108;a.techTactics=function(){I(24)};a.techTactics.iconID=257;a.techMercenaries=function(){I(25)};a.techMercenaries.iconID=95;a.techHeroes=function(){I(26)};a.techHeroes.iconID=96;a.techFame=function(){I(27)};a.techFame.iconID=111;a.techSiegeTactics=
function(){I(28)};a.techSiegeTactics.iconID=258;a.techBodyBuilding=function(){I(29)};a.techBodyBuilding.iconID=101;a.createPriest=function(){S(9)};a.createPriest.iconID=155;a.createCow=function(){S(27)};a.createCow.iconID=163;a.techCropRotation=function(){I(8)};a.techCropRotation.iconID=227;a.techDomestication=function(){I(7)};a.techDomestication.iconID=157;a.techMapMaking=function(){I(16)};a.techMapMaking.iconID=89;a.techTradeRoutes=function(){I(17)};a.techTradeRoutes.iconID=102;a.techTradeTaxes=
function(){I(18)};a.techTradeTaxes.iconID=110;a.techUsury=function(){I(19)};a.techUsury.iconID=105;a.techSupplyStorage=function(){I(20)};a.techSupplyStorage.iconID=62;a.techBribery=function(){I(21)};a.techBribery.iconID=109;a.bribe=function(){};a.bribe.iconID=128;a.createCaravan=function(){S(61)};a.createCaravan.iconID=169;a.createCaravan2=function(){S(90)};a.createCaravan2.iconID=134;a.createFootman2=function(){S(80)};a.createFootman2.iconID=49;a.createArcher2=function(){S(81)};a.createArcher2.iconID=
43;a.createSatrap=function(){S(83)};a.createSatrap.iconID=116;a.createPikeman2=function(){S(82)};a.createPikeman2.iconID=42;a.createHorseArcher2=function(){S(85)};a.createHorseArcher2.iconID=124;a.createCavalry=function(){S(84)};a.createCavalry.iconID=133;a.createEnichar=function(){S(91)};a.createEnichar.iconID=123;a.createJihad=function(){S(86)};a.createJihad.iconID=236;a.trade=function(){};a.trade.iconID=161;a.unload=function(){L=ue};a.unload.iconID=148;a.createMercenaries=function(){ha(B[F[0]].mlist)};
a.createMercenaries.iconID=95;a.createHeroes=function(){ha(B[F[0]].hlist)};a.createHeroes.iconID=96;a.upgradeGuildTower=function(){I(42)};a.upgradeGuildTower.iconID=171;a.upgradeStoneTower=function(){I(43)};a.upgradeStoneTower.iconID=178;a.upgradeCannonTower=function(){I(44)};a.upgradeCannonTower.iconID=178;a.createCatapult=function(){S(37)};a.createCatapult.iconID=152;a.createHeavyCatapult=function(){S(39)};a.createHeavyCatapult.iconID=153;a.createBallist=function(){S(38)};a.createBallist.iconID=
154;a.techEngineering=function(){I(47)};a.techEngineering.iconID=92;a.techCannonTower=function(){I(46)};a.techCannonTower.iconID=178;a.techPlateArmor=function(){I(10)};a.techPlateArmor.iconID=131;a.techTemperIron=function(){I(4)};a.techTemperIron.iconID=266;a.techHalberd=function(){I(6)};a.techHalberd.iconID=113;a.techScaleArmor=function(){I(5)};a.techScaleArmor.iconID=251;a.techChainMail=function(){I(9)};a.techChainMail.iconID=252;a.techLongbow=function(){I(0)};a.techLongbow.iconID=259;a.techWoodCutting=
function(){I(3)};a.techWoodCutting.iconID=107;a.techCrossbow=function(){I(11)};a.techCrossbow.iconID=112;a.createFishingBoat=function(){S(74)};a.createFishingBoat.iconID=48;a.createXebec=function(){S(76)};a.createXebec.iconID=166;a.upgradeShip=function(){};a.upgradeShip.iconID=268;a.fishing=function(){};a.fishing.iconID=41;a.createHulk=function(){S(75)};a.createHulk.iconID=165;a.createGalleon=function(){S(73)};a.createGalleon.iconID=164;a.techLandingTactics=function(){};a.techLandingTactics.iconID=
98;a.techConcentration=function(){I(58)};a.techConcentration.iconID=75;a.techConfusion=function(){I(59)};a.techConfusion.iconID=76;a.techWhirlpool=function(){I(60)};a.techWhirlpool.iconID=78;a.techDragon=function(){I(61)};a.techDragon.iconID=115;a.techTurnToStone=function(){I(62)};a.techTurnToStone.iconID=77;a.techFlameBolt=function(){I(63)};a.techFlameBolt.iconID=25;a.techJewelry=function(){I(64)};a.techJewelry.iconID=230;a.techBanking=function(){I(65)};a.techBanking.iconID=74;a.techChemistry=function(){I(66)};
a.techChemistry.iconID=225;a.techSeaFood=function(){I(67)};a.techSeaFood.iconID=67;a.techGunPowder=function(){I(68)};a.techGunPowder.iconID=212;a.techRocketArrow=function(){I(69)};a.techRocketArrow.iconID=47;a.techBushido=function(){I(70)};a.techBushido.iconID=60;a.techLeadership=function(){I(71)};a.techLeadership.iconID=114;a.techHonor=function(){I(72)};a.techHonor.iconID=94;a.techSunTzu=function(){I(73)};a.techSunTzu.iconID=66;a.createRonin=function(){S(66)};a.createRonin.iconID=54;a.createArcher1=
function(){S(67)};a.createArcher1.iconID=53;a.createSamurai=function(){S(68)};a.createSamurai.iconID=122;a.createHorseArcher1=function(){S(69)};a.createHorseArcher1.iconID=52;a.createMonk=function(){S(128)};a.createMonk.iconID=45;a.createMage1=function(){S(129)};a.createMage1.iconID=50;a.createPriest1=function(){S(127)};a.createPriest1.iconID=44;a.createPriest2=function(){S(87)};a.createPriest2.iconID=125;a.buyItems=function(){};a.buyItems.iconID=31;a.sellItems=function(){};a.sellItems.iconID=30;
a.createHorseSamurai=function(){S(70)};a.createHorseSamurai.iconID=121;a.createChariot=function(){S(72)};a.createChariot.iconID=79;a.stopTech=function(){ea(oe,0,F);Ha(B[F[0]])};a.stopTech.iconID=160;a.repair=function(){L=Wc};a.repair.iconID=145;a.conquest=function(){};a.conquest.iconID=249;a.dcm=function(){L=Bd};a.dcm.iconID=260;a.buildBarrack=function(){G(14)};a.buildBarrack.iconID=205;a.buildBarrack1=function(){G(71)};a.buildBarrack1.iconID=205;a.buildBarrack2=function(){G(102)};a.buildBarrack2.iconID=
205;a.buildTower=function(){G(32)};a.buildTower.iconID=170;a.buildStorage=function(){G(18)};a.buildStorage.iconID=200;a.buildLumbermill=function(){G(15)};a.buildLumbermill.iconID=199;a.buildLumbermill2=function(){G(93)};a.buildLumbermill2.iconID=199;a.buildFields=function(){G(20)};a.buildFields.iconID=265;a.buildCastle=function(){G(12)};a.buildCastle.iconID=206;a.buildCastle1=function(){G(62)};a.buildCastle1.iconID=206;a.buildCastle2=function(){G(63)};a.buildCastle2.iconID=206;a.buildAcademy=function(){G(17)};
a.buildAcademy.iconID=204;a.buildCathedral=function(){G(11)};a.buildCathedral.iconID=191;a.buildCathedral2=function(){G(106)};a.buildCathedral2.iconID=189;a.buildMerchands=function(){G(24)};a.buildMerchands.iconID=198;a.buildMerchands2=function(){G(108)};a.buildMerchands2.iconID=198;a.buildChurch=function(){G(25)};a.buildChurch.iconID=197;a.buildMarket=function(){G(33)};a.buildMarket.iconID=194;a.buildMageTower=function(){G(16)};a.buildMageTower.iconID=192;a.buildMageTower2=function(){G(107)};a.buildMageTower2.iconID=
192;a.buildDummy=function(){G(36)};a.buildDummy.iconID=65;a.buildFarm=function(){G(23)};a.buildFarm.iconID=193;a.buildBlacksmith=function(){G(26)};a.buildBlacksmith.iconID=202;a.buildWorkshop=function(){G(29)};a.buildWorkshop.iconID=201;a.buildWorkshop2=function(){G(98)};a.buildWorkshop2.iconID=201;a.buildStable=function(){G(28)};a.buildStable.iconID=196;a.buildStable2=function(){G(103)};a.buildStable2.iconID=196;a.buildTavern=function(){G(30)};a.buildTavern.iconID=208;a.buildHouse=function(){G(31)};
a.buildHouse.iconID=195;a.buildHarbor=function(){G(41)};a.buildHarbor.iconID=188;a.buildOutpost=function(){G(34)};a.buildOutpost.iconID=158;a.buildWoodWall=function(){hg(13)};a.buildWoodWall.iconID=210;a.buildWoodGate=function(){};a.buildWoodGate.iconID=209;a.buildWoodGate.disabled=2;a.buildBridge=function(){G(35)};a.buildBridge.iconID=176;nf="freeze invisibility lightning turnToStone bless healing".split(" ");a.freeze=function(){L=Re};a.freeze.iconID=99;a.freeze.obj={name:z.freeze};a.freeze.iconIDbook=
205;a.confusion=function(){L=Te};a.confusion.iconID=76;a.confusion.obj={name:"Confusion",spcost:[120,0,0,0]};a.confusion.iconIDbook=206;a.turnToStone=function(){L=qg};a.turnToStone.iconID=77;a.turnToStone.iconIDbook=213;a.turnToStone.obj={name:"Turn to Stone",spcost:[40,0,0,0]};a.whirlpool=function(){L=ki};a.whirlpool.iconID=78;a.whirlpool.iconIDbook=214;a.whirlpool.obj={name:"Whirlpool",spcost:[80,0,0,0]};a.flameBolt=function(){L=Me};a.flameBolt.iconID=25;a.flameBolt.obj={name:"Flame Bolt",spcost:[120,
0,0,0]};a.flameBolt.iconIDbook=216;a.createDragon=function(){L=ze};a.createDragon.iconID=115;a.createDragon.obj={name:"Spawn Dragon",spcost:[320,0,0,0]};a.createDragon.iconIDbook=215;a.lightning=function(){L=ug};a.lightning.iconID=263;a.lightning.obj={name:z.lightning,spcost:[80,0,0,0]};a.lightning.iconIDbook=200;a.createBat=function(){L=Be};a.createBat.iconID=168;a.createBat.iconIDbook=203;a.createGolem=function(){L=xe};a.createGolem.iconID=119;a.createGolem.iconIDbook=209;a.autoInvisibility=function(){L=
Ke};a.autoInvisibility.iconID=217;a.autoInvisibility.obj={name:z.invisibility};a.invisibility=function(){L=Ke};a.invisibility.iconID=217;a.invisibility.iconIDbook=208;a.impersonate=function(){L=sg};a.impersonate.iconID=32;a.impersonate.obj={name:"Impersonate"};a.revealSelf=function(){ea(oi,F[0],0)};a.revealSelf.iconID=33;a.revealSelf.obj={name:"Reveal your true self"};a.buildHouse1=function(){G(111)};a.buildHouse1.iconID=195;a.buildHouse2=function(){G(92)};a.buildHouse2.iconID=195;a.buildLumbermill1=
function(){G(112)};a.buildLumbermill1.iconID=199;a.buildStorage1=function(){G(113)};a.buildStorage1.iconID=200;a.buildStorage2=function(){G(94)};a.buildStorage2.iconID=200;a.buildFarm1=function(){G(114)};a.buildFarm1.iconID=193;a.buildFarm2=function(){G(95)};a.buildFarm2.iconID=193;a.buildHarbor1=function(){G(115)};a.buildHarbor1.iconID=188;a.buildHarbor2=function(){G(96)};a.buildHarbor2.iconID=188;a.buildBlacksmith1=function(){G(116)};a.buildBlacksmith1.iconID=202;a.buildBlacksmith2=function(){G(97)};
a.buildBlacksmith2.iconID=202;a.buildWorkshop1=function(){G(117)};a.buildWorkshop1.iconID=201;a.buildChurch1=function(){G(118)};a.buildChurch1.iconID=197;a.buildChurch2=function(){G(99)};a.buildChurch2.iconID=197;a.buildTavern1=function(){G(119)};a.buildTavern1.iconID=208;a.buildTavern2=function(){G(100)};a.buildTavern2.iconID=208;a.buildMarket1=function(){G(120)};a.buildMarket1.iconID=194;a.buildMarket2=function(){G(101)};a.buildMarket2.iconID=194;a.buildStable1=function(){G(121)};a.buildStable1.iconID=
196;a.buildOutpost1=function(){G(122)};a.buildOutpost1.iconID=158;a.buildOutpost2=function(){G(104)};a.buildOutpost2.iconID=158;a.buildCathedral1=function(){G(123)};a.buildCathedral1.iconID=190;a.buildMageTower1=function(){G(124)};a.buildMageTower1.iconID=192;a.createObjects=function(){Id("magicworkshopmenu",X)};a.createObjects.iconID=20;a.createObjects.obj={};a.buildMagicWorkshop=function(){G(110)};a.buildMagicWorkshop.iconID=46;a.buildMerchands1=function(){G(125)};a.buildMerchands1.iconID=198;a.buildAcademy1=
function(){G(126)};a.buildAcademy1.iconID=204;a.buildAcademy2=function(){G(109)};a.buildAcademy2.iconID=204;a.buildRocketTower=function(){G(57)};a.buildRocketTower.iconID=47;a.murder=function(){G(57)};a.murder.iconID=28;a.convertJihad=function(){};a.convertJihad.iconID=236;a.convertJihad.obj={};a.menuCommonBuild2=function(){ha(b)};a.menuCommonBuild2.iconID=17;var b=[a.buildFarm2,a.buildBlacksmith2,a.buildWorkshop2,a.buildStable2,a.buildTavern2,a.buildHouse2];b.menuName="a_build";a.menuCommonBuild2.xtra=
b;a.menuSpecialBuild2=function(){ha(e)};a.menuSpecialBuild2.iconID=15;var e=[a.buildCastle2,a.buildAcademy2,a.buildCathedral2,a.buildMerchands2,a.buildChurch2,a.buildMarket2,a.buildMageTower2,a.buildMagicWorkshop];e.menuName="a_build";a.menuSpecialBuild2.xtra=e;a.menuOtherBuild2=function(){ha(c)};a.menuOtherBuild2.iconID=16;var c=[a.buildHarbor2,a.buildOutpost2,a.buildWoodWall,a.buildWoodGate,a.buildBridge];c.menuName="e_build";a.menuOtherBuild2.xtra=c;a.menuBuilds2=function(){ha(d)};a.menuBuilds2.iconID=
245;var d=[a.menuSpecialBuild2,a.menuCommonBuild2,a.menuOtherBuild2,a.buildBarrack2,a.buildTower,a.buildStorage2,a.buildLumbermill2,a.buildFields];d.menuName="a_build";a.menuBuilds2.xtra=d;a.createCarpet=function(){L=Fe};a.createCarpet.iconID=146;a.createCarpet.iconIDbook=202;a.createJinn=function(){L=De};a.createJinn.iconID=118;a.createJinn.iconIDbook=218;a.magicVision=function(){};a.magicVision.iconID=223;a.magicVision.iconIDbook=210;a.fireRain=function(){L=Ve};a.fireRain.iconID=264;a.fireRain.iconIDbook=
199;a.raiseDead=function(){L=Oe};a.raiseDead.iconID=87;a.raiseDead.iconIDbook=211;a.createMage2=function(){S(89)};a.createMage2.iconID=126;a.techCowPoaching=function(){I(74)};a.techCowPoaching.iconID=85;a.techHorseManShip=function(){I(75)};a.techHorseManShip.iconID=231;a.techScimitar=function(){I(76)};a.techScimitar.iconID=84;a.techJihad=function(){I(77)};a.techJihad.iconID=236;a.techCarpet=function(){I(78)};a.techCarpet.iconID=146;a.techMagicWorkshop=function(){I(79)};a.techMagicWorkshop.iconID=
86;a.techFireRain=function(){I(80)};a.techFireRain.iconID=264;a.techMagicVision=function(){I(81)};a.techMagicVision.iconID=224;a.techNecromancy=function(){I(82)};a.techNecromancy.iconID=87;a.techJinn=function(){I(83)};a.techJinn.iconID=118;a.techOreFloatation=function(){I(84)};a.techOreFloatation.iconID=106;a.techRiddingHorses=function(){I(85)};a.techRiddingHorses.iconID=232;a.techJanissary=function(){I(86)};a.techJanissary.iconID=81;a.buildMagicItems=function(){};a.buildMagicItems.iconID=20;a.techSlavery=
function(){I(87)};a.techSlavery.iconID=135;a.stopBuilding=function(){ea(Jd,0,F)};a.stopBuilding.iconID=160;a.menuSpecialBuild1=function(){ha(h)};a.menuSpecialBuild1.iconID=15;var h=[a.buildCastle1,a.buildAcademy1,a.buildCathedral1,a.buildMerchands1,a.buildChurch1,a.buildMarket1,a.buildMageTower1,a.buildRocketTower,a.buildDummy];h.menuName="a_build";a.menuSpecialBuild1.xtra=h;a.menuCommonBuild1=function(){ha(g)};a.menuCommonBuild1.iconID=17;var g=[a.buildFarm1,a.buildBlacksmith1,a.buildWorkshop1,a.buildStable1,
a.buildTavern1,a.buildHouse1];g.menuName="a_build";a.menuCommonBuild1.xtra=g;a.menuSpecialBuild=function(){ha(k)};a.menuSpecialBuild.iconID=15;var k=[a.buildCastle,a.buildAcademy,a.buildCathedral,a.buildMerchands,a.buildChurch,a.buildMarket,a.buildMageTower,a.buildDummy];k.menuName="e_build";a.menuSpecialBuild.xtra=k;a.menuCommonBuild=function(){ha(p)};a.menuCommonBuild.iconID=17;var p=[a.buildFarm,a.buildBlacksmith,a.buildWorkshop,a.buildStable,a.buildTavern,a.buildHouse];p.menuName="e_build";a.menuCommonBuild.xtra=
p;a.menuOtherBuild=function(){ha(m)};a.menuOtherBuild.iconID=16;var m=[a.buildHarbor,a.buildOutpost,a.buildWoodWall,a.buildWoodGate,a.buildBridge];m.menuName="e_build";a.menuOtherBuild.xtra=m;a.menuOtherBuild1=function(){ha(n)};a.menuOtherBuild1.iconID=16;var n=[a.buildHarbor1,a.buildOutpost1,a.buildWoodWall,a.buildWoodGate,a.buildBridge];n.menuName="e_build";a.menuOtherBuild1.xtra=n;a.menuBuilds=function(){ha(q)};var q=[a.menuSpecialBuild,a.menuCommonBuild,a.menuOtherBuild,a.buildBarrack,a.buildTower,
a.buildStorage,a.buildLumbermill,a.buildFields];q.menuName="e_build";a.menuBuilds.iconID=245;a.menuBuilds.xtra=q;a.menuBuilds1=function(){ha(r)};a.menuBuilds1.iconID=245;var r=[a.menuSpecialBuild1,a.menuCommonBuild1,a.menuOtherBuild1,a.buildBarrack1,a.buildTower,a.buildStorage1,a.buildLumbermill1,a.buildFields];r.menuName="a_build";a.menuBuilds1.xtra=r;Yi=function(){a.fishing.obj={};a.impersonate.obj={};a.techGreatWall.obj=E[48];a.revealSelf.obj={};a.trade.obj={};a.unload.obj={};a.mercFootman6.obj=
{};a.murder.obj={};a.mercArcher6.obj={};a.mercMaceman6.obj={};a.mercPikeman6.obj={};a.mercLongbowman6.obj={};a.sameSpeed.obj={name:"Same speed"};a.restoreSpeed.obj={name:"Restore speed"};a.mercKnight6.obj={};a.attackGround.obj={};a.steady.obj={};a.bribe.obj={};a.createPriest1.obj=x[127];a.createPriest2.obj=x[87];a.createFootman2.obj=x[80];a.createArcher2.obj=x[81];a.createSatrap.obj=x[83];a.createPikeman2.obj=x[82];a.createHorseArcher2.obj=x[85];a.createCavalry.obj=x[84];a.createEnichar.obj=x[91];
a.createJihad.obj=x[86];a.createMonk.obj=x[128];a.healing.obj={name:z.heal,spcost:[20,0,0,0]};a.bless.obj={name:z.bless,spcost:[20,0,0,0]};a.stopTech.obj={};a.conquest.obj={};a.dcm.obj={name:z.dcm};a.repair.obj={name:z.repair};a.menuOtherBuild.obj={};a.menuOtherBuild1.obj={};a.menuOtherBuild2.obj={};a.sellItems.obj={};a.buyItems.obj={};a.menuBuilds.obj={name:z.menuBuild};a.menuCommonBuild.obj={};a.menuSpecialBuild.obj={};a.techMastery.obj=E[57];a.techNinjas.obj=E[56];a.teach.obj={name:"Teach",spcost:[20,
0,0,0]};a.techPhilosophy.obj=E[55];a.techKungFu.obj=E[53];a.techTournaments.obj=E[54];a.techMeditation.obj=E[52];a.menuCommonBuild1.obj={};a.menuCommonBuild2.obj={};a.createMage1.obj=x[129];a.menuSpecialBuild1.obj={};a.menuSpecialBuild2.obj={};a.menuBuilds1.obj={name:z.menuBuild};a.menuBuilds2.obj={name:z.menuBuild};a.stopBuilding.obj={};a.freeze.obj={name:z.freeze,spcost:[200,0,0,0]};a.invisibility.obj={name:z.invisibility,spcost:[40,0,0,0]};a.autoInvisibility.obj={name:z.invisibility};a.createHeroes.obj=
{};a.createMercenaries.obj={};a.upgradeShip.obj={};a.techMedicine.obj=E[35];a.techBless.obj=E[36];a.buildHouse1.obj=x[111];a.techHealing.obj=E[34];a.techInquisition.obj=E[33];a.techArmoredChariot.obj=E[51];a.techRocketArrow.obj=E[69];a.techJewelry.obj=E[64];a.techGunPowder.obj=E[68];a.techSeaFood.obj=E[67];a.techChemistry.obj=E[66];a.techBanking.obj=E[65];a.createMage.obj=x[5];a.techBat.obj=E[38];a.techGolem.obj=E[41];a.techInvisibility.obj=E[37];a.techLightning.obj=E[40];a.techFreeze.obj=E[39];a.techHeroism.obj=
E[22];a.createHorseSamurai.obj=x[70];a.createChariot.obj=x[72];a.createHorseArcher1.obj=x[69];a.createHorseArcher2.obj=x[85];a.createSamurai.obj=x[68];a.createArcher1.obj=x[67];a.techConfusion.obj=E[59];a.techConcentration.obj=E[58];a.techWhirlpool.obj=E[60];a.techDragon.obj=E[61];a.techTurnToStone.obj=E[62];a.techFlameBolt.obj=E[63];a.createRonin.obj=x[66];a.buildStorage.obj=x[18];a.buildStorage1.obj=x[113];a.buildStorage2.obj=x[94];a.buildFields.obj=x[20];a.buildLumbermill.obj=x[15];a.buildLumbermill1.obj=
x[112];a.buildLumbermill2.obj=x[93];a.buildTower.obj=x[32];a.buildBarrack1.obj=x[71];a.buildBarrack.obj=x[14];a.buildBarrack2.obj=x[102];a.buildDummy.obj=x[36];a.buildRocketTower.obj=x[57];a.buildMageTower.obj=x[16];a.buildMageTower1.obj=x[124];a.buildMageTower2.obj=x[107];a.buildMarket.obj=x[33];a.buildMarket1.obj=x[120];a.buildMarket2.obj=x[101];a.buildChurch.obj=x[25];a.buildChurch1.obj=x[118];a.buildChurch2.obj=x[99];a.buildMerchands.obj=x[24];a.irrigation.obj=E[50];a.ridingHorses.obj=E[49];a.buildMerchands1.obj=
x[125];a.buildMerchands2.obj=x[108];a.buildCathedral.obj=x[11];a.buildCathedral1.obj=x[123];a.buildCathedral2.obj=x[106];a.buildAcademy.obj=x[17];a.buildAcademy1.obj=x[126];a.buildAcademy2.obj=x[109];a.buildCastle.obj=x[12];a.magicVision.obj={name:"Magic Vision",spcost:[20,0,0,0]};a.fireRain.obj={name:"Fire Rain",spcost:[200,0,0,0]};a.raiseDead.obj={name:"Raise the Dead",spcost:[40,0,0,0]};a.createJinn.obj={name:"Spawn Jinn",spcost:[320,0,0,0]};a.createCarpet.obj={name:"Spawn Magic Carpet",spcost:[320,
0,0,0]};a.buildCastle1.obj=x[62];a.buildCastle2.obj=x[63];a.buildHouse.obj=x[31];a.buildHouse2.obj=x[92];a.buildTavern.obj=x[30];a.buildTavern1.obj=x[119];a.buildTavern2.obj=x[100];a.buildStable.obj=x[28];a.buildStable1.obj=x[121];a.buildStable2.obj=x[103];a.buildFarm.obj=x[23];a.buildFarm1.obj=x[114];a.buildFarm2.obj=x[95];a.buildWorkshop.obj=x[29];a.buildWorkshop1.obj=x[117];a.buildWorkshop2.obj=x[98];a.buildBlacksmith.obj=x[26];a.buildBlacksmith1.obj=x[116];a.buildBlacksmith2.obj=x[97];a.buildBridge.obj=
x[35];a.buildHarbor.obj=x[41];a.buildHarbor1.obj=x[115];a.buildHarbor2.obj=x[96];a.createMage2.obj=x[89];a.buildMagicItems.obj={};a.techJanissary.obj=E[86];a.techRiddingHorses.obj=E[85];a.techOreFloatation.obj=E[84];a.techJinn.obj=E[83];a.techNecromancy.obj=E[82];a.techMagicVision.obj=E[81];a.techFireRain.obj=E[80];a.techMagicWorkshop.obj=E[79];a.techCarpet.obj=E[78];a.techJihad.obj=E[77];a.techScimitar.obj=E[76];a.techHorseManShip.obj=E[75];a.techCowPoaching.obj=E[74];a.buildWoodGate.obj={};a.buildWoodWall.obj=
x[13];a.buildOutpost.obj=x[34];a.buildOutpost1.obj=x[122];a.buildOutpost2.obj=x[104];a.createGolem.obj={name:"Spawn Stone Golem",spcost:[480,0,0,0]};a.techSunTzu.obj=E[73];a.techBushido.obj=E[70];a.techLeadership.obj=E[71];a.techHonor.obj=E[72];a.createBat.obj={name:"Spawn Bat",spcost:[40,0,0,0]};a.techGoldMining.obj=E[1];a.techStoneMining.obj=E[2];a.emergeAllUnits.obj={};a.createOrk.obj=x[58];a.createDwarf.obj=x[59];a.createSkeleton.obj=x[60];a.createGhost.obj=x[40];a.createFootman.obj=x[0];a.createArcher.obj=
x[4];a.techSlavery.obj=E[87];a.createMaceman.obj=x[3];a.createPikeman.obj=x[1];a.createLongbowman.obj=x[6];a.createKnight.obj=x[19];a.mercFootman.obj=f;a.mercArcher.obj=f;a.mercMaceman.obj=f;a.mercPikeman.obj=f;a.mercLongbowman.obj=f;a.mercKnight.obj=f;a.createPeon.obj=x[10];a.createSpy.obj=x[2];a.techFeudalism.obj=E[12];a.techArchitecture.obj=E[13];a.techLearning.obj=E[14];a.createPeon1.obj=x[64];a.createPeon2.obj=x[79];a.createNinja.obj=x[65];a.techBuddhism.obj=E[45];a.createCrusaders.obj={};a.buildMagicWorkshop.obj=
x[110];a.techFanaticism.obj=E[31];a.techCrusade.obj=E[32];a.techEspionage.obj=E[30];a.techChainMail.obj=E[9];a.techHalberd.obj=E[6];a.techLongbow.obj=E[0];a.techScaleArmor.obj=E[5];a.techTemperIron.obj=E[4];a.techPlateArmor.obj=E[10];a.techLandingTactics.obj={};a.createGalleon.obj=x[73];a.createHulk.obj=x[75];a.createXebec.obj=x[76];a.createFishingBoat.obj=x[74];a.techCrossbow.obj=E[11];a.techWoodCutting.obj=E[3];a.techCannonTower.obj=E[46];a.techEngineering.obj=E[47];a.createBallist.obj=x[38];a.createHeavyCatapult.obj=
x[39];a.createCatapult.obj=x[37];a.upgradeCannonTower.obj=E[44];a.upgradeStoneTower.obj=E[43];a.upgradeGuildTower.obj=E[42];a.createCaravan.obj=x[61];a.createCaravan2.obj=x[90];a.techBribery.obj=E[21];a.techSupplyStorage.obj=E[20];a.techUsury.obj=E[19];a.techCropRotation.obj=E[8];a.createCow.obj=x[27];a.techDomestication.obj=E[7];a.techTradeTaxes.obj=E[18];a.techTradeRoutes.obj=E[17];a.techMapMaking.obj=E[16];a.createPriest.obj=x[9];a.techBodyBuilding.obj=E[29];a.techSiegeTactics.obj=E[28];a.techFame.obj=
E[27];a.techHeroes.obj=E[26];a.techMercenaries.obj=E[25];a.techTactics.obj=E[24];a.techWarfare.obj=E[23];for(var b=Object.keys(a),c=0,d=b.length;c<d;c++){var e=a[b[c]];e.objName=b[c];e.obj&&(e.obj.nu=e)}}},ef={resitem:{u:"item_use",d:"item_drop"},item_soul:{k:"item_kill",b:"item_berserk",d:"item_drop"},wall_wood:{s:"to_swall"},e_tavern:{t:"trade1",g:"gamble",m:"createMercenaries",h:"createHeroes",l:"loan"},loan:{g:"loan_gold",s:"loan_stone",f:"loan_food",w:"loan_wood"},e_castle:{p:"createPeon",s:"createSpy",
e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning"},a_castle:{p:"createPeon1",n:"createNina",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",b:"techBudhism",w:"techGreatwall"},r_castle:{p:"createPeon2",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",y:"techSlavery"},e_barrack:{f:"createFootman",a:"createArcher",m:"createMaceman",p:"createPikeman",l:"createLongbowman",k:"createKnight"},a_barrack:{r:"createRonin",
a:"createArcher2",s:"createSamurai",h:"createHorseArcher1",o:"createHorseSamurai",c:"createChariot"},r_barrack:{f:"createFootman2",a:"createArcher2",s:"createSatrap",p:"createSpearman",h:"createHorsearcher2",c:"createCavalry",j:"createJanissary",d:"createJihadWarrior"},e_magetower:{m:"createMage"},r_magetower:{m:"createMage2"},a_magetower:{m:"createMage1"},e_peon:{b:"menuBuilds",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",i:"bribe"},r_peon:{b:"menuBuilds2",
r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",j:"become_jihadw",i:"bribe"},a_peon:{b:"menuBuilds1",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",t:"trade"},e_priest:{m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"},a_priest:{m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",r:"raiseexp"},e_mage:{m:"move",a:"attack",s:"stop",n:"stand",l:"lightning",b:"createBat",f:"freeze",t:"createGolem",
i:"invisibility"},r_mage:{m:"move",a:"attack",s:"stop",n:"stand",c:"spell_spawncarpet",j:"spell_spawnjin",r:"spell_firerain",v:"spell_magicvision",d:"raisedead"},a_mage:{m:"move",a:"attack",s:"stop",n:"stand",h:"spell_hypnotize",t:"spell_turntostone",w:"spell_whirlpool",f:"spell_flamebolt",d:"spell_spawndragon"},footman:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"},a_monk:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"},a_monk_priest:{a:"attack",
g:"guard",r:"become_priest",p:"pick_item",e:"explore",s:"stop",n:"stand"},e_spy:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",n:"stand",s:"stop"},ninja:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand",c:"cloak",u:"murder"},ninja_cloaked:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand",k:"uncloak",u:"murder"},catapult:{a:"attack",g:"guard",p:"patrol",e:"explore",s:"stop",n:"stand",r:"attack_ground",h:"hold_steady"},e_market:{c:"createCaravan"},
r_market:{c:"createCaravan2"},a_market:{b:"market_items",s:"market_sell"},market_items:{},market_sell:{},e_workshop:{c:"createCatapult",h:"createHeavyCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"},r_workshop:{c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"},a_workshop:{c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"},r_church:{p:"createPriest2"},e_church:{p:"createPriest"},a_church:{m:"createMonk",p:"createPriest1"},
e_build:{c:"buildCastle",s:"buildStorage",b:"buildBarrack",k:"buildBlacksmith",f:"buildFarm",l:"buildLumber",p:"buildWorkshop",e:"buildCathedral",u:"buildChurch",n:"buildTavern",m:"buildMageTower",a:"buildStable",r:"buildHarbor",o:"buildOutpost",i:"buildFields",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse",g:"buildGateWood",y:"buildDummy"},r_build:{c:"buildCastle2",k:"buildBlacksmith2",f:"buildFarm2",n:"buildTavern2",b:"buildBarrack2",p:"buildWorkshop2",s:"buildStorage2",a:"buildStable2",
l:"buildLumber2",r:"buildHarbor2",o:"buildOutpost2",u:"buildChurch2",e:"buildMosque",i:"buildFields",m:"buildMageTower2",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse2",g:"buildGateWood"},r_magicworkshop:{i:"build_item"},a_build:{c:"buildCastle1",f:"buildFarm1",e:"buildShaolinn",n:"buildTavern1",b:"buildBarrack1",p:"buildWorkshop1",s:"buildStorage1",k:"buildBlacksmith1",a:"buildStable1",l:"buildLumber1",r:"buildHarbor1",o:"buildOutpost1",u:"buildChurch1",i:"buildFields",m:"buildMageTower1",
w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse1",g:"buildGateWood"},e_lumber:{b:"techLongbow",w:"techWoodCutting",c:"techCrossbow"},r_lumber:{w:"techWoodCutting",c:"techCrossbow"},a_lumber:{w:"techWoodCutting",c:"techCrossbow"},e_blacksmith:{p:"techPlateArmor",t:"techTemperIron",s:"techScaleArmor",h:"techHalberd",c:"techChainMail"},r_blacksmith:{t:"techTemperIron",a:"techScaleArmor",s:"techScimitar",c:"techChainMail",h:"techHalberd"},a_blacksmith:{t:"techTemperIron",a:"techScaleArmor",
r:"techArmoredChariot",c:"techChainMail"},e_outpost:{e:"emergeAllUnits"},menu_stop:{s:"stop"},tower_wood:{a:"attack",s:"stop",g:"upgradeGuildTower"},tower_wood2:{a:"attack",s:"stop",g:"upgradeStoneTower",c:"upgradeCannonTower"},tower_stone:{a:"attack",s:"stop",c:"upgradeCannonTower"},tower_stone2:{a:"attack",r:"attack_ground",s:"stop",h:"holdfire"},tower_stone3:{a:"attack",r:"attack_ground",s:"stop",f:"fireatwill"},ownership:{h:"view_heroes",s:"view_spys",i:"view_items",q:"view_quests"},gate_wood_00:{o:"gateclose",
n:"gate_subai_on",s:"to_sgate"},gate_wood_01:{o:"gateclose",f:"gate_subai_off",s:"to_sgate"},gate_wood_10:{c:"gateopen",n:"gate_subai_on",s:"to_sgate"},gate_wood_11:{c:"gateopen",f:"gate_subai_off",s:"to_sgate"},gate_stone_00:{o:"gateclose",n:"gate_subai_on"},gate_stone_01:{o:"gateclose",f:"gate_subai_off"},gate_stone_10:{c:"gateopen",n:"gate_subai_on"},gate_stone_11:{c:"gateopen",f:"gate_subai_off"},e_harbor:{f:"createFishingBoat",x:"createXebec",h:"createHulk",g:"createGalleon",t:"te_landingtactics"},
r_harbor:{f:"createFishingBoat",h:"createHulk",x:"createXebec",t:"te_landingtactics"},a_harbor:{f:"createFishingBoat",h:"createHulk",x:"createXebec"},e_boat:{m:"move",e:"explore",s:"stop",n:"stand",f:"fishing"},e_galleon:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship",l:"to_ship_level2"},e_galleon2:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship",l:"to_ship_level3"},e_galleon3:{m:"move",
e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship",l:"to_ship_level4"},e_galleon4:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship",l:"to_ship_level5"},e_galleon5:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship",l:"to_ship_level6"},e_galleon6:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",
t:"trade_ship"},e_carpet:{m:"move",u:"unload",a:"attack",e:"explore",s:"stop",n:"stand"},e_trader:{m:"move",t:"trade",e:"explore",s:"stop",n:"stand",u:"unload"},e_farm:{c:"createCow",f:"techCropRotation",d:"techDomestication"},r_farm:{c:"createCow",f:"techDomestication",d:"techDomestication",p:"te_cowpoaching",r:"te_artofriding",h:"te_horsemanship"},a_farm:{f:"techDomestication",a:"te_artofriding",i:"te_irrigation"},e_storage:{g:"techGoldMining",s:"techStoneMining"},r_storage:{g:"techGoldMining",
s:"techStoneMining"},a_storage:{g:"techGoldMining",s:"techStoneMining"},spy_add:{i:"impersonate",v:"reveal_self"},cathedral:{c:"createCrusaders"},magic_gateway:{o:"createOrk",d:"createDwarf",g:"createGhost",s:"createSkeleton"},crusade_anchor:{s:"select_crusaders"}};(function(){for(var a=Object.keys(ef),b=0;b<a.length;b++)for(var e=ef[a[b]],c=Object.keys(e),d=0;d<c.length;d++)e[e[c[d]]]=c[d]})();var Eb={};w("selectUnits").onclick=function(){w("mapeditorinfoUnits").style.display="block";w("mapeditorinfoBuilds").style.display=
"none";w("mapeditorinfoItems").style.display="none";w("mapeditorinfoNature").style.display="none"};w("selectBuilds").onclick=function(){w("mapeditorinfoUnits").style.display="none";w("mapeditorinfoBuilds").style.display="block";w("mapeditorinfoItems").style.display="none";w("mapeditorinfoNature").style.display="none"};w("selectItems").onclick=function(){w("mapeditorinfoUnits").style.display="none";w("mapeditorinfoBuilds").style.display="none";w("mapeditorinfoItems").style.display="block";w("mapeditorinfoNature").style.display=
"none"};w("selectNature").onclick=function(){w("mapeditorinfoUnits").style.display="none";w("mapeditorinfoBuilds").style.display="none";w("mapeditorinfoItems").style.display="none";w("mapeditorinfoNature").style.display="block"};Eb.size=5;Eb.func=function(){C=[{color:[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],ia:0,name:"IA",race:0,team:0}];u.editor=1;if(Qc(0,Eb.func)){w("statButton").style.display="none";w("menu").style.display="none";w("resources").style.display="none";w("mapeditorinfotop").style.display=
"block";w("mapeditorinfo").style.display="block";var a=document.getElementById("mapeditorinfoUnits");a.style.display="block";if(!Eb.preload){Eb.preload=!0;var b={},e={},c=x,d={euro:La[0],arab:La[1],asia:La[2],common:z.common};b[La[0]]=[];b[La[1]]=[];b[La[2]]=[];b[z.common]=[];e[La[0]]=[];e[La[1]]=[];e[La[2]]=[];e[z.common]=[];for(var h=0,g=c.length;h<g;h++){var k=c[h];!k.race||k.illegal||7==k.type||k.item||(k.build?e[d[k.race]].put(h):b[d[k.race]].put(h))}for(k=0;2>k;k++){c=Object.keys(b);var p={};
h=0;for(g=c.length;h<g;p={ul$17:p.ul$17},h++){var m=document.createElement("h1");m.innerHTML=c[h];p.ul$17=document.createElement("ul");m.onclick=function(a){return function(){oh(a.ul$17)}}(p);p.ul$17.style.display="none";for(var n=b[c[h]],q=Object.keys(n),r={},v=0,y=q.length;v<y;r={tcreate:r.tcreate},v++)d=document.createElement("li"),d.innerHTML=x[n[q[v]]].name,r.tcreate=n[q[v]],d.onclick=function(a){return function(){var b=a.tcreate;x[b].wall?hg(b):G(b)}}(r),p.ul$17.appendChild(d);a.appendChild(m);
a.appendChild(p.ul$17)}b=e;a=w("mapeditorinfoBuilds")}c=Object.keys(Kb);a=w("mapeditorinfoItems");ul=document.createElement("ul");b={};h=0;for(g=c.length;h<g;b={u$18:b.u$18},h++)d=document.createElement("li"),b.u$18=Kb[c[h]],d.onclick=function(a){return function(){ph(a.u$18)}}(b),d.innerHTML=b.u$18.name,ul.appendChild(d);a.appendChild(ul);a=w("mapeditorinfoNature");m=document.createElement("h1");m.innerHTML=z.trees;ul=document.createElement("ul");m.onclick=function(){oh(ul)};ul.style.display="none";
d=document.createElement("li");ul.appendChild(d);a.appendChild(m);a.appendChild(ul);d.onclick=function(){tj(Yg)};d.innerHTML=z.delete;d=document.createElement("li");ul.appendChild(d);d.onclick=function(){tj(Zg)};d.innerHTML=z.create}}};var Ig,tj=function(a){Ig=!0;L=function(){};var b=fa;b.img=k.blank;var e=32*Eb;b.wh=[e,e];Sa(b);b.active=!0;document.addEventListener("mousemove",Fb);document.addEventListener("mouseup",uj);document.addEventListener("mousedown",a)},Zg=function(a,b,e){if(b){a=2*Eb.size;
for(var c=a*a,d=y,f=0;f<c;f++){var g=b+f%a,k=e+~~(f/a);oa(g,k)&&(0===Y[g+k*d]?.8<Math.random()&&Tc([g+k*d,7,{d:3+~~(28*Math.random())}]):(g=B[Y[g+k*d]],7==g.type&&g.die()))}}else document.removeEventListener("mousedown",Zg),Fb.active=Zg},Yg=function(a,b,e){if(b){a=2*Eb.size;for(var c=a*a,d=y,f=0;f<c;f++){var g=b+f%a,k=e+~~(f/a);oa(g,k)&&(g=B[Y[g+k*d]],7==g.type&&g.die())}}else document.removeEventListener("mousedown",Yg),Fb.active=Yg},Fb=function(a){var b=32*Eb.size;b=Lb(a.pageX-A.mx-.5*b/da,a.pageY-
.5*b/da);var e=~~(.03125*b[1]);b=~~(.03125*b[0]);fa.x=32*b;fa.y=32*e;fa.active=!0;Fb.last!==b+e*y&&Fb.active&&Fb.active(a,b,e);Fb.last=b+e*y},uj=function(){fa.active=!0;fa.x=-9999;fa.y=-9999;Ig=!1;if(Fb.active){var a=32*Eb.size;a=Lb(event.pageX-A.mx-.5*a/da,event.pageY-.5*a/da);var b=~~(.03125*a[1]);a=~~(.03125*a[0]);Fb.active(event,a,b);Fb.active=!1}document.removeEventListener("mousemove",Fb);document.removeEventListener("mouseup",uj)};Kd.onchange=function(a){ea(og,parseInt(Kd.value)/100,F)};w("mapload").onchange=
function(){var a=document.getElementById("mapload").files[0],b=new FileReader;b.onloadend=function(a){a=a.target.result;w("customMapcont").style.display="block";Ba=JSON.parse(a);Ba.record?(w("seeStats").style.display="inline-table",w("playrecord").style.display="inline-table"):(w("seeStats").style.display="none",w("playrecord").style.display="none");C=Ba.playersList;null===Ba.goldRes&&(Ba.goldRes=Infinity);null===Ba.stoneRes&&(Ba.stoneRes=Infinity);null===Ba.foodRes&&(Ba.foodRes=Infinity);null===
Ba.woodRes&&(Ba.woodRes=Infinity);a=document.getElementById("custombody");a.innerHTML="";for(var b=0,d=C.length;b<d;b++){var e=C[b],f=e.color;a.innerHTML+="<tr><td style='background:rgb("+f[0]+","+f[1]+","+f[2]+')\' class="ucolor1"></td><td class="username1">'+e.name+'</td><td class="race1">'+e.race+'</td><td class="team1">'+e.team+"</td></tr>"}};a&&b.readAsText(a)};var Ba,Xk=function(a){var b={Blue:189,Red:13506841,Green:3257600,Purple:11337925,Yellow:16768512,Cyan:46517,Orange:16751649,Gray:5921370},
e=a.split(["[Player"]),c=a.split("GameDuration =")[1].split("[")[0].split(" min")[0].split(" ")[1],d=[];a=[];for(var f=1,g=e.length;f<g;f++){var k=e[f].split("\n"),p={};d[f-1]=p;for(var m=0,n=k.length;m<n;m++){var q=k[m];q=q.split(" = ");if(q[1]&&m){q[1]=q[1].trim();"Color"==q[0]&&(q[1]=b[q[1]]);"Type"==r&&"Status"!==q[0]&&a.put("N");q[1]=encodeURIComponent(q[1]);a.put(q[1]);p[q[0]]=q[1];var r=q[0]}}}b=d[0].Name+"'s Game";var u=new XMLHttpRequest;u.open("POST","http://127.0.0.1/php/stats.php",!0);
u.setRequestHeader("Content-type","application/x-www-form-urlencoded");u.onreadystatechange=function(){200===u.status&&4===u.readyState&&(location.hash="MatchX"+u.responseText)};a=a.join("<");u.send("arr="+a+"&time="+6E4*c+"&name="+b+"&players="+d.length)},$g=function(a,b){for(var e=0,c=0,d=a.length;c<d;c++)e+=b[a[c]];return e},ah=function(a,b,e){var c=["",e];performance.now();for(var d=1,f=a.length-1;d<f;d++){var g=a[d],k=g.stats,p=k.resources,m=k.unitCountMax,n=24*(d-1)+2,q=g.color,r=g.IA;r=r?"IA":
"Human";c[n]=(q[0]<<16)+(q[1]<<8)+q[2];c[n+1]=g.name;c[n+1]=g.name;c[n+2]=r;c[n+3]=g.status;c[n+4]=g.team;c[n+5]=La[g.race];c[n+6]=k.score;c[n+7]=p[0];c[n+8]=p[1];c[n+9]=p[2];c[n+10]=p[3];c[n+11]=k.dmgInflicted;c[n+12]=k.dmgTaken;c[n+13]=k.unitsKilled;c[n+14]=k.unitsLosed;c[n+15]=k.buildsDestroyed;c[n+16]=k.buildsLosed;c[n+17]=$g([10,79,64],m);c[n+18]=$g([32,44],m);c[n+19]=$g([55,56],m);c[n+20]=0;c[n+21]=0;c[n+22]=0;c[n+23]=0}vj(c,b);b&&setTimeout(function(){"block"==w("ingameStats").style.display&&
ah(a,b,e)},500)},vj=function(a,b){for(var e="<tr style='background:#000;'><td style='    padding-right: 150px;'>Name</td><td>Type</td><td>Status</td><td>Team</td><td>Race</td><td>Score</td><td>Gold</td><td>Wood</td><td>Food</td><td>Stone</td><td title='Damage Inflicted'>D.I</td><td title='Damage Taken'>D.T</td><td title='Units Killed'>U.K</td><td title='Units Losed'>U.L</td><td title='Buildings Destroyed'>B.D</td><td title='Buildings Losed'>B.L</td><td title='Maximum Peasants'>M.P</td><td title='Maximum Towers'>M.T</td><td title='Maximum Stone Towers'>M.S.T</td><td title='Gold Traded'>G.T</td><td title='Stone Traded'>S.T</td><td title='Gold Converted'>G.C</td><td title='Stone Converted'>S.C</td></tr>",
c=2,d=a.length;c<d;c++)if((c-2)%24)0!==(c-3)%24&&(f=~~((c-2)/24)%2?"style = 'background:rgba(0,0,0,0.45)'":"style = 'background:rgba(0,0,0,0.65)'"),e+="<td "+f+">"+Rb(decodeURIComponent(a[c]))+"</td>";else{c-2&&(e+="</tr>");f=parseInt(Rb(decodeURIComponent(a[c])));var f="style = 'background:rgba("+Math.floor(f/65536)+","+Math.floor(f/256)%256+","+f%256+",0.45)'";e+="<tr>"}e+="</tr>";b?(w("ingameStats").style.display="block",w("statsGame").innerHTML="<tbody>"+e+"</tbody>",b=w("statsGame").getElementsByTagName("td")):
(w("MatchX").style.display="block",w("returnmenu").style.display="block",w("statsTable").innerHTML="<tbody>"+e+"</tbody>",b=w("statsTable").getElementsByTagName("td"));a=[];c=0;for(d=b.length;c<d;c++)e=c%23,4<e&&23<c&&(a[e-5]||(a[e-5]=[]),a[e-5].put(b[c]));c=0;for(d=a.length;c<d;c++){b=a[c];b.sort(Fj);e=b.length;if(!b[1])break;b[0].innerHTML!=b[1].innerHTML&&(b[0].style.background="rgba(127,0,0,0.45)");b[e-1].innerHTML!=b[e-2].innerHTML&&(b[e-1].style.background="rgba(0,127,0,0.45)")}};w("statsLoad").onchange=
function(){var a=document.getElementById("statsLoad").files[0],b=new FileReader;b.onloadend=function(a){Xk(a.target.result)};a&&b.readAsText(a,"ascii")};var Ej=function(a){var b=new XMLHttpRequest;b.open("POST","http://127.0.0.1/php/loadstat.php",!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");wj(b,function(a){vj(a.responseText.split("<"))});K(a);b.send("id="+a)},wj=function(a,b){a.onreadystatechange=function(){4===a.readyState&&(200===a.status?b(a):alert("Error: "+a.status))}};
w("deleteUnit").onclick=function(){ea(Jd,1,F.slice(0))};w("rotatebutton").onclick=function(){for(var a=F,b=0,e=a.length;b<e;b++){var c=B[a[b]];c.build||(c.d=(c.d+1)%8,ObjectsetupIMG(c,c.img))}};w("gameMenu").onclick=Gf;w("menueditor").onclick=Gf;w("quitButton1").onclick=function(){Hf("playingMenu");u.online&&Og();C.length=0;F=[];Pa=void 0;clearInterval(fe);J=[];Lg=8;u={canceled:!0};C.length=0;B=[{terrain:1},{terrain:1},{terrain:1}];uc={};sc={};Mb={};eb.length=0;Va=A.kingdom=void 0;xi={euro:0,arab:0,
asia:0};Ga.stop();Zb=document.getElementById("msgs");qf=document.getElementById("msginput");window.removeEventListener("mousemove",sb);window.removeEventListener("keydown",Ji);window.removeEventListener("keyup",Ki);window.removeEventListener("mousemove",Li);window.removeEventListener("mousedown",Mi);window.removeEventListener("mouseup",Ni);Bc();document.getElementById("playermenu").style.display="block";document.getElementById("playingMenu").style.display="none"};w("backToGame").onclick=Gf;w("backToGameS").onclick=
function(){Hf("ingameStats")};w("statButton").onclick=function(){ah(J,!0,u.now())};w("returnmenu1").onclick=Bc;w("returnmenu").onclick=Bc;w("refreshButton1").onclick=Lf;w("sendmsg").onclick=Bg;w("start1").onclick=lj;w("start2").onclick=Qc;w("alertok").onclick=function(){this.parentNode.style.display="none";Rc()};w("saveGame").onclick=function(){var a=document.createElement("a");document.body.appendChild(a);a.style="display: none";var b=u,e=B,c=[];c.length=e.length-3;for(var d=3,h=e.length;d<h;d++){var g=
e[d],k=x[g.type],p={kingdom:g.kingdom,d:g.d,type:g.type,img:g.img,x32:g.x32,y32:g.y32};g.name!==k.name&&(p.name=g.name);g.iconID!==k.iconID&&(p.iconID=g.iconID);g.attack!==k.attack&&(p.attack=g.attack);g.defence!==k.defence&&(p.defence=g.defence);g.level!==k.level&&(p.level=g.level);g.health!==k.health&&(p.health=g.health);g.maxHealth!==k.maxHealth&&(p.maxHealth=g.maxHealth);g.func&&(p.func=g.func);g.funcObj&&(p.funcObj=g.funcObj);g.workers&&g.workers.length&&(p.workers=g.workers);g.workingOn&&(p.workingOn=
g.workingOn);g.inventory&&g.inventory.length&&(p.inventory=g.inventory);g.dix&&(p.dix=g.dix);g.diy&&(p.diy=g.diy);g.timestamp&&(p.timestamp=g.timestamp);g.working&&(p.working=g.working);g.rnd&&(p.rnd=g.rnd);g.techID&&(p.techID=g.techID);g.techStart&&(p.techStart=g.techStart);g.activeTech&&(p.activeTech=g.activeTech);g.levelProgress&&(p.levelProgress=g.levelProgress);g.c&&(p.c=g.c);g.mimg&&(p.mimg=g.mimg);void 0!==g.built&&(p.built=g.built);void 0!==g.xf&&(p.xf=g.xf);void 0!==g.yf&&(p.yf=g.yf);void 0!==
g.action&&(p.action=g.action);g.point&&(p.point=g.point);g.waitlist&&(p.waitlist=g.waitlist);g.mv&&(p.mv=g.mv);g.work&&(p.work=g.work);g.death&&(p.death=g.death);g.freezed&&(p.freezed=g.freezed);g.sword&&(p.sword=g.sword);g.shield&&(p.shield=g.shield);g.book&&(p.book=g.book);c[d-3]=p}b.allunits=c;u.movtable=sc;u.movtable2=uc;u.playersList=C;u.terrain=Array.prototype.slice.call(cd);b=JSON.stringify(u);b=new Blob([b],{type:"application/json"});b=URL.createObjectURL(b);a.href=b;a.download="savegame.tzared";
a.click();u.allunits=void 0};w("closeButton1").onclick=function(){w("mapconfiguration").style.display="none";Rc()};w("createGame1").onclick=kj;w("copyButton").onclick=function(){document.getElementById("onlineID").select();document.execCommand("Copy")};w("startCustom").onclick=function(){u=Object.assign({},Ba);u.editor=!1;u.custom=!0;Ba=void 0;Qc(!1,!1,!0)};w("playrecord").onclick=function(){u=Object.assign({},Ba);u.custom=!0;u.demo=!0;u.cycle=0;u.editor=!1;Ba=void 0;Qc(!1,!1,!0)};w("seeStats").onclick=
function(){ah(Ba.kingdoms,!1,25*Ba.cycle);location.hash="MatchX"};var lh={MatchHistory:function(){document.getElementById("returnmenu").style.display="block";var a=new XMLHttpRequest;a.open("GET","http://127.0.0.1/php/latest.php",!0);wj(a,function(a){a=a.responseText.split("|");for(var b=a.length-1,c="",d=0;d<b;d+=5)c+="<tr id='statList"+Rb(decodeURIComponent(a[d]))+"'><td>"+Rb(decodeURIComponent(a[d+1]))+"</td><td>"+Rb(decodeURIComponent(a[d+2]))+"</td><td>"+Rb(decodeURIComponent(a[d+3]))+"</td><td>"+
parseInt(Rb(decodeURIComponent(a[d+4])))/6E4+" min</td></tr>";document.getElementById("matchtable").innerHTML="<tbody>"+c+"</tbody>";c={};for(d=0;d<b;c={l:c.l},d+=5)c.l=Rb(decodeURIComponent(a[d])),w("statList"+c.l).onclick=function(a){return function(){location.hash="MatchX"+a.l}}(c)});a.send(null)},GameList:Lf,RandomMap:$b,Twitter:function(){document.getElementById("returnmenu").style.display="block"},Account:function(){ed.returnmenu.style.display="block";""==ed.Account.innerHTML&&(ed.Account.innerHTML=
'<iframe id="accountIframe"></iframe>',ed.accountIframe=document.getElementById("accountIframe"));ed.accountIframe.src="http://127.0.0.1/"+A.langCodeUrl+"account/?iframe=1"},MapEditor:Eb.func,CustomMap:function(){document.getElementById("returnmenu").style.display="block"}};jh();var tc=[Hg,He,zc,xc,Fd,we,Qe,Je,Ae,ye,Ge,Se,Le,ji,Ue,Ce,Ee,Ne,Hd,ge,Rd,Dh,he,Wf,Ch,ii,se,ni,pi,Yc,vg,qi,ri,si,ti,se,bj,di,ui,td,ei,fg,ai,bi,mg,ci,xd,Xb,lg,yc,xc,Ad,zc,rc,Cd,Xc,R,function(a){var b=a[1],e=B[a[2]];a=E[a[0]];
J[e.kingdom].technology.hidden[a.id.id]=0;Wb(e,a,b);ha.actv[a.id.id]&&Z(!1)},vd,pe,Oa,Uh,kb,qe,jg,rd,Fg,Bi,mi];(function(){for(var a=0,b=tc.length;a<b;a++)tc[a].url=a})()})();
