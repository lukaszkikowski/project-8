/*
 JSON v3.2.6 | http://bestiejs.github.io/json3 | Copyright 2012-2013, Kit Cambridge | http://kit.mit-license.org  https://mths.be/utf8js v2.0.0 by @mathias */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(F,aa,ca){F!=Array.prototype&&F!=Object.prototype&&(F[aa]=ca.value)};$jscomp.getGlobal=function(F){return"undefined"!=typeof window&&window===F?F:"undefined"!=typeof global&&null!=global?global:F};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var F=0;return function(aa){return $jscomp.SYMBOL_PREFIX+(aa||"")+F++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var F=$jscomp.global.Symbol.iterator;F||(F=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[F]&&$jscomp.defineProperty(Array.prototype,F,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(F){var aa=0;return $jscomp.iteratorPrototype(function(){return aa<F.length?{done:!1,value:F[aa++]}:{done:!0}})};$jscomp.iteratorPrototype=function(F){$jscomp.initSymbolIterator();F={next:F};F[$jscomp.global.Symbol.iterator]=function(){return this};return F};
$jscomp.iteratorFromArray=function(F,aa){$jscomp.initSymbolIterator();F instanceof String&&(F+="");var ca=0,Ba={next:function(){if(ca<F.length){var Aa=ca++;return{value:aa(Aa,F[Aa]),done:!1}}Ba.next=function(){return{done:!0,value:void 0}};return Ba.next()}};Ba[Symbol.iterator]=function(){return Ba};return Ba};
$jscomp.polyfill=function(F,aa,ca,Ba){if(aa){ca=$jscomp.global;F=F.split(".");for(Ba=0;Ba<F.length-1;Ba++){var Aa=F[Ba];Aa in ca||(ca[Aa]={});ca=ca[Aa]}F=F[F.length-1];Ba=ca[F];aa=aa(Ba);aa!=Ba&&null!=aa&&$jscomp.defineProperty(ca,F,{configurable:!0,writable:!0,value:aa})}};$jscomp.polyfill("Array.prototype.keys",function(F){return F?F:function(){return $jscomp.iteratorFromArray(this,function(F){return F})}},"es6","es3");
$jscomp.polyfill("Object.getOwnPropertySymbols",function(F){return F?F:function(){return[]}},"es6","es5");$jscomp.findInternal=function(F,aa,ca){F instanceof String&&(F=String(F));for(var Ba=F.length,Aa=0;Aa<Ba;Aa++){var L=F[Aa];if(aa.call(ca,L,Aa,F))return{i:Aa,v:L}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(F){return F?F:function(F,ca){return $jscomp.findInternal(this,F,ca).v}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(F){return F?F:function(){return $jscomp.iteratorFromArray(this,function(F,ca){return ca})}},"es8","es3");$jscomp.polyfill("Math.sign",function(F){return F?F:function(F){F=Number(F);return 0===F||isNaN(F)?F:0<F?1:-1}},"es6","es3");$jscomp.polyfill("Number.isFinite",function(F){return F?F:function(F){return"number"!==typeof F?!1:!isNaN(F)&&Infinity!==F&&-Infinity!==F}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(F){return F?F:function(F){return Number.isFinite(F)?F===Math.floor(F):!1}},"es6","es3");$jscomp.owns=function(F,aa){return Object.prototype.hasOwnProperty.call(F,aa)};$jscomp.polyfill("Object.assign",function(F){return F?F:function(F,ca){for(var aa=1;aa<arguments.length;aa++){var Aa=arguments[aa];if(Aa)for(var L in Aa)$jscomp.owns(Aa,L)&&(F[L]=Aa[L])}return F}},"es6","es3");
(function(){var F,aa,ca,Ba;function Aa(f,b){var a=D,c;for(c=2;60>=c;c+=2){f--;b--;for(var e=0;e<=c;){if(2<V[f+e+a*b]&&1==z[V[f+e+a*b]].res)return V[f+e+a*b];if(2<V[f+e+a*(b+c)]&&1==z[V[f+e+a*(b+c)]].res)return V[f+e+a*(b+c)];e++}for(e=0;e<c-1;){e++;if(2<V[f+a*(b+e)]&&1==z[V[f+a*(b+e)]].res)return V[f+a*(b+e)];if(2<V[f+c+a*(b+e)]&&1==z[V[f+c+a*(b+e)]].res)return V[f+c+a*(b+e)]}}return!1}function L(f){f.setupINTV(Yd,f.id,0)}function Lj(){for(var f=0,b=Ga.length;f<b;Ga[f++].className="");}function Mj(f){g.getError()==
g.CONTEXT_LOST_WEBGL&&(g=document.getElementById("tzar").getContext("webgl2",{antialias:!1,alpha:!1}),M("restored"));aa=[];ca=[0,1,2,1,2,3];Ba=[];ca.changed=!0;if(!jd){var b=g.createShader(g.VERTEX_SHADER);g.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec4 a_kingdom;\nin vec4 a_physic;\nuniform float zoom;\nuniform mediump int miniMap;\nuniform float now;\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform sampler2D u_image1;\nuniform sampler2D delay;\nuniform float zMax;\nout highp vec2 vTextureCoord;\nout vec4 v_kcolor;\nout float height;\n\nvec4 superArray(in highp uint position) {\n     return(texelFetch(u_image1, ivec2(\t\t(position%uint(512))\t\t,\tposition/uint(512)\t), 0));\n}\n\n\n\nvoid main() {\n\n\n\n    highp float  x;\n    float t;\n\thighp uint pos;\n\n\nif(a_texCoord.y>-.5&&miniMap==0){\nt=(now-a_texCoord.y);\nif(a_texCoord.w>=0.0){\npos=uint(floor(t * a_texCoord.w));         \n}else{\n\n\nint index=int(-a_texCoord.w);\nint len=int(a_texCoord.z);\nint i;\n\nfloat spt= mod(t,texelFetch(delay, ivec2(len-1+index, 0), 0).r);\n\n for(i=0;i<len;i++){\n\n\nif(texelFetch(delay, ivec2(i+index, 0), 0).r>spt) {\n\nbreak;\n }\n\n\n }\n\n pos=uint(i);\n\n\t\t\t\t  \n //pos=uint(4);\n}\n\n\n\tpos=uint(a_texCoord.x)+uint(4)*(pos%uint(a_texCoord.z));\n\n\n}else{\n\npos=uint(a_texCoord.x);\n\n}\n\n\n\n    vec4 coord = superArray(pos);\n\n\tpos=pos-pos%uint(4);\n\n\theight = (superArray(pos+uint(3)).w-superArray(pos).w)/512.0;\n\n    vec2 mxy=vec2(coord.p,coord.q);\n\n\n\t\tfloat z=a_position.z;\n\n\tif(z<0.0){\n\tz*=-1.0;\n\tmxy*=0.0;\n\n\t}\n\n\n\n    t = (now - a_physic.w) * 0.001;\n    mxy.x+=a_physic.x * t;\n\n\tfloat physicY=a_physic.y * t + a_physic.z * .5 * t * t;\n\n    mxy.y+=physicY;\n\n\nif(miniMap==1){\n\tz=0.0;\n}else{\n\tz=(1.0 - (physicY+z)/ zMax)*.9;\n}\n\n   gl_Position = vec4((((a_position.xy+mxy) + u_translation) / u_resolution * 2.0 - 1.0) * vec2(zoom, -zoom), (z), 1.0);\n\n   vTextureCoord=vec2(coord.s,coord.t);\n\n\n    v_kcolor=a_kingdom;\n\n\n}\n");
g.compileShader(b);var a=g.createShader(g.FRAGMENT_SHADER);g.shaderSource(a,"#version 300 es\nprecision mediump float;\n\n\n\nuniform sampler2D lightmap;\nuniform vec2 u_resolution;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform mediump int miniMap;\nin vec4 v_kcolor;\nin highp vec2 vTextureCoord;\nin float height;\nout vec4 COLOR;\n\nvoid main() {\n\n\nif(miniMap==0){\n\n\n\n\nvec2 txtFinal=vTextureCoord;\n\nif(txtFinal.x>=1.0){\ntxtFinal.y+=height*floor(txtFinal.x);\n}\n\n\nvec4 color=texture(img_common, vec3(txtFinal, int(txtFinal.y)));\n \n\nif(color.a<0.5) discard;\n\n\n\n\nif(v_kcolor.a<1.0){\ncolor*=v_kcolor;\n}else if(v_kcolor.a!=1.0){\n\nif(color.r==color.g&&color.r==color.b){\ncolor.rgb*=v_kcolor.rgb;\n}\ncolor.a*=v_kcolor.a-1.0;\n}\nvec4 light=vec4(1.0);\n\n\nlight = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+vec4(1.0,1.0,1.0,0.0)*u_ambient;\n\nCOLOR=color*light;\n\n}else{\nCOLOR=v_kcolor;\n}\n\n}");
g.compileShader(a);la=g.createProgram();g.attachShader(la,b);g.attachShader(la,a);g.linkProgram(la);g.useProgram(la);b=g.getShaderInfoLog(b);console.log("Shader compiler log: "+b);b=g.getShaderInfoLog(a);console.log("Shader compiler log: "+b);b=g.createShader(g.VERTEX_SHADER);g.shaderSource(b,"#version 300 es\nprecision mediump float;\n\nin vec3 a_position;\n\n\nuniform vec2 u_resolution;\nuniform vec2 u_translation;\nuniform mediump int miniMap;\nuniform float zoom;\n\n\nvoid main() {\n\nfloat depth;\nif(miniMap==1){\ndepth=.03;\n}else{\ndepth=1.0;\n}\n\n   gl_Position = vec4(a_position.x, a_position.y, depth, 1.0);\n   \n\n}");
g.compileShader(b);a=g.createShader(g.FRAGMENT_SHADER);g.shaderSource(a,"#version 300 es\nprecision mediump float;\n\nuniform float u_fps;\nuniform mediump int miniMap;\nprecision highp sampler2DArray;\nuniform sampler2DArray img_common;\nuniform vec4 u_ambient;\nuniform vec2 borderCoords;\nuniform vec2 waterBorder;\nuniform vec2 u_translation;\nuniform vec2 u_resolution;\nuniform vec2 minimapMargin;\nuniform mediump isampler2D img_data;\nuniform sampler2D lightmap;\nout vec4 COLOR;\nuniform float zoom;\nuniform float mx;\nuniform float mapSize;\nuniform float terrainInfo[32];\nvec4 sptexture3D(in vec2 coords,in float height1) {\n \n\n \nif(coords.x>=1.0){\ncoords.y+=height1*floor(coords.x);\n}\n\n\n\n    return(\ttexture(img_common, vec3(coords,int(coords.y)))\t);\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\nvec4 color;\n\nvec2 xy =  vec2(gl_FragCoord.x,u_resolution.y-gl_FragCoord.y)/zoom;\n\nif(miniMap==1){\nxy+=minimapMargin/zoom;\n}else{\nxy+=-u_translation+vec2(mx,0.0)/zoom+0.5*(u_resolution-u_resolution/zoom);\n}\n\nvec2 xy32=xy/32.0;\n\nvec2 floorxy32=floor(xy32);\n\nvec2 xyr=xy32-floorxy32;\n\n\nvec2 xyb;\n\n\nfloat dx=0.0;\nfloat dy=0.0;\n\nif(xyr.x>0.5){dx=1.0;}\nif(xyr.y>0.5){dy=1.0;}\n\nvec2 oxy32=xy32;\n\n\nif(dx==1.0){\nxyb=vec2(borderCoords.x+floor(rand(floorxy32)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(-16.0,8.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.x+=dx;\n}\n}\n\nif(dy==1.0){\nxyb=vec2(borderCoords.x+floor(rand(1.5*floorxy32-3.0)*24.0)*64.0/512.0,borderCoords.y)+(xyr)*(32.0/512.0)+vec2(8,-16.0)/512.0;\nif(sptexture3D(xyb,64.0/512.0).r>0.5){\nxy32.y+=dy;\n}\n}\n\n\nint type = texture(img_data,xy32/(mapSize)).r;\nint ntype = texture(img_data,oxy32/(mapSize)).r;\n\nif(type<0&&type!=ntype){\n\nif(ntype<0){\ntype=ntype;\n}else if(ntype==3){\ntype=ntype;\n}else{\ntype=1;\n}\n}\n\n\n\nfloat h;\nfloat w;\nvec2 xytxt;\nif(type<0){\n\ntype=-type-1;\nxytxt=waterBorder+vec2(float(type*8*32),0.0)/512.0;\nw=32.0;\nh=32.0;\ntype*=-1;\n}else{\nxytxt=vec2(terrainInfo[type*4],terrainInfo[type*4+1]);\nw=terrainInfo[type*4+2];\nh=terrainInfo[type*4+3];\n\nif(type==3) xytxt+=vec2(u_fps,0.0);\n}\n\n\nvec2 xyt=vec2(xytxt)+vec2(mod(xy.x,w),mod(xy.y,h))/512.0;\n\n\nif(type==3){ h=576.0; }\ncolor=sptexture3D(xyt,h/512.0);\n\nmediump vec4 light=vec4(1.0);\nif(miniMap==0) light = texture(lightmap, gl_FragCoord.xy/u_resolution)/u_ambient+1.0;\n\n\n\nCOLOR=color*light*u_ambient;\n\n\n\n}");
g.compileShader(a);ba=g.createProgram();g.attachShader(ba,b);g.attachShader(ba,a);g.linkProgram(ba);b=g.getShaderInfoLog(b);console.log("Shader1 compiler log T: "+b);b=g.getShaderInfoLog(a);console.log("Shader compiler log T: "+b)}a=g.getAttribLocation(la,"a_position");b=g.getAttribLocation(la,"a_texCoord");var c=g.getAttribLocation(la,"a_kingdom"),e=g.getAttribLocation(la,"a_physic"),h=k,l=Sb.dir,p=[];p.length=4*l.length;for(var n=0,m=l.length;n<m;n++){var q=ra[h[l[n]]],y=q[7]+q.deltaY,u=q[8],E=
q[9];p[4*n]=q[6]/512;p[4*n+1]=y/512;p[4*n+2]=u;p[4*n+3]=E}M(p);n=1/512;g.useProgram(ba);m=g.getUniformLocation(ba,"minimapMargin");kd=g.getUniformLocation(ba,"u_translation");zf=g.getUniformLocation(ba,"u_resolution");Af=g.getUniformLocation(ba,"u_fps");var Fb=g.getUniformLocation(ba,"u_ambient");Qc=g.getUniformLocation(ba,"zoom");q=g.getUniformLocation(ba,"mx");l=g.getUniformLocation(ba,"mapSize");y=g.getUniformLocation(ba,"borderCoords");u=g.getUniformLocation(ba,"waterBorder");Zd=g.getUniformLocation(ba,
"miniMap");E=g.getUniformLocation(ba,"terrainInfo");g.uniform2fv(y,[ra[h.terrain_border][6]*n,n*(ra[h.terrain_border].deltaY+ra[h.terrain_border][7])]);g.uniform2fv(u,[ra[h.waterborder][6]*n,n*(ra[h.waterborder].deltaY+ra[h.waterborder][7])]);g.uniform1i(Zd,0);g.uniform2fv(kd,[0,0]);g.uniform1f(Af,-1);g.uniform1f(Qc,1);g.uniform1f(q,-t.mx);g.uniform1f(l,D);g.uniform1fv(E,p);r.editor?g.uniform2fv(m,[0,-60]):g.uniform2fv(m,[-4,-31]);h=g.getAttribLocation(ba,"a_position");Bf=g.createVertexArray();g.bindVertexArray(Bf);
p=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,p);g.bufferData(g.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,-1,1,1,-1,1]),g.STATIC_DRAW);g.enableVertexAttribArray(h);g.vertexAttribPointer(h,2,g.FLOAT,!1,0,0);g.bindVertexArray(null);g.useProgram(la);g.bindBuffer(g.ARRAY_BUFFER,null);h=D*xa*3;Cf=g.createVertexArray();g.bindVertexArray(Cf);Xa=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,Xa);g.enableVertexAttribArray(c);g.vertexAttribPointer(c,4,g.FLOAT,!1,0,0);g.bufferData(g.ARRAY_BUFFER,16*h,
g.DYNAMIC_DRAW);Rc=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,Rc);g.enableVertexAttribArray(b);g.vertexAttribPointer(b,4,g.FLOAT,!1,0,0);g.bufferData(g.ARRAY_BUFFER,16*h,g.DYNAMIC_DRAW);ec=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,ec);g.enableVertexAttribArray(a);g.vertexAttribPointer(a,3,g.FLOAT,!1,0,0);g.bufferData(g.ARRAY_BUFFER,12*h,g.DYNAMIC_DRAW);ld=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,ld);g.enableVertexAttribArray(e);g.vertexAttribPointer(e,4,g.FLOAT,!1,0,0);g.bufferData(g.ARRAY_BUFFER,
16*h,g.DYNAMIC_DRAW);g.bindVertexArray(null);$d=g.getUniformLocation(la,"u_resolution");var Qa=g.getUniformLocation(la,"u_ambient");md=g.getUniformLocation(la,"u_translation");Sc=g.getUniformLocation(la,"zoom");lh=g.getUniformLocation(la,"now");ae=g.getUniformLocation(la,"miniMap");a=g.getUniformLocation(la,"zMax");g.uniform1f(a,r.zMax);g.uniform1i(ae,0);g.useProgram(la);k.delay=[100,250,400,550,650,750,850,1E3,1150,5150,7650,10150,13650,17150,21150,25150,100,200,300,400,500,600,700,800,900,1E3,1100,
1200,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6500,7700,8900,10100,13600,17100,22100,8E3,8080,8160,8240,8320,8400,8480,100,200,300,400,500,600,700,800,900,1E3,1100,2400,3600,4800,6E3,7200,8400,11900,15400,20400,8E3,8077,8154,8231,8308,8385,8462,8539,8616,8693,8770,8847,8923,5E3,5072,5143,5215,5286,5358,5429,5501,5572,5644,5715,5787,5858,5929,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,3700,4900,7100,9600,12600,17100,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,
8833,8916,9E3,8E3,8083,8166,8250,8333,8416,8500,8583,8666,8750,8833,8916,9E3,9080,5E3,5100,5200,5300,5400,5500,5600,5700,5850,6E3,70,140,210,280,350,420,490,560,630,700,770,840,910,980,4980,8980,12980,16980,20980,26980,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,4100,6300,8500,11E3,13500,17E3,20500,5E3,5100,5200,5300,5400,5500,5600,5700,5800,5900,6E3,125,230,335,431,546,606,666,731,857,952,1045,1139,1238,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,3300,
5800,8800,12E3,15500,5500,5600,5700,5800,5900,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,6800,9800,12800,16300,19800,23800,28300,5E3,5100,5200,5300,5400,5500,5600,210,420,654,864,1074,1284,1494,108,244,380,516,652,788,924,1060,1196,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4100,6100,8100,11100,14100,17100,6E3,6100,6200,6300,6400,6500,6600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5200,9E3,11E3,13800,17600,23400,7E3,7100,
7200,7300,7400,8200,8300,8400,8500,8600,9600,9700,9800,9900,1E4,80,160,210,360,610,1010,1510,100,200,300,400,500,3500,7500,13500,40,80,120,160,200,240,280,320,360,400,440,480,520,2520,3520,4520,5520,6520,8520,11520,107,214,321,428,535,642,749,856,963,1070,1177,1284,1391,1498,7323,13148,18973,24798,30623,36448,7E3,7170,7340,7510,7680,7980,8150,8320,8490,8660,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,6400,8900,11400,14900,18400,7E3,7200,7400,7600,7800,8E3,8200,125,250,375,500,
2E3,2125,2250,100,200,300,400,500,4E3,10500,100,200,300,400,500,600,700,800,900,8900,15900,21400,27400,33900,38900,44900,51900,800,1E3,1200,1400,1600,1800,2E3,2200,2400,2600,NaN,80,160,240,320,400,480,560,640,720,800,880,960,1040,5040,9040,12790,16540,19290,22040,25790,7671,7771,7871,7971,8071,8171,8271,100,200,300,400,500,600,700,800,900,1E3,1100,1200,6200,9700,13200,17200,21200,25200,29200,35200,100,200,300,400,500,600,9600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,11300,17300,
27300,37300,49300,64300,8E3,8228,8457,8685,8914,9142,9371,80,160,240,320,400,480,560,640,720,800,880,960,4960,8460,11460,14460,18460,22460,28460,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,5400,8900,12900,16900,22900,28900,5E3,5143,5286,5429,5572,5715,5857,121,232,361,508,629,758,879,1018,1165,1425,1445,1465,1536,1692,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8300,11300,14800,18800,23300,29300,6E3,6171,6343,6514,6685,6857,7028,125,
250,375,500,625,750,875,1E3,1125,1250,1375,1500,6500,10500,13500,16500,19500,23E3,27E3,31500,8E3,8185,8370,8555,8740,8925,9108,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4300,7800,11300,15300,19300,23800,29800,1E4,10107,10214,10321,10428,10535,10643,10750,10857,10964,11071,11178,11285,11393,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4900,8400,12900,17400,22400,27400,
8E3,8250,8500,8750,9E3,9250,9500,9750,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,8300,11800,15800,19800,24300,29300,5E3,5157,5314,5471,5628,5785,5943,125,250,375,500,625,3125,3250,3375,100,200,300,400,500,600,4600,8600,14600,15600,14E3,14143,14286,14429,14572,14715,14857,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14400,18400,
22400,28400,180,360,540,720,900,1080,10080,100,200,350,500,600,700,800,950,1100,1250,1400,1550,1700,6200,8700,11700,15200,18700,22700,27700,6E3,6120,6240,6360,6480,6600,6720,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,7400,10900,14900,18900,23400,29400,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,4400,7400,10900,14900,19900,5E3,5100,5200,5300,5400,5500,5600,116,232,348,464,522,580,638,696,812,928,1044,1160,1276,1392,100,200,300,400,
500,600,700,800,900,1E3,1100,1200,5200,8700,11700,14700,18700,22700,28700,8E3,8228,8456,8684,8912,9140,9367,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,6900,10900,14400,18400,22400,27400,7E3,7100,7200,7300,7400,7500,7600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8600,10800,13E3,15500,19500,24E3,8E3,8100,8200,8300,8400,8500,8600,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,5300,8800,12300,16300,20300,24300,29300,6E3,6100,6200,6300,6400,6500,6600,100,200,
300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1630,1730,1830,1930,2030,2130,2230,2330,5330,8330,11330,7E3,7150,7300,7450,7600,7750,7900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,5200,8700,12200,15700,20200,24700,29700,34700,8E3,8080,8163,8246,8330,8413,8496,8580,8663,8746,8830,8913,8996,9080,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,4800,7800,10800,14300,17800,21800,26300,5E3,5086,5171,5257,5342,5428,5513,5599,5684,5770,5855,5941,6026,6112,125,250,375,500,625,
750,875,1E3,1125,1250,1375,1500,1625,5625,8625,11625,14625,18125,22125,26625,8E3,8185,8370,8555,8740,8925,9108,190,369,547,726,904,1073,1241,1325,1398,1429,1586,1754,1922,2100,100,200,300,400,500,600,700,800,900,1E3,1100,6100,10600,14600,18100,21600,26100,30600,35600,40600,8E3,8150,8300,8450,8600,8750,8900,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,1500,1600,1700,6700,10700,11300,6E3,6200,6400,6600,6800,7E3,7200,100,200,300,400,500,600,700,800,900,1E3,1100,1200,1300,1400,10400,100,
200,300,400,500,600,8600];a=k.delay;var N=a.length;ra[k.expl_small_hole][1]=-N;for(b=n=0;14>n;n++)b+=66,a[n+N]=b;a.put(b+3E4);a=new Float32Array(a);mh=function(f){g.useProgram(ba);g.uniform4fv(Fb,f);g.useProgram(la);g.uniform4fv(Qa,f)};Df=function(f){if(!nd&&(f.clientX>t.menumx||Tc||!f.clientX)){f=.07*Math.sign(f.deltaY)*da;var b=(da+f)*tzar.height*.03125;(da+f)*tzar.width*.03125-(da+f)*t.mx/32>D||b>xa||(da+=f,.08>da&&(da=.08),rb(),od(-bb,-cb),g.useProgram(ba),g.uniform1f(Qc,1/da),g.useProgram(la),
g.uniform1f(Sc,1/da))}};window.addEventListener("wheel",Df,!1);nh=function(){N=[bb,cb];g.useProgram(ba);g.uniform2fv(kd,N);g.useProgram(la);g.uniform2fv(md,N)};mh(oh());M(oh());g.uniform1f(Sc,1);g.uniform2fv(md,[0,0]);var Gb=g.createFramebuffer(),pa;pd=function(){var f=window.innerWidth,b=window.innerHeight;tzar.width=f;tzar.height=b;g.useProgram(ba);g.uniform2f(zf,f,b);g.useProgram(la);Gb.width=f;Gb.height=b;g.activeTexture(g.TEXTURE2);pa||(pa=g.createTexture());g.bindTexture(g.TEXTURE_2D,pa);g.texImage2D(g.TEXTURE_2D,
0,g.RGBA,f,b,0,g.RGBA,g.UNSIGNED_BYTE,null);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.bindFramebuffer(g.FRAMEBUFFER,Gb);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,pa,0);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);g.bindFramebuffer(g.FRAMEBUFFER,null);da=1;g.uniform1f(Sc,
1/da);g.uniform1i(g.getUniformLocation(la,"lightmap"),2);g.useProgram(ba);g.uniform1i(g.getUniformLocation(ba,"lightmap"),2);g.uniform1f(Qc,1/da);g.useProgram(la);g.uniform2f($d,f,b);g.viewport(t.mx,0,f,b);pd.changed=1;od(-bb,-cb)};pd.changed=0;window.addEventListener("resize",pd,!1);pd();g.blendEquation(g.FUNC_ADD);g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA);g.disable(g.DITHER);g.disable(g.BLEND);performance.now();b=g.createTexture();c=W.info;M(x);g.bindTexture(g.TEXTURE_2D,b);g.texImage2D(g.TEXTURE_2D,
0,g.RGBA32F,512,512,0,g.RGBA,g.FLOAT,c);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT);g.bindTexture(g.TEXTURE_2D,null);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,b);g.uniform1i(g.getUniformLocation(la,"u_image1"),0);g.activeTexture(g.TEXTURE1);b=g.createTexture();g.bindTexture(g.TEXTURE_2D_ARRAY,b);g.texParameteri(g.TEXTURE_2D_ARRAY,
g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D_ARRAY,g.TEXTURE_MIN_FILTER,g.NEAREST);c=W.common;e=c.length;q=W.xtra;n=0;for(m=q.length;n<m;e+=q[n++].length);M(W);g.texImage3D(g.TEXTURE_2D_ARRAY,0,g.RGBA,W.size,W.size,e/(4*W.size*W.size),0,g.RGBA,g.UNSIGNED_BYTE,null);e=c.length;g.texSubImage3D(g.TEXTURE_2D_ARRAY,0,0,0,0,W.size,W.size,c.length/(4*W.size*W.size),g.RGBA,g.UNSIGNED_BYTE,c);n=0;for(m=q.length;n<m;n++)c=q[n],g.texSubImage3D(g.TEXTURE_2D_ARRAY,0,0,0,e/1048576,W.size,W.size,
c.length/(4*W.size*W.size),g.RGBA,g.UNSIGNED_BYTE,c),e+=c.length;M(e);g.activeTexture(g.TEXTURE1);g.bindTexture(g.TEXTURE_2D_ARRAY,b);g.uniform1i(g.getUniformLocation(la,"img_common"),1);g.useProgram(ba);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D_ARRAY,b);g.uniform1i(g.getUniformLocation(ba,"img_common"),0);ph(f);jd||(M(a),g.activeTexture(g.TEXTURE3),b=g.createTexture(),g.bindTexture(g.TEXTURE_2D,b),g.texImage2D(g.TEXTURE_2D,0,g.R16F,a.length,1,0,g.RED,g.FLOAT,a),g.texParameteri(g.TEXTURE_2D,
g.TEXTURE_MAG_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT),g.bindTexture(g.TEXTURE_2D,null),g.bindTexture(g.TEXTURE_2D,b),g.uniform1i(g.getUniformLocation(la,"delay"),3),g.activeTexture(g.TEXTURE2),Ef=g.createTexture(),g.bindTexture(g.TEXTURE_2D,Ef),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),g.texParameteri(g.TEXTURE_2D,
g.TEXTURE_MAG_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT),g.clearColor(0,0,0,1));g.bindFramebuffer(g.FRAMEBUFFER,Gb);Gb.width=1;Gb.height=1;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,pa,0);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);g.bindFramebuffer(g.FRAMEBUFFER,null);new Float32Array(8);Ff=g.createBuffer();Gf=g.createBuffer();
qh=g.createBuffer();n=0;for(m=Hf.length;n<m;n++)Ra(Hf[n]);g.enable(g.DEPTH_TEST);g.depthFunc(g.LEQUAL);db.fp1000=1E3;db.delta=0;db.now=0;db.frameCount=0;g.bindTexture(g.TEXTURE_2D,pa);jd=W.setup=!0}function Uc(f,b,a){var d=b||Uc,e=function(){d(f,b,a)};if(!rh()){r.editor?(t.marx=0,t.mary=60,v("saveGame").innerHTML=A.save,t.menumy=60,Ya=Hb=171,t.mx=0,t.menumx=171):(t.mx=151,Ya=Hb=128,t.menumx=151,t.menumy=0,v("saveGame").innerHTML=A.savegame,t.marx=4,t.mary=31);oc.style.width=Hb+"px";oc.style.height=
Ya+"px";oc.style.left=t.marx+"px";oc.style.top=t.mary+"px";Vc();v("loading").style.display="block";origin=!1;M(W.load,W.images);if(W.load<W.images||!W.images)return W.started||(v("qdgraphics")&&(v("qdgraphics").style.display="none"),sh()),v("loadingtext").innerHTML=A.waitImages,Ib=e,!1;if(If.last!==v("terrainSelect").value)return Jf=!0,v("loadingtext").innerHTML="Downloading terrain",Oj(),Ib=e,!1;Pj();v("notifybottom").style.display="none";void 0==r.arje&&Kf();r.demo?v("saveGame").style.display="none":
v("saveGame").style.display="block";M(P);if(a){var h=0==r.cycle?r.kingdomStart:r.kingdoms;e=0;for(p=h.length;e<p;e++){var l=new Tb("",h[e].color,[0],!0);Object.assign(l,h[e]);null==l.resources[0]&&(l.resources[0]=Infinity);null==l.resources[1]&&(l.resources[1]=Infinity);null==l.resources[2]&&(l.resources[2]=Infinity);null==l.resources[3]&&(l.resources[3]=Infinity)}}else{e=0;for(var p=P.length;e<p;e++){h=P[e];l=[0];for(var n=0;n<p;n++)l[n+1]=P[n].team==h.team?0:1;l.put(1);r.online&&h.id===t.onlineID&&
(t.kingdom=e+1);new Tb(h.name,h.color,l,h.race,h.IA,[r.goldRes,r.woodRes,r.foodRes,r.stoneRes],h.team)}}t.kingdom||(t.kingdom=1);Qj();return!0}}function th(){v("playingMenu").style.display="block";Vc()}function Rj(f){M("setup:",f);f.toSend=[];f.orderList=[];f.sendDirectly("channelMessage","nehhof",{});f.channels.channelMessage.onopen=function(){va.put(f);ma("attack");Lf();Mf(1);M("DATACHANNEL OPEN");for(var b=0,a=P.length;b<a;b++)if(P[b].id==f.id)f.username=P[b].name,Ub[b]&&(Ub[b].style.background=
"#00ff00",Ub[b].style.boxShadow="0px 0px 30px 0px #00ff00");else if(P[b].id==t.onlineID){var c=P[b],e=t.color;M("sending");ea(Nf,e,0,[f],2);ea(Of,c.team,0,[f],2);ea(Pf,c.race,0,[f],2);ea(uh,t.name,0,[f],2)}};f.channels.channelMessage.onerror=function(f){M(f)}}function vh(){document.getElementById("buttons").innerHTML="";document.getElementById("onlineID").value="";document.getElementById("gameName").innerHTML=""}function Qf(){t.p2p?(kb(),t.p2p.emit("getRooms"),v("returnmenu").style.display="block"):
(Da||Vb(),Vb.func=Qf)}function wh(){var f=location,b=f.hash.substr(1);""==b&&(document.getElementById("returnmenu").style.display="none");if("MatchX"==b.substr(0,6))6<b.length&&Sj(b.substr(6-b.length));else if("Room"==f.hash.substr(-4))f=f.hash.substr(1),t.admin||xh(f.substr(0,f.length-4));else if(yh[b])yh[b]();else f.hash=""}function zh(f){var b=new Date;f=new Uint32Array(f);for(var a,c=D,e=0;e<V.length;e++)V[e]!=f[e]&&(a=f[e],V[e]=a,a=z[a],a.x32=e%c,a.y32=~~(e/c));console.log(new Date-b)}function Ah(f){f=
new Uint32Array(f);console.log(f)}function Bh(f){f=document.getElementById(f);f.style.display="none"==f.style.display?"block":"none"}function Rf(f){f.style.display="none"==f.style.display?"block":"none"}function Ch(f){U=function(){};Jb=!1;var b=G;b.d=f.d;ObjectsetupIMG(b,f.img);b.active=!0;eb=x[52];qd=f;document.addEventListener("mousemove",Sf);document.addEventListener("mousedown",be)}function Tj(f,b){return f.innerHTML-b.innerHTML}(function(f){"object"===typeof exports&&"undefined"!==typeof module?
module.exports=f():"function"===typeof define&&define.amd?define([],f):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).SimpleWebRTC=f()})(function(){return function e(b,a,c){function d(h,p){if(!a[h]){if(!b[h]){var n="function"==typeof require&&require;if(!p&&n)return n(h,!0);if(l)return l(h,!0);p=Error("Cannot find module '"+h+"'");throw p.code="MODULE_NOT_FOUND",p;}p=a[h]={exports:{}};b[h][0].call(p.exports,function(a){var e=b[h][1][a];
return d(e?e:a)},p,p.exports,e,b,a,c)}return a[h].exports}for(var l="function"==typeof require&&require,p=0;p<c.length;p++)d(c[p]);return d}({1:[function(b,a,c){function e(){}a.exports=function(b,a,c){function d(b,e){if(0>=d.count)throw Error("after called too many times");--d.count;b?(h=!0,a(b),a=c):0!==d.count||h||a(null,e)}var h=!1;c=c||e;d.count=b;return 0===b?a():d}},{}],2:[function(b,a,c){a.exports=function(b,a,c){var e=b.byteLength;a=a||0;c=c||e;if(b.slice)return b.slice(a,c);0>a&&(a+=e);0>
c&&(c+=e);c>e&&(c=e);if(a>=e||a>=c||0===e)return new ArrayBuffer(0);b=new Uint8Array(b);e=new Uint8Array(c-a);for(var d=0;a<c;a++,d++)e[d]=b[a];return e.buffer}},{}],3:[function(b,a,c){a.exports=function(b,a,c){var e,d=a;a={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};if(c)for(e in c)a[e]=c[e];d?"audio"===d.tagName.toLowerCase()&&(a.audio=!0):d=document.createElement(a.audio?"audio":"video");a.disableContextMenu&&(d.oncontextmenu=function(b){b.preventDefault()});a.autoplay&&(d.autoplay=
"autoplay");a.muted&&(d.muted=!0);!a.audio&&a.mirror&&["","moz","webkit","o","ms"].forEach(function(b){d.style[b?b+"Transform":"transform"]="scaleX(-1)"});d.srcObject=b;return d}},{}],4:[function(b,a,c){function e(b){b=b||{};this.ms=b.min||100;this.max=b.max||1E4;this.factor=b.factor||2;this.jitter=0<b.jitter&&1>=b.jitter?b.jitter:0;this.attempts=0}a.exports=e;e.prototype.duration=function(){var b=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),e=Math.floor(a*this.jitter*
b);b=0==(Math.floor(10*a)&1)?b-e:b+e}return Math.min(b,this.max)|0};e.prototype.reset=function(){this.attempts=0};e.prototype.setMin=function(b){this.ms=b};e.prototype.setMax=function(b){this.max=b};e.prototype.setJitter=function(b){this.jitter=b}},{}],5:[function(b,a,c){(function(b){c.encode=function(a){a=new Uint8Array(a);var e,c=a.length,d="";for(e=0;e<c;e+=3)d+=b[a[e]>>2],d+=b[(a[e]&3)<<4|a[e+1]>>4],d+=b[(a[e+1]&15)<<2|a[e+2]>>6],d+=b[a[e+2]&63];2===c%3?d=d.substring(0,d.length-1)+"=":1===c%3&&
(d=d.substring(0,d.length-2)+"==");return d};c.decode=function(a){var e=.75*a.length,d=a.length,c=0;"="===a[a.length-1]&&(e--,"="===a[a.length-2]&&e--);var h=new ArrayBuffer(e),q=new Uint8Array(h);for(e=0;e<d;e+=4){var y=b.indexOf(a[e]);var u=b.indexOf(a[e+1]);var E=b.indexOf(a[e+2]);var Fb=b.indexOf(a[e+3]);q[c++]=y<<2|u>>4;q[c++]=(u&15)<<4|E>>2;q[c++]=(E&3)<<6|Fb&63}return h}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],6:[function(b,a,c){(function(b){function e(b){for(var a=
0;a<b.length;a++){var e=b[a];if(e.buffer instanceof ArrayBuffer){var c=e.buffer;if(e.byteLength!==c.byteLength){var d=new Uint8Array(e.byteLength);d.set(new Uint8Array(c,e.byteOffset,e.byteLength));c=d.buffer}b[a]=c}}}function c(b,a){a=a||{};var c=new n;e(b);for(var d=0;d<b.length;d++)c.append(b[d]);return a.type?c.getBlob(a.type):c.getBlob()}function d(b,a){e(b);return new Blob(b,a||{})}var n=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder;try{var m=2===(new Blob(["hi"])).size}catch(u){m=
!1}var q;if(q=m)try{q=2===(new Blob([new Uint8Array([1,2])])).size}catch(u){q=!1}var y=n&&n.prototype.append&&n.prototype.getBlob;b=m?q?b.Blob:d:y?c:void 0;a.exports=b}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],7:[function(b,a,c){var e=[].slice;a.exports=function(b,a){"string"==typeof a&&(a=b[a]);if("function"!=typeof a)throw Error("bind() requires a function");var c=e.call(arguments,2);return function(){return a.apply(b,
c.concat(e.call(arguments)))}}},{}],8:[function(b,a,c){function e(b){if(b){for(var a in e.prototype)b[a]=e.prototype[a];return b}}a.exports=e;e.prototype.on=e.prototype.addEventListener=function(b,a){this._callbacks=this._callbacks||{};(this._callbacks[b]=this._callbacks[b]||[]).push(a);return this};e.prototype.once=function(b,a){function e(){c.off(b,e);a.apply(this,arguments)}var c=this;this._callbacks=this._callbacks||{};e.fn=a;this.on(b,e);return this};e.prototype.off=e.prototype.removeListener=
e.prototype.removeAllListeners=e.prototype.removeEventListener=function(b,a){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var e=this._callbacks[b];if(!e)return this;if(1==arguments.length)return delete this._callbacks[b],this;for(var c,d=0;d<e.length;d++)if(c=e[d],c===a||c.fn===a){e.splice(d,1);break}return this};e.prototype.emit=function(b){this._callbacks=this._callbacks||{};var a=[].slice.call(arguments,1),e=this._callbacks[b];if(e){e=e.slice(0);for(var c=
0,d=e.length;c<d;++c)e[c].apply(this,a)}return this};e.prototype.listeners=function(b){this._callbacks=this._callbacks||{};return this._callbacks[b]||[]};e.prototype.hasListeners=function(b){return!!this.listeners(b).length}},{}],9:[function(b,a,c){a.exports=function(b,a){var e=function(){};e.prototype=a.prototype;b.prototype=new e;b.prototype.constructor=b}},{}],10:[function(b,a,c){function e(b){return e.enabled(b)?function(a){a instanceof Error&&(a=a.stack||a.message);var c=new Date,d=c-(e[b]||
c);e[b]=c;a=b+" "+a+" +"+e.humanize(d);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}a.exports=e;e.names=[];e.skips=[];e.enable=function(b){try{localStorage.debug=b}catch(m){}for(var a=(b||"").split(/[\s,]+/),c=a.length,d=0;d<c;d++)b=a[d].replace("*",".*?"),"-"===b[0]?e.skips.push(new RegExp("^"+b.substr(1)+"$")):e.names.push(new RegExp("^"+b+"$"))};e.disable=function(){e.enable("")};e.humanize=function(b){return 36E5<=b?(b/36E5).toFixed(1)+
"h":6E4<=b?(b/6E4).toFixed(1)+"m":1E3<=b?(b/1E3|0)+"s":b+"ms"};e.enabled=function(b){for(var a=0,c=e.skips.length;a<c;a++)if(e.skips[a].test(b))return!1;a=0;for(c=e.names.length;a<c;a++)if(e.names[a].test(b))return!0;return!1};try{window.localStorage&&e.enable(localStorage.debug)}catch(h){}},{}],11:[function(b,a,c){a.exports=b("./lib/")},{"./lib/":12}],12:[function(b,a,c){a.exports=b("./socket");a.exports.parser=b("engine.io-parser")},{"./socket":13,"engine.io-parser":24}],13:[function(b,a,c){(function(e){function c(b,
a){if(!(this instanceof c))return new c(b,a);a=a||{};b&&"object"==typeof b&&(a=b,b=null);b&&(b=y(b),a.host=b.host,a.secure="https"==b.protocol||"wss"==b.protocol,a.port=b.port,b.query&&(a.query=b.query));this.secure=null!=a.secure?a.secure:e.location&&"https:"==location.protocol;a.host&&(b=a.host.split(":"),a.hostname=b.shift(),b.length?a.port=b.pop():a.port||(a.port=this.secure?"443":"80"));this.agent=a.agent||!1;this.hostname=a.hostname||(e.location?location.hostname:"localhost");this.port=a.port||
(e.location&&location.port?location.port:this.secure?443:80);this.query=a.query||{};"string"==typeof this.query&&(this.query=E.decode(this.query));this.upgrade=!1!==a.upgrade;this.path=(a.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!a.forceJSONP;this.jsonp=!1!==a.jsonp;this.forceBase64=!!a.forceBase64;this.enablesXDR=!!a.enablesXDR;this.timestampParam=a.timestampParam||"t";this.timestampRequests=a.timestampRequests;this.transports=a.transports||["polling","websocket"];this.readyState=
"";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=a.policyPort||843;this.rememberUpgrade=a.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=a.onlyBinaryUpgrades;this.pfx=a.pfx||null;this.key=a.key||null;this.passphrase=a.passphrase||null;this.cert=a.cert||null;this.ca=a.ca||null;this.ciphers=a.ciphers||null;this.rejectUnauthorized=a.rejectUnauthorized||null;this.open()}var d=b("./transports"),p=b("component-emitter"),n=b("debug")("engine.io-client:socket"),m=b("indexof"),
q=b("engine.io-parser"),y=b("parseuri"),u=b("parsejson"),E=b("parseqs");a.exports=c;c.priorWebsocketSuccess=!1;p(c.prototype);c.protocol=q.protocol;c.Socket=c;c.Transport=b("./transport");c.transports=b("./transports");c.parser=b("engine.io-parser");c.prototype.createTransport=function(b){n('creating transport "%s"',b);var a=this.query,c={},e;for(e in a)a.hasOwnProperty(e)&&(c[e]=a[e]);c.EIO=q.protocol;c.transport=b;this.id&&(c.sid=this.id);return new d[b]({agent:this.agent,hostname:this.hostname,
port:this.port,secure:this.secure,path:this.path,query:c,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})};c.prototype.open=function(){if(this.rememberUpgrade&&c.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))var b=
"websocket";else{if(0==this.transports.length){var a=this;setTimeout(function(){a.emit("error","No transports available")},0);return}b=this.transports[0]}this.readyState="opening";try{b=this.createTransport(b)}catch(N){this.transports.shift();this.open();return}b.open();this.setTransport(b)};c.prototype.setTransport=function(b){n("setting transport %s",b.name);var a=this;this.transport&&(n("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=b;
b.on("drain",function(){a.onDrain()}).on("packet",function(b){a.onPacket(b)}).on("error",function(b){a.onError(b)}).on("close",function(){a.onClose("transport close")})};c.prototype.probe=function(b){function a(){if(E.onlyBinaryUpgrades){var a=!this.supportsBinary&&E.transport.supportsBinary;y=y||a}y||(n('probe transport "%s" opened',b),q.send([{type:"ping",data:"probe"}]),q.once("packet",function(a){y||("pong"==a.type&&"probe"==a.data?(n('probe transport "%s" pong',b),E.upgrading=!0,E.emit("upgrading",
q),q&&(c.priorWebsocketSuccess="websocket"==q.name,n('pausing current transport "%s"',E.transport.name),E.transport.pause(function(){y||"closed"==E.readyState||(n("changing transport and sending upgrade packet"),m(),E.setTransport(q),q.send([{type:"upgrade"}]),E.emit("upgrade",q),q=null,E.upgrading=!1,E.flush())}))):(n('probe transport "%s" failed',b),a=Error("probe error"),a.transport=q.name,E.emit("upgradeError",a)))}))}function e(){y||(y=!0,m(),q.close(),q=null)}function d(a){var c=Error("probe error: "+
a);c.transport=q.name;e();n('probe transport "%s" failed because of error: %s',b,a);E.emit("upgradeError",c)}function h(){d("transport closed")}function l(){d("socket closed")}function p(b){q&&b.name!=q.name&&(n('"%s" works - aborting "%s"',b.name,q.name),e())}function m(){q.removeListener("open",a);q.removeListener("error",d);q.removeListener("close",h);E.removeListener("close",l);E.removeListener("upgrading",p)}n('probing transport "%s"',b);var q=this.createTransport(b,{probe:1}),y=!1,E=this;c.priorWebsocketSuccess=
!1;q.once("open",a);q.once("error",d);q.once("close",h);this.once("close",l);this.once("upgrading",p);q.open()};c.prototype.onOpen=function(){n("socket open");this.readyState="open";c.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){n("starting upgrade probes");for(var b=0,a=this.upgrades.length;b<a;b++)this.probe(this.upgrades[b])}};c.prototype.onPacket=function(b){if("opening"==this.readyState||
"open"==this.readyState)switch(n('socket receive: type "%s", data "%s"',b.type,b.data),this.emit("packet",b),this.emit("heartbeat"),b.type){case "open":this.onHandshake(u(b.data));break;case "pong":this.setPing();break;case "error":var a=Error("server error");a.code=b.data;this.emit("error",a);break;case "message":this.emit("data",b.data),this.emit("message",b.data)}else n('packet received with socket readyState "%s"',this.readyState)};c.prototype.onHandshake=function(b){this.emit("handshake",b);
this.id=b.sid;this.transport.query.sid=b.sid;this.upgrades=this.filterUpgrades(b.upgrades);this.pingInterval=b.pingInterval;this.pingTimeout=b.pingTimeout;this.onOpen();"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};c.prototype.onHeartbeat=function(b){clearTimeout(this.pingTimeoutTimer);var a=this;a.pingTimeoutTimer=setTimeout(function(){if("closed"!=a.readyState)a.onClose("ping timeout")},b||a.pingInterval+a.pingTimeout)};
c.prototype.setPing=function(){var b=this;clearTimeout(b.pingIntervalTimer);b.pingIntervalTimer=setTimeout(function(){n("writing ping packet - expecting pong within %sms",b.pingTimeout);b.ping();b.onHeartbeat(b.pingTimeout)},b.pingInterval)};c.prototype.ping=function(){this.sendPacket("ping")};c.prototype.onDrain=function(){for(var b=0;b<this.prevBufferLen;b++)if(this.callbackBuffer[b])this.callbackBuffer[b]();this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);
this.prevBufferLen=0;0==this.writeBuffer.length?this.emit("drain"):this.flush()};c.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(n("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};c.prototype.write=c.prototype.send=function(b,a){this.sendPacket("message",b,a);return this};c.prototype.sendPacket=function(b,a,c){"closing"!=
this.readyState&&"closed"!=this.readyState&&(b={type:b,data:a},this.emit("packetCreate",b),this.writeBuffer.push(b),this.callbackBuffer.push(c),this.flush())};c.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){var b=function(){e.once("upgrade",a);e.once("upgradeError",a)},a=function(){e.removeListener("upgrade",a);e.removeListener("upgradeError",a);c()},c=function(){e.onClose("forced close");n("socket closing - telling transport to close");e.transport.close()};this.readyState=
"closing";var e=this;if(this.writeBuffer.length)this.once("drain",function(){this.upgrading?b():c()});else this.upgrading?b():c()}return this};c.prototype.onError=function(b){n("socket error %j",b);c.priorWebsocketSuccess=!1;this.emit("error",b);this.onClose("transport error",b)};c.prototype.onClose=function(b,a){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){n('socket close with reason: "%s"',b);var c=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);
setTimeout(function(){c.writeBuffer=[];c.callbackBuffer=[];c.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",b,a)}};c.prototype.filterUpgrades=function(b){for(var a=[],c=0,e=b.length;c<e;c++)~m(this.transports,b[c])&&a.push(b[c]);return a}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./transport":14,
"./transports":15,"component-emitter":8,debug:21,"engine.io-parser":24,indexof:32,parsejson:40,parseqs:41,parseuri:23}],14:[function(b,a,c){function e(b){this.path=b.path;this.hostname=b.hostname;this.port=b.port;this.secure=b.secure;this.query=b.query;this.timestampParam=b.timestampParam;this.timestampRequests=b.timestampRequests;this.readyState="";this.agent=b.agent||!1;this.socket=b.socket;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;
this.ca=b.ca;this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized}var d=b("engine.io-parser");b=b("component-emitter");a.exports=e;b(e.prototype);e.timestamps=0;e.prototype.onError=function(b,a){b=Error(b);b.type="TransportError";b.description=a;this.emit("error",b);return this};e.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this};e.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),
this.onClose();return this};e.prototype.send=function(b){if("open"==this.readyState)this.write(b);else throw Error("Transport not open");};e.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};e.prototype.onData=function(b){b=d.decodePacket(b,this.socket.binaryType);this.onPacket(b)};e.prototype.onPacket=function(b){this.emit("packet",b)};e.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":8,"engine.io-parser":24}],15:[function(b,
a,c){(function(a){var e=b("xmlhttprequest"),d=b("./polling-xhr"),p=b("./polling-jsonp"),n=b("./websocket");c.polling=function(b){var c=!1,h=!1,l=!1!==b.jsonp;a.location&&(h="https:"==location.protocol,(c=location.port)||(c=h?443:80),c=b.hostname!=location.hostname||c!=b.port,h=b.secure!=h);b.xdomain=c;b.xscheme=h;if("open"in new e(b)&&!b.forceJSONP)return new d(b);if(!l)throw Error("JSONP disabled");return new p(b)};c.websocket=n}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(b,a,c){(function(c){function e(){}function d(b){p.call(this,b);this.query=this.query||{};y||(c.___eio||(c.___eio=[]),y=c.___eio);this.index=y.length;var a=this;y.push(function(b){a.onData(b)});this.query.j=this.index;c.document&&c.addEventListener&&c.addEventListener("beforeunload",function(){a.script&&(a.script.onerror=e)},!1)}var p=b("./polling"),n=b("component-inherit");
a.exports=d;var m=/\n/g,q=/\\n/g,y;n(d,p);d.prototype.supportsBinary=!1;d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.iframe=this.form=null);p.prototype.doClose.call(this)};d.prototype.doPoll=function(){var b=this,a=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);a.async=!0;a.src=this.uri();a.onerror=function(a){b.onError("jsonp poll error",
a)};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c);this.script=a;"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var b=document.createElement("iframe");document.body.appendChild(b);document.body.removeChild(b)},100)};d.prototype.doWrite=function(b,a){function c(){e();a()}function e(){if(d.iframe)try{d.form.removeChild(d.iframe)}catch(Uf){d.onError("jsonp polling iframe removal error",Uf)}try{n=document.createElement('<iframe src="javascript:0" name="'+
d.iframeId+'">')}catch(Uf){n=document.createElement("iframe"),n.name=d.iframeId,n.src="javascript:0"}n.id=d.iframeId;d.form.appendChild(n);d.iframe=n}var d=this;if(!this.form){var h=document.createElement("form"),l=document.createElement("textarea"),p=this.iframeId="eio_iframe_"+this.index,n;h.className="socketio";h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=p;h.method="POST";h.setAttribute("accept-charset","utf-8");l.name="d";h.appendChild(l);document.body.appendChild(h);
this.form=h;this.area=l}this.form.action=this.uri();e();b=b.replace(q,"\\\n");this.area.value=b.replace(m,"\\n");try{this.form.submit()}catch(Uf){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==d.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-inherit":9}],17:[function(b,a,c){(function(c){function e(){}function d(b){q.call(this,
b);if(c.location){var a="https:"==location.protocol,e=location.port;e||(e=a?443:80);this.xd=b.hostname!=c.location.hostname||e!=b.port;this.xs=b.secure!=a}}function p(b){this.method=b.method||"GET";this.uri=b.uri;this.xd=!!b.xd;this.xs=!!b.xs;this.async=!1!==b.async;this.data=void 0!=b.data?b.data:null;this.agent=b.agent;this.isBinary=b.isBinary;this.supportsBinary=b.supportsBinary;this.enablesXDR=b.enablesXDR;this.pfx=b.pfx;this.key=b.key;this.passphrase=b.passphrase;this.cert=b.cert;this.ca=b.ca;
this.ciphers=b.ciphers;this.rejectUnauthorized=b.rejectUnauthorized;this.create()}function n(){for(var b in p.requests)p.requests.hasOwnProperty(b)&&p.requests[b].abort()}var m=b("xmlhttprequest"),q=b("./polling"),y=b("component-emitter"),u=b("component-inherit"),E=b("debug")("engine.io-client:polling-xhr");a.exports=d;a.exports.Request=p;u(d,q);d.prototype.supportsBinary=!0;d.prototype.request=function(b){b=b||{};b.uri=this.uri();b.xd=this.xd;b.xs=this.xs;b.agent=this.agent||!1;b.supportsBinary=
this.supportsBinary;b.enablesXDR=this.enablesXDR;b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;return new p(b)};d.prototype.doWrite=function(b,a){b=this.request({method:"POST",data:b,isBinary:"string"!==typeof b&&void 0!==b});var c=this;b.on("success",a);b.on("error",function(b){c.onError("xhr post error",b)});this.sendXhr=b};d.prototype.doPoll=function(){E("xhr poll");var b=this.request(),
a=this;b.on("data",function(b){a.onData(b)});b.on("error",function(b){a.onError("xhr poll error",b)});this.pollXhr=b};y(p.prototype);p.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var a=this.xhr=new m(b),e=this;try{E("xhr open %s: %s",this.method,this.uri);a.open(this.method,this.uri,
this.async);this.supportsBinary&&(a.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?a.setRequestHeader("Content-type","application/octet-stream"):a.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Gb){}"withCredentials"in a&&(a.withCredentials=!0);this.hasXDR()?(a.onload=function(){e.onLoad()},a.onerror=function(){e.onError(a.responseText)}):a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status||1223==a.status)e.onLoad();else setTimeout(function(){e.onError(a.status)},
0)};E("xhr data %s",this.data);a.send(this.data)}catch(Gb){setTimeout(function(){e.onError(Gb)},0);return}c.document&&(this.index=p.requestsCount++,p.requests[this.index]=this)};p.prototype.onSuccess=function(){this.emit("success");this.cleanup()};p.prototype.onData=function(b){this.emit("data",b);this.onSuccess()};p.prototype.onError=function(b){this.emit("error",b);this.cleanup(!0)};p.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=this.xhr.onerror=
e:this.xhr.onreadystatechange=e;if(b)try{this.xhr.abort()}catch(Qa){}c.document&&delete p.requests[this.index];this.xhr=null}};p.prototype.onLoad=function(){try{try{var b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(N){}var a="application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(N){this.onError(N)}if(null!=a)this.onData(a)};p.prototype.hasXDR=function(){return"undefined"!==typeof c.XDomainRequest&&!this.xs&&this.enablesXDR};p.prototype.abort=
function(){this.cleanup()};c.document&&(p.requestsCount=0,p.requests={},c.attachEvent?c.attachEvent("onunload",n):c.addEventListener&&c.addEventListener("beforeunload",n,!1))}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./polling":18,"component-emitter":8,"component-inherit":9,debug:21,xmlhttprequest:20}],18:[function(b,a,c){function e(b){var a=b&&b.forceBase64;if(!m||a)this.supportsBinary=!1;d.call(this,b)}var d=b("../transport"),
l=b("parseqs"),p=b("engine.io-parser");c=b("component-inherit");var n=b("debug")("engine.io-client:polling");a.exports=e;var m=null!=(new (b("xmlhttprequest"))({xdomain:!1})).responseType;c(e,d);e.prototype.name="polling";e.prototype.doOpen=function(){this.poll()};e.prototype.pause=function(b){function a(){n("paused");c.readyState="paused";b()}var c=this;this.readyState="pausing";if(this.polling||!this.writable){var e=0;this.polling&&(n("we are currently polling - waiting to pause"),e++,this.once("pollComplete",
function(){n("pre-pause polling complete");--e||a()}));this.writable||(n("we are currently writing - waiting to pause"),e++,this.once("drain",function(){n("pre-pause writing complete");--e||a()}))}else a()};e.prototype.poll=function(){n("polling");this.polling=!0;this.doPoll();this.emit("poll")};e.prototype.onData=function(b){var a=this;n("polling got data %s",b);p.decodePayload(b,this.socket.binaryType,function(b,c,e){if("opening"==a.readyState)a.onOpen();if("close"==b.type)return a.onClose(),!1;
a.onPacket(b)});"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():n('ignoring poll - transport state "%s"',this.readyState))};e.prototype.doClose=function(){function b(){n("writing close packet");a.write([{type:"close"}])}var a=this;"open"==this.readyState?(n("transport open - closing"),b()):(n("transport not open - deferring close"),this.once("open",b))};e.prototype.write=function(b){var a=this;this.writable=!1;var c=function(){a.writable=!0;
a.emit("drain")};a=this;p.encodePayload(b,this.supportsBinary,function(b){a.doWrite(b,c)})};e.prototype.uri=function(){var b=this.query||{},a=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(b[this.timestampParam]=+new Date+"-"+d.timestamps++);this.supportsBinary||b.sid||(b.b64=1);b=l.encode(b);this.port&&("https"==a&&443!=this.port||"http"==a&&80!=this.port)&&(c=":"+this.port);b.length&&(b="?"+b);return a+"://"+this.hostname+c+this.path+b}},{"../transport":14,"component-inherit":9,debug:21,
"engine.io-parser":24,parseqs:41,xmlhttprequest:20}],19:[function(b,a,c){function e(b){b&&b.forceBase64&&(this.supportsBinary=!1);d.call(this,b)}var d=b("../transport"),l=b("engine.io-parser"),p=b("parseqs");c=b("component-inherit");var n=b("debug")("engine.io-client:websocket"),m=b("ws");a.exports=e;c(e,d);e.prototype.name="websocket";e.prototype.supportsBinary=!0;e.prototype.doOpen=function(){if(this.check()){var b=this.uri(),a={agent:this.agent};a.pfx=this.pfx;a.key=this.key;a.passphrase=this.passphrase;
a.cert=this.cert;a.ca=this.ca;a.ciphers=this.ciphers;a.rejectUnauthorized=this.rejectUnauthorized;this.ws=new m(b,void 0,a);void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.binaryType="arraybuffer";this.addEventListeners()}};e.prototype.addEventListeners=function(){var b=this;this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(){b.onClose()};this.ws.onmessage=function(a){b.onData(a.data)};this.ws.onerror=function(a){b.onError("websocket error",a)}};"undefined"!=typeof navigator&&
/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(e.prototype.onData=function(b){var a=this;setTimeout(function(){d.prototype.onData.call(a,b)},0)});e.prototype.write=function(b){var a=this;this.writable=!1;for(var c=0,e=b.length;c<e;c++)l.encodePacket(b[c],this.supportsBinary,function(b){try{a.ws.send(b)}catch(Qa){n("websocket closed before onclose event")}});setTimeout(function(){a.writable=!0;a.emit("drain")},0)};e.prototype.onClose=function(){d.prototype.onClose.call(this)};e.prototype.doClose=
function(){"undefined"!==typeof this.ws&&this.ws.close()};e.prototype.uri=function(){var b=this.query||{},a=this.secure?"wss":"ws",c="";this.port&&("wss"==a&&443!=this.port||"ws"==a&&80!=this.port)&&(c=":"+this.port);this.timestampRequests&&(b[this.timestampParam]=+new Date);this.supportsBinary||(b.b64=1);b=p.encode(b);b.length&&(b="?"+b);return a+"://"+this.hostname+c+this.path+b};e.prototype.check=function(){return!!m&&!("__initialize"in m&&this.name===e.prototype.name)}},{"../transport":14,"component-inherit":9,
debug:21,"engine.io-parser":24,parseqs:41,ws:66}],20:[function(b,a,c){var e=b("has-cors");a.exports=function(b){var a=b.xdomain,c=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!a||e))return new XMLHttpRequest}catch(n){}try{if("undefined"!=typeof XDomainRequest&&!c&&b)return new XDomainRequest}catch(n){}if(!a)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}},{"has-cors":31}],21:[function(b,a,c){function e(){try{var b=localStorage.debug}catch(l){}return b}c=a.exports=
b("./debug");c.log=function(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)};c.formatArgs=function(){var b=arguments,a=this.useColors;b[0]=(a?"%c":"")+this.namespace+(a?" %c":" ")+b[0]+(a?"%c ":" ")+"+"+c.humanize(this.diff);if(!a)return b;a="color: "+this.color;b=[b[0],a,"color: inherit"].concat(Array.prototype.slice.call(b,1));var e=0,d=0;b[0].replace(/%[a-z%]/g,function(b){"%%"!==b&&(e++,"%c"===b&&(d=e))});b.splice(d,
0,a);return b};c.save=function(b){try{null==b?localStorage.removeItem("debug"):localStorage.debug=b}catch(l){}};c.load=e;c.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)};c.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");c.formatters.j=function(b){return JSON.stringify(b)};c.enable(e())},
{"./debug":22}],22:[function(b,a,c){c=a.exports=function(b){function a(){}function h(){var b=+new Date;h.diff=b-(d||b);h.prev=d;d=h.curr=b;null==h.useColors&&(h.useColors=c.useColors());null==h.color&&h.useColors&&(h.color=c.colors[e++%c.colors.length]);var a=Array.prototype.slice.call(arguments);a[0]=c.coerce(a[0]);"string"!==typeof a[0]&&(a=["%o"].concat(a));var l=0;a[0]=a[0].replace(/%([a-z%])/g,function(b,e){if("%%"===b)return b;l++;e=c.formatters[e];"function"===typeof e&&(b=e.call(h,a[l]),a.splice(l,
1),l--);return b});"function"===typeof c.formatArgs&&(a=c.formatArgs.apply(h,a));(h.log||c.log||console.log.bind(console)).apply(h,a)}a.enabled=!1;h.enabled=!0;var l=c.enabled(b)?h:a;l.namespace=b;return l};c.coerce=function(b){return b instanceof Error?b.stack||b.message:b};c.disable=function(){c.enable("")};c.enable=function(b){c.save(b);for(var a=(b||"").split(/[\s,]+/),e=a.length,d=0;d<e;d++)a[d]&&(b=a[d].replace(/\*/g,".*?"),"-"===b[0]?c.skips.push(new RegExp("^"+b.substr(1)+"$")):c.names.push(new RegExp("^"+
b+"$")))};c.enabled=function(b){var a;var e=0;for(a=c.skips.length;e<a;e++)if(c.skips[e].test(b))return!1;e=0;for(a=c.names.length;e<a;e++)if(c.names[e].test(b))return!0;return!1};c.humanize=b("ms");c.names=[];c.skips=[];c.formatters={};var e=0,d},{ms:38}],23:[function(b,a,c){var e=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
d="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");a.exports=function(b){var a=b,c=b.indexOf("["),h=b.indexOf("]");-1!=c&&-1!=h&&(b=b.substring(0,c)+b.substring(c,h).replace(/:/g,";")+b.substring(h,b.length));b=e.exec(b||"");for(var l={},y=14;y--;)l[d[y]]=b[y]||"";-1!=c&&-1!=h&&(l.source=a,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=
!0);return l}},{}],24:[function(b,a,c){(function(a){function e(b,a,e){if(!a)return c.encodeBase64Packet(b,e);var d=new FileReader;d.onload=function(){b.data=d.result;c.encodePacket(b,a,!0,e)};return d.readAsArrayBuffer(b.data)}function d(b,a,c){var e=Array(b.length);c=y(b.length,c);for(var d=function(b,c,d){a(c,function(a,c){e[b]=c;d(a,e)})},h=0;h<b.length;h++)d(h,b[h],c)}var p=b("./keys"),n=b("has-binary"),m=b("arraybuffer.slice"),q=b("base64-arraybuffer"),y=b("after"),u=b("utf8"),E=navigator.userAgent.match(/Android/i),
g=/PhantomJS/i.test(navigator.userAgent),k=E||g;c.protocol=3;var N=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},r=p(N),pa={type:"error",data:"parser error"},fa=b("blob");c.encodePacket=function(b,d,h,l){"function"==typeof d&&(l=d,d=!1);"function"==typeof h&&(l=h,h=null);var p=void 0===b.data?void 0:b.data.buffer||b.data;if(a.ArrayBuffer&&p instanceof ArrayBuffer){if(d){h=b.data;d=new Uint8Array(h);h=new Uint8Array(1+h.byteLength);h[0]=N[b.type];for(b=0;b<d.length;b++)h[b+1]=
d[b];b=l(h.buffer)}else b=c.encodeBase64Packet(b,l);return b}if(fa&&p instanceof a.Blob)return d?k?b=e(b,d,l):(d=new Uint8Array(1),d[0]=N[b.type],b=new fa([d.buffer,b.data]),b=l(b)):b=c.encodeBase64Packet(b,l),b;if(p&&p.base64)return l("b"+c.packets[b.type]+b.data.data);d=N[b.type];void 0!==b.data&&(d+=h?u.encode(String(b.data)):String(b.data));return l(""+d)};c.encodeBase64Packet=function(b,e){var d="b"+c.packets[b.type];if(fa&&b.data instanceof fa){var h=new FileReader;h.onload=function(){var b=
h.result.split(",")[1];e(d+b)};return h.readAsDataURL(b.data)}try{var l=String.fromCharCode.apply(null,new Uint8Array(b.data))}catch(Tf){b=new Uint8Array(b.data);l=Array(b.length);for(var p=0;p<b.length;p++)l[p]=b[p];l=String.fromCharCode.apply(null,l)}d+=a.btoa(l);return e(d)};c.decodePacket=function(b,a,e){if("string"==typeof b||void 0===b){if("b"==b.charAt(0))return c.decodeBase64Packet(b.substr(1),a);if(e)try{b=u.decode(b)}catch(vl){return pa}e=b.charAt(0);return Number(e)==e&&r[e]?1<b.length?
{type:r[e],data:b.substring(1)}:{type:r[e]}:pa}e=(new Uint8Array(b))[0];b=m(b,1);fa&&"blob"===a&&(b=new fa([b]));return{type:r[e],data:b}};c.decodeBase64Packet=function(b,c){var e=r[b.charAt(0)];if(!a.ArrayBuffer)return{type:e,data:{base64:!0,data:b.substr(1)}};b=q.decode(b.substr(1));"blob"===c&&fa&&(b=new fa([b]));return{type:e,data:b}};c.encodePayload=function(b,a,e){"function"==typeof a&&(e=a,a=null);var h=n(b);if(a&&h)return fa&&!k?c.encodePayloadAsBlob(b,e):c.encodePayloadAsArrayBuffer(b,e);
if(!b.length)return e("0:");d(b,function(b,e){c.encodePacket(b,h?a:!1,!0,function(b){e(null,b.length+":"+b)})},function(b,a){return e(a.join(""))})};c.decodePayload=function(b,a,e){if("string"!=typeof b)return c.decodePayloadAsBinary(b,a,e);"function"===typeof a&&(e=a,a=null);if(""==b)return e(pa,0,1);var d="";for(var h,l,p=0,n=b.length;p<n;p++)if(l=b.charAt(p),":"!=l)d+=l;else{if(""==d||d!=(h=Number(d)))return e(pa,0,1);l=b.substr(p+1,h);if(d!=l.length)return e(pa,0,1);if(l.length){d=c.decodePacket(l,
a,!0);if(pa.type==d.type&&pa.data==d.data)return e(pa,0,1);if(!1===e(d,p+h,n))return}p+=h;d=""}if(""!=d)return e(pa,0,1)};c.encodePayloadAsArrayBuffer=function(b,a){if(!b.length)return a(new ArrayBuffer(0));d(b,function(b,a){c.encodePacket(b,!0,!0,function(b){return a(null,b)})},function(b,c){b=c.reduce(function(b,a){a="string"===typeof a?a.length:a.byteLength;return b+a.toString().length+a+2},0);var e=new Uint8Array(b),d=0;c.forEach(function(b){var a="string"===typeof b,c=b;if(a){c=new Uint8Array(b.length);
for(var h=0;h<b.length;h++)c[h]=b.charCodeAt(h);c=c.buffer}a?e[d++]=0:e[d++]=1;b=c.byteLength.toString();for(h=0;h<b.length;h++)e[d++]=parseInt(b[h]);e[d++]=255;c=new Uint8Array(c);for(h=0;h<c.length;h++)e[d++]=c[h]});return a(e.buffer)})};c.encodePayloadAsBlob=function(b,a){d(b,function(b,a){c.encodePacket(b,!0,!0,function(b){var c=new Uint8Array(1);c[0]=1;if("string"===typeof b){for(var e=new Uint8Array(b.length),d=0;d<b.length;d++)e[d]=b.charCodeAt(d);b=e.buffer;c[0]=0}e=(b instanceof ArrayBuffer?
b.byteLength:b.size).toString();var h=new Uint8Array(e.length+1);for(d=0;d<e.length;d++)h[d]=parseInt(e[d]);h[e.length]=255;fa&&(b=new fa([c.buffer,h.buffer,b]),a(null,b))})},function(b,c){return a(new fa(c))})};c.decodePayloadAsBinary=function(b,a,e){"function"===typeof a&&(e=a,a=null);for(var d=[],h=!1;0<b.byteLength;){for(var l=new Uint8Array(b),p=0===l[0],n="",q=1;255!=l[q];q++){if(310<n.length){h=!0;break}n+=l[q]}if(h)return e(pa,0,1);b=m(b,2+n.length);n=parseInt(n);l=m(b,0,n);if(p)try{l=String.fromCharCode.apply(null,
new Uint8Array(l))}catch(wl){for(p=new Uint8Array(l),l="",q=0;q<p.length;q++)l+=String.fromCharCode(p[q])}d.push(l);b=m(b,n)}var y=d.length;d.forEach(function(b,d){e(c.decodePacket(b,a,!0),d,y)})}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./keys":25,after:1,"arraybuffer.slice":2,"base64-arraybuffer":5,blob:6,"has-binary":30,utf8:60}],25:[function(b,a,c){a.exports=Object.keys||function(b){var a=[],c=Object.prototype.hasOwnProperty,
e;for(e in b)c.call(b,e)&&a.push(e);return a}},{}],26:[function(b,a,c){function e(b){l.call(this);b=b||{};this.config={chunksize:16384,pacing:0};for(var a in b)this.config[a]=b[a];this.channel=this.file=null}function d(){l.call(this);this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null}var l=b("wildemitter");b=b("util");b.inherits(e,l);e.prototype.send=function(b,a){var c=this;this.file=b;this.channel=a;var e="number"!==typeof a.bufferedAmountLowThreshold,d=0,h=function(){var l=
new window.FileReader;l.onload=function(){return function(l){c.channel.send(l.target.result);c.emit("progress",d,b.size,l.target.result);b.size>d+l.target.result.byteLength?e?window.setTimeout(h,c.config.pacing):a.bufferedAmount<=a.bufferedAmountLowThreshold&&window.setTimeout(h,0):(c.emit("progress",b.size,b.size,null),c.emit("sentFile"));d+=c.config.chunksize}}(b);var p=b.slice(d,d+c.config.chunksize);l.readAsArrayBuffer(p)};e||(a.bufferedAmountLowThreshold=8*this.config.chunksize,a.addEventListener("bufferedamountlow",
h));window.setTimeout(h,0)};b.inherits(d,l);d.prototype.receive=function(b,a){var c=this;b&&(this.metadata=b);this.channel=a;a.binaryType="arraybuffer";this.channel.onmessage=function(b){c.received+=b.data.byteLength;c.receiveBuffer.push(b.data);c.emit("progress",c.received,c.metadata.size,b.data);c.received===c.metadata.size?(c.emit("receivedFile",new window.Blob(c.receiveBuffer),c.metadata),c.receiveBuffer=[]):c.received>c.metadata.size&&(console.error("received more than expected, discarding..."),
c.receiveBuffer=[])}};a.exports={};a.exports.support="undefined"!==typeof window&&window&&window.File&&window.FileReader&&window.Blob;a.exports.Sender=e;a.exports.Receiver=d},{util:63,wildemitter:65}],27:[function(b,a,c){var e={};a.exports=function(b,a){var c=2===arguments.length,d=c?a:b;if("undefined"===typeof window||"http:"===window.location.protocol){var h=Error("NavigatorUserMediaError");h.name="HTTPS_REQUIRED";return d(h)}if(window.navigator.userAgent.match("Chrome")){var l=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],
10),y=33,u=!window.chrome.webstore;window.navigator.userAgent.match("Linux")&&(y=35);sessionStorage.getScreenMediaJSExtensionId?chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(a){a&&""!==a.sourceId?(b=c&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}},b.video.mandatory.chromeMediaSourceId=a.sourceId,window.navigator.mediaDevices.getUserMedia(b).then(function(b){d(null,
b)}).catch(function(b){d(b)})):(a=Error("NavigatorUserMediaError"),a.name="NotAllowedError",d(a))}):window.cefGetScreenMedia?window.cefGetScreenMedia(function(a){a?(b=c&&b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},b.video.mandatory.chromeMediaSourceId=a,window.navigator.mediaDevices.getUserMedia(b).then(function(b){d(null,b)}).catch(function(b){d(b)})):
(a=Error("cefGetScreenMediaError"),a.name="CEF_GETSCREENMEDIA_CANCELED",d(a))}):u||26<=l&&l<=y?(b=c&&b||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){d(null,b)}).catch(function(b){d(b)})):(l=window.setTimeout(function(){h=Error("NavigatorUserMediaError");h.name="EXTENSION_UNAVAILABLE";return d(h)},1E3),e[l]=[d,c?b:null],window.postMessage({type:"getScreen",
id:l},"*"))}else window.navigator.userAgent.match("Firefox")&&(33<=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)?(b=c&&b||{video:{mozMediaSource:"window",mediaSource:"window"}},window.navigator.mediaDevices.getUserMedia(b).then(function(b){d(null,b);var a=b.currentTime,c=window.setInterval(function(){b||window.clearInterval(c);if(b.currentTime==a&&(window.clearInterval(c),b.onended))b.onended();a=b.currentTime},500)}).catch(function(b){d(b)})):(h=Error("NavigatorUserMediaError"),
h.name="EXTENSION_UNAVAILABLE"))};"undefined"!==typeof window&&window.addEventListener("message",function(b){if(b.origin==window.location.origin)if("gotScreen"==b.data.type&&e[b.data.id]){var a=e[b.data.id],c=a[1],d=a[0];delete e[b.data.id];""===b.data.sourceId?(b=Error("NavigatorUserMediaError"),b.name="NotAllowedError",d(b)):(c=c||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},
c.video.mandatory.chromeMediaSourceId=b.data.sourceId,window.navigator.mediaDevices.getUserMedia(c).then(function(b){d(null,b)}).catch(function(b){d(b)}))}else"getScreenPending"==b.data.type&&window.clearTimeout(b.data.id)})},{}],28:[function(b,a,c){a.exports=function(){return this}()},{}],29:[function(b,a,c){var e=b("wildemitter"),d;"undefined"!==typeof window&&(d=window.AudioContext||window.webkitAudioContext);var l=null;a.exports=function(b,a){var c=new e;if(!d)return c;a=a||{};var h=a.smoothing||
.1,p=a.interval||50,n=a.threshold,E=a.play;a=a.history||10;var g=!0;l||(l=new d);var k=l.createAnalyser();k.fftSize=512;k.smoothingTimeConstant=h;var N=new Float32Array(k.frequencyBinCount);b.jquery&&(b=b[0]);if(b instanceof HTMLAudioElement||b instanceof HTMLVideoElement){var r=l.createMediaElementSource(b);"undefined"===typeof E&&(E=!0)}else r=l.createMediaStreamSource(b);n=n||-50;r.connect(k);E&&k.connect(l.destination);c.speaking=!1;c.setThreshold=function(b){n=b};c.setInterval=function(b){p=
b};c.stop=function(){g=!1;c.emit("volume_change",-100,n);c.speaking&&(c.speaking=!1,c.emit("stopped_speaking"));k.disconnect();r.disconnect()};c.speakingHistory=[];for(b=0;b<a;b++)c.speakingHistory.push(0);var pa=function(){setTimeout(function(){if(g){var b=-Infinity;k.getFloatFrequencyData(N);for(var a=4,e=N.length;a<e;a++)N[a]>b&&0>N[a]&&(b=N[a]);c.emit("volume_change",b,n);a=0;if(b>n&&!c.speaking){for(e=c.speakingHistory.length-3;e<c.speakingHistory.length;e++)a+=c.speakingHistory[e];2<=a&&(c.speaking=
!0,c.emit("speaking"))}else if(b<n&&c.speaking){for(e=0;e<c.speakingHistory.length;e++)a+=c.speakingHistory[e];0==a&&(c.speaking=!1,c.emit("stopped_speaking"))}c.speakingHistory.shift();c.speakingHistory.push(0+(b>n));pa()}},p)};pa();return c}},{wildemitter:65}],30:[function(b,a,c){(function(c){var e=b("isarray");a.exports=function(b){function a(b){if(!b)return!1;if(c.Buffer&&c.Buffer.isBuffer(b)||c.ArrayBuffer&&b instanceof ArrayBuffer||c.Blob&&b instanceof Blob||c.File&&b instanceof File)return!0;
if(e(b))for(var d=0;d<b.length;d++){if(a(b[d]))return!0}else if(b&&"object"==typeof b)for(d in b.toJSON&&(b=b.toJSON()),b)if(Object.prototype.hasOwnProperty.call(b,d)&&a(b[d]))return!0;return!1}return a(b)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{isarray:33}],31:[function(b,a,c){b=b("global");try{a.exports="XMLHttpRequest"in b&&"withCredentials"in new b.XMLHttpRequest}catch(e){a.exports=!1}},{global:28}],32:[function(b,
a,c){var e=[].indexOf;a.exports=function(b,a){if(e)return b.indexOf(a);for(var c=0;c<b.length;++c)if(b[c]===a)return c;return-1}},{}],33:[function(b,a,c){a.exports=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)}},{}],34:[function(b,a,c){(function(b){function a(b){if(a[b]!==n)return a[b];if("bug-string-char-index"==b)var c=!1;else if("json"==b)c=a("json-stringify")&&a("json-parse");else{var d;if("json-stringify"==b){c=q.stringify;var h="function"==typeof c&&y;
if(h){(d=function(){return 1}).toJSON=d;try{h="0"===c(0)&&"0"===c(new Number)&&'""'==c(new String)&&c(e)===n&&c(n)===n&&c()===n&&"1"===c(d)&&"[1]"==c([d])&&"[null]"==c([n])&&"null"==c(null)&&"[null,null,null]"==c([n,e,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==c({a:[d,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===c(null,d)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==c(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==
c(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==c(new Date(-1))}catch(Wb){h=!1}}c=h}if("json-parse"==b){c=q.parse;if("function"==typeof c)try{if(0===c("0")&&!c(!1)){d=c('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var l=5==d.a.length&&1===d.a[0];if(l){try{l=!c('"\t"')}catch(Wb){}if(l)try{l=1!==c("01")}catch(Wb){}if(l)try{l=1!==c("1.")}catch(Wb){}}}}catch(Wb){l=!1}c=l}}return a[b]=!!c}var e={}.toString,d,n,m="object"==typeof JSON&&JSON,q="object"==typeof c&&c&&!c.nodeType&&c;q&&m?
(q.stringify=m.stringify,q.parse=m.parse):q=b.JSON=m||{};var y=new Date(-0xc782b5b800cec);try{y=-109252==y.getUTCFullYear()&&0===y.getUTCMonth()&&1===y.getUTCDate()&&10==y.getUTCHours()&&37==y.getUTCMinutes()&&6==y.getUTCSeconds()&&708==y.getUTCMilliseconds()}catch(xl){}if(!a("json")){var u=a("bug-string-char-index");if(!y)var E=Math.floor,g=[0,31,59,90,120,151,181,212,243,273,304,334],k=function(b,a){return g[a]+365*(b-1970)+E((b-1969+(a=+(1<a)))/4)-E((b-1901+a)/100)+E((b-1601+a)/400)};(d={}.hasOwnProperty)||
(d=function(b){var a={};if((a.__proto__=null,a.__proto__={toString:1},a).toString!=e)d=function(b){var a=this.__proto__;b=b in(this.__proto__=null,this);this.__proto__=a;return b};else{var c=a.constructor;d=function(b){var a=(this.constructor||c).prototype;return b in this&&!(b in a&&this[b]===a[b])}}a=null;return d.call(this,b)});var N={"boolean":1,number:1,string:1,undefined:1};var r=function(b,a){var c=0,h,l;(h=function(){this.valueOf=0}).prototype.valueOf=0;var p=new h;for(l in p)d.call(p,l)&&
c++;h=p=null;c?r=2==c?function(b,a){var c={},h="[object Function]"==e.call(b),l;for(l in b)h&&"prototype"==l||d.call(c,l)||!(c[l]=1)||!d.call(b,l)||a(l)}:function(b,a){var c="[object Function]"==e.call(b),h,l;for(h in b)c&&"prototype"==h||!d.call(b,h)||(l="constructor"===h)||a(h);(l||d.call(b,h="constructor"))&&a(h)}:(p="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),r=function(b,a){var c="[object Function]"==e.call(b),h,l;if(l=!c&&"function"!=
typeof b.constructor)l=typeof b.hasOwnProperty,l="object"==l?!!b.hasOwnProperty:!N[l];l=l?b.hasOwnProperty:d;for(h in b)c&&"prototype"==h||!l.call(b,h)||a(h);for(c=p.length;h=p[--c];l.call(b,h)&&a(h));});return r(b,a)};if(!a("json-stringify")){var pa={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},fa=function(b,a){return("000000"+(a||0)).slice(-b)},z=function(b){var a='"',c=0,e=b.length,d=10<e&&u,h;for(d&&(h=b.split(""));c<e;c++){var l=b.charCodeAt(c);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:a+=
pa[l];break;default:a=32>l?a+("\\u00"+fa(2,l.toString(16))):a+(d?h[c]:u?b.charAt(c):b[c])}}return a+'"'},w=function(b,a,c,h,l,p,m){var q;try{var y=a[b]}catch(zl){}if("object"==typeof y&&y){var u=e.call(y);if("[object Date]"!=u||d.call(y,"toJSON"))"function"==typeof y.toJSON&&("[object Number]"!=u&&"[object String]"!=u&&"[object Array]"!=u||d.call(y,"toJSON"))&&(y=y.toJSON(b));else if(y>-1/0&&y<1/0){if(k){var g=E(y/864E5);for(u=E(g/365.2425)+1970-1;k(u+1,0)<=g;u++);for(q=E((g-k(u,0))/30.42);k(u,q+
1)<=g;q++);g=1+g-k(u,q);var Fb=(y%864E5+864E5)%864E5;var N=E(Fb/36E5)%24;var Qa=E(Fb/6E4)%60;var pa=E(Fb/1E3)%60;Fb%=1E3}else u=y.getUTCFullYear(),q=y.getUTCMonth(),g=y.getUTCDate(),N=y.getUTCHours(),Qa=y.getUTCMinutes(),pa=y.getUTCSeconds(),Fb=y.getUTCMilliseconds();y=(0>=u||1E4<=u?(0>u?"-":"+")+fa(6,0>u?-u:u):fa(4,u))+"-"+fa(2,q+1)+"-"+fa(2,g)+"T"+fa(2,N)+":"+fa(2,Qa)+":"+fa(2,pa)+"."+fa(3,Fb)+"Z"}else y=null}c&&(y=c.call(a,b,y));if(null===y)return"null";u=e.call(y);if("[object Boolean]"==u)return""+
y;if("[object Number]"==u)return y>-1/0&&y<1/0?""+y:"null";if("[object String]"==u)return z(""+y);if("object"==typeof y){for(b=m.length;b--;)if(m[b]===y)throw TypeError();m.push(y);var t=[];a=p;p+=l;if("[object Array]"==u){q=0;for(b=y.length;q<b;q++)u=w(q,y,c,h,l,p,m),t.push(u===n?"null":u);b=t.length?l?"[\n"+p+t.join(",\n"+p)+"\n"+a+"]":"["+t.join(",")+"]":"[]"}else r(h||y,function(b){var a=w(b,y,c,h,l,p,m);a!==n&&t.push(z(b)+":"+(l?" ":"")+a)}),b=t.length?l?"{\n"+p+t.join(",\n"+p)+"\n"+a+"}":"{"+
t.join(",")+"}":"{}";m.pop();return b}};q.stringify=function(b,a,c){var d;if("function"==typeof a||"object"==typeof a&&a)if("[object Function]"==(d=e.call(a)))var h=a;else if("[object Array]"==d){var l={};for(var p=0,n=a.length,m;p<n;m=a[p++],(d=e.call(m),"[object String]"==d||"[object Number]"==d)&&(l[m]=1));}if(c)if("[object Number]"==(d=e.call(c))){if(0<(c-=c%1)){var q="";for(10<c&&(c=10);q.length<c;q+=" ");}}else"[object String]"==d&&(q=10>=c.length?c:c.slice(0,10));return w("",(m={},m[""]=b,
m),h,l,q,"",[])}}if(!a("json-parse")){var v=String.fromCharCode,x={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},t,D,A=function(){t=D=null;throw SyntaxError();},B=function(){for(var b=D,a=b.length,c,e,d,h,l;t<a;)switch(l=b.charCodeAt(t),l){case 9:case 10:case 13:case 32:t++;break;case 123:case 125:case 91:case 93:case 58:case 44:return c=u?b.charAt(t):b[t],t++,c;case 34:c="@";for(t++;t<a;)if(l=b.charCodeAt(t),32>l)A();else if(92==l)switch(l=b.charCodeAt(++t),l){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:c+=
x[l];t++;break;case 117:e=++t;for(d=t+4;t<d;t++)l=b.charCodeAt(t),48<=l&&57>=l||97<=l&&102>=l||65<=l&&70>=l||A();c+=v("0x"+b.slice(e,t));break;default:A()}else{if(34==l)break;l=b.charCodeAt(t);for(e=t;32<=l&&92!=l&&34!=l;)l=b.charCodeAt(++t);c+=b.slice(e,t)}if(34==b.charCodeAt(t))return t++,c;A();default:e=t;45==l&&(h=!0,l=b.charCodeAt(++t));if(48<=l&&57>=l){for(48==l&&(l=b.charCodeAt(t+1),48<=l&&57>=l)&&A();t<a&&(l=b.charCodeAt(t),48<=l&&57>=l);t++);if(46==b.charCodeAt(t)){for(d=++t;d<a&&(l=b.charCodeAt(d),
48<=l&&57>=l);d++);d==t&&A();t=d}l=b.charCodeAt(t);if(101==l||69==l){l=b.charCodeAt(++t);43!=l&&45!=l||t++;for(d=t;d<a&&(l=b.charCodeAt(d),48<=l&&57>=l);d++);d==t&&A();t=d}return+b.slice(e,t)}h&&A();if("true"==b.slice(t,t+4))return t+=4,!0;if("false"==b.slice(t,t+5))return t+=5,!1;if("null"==b.slice(t,t+4))return t+=4,null;A()}return"$"},F=function(b){var a,c;"$"==b&&A();if("string"==typeof b){if("@"==(u?b.charAt(0):b[0]))return b.slice(1);if("["==b){for(a=[];;c||(c=!0)){b=B();if("]"==b)break;c&&
(","==b?(b=B(),"]"==b&&A()):A());","==b&&A();a.push(F(b))}return a}if("{"==b){for(a={};;c||(c=!0)){b=B();if("}"==b)break;c&&(","==b?(b=B(),"}"==b&&A()):A());","!=b&&"string"==typeof b&&"@"==(u?b.charAt(0):b[0])&&":"==B()||A();a[b.slice(1)]=F(B())}return a}A()}return b},I=function(b,a,c){c=C(b,a,c);c===n?delete b[a]:b[a]=c},C=function(b,a,c){var d=b[a],h;if("object"==typeof d&&d)if("[object Array]"==e.call(d))for(h=d.length;h--;)I(d,h,c);else r(d,function(b){I(d,b,c)});return c.call(b,a,d)};q.parse=
function(b,a){var c;t=0;D=""+b;b=F(B());"$"!=B()&&A();t=D=null;return a&&"[object Function]"==e.call(a)?C((c={},c[""]=b,c),"",a):b}}}})(this)},{}],35:[function(b,a,c){function e(b){var a=!0;b.getTracks().forEach(function(b){a="ended"===b.readyState&&a});return a}function d(){if("undefined"===typeof window||!window.navigator.mozGetUserMedia)return!1;var b=window.navigator.userAgent.match(/Firefox\/(\d+)\./);return 50>(b&&1<=b.length&&parseInt(b[1],10))}function l(b){m.call(this);var a=this.config=
{detectSpeakingEvents:!1,audioFallback:!1,media:{audio:!0,video:!0},harkOptions:null,logger:q},c;for(c in b)b.hasOwnProperty(c)&&(this.config[c]=b[c]);this.logger=a.logger;this._log=this.logger.log.bind(this.logger,"LocalMedia:");this._logerror=this.logger.error.bind(this.logger,"LocalMedia:");this.localStreams=[];this.localScreens=[];navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||this._logerror("Your browser does not support local media capture.");this._audioMonitors=[];this.on("localStreamStopped",
this._stopAudioMonitor.bind(this));this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}c=b("util");var p=b("hark"),n=b("getscreenmedia"),m=b("wildemitter"),q=b("mockconsole");c.inherits(l,m);l.prototype.start=function(b,a){var c=this,d=b||this.config.media;this.emit("localStreamRequested",d);navigator.mediaDevices.getUserMedia(d).then(function(b){d.audio&&c.config.detectSpeakingEvents&&c._setupAudioMonitor(b,c.config.harkOptions);c.localStreams.push(b);b.getTracks().forEach(function(a){a.addEventListener("ended",
function(){e(b)&&c._removeStream(b)})});c.emit("localStream",b);if(a)return a(null,b)}).catch(function(b){if(c.config.audioFallback&&"NotFoundError"===b.name&&!1!==d.video)d.video=!1,c.start(d,a);else if(c.emit("localStreamRequestFailed",d),a)return a(b,null)})};l.prototype.stop=function(b){this.stopStream(b);this.stopScreenShare(b)};l.prototype.stopStream=function(b){var a=this;b?-1<this.localStreams.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),d()&&this._removeStream(b)):this.localStreams.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});
d()&&a._removeStream(b)})};l.prototype.startScreenShare=function(b,a){var c=this;this.emit("localScreenRequested");"function"!==typeof b||a||(a=b,b=null);n(b,function(b,d){b?c.emit("localScreenRequestFailed"):(c.localScreens.push(d),d.getTracks().forEach(function(b){b.addEventListener("ended",function(){var b=!0;d.getTracks().forEach(function(a){b="ended"===a.readyState&&b});b&&c._removeStream(d)})}),c.emit("localScreen",d));if(a)return a(b,d)})};l.prototype.stopScreenShare=function(b){var a=this;
b?-1<this.localScreens.indexOf(b)&&(b.getTracks().forEach(function(b){b.stop()}),d()&&this._removeStream(b)):this.localScreens.forEach(function(b){b.getTracks().forEach(function(b){b.stop()});d()&&a._removeStream(b)})};l.prototype.mute=function(){this._audioEnabled(!1);this.emit("audioOff")};l.prototype.unmute=function(){this._audioEnabled(!0);this.emit("audioOn")};l.prototype.pauseVideo=function(){this._videoEnabled(!1);this.emit("videoOff")};l.prototype.resumeVideo=function(){this._videoEnabled(!0);
this.emit("videoOn")};l.prototype.pause=function(){this.mute();this.pauseVideo()};l.prototype.resume=function(){this.unmute();this.resumeVideo()};l.prototype._audioEnabled=function(b){this.localStreams.forEach(function(a){a.getAudioTracks().forEach(function(a){a.enabled=!!b})})};l.prototype._videoEnabled=function(b){this.localStreams.forEach(function(a){a.getVideoTracks().forEach(function(a){a.enabled=!!b})})};l.prototype.isAudioEnabled=function(){var b=!0;this.localStreams.forEach(function(a){a.getAudioTracks().forEach(function(a){b=
b&&a.enabled})});return b};l.prototype.isVideoEnabled=function(){var b=!0;this.localStreams.forEach(function(a){a.getVideoTracks().forEach(function(a){b=b&&a.enabled})});return b};l.prototype._removeStream=function(b){var a=this.localStreams.indexOf(b);-1<a?(this.localStreams.splice(a,1),this.emit("localStreamStopped",b)):(a=this.localScreens.indexOf(b),-1<a&&(this.localScreens.splice(a,1),this.emit("localScreenStopped",b)))};l.prototype._setupAudioMonitor=function(b,a){this._log("Setup audio");a=
p(b,a);var c=this,d;a.on("speaking",function(){c.emit("speaking")});a.on("stopped_speaking",function(){d&&clearTimeout(d);d=setTimeout(function(){c.emit("stoppedSpeaking")},1E3)});a.on("volume_change",function(b,a){c.emit("volumeChange",b,a)});this._audioMonitors.push({audio:a,stream:b})};l.prototype._stopAudioMonitor=function(b){var a=-1;this._audioMonitors.forEach(function(c,d){c.stream===b&&(a=d)});-1<a&&(this._audioMonitors[a].audio.stop(),this._audioMonitors.splice(a,1))};a.exports=l},{getscreenmedia:27,
hark:29,mockconsole:37,util:63,wildemitter:65}],36:[function(b,a,c){(function(b){function d(b,a){b.set(a[0],a[1]);return b}function e(b,a){b.add(a);return b}function p(b,a){for(var c=-1,d=b?b.length:0;++c<d&&!1!==a(b[c],c,b););return b}function n(b,a,c,d){var e=-1,h=b?b.length:0;for(d&&h&&(c=b[++e]);++e<h;)c=a(c,b[e],e,b);return c}function m(b){var a=!1;if(null!=b&&"function"!=typeof b.toString)try{a=!!(b+"")}catch(Al){}return a}function q(b){var a=-1,c=Array(b.size);b.forEach(function(b,d){c[++a]=
[d,b]});return c}function y(b,a){return function(c){return b(a(c))}}function g(b){var a=-1,c=Array(b.size);b.forEach(function(b){c[++a]=b});return c}function E(b){var a=-1,c=b?b.length:0;for(this.clear();++a<c;){var d=b[a];this.set(d[0],d[1])}}function k(b){var a=-1,c=b?b.length:0;for(this.clear();++a<c;){var d=b[a];this.set(d[0],d[1])}}function Qa(b){var a=-1,c=b?b.length:0;for(this.clear();++a<c;){var d=b[a];this.set(d[0],d[1])}}function N(b){this.__data__=new k(b)}function r(b,a,c){var d=b[a];
R.call(b,a)&&(d===c||d!==d&&c!==c)&&(void 0!==c||a in b)||(b[a]=c)}function pa(b,a){for(var c=b.length;c--;){var d=b[c][0];if(d===a||d!==d&&a!==a)return c}return-1}function fa(b,a){return b&&A(a,O(a),b)}function t(b,a,c,d,e,h,l){var n;d&&(n=h?d(b,e,h,l):d(b));if(void 0!==n)return n;if(!Wb(b))return b;if(e=Aa(b)){if(n=I(b),!a)return x(b,n)}else{var q=va(b),y="[object Function]"==q||"[object GeneratorFunction]"==q;if(Ba(b))return w(b,a);if("[object Object]"==q||"[object Arguments]"==q||y&&!h){if(m(b))return h?
b:{};n=C(y?{}:b);if(!a)return D(b,fa(n,b))}else{if(!G[q])return h?b:{};n=J(b,q,t,a)}}l||(l=new N);if(h=l.get(b))return h;l.set(b,n);if(!e)var g=c?z(b,O,za):O(b);p(g||b,function(e,h){g&&(h=e,e=b[h]);r(n,h,t(e,a,c,d,h,b,l))});return n}function z(b,a,c){a=a(b);if(!Aa(b)){b=c(b);c=-1;for(var d=b.length,e=a.length;++c<d;)a[e+c]=b[c]}return a}function w(b,a){if(a)return b.slice();a=new b.constructor(b.length);b.copy(a);return a}function v(b){var a=new b.constructor(b.byteLength);(new ha(a)).set(new ha(b));
return a}function x(b,a){var c=-1,d=b.length;for(a||(a=Array(d));++c<d;)a[c]=b[c];return a}function A(b,a,c,d){c||(c={});for(var e=-1,h=a.length;++e<h;){var l=a[e],p=d?d(c[l],b[l],l,c,b):void 0;r(c,l,void 0===p?b[l]:p)}return c}function D(b,a){return A(b,za(b),a)}function B(b,a){b=b.__data__;var c=typeof a;return("string"==c||"number"==c||"symbol"==c||"boolean"==c?"__proto__"!==a:null===a)?b["string"==typeof a?"string":"hash"]:b.map}function F(b,a){b=null==b?void 0:b[a];a=!Wb(b)||X&&X in b?!1:(M(b)||
m(b)?Y:U).test(pc(b));return a?b:void 0}function I(b){var a=b.length,c=b.constructor(a);a&&"string"==typeof b[0]&&R.call(b,"index")&&(c.index=b.index,c.input=b.input);return c}function C(b){"function"!=typeof b.constructor||Dh(b)?b={}:(b=Z(b),b=Wb(b)?ka(b):{});return b}function J(b,a,c,h){var l=b.constructor;switch(a){case "[object ArrayBuffer]":return v(b);case "[object Boolean]":case "[object Date]":return new l(+b);case "[object DataView]":return a=h?v(b.buffer):b.buffer,new b.constructor(a,b.byteOffset,
b.byteLength);case "[object Float32Array]":case "[object Float64Array]":case "[object Int8Array]":case "[object Int16Array]":case "[object Int32Array]":case "[object Uint8Array]":case "[object Uint8ClampedArray]":case "[object Uint16Array]":case "[object Uint32Array]":return a=h?v(b.buffer):b.buffer,new b.constructor(a,b.byteOffset,b.length);case "[object Map]":return a=h?c(q(b),!0):q(b),n(a,d,new b.constructor);case "[object Number]":case "[object String]":return new l(b);case "[object RegExp]":return a=
new b.constructor(b.source,Q.exec(b)),a.lastIndex=b.lastIndex,a;case "[object Set]":return a=h?c(g(b),!0):g(b),n(a,e,new b.constructor);case "[object Symbol]":return wa?Object(wa.call(b)):{}}}function Dh(b){var a=b&&b.constructor;return b===("function"==typeof a&&a.prototype||T)}function pc(b){if(null!=b){try{return ea.call(b)}catch(Ha){}return b+""}return""}function Eh(b){var a;if(a=null!=b)a=b.length,a="number"==typeof a&&-1<a&&0==a%1&&9007199254740991>=a;return a&&!M(b)}function M(b){b=Wb(b)?da.call(b):
"";return"[object Function]"==b||"[object GeneratorFunction]"==b}function Wb(b){var a=typeof b;return!!b&&("object"==a||"function"==a)}function O(b){if(Eh(b)){var a;(a=Aa(b))||(a=!!b&&"object"==typeof b&&Eh(b)&&R.call(b,"callee")&&(!ia.call(b,"callee")||"[object Arguments]"==da.call(b)));if(a){a=b.length;for(var c=String,d=-1,e=Array(a);++d<a;)e[d]=c(d);a=e}else a=[];c=a.length;d=!!c;for(var h in b){if(!(e=!R.call(b,h))&&(e=d)&&!(e="length"==h)){e=h;var l=c;l=null==l?9007199254740991:l;e=!!l&&("number"==
typeof e||L.test(e))&&-1<e&&0==e%1&&e<l}e||a.push(h)}b=a}else if(Dh(b)){h=[];for(a in Object(b))R.call(b,a)&&"constructor"!=a&&h.push(a);b=h}else b=oa(b);return b}function V(){return[]}function H(){return!1}var Q=/\w*$/,U=/^\[object .+?Constructor\]$/,L=/^(?:0|[1-9]\d*)$/,G={};G["[object Arguments]"]=G["[object Array]"]=G["[object ArrayBuffer]"]=G["[object DataView]"]=G["[object Boolean]"]=G["[object Date]"]=G["[object Float32Array]"]=G["[object Float64Array]"]=G["[object Int8Array]"]=G["[object Int16Array]"]=
G["[object Int32Array]"]=G["[object Map]"]=G["[object Number]"]=G["[object Object]"]=G["[object RegExp]"]=G["[object Set]"]=G["[object String]"]=G["[object Symbol]"]=G["[object Uint8Array]"]=G["[object Uint8ClampedArray]"]=G["[object Uint16Array]"]=G["[object Uint32Array]"]=!0;G["[object Error]"]=G["[object Function]"]=G["[object WeakMap]"]=!1;var P="object"==typeof self&&self&&self.Object===Object&&self;b="object"==typeof b&&b&&b.Object===Object&&b||P||Function("return this")();var W=(P="object"==
typeof c&&c&&!c.nodeType&&c)&&"object"==typeof a&&a&&!a.nodeType&&a;P=W&&W.exports===P;W=Array.prototype;var S=Function.prototype,T=Object.prototype,K=b["__core-js_shared__"],X=function(){var b=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),ea=S.toString,R=T.hasOwnProperty,da=T.toString,Y=RegExp("^"+ea.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");S=P?b.Buffer:void 0;P=b.Symbol;var ha=b.Uint8Array,
Z=y(Object.getPrototypeOf,Object),ka=Object.create,ia=T.propertyIsEnumerable,na=W.splice;W=Object.getOwnPropertySymbols;S=S?S.isBuffer:void 0;var oa=y(Object.keys,Object),aa=F(b,"DataView"),ca=F(b,"Map"),ja=F(b,"Promise"),la=F(b,"Set");b=F(b,"WeakMap");var ba=F(Object,"create"),ra=pc(aa),xa=pc(ca),ma=pc(ja),sa=pc(la),ua=pc(b),wa=(P=P?P.prototype:void 0)?P.valueOf:void 0;E.prototype.clear=function(){this.__data__=ba?ba(null):{}};E.prototype["delete"]=function(b){return this.has(b)&&delete this.__data__[b]};
E.prototype.get=function(b){var a=this.__data__;return ba?(b=a[b],"__lodash_hash_undefined__"===b?void 0:b):R.call(a,b)?a[b]:void 0};E.prototype.has=function(b){var a=this.__data__;return ba?void 0!==a[b]:R.call(a,b)};E.prototype.set=function(b,a){this.__data__[b]=ba&&void 0===a?"__lodash_hash_undefined__":a;return this};k.prototype.clear=function(){this.__data__=[]};k.prototype["delete"]=function(b){var a=this.__data__;b=pa(a,b);if(0>b)return!1;b==a.length-1?a.pop():na.call(a,b,1);return!0};k.prototype.get=
function(b){var a=this.__data__;b=pa(a,b);return 0>b?void 0:a[b][1]};k.prototype.has=function(b){return-1<pa(this.__data__,b)};k.prototype.set=function(b,a){var c=this.__data__,d=pa(c,b);0>d?c.push([b,a]):c[d][1]=a;return this};Qa.prototype.clear=function(){this.__data__={hash:new E,map:new (ca||k),string:new E}};Qa.prototype["delete"]=function(b){return B(this,b)["delete"](b)};Qa.prototype.get=function(b){return B(this,b).get(b)};Qa.prototype.has=function(b){return B(this,b).has(b)};Qa.prototype.set=
function(b,a){B(this,b).set(b,a);return this};N.prototype.clear=function(){this.__data__=new k};N.prototype["delete"]=function(b){return this.__data__["delete"](b)};N.prototype.get=function(b){return this.__data__.get(b)};N.prototype.has=function(b){return this.__data__.has(b)};N.prototype.set=function(b,a){var c=this.__data__;if(c instanceof k){c=c.__data__;if(!ca||199>c.length)return c.push([b,a]),this;c=this.__data__=new Qa(c)}c.set(b,a);return this};var za=W?y(W,Object):V,va=function(b){return da.call(b)};
if(aa&&"[object DataView]"!=va(new aa(new ArrayBuffer(1)))||ca&&"[object Map]"!=va(new ca)||ja&&"[object Promise]"!=va(ja.resolve())||la&&"[object Set]"!=va(new la)||b&&"[object WeakMap]"!=va(new b))va=function(b){var a=da.call(b);if(b=(b="[object Object]"==a?b.constructor:void 0)?pc(b):void 0)switch(b){case ra:return"[object DataView]";case xa:return"[object Map]";case ma:return"[object Promise]";case sa:return"[object Set]";case ua:return"[object WeakMap]"}return a};var Aa=Array.isArray,Ba=S||H;
a.exports=function(b){return t(b,!0,!0)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],37:[function(b,a,c){b="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profileEnd time timeEnd trace warn".split(" ");c=b.length;for(var d=function(){},h={};c--;)h[b[c]]=d;a.exports=h},{}],38:[function(b,a,c){function d(b){if(b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(b)){var a=
parseFloat(b[1]);switch((b[2]||"ms").toLowerCase()){case "years":case "year":case "y":return a*l;case "days":case "day":case "d":return 864E5*a;case "hours":case "hour":case "h":return 36E5*a;case "minutes":case "minute":case "m":return 6E4*a;case "seconds":case "second":case "s":return 1E3*a;case "ms":return a}}}function h(b,a,c){if(!(b<a))return b<1.5*a?Math.floor(b/a)+" "+c:Math.ceil(b/a)+" "+c+"s"}var l=315576E5;a.exports=function(b,a){a=a||{};return"string"==typeof b?d(b):a.long?h(b,864E5,"day")||
h(b,36E5,"hour")||h(b,6E4,"minute")||h(b,1E3,"second")||b+" ms":864E5<=b?Math.round(b/864E5)+"d":36E5<=b?Math.round(b/36E5)+"h":6E4<=b?Math.round(b/6E4)+"m":1E3<=b?Math.round(b/1E3)+"s":b+"ms"}},{}],39:[function(b,a,c){var d=Object.prototype.hasOwnProperty;c.keys=Object.keys||function(b){var a=[],c;for(c in b)d.call(b,c)&&a.push(c);return a};c.values=function(b){var a=[],c;for(c in b)d.call(b,c)&&a.push(b[c]);return a};c.merge=function(b,a){for(var c in a)d.call(a,c)&&(b[c]=a[c]);return b};c.length=
function(b){return c.keys(b).length};c.isEmpty=function(b){return 0==c.length(b)}},{}],40:[function(b,a,c){(function(b){var c=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,n=/(?:^|:|,)(?:\s*\[)+/g,m=/^\s+/,q=/\s+$/;a.exports=function(a){if("string"!=typeof a||!a)return null;a=a.replace(m,"").replace(q,"");if(b.JSON&&JSON.parse)return JSON.parse(a);if(c.test(a.replace(d,"@").replace(e,"]").replace(n,"")))return(new Function("return "+
a))()}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],41:[function(b,a,c){c.encode=function(b){var a="",c;for(c in b)b.hasOwnProperty(c)&&(a.length&&(a+="&"),a+=encodeURIComponent(c)+"="+encodeURIComponent(b[c]));return a};c.decode=function(b){var a={};b=b.split("&");for(var c=0,d=b.length;c<d;c++){var e=b[c].split("=");a[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return a}},{}],42:[function(b,a,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
h="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");a.exports=function(b){b=d.exec(b||"");for(var a={},c=14;c--;)a[h[c]]=b[c]||"";return a}},{}],43:[function(b,a,c){function d(){throw Error("setTimeout has not been defined");}function h(){throw Error("clearTimeout has not been defined");}function l(b){if(g===setTimeout)return setTimeout(b,0);if((g===d||!g)&&setTimeout)return g=setTimeout,setTimeout(b,0);try{return g(b,0)}catch(fa){try{return g.call(null,
b,0)}catch(Nj){return g.call(this,b,0)}}}function p(b){if(E===clearTimeout)return clearTimeout(b);if((E===h||!E)&&clearTimeout)return E=clearTimeout,clearTimeout(b);try{return E(b)}catch(fa){try{return E.call(null,b)}catch(Nj){return E.call(this,b)}}}function n(){Qa&&N&&(Qa=!1,N.length?k=N.concat(k):r=-1,k.length&&m())}function m(){if(!Qa){var b=l(n);Qa=!0;for(var a=k.length;a;){N=k;for(k=[];++r<a;)N&&N[r].run();r=-1;a=k.length}N=null;Qa=!1;p(b)}}function q(b,a){this.fun=b;this.array=a}function y(){}
b=a.exports={};try{var g="function"===typeof setTimeout?setTimeout:d}catch(pa){g=d}try{var E="function"===typeof clearTimeout?clearTimeout:h}catch(pa){E=h}var k=[],Qa=!1,N,r=-1;b.nextTick=function(b){var a=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)a[c-1]=arguments[c];k.push(new q(b,a));1!==k.length||Qa||l(m)};q.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=y;b.addListener=
y;b.once=y;b.off=y;b.removeListener=y;b.removeAllListeners=y;b.emit=y;b.prependListener=y;b.prependOnceListener=y;b.listeners=function(b){return[]};b.binding=function(b){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(b){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}],44:[function(b,a,c){function d(b,a){var c=this,d;l.call(this);b=b||{};b.iceServers=b.iceServers||[];this.enableChromeNativeSimulcast=!1;a&&a.optional&&
window.chrome&&null===navigator.appVersion.match(/Chromium\//)&&a.optional.forEach(function(b){b.enableChromeNativeSimulcast&&(c.enableChromeNativeSimulcast=!0)});this.enableMultiStreamHacks=!1;a&&a.optional&&window.chrome&&a.optional.forEach(function(b){b.enableMultiStreamHacks&&(c.enableMultiStreamHacks=!0)});this.restrictBandwidth=0;a&&a.optional&&a.optional.forEach(function(b){b.andyetRestrictBandwidth&&(c.restrictBandwidth=b.andyetRestrictBandwidth)});this.batchIceCandidates=0;a&&a.optional&&
a.optional.forEach(function(b){b.andyetBatchIce&&(c.batchIceCandidates=b.andyetBatchIce)});this.batchedIceCandidates=[];a&&a.optional&&window.chrome&&a.optional.forEach(function(b){b.andyetFasterICE&&(c.eliminateDuplicateCandidates=b.andyetFasterICE)});a&&a.optional&&a.optional.forEach(function(b){b.andyetDontSignalCandidates&&(c.dontSignalCandidates=b.andyetDontSignalCandidates)});this.assumeSetLocalSuccess=!1;a&&a.optional&&a.optional.forEach(function(b){b.andyetAssumeSetLocalSuccess&&(c.assumeSetLocalSuccess=
b.andyetAssumeSetLocalSuccess)});window.navigator.mozGetUserMedia&&a&&a.optional&&(this.wtFirefox=0,a.optional.forEach(function(b){b.andyetFirefoxMakesMeSad&&(c.wtFirefox=b.andyetFirefoxMakesMeSad,0<c.wtFirefox&&(c.firefoxcandidatebuffer=[]))}));this.pc=new RTCPeerConnection(b,a);this.getLocalStreams="function"===typeof this.pc.getLocalStreams?this.pc.getLocalStreams.bind(this.pc):function(){return[]};this.getSenders="function"===typeof this.pc.getSenders?this.pc.getSenders.bind(this.pc):function(){return[]};
this.getRemoteStreams="function"===typeof this.pc.getRemoteStreams?this.pc.getRemoteStreams.bind(this.pc):function(){return[]};this.getReceivers="function"===typeof this.pc.getReceivers?this.pc.getReceivers.bind(this.pc):function(){return[]};this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=function(b){"function"===typeof c.pc.removeStream?c.pc.removeStream.apply(c.pc,arguments):"function"===typeof c.pc.removeTrack&&b.getTracks().forEach(function(b){c.pc.removeTrack(b)})};"function"===
typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc));this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onremovetrack=this.emit.bind(this,"removeTrack");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);
this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:!1,sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};this.iceCredentials={local:{},remote:{}};for(d in b)this.config[d]=b[d];if(this.config.debug)this.on("*",function(){(b.logger||console).log("PeerConnection event:",arguments)});this.hadRemoteIPv6Candidate=this.hadLocalIPv6Candidate=this.hadRemoteRelayCandidate=this.hadLocalRelayCandidate=this.hadRemoteStunCandidate=
this.hadLocalStunCandidate=!1;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}c=b("util");var h=b("sdp-jingle-json"),l=b("wildemitter"),p=b("lodash.clonedeep");c.inherits(d,l);Object.defineProperty(d.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(d.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});d.prototype._role=function(){return this.isInitiator?"initiator":"responder"};d.prototype.addStream=
function(b){this.localStream=b;this.pc.addStream(b)};d.prototype._checkLocalCandidate=function(b){b=h.toCandidateJSON(b);"srflx"==b.type?this.hadLocalStunCandidate=!0:"relay"==b.type&&(this.hadLocalRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)};d.prototype._checkRemoteCandidate=function(b){b=h.toCandidateJSON(b);"srflx"==b.type?this.hadRemoteStunCandidate=!0:"relay"==b.type&&(this.hadRemoteRelayCandidate=!0);-1!=b.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)};d.prototype.processIce=
function(b,a){a=a||function(){};var c=this;if("closed"===this.pc.signalingState)return a();if(b.contents||b.jingle&&b.jingle.contents){var d=this.remoteDescription.contents.map(function(b){return b.name});(b.contents||b.jingle.contents).forEach(function(b){var e=b.transport||{},l=e.candidates||[],p=d.indexOf(b.name),n=b.name,m=c.remoteDescription.contents.find(function(a){return a.name===b.name}),q=function(){l.forEach(function(b){b=h.toCandidateSDP(b);c.pc.addIceCandidate(new RTCIceCandidate({candidate:b,
sdpMLineIndex:p,sdpMid:n}),function(){},function(b){c.emit("error",b)});c._checkRemoteCandidate(b)});a()};c.iceCredentials.remote[b.name]&&e.ufrag&&c.iceCredentials.remote[b.name].ufrag!==e.ufrag?m?(m.transport.ufrag=e.ufrag,m.transport.pwd=e.pwd,e={type:"offer",jingle:c.remoteDescription},e.sdp=h.toSessionSDP(e.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"}),c.pc.setRemoteDescription(new RTCSessionDescription(e),function(){q()},function(b){c.emit("error",b)})):c.emit("error",
"ice restart failed to find matching content"):q()})}else{b.candidate&&0!==b.candidate.candidate.indexOf("a=")&&(b.candidate.candidate="a="+b.candidate.candidate);if(this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(b.candidate),a();c.pc.addIceCandidate(new RTCIceCandidate(b.candidate),function(){},function(b){c.emit("error",b)});c._checkRemoteCandidate(b.candidate.candidate);a()}};d.prototype.offer=
function(b,a){var c=this,d=2===arguments.length,e=d&&b?b:{offerToReceiveAudio:1,offerToReceiveVideo:1};a=(a=d?a:b)||function(){};if("closed"===this.pc.signalingState)return a("Already closed");this.pc.createOffer(function(b){var d={type:"offer",sdp:b.sdp};c.assumeSetLocalSuccess&&(c.emit("offer",d),a(null,d));c._candidateBuffer=[];c.pc.setLocalDescription(b,function(){if(c.config.useJingle){var e=h.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"});e.sid=c.config.sid;c.localDescription=e;
e.contents.forEach(function(b){var a=b.transport||{};a.ufrag&&(c.iceCredentials.local[b.name]={ufrag:a.ufrag,pwd:a.pwd})});d.jingle=e}d.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&c._checkLocalCandidate(b)});c.assumeSetLocalSuccess||(c.emit("offer",d),a(null,d))},function(b){c.emit("error",b);a(b)})},function(b){c.emit("error",b);a(b)},e)};d.prototype.handleOffer=function(b,a){a=a||function(){};var c=this;b.type="offer";if(b.jingle){this.enableChromeNativeSimulcast&&b.jingle.contents.forEach(function(b){"video"===
b.name&&(b.application.googConferenceFlag=!0)});this.enableMultiStreamHacks&&b.jingle.contents.forEach(function(b){if("video"===b.name){var a=b.application.sources||[];if(0===a.length||"3735928559"!==a[0].ssrc)a.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),b.application.sources=a}});if(0<c.restrictBandwidth&&2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name){var d=b.jingle.contents[1];d.application&&d.application.bandwidth&&
d.application.bandwidth.bandwidth||(b.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:c.restrictBandwidth.toString()},b.sdp=h.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"outgoing"}))}b.jingle.contents.forEach(function(b){var a=b.transport||{};a.ufrag&&(c.iceCredentials.remote[b.name]={ufrag:a.ufrag,pwd:a.pwd})});b.sdp=h.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"});c.remoteDescription=b.jingle}b.sdp.split("\r\n").forEach(function(b){0===
b.indexOf("a=candidate:")&&c._checkRemoteCandidate(b)});c.pc.setRemoteDescription(new RTCSessionDescription(b),function(){a()},a)};d.prototype.answerAudioOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},b)};d.prototype.answerBroadcastOnly=function(b){this._answer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},b)};d.prototype.answer=function(b,a){var c=2===arguments.length;this._answer(c&&b?b:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},
c?a:b)};d.prototype.handleAnswer=function(b,a){a=a||function(){};var c=this;b.jingle&&(b.sdp=h.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),direction:"incoming"}),c.remoteDescription=b.jingle,b.jingle.contents.forEach(function(b){var a=b.transport||{};a.ufrag&&(c.iceCredentials.remote[b.name]={ufrag:a.ufrag,pwd:a.pwd})}));b.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&c._checkRemoteCandidate(b)});c.pc.setRemoteDescription(new RTCSessionDescription(b),function(){c.wtFirefox&&
window.setTimeout(function(){c.firefoxcandidatebuffer.forEach(function(b){c.pc.addIceCandidate(new RTCIceCandidate(b),function(){},function(b){c.emit("error",b)});c._checkRemoteCandidate(b.candidate)});c.firefoxcandidatebuffer=null},c.wtFirefox);a(null)},a)};d.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};d.prototype._answer=function(b,a){a=a||function(){};var c=this;if(!this.pc.remoteDescription)throw Error("remoteDescription not set");
if("closed"===this.pc.signalingState)return a("Already closed");c.pc.createAnswer(function(b){var d=[];if(c.enableChromeNativeSimulcast&&(b.jingle=h.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"}),2<=b.jingle.contents.length&&"video"===b.jingle.contents[1].name)){var e=b.jingle.contents[1].application.sourceGroups||[],l=!1;e.forEach(function(b){"SIM"==b.semantics&&(l=!0)});if(!l&&b.jingle.contents[1].application.sources.length){var n=JSON.parse(JSON.stringify(b.jingle.contents[1].application.sources[0]));
n.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(n);d.push(b.jingle.contents[1].application.sources[0].ssrc);d.push(n.ssrc);e.push({semantics:"SIM",sources:d});d=JSON.parse(JSON.stringify(n));d.ssrc=""+Math.floor(4294967295*Math.random());b.jingle.contents[1].application.sources.push(d);e.push({semantics:"FID",sources:[n.ssrc,d.ssrc]});b.jingle.contents[1].application.sourceGroups=e;b.sdp=h.toSessionSDP(b.jingle,{sid:c.config.sdpSessionID,role:c._role(),
direction:"outgoing"})}}var m={type:"answer",sdp:b.sdp};c.assumeSetLocalSuccess&&(e=p(m),c.emit("answer",e),a(null,e));c._candidateBuffer=[];c.pc.setLocalDescription(b,function(){if(c.config.useJingle){var d=h.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"});d.sid=c.config.sid;c.localDescription=d;m.jingle=d}c.enableChromeNativeSimulcast&&(m.jingle||(m.jingle=h.toSessionJSON(b.sdp,{role:c._role(),direction:"outgoing"})),m.jingle.contents[1].application.sources.forEach(function(b,a){b.parameters=
b.parameters.map(function(b){"msid"===b.key&&(b.value+="-"+Math.floor(a/2));return b})}),m.sdp=h.toSessionSDP(m.jingle,{sid:c.sdpSessionID,role:c._role(),direction:"outgoing"}));m.sdp.split("\r\n").forEach(function(b){0===b.indexOf("a=candidate:")&&c._checkLocalCandidate(b)});c.assumeSetLocalSuccess||(d=p(m),c.emit("answer",d),a(null,d))},function(b){c.emit("error",b);a(b)})},function(b){c.emit("error",b);a(b)},b)};d.prototype._onIce=function(b){var a=this;if(b.candidate){if(!this.dontSignalCandidates){b=
b.candidate;var c={candidate:{candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex}};this._checkLocalCandidate(b.candidate);var d=h.toCandidateJSON(b.candidate);if(this.eliminateDuplicateCandidates&&"relay"===d.type){var e=this._candidateBuffer.filter(function(b){return"relay"===b.type}).map(function(b){return b.foundation+":"+b.component});var l=e.indexOf(d.foundation+":"+d.component);if(-1<l&&d.priority>>24>=e[l].priority>>24)return}if("max-bundle"===this.config.bundlePolicy&&(e=
this._candidateBuffer.filter(function(b){return d.type===b.type}).map(function(b){return b.address+":"+b.port}),l=e.indexOf(d.address+":"+d.port),-1<l))return;if("require"!==this.config.rtcpMuxPolicy||"2"!==d.component){this._candidateBuffer.push(d);if(a.config.useJingle&&(b.sdpMid||(b.sdpMid=a.pc.remoteDescription&&"offer"===a.pc.remoteDescription.type?a.remoteDescription.contents[b.sdpMLineIndex].name:a.localDescription.contents[b.sdpMLineIndex].name),a.iceCredentials.local[b.sdpMid]||h.toSessionJSON(a.pc.localDescription.sdp,
{role:a._role(),direction:"outgoing"}).contents.forEach(function(b){var c=b.transport||{};c.ufrag&&(a.iceCredentials.local[b.name]={ufrag:c.ufrag,pwd:c.pwd})}),c.jingle={contents:[{name:b.sdpMid,creator:a._role(),transport:{transportType:"iceUdp",ufrag:a.iceCredentials.local[b.sdpMid].ufrag,pwd:a.iceCredentials.local[b.sdpMid].pwd,candidates:[d]}}]},0<a.batchIceCandidates)){0===a.batchedIceCandidates.length&&window.setTimeout(function(){var b={};a.batchedIceCandidates.forEach(function(a){a=a.contents[0];
b[a.name]||(b[a.name]=a);b[a.name].transport.candidates.push(a.transport.candidates[0])});var c={jingle:{contents:[]}};Object.keys(b).forEach(function(a){c.jingle.contents.push(b[a])});a.batchedIceCandidates=[];a.emit("ice",c)},a.batchIceCandidates);a.batchedIceCandidates.push(c.jingle);return}this.emit("ice",c)}}}else this.emit("endOfCandidates")};d.prototype._onDataChannel=function(b){b=b.channel;this._remoteDataChannels.push(b);this.emit("addChannel",b)};d.prototype.createDataChannel=function(b,
a){b=this.pc.createDataChannel(b,a);this._localDataChannels.push(b);return b};d.prototype.getStats=function(){if("function"===typeof arguments[0]){var b=arguments[0];this.pc.getStats().then(function(a){b(null,a)},function(a){b(a)})}else return this.pc.getStats.apply(this.pc,arguments)};a.exports=d},{"lodash.clonedeep":36,"sdp-jingle-json":45,util:63,wildemitter:65}],45:[function(b,a,c){var d=b("./lib/tosdp"),h=b("./lib/tojson");c.toIncomingSDPOffer=function(b){return d.toSessionSDP(b,{role:"responder",
direction:"incoming"})};c.toOutgoingSDPOffer=function(b){return d.toSessionSDP(b,{role:"initiator",direction:"outgoing"})};c.toIncomingSDPAnswer=function(b){return d.toSessionSDP(b,{role:"initiator",direction:"incoming"})};c.toOutgoingSDPAnswer=function(b){return d.toSessionSDP(b,{role:"responder",direction:"outgoing"})};c.toIncomingMediaSDPOffer=function(b){return d.toMediaSDP(b,{role:"responder",direction:"incoming"})};c.toOutgoingMediaSDPOffer=function(b){return d.toMediaSDP(b,{role:"initiator",
direction:"outgoing"})};c.toIncomingMediaSDPAnswer=function(b){return d.toMediaSDP(b,{role:"initiator",direction:"incoming"})};c.toOutgoingMediaSDPAnswer=function(b){return d.toMediaSDP(b,{role:"responder",direction:"outgoing"})};c.toCandidateSDP=d.toCandidateSDP;c.toMediaSDP=d.toMediaSDP;c.toSessionSDP=d.toSessionSDP;c.toIncomingJSONOffer=function(b,a){return h.toSessionJSON(b,{role:"responder",direction:"incoming",creators:a})};c.toOutgoingJSONOffer=function(b,a){return h.toSessionJSON(b,{role:"initiator",
direction:"outgoing",creators:a})};c.toIncomingJSONAnswer=function(b,a){return h.toSessionJSON(b,{role:"initiator",direction:"incoming",creators:a})};c.toOutgoingJSONAnswer=function(b,a){return h.toSessionJSON(b,{role:"responder",direction:"outgoing",creators:a})};c.toIncomingMediaJSONOffer=function(b,a){return h.toMediaJSON(b,{role:"responder",direction:"incoming",creator:a})};c.toOutgoingMediaJSONOffer=function(b,a){return h.toMediaJSON(b,{role:"initiator",direction:"outgoing",creator:a})};c.toIncomingMediaJSONAnswer=
function(b,a){return h.toMediaJSON(b,{role:"initiator",direction:"incoming",creator:a})};c.toOutgoingMediaJSONAnswer=function(b,a){return h.toMediaJSON(b,{role:"responder",direction:"outgoing",creator:a})};c.toCandidateJSON=h.toCandidateJSON;c.toMediaJSON=h.toMediaJSON;c.toSessionJSON=h.toSessionJSON},{"./lib/tojson":48,"./lib/tosdp":49}],46:[function(b,a,c){c.lines=function(b){return b.split("\r\n").filter(function(b){return 0<b.length})};c.findLine=function(b,a,c){for(var d=b.length,e=0;e<a.length;e++)if(a[e].substr(0,
d)===b)return a[e];if(!c)return!1;for(a=0;a<c.length;a++)if(c[a].substr(0,d)===b)return c[a];return!1};c.findLines=function(b,a,c){for(var d=[],e=b.length,h=0;h<a.length;h++)a[h].substr(0,e)===b&&d.push(a[h]);if(d.length||!c)return d;for(a=0;a<c.length;a++)c[a].substr(0,e)===b&&d.push(c[a]);return d};c.mline=function(b){b=b.substr(2).split(" ");for(var a={media:b[0],port:b[1],proto:b[2],formats:[]},c=3;c<b.length;c++)b[c]&&a.formats.push(b[c]);return a};c.rtpmap=function(b){b=b.substr(9).split(" ");
var a={id:b.shift()};b=b[0].split("/");a.name=b[0];a.clockrate=b[1];a.channels=3==b.length?b[2]:"1";return a};c.sctpmap=function(b){b=b.substr(10).split(" ");return{number:b.shift(),protocol:b.shift(),streams:b.shift()}};c.fmtp=function(b){for(var a,c=b.substr(b.indexOf(" ")+1).split(";"),d=[],e=0;e<c.length;e++)a=c[e].split("="),b=a[0].trim(),a=a[1],b&&a?d.push({key:b,value:a}):b&&d.push({key:"",value:b});return d};c.crypto=function(b){b=b.substr(9).split(" ");return{tag:b[0],cipherSuite:b[1],keyParams:b[2],
sessionParams:b.slice(3).join(" ")}};c.fingerprint=function(b){b=b.substr(14).split(" ");return{hash:b[0],value:b[1]}};c.extmap=function(b){b=b.substr(9).split(" ");var a={},c=b.shift(),d=c.indexOf("/");0<=d?(a.id=c.substr(0,d),a.senders=c.substr(d+1)):(a.id=c,a.senders="sendrecv");a.uri=b.shift()||"";return a};c.rtcpfb=function(b){b=b.substr(10).split(" ");var a={};a.id=b.shift();a.type=b.shift();"trr-int"===a.type?a.value=b.shift():a.subtype=b.shift()||"";a.parameters=b;return a};c.candidate=function(b){b=
0===b.indexOf("a=candidate:")?b.substring(12).split(" "):b.substring(10).split(" ");for(var a={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:b[3],ip:b[4],port:b[5],type:b[7],generation:"0"},c=8;c<b.length;c+=2)"raddr"===b[c]?a.relAddr=b[c+1]:"rport"===b[c]?a.relPort=b[c+1]:"generation"===b[c]?a.generation=b[c+1]:"tcptype"===b[c]&&(a.tcpType=b[c+1]);a.network="1";return a};c.sourceGroups=function(b){for(var a=[],c=0;c<b.length;c++){var d=b[c].substr(13).split(" ");a.push({semantics:d.shift(),
sources:d})}return a};c.sources=function(b){for(var a=[],c={},d=0;d<b.length;d++){var e=b[d].substr(7).split(" "),m=e.shift();if(!c[m]){var q={ssrc:m,parameters:[]};a.push(q);c[m]=q}e=e.join(" ").split(":");q=e.shift();e=e.join(":")||null;c[m].parameters.push({key:q,value:e})}return a};c.groups=function(b){for(var a=[],c,d=0;d<b.length;d++)c=b[d].substr(8).split(" "),a.push({semantics:c.shift(),contents:c});return a};c.bandwidth=function(b){b=b.substr(2).split(":");var a={};a.type=b.shift();a.bandwidth=
b.shift();return a};c.msid=function(b){b=b.substr(7);var a=b.split(" ");return{msid:b,mslabel:a[0],label:a[1]}}},{}],47:[function(b,a,c){a.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",
responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],48:[function(b,a,c){var d=b("./senders"),h=b("./parsers"),l=Math.random();c._setIdCounter=function(b){l=b};c.toSessionJSON=function(b,a){var d,e=a.creators||[],l=a.role||"initiator";a=a.direction||"outgoing";
var p=b.split("\r\nm=");for(d=1;d<p.length;d++)p[d]="m="+p[d],d!==p.length-1&&(p[d]+="\r\n");var n=p.shift()+"\r\n",g=h.lines(n);b={};var k=[];for(d=0;d<p.length;d++)k.push(c.toMediaJSON(p[d],n,{role:l,direction:a,creator:e[d]||"initiator"}));b.contents=k;e=h.findLines("a=group:",g);e.length&&(b.groups=h.groups(e));return b};c.toMediaJSON=function(b,a,e){var l=e.creator||"initiator",p=e.role||"initiator",n=e.direction||"outgoing",m=h.lines(b);b=h.lines(a);a=h.mline(m[0]);l={creator:l,name:a.media,
application:{applicationType:"rtp",media:a.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==a.media&&(l.application={applicationType:"datachannel"},l.transport.sctp=[]);var g=l.application,k=l.transport;if(a=h.findLine("a=mid:",m))l.name=a.substr(6);h.findLine("a=sendrecv",m,b)?l.senders="both":h.findLine("a=sendonly",m,b)?l.senders=d[p][n].sendonly:h.findLine("a=recvonly",m,b)?l.senders=d[p][n].recvonly:
h.findLine("a=inactive",m,b)&&(l.senders="none");if("rtp"==g.applicationType){if(a=h.findLine("b=",m))g.bandwidth=h.bandwidth(a);if(a=h.findLine("a=ssrc:",m))g.ssrc=a.substr(7).split(" ")[0];h.findLines("a=rtpmap:",m).forEach(function(b){var a=h.rtpmap(b);a.parameters=[];a.feedback=[];h.findLines("a=fmtp:"+a.id,m).forEach(function(b){a.parameters=h.fmtp(b)});h.findLines("a=rtcp-fb:"+a.id,m).forEach(function(b){a.feedback.push(h.rtcpfb(b))});g.payloads.push(a)});h.findLines("a=crypto:",m,b).forEach(function(b){g.encryption.push(h.crypto(b))});
h.findLine("a=rtcp-mux",m)&&(g.mux=!0);h.findLines("a=rtcp-fb:*",m).forEach(function(b){g.feedback.push(h.rtcpfb(b))});h.findLines("a=extmap:",m).forEach(function(b){b=h.extmap(b);b.senders=d[p][n][b.senders];g.headerExtensions.push(b)});a=h.findLines("a=ssrc-group:",m);g.sourceGroups=h.sourceGroups(a||[]);a=h.findLines("a=ssrc:",m);var N=g.sources=h.sources(a||[]);if(a=h.findLine("a=msid:",m)){var r=h.msid(a);["msid","mslabel","label"].forEach(function(b){for(var a=0;a<N.length;a++){for(var c=!1,
d=0;d<N[a].parameters.length;d++)N[a].parameters[d].key===b&&(c=!0);c||N[a].parameters.push({key:b,value:r[b]})}})}h.findLine("a=x-google-flag:conference",m,b)&&(g.googConferenceFlag=!0)}a=h.findLines("a=fingerprint:",m,b);var pa=h.findLine("a=setup:",m,b);a.forEach(function(b){b=h.fingerprint(b);pa&&(b.setup=pa.substr(8));k.fingerprints.push(b)});a=h.findLine("a=ice-ufrag:",m,b);e=h.findLine("a=ice-pwd:",m,b);a&&e&&(k.ufrag=a.substr(12),k.pwd=e.substr(10),k.candidates=[],h.findLines("a=candidate:",
m,b).forEach(function(b){k.candidates.push(c.toCandidateJSON(b))}));"datachannel"==g.applicationType&&h.findLines("a=sctpmap:",m).forEach(function(b){b=h.sctpmap(b);k.sctp.push(b)});return l};c.toCandidateJSON=function(b){b=h.candidate(b.split("\r\n")[0]);b.id=(l++).toString(36).substr(0,12);return b}},{"./parsers":46,"./senders":47}],49:[function(b,a,c){var d=b("./senders");c.toSessionSDP=function(b,a){var d=a.sid||b.sid||Date.now(),e=a.time||Date.now(),h=["v=0","o=- "+d+" "+e+" IN IP4 0.0.0.0",
"s=-","t=0 0"];d=b.contents||[];var l=!1;d.forEach(function(b){b.application.sources&&b.application.sources.length&&(l=!0)});l&&h.push("a=msid-semantic: WMS *");(b.groups||[]).forEach(function(b){h.push("a=group:"+b.semantics+" "+b.contents.join(" "))});d.forEach(function(b){h.push(c.toMediaSDP(b,a))});return h.join("\r\n")+"\r\n"};c.toMediaSDP=function(b,a){var e=[],h=a.role||"initiator",l=a.direction||"outgoing",q=b.application;a=b.transport;var g=q.payloads||[],k=a&&a.fingerprints||[],E=[];"datachannel"==
q.applicationType?(E.push("application"),E.push("1"),E.push("DTLS/SCTP"),a.sctp&&a.sctp.forEach(function(b){E.push(b.number)})):(E.push(q.media),E.push("1"),0<k.length?E.push("UDP/TLS/RTP/SAVPF"):q.encryption&&0<q.encryption.length?E.push("RTP/SAVPF"):E.push("RTP/AVPF"),g.forEach(function(b){E.push(b.id)}));e.push("m="+E.join(" "));e.push("c=IN IP4 0.0.0.0");q.bandwidth&&q.bandwidth.type&&q.bandwidth.bandwidth&&e.push("b="+q.bandwidth.type+":"+q.bandwidth.bandwidth);"rtp"==q.applicationType&&e.push("a=rtcp:1 IN IP4 0.0.0.0");
a&&(a.ufrag&&e.push("a=ice-ufrag:"+a.ufrag),a.pwd&&e.push("a=ice-pwd:"+a.pwd),k.forEach(function(b){e.push("a=fingerprint:"+b.hash+" "+b.value);b.setup&&e.push("a=setup:"+b.setup)}),a.sctp&&a.sctp.forEach(function(b){e.push("a=sctpmap:"+b.number+" "+b.protocol+" "+b.streams)}));"rtp"==q.applicationType&&e.push("a="+(d[h][l][b.senders]||"sendrecv"));e.push("a=mid:"+b.name);q.sources&&q.sources.length&&(q.sources[0].parameters||[]).forEach(function(b){"msid"===b.key&&e.push("a=msid:"+b.value)});q.mux&&
e.push("a=rtcp-mux");(q.encryption||[]).forEach(function(b){e.push("a=crypto:"+b.tag+" "+b.cipherSuite+" "+b.keyParams+(b.sessionParams?" "+b.sessionParams:""))});q.googConferenceFlag&&e.push("a=x-google-flag:conference");g.forEach(function(b){var a="a=rtpmap:"+b.id+" "+b.name+"/"+b.clockrate;b.channels&&"1"!=b.channels&&(a+="/"+b.channels);e.push(a);if(b.parameters&&b.parameters.length){a=["a=fmtp:"+b.id];var c=[];b.parameters.forEach(function(b){c.push((b.key?b.key+"=":"")+b.value)});a.push(c.join(";"));
e.push(a.join(" "))}b.feedback&&b.feedback.forEach(function(a){"trr-int"===a.type?e.push("a=rtcp-fb:"+b.id+" trr-int "+(a.value?a.value:"0")):e.push("a=rtcp-fb:"+b.id+" "+a.type+(a.subtype?" "+a.subtype:""))})});q.feedback&&q.feedback.forEach(function(b){"trr-int"===b.type?e.push("a=rtcp-fb:* trr-int "+(b.value?b.value:"0")):e.push("a=rtcp-fb:* "+b.type+(b.subtype?" "+b.subtype:""))});(q.headerExtensions||[]).forEach(function(b){e.push("a=extmap:"+b.id+(b.senders?"/"+d[h][l][b.senders]:"")+" "+b.uri)});
(q.sourceGroups||[]).forEach(function(b){e.push("a=ssrc-group:"+b.semantics+" "+b.sources.join(" "))});(q.sources||[]).forEach(function(b){for(var a=0;a<b.parameters.length;a++){var c=b.parameters[a];e.push("a=ssrc:"+(b.ssrc||q.ssrc)+" "+c.key+(c.value?":"+c.value:""))}});(a.candidates||[]).forEach(function(b){e.push(c.toCandidateSDP(b))});return e.join("\r\n")};c.toCandidateSDP=function(b){var a=[];a.push(b.foundation);a.push(b.component);a.push(b.protocol.toUpperCase());a.push(b.priority);a.push(b.ip);
a.push(b.port);var c=b.type;a.push("typ");a.push(c);("srflx"===c||"prflx"===c||"relay"===c)&&b.relAddr&&b.relPort&&(a.push("raddr"),a.push(b.relAddr),a.push("rport"),a.push(b.relPort));b.tcpType&&"TCP"==b.protocol.toUpperCase()&&(a.push("tcptype"),a.push(b.tcpType));a.push("generation");a.push(b.generation||"0");return"a=candidate:"+a.join(" ")}},{"./senders":47}],50:[function(b,a,c){a.exports=b("./lib/")},{"./lib/":51}],51:[function(b,a,c){function d(b,a){"object"==typeof b&&(a=b,b=void 0);a=a||
{};b=h(b);var c=b.source,d=b.id;a.forceNew||a["force new connection"]||!1===a.multiplex?(n("ignoring socket cache for %s",c),a=p(c,a)):(m[d]||(n("new io instance for %s",c),m[d]=p(c,a)),a=m[d]);return a.socket(b.path)}var h=b("./url"),l=b("socket.io-parser"),p=b("./manager"),n=b("debug")("socket.io-client");a.exports=c=d;var m=c.managers={};c.protocol=l.protocol;c.connect=d;c.Manager=b("./manager");c.Socket=b("./socket")},{"./manager":52,"./socket":54,"./url":55,debug:10,"socket.io-parser":57}],52:[function(b,
a,c){function d(b,a){if(!(this instanceof d))return new d(b,a);b&&"object"==typeof b&&(a=b,b=void 0);a=a||{};a.path=a.path||"/socket.io";this.nsps={};this.subs=[];this.opts=a;this.reconnection(!1!==a.reconnection);this.reconnectionAttempts(a.reconnectionAttempts||Infinity);this.reconnectionDelay(a.reconnectionDelay||1E3);this.reconnectionDelayMax(a.reconnectionDelayMax||5E3);this.randomizationFactor(a.randomizationFactor||.5);this.backoff=new k({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==a.timeout?2E4:a.timeout);this.readyState="closed";this.uri=b;this.connected=[];this.encoding=!1;this.packetBuffer=[];this.encoder=new p.Encoder;this.decoder=new p.Decoder;(this.autoConnect=!1!==a.autoConnect)&&this.open()}b("./url");var h=b("engine.io-client"),l=b("./socket");c=b("component-emitter");var p=b("socket.io-parser"),n=b("./on"),m=b("component-bind");b("object-component");var q=b("debug")("socket.io-client:manager"),g=b("indexof"),
k=b("backo2");a.exports=d;d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var b in this.nsps)this.nsps[b].emit.apply(this.nsps[b],arguments)};d.prototype.updateSocketIds=function(){for(var b in this.nsps)this.nsps[b].id=this.engine.id};c(d.prototype);d.prototype.reconnection=function(b){if(!arguments.length)return this._reconnection;this._reconnection=!!b;return this};d.prototype.reconnectionAttempts=function(b){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=
b;return this};d.prototype.reconnectionDelay=function(b){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=b;this.backoff&&this.backoff.setMin(b);return this};d.prototype.randomizationFactor=function(b){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=b;this.backoff&&this.backoff.setJitter(b);return this};d.prototype.reconnectionDelayMax=function(b){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=b;this.backoff&&
this.backoff.setMax(b);return this};d.prototype.timeout=function(b){if(!arguments.length)return this._timeout;this._timeout=b;return this};d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};d.prototype.open=d.prototype.connect=function(b){q("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;q("opening %s",this.uri);var a=this.engine=h(this.uri,this.opts),c=this;this.readyState="opening";this.skipReconnect=
!1;var d=n(a,"open",function(){c.onopen();b&&b()}),e=n(a,"error",function(a){q("connect_error");c.cleanup();c.readyState="closed";c.emitAll("connect_error",a);if(b){var d=Error("Connection error");d.data=a;b(d)}else c.maybeReconnectOnOpen()});if(!1!==this._timeout){var l=this._timeout;q("connect attempt will timeout after %d",l);var p=setTimeout(function(){q("connect attempt timed out after %d",l);d.destroy();a.close();a.emit("error","timeout");c.emitAll("connect_timeout",l)},l);this.subs.push({destroy:function(){clearTimeout(p)}})}this.subs.push(d);
this.subs.push(e);return this};d.prototype.onopen=function(){q("open");this.cleanup();this.readyState="open";this.emit("open");var b=this.engine;this.subs.push(n(b,"data",m(this,"ondata")));this.subs.push(n(this.decoder,"decoded",m(this,"ondecoded")));this.subs.push(n(b,"error",m(this,"onerror")));this.subs.push(n(b,"close",m(this,"onclose")))};d.prototype.ondata=function(b){this.decoder.add(b)};d.prototype.ondecoded=function(b){this.emit("packet",b)};d.prototype.onerror=function(b){q("error",b);
this.emitAll("error",b)};d.prototype.socket=function(b){var a=this.nsps[b];if(!a){a=new l(this,b);this.nsps[b]=a;var c=this;a.on("connect",function(){a.id=c.engine.id;~g(c.connected,a)||c.connected.push(a)})}return a};d.prototype.destroy=function(b){b=g(this.connected,b);~b&&this.connected.splice(b,1);this.connected.length||this.close()};d.prototype.packet=function(b){q("writing packet %j",b);var a=this;a.encoding?a.packetBuffer.push(b):(a.encoding=!0,this.encoder.encode(b,function(b){for(var c=0;c<
b.length;c++)a.engine.write(b[c]);a.encoding=!1;a.processPacketQueue()}))};d.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var b=this.packetBuffer.shift();this.packet(b)}};d.prototype.cleanup=function(){for(var b;b=this.subs.shift();)b.destroy();this.packetBuffer=[];this.encoding=!1;this.decoder.destroy()};d.prototype.close=d.prototype.disconnect=function(){this.skipReconnect=!0;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};
d.prototype.onclose=function(b){q("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",b);this._reconnection&&!this.skipReconnect&&this.reconnect()};d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var b=this;if(this.backoff.attempts>=this._reconnectionAttempts)q("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var a=this.backoff.duration();q("will wait %dms before reconnect attempt",
a);this.reconnecting=!0;var c=setTimeout(function(){b.skipReconnect||(q("attempting reconnect"),b.emitAll("reconnect_attempt",b.backoff.attempts),b.emitAll("reconnecting",b.backoff.attempts),b.skipReconnect||b.open(function(a){a?(q("reconnect attempt error"),b.reconnecting=!1,b.reconnect(),b.emitAll("reconnect_error",a.data)):(q("reconnect success"),b.onreconnect())}))},a);this.subs.push({destroy:function(){clearTimeout(c)}})}};d.prototype.onreconnect=function(){var b=this.backoff.attempts;this.reconnecting=
!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",b)}},{"./on":53,"./socket":54,"./url":55,backo2:4,"component-bind":7,"component-emitter":8,debug:10,"engine.io-client":11,indexof:32,"object-component":39,"socket.io-parser":57}],53:[function(b,a,c){a.exports=function(b,a,c){b.on(a,c);return{destroy:function(){b.removeListener(a,c)}}}},{}],54:[function(b,a,c){function d(b,a){this.io=b;this.nsp=a;this.json=this;this.ids=0;this.acks={};this.io.autoConnect&&this.open();this.receiveBuffer=
[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0}var h=b("socket.io-parser");c=b("component-emitter");var l=b("to-array"),p=b("./on"),n=b("component-bind"),m=b("debug")("socket.io-client:socket"),q=b("has-binary");a.exports=d;var g={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},k=c.prototype.emit;c(d.prototype);d.prototype.subEvents=function(){if(!this.subs){var b=this.io;this.subs=
[p(b,"open",n(this,"onopen")),p(b,"packet",n(this,"onpacket")),p(b,"close",n(this,"onclose"))]}};d.prototype.open=d.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};d.prototype.send=function(){var b=l(arguments);b.unshift("message");this.emit.apply(this,b);return this};d.prototype.emit=function(b){if(g.hasOwnProperty(b))return k.apply(this,arguments),this;var a=l(arguments),c=h.EVENT;q(a)&&(c=h.BINARY_EVENT);
c={type:c,data:a};"function"==typeof a[a.length-1]&&(m("emitting packet with ack id %d",this.ids),this.acks[this.ids]=a.pop(),c.id=this.ids++);this.connected?this.packet(c):this.sendBuffer.push(c);return this};d.prototype.packet=function(b){b.nsp=this.nsp;this.io.packet(b)};d.prototype.onopen=function(){m("transport is open - connecting");"/"!=this.nsp&&this.packet({type:h.CONNECT})};d.prototype.onclose=function(b){m("close (%s)",b);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",
b)};d.prototype.onpacket=function(b){if(b.nsp==this.nsp)switch(b.type){case h.CONNECT:this.onconnect();break;case h.EVENT:this.onevent(b);break;case h.BINARY_EVENT:this.onevent(b);break;case h.ACK:this.onack(b);break;case h.BINARY_ACK:this.onack(b);break;case h.DISCONNECT:this.ondisconnect();break;case h.ERROR:this.emit("error",b.data)}};d.prototype.onevent=function(b){var a=b.data||[];m("emitting event %j",a);null!=b.id&&(m("attaching ack callback to event"),a.push(this.ack(b.id)));this.connected?
k.apply(this,a):this.receiveBuffer.push(a)};d.prototype.ack=function(b){var a=this,c=!1;return function(){if(!c){c=!0;var d=l(arguments);m("sending ack %j",d);var e=q(d)?h.BINARY_ACK:h.ACK;a.packet({type:e,id:b,data:d})}}};d.prototype.onack=function(b){m("calling ack %s with %j",b.id,b.data);this.acks[b.id].apply(this,b.data);delete this.acks[b.id]};d.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};d.prototype.emitBuffered=function(){var b;
for(b=0;b<this.receiveBuffer.length;b++)k.apply(this,this.receiveBuffer[b]);this.receiveBuffer=[];for(b=0;b<this.sendBuffer.length;b++)this.packet(this.sendBuffer[b]);this.sendBuffer=[]};d.prototype.ondisconnect=function(){m("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};d.prototype.destroy=function(){if(this.subs){for(var b=0;b<this.subs.length;b++)this.subs[b].destroy();this.subs=null}this.io.destroy(this)};d.prototype.close=d.prototype.disconnect=function(){this.connected&&
(m("performing disconnect (%s)",this.nsp),this.packet({type:h.DISCONNECT}));this.destroy();if(this.connected)this.onclose("io client disconnect");return this}},{"./on":53,"component-bind":7,"component-emitter":8,debug:10,"has-binary":30,"socket.io-parser":57,"to-array":59}],55:[function(b,a,c){(function(c){var d=b("parseuri"),e=b("debug")("socket.io-client:url");a.exports=function(b,a){var h=b;a=a||c.location;null==b&&(b=a.protocol+"//"+a.host);"string"==typeof b&&("/"==b.charAt(0)&&(b="/"==b.charAt(1)?
a.protocol+b:a.hostname+b),/^(https?|wss?):\/\//.test(b)||(e("protocol-less url %s",b),b="undefined"!=typeof a?a.protocol+"//"+b:"https://"+b),e("parse %s",b),h=d(b));h.port||(/^(http|ws)$/.test(h.protocol)?h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443"));h.path=h.path||"/";h.id=h.protocol+"://"+h.host+":"+h.port;h.href=h.protocol+"://"+h.host+(a&&a.port==h.port?"":":"+h.port);return h}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?
window:{})},{debug:10,parseuri:42}],56:[function(b,a,c){(function(a){var d=b("isarray"),e=b("./is-buffer");c.deconstructPacket=function(b){function a(b){if(!b)return b;if(e(b)){var h={_placeholder:!0,num:c.length};c.push(b);return h}if(d(b)){h=Array(b.length);for(var l=0;l<b.length;l++)h[l]=a(b[l]);return h}if("object"==typeof b&&!(b instanceof Date)){h={};for(l in b)h[l]=a(b[l]);return h}return b}var c=[];b.data=a(b.data);b.attachments=c.length;return{packet:b,buffers:c}};c.reconstructPacket=function(b,
a){function c(b){if(b&&b._placeholder)return a[b.num];if(d(b))for(var e=0;e<b.length;e++)b[e]=c(b[e]);else if(b&&"object"==typeof b)for(e in b)b[e]=c(b[e]);return b}b.data=c(b.data);b.attachments=void 0;return b};c.removeBlobs=function(b,c){function h(b,n,m){if(!b)return b;if(a.Blob&&b instanceof Blob||a.File&&b instanceof File){l++;var q=new FileReader;q.onload=function(){m?m[n]=this.result:p=this.result;--l||c(p)};q.readAsArrayBuffer(b)}else if(d(b))for(q=0;q<b.length;q++)h(b[q],q,b);else if(b&&
"object"==typeof b&&!e(b))for(q in b)h(b[q],q,b)}var l=0,p=b;h(p);l||c(p)}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./is-buffer":58,isarray:33}],57:[function(b,a,c){function d(){}function h(b){var a=!1;var d=""+b.type;if(c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type)d+=b.attachments,d+="-";b.nsp&&"/"!=b.nsp&&(a=!0,d+=b.nsp);null!=b.id&&(a&&(d+=",",a=!1),d+=b.id);null!=b.data&&(a&&(d+=","),d+=q.stringify(b.data));m("encoded %j as %s",
b,d);return d}function l(b,a){g.removeBlobs(b,function(b){var c=g.deconstructPacket(b);b=h(c.packet);c=c.buffers;c.unshift(b);a(c)})}function p(){this.reconstructor=null}function n(b){this.reconPack=b;this.buffers=[]}var m=b("debug")("socket.io-parser"),q=b("json3");b("isarray");a=b("component-emitter");var g=b("./binary"),k=b("./is-buffer");c.protocol=4;c.types="CONNECT DISCONNECT EVENT BINARY_EVENT ACK BINARY_ACK ERROR".split(" ");c.CONNECT=0;c.DISCONNECT=1;c.EVENT=2;c.ACK=3;c.ERROR=4;c.BINARY_EVENT=
5;c.BINARY_ACK=6;c.Encoder=d;c.Decoder=p;d.prototype.encode=function(b,a){m("encoding packet %j",b);c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?l(b,a):(b=h(b),a([b]))};a(p.prototype);p.prototype.add=function(b){if("string"==typeof b){a:{var a={},d=0;a.type=Number(b.charAt(0));if(null==c.types[a.type])b={type:c.ERROR,data:"parser error"};else{if(c.BINARY_EVENT==a.type||c.BINARY_ACK==a.type){for(var e="";"-"!=b.charAt(++d)&&(e+=b.charAt(d),d!=b.length););if(e!=Number(e)||"-"!=b.charAt(d))throw Error("Illegal attachments");
a.attachments=Number(e)}if("/"==b.charAt(d+1))for(a.nsp="";++d;){e=b.charAt(d);if(","==e)break;a.nsp+=e;if(d==b.length)break}else a.nsp="/";e=b.charAt(d+1);if(""!==e&&Number(e)==e){for(a.id="";++d;){e=b.charAt(d);if(null==e||Number(e)!=e){--d;break}a.id+=b.charAt(d);if(d==b.length)break}a.id=Number(a.id)}if(b.charAt(++d))try{a.data=q.parse(b.substr(d))}catch(Gb){b={type:c.ERROR,data:"parser error"};break a}m("decoded %s as %j",b,a);b=a}}c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?(this.reconstructor=
new n(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else if(k(b)||b.base64)if(this.reconstructor){if(b=this.reconstructor.takeBinaryData(b))this.reconstructor=null,this.emit("decoded",b)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+b);};p.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};n.prototype.takeBinaryData=function(b){this.buffers.push(b);
return this.buffers.length==this.reconPack.attachments?(b=g.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),b):null};n.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},{"./binary":56,"./is-buffer":58,"component-emitter":8,debug:10,isarray:33,json3:34}],58:[function(b,a,c){(function(b){a.exports=function(a){return b.Buffer&&b.Buffer.isBuffer(a)||b.ArrayBuffer&&a instanceof ArrayBuffer}}).call(this,"undefined"!==typeof global?global:"undefined"!==
typeof self?self:"undefined"!==typeof window?window:{})},{}],59:[function(b,a,c){a.exports=function(b,a){for(var c=[],d=(a=a||0)||0;d<b.length;d++)c[d-a]=b[d];return c}},{}],60:[function(b,a,c){(function(b){(function(d){function e(b){for(var a=[],c=0,d=b.length,e,h;c<d;)e=b.charCodeAt(c++),55296<=e&&56319>=e&&c<d?(h=b.charCodeAt(c++),56320==(h&64512)?a.push(((e&1023)<<10)+(h&1023)+65536):(a.push(e),c--)):a.push(e);return a}function h(b){if(55296<=b&&57343>=b)throw Error("Lone surrogate U+"+b.toString(16).toUpperCase()+
" is not a scalar value");}function n(){if(N>=t)throw Error("Invalid byte index");var b=r[N]&255;N++;if(128==(b&192))return b&63;throw Error("Invalid continuation byte");}function m(){if(N>t)throw Error("Invalid byte index");if(N==t)return!1;var b=r[N]&255;N++;if(0==(b&128))return b;if(192==(b&224)){var a=n();b=(b&31)<<6|a;if(128<=b)return b;throw Error("Invalid continuation byte");}if(224==(b&240)){a=n();var c=n();b=(b&15)<<12|a<<6|c;if(2048<=b)return h(b),b;throw Error("Invalid continuation byte");
}if(240==(b&248)){a=n();c=n();var d=n();b=(b&15)<<18|a<<12|c<<6|d;if(65536<=b&&1114111>=b)return b}throw Error("Invalid UTF-8 detected");}var q="object"==typeof c&&c,g="object"==typeof a&&a&&a.exports==q&&a,k="object"==typeof b&&b;if(k.global===k||k.window===k)d=k;var E=String.fromCharCode,r,t,N;k={version:"2.0.0",encode:function(b){b=e(b);for(var a=b.length,c=-1,d,l="";++c<a;){d=b[c];if(0==(d&4294967168))d=E(d);else{var p="";0==(d&4294965248)?p=E(d>>6&31|192):0==(d&4294901760)?(h(d),p=E(d>>12&15|
224),p+=E(d>>6&63|128)):0==(d&4292870144)&&(p=E(d>>18&7|240),p+=E(d>>12&63|128),p+=E(d>>6&63|128));d=p+=E(d&63|128)}l+=d}return l},decode:function(b){r=e(b);t=r.length;N=0;b=[];for(var a;!1!==(a=m());)b.push(a);a=b.length;for(var c=-1,d,h="";++c<a;)d=b[c],65535<d&&(d-=65536,h+=E(d>>>10&1023|55296),d=56320|d&1023),h+=E(d);return h}};if(q&&!q.nodeType)if(g)g.exports=k;else{d={}.hasOwnProperty;for(var z in k)d.call(k,z)&&(q[z]=k[z])}else d.utf8=k})(this)}).call(this,"undefined"!==typeof global?global:
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],61:[function(b,a,c){a.exports="function"===typeof Object.create?function(b,a){b.super_=a;b.prototype=Object.create(a.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,a){b.super_=a;var c=function(){};c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b}},{}],62:[function(b,a,c){a.exports=function(b){return b&&"object"===typeof b&&"function"===typeof b.copy&&"function"===
typeof b.fill&&"function"===typeof b.readUInt8}},{}],63:[function(b,a,c){(function(a,d){function e(b,a){var d={seen:[],stylize:n};3<=arguments.length&&(d.depth=arguments[2]);4<=arguments.length&&(d.colors=arguments[3]);z(a)?d.showHidden=a:a&&c._extend(d,a);x(d.showHidden)&&(d.showHidden=!1);x(d.depth)&&(d.depth=2);x(d.colors)&&(d.colors=!1);x(d.customInspect)&&(d.customInspect=!0);d.colors&&(d.stylize=h);return q(d,b,d.depth)}function h(b,a){return(a=e.styles[a])?"\u001b["+e.colors[a][0]+"m"+b+"\u001b["+
e.colors[a][1]+"m":b}function n(b,a){return b}function m(b){var a={};b.forEach(function(b,c){a[b]=!0});return a}function q(b,a,d){if(b.customInspect&&a&&I(a.inspect)&&a.inspect!==c.inspect&&(!a.constructor||a.constructor.prototype!==a)){var e=a.inspect(d,b);v(e)||(e=q(b,e,d));return e}if(e=g(b,a))return e;var h=Object.keys(a),l=m(h);b.showHidden&&(h=Object.getOwnPropertyNames(a));if(F(a)&&(0<=h.indexOf("message")||0<=h.indexOf("description")))return k(a);if(0===h.length){if(I(a))return b.stylize("[Function"+
(a.name?": "+a.name:"")+"]","special");if(A(a))return b.stylize(RegExp.prototype.toString.call(a),"regexp");if(B(a))return b.stylize(Date.prototype.toString.call(a),"date");if(F(a))return k(a)}e="";var p=!1,n=["{","}"];N(a)&&(p=!0,n=["[","]"]);I(a)&&(e=" [Function"+(a.name?": "+a.name:"")+"]");A(a)&&(e=" "+RegExp.prototype.toString.call(a));B(a)&&(e=" "+Date.prototype.toUTCString.call(a));F(a)&&(e=" "+k(a));if(0===h.length&&(!p||0==a.length))return n[0]+e+n[1];if(0>d)return A(a)?b.stylize(RegExp.prototype.toString.call(a),
"regexp"):b.stylize("[Object]","special");b.seen.push(a);h=p?E(b,a,d,l,h):h.map(function(c){return r(b,a,d,l,c,p)});b.seen.pop();return t(h,e,n)}function g(b,a){if(x(a))return b.stylize("undefined","undefined");if(v(a))return a="'"+JSON.stringify(a).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",b.stylize(a,"string");if(w(a))return b.stylize(""+a,"number");if(z(a))return b.stylize(""+a,"boolean");if(null===a)return b.stylize("null","null")}function k(b){return"["+Error.prototype.toString.call(b)+
"]"}function E(b,a,c,d,e){for(var h=[],l=0,p=a.length;l<p;++l)Object.prototype.hasOwnProperty.call(a,String(l))?h.push(r(b,a,c,d,String(l),!0)):h.push("");e.forEach(function(e){e.match(/^\d+$/)||h.push(r(b,a,c,d,e,!0))});return h}function r(b,a,c,d,e,h){var l,p;a=Object.getOwnPropertyDescriptor(a,e)||{value:a[e]};a.get?p=a.set?b.stylize("[Getter/Setter]","special"):b.stylize("[Getter]","special"):a.set&&(p=b.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(d,e)||(l="["+e+"]");p||
(0>b.seen.indexOf(a.value)?(p=null===c?q(b,a.value,null):q(b,a.value,c-1),-1<p.indexOf("\n")&&(p=h?p.split("\n").map(function(b){return"  "+b}).join("\n").substr(2):"\n"+p.split("\n").map(function(b){return"   "+b}).join("\n"))):p=b.stylize("[Circular]","special"));if(x(l)){if(h&&e.match(/^\d+$/))return p;l=JSON.stringify(""+e);l.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(l=l.substr(1,l.length-2),l=b.stylize(l,"name")):(l=l.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),l=b.stylize(l,
"string"))}return l+": "+p}function t(b,a,c){var d=0;return 60<b.reduce(function(b,a){d++;0<=a.indexOf("\n")&&d++;return b+a.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===a?"":a+"\n ")+" "+b.join(",\n  ")+" "+c[1]:c[0]+a+" "+b.join(", ")+" "+c[1]}function N(b){return Array.isArray(b)}function z(b){return"boolean"===typeof b}function w(b){return"number"===typeof b}function v(b){return"string"===typeof b}function x(b){return void 0===b}function A(b){return D(b)&&"[object RegExp]"===Object.prototype.toString.call(b)}
function D(b){return"object"===typeof b&&null!==b}function B(b){return D(b)&&"[object Date]"===Object.prototype.toString.call(b)}function F(b){return D(b)&&("[object Error]"===Object.prototype.toString.call(b)||b instanceof Error)}function I(b){return"function"===typeof b}function C(b){return 10>b?"0"+b.toString(10):b.toString(10)}function J(){var b=new Date,a=[C(b.getHours()),C(b.getMinutes()),C(b.getSeconds())].join(":");return[b.getDate(),V[b.getMonth()],a].join(" ")}var G=/%[sdj%]/g;c.format=
function(b){if(!v(b)){for(var a=[],c=0;c<arguments.length;c++)a.push(e(arguments[c]));return a.join(" ")}c=1;var d=arguments,h=d.length;a=String(b).replace(G,function(b){if("%%"===b)return"%";if(c>=h)return b;switch(b){case "%s":return String(d[c++]);case "%d":return Number(d[c++]);case "%j":try{return JSON.stringify(d[c++])}catch(yl){return"[Circular]"}default:return b}});for(var l=d[c];c<h;l=d[++c])a=null!==l&&D(l)?a+(" "+e(l)):a+(" "+l);return a};c.deprecate=function(b,e){if(x(d.process))return function(){return c.deprecate(b,
e).apply(this,arguments)};if(!0===a.noDeprecation)return b;var h=!1;return function(){if(!h){if(a.throwDeprecation)throw Error(e);a.traceDeprecation?console.trace(e):console.error(e);h=!0}return b.apply(this,arguments)}};var M={},O;c.debuglog=function(b){x(O)&&(O=a.env.NODE_DEBUG||"");b=b.toUpperCase();if(!M[b])if((new RegExp("\\b"+b+"\\b","i")).test(O)){var d=a.pid;M[b]=function(){var a=c.format.apply(c,arguments);console.error("%s %d: %s",b,d,a)}}else M[b]=function(){};return M[b]};c.inspect=e;
e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};c.isArray=N;c.isBoolean=z;c.isNull=function(b){return null===b};c.isNullOrUndefined=function(b){return null==b};c.isNumber=w;c.isString=v;c.isSymbol=function(b){return"symbol"===
typeof b};c.isUndefined=x;c.isRegExp=A;c.isObject=D;c.isDate=B;c.isError=F;c.isFunction=I;c.isPrimitive=function(b){return null===b||"boolean"===typeof b||"number"===typeof b||"string"===typeof b||"symbol"===typeof b||"undefined"===typeof b};c.isBuffer=b("./support/isBuffer");var V="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");c.log=function(){console.log("%s - %s",J(),c.format.apply(c,arguments))};c.inherits=b("inherits");c._extend=function(b,a){if(!a||!D(a))return b;for(var c=Object.keys(a),
d=c.length;d--;)b[c[d]]=a[c[d]];return b}}).call(this,b("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":62,_process:43,inherits:61}],64:[function(b,a,c){if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){var d="moz";var h=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)d="webkit",h=navigator.userAgent.match(/Chrom(e|ium)/)&&
parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10);b=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;c=window.mozRTCIceCandidate||window.RTCIceCandidate;var l=window.mozRTCSessionDescription||window.RTCSessionDescription,p=window.webkitMediaStream||window.MediaStream,n="https:"===window.location.protocol&&("webkit"===d&&26<=h||"moz"===d&&33<=h),m=window.AudioContext||window.webkitAudioContext,q=document.createElement("video");q=q&&q.canPlayType&&
"probably"===q.canPlayType('video/webm; codecs="vp8", vorbis');var g=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;a.exports={prefix:d,browserVersion:h,support:!!b&&!!g,supportRTCPeerConnection:!!b,supportVp8:q,supportGetUserMedia:!!g,supportDataChannel:!!(b&&b.prototype&&b.prototype.createDataChannel),supportWebAudio:!(!m||!m.prototype.createMediaStreamSource),supportMediaStream:!(!p||!p.prototype.removeTrack),supportScreenSharing:!!n,AudioContext:m,
PeerConnection:b,SessionDescription:l,IceCandidate:c,MediaStream:p,getUserMedia:g}},{}],65:[function(b,a,c){function d(){}a.exports=d;d.mixin=function(b){b=b.prototype||b;b.isWildEmitter=!0;b.on=function(b,a,c){this.callbacks=this.callbacks||{};var d=3===arguments.length,e=d?arguments[2]:arguments[1];e._groupName=d?arguments[1]:void 0;(this.callbacks[b]=this.callbacks[b]||[]).push(e);return this};b.once=function(b,a,c){function d(){e.off(b,d);l.apply(this,arguments)}var e=this,h=3===arguments.length,
l=h?arguments[2]:arguments[1];this.on(b,h?arguments[1]:void 0,d);return this};b.releaseGroup=function(b){this.callbacks=this.callbacks||{};var a,c;for(a in this.callbacks){var d=this.callbacks[a];var e=0;for(c=d.length;e<c;e++)d[e]._groupName===b&&(d.splice(e,1),e--,c--)}return this};b.off=function(b,a){this.callbacks=this.callbacks||{};var c=this.callbacks[b];if(!c)return this;if(1===arguments.length)return delete this.callbacks[b],this;var d=c.indexOf(a);c.splice(d,1);0===c.length&&delete this.callbacks[b];
return this};b.emit=function(b){this.callbacks=this.callbacks||{};var a=[].slice.call(arguments,1),c=this.callbacks[b],d=this.getWildcardCallbacks(b),e;if(c){var h=c.slice();c=0;for(e=h.length;c<e&&h[c];++c)h[c].apply(this,a)}if(d)for(h=d.slice(),c=0,e=h.length;c<e&&h[c];++c)h[c].apply(this,[b].concat(a));return this};b.getWildcardCallbacks=function(b){this.callbacks=this.callbacks||{};var a,c=[];for(a in this.callbacks){var d=a.split("*");if("*"===a||2===d.length&&b.slice(0,d[0].length)===d[0])c=
c.concat(this.callbacks[a])}return c}};d.mixin(d)},{}],66:[function(b,a,c){function d(b,a,c){return a?new h(b,a):new h(b)}b=function(){return this}();var h=b.WebSocket||b.MozWebSocket;a.exports=h?d:null;h&&(d.prototype=h.prototype)},{}],67:[function(b,a,c){function d(b){var a=!0;b.getTracks().forEach(function(b){a="ended"===b.readyState&&a});return a}function h(b){var a=this;n.call(this);this.id=b.id;this.parent=b.parent;this.type=b.type||"video";this.oneway=b.oneway||!1;this.sharemyscreen=b.sharemyscreen||
!1;this.browserPrefix=b.prefix;this.stream=b.stream;this.enableDataChannels=void 0===b.enableDataChannels?this.parent.config.enableDataChannels:b.enableDataChannels;this.receiveMedia=b.receiveMedia||this.parent.config.receiveMedia;this.channels={};this.sid=b.sid||Date.now().toString();this.pc=new p(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints);this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("endOfCandidates",function(b){a.send("endOfCandidates",
b)});this.pc.on("offer",function(b){a.parent.config.nick&&(b.nick=a.parent.config.nick);a.send("offer",b)});this.pc.on("answer",function(b){a.parent.config.nick&&(b.nick=a.parent.config.nick);a.send("answer",b)});this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this));this.pc.on("addChannel",this.handleDataChannelAdded.bind(this));this.pc.on("removeStream",this.handleStreamRemoved.bind(this));this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded"));this.pc.on("iceConnectionStateChange",
this.emit.bind(this,"iceConnectionStateChange"));this.pc.on("iceConnectionStateChange",function(){switch(a.pc.iceConnectionState){case "failed":"offer"===a.pc.pc.localDescription.type&&(a.parent.emit("iceFailed",a),a.send("connectivityError"))}});this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange"));this.logger=this.parent.logger;"screen"===b.type?this.parent.localScreens&&this.parent.localScreens[0]&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),
this.pc.addStream(this.parent.localScreens[0]),this.broadcaster=b.broadcaster):this.parent.localStreams.forEach(function(b){a.pc.addStream(b)});this.on("channelOpen",function(b){"https://simplewebrtc.com/protocol/filetransfer#inband-v1"===b.protocol&&(b.onmessage=function(c){c=JSON.parse(c.data);var d=new m.Receiver;d.receive(c,b);a.emit("fileTransfer",c,d);d.on("receivedFile",function(b,a){d.channel.close()})})});this.on("*",function(){a.parent.emit.apply(a.parent,arguments)})}c=b("util");var l=
b("webrtcsupport"),p=b("rtcpeerconnection"),n=b("wildemitter"),m=b("filetransfer");c.inherits(h,n);h.prototype.handleMessage=function(b){var a=this;this.logger.log("getting",b.type,b);b.prefix&&(this.browserPrefix=b.prefix);"offer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleOffer(b.payload,function(b){b||a.pc.answer(function(b,a){})})):"answer"===b.type?(this.nick||(this.nick=b.payload.nick),delete b.payload.nick,this.pc.handleAnswer(b.payload)):"candidate"===
b.type?this.pc.processIce(b.payload):"connectivityError"===b.type?this.parent.emit("connectivityError",a):"mute"===b.type?this.parent.emit("mute",{id:b.from,name:b.payload.name}):"unmute"===b.type&&this.parent.emit("unmute",{id:b.from,name:b.payload.name})};h.prototype.send=function(b,a){a={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:b,payload:a,prefix:l.prefix};this.logger.log("sending",b,a);this.parent.emit("message",a)};h.prototype.sendDirectly=function(b,a,c){c=
{type:a,payload:c};this.logger.log("sending via datachannel",b,a,c);b=this.getDataChannel(b);if("open"!=b.readyState)return!1;b.send(JSON.stringify(c));return!0};h.prototype._observeDataChannel=function(b){var a=this;b.onclose=this.emit.bind(this,"channelClose",b);b.onerror=this.emit.bind(this,"channelError",b);b.onmessage=function(c){a.emit("channelMessage",a,b.label,JSON.parse(c.data),b,c)};b.onopen=this.emit.bind(this,"channelOpen",b)};h.prototype.getDataChannel=function(b,a){if(!l.supportDataChannel)return this.emit("error",
Error("createDataChannel not supported"));var c=this.channels[b];a||(a={});if(c)return c;c=this.channels[b]=this.pc.createDataChannel(b,a);this._observeDataChannel(c);return c};h.prototype.onIceCandidate=function(b){if(!this.closed)if(b){var a=this.parent.config.peerConnectionConfig;"moz"===l.prefix&&a&&a.iceTransports&&b.candidate&&b.candidate.candidate&&0>b.candidate.candidate.indexOf(a.iceTransports)?this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",a.iceTransports):
this.send("candidate",b)}else this.logger.log("End of candidates.")};h.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc");this.pc.offer(this.receiveMedia,function(b,a){})};h.prototype.icerestart=function(){var b=this.receiveMedia;b.mandatory.IceRestart=!0;this.pc.offer(b,function(b,a){})};h.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())};h.prototype.handleRemoteStreamAdded=function(b){var a=this;this.stream?this.logger.warn("Already have a remote stream"):
(this.stream=b.stream,this.stream.getTracks().forEach(function(b){b.addEventListener("ended",function(){d(a.stream)&&a.end()})}),this.parent.emit("peerStreamAdded",this))};h.prototype.handleStreamRemoved=function(){var b=this.parent.peers.indexOf(this);-1<b&&(this.parent.peers.splice(b,1),this.closed=!0,this.parent.emit("peerStreamRemoved",this))};h.prototype.handleDataChannelAdded=function(b){this.channels[b.label]=b;this._observeDataChannel(b)};h.prototype.sendFile=function(b){var a=new m.Sender,
c=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:"https://simplewebrtc.com/protocol/filetransfer#inband-v1"});c.onopen=function(){c.send(JSON.stringify({size:b.size,name:b.name}));a.send(b,c)};c.onclose=function(){console.log("sender received transfer");a.emit("complete")};return a};a.exports=h},{filetransfer:26,rtcpeerconnection:44,util:63,webrtcsupport:64,wildemitter:65}],68:[function(b,a,c){function d(b){var a=this,c=b||{},d=this.config={url:"https://sandbox.simplewebrtc.com:443/",
socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}},e;var k=b.debug?b.logger||console:b.logger||m;this.logger=k;for(e in c)c.hasOwnProperty(e)&&(this.config[e]=c[e]);this.capabilities=p;l.call(this);var q=null===this.config.connection?this.connection=
new g(this.config):this.connection=this.config.connection;q.on("connect",function(){a.emit("connectionReady",q.getSessionid());a.sessionReady=!0;a.testReadiness()});q.on("message",function(b){var c=a.webrtc.getPeers(b.from,b.roomType);if("offer"===b.type){c.length&&c.forEach(function(a){a.sid==b.sid&&(d=a)});if(!d){var d=a.webrtc.createPeer({id:b.from,sid:b.sid,type:b.roomType,enableDataChannels:a.config.enableDataChannels&&"screen"!==b.roomType,sharemyscreen:"screen"===b.roomType&&!b.broadcaster,
broadcaster:"screen"!==b.roomType||b.broadcaster?null:a.connection.getSessionid()});a.emit("createdPeer",d)}d.handleMessage(b)}else c.length&&c.forEach(function(a){b.sid?a.sid===b.sid&&a.handleMessage(b):a.handleMessage(b)})});q.on("remove",function(b){b.id!==a.connection.getSessionid()&&a.webrtc.removePeers(b.id,b.type)});b.logger=this.logger;b.debug=!1;this.webrtc=new h(b);"mute unmute pauseVideo resumeVideo pause resume sendToAll sendDirectlyToAll getPeers".split(" ").forEach(function(b){a[b]=
a.webrtc[b].bind(a.webrtc)});this.webrtc.on("*",function(){a.emit.apply(a,arguments)});if(d.debug)this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:"));this.webrtc.on("localStream",function(){a.testReadiness()});this.webrtc.on("message",function(b){a.connection.emit("message",b)});this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this));this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this));this.config.adjustPeerVolume&&(this.webrtc.on("speaking",
this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1)));q.on("stunservers",function(b){a.webrtc.config.peerConnectionConfig.iceServers=b;a.emit("stunservers",b)});q.on("turnservers",function(b){a.webrtc.config.peerConnectionConfig.iceServers=a.webrtc.config.peerConnectionConfig.iceServers.concat(b);a.emit("turnservers",b)});this.webrtc.on("iceFailed",function(b){});this.webrtc.on("connectivityError",function(b){});this.webrtc.on("audioOn",
function(){a.webrtc.sendToAll("unmute",{name:"audio"})});this.webrtc.on("audioOff",function(){a.webrtc.sendToAll("mute",{name:"audio"})});this.webrtc.on("videoOn",function(){a.webrtc.sendToAll("unmute",{name:"video"})});this.webrtc.on("videoOff",function(){a.webrtc.sendToAll("mute",{name:"video"})});this.webrtc.on("localScreen",function(b){var c=document.createElement("video"),d=a.getRemoteVideoContainer();c.oncontextmenu=function(){return!1};c.id="localScreen";n(b,c);d&&d.appendChild(c);a.emit("localScreenAdded",
c);a.connection.emit("shareScreen");a.webrtc.peers.forEach(function(b){"video"===b.type&&(b=a.webrtc.createPeer({id:b.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:a.connection.getSessionid()}),a.emit("createdPeer",b),b.start())})});this.webrtc.on("localScreenStopped",function(b){a.getLocalScreen()&&a.stopScreenShare()});this.webrtc.on("channelMessage",function(b,c,d){"volume"==d.type&&a.emit("remoteVolumeChange",b,d.volume)});
this.config.autoRequestMedia&&this.startLocalVideo()}var h=b("./webrtc"),l=b("wildemitter"),p=b("webrtcsupport"),n=b("attachmediastream"),m=b("mockconsole"),g=b("./socketioconnection");d.prototype=Object.create(l.prototype,{constructor:{value:d}});d.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare();this.emit("leftRoom",this.roomName);this.roomName=void 0}};d.prototype.disconnect=
function(){this.connection.disconnect();delete this.connection};d.prototype.handlePeerStreamAdded=function(b){var a=this,c=this.getRemoteVideoContainer(),d=n(b.stream);b.videoEl=d;d.id=this.getDomId(b);c&&c.appendChild(d);this.emit("videoAdded",d,b);window.setTimeout(function(){a.webrtc.isAudioEnabled()||b.send("mute",{name:"audio"});a.webrtc.isVideoEnabled()||b.send("mute",{name:"video"})},250)};d.prototype.handlePeerStreamRemoved=function(b){var a=this.getRemoteVideoContainer(),c=b.videoEl;this.config.autoRemoveVideos&&
a&&c&&a.removeChild(c);c&&this.emit("videoRemoved",c,b)};d.prototype.getDomId=function(b){return[b.id,b.type,b.broadcaster?"broadcasting":"incoming"].join("_")};d.prototype.setVolumeForAll=function(b){this.webrtc.peers.forEach(function(a){a.videoEl&&(a.videoEl.volume=b)})};d.prototype.joinRoom=function(b,a){var c=this;this.roomName=b;this.connection.emit("join",b,function(d,e){console.log("join CB",d);M(e);if(d)c.emit("error",d);else{if(!e.xtra){kb();Kb();Fh(A.errorLoading,"#ff0000");return}t.room=
e.xtra;var h,l;for(h in e.clients){var p=e.clients[h];for(l in p)if(p[l]){var n=c.webrtc.createPeer({id:h,type:l,enableDataChannels:c.config.enableDataChannels&&"screen"!==l,receiveMedia:{offerToReceiveAudio:"screen"!==l&&c.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:c.config.receiveMedia.offerToReceiveVideo}});c.emit("createdPeer",n);n.start()}}}a&&a(d,e);c.emit("joinedRoom",b)})};d.prototype.getEl=function(b){return"string"===typeof b?document.getElementById(b):b};d.prototype.startLocalVideo=
function(){var b=this;this.webrtc.start(this.config.media,function(a,c){a?b.emit("localMediaError",a):n(c,b.getLocalVideoContainer(),b.config.localVideo)})};d.prototype.stopLocalVideo=function(){this.webrtc.stop()};d.prototype.getLocalVideoContainer=function(){var b=this.getEl(this.config.localVideoEl);if(b&&"VIDEO"===b.tagName)return b.oncontextmenu=function(){return!1},b;if(b){var a=document.createElement("video");a.oncontextmenu=function(){return!1};b.appendChild(a);return a}};d.prototype.getRemoteVideoContainer=
function(){return this.getEl(this.config.remoteVideosEl)};d.prototype.shareScreen=function(b){this.webrtc.startScreenShare(b)};d.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]};d.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var b=document.getElementById("localScreen"),a=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&a&&b&&a.removeChild(b);b&&this.emit("videoRemoved",b);this.getLocalScreen()&&this.webrtc.stopScreenShare();
this.webrtc.peers.forEach(function(b){b.broadcaster&&b.end()})};d.prototype.testReadiness=function(){this.sessionReady&&(this.config.media.video||this.config.media.audio?0<this.webrtc.localStreams.length&&this.emit("readyToCall",this.connection.getSessionid()):this.emit("readyToCall",this.connection.getSessionid()))};d.prototype.createRoom=function(b,a){this.roomName=b;this.connection.emit("create",t.room,a)};d.prototype.sendFile=function(){if(!p.dataChannel)return this.emit("error",Error("DataChannelNotSupported"))};
a.exports=d},{"./socketioconnection":69,"./webrtc":70,attachmediastream:3,mockconsole:37,webrtcsupport:64,wildemitter:65}],69:[function(b,a,c){function d(b){this.connection=h.connect(b.url,b.socketio)}var h=b("socket.io-client");d.prototype.on=function(b,a){this.connection.on(b,a)};d.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)};d.prototype.getSessionid=function(){return this.connection.id};d.prototype.disconnect=function(){return this.connection.disconnect()};a.exports=
d},{"socket.io-client":50}],70:[function(b,a,c){function d(b){var a=this,c=b||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:!0};var d;b=b.debug?b.logger||console:b.logger||l;this.logger=b;for(d in c)c.hasOwnProperty(d)&&(this.config[d]=c[d]);h.support||this.logger.error("Your browser doesn't seem to support WebRTC");this.peers=[];
p.call(this,this.config);this.on("speaking",function(){a.hardMuted||a.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"speaking"})))})});this.on("stoppedSpeaking",function(){a.hardMuted||a.peers.forEach(function(b){b.enableDataChannels&&(b=b.getDataChannel("hark"),"open"==b.readyState&&b.send(JSON.stringify({type:"stoppedSpeaking"})))})});this.on("volumeChange",function(b,c){a.hardMuted||a.peers.forEach(function(a){a.enableDataChannels&&
(a=a.getDataChannel("hark"),"open"==a.readyState&&a.send(JSON.stringify({type:"volume",volume:b})))})});if(this.config.debug)this.on("*",function(b,c,d){(a.config.logger===l?console:a.logger).log("event:",b,c,d)})}c=b("util");var h=b("webrtcsupport"),l=b("mockconsole"),p=b("localmedia"),n=b("./peer");c.inherits(d,p);d.prototype.createPeer=function(b){b.parent=this;b=new n(b);this.peers.push(b);return b};d.prototype.removePeers=function(b,a){this.getPeers(b,a).forEach(function(b){b.end()})};d.prototype.getPeers=
function(b,a){return this.peers.filter(function(c){return(!b||c.id===b)&&(!a||c.type===a)})};d.prototype.sendToAll=function(b,a){this.peers.forEach(function(c){c.send(b,a)})};d.prototype.sendDirectlyToAll=function(b,a,c){this.peers.forEach(function(d){d.enableDataChannels&&d.sendDirectly(b,a,c)})};a.exports=d},{"./peer":67,localmedia:35,mockconsole:37,util:63,webrtcsupport:64}]},{},[68])(68)});var D,xa,A={},t={name:"Guest"};console.log("%c nehhon %c POWER ","background: #000; color: #00ffff; font-size:35px",
"background: #00ffff; color: #000; font-size:35px");console.log("%c Author: Ruben ","background: #00ffff; color: #000; font-size:35px");console.log("%c webmaster@nehhon.com ","background: #00ffff; color: #000; font-size:35px");console.log("%c @nehhon ","background: #00ffff; color: #000; font-size:35px");var v=function(a){return document.getElementById(a)},Uj=!!window.opr||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),Vj="undefined"!==typeof InstallTrigger,Wj=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),
Gh=!!document.documentMode,Xj=!Gh&&!!window.StyleMedia,Yj=!!window.chrome&&!!window.chrome.webstore,qc;Uj?qc="Opera":Vj?qc="Firefox":Wj?qc="Safari":Gh?qc="IE":Xj?qc="Edge":Yj&&(qc="Chrome");t.navLang=navigator.language||navigator.userLanguage;(function(){var a=t.navLang.substr(0,2);({es:1,it:1,pl:1,ru:1,pt:1,bg:1,de:1})[a]&&(window.history.pushState("","","/"+a+"/"+location.hash),document.getElementsByTagName("html")[0].lang=a)})();t.race=0;t.navigator=qc;t.mx=151;t.onlineID=null;t.temperature=0;
var Zj=location.pathname.split("/")[1],Hh="en es it pt ru pl bg de".split(" ");t.lang=Hh.indexOf(Zj);0>t.lang&&(t.lang=0);t.langCodeUrl=t.lang?Hh[t.lang]+"/":"";var M=console.log,ak=document.getElementById("alerttitle"),bk=document.getElementById("alerttext"),ck=document.getElementById("alert"),rc=function(a,b,d){ck.style.display="block";ak.innerHTML=b||A.warning;bk.innerHTML=a;d?document.getElementById("alertok").style.display="none":document.getElementById("alertok").style.display="block";v("basic").style.filter=
"blur(94px)"},sh,Jh=function(a,b,d){var f=new XMLHttpRequest;f.open("GET",a,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");f.onreadystatechange=function(){4==this.readyState&&200==this.status&&(b.length?W[b]=Ih(f.response):W.xtra[b]=Ih(f.response),W.load++,Ib&&W.load===W.images&&Ib())};d&&(f.onprogress=function(b){d(b)});f.send(!0)},Ih=function(a){performance.now();a=new Uint16Array(a);var b=a.length,f=a[b-4]+65536*a[b-3],c=a[b-
2]+65536*a[b-1];b-=2;var e=-1;c=new Uint8Array(4*c);for(var h=0;f<b;f++){var l=a[f];if(65533<l){65535==l?(l=a[f+1],f+=1):(l=a[f+1]+65536*a[f+2],f+=2);for(var p=0;p<l;p++)c[h++]=e&255,c[h++]=e>>8&255,c[h++]=e>>16&255,c[h++]=e>>24&255}else l=a[2*l]+65536*a[2*l+1],c[h++]=l&255,c[h++]=l>>8&255,c[h++]=l>>16&255,c[h++]=l>>24&255,e=l}return c},W={size:512,load:0,xtra:[]},Ib;W.xtraRes=[];var X={page:0,length:8,leftButton:document.getElementById("aleft"),rightButton:document.getElementById("aright"),stock:document.getElementById("stock")},
k;(function(){var a=0,b=0,d=function(f){f.target.loadedSize||(b+=f.total,f.target.lastLoaded=0,f.target.loadedSize=!0);a+=f.loaded-f.target.lastLoaded;f.target.lastLoaded=f.loaded;c.innerHTML=A.loadgraphics+" "+~~(100*a/b)+"%";c.style.display=a>=b?"none":"block"},c=document.getElementById("notifybottom"),e=function(b){var a=!!b.icons;W.images=Object.keys(b).length;if(a){var f=new XMLHttpRequest;f.open("GET",b.icons,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");
f.onreadystatechange=function(){if(4===f.readyState&&200===f.status){var b=new Uint8Array(f.response);b=new Blob([b],{type:"image/png"});var a=new Image;a.src=URL.createObjectURL(b);W.load++;X.icons=a;Ib&&W.load===W.images&&Ib();Date.now()}};f.onprogress=function(b){d(b)};f.send("")}Date.now();var c=new XMLHttpRequest;c.open("GET",b.imageJSON,!0);a&&c.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");c.onreadystatechange=function(){4==this.readyState&&200==this.status&&
(W.load++,Ib&&W.load===W.images&&Ib(),k=JSON.parse(c.response))};c.onprogress=function(b){d(b)};c.send(!0);Jh(b.common,"common",d)};(function(){var b=!1;"serviceWorker"in navigator?(console.log("CLIENT: service worker registration in progress."),navigator.serviceWorker.register("/sworker.js").then(function(){console.log("CLIENT: service worker registration complete.")},function(b){M(b);console.log("CLIENT: service worker registration failure.")})):console.log("CLIENT: service worker is not supported.");
sh=function(){W.started=!0;b||(b=!0,e({icons:"https://dl.dropboxusercontent.com/s/mpc0k7ep2l0v0j2/icons.png",imageJSON:"https://dl.dropboxusercontent.com/s/iea7wlmxml6pus0/images.json",common:"https://dl.dropboxusercontent.com/s/avpm3elzmphq5b1/graphics.nh17"}))}})();setTimeout(function(){W.load<W.images&&(c.style.display="block")},1200)})();var If={grass:{json:"agjeb95idjel2dr/terrainData.json?v5",main:"xg1qh97bjrm61x0/grass.nh17"},snow:{json:"hwja6mugluokbkh/terrainData.json?v3",main:"1x2cwzm0i7v2sz8/terrain.nh17?v1"},
last:""},ce,Oj=function(){W.images+=2;var a=If[v("terrainSelect").value];If.last=v("terrainSelect").value;var b=new XMLHttpRequest;b.open("GET","https://dl.dropboxusercontent.com/s/"+a.json,!0);b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onreadystatechange=function(){if(4==this.readyState&&200==this.status){W.xtraRes[0]=JSON.parse(b.response);Sb=W.xtraRes[0];var a=Sb.specialColor;ce=new Float32Array(xb(a[0]/255,a[1]/255,a[2]/255,.9));W.load++;a="rgb("+a[0]+
","+a[1]+","+a[2]+")";v("msgs1").style.color=a;v("playersinfo").style.color=a;v("topinfo").style.color=a;Ib&&W.load===W.images&&Ib()}};b.send(!0);Jh("https://dl.dropboxusercontent.com/s/"+a.main,0,!1)};if("undefined"!==typeof AudioContext){var Kh=function(a,b,d){b=b.split("/")[1].split(".")[0].toLowerCase();de[b]=a;!d||d.music&&d.mid!=Ia.id||(ma(b,d.x,d.y,d.k,d.music,d.date),d.date=0)},Lh=function(a,b,d){this.context=a;this.urlList=b;this.onload=d;this.loadCount=0};Lh.prototype.loadBuffer=function(a,
b){var f=new XMLHttpRequest;f.open("GET",dk+a,!0);f.responseType="arraybuffer";f.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");var c=this;f.onreadystatechange=function(){4===f.readyState&&200===f.status&&c.context.decodeAudioData(f.response).then(function(f){f&&Kh(f,a,b)})};f.send()};var de={},Mh="kwf09yi8p5vq1px/Tzar%20Soundtrack%201.mp3 0d7r5b6yq8rvzxa/Tzar%20Soundtrack%202.mp3 6sc2lejtpq5hn1p/Tzar%20Soundtrack%203.mp3 0r454nszfs18sk8/Tzar%20Soundtrack%204.mp3 2qza05mvhvojepw/Tzar%20Soundtrack%205.mp3 55yuwxmo3ebav3v/Tzar%20Soundtrack%206.mp3 d9ifze8utu7b1d4/Tzar%20Soundtrack%207.mp3 ewnlwat5mpm3a6i/Tzar%20Soundtrack%208.mp3 emy8tmk7wrbxqik/Tzar%20Soundtrack%209.mp3 0ryt8t85pu140ys/Tzar%20Soundtrack%2010.mp3 ux3nmflf1efo0si/sr1.mp3 mb8leyhrlx3a8ep/sr2.mp3 uepj5sz037fs6jm/sr3.mp3 aqgug89aiyh78ym/sr4.mp3 v4mnk06t1cm5g2x/sr5.mp3 nnkkl7jddynbbg8/sr6.mp3 0foqk5c3t91c0ll/sr7.mp3 cacamdny4wwisyj/sr8.mp3 m8mbt8r1vlj2i9l/sr9.mp3 ubig3no0l96pnxp/sr10.mp3 jajip2pw72hwz5q/1.mp3 eub8hy6mtuw12vk/2.mp3 mml4nqhhj0ph30d/3.mp3 p72cdqjbjc7oa6v/4.mp3 m895z5a7e1stzg1/5.mp3 ya1yue1ti1ehyo8/6.mp3 lfq7ac9jvtcb8tr/7.mp3 onxh886y06v9c1m/8.mp3 u01v2nu5u1mooma/9.mp3 hfvvah4t7ngs942/10.mp3 zghe44ohag94non/INTRO.mp3 bjdukzb5x2d148f/OUTRO.mp3 m335ymfbydtah6n/WIN1.mp3 j0nl2nra3633p0m/WIN2.mp3 9igi2qh7ixqej07/ATTACK.WAV d48c9woeedsefpq/BALLISTA.WAV toc4s5nzofcrl7a/BLDGDONE.WAV c8k3wd0wmlgxzbj/CHAT%20LOCATION.WAV ser4l9wo87txp9k/TECHDONE.WAV 9f37sjm7co5ccuj/UNITDONE.WAV 6xn0s3j79267158/CHAT.WAV v39gv0xmfobxhm6/E_CASTLE1.WAV 2d9cjalgge5ig3g/E_CATHEDRAL1.WAV xmfkvzft63m3ivi/E_CATHEDRAL2.WAV vzzhxrrqftezh2b/E_FARM1.WAV ftrazbogpf8foip/E_CHURCH1.WAV 961xangoq096ta1/E_FARM2.WAV 5927kzdwz5znu6o/E_HARBOR1.WAV wwjtlgwpm230rqx/E_LUMBER1.WAV a4buxao1lfo5txs/E_MAGETOWER1.WAV mgcz1j57ijivnrx/E_MAGETOWER2.WAV mlqr06rsg0ebg5c/E_MAGETOWER3.WAV jcut9rj4pedruuf/E_MARKET1.WAV m7rpubt227a2mqm/E_SHIPYARD1.WAV dtlikm0f72bqts6/E_STABLES1.WAV 189t8l14j3gfbcd/E_STORAGE1.WAV 6u92t20jjl2ibax/E_OUTPOST1.WAV o6psq5jg611te7h/E_STORAGE2.WAV jpnp0pwsjfajpqh/E_TAVERN1.WAV omdobwnv6ijrdk6/E_WARACADEMY1.WAV xfph6w0wl72iy14/E_WORKSHOP1.WAV m9nzrabgjly054c/EVILCASTLE.WAV o1vdoiexa6q41kd/GATE1.WAV 0i8okhmc24fie1i/GATE2.WAV gcic4rgv7th76g5/GATE3.WAV 1gcczjnk6800a0w/GATE4.WAV s35f76gtwm27r2t/GATE5.WAV jkkktkeqcinw0qk/GATE6.WAV 0qsz059kx5x0fna/GATEWAY.WAV dx4ykguy0c2gkec/HOUSE1.WAV 0bu3c206awygol8/HOUSE2.WAV ixuujwh5i34jqyn/HOUSE3.WAV gtsdx7aq1qo1af9/HOUSE4.WAV y89q2pti77rnl62/HOUSE5.WAV slzdb82f2pq9efh/MERCHANT.WAV hxb9ppcht4b1agh/MINE1.WAV kmvph19wybjvtk3/MONASTERY1.WAV trjbjumhpdq2r6c/MONASTERY2.WAV xdzl5qyez51vp0i/R_CATHEDRAL1.WAV 0jfe5axwda2zy9m/R_CHURCH1.WAV jp0ya01e6lovbpv/SHAOLIN2.WAV sa97rwaqc4bczzg/SHAOLIN.WAV ba9yor9562k8rmk/CHOP%201.WAV 0yq403uktwmaskq/CHOP%202.WAV oumccxj3ppx74lb/CHOP%203.WAV zjlmh6oyt9z80vn/CHOP%204.WAV 8q3x45ooavhgdxf/CHOP%205.WAV tyyuf0ai2b7td9d/CHOP%206.WAV mxk7ilq612mco8y/CHOP%207.WAV vi1nql8csgxue0d/CHOP%208.WAV ptkzwv8er5r250q/CHOP%209.WAV e47rp6twlz7cvor/CHOP%2010.WAV swpbug0t56ool1r/CHOP%2011.WAV 2ddruqf84gi974h/DIG%201.WAV mdv1kf8bb7e6bwj/DIG%202.WAV u7h8iw95x8ufogy/DIG%203.WAV myb354s27trhsgb/MINE%201.WAV 3jca7grtu2uphde/MINE%202.WAV 0sgl0kc77mryj1j/MINE%203.WAV ry9mlisv1lqqp9d/HIT%201.WAV 2ufyfcq4wu9bk1i/HIT%202.WAV cqzlr7gy6mj0k66/HIT%203.WAV i86tqxj1sz91cru/HIT%204.WAV vf604r6t01qe6zd/HIT%205.WAV mnslicm4wy9wdj0/HIT%206.WAV p1ta2wlhfse37db/HIT%207.WAV emwp2hib6msgj22/GHOST1.WAV lrsl9rbxku5cjg7/GHOST2.WAV txbl2bb91s38dqx/GOLEM1.WAV pcfkaldpd7hfrjp/GOLEM2.WAV ivfai5ayu6q99yx/H%20SWORD%201.WAV gedtsneew008x4h/H%20SWORD%202.WAV 57xjkhtc93001et/H%20SWORD%203.WAV ni97b3dbi91yr8b/H%20SWORD%204.WAV 0ls1kz4but9zl51/H%20SWORD%205.WAV ks9mme9djnvdyi5/H%20SWORD%206.WAV hlinmaxi6xj6mv2/H%20SWORD%207.WAV hlinmaxi6xj6mv2/H%20SWORD%207.WAV dt4o378w3100sfu/H%20SWORD%208.WAV ks909spplow4fjz/H%20SWORD%209.WAV w2xfv47ffd7sb72/H%20SWORD%2010.WAV ypapwgz03m7utmq/H%20SWORD%2011.WAV zdcr00adm5qc6hs/H%20SWORD%2012.WAV y90qo1djcx5bzxa/HAND1.WAV 56vhwy7iiu9cpzy/HAND2.WAV 6zhms0m94qg4mvt/HAND3.WAV 41wm4r3cpgjaxly/HAND4.WAV tt4q17tzh6i7u1g/MAGE%20ATTACK.WAV ldhx6mr9upxefci/MESSIAH.WAV 07mie3az1eg1xxh/ORC%20SWORD%201.WAV 9v7spriyxf9szgh/ORC%20SWORD%202.WAV gcfojobbzl2drpn/ORC%20SWORD%203.WAV x0wz0zwpye9i5y3/ORC%20SWORD%204.WAV 2300jmtwppvm452/ORC%20SWORD%205.WAV 3yz2rottu8o8ggt/ORC%20SWORD%206.WAV x5s65vpufpj8t06/ORC%20SWORD%20V1.WAV 0nrb17mzbu3lxtc/ORC%20SWORD%20V2.WAV cypkkpihc1w1hcq/ORC%20SWORD%20V3.WAV y8umilh5cud7jih/SHIP%20CANNON%201.WAV 09kjxvpfn9bdprd/SHIP%20CANNON%202.WAV atj8b8w1k24aqfm/SHIP%20CANNON%203.WAV 6ju34h2pw3nhg7s/SHIP%20CANNON%204.WAV l18s2fbq9q6nzpm/SHIP%20CANNON%205.WAV vrgh4puvgdbpwae/SHIP%20CANNON%206.WAV tmbpku710qnx85q/SHIP%20CANNON%207.WAV 2nomenens1x41lf/SIEGE.WAV 8t9zd51oee3n6vw/SWORD%201.WAV gmwu6lxjaf4mxvv/SWORD%202.WAV tfjzh0u37b60xfc/SWORD%203.WAV s0w71lijsebscys/SWORD%204.WAV 63xcxvtf6fz4nmv/SWORD%205.WAV qpqihts3djiavqd/SWORD%206.WAV zw2cqwnqq5bo3aw/SWORD%207.WAV ub1hntg5qh5h58k/SWORD%208.WAV r4viyma73vblsf5/SWORD%209.WAV 8lxp86hri1yejyt/SWORD%2010.WAV r63199ryslobulc/SWORD%2011.WAV ph48z41qbgbaina/SWORD%2012.WAV o87veypm8qensdd/SWORD%2013.WAV fwapbo29d97mer1/SWORD%2014.WAV tyzv9eybfmt378i/SWORD%2015.WAV 0164fmqamf7yr9s/SWORD%2016.WAV c9renf4qsr56ab4/V%20SWORD%201.WAV gge4f1nb5o7m9qd/V%20SWORD%202.WAV wo0f0ul88unnh01/V%20SWORD%203.WAV q48z5txon4bv76v/V%20SWORD%204.WAV kibmb5mtp1oasan/V%20SWORD%205.WAV 360bl44ii251dus/V%20SWORD%206.WAV oya931j5cn584vn/V%20SWORD%207.WAV rgh3xwlvihecsur/ADRAGON2.WAV jafi9t4hdx4gjnu/ADRAGON3.WAV p7yau58i9x9tznf/ARROW%201.WAV 16jf0mu2c4902ad/ARROW%202.WAV 3gf1vmhszlzsvp6/ARROW%203.WAV hastp290kjpatul/ARROW%204.WAV rzf63kcptscqqb6/ARROW%205.WAV ueysrsca11dznn1/ARROW%206.WAV 2l7ncb4kro91hjp/ARROW%20V1.WAV 6z1zfcuve202wlt/ARROW%20V2.WAV 4al06dvukghp9p8/ARROW%20V3.WAV y3cj0obmsklz7kb/ARROW%20V4.WAV zopzovz1zdos9qn/BEAR1.WAV glbc40fzxrz7x4u/BEAR2.WAV mq7830e9lsw539i/BEAR3.WAV s5h4p53936jqf0m/BEAR4.WAV at4kj0gz88632rt/BEAR5.WAV uq2u4sgg8g6tmou/MWORKSHOP.WAV 09hjcqjlhkgwjsi/DESTROY%20BUILDING.WAV rxan7ebabmxn77z/DESTROY%20MINE.WAV pcwbjrjklna7q57/LIGHTING2.WAV uv2jv59kstujpap/LIGHTING.WAV 6omy17asgyyvcdg/METEOR.WAV r193yz5l7k7yb2i/SMALL%20EXPLOSION.WAV os6jelw7rx49obm/WATER%20BLOP.WAV tjdz2vmlil8c8ud/SPY%20KILL%201.WAV z9tqra8z2pj8fto/SPY%20KILL%203.WAV l85d5424o8s1tq3/SPY%20KILL%202.WAV 97k844atrp03l71/PRIEST%20ATTACK.WAV 2rs81eunjj79t8m/LIGHTNING.WAV i16vdcztiiyd9pl/INVISIBLE.WAV 01a581w494e6nc3/HEAL.WAV v0f62hdvhy2vhiw/FREEZE.WAV e9xkwqnmq1h3xii/FLAME%20BALL.WAV yn1958raqi2el4a/CURSE.WAV 455t0hvitbn4nns/CRUSADE.WAV 1wl7qmtar3y1j2v/CONFUSION.WAV fz21lqeozbq043o/BLESS.WAV xyq2n7ixn80pyn5/WHIRLPOOL.WAV 1t99pip34fvthkq/TURN%20TO%20STONE.WAV jdclsge6rjo7vgo/TEACH.WAV xt7pqtetzsvtgai/SUMMON10.WAV yxcdbheu9s6sqbp/SUMMON9.WAV oum26s9h0mkg6ya/SUMMON8.WAV 46cvrb8px83r1ze/SUMMON7.WAV of68oo8ne7cgdtw/SUMMON6.WAV 3awiprcaujqvohu/SUMMON5.WAV 5kq2b6q3d8ncpww/SUMMON4.WAV avx69olt3m6rrnr/SUMMON3.WAV m08n1qafeiyqe05/SUMMON2.WAV ui2kvbd47bfmx2b/SUMMON1.WAV k8qekk7sutmpcot/REVEAL.WAV 0q9fghfa9qhq5qw/RESSURECT.WAV cb1pq0ssnmj4jic/COWDIE1.WAV f7wgvizjaklyf7n/COWDIE2.WAV cb1pq0ssnmj4jic/COWDIE1.WAV y5zib4fpfywsurg/COWDIE3.WAV oy9j73ss27gix5z/COWDIE4.WAV 1eyn0em70qu0f2i/DIE%201.WAV 27kh2wyo2o9znoz/DIE%202.WAV u572ytnhxy4km3h/DIE%203.WAV 182gaz77ml2mei7/DIE%204.WAV wpvdhtxbe6yy29z/DIE%205.WAV un94l6ebn0l9y2p/DIE%206.WAV 3k2ph5z9vm6ytvz/DIE%207.WAV hjnvqvyet103hf7/DIE%208.WAV umjfyhfxku3dwvp/DIE%209.WAV x1evcyyuhwy2vd3/DIE%2010.WAV xzk59hp6c4wdk3t/DRAGON%20DIE%201.WAV ar7eck4ow8r5w3s/DRAGON%20DIE%202.WAV emwp2hib6msgj22/GHOST1.WAV lrsl9rbxku5cjg7/GHOST2.WAV 6at0jqhx4dza704/GOLEM.WAV h5ydq4j2zdpkiu8/H%20DIE%201.WAV 1bp2u30m504f314/H%20DIE%202.WAV r5kdxiuj8chfl55/H%20DIE%203.WAV 0gubmigjng965ss/H%20DIE%204.WAV 4xzstnrfwevpx21/H%20DIE%205.WAV pnrvg1i5b0jf50i/H%20DIE%206.WAV wkzig2jil3z2hgi/H%20DIE%207.WAV ue13nwsyc6t5ox9/H%20DIE%208.WAV dxk8rptrddombo8/H%20DIE%209.WAV tsdk3uma1x5rz2v/H%20DIE%2010.WAV i3x6klg1g1tx9xx/MAGE.WAV t7c9h3ntknga8i7/ORC%20DIE%201.WAV zwf40uvu5rdu1wy/ORC%20DIE%202.WAV p9gga0rk3ftkkdf/SHIP%20SINK.WAV 5ihoed06p5cm26r/SIEGE%20DIE%201.WAV tahsd6hynfrv1qg/SIEGE%20DIE%202.WAV xboh1sh4rbvx88r/SIEGE%20DIE%203.WAV 4chclvk26ech3mz/SIEGE%20DIE%204.WAV w401vbbvvj99msr/SKELETON%20DIE%201.WAV 0ff119o39785ttm/SKELETON%20DIE%202.WAV 6lxfa75vtxfl2bb/SKELETON%20DIE%203.WAV f3aokr2ngvqpfit/SKELETON%20DIE%204.WAV omfzz21cazinkkm/MESSIAH_ATTACK.WAV 1w2vexiw5aqtrw4/C%20DIE%201.WAV h32280ztxrrz5aa/C%20DIE%202.WAV rq5rgbwaynrdtfc/C%20DIE%203.WAV usywc7awecnolh0/C%20DIE%204.WAV x33opiu95eb78ie/C%20DIE%205.WAV 4lo6hly2n52aq5b/CAMELDIE1.WAV gwsglwtm1fg2eqf/CAMELDIE2.WAV u3mxrmlb10sje2u/CAMELDIE3.WAV nw0ipg198lvq519/BAT%20ATTACK.WAV hukqtscgut9xic7/BAT%20CMD.WAV 77915sxy83vzump/BAT%20DIE.WAV".split(" ");
(function(){for(var a=0,b=Mh.length;a<b;a++){var d=Mh[a];de[d.split("/")[1].split(".")[0].toLowerCase()]=d}})();var rd="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206 arrow%20v1 arrow%20v2 arrow%20v3 arrow%20v4".split(" "),Vf="arrow%201 arrow%202 arrow%203 arrow%204 arrow%205 arrow%206".split(" "),sc="sword%201 sword%202 sword%203 sword%204 sword%205 sword%206 sword%207 sword%208 sword%209 sword%2010 sword%2011 sword%2012 sword%2013 sword%2014 sword%2015 sword%2016 v%20sword%201 v%20sword%202 v%20sword%203 v%20sword%204 v%20sword%205 v%20sword%206 v%20sword%207".split(" "),
Wf=["siege"],Nh=["hand1","hand2","hand3","hand4"],ee="h%20sword%201 h%20sword%202 h%20sword%203 h%20sword%204 h%20sword%205 h%20sword%206 h%20sword%207 h%20sword%208 h%20sword%209 h%20sword%2010 h%20sword%2011 h%20sword%2012".split(" "),ek=["ork%20sword%20v1","ork%20sword%20v2","ork%20sword%20v3"],fe="ship%20cannon%201 ship%20cannon%202 ship%20cannon%203 ship%20cannon%204 ship%20cannon%205 ship%20cannon%206 ship%20cannon%207".split(" "),fk=["ghost%201","ghost%202"],gk=["mage%20attack"],O=["destroy%20building"],
Xf=["siege%20die%201","siege%20die%202","siege%20die%203","siege%20die%204"],ge="h%20die%201 h%20die%202 h%20die%203 h%20die%204 h%20die%205 h%20die%206 h%20die%207 h%20die%208 h%20die%209 h%20die%2010".split(" "),Za="die%201 die%202 die%203 die%204 die%205 die%206 die%207 die%208 die%209 die%2010".split(" "),Oh=["e_barrack1"],dk="https://dl.dropboxusercontent.com/s/";window.AudioContext=window.AudioContext||window.webkitAudioContext;var tc=new AudioContext;var he=tc.createGain();var ie=tc.createGain();
var hk=new Lh(tc,void 0,Kh);he.gain.value=parseInt(document.getElementById("musicRange").value)/100;ie.gain.value=parseInt(document.getElementById("soundRange").value)/100;var Ia=function(){if(!r.editor){Ia.id++;localStorage.setItem("favMusic",musicSelect.mversion.value);var a=Ia.list[musicSelect.mversion.value];a&&ma(a[~~(a.length*Math.random())],0,0,void 0,1,0,Ia.id)}};document.getElementById("musicRange").oninput=function(){he.gain.value=parseInt(document.getElementById("musicRange").value)/100};
document.getElementById("soundRange").oninput=function(){ie.gain.value=parseInt(document.getElementById("soundRange").value)/100};Ia.reset=function(){Ia.stop();Ia()};Ia.stop=function(){Ia.active&&(Ia.active.stop(),clearTimeout(Ia.intv))};Ia.id=0;Ia.list={originalMusic1:[1,2,3,4,5,6,7,8,9,10,"outro"],originalMusic:"tzar%20soundtrack%201 tzar%20soundtrack%202 tzar%20soundtrack%203 tzar%20soundtrack%204 tzar%20soundtrack%205 tzar%20soundtrack%206 tzar%20soundtrack%207 tzar%20soundtrack%208 tzar%20soundtrack%209 tzar%20soundtrack%2010".split(" "),
sharpRain:"sr1 sr2 sr3 sr4 sr5 sr6 sr7 sr8 sr9 sr10".split(" ")};var ma=function(a,b,d,c,e,h,l){var f=a;if((a=de[a])&&"loading"!==a&&!r.canceled){var n=-bb+(window.innerWidth-t.mx)/2,m=-cb+window.innerHeight/2;if(a.duration){if(r.started)if(64<r.now()-a.lastPlayed||!a.lastPlayed)a.lastPlayed=r.now();else return;!e&&"attack"!=f&&h&&600<Date.now()-h||(b?(b=(-n+32*b)/80,d=(-m+32*d)/80,m=da/8):m=d=b=0,void 0!==c&&c!==t.kingdom||r.mute||(c=tc.createBufferSource(),c.buffer=a,e?(c.connect(he),he.connect(tc.destination),
Ia.active=c,Ia.intv=setTimeout(Ia,~~(1E3*a.duration)+1E3)):(a=tc.createPanner(),a.panningModel="HRTF",a.setPosition(b,d,m),c.connect(a),a.connect(ie),ie.connect(tc.destination)),c.start(0)))}else de[f]="loading",e={x:b,y:d,k:c,music:e,date:Date.now(),mid:l},hk.loadBuffer(a,e)}}}var sd=function(a,b,d,c){a.img===c.url&&(ma(b+~~(Math.random()*d+1),a.x32,a.y32),setTimeout(sd,Ca(c),a,b,d,c))};(function(){for(var a=document.getElementById("musicSelect").getElementsByTagName("input"),b=0,d=a.length;b<d;b++)a[b].onchange=
Ia.reset})();var ik=function(a){for(var b=[],f=0,c=[a.icons],e=0,h=c.length;e<h;e++)for(var l=c[e],p=0,n=l.length;p<n;p++)if(l[p]){var m=l[p];m.doneBy||(m.doneBy=[]);m.doneBy.put(a);b[f++]=m;m.xtra&&(c.put(m.xtra),h++)}a.habilities=b},jk=function(a,b){return b.balanceTotal-a.balanceTotal},Yf=function(a,b){return b.priority-a.priority},kk=function(a,b){return a-b},je=function(a,b){if(!a.url.attack||a.attackOnly&&!a.attackOnly[b.type])return 0;var f=25*~~(Ca(a.url.attack)/25);a=a.attack*((Wc[a.type][b.type]||
0)+1);a-=b.defence;1>a&&(a=1);return~~(b.health/a)*f},sb=function(a){this.kingdom=a.k;this.aggressive=this.perfection=1;sb.arr.put(this)};sb.prototype.valorateLost=function(a){this.script.put({order:a.nu,obj:a,priority:1})};var Zf=function(a,b,d,c,e){var f=d.obj.cost;c[0]+=f[0];c[1]+=f[1];c[2]+=f[2];c[3]+=f[3];a[a.length]={order:d,priority:b.priority,name:d.obj.name,obj:d.obj,pTime:b.obj.time,required:1,doner:e};a.changed=!0},$f=function(a,b,d,c,e){var f=[a],l=[],p={},n=e.target;l.put(a);for(var m=
0;m<f.length;m++){var g=f[m];g.availables&&(g.availables=void 0);if((a=g.order)&&!p[g.order.id]&&(p[g.order.id]=1,!d[a.id])){var k=a.requireObj;if(k)for(var u=0,E=k.length;u<E;u++)if(a=k[u],a.tech)b[a.nu.id]||d[a.nu.id]||Zf(f,g,a.nu,n);else{var r=c[a.type];r.length||Zf(f,g,a.nu,n)}if(k=a.doneBy)for(u=0,E=k.length;u<E;u++)a=k[u],r=c[a.type],r.length||a.race!=e.racestr||Zf(f,g,a.nu,n,1);m&&!g.doner&&l.put(g)}}return l},ag={food:2,wood:1,gold:0,stone:3},td=function(a,b){a=a.order;var f=td.tech;a.obj.build&&
(f=td.build);return f(a,b)};td.tech=function(a,b){a=a.doneBy;for(var f=0,c=a.length;f<c;f++)for(var e=b[a[f].type],h=0,l=e.length;h<l;h++)if(e[h].free)return e[h].free=0,[e[h]];return!1};td.build=function(a,b){a=a.doneBy;for(var f=0,c=a.length;f<c;f++)for(var e=b[a[f].type],h=0,l=e.length;h<l;h++)if(e[h].free)return e[h].free=0,[e[h]];return!1};var fc=function(a,b){if(a){var f=a.order,c=f.obj,e=fc.unit;c.tech?e=fc.tech:c.build&&(e=fc.build);return e(f,b,a)}};fc.build=function(a,b){for(var f=[],c=
a.doneBy,e=hb[b.k],h=0,l=c.length;h<l;h++)for(var p=e[c[h].type],n=0,m=p.length;n<m;n++){var g=z[p[n]];if(!g.func&&!g.in){f.put(g.id);break}}if(!f.length)return!1;c=D;g=a.obj;a=g.space;e=g.validator.check;p=b.origin[0];n=b.origin[1];m=n-1;var k=p-1,u=p-40,E=n-40,r=Infinity,t=-1;l=6400;for(h=0;h<l;h++){var N=h%80+u,w=~~(h/80)+E,v=(p-N)*(p-N)+(n-w)*(n-w);1600>v&&v<r&&e(N,w,a,m,k,900>v,b.k)&&(r=v,t=N+w*c)}if(0>t)return!1;ea(Xc,[t,g.type],f);return!0};fc.tech=function(a,b){var f=a.doneBy;b=hb[b.k];for(var c=
[],e=0,h=f.length;e<h;e++)for(var l=b[f[e].type],p=0,n=l.length;p<n;p++){var m=z[l[p]];m.working||m.techStart||!m.built||c.put(m.id)}if(!c.length)return!1;ea(bg,[a.obj.id,a.id],c[0]);return!0};fc.unit=function(a,b,d){d=a.doneBy;b=hb[b.k];for(var f=[],e=0,h=d.length;e<h;e++)for(var l=b[d[e].type],p=0,n=l.length;p<n;p++){var m=z[l[p]];m.working||m.techStart||!m.built||f.put(m.id)}if(!f.length)return!1;ea(ke,[a.obj.type,1,0],f[0]);return!0};sb.prototype.leaveMeAloneIKnowWhatToDo=function(){performance.now();
var a=I[this.kingdom],b=a.resources,d=hb[this.kingdom],c=D,e=a.origin[0],h=a.origin[1],l=h-1,p=e-1,n=e-40,m=h-40;M(n,m);for(var g=0,k=6400,u=0;u<k;u++){var E=u%80+n,t=~~(u/80)+m;1600>(e-E)*(e-E)+(h-t)*(h-t)&&(!(E>=p&&E<=p+2)||t>=l&&t<=l+2)&&0===V[E+t*c]&&na(E,t)&&g++}var w=[];performance.now();for(var N=0,v=0,A=x.length;v<A;v++){var fa=x[v];if(!fa.build&&!fa.item&&!fa.boat&&fa.url.attack&&fa.race==a.racestr&&8!=fa.type){w.put(fa);fa.balanceSum=0;fa.bestBalance=-1;fa.balanceDefence={};for(var F=Infinity,
C=fa.attDist,J=0;J<A;J++){var G=x[J];if(!G.build&&!G.item&&!G.boat&&G.race==a.racestr&&G.url.attack&&8!=G.type&&(N=je(G,fa))){var O=je(fa,G);O&&(N-=O,N+=2E3*C,N<F&&(F=N,fa.bestBalance=G),fa.balanceSum+=N)}}}fa.balanceTotal=fa.balanceSum}w.sort(jk);fa=w[0];for(var H=1E3,Tf={},tb=[],Q=0,P=H;!Tf[fa.type];)Tf[fa.type]=1,tb[Q++]=fa,tb[Q++]=H,G=fa.bestBalance,H=~~(H*je(G,fa)/je(fa,G)+.5),P+=H,fa=G;tb.nu=P-H;for(var U=a.target,W=B,L=W.length,S=[],R=0;R<L;R++){var K=W[R],X;if(!(X=!K.type||K.upgrade||K.type==
T||void 0!==ag[K.value]&&a.resources[K.value]>=U[K.value])){a:{for(var da=K.nu.doneBy,ea=0,Y=da.length;ea<Y;ea++)if(da[ea].race==a.racestr){var ha=!0;break a}ha=!1}X=!ha}X||S.put({order:K.nu,obj:K,original:1,priority:1E-10})}var Z=[];u=0;k=tb.length;for(var ka=tb.nu;u<k;u+=2){var ia=~~(.5+tb[u+1]/ka*250)-d[tb[u].type].length,ca=tb[u];ca=ca.nu;for(var aa=0;aa<ia;aa++)priority=1-aa/ia,S.put({order:ca,priority:priority,obj:ca.obj,original:1})}var ba=0,oa=0,la=a.target,ra={};oa++;la[0]=0;la[1]=0;la[2]=
0;la[3]=0;u=ba=Z.length=0;for(k=S.length;u<k;u++){var xa=S[u].priority,va=$f(S[u],a.technology.actived,a.technology.hidden,d,a);aa=0;for(var ma=va.length;aa<ma;aa++){ca=va[aa];ca.original||(ca.priority=xa);var sa=1;void 0!==ca.priority&&(sa=ca.priority);var ua=ca.obj;ua.increase&&void 0!==ag[ua.value]&&(sa=ua.increase*sa/b[ag[ua.value]]);sa/=ua.time;ca.priority=sa;if(!(0>=ca.priority)){var wa=ca.order.id;!ra[wa]||ca.original?(ra[wa]=ba,Z[ba++]=ca):Z[ra[wa]].priority+=ca.priority}}}var za=!1;Z.sort(Yf);
var Aa={},Ba={},ya={},qa=[],Ja=x.length;for(u=0;u<Ja;ya[u++]=0);for(u=0;u<Z.length;u++){var ja=Z[u];ca=ja.order;var Ga=ja.obj;if(ja.original||ja.required)ja.obj.tech||ya[ja.obj.type]++,qa.put(ja);var Ia=ca.doneBy,Fa=Ga.time;aa=0;for(k=Ia.length;1>aa;aa++){var ta=Ia[aa],Ma=ta.time;if(Ga){for(var Oa=ta,Ka=d[ta.type],La=sb.process,Ua=Fa,Wa=Ka.length,Da=!1,Na=Infinity,Pa=0;Pa<Wa;Pa++){var Ha=z[Ka[Pa]],Ca=0;Ha.build&&(Ha.working||Ha.techStart||!Ha.built)&&(Ha.built?(Ca=(Ha.c-r.cycle)*gc.speed,Ca/=1E3):
(Ca=Ha.time*(Ha.maxHealth-Ha.health)/Ha.maxHealth,Ha.workers&&Ha.workers.length&&(Ca/=Ha.workers.length)));Ha.build||!Ha.func&&!Ha.in||(Ca=Infinity);Ha.nato!=La?(Ha.nato=La,Ha.natoTime=0):Ca+=Ha.natoTime;Ca<Na&&(Na=Ca,Da=Ha)}Da&&Na<=Oa.time?(Da.natoTime+=Ua,za=Da):za=!1}if(!za){Aa[ta.type]||(Aa[ta.type]=[],Ba[ta.type]=[]);var Ea=Aa[ta.type],Va=Ba[ta.type];ya[ta.type]||(ya[ta.type]=0);var ab=!1,gb=0;for(ma=Ea.length+1;gb<ma;gb++){if(void 0==Ea[gb]){var Xa={order:ta.nu,priority:0,obj:ta};Z.put(Xa);
qa.put(Xa);Ea[gb]=0;Va[gb]=Xa;ya[ta.type]++;ab=!0}if(Ea[gb]+Fa<=Ma||ab){Ea[gb]+=Fa;Va[gb].priority+=ja.priority;break}}}}}qa.sort(Yf);var Ra=0;u=0;for(k=qa.length;u<k;u++)if(ja=qa[u].obj,ja.build){var eb=ja.space[ja.space.length-1]+2;Ra+=eb*((ja.space.length-1)/eb+2)}M(Ra,g);if(Ra>g){var ob=g/Ra*.7;u=0;for(k=x.length;u<k;u++)x[u].build&&(ja=ya[u])&&((ja=~~(ja*ob))||(ja=1),ya[u]=ja)}u=0;for(k=qa.length;u<k;u++)ja=qa[u].obj,ja.build&&(ya[ja.type]?ya[ja.type]--:qa[u]=0);for(var ib=0;1>ib;ib++){var Ta=
[],jb={},db={},Za={},lb={},bb=[[]],cb=[0];u=0;for(k=d.length;u<k;u++){lb[u]=0;ja=d[u];var qb=[];Za[u]=qb;gb=0;for(ma=ja.length;gb<ma;gb++)qb[gb]={free:1,type:u}}for(ba=0;ba<cb.length;ba++){var pb=cb[ba],rb=bb[pb];u=0;for(k=rb.length;u<k;u++){var Ya=rb[u],kb=Ya.list;gb=0;for(ma=kb.length;gb<ma;gb++)ja=kb[gb],ja.used||(lb[ja.type]++,ja.used=1,Ta.put(ja.action)),ja.free=1;Ya.obj.tech?jb[Ya.obj.nu.id]=1:Za[Ya.obj.type].put({free:1,type:Ya.obj.type,action:Ya.action})}u=0;for(k=qa.length;u<k;u++)if((ja=
qa[u])&&1===$f(ja,jb,db,Za,a).length&&(kb=td(ja,Za))){var mb=ja.obj.time+pb;bb[mb]||(bb[mb]=[],cb.put(mb));if(ja.obj.tech){if(db[ja.order.id])continue;db[ja.order.id]=1}(ja.original||ja.required)&&Ta.put(ja);bb[mb].put({list:kb,obj:ja.obj,action:ja});qa[u]=void 0}cb.sort(kk)}M(pb);for(var $a=Ta,nb={},Sa=0;Sa<$a.length;Sa++)$a[Sa]&&!$a[Sa].obj.tech&&(nb[$a[Sa].obj.name]||(nb[$a[Sa].obj.name]=0),nb[$a[Sa].obj.name]++);M(nb);qa=Ta;qa.sort(Yf)}this.script=qa};var cg=function(){for(var a=0,b=sb.arr,d=
b.length;a<d;b[a++].maintenance());ya({func:cg},sb.time,1);sb.process++};sb.prototype.maintenance=function(){var a=this.script,b=I[this.kingdom],d=b.technology,c=d.actived,e=d.hidden,h=hb[b.k];d=D;var l={};if(b.values.pop+b.unitLoading>b.values.popMax&&b.values.popMax<=b.values.popLimit){for(var p=lb[b.race].house.nu,n=1,m=0,g=ud.length;m<g;m++)n+=h[ud[m].type].length*ud[m].population;n+b.unitLoading>b.values.popMax&&n<=b.values.popLimit&&fc({order:p,priority:1,obj:p.obj},b)}m=0;for(g=a.length;m<
g;m++)(p=a[m])&&!l[p.order.id]&&1===$f(p,c,e,h,b).length&&(fc(p,b)?a[m]=0:l[p.order.id]=1);a=!1;l=Infinity;var k=b.diplomacy;e=b.origin[0];h=b.origin[1];c=hb[b.k];m=1;for(g=I.length;m<g;m++)if(k[m]&&!I[m].death){p=I[m];n=p.origin[0]-e;var u=p.origin[1]-h;b=n*n+u*u;b<l&&(l=b,a=p)}if(a){b=[];m=n=0;for(g=c.length;m<g;m++)for(u=c[m],l=0,k=u.length;l<k;l++)p=z[u[l]],p.func==Yd.url&&(b[n++]=p.id);if(60<b.length){c=a.origin[0];k=a.origin[1];p=[40,0,-40,0,0,40,0,-40];l=Infinity;m=0;for(g=p.length;m<g;m+=
2)if(n=p[m],u=p[m+1],n+=e+10*Math.sign(n),u+=h+10*Math.sign(u),(n-c)*(n-c)+(k-u)*(k-u)<l&&na(n,u)){l=(n-c)*(n-c)+(k-u)*(k-u);var E=n+u*d}g=E%d;e=~~(E/d);h=-1;n=Infinity;c=hb[a.k];m=0;for(length=c.length;m<length;m++)for(a=c[m],l=0,u=a.length;l<u;l++)p=z[a[l]],p.build&&p.built&&(k=(p.x32-g)*(p.x32-g)+(p.y32-e)*(p.y32-e),k<n&&(n=k,h=p.x32+p.y32*d));-1<h&&ea(Ph,[E,h],b)}}};var Ph=function(a,b){var f=D,c=a[0];a=a[1];var e=a%f;f=~~(a/f);i=0;for(length=b.length;i<length;i++){var h=z[b[i]];6400<(h.x32-e)*
(h.x32-e)+(h.y32-f)*(h.y32-f)?oa(-c,h,vd,h.url.move):oa(-a,h,vd,h.url.move)}ya({func:Qh,data:{list:b,xy:-a}},3E4,1)},Qh=function(a){var b=a.list;a=a.xy;for(var f=0,c=b.length;f<c;f++){var e=z[b[f]];e.death||oa(a,e,vd,e.url.move)}},lk=function(a,b,d,c){var f=D,h;for(h=2;60>=h;h+=2){a--;b--;for(var l=0;l<=h;){var p=V[a+l+f*b];if(2<p&&p!=c&&z[p].type==d)return p;p=V[a+l+f*(b+h)];if(2<p&&p!=c&&z[p].type==d)return p;l++}for(l=0;l<h-1;){l++;p=V[a+f*(b+l)];if(2<p&&p!=c&&z[p].type==d)return p;p=V[a+h+f*(b+
l)];if(2<p&&p!=c&&z[p].type==d)return p}}return!1},Yd=function(a){a=z[a];performance.now();var b=dg(a.id);if(b)return uc(b,[a.id],1);mb(a,1E3)},dg=function(a){a=z[a];if(!a.freezed&&!a.invisible){for(var b=a.x32,f=a.y32,c=I[a.kingdom].diplomacy,e=a.sight,h=D,l=2*e+1,p,n=!!a.confused,m=Infinity,g=!1,k=0,u=l*l;k<u;k++){var E=k%l-e,r=~~(k/l)-e,t=Math.sqrt(E*E+r*r);if(~~t<=e){E+=b;r+=f;for(var N=0;3>N;N++){p=La[N][E+h*r];var w=z[p];if((w&&w.kingdom&&c[w.kingdom]||n)&&!(w.death||w.invisible||a.attackOnly&&
!a.attackOnly[w.type]||p==a.id||w.item)){var v=Wc[a.type][w.type];v||(v=0);w=t*t+.05*w.health-(v+1)*a.attack;w<m&&(g=p,m=w)}}}}return g}},mk=function(a){a.setupINTV(Rh,a.id,1E3)},Rh=function(a){a=z[a];var b=a.free;b||(b=Sh);var f=D,c=a.x32,e=a.y32,h=[];h.length=I.length;for(var l=h.length,p=0;p<l;h[p++]=0);p=0;for(var n=b.length;p<n;p+=2){var m=b[p]+c,g=b[p+1]+e;na(m,g)&&(m=z[V[m+g*f]],m.nocapture||m.build||h[m.kingdom]++)}f=b=0;for(p=1;p<l;p++)h[p]>b&&(f=p,b=h[p]);b&&a.kingdom!=f&&a.changeKingdom(f);
mb(a,1E3)},le,nk=[1,1],Th=function(){return 25*(Date.now()-r.loadDate+r.pausedTime+r.deltaTime)/gc.speed},$a=function(a){if(!(a&&r.online||$a.bySystem&&a))if(0===r.paused){r.paused=1;void 0!=le&&clearInterval(le);var b=r.now();r.pausedTime+=Date.now();a?rc("",A.paused,1):$a.bySystem=1;r.now=function(){return b}}else r.pausedTime-=Date.now(),r.paused=0,$a.bySystem=0,a&&(document.getElementById("alert").style.display="none"),le=setInterval(gc,gc.speed),r.now=Th};$a.bySystem=0;var yb=function(a,b){var f=
!1;if(1>a){a*=-1;var c=~~(a/xa),e=a%xa}else f=a;a=0;for(var h=b.length;a<h;a++){var l=z[b[a]];l.build||l.cow&&l.workers.length||f==l.id||(l.action=null,l.distance=0,l.mv&&null!=l.xf?f?(l.xf=f,l.yf=!0):(l.xf=e,l.yf=c):l.x32==e&&l.y32==c?l.stay():(l.dix=(e-l.x32)/Math.abs(e-l.x32),l.diy=(c-l.y32)/Math.abs(c-l.y32),f?(l.xf=f,l.yf=!0):(l.xf=e,l.yf=c),l.mv=!0,l.setupINTV(me,l.id,0),eg(l),l.action=null))}},eg=function(a){a.stock&&0!==a.stock[0]?(a.mimg=a.url[a.stock[4].url],a.stock[3]===vc&&(a.mimg=a.url.milk)):
a.mimg=a.url.move};yb.cursor=7;yb.allowPos=1;var mb=function(a,b,d){b=~~(b/25)+r.cycle;d=wc[b];d||(d=[],wc[b]=d);var f=d.length;a.c=b;d[f]=a.id;a.timestamp=r.now()},wc={},ne=function(a){var b=z[a[0]];if(!b.death){var f=a[1],c=a[2],e=a[3];b.cow&&"milk"==f&&b.workers&&b.workers.length||(b[f]+=I[b.kingdom].values[c],c=b[f+"Max"],b[f]>c&&2!==b.blocked&&(b[f]=c));"mana"==f&&(c=b.manaTask)&&c[2]<=b[f]&&(M(c),oa(c[1],b,xc[c[0]],b.url.move),b.manaTask=void 0,b.blockedAction(1));Y(b.id,1);ya({func:ne,data:a},
e,1)}},ya=function(a,b,d){a.func.url||M(a.func);a.func=a.func.url;d&&(b=~~(b/25)+r.cycle);d=yc[b];d||(d=[],yc[b]=d);d.put(a)},yc={},me=function(a){a=z[a];var b=D,f=!1;5===a.distance&&(a.distance=-1);a.waiting&&eg(a);var c=a.y32,e=a.x32,h=xc[a.action];ObjectsetupPosition(a,32*c);var l=La[a.zLevel],p=e+c*b;if(a.id===l[p]){var n=a.size;if(2>n)l[p]=a.radix;else for(var m=n*n,g=-b,k=0;k<m;k++){var u=k%n;0===u&&(g+=b);l[p+u+g]=0}}if(a.stop)return l[p]=a.id,a.stay(),a.stop=void 0,0;if(a.kx||a.ky){var E=
a.kx||0,r=a.ky||0;m=!1;if(0!==l[E+e+(r+c)*b])return a.aspettare()}else{h&&h.rev&&(m=h.rev(a))&&(a.action=m[0],h=xc[a.action],a.xf=m[1],a.yf=!0);if(!0===a.yf){m=a.xf;var t=z[m];if(!t||t.death&&(!h||!h.available))return l[p]=a.id,a.stay();k=!0;g=!1;if(h&&h.available){if(g=h.available(a,t),k=g[2],!1===g)return a.aspettare()}else t.death||(g=Lb(t,a,50,a.radix));a.xf!==m&&(t=z[a.xf]);if(!t||t.death||t.in)return l[p]=a.id,a.stay();if(!k&&(w+v*b===p||h))return a.aspettare();var w=g[0],v=g[1];if(h&&h.distance){var x=
h.distance;x=0>x?a.attDist:I[a.kingdom].values[x];g=fg(t,e,c);wd(e,c,g%D,~~(g/D),x)&&(f=2)}a==t&&(f=2)}else{w=a.xf;v=a.yf;m=l[w+v*b];if(2<m&&(!h||h&&h.rev)){m=z[m];g=Lb(m,a,50,a.radix);if(!1===g)return l[p]=a.id,a.stay();w=g[0];v=g[1]}h&&h.distance&&(x=h.distance,x=0>x?a.attDist:I[a.kingdom].values[x],wd(e,c,w,v,x)&&(f=2))}m=w+v*b;if(!f){performance.now();a:{E=e;r=c;g=w;k=v;u=a.radix;var A=D,B=E+r*A,F=B,G=g+k*A,C;performance.now();var J=B+Ea[~~(8*zc(B%A-g,~~(B/A)-k)+.5)%8];for(C=0;24>C;C++){var M=
~~(8*zc(B%A-g,~~(B/A)-k)+.5)%8;if(B===G)break;var O=l[B+Ea[M]];if(O===u||1>=Math.abs(z[O].d-(M+2)%8)&&null!=z[O].xf)B+=Ea[M];else if(l[B+Ea[M+1]]===u)B+=Ea[M+1];else if(O=M-1,-1===O&&(O=7),l[B+Ea[O]]===u)B+=Ea[O];else{B+=Ea[M];break}gg&&oe(B%A,~~(B/A),"stone")}if(l[B]>u){M=[B];O=1;var tb=0,H={};H[B]=2;for(var Q,V=Infinity,P=0;void 0!==(Q=M[tb++]);){gg&&oe(Q%A,~~(Q/A),"food");C=Q%A-g;var U=~~(Q/A)-k;C=C*C+U*U;C<V&&(V=C,P=Q);for(C=0;4>C;C++)if(B=Q+Uh[C],!H[B]&&l[B]!==u)for(G=0;8>G;G++)if(l[B+Ea[G]]===
u){M[O++]=B;H[B]=2;break}}Q=P;V=Infinity;for(G=0;8>G;G++)B=Q+Ea[G],l[B]===u&&(C=B%A-g,U=~~(B/A)-k,C=C*C+U*U,C<V&&(P=B,V=C));tb=0;O=1;M.length=0;M[0]=P;for(H[P]=1;void 0!==(Q=M[tb++]);){gg&&oe(Q%A,~~(Q/A),"gold");B=Q+Ea[~~(8*zc(Q%A-E,~~(Q/A)-r)+.5)%8];if(l[B]===u&&!H[B]){if(B==F){E=Q;break a}M[O++]=B;H[B]=1}for(C=0;8>C;C++)if(B=Q+Ea[C],!H[B]&&l[B]===u)for(G=0;8>G;G++)if(2===H[B+Ea[G]]){M[O++]=B;H[B]=1;break}}}E=J}r=~~((8*zc(-(E%b)+e,-~~(E/b)+c)+.5)%8);E=Vh[2*r];r=Vh[2*r+1];if(l[e+E+(c+r)*b]!==a.radix||
!na(e+E,c+r)){E=[e+1,c,e-1,c,e+1,c+1,e+1,c-1,e,c-1,e-1,c+1,e,c+1,e-1,c-1];r=w;g=v;k=D;u=Infinity;for(A=0;A<E.length;A+=2)if(0===l[E[A]+E[A+1]*k]&&na(E[A],E[A+1])&&u>=(E[A]-r)*(E[A]-r)+(E[A+1]-g)*(E[A+1]-g)){u=(E[A]-r)*(E[A]-r)+(E[A+1]-g)*(E[A+1]-g);var S=A}g=[E[S],E[S+1]];E=g[0]-e;r=g[1]-c;E=0<E?1:0>E?-1:0;r=0<r?1:0>r?-1:0;if(l[e+E+(c+r)*b]!==a.radix){l[p]=a.id;a.stay();return}}}}if(p==m||f)if(l[e+c*b]=a.id,a.x32=e,a.y32=c,h){if(h.distance&&2!==f)return a.aspettare();a.stay(1);t||(t=w+v*b);a.action=
void 0;h(t,a,x)}else a.stay();else{if(0===E&&0===r)return a.aspettare();a.setupDir(E,r);f=a.spd;ObjectsetupIMG(a,a.mimg,-1,a.spd/a.__proto__.spd);a.dix=E*f;a.diy=r*f;c+=r;e+=E;a.x32=e;a.y32=c;a.distance++;mb(a,~~(32E3/f));ObjectsetupPhysics(a,E*f,r*f,0);p=e+c*b;if(2>n)l[p]=a.id;else for(m=n*n,g=-b,k=0;k<m;k++)u=k%n,0===u&&(g+=b),l[p+u+g]=a.id}},gc=function(){var a=r.cycle;r.now();if(r.demo){var b=r.record[a];if(b)for(var d=0;d<b.length;d+=3)pe[b[d]](b[d+1],b[d+2])}if(b=yc[a]){for(d=0;d<b.length;d++){var c=
b[d];xc[c.func](c.data)}delete yc[a]}if(b=wc[a]){for(d=0;d<b.length;d++)c=z[b[d]],c.c===a&&(c.death&&M(c.func),c.c=void 0,xc[c.func](c.funcObj));delete wc[a]}r.cycle++;if(r.online&&0===r.cycle%8)var e=hg();!e&&!r.automatic&&r.now()-(r.cycle-1)*gc.speed>=gc.speed&&gc()};gc.speed=25;var Ea,Uh,oe=function(a,b,d){d=Object.assign({},Mb[d]);d.x32=a;d.y32=b;d.z32=2;Ra(d);zb.new(d,500)},gg,Vh=[1,0,1,-1,0,-1,-1,-1,-1,0,-1,1,0,1,1,1],zc=function(a,b){a=.5-Math.atan2(b,a)/(2*Math.PI);1==a&&(a=0);return a},xb=
function(a,b,d,c){return[a,b,d,c,a,b,d,c,a,b,d,c,a,b,d,c]},qe=new Float32Array(xb(1,0,0,.75)),ok=new Float32Array(xb(1,1,1,.5)),Wh=new Float32Array(xb(0,1,0,.75)),pk=new Float32Array(xb(0,1,0,.9)),qk=new Float32Array(xb(.3515625,.29296875,.21875,.9)),Xh=new Float32Array(xb(0,1,1,.9)),ig=new Float32Array(xb(1,1,1,.5)),Yh=new Float32Array(xb(.3,.3,.3,.9)),Zh=new Float32Array(xb(.7,.2,.2,.9));Xh.noAlpha=1;Yh.noAlpha=1;Zh.noAlpha=1;var R=function(a){ea(ke,[a,4*nb.shift+1,Sa],J[0])},ke=function(a,b){var f=
a[0],c=a[1],e=a[2];a=x[f];b=z[b];var h=b.icons.indexOf(a.nu);if(!(0>h)){performance.now();if(0==e)for(e=0;e<c;e++){var l=I[b.kingdom],p=l.mod[f].cost||a.cost;if(l.paypal(p))return!1;b.waitlist||(b.waitlist=[]);b.waitlist.push(f,-h-1);b.work||(b.work={});b.work[h]||(b.work[h]=0);b.work[h]++;b.working=1;l.unitLoading++;2==b.waitlist.length&&(p=1E3*a.time,b.setupINTV(xd,b.id,p))}else{if(!b.work)return;var n=b.waitlist;l=I[b.kingdom];for(e=0;e<c;e++){p=l.mod[f].cost||a.cost;l.setupResources(p,-1);p=n.lastIndexOf(f);
if(0>p)break;n.splice(p,2);M(b.work[h]);b.work[h]--;if(0==n.length){b.c=-1;b.working=0;break}l.unitLoading--;0===p&&(p=1E3*x[n[0]].time,b.setupINTV(xd,b.id,p))}}Y(b.id)}},$h=0,xd=function(a){a=z[a];var b=a.kingdom;b=I[b];var f=b.values.pop>=b.values.popMax?A.houseLimit:A.popLimit;if(b.values.pop>=b.values.popMax||b.values.pop>=b.values.popLimit)return document.getElementById("msgs1").getElementsByTagName("li"),3E4<Date.now()-$h&&b.k==t.kingdom&&Ab(f,0,5),$h=Date.now(),b.onFreePop.put(a.id);b.unitLoading--;
b=a.waitlist[0];f=x[b];a.work[-a.waitlist[1]-1]--;a.waitlist.splice(0,2);0<a.waitlist.length?a.setupINTV(xd,a.id,1E3*f.time):a.working=0;Ac(b,a);Y(a.id)},Fa=function(){if(0==Sa){var a=z[J[0]];ea(jg,[a.mlistID[ob.nu],!0],a.id)}},ta=function(){if(0==Sa){var a=z[J[0]];ea(jg,[a.hlistID[ob.nu],!1],a.id)}},ai=function(a,b,d){var f=1.6,e=0;1===b&&(d=0,f=3.6,e=620);return[e+~~(f*a[0]*b+.5)+120*d,~~(f*a[1]*b+.5),~~(f*a[2]*b+.5),~~(f*a[3]*b+.5)]},jg=function(a,b){var f=a[0];a=a[1];b=z[b];var c=I[b.kingdom];
if(c.values.pop>=c.values.popMax)return Ab(A.popLimit,0,5);if(a)var e=c.values.fameTech;c=4;var h=9*a;h||(h=1);if(a)var l=b.mlist,p=b.mlistID;else l=b.hlist,p=b.hlistID;var n=p.indexOf(f);if(!(0>n)){f=l[n].unit;l.splice(n,1);p.splice(n,1);p=ai(x[f].cost,h,e);if(I[b.kingdom].paypal(p))return 0;X.active==l&&ia(l);for(p=0;p<h;p++)n=Ac(f,b),e?n.level=c:a||(c=16,n.level=c,l=bi[n.race],n.name=l[n.id%l.length],ci(n))}},Ac=function(a,b,d,c){var f=D,h=b.kingdom;b.rnd||kg(b);var l=-1,p=-1;if(b.point&&!b.disallowPoint){var n=
b.point[0],g=b.point[1];l=di(b,n,g,x[a].radix,x[a].rbase())[0]}else l=di(b,l,p,x[a].radix,x[a].rbase())[1],l=l[ei(b,l.length)];p=~~(l/f);a=new hc(a,h,l%f,p,0,!1,c);yd(h);d||ma("unitdone",0,0,a.kingdom);if(b.point&&(b=lg(n,g,a,!0),d=b[1],b[0]))b[0](d,[a.id]);return a},re=0,se=0,Jb,eb,qd,H=function(a){U=function(){};a=x[a];Jb=!1;var b=G;ObjectsetupIMG(b,a.img);b.active=!0;eb=a;qd=!1;document.addEventListener("mousemove",Sf);document.addEventListener("mousedown",be)},be=function(a){var b=eb.validator,
f=eb.space,c=ra[eb.img];if(0==a.button&&151<a.pageX){c=Nb(a.pageX-t.mx-.5*c[8]/da,a.pageY-.5*c[9]/da);var e=~~(.03125*c[1]);c=~~(.03125*c[0]);b(c,e,f,t.kingdom)[1]&&(Jb=!0,G.active=!0,G.x=-9999,G.y=-9999,U=151<a.pageX?0:ib,document.removeEventListener("mousedown",be),ea(Xc,[c+D*e,eb.type,qd],J),nb.shift&&(qd?Ch(qd):H(eb.type)));U=function(){}}else G.active=!0,G.x=-9999,G.y=-9999,Jb=!0,U=151<a.pageX?0:ib,document.removeEventListener("mousedown",be)},Sf=function(a){var b=eb.validator,f=eb.space,c=ra[eb.img];
if(Jb)document.removeEventListener("mousemove",Sf);else{var e=a.pageX,h=a.pageY;if(e!=re||h!=se)G.active=!0,re=e,se=h,e=Nb(a.pageX-t.mx-.5*c[8]/da,a.pageY-.5*c[9]/da),h=~~(.03125*e[1]),e=~~(.03125*e[0]),a=32*e,c=32*h,(b=!b(e,h,f,qb.k)[1])?b!=ic&&(ic=b,g.bindBuffer(g.ARRAY_BUFFER,Xa),g.bufferSubData(g.ARRAY_BUFFER,16*G.bufferID,qe)):b!=ic&&(ic=b,g.bindBuffer(g.ARRAY_BUFFER,Xa),g.bufferSubData(g.ARRAY_BUFFER,16*G.bufferID,Wh)),G.x=a,G.y=c}},Xc=function(a,b){var f=a[0],c=f%xa,e=~~(f/xa),h=r.editor?t.kingdom:
z[b[0]].kingdom;f=a[1];var l=x[f].cost,p=I[h];if(!r.editor&&p.paypal(l))return!1;a=new hc(f,h,c,e,0,!r.editor,a[2]);if(!0===a.invalid||r.editor)return!1;a.waitlist=[];if(20===f)a.built=1,c=z[b[0]],oa(a.id,c,Bc,c.url.move),U=function(){U=ib};else for(a.health=1,ObjectsetupIMG(a,a.bimg),a=a.id,f=0,e=b.length;f<e;f++)c=z[b[f]],c.buildList?(c.buildList.put(a),c.func!==mg&&(h=te(c.buildList,c.x32,c.y32))&&oa(h,c,Cc,c.url.move)):(c.buildList=[a],oa(a,c,Cc,c.url.move))},ic=null,og=function(a){U=function(){};
a=x[a];Jb=!1;var b=G;eb=a;ObjectsetupIMG(b,a.img);document.addEventListener("mousemove",fi);document.addEventListener("mousedown",ng)},ng=function(a){var b=D,f=ra[eb.img];if(0==a.button&&151<a.pageX){a=Nb(a.pageX-t.mx-.5*f[8]/da,a.pageY-.5*f[9]/da);var c=~~(.03125*a[1]);a=~~(.03125*a[0]);g.bindBuffer(g.ARRAY_BUFFER,Xa);g.bufferSubData(g.ARRAY_BUFFER,0,qk);var e=ha[2];ha[2]=32;ha[5]=32;ha[8]=32;ha[11]=32;G.wall=a+c*b;var h=a;document.addEventListener("mouseup",function n(a){rb.forced=!1;a=ua[3*t.kingdom];
var f=ua[3*t.kingdom+1],d=ua[3*t.kingdom+2];w[0]=a;w[1]=f;w[2]=d;w[3]=.5;w[4]=a;w[5]=f;w[6]=d;w[7]=.5;w[8]=a;w[9]=f;w[10]=d;w[11]=.5;w[12]=a;w[13]=f;w[14]=d;w[15]=.5;g.bindBuffer(g.ARRAY_BUFFER,Xa);g.bufferSubData(g.ARRAY_BUFFER,0,w);ha[2]=e;ha[5]=e;ha[8]=e;ha[11]=e;var p=~~(ha[9]/32),k=~~(ha[10]/32);f=Math.abs(h-p);d=Math.abs(c-k);f&&--f;d&&--d;a=1;p=p<h?p:h;var r=k<c?k:c;k=[p+r*b];for(var z=0;z<f;z++)k[a++]=p+z+r*b+1,k[a++]=p+z+(r+d)*b;for(z=0;z<d;z++)k[a++]=p+(r+z)*b,k[a++]=p+(r+z+1)*b+f;for(z=
1;z<a;z++)f=k[z],Jb=!0,U=function(){U=ib},jc(2),ea(Xc,[f,eb.type],J);G.active=!0;G.x=-9999;G.y=-9999;nb.shift&&og(eb.type);document.removeEventListener("mouseup",n)});document.removeEventListener("mousedown",ng);Jb=!0}else G.active=!0,G.x=-9999,G.y=-9999,Jb=!0,U=151<a.pageX?0:ib,document.removeEventListener("mousedown",ng)},fi=function(a){var b=D,f=ra[eb.img];if(Jb)document.removeEventListener("mousemove",fi);else{var c=a.pageX,e=a.pageY;if(c!=re||e!=se){var h=!0;re=c;se=e;G.active=!0;a=Nb(a.pageX-
t.mx-.5*f[8]/da,a.pageY-.5*f[9]/da);f=~~(a[1]/32);a=~~(a[0]/32);c=32*a;e=32*f;0==V[a+f*b]&&(h=!1);h?h!=ic&&(ic=h,g.bindBuffer(g.ARRAY_BUFFER,Xa),g.bufferSubData(g.ARRAY_BUFFER,16*G.bufferID,qe)):h!=ic&&(ic=h,g.bindBuffer(g.ARRAY_BUFFER,Xa),g.bufferSubData(g.ARRAY_BUFFER,16*G.bufferID,Wh));G.x=c;G.y=e}}},pg=function(a,b){a=0;for(var f=b.length;a<f;a++){var c=z[b[a]];c.xf?c.stop=1:c.stay()}},ue=function(a,b){a=z[b[0]];a.techStart=0;a.c=void 0;if(b=a.techID){var f=I[a.kingdom].technology.hidden;-1<b&&
(f[b]=0);I[a.kingdom].setupResources(B[a.activeTech].cost,-1)}else I[a.kingdom].setupResources(a.lcost,-1)},C=function(a){var b=z[J[0]];if(I[b.kingdom].paypal(B[a].cost))return!1;ea(bg,[a,ob.lastFunc.id],b.id)},bg=function(a,b){var f=a[0];a=a[1];var c=B[f],e=z[b];c.upgrade&&(a=-1);e.activeTech=f;e.techID=a;e.setupINTV(c.type,[f,a,b],1E3*c.time);e.techStart=e.c-r.cycle;f=I[z[b].kingdom].technology.hidden;-1<a&&(f[a]=1);Y(b)},T=function(a){var b=a[1],f=z[a[2]];a=B[a[0]];Xb(f,a,b)},zd=function(a){var b=
a[1],f=z[a[2]];a=B[a[0]];var c=x[a.obj],e=I[f.kingdom].mod[c.type];gi(f);f.img=c.img;f.attack=e.attack||c.attack;f.health=f.health/f.maxHealth*c.health;f.maxHealth=c.health;f.__proto__=c;Ra(f);Xb(f,a,b)},ve=function(a){var b=a[1],f=z[a[2]];a=B[a[0]];if(a.actvintv)for(var c=a.actvintv,e=0,h=c.length;e<h;e++){var l=c[e];I[f.kingdom].technology.disabled[l.id]=0;for(var p=l.builds,n=hb[f.kingdom],g=0,k=p.length;g<k;g++)for(var y=n[p[g]],u=0,r=y.length;u<r;u++)l(z[y[u]])}Xb(f,a,b)},Ma=function(a,b){var f=
a[1];b=z[a[2]];a=B[a[0]];I[b.kingdom].values[a.value]+=a.increase;"popMax"==a.value&&yd(b.kingdom);Xb(b,a,f)},hi=function(a,b){var f=a[1];b=z[a[2]];a=B[a[0]];for(var c=a.group,e=I[b.kingdom].mod,h=0,l=c.length;h<l;h++)for(var p=e[c[h].type],n=0,g=a.values,k=g.length;n<k;n+=2){var y=g[n],u=g[n+1];p[y]||(p[y]=c[h][y]||0);p[y]+=u}Xb(b,a,f)},Ta=function(a,b){var f=a[1];b=z[a[2]];a=B[a[0]];for(var c=a.group,e=I[b.kingdom].mod,h=0,l=c.length;h<l;h++){var p=e[c[h].type];p[a.value]||(p[a.value]=c[h][a.value]||
0);p[a.value]+=a.increase}Xb(b,a,f)},we=function(a,b){var f=a[1];b=z[a[2]];a=B[a[0]];for(var c=I[b.kingdom].mod,e=a.mulp,h=0,l=a.group.length;h<l;h++){var p=a.group[h],n=c[p.type].cost||p.cost;c[p.type].cost=e?[~~(n[0]*e),~~(n[1]*e),~~(n[2]*e),~~(n[3]*e)]:[n[0]-a.decrease[0],n[1]-a.decrease[1],n[2]-a.decrease[2],n[3]-a.decrease[3]]}Xb(b,a,f)},qg=function(a,b){var f=a[1];b=z[a[2]];a=B[a[0]];for(var c=I[b.kingdom].mod,e=0,h=a.decrease,l=h.length;e<l;e+=2){var p=h[e],n=h[e+1],g=c[p.type].cost||p.cost;
c[p.type].cost=[g[0]-n[0],g[1]-n[1],g[2]-n[2],g[3]-n[3]]}Xb(b,a,f)},Xb=function(a,b,d){a.techStart=void 0;a.activeTech=void 0;a.techID=void 0;a.func=void 0;var f=I[a.kingdom].technology,e=f.disabled;f.investigated[d]=1;ma("techdone",0,0,a.kingdom);if(b=b.next){d=!1;f=0;for(var h=b.length;f<h;f++){var l=b[f].id;e[l]--;ia.actv[l]&&(d=!0)}d&&ia(X.active)}Y(a.id)},Dc,rk={icon:"food",img:"item_meat",url:"meat"},sk={icon:"milk",img:"milk",url:"milk"},tk={icon:"gold",img:"item_gold",url:"gold"},uk={icon:"stone",
img:"item_stone",url:"stone"},ii={icon:"wood",img:"item_tree",url:"tree"},vk={icon:"food",img:"item_food",url:"food"},Ad=function(a,b,d,c){a=hb[a];var f=Dc[b];b=[];b.length=f.length;for(var h=0,l=f.length;h<l;b[h]=a[f[h++]]);a=Infinity;f=-1;for(h=0;h<b.length;h++){l=b[h];for(var p=l.length,g=0;g<p;g++){var m=z[l[g]],k=m.x32,y=m.y32,u=m.space;m=u[u.length-1];u=(u.length-1)/m;m*=.5;u*=.5;k+=m;y+=u;m=.5*(m+u);k=Math.sqrt((k-d)*(k-d)+(y-c)*(y-c))-m;a>=k&&(a=k,f=l[g])}}return f},ka,wk=function(a){if("string"==
typeof a){for(var b=1,f=0,c=a.length;f<c;f++)b+=b*(a.charCodeAt(f)/65535)*(f+1);a=b+c}var e=4294967295-a,h=4294967295+a;f=0;ka=function(){h+=f;e-=f++;h=36969*(h&65535)+(h>>16)&4294967295;e=18E3*(e&65535)+(e>>16)&4294967295;return((h<<16)+e&4294967295)/4294967295+.5}},ei=function(a,b){a=a.rnd;var f=a[0],c=a[1],e=a[2];f+=e;c-=e;f=36969*(f&65535)+(f>>16)&4294967295;c=18E3*(c&65535)+(c>>16)&4294967295;a[0]=f;a[1]=c;a[2]++;return~~((((f<<16)+c&4294967295)/4294967295+.5)*b)},jc=function(a){a!=xk&&(document.body.className=
"ncursor"+a)},xk=-1,Yc=function(a,b){for(var f=0,c=b.length;f<c;f++){var e=z[b[f]];oa(a,e,Bd,e.url.move)}};Yc.spLevel=function(a){var b=0;2<za[a]&&(b=za[a]);return b};var Bd=function(a,b){b.stay55();if(b.inventory&&b.invMax===b.inventory.length||!a.item)return 1;za[a.x32+a.y32*D]=a.radix;ObjectindexHide(a);if(b.peon&&a.contain){var f=a.contain[1],c=a.contain[0];b.stock&&ji(b);var e=D;var h=Infinity;for(var l=!1,p=0;121>p;p++){var g=p%11-5;var m=~~(p/11)-5,k=g*g+m*m;g+=b.x32;m+=b.y32;k<h&&(g=za[g+
e*m],0<g&&(g=z[g],g.contain&&(h=k,l=g.id)))}h=l;e=a.contain[2];a.die(1);b.stock=[c,f,h,Bd,e];a=Ad(b.kingdom,f,b.x32,b.y32);oa(a,b,Yb,b.url[e.url]);Y(b.id);return 1}b.addItem(a);Y(b.id)},ji=function(a){var b=ki(a.x32,a.y32),f=~~(b/D);b%=D;b=new hc(52,a.kingdom,b,f,0);ObjectsetupIMG(b,k[a.stock[4].img]);b.contain=[a.stock[0],2,a.stock[4]]},li=function(a,b){a=0;for(var f=b.length;a<f;a++){var c=z[b[a]];c.xf?c.stop=2:(c.stop=2,c.stay(),c.stop=void 0)}},Zc=function(a,b){var f=D;a=z[a];for(var c=0,e=b.length;c<
e;c++){var h=z[b[c]],l=La[h.zLevel],p=h.x32+h.y32*f;if(0!==l[p]||!a.build){p=a.build?rg(h,h.x32,h.y32):rg(h,a.x32,a.y32);if(!1===p)continue;h.x32=p%D;h.y32=~~(p/D)}h.item&&(a.attack-=h.attack||0,a.defence-=h.defence||0);h.url.idle&&ObjectsetupIMG(h,h.url.idle,1);l[p]=h.id;h.in=0;a.inventory.quit(h.id);ObjectindexShow(h)}Y(a.id,1)},Cd=function(a,b){a=z[a];if(1===a.invType)for(var f=0,c=b.length;f<c;f++){var e=z[b[f]];e!=a&&oa(a.id,e,sg,e.url.move)}},sg=function(a,b){var f=a.inventory;if(f.length<a.invMax){var c=
b.x32,e=b.y32;b.rbase()[c+e*D]=b.radix;f.put(b.id);ObjectindexHide(b);b.in=a.id;Dd(b.id);Y(a.id)}else b.stay55()},$c=function(a,b){for(var f=b.length,c=0;c<f;c++){var e=z[b[c]];e.buildList=!1;oa(a,e,Cc,e.url.move)}},Cc=function(a,b){if(a.dummy&&a.dummy.built)return b.stay55();if(a.health<a.maxHealth)b.dix=0,b.diy=0,b.mv=!0,b.setupDirBuild(a),ObjectsetupIMG(b,b.url.build,1),b.setupINTV(mg,{u:a.id,a:b.id},Ca(b.img)),sd(b,"hit%20",7,b.img);else{if(b.buildList&&(a=te(b.buildList,b.x32,b.y32)))return oa(a,
b,Cc,b.url.move),0;b.stay55()}},mg=function(a){var b=z[a.u];a=z[a.a];var f=a.x32,c=a.y32,e=b.x32+b.y32*D;if(b.death)return a.stay();var h=b.maxHealth,l=h/b.time*I[a.kingdom].values.buildSpeed;if(1===b.health){for(var p=b.onbuild1,g=b.id,m=b.getRadix(),q=0,y=p.length;q<y;q++)if(2<m[p[q]]){mb(a,Ca(a.img));return}var u=ub[b.kingdom];q=0;for(y=p.length;q<y;q++)m[p[q]]=g,u[p[q]]=void 0;Zb(b)}b.health+=l;l=b.health;0==b.built&&(u=~~(4*l/h),u>b.d&&(b.d=u,ObjectsetupIMG(b,b.img)));if(l>=h){l=b.health=h;Y(b.id);
if(!b.built){b.d=0;p=b.url;u=ub[b.kingdom];1343===b.type&&(u[e+1]&&13==z[u[e+1]].type&&u[e-1]&&13==z[u[e-1]].type?(p=k.wood_horz,b.child=void 0):u[e+D]&&13==z[u[e+D]].type&&u[e-D]&&13==z[u[e-D]].type&&(p=k.wood_vert,b.child=void 0));b.built=1;b.img=p;Ra(b);if(p=b.onbuildValid)for(m=b.validator.dimension,q=0,y=p.length;q<y;m[p[q++]]=0);mi(b);ma("bldgdone",0,0,b.kingdom);Y(b.id)}b.action=void 0;(e=a.buildList)&&e.quit(b.id);if(!e||a.buildList&&0===a.buildList.length)a.buildList=ni(a),e=a.buildList;
if(f=te(e,f,c))return oa(f,a,Cc,a.url.move),0;a.buildList.length=0;a.stay();a.stock&&a.stock[0]&&ObjectsetupIMG(a,a.url[a.stock[4].url])}else Y(b.id),mb(a,Ca(a.img));J[0]==b&&(kc.innerHTML=l+"/"+h,qa.value=l)},xe=function(a,b){if(2<a)for(var f=0,c=b.length;f<c;f++){var e=z[b[f]];oa(a,e,Bc,e.url.move)}},Fd=function(a,b){var f=a;a=z[a];if(a.field)for(c=0,a=b.length;c<a;c++)e=z[b[c]],oa(f,e,Bc,e.url.move);else if(0===a.res||3===a.res){var c=0;for(a=b.length;c<a;c++){var e=z[b[c]];oa(f,e,Ed,e.url.move)}}else if(1===
a.res)for(c=0,a=b.length;c<a;c++)e=z[b[c]],oa(f,e,Ec,e.url.move);else if(2===a.res)for(c=0,a=b.length;c<a;c++)e=z[b[c]],oa(f,e,vc,e.url.move)},uc=function(a,b,d){d=d?Gd:ad;if(!(3>a||(a=z[a],void 0!=a.res||a.magicGateway)))for(var f=0,e=b.length;f<e;f++){var h=z[b[f]];h==a||h.attackOnly&&!h.attackOnly[a.type]||h.bat&&a.build||a.stoned||(h.build?ad(a,h):oa(a.id,h,d,h.url.move))}},Ec=function(a,b){if(0<a.health){var f=b.x32,c=b.y32;b.mv=!0;b.setupDir(a.x32-f,a.y32-c);ObjectsetupIMG(b,b.url.cut,1);b.dix=
0;b.diy=0;sd(b,"chop%20",11,b.img);b.setupINTV(oi,{u:a.id,a:b.id},7E3);a.addWorker(b)}else b.stay55()},oi=function(a){var b=D,f=z[a.u];a=z[a.a];var c=I[a.kingdom].values.wood;f.workers.quit(a.id);var e=Ad(a.kingdom,1,a.x32,a.y32);f.health-=c;a.mv=!1;Y(f.id);if(1>f.health){c+=f.health;V[f.x32+f.y32*b]=0;b=z[e];b=Aa(b.x32,b.y32);for(var h=f.health=0,l=f.workers.slice(0),p=l.length;h<p;h++){var g=z[l[h]];M(g);b?oa(b,g,Ec,a.url.move):g.stay()}a.stock=[c,1,b,Ec,ii];a.mv=!1;oa(e,a,Yb,a.url.tree);Y(a.id,
1);f.workers.length=0;f.die()}else a.stock=[c,1,f.id,Ec,ii],oa(e,a,Yb,a.url.tree),Y(a.id,1);if(0>e)return a.stay()},Bc=function(a,b){b.mv=!0;b.setupDir(a.x32-b.x32,a.y32-b.y32);ObjectsetupIMG(b,b.url.dig,1);sd(b,"dig%20",3,b.img);b.setupINTV(pi,{u:a.id,a:b.id},7E3)},pi=function(a){var b=z[a.u];a=z[a.a];var f=I[a.kingdom].values.food,c=Ad(a.kingdom,2,a.x32,a.y32);a.mv=!1;a.stock=[f,2,b.id,Bc,vk];oa(c,a,Yb,a.url.food);Y(a.id,1);if(0>c)return a.stay()},vc=function(a,b){b.mv=!0;b.setupDir(a.x32-b.x32,
a.y32-b.y32);ObjectsetupIMG(b,b.url.milk1,1);b.stock=[0,2,a.id,vc,sk];b.setupINTV(tg,{u:a.id,a:b.id},1E3);a.addWorker(b);a.d=8-b.d;a.stay()},tg=function(a){var b=z[a.u];a=z[a.a];b.milk-=3;var f=a.x32,c=a.y32;a.stock[0]+=3;Y(a.id,1);if(0>=b.milk||b.death){if(50<a.stock[0]&&(a.stock[0]=50),a.mv=!1,b=Ad(a.kingdom,2,f,c),oa(b,a,Yb,a.url.milk),0>b)return a.stay()}else mb(a,1E3)},vd=function(a,b){b.stay55()},Gd=function(a,b){ad(a,b)},ad=function(a,b){if(1!==a.death&&a!=b){if(a.dummy&&!I[b.kingdom].values.experience)return b.stay55();
b.invisible&&bd(b.id);if(!0!==b.build){b.mv=1;var f=a.x32-b.x32,c=a.y32-b.y32;a.space&&(c=fg(a,b.x32,b.y32),f=c%D-b.x32,c=~~(c/D)-b.y32);b.setupDir(f,c,b.d2attack);b.url.attack&&ObjectsetupIMG(b,b.url.attack,1)}b.setupINTV(qi,{u:a.id,a:b.id},Ca(b.img));a.addWorker(b)}else b.stay55()};ad.distance=-1;Gd.distance=-1;var ug=function(a,b){var f=I[a.kingdom];if(f.values.experience&&(!b||0!=f.diplomacy[b.kingdom]||b.dummy)){if(0==a.level||null==a.level)a.level=0,a.levelProgress=0;a.levelProgress++;a.levelProgress>=
~~(a.level/f.values.experience)&&a.level<f.values.maxLevel&&(a.level++,a.health+=f.values.healthJump,a.maxHealth+=f.values.healthJump,a.levelProgress=0,a.attack+=a.level,a.defence+=a.level%2,Y(a.id,1))}},ci=function(a){var b=a.level;a.attack+=b;a.defence+=~~(.5*b)},qi=function(a){var b=z[a.u];a=z[a.a];var f=a.attDist,c=b.x32-a.x32,e=b.y32-a.y32,h=b.x32,l=b.y32,p=!a.build;if(a.attackSound){var g=a.attackSound;ma(g[~~(g.length*Math.random())],a.x32,a.y32)}p&&!b.build&&a.setupDir(c,e,a.d2attack);ObjectsetupIMG(a,
a.img,1);if(b.death||a.level&&8<=a.level&&b.dummy||b.dummy&&a.level&&a.level>=I[a.kingdom].values.maxLevel)return a.stay();if(1<f&&!a.dragon){p=!0;var k=a.attimg}else p=!1;if(b.build||wd(b.x32,b.y32,a.x32,a.y32,f)){b.onattack(a);f=a.attack*((Wc[a.type][b.type]||0)+1);if(p){b.space&&(c=fg(b,a.x32,a.y32),h=c%D,l=~~(c/D),c=h-a.x32,e=l-a.y32);p=0;if(a.arrow||a.ball){g=ri;var q=zc(-c,-e);var y=c;var u=e;var E=411/Math.sqrt(y*y+u*u);y*=E;u*=E;var t=Math.sqrt(1024*c*c+e*e*1024)/Math.sqrt(y*y+u*u);a.ball&&
(k[1]=k[0]/t)}else{var w=2;g=ye;p=y=r.gravity;q=Math.PI/180*60;E=Math.cos(q);q=a.attackDeg;q*=Math.PI/180;u=Math.sin(q);t=Math.cos(q);q=32*Math.sqrt(c*c+e*e);y=t*Math.sqrt(y*q/(u*t*2));t=q/y;u=-Math.sin(Math.atan2(-c,-e));q=zc(-c,-e);y*=u;p=Math.abs(p*E*u);u=(32*e-p*t*t*.5)/t}t=Math.round(1E3*t);E={x32:a.x32+.5,y32:a.y32+.5,img:k,mv:a.ball,d:0,rotation:-q+1.5,xf:h,yf:l,obj:b.id,attack:f,range:w};Ra(E);ObjectsetupPhysics(E,y,u,p);ya({func:g,data:E},t,1)}E||b.damage(f,a);if(b.dummy){if(50<=a.dummyDamage||
!a.dummyDamage)a.dummyDamage=0;a.dummyDamage+=f;50<=a.dummyDamage&&ug(a,b)}b.death?(a.stay(),a.action=null,b.build||a.build||ug(a,b)):mb(a,Ca(a.img))}else a.mv=!1,0!==a.state&&oa(b.id,a,ad,a.url.move)},Ed=function(a,b){0<a.health?(b.dix=0,b.diy=0,b.mv=1,b.setupDirBuild(a),ObjectsetupIMG(b,b.url.kirka,1),sd(b,"mine%20",3,b.img),b.setupINTV(si,{u:a.id,a:b.id},7E3),a.addWorker(b)):b.stay()},si=function(a){var b=z[a.u];a=z[a.a];var f=b.res,c=I[a.kingdom].values[0==f?"gold":"stone"],e=a.x32,h=a.y32;b.health-=
c;Y(b.id);1>b.health&&(c=b.health+c,b.health=0,b.d=3,b.die());a.mv=!1;e=Ad(a.kingdom,f,e,h);0==f?(a.stock=[c,f,b.id,Ed,tk],oa(e,a,Yb,a.url.gold)):(a.stock=[c,f,b.id,Ed,uk],oa(e,a,Yb,a.url.stone));Y(a.id,1);if(0>e)return a.stay()},oa=function(a,b,d,c){b.cow&&b.workers.length||(b.action=d.url,b.distance=0,0<a?(b.xf=a,b.yf=!0):(a*=-1,b.xf=a%D,b.yf=~~(a/D)),b.func!=me.url&&(c==b.url.move?eg(b):b.mimg=c,b.dix=0,b.diy=0,b.mv=!0,b.setupINTV(me,b.id,0)))},Ae=function(a,b){M(a);ze(b,a,yk)};Ae.allowPos=1;var yk=
function(a,b){Zc(b.id,b.inventory.slice(0));b.stay55()},fg=function(a,b,d){var f=a.space||nk,e=f.length-1,h=f[e],l=a.x32;a=a.y32-1;for(var p=Infinity,g=0,k=0;k<e;k++){var q=k%h;q||a++;var y=(l+q-b)*(l+q-b)+(a-d)*(a-d);y<p&&f[k]&&(g=l+q+a*D,p=y)}return g},rg=function(a,b,d){var f=D,e=a.radix,h=La[a.zLevel];for(a=2;60>=a;a+=2){b--;d--;for(var l=0;l<=a;){var p=b+l+f*d;if(h[p]===e)return p;p=b+l+f*(d+a);if(h[p]===e)return p;l++}for(l=0;l<a-1;){l++;p=b+f*(d+l);if(h[p]===e)return p;p=b+a+f*(d+l);if(h[p]===
e)return p}}return!1},ki=function(a,b){var f=D,c,e=za;for(c=2;60>=c;c+=2){a--;b--;for(var h=0;h<=c;){var l=a+h+f*b;if(0===e[l]&&0===V[l])return l;l=a+h+f*(b+c);if(0===e[l]&&0===V[l])return l;h++}for(h=0;h<c-1;){h++;l=a+f*(b+h);if(0===e[l]&&0===V[l])return l;l=a+c+f*(b+h);if(0===e[l]&&0===V[l])return l}}return!1},Hd=function(a,b){var f=a%D;a=~~(a/D);var c=b%D;b=~~(b/D);var e=Hd.x,h=Hd.y;return(f-e)*(f-e)+(a-h)*(a-h)-((c-e)*(c-e)+(b-h)*(b-h))},Lb=function(a,b,d,c){var f=b.x32,h=b.y32,l=D,p=f+h*l,g=
a.x32,k=a.y32,q=a.space;if(q){var y=q[q.length-1];q=(q.length-1)/y;a=a.free}else q=y=1,a=Sh;b=b.rbase();for(var u,r=Infinity,t=-1,w=!1,N=0,A=0;N<d&&-1==t;){if(0==N&&a){u=[];for(var v=0,x=a.length;v<x;v+=2){var B=a[v]+g,F=a[v+1]+k;!na(B,F)||b[B+F*l]!==c&&B+F*l!=p||(u[A++]=B+F*l)}Hd.x=f;Hd.y=h;u.sort(Hd);for(v=0;v<A;v++){B=u[v];x=B%l;F=~~(B/l);if(!(x=100<(f-x)*(f-x)+(h-F)*(h-F))){var C=f,G=h,I=B%l,M=~~(B/l),J=c,O=b;performance.now();x=D;var Q=-x,H=+x,V=0,P=0;F=[];var U={};U[C+G*x]=1;var S=I+M*x,K=0;
I=!1;var W=0;b:do{M=S%x;var L=~~(S/x);W++;M=(M-C)*(M-C)+(L-G)*(L-G);if(void 0==S||2>=M){I=!0;break b}U[S]=1;M=5>=M?0:1;L=Ea[~~(8*zc(S%x-C,~~(S/x)-G)+.5*M)%8];if(O[S+L]!==J&&null==z[O[S+L]].xf||U[S+L]){var R=!1;for(var X=0;8>X;X++)if(L=S+Ea[X],O[L]==J&&!U[L]&&(O[-1+Q+L]!=J||O[Q+L]!=J||O[1+Q+L]!=J||O[-1+L]!=J||O[1+L]!=J||O[-1+H+L]!=J||O[H+L]!=J||O[H+1+L]!=J)){if(R&&12<K++)break;R=!0;F[V++]=L;M=L%x;L=~~(L/x);if(2>=(M-C)*(M-C)+(L-G)*(L-G)){I=!0;break b}}R||K--}else if(F[V++]=S+L,M=(S+L)%x,L=~~((S+L)/
x),2>=(M-C)*(M-C)+(L-G)*(L-G)){I=!0;break b}do S=F[P++];while(U[S])}while(P<=V);C=F;for(G=0;G<0*C.length;G++)M=C[G]%x,L=~~(C[G]/x),J=new hc(0,1,M,L,0),J.c=NaN,ObjectsetupPosition(J,32*D),J.x=32*J.x32+16,J.y=32*J.y32,zb.new(J,2E3);x=I?F:!1;x=!1!==x}if(x){t=B;break}}if(-1<t){w=!0;break}if(1==d)break}N++;--g;--k;for(v=0;v<y+2*N;v++)b[g+k*l+v]==c&&na(g+v,k)&&(u=(g+v-f)*(g+v-f)+(k-h)*(k-h),r>u&&(r=u,t=g+v+k*l)),b[g+(k+q+2*N-1)*l+v]==c&&na(g+v,k+q+2*N-1)&&(u=(g+v-f)*(g+v-f)+(k+q+2*N-1-h)*(k+q+2*N-1-h),
r>u&&(r=u,t=g+(k+q+2*N-1)*l+v));for(v=1;v<q+2*N-1;v++)b[g+(k+v)*l]==c&&na(g,k+v)&&(u=(g-f)*(g-f)+(k+v-h)*(k+v-h),r>u&&(r=u,t=g+(k+v)*l)),b[g+y+2*N-1+(k+v)*l]==c&&na(g+y+2*N-1,k+v)&&(u=(g+y+2*N-1-f)*(g+y+2*N-1-f)+(k+v-h)*(k+v-h),r>u&&(r=u,t=g+y+2*N-1+(k+v)*l))}return-1<t?[t%l,~~(t/l),w]:!1},di=function(a,b,d,c,e){performance.now();var f=D,l=a.x32,p=a.y32,g=a.space,k=[],q=0;if(g){var y=g[g.length-1];g=(g.length-1)/y;var u=a.free}else g=y=1;a=-1==b?-Infinity:Infinity;for(var r=-1,t=0,w=0;0==k.length;){if(u&&
0==w){for(var v=0,z=u.length;v<z;v+=2){var x=u[v]+l,A=u[v+1]+p;na(x,A)&&e[x+A*f]===c&&(k[q++]=x+A*f,t=(x-b)*(x-b)+(A-d)*(A-d),a>t&&(a=t,r=x+A*f))}if(k.length)break}w++;--l;--p;for(v=0;v<y+2*w;v++)e[l+p*f+v]==c&&na(l+v,p)&&(k[q++]=l+v+p*f,t=(l+v-b)*(l+v-b)+(p-d)*(p-d),a>t&&(a=t,r=l+v+p*f)),e[l+(p+g+2*w-1)*f+v]==c&&na(l+v,p+g+2*w-1)&&(k[q++]=l+(p+g+2*w-1)*f+v,t=(l+v-b)*(l+v-b)+(p+g+2*w-1-d)*(p+g+2*w-1-d),a>t&&(a=t,r=l+(p+g+2*w-1)*f+v));for(v=1;v<g+2*w-1;v++)e[l+(p+v)*f]==c&&na(l,p+v)&&(k[q++]=l+(p+
v)*f,t=(l-b)*(l-b)+(p+v-d)*(p+v-d),a>t&&(a=t,r=l+(p+v)*f)),e[l+y+2*w-1+(p+v)*f]==c&&na(l+y+2*w-1,p+v)&&(k[q++]=l+y+2*w-1+(p+v)*f,a>t&&(a=t,r=l+y+2*w-1+(p+v)*f))}return[r,k]},Sh=[-1,0,-1,-1,0,-1,1,-1,1,0,1,1,0,1,-1,1],te=function(a,b,d){for(var f=Infinity,e=!1,h=0,l=a.length;h<l;h++){var g=a[h],k=z[a[h]];if(0!=k.built||k.death)h--,l--,a.quit(g);else{var m=k.x32;k=k.y32;k=(m-b)*(m-b)+(k-d)*(k-d);f>=k&&(f=k,e=g)}}return e},ti=function(a){for(var b=0,f=a.length;b<f;b++){var c=z[a[b]];c.spd=c.__proto__.spd}},
ui=function(a){for(var b=Infinity,f=0,c=a.length;f<c;f++){var e=z[a[f]];M(e.spd);e.spd<b&&(b=e.spd)}vg(b,a)},wg=function(a,b){ze(b,a,Yb)},Yb=function(a,b){a=I[b.kingdom];a.resources[b.stock[1]]+=b.stock[0];a.stats.resources[b.stock[1]]+=b.stock[0];Be(b.kingdom);b.func=1;var f=b.stock[3];a=z[b.stock[2]];if(f==vc){var c=D;for(var e,h=Infinity,l=!1,g=0;961>g;g++){var k=g%31-15,m=~~(g/31)-15,q=k*k+m*m;k+=b.x32;m+=b.y32;q<h&&(e=za[k+c*m],0<e&&0===V[k+c*m]&&(e=z[e],e.contain&&"meat"==e.contain[2].url&&
(h=q,l=e)))}if(c=l)f=Bd,a=c}else"meat"==b.stock[4].url&&!1===b.stock[2]&&(c=vi(b.x32,b.y32,!0))&&(f=vc,a=c,b.stock[2]=1);if(!1===b.stock[2])return b.stock=void 0,b.stay();b.stock=void 0;oa(a.id,b,f,b.url.move);Y(b.id,1)};Fd.cursor=6;uc.cursor=1;$c.cursor=9;Yc.cursor=5;Cd.cursor=7;Ae.cursor=7;xe.cursor=6;wg.cursor=6;var ni=function(a){var b=D,f=a.kingdom,c=a.x32,e=a.y32;c-=8;e-=8;for(var h={},l=[],g=0,k=ub[f],m=0;256>m;m++){a=m%16+c;var q=~~(m/16)+e;na(a,q)&&(a=k[a+q*b],void 0!==a&&(a=z[a],a.kingdom!=
f||!1!==a.built||h[a.id]||(l[g++]=a.id,h[a.id]=1)))}return l};Ec.available=function(a,b){var f=I[a.kingdom].values.wood;if(b.death||1>b.health-f&&b.workers.length)b=Aa(b.x32,b.y32),a.xf=b,b=z[b];return Lb(b,a,1,a.radix)};Ed.available=function(a,b){if(!b.death){var f=Lb(b,a,1,a.radix);if(f[2])return f}for(var c=b.x32,e=b.y32,h=0;5>h;){b=lk(c,e,b.type,b.id);if(!1===b)break;b=z[b];f=Lb(b,a,1,a.radix);if(f[2])return a.xf=b.id,f;h++}return!1};Bc.available=function(a,b){if(b.death)return!1;a=b.x32+1;b=
b.y32+1;return 0===V[a+b*D]?[a,b,1]:!1};Cc.available=function(a,b){var f=a.x32,c=a.y32;if(!b.death){var e=Lb(b,a,1,a.radix);if(e[2])return e}a.buildList?(e=a.buildList,e.quit(b.id)):(a.buildList=ni(a),e=a.buildList);b=te(e,f,c);if(!b)return!1;a.xf=b;b=z[b];return Lb(b,a,1,a.radix)};vd.rev=function(a){return(a=dg(a.id))?[Gd.url,a]:!1};Gd.available=function(a,b){var f=dg(a.id);f&&(a.xf=f,b=z[f]);return Lb(b,a,5,a.radix)};Bd.available=function(a,b){if(b.death)return!1;a=b.x32;b=b.y32;return 0===V[a+
b*D]?[a,b,1]:!1};vc.available=function(a,b){if(b.workers.length||b.milk<50/1.5||b.death){b=vi(a.x32,a.y32);if(!b)return!1;a.xf=b.id}return Lb(b,a,5,a.radix)};sg.available=function(a,b){if(b.death)return a.stay(),!1;var f=1;b.boat&&(f=2);return(a=Lb(b,a,f,a.radix))?(a[2]=1,a):!1};var vi=function(a,b,d){for(var f=D,e,h=Infinity,l=!1,g=0;441>g;g++){e=g%21-10;var k=~~(g/21)-10,m=e*e+k*k;e+=a;k+=b;m<h&&(e=V[e+f*k],0<e&&(e=z[e],e.cow&&(!e.workers.length&&e.milk>=50/1.5||d)&&(h=m,l=e)))}return l},ze=function(a,
b,d){for(var f=0,e=a.length;f<e;f++){var h=z[a[f]];oa(b,h,d,h.url.move)}},De=function(a,b){Ua(b,a,Ce)};De.noObj=1;var Ce=function(a,b){Id(b,-a,77,Ce)},Fe=function(a,b){Ua(b,a,Ee)};Fe.noObj=1;var Ee=function(a,b){Id(b,-a,130,Ee)},He=function(a,b){Ua(b,a,Ge)};He.noObj=1;var Ge=function(a,b){Id(b,-a,78,Ge)},Je=function(a,b){Ua(b,a,Ie)};Je.noObj=1;Je.cursor=10;var Ie=function(a,b){Id(b,-a,132,Ie)},Le=function(a,b){Ua(b,a,Ke)};Le.cursor=10;Le.noObj=1;var Ke=function(a,b){Id(b,-a,131,Ke)},Id=function(a,
b,d,c){var f=D,h=I[a.kingdom],l=x[d],g=x[d].cost,k=a.mana>a.manaMax;if(vb(a)||a.checkMana(g[4],b,c,g)){k||h.paypal(g);c=d;b*=-1;k=b%f;var m=~~(b/f),q=k,y=m,u=La[l.zLevel],r=~~(a.mana/g[4])+1;1<r&&(h.resources[0]-=g[0]*(r-1),a.mana-=g[4]*(r-1));for(h=0;h<r;h++)0!==u[b]&&(d=rg(l,k,m),q=d%f,y=~~(d/f)),ma("summon"+~~(10*Math.random()+1),q,y),d=new hc(c,a.kingdom,q,y,0),d.setupChild(Bb.spawn);a.setupDir(-a.x32+d.x32,-a.y32+d.y32);a.setupSpellIMG()}else h.paypal(g);Y(a.id)},wd=function(a,b,d,c,e){return~~Math.sqrt((a-
d)*(a-d)+(b-c)*(b-c))<=e},xg=function(a,b){Ua(b,a,Me)};xg.cursor=0;var Me=function(a,b){a.build||a.terrain||a.nofreeze||!vb(b)&&!b.checkMana(50,a.id,Me)||(a.freezed=1,a.stoned=1,ObjectsetupPosition(a,32*a.y32),a.stay(),ObjectsetupIMG(a,a.img,0),a.setupChild(Bb.turnStone),cd(a,Yh),Dd(a.id),b.setupDir(-b.x32+a.x32,-b.y32+a.y32),b.setupSpellIMG(),ma("turn%20to%20stone",b.x32,b.y32),ya({func:wi,data:a.id},24E4,1))},wi=function(a){a=z[a];a.freezed=0;Zb(a);a.stoned=0},yg=function(a,b){Ua(b,a,Jd)},Jd=function(a,
b){a.health<a.maxHealth&&!a.build?(b.setupDir(a.x32-b.x32,a.y32-b.y32),M("heal",Ca(b.img)),b.setupSpellIMG(!0),b.setupINTV(zk,{u:a.id,a:b.id},0),a.addWorker(b)):b.stay()},yi=function(){Ua(list,obj,xi)},xi=function(){},zk=function(a){var b=z[a.a];a=z[a.u];var f=I[b.kingdom].values.healingRange;ma("heal",b.x32,b.y32);if(!wd(a.x32,a.y32,b.x32,b.y32,f))return oa(a.id,b,Jd,b.url.move);if(vb(b)||b.checkMana(4,a.id,Jd)){b.setupDir(a.x32-b.x32,a.y32-b.y32);a.health+=6;a.setupChild(Bb.heal);if(a.health>=a.maxHealth)return a.health=
a.maxHealth,Y(a.id,1),Y(b.id,1),b.stay();Y(a.id,1);Y(b.id,1);mb(b,Ca(b.url.spell))}},Oe=function(a,b){Ua(b,a,Ne)};Oe.cursor=10;var zi=function(f,b){f=z[f];b=z[b];if(f.inventory.quit(b.id)){b=a[b.spell];f.icons==f.__proto__.icons&&(f.icons=f.icons.slice(0));f.icons.put(b);var d=f.icons;d.olegal||(d.olegal={});d.olegal[b.id]=1;Y(f.id)}},Kd=function(a,b){var f=b[1];b=z[b[0]];z[a].nopotion||z[a].build||(oa(a,b,Ai,b.url.move),b.actionItem=f)};Kd.item=1;var Ai=function(a,b){var f=z[b.actionItem];b.actionItem=
void 0;f.attack&&(a.attack+=f.attack);f.defence&&(a.defence+=f.defence);f.mana&&(a.mana||(a.mana=0,a.manaMax=0,a.update?a.update.push("mana","manaSpeed",1E3):a.update=["mana","manaSpeed",1E3],ya({func:ne,data:[a.id,"mana","manaSpeed",1E3]},1E3,1)),a.manaMax+=f.mana,a.mana+=f.mana);f.level&&(a.level||(a.level=0),a.level+=f.level,a.attack+=f.level,a.defence+=~~f.level);ma("bless",a.x32,a.y32);b.inventory.quit(f.id);b.stay55();Y(b.id)};Kd.cursor=10;yg.cursor=10;De.cursor=10;Fe.cursor=10;He.cursor=10;
var zg=function(a,b){Ua(b,a,Ak)};zg.cursor=1;var Ak=function(a,b){a.isSpy&&a==b?b.stay55():(b.setupDir(-b.x32+a.x32,-b.y32+a.y32),ObjectsetupIMG(b,b.url.attack,1),ya({func:Bi,data:[a,b]},Ca(b.img)-25,1))},Bi=function(f){var b=f[1];f=f[0];f.die(1);var d=f.getRadix();d[b.x32+b.y32*D]=b.radix;b.x32=f.x32;b.y32=f.y32;b.d=f.d;b.name=b.name;b.attack=f.attack;b.defence=f.defence;b.update=b.update;b.mana=0;b.manaMax=b.manaMax;d[b.x32+b.y32*D]=b.id;ObjectsetupPosition(b,32*b.y32);b.__proto__=f.__proto__;ObjectsetupIMG(b,
b.url.idle);d=f.icons.slice(0);d.quit(a.menuBuilds);d.quit(a.menuBuilds1);d.quit(a.menuBuilds2);d.put(a.impersonate);d.put(a.revealSelf);b.icons=d;b.spy||(b.spy=b.kingdom);b.kingdom!==f.kingdom&&b.changeKingdom(f.kingdom);b.setupChild(Bb.impersonate);Y(b.id)},Ci=function(a){a=z[a];if(a.spy){var b=x[2];a.attack=b.attack;a.defence=b.defence;a.__proto__=b;a.icons=b.icons;a.kingdom!==a.spy?a.changeKingdom(a.spy):a.stay();ObjectsetupIMG(a,a.url.idle);Y(a.id)}};Oe.allowPos=1;var Ne=function(a,b){if(a.id){var f=
a.id,c=a.x32;a=a.y32}else f=-a,c=a%D,a=~~(a/D);if(vb(b)||b.checkMana(60,f,Ne)){b.setupDir(-b.x32+c,-b.y32+a);b.setupSpellIMG();f=8;c-=.5*f;a-=.5*f;var e=[];f+=1;var h=f*f;ma("bless",b.x32,b.y32);for(b=0;b<h;b++)for(var l=1;3>l;l++){var g=z[La[l][b%f+c+(~~(b/f)+a)*D]];g.build||g.terrain||(g.setupChild(Bb.bless),g.blessed||(g.blessed=1,g.attack+=5,Y(g.id,1),e.put(g)))}ya({func:Di,data:e},3E4,1)}},Ua=function(a,b,d){if(a[1]&&z[a[1]].item){var c=a[1];a.length--;ze(a,b,d);z[a[0]].actionItem=c}else ze(a,
b,d)},vb=function(a){var b=a.actionItem;if(!b)return!1;b=z[b];b.attack&&(b.attack--,0===b.attack&&(a.inventory.quit(b.id),Y(a.id)));return!0},Di=function(a){for(var b=0,f=a.length;b<f;b++){var c=a[b];c.blessed=void 0;c.attack-=5;Y(c.id,1)}},Qe=function(a,b){Ua(b,a,Pe)};Qe.cursor=10;var Pe=function(a,b){a.freezed||!vb(b)&&!b.checkMana(50,a.id,Pe)?b.stay55():(b.setupDir(-b.x32+a.x32,-b.y32+a.y32),b.setupSpellIMG(),ma("invisible",a.x32,a.y32),a.invisible||(cd(a,ig),a.invisible=1,a.stay()),Y(a.id),ya({func:bd,
data:a.id},5E4,1))},bd=function(a){a=z[a];a.death||(a.invisible=void 0,Zb(a))},Bg=function(a,b){Ua(b,a,Ag)};Bg.cursor=0;var Ag=function(a,b){if(vb(b)||b.checkMana(50,a.id,Ag))b.setupDir(-b.x32+a.x32,-b.y32+a.y32),b.setupSpellIMG(),ma("lightning",b.x32,b.y32),a.damage(50,b)},Se=function(a,b){Ua(b,a,Re)};Se.cursor=0;Se.noObj=1;var Re=function(a,b){var f=D;if(a.id){var c=a.id,e=a.x32;a=a.y32}else c=-a,e=a%f,a=~~(a/f);if(vb(b)||b.checkMana(50,c,Re)){b.setupDir(-b.x32+e,-b.y32+a);b.setupSpellIMG();ma("flame%20ball",
e,a);c=e-b.x32;e=a-b.y32;a=Math.sqrt(c*c+e*e);c/=a;e/=a;for(var h=b.x32+.5,l=b.y32+.5,g=[],k=[],m=0,q,y,u=0;u<a;u++)q=h+c*u,y=l+e*u,k.put(q),k.put(y),q=~~q,y=~~y,g[m++]=q+y*f,g[m++]=~~(q+e)+~~(y+c)*f,g[m++]=~~(q-e)+~~(y-c)*f;for(u=0;u<0*g.length;u++)oe(g[u]%f,~~(g[u]/f),"food");ya({func:Cg,data:{list:g,anim:k,i:2,a:b}},1E3,1)}},Dg=function(a,b){Ua(b,a,Ld)};Dg.cursor=10;var Ld=function(a,b){b.setupDir(-b.x32+a.x32,-b.y32+a.y32);b.setupSpellIMG(!0);b.setupINTV(Bk,{u:a.id,a:b.id},0);a.addWorker(b)},
Bk=function(a){var b=z[a.a];a=z[a.u];if(!wd(a.x32,a.y32,b.x32,b.y32,I[b.kingdom].values.teachDistance))return oa(a.id,b,Ld,b.url.move);if(a.level>=b.level)return b.stay();if(vb(b)||b.checkMana(10,a.id,Ld))ma("teach",b.x32,b.y32),b.setupDir(a.x32-b.x32,a.y32-b.y32),a.setupChild(Bb.curse,!1,pk),ug(a,!1),Y(a.id,1),Y(b.id,1),mb(b,Ca(b.url.spell))},Ue=function(a,b){Ua(b,a,Te)};Ue.cursor=0;Ue.noObj=1;var Te=function(a,b){var f=D;if(a.id){var c=a.id,e=a.x32;a=a.y32}else c=-a,e=a%f,a=~~(a/f);if(vb(b)||b.checkMana(70,
c,Te)){b.setupDir(-b.x32+e,-b.y32+a);b.setupSpellIMG();c=e;var h=a;e-=8;a-=8;for(var l=0;256>l;l++){var g=e+l%16,k=~~(l/16)+a,m=g+k*f;na(g,k)&&64>=Math.pow(g-c,2)+Math.pow(k-h,2)&&Ve[m]&&0===V[m]&&(M(g,k),new hc(60,b.kingdom,g,k,0))}}},Cg=function(a){var b=a.list,f=a.anim,c=a.i,e=a.a,h={x32:f[2*c],y32:f[2*c+1],d:0,img:k.flame_trail,mv:1,z32:2,alpha:!0};Ra(h);zb.new(h,Ca(h.img));for(h=0;3>h;h++){var l=z[V[b[h+3*c]]];l.health&&l.damage(96,e)}a.i++;a.i<.5*f.length&&ya({func:Cg,data:a},50,1)},Xe=function(a,
b){Ua(b,a,We)};Xe.cursor=0;Xe.noObj=1;var We=function(a,b){if(a.id){var f=a.id,c=a.x32;a=a.y32}else f=-a,c=a%D,a=~~(a/D);if(vb(b)||b.checkMana(60,f,We))b.setupDir(-b.x32+c,-b.y32+a),b.setupSpellIMG(),ma("freeze",c,a),ya({func:Ei,data:[c,a]},1E3,1)},Ze=function(a,b){Ua(b,a,Ye)};Ze.cursor=0;Ze.noObj=1;var Ye=function(a,b){if(a.id){var f=a.id,c=a.x32;a=a.y32}else f=-a,c=a%D,a=~~(a/D);if(vb(b)||b.checkMana(70,f,Ye)){b.setupDir(-b.x32+c,-b.y32+a);b.setupSpellIMG();ma("confusion",c,a);b=4;c-=.5*b;a-=.5*
b;f=D;var e=[];b+=1;for(var h=b*b,l=0;l<h;l++)for(var g=1;3>g;g++){var k=z[La[g][l%b+c+(~~(l/b)+a)*f]];k.build||k.terrain||k.stoned||(k.confused=1,k.invisible&&bd(k),cd(k,Zh),k.stay(),k.oking=k.kingdom,k.kingdom=I.length-1,e.put(k),Dd(k.id))}h&&1===J.length&&Y(J[0]);e.length&&ya({func:Fi,data:e},2E4,1)}},Fi=function(a){for(var b=0,f=a.length;b<f;b++){var c=a[b];c.confused=void 0;c.kingdom=c.oking;c.oking=void 0;c.death||(ObjectsetupIMG(c,c.img,1),Zb(c),c.stay(),Va==c&&(Va=void 0,J[0]=c.id,Y(c.id)))}},
Ei=function(a){var b=6,f=a[0]-.5*b,c=a[1]-.5*b,e=D,h=[];b+=1;var l=b*b;a={img:k.freeze_expl,d:0,mv:1,x32:a[0],y32:a[1]};Ra(a);zb.new(a,Ca(a.img));for(var g=0;g<l;g++)for(var n=1;3>n;n++)a=z[La[n][g%b+f+(~~(g/b)+c)*e]],a.build||a.terrain||a.nofreeze||a.stoned||(a.freezed=1,ObjectsetupPosition(a,32*a.y32),a.stay(),ObjectsetupIMG(a,a.img,0),a.invisible&&bd(a),cd(a,Xh),a.health-=40,1>a.health&&(a.health=1),h.put(a),Dd(a.id));l&&1===J.length&&Y(J[0]);ya({func:Gi,data:h},2E4,1)},Gi=function(a){for(var b=
0,f=a.length;b<f;b++){var c=a[b];c.freezed=void 0;c.death||(ObjectsetupIMG(c,c.img,1),Zb(c),Va==c&&(Va=void 0,J[0]=c.id,Y(c.id)))}},af=function(a,b){M(b);Ua(b,a,$e)};af.cursor=0;af.noObj=1;var $e=function(a,b){M(a,b);if(a.id){var f=a.id,c=a.x32;a=a.y32}else f=-a,c=a%D,a=~~(a/D);if(vb(b)||b.checkMana(100,f,$e))b.setupDir(-b.x32+c,-b.y32+a),b.setupSpellIMG(),Eg(c,a,3,20,4500,b.id)},Eg=function(a,b,d,c,e,h){for(var f=k.fire_rain,g=r.gravity,n=Date.now(),m=Eg.rnd,q=Math.PI,y=performance.now(),u=0;u<c;u++){var t=
2*m()*q,v=d*m(),w=a+v*Math.cos(t);t=b+v*Math.sin(t);v=~~(u/c*e);na(w,t)&&ya({func:Hi,data:{x32:w,y32:t-6,dix:0,diy:140,img:f,mv:1,d:0,timestamp:n,finnish:Infinity,aceleration:g,attack:40,xf:w,yf:t,range:2,kingdom:0,obj:h,crashTime:(Math.sqrt(19600+384*g)-140)/g*1E3}},v,1)}M(performance.now()-y)},Hi=function(a){ya({func:ye,data:a},a.crashTime,1);Ra(a,0,a.diy,r.gravity)};Eg.rnd=function(){var a=4096,b=2048;return function(){b=36969*(b&65535)+(b>>16)&4294967295;a=18E3*(a&65535)+(a>>16)&4294967295;return((b<<
16)+a&4294967295)/4294967296+.5}}();var ri=function(a){z[a.obj].damage(a.attack,z[a.obj]);wb(a);$b.put(a.bufferID)},Ii=function(a){a=z[a];a.bufferID&&(wb(a),$b.put(a.bufferID));Ve[a.x32+a.y32*D]=void 0},ye=function(a){var b=D,f=a.xf,c=a.yf,e=a.attack;a.mv=1;a.func=void 0;a.x32=f;a.y32=c;ObjectsetupPhysics(a,0,0,0);ObjectsetupPosition(a,2);f=~~f;c=~~c;var h=f+c*b,l=V[h];Ob[h]?(a.img=k.expl_small_water,ma("water%blop",a.x32,a.y32)):(a.img=k.expl_small_hole,ma("small%20explosion",a.x32,a.y32));ObjectsetupIMG(a,
a.img,1);zb.new(a,Ji(ra[a.img]));if(2<l){var g=z[l];g.damage(e,z[a.obj])}h=a.range;l=2*h+1;for(var n=0,m=l*l;n<m;n++){g=n%l-h;var q=~~(n/l)-h,y=~~Math.sqrt(g*g+q*q);y<h&&(g+=f,q+=c,g=V[g+q*b],2<g&&(g=z[g],g.damage(e*(1-y/h),z[a.obj])))}},Ck=function(a){if(0<J.length){var b=z[J[0]],f=0,c=0,e=0,h=0;void 0!==b.dix&&(a=.001*(a-b.timestamp),h=b.dix,e=b.diy,f=h*a,c=e*a);if(b.space){var l=b.space;a=l[l.length-1];l=(l.length-1)/a}else l=a=1;f+=32*(b.x32+.5*a-Math.sign(h))+.5*-tzar.width+.5;c+=32*(b.y32+.5*
l-Math.sign(e))+.5*-tzar.height+.5;bb=~~-f;cb=~~-c}},Ki=function(){};Jd.distance="healingRange";Ce.distance="createGolemRange";Ne.distance="blessDistance";We.distance="freezeDistance";Ye.distance="confusionDistance";Pe.distance="invisibilityDistance";Ag.distance="lightningDistance";Ge.distance="createBatDistance";Ee.distance="createDragonDistance";Ke.distance="createCarpetDistance";Ie.distance="createJinnDistance";Me.distance="turnToStoneDistance";Re.distance="flameBoltDistance";$e.distance="fireRainDistance";
Te.distance="freezeDistance";Ld.distance="teachDistance";var I=[];var Tb=function(a,b,d,c,e,h,l){this.name=a;this.k=I.length;this.color=b;this.status="";this.stats={dmgInflicted:0,dmgTaken:0,resources:[0,0,0,0],score:0,unitsKilled:0,unitsLosed:0,buildsLosed:0,buildsDestroyed:0,unitCount:new Uint32Array(x.length),unitCountMax:new Uint32Array(x.length),unitCountDeath:new Uint32Array(x.length),goldTraded:0,goldConverted:0,stoneTraded:0};this.team=l;this.resources=h||[5E4,5E4,5E4,5E4];this.values={gold:10,
wood:10,food:10,stone:10,buildSpeed:1,experience:0,healthJump:0,maxLevel:4,pop:0,popMax:1,popLimit:200,healingRange:1,blessDistance:9,createGolemRange:5,freezeDistance:13,invisibilityDistance:9,createBatDistance:16,lightningDistance:12,createDragonDistance:4,turnToStoneDistance:21,flameBoltDistance:19,fameTech:0,confusionDistance:13,manaSpeed:2,milkSpeed:2,cowSpeed:2,stealCow:0,miningPerf:1,fireRainDistance:15,createCarpetDistance:3,createJinnDistance:3,teachDistance:2};this.race=c;this.racestr=Fg[c];
this.IA=e||0;this.diplomacy=d;this.control={};this.control[this.k]=1;this.onFreePop=[];a=[];a.length0function=Dk;this.unitLoading=0;this.target=[0,0,0,0];this.crusade={number:0,list:a};this.technology={hidden:{},disabled:{},actived:{},investigated:{}};this.mod=b=[];Li[this.racestr]++;a=0;for(d=x.length;a<d;b[a++]={});I[I.length]=this;a=this.k;b=[];ub[a]={};hb[a]=b;for(d=0;d<x.length;d++)b[d]=[];I[0].diplomacy[a]=1;b=this.color;ua[3*a]=b[0]/255;ua[3*a+1]=b[1]/255;ua[3*a+2]=b[2]/255};Tb.prototype.setupResources=
function(a,b){var f=this.resources;b||(b=1);f[0]-=a[0]*b;f[1]-=a[1]*b;f[2]-=a[2]*b;f[3]-=a[3]*b;Be(this.k)};var hb=[];var ub=[];var ua=[];Tb.prototype.check=function(){for(var a=Ek,b=hb[this.k],d=0,c=x.length;d<c;d++)if(!a[d]&&0<b[d].length)return!0;this.die()};Tb.prototype.checkPopArray=function(){this.onFreePop.length&&xd(this.onFreePop.shift())};Tb.prototype.die=function(){this.k+1!=I.length&&(this.death=1,this.status="defeated",Mi(),Ab(dd(A.playerDefeated,this.name),0,5))};Tb.prototype.paypal=
function(a){var b=this.resources,f=!1;b[0]<a[0]&&(Ab(dd(A.notEnough,A.gold),0,5),f=!0);b[1]<a[1]&&(Ab(dd(A.notEnough,A.wood),0,5),f=!0);b[2]<a[2]&&(Ab(dd(A.notEnough,A.food),0,5),f=!0);b[3]<a[3]&&(Ab(dd(A.notEnough,A.stone),0,5),f=!0);if(f)return f;b[0]-=a[0];b[1]-=a[1];b[2]-=a[2];b[3]-=a[3];Be(this.k)};var Be=function(a){if(a==t.kingdom){var b=I[a].resources;a=b[0];var f=b[1],c=b[2];b=b[3];Infinity==a&&(a="***");Infinity==f&&(f="***");Infinity==c&&(c="***");Infinity==b&&(b="***");Fk.innerHTML=a;
Gk.innerHTML=f;Hk.innerHTML=c;Ik.innerHTML=b}},Ek={13:1,20:1,21:1,22:1,27:1,32:1,35:1,36:1,43:1,44:1,55:1,56:1,57:1},qb;var Ni=[];(function(){var a="",b=new Image;b.src="data:image/gif;base64,R0lGODlhIQB2AfcAAAAAABAIAAgAABEhACE6ABkbChAQAAgIABAQCO/vlN7epf/6hZSQUv76n721a//rY/XmhnNjECklEP7oecW1Y+7ZeP/rhvvrljEpCCgiB+/Wa97OjP/WSu3YhyEZAIhzLf/WWOnHWv7baL2lVt3Db/vsvUo3BGtSCGhVIdq1SnhjKdy4V62USuvIaPzad/felO/XlzopAGtaMe3Kd/zbiOjMhv/9+JxzGWNKECEZCP/JSuu5Sc6lSMynV4tzPdSyaK2UWjEhADopCNacKWNKGVdCGf/IVuu4VruUSPzJZ7qYU0IqABkQAGdFB2tKEFI6D5tzKMqVN9unSNyrVlRDI/nLd7JwACkZAOaUEDEhCMSMMZRrKYlkJ/u3SJt0M8yYRquDQO66Zu3MlrWcc5haAItSAf+lGUIqCGNCEJdjGXpTGJxrIfisOGtKGcSNOtacQruHOfu6VsiYVOm6dPvLh/rZqTohAHdHB3NKEFo6D0kxEJRjIc6MMalzKYRaIZxrKXlTIuCcP6x5M+umR1I6GX5aKdacSuqqVdedUollNK2HVUopAFQxBXtKEGtCEMmBJ7h2J3NKGdeNNMOCMWNBGZRjKf2rR86MOtaUQpdpMt6cSrqFQkk0GnVWL9OjZolVGeeQLJ5jIKdqJ4xaIeCTObd6NembRt6UQsWEPGlHIf+tUsuMQ9aUSppyRzEZAGU1BkopCHNCEDohCFIxECkZCPeXM3tKGdKDMIRSIZxjKlo6Gc6EOoxaKahwNt6USjUkE/zLmUIgACEQAIZLEtZ2H5ZUF2Y6ELlpIN9/KGtBGUUpEHVKIRkQCNaMRntCEHNCGZdZI86MUjoZAFQoBs5qIF0xECUZEE8hAHQ0CIQ9C5RHD65TFb5cGXY6EDEZCHtCGYRKIVIxGSkQAEohCEIfCVIpEKJEEUUpGWgnBzoZCEIzKzEQABkIAHMpCIw0CyEQCFsZAlEZBikQCDQZECEHAD4PATEQCGshEDEIAPNGKRkAABAAABkICBAICAgICP///yH5BAEAAP8ALAAAAAAhAHYBAAj/AP8JHEiwIEEBBhMqXPiP3QGEAwVAZKgQYoBwLAIMpIUCwESKE5lI/CeA0woU+wTSIvHk40IBD/9x+vHrnYB9+358EbdPwDsavfi5NMiEChcA/5i0QIKrzTsANeQoC+DzAhJvKYcK3AeoAheqAlbo0XNGlpIKR5axEyChwwo/U7UK+EWiAxRdgH5RGnWpD6ArwpCUWlaES40WX0pRompQwIcXLbR8ObKi1BdUcXatMsZuFCUuUtxKidLr11ABT5Ag+tIHjK5MYb5UilPqlK0rVwKkmiJFyyVBpgsyCRCAEpIvyubJC4CkCq9Rh3JhqiRSAJQvcPgIUgaTIIofMvL8/5hCKwfEHmEiDcq0CtosdklHjeoDaSpSgQKoWGjRowMYWh4JlEgYm4wyhR+buaKLAEwoQ4gfs9CikUBM/OBWCytEAuBESIThhyZbVGILOU+QJEAOhFBCyy/44QDDDFKsgJwwqRA0oBejiBJJMmecYSIAOSxjjzf4jeLCFNi9ocxugAyk3hSVhIILGmd4U6KJ77yTAzu/cMIOZXBQ4gcsRXyRhB4CPXEJHT2U4kUyeggzS0QCABAAHD0koUIP/HkjzwH/+ODCFz7qUQoNM3zBVB5X+GjQLGBQtkIHSTxDXAB5wGFBGEUUcUsVF8SWSzJZyJLQTZUc0cIMK7ghhAAZ/P9DySAWuBCHKYdcMMMUgkQSZxGnyiPFF27wIAUX9hgQQBu4DOKCrVLQUMURboySBxNonurFCmn4UYoWfsiT0l6TDBLHIWGEgeQfaAQhREXhrADHLLrgIsgswgiURySiuCEFK4dg4oYoz5yhlUDiRCEFJfZk0UYeNgkkizGfiCJKKajAkYstswTQpEKzVsIOO+Rk4Y1IAglzRh7OQFOKIKF8wmgWClHVhyRFBOARLbRMxI4wsDgSSh99jJKMLKfNxY4abgiii851fiQAO64Yc4woebiCckE5qFCFEnB8IcUWv2zdmDDDSCMRg40RIkgILVAmxRPvTJjQPuwA4FG+pzL/w8UkYGCXzC8BJkSVnSBloYssnMxSsgEHU2RQFjoH4I0wkUuuEAB4Z655RZ8rVAIgzIQeehx0RMKE6Z9XkcQspbNOESZ0xAG77BQFAoztseOukO6WlNO77waZUocls+RAvEKHHJ/88gk1X4sxtEBvUBh1sGGM8tYTNIgNtXzC/T9kVA99IOA/f0cJtYxPPB82gHLHP03QYAU93fOBzDE5bGLKK90byB1I4Q3zdS8PjGhCCaxgQOjdwQZWMAMtzIAFmlmPBmzIAiX+8YohlKEM81teGXg2kDLYgAZkCOBAmlCLWtxHhf/4IAxnSMMa2vCGOMyhDnfIwx768B82QEMN/2dgg3fN0BNhsAERZtgKRMDABsaYISvCAIMSPINIAczEEeRQhxK8woLWe8UOLrGCElzAFukIIB+O8IgpXGAOr0hHH6yXiyQkRgwwSMIdvGGx5anBCFNYhSjmMIcj3MAbgIDE8jQRBkQIYg3j2YEUZBELLRAPCUk4hBy4kAs5wEFh8nDEG6KAuyZkcgpwaEQvFCGIK3jjDIx4xA5wd4QjBPITjviDMITBjiysCAMvDF0f4iCFUkBDDx6QhTVmIY/CyY4eSZACKi5BjgA0QgtbkEUDZReFHexAHOKoRAPC0IZXLm8ZIBCHzvTgiVKlwhrLO4cx9oEUAGSAFnKYAhf6of9CABxAEDtIhCxMAMMA7OEMPSiGGmDIiDF0AAnQgOEBQFEDRgSzeyYoBqZ+yNGOevSjIA2pSAVygic0gXVLkFwT3BGPeIQOHYx4wkUL0gRzcCMe2KiH5tCBDnfo7R/kUIg79hcPdLhUcuiwqUvrwQiDtJQatQiEOdxBAKQO9RgR6GlCpsENZOgAGdxoRzAo8tSoTpUA7RhIPYo6VB3ooAuSaCpFuOpVsLZDrsFohzt4So0u6MAIICjGWBligra+Na7uYEQw3OGOf5iAG2z46wOksA10UAQdff1rYBlbD3MU4x/40EYtACuCB1SWIo+NrBEmy9MMcIMa7sAHPh6hAxD/GIEDoOAGNggrWtKaFh3C2AYoGCvbY7CBDaAgRjF2S9ha1Pa2oMgGPhhRC9hqY6/aSC4xZMHchZgAG9g4bnKLEQ/hgsIc1KCGOeqhjW6wFJwUwYY7skuM7b5iG1A9BlSJgQ5yoMMY2CiA5kyAjm24Nx5LcAc12BAIZBx3G8HARgbEEVTJYWMc4/gvNmiBDmKAQge1YEMXkGEOciDucxgex4QZUY/6dsEIx60FMnA3DmwwIwCMYIQ5zEGMOOiADSGuMOsC8F1s5HjHo+1CLUABCuIFYLc7tikpunAL4Q4Deozdhja2wQ1zwOMRw7gy8eABj20Uoxxchgc5lKGM5cGj/7NnCEA3wgqAJaQUeu2gypPRUY9pbMN6AchCBhAQjAybo3tkzkA83lEAIXcvB9gQRwGkMdJKW/rSBlHGDFhHAxZRJAdV2PTnfhCGbSbkHZqgQRg0hwgXaMLTDBEGL1ywK4qsIgxJyISpDSKMZEBCD0VIxEIooQxvbCMZuy6IN6YSgGQPJAuY24ezB+IndsDCCFFUSB6mAIt3sAOLmnsGJXRBhSIAQhB9EIUXEkGIZETI0Zr7hS5IMYELXKABF6hAC5JwhC+0wZes08UXBpEEC1igAQ2oVRICAYdKKAPeklvGwI0wgYM3YAJJiMMb4MALPUw7Ictwg7lEgHFTTCEJYf9wQy9SUZOA/yEQcQDBD/KRD3f4AA598MMTaPEO1inDW4OwRCvu4Y56qAMQe2iDMnIgD9Z5IxJ9MIUlOsGJeajj6J/QxS+Y8XGD0IISezhFF7rwB3VQAQqTiESEEADuz3ljFkDvgghEYIRBKGbpzADj52ThsJfL3QVGOAIXnpAFZuRddjl4Ai5IYQkjiICYfvA4M3ouO1n8IhKCGIQRkmCJLwBi6c32nTcI0Qdz1V0QRaBc1xkiC13AwQinJwQz2o67TCjDGKUwRR+MUQ0JWO8Qn3+HhNjxiVNA7xBfqIaQx5EHTKyCeGCYAiXSSJB08IIUgsBdKwyBC9oLRBm5sLv/7MCQiDYrJBWtyASm189+9tvBDq4QBwyfMApW9CEZ7EhJ98Cwik3EYRKrYFHdkwhV8AW4kASiYAqRMDLWIwc0gAu2cAi4oAm84DmjVgV5IIHNMApnMFOy4zWbAAiH8AyowAj0MCfQowRzEAmHUAi84AhXQFCycyUCUgWZgAu5gAbGcAWuIDtEcAjAIhDJcAg/wAuVoAbV4ArsIIOh8wRy4AJBIBBnsAoX8AOb4AXGEAz7YCqs4wMQgAhX8A9nUAoXQANToARqwAhUIzsmsAoJEAZjsQs00AAFWAnGsEu4kwdxkAATcASkEAYNoGqCEAvBIADZYjqUoAaHAAEYlyuq/2aAsCAAjsI6eTAKbnAIKFcFVRAGhvAHeSAMYYg7JuAIorAKU4AIYcAKXyAKO+iBnyMOjKAGfyAKvVAKm5ALjhAMAPAxuLMP0jANxjAMgiAI0OAIsPAzy+MRrjANwwAN0MB74uCKoaM3+jANxVAMdrAW0mg6nPMK9KA3zgQ9HgGOdmM94LiN7ZeO6riO7HhpvdALgJAKNdI9QFAKq7AKqggGhQBrvvMDM2AKvsAK94gKm5AJ50A8PwADdBAGAMkKqECQmyAInOA7JFACM3AIhzAIlXBurLAJBTmRsvMDJVADh7ADEPACiZAKuXePnYA7P2ADdRAGgzAHNqAA35AKnP+QCJ1ABbjDRSUQBhipATZwBLkAADc2ALgDBh1AA3FzBKkQAhuwCalQjrKDCPl2BILgD9TQC60QDa0gYL6TCj/QAodwDgDACZsADK3ADAiwPKmQCVQQO5nQCe/Qb9XglsFEBb9QBz8gCLYAQ79ABXy5ChukQr/QCTDgCaUQDoBJBWLgCZkAkgH0C4nwmJnAmIbZCmIgB51AldDzC62gCOqQAZ65PL/wCwdAHDN0Ke3Ymq75mrAZm7ApmbhDmwSRCqdQmOFgfp9DCKigC5kGCKUADsogAnCFmQwRB3GgBxeDC6aWBctwBtzwAA1gCZFAEV0wAQ1wDNWQDJRnEAeQBZD/YAkuUJ28aRCWUHGWgAzCoHeZJgi7kJ4NcAsKUQsNIAKmIAmiAJwMkQOUwC+3cAQQkAwGkQsL0AWQMArQoCGSkwM8MwvVMAu+QhCzoAbdMA16oE3uwzq4EAeqcJ7W06ElIALQAKLLE4E0cAvpUJq+MwtWMw4BsDoq9A4ZyqIU8XV/UAqScJ9GwIsDMQopQAKBMAkv0waHyDX+VApJUAITEAi8gJwDoQzHcAQlQAeDwAVTYaL/ACBMcABwMAinIApQShCyAAldkACJEAAHACQJoQx/gAzKcABuUApaOhDGIAnHAADdoA0kVBCzIAmWwAbcAADLkAx1+n1/wAS/wAeg/0ANBaEMcKAKpoAJnZAFAKAHhzoQyaAzlPAFpkAKkGBBunEJojALT2GUR6oQlKM3utALl0CnysMMB7AM5sMzY7oQv2A+DqML72B+zMCPxMMJB7B6slmsxnqsyNqO+0AfvoMOxcANxIAMknALx9AHoHgEgzAIxxA6jNAIj0AKRxCI0hIGkjAM7JAG5UmHpvA5mNMIXeAGaeAIS3AF4tAEWfMIoGAEFjcDbyA5IoEbxMEOTMAEAssEwuAEofAIjyAJSfAsUyA5+ReF//AJgjAJdwaKrrAIefAKd3AHogAH/fo5dyAGJWAJ1BAD/yAM4mAHMWAHgLFLBksRFisQV0ADSf8wCKGwCLgzCW/AB4GABsPxD3aQbq/wCnbwOVwABsYyAzRgK4MQBIUDGOIgo/8AB1uABqJAgwQhDksjBWFQBS5QBVGAOaIACYvwBGcQA4wgCF57CHFACqJwZwkBAMGwDccACX2xD0EgCpJgBC5gAWVYBdIyGsVAD/LHEPtwDdjwCX2wFsWQBpCgsNN6CZOQBp8QC9JwBVTLEAHADoygM0zgCuswDdfAU9LQE5wTDD34OewQAK6gfzPEN8k6u7Rbu7Z7u7ibu5rTB+LAhSr0LNPAN4VgqbuoBJ+FOyKwAq9gCAYXBqUwAxVAAz8wDdhwvKxTDCFgAUlwb67TAmEwA47/kA2LKzsNsABJAHtx0AWB0AMkQAl5EwvOwDoJB3tG0AWDQApTAAaYQxw/FTrl6wIZ1wWgQAqIsARrozcWWBAAbARxMAiSgAibsL/nKDthgK2kgAmIYAwSoY11gjtTsAluoAmlQBX0cAYqEBO+AwdKoASMIBH0Cgap4AqhiDtKoAiuQBUHgAcqsAAO0AEMQDxMIA514hEBIAwU8ASfcAUJ/DlXUAFPYLfXsBYBdAbbUAWmEAoC2D2u8AoAPAmfIMXdIwClUAWaAA0trEKycAhVAAmOgDkBZAe4EAY/8AmRqEJnAAdzIAiOcMMqxAhfMAqzQDl2nMRqaqO4kxtLrLuK/7zIjBxSsLAIROIEgMkCUqAOUDANAbQFH8ACK+ACbfAJAqEGLLBQvpMBbbACK9AFXOAov7ADR+s7A5ACPAACg2ALRiQNtHANy+MNn5AMsMAEJ2UQetAGbcAIsAAFn0MLJsAOdiBXBgEASAAIPdAK5ODMC+EIjjANWSACSDEWZSEQX0ACYcADK2AIMkIR2VAEKwA0D8AEe9EXfyEMAGAMSRACIdArM7wQAXAEI8AFM9AGXnAZmbEZ7JC8UoAEUfAJqWo4gGABSqABI6AHmyAbtGEbuNEHe4AHdWYQd2DCjKAJLoAEIr0CUiAFhFAERQgd0kEd7CAPApBsDDABLSAA5P/gLCtAGVPwB0TgA+mxHu3xHuxwDbsGAJsQAl2gN8swCFMgKVJgDHpAIAaCIMagIAshDVzQBVpwAFywADCCylOQCZSgB53gISAiIiTCEOGgN1CgBUUbBVGgDFygBt7wDlwQBjiiIzwyiQnxCgLACK7gCrvIBYSwCUXwBHP9JFEyJVWitQzRD81w0mYyFkygJmziJnAiJ5rzCrLwDD4hKIQyD4aCKIqCC4yi1wvxCvQkDrSQKZvSKZ8SKl8wKqXCOgbgDbNSK7eSK7vSK7/CED4ABipQEMziLNAiLdRiLdiyEMxwBF1gouRiLuiiLl/ALu6yENOQCG0ACwmxL/3yLwFJMzAFkzmguBATUzEXkzEb0zE+yjoqwzIuAzMycwXuyTo/EzRDUzRHk8gVQTVWgzVao98vgTZqIxGbuzx4g8CyC2h1YsiN/DkBAQA7";
var d=document.createElement("canvas"),c=d.getContext("2d");b.onload=function(){d.width=33;d.height=34;for(var f=0;11>f;f++)c.drawImage(b,0,34*f,33,34,0,0,33,34),Ni[f]=d.toDataURL("image/png"),a+=".ncursor"+f+"{cursor:url('"+Ni[f]+"'), default}",c.clearRect(0,0,33,34);document.getElementsByTagName("style")[0].innerHTML=a};jc(2)})();var Md=function(a,b){v(a).style.display="block";Md.actived=a;b.actual="potion";b.id=0;b.amount=100;b.func()};Md.actived="";var Z={potion:{bak:1,max:4,ord:["level","mana",
"attack","defence"]},sword:{bak:5,max:3,ord:["attack","attackBow","defence"]},book:{bak:8,max:18,ord:"fireRain lightning healing createCarpet createBat bless freeze confusion invisibility createGolem magicVision raiseDead turnToStone whirlpool createDragon flameBolt teach createJinn".split(" ")}};v("mgbook").onclick=function(){Z.actual="book";Z.id=0;Z.amount=a[Z.book.ord[Z.id]].obj.spcost[0];Z.func()};v("mgpotion").onclick=function(){Z.actual="potion";Z.id=0;Z.amount=100;Z.func()};v("mgsword").onclick=
function(){Z.actual="sword";Z.id=0;Z.amount=100;Z.func()};v("mgdecline").onclick=function(){v("magicworkshopmenu").style.display="none"};v("mgitem").onmousedown=function(f){var b=1;f.button&&(b*=-1);f=Z[Z.actual].max;0>Z.id+b&&(Z.id=f);Z.id=(Z.id+b)%f;"book"==Z.actual&&(Z.amount=a[Z.book.ord[Z.id]].obj.spcost[0]);Z.func()};v("mgaccept").onclick=function(){ea(Oi,[Z.actual,Z.id,parseInt(v("mgamount").innerHTML)],J[0])};var Oi=function(a,b){b=z[b];var f=a[2],c=[f,0,0,0];qb.paypal(c)||(f=~~(250*f),"book"==
a[0]&&(f*=2),b.setupINTV(Pi,[a,b.id],f),b.lcost=c,b.techStart=b.c-r.cycle,Y(b.id)&&(v("magicworkshopmenu").style.display="none"))},Jk={defence:6,mana:0,level:2,health:1,attack:5},Kk={attack:"sword",attackBow:"bow",defence:"shield"},Lk={attack:.5,mana:1,defence:.5,level:.2},Pi=function(f){var b=z[f[1]],d=f[0][0],c=Z[d].ord[f[0][1]];f=f[0][2];b.lcost=void 0;"sword"==d&&(d=Kk[c]);"attackBow"==c&&(c="attack");d=Object.assign({},Mb[d]);if(d.potion)d.d=Jk[c],d[c]=~~(f*Lk[c]);else if(d.book){var e=a[c],
h=e.obj;d.spell=c;d.attack=~~(f/h.spcost[0]);d.name=h.name;d.iconID=e.iconIDbook}else d[c]=~~(.25*f),250<d[c]&&(d[c]=250);M(d);Ac(52,b,!0,d);b.techStart=void 0;Y(b.id)};v("mgamount").onmousedown=function(f){var b=10;"book"==Z.actual&&(b=a[Z.book.ord[Z.id]].obj.spcost[0]);var d=b;f.button&&(b*=-1);nb.shift&&(b*=5);Z.amount+=b;0>=Z.amount&&(Z.amount=d);v("mgamount").innerHTML=Z.amount};Z.func=function(){v("mgitem").style.backgroundPositionY=-48*(Z.id+Z[Z.actual].bak)+"px";v("mgamount").innerHTML=Z.amount};
var bf=[0,0,0,0,0,0,0,0],Sa,Tc,Ga=[document.getElementById("order1"),document.getElementById("order2"),document.getElementById("order3"),document.getElementById("order4"),document.getElementById("order5"),document.getElementById("order6"),document.getElementById("order7"),document.getElementById("order8")],Qi=document.getElementById("bottominfo"),cf=Ga[0],df=Ga[1],ef=Ga[2],ff=Ga[3],gf=Ga[4],hf=Ga[5],jf=Ga[6],kf=Ga[7];cf.addEventListener("mousedown",function(){cf.style.transform="translate(2px,2px)"});
df.addEventListener("mousedown",function(){df.style.transform="translate(2px,2px)"});ef.addEventListener("mousedown",function(){ef.style.transform="translate(2px,2px)"});ff.addEventListener("mousedown",function(){ff.style.transform="translate(2px,2px)"});gf.addEventListener("mousedown",function(){gf.style.transform="translate(2px,2px)"});hf.addEventListener("mousedown",function(){hf.style.transform="translate(2px,2px)"});jf.addEventListener("mousedown",function(){jf.style.transform="translate(2px,2px)"});
kf.addEventListener("mousedown",function(){kf.style.transform="translate(2px,2px)"});cf.addEventListener("mouseup",function(a){Sa=a.button;ob(0)});df.addEventListener("mouseup",function(a){Sa=a.button;ob(1)});ef.addEventListener("mouseup",function(a){Sa=a.button;ob(2)});ff.addEventListener("mouseup",function(a){Sa=a.button;ob(3)});gf.addEventListener("mouseup",function(a){Sa=a.button;ob(4)});hf.addEventListener("mouseup",function(a){Sa=a.button;ob(5)});jf.addEventListener("mouseup",function(a){Sa=
a.button;ob(6)});kf.addEventListener("mouseup",function(a){Sa=a.button;ob(7)});document.getElementById("stock").addEventListener("click",function(a){Ri(z[J[0]])});var Ri=function(a,b){if(0==X.stockActive||b){if(b=a.inventory,b.length){var f=[];f.length=b.length;for(var c=0,e=b.length;c<e;f[c]=z[b[c++]]);ia(f,a,1)}}else ia(a.icons,a)};(function(){for(var a={},b=0,d=Ga.length;b<d;a={l:a.l},b++)a.l=b,Ga[b].addEventListener("mouseenter",function(b){return function(){var a=X.displayed[b.l],c=z[J[0]];if(c&&
c.kingdom)var f=I[c.kingdom];if(a){if(void 0!==a.unit){c=x[a.unit];var d={name:c.name,cost:ai(c.cost,a.hero||a.merc,f.values.fameTech)}}else d=a.obj;X.stockActive&&Fc(X.active[b.l].id,1,1);if(d&&d.name){var g=d.name;c="<span>";c=2==g.length?c+(g[0]+" - "+g[1]):c+g;if(g=d.cost){!d.tech&&f.mod[d.type]&&f.mod[d.type].cost&&(g=f.mod[d.type].cost);c+=" - (";for(f=0;5>f;f++)g[f]&&(c+=g[f]+"<img class='resource' src='"+Mk[f]+"' /> ");c=c.substring(0,c.length-1);c+=")"}c+="</span>";I[z[J[0]].kingdom].technology.disabled[a.id]&&
(c+="<span class='red'>"+A.requires+": "+a.require+"</span>");d.type==Ta&&(c+="<span class='increase'>+"+d.increase+"</span>");(f=lf[z[J[0]].strID])&&f[a.objName]&&(c+="<span class='shotcut'>"+f[a.objName].toLocaleUpperCase()+"</span>");Qi.innerHTML=c}}}}(a)),Ga[b].addEventListener("mouseout",function(){X.stockActive&&Fc(J[0],1,1);Qi.innerHTML=""})})();var Si=function(){history.pushState("",document.title,window.location.pathname)},Kb=function(){r.online=0;location.hash="";v("MatchX").style.display=
"none";document.getElementById("index").style.display="block";document.getElementById("returnmenu").style.display="none";document.getElementById("game").style.display="none";document.getElementById("chat").style.display="none";document.getElementById("gameFinish").style.display="none";setTimeout(Si,200)},ob=function(f){var b=bf[f];ob.lastFunc=b;ob.nu=f;if(X.stockActive){b=z[J[0]];var d=z[b.inventory[f]];d&&(d.potion?nb.control?ea(Kd,b.id,[b.id,d.id]):(U=Kd,U.item=d.id):d.spell?nb.control&&b.mana?
ea(zi,b.id,d.id):(a[d.spell](),U.item=d.id):(ea(Zc,b.id,[d.id]),Y(b.id)))}else b&&b();ob.lastFunc=void 0;ob.nu=void 0;Ga[f].style.transform=""},oh=function(a){var b=[.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.25,.3,1,.3,.27,.3,1,.5,.5,.5,1,.62,.62,.62,1,.74,.74,.74,1,.3+.58,.3+.58,.3+.58,1,.94,.94,.94,1,1,1,1,1,1.06,1.06,1.06,1,.3+.82,.3+.82,.3+.82,1,1.08,1.08,1.08,1,1.04,1.04,1.04,1,1,1,1,1,.95,.95,.95,1,.3+.58,.8,.7,1,.3+.54,.72,.6,1,.7,.62,.5,1,.6,.55,.3+.15,1,.5,.44,.42,1,.4,.37,.35,
1],f=new Date;null!=a&&(f=a);a=f.getMinutes()/60;f=f.getHours();document.getElementById("daynighticon").style.backgroundPosition="0 -"+36*f+"px";var c=[b[4*f],b[4*f+1],b[4*f+2],b[4*f+3]];f=(f+1)%24*4;c[0]+=(-c[0]+b[f])*a;c[1]+=(-c[1]+b[f+1])*a;c[2]+=(-c[2]+b[f+2])*a;c[3]+=(-c[3]+b[f+3])*a;return c},bb=0,cb=0,Gc=0,Hc=0,od=function(a,b){var f=tzar.width,c=tzar.height,e=t.mx/32;a/=32;b/=32;var h=da*f*.03125,l=da*c*.03125,g=.03125*f,k=.03125*c,m=a+.5*(g-h),q=b+.5*(k-l);0>m?a=.5*-(g-h):m+h-e*da>D&&(a=
D-h-.5*(g-h)+e*da);0>q?b=.5*-(k-l):q+l>xa&&(b=xa-l-.5*(k-l));h-t.mx>D&&(da=D/(.03125*f),M(da));l>xa&&(da=xa/(.03125*c),M(da));bb=32*-a;cb=32*-b},oc=document.getElementById("minimap"),mf=function(a){var b=a.pageX-parseInt(oc.style.left);a=a.pageY-parseInt(oc.style.top);var f=tzar.height*Ya/(32*xa);b=~~(.5+(b-tzar.width*Hb/(32*D)*.5)*D/Hb);a=~~(.5+(a-.5*f)*xa/Ya);od(32*b,32*a);0==Tc&&document.removeEventListener("mousemove",mf)};oc.addEventListener("mousedown",function(a){var b=a.pageX-4,f=a.pageY-
31;0==a.button?(document.addEventListener("mouseup",function h(b){document.removeEventListener("mouseup",h);document.removeEventListener("mousemove",mf)}),Tc=!0,mf(a),document.addEventListener("mousemove",mf)):2==a.button&&(b=~~(D*(a.pageX-4)/Hb),f=~~(xa*(a.pageY-31)/Ya),ea(yb,b+f*D,J))});var nb={control:0,shift:0,esc:0},sa=function(f,b){if(f&&1==J.length){if(f=X.active)f=f.menuName;b=Nk[b];if(f=lf[f])f=a[f[b]],-1!==X.active.indexOf(f)&&(b=qb.technology,Sa=0,b.disabled[f.id]||b.hidden[f.id]||f())}},
Fh=function(a,b){var f=document.getElementById("notifybar"),c=document.createElement("div");c.innerHTML=a;b&&(c.style.background=b);f.appendChild(c);setTimeout(Ok,11E3,c)},Ok=function(a){a.parentNode.removeChild(a)},Cb={37:function(a){Gc=a},40:function(a){Hc=-a},39:function(a){Gc=-a},38:function(a){Hc=a},32:function(a){Ki=a?Ck:function(){}},46:function(a){a||ea(Nd,nb.shift,J.slice(0))},16:function(a){nb.shift=a},17:function(a){nb.control=a},27:function(a){nb.esc=a},13:function(a){a&&!r.editor&&("displaynone"==
Gg.className?(Gg.className="displayblock",Hg.focus(),Cb.blocked=13):(Ig(),Gg.className="displaynone",Cb.blocked=null))},19:function(a){a||r.online||$a(1)},48:function(a){a&&nb.control&&(da=1,Df({deltaY:0}))},176:function(a){a&&(r.deltaTime+=3E4)},65:sa,66:sa,67:sa,68:sa,69:sa,70:sa,71:sa,72:sa,73:sa,74:sa,75:sa,76:sa,77:sa,78:sa,79:sa,80:sa,81:sa,82:sa,83:sa,84:sa,85:sa,86:sa,87:sa,88:sa,89:sa,90:sa,219:function(a){a&&Ti(-1)},221:function(a){a&&Ti(1)}},Nk={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",
71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"};Cb.blocked=null;(function(){for(var a=[65,37,40,83,39,68,38,87],b=a.length=0,d=a.length;b<d;b+=2)Cb[a[b]]=Cb[a[b+1]]})();window.addEventListener("beforeunload",function(a){t.admin&&Ui();return null});document.oncontextmenu=function(){return!1};var Pb=document.getElementById("attackmenu"),Ic=document.getElementById("defencemenu"),Jc=document.getElementById("levelmenu"),
ed=document.getElementById("kingdom"),qa=document.getElementById("progressone"),nf=document.getElementById("unitname"),kc=document.getElementById("progressvalue");document.getElementById("selectedobject");var Nd=function(a,b){if(b.length){a=a||r.editor?b.length:1;for(var f=0;f<a;f++)z[b[f]].die()}},Ja=function(f,b){f.sound&&!b&&(b=f.sound,ma(b[~~(b.length*Math.random())]));Jc.style.display="none";Od.style.display="none";ed.style.display="block";qa.style.display="block";manamenu.style.display="none";
manamenu1.style.display="none";progressmana.style.display="none";Ic.style.display="none";nf.innerHTML=f.name;Pd(f);ed.innerHTML=I[f.kingdom].name;f.attack?(Pb.style.display="block",Pb.innerHTML=f.attack):Pb.style.display="none";b=f.health;var d=f.maxHealth;Infinity==b?(qa.value=100,qa.max=100,kc.innerHTML=b):qa.value=b;Infinity==d&&Infinity!=b?(qa.max=100,qa.value=1):Infinity!==d&&(qa.max=d);f.inventory&&f.inventory.length&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",
manamenu1.innerHTML=f.inventory.length);kc.innerHTML=~~b+"/"+d;if(!ac(f,t))return ia([]);f.point&&(b=f.point,Wa.x32=b[0],Wa.y32=b[1],ObjectsetupPosition(Wa,96*(xa-1)),Wa.show=1);if(!1===f.built)ia([a.stopBuilding]),Pd(f);else if(f.techStart)ia([a.stopTech]),Pd(f),manamenu.style.display="block",manamenu.style.backgroundPosition="0px -200px",manamenu.innerHTML=100-~~(100*(f.c-r.cycle)/f.techStart)+"%",Ja.intv&&clearInterval(Ja.intv),Ja.intv=setInterval(function(){J[0]==f.id?manamenu.innerHTML=100-~~(100*
(f.c-r.cycle)/f.techStart)+"%":clearInterval(Ja.intv)},400);else{Lj();if(f.working){d=f.work;var c=X.page*X.length;b=0;for(var e=X.length;b<e;b++){var h=d[b+c];Ga[b].innerHTML=h?h:""}manamenu.style.display="block";manamenu.style.backgroundPosition="0px -200px";var l=1E3*x[f.waitlist[0]].time;b=~~(100*(r.now()-f.timestamp)/l);100<b&&(b=100);manamenu.innerHTML=b+"%";Ja.intv&&clearInterval(Ja.intv);Ja.intv=setInterval(function(){if(J[0]==f.id&&f.working){var b=~~(100*(r.now()-f.timestamp)/l);100<b&&
(b=100);manamenu.innerHTML=b+"%"}else clearInterval(Ja.intv)},400)}else for(b=0,d=X.length;b<d;Ga[b++].innerHTML="");ia(f.icons,f)}};Ja.intv=!1;var Qd=function(){Pb.style.display="none";Ic.style.display="none";Jc.style.display="none";qa.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";nf.innerHTML="";Pb.innerHTML="";Ic.innerHTML="";manamenu.innerHTML="";Jc.innerHTML="";ed.innerHTML="";kc.innerHTML="";qa.value="";kc.maxLength="";Od.style.display=
"none";of();Vi()},U,Va,Qb,Df,bc={},lg=function(a,b,d,c){var f=d||z[J[0]],h=c?I[f.kingdom]:qb;if("peon"==(d?f.clss:Qb))var l=!0;if(r.editor)return[ib,g];var g=a+b*D;if(!c&&U!=ib)return[U,g];a=V[g];b=0;if(!f)return[b,g];if(2<a||(a=Kc[g])&&2<a){var k=z[a];k.invisible||(l&&k.storage&&f.stock?b=wg:l&&void 0!=k.res?b=Fd:l&&k.health<k.maxHealth&&!h.diplomacy[k.kingdom]&&k.build&&!k.dummy||k.dummy&&!k.built?b=$c:h.diplomacy[k.kingdom]||k.dummy&&h.values.experience?b=uc:1===k.invType&&!f.build&&!f.boat&&0<
k.invMax&&ac(f,k)&&(b=Cd))}else a=za[g],2<a&&!f.build&&!f.boat&&(k=z[a],k.item?b=Yc:k.field&&l?b=xe:1===k.invType&&!f.build&&!f.boat&&0<k.invMax&&ac(f,k)&&(b=Cd));0===b&&(f=ub[f.kingdom],f[g]&&l?(a=f[g],b=$c):(k||(a=-g),b=yb,yb.cursor=2));return[b,a]},J=[];J.change=1;var Wi,Fk=document.getElementById("gold"),Gk=document.getElementById("wood"),Hk=document.getElementById("food"),Ik=document.getElementById("stone"),ha,Jg;var Kg=!1;var Nb=function(a,b){var f=da,c=tzar.width,e=tzar.height;a=a*f-bb+.5*
(c-f*c);b=b*f-cb+.5*(e-f*e);return[a,b]},rb=function(a){if(a){var b=a.pageX;a=a.pageY;rb.lastX=b;rb.lastY=a}else b=rb.lastX,a=rb.lastY;b=Nb(b-t.mx,a);a=b[1];b=b[0];0==Kg?(window.removeEventListener("mousemove",rb),Jg=!1):Jg=!0;if(1===ha[2]||rb.forced)a=32*~~(a/32),b=32*~~(b/32);ha[4]=a;ha[6]=b;ha[9]=b;ha[10]=a},Xi=function(a,b){b=z[b];V[a[0]+a[1]*D]==b.id?(b.point=void 0,J[0]==b.id&&(Wa.x32=2*D,ObjectsetupPosition(Wa,128*D),Wa.show=0)):(b.point=a,Wa.x32=a[0],Wa.y32=a[1],J[0]==b.id&&(ObjectsetupPosition(Wa,
96*(xa-1)),Wa.show=1))},Yi=function(a){if(null==Cb.blocked||Cb.blocked==a.keyCode){var b=Cb[a.keyCode];b&&b(1,a.keyCode)}},Zi=function(a){if(null==Cb.blocked||Cb.blocked==a.keyCode){var b=Cb[a.keyCode];b&&b(0,a.keyCode)}},$i=function(a){var b=window.innerWidth,f=window.innerHeight,c=a.pageX,e=a.pageY;if(screen.height-10<=f){if(1.2==Math.abs(Gc)||0==Gc)Gc=1.2*((10>c)-(c>b-10));if(1.2==Math.abs(Hc)||0==Hc)Hc=1.2*((10>e)-(e>f-10))}c=Nb(c-t.mx,e);e=~~(.03125*c[1]);c=~~(.03125*c[0]);a.pageX<t.mx?jc(2):
(a=lg(c,e)[0],0==a||void 0==a.cursor?jc(2):jc(a.cursor))},aj=function(a){if(!nd)if(a.pageX>t.menumx){if(0==a.button){window.addEventListener("mousemove",rb);a=Nb(a.pageX-t.mx,a.pageY);var b=a[1];a=a[0];void 0!=G.wall&&(a=G.wall,b=32*~~(a/D),a=a%D*32,rb.forced=!0,G.wall=void 0);Kg=!0;ha[0]=a;ha[1]=b;ha[9]=ha[0];ha[10]=ha[1];ha[3]=ha[0];ha[7]=ha[1];pf=!1}}else pf=!0},pf=!1,Pk=function(a){if(a.pageX>t.menumx&&a.pageY>t.menumy&&!Tc&&0==pf){Kg=!1;var b=Nb(a.pageX-t.mx,a.pageY),f=~~(b[1]/32);b=~~(b[0]/
32);M(b,f);var c=xa;if(2==a.button&&!r.editor){if(U!=ib){U=ib;return}if(0<J.length)if(c=z[J[0]],1!=c.build||c.arrow){if(0===U){U=ib;return}c=lg(b,f);a=c[1];c=c[0];c==yb&&(b={x32:b,y32:f,d:0,mv:1,img:k.cursor},Ra(b),zb.new(b,Ca(b.img)));ea(c,a,J)}else ea(Xi,[b,f],J[0]);return!1}if(0==a.button){if(U==ib)return ib();a=b+f*c;if(U.spLevel)a=U.spLevel(a);else{var e=0;2<Kc[a]?e=Kc[a]:2<V[a]?e=V[a]:2<za[a]&&(e=za[a]);a=e}if(a)U.allowPos&&z[a].build&&(a=-(b+f*c));else if(U.allowPos||U.noObj)a=-(b+f*c);else return U=
ib;U.noObj&&3<=a&&(a=-(b+f*c));U.item?(ea(U,a,[J[0],U.item]),U.item=void 0):ea(U,a,J);nb.shift||(U=ib)}}pf=!1},bj=function(a){nd||(Pk(a),ha[0]=NaN,ha[1]=NaN,ha[9]=NaN,ha[10]=NaN,ha[3]=NaN,ha[7]=NaN,g.bindBuffer(g.ARRAY_BUFFER,ec),g.bufferSubData(g.ARRAY_BUFFER,0,ha),Tc&&(Tc=!1))},Lg=function(a){a=z[a];a.tempChild.quit(a.selectAnim);wb(a.selectAnim);a.selectAnim=void 0},ib=function(){for(var a=0,b=J.length;a<b;Lg(J[a++]));Md.actived&&(v(Md.actived).style.display="none");Va&&(Lg(Va.id),Va=void 0);J.length=
0;Qb=-1;bc={};Od.style.display="none";cf.innerHTML="";df.innerHTML="";ef.innerHTML="";ff.innerHTML="";gf.innerHTML="";hf.innerHTML="";jf.innerHTML="";kf.innerHTML="";Pb.className="";X.page=0;Wa.show&&(Wa.x32=2*D,ObjectsetupPosition(Wa,128*D),Wa.show=0);var d=D,c=ha[0],e=ha[1];a=ha[9];var h=ha[10];if(0===e-h&&0===c-a){h=~~(c/32);var l=~~(e/32),g=e,k=c,m=0;for(a=0;3>a;a++){b=La[a];var q=h,y=l;c=k;e=g;2<b[q+y*d]?(c=q,e=y,m=z[b[c+e*d]]):(.5<=e/32-y?y++:y--,2<b[q+y*d]?(c=q,e=y,m=z[b[c+e*d]]):(.5<=c/32-
q?q++:q--,2<b[q+y*d]?(c=q,e=y,m=z[b[c+e*d]]):(y=~~(e/32),2<b[q+y*d]&&(c=q,e=y,m=z[b[c+e*d]]))))}m.id||(m=ub[t.kingdom][h+l*d])&&(m=z[m]);if(m&&2<m.id&&(!m.invisible||ac(m,t)))if(bc[m.id]=1,J.length=0,m.setupChild(Bb.select,1,ce),ac(m,t)&&!r.demo){J[0]=m.id;Qb=null!=m.defence?m.clss:-2;if(256>Date.now()-Wi){if(r.editor){Qk(z[J[0]]);return}if(!m.build)for(d=~~(da*tzar.width*.03125),c=~~(da*tzar.height*.03125),h=~~(.03125*-bb+.5*(~~(.03125*tzar.width)-d)),g=~~(.03125*-cb+.5*(~~(.03125*tzar.height)-c)),
c*=d,h+=g*D,a=0;a<c;a++)for(e=h+a%d+~~(a/d)*D,l=0;3>l;l++)g=La[l][e],2<g&&(k=z[g],k.clss!=m.clss||bc[g]||!ac(k,m)||k.item||(k.setupChild(Bb.select,1,ce),bc[g]=1,J.put(g)))}Wi=Date.now();if(m.build)return Ja(m)}else return Va=m,Fc(m.id),!1}else if(!r.demo)for(c=~~(c/32),a=~~(a/32),e=~~(e/32),h=~~(h/32),c>=a&&(m=c,c=a,a=m),e>=h&&(m=e,e=h,h=m),a++,m=[1,1,1],k=a-c,a=0,b=k*(h-e+1);a<b;a++)for(h=a%k+c,g=~~(a/k)+e,l=0;3>l;l++)q=La[l][h+g*d],y=z[q],y.selected=1,m[q]||(m[q]=1,y.build||!ac(y,t)||y.item||(J[J.length]=
q,y.setupChild(Bb.select,1,ce),bc[q]=1));1<J.length?Mg(J):1==J.length?Fc(J[0]):(ia([]),Qd(),Qb=-1,J.length=0)},cj=[manamenu,manamenu1],dj={mana:{background:"0px -120px",progress:progressmana},food:{background:"0px -240px"},milk:{background:"0px -280px"},gold:{background:"0px -260px"},stone:{background:"0px -320px"},wood:{background:"0px -340px"}},Mk=["https://i.imgur.com/toj2Nv3.gif","https://i.imgur.com/TwImKWn.gif","https://i.imgur.com/wFIu276.gif","https://i.imgur.com/kIWwIhG.gif","https://i.imgur.com/JBGA2KM.gif"],
Od=document.getElementById("unitSpeed"),Fc=function(a,b,d){manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";a=z[a];a.sound&&!d&&(d=a.sound,ma(d[~~(d.length*Math.random())]));Qb=a.clss;a.inventory&&a.inventory.length&&ac(a,t)&&(manamenu1.style.display="block",manamenu1.style.backgroundPosition="0px -80px",manamenu1.innerHTML=a.inventory.length);b||(ac(a,t)&&!r.demo?ia(a.icons,a):of());ed.style.display="block";nf.innerHTML=a.name;a.attack&&a.item||void 0!==
a.attack?(Pb.innerHTML=a.attack,Pb.style.display="block"):Pb.style.display="none";a.defence&&a.item||void 0!==a.defence?(Ic.innerHTML=a.defence,Ic.style.display="block"):Ic.style.display="none";a.mana&&!a.manaTarget&&(manamenu.style.display="block",manamenu.innerHTML=a.mana,manamenu.style.backgroundPosition="0px -120px");b=0;var c=a.update;if(c){b=0;for(var f=c.length;b<f;b+=3){var h=c[b],l=dj[h];d=cj[b/3];d.innerHTML=a[h];d.style.display="block";d.style.backgroundPosition=l.background;"mana"==h&&
a.manaTarget&&(d.innerHTML=~~(100*a.mana/a.manaTarget+.5)+"%",d.style.backgroundPosition="0px -200px");l.progress&&(l.progress.style.display="block",l.progress.value=a[h],l.progress.max=a[h+"Max"])}}a.stock&&(c=a.stock,d=cj[b/3],d.style.display="block",d.style.backgroundPosition=dj[c[4].icon].background,d.innerHTML=c[0]);b=a.level?a.level:0;Jc.innerHTML=b;Jc.style.display="block";0===b&&(a.item||a.build)&&(Jc.style.display="none");ed.innerHTML=I[a.kingdom].name;qa.style.display="block";ej(a);Pd(a)},
ej=function(a){var b=a.health;a=a.maxHealth;Infinity==b?(qa.value=100,qa.max=100,kc.innerHTML=b):(qa.value=b,Infinity==a?(qa.max=100,qa.value=1):qa.max=a,kc.innerHTML=~~b+"/"+a)},Mg=function(a,b){for(var f=z[a[0]],c=0,e=0,h=f.clss,l=a.length,g={},k=[],m=0;m<l;m++){f=z[a[m]];c+=f.maxHealth;e+=f.health;Qb=h!=f.clss?-1:!0;for(var q=f.icons,y=q.length,u=0;u<y;u++){var r=q[u].id;void 0===g[r]?g[r]=1:g[r]++;g[r]===l&&k.put(q[u])}}!0===Qb&&(Qb=f.clss);e=Infinity==e?100:~~(e/c*100);kc.innerHTML=e+"/100(%)";
fj();nf.innerHTML="";Pb.style.display="none";Ic.style.display="none";manamenu.style.display="none";manamenu1.style.display="none";progressmana.style.display="none";Jc.style.display="none";ed.innerHTML=l+" "+A.units;qa.style.display="block";qa.value=e;qa.max=100;b||(!0!==Qb?ia(k):ia(f.icons))},nh=function(){};new Float32Array(8);var Xa,Rc,ec,pd,ld,da=1,gj={1:2560,101001:2048,101E3:2048,1001:2048,1E3:2048,100:1536,10010100:1280,10100:1280,1001E4:1280,1E4:1280,10010010:256,10010110:256,10110:256,10111:256,
10010111:256,110:512,111:512,11:512,10:512,111E5:2816,11E5:2816,11E6:2816,1E6:2816,1101E4:768,11110100:768,11010100:768,1111E4:768,1E7:3360,1E5:3072,1101E3:1792,1101001:1792,11101E3:1792,11101001:1792,101111:0,1011:0,1111:0,101011:0},Rk=function(a){wb(a);$b.put(a.bufferID)},zb={table:{},dates:[],new:function(a,b,d){b=Math.floor(b)+r.now();var c=this.table;d||(d=Rk);c[b]||(c[b]=[]);a.animFunc=d;c[b].put(a);this.dates.add(b);this.needOrder=!0}},Ca=function(a){a=ra[a];return 0>a[1]?k.delay[a[0]-a[1]-
1]:a[0]/a[1]*1E3},pb=new Float32Array(12),kg=function(a){var b=a.id+r.arje+a.x32+a.y32;a.rnd=[4294967295+b,4294967295-b,0]},Ng=function(a){a=z[a];a.mlist&&hj(a,!0);a.hlist&&hj(a,!1)},hj=function(a,b){if(b)var f=a.mlist,c=a.mlistID,e=fd.mercenaries;else f=a.hlist,c=a.hlistID,e=fd.heroes;f.unshift(e[ei(a,e.length)]);b?c.unshift(a.mercID++):c.unshift(a.heroID++);8<f.length&&(f.length=8,c.length=8);X.active==f&&ia(f);mb(a,5E4)},Og=function(f){f=z[f];var b=I[f.kingdom],d=16+4*b.crusade.number;b.crusade.number++;
32<d&&(d=32);var c=b.crusade.list;c.length=d;for(var e=0;e<d;e++)(c[e]=Ac(8,f,1)).deleteFromList=c;ma("crusade",f.x32,f.y32);b.technology.disabled[a.createCrusaders.id]=1;Y(f.id)},Dk=function(f){I[f.kingdom].technology.disabled[a.createCrusaders.id]=0},Sc,V=[],za=[],Kc=[],La=[];La.length=3;var of=function(){for(var a=X.displayed.length=0,b=X.length;a<b;a++){var d=Ga[a];d.className="blocked";d.style.backgroundPosition="48px 96px";bf[a]=Pg}X.rightButton.className="blocked";X.leftButton.className="blocked";
X.stock.className="blocked";X.rightBlocked=1};X.leftButton.onclick=function(){X.page&&(X.page--,ia(X.active,0,X.stockActive))};X.rightButton.onclick=function(){X.rightBlocked||(X.page++,ia(X.active,0,X.stockActive))};X.displayed=[];var ia=function(a,b,d){d=!!d;b||(b=NaN);var c=a.olegal||NaN;if(b.working&&!d)var f=1;X.active=a;X.displayed.length=0;var h=qb.technology,l=X.page,g=X.length;of();!1!==d&&b?X.stockActive=b:!1===d&&(X.stockActive=!1);ia.actv={};a.length<=l*g&&a.length&&(X.page--,l--);for(var k=
0,m=0,q;k<g;k++){q=a[k+l*g];if(!q)break;var y=Ga[m];if(!d&&(ia.actv[q.id]=1,h.hidden[q.id]||q.obj.tech&&f)){g++;continue}y.style.backgroundPosition=48*d+"px "+(-d||1)*q.iconID*48+"px";d||!h.disabled[q.id]||c[q.id]?(y.className="",bf[m]=q):y.className="blocked";X.displayed[m]=q;m++}a[k+l*g]&&(X.rightButton.className="",X.rightBlocked=0);0<l&&(X.leftButton.className="");1===J.length&&(b=z[J[0]]);b.inventory&&0<b.inventory.length&&(X.stock.className="")};ia.actv={};var mh,la,ba,Ef;var g=v("tzar").getContext("webgl2",
{antialias:!0,alpha:!1});t.gl=!!g;if(g){var Sk=g.getExtension("WEBGL_lose_context");g.canvas.addEventListener("webglcontextlost",function(a){setTimeout(function(){Sk.restoreContext()},2E3);a.preventDefault()},!1);g.canvas.addEventListener("webglcontextrestored",function(a){M("restored 2")},!1)}var lh,Ff,Gf,qh,$d,Af,zf,Zd,ae,md,kd,Qc,Bf,Cf,db=function(){if(r.canceled)return 0;requestAnimationFrame(db);var a=db.fp1000,b=db.delta,d=db.now,c=db.frameCount;performance.now();var e=d;db.frameCount++;d=r.now();
db.now=d;b=(b+(d-e))/1E3;db.delta=b;if(!(c%8||r.editor)){c=r.now()/1E3;e=~~(c/60)%60;var h=~~(c/3600);c=~~(c%60);v("topinfo").innerHTML=~~(1/b)+"fps "+h+":"+e+":"+c}db.fp1000=a+b;a=zb.table;c=zb.dates;zb.needOrder&&(c.sort(function(a,b){return a-b}),zb.needOrder=0);for(e=0;c[e]<=d+17;e++){h=a[c[e]];for(var l=0,k=h.length;l<k;l++){var n=h[l];n.animFunc(n)}delete a[c[e]];e--;c.shift()}if(0!=Gc||0!=Hc)bb+=Gc*b*640*da,cb+=Hc*b*640*da,od(-bb,-cb),rb();Ki(d);nh();g.uniform1f(lh,d);g.clear(g.COLOR_BUFFER_BIT|
g.DEPTH_BUFFER_BIT);if(a=Ba.length)g.bindFramebuffer(g.FRAMEBUFFER,fb),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,qh),b=Ba,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,g.bufferData(g.ELEMENT_ARRAY_BUFFER,b.typed,g.STATIC_DRAW)),g.enable(g.BLEND),g.blendEquation(g.MAX),g.blendFunc(g.SRC_COLOR,g.SRC_COLOR),g.bindTexture(g.TEXTURE_2D,Ef),g.drawElements(g.TRIANGLES,a,g.UNSIGNED_INT,0),g.bindTexture(g.TEXTURE_2D,Lighttexture),g.disable(g.BLEND),g.bindFramebuffer(g.FRAMEBUFFER,null);ij(Ff);c=window.innerWidth;
e=window.innerHeight;g.viewport(t.marx,e-Ya-t.mary,Hb,Ya);g.uniform2f($d,32*D,32*xa);g.uniform2fv(md,[0,0]);g.uniform1i(ae,1);g.uniform1f(Sc,1);ij(Ff);g.viewport(t.mx,0,c,e);performance.now();g.useProgram(ba);g.bindVertexArray(Bf);g.uniform1f(Af,~~((.01*d+.5)%5));g.drawArrays(g.TRIANGLES,0,6);g.viewport(t.marx,e-Ya-t.mary,Hb,Ya);g.uniform1i(Zd,1);g.uniform2fv(kd,[0,0]);g.uniform1f(Qc,Hb/32/D);g.drawArrays(g.TRIANGLES,0,6);g.uniform1i(Zd,0);g.uniform2f(zf,c,e);g.uniform2fv(kd,[bb,cb]);g.uniform1f(Qc,
1/da);g.viewport(t.mx,0,c,e);g.useProgram(la);g.bindVertexArray(Cf);if(a=ca.length)g.enable(g.BLEND),g.blendEquation(g.FUNC_ADD),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),g.bindBuffer(g.ARRAY_BUFFER,ec),c=tzar.width,e=tzar.height,d=-bb+.5*(c-da*c),b=-cb+.5*(e-da*e),h=da*(c-t.mx),l=da*e,g.bufferSubData(g.ARRAY_BUFFER,0,new Float32Array([d,b,24576,d+h,b,24576,d,b+l,24576,d+h,b+l,24576])),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,Gf),b=ca,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,g.bufferData(g.ELEMENT_ARRAY_BUFFER,
b.typed,g.STATIC_DRAW)),g.viewport(t.marx,e-Ya-t.mary,Hb,Ya),g.drawElements(g.TRIANGLES,12,g.UNSIGNED_INT,0),g.uniform1i(ae,0),g.uniform2f($d,c,e),g.uniform2fv(md,[bb,cb]),g.uniform1f(Sc,1/da),g.viewport(t.mx,0,c,e),g.bindBuffer(g.ARRAY_BUFFER,ec),Jg&&!Qg?g.bufferSubData(g.ARRAY_BUFFER,0,ha):g.bufferSubData(g.ARRAY_BUFFER,0,new Float32Array([NaN,NaN,24576,NaN,4347,24576,5551,NaN,24576,NaN,NaN,24576])),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,Gf),b=ca,b.changed&&(b.typed=new Uint32Array(b),b.changed=!1,
g.bufferData(g.ELEMENT_ARRAY_BUFFER,b.typed,g.STATIC_DRAW)),g.drawElements(g.TRIANGLES,a,g.UNSIGNED_INT,0),g.disable(g.BLEND);G.active&&(d=G.x,b=G.y,a=96*D,G.wh?(c=G.wh[0]-ra[G.img][8],e=G.wh[1]-ra[G.img][9]):e=c=0,Rg(d,b,a,c,e,G.bufferID),G.active=!1)},ij=function(a){var b=aa.length;b&&(g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,a),a=aa,a.changed&&(a.typed=new Uint32Array(a),a.changed=!1,g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.typed,g.STATIC_DRAW)),g.drawElements(g.TRIANGLES,b,g.UNSIGNED_INT,0))},jd=!1,na=
function(a,b){return a<D&&0<=a&&0<=b&&b<xa?!0:!1};Array.prototype.put=function(a){this[this.length]=a};var Pg=function(){},Bb,Rd,Mb,Sg,Lc=function(a,b,d,c){c&&0==Lc.cols[c]&&(Lc.list.push(c,a),Lc.cols[c]=1)};Lc.cols={};Lc.list=[];window.onerror=Lc;var r={},ra=[],Tk=function(a,b,d,c){for(var f=0,h=Object.keys(a),l=0,g=h.length;l<g;l++){var k=h[l],m=a[k];if(Array.isArray(m)){a[k]=f;m.url=f;k=ra[f++]=m;var q=m.deltaY?m.deltaY:0;k.id=c/4;for(var y=6,u=k.length;y<u;y+=6){var r=k[y-2],t=k[y-1],v=k[y+2],
w=k[y+3];b[c++]=k[y]/d;b[c++]=(q+k[y+1])/d;b[c++]=r;b[c++]=t;b[c++]=(k[y]+v)/d;b[c++]=(k[y+1]+q)/d;b[c++]=r+v;b[c++]=t;b[c++]=k[y]/d;b[c++]=(k[y+1]+w+q)/d;b[c++]=r;b[c++]=t+w;b[c++]=(k[y]+v)/d;b[c++]=(k[y+1]+w+q)/d;b[c++]=r+v;b[c++]=t+w}}else for(var z=Object.keys(m),x=0,A=z.length;x<A;x++)for(k=m[z[x]],k.id=c/4,k.url=f,m[z[x]]=f,ra[f++]=k,q=k.deltaY?k.deltaY:0,y=6,u=k.length;y<u;y+=6)r=k[y-2],t=k[y-1],v=k[y+2],w=k[y+3],b[c++]=k[y]/d,b[c++]=(q+k[y+1])/d,b[c++]=r,b[c++]=t,b[c++]=(k[y]+v)/d,b[c++]=
(k[y+1]+q)/d,b[c++]=r+v,b[c++]=t,b[c++]=k[y]/d,b[c++]=(k[y+1]+w+q)/d,b[c++]=r,b[c++]=t+w,b[c++]=(k[y]+v)/d,b[c++]=(k[y+1]+w+q)/d,b[c++]=r+v,b[c++]=t+w}return c},Q=function(a,b,d,c){var f=0,h=d.length-1,l=d[h];c=ub[c];var g=[],k=0,m=!0;na(a,b)&&na(a+l-1,b+h/l-1)||(m=!1);for(var q=D,r=0;r<h;r++){f==l&&(f=0,b++);if(d[r]){var u=a+f+q*b;c[u]&&(m=!1);if(0<V[u]||Ob[u])m=!1;g[k++]=u}f++}return[g,m]};Q.check=function(a,b,d,c,e,h,l){var f=d.length-1;d=d[f];var g=f/d;f=D;l=ub[l];d+=2;--a;--b;g=d*(g+2);for(var k=
0;k<g;k++){var q=a+k%d,r=b+~~(k/d),u=q+r*f;if(0<V[u]||Ob[u]||h&&(q>=e&&q<=e+2||r>=c&&r<=c+2)||!na(q,r)||l[u])return!1}return!0};var jj=function(a,b,d){var c=0,f=d.length-1,h=d[f],l=[],g=[],k=0,m=!0;na(a,b)&&na(a+h-1,b+f/h-1)||(m=!1);for(var q=0,r=0;r<f;r++){c==h&&(c=0,b++);var u=a+c+D*b;d[r]?(2<V[u]&&(m=!1),l[k++]=u):(g[q++]=u,2<V[u]&&(m=!1));c++}return[l,m,g]},kj=function(a,b,d){var c=0,f=d.length-1,h=d[f],l=[],g=0,k=!0;na(a,b)&&na(a+h-1,b+f/h-1)||(k=!1);for(var m=0;m<f;m++){c==h&&(c=0,b++);var q=
a+c+b*D;if(d[m]&&2<V[q]&&1==z[V[q]].build||0<za[q])k=!1;l[g++]=q;c++}return[l,k]},qf=function(a,b,d){var c=!1,f=0,h=[],l=0,g=d.length-1,k=d[g],m=0,q=!0;na(a,b)&&na(a+k-1,b+g/k-1)||(q=!1);for(var r=0;r<g;r++){m==k&&(m=0,b++);if(d[r]){var u=a+m+D*b,t=V[u];2<t&&(q=!1);0<t?f++:c=!0;h[l++]=u}m++}f>.5*(g-1)&&c||(q=!1);return[h,q]},Sd=function(a,b,d){d=!0;na(a,b)||(d=!1);1!==za[a+b*D]&&(d=!1);return[[a+b*D],d]},S=function(a,b,d){d=!0;na(a,b)||(d=!1);0<V[a+b*D]&&(d=!1);return[[a+b*D],d]},rf=function(a,b,
d){d=!0;na(a,b)||(d=!1);0<Kc[a+b*D]&&(d=!1);return[[a+b*D],d]},Db=function(a,b,d){d=!0;na(a,b)||(d=!1);if(0<za[a+b*D]||2==V[a+b*D]||1==V[a+b*D])d=!1;return[[a+b*D],d]},Uk=function(a){for(var b=Object.keys(a),f=W.common.length/1048576,c=0,e=b.length;c<e;c++)a[b[c]].deltaY=512*f},G,B,Na,lb,Pj=function(){G={img:0,x32:-1E3,y32:-1E3,rgb:[0,0,0,.5],d:0,active:!1};var f=8,b=9;if(!jd){Vk();var d=[a.move,a.attack,a.guard,a.patrol,a.pickUp,a.explore,a.stop,a.stand,a.sameSpeed,a.restoreSpeed];Rd={magic_creatures:[58,
40,59,5,78,77,60,130,131,132,89,129]};for(var c=Object.keys(Rd),e=0,h=c.length;e<h;e++){var l=Rd[c[e]],g={};l.obj=g;for(var n=0,m=l.length;n<m;g[l[n++]]=1);}fd.mercenaries=[a.mercArcher,a.mercFootman,a.mercMaceman,a.mercLongbowman,a.mercPikeman,a.mercKnight,a.mercArcherAsian,a.mercSamurai,a.mercHourseSamurai,a.mercRonin,a.mercHorseArcher,a.mercChariot,a.mercFootmanArab,a.mercArcherArab,a.mercMacemanArab,a.mercPikemanArab,a.mercCavalry,a.mercEnichar,a.mercJihad];fd.heroes=[a.mercArcher6,a.mercFootman6,
a.mercMaceman6,a.mercLongbowman6,a.mercPikeman6,a.mercKnight6,a.mercArcherAsian6,a.mercSamurai6,a.mercHourseSamurai6,a.mercRonin6,a.mercHorseArcher6,a.mercChariot6,a.mercFootmanArab6,a.mercArcherArab6,a.mercMacemanArab6,a.mercPikemanArab6,a.mercCavalry6,a.mercEnichar6,a.mercJihad6];c=fd.mercenaries;e=0;for(h=c.length;e<h;c[e++].merc=9);c=fd.heroes;e=0;for(h=c.length;e<h;c[e++].hero=1);m=k;m.build2x2[2]=1;m.build3x3[2]=1;m.build4x4[2]=1;m.build5x5[2]=1;m.build6x6[2]=1;m.items1[2]=1;m.build_harbor[2]=
1;m.bridge_horz_build[2]=1;m.bridge_vert_build[2]=1;m.sexplosion[0]=13;m.sexplosion[1]=25;m.flame_trail[0]=16;m.flame_trail[1]=25;e=0;for(n=m.flame_trail.length;e<n;e+=6)m.flame_trail[4+e]-=32,m.flame_trail[5+e]-=32;e=0;for(n=m.sexplosion.length;e<n;e+=6)m.sexplosion[4+e]-=48,m.sexplosion[5+e]-=48;m.items1[1]=0;m.books[1]=0;m.potions[1]=0;m.troll.attack[1]=14;m.ork.attack[1]=14;m.dwarf.attack[1]=14;m.asian_mage.move[1]=14;m.arab_priest.attack=m.arab_priest.spell;m.asian_mage.spell=m.asian_mage.castspell;
m.asian_mage.attack=m.asian_mage.castspell;m.asian_mage.spell[1]=13;m.arab_horse_archer.move=m.arab_horse.archer;m.arab_jwarrior.attack[1]=14;m.arab_peasant.attack=m.arab_peasant.attack1;m.arab_peasant.tree=m.arab_peasant.wood;m.asian_peasant.attack=m.asian_peasant.attack1;m.asian_peasant.cut=m.asian_peasant.chop;m.asian_peasant.tree=m.asian_peasant.wood;m.asian_peasant.dig[1]=14;m.asian_archer.die[1]=14;m.asian_ronin.attack=m.asian_ronin.attack1;e=0;for(n=m.turn_to_stone.length;e<n;e+=6)m.turn_to_stone[4+
e]-=56,m.turn_to_stone[5+e]-=64;m.arab_tcguild_c[4]=31;m.arab_tcguild_c[5]=85;m.dragon.idle=m.dragon.move;m.asian_samurai.attack=m.asian_samurai.attack1;m.asian_horsamurai.idle=m.asian_horsamurai.idle1;m.asian_horsarcher.idle=m.asian_horsarcher.idle2;m.asian_priest.attack=m.asian_priest.attack1;m.asian_priest.spell=m.asian_priest.pray;m.asian_monk.attack[1]=12;m.euro_mage.attack=m.euro_mage.spell;m.euro_ghost.idle=m.euro_ghost.move;m.euro_priest.attack=m.euro_priest.spell;m.arab_mage.spell=m.arab_mage.attack;
m.cursor[1]=15;m.star[1]=15;m.select[4]+=3;m.select[5]+=3;m.arab_houses_c[f]=96;m.asia_houses_c[f]=96;m.asia_houses_c[4]-=9;m.asia_houses_c[5]-=15;m.wood_build[2]=1;m.res_gold[2]=1;m.res_gold_s[2]=1;m.res_stone[2]=1;m.res_stone_s[2]=1;m.bridge_horz1[4]=-9;m.bridge_horz1[5]=132;m.bridge_horz1[4]=-9;m.bridge_horz1[5]=132;m.euro_stable_c[4]+=18;m.euro_stable_c[5]-=10;m.euro_lumbermill_s[4]-=19;m.euro_lumbermill_s[5]-=17;m.wood_tower_c[4]=0;m.wood_tower_c[5]*=1;m.bat.idle=m.bat.move;e=0;for(n=m.curse.length;e<
n;e+=6)m.curse[5+e]-=48;e=0;for(n=m.impersonate.length;e<n;e+=6)m.impersonate[5+e]-=48;e=0;for(n=m.bless.length;e<n;e+=6)m.bless[5+e]-=48;e=0;for(n=m.euro_barracks_c.length;e<n;e+=6)m.euro_barracks_c[4+e]+=50;e=0;for(n=m.healing.length;e<n;e+=6)m.healing[5+e]-=48;e=0;for(n=m.expl_small_hole.length;e<n;e+=6)m.expl_small_hole[4+e]-=4,m.expl_small_hole[5+e]-=34;Date.now();c=[a.createKnight,a.createHorseArcher1,a.createHorseArcher2,a.createHorseSamurai,a.createChariot,a.createEnichar,a.createCavalry]}if(Jf){Jf=
!1;M("TErrain changed");e=0;for(h=W.xtra.length;e<h;e++){m=W.xtraRes[e].coords;Uk(m);m.terrain_water[f]=512;m.terrain_water[b]=512;m.terrain_water[6]+=32;m.terrain_water[7]+=32;l=0;for(n=m.terrain_tree.length;l<n;l+=6)m.terrain_tree[4+l]-=32,m.terrain_tree[5+l]-=96;l=0;for(n=m.terrain_tree_s.length;l<n;l+=6)m.terrain_tree_s[5+l]-=32;m.terrain_tree[2]=1;Object.assign(k,m)}f=W.size;h=new Float32Array(1048576);m=Tk(k,h,f,0);W.info=h;W.ids=m/16}if(!jd){Mb={sword:{name:"Sword",iconID:16,img:k.items1,d:0,
dMax:7,attack:1,type:52,sword:1},bow:{name:"Bow",iconID:4,img:k.items1,d:15,dMax:4,attack:1,type:52,sword:1},shield:{name:"Shield",iconID:1,img:k.items1,d:8,dMax:6,defence:1,type:52,shield:1},potion:{name:"Potion",iconID:11,img:k.potions,d:0,dMax:7,type:52,potion:1},book:{name:"Book",iconID:9,img:k.books,d:0,dMax:4,type:52,book:1},gold:{name:"Gold",iconID:20,img:k.item_gold,d:0,dMax:0,type:52},stone:{name:"Stone",iconID:22,img:k.item_stone,d:0,dMax:0,type:52},food:{name:"Food",iconID:14,img:k.item_food,
d:0,dMax:0,type:52},wood:{name:"Wood",iconID:15,img:k.item_tree,d:0,dMax:0,type:52},iron:{name:"Iron",iconID:21,img:k.item_iron,d:0,dMax:0,type:52}};Sg=[Mb.sword,Mb.potion,Mb.book,Mb.bow,Mb.shield];h=[a.move,a.attack,a.stop,a.stand,a.pickUp,a.explore,a.healing,a.bless];f=[a.attack,a.guard,a.patrol,a.explore,a.stop,a.stand,a.attackGround,a.steady,a.move];b=[a.buildAcademy,a.buildWorkshop,a.buildWorkshop1,a.buildAcademy1,a.buildWorkshop2,a.buildAcademy2];e=[a.buildMerchands1,a.buildMerchands2,a.buildMerchands];
lb={euro:{},asia:{},arab:{},common:{}};x=[{name:"Footman",attack:6,defence:3,health:65,maxHealth:65,img:k.euro_footman.idle,attackSound:sc,invType:0,invMax:8,validator:S,human:12,iconID:36,time:12,sight:5,url:k.euro_footman,icons:d,cost:[0,0,50,0],attDist:1,spd:50,dieSound:Za,clss:"footman",size:1,standardFunc:L,radix:0,zLevel:1,strID:"e_footman",race:"euro"},{name:"Pikeman",radix:0,attackSound:sc,attack:8,defence:4,health:75,maxHealth:75,img:k.euro_pikeman.idle,invType:0,dieSound:Za,invMax:8,validator:S,
human:1,iconID:39,time:18,sight:5,url:k.euro_pikeman,icons:d,cost:[40,0,60,0],attDist:1,spd:50,standardFunc:L,clss:"e_pikeman",zLevel:1,size:1,strID:"e_pikeman",nu:a.createPikeman,race:"euro"},{name:"Spy",radix:0,attack:20,defence:0,mana:100,manaMax:100,health:50,maxHealth:50,img:k.euro_spy.idle,attackSound:["spy%20kill%201","spy%20kill%202","spy%20kill%203"],invType:0,invMax:8,validator:S,human:1,dieSound:Za,iconID:41,time:30,sight:12,url:k.euro_spy,icons:[a.move,a.attack,a.guard,a.patrol,a.pickUp,
a.explore,a.stop,a.stand,a.impersonate,a.revealSelf],zLevel:1,cost:[120,0,0,0],attDist:1,spd:50,clss:"spy",standardFunc:L,size:1,update:["mana","manaSpeed",1E3],isSpy:1,strID:"spy",nu:a.createSpy,race:"common"},{name:"Maceman",radix:0,attack:8,defence:0,health:120,maxHealth:120,img:k.euro_maceman.idle,attackSound:sc,invType:0,invMax:8,validator:S,human:1,iconID:37,time:14,dieSound:Za,sight:5,zLevel:1,url:k.euro_maceman,icons:d,cost:[0,0,120,0],attDist:1,spd:50,clss:"maceman",standardFunc:L,size:1,
strID:"e_maceman",nu:a.createMaceman,race:"euro"},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:k.euro_archer1.idle,invType:0,invMax:8,validator:S,human:1,sight:10,dieSound:Za,arrow:!0,iconID:38,zLevel:1,time:12,url:k.euro_archer1,icons:d,cost:[0,20,40,0],attDist:7,spd:50,clss:"archer",standardFunc:L,attimg:k.arrow1,attackSound:rd,size:1,strID:"e_archer",nu:a.createArcher,race:"euro"},{radix:0,name:"Wizard",attackSound:gk,dieSound:["mage"],attack:5,defence:0,mana:100,manaMax:100,
health:60,maxHealth:60,img:k.euro_mage.idle,zLevel:1,invType:0,invMax:8,validator:S,human:1,iconID:42,time:30,sight:15,url:k.euro_mage,icons:[a.stop,a.pickUp,a.explore,a.lightning,a.createBat,a.freeze,a.createGolem,a.invisibility,a.stand,a.attack,a.move],cost:[150,0,0,0],attDist:10,attimg:k.flame_bolt,ball:1,spd:50,clss:"mage",standardFunc:L,size:1,update:["mana","manaSpeed",1E3],strID:"e_mage",nu:a.createMage,race:"euro"},{radix:0,name:"Longbowman",attack:6,defence:2,health:50,maxHealth:50,img:k.euro_longbowman.idle,
zLevel:1,invType:0,invMax:8,dieSound:Za,attackSound:rd,arrow:!0,validator:S,race:"euro",human:1,iconID:35,time:18,sight:18,url:k.euro_longbowman,icons:d,cost:[50,0,90,0],attDist:12,spd:50,standardFunc:L,clss:"longbowman",size:1,d2attack:2,strID:"e_longbowman",attimg:k.arrow1,nu:a.createLongbowman},{radix:0,clss:"tree",name:"Tree",health:100,maxHealth:100,img:k.terrain_tree,invType:0,invMax:8,zLevel:1,mMapcolor:[11,131,11],validator:S,child:[{img:k.terrain_tree_s,rgb:[0,0,0,.5],alpha:1,x:0,y:0}],iconID:23,
url:k.terrain_tree,dimgInfinity:k.terrain_tree,dimgRND:3,icons:[],res:1,race:"common",build:!0,size:1,zolotoy:1,strID:"tree"},{radix:0,name:"Crusader",zLevel:1,dieSound:ge,attackSound:ee,attack:14,defence:8,health:180,maxHealth:180,img:k.crus.idle,invType:0,invMax:8,validator:S,human:1,race:"euro",iconID:100,time:19,sight:5,url:k.crus,icons:d,cost:[0,0,0,0],attDist:1,spd:85,standardFunc:L,clss:"crusader",size:1,strID:"crusader"},{radix:0,name:"Priest",attack:20,defence:0,mana:100,manaMax:100,health:60,
maxHealth:60,img:k.euro_priest.idle,invType:0,zLevel:1,invMax:8,validator:S,human:1,iconID:40,time:30,ball:1,sight:21,dieSound:Za,url:k.euro_priest,icons:h,attackOnly:Rd.magic_creatures.obj,cost:[150,0,0,0],attDist:18,race:"euro",spd:50,standardFunc:L,clss:"priest",size:1,update:["mana","manaSpeed",1E3],strID:"e_priest",nu:a.createPriest,attimg:k.flame_bolt},{radix:0,name:"Peasant",attackSound:Nh,attack:5,defence:0,health:50,maxHealth:50,img:k.euro_peasant.idle,invType:0,invMax:8,dieSound:Za,zLevel:1,
validator:S,human:1,race:"euro",iconID:33,time:8,sight:5,url:k.euro_peasant,icons:[a.move,a.menuBuilds,a.repair,a.conquest,a.dcm,a.pickUp,a.explore,a.stop,a.stand,a.attack,a.bribe,a.sameSpeed,a.restoreSpeed],cost:[0,0,50,0],attDist:1,spd:50,clss:"peon",size:1,peon:1,strID:"e_peon",nu:a.createPeon,nocapture:1},{radix:0,clss:"cathedral",name:"Cathedral",dieSound:O,sound:["e_cathedral1","e_cathedral2"],resistance:700,health:5E3,maxHealth:5E3,img:k.euro_cathedral,invType:0,invMax:8,race:"euro",zLevel:1,
validator:Q,bimg:k.build5x5,dimg:k.des_5x5,iconID:60,icons:[a.createCrusaders,a.techFanaticism,a.techEspionage,a.techInquisition,a.techHealing,a.techBless,a.techCrusade,a.techMedicine],time:90,sight:8,child:[{img:k.euro_cathedral_c,x:0,y:0},{img:k.euro_cathedral_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,0,5]),url:k.euro_cathedral,build:!0,cost:[2E3,0,0,2E3],onbuild:[a.buildChurch],size:1,strID:"cathedral"},{radix:0,name:"Castle",clss:"castle",
dieSound:O,sound:["e_castle1"],resistance:700,health:8E3,maxHealth:8E3,img:k.euro_castle,invType:1,invMax:50,race:"euro",zLevel:1,validator:Q,bimg:k.build6x6,dimg:k.des_6x6,iconID:59,time:120,sight:12,child:[{img:k.euro_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:k.euro_castle_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[a.createPeon,a.createSpy,a.emergeAllUnits,a.techFeudalism,a.techArchitecture,a.techLearning],space:new Uint8Array([0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,
1,1,0,0,1,1,0,1,1,7]),menu:Ja,url:k.euro_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1,strID:"e_castle"},{radix:0,name:"Wooden Wall",clss:"wall_wood",resistance:700,health:2E3,maxHealth:2E3,img:k.wood_tower,time:6,sight:1,zLevel:1,dieSound:O,validator:S,bimg:k.wood_build,dimgInfinity:k.wood_debris,iconID:49,icons:[],mx:0,race:"common",my:0,hframe:71,menu:Ja,url:k.wood_tower,wall:1,build:!0,cost:[0,0,20,0],size:1,strID:"woodwall",child:[{img:k.wood_tower_c,x:0,y:0}]},
{radix:0,name:"Barracks",clss:"barracks",strID:"e_barrack",sound:Oh,generator:1,resistance:500,health:1400,maxHealth:1400,img:k.euro_barrack,invType:1,invMax:0,dieSound:O,time:60,sight:6,zLevel:1,race:"euro",validator:Q,bimg:k.build5x5,dimg:k.des_5x5,child:[{img:k.euro_barracks_c,mv:!0},{img:k.euro_barrack_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:57,icons:[a.createFootman,a.createArcher,a.createMaceman,a.createPikeman,a.createLongbowman,a.createKnight],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:k.euro_barrack,build:!0,cost:[0,200,0,200],size:1},{radix:0,strID:"e_lumber",name:"Lumber Mill",sound:["e_lumber1"],clss:"lumber_mill",resistance:500,health:800,maxHealth:800,img:k.euro_lumbermill,invType:1,invMax:0,time:30,race:"euro",sight:4,dieSound:O,zLevel:1,validator:Q,bimg:k.build2x2,dimg:k.des_2x2,iconID:64,child:[{img:k.euro_lumbermill_c,x:0,y:0},{alpha:!0,img:k.euro_lumbermill_s,x:0,y:0,rgb:[0,0,0,.5]}],icons:[a.techLongbow,a.techWoodCutting,a.techCrossbow],
space:new Uint8Array([1,1,1,1,2]),hframe:98,url:k.euro_lumbermill,build:!0,cost:[0,100,0,0],storage:1,size:1},{radix:0,name:"Mage Tower",strID:"e_magetower",sound:["e_magetower1","e_magetower2","e_magetower3"],clss:"magictower",resistance:700,health:5E3,maxHealth:5E3,img:k.euro_magetower,invType:1,invMax:0,time:90,race:"euro",dieSound:O,sight:8,validator:Q,bimg:k.build5x5,dimg:k.des_5x5,zLevel:1,child:[{img:k.euro_magetower_c,x:0,y:0},{img:k.euro_magetower_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:71,
icons:[a.createMage,a.techBat,a.techInvisibility,a.techLightning,a.techFreeze,a.techGolem],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.euro_magetower,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,strID:"e_waracademy",name:"Warriors Guild",sound:["e_waracademy1"],clss:"academy",resistance:700,health:5E3,maxHealth:5E3,img:k.euro_waracademy,invType:1,invMax:0,race:"euro",time:90,sight:8,dieSound:O,zLevel:1,validator:Q,bimg:k.build6x6,dimg:k.des_6x6,iconID:56,child:[{img:k.euro_waracademy_c,
x:0,y:0,mv:!0},{img:k.euro_waracademy_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],icons:[a.techHeroism,a.techWarfare,a.techMercenaries,a.techSiegeTactics,a.techBodyBuilding,a.techLeadership,a.techTactics,a.techHeroes,a.techHonor,a.techFame],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,5]),url:k.euro_waracademy,build:!0,cost:[2E3,0,0,2E3],size:1},{radix:0,name:"Storage",strID:"e_storage",sound:["e_storage1","e_storage2"],clss:"storage",resistance:80,health:800,maxHealth:800,img:k.euro_storage,
invType:1,invMax:0,time:30,dieSound:O,zLevel:1,sight:5,validator:Q,bimg:k.build4x4,dimg:k.des_4x4,iconID:69,race:"euro",icons:[a.techGoldMining,a.techStoneMining],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:k.euro_storage,storage:0,build:!0,cost:[0,200,0,0],size:1,child:[{img:k.euro_storage_c,x:0,y:0},{img:k.euro_storage_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,name:"Knight",strID:"e_knight",dieSound:ge,clss:"knight",attackSound:ee,attack:12,defence:6,health:120,maxHealth:120,
img:k.euro_knight.idle,invType:0,zLevel:1,race:"euro",invMax:8,validator:S,human:1,iconID:43,d2attack:2,time:22,sight:5,url:k.euro_knight,icons:d,cost:[120,0,70,0],attDist:1,spd:85,nu:a.createKnight,standardFunc:L,size:1},{radix:0,name:"Field",clss:"field",strID:"field",instantBuild:1,resistance:80,health:100,maxHealth:100,img:k.fields,invMax:0,validator:kj,zLevel:1,iconID:104,race:"common",icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:k.fields,build:!0,field:1,res:2,cost:[0,200,0,0],rndDirection:9,
time:0,sight:1,z32:.5,size:1},{radix:0,name:"Golden rocks",mMapcolor:[148,148,0],strID:"gold",sound:["mine1"],clss:"golden_rocks",resistance:0,health:6E3,maxHealth:6E3,img:k.res_gold,invMax:0,validator:Q,iconID:20,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.res_gold,build:!0,zLevel:1,race:"common",res:0,cost:[0,0,0,0],time:0,sight:2,dieSound:["destroy%20mine"],size:1,zolotoy:1,child:[{img:k.res_gold_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:k.res_gold},{radix:0,
name:"Rocks",strID:"stone",mMapcolor:[132,132,132],sound:["mine1"],clss:"rocks",dieSound:["destroy%20mine"],resistance:0,health:6E3,maxHealth:6E3,img:k.res_stone,invMax:0,validator:Q,zLevel:1,iconID:22,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.res_stone,build:!0,res:3,cost:[0,0,0,0],race:"common",time:0,sight:2,size:1,zolotoy:1,child:[{img:k.res_stone_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],dimgInfinity:k.res_stone},{radix:0,name:"Farm",strID:"e_farm",sound:["e_farm1","e_farm2"],
clss:"farm",resistance:0,health:800,maxHealth:800,img:k.euro_farm,invType:1,invMax:0,zLevel:1,validator:Q,bimg:k.build4x4,dimg:k.des_4x4,iconID:61,dieSound:O,race:"euro",icons:[a.createCow,a.techCropRotation,a.techDomestication],space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Ja,url:k.euro_farm,build:!0,cost:[0,200,0,0],time:30,sight:5,storage:2,size:1,child:[{img:k.euro_farm_c,x:0,y:0}]},{radix:0,name:"Merchants Guild",strID:"e_merchant",sound:["merchant"],clss:"merchants_guild",resistance:0,
health:5E3,maxHealth:5E3,img:k.euro_tcguild,invType:1,invMax:0,validator:Q,bimg:k.build6x6,zLevel:1,dimg:k.des_6x6,race:"euro",iconID:62,dieSound:O,icons:[a.techMapMaking,a.techTradeRoutes,a.techUsury,a.techSupplyStorage,a.techBribery,a.techTradeTaxes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),menu:Ja,url:k.euro_tcguild,build:!0,time:90,sight:8,cost:[2E3,0,0,2E3],onbuild:[a.buildMarket],size:1,child:[{img:k.euro_tcguild_c,x:0,y:0},{img:k.euro_tcguild_s,x:0,y:0,rgb:[0,
0,0,.5],alpha:!0}]},{radix:0,name:"Church",clss:"church",strID:"e_church",sound:["e_church1"],resistance:0,health:800,maxHealth:800,img:k.euro_church,invType:1,invMax:0,dieSound:O,validator:Q,bimg:k.build3x3,race:"euro",zLevel:1,dimg:k.des_3x3,iconID:139,icons:[a.createPriest],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),menu:Ja,url:k.euro_church,build:!0,cost:[0,0,200,200],time:40,sight:6,size:1,child:[{img:k.euro_church_c,x:0,y:0},{img:k.euro_church_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}]},{radix:0,
name:"Blacksmith",clss:"blacksmith",strID:"e_blacksmith",resistance:0,health:800,maxHealth:800,img:k.euro_blacksmith,invType:1,invMax:0,time:40,zLevel:1,sight:5,dieSound:O,validator:Q,bimg:k.build4x4,race:"euro",dimg:k.des_4x4,child:[{img:k.euro_blacksmith_c,x:0,y:0}],iconID:58,icons:[a.techPlateArmor,a.techTemperIron,a.techScaleArmor,a.techHalberd,a.techChainMail],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),menu:Ja,url:k.euro_blacksmith,build:!0,cost:[0,0,200,200],onbuild:b,size:1},
{radix:0,name:"Cow",clss:"cow",nu:a.createCow,race:"common",strID:"cow",attack:0,defence:3,health:50,maxHealth:50,img:k.cow.idle,invType:0,invMax:8,zLevel:1,validator:S,iconID:99,time:20,dieSound:["cowdie1","cowdie2","cowdie3","cowdie4"],url:k.cow,icons:[a.move,a.stop],sight:3,cost:[0,0,300,0],attDist:0,spd:32,res:2,food:300,milk:50,milkMax:50,foodMax:600,size:1,cow:1,update:["milk","milkSpeed",1E3,"food","cowSpeed",1E3]},{radix:0,name:"Stable",sound:["e_stables1"],clss:"stable",strID:"e_stable",
onlyRequired:1,resistance:0,health:800,maxHealth:800,invType:1,invMax:0,race:"euro",zLevel:1,validator:Q,bimg:k.build4x4,dimg:k.des_4x4,iconID:68,dieSound:O,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,4]),url:k.euro_stables,build:!0,cost:[0,200,0,0],onbuild:c,size:1,time:40,sight:5,img:k.euro_stables,nu:a.createCow,child:[{img:k.euro_stable_c,x:0,y:0}]},{radix:0,name:"Workshop",sound:["e_workshop1"],clss:"workshop",strID:"e_workshop",zLevel:1,resistance:0,health:800,maxHealth:800,img:k.euro_workshop,
invType:1,invMax:0,dieSound:O,validator:Q,bimg:k.build4x4,race:"euro",dimg:k.des_4x4,iconID:75,icons:[a.createCatapult,a.createHeavyCatapult,a.createBallist,a.techEngineering,a.techCannonTower],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,4]),url:k.euro_workshop,build:!0,cost:[0,200,200,0],size:1,time:40,sight:5,child:[{img:k.euro_workshop_c,x:0,y:0}]},{radix:0,name:"Tavern",sound:["e_tavern1"],clss:"tavern",strID:"e_tavern",dieSound:O,resistance:0,health:1E3,maxHealth:1E3,img:k.euro_tavern,
invType:1,invMax:0,validator:Q,race:"euro",bimg:k.build4x4,dimg:k.des_4x4,zLevel:1,iconID:70,icons:[a.createMercenaries,a.createHeroes],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4]),url:k.euro_tavern,build:1,cost:[0,200,200,0],onbuild:e,actvintv:[a.iniMercenaries,a.iniHeroes],size:1,time:40,sight:5,child:[{img:k.euro_tavern_c,x:0,y:0}]},{name:"House",sound:["house1","house2","house3","house4","house5"],clss:"house",strID:"e_house",resistance:0,health:75,maxHealth:75,img:k.euro_houses,
invType:1,invMax:0,validator:Q,bimg:k.build3x3,dimg:k.des_3x3,race:"euro",iconID:73,zLevel:1,dieSound:O,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),url:k.euro_houses,build:!0,cost:[0,75,0,0],population:10,size:1,time:20,sight:4,child:[{img:k.euro_houses_c,x:0,y:0}]},{name:"Watch Tower",attackSound:Vf,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),clss:"watch_tower",strID:"watch_tower",attack:7,health:400,maxHealth:400,img:k.euro_tower_wood_2,state:0,invType:1,race:"common",invMax:0,
zLevel:1,dieSound:O,level:0,validator:Q,child:[{img:k.euro_tower_wood_2_c,x:0,y:0},{alpha:!0,img:k.euro_tower_wood_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attimg:k.arrow1,attDist:8,bimg:k.build2x2,dimg:k.des_2x2,iconID:53,icons:[a.attack,a.stop,a.upgradeGuildTower],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_wood_2,build:!0,cost:[0,300,0,0],size:1,arrow:!0,time:10,sight:15,standardFunc:L},{name:"Market",sound:["e_market1"],clss:"market",strID:"e_market",resistance:0,health:1400,maxHealth:1400,img:k.euro_market,
invType:1,invMax:0,dieSound:O,zLevel:1,validator:Q,bimg:k.build4x4,dimg:k.des_4x4,iconID:65,race:"euro",icons:[a.createCaravan],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,4]),url:k.euro_market,build:!0,cost:[0,200,200,0],size:1,time:60,sight:8,child:[{img:k.euro_market_c,x:0,y:0}]},{name:"Outpost",sound:["e_outpost1"],clss:"outpost",strID:"e_outpost",zLevel:1,resistance:0,health:2E3,maxHealth:2E3,img:k.euro_outpost,invType:1,dieSound:O,invMax:50,validator:Q,race:"euro",bimg:k.build4x4,
dimg:k.des_4x4,iconID:66,icons:[a.emergeAllUnits],space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,4]),url:k.euro_outpost,build:!0,cost:[0,200,0,400],size:1,child:[{img:k.euro_outpost_c,x:0,y:0},{img:k.euro_outpost_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{name:"Bridge",clss:"bridge",strID:"bridge",resistance:0,health:1E4,maxHealth:1E4,img:k.bridge_horz,invMax:0,validator:jj,bimg:k.bridge_horz_build,race:"common",zLevel:1,dieSound:O,child:[{alpha:!0,img:k.bridge_horz_s,x:0,y:0,rgb:[0,
0,0,.5]},{img:k.bridge_horz1,x:0,y:0,z:6}],time:22,sight:1,dimg:k.bridge_horz_demol,iconID:44,icons:[],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,11]),url:k.bridge_horz,build:!0,cost:[0,200,0,400],size:1},{name:"Dummy",clss:"dummy",strID:"dummy",resistance:0,health:5E3,maxHealth:5E3,img:k.dummy1,invMax:0,validator:S,bimg:k.dummy1_b,iconID:165,icons:[],mx:0,zLevel:1,
my:16,hframe:65,race:"common",url:k.dummy1,dimg:k.dummy1_d,build:!0,cost:[0,300,0,0],dummy:!0,child:[{img:k.dummy1_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:10,sight:1},{name:"Catapult",strID:"catapult",dieSound:Xf,clss:"catapult",attackSound:Wf,defence:0,attack:10,health:110,maxHealth:110,img:k.catapult.idle,invMax:0,radix:0,validator:S,iconID:30,time:30,sight:20,race:"common",url:k.catapult,level:0,zLevel:1,icons:f,cost:[0,600,0,0],nofreeze:1,arrow:!1,attDist:17,spd:40,standardFunc:L,size:1,attimg:k.cat_stone,
space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:a.createCatapult},{name:"Ballista",radix:0,strID:"ballista",attackSound:Wf,dieSound:Xf,clss:"ballista",defence:0,attack:60,health:75,maxHealth:75,img:k.ballista.idle,invMax:0,validator:S,iconID:31,time:30,sight:16,nofreeze:1,race:"common",zLevel:1,url:k.ballista,icons:f,cost:[0,800,0,0],attDist:13,spd:40,standardFunc:L,size:1,attimg:k.arrow_ballista1,space:new Uint8Array([1,1,1,1,2]),attackDeg:30,nu:a.createBallist},{name:"Heavy Catapult",strID:"heavy_catapult",
attackSound:Wf,defence:0,attack:25,health:250,maxHealth:250,img:k.h_catapult.idle,invMax:0,radix:0,validator:S,iconID:45,time:60,dieSound:Xf,sight:26,race:"common",url:k.h_catapult,zLevel:1,icons:f,standardFunc:L,cost:[0,1200,0,0],attDist:22,spd:40,nofreeze:1,clss:"heavy_catapult",size:1,attimg:k.cb_metal,space:new Uint8Array([1,1,1,1,2]),attackDeg:60,nu:a.createHeavyCatapult},{radix:0,name:"Ghost",strID:"ghost",defence:0,attack:8,health:60,maxHealth:60,img:k.euro_ghost.idle,invType:0,invMax:8,dieSound:["ghost1",
"ghost2"],validator:S,iconID:178,zLevel:1,race:"common",time:15,attackSound:fk,sight:5,standardFunc:L,url:k.euro_ghost,icons:d,w:1,cost:[40,0,0,0],attDist:1,spd:80,clss:"ghost",size:1,nu:a.createGhost},{name:"Harbor",strID:"e_harbor",resistance:80,health:800,maxHealth:800,img:k.euro_harbor,invType:1,invMax:0,validator:qf,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:k.build_harbor,dimg:k.des_harbor,zLevel:1,race:"euro",dieSound:O,iconID:63,icons:[a.createFishingBoat,a.createXebec,a.createHulk,
a.createGalleon,a.techLandingTactics],clss:"harbor",url:k.euro_harbor,storage:4,build:!0,cost:[0,200,200,0],child:[{img:k.euro_harbor_c,x:0,y:0},{img:k.euro_harbor_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],time:60,sight:8},{radix:0,name:"Messiah",strID:"messiah",attack:50,defence:10,mana:1E3,manaMax:1E3,health:1E3,maxHealth:1E3,img:k.messiah.idle,invType:0,invMax:0,race:"common",validator:S,human:1,iconID:169,zLevel:1,attackSound:["messiah_attack"],dieSound:["messiah"],time:300,sight:26,url:k.messiah,standardFunc:L,
icons:d,cost:[2E3,0,0,0],attDist:10,spd:50,clss:"messiah",size:1,update:["mana","manaSpeed",1E3]},{name:"Magic Gateway",sound:["gateway"],strID:"gateway",magicGateway:1,resistance:0,health:Infinity,maxHealth:Infinity,img:k.teleport,invMax:0,validator:Q,bimg:k.build4x4,zLevel:1,dieSound:O,race:"common",iconID:180,clss:"magic_gateway",icons:[a.createOrk,a.createDwarf,a.createGhost,a.createSkeleton],space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,0,5]),url:k.teleport,build:!0,cost:[0,
0,0,0],size:1,time:10,sight:10,zolotoy:1,child:[{img:k.teleport_c,x:0,y:0},{alpha:!0,img:k.teleport_s,x:0,y:0,rgb:[0,0,0,.5]}],standardFunc:mk},{name:"Guard Tower",strID:"guard_tower",race:"common",clss:"guard_tower",attackSound:Vf,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:12,health:1E3,maxHealth:1E3,img:k.euro_tower_wood,state:0,invType:1,invMax:0,dieSound:O,zLevel:1,validator:Q,child:[{img:k.euro_tower_wood_c,x:0,y:0},{alpha:!0,img:k.euro_tower_wood_s,x:0,y:0,rgb:[0,0,0,.5]}],
attDist:12,bimg:k.build2x2,dimg:k.des_2x2,iconID:52,icons:[a.attack,a.stop,a.upgradeStoneTower,a.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_wood,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:k.arrow1,time:35,sight:16,standardFunc:L},{name:"Sword",attack:0,defence:0,health:25,maxHealth:25,img:k.items1,state:0,invMax:0,validator:Db,iconID:16,url:k.items1,icons:[],cost:[0,0,0,0],size:1,zLevel:0,z32:.5,radix:0,race:"common",item:1},{name:"Bow",attack:0,defence:0,health:25,
maxHealth:25,img:k.items1,state:0,invMax:0,validator:Db,iconID:4,url:k.items1,icons:[],cost:[0,0,0,0],size:1,z32:.5,zLevel:0,radix:0,race:"common",item:1},{name:"Shield",attack:0,defence:0,health:25,maxHealth:25,img:k.items1,state:0,invMax:0,validator:Db,iconID:1,url:k.items1,icons:[],cost:[0,0,0,0],zLevel:0,race:"common",radix:0,size:1,z32:.5,item:1},{name:"Potion",attack:0,defence:0,health:25,maxHealth:25,img:k.potions,state:0,invMax:0,validator:Db,iconID:11,url:k.potions,icons:[],radix:0,race:"common",
zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Book",attack:0,defence:0,health:25,maxHealth:25,img:k.book1,state:0,invMax:0,validator:Db,iconID:9,zLevel:0,race:"common",radix:0,url:k.books,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Gold",health:1,maxHealth:1,img:k.item_gold,invMax:0,validator:Db,iconID:20,radix:0,race:"common",zLevel:0,url:k.item_gold,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Stone",health:1,maxHealth:1,img:k.item_stone,invMax:0,validator:Db,iconID:22,race:"common",
radix:0,url:k.item_stone,zLevel:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Food",health:15,maxHealth:15,img:k.item_food,invMax:0,mMapcolor:[0,255,255],validator:Db,iconID:14,url:k.item_food,radix:0,race:"common",icons:[],zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Wood",health:1,maxHealth:1,img:k.item_wood,invMax:0,validator:Db,iconID:15,url:k.item_wood,icons:[],race:"common",radix:0,zLevel:0,cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Iron",health:1,maxHealth:1,img:k.item_iron,
invMax:0,validator:Db,iconID:21,zLevel:0,race:"common",url:k.item_iron,radix:0,icons:[],cost:[0,0,0,0],size:1,z32:.5,item:1},{name:"Keep Tower",strID:"keep_tower",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:16,health:2E3,maxHealth:2E3,img:k.euro_tower_stone,state:0,invType:1,zLevel:1,attackSound:Vf,invMax:0,dieSound:O,validator:Q,clss:"keep_tower",race:"common",child:[{alpha:!0,img:k.euro_tower_stone_s,x:0,y:0,rgb:[0,0,0,.5]},{img:k.euro_tower_stone_c,x:0,y:0}],attDist:14,bimg:k.build2x2,
dimg:k.des_2x2,standardFunc:L,iconID:54,icons:[a.attack,a.stop,a.upgradeCannonTower],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_stone,build:!0,cost:[0,600,0,0],size:1,arrow:!0,attimg:k.arrow_big1,time:40,sight:18},{name:"Cannon Tower",clss:"tower_stone2",strID:"tower_stone2",attackSound:fe,sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),attack:40,health:2500,maxHealth:2500,img:k.euro_tower_stone_2,state:0,invType:1,invMax:0,dieSound:O,race:"common",validator:Q,zLevel:1,child:[{img:k.euro_tower_stone_2_c,
x:0,y:0},{alpha:!0,img:k.euro_tower_stone_2_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:10,bimg:k.build2x2,dimg:k.des_2x2,iconID:54,icons:[a.attack,a.stop],space:new Uint8Array([1,1,1,1,2]),url:k.euro_tower_stone_2,build:!0,cost:[0,600,0,0],standardFunc:L,size:1,arrow:!1,attimg:k.hot_cannon,time:45,sight:18,attackDeg:30},{name:"Rocket Tower",strID:"tower_rocket",race:"asia",clss:"tower_rocket",sound:"gate1 gate2 gate3 gate4 gate5 gate6".split(" "),zLevel:1,attack:30,health:1400,maxHealth:1400,img:k.rocket_tower,
state:0,invType:1,invMax:0,dieSound:O,validator:Q,child:[{img:k.rocket_tower_c},{alpha:!0,img:k.rocket_tower_s,x:0,y:0,rgb:[0,0,0,.5]}],attDist:20,bimg:k.build2x2,dimg:k.des_2x2,iconID:186,icons:[],space:new Uint8Array([1,1,1,1,2]),url:k.rocket_tower,build:!0,cost:[0,600,0,0],standardFunc:L,size:1,arrow:!0,attimg:k.arrow_big1,time:60,sight:26},{radix:0,name:"Ork",race:"common",strID:"ork",dieSound:["orc%20die%201","orc%20die%202"],attackSound:ek,attack:18,defence:2,health:75,maxHealth:75,img:k.ork.idle,
invType:0,invMax:8,validator:S,zLevel:1,iconID:143,time:12,sight:5,url:k.ork,standardFunc:L,icons:d,cost:[60,0,0,0],attDist:1,spd:50,clss:"ork",size:1,nu:a.createOrk},{radix:0,name:"Dwarf",race:"common",attack:7,defence:7,health:120,maxHealth:120,img:k.dwarf.idle,invType:0,strID:"dwarf",invMax:8,zLevel:1,dieSound:Za,validator:S,iconID:185,time:12,sight:3,url:k.dwarf,standardFunc:L,icons:d,cost:[80,0,0,0],attDist:1,spd:50,clss:"dwarf",size:1,nu:a.createDwarf},{radix:0,name:"Skeleton",strID:"skeleton",
race:"common",dieSound:["skeleton%20die%201","skeleton%20die%202","skeleton%20die%203","skeleton%20die%204"],attack:4,defence:0,health:40,maxHealth:40,img:k.skeleton.idle,invType:0,zLevel:1,attackSound:sc,invMax:8,nofreeze:1,validator:S,iconID:167,time:12,sight:3,url:k.skeleton,standardFunc:L,icons:d,cost:[0,0,30,0],attDist:1,spd:50,clss:"skeleton",size:1,nu:a.createSkeleton},{radix:0,name:"Caravan",race:"euro",strID:"e_caravan",attack:0,defence:0,health:350,maxHealth:350,img:k.caravan.idle,invType:1,
invMax:8,validator:S,iconID:34,zLevel:1,time:50,sight:7,url:k.caravan,icons:[a.move,a.trade,a.explore,a.stop,a.stand,a.unload],cost:[0,200,400,0],attDist:1,spd:75,clss:"caravan",size:1,nu:a.createCaravan},{name:"Castle",health:8E3,maxHealth:8E3,img:k.asia_castle,invType:1,strID:"a_castle",zLevel:1,race:"asia",invMax:50,validator:Q,bimg:k.build6x6,dimg:k.des_6x6,iconID:164,time:120,sight:12,dieSound:O,clss:"castle",child:[{img:k.asia_castle_c,x:0,y:0,mv:!0},{alpha:!0,img:k.asia_castle_s,x:0,y:0,rgb:[0,
0,0,.5]}],icons:[a.createPeon1,a.createNinja,a.emergeAllUnits,a.techFeudalism,a.techArchitecture,a.techLearning,a.techBuddhism,a.techGreatWall],space:new Uint8Array([0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,0,0,8]),menu:Ja,url:k.asia_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{name:"Castle",dieSound:O,clss:"castle",strID:"r_castle",race:"arab",health:8E3,maxHealth:8E3,img:k.arab_castle,
invType:1,invMax:50,validator:Q,bimg:k.build6x6,dimg:k.des_6x6,zLevel:1,iconID:97,time:120,sight:12,child:[{img:k.arab_castle_c}],icons:[a.createPeon2,a.createSpy,a.emergeAllUnits,a.techFeudalism,a.techArchitecture,a.techLearning,a.techSlavery],space:new Uint8Array([0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,,8]),menu:Ja,url:k.arab_castle,build:!0,cost:[0,1500,0,1500],storage:-1,castle:!0,population:20,size:1},{radix:0,
name:"Peasant",attack:5,defence:0,health:50,maxHealth:50,img:k.asian_peasant.idle,invType:0,invMax:8,attackSound:Nh,race:"asia",validator:S,human:1,strID:"a_peon",iconID:132,dieSound:Za,zLevel:1,time:8,peon:1,sight:5,url:k.asian_peasant,icons:[a.move,a.menuBuilds1,a.repair,a.conquest,a.dcm,a.pickUp,a.explore,a.stop,a.stand,a.attack,a.sameSpeed,a.restoreSpeed],cost:[0,0,40,0],attDist:1,spd:50,clss:"peon",nocapture:1,size:1},{radix:0,name:"Ninja",race:"asia",attack:12,defence:5,mana:100,manaMax:100,
health:90,maxHealth:90,img:k.asian_ninja.idle,invType:0,invMax:8,attackSound:sc,validator:S,human:1,iconID:133,strID:"ninja",dieSound:Za,zLevel:1,time:20,standardFunc:L,sight:10,url:k.asian_ninja,icons:[a.guard,a.patrol,a.pickUp,a.explore,a.stop,a.stand,a.invisibility,a.murder,a.move,a.attack,a.sameSpeed,a.restoreSpeed],cost:[120,0,0,0],attDist:1,spd:85,clss:"ninja",size:1,update:["mana","manaSpeed",1E3]},{radix:0,name:"Ronin",attack:7,defence:0,health:45,maxHealth:45,img:k.asian_ronin.idle,invType:0,
invMax:8,race:"asia",validator:S,human:1,standardFunc:L,iconID:141,strID:"ronin",dieSound:Za,zLevel:1,time:8,sight:5,url:k.asian_ronin,icons:d,cost:[0,0,40,0],attDist:1,spd:50,attackSound:sc,clss:"a_footman",size:1},{radix:0,name:"Archer",attack:5,defence:0,health:50,maxHealth:50,img:k.asian_archer.idle,invType:0,invMax:8,race:"asia",validator:S,human:1,strID:"a_archer",dieSound:Za,zLevel:1,attimg:k.arrow1,iconID:136,arrow:1,attackSound:rd,time:12,sight:10,url:k.asian_archer,icons:d,cost:[0,20,40,
0],standardFunc:L,spd:50,clss:"archer",size:1,attDist:6},{radix:0,name:"Samurai",attack:10,defence:4,health:90,maxHealth:90,img:k.asian_samurai.idle,invType:0,race:"asia",strID:"samurai",invMax:8,attackSound:sc,validator:S,human:1,iconID:142,time:20,standardFunc:L,zLevel:1,dieSound:Za,sight:6,url:k.asian_samurai,icons:d,cost:[50,0,150,0],attDist:1,spd:50,clss:"a_maceman",size:1},{radix:0,name:"Horse Archer",attack:7,defence:0,health:75,maxHealth:75,img:k.asian_horsarcher.idle,invType:0,race:"asia",
invMax:8,validator:S,human:1,attackSound:rd,iconID:183,strID:"a_horse_archer",dieSound:ge,time:20,standardFunc:L,sight:12,url:k.asian_horsarcher,zLevel:1,icons:d,arrow:1,attimg:k.arrow1,cost:[40,0,120,0],spd:85,clss:"horse_archer",size:1,attDist:7},{radix:0,name:"Horse Samurai",attack:14,defence:4,health:160,maxHealth:160,img:k.asian_horsamurai.idle,invType:0,invMax:8,validator:S,human:1,iconID:135,race:"asia",standardFunc:L,attackSound:ee,time:22,zLevel:1,strID:"horse_samurai",dieSound:ge,sight:5,
url:k.asian_horsamurai,icons:d,cost:[75,0,120,0],attDist:1,spd:85,clss:"horse_samurai",size:1},{name:"Barracks",resistance:500,health:1400,maxHealth:1400,img:k.asia_barracks,invType:1,sound:Oh,invMax:0,time:60,dieSound:O,radix:0,sight:6,race:"asia",strID:"a_barrack",validator:Q,zLevel:1,bimg:k.build5x5,dimg:k.des_5x5,child:[{img:k.asia_barracks_c,x:0,y:0,mv:!0},{img:k.asia_barracks_s,x:0,y:0,rgb:[0,0,0,.5],alpha:!0}],iconID:146,icons:[a.createRonin,a.createArcher1,a.createSamurai,a.createHorseArcher1,
a.createHorseSamurai,a.createChariot],space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),url:k.asia_barracks,build:!0,cost:[0,200,0,200],size:1,clss:"barracks"},{name:"Chariot",attack:4,defence:3,health:180,maxHealth:180,img:k.asian_charriot.idle,invType:0,radix:0,race:"asia",invMax:8,strID:"chariot",dieSound:["c%20die%201","c%20die%202","c%20die%203","c%20die%204","c%20die%205"],attackSound:ee,validator:S,human:1,zLevel:1,iconID:175,standardFunc:L,time:8,sight:5,url:k.asian_charriot,
icons:d,cost:[0,200,150,0],attDist:1,spd:85,clss:"chariot",size:1},{radix:1,name:"Galleon",attackSound:fe,attack:35,attDist:12,race:"common",defence:0,health:1200,maxHealth:1200,strID:"galleon",nu:a.createGalleon,img:k.galleon.idle,invType:1,invMax:24,dieSound:["ship%20sink"],zLevel:0,validator:Sd,iconID:32,time:50,boat:!0,attimg:k.cb_metal,attackDeg:20,sight:16,url:k.galleon,icons:[a.move,a.explore,a.unload,a.attack,a.attackGround,a.stop,a.stand,a.stop,a.stand,a.attack,a.steady,a.upgradeShip],cost:[0,
1200,800,0],spd:50,nofreeze:1,clss:"galleon",standardFunc:L,size:1,peon:1},{radix:1,name:"Fishing Boat",attackSound:fe,attack:1,attDist:8,race:"common",defence:0,health:50,boat:!0,nu:a.createFishingBoat,maxHealth:50,img:k.boat.idle,invType:1,invMax:0,strID:"fishing_boat",dieSound:["ship%20sink"],zLevel:0,validator:Sd,iconID:184,nofreeze:1,time:50,sight:16,url:k.boat,icons:[a.move,a.explore,a.stop,a.stand,a.fishing],cost:[0,200,100,0],spd:65,clss:"fishing_boat",size:1},{radix:1,name:"Hulk",attackSound:fe,
attack:18,attDist:10,race:"common",defence:0,health:700,maxHealth:700,strID:"hulk",img:k.hulk.idle,invType:1,boat:!0,nu:a.createHulk,attackDeg:20,invMax:16,dieSound:["ship%20sink"],zLevel:0,validator:Sd,iconID:128,time:30,sight:14,attimg:k.cb_metal,url:k.hulk,icons:[a.move,a.explore,a.unload,a.attack,a.attackGround,a.stop,a.stand,a.stop,a.stand,a.attack,a.steady,a.upgradeShip],cost:[0,500,300,0],spd:65,nofreeze:1,clss:"hulk",standardFunc:L,size:1},{radix:1,name:"Pinque",attackSound:rd,attack:10,race:"common",
attDist:8,defence:0,health:300,boat:!0,maxHealth:300,img:k.xebec.idle,attimg:k.arrow1,arrow:!0,strID:"pinque",invType:1,invMax:8,dieSound:["ship%20sink"],zLevel:0,validator:Sd,iconID:129,time:20,nofreeze:1,sight:12,url:k.xebec,icons:[a.move,a.explore,a.unload,a.attack,a.attackGround,a.stop,a.stand,a.stop,a.stand,a.attack,a.steady,a.upgradeShip],cost:[0,300,200,0],spd:80,clss:"xebec",size:1,standardFunc:L,nu:a.createXebec},{radix:0,name:"Stone Golem",strID:"troll",defence:3,attack:25,health:400,maxHealth:400,
img:k.troll.idle,invType:0,invMax:0,dieSound:["golem"],validator:S,iconID:144,race:"common",zLevel:1,nofreeze:1,attackSound:["golem1","golem2"],sight:10,standardFunc:L,url:k.troll,icons:d,w:1,cost:[120,0,0,0,600],attDist:1,spd:56,clss:"troll",size:1},{radix:0,name:"Bat",strID:"bat",defence:0,attack:3,health:20,maxHealth:20,img:k.bat.move,invType:0,invMax:0,race:"common",bat:1,dieSound:["bat%20die"],validator:rf,iconID:105,zLevel:2,attackSound:["bat%20attack"],sight:10,standardFunc:L,url:k.bat,icons:d,
w:1,cost:[0,0,0,0,25],attDist:1,spd:128,clss:"bat",size:1,z32:1.5},{race:"arab",invType:0,invMax:8,iconID:138,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_peasant,img:k.arab_peasant.idle,spd:50,validator:S,human:1,icons:[a.move,a.menuBuilds2,a.repair,a.conquest,a.dcm,a.pickUp,a.explore,a.stop,a.stand,a.attack,a.convertJihad,a.bribe,a.sameSpeed,a.restoreSpeed],name:"Peasant",clss:"peon",cost:[0,0,50,0],attDist:1,time:8,nocapture:1,peon:1,sight:5,health:50,attack:5,defence:0},{race:"arab",
invType:0,invMax:8,iconID:172,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_footman,img:k.arab_footman.idle,standardFunc:L,spd:50,validator:S,human:1,attDist:1,icons:d,name:"Footman",clss:"footman",cost:[0,0,50,0],time:12,sight:5,health:50,attack:6,defence:1},{race:"arab",invType:0,invMax:8,iconID:170,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_archer,img:k.arab_archer.idle,spd:50,validator:S,standardFunc:L,human:1,attimg:k.arrow1,arrow:1,icons:d,name:"Archer",clss:"archer",
cost:[0,20,40,0],time:12,sight:10,attDist:6,health:50,attack:5,defence:0},{race:"arab",invType:0,invMax:8,iconID:173,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_spearman,img:k.arab_spearman.idle,spd:50,validator:S,standardFunc:L,human:1,icons:d,name:"Spearman",clss:"pikeman",attDist:1,cost:[40,0,60,0],time:14,sight:5,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:174,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,standardFunc:L,url:k.arab_satrap,img:k.arab_satrap.idle,
spd:50,validator:S,human:1,icons:d,name:"Satrap",attDist:1,clss:"maceman",cost:[0,0,120,0],time:14,sight:5,health:120,attack:8,defence:0},{race:"arab",invType:0,invMax:8,iconID:171,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_cavalry,standardFunc:L,img:k.arab_cavalry.idle,spd:85,validator:S,human:1,attDist:1,icons:d,name:"Cavalry",clss:"heavy_cavalry",cost:[60,0,100,0],time:14,sight:5,health:90,attack:10,defence:4},{race:"arab",invType:0,invMax:8,iconID:168,zLevel:1,dieSound:[],attackSound:[],
size:1,radix:0,url:k.arab_horse_archer,img:k.arab_horse_archer.idle,spd:85,validator:S,human:1,standardFunc:L,icons:d,name:"Horse Archer",clss:"horse_archer",cost:[50,0,100,0],time:14,attimg:k.arrow1,arrow:1,sight:12,attDist:7,health:75,attack:6,defence:2},{race:"arab",invType:0,invMax:8,iconID:179,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_jwarrior,img:k.arab_jwarrior.idle,spd:50,validator:S,human:1,standardFunc:L,icons:d,name:"Jihad warrior",attDist:1,clss:"jihad_warrior",cost:[0,
0,100,0],time:8,sight:5,health:75,attack:10,defence:2},{race:"arab",invType:0,invMax:8,iconID:176,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_priest,img:k.arab_priest.idle,standardFunc:L,spd:50,mana:100,validator:S,human:1,icons:h,name:"Priest",clss:"priest",cost:[150,0,0,0],time:30,sight:21,attDist:18,health:60,attack:20,update:["mana","manaSpeed",1E3],manaMax:100,defence:0,attimg:k.flame_bolt,ball:1,attackOnly:Rd.magic_creatures.obj},{race:"arab",invType:0,invMax:0,iconID:105,
zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:0,img:0,testing:1,illegal:1,spd:50,validator:S,human:1,icons:[],name:"Spy",clss:"spy",cost:150,time:30,sight:12,health:50,attack:20,defence:0},{race:"arab",invType:0,invMax:8,iconID:188,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,attimg:k.flame_bolt,url:k.arab_mage,img:k.arab_mage.idle,spd:50,validator:S,human:1,icons:[a.stop,a.pickUp,a.explore,a.createCarpet,a.createJinn,a.fireRain,a.magicVision,a.raiseDead,a.attack,a.stand,a.move],standardFunc:L,
name:"Mage",clss:"mage",ball:1,mana:100,manaMax:100,update:["mana","manaSpeed",1E3],cost:[150,0,0,0],time:30,sight:15,attDist:10,health:60,attack:8,defence:0},{race:"arab",invType:1,invMax:8,iconID:126,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_caravan,img:k.arab_caravan.idle,spd:75,validator:S,human:1,icons:[],name:"Caravan",clss:"trader",cost:[0,0,500,0],time:30,sight:5,health:150},{race:"arab",invType:0,invMax:8,iconID:177,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.arab_enichar,
img:k.arab_enichar.idle,spd:85,validator:S,human:1,standardFunc:L,icons:d,name:"Enichar",attDist:1,clss:"enichar",cost:[80,0,120,0],time:25,sight:5,health:130,attack:18,defence:4},{race:"arab",invType:1,invMax:0,iconID:82,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,population:10,url:k.arab_houses,validator:Q,build:1,icons:[],child:[{img:k.arab_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],time:20,sight:4,resistance:50,health:500},{race:"arab",
invType:1,invMax:0,iconID:85,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_lumbermill,validator:Q,build:1,icons:[a.techWoodCutting,a.techCrossbow],child:[{img:k.arab_lumbermill_c}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],storage:1,time:30,sight:4,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:96,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,
radix:0,url:k.arab_storage,validator:Q,build:1,storage:0,icons:[a.techGoldMining,a.techStoneMining],child:[{img:k.arab_storage_c},{alpha:!0,img:k.arab_storage_s,rgb:[0,0,0,.5]}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:80,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_farm,validator:Q,build:1,icons:[a.createCow,a.techCropRotation,a.techDomestication,
a.techCowPoaching,a.ridingHorses,a.techHorseManShip],child:[{img:k.arab_farm_c}],name:"Farm",storage:2,clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:81,zLevel:1,dieSound:O,validator:qf,space:new Uint8Array([1,1,0,0,1,1,1,1,1,1,1,1,4]),bimg:k.build_harbor,dimg:k.des_harbor,radix:0,url:k.arab_harbour,build:1,icons:[a.createFishingBoat,a.createXebec,a.createHulk,a.techLandingTactics],child:[{img:k.arab_harbour_c},{alpha:!0,img:k.arab_harbour_s,
rgb:[0,0,0,.5]}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:79,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_blacksmith,validator:Q,build:1,icons:[a.techTemperIron,a.techScaleArmor,a.techScimitar,a.techChainMail,a.techHalberd],child:[{img:k.arab_blacksmith_c},{alpha:!0,img:k.arab_blacksmith_s,rgb:[0,0,0,.5]}],name:"Blacksmith",clss:"blacksmith",
cost:[0,150,150,0],onbuild:b,time:40,sight:5,resistance:80,health:800},{race:"arab",invType:1,invMax:0,iconID:95,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_workshop,validator:Q,build:1,icons:[a.createCatapult,a.createBallist,a.techEngineering,a.techCannonTower],child:[{img:k.arab_workshop_c},{alpha:!0,img:k.arab_workshop_s,rgb:[0,0,0,.5]}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,
health:800},{race:"arab",invType:1,invMax:0,iconID:140,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_church,validator:Q,build:1,icons:[a.createPriest2],child:[{img:k.arab_church_c},{alpha:!0,img:k.arab_church_s,rgb:[0,0,0,.5]}],name:"Church",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"arab",invType:1,invMax:0,iconID:92,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_tavern,validator:Q,build:1,icons:[a.createMercenaries,a.createHeroes],child:[{img:k.arab_tavern_c}],name:"Tavern",clss:"tavern",cost:[0,200,200,0],onbuild:e,actvintv:[a.iniMercenaries,a.iniHeroes],time:40,sight:5,resistance:150,health:1E3},{race:"arab",invType:1,invMax:0,iconID:87,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_market,validator:Q,build:1,icons:[a.createCaravan2],
child:[{img:k.arab_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"arab",invType:1,invMax:0,iconID:98,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_barracks,validator:Q,build:1,icons:[a.createFootman2,a.createArcher2,a.createSatrap,a.createPikeman2,a.createHorseArcher2,a.createCavalry,a.createEnichar,a.createJihad],child:[{img:k.arab_barracks_c},
{alpha:!0,img:k.arab_barracks_s,rgb:[0,0,0,.5]}],name:"Barracks",clss:"barrack",cost:[0,0,200,200],time:60,sight:6,resistance:500,health:1400},{race:"arab",invType:1,invMax:0,iconID:91,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_stables,validator:Q,build:1,icons:[],child:[{img:k.arab_stables_c}],name:"Stable",clss:"stable",cost:[0,200,200,0],time:40,onbuild:c,sight:5,resistance:80,health:800},{race:"arab",invType:1,
invMax:50,iconID:89,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_outpost,validator:Q,build:1,icons:[a.emergeAllUnits],child:[{img:k.arab_outpost_c,mv:1},{alpha:!0,img:k.arab_outpost_s,rgb:[0,0,0,.5]}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"arab",invType:1,invMax:0,iconID:105,zLevel:1,dieSound:O,space:23213123,bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:0,img:0,
validator:Q,build:1,icons:[],child:[{img:3213123}],name:"NULL",testing:1,clss:"castle",cost:[0,1500,0,1500],time:120,sight:12,resistance:1E3,health:8E3},{race:"arab",invType:1,invMax:0,iconID:88,zLevel:1,dieSound:O,space:new Uint8Array([0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,6]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_mosque,validator:Q,build:1,icons:[a.techFanaticism,a.techEspionage,a.techHealing,a.techBless,a.techJihad],child:[{img:k.arab_mosque_c},{alpha:!0,
img:k.arab_mosque_s,rgb:[0,0,0,.5]}],name:"Mosque",onbuild:[a.buildChurch2],clss:"mosque",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:86,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.arab_magetower,validator:Q,build:1,icons:[a.createMage2,a.techCarpet,a.techMagicWorkshop,a.techFireRain,a.techMagicVision,a.techNecromancy,a.techJinn],child:[{img:k.arab_magetower_c},{alpha:!0,
img:k.arab_magetower_s,rgb:[0,0,0,.5]}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:93,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_tc_guild,validator:Q,build:1,icons:[a.techUsury,a.techTradeRoutes,a.techSupplyStorage,a.techBribery,a.techOreFloatation],child:[{img:k.arab_tcguild_c},{alpha:!0,img:k.arab_tc_guild_s,
rgb:[0,0,0,.5]}],name:"Merchants Guild",clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[a.buildMarket2],sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:94,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.arab_waracademy,validator:Q,build:1,icons:[a.techHeroism,a.techWarfare,a.techMercenaries,a.techRiddingHorses,a.techBodyBuilding,a.techLeadership,a.techHeroes,a.techJanissary,a.techHonor,
a.techFame],child:[{img:k.arab_waracademy_c},{alpha:!0,img:k.arab_waracademy_s,rgb:[0,0,0,.5]}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"arab",invType:1,invMax:0,iconID:158,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.arab_magicworkshop,validator:Q,build:1,icons:[a.createObjects],child:[{img:k.arab_magicworkshop_c},{alpha:!0,img:k.arab_magicworkshop_s,rgb:[0,0,0,.5]}],name:"Magic Workshop",
disallowPoint:!0,clss:"magicworkshop",cost:[0,0,0,300],time:20,sight:5,resistance:200,health:1200},{race:"asia",invType:1,invMax:0,iconID:161,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,0,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.asia_houses,validator:Q,build:1,icons:[],child:[{img:k.asia_houses_c}],name:"House",clss:"house",cost:[0,75,0,0],population:10,time:20,sight:4,resistance:50,health:500},{race:"asia",invType:1,invMax:0,iconID:149,zLevel:1,dieSound:O,space:new Uint8Array([0,
1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,storage:1,url:k.asia_lumbermill,validator:Q,build:1,icons:[a.techWoodCutting,a.techCrossbow],child:[{img:k.asia_lumbermill_c},{img:k.asia_lumbermill_s,rgb:[0,0,0,.5],alpha:!0}],name:"Lumber Mill",clss:"lumber",cost:[0,100,0,0],time:30,sight:4,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:154,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_storage,
storage:0,validator:Q,build:1,icons:[a.techGoldMining,a.techStoneMining],child:[{img:k.asia_storage_s,rgb:[0,0,0,.5],alpha:!0},{img:k.asia_storage_c}],name:"Storage",clss:"storage",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:147,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,storage:2,url:k.asia_farm,validator:Q,build:1,icons:[a.techCropRotation,a.ridingHorses,a.irrigation],
child:[{img:k.asia_farm_c}],name:"Farm",clss:"farm",cost:[0,200,0,0],time:30,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:148,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,1,1,1,1,1,1,3]),validator:qf,bimg:k.build_harbor,dimg:k.des_harbor,radix:0,url:k.asia_harbor,build:1,icons:[a.createFishingBoat,a.createXebec,a.createHulk,a.techLandingTactics],child:[{img:k.asia_harbor_c},{img:k.asia_harbor_s,rgb:[0,0,0,.5],alpha:!0}],name:"Harbor",clss:"harbor",cost:[0,200,200,0],
time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:145,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_blacksmith,validator:Q,build:1,icons:[a.techTemperIron,a.techScaleArmor,a.techArmoredChariot,a.techChainMail],child:[{img:k.asia_blacksmith_c},{img:k.asia_blacksmith_s,rgb:[0,0,0,.5],alpha:!0}],name:"Blacksmith",clss:"blacksmith",cost:[0,150,150,0],time:40,sight:5,onbuild:b,
resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:157,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_workshop,validator:Q,build:1,icons:[a.createCatapult,a.createBallist,a.techEngineering,a.techCannonTower],child:[{img:k.asia_workshop_c,x:0,y:0},{img:k.asia_workshop_s,rgb:[0,0,0,.5],alpha:!0}],name:"Workshop",clss:"workshop",cost:[0,150,150,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,
invMax:0,iconID:162,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asian_monastery,validator:Q,build:1,icons:[a.createMonk,a.createPriest1],child:[{img:k.asian_monastery_c},{img:k.asian_monastery_s,rgb:[0,0,0,.5],alpha:!0}],name:"Monastery",clss:"church",cost:[0,0,200,200],time:40,sight:6,resistance:200,health:1E3},{race:"asia",invType:1,invMax:0,iconID:155,zLevel:1,dieSound:O,space:new Uint8Array([1,1,0,
0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_tavern,validator:Q,build:1,icons:[a.createMercenaries,a.createHeroes],child:[{img:k.asia_tavern_c},{img:k.asia_tavern_s,rgb:[0,0,0,.5],alpha:!0}],onbuild:e,name:"Tavern",clss:"tavern",actvintv:[a.iniMercenaries,a.iniHeroes],cost:[0,200,200,0],time:40,sight:5,resistance:150,health:1E3},{race:"asia",invType:1,invMax:0,iconID:150,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,4]),bimg:k.build4x4,
dimg:k.des_4x4,radix:0,url:k.asia_market,validator:Q,build:1,icons:[],child:[{img:k.asia_market_c}],name:"Market",clss:"market",cost:[0,200,200,0],time:60,sight:8,resistance:200,health:1400},{race:"asia",invType:1,invMax:0,iconID:153,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,4]),bimg:k.build4x4,dimg:k.des_4x4,radix:0,url:k.asia_stables,validator:Q,build:1,icons:[],child:[{img:k.asia_stables_c,mv:!0},{img:k.asia_stables_s,rgb:[0,0,0,.5],alpha:!0}],name:"Stable",clss:"stable",
onbuild:c,cost:[0,200,200,0],time:40,sight:5,resistance:80,health:800},{race:"asia",invType:1,invMax:0,iconID:151,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,3]),bimg:k.build3x3,dimg:k.des_3x3,radix:0,url:k.asia_outpost,validator:Q,build:1,icons:[a.emergeAllUnits],child:[{img:k.asia_outpost_c,mv:1},{img:k.asia_outpost_s,rgb:[0,0,0,.5],alpha:!0}],name:"Outpost",clss:"outpost",cost:[0,200,0,400],time:60,sight:8,resistance:500,health:2E3},{race:"asia",invType:1,invMax:0,iconID:163,zLevel:1,
dieSound:O,space:new Uint8Array([0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,6]),bimg:k.build6x6,dimg:k.des_6x6,radix:0,url:k.asia_shao_lin,validator:Q,build:1,icons:[a.techMeditation,a.techKungFu,a.techHealing,a.techPhilosophy,a.techNinjas,a.techMastery,a.techTournaments,a.techMedicine],child:[{img:k.asia_shao_lin_c},{img:k.asia_shao_lin_s,rgb:[0,0,0,.5],alpha:!0}],name:"Shao Linn",onbuild:[a.buildChurch1],clss:"shaolinn",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,
health:5E3},{race:"asia",invType:1,invMax:0,iconID:152,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_wizardguild,validator:Q,build:1,icons:[a.createMage1,a.techConcentration,a.techWhirlpool,a.techFlameBolt,a.techTurnToStone,a.techConfusion,a.techDragon],child:[{img:k.asia_wizardguild_c},{img:k.asia_wizardguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Mage Guild",clss:"magetower",cost:[2E3,0,0,2E3],time:90,
sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:159,zLevel:1,dieSound:O,space:new Uint8Array([0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_tcguild,validator:Q,build:1,icons:[a.techTradeRoutes,a.techUsury,a.techJewelry,a.techSupplyStorage,a.techBanking,a.techChemistry,a.techSeaFood,a.techGunPowder,a.techRocketArrow],child:[{img:k.asia_tcguild_c,mv:!0},{img:k.asia_tcguild_s,rgb:[0,0,0,.5],alpha:!0}],name:"Merchants Guild",
clss:"tcguild",cost:[2E3,0,0,2E3],time:90,onbuild:[a.buildMarket1],sight:8,resistance:700,health:5E3},{race:"asia",invType:1,invMax:0,iconID:156,zLevel:1,dieSound:O,space:new Uint8Array([1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,5]),bimg:k.build5x5,dimg:k.des_5x5,radix:0,url:k.asia_warguild,validator:Q,build:1,icons:[a.techBushido,a.techHeroism,a.techWarfare,a.techMercenaries,a.techLeadership,a.techTactics,a.techHeroes,a.techHonor,a.techSunTzu],child:[{img:k.asia_warguild_c,mv:!0},{img:k.asia_warguild_s,
rgb:[0,0,0,.5],alpha:!0}],name:"Warriors Guild",clss:"academy",cost:[2E3,0,0,2E3],time:90,sight:8,resistance:700,health:5E3},{race:"asia",invType:0,invMax:0,iconID:166,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.asian_priest,img:k.asian_priest.idle,spd:50,validator:S,human:1,icons:[a.attack,a.stop,a.stand,a.pickUp,a.explore,a.healing,a.teach,a.move],name:"Priest",clss:"priest",cost:[170,0,0,0],time:30,sight:21,health:120,standardFunc:L,attDist:1,attack:10,defence:10,mana:100,update:["mana",
"manaSpeed",1E3],manaMax:100},{race:"asia",invType:0,invMax:0,iconID:187,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.asian_monk,img:k.asian_monk.idle,spd:50,validator:S,human:1,icons:d,name:"Monk",standardFunc:L,clss:"monk",cost:[0,0,200,0],time:20,sight:5,health:90,attack:6,defence:6,attDist:1},{race:"asia",invType:0,invMax:0,iconID:134,zLevel:1,dieSound:[],attackSound:[],size:1,radix:0,url:k.asian_mage,img:k.asian_mage.idle,spd:50,attimg:k.flame_bolt,validator:S,standardFunc:L,human:1,
icons:[a.stop,a.pickUp,a.explore,a.confusion,a.turnToStone,a.whirlpool,a.flameBolt,a.createDragon,a.attack,a.stand,a.move],name:"Mage",clss:"mage",cost:[150,0,0,0],ball:1,time:30,sight:15,mana:100,attDist:10,health:60,attack:8,defence:0,update:["mana","manaSpeed",1E3],manaMax:100},{radix:0,name:"Dragon",strID:"dragon",defence:0,attack:25,health:300,maxHealth:300,img:k.dragon.idle,invType:0,invMax:0,dieSound:[],sSizex:2,sSizey:2,dragon:1,iconID:160,race:"common",zLevel:2,nofreeze:1,attackSound:[],
sight:12,standardFunc:L,url:k.dragon,icons:d,cost:[80,0,0,0,800],attDist:2,spd:128,clss:"drg",size:1,z32:1.5,validator:rf},{radix:0,name:"Carpet",strID:"carpet",defence:0,attack:0,health:90,maxHealth:90,img:k.carpet.idle,invType:1,invMax:8,dieSound:[],iconID:131,race:"common",zLevel:2,nofreeze:1,attackSound:[],sight:8,url:k.carpet,icons:[a.move,a.unload,a.explore,a.stop,a.stand],cost:[80,0,0,0,500],attDist:2,spd:120,clss:"carpet",size:1,z32:1.5,validator:rf},{radix:0,name:"Jinn",strID:"jinn",defence:5,
attack:20,health:300,maxHealth:300,img:k.arab_jinn.idle,invType:0,invMax:0,dieSound:[],validator:S,iconID:182,race:"common",zLevel:1,nofreeze:1,attackSound:[],sight:8,standardFunc:L,url:k.arab_jinn,icons:d,w:1,cost:[80,0,0,0,300],attDist:1,spd:85,clss:"jinn",size:1}];Wc={};Tg={arr:[]};Na={euro:[],asia:[],arab:[],common:[]};ud=[];Dc=[[],[],[],[],[],[]];m=0;for(l=x.length;m<l;m++){d=x[m];x[m].type=m;g=d.space;d.name.split(" ").join("");d.population&&ud.put(d);Wc[m]={};void 0!==d.storage&&(-1<d.storage?
Dc[d.storage].put(m):(Dc[0].put(m),Dc[1].put(m),Dc[2].put(m),Dc[3].put(m)));lb[d.race][d.name.toLowerCase().split(" ").join("")]=d;d.icons.menuName=d.strID;Tg[d.name]=m;Tg.arr.put(m);d.img||(d.img=d.url);d.maxHealth=d.health;d.race&&Na[d.race].put(d);e=0;c=d.icons;for(h=c.length;e<h;e++)(f=c[e])&&f.obj&&(f.orderOrigin=d);if(g){e=[];d.free=e;f=g[g.length-1];b=(g.length-1)/f;d=f+2;h=b+2;c=new Uint8Array(d*h);for(n=0;n<b;n++)for(var q=0;q<f;q++)c[(n+1)*d+q+1]=g[q+n*f];n=0;for(h*=d;n<h;n++)!c[n]&&(c[n+
1]||c[n-1]||c[n+1+d]||c[n+1-d]||c[n-1+d]||c[n-1-d]||c[n+d]||c[n-d])&&(e.put(n%d-1),e.put(~~(n/d)-1))}}Na.euro=Na.euro.concat(Na.common);Na.asia=Na.asia.concat(Na.common);Na.arab=Na.arab.concat(Na.common);Na[0]=Na.euro;Na[1]=Na.arab;Na[2]=Na.asian;c=lb.euro;h=lb.asia;f=lb.arab;b=lb.common;lb[0]=lb.euro;lb[1]=lb.arab;lb[2]=lb.asia;e=[c.knight,h.horsesamurai,f.cavalry,f.enichar,c.crusader,h.chariot,h.horsearcher,f.horsearcher];m=[h.horsesamurai,c.crusader,f.enichar];d=[c.knight,f.cavalry,h.chariot,h.horsearcher,
f.horsearcher];n=[c.longbowman,f.archer,h.archer,c.archer];l=[b.catapult,b.ballista,b.heavycatapult];g=[b.galleon,b.hulk,b.pinque,b.fishingboat];q=[b.galleon,b.hulk,b.pinque];var r=[f.satrap,c.maceman],u=[c.longbowman,f.archer,h.archer,c.archer,h.horsearcher,f.horsearcher,b.pinque,b.watchtower,b.keeptower,b.guardtower],t=[b.stonegolem,b.ork,b.dwarf,b.skeleton,b.ghost,b.dragon,b.jinn,b.bat,c.wizard,f.mage,h.mage],v=[c.peasant,h.peasant,f.peasant,c.footman,f.footman,h.ronin,c.pikeman,f.spearman,f.satrap,
c.maceman,f.cavalry,f.jihadwarrior,b.spy,f.enichar,h.horsesamurai,h.monk,h.chariot,h.ninja,b.stonegolem,b.ork,b.dwarf,b.jinn,b.skeleton,b.ghost,c.knight,c.crusader],w=[b.watchtower,b.keeptower,b.guardtower,b.cannontower],z=[b.cannontower,h.rockettower],A=[c.cathedral,c.castle,b.woodenwall,c.barracks,c.lumbermill,c.magetower,c.warriorsguild,c.storage,c.farm,c.merchantsguild,c.church,c.blacksmith,c.stable,c.workshop,c.tavern,c.house,b.watchtower,c.market,c.outpost,b.bridge,c.harbor,b.guardtower,b.keeptower,
b.cannontower,h.rockettower,h.castle,f.castle,h.barracks,f.house,f.lumbermill,f.storage,f.farm,f.harbor,f.blacksmith,f.workshop,f.church,f.tavern,f.market,f.barracks,f.stable,f.outpost,f.mosque,f.mageguild,f.merchantsguild,f.warriorsguild,f.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],D=[c.cathedral,c.castle,b.woodenwall,c.barracks,c.lumbermill,c.magetower,
c.warriorsguild,c.storage,c.farm,c.merchantsguild,c.church,c.blacksmith,c.stable,c.workshop,c.tavern,c.house,b.watchtower,c.market,c.outpost,b.bridge,c.harbor,h.castle,f.castle,h.barracks,f.house,f.lumbermill,f.storage,f.farm,f.harbor,f.blacksmith,f.workshop,f.church,f.tavern,f.market,f.barracks,f.stable,f.outpost,f.mosque,f.mageguild,f.merchantsguild,f.warriorsguild,f.magicworkshop,h.house,h.lumbermill,h.storage,h.farm,h.harbor,h.blacksmith,h.workshop,h.monastery,h.tavern,h.market,h.stable,h.outpost,
h.shaolinn,h.mageguild,h.merchantsguild,h.warriorsguild],F=[b.catapult,b.heavycatapult],C=[c.pikeman,f.spearman],I=[h.monk,h.priest],J=[b.woodenwall],H=[c.peasant,h.peasant,f.peasant],V=[c.wizard,f.mage,h.mage],U=[c.footman,f.footman,h.ronin],P=[c.priest,f.priest,h.priest];Bb={bless:{img:k.bless,d:0,mv:1},star:{img:k.star,d:0,mv:1},heal:{img:k.healing,d:0,mv:1},impersonate:{img:k.impersonate,d:0,mv:1},select:{img:k.select,d:0,mv:0,select:1,z32:.8},spawn:{img:k.spawn,d:0,mv:1},curse:{img:k.curse,d:0,
mv:1},turnStone:{img:k.turn_to_stone,d:0,mv:1}};var K=function(a,b,c){for(var f=a.length,d=0,e=b.length;d<e;d++)for(var h=0;h<f;h++)Wc[a[h].type][b[d].type]=c};K(z,q,4);K(q,q,3);K(q,D,3);K(q,w,3);K(q,J,5);K(q,l,2);K(F,D,4);K(F,g,4);K(F,w,6);K(F,l,4);K(F,J,9);K([h.samurai],m,.5);K([h.samurai],d,.3);K([h.ronin],H,1);K(C,e,6);K(U,C,1.5);K(U,n,1.5);K(U,[f.jihadwarrior],1);K([f.satrap],H,2);K(r,l,1.5);K(u,[b.dragon],.75);K(u,[b.bat],1);K(u,[c.pikeman],-.75);K(u,r,1);K(u,[h.chariot],-.3);K(u,I,.5);K(V,
P,4);K(P,V,3);K(P,t,3);K(v,[b.bat],-.2);K(v,[b.dragon],-.5);K([b.stonegolem],A,1);K([b.dwarf],A,4);K(t,[h.priest],-.5);Wa={img:k.gath_point,x32:-10,y32:-10,d:0,mv:!0};Hf=[Wa];d=wa;n=Object.keys(d);for(e=0;e<x.length;e++)for(l=x[e],m=0;m<n.length;m++)l[n[m]]=d[n[m]];e=[c.archer,c.longbowman,h.archer,h.horsearcher,f.archer,f.horsearcher];m=[c.footman,c.maceman,c.knight,c.crusader,c.pikeman,f.jihadwarrior,f.cavalry,f.footman,f.enichar,c.peasant,f.peasant,f.satrap,f.spearman,b.spy,h.chariot,h.monk,h.samurai,
h.ronin,h.horsesamurai,h.ninja,h.peasant,b.skeleton,b.ghost,b.ork,b.dwarf];d=[c.footman,c.maceman,c.knight,c.crusader,c.pikeman,f.jihadwarrior,f.cavalry,f.footman,f.enichar,c.peasant,f.peasant,f.satrap,f.spearman,b.spy,h.chariot,h.monk,h.samurai,h.ronin,h.horsesamurai,h.ninja,h.peasant,c.archer,c.longbowman,h.archer,h.horsearcher,f.archer,f.horsearcher,c.wizard,f.mage,h.mage,c.priest,f.priest,h.priest,b.skeleton,b.ghost,b.ork,b.dwarf];B=[{name:["Longbow","Allows the production of longbowmen"],next:[a.createLongbowman],
cost:[400,0,0,0],time:45,type:T},{name:["Gold Mining","Increases gold production"],increase:2,value:"gold",cost:[400,0,0,0],time:20,type:Ma},{name:["Stone Mining","Increases stone production"],increase:2,value:"stone",cost:[400,0,0,0],time:20,type:Ma},{name:["Wood Cutting","Increases wood production"],increase:2,value:"wood",cost:[400,0,0,0],time:20,type:Ma},{name:["Temper Iron","Increases hand-to-hand units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:m,next:[a.techHalberd],
type:Ta},{name:["Scale Armor","Increases unit's defense"],increase:1,value:"defence",cost:[400,0,0,0],time:30,group:d,next:[a.techChainMail],type:Ta},{name:["Halberd","Allows the production of spear units"],next:[a.createPikeman,a.createPikeman2],cost:[400,0,0,0],time:30,type:T},{name:["Domestication","Allows the production of cows"],next:[a.createCow],cost:[300,0,0,0],time:20,type:T},{name:["Crop Rotation","Increases the production of fields"],increase:2,value:"food",cost:[400,0,0,0],time:20,type:Ma,
next:[a.irrigation]},{name:["Chain Mail","Increases unit's defense"],increase:2,value:"defence",cost:[400,0,0,0],time:30,group:d,type:Ta},{name:["Plate Armor","Allows the production of knights"],next:[a.createKnight],cost:[400,0,0,0],time:60,type:T},{name:["Crossbow","Increases arrow units' attack power"],increase:2,value:"attack",cost:[400,0,0,0],time:30,group:e,type:Ta},{name:["Feudalism","Makes peasants cheaper"],cost:[300,0,0,0],time:30,decrease:[h.peasant,[0,0,8,0],c.peasant,[0,0,10,0],f.peasant,
[0,0,10,0]],type:qg,next:[a.techSlavery]},{name:["Architecture","Peasants build faster, and allows stone wall, gate and towers"],increase:.5,value:"buildSpeed",cost:[300,0,0,0],time:30,type:Ma,next:[a.upgradeStoneTower,a.techGreatWall,a.buildBridge]},{name:["Learning","Allows units to gather experience"],increase:1,value:"experience",cost:[400,0,0,0],time:30,type:Ma,next:[a.buildAcademy,a.buildAcademy1,a.buildAcademy2]},{name:["Convert Resources",""],cost:[400,0,0,0],time:30},{name:["Map Making",
"Allows the production of galleons"],cost:[800,0,0,0],time:30,type:T},{name:["Trade Routes","Allows trading"],cost:[400,0,0,0],time:30,type:T,next:[a.techTradeTaxes]},{name:["Trade Taxes","Increases trade profit"],cost:[400,0,0,0],time:30},{name:["Usury","Allows the obtaining of loans in taverns"],cost:[300,0,0,0],time:30,type:ve,changeicon:38,next:[a.techBanking]},{name:["Supply Storage","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Ma,value:"popLimit",next:[a.techSeaFood]},
{name:["Bribery","Allows the bribing of enemy units"],cost:[600,0,0,0],time:60,type:T,next:[a.bribe]},{name:["Heroism","Allows unlimited experience"],cost:[500,0,0,0],time:30,increase:Infinity,value:"maxLevel",type:Ma,next:[a.techLeadership]},{name:["Warfare","Gain experience faster"],cost:[400,0,0,0],time:30,type:Ma,increase:1,value:"experience",next:[a.techTactics]},{name:["Tactics","Gain experience faster"],cost:[800,0,0,0],time:30,type:T,next:[a.buildDummy,a.techSunTzu]},{name:["Mercenaries",
"Allows the recruitment of units in taverns"],cost:[600,0,0,0],time:30,type:ve,next:[a.techHeroes,a.createMercenaries],actvintv:[a.iniMercenaries]},{name:["Heroes' Quest","Allows the recruitment of heroes in taverns"],cost:[800,0,0,0],time:30,type:ve,next:[a.techFame,a.createHeroes],actvintv:[a.iniHeroes]},{name:["Fame","Recruit better units from taverns"],cost:[500,0,0,0],time:30,value:"fameTech",increase:1,type:Ma},{name:["Siege Tactics","Allows the production of heavy catapults"],cost:[1200,0,
0,0],time:60,type:T,next:[a.createHeavyCatapult]},{name:["Body Building","Increases unit's hit points at every new level"],cost:[800,0,0,0],time:60,value:"healthJump",increase:5,type:Ma},{name:["Espionage","Allows the production of a spy"],cost:[400,0,0,0],time:30,type:T,next:[a.createSpy]},{name:["Fanaticism","Increases the building's resistance"],cost:[400,0,0,0],time:30,type:Ta,group:[],increase:5,value:"resistance",next:[a.techCrusade,a.techJihad]},{name:["Crusade","Allows the preaching of a crusade"],
cost:[1200,0,0,0],time:180,type:T,next:[a.createCrusaders]},{name:["Inquisition","Increases priest attack"],cost:[400,0,0,0],time:30,type:Ta,group:[c.priest,f.priest,h.priest],increase:5,value:"attack"},{name:["Healing","Allows healing of units"],cost:[400,0,0,0],time:30,next:[a.techMedicine,a.healing],type:T},{name:["Medicine","Allows remote healing of units"],cost:[500,0,0,0],time:30,value:"healingRange",increase:5,type:Ma},{name:["Bless","Temporarily increases unit attack skill"],cost:[400,0,0,
0],time:30,type:T,next:[a.bless]},{name:["Invisibility","Invisibility spell"],cost:[500,0,0,0],time:30,type:T,next:[a.invisibility]},{name:["Bat","Researches bat summoning"],cost:[400,0,0,0],time:240,type:T,next:[a.createBat]},{name:["Freeze","Freeze spell"],cost:[800,0,0,0],time:30,type:T,next:[a.freeze]},{name:["Lightning","Lightning spell"],cost:[400,0,0,0],time:30,type:T,next:[a.lightning]},{name:["Stone Golem","Researches stone golem summoning"],cost:[800,0,0,0],time:120,type:T,next:[a.createGolem]},
{name:"Upgrade to Guard Tower",cost:[0,600,0,0],time:20,type:zd,obj:44,upgrade:1},{name:"Upgrade to Stone Tower",cost:[0,0,0,500],time:30,type:zd,obj:55,upgrade:1},{name:"Upgrade to Cannon Tower",cost:[0,0,0,500],time:30,type:zd,obj:56,upgrade:1},{name:["Buddhism"],cost:[400,0,0,0],time:30,type:T,next:[a.buildCathedral1]},{name:["Cannon Tower","Allows the building of cannon towers"],next:[a.upgradeCannonTower],cost:[400,0,0,0],time:30,type:T},{name:["Engineering","Increases siege weapon's attack"],
increase:5,value:"attack",cost:[400,0,0,0],time:30,group:[b.ballista,b.catapult,b.heavycatapult],type:Ta},{name:["Great Wall","Makes stone walls, towers and gates stronger"],cost:[600,0,0,0],time:30,type:T},{name:["Art of Riding","Allows the production of horse archers"],cost:[500,0,0,0],time:30,type:T,next:[a.createHorseArcher1,a.createHorseArcher2,a.techHorseManShip]},{name:["Irrigation","Increases field production"],increase:4,value:"food",cost:[400,0,0,0],time:30,type:Ma},{name:["Armored Chariot",
"Allows the production of armored chariots"],cost:[500,0,0,0],time:60,type:T,next:[a.createChariot]},{name:["Meditation","Makes monks cheaper"],cost:[300,0,0,0],time:30,decrease:[0,0,50,0],type:we,next:[a.techPhilosophy],group:[h.monk]},{name:["Kung-Fu","Increases the attack of all kung-fu units"],cost:[400,0,0,0],time:30,type:Ta,increase:1,value:"attack",group:[h.peasant,h.ninja,h.monk,h.priest],next:[a.techMastery,a.techNinjas,a.techTournaments]},{name:["Tournaments","Allows sharing of experience between kung-fu units"],
cost:[800,0,0,0],time:30,type:T,next:[]},{name:["Philosophy","Allows the production of more experienced monks"],cost:[400,0,0,0],time:30,type:Ta,increase:2,value:"level",group:[h.monk,h.priest],next:[a.createPriest1]},{name:["Ninjas","Allows the production of ninjas"],cost:[500,0,0,0],time:30,type:T,next:[a.createNinja]},{name:["Mastery","Allows priests to teach kung-fu units"],cost:[500,0,0,0],time:30,type:T,next:[a.teach]},{name:["Concentration","Allows faster manna restoration"],cost:[600,0,0,
0],time:80,type:T,next:[a.techConfusion]},{name:["Confusion","Researches the Confusion spell"],cost:[400,0,0,0],time:30,type:T,next:[a.confusion]},{name:["Whirlpool","Researches the Whirlpool spell"],cost:[300,0,0,0],time:30,type:T,next:[a.whirlpool]},{name:["Dragon","Researches Dragon summoning"],cost:[800,0,0,0],time:300,type:T,next:[a.createDragon]},{name:["Turn to Stone","Researches the Turn to Stone spell"],cost:[300,0,0,0],time:30,type:T,next:[a.turnToStone]},{name:["Flame Bolt","Researches the Flame Bolt spell"],
cost:[400,0,0,0],time:30,type:T,next:[a.techDragon,a.flameBolt]},{name:["Jewelry","Allows trading of items"],cost:[400,0,0,0],time:30,type:T,next:[a.sellItems,a.buyItems]},{name:["Banking","Increases trade profit"],cost:[600,0,0,0],time:30,type:T},{name:["Chemistry","Increases arrow units' attack power"],cost:[500,0,0,0],time:30,type:Ta,group:e,increase:1,value:"attack",next:[a.techGunPowder]},{name:["Sea Food","Increases the population limit"],cost:[500,0,0,0],time:30,increase:50,type:Ma,value:"popLimit"},
{name:["Gun Powder","Increases cannon tower's attack power"],cost:[500,0,0,0],time:30,type:Ta,increase:10,value:"attack",group:[b.cannontower],next:[a.techRocketArrow]},{name:["Rocket Arrow","Allows the building of rocket tower"],cost:[800,0,0,0],time:30,type:T,next:[a.buildRocketTower]},{name:["Bushido","Allows the production of horse samurai"],cost:[800,0,0,0],time:120,type:T,next:[a.createHorseSamurai]},{name:["Leadership","Units around a hero gain experience"],cost:[600,0,0,0],time:30,type:T,
next:[a.techHonor]},{name:["Honor","Hero vs. hero attack bonus"],cost:[500,0,0,0],time:30,type:T},{name:["Sun Tzu's Book","Increases the speed of learning"],cost:[800,0,0,0],time:30,type:Ma,increase:1,value:"experience"},{name:["Cow Poaching","Allows peasants to steal cows"],cost:[200,0,0,0],time:30,type:Ma,increase:1,value:"stealCows"},{name:["Horsemanship","Makes mounted units cheaper"],cost:[500,0,0,0],time:30,type:we,mulp:.75,group:[h.horsearcher,f.cavalry,f.horsearcher]},{name:["Scimitar","Increases sword attack power and allows the production of satraps"],
cost:[400,0,0,0],time:30,type:Ta,increase:1,value:"attack",group:m,next:[a.createSatrap]},{name:["Jihad","Allows the production of Jihad Warriors"],cost:[1200,0,0,0],time:30,type:T,next:[a.createJihad,a.convertJihad]},{name:["Magic Carpet","Researches Magic Carpet summoning"],cost:[300,0,0,0],time:30,type:T,next:[a.createCarpet,a.techJinn]},{name:["Magic Workshop","Allows the building of a magic workshop"],cost:[1200,0,0,0],time:180,type:T,next:[a.buildMagicWorkshop]},{name:["Rain of Fire",""],cost:[800,
0,0,0],time:60,type:T,next:[a.fireRain]},{name:["Magic Vision","Researches the Magic Vision spell"],cost:[400,0,0,0],time:30,type:T,next:[a.magicVision]},{name:["Necromancy","Researches the Raise the Dead spell"],cost:[400,0,0,0],time:30,type:T,next:[a.raiseDead]},{name:["Jinn","Researches Jinn summoning"],cost:[600,0,0,0],time:300,type:T,next:[a.createJinn]},{name:["Ore Enrichment","Increases mine production"],cost:[800,0,0,0],time:30,type:Ma,increase:1,value:"miningPerf"},{name:["Riding Horses",
"Increases the mounted units' attack and defense power"],cost:[500,0,0,0],time:30,type:hi,values:["attack",2,"defence",1],group:[h.horsearcher,f.cavalry,f.horsearcher],next:[a.techJanissary]},{name:["Janissary","Allows the production of Janissaries"],cost:[1200,0,0,0],time:120,type:T,next:[a.createEnichar]},{name:["Slavery","Makes peasants cheaper"],cost:[200,0,0,0],time:30,decrease:[h.peasant,[0,0,7,0],c.peasant,[0,0,8,0],f.peasant,[0,0,8,0]],type:qg}];lj();a.buildMarket.disabled=1;mj();m=0;for(l=
x.length;m<l;m++)if(d=x[m],d.onbuild)for(c=d.onbuild,e=0,h=c.length;e<h;e++)f=c[e],f.obj.race==d.race&&(f.disabled=1,f.require=d.name,f.requireObj||(f.requireObj=[]),f.requireObj.put(d));e=0;for(h=B.length;e<h;e++)if(f=B[e],f.tech=1,f.id=e,f.next)for(c=f.next,n=0,m=c.length;n<m;n++)d=c[n],d.disabled?(d.disabled++,d.require+=", "+f.name[0],d.requireObj.put(f)):(d.requireObj=[f],d.disabled=1,d.require=f.name[0]);e=0;c=x;for(h=c.length;e<h;ik(c[e++]));}new Tb("",[255,255,255],[0],!0)},x,Wc,Tg,Wa,Hf,
ud,Ug=8,w=new Float32Array(16),hc=function(a,b,d,c,e,h,l){var f=x[a];if(h=h&&!f.instantBuild)this.built=!1;var g=I[b],k=g.mod[a],q=Object.keys(k);this.__proto__=f;this.kingdom=b;this.d=e;this.x32=d;this.y32=c;this.taskList=[];e=0;for(var y=q.length;e<y;this[q[e]]=k[q[e++]]);if(l)for(k=Object.keys(l),e=0,y=k.length;e<y;this[k[e]]=l[k[e++]]);0<f.invMax&&(this.inventory=[]);f.build||(this.mv=1);l=g.technology.disabled;k=f.actvintv;this.workers=[];this.id=y=z.length;f.rndDirection&&(this.d=y*d%f.rndDirection);
this.build||g.values.pop++;d=f.validator(d,c,f.space,b);if(d[1]){c=f.validator.dimension;q=d[0];if(h){c=za;this.onbuild1=q;var u=ub[b];e=0;for(f=q.length;e<f;e++)u[q[e]]=y}else for(e=0,f=q.length;e<f;c[q[e++]]=y);if(d[2])if(q=d[2],h){M(q);e=0;for(f=q.length;e<f;c[q[e++]]=y);this.onbuildValid=q}else for(e=0,f=q.length;e<f;c[q[e++]]=0);}else return this.invalid=!0,!1;z[y]=this;hb[b][a].put(y);if(this.update&&!r.custom)for(a=this.update,e=0,y=a.length;e<y;e+=3)ya({func:ne,data:[this.id,a[e],a[e+1],a[e+
2]]},a[e+2],1);if(k)for(a=0,f=k.length;a<f;a++)b=k[a],l[b.id]||b(this);h?(Ra(this),t.kingdom==this.kingdom?(M(h),cd(this,ok)):cd(this,ig)):Ra(this);this.level&&!this.potion&&ci(this);!this.standardFunc||this.func||r.editor||this.standardFunc(this);h=g.stats;h.unitCount[this.type]++;g=h.unitCount[this.type]-h.unitCountDeath[this.type];g>h.unitCountMax[this.type]&&(h.unitCountMax[this.type]=g)},mi=function(a){var b=I[a.kingdom];if(a.population){var f=a.population;b.values.popMax+=f;yd(a.kingdom);for(var c=
0;c<f;c++)b.checkPopArray()}if(a.onbuild)for(a=a.onbuild,f=b.technology,b=f.disabled,f=f.actived,c=0;c<a.length;c++){var e=a[c].id;f[e]||(f[e]=0);f[e]++;f[e]-1||(b[e]--,!b[e]&&ia.actv[e]&&ia(X.active))}},$b=[],K=new Float32Array(12),Vg=function(a,b,d){var c=a.length;a[c]=b;a[c+1]=b+1;a[c+2]=b+2;a[c+3]=b+1;a[c+4]=b+2;a[c+5]=b+3;a.changed=!0;d.typeBuffer=a;d.elemtId=c},cd=function(a,b){var f=b[3];if(b.noAlpha)c=aa;else{a.alpha=!0;var c=ca}if(a.typeBuffer!==c){if(b==ig){if(qb.diplomacy[a.kingdom]){wb(a);
return}b=new Float32Array(xb(ua[3*a.kingdom],ua[3*a.kingdom+1],ua[3*a.kingdom+2],f+1))}wb(a);Vg(c,a.bufferID,a)}g.bindBuffer(g.ARRAY_BUFFER,Xa);g.bufferSubData(g.ARRAY_BUFFER,16*a.bufferID,b)},Zb=function(a){var b=sf(a,a.kingdom),f=b[0],c=b[1],e=b[2];b=b[3];var h=a.bufferID;nj(f,c,e,b,a.bufferID);1>b?(a.alpha=!0,f=ca):f=aa;a.typeBuffer!==f&&(wb(a),Vg(f,h,a));if(a.child&&(!1!==a.built||!a.build))for(var l=a.child,g=0,k=l.length;g<k;g++)h+=4,b=sf(l[g],a.kingdom),f=b[0],c=b[1],e=b[2],b=b[3],nj(f,c,e,
b,h)},sf=function(a,b){if(null!=a.rgb){var f=a.rgb;a=f[0];var c=f[1];b=f[2];f=f[3]}else ra[a.img][3]?(a=ua[3*b],c=ua[3*b+1],b=ua[3*b+2],f=2):(a.mMapcolor?(b=a.mMapcolor,a=b[0]/255,c=b[1]/255,b=b[2]/255):(a=ua[3*b],c=ua[3*b+1],b=ua[3*b+2]),f=1);return[a,c,b,f]},oj=function(){if($b.length){var a=$b[$b.length-1];$b.length--}else a=Ug,Ug+=4;return a},Ra=function(a,b,d,c){void 0==b&&(c=d=b=0);var f=ra[a.img],h=1;if(a.bufferID){var l=a.bufferID;h=0}else l=oj();a.bufferID=l;var k=f[2]*a.d*6+4,n=f[4+k],m=
f[5+k];k=f[0];var q=f[1];0<=q&&(q*=.001);var y=f.id+4*a.d*f[2],u=-1;a.mv&&(u=r.now());w[0]=y;w[1]=u;w[2]=k;w[3]=q;w[4]=y+1;w[5]=u;w[6]=k;w[7]=q;w[8]=y+2;w[9]=u;w[10]=k;w[11]=q;w[12]=y+3;w[13]=u;w[14]=k;w[15]=q;var t=32*a.x32,v=32*a.y32;k=32*a.y32;null!=a&&null!=a.z32&&(k*=a.z32);var z=aa;g.bindBuffer(g.ARRAY_BUFFER,Rc);g.bufferSubData(g.ARRAY_BUFFER,16*l,w);g.bindBuffer(g.ARRAY_BUFFER,ec);if(a.rotation){var x=a.rotation;x*=2*Math.PI;var A=.5*f[8];q=.5*f[9];f=-1*k;y=-A;u=-q;var B=0*K.length;K[B]=y*
Math.cos(x)-q*Math.sin(x)+t;K[B+1]=q*Math.cos(x)+y*Math.sin(x)+v;K[B+2]=f;K[B+3]=y*Math.cos(x)-u*Math.sin(x)+t;K[B+4]=u*Math.cos(x)+y*Math.sin(x)+v;K[B+5]=f;K[B+6]=A*Math.cos(x)-q*Math.sin(x)+t;K[B+7]=q*Math.cos(x)+A*Math.sin(x)+v;K[B+8]=f;K[B+9]=A*Math.cos(x)-u*Math.sin(x)+t;K[B+10]=u*Math.cos(x)+A*Math.sin(x)+v;K[B+11]=f}else a.wh?(x=a.wh[0],A=a.wh[1],x-=n,A-=m,K[0]=t,K[1]=v,K[2]=k,K[3]=t+x,K[4]=v,K[5]=k,K[6]=t,K[7]=v+A,K[8]=k,K[9]=t+x,K[10]=v+A):(K[0]=t,K[1]=v,K[2]=k,K[3]=t,K[4]=v,K[5]=k,K[6]=
t,K[7]=v,K[8]=k,K[9]=t,K[10]=v),K[11]=k;g.bufferSubData(g.ARRAY_BUFFER,12*l,K);u=sf(a,a.kingdom);f=u[0];q=u[1];y=u[2];u=u[3];if(1>u||a.alpha)a.alpha=!0,z=ca;g.bindBuffer(g.ARRAY_BUFFER,Xa);w[0]=f;w[1]=q;w[2]=y;w[3]=u;w[4]=f;w[5]=q;w[6]=y;w[7]=u;w[8]=f;w[9]=q;w[10]=y;w[11]=u;w[12]=f;w[13]=q;w[14]=y;w[15]=u;g.bufferSubData(g.ARRAY_BUFFER,16*l,w);g.bindBuffer(g.ARRAY_BUFFER,ld);x=r.now();w[0]=b;w[1]=d;w[2]=c;w[3]=x;w[4]=b;w[5]=d;w[6]=c;w[7]=x;w[8]=b;w[9]=d;w[10]=c;w[11]=x;w[12]=b;w[13]=d;w[14]=c;w[15]=
x;g.bufferSubData(g.ARRAY_BUFFER,16*l,w);h&&Vg(z,l,a);if(a.child&&!1!==a.built)for(b=k,d=a.child.length,c=[],a.childLoc=c,h=0;h<d;h++){z=a.child[h];f=ra[z.img];k=f[2]*a.d*6+4;x=f[4+k];A=f[5+k];k=f[0];q=f[1];0<=q&&(q*=.001);y=f.id+4*a.d;u=-1;z.mv&&(u=1);w[0]=y;w[1]=u;w[2]=k;w[3]=q;w[4]=y+1;w[5]=u;w[6]=k;w[7]=q;w[8]=y+2;w[9]=u;w[10]=k;w[11]=q;w[12]=y+3;w[13]=u;w[14]=k;w[15]=q;u=sf(z,a.kingdom);f=u[0];q=u[1];y=u[2];u=u[3];B=t;var D=v;z.wh1&&(x=z.wh[0],A=z.wh[1]);z.center&&(B-=.5*~~(x-n),D-=.5*~~(A-m));
l=oj();g.bindBuffer(g.ARRAY_BUFFER,Rc);g.bufferSubData(g.ARRAY_BUFFER,16*l,w);g.bindBuffer(g.ARRAY_BUFFER,Xa);w[0]=f;w[1]=q;w[2]=y;w[3]=u;w[4]=f;w[5]=q;w[6]=y;w[7]=u;w[8]=f;w[9]=q;w[10]=y;w[11]=u;w[12]=f;w[13]=q;w[14]=y;w[15]=u;g.bufferSubData(g.ARRAY_BUFFER,16*l,w);k=z.z?32*z.z+b:b;g.bindBuffer(g.ARRAY_BUFFER,ec);K[0]=B;K[1]=D;K[2]=k;K[3]=B;K[4]=D;K[5]=k;K[6]=B;K[7]=D;K[8]=k;K[9]=B;K[10]=D;K[11]=k;g.bufferSubData(g.ARRAY_BUFFER,12*l,K);g.bindBuffer(g.ARRAY_BUFFER,ld);w[0]=0;w[1]=0;w[2]=0;w[3]=0;
w[4]=0;w[5]=0;w[6]=0;w[7]=0;w[8]=0;w[9]=0;w[10]=0;w[11]=0;w[12]=0;w[13]=0;w[14]=0;w[15]=0;g.bufferSubData(g.ARRAY_BUFFER,16*l,w);k=1>u?ca:z.light?Ba:aa;c.put(k);x=k.length;c.put(x);k[x]=l;k[x+1]=l+1;k[x+2]=l+2;k[x+3]=l+1;k[x+4]=l+2;k[x+5]=l+3;k.changed=!0}};ObjectsetupPhysics=function(a,b,d,c){var f=r.now(),h=a.bufferID;w[0]=b;w[1]=d;w[2]=c;w[3]=f;w[4]=b;w[5]=d;w[6]=c;w[7]=f;w[8]=b;w[9]=d;w[10]=c;w[11]=f;w[12]=b;w[13]=d;w[14]=c;w[15]=f;g.bindBuffer(g.ARRAY_BUFFER,ld);g.bufferSubData(g.ARRAY_BUFFER,
16*h,w);g.bindBuffer(g.ARRAY_BUFFER,null);if(a.tempChild)for(f=0,a=a.tempChild,h=a.length;f<h;ObjectsetupPhysics(a[f++],b,d,c));};var Rg=function(a,b,d,c,e,h){pb[0]=a;pb[1]=b;pb[2]=d;pb[3]=a+c;pb[4]=b;pb[5]=d;pb[6]=a;pb[7]=b+e;pb[8]=d;pb[9]=a+c;pb[10]=b+e;pb[11]=d;g.bindBuffer(g.ARRAY_BUFFER,ec);g.bufferSubData(g.ARRAY_BUFFER,12*h,pb);g.bindBuffer(g.ARRAY_BUFFER,null)},nj=function(a,b,d,c,e){w[0]=a;w[1]=b;w[2]=d;w[3]=c;w[4]=a;w[5]=b;w[6]=d;w[7]=c;w[8]=a;w[9]=b;w[10]=d;w[11]=c;w[12]=a;w[13]=b;w[14]=
d;w[15]=c;g.bindBuffer(g.ARRAY_BUFFER,Xa);g.bufferSubData(g.ARRAY_BUFFER,16*e,w);g.bindBuffer(g.ARRAY_BUFFER,null)};ObjectsetupPosition=function(a,b,d){void 0==d&&(d=32);a.z32&&(b*=a.z32);var c=a.x32*d;d*=a.y32;a.wh?Rg(c,d,b,a.wh[0]-ra[a.img][8],a.wh[1]-ra[a.img][9],a.bufferID):Rg(c,d,b,0,0,a.bufferID);if(a.tempChild)for(b=a.tempChild,c=0,d=b.length;c<d;c++){var f=b[c];f.x32=a.x32;f.y32=a.y32;ObjectsetupPosition(f,32*a.y32)}};ObjectindexHide=function(a){ObjectsetupPosition(a,NaN)};ObjectindexShow=
function(a){var b=1;a.z32&&(b=a.z32);ObjectsetupPosition(a,32*a.y32*b)};var wa={getRadix:function(){return La[this.zLevel]},checkMana:function(a,b,d,c){if(!this.mana)return!1;if(0>this.mana-a)return this.manaTask=[d.url,b,a],this.stay55(),a>this.manaMax&&c&&(this.blockedCost=c,b=this.setupChild(Bb.curse,1),this.blocked=2,this.blockedimg=b,this.manaTarget=a,g.bindBuffer(g.ARRAY_BUFFER,Xa),g.bufferSubData(g.ARRAY_BUFFER,16*this.bufferID,qe),g.bufferSubData(g.ARRAY_BUFFER,16*b.bufferID,qe)),!1;this.mana-=
a;return!0}},ac=function(a,b){return r.editor?!0:a.freezed||a.confused?!1:I[a.spy||a.kingdom].control[b.spy||b.kingdom]};wa.changeKingdom=function(a){hb[this.kingdom][this.type].quit(this.id);bc[this.id]&&(bc[this.id]=0,J.quit(this.id),0==J.length&&(ia([]),Qd(),Qb=-1),Lg(this.id));this.kingdom=a;Zb(this);this.childBuild&&(this.childBuild=0);this.build&&!this.arrow||this.stay();hb[a][this.type].put(this.id)};wa.aspettare=function(){this.getRadix()[this.x32+this.y32*D]=this.id;this.waiting=!0;ObjectsetupIMG(this,
this.url.idle);ObjectsetupPhysics(this,0,0,0);mb(this,~~(32E3/this.spd))};wa.addItem=function(a){var b=this.inventory;b&&(b[b.length]=a.id,a.sword||a.shield)&&(a.attack&&(this.attack+=a.attack),a.defence&&(this.defence+=a.defence))};wa.showInventory=function(){of();for(var a=this.inventory,b=0;8>b;b++){var d=a[b];if(!d)break;var c=Ga[b];c.style.backgroundPosition="0px "+48*d.iconID+"px";c.className="";bf[b]=null}};wa.deleteItem=function(a){this.inventory.quit(a.id);this.attack-=a.attack;this.defence-=
a.defence};wa.useItem=function(a){48==a.type&&(this.health+=a.lives,this.health>this.maxHealth&&(this.maxHealth=this.health),this.inventory.quit(a.id))};wa.onattack=function(a){!this.attack||this.freezed||this.death||this.func!=Yd.url&&this.func||uc(a.id,[this.id],1)};ObjectsetupINTV1=function(a,b,d){this.data=b;this.func=a.url;this.time=~~(.04*d);ya(this,d);return d};wa.setupINTV=function(a,b,d){this.funcObj=b;a.url||M(a,a.url);this.func=a.url;this.deleteWorker();mb(this,d);return d};wa.damage=function(a,
b){if(!(this.zolotoy||this.death||this.stoned)){this.defence&&(a-=this.defence);1>a&&(a=1);this.health-=a;b=I[b.kingdom].stats;b.dmgInflicted+=a;var f=I[this.kingdom].stats;f.dmgTaken+=a;1>this.health?(this.build?(f.buildsLosed++,b.buildsKilled++):(f.unitsLosed++,b.unitsKilled++),this.die()):Y(this.id,1)}};var Y=function(a,b){if(bc[a]||!1===a)return a=J.length,1===a?(a=z[J[0]],X.stockActive==a&&a.inventory.length?(Fc(a.id,1,1),Ri(a,1)):a.build?Ja(a,1):Fc(a.id,b)):1<a?Mg(J,b):ej(Va),!0};wa.setupSpellIMG=
function(a){this.invisible&&bd(this.id);this.url.spell&&ObjectsetupIMG(this,this.url.spell,1);a||ya({func:pj,data:this.id},Ca(this.img),1)};var pj=function(a){a=z[a];a.death||a.stay()};wa.setupChild=function(a,b,d){var c={x32:this.x32,y32:this.y32,d:a.d,img:a.img,mv:a.mv,parent:this.id,z32:a.z32};if((this.dix||this.diy)&&!this.waiting){var f=.001*(r.now()-this.timestamp);c.x32+=this.dix*f/32-Math.sign(this.dix);c.y32+=this.diy*f/32-Math.sign(this.diy)}if(a.select){if(this.space)a=this.space[this.space.length-
1],h=(this.space.length-1)/a;else{a=this.sSizex||1;var h=this.sSizey||1}this.z32&&(c.z32=this.z32);c.wh=[32*a-3,32*h-3];this.selectAnim=c}Ra(c);f&&ObjectsetupPhysics(c,this.dix,this.diy,0);d&&(g.bindBuffer(g.ARRAY_BUFFER,Xa),g.bufferSubData(g.ARRAY_BUFFER,16*c.bufferID,d));this.tempChild||(this.tempChild=[]);this.tempChild.put(c);b||zb.new(c,Ca(c.img),qj);return c};var qj=function(a){z[a.parent].tempChild.quit(a);wb(a)};wa.distance=0;ObjectsetupIMG=function(a,b,d,c){a.img=b;b=ra[b];var f=b[0],h=b[1];
0<=h&&(h*=.001);c&&(h*=c);b=b.id+4*a.d*b[2];c=-1;1===d?c=r.now():0>d&&(c=1);d=c;a=a.bufferID;w[0]=b;w[1]=d;w[2]=f;w[3]=h;w[4]=b+1;w[5]=d;w[6]=f;w[7]=h;w[8]=b+2;w[9]=d;w[10]=f;w[11]=h;w[12]=b+3;w[13]=d;w[14]=f;w[15]=h;g.bindBuffer(g.ARRAY_BUFFER,Rc);g.bufferSubData(g.ARRAY_BUFFER,16*a,w);g.bindBuffer(g.ARRAY_BUFFER,null)};wa.setupDir=function(a,b,d){a=Math.sign(a);b=Math.sign(b);a=3*(b-1)+(a+1);2==a?this.d=1:-6==a?this.d=5:0==a?this.d=7:-4==a?this.d=3:-1==a?this.d=2:1==a?this.d=0:-5==a?this.d=4:-3==
a&&(this.d=6);d&&(this.d=(this.d+d)%8)};wa.setupDirBuild=function(a){var b=V;1==a.health&&0==a.built&&(b=ub[a.kingdom]);a=a.id;var d=D,c=this.x32+this.y32*d;b[c+d]==a?this.d=0:b[c-d]==a?this.d=4:b[c+1]==a?this.d=2:b[c-1]==a?this.d=6:b[c+d+1]==a?this.d=1:b[c-d+1]==a?this.d=3:b[c+d-1]==a?this.d=7:b[c-d-1]==a&&(this.d=5)};wa.spdMod=0;var vg=function(a,b){b=b.length;for(var d=0;d<b;d++){var c=z[J[d]];c.build||(c.spd=a)}};wa.stay=function(a){this.mv=1;this.func=this.time=void 0;this.diy=this.dix=0;this.c=
void 0;this.xf=null;ObjectsetupPhysics(this,0,0,0);a||(this.stock&&0!==this.stock[0]?ObjectsetupIMG(this,this.img,NaN):ObjectsetupIMG(this,this.__proto__.img,1),this.deleteWorker(),this.standardFunc&&2!==this.stop&&this.standardFunc(this))};wa.stay55=function(){this.stock&&0!==this.stock[0]?ObjectsetupIMG(this,this.img,NaN):ObjectsetupIMG(this,this.__proto__.img,1);this.deleteWorker();this.standardFunc&&this.standardFunc(this)};var Wk=[],wb=function(a){a.elemtId&&(rj(a.elemtId,a.typeBuffer),a.elemtId=
void 0,a.typeBuffer=void 0)},gi=function(a){if(a.childLoc){a=a.childLoc;for(var b=0,d=a.length;b<d;b+=2)rj(a[b+1],a[b])}},rj=function(a,b){b[a]=NaN;b[a+1]=NaN;b[a+2]=NaN;b[a+3]=NaN;b[a+4]=NaN;b[a+5]=NaN;b.changed=!0;Wk.put(a)};wa.addWorker=function(a){this.workers.put(a.id);a.workingOn=this.id};wa.deleteWorker=function(){this.workingOn&&(z[this.workingOn].workers.quit(this.id),this.workingOn=0);this.actionItem&&(this.actionItem=void 0);this.blockedAction()};wa.blockedAction=function(a){var b=this.blocked;
if(sj[b])sj[b](this,a)};var sj={2:function(a,b){a.blocked=void 0;Zb(a);qj(a.blockedimg);a.blockedimg=void 0;a.manaTarget=void 0;b||(I[a.kingdom].setupResources(a.blockedCost,-1),a.blockedCost=void 0)}},Ji=function(a){return k.delay[-a[1]+a[0]-1]},Dd=function(a){var b=J.length;J.quit(a);if(b!=J.length){var d=z[a];d.selectAnim=void 0;b=0;for(d=d.tempChild;b<d.length;b++){var c=d[b];wb(c);var f=d.length;d.quit(c);f!=d.length&&b--}bc[a]=void 0;0==J.length?Qd():1==J.length?Fc(a):Mg(J)}Va&&Va.id===a&&(Qd(),
Va.selectAnim&&(wb(Va.selectAnim),Va.selectAnim=void 0),Va=void 0)};wa.base=function(a){return La[this.zLevel][a]};wa.rbase=function(){return La[this.zLevel]};var Ve;wa.die=function(a){if(!this.death){var b=D,d=this.id,c=this.kingdom,f=I[c];this.waitlist&&(f.unitLoading-=.5*this.waitlist.length);if(this.dieSound&&!r.editor){var h=this.dieSound;ma(h[~~(h.length*Math.random())],this.x32,this.y32)}Dd(this.id);(this.freezed||this.invisible)&&Zb(this);var l=this.x32,g=this.y32;this.death=1;1==this.zLevel&&
(Ve[l+g*b]=1);this.c=void 0;var n=this.url.die||this.dimg;gi(this);f.IA&&f.IA.valorateLost&&f.IA.valorateLost(this);if(this.food&&!r.editor){var m=100,q=this.food/m,t=~~q,u=~~((q-t)*m);for(h=0;h<q;h++){h==t&&u&&(m=u);var v=ki(l,g),w=~~(v/b);v%=b;v=new hc(52,c,v,w,0);ObjectsetupIMG(v,k.item_meat);v.contain=[m,2,rk]}}f.stats.unitCountDeath[this.type]++;h=this.x32;b=this.y32;a||r.editor?(wb(this),$b.put(this.bufferID)):n?(this.mv=!0,ObjectsetupIMG(this,n,1),a=ra[this.img],n=a[1],n=0>n?Ji(a):1E3*a[0]/
n,ya({func:Ii,data:this.id},n-25,1),ObjectsetupPhysics(this,0,0,0),void 0!==this.dix&&(a=.001*(r.now()-this.timestamp),this.x32+=this.dix*a/32-Math.sign(this.dix),this.y32+=this.diy*a/32-Math.sign(this.diy))):this.dimgInfinity?(this.dimgRND&&(this.d=this.id%this.dimgRND),ObjectsetupIMG(this,this.dimgInfinity)):(wb(this),$b.put(this.bufferID));this.techStart&&ue(0,[this.id]);ObjectsetupPosition(this,32*this.y32-36);this.x32=h;this.y32=b;this.build||f.values.pop--;this.population&&this.built&&(f.values.popMax-=
this.population);g=this.validator(l,g,this.space,this.kingdom);a=g[0];if(this.onbuild&&!r.editor)for(l=this.onbuild,n=f.technology,h=n.disabled,n=n.actived,b=0;b<l.length;b++)c=l[b].id,n[c]--,0===n[c]&&h[c]++;l=this.validator.dimension;h=0;for(n=a.length;h<n;h++)b=a[h],l[b]=Ob[b]?Ob[b]:0;if(1==this.health&&!this.built)for(b=ub[this.kingdom],h=0,n=a.length;h<n;b[a[h++]]=void 0);if(g[2])for(a=g[2],h=0,n=a.length;h<n;h++)b=a[h],Ob[b]?(2<l[b]&&z[l[b]].die(1),l[b]=Ob[b]):(2<l[b]&&z[l[b]].die(),l[b]=0);
hb[this.kingdom][this.type].quit(this.id);if(this.workers){h=0;l=this.workers.slice(0);for(n=l.length;h<n;h++)g=z[l[h]],g.workingOn===d&&(g.workingOn=0,g.func!==tg.url&&g.stay());this.workers.length=0}this.deleteFromList&&(l=this.deleteFromList,l.quit(this),l.length||l.length0function(this));this.func=this.time=void 0;this.diy=this.dix=0;this.inventory&&0<this.inventory.length&&Zc(this.id,this.inventory.slice(0));this.stock&&ji(this);r.editor||(f.check(),yd(this.kingdom),f.checkPopArray());this.deleteWorker()}};
Array.prototype.quit=function(a){a=this.indexOf(a);return-1<a?(this.splice(a,1),!0):!1};Array.prototype.add=function(a){0>this.indexOf(a)&&(this[this.length]=a)};var Oa=["European","Arab","Asian"];A={open:"Open",loading:"Loading...",systemAlert:"System Message",notEnough:"Not enough %s",ok:"OK",yes:"Yes",no:"No",secure:"Are you sure?",gold:"Gold",stone:"Stone",wood:"Wood",food:"Food",mana:"Manna",warning:"Warning",play:"PLAY",close:"CLOSE",gameClosed:"The game was canceled by the server.",loadgraphics:"Downloading graphics...",
waitImages:"Downloading graphics",wait:"Wait",audioproblem:"Your browser is not compatible with Web Audio",defeated:"DEFEATED",victorious:"VICTORIOUS",options:"OPTIONS",refresh:"Refresh",back:"BACK",paused:"PAUSED",chatMsg:"CHAT MESSAGE",disconnect:"Disconnect",playerDisconnected:"%s has disconnected!",connectionError:"Connection error",noP2P:"Engine not loaded",startingResources:"Starting Resources",mapSize:"Map Size",menu:"MENU",quit:"QUIT",continue:"Continue",backToGame:"BACK TO GAME",initializing:"Initializing...",
requires:"Requires",stop:"Stop",pickItems:"Pick items",move:"Move",stand:"Stand ground",explore:"Explore",patrol:"Patrol",guard:"Guard",extension:"Do you want download 'Tzared boost' extension?",errorLoading:"Error loading game.",waitingPlayers:"Waiting for players to connect",musicVolume:"Music Volume",soundVolume:"Sound Volume",common:"Common",popLimit:"Population limit reached",houseLimit:"Not enough houses",lightning:"Lightning",freeze:"Freeze",bless:"Bless",heal:"Heal",invisibility:"Invisibility",
dcm:"Dig, chop or mine",repair:"Repair building",menuBuild:"See what you can build",units:"Units",infinite:"Infinite",gameFull:"Sorry, the game is full.",terrainOption:"Terrain",playerDefeated:"%s has been defeated!",savegame:"SAVE GAME",loadRecord:"Recording",stats:"Stats",builds:"Builds",items:"Items",nature:"Nature",trees:"Trees",delete:"Delete",create:"Create",username:"Player Name",gameOptions:"GAME OPTIONS",nplayers:"Number of Players",gameName:"Enter Game Name",gamesFound:"Games Found",strSearch:"SEARCH| Search for existing games",
strCreate:"CREATE| Create a game",randomMap:"RANDOM MAP",strcusMap:"CUSTOM MAP",mapMaking:"Map Making",terrain:"Terrain",save:"SAVE",accept:"ACCEPT",team:"Team",color:"Colour",AI:"AI Assist",kingdom:"Kingdom",attack:"Attack",defence:"Defence",health:"Health",maxHealth:"Max health",playing:"Playing",waiting:"Waiting",joining:"Joining..."};var bi={euro:"Lancelot Arthur Guivain Merlin Blackthorn Morin Golstuck Karambol Kelerick Rockmore Bridport Casevil Stirm Tonis Pelegrim Peresohn Pirk Pharn Gork".split(" "),
arab:"Ibn Fadlan;Mohammad;Al Ferissa;Harun Al Rashid;Sindbad;Mellemad;Moarrac;Sakhavan;Bellefars;Mokhac;Norahz;Kerhetin;Maham;Dushesh;Direkh".split(";"),asia:"Ishida Toranaga Ichinzen Haiako Mozuki Hitachi Tosheba Harachiko Marasuma Korodzum Ishinghen Genghis Musa Echibo Ichikahr Yotokan Maraga".split(" "),common:"Fistantilus Skenderbeg Raislin Tenis Morok Sokob Baras Haram Billihz Ynte Orgh Savael Birgos Savator Gandeh Gordor Fessh Gilmi Phergas".split(" ")},Wg=[A.gold,A.wood,A.food,A.stone,A.mana],
dd=function(a,b,d){d&&(a=a.replace("%d",d));return a.replace("%s",b)},fd={},lj=Pg,uj=function(f){f--;var b=new XMLHttpRequest;b.open("GET","https://dl.dropboxusercontent.com/s/ssnjwy6sm462q89/dictionary.json?v1=1",!0);b.setRequestHeader("Content-type"," text / plain; charset = dropbox - cors - hack");b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var d=JSON.parse(b.response);lj=function(){for(var a=x,b=0;b<a.length;b++){var c=a[b].name;d[c]&&(a[b].name=d[c][f])}for(b=0;b<B.length;b++)a=
B[b],d[a.name[0]]&&d[a.name[1]]&&(a.name[0]=d[a.name[0]][f],a.name[1]=d[a.name[1]][f]);d=null};for(var c=[],e=0;0>e;e++)"undefined"!=typeof a[e]&&null!=a[e].tech&&(c.push(a[e].tech.name),Object.freeze(a[e].tech));for(e=0;e<c.length;e++)c[e][0]=d[c[e][0]][f],c[e][1]=d[c[e][1]][f];c=Object.keys(A);for(e=0;e<c.length;e++){var h=c[e];void 0!=d[A[h]]&&(A[h]=d[A[h]][f])}Object.freeze(A);for(e=0;e<Oa.length;e++)Oa[e]=d[Oa[e]][f];for(e=0;e<0*Wg.length;e++)Wg[e]=d[Wg[e]][f];Object.freeze(Oa);tj()}};b.send()};
0<t.lang&&(uj(t.lang),uj.translated=!0);var tj=function(){for(var a=["refreshButton",A.refresh,"optionsButton",A.options,"startButton",A.play,"backButton",A.back,"closeButton",A.close,"quitButton",A.quit,"continueButton",A.continue],b=0,d=a.length;b<d;b+=2)for(var c=document.getElementsByClassName(a[b]),e=0,h=c.length;e<h;e++)c[e].innerHTML=a[b+1];a=["alertok",A.ok,"sendMessageH2",A.chatMsg,"mapsizeOption",A.mapSize,"startingResourcesOption",A.startingResources,"goldWord",A.gold,"stoneWord",A.stone,
"foodWord",A.food,"woodWord",A.wood,"gameMenu",A.menu,"infiniteWord",A.infinite,"backToGame",A.backToGame,"backToGameS",A.backToGame,"musicVolume",A.musicVolume,"soundVolume",A.soundVolume,"menueditor",A.menu,"terrainOption",A.terrainOption,"saveGame",A.savegame,"playrecord",A.loadRecord,"seeStats",A.stats,"selectBuilds",A.builds,"selectUnits",A.units,"selectItems",A.items,"selectNature",A.nature,"gamesFound",A.gamesFound,"strSearch",A.strSearch.split("| ")[1],"strCreate",A.strCreate.split("| ")[1],
"strRandomMap",A.randomMap,"strcusMap",A.strcusMap,"strMapEditor",A.mapMaking,"h2cusmap",A.strcusMap,"h2rndMap",A.randomMap,"mapProps",A.options];b=0;for(d=a.length;b<d;b+=2)document.getElementById(a[b]).innerHTML=a[b+1]};tj();var Xg,Eb={},lc,Kf=function(){for(var a="mapx mapwidth goldRes goldValue woodRes woodValue foodRes foodValue stoneRes stoneValue infinity infiniteValue".split(" "),b=0,d=a.length;b<d;b+=2){var c=document.getElementById(a[b+1]).value;M(c);"infinity"==a[b]?(c=document.getElementById(a[b+
1]).checked,r[a[b]]=c):r[a[b]]=parseInt(c)}r.infinity&&(r.goldRes=Infinity,r.foodRes=Infinity,r.woodRes=Infinity,r.stoneRes=Infinity);r.mapy=r.mapx;r.gravity=parseFloat(document.getElementById("mapgravity").value)*(580.9/9.8);r.name="";r.arje=555555*Math.random()+1;M(r.arje,"arje")},Qj=function(){r.online&&(vj(A.initializing),r.editor=0);r.mapx||Kf();r.pausedTime=0;r.canceled=0;for(var f=Object.keys(a),b=I.length,d=0,c=f.length;d<c;d++){var e=a[f[d]];e.id=d;if(e.disabled)for(var h=0;h<b;I[h++].technology.disabled[d]=
e.disabled);if(e.hidden)for(h=0;h<b;I[h++].technology.hidden[d]=1);}var l=performance.now();cc=document.getElementById("msgs1");r.online||(location.hash="");Td("playermenu");Td("index");Ud("menu");Ud("statButton");Td("mapeditorinfo");Td("mapeditorinfotop");Ud("resources");qb=I[t.kingdom];Be(t.kingdom);Xg||(Xg=JSON.parse(JSON.stringify(I.slice(1))));setTimeout(function(){r.cycle?r.deltaTime=25*r.cycle:(r.players=I.length-1,r.date=Date.now(),r.cycle=0,r.kingdoms=I,r.deltaTime=0);r.loadDate=Date.now();
r.online||Si();r.now=Th;r.paused=0;r.pausedTime=0;r.zMax=96*r.mapy;$a();performance.now();r.allow14=!0;D=r.mapx;xa=r.mapy;r.temperature=25;var b=r.temperature;0==t.temperature&&(b+="&deg;C");document.getElementById("temperature").innerHTML=b;da=1;Xk();Qd();Ve={};var c=D;b=-c;c=+c;Ea=[1,1+b,b,-1+b,-1,-1+c,c,c+1];Uh=[b,-1,1,c];r.online&&(document.getElementById("content").style.display="block");b=["chat","loading","playermenu","index"];c=b.length;for(var d=0;d<c;document.getElementById(b[d++]).style.display=
"none");v("loadingtext").innerHTML="Loading terrain";b=performance.now();if(r.terrain)lc=new Int8Array(r.terrain);else{c=performance.now();var f=D,e=f*xa,h=Math.sqrt(e),x,B,C=0,N,J;d=new Int8Array(new ArrayBuffer(e));var K=new Uint32Array([2,3,0,1,1,1,0,1,0,1,0,1,1,1,1,0,0,15,0,1]);for(wk(r.arje);C<e;d[C++]=0);var O=K.length;for(C=0;C<O;C+=4)K[C+3]&&(K[C+1]=~~(h/K[C+1]));for(N=0;N<O;N+=4){var L=K[N+1];var H=K[N];var P=K[N+2];for(C=0;C<L;C++){var W=~~(ka()*e+.5);var R=6*ka()-3;var X=6*ka()-3;if(P){var T=
ka()*h;var Z=~~(ka()*(h/15))+4;var Y=~~(100*ka())/4;var aa=Z/12}else T=128*ka(),Z=~~(2.56*ka())+4,Y=~~(100*ka())/2,aa=1;var ba=W%f;W=~~(W/f);for(J=0;J<T;J++)for(100*ka()>Y&&(R=(6*ka()-3)*aa,X=(6*ka()-3)*aa),ba+=R,W+=X,x=0;x<Z;x++)for(B=0;B<Z;B++)if((x-Z/2)*(x-Z/2)+(B-Z/2)*(B-Z/2)<Z*Z/4){var ia=~~ba+x+(B+~~W)*f;ia>=e?ia%=e:0>ia&&(ia+=e);d[ia]=H}}}f=performance.now();M("randomtxt1",f-c);M("drawTerrain: ",performance.now()-f);lc=d}Eb.randomtxt=performance.now()-b;M("randomtxt: ",Eb.randomtxt);b=performance.now();
v("loadingtext").innerHTML="Creating map";c=D*xa*4;V=new Uint32Array(c);za=new Uint32Array(c);Kc=new Uint32Array(c);Q.dimension=V;Sd.dimension=za;jj.dimension=V;kj.dimension=za;S.dimension=V;rf.dimension=Kc;Db.dimension=za;qf.dimension=V;La[0]=za;La[1]=V;La[2]=Kc;Eb.createMap=performance.now()-b;M("createMap: ",Eb.createMap);v("content").style.display="block";b=performance.now();M(r.allunits);if(r.allunits)F=r.allunits;else{c=lc;d=r.mapx;P=r.mapy;f=performance.now();R=d*P;N=Math.sqrt(R);F=[];gd={};
X=Yk;L=Zk;e=gd;h=$k;Y=[12,63,62];ba=[];C=I.length;for(T=1;T<C;T++){K=!0;H=I[T];W=Y[H.race];for(x=0;K&&25>x;){x++;aa=~~(ka()*(d-15)+.5)+4;Z=~~(ka()*(P-15)+.5)+4;K=!1;O=ba.length;for(H=0;H<O;H+=2)60>Math.sqrt((aa-ba[H])*(aa-ba[H])+(Z-ba[H+1])*(Z-ba[H+1]))&&(K=!0);K||(ba.push(aa+4,Z+3),X(aa+Z*d,{type:W,kingdom:T}))}if(25==x){I.length=T;break}}Y=2*(C-1);C=1*~~(N/3.2);for(T=0;T<C;T++)for(K=~~(ka()*d+.5),O=~~(ka()*P+.5),W=~~(25*ka())+10,x=~~(25*ka())+10,H=0;55>H;H++)aa=~~(ka()*W+~~(K+18*ka()-9)+.5),Z=~~(ka()*
x+~~(O+18*ka()-9)+.5),aa+=Z*d,L(aa)&&aa<=R&&X(aa,{type:7,d:~~(28*ka()+3)});C=40*~~(N/256);for(T=0;T<C;T++){aa=~~(ka()*R+.5);P=Sg[~~(ka()*Sg.length)];H=Object.assign({},P);H.d+=~~(P.dMax*ka());if(P.sword||P.potion)H.attack=~~(6*ka())+1;if(P.shield||P.potion)H.defence=~~(6*ka())+1;P.book&&(P=~~(ka()*tf.length),H.spell=tf[P],H.iconID=a[tf[P]].iconIDbook,H.name=A[H.spell],H.attack=~~(6*ka())+1);X(aa,H)}C=3*~~(N/256);for(T=0;T<C;T++)aa=~~(ka()*R),L(aa)&&X(aa,{type:43});P=!!r.infinity;for(H=0;H<Y*(1-P);H+=
2)L=2*Math.round(ka())-1,T=ba[H]+10*(2*Math.round(ka())-1)+~~(3*ka()),N=ba[H+1]+10*L+~~(3*ka()),C=ba[H]+10*(2*Math.round(ka())-1)+~~(3*ka()),L=ba[H+1]+10*-L+~~(3*ka()),0>T?T=0:T+4>D&&(T-=(T+4)%R),0>N?N=0:N+4>xa&&(N-=(N+4)%R),0>C?C=0:C+4>D&&(C-=(C+4)%R),0>L?L=0:L+4>xa&&(L-=(L+4)%R),X(T+N*d,{type:21}),X(C+L*d,{type:22});for(H=0;H<Y;H+=2)for(T=ba[H]-25,N=ba[H+1]-25,C=0;50>C;C++)for(L=0;50>L;L++)625>(C-25)*(C-25)+(L-25)*(L-25)&&(R=C+T+(L+N)*d,7===h(R).type&&(e[R].cancell=1),1===Sb.type[c[R]]&&(c[R]=0));
M("random:",performance.now()-f);Eb.random=performance.now()-f}r.movtable&&!r.demo&&(wc=r.movtable,yc=r.movtable2);c=performance.now();v("loadingtext").innerHTML="Loading textures";Mj(lc);Eb.setupGL=performance.now()-c;M("setupGL: ",Eb.setupGL);c=performance.now();f=lc;e=Sb.type;h=D*xa;for(d=0;d<h;d++)e[f[d]]?(za[d]=1,V[d]=1,Ob[d]=1):0>f[d]&&(Ob[d]=2,za[d]=2,V[d]=2);f=F;r.custom||(r.ini=f);r.demo&&(f=r.ini);d=0;for(e=f.length;d<e;d++)Y=f[d],Y.death?z.put(Y):Y.cancell||(h=Y.x32,ba=Y.y32,R=!1===Y.built&&
1===Y.health?!0:!1,X=Y.kingdom||0,Y=new hc(Y.type,X,h,ba,0,R,Y),R||mi(Y),Y.castle&&(I[X].origin=[h+4,ba+3]));gd=F=null;M("positioned:",performance.now()-c);Eb.positioned=performance.now()-c;Eb.setupGL=performance.now()-b;M("setupGL: ",Eb.setupGL);Ra(Wa);Ra(G);yd(t.kingdom);Mi();b=I[t.kingdom].origin;od(~~(32*b[0]-.5*(window.innerWidth-t.mx)),~~(32*b[1]-.5*window.innerHeight));window.addEventListener("keydown",Yi);window.addEventListener("keyup",Zi);window.addEventListener("mousemove",$i);U=ib;ha=
new Float32Array(12);b=ra[k.blank].id;w[0]=b;w[1]=0;w[2]=1;w[3]=0;w[4]=b;w[5]=0;w[6]=1;w[7]=0;w[8]=b;w[9]=0;w[10]=1;w[11]=0;w[12]=b;w[13]=0;w[14]=1;w[15]=0;b=ca;b[0]=0;b[1]=1;b[2]=2;b[3]=1;b[4]=2;b[5]=3;g.bindBuffer(g.ARRAY_BUFFER,Rc);g.bufferSubData(g.ARRAY_BUFFER,0,w);g.bindBuffer(g.ARRAY_BUFFER,Xa);d=3*t.kingdom;b=ua[d];c=ua[d+1];d=ua[d+2];g.bufferSubData(g.ARRAY_BUFFER,0,new Float32Array([b,c,d,.5,b,c,d,.5,b,c,d,.5,b,c,d,.5]));b=96*D;ha[2]=b;ha[5]=b;ha[8]=b;ha[11]=b;window.addEventListener("mousedown",
aj);window.addEventListener("mouseup",bj);M("FULL: ",performance.now()-l);r.record||(r.record={});r.online?(rc(Vd(),A.waitingPlayers,1),t.admin?Mc():ea(Mc,0,0)):uf();r.allow14=!1;Lc.list.push(0,JSON.stringify(Eb))},300)},Vd=function(){for(var a=P.length,b=P,d="",c=0;c<a;c++)Vd.obj[b[c].id]||b[c].id==t.onlineID||(d+="<br>"+b[c].name);return d};Vd.obj={};var rh=function(){return t.gl?!1:(rc("You can't run WEBGL 2<br>More info <a href='http://webglreport.com/?v=2'>here</a>","Error"),Kb(),!0)},Jf=!1,
Mi=function(){var a=document.getElementById("playersinfo");a.innerHTML="";if(!r.editor)for(var b=1,d=I.length;b<d;b++){var c=I[b];M(c);var e=c.death?c.name.strike():c.name;a.innerHTML+=e+"<span id='score"+b+"'> 0/0</span><div class='playercolor' style='background:rgb("+c.color[0]+","+c.color[1]+","+c.color[2]+")'></div><br>"}},Pd,fj,Vi,Xk=function(){var a=document.getElementById("selectedobject").getContext("webgl",{antialias:!1,depth:!1}),b=a.createShader(a.VERTEX_SHADER);a.shaderSource(b,"void main() {\ngl_Position = vec4(0 ,0, 0, 1);\ngl_PointSize=48.0;\n}");
a.compileShader(b);var d=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(d,"precision mediump float;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nuniform float txtCoord;\nvoid main() {\ngl_FragColor = texture2D(u_image, (vec2(\tmod(txtCoord,21.0) ,floor(txtCoord/21.0) ) + gl_PointCoord)*(0.046875));\nif(gl_FragColor.r==gl_FragColor.g&&gl_FragColor.r==gl_FragColor.b) gl_FragColor*=u_color;\n}");a.compileShader(d);var c=a.createProgram();a.attachShader(c,b);a.attachShader(c,d);a.linkProgram(c);
a.useProgram(c);b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texImage2D(a.TEXTURE_2D,0,a.RGB,a.RGB,a.UNSIGNED_BYTE,X.icons);var e=a.getUniformLocation(c,"u_color"),h=a.getUniformLocation(c,"txtCoord");Pd=function(b){if(ra[b.img][3]){var c=b.kingdom;a.uniform4f(e,
ua[3*c],ua[3*c+1],ua[3*c+2],1)}else a.uniform4f(e,1,1,1,1);a.uniform1f(h,b.iconID);a.drawArrays(a.POINTS,0,1)};fj=function(){a.uniform4f(e,1,1,1,1);a.uniform1f(h,189);a.drawArrays(a.POINTS,0,1)};Vi=function(){a.uniform1f(h,0);a.uniform4f(e,0,0,0,0);a.drawArrays(a.POINTS,0,1)}},Hb=128,Ya=128,z=[{terrain:1},{terrain:1},{terrain:1}],Ob={},yd=function(a){a===t.kingdom&&(a=qb.values.popMax<qb.values.popLimit?qb.values.popMax:qb.values.popLimit,document.getElementById("pop").innerHTML=qb.values.pop+"/"+
a)};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();var gd=F=void 0;var Yk=function(a,b){gd[a]||(b.x32=a%D,b.y32=~~(a/xa),F.put(b),gd[a]=b)},Zk=function(a){return!F[a]},$k=function(a){return gd[a]||NaN},va=[],Yg=function(){M("123");Da.leaveRoom();va.length=0},hd={};(function(){for(var a=["returnmenu","index","Account","accountIframe"],b=0,d=a.length;b<d;hd[a[b]]=
document.getElementById(a[b++]));})();var al=function(){location.replace("#"+this.gameID+"Room")},xh=function(a){va=[];M("connecting to",a,A.loading);v("game").style.display="block";v("gameName").innerHTML=A.loading;v("returnmenu").style.display="none";v("index").style.display="none";mc.innerHTML="";cc.innerHTML="";t.p2p?Da.joinRoom(a,Mf):(Da||Vb(),Vb.func=function(){xh(a)})},bl=function(a){v("game").style.display="none";P.length=0;r.online=0;Yg();Kb();a.constructor==String&&rc(a)},Li={euro:0,arab:0,
asia:0},uh=function(a,b,d){if(d){b=Zg(d.id);var c=b[1];b=b[0];a=ab(a);b.username||(wj[c].innerHTML=a,b.name=a,d.username=a,vj(A.joining,a,1E3))}},jb=function(a,b){if(b.resend)if(a.destinatary)(b=Nc(a.destinatary))&&b.id!=t.onlineID&&(a.bridge=h.id,b.send(a));else{b=b.resend;for(var d=0,c=b.length;d<c;d++){var f=b[d];a.bridge=h.id;f.send(a)}}else{var h=b;a.bridge&&(h=Nc(a.bridge));if(void 0===a.length){if(void 0!==a.func)(0,pe[a.func])(a[1],a[2],h)}else b=a[0],h.orderList[b]=a,jb.done[b]||(jb.done[b]=
0),jb.done[b]++,jb.done[b]==va.length&&jb.func&&(jb.func=!1,hg(),$a())}};jb.done=[];var Oc=function(a,b,d){d&&(M(d.id,"CAN connect"),Oc.ids[a]||(Oc.ids[a]=1,t.admin||clearTimeout(Oc.intv[a]),M("MAKE BRIDGE"),Nc(a).bridge=d,ea(xj,a,0,[d],0)))};Oc.ids={};Oc.intv={};var xj=function(a,b,d){d&&(M("BRIDGE"),d.resend||(d.resend=[]),d.resend.put(Nc(a)))},Nc=function(a){for(var b=0,d=va.length;b<d;b++){var c=va[b];if(c.id==a)return c}},Da,cl=function(){t.name=ab(v("usernameVal").value);t.color=v("usernameColor").value;
localStorage.color=t.color;localStorage.username=t.name;document.body.removeChild(v("usernameForm"));Vb();kb()},Vb=function(){if(!rh())if("Guest"!==t.name&&t.name)Da=new SimpleWebRTC({localVideoEl:"",remoteVideosEl:"",autoRequestMedia:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},url:"https://solar.tza.red/"}),Da.on("channelMessage",function(a,b,d){"nehhof"==d.type&&(b=JSON.parse(d.payload),jb(b,a))}),Da.on("error",function(a){"full"==a&&(Kb(),Fh(A.gameFull,"#ff0000"))}),Da.on("connectionReady",
function(a){var b=Da.connection.connection;t.p2p=b;b.username=t.name;b.color=t.color;b.on("getRooms",function(a){var b=Object.keys(a),c=v("gameList");if(0<b.length){c.innerHTML="";for(var d=0,f=b.length;d<f;d++){var e=b[d],h=a[e],g=h.len;if(g){var k=document.createElement("tr"),r="";r=h.playing?r+("<td><div class='redCircle'></div>"+A.playing+"</td>"):r+("<td><div class='redCircle' style=\"background:rgba(0,255,0,.8)\"></div>"+A.waiting+"</td></td>");r+="<td>"+ab(h.description)+"</td><td>"+~~((Date.now()-
h.date)/6E4)+" min ago</td><td>"+ab(g)+"/"+ab(h.max)+"</td>";k.innerHTML=r;k.gameID=e;h.playing||(k.onclick=al);c.appendChild(k)}}}else c.innerHTML="<tr><td>No games found</td></tr>"});t.onlineID=a;Vb.func&&Vb.func()}),Da.on("createdPeer",function(a){r.started||Rj(a)});else if(!v("usernameForm")){Vc();var a=localStorage.username||"",b=localStorage.color||"#"+Math.floor(16777215*Math.random()).toString(16),d=document.createElement("div");d.id="usernameForm";d.innerHTML="\n            <div>\n            <h2>"+
A.username+'</h2>\n            <div>\n<input type="color" id=\'usernameColor\' value="'+b+'" /><input id=\'usernameVal\' type="text" value="'+a+'" />\n</div>\n<br />\n</div>';a=document.createElement("button");a.innerHTML=A.continue;a.onclick=cl;d.children[0].appendChild(a);document.body.appendChild(d)}},dl=function(){kb();v("game").style.display="block";v("gameName").innerHTML=A.loading;v("returnmenu").style.display="none";v("index").style.display="none";mc.innerHTML="";cc.innerHTML="";va=[];vh();
t.admin=1;t.room={description:v("gameFormName").value,max:parseInt(v("gameMax").value),public:!0};2>t.room.max&&(t.room.max=2);14<t.room.max&&(t.room.max=14);localStorage.gameDescription=t.room.description;Da.createRoom(t.onlineID+"b",Mf);r.online=1;document.body.removeChild(v("gameForm"))},yj=function(){Da||Vb();if(t.onlineID){Vc();var a=localStorage.gameDescription||t.name+"'s room",b=document.createElement("div");b.id="gameForm";b.innerHTML="\n<div>\n            <h2>"+A.gameOptions+"</h2>\n            "+
A.gameName+': <input id=\'gameFormName\' type="text" value="'+a+'" maxlength="29" /><br />\n'+A.nplayers+': <input id="gameMax" type="number" value="6" max="14" min="2"/><br />\n            </div>';a=document.createElement("button");a.innerHTML=A.continue;a.onclick=dl;b.children[0].appendChild(a);document.body.appendChild(b)}else setTimeout(function(){location.hash=""},200),Vb.func=yj},$g=function(a,b){b=JSON.stringify(b);a.sendDirectly("channelMessage","nehhof",b)},Wd=[],ea=function(a,b,d,c,e){if(!0===
e&&r.online&&va.length)d.change&&(d=d.slice(0)),Ka(function(){ea(a,b,d,c,55)});else if(void 0===a.location)a();else{if(r.started&&!r.editor){var f=r.record;f[r.cycle]||(f[r.cycle]=[]);var l=f[r.cycle];f=l.length;l[f]=a.location;l[f+1]=b;d.length&&(d=d.slice(0));l[f+2]=d}if(r.online&&va.length){if(55===e)var g=!1;var k={func:a.location,1:b,2:d,active:g,rnd:4294967296*Math.random()};if(a==$a||a==uf){g=Ka.max;k.active=!1;f=0;for(e=va.length;f<e;f++)l=va[f],l.bridge||setTimeout(function(a){$g(a,k)},g-
l.ping,l);setTimeout(function(){a(b,d)},g)}else if(r.started)if(c)for(f=0,e=c.length;f<e;f++)l=c[f],k.destinatary=l.id,l.bridge?$g(l.bridge,k):$g(l,k);else Wd.put(k);else ah(k),a(b,d)}else a(b,d)}},el=function(){if(va.length){Kf();Mc.i=0;t.p2p.emit("gameStarted");for(var a={},b=0,d=P.length;b<d;b++)a[P[b].id]=b;ea(bh,r,a,0,0)}},Mc=function(a,b,d){d&&(Vd.obj[d.id]=1,a=Vd(),""==a?rc(a,A.loading,1):rc(a,A.waitingPlayers,1));t.admin&&(Mc.i++,Mc.i==P.length&&setTimeout(function(){ea(uf,0,0,0,!0)},100))};
Mc.i=0;var ah=function(a){a=JSON.stringify(a);for(var b=0,d=va.length;b<d;b++)va[b].sendDirectly("channelMessage","nehhof",a)},Pc,ch,hg=function(){if(!jb.done[Pc]||jb.done[Pc]<va.length)return jb.func=!0,$a(),!0;for(var a=0,b=P.length;a<b;a++){var d=Nc(P[a].id);if(a==t.kingdom-1)var c=ch;else{if(!d)continue;c=d.orderList[Pc]}for(var e=1,h=c.length;e<h;e++){var l=c[e];pe[l.func](l[1],l[2],d)}}jb.func=!1;ah(Wd);ch=Wd;Pc++;Wd=[Pc+1];return!1},uf=function(){document.getElementById("alert").style.display=
"none";r.started=1;r.date=Date.now();$a();Ia();kb();Pc=0;if(!r.custom||r.demo)for(var a=1,b=I.length;a<b;a++){var d=lb[Fg[I[a].race]],c=d.peasant.type;if(d=z[hb[a][d.castle.type][0]])Ac(c,d,1),Ac(c,d,1),Ac(c,d,1)}sb.arr=[];sb.units=[];sb.time=500;sb.steps=0;sb.process=0;if(!r.editor&&!r.demo){for(a=1;a<I.length;a++)I[a].IA&&Infinity==r.goldRes&&new sb(I[a]);a=0;b=sb.arr;for(c=b.length;a<c;b[a++].leaveMeAloneIKnowWhatToDo());cg()}r.online&&(ah([0]),Wd=[1],ch=[0]);db()},bh=function(a,b,d){if(d&&d.admin){d=
[P[0]];for(var c=0,e=P.length;c<e;c++)d[b[P[c].id]]=P[c];P=d}ma("bless");r=a;r.infinity&&(r.goldRes=Infinity,r.woodRes=Infinity,r.foodRes=Infinity,r.stoneRes=Infinity);Uc()},nd=!1,kb=function(){nd=!1;v("basic").style.filter="blur(0px)";setTimeout(function(){"blur(0px)"==v("basic").style.filter&&(v("basic").style.filter="")},500)},Vc=function(){nd=!0;v("basic").style.filter="blur(94px)"};var Ui=function(){Ud("game");P.length=0;r.online=0;Yg();Kb();t.admin=0};var Mf=function(a){if(t.admin||a)if(a=Da.roomName,
a+="Room",M("login"),kb(),0!==Da.getPeers().length||t.admin){var b=t.room||NaN;M(a);r.id=a;r.online=1;vh();Ud("chat");v("gameName").innerHTML=ab(b.description)||"Online Game";v("onlineID").value=location.origin+"/#"+r.id;Td("returnmenu");Lf();t.admin?(location.replace("#"+r.id),v("buttons").innerHTML='<button id="startbutton">'+A.play+'</button><button id="optionbutton">'+A.options+'</button><button id="closebutton">'+A.close+"</button>",v("startbutton").onclick=el,v("optionbutton").onclick=zj,v("closebutton").onclick=
Ui):(v("buttons").innerHTML='<button id="quitbutton">'+A.disconnect+"</button>",v("quitbutton").onclick=bl);Da.connection.on("remove",function(a){if(a=Nc(a.id))if(Ab(dd(A.playerDisconnected,a.username),0,5),r.online){if(r.started)for(var b=0;b<P.length;b++)if(P[b].id==a.id){I[b+1].die();break}va.quit(a);r.started?jb.done[Pc]==va.length&&jb.func&&(jb.func=!1,hg(),$a()):(Lf(),a.admin&&(Kb(),Da.leaveRoom(),rc(A.gameClosed)))}})}else location.hash="",Kb()},Ka=function(a){Ka.func.put(a);0===Ka.active&&
(ea(Aj,0,0,0,0),Ka.date=Date.now(),Ka.received=0,Ka.max=-Infinity,Ka.active=1)};Ka.func=[];Ka.active=0;var Aj=function(a,b,d){d&&ea(Bj,0,0,[d],0)},dh={},Bj=function(a,b,d){if(d&&(d.ping=~~(.5*(Date.now()-Ka.date)+.5),dh[d.id]?dh[d.id].put(d.ping):dh[d.id]=[d.ping],d.ping>Ka.max&&(Ka.max=d.ping),Ka.received++,Ka.received==va.length)){a=performance.now();b=0;for(d=Ka.func.length;b<d;Ka.func[b++]());M(-a+performance.now());Ka.func.length=0;Ka.active=0}},eh=document.getElementsByClassName("ucolor"),wj=
document.getElementsByClassName("username"),fh=document.getElementsByClassName("race"),vf=document.getElementsByClassName("team"),Ub=document.getElementsByClassName("isconnected"),Pf=function(a,b,d){d&&(b=Zg(d.id),d=b[1],b=b[0],b.race=a%3,b.race||(b.race=0),fh[d].innerHTML=Oa[b.race])},Zg=function(a){for(var b=0,d=P.length;b<d;b++){var c=P[b];if(c.id==a)return[c,b]}},Nf=function(a,b,d){if(d){M(a);b=a.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);b||(a="ffffff",b=["ffffff","ff","ff","ff"]);d.color=
a;d=Zg(d.id);var c=d[1];d=d[0];eh[c].style.background=a;d.color=[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]}},Of=function(a,b,d){a=parseInt(a);if(isNaN(a)||!a)a=0;(a%=5)||(a=0);if(d){b=d.id;d=0;for(var c=P.length;d<c;d++){var e=P[d];if(e.id==b){e.team=a;vf[d].innerHTML=a;break}}}},Lf=function(){M("setup MENU");var a=document.getElementById("multiplayertable");a.innerHTML="";for(var b=t.room?t.room.max:14,d=0;d<b;d++)a.innerHTML+='<tr><td class="ucolor"></td><td class="username">'+A.open+
'</td><td class="race"></td><td class="team"></td><td class="isconnected"></td></tr>';a=Da.roomName;a=a.substr(0,a.length-1);var c=[t.p2p];d=0;for(b=va.length;d<b;d++){var e=va[d];e.admin?c.unshift(e):c.put(e)}for(b=0;b<c.length;b++){d=c[b];if(P[b]&&P[b].id==d.id)e=P[b];else{e=d.color||"ffffff";var h=parseInt(e.substr(1),16),l=h>>16&255,g=h>>8&255;h&=255;M(l,g,h,e);e={color:[l,g,h],ia:0,name:d.username,race:0,team:1,id:d.id,cID:b}}d&&d.id?(Ub[b].style.background="#00ff00",Ub[b].style.boxShadow="0px 0px 30px 0px #00ff00"):
(Ub[b].style.background="#ff0000",Ub[b].style.boxShadow="0px 0px 30px 0px #ff0000");eh[b].style.background="rgb("+e.color[0]+","+e.color[1]+","+e.color[2]+")";wj[b].innerHTML=e.name;e.id==a&&(d.admin=!0);t.onlineID==e.id?(vf[b].innerHTML="",d=document.createElement("button"),d.onmousedown=Cj,d.iteam=b,d.innerHTML=e.team,vf[b].appendChild(d),d=document.createElement("button"),d.onmousedown=Dj,d.iteam=b,d.innerHTML=Oa[e.race],fh[b].appendChild(d),d=document.createElement("input"),d.type="color",l=e.color,
d.iteam=b,d.value="#"+(16777216+(l[0]<<16)+(l[1]<<8)+l[2]).toString(16).slice(1),eh[b].appendChild(d),d.onchange=Ej,Ub[b].style.background="#00ff00",Ub[b].style.boxShadow="0px 0px 30px 0px #00ff00"):(vf[b].innerHTML=e.team,fh[b].innerHTML=Oa[e.race]);P[b]=e}P.length=c.length},P=[];window.onhashchange=wh;var cc=document.getElementById("msgs"),mc=document.getElementById("msgs1"),wf=document.getElementById("msginput"),Hg=document.getElementById("msginputGame"),Gg=document.getElementById("enterwindow");
wf.addEventListener("keyup",function(a){13==a.keyCode&&Ig()});var Ab=function(a,b,d){ma("chat");d&&(r.started?(b=mc,xf()):b=cc,b.innerHTML=5!==d?b.innerHTML+("<li><span>"+d.username+" \u2014</span> "+ab(a)+"</li>"):b.innerHTML+("<li>"+a+"</li>"),b.scrollTop=b.scrollHeight)},xf=function(){11==cc.children.length&&mc.removeChild(mc.children[0]);1==cc.children.length&&(xf.intv=setInterval(function(){mc.removeChild(mc.children[0]);0==cc.children.length&&clearInterval(xf.intv)},3E4))},ab=function(a){return String(a).replace(/</g,
"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Ig=function(){if(r.started){var a=mc,b=Hg.value;Hg.value="";xf()}else a=cc,b=wf.value,wf.value="";""!=b&&(b=ab(b),a.innerHTML+="<li><span>"+t.name+" \u2014</span> "+b+"</li>",ea(Ab,b,0,0,0),a.scrollTop=a.scrollHeight)},pe=[bh,yb,Fd,uc,xe,$c,Xc,zh,Ah,Ab,ke,Cd,Yc,Og,Zc,Nd,pg,ue,jg,Mc,$a,Aj,Bj,Of,Xi,function(a,b,d){d&&(a=Nc(a))&&a.open&&(M("I CAN connect"),ea(Oc,a.id,0,[d],0))},Oc,xj,uf,bg,yg,Oe,zg,Ci,wg,Ae,De,Xe,Qe,Bg,He,li,Kd,Nf,function(a,b){b=
z[b];var d=a[0];a=a[1];var c=D;!1!==d&&(b.kx=d);!1!==a&&(b.ky=a);d=-(b.x32+d+(a+b.y32)*c);b.stop=b.kx||b.ky?!1:!0;Number.isInteger(b.xf)||yb(d,[b.id])},vg,ti,ui,Pf,Fe,xg,Ze,Se,yi,af,Le,Je,Ue,Dg,Oi,zi,Ph,uh];localStorage.favMusic&&(musicSelect.mversion.value=localStorage.favMusic);bh.antiHack=0;yb.antiHack=0;Fd.antiHack=0;uc.antiHack=0;xe.antiHack=0;$c.antiHack=0;Xc.antiHack=0;T.antiHack=0;we.antiHack=0;Ma.antiHack=0;Ta.antiHack=0;T.antiHack=0;zh.antiHack=0;Ah.antiHack=0;Ab.antiHack=0;ke.antiHack=
0;Cd.antiHack=0;Yc.antiHack=0;zd.antiHack=0;Og.antiHack=0;Zc.antiHack=0;Nd.antiHack=0;pg.antiHack=0;ue.antiHack=0;(function(){for(var a=pe,b=0,d=a.length;b<d;b++)a[b].location=b})();var zj=function(){v("mapconfiguration").style.display="block";v("basic").style.filter="blur(94px)"},Fj=document.getElementsByClassName("ucolor1"),fl=document.getElementsByClassName("username1"),gl=document.getElementsByClassName("race1"),hl=document.getElementsByClassName("team1"),Cj=function(a){var b=1;2==a.button&&(b=
-1);a=this.iteam;P[a].team+=b;0>P[a].team&&(P[a].team=0);this.innerHTML=P[a].team;r.online&&(b=parseInt(this.innerHTML),b%=6,0==b&&(b=1),this.innerHTML=b,ea(Of,b,0,0,2),P[a].team=b)},Dj=function(a){a=P[this.iteam];a.race=(a.race+1)%3;this.innerHTML=Oa[a.race];ea(Pf,a.race,0,0,2)},Ej=function(){this.parentElement.style.background=this.value;var a=this.value.match(/^#?([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);P[this.iteam].color=[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)];va.length&&ea(Nf,
this.value,0,0,2)},il=function(){dc.nu++;dc()},jl=function(){dc.nu--;0>=dc.nu?dc.nu=1:P.length--;dc()},Fg={0:"euro",1:"arab",2:"asia"},Gj=[["a","e","i","o","u"],"bcdfghjklmnpqrstvwxyz".split("")],dc=function(){document.getElementById("returnmenu").style.display="block";document.getElementById("oneplayertbody").innerHTML="";document.getElementById("oneplayertbody").innerHTML+='<tr><td></td><td id="addremove"><button id="addPlayer">+</button><button id="removePlayer">-</button></td><td></td><td></td></tr>';
for(var a=dc.nu,b=0;b<a;b++)if(document.getElementById("oneplayertbody").innerHTML+='<tr><td class="ucolor1"></td><td class="username1"></td><td class="race1"><button></button></td><td class="team1"><button></button></td></tr>',!P[b]){var d=~~(16777216*Math.random());P[b]={color:[d>>16&255,d>>8&255,d&255],IA:1,race:~~(3*Math.random()),team:b}}document.getElementById("addPlayer").onclick=il;document.getElementById("removePlayer").onclick=jl;P[0].color=[0,0,189];P[0].name=t.name;for(b=d=P[0].IA=0;b<
a;b++){var c=P[b],e=bi[Fg[c.race]];if(c.IA)if(d<e.length)c.name=e[d++];else{e=c;var h=~~(9*Math.random())+2,l=Gj[1],g=l[~~(Math.random()*l.length)].toUpperCase();.85<Math.random()&&(g+=l[~~(Math.random()*l.length)]);for(l=0;l<h;l++){var k=Gj[l%2];g+=k[~~(Math.random()*k.length)];.8<Math.random()&&(g+=k[~~(Math.random()*k.length)])}e.name=g}Fj[b].style.background="rgb("+c.color[0]+","+c.color[1]+","+c.color[2]+")";fl[b].innerHTML=c.name;e=hl[b].getElementsByTagName("button")[0];e.iteam=b;e.onmousedown=
Cj;e.innerHTML=b;e=gl[b].getElementsByTagName("button")[0];e.iteam=b;e.onmousedown=Dj;e.innerHTML=Oa[c.race];c=P[b].color;e=document.createElement("input");e.type="color";e.iteam=b;e.value="#"+(16777216+(c[0]<<16)+(c[1]<<8)+c[2]).toString(16).slice(1);Fj[b].appendChild(e);e.onchange=Ej}};dc.nu=4;var vj=function(a,b,d){"granted"!=Notification.permission&&Notification.requestPermission(function(a){});var c=new Notification(a,{icon:"https://i.imgur.com/SWtWteN.png",body:b,requireInteraction:!0});d||
(d=7550);setTimeout(function(){c.close()},d)},Sb,nc=function(a){if(na(a%D,~~(a/D))&&(a=lc[a],0<=a&&!Sb.type[a]))return!0},ph=function(a){for(var b=D,d=[],c={},e=0,f=D*xa;e<f;e++)if(Sb.type[a[e]]){var l=0;nc(e-1-b)&&(l+=1E7);nc(e-b)&&(l+=1E6);nc(e-b+1)&&(l+=1E5);nc(e-1)&&(l+=1E4);nc(e+1)&&(l+=1E3);nc(e-1+b)&&(l+=100);nc(e+b)&&(l+=10);nc(e+1+b)&&(l+=1);l&&void 0!==gj[l]&&(d.add(e),c[d.length-1]=-gj[l]/256-1)}e=0;for(len=d.length;e<len;a[d[e]]=c[e++]);g.useProgram(ba);g.activeTexture(g.TEXTURE1);b=g.createTexture();
g.bindTexture(g.TEXTURE_2D,b);g.texImage2D(g.TEXTURE_2D,0,g.R8I,D,xa,0,g.RED_INTEGER,g.BYTE,a);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT);g.bindTexture(g.TEXTURE_2D,null);g.bindTexture(g.TEXTURE_2D,b);g.uniform1i(g.getUniformLocation(ba,"img_data"),1);g.useProgram(la);g.activeTexture(g.TEXTURE2)},a,mj,tf,Vk=function(){var f=
{};a={move:function(){U=yb;yb.cursor=7}};a.move.iconID=262;a.move.obj={name:A.move};a.attack=function(){U=uc};a.attack.iconID=250;a.attack.obj={name:A.attack};a.guard=function(){jc(4)};a.guard.iconID=237;a.guard.obj={name:A.guard};a.patrol=function(){jc(8)};a.patrol.iconID=238;a.patrol.obj={name:A.patrol};a.pickUp=function(){U=Yc};a.pickUp.iconID=240;a.pickUp.obj={name:A.pickItems};a.explore=function(){jc(7)};a.explore.iconID=40;a.explore.obj={name:A.explore};a.stop=function(){ea(pg,0,J)};a.stop.iconID=
160;a.stop.obj={name:A.stop};a.stand=function(){ea(li,0,J)};a.stand.iconID=27;a.stand.obj={name:A.stand};a.attackGround=function(){};a.attackGround.iconID=100;a.steady=function(){};a.steady.iconID=21;a.createOrk=function(){R(58)};a.createOrk.iconID=120;a.createDwarf=function(){R(59)};a.createDwarf.iconID=117;a.createSkeleton=function(){R(60)};a.createSkeleton.iconID=87;a.createGhost=function(){R(40)};a.createGhost.iconID=222;a.createFootman=function(){R(0)};a.createFootman.iconID=182;a.createArcher=
function(){R(4)};a.createArcher.iconID=185;a.createMaceman=function(){R(3)};a.createMaceman.iconID=186;a.createPikeman=function(){R(1)};a.createPikeman.iconID=183;a.createLongbowman=function(){R(6)};a.createLongbowman.iconID=184;a.createKnight=function(){R(19)};a.createKnight.iconID=180;a.iniMercenaries=function(a){a.mlist=[];a.mlistID=[];a.mercID=0;kg(a);a.setupINTV(Ng,a.id,2E3)};a.iniMercenaries.builds=[30];a.iniHeroes=function(a){a.hlist=[];a.hlistID=[];a.heroID=0;kg(a);a.setupINTV(Ng,a.id,2E3)};
a.iniHeroes.builds=[30];a.mercFootmanArab=function(){Fa()};a.mercFootmanArab.iconID=49;a.mercFootmanArab.unit=80;a.mercFootmanArab.obj={};a.mercArcherArab=function(){Fa()};a.mercArcherArab.iconID=52;a.mercArcherArab.unit=85;a.mercArcherArab.obj={};a.mercMacemanArab=function(){Fa()};a.mercMacemanArab.iconID=116;a.mercMacemanArab.obj={};a.mercMacemanArab.unit=83;a.mercPikemanArab=function(){Fa()};a.mercPikemanArab.iconID=52;a.mercPikemanArab.unit=82;a.mercPikemanArab.obj={};a.mercCavalry=function(){Fa()};
a.mercCavalry.iconID=133;a.mercCavalry.unit=84;a.mercCavalry.obj={};a.mercEnichar=function(){Fa()};a.mercEnichar.iconID=123;a.mercEnichar.unit=91;a.mercEnichar.obj={};a.mercJihad=function(){Fa()};a.mercJihad.iconID=236;a.mercJihad.unit=86;a.mercJihad.obj={};a.mercFootmanArab6=function(){ta()};a.mercFootmanArab6.iconID=49;a.mercFootmanArab6.unit=80;a.mercFootmanArab6.obj={};a.mercArcherArab6=function(){ta()};a.mercArcherArab6.iconID=52;a.mercArcherArab6.unit=85;a.mercArcherArab6.obj={};a.mercMacemanArab6=
function(){ta()};a.mercMacemanArab6.iconID=116;a.mercMacemanArab6.unit=83;a.mercMacemanArab6.obj={};a.mercPikemanArab6=function(){ta()};a.mercPikemanArab6.iconID=52;a.mercPikemanArab6.unit=82;a.mercPikemanArab6.obj={};a.mercCavalry6=function(){ta()};a.mercCavalry6.iconID=133;a.mercCavalry6.unit=84;a.mercCavalry6.obj={};a.mercEnichar6=function(){ta()};a.mercEnichar6.iconID=123;a.mercEnichar6.unit=91;a.mercEnichar6.obj={};a.mercJihad6=function(){ta()};a.mercJihad6.iconID=236;a.mercJihad6.unit=86;a.mercJihad6.obj=
{};a.mercFootman=function(){Fa()};a.mercFootman.iconID=182;a.mercFootman.unit=0;a.mercArcher=function(){Fa()};a.mercArcher.iconID=185;a.mercArcher.unit=4;a.mercMaceman=function(){Fa()};a.mercMaceman.iconID=186;a.mercMaceman.unit=3;a.mercPikeman=function(){Fa()};a.mercPikeman.iconID=183;a.mercPikeman.unit=1;a.mercLongbowman=function(){Fa()};a.mercLongbowman.iconID=184;a.mercLongbowman.unit=6;a.mercKnight=function(){Fa()};a.mercKnight.iconID=180;a.mercKnight.unit=19;a.mercFootman6=function(){ta()};
a.mercFootman6.iconID=182;a.mercFootman6.unit=0;a.mercFootman6.obj={};a.mercArcher6=function(){ta()};a.mercArcher6.iconID=185;a.mercArcher6.unit=4;a.mercArcher6.obj={};a.mercMaceman6=function(){ta()};a.mercMaceman6.iconID=186;a.mercMaceman6.unit=3;a.mercMaceman6.obj={};a.mercPikeman6=function(){ta()};a.mercPikeman6.iconID=183;a.mercPikeman6.unit=1;a.mercPikeman6.obj={};a.mercLongbowman6=function(){ta()};a.mercLongbowman6.iconID=184;a.mercLongbowman6.unit=6;a.mercLongbowman6.obj={};a.mercKnight6=function(){ta()};
a.mercKnight6.iconID=180;a.mercKnight6.unit=19;a.mercKnight6.obj={};a.mercArcherAsian6=function(){ta()};a.mercArcherAsian6.iconID=53;a.mercArcherAsian6.unit=67;a.mercArcherAsian6.obj={};a.mercSamurai6=function(){ta()};a.mercSamurai6.iconID=122;a.mercSamurai6.unit=68;a.mercSamurai6.obj={};a.mercHourseSamurai6=function(){ta()};a.mercHourseSamurai6.iconID=121;a.mercHourseSamurai6.unit=70;a.mercHourseSamurai6.obj={};a.mercRonin6=function(){ta()};a.mercRonin6.iconID=54;a.mercRonin6.unit=66;a.mercRonin6.obj=
{};a.mercHorseArcher6=function(){ta()};a.mercHorseArcher6.iconID=52;a.mercHorseArcher6.unit=69;a.mercHorseArcher6.obj={};a.mercChariot6=function(){ta()};a.mercChariot6.iconID=79;a.mercChariot6.unit=72;a.mercChariot6.obj={};a.mercArcherAsian=function(){Fa()};a.mercArcherAsian.iconID=53;a.mercArcherAsian.unit=67;a.mercArcherAsian.obj={};a.mercSamurai=function(){Fa()};a.mercSamurai.iconID=122;a.mercSamurai.unit=68;a.mercSamurai.obj={};a.mercHourseSamurai=function(){Fa()};a.mercHourseSamurai.iconID=121;
a.mercHourseSamurai.unit=70;a.mercHourseSamurai.obj={};a.mercRonin=function(){Fa()};a.mercRonin.iconID=54;a.mercRonin.unit=66;a.mercRonin.obj={};a.mercHorseArcher=function(){Fa()};a.mercHorseArcher.iconID=52;a.mercHorseArcher.unit=69;a.mercHorseArcher.obj={};a.mercChariot=function(){Fa()};a.mercChariot.iconID=79;a.mercChariot.unit=72;a.mercChariot.obj={};a.createPeon=function(){R(10)};a.createPeon.iconID=187;a.sameSpeed=function(){ea(ui,J)};a.sameSpeed.iconID=82;a.restoreSpeed=function(){ea(ti,J)};
a.restoreSpeed.iconID=88;a.createSpy=function(){R(2)};a.createSpy.iconID=162;a.emergeAllUnits=function(){var a=J[0];ea(Zc,a,z[a].inventory.slice(0))};a.emergeAllUnits.iconID=261;a.techFeudalism=function(){C(12)};a.techFeudalism.iconID=233;a.techArchitecture=function(){C(13)};a.techArchitecture.iconID=226;a.techLearning=function(){C(14)};a.techLearning.iconID=129;a.createPeon1=function(){R(64)};a.createPeon1.iconID=55;a.createPeon2=function(){R(79)};a.createPeon2.iconID=132;a.createNinja=function(){R(65)};
a.createNinja.iconID=51;a.techArmoredChariot=function(){C(51)};a.techArmoredChariot.iconID=79;a.techBuddhism=function(){C(45)};a.techBuddhism.iconID=127;a.techGreatWall=function(){C(48)};a.techGreatWall.iconID=80;a.ridingHorses=function(){C(49)};a.ridingHorses.iconID=64;a.irrigation=function(){C(50)};a.irrigation.iconID=72;a.createHorseArcher2=function(){R(85)};a.createHorseArcher2.iconID=52;a.techMeditation=function(){C(52)};a.techMeditation.iconID=71;a.techKungFu=function(){C(53)};a.techKungFu.iconID=
228;a.techTournaments=function(){C(54)};a.techTournaments.iconID=73;a.techPhilosophy=function(){C(55)};a.techPhilosophy.iconID=68;a.techNinjas=function(){C(56)};a.techNinjas.iconID=56;a.techMastery=function(){C(57)};a.techMastery.iconID=69;a.techGoldMining=function(){C(1)};a.techGoldMining.iconID=58;a.techStoneMining=function(){C(2)};a.techStoneMining.iconID=57;a.createCrusaders=function(){ea(Og,J[0],0)};a.createCrusaders.iconID=221;a.techFanaticism=function(){C(31)};a.techFanaticism.iconID=235;a.techCrusade=
function(){C(32)};a.techCrusade.iconID=93;a.techEspionage=function(){C(30)};a.techEspionage.iconID=215;a.techInquisition=function(){C(33)};a.techInquisition.iconID=97;a.techHealing=function(){C(34)};a.techHealing.iconID=219;a.healing=function(){U=yg};a.healing.iconID=219;a.healing.iconIDbook=201;a.teach=function(){U=Dg};a.teach.iconID=23;a.teach.iconIDbook=217;a.techBless=function(){C(36)};a.techBless.iconID=159;a.bless=function(){U=Oe};a.bless.iconID=159;a.bless.iconIDbook=204;a.techMedicine=function(){C(35)};
a.techMedicine.iconID=220;a.createMage=function(){R(5)};a.createMage.iconID=156;a.techBat=function(){C(38)};a.techBat.iconID=168;a.techGolem=function(){C(41)};a.techGolem.iconID=119;a.techInvisibility=function(){C(37)};a.techInvisibility.iconID=217;a.techLightning=function(){C(40)};a.techLightning.iconID=143;a.techFreeze=function(){C(39)};a.techFreeze.iconID=130;a.techHeroism=function(){C(22)};a.techHeroism.iconID=136;a.techWarfare=function(){C(23)};a.techWarfare.iconID=108;a.techTactics=function(){C(24)};
a.techTactics.iconID=257;a.techMercenaries=function(){C(25)};a.techMercenaries.iconID=95;a.techHeroes=function(){C(26)};a.techHeroes.iconID=96;a.techFame=function(){C(27)};a.techFame.iconID=111;a.techSiegeTactics=function(){C(28)};a.techSiegeTactics.iconID=258;a.techBodyBuilding=function(){C(29)};a.techBodyBuilding.iconID=101;a.createPriest=function(){R(9)};a.createPriest.iconID=155;a.createCow=function(){R(27)};a.createCow.iconID=163;a.techCropRotation=function(){C(8)};a.techCropRotation.iconID=
227;a.techDomestication=function(){C(7)};a.techDomestication.iconID=157;a.techMapMaking=function(){C(16)};a.techMapMaking.iconID=89;a.techTradeRoutes=function(){C(17)};a.techTradeRoutes.iconID=102;a.techTradeTaxes=function(){C(18)};a.techTradeTaxes.iconID=110;a.techUsury=function(){C(19)};a.techUsury.iconID=105;a.techSupplyStorage=function(){C(20)};a.techSupplyStorage.iconID=62;a.techBribery=function(){C(21)};a.techBribery.iconID=109;a.bribe=function(){};a.bribe.iconID=128;a.createCaravan=function(){R(61)};
a.createCaravan.iconID=169;a.createCaravan2=function(){R(90)};a.createCaravan2.iconID=134;a.createFootman2=function(){R(80)};a.createFootman2.iconID=49;a.createArcher2=function(){R(81)};a.createArcher2.iconID=43;a.createSatrap=function(){R(83)};a.createSatrap.iconID=116;a.createPikeman2=function(){R(82)};a.createPikeman2.iconID=42;a.createHorseArcher2=function(){R(85)};a.createHorseArcher2.iconID=124;a.createCavalry=function(){R(84)};a.createCavalry.iconID=133;a.createEnichar=function(){R(91)};a.createEnichar.iconID=
123;a.createJihad=function(){R(86)};a.createJihad.iconID=236;a.trade=function(){};a.trade.iconID=161;a.unload=function(){U=Ae};a.unload.iconID=148;a.createMercenaries=function(){ia(z[J[0]].mlist)};a.createMercenaries.iconID=95;a.createHeroes=function(){ia(z[J[0]].hlist)};a.createHeroes.iconID=96;a.upgradeGuildTower=function(){C(42)};a.upgradeGuildTower.iconID=171;a.upgradeStoneTower=function(){C(43)};a.upgradeStoneTower.iconID=178;a.upgradeCannonTower=function(){C(44)};a.upgradeCannonTower.iconID=
178;a.createCatapult=function(){R(37)};a.createCatapult.iconID=152;a.createHeavyCatapult=function(){R(39)};a.createHeavyCatapult.iconID=153;a.createBallist=function(){R(38)};a.createBallist.iconID=154;a.techEngineering=function(){C(47)};a.techEngineering.iconID=92;a.techCannonTower=function(){C(46)};a.techCannonTower.iconID=178;a.techPlateArmor=function(){C(10)};a.techPlateArmor.iconID=131;a.techTemperIron=function(){C(4)};a.techTemperIron.iconID=266;a.techHalberd=function(){C(6)};a.techHalberd.iconID=
113;a.techScaleArmor=function(){C(5)};a.techScaleArmor.iconID=251;a.techChainMail=function(){C(9)};a.techChainMail.iconID=252;a.techLongbow=function(){C(0)};a.techLongbow.iconID=259;a.techWoodCutting=function(){C(3)};a.techWoodCutting.iconID=107;a.techCrossbow=function(){C(11)};a.techCrossbow.iconID=112;a.createFishingBoat=function(){R(74)};a.createFishingBoat.iconID=48;a.createXebec=function(){R(76)};a.createXebec.iconID=166;a.upgradeShip=function(){};a.upgradeShip.iconID=268;a.fishing=function(){};
a.fishing.iconID=41;a.createHulk=function(){R(75)};a.createHulk.iconID=165;a.createGalleon=function(){R(73)};a.createGalleon.iconID=164;a.techLandingTactics=function(){};a.techLandingTactics.iconID=98;a.techConcentration=function(){C(58)};a.techConcentration.iconID=75;a.techConfusion=function(){C(59)};a.techConfusion.iconID=76;a.techWhirlpool=function(){C(60)};a.techWhirlpool.iconID=78;a.techDragon=function(){C(61)};a.techDragon.iconID=115;a.techTurnToStone=function(){C(62)};a.techTurnToStone.iconID=
77;a.techFlameBolt=function(){C(63)};a.techFlameBolt.iconID=25;a.techJewelry=function(){C(64)};a.techJewelry.iconID=230;a.techBanking=function(){C(65)};a.techBanking.iconID=74;a.techChemistry=function(){C(66)};a.techChemistry.iconID=225;a.techSeaFood=function(){C(67)};a.techSeaFood.iconID=67;a.techGunPowder=function(){C(68)};a.techGunPowder.iconID=212;a.techRocketArrow=function(){C(69)};a.techRocketArrow.iconID=47;a.techBushido=function(){C(70)};a.techBushido.iconID=60;a.techLeadership=function(){C(71)};
a.techLeadership.iconID=114;a.techHonor=function(){C(72)};a.techHonor.iconID=94;a.techSunTzu=function(){C(73)};a.techSunTzu.iconID=66;a.createRonin=function(){R(66)};a.createRonin.iconID=54;a.createArcher1=function(){R(67)};a.createArcher1.iconID=53;a.createSamurai=function(){R(68)};a.createSamurai.iconID=122;a.createHorseArcher1=function(){R(69)};a.createHorseArcher1.iconID=52;a.createMonk=function(){R(128)};a.createMonk.iconID=45;a.createMage1=function(){R(129)};a.createMage1.iconID=50;a.createPriest1=
function(){R(127)};a.createPriest1.iconID=44;a.createPriest2=function(){R(87)};a.createPriest2.iconID=125;a.buyItems=function(){};a.buyItems.iconID=31;a.sellItems=function(){};a.sellItems.iconID=30;a.createHorseSamurai=function(){R(70)};a.createHorseSamurai.iconID=121;a.createChariot=function(){R(72)};a.createChariot.iconID=79;a.stopTech=function(){ea(ue,0,J);Ja(z[J[0]])};a.stopTech.iconID=160;a.repair=function(){U=$c};a.repair.iconID=145;a.conquest=function(){};a.conquest.iconID=249;a.dcm=function(){U=
Fd};a.dcm.iconID=260;a.buildBarrack=function(){H(14)};a.buildBarrack.iconID=205;a.buildBarrack1=function(){H(71)};a.buildBarrack1.iconID=205;a.buildBarrack2=function(){H(102)};a.buildBarrack2.iconID=205;a.buildTower=function(){H(32)};a.buildTower.iconID=170;a.buildStorage=function(){H(18)};a.buildStorage.iconID=200;a.buildLumbermill=function(){H(15)};a.buildLumbermill.iconID=199;a.buildLumbermill2=function(){H(93)};a.buildLumbermill2.iconID=199;a.buildFields=function(){H(20)};a.buildFields.iconID=
265;a.buildCastle=function(){H(12)};a.buildCastle.iconID=206;a.buildCastle1=function(){H(62)};a.buildCastle1.iconID=206;a.buildCastle2=function(){H(63)};a.buildCastle2.iconID=206;a.buildAcademy=function(){H(17)};a.buildAcademy.iconID=204;a.buildCathedral=function(){H(11)};a.buildCathedral.iconID=191;a.buildCathedral2=function(){H(106)};a.buildCathedral2.iconID=189;a.buildMerchands=function(){H(24)};a.buildMerchands.iconID=198;a.buildMerchands2=function(){H(108)};a.buildMerchands2.iconID=198;a.buildChurch=
function(){H(25)};a.buildChurch.iconID=197;a.buildMarket=function(){H(33)};a.buildMarket.iconID=194;a.buildMageTower=function(){H(16)};a.buildMageTower.iconID=192;a.buildMageTower2=function(){H(107)};a.buildMageTower2.iconID=192;a.buildDummy=function(){H(36)};a.buildDummy.iconID=65;a.buildFarm=function(){H(23)};a.buildFarm.iconID=193;a.buildBlacksmith=function(){H(26)};a.buildBlacksmith.iconID=202;a.buildWorkshop=function(){H(29)};a.buildWorkshop.iconID=201;a.buildWorkshop2=function(){H(98)};a.buildWorkshop2.iconID=
201;a.buildStable=function(){H(28)};a.buildStable.iconID=196;a.buildStable2=function(){H(103)};a.buildStable2.iconID=196;a.buildTavern=function(){H(30)};a.buildTavern.iconID=208;a.buildHouse=function(){H(31)};a.buildHouse.iconID=195;a.buildHarbor=function(){H(41)};a.buildHarbor.iconID=188;a.buildOutpost=function(){H(34)};a.buildOutpost.iconID=158;a.buildWoodWall=function(){og(13)};a.buildWoodWall.iconID=210;a.buildWoodGate=function(){};a.buildWoodGate.iconID=209;a.buildWoodGate.disabled=2;a.buildBridge=
function(){H(35)};a.buildBridge.iconID=176;tf="freeze invisibility lightning turnToStone bless healing".split(" ");a.freeze=function(){U=Xe};a.freeze.iconID=99;a.freeze.obj={name:A.freeze};a.freeze.iconIDbook=205;a.confusion=function(){U=Ze};a.confusion.iconID=76;a.confusion.obj={name:"Confusion",spcost:[120,0,0,0]};a.confusion.iconIDbook=206;a.turnToStone=function(){U=xg};a.turnToStone.iconID=77;a.turnToStone.iconIDbook=213;a.turnToStone.obj={name:"Turn to Stone",spcost:[40,0,0,0]};a.whirlpool=function(){U=
yi};a.whirlpool.iconID=78;a.whirlpool.iconIDbook=214;a.whirlpool.obj={name:"Whirlpool",spcost:[80,0,0,0]};a.flameBolt=function(){U=Se};a.flameBolt.iconID=25;a.flameBolt.obj={name:"Flame Bolt",spcost:[120,0,0,0]};a.flameBolt.iconIDbook=216;a.createDragon=function(){U=Fe};a.createDragon.iconID=115;a.createDragon.obj={name:"Spawn Dragon",spcost:[320,0,0,0]};a.createDragon.iconIDbook=215;a.lightning=function(){U=Bg};a.lightning.iconID=263;a.lightning.obj={name:A.lightning,spcost:[80,0,0,0]};a.lightning.iconIDbook=
200;a.createBat=function(){U=He};a.createBat.iconID=168;a.createBat.iconIDbook=203;a.createGolem=function(){U=De};a.createGolem.iconID=119;a.createGolem.iconIDbook=209;a.autoInvisibility=function(){U=Qe};a.autoInvisibility.iconID=217;a.autoInvisibility.obj={name:A.invisibility};a.invisibility=function(){U=Qe};a.invisibility.iconID=217;a.invisibility.iconIDbook=208;a.impersonate=function(){U=zg};a.impersonate.iconID=32;a.impersonate.obj={name:"Impersonate"};a.revealSelf=function(){ea(Ci,J[0],0)};a.revealSelf.iconID=
33;a.revealSelf.obj={name:"Reveal your true self"};a.buildHouse1=function(){H(111)};a.buildHouse1.iconID=195;a.buildHouse2=function(){H(92)};a.buildHouse2.iconID=195;a.buildLumbermill1=function(){H(112)};a.buildLumbermill1.iconID=199;a.buildStorage1=function(){H(113)};a.buildStorage1.iconID=200;a.buildStorage2=function(){H(94)};a.buildStorage2.iconID=200;a.buildFarm1=function(){H(114)};a.buildFarm1.iconID=193;a.buildFarm2=function(){H(95)};a.buildFarm2.iconID=193;a.buildHarbor1=function(){H(115)};
a.buildHarbor1.iconID=188;a.buildHarbor2=function(){H(96)};a.buildHarbor2.iconID=188;a.buildBlacksmith1=function(){H(116)};a.buildBlacksmith1.iconID=202;a.buildBlacksmith2=function(){H(97)};a.buildBlacksmith2.iconID=202;a.buildWorkshop1=function(){H(117)};a.buildWorkshop1.iconID=201;a.buildChurch1=function(){H(118)};a.buildChurch1.iconID=197;a.buildChurch2=function(){H(99)};a.buildChurch2.iconID=197;a.buildTavern1=function(){H(119)};a.buildTavern1.iconID=208;a.buildTavern2=function(){H(100)};a.buildTavern2.iconID=
208;a.buildMarket1=function(){H(120)};a.buildMarket1.iconID=194;a.buildMarket2=function(){H(101)};a.buildMarket2.iconID=194;a.buildStable1=function(){H(121)};a.buildStable1.iconID=196;a.buildOutpost1=function(){H(122)};a.buildOutpost1.iconID=158;a.buildOutpost2=function(){H(104)};a.buildOutpost2.iconID=158;a.buildCathedral1=function(){H(123)};a.buildCathedral1.iconID=190;a.buildMageTower1=function(){H(124)};a.buildMageTower1.iconID=192;a.createObjects=function(){Md("magicworkshopmenu",Z)};a.createObjects.iconID=
20;a.createObjects.obj={};a.buildMagicWorkshop=function(){H(110)};a.buildMagicWorkshop.iconID=46;a.buildMerchands1=function(){H(125)};a.buildMerchands1.iconID=198;a.buildAcademy1=function(){H(126)};a.buildAcademy1.iconID=204;a.buildAcademy2=function(){H(109)};a.buildAcademy2.iconID=204;a.buildRocketTower=function(){H(57)};a.buildRocketTower.iconID=47;a.murder=function(){H(57)};a.murder.iconID=28;a.convertJihad=function(){};a.convertJihad.iconID=236;a.convertJihad.obj={};a.menuCommonBuild2=function(){ia(b)};
a.menuCommonBuild2.iconID=17;var b=[a.buildFarm2,a.buildBlacksmith2,a.buildWorkshop2,a.buildStable2,a.buildTavern2,a.buildHouse2];b.menuName="a_build";a.menuCommonBuild2.xtra=b;a.menuSpecialBuild2=function(){ia(d)};a.menuSpecialBuild2.iconID=15;var d=[a.buildCastle2,a.buildAcademy2,a.buildCathedral2,a.buildMerchands2,a.buildChurch2,a.buildMarket2,a.buildMageTower2,a.buildMagicWorkshop];d.menuName="a_build";a.menuSpecialBuild2.xtra=d;a.menuOtherBuild2=function(){ia(c)};a.menuOtherBuild2.iconID=16;
var c=[a.buildHarbor2,a.buildOutpost2,a.buildWoodWall,a.buildWoodGate,a.buildBridge];c.menuName="e_build";a.menuOtherBuild2.xtra=c;a.menuBuilds2=function(){ia(e)};a.menuBuilds2.iconID=245;var e=[a.menuSpecialBuild2,a.menuCommonBuild2,a.menuOtherBuild2,a.buildBarrack2,a.buildTower,a.buildStorage2,a.buildLumbermill2,a.buildFields];e.menuName="a_build";a.menuBuilds2.xtra=e;a.createCarpet=function(){U=Le};a.createCarpet.iconID=146;a.createCarpet.iconIDbook=202;a.createJinn=function(){U=Je};a.createJinn.iconID=
118;a.createJinn.iconIDbook=218;a.magicVision=function(){};a.magicVision.iconID=223;a.magicVision.iconIDbook=210;a.fireRain=function(){U=af};a.fireRain.iconID=264;a.fireRain.iconIDbook=199;a.raiseDead=function(){U=Ue};a.raiseDead.iconID=87;a.raiseDead.iconIDbook=211;a.createMage2=function(){R(89)};a.createMage2.iconID=126;a.techCowPoaching=function(){C(74)};a.techCowPoaching.iconID=85;a.techHorseManShip=function(){C(75)};a.techHorseManShip.iconID=231;a.techScimitar=function(){C(76)};a.techScimitar.iconID=
84;a.techJihad=function(){C(77)};a.techJihad.iconID=236;a.techCarpet=function(){C(78)};a.techCarpet.iconID=146;a.techMagicWorkshop=function(){C(79)};a.techMagicWorkshop.iconID=86;a.techFireRain=function(){C(80)};a.techFireRain.iconID=264;a.techMagicVision=function(){C(81)};a.techMagicVision.iconID=224;a.techNecromancy=function(){C(82)};a.techNecromancy.iconID=87;a.techJinn=function(){C(83)};a.techJinn.iconID=118;a.techOreFloatation=function(){C(84)};a.techOreFloatation.iconID=106;a.techRiddingHorses=
function(){C(85)};a.techRiddingHorses.iconID=232;a.techJanissary=function(){C(86)};a.techJanissary.iconID=81;a.buildMagicItems=function(){};a.buildMagicItems.iconID=20;a.techSlavery=function(){C(87)};a.techSlavery.iconID=135;a.stopBuilding=function(){ea(Nd,0,J)};a.stopBuilding.iconID=160;a.menuSpecialBuild1=function(){ia(h)};a.menuSpecialBuild1.iconID=15;var h=[a.buildCastle1,a.buildAcademy1,a.buildCathedral1,a.buildMerchands1,a.buildChurch1,a.buildMarket1,a.buildMageTower1,a.buildRocketTower,a.buildDummy];
h.menuName="a_build";a.menuSpecialBuild1.xtra=h;a.menuCommonBuild1=function(){ia(l)};a.menuCommonBuild1.iconID=17;var l=[a.buildFarm1,a.buildBlacksmith1,a.buildWorkshop1,a.buildStable1,a.buildTavern1,a.buildHouse1];l.menuName="a_build";a.menuCommonBuild1.xtra=l;a.menuSpecialBuild=function(){ia(g)};a.menuSpecialBuild.iconID=15;var g=[a.buildCastle,a.buildAcademy,a.buildCathedral,a.buildMerchands,a.buildChurch,a.buildMarket,a.buildMageTower,a.buildDummy];g.menuName="e_build";a.menuSpecialBuild.xtra=
g;a.menuCommonBuild=function(){ia(k)};a.menuCommonBuild.iconID=17;var k=[a.buildFarm,a.buildBlacksmith,a.buildWorkshop,a.buildStable,a.buildTavern,a.buildHouse];k.menuName="e_build";a.menuCommonBuild.xtra=k;a.menuOtherBuild=function(){ia(m)};a.menuOtherBuild.iconID=16;var m=[a.buildHarbor,a.buildOutpost,a.buildWoodWall,a.buildWoodGate,a.buildBridge];m.menuName="e_build";a.menuOtherBuild.xtra=m;a.menuOtherBuild1=function(){ia(q)};a.menuOtherBuild1.iconID=16;var q=[a.buildHarbor1,a.buildOutpost1,a.buildWoodWall,
a.buildWoodGate,a.buildBridge];q.menuName="e_build";a.menuOtherBuild1.xtra=q;a.menuBuilds=function(){ia(r)};var r=[a.menuSpecialBuild,a.menuCommonBuild,a.menuOtherBuild,a.buildBarrack,a.buildTower,a.buildStorage,a.buildLumbermill,a.buildFields];r.menuName="e_build";a.menuBuilds.iconID=245;a.menuBuilds.xtra=r;a.menuBuilds1=function(){ia(t)};a.menuBuilds1.iconID=245;var t=[a.menuSpecialBuild1,a.menuCommonBuild1,a.menuOtherBuild1,a.buildBarrack1,a.buildTower,a.buildStorage1,a.buildLumbermill1,a.buildFields];
t.menuName="a_build";a.menuBuilds1.xtra=t;mj=function(){a.fishing.obj={};a.impersonate.obj={};a.techGreatWall.obj=B[48];a.revealSelf.obj={};a.trade.obj={};a.unload.obj={};a.mercFootman6.obj={};a.murder.obj={};a.mercArcher6.obj={};a.mercMaceman6.obj={};a.mercPikeman6.obj={};a.mercLongbowman6.obj={};a.sameSpeed.obj={name:"Same speed"};a.restoreSpeed.obj={name:"Restore speed"};a.mercKnight6.obj={};a.attackGround.obj={};a.steady.obj={};a.bribe.obj={};a.createPriest1.obj=x[127];a.createPriest2.obj=x[87];
a.createFootman2.obj=x[80];a.createArcher2.obj=x[81];a.createSatrap.obj=x[83];a.createPikeman2.obj=x[82];a.createHorseArcher2.obj=x[85];a.createCavalry.obj=x[84];a.createEnichar.obj=x[91];a.createJihad.obj=x[86];a.createMonk.obj=x[128];a.healing.obj={name:A.heal,spcost:[20,0,0,0]};a.bless.obj={name:A.bless,spcost:[20,0,0,0]};a.stopTech.obj={};a.conquest.obj={};a.dcm.obj={name:A.dcm};a.repair.obj={name:A.repair};a.menuOtherBuild.obj={};a.menuOtherBuild1.obj={};a.menuOtherBuild2.obj={};a.sellItems.obj=
{};a.buyItems.obj={};a.menuBuilds.obj={name:A.menuBuild};a.menuCommonBuild.obj={};a.menuSpecialBuild.obj={};a.techMastery.obj=B[57];a.techNinjas.obj=B[56];a.teach.obj={name:"Teach",spcost:[20,0,0,0]};a.techPhilosophy.obj=B[55];a.techKungFu.obj=B[53];a.techTournaments.obj=B[54];a.techMeditation.obj=B[52];a.menuCommonBuild1.obj={};a.menuCommonBuild2.obj={};a.createMage1.obj=x[129];a.menuSpecialBuild1.obj={};a.menuSpecialBuild2.obj={};a.menuBuilds1.obj={name:A.menuBuild};a.menuBuilds2.obj={name:A.menuBuild};
a.stopBuilding.obj={};a.freeze.obj={name:A.freeze,spcost:[200,0,0,0]};a.invisibility.obj={name:A.invisibility,spcost:[40,0,0,0]};a.autoInvisibility.obj={name:A.invisibility};a.createHeroes.obj={};a.createMercenaries.obj={};a.upgradeShip.obj={};a.techMedicine.obj=B[35];a.techBless.obj=B[36];a.buildHouse1.obj=x[111];a.techHealing.obj=B[34];a.techInquisition.obj=B[33];a.techArmoredChariot.obj=B[51];a.techRocketArrow.obj=B[69];a.techJewelry.obj=B[64];a.techGunPowder.obj=B[68];a.techSeaFood.obj=B[67];
a.techChemistry.obj=B[66];a.techBanking.obj=B[65];a.createMage.obj=x[5];a.techBat.obj=B[38];a.techGolem.obj=B[41];a.techInvisibility.obj=B[37];a.techLightning.obj=B[40];a.techFreeze.obj=B[39];a.techHeroism.obj=B[22];a.createHorseSamurai.obj=x[70];a.createChariot.obj=x[72];a.createHorseArcher1.obj=x[69];a.createHorseArcher2.obj=x[85];a.createSamurai.obj=x[68];a.createArcher1.obj=x[67];a.techConfusion.obj=B[59];a.techConcentration.obj=B[58];a.techWhirlpool.obj=B[60];a.techDragon.obj=B[61];a.techTurnToStone.obj=
B[62];a.techFlameBolt.obj=B[63];a.createRonin.obj=x[66];a.buildStorage.obj=x[18];a.buildStorage1.obj=x[113];a.buildStorage2.obj=x[94];a.buildFields.obj=x[20];a.buildLumbermill.obj=x[15];a.buildLumbermill1.obj=x[112];a.buildLumbermill2.obj=x[93];a.buildTower.obj=x[32];a.buildBarrack1.obj=x[71];a.buildBarrack.obj=x[14];a.buildBarrack2.obj=x[102];a.buildDummy.obj=x[36];a.buildRocketTower.obj=x[57];a.buildMageTower.obj=x[16];a.buildMageTower1.obj=x[124];a.buildMageTower2.obj=x[107];a.buildMarket.obj=
x[33];a.buildMarket1.obj=x[120];a.buildMarket2.obj=x[101];a.buildChurch.obj=x[25];a.buildChurch1.obj=x[118];a.buildChurch2.obj=x[99];a.buildMerchands.obj=x[24];a.irrigation.obj=B[50];a.ridingHorses.obj=B[49];a.buildMerchands1.obj=x[125];a.buildMerchands2.obj=x[108];a.buildCathedral.obj=x[11];a.buildCathedral1.obj=x[123];a.buildCathedral2.obj=x[106];a.buildAcademy.obj=x[17];a.buildAcademy1.obj=x[126];a.buildAcademy2.obj=x[109];a.buildCastle.obj=x[12];a.magicVision.obj={name:"Magic Vision",spcost:[20,
0,0,0]};a.fireRain.obj={name:"Fire Rain",spcost:[200,0,0,0]};a.raiseDead.obj={name:"Raise the Dead",spcost:[40,0,0,0]};a.createJinn.obj={name:"Spawn Jinn",spcost:[320,0,0,0]};a.createCarpet.obj={name:"Spawn Magic Carpet",spcost:[320,0,0,0]};a.buildCastle1.obj=x[62];a.buildCastle2.obj=x[63];a.buildHouse.obj=x[31];a.buildHouse2.obj=x[92];a.buildTavern.obj=x[30];a.buildTavern1.obj=x[119];a.buildTavern2.obj=x[100];a.buildStable.obj=x[28];a.buildStable1.obj=x[121];a.buildStable2.obj=x[103];a.buildFarm.obj=
x[23];a.buildFarm1.obj=x[114];a.buildFarm2.obj=x[95];a.buildWorkshop.obj=x[29];a.buildWorkshop1.obj=x[117];a.buildWorkshop2.obj=x[98];a.buildBlacksmith.obj=x[26];a.buildBlacksmith1.obj=x[116];a.buildBlacksmith2.obj=x[97];a.buildBridge.obj=x[35];a.buildHarbor.obj=x[41];a.buildHarbor1.obj=x[115];a.buildHarbor2.obj=x[96];a.createMage2.obj=x[89];a.buildMagicItems.obj={};a.techJanissary.obj=B[86];a.techRiddingHorses.obj=B[85];a.techOreFloatation.obj=B[84];a.techJinn.obj=B[83];a.techNecromancy.obj=B[82];
a.techMagicVision.obj=B[81];a.techFireRain.obj=B[80];a.techMagicWorkshop.obj=B[79];a.techCarpet.obj=B[78];a.techJihad.obj=B[77];a.techScimitar.obj=B[76];a.techHorseManShip.obj=B[75];a.techCowPoaching.obj=B[74];a.buildWoodGate.obj={};a.buildWoodWall.obj=x[13];a.buildOutpost.obj=x[34];a.buildOutpost1.obj=x[122];a.buildOutpost2.obj=x[104];a.createGolem.obj={name:"Spawn Stone Golem",spcost:[480,0,0,0]};a.techSunTzu.obj=B[73];a.techBushido.obj=B[70];a.techLeadership.obj=B[71];a.techHonor.obj=B[72];a.createBat.obj=
{name:"Spawn Bat",spcost:[40,0,0,0]};a.techGoldMining.obj=B[1];a.techStoneMining.obj=B[2];a.emergeAllUnits.obj={};a.createOrk.obj=x[58];a.createDwarf.obj=x[59];a.createSkeleton.obj=x[60];a.createGhost.obj=x[40];a.createFootman.obj=x[0];a.createArcher.obj=x[4];a.techSlavery.obj=B[87];a.createMaceman.obj=x[3];a.createPikeman.obj=x[1];a.createLongbowman.obj=x[6];a.createKnight.obj=x[19];a.mercFootman.obj=f;a.mercArcher.obj=f;a.mercMaceman.obj=f;a.mercPikeman.obj=f;a.mercLongbowman.obj=f;a.mercKnight.obj=
f;a.createPeon.obj=x[10];a.createSpy.obj=x[2];a.techFeudalism.obj=B[12];a.techArchitecture.obj=B[13];a.techLearning.obj=B[14];a.createPeon1.obj=x[64];a.createPeon2.obj=x[79];a.createNinja.obj=x[65];a.techBuddhism.obj=B[45];a.createCrusaders.obj={};a.buildMagicWorkshop.obj=x[110];a.techFanaticism.obj=B[31];a.techCrusade.obj=B[32];a.techEspionage.obj=B[30];a.techChainMail.obj=B[9];a.techHalberd.obj=B[6];a.techLongbow.obj=B[0];a.techScaleArmor.obj=B[5];a.techTemperIron.obj=B[4];a.techPlateArmor.obj=
B[10];a.techLandingTactics.obj={};a.createGalleon.obj=x[73];a.createHulk.obj=x[75];a.createXebec.obj=x[76];a.createFishingBoat.obj=x[74];a.techCrossbow.obj=B[11];a.techWoodCutting.obj=B[3];a.techCannonTower.obj=B[46];a.techEngineering.obj=B[47];a.createBallist.obj=x[38];a.createHeavyCatapult.obj=x[39];a.createCatapult.obj=x[37];a.upgradeCannonTower.obj=B[44];a.upgradeStoneTower.obj=B[43];a.upgradeGuildTower.obj=B[42];a.createCaravan.obj=x[61];a.createCaravan2.obj=x[90];a.techBribery.obj=B[21];a.techSupplyStorage.obj=
B[20];a.techUsury.obj=B[19];a.techCropRotation.obj=B[8];a.createCow.obj=x[27];a.techDomestication.obj=B[7];a.techTradeTaxes.obj=B[18];a.techTradeRoutes.obj=B[17];a.techMapMaking.obj=B[16];a.createPriest.obj=x[9];a.techBodyBuilding.obj=B[29];a.techSiegeTactics.obj=B[28];a.techFame.obj=B[27];a.techHeroes.obj=B[26];a.techMercenaries.obj=B[25];a.techTactics.obj=B[24];a.techWarfare.obj=B[23];for(var b=Object.keys(a),c=0,d=b.length;c<d;c++){var e=a[b[c]];e.objName=b[c];e.obj&&(e.obj.nu=e)}}},lf={resitem:{u:"item_use",
d:"item_drop"},item_soul:{k:"item_kill",b:"item_berserk",d:"item_drop"},wall_wood:{s:"to_swall"},e_tavern:{t:"trade1",g:"gamble",m:"createMercenaries",h:"createHeroes",l:"loan"},loan:{g:"loan_gold",s:"loan_stone",f:"loan_food",w:"loan_wood"},e_castle:{p:"createPeon",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning"},a_castle:{p:"createPeon1",n:"createNina",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",b:"techBudhism",w:"techGreatwall"},
r_castle:{p:"createPeon2",s:"createSpy",e:"emergeAllUnits",d:"techFeudalism",a:"techArchitecture",l:"techLearning",y:"techSlavery"},e_barrack:{f:"createFootman",a:"createArcher",m:"createMaceman",p:"createPikeman",l:"createLongbowman",k:"createKnight"},a_barrack:{r:"createRonin",a:"createArcher2",s:"createSamurai",h:"createHorseArcher1",o:"createHorseSamurai",c:"createChariot"},r_barrack:{f:"createFootman2",a:"createArcher2",s:"createSatrap",p:"createSpearman",h:"createHorsearcher2",c:"createCavalry",
j:"createJanissary",d:"createJihadWarrior"},e_magetower:{m:"createMage"},r_magetower:{m:"createMage2"},a_magetower:{m:"createMage1"},e_peon:{b:"menuBuilds",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",i:"bribe"},r_peon:{b:"menuBuilds2",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",j:"become_jihadw",i:"bribe"},a_peon:{b:"menuBuilds1",r:"repair",c:"capture",h:"dcm",p:"pickUp",e:"explore",s:"stop",n:"stand",a:"attack",t:"trade"},
e_priest:{m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",b:"bless"},a_priest:{m:"move",a:"attack",e:"explore",s:"stop",n:"stand",h:"healing",r:"raiseexp"},e_mage:{m:"move",a:"attack",s:"stop",n:"stand",l:"lightning",b:"createBat",f:"freeze",t:"createGolem",i:"invisibility"},r_mage:{m:"move",a:"attack",s:"stop",n:"stand",c:"spell_spawncarpet",j:"spell_spawnjin",r:"spell_firerain",v:"spell_magicvision",d:"raisedead"},a_mage:{m:"move",a:"attack",s:"stop",n:"stand",h:"spell_hypnotize",
t:"spell_turntostone",w:"spell_whirlpool",f:"spell_flamebolt",d:"spell_spawndragon"},footman:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"},a_monk:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand"},a_monk_priest:{a:"attack",g:"guard",r:"become_priest",p:"pick_item",e:"explore",s:"stop",n:"stand"},e_spy:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",n:"stand",s:"stop"},ninja:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",
s:"stop",n:"stand",c:"cloak",u:"murder"},ninja_cloaked:{a:"attack",g:"guard",r:"patrol",p:"pick_item",e:"explore",s:"stop",n:"stand",k:"uncloak",u:"murder"},catapult:{a:"attack",g:"guard",p:"patrol",e:"explore",s:"stop",n:"stand",r:"attack_ground",h:"hold_steady"},e_market:{c:"createCaravan"},r_market:{c:"createCaravan2"},a_market:{b:"market_items",s:"market_sell"},market_items:{},market_sell:{},e_workshop:{c:"createCatapult",h:"createHeavyCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"},
r_workshop:{c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"},a_workshop:{c:"createCatapult",b:"createBallista",e:"techEngineering",t:"techCannonTower"},r_church:{p:"createPriest2"},e_church:{p:"createPriest"},a_church:{m:"createMonk",p:"createPriest1"},e_build:{c:"buildCastle",s:"buildStorage",b:"buildBarrack",k:"buildBlacksmith",f:"buildFarm",l:"buildLumber",p:"buildWorkshop",e:"buildCathedral",u:"buildChurch",n:"buildTavern",m:"buildMageTower",a:"buildStable",r:"buildHarbor",
o:"buildOutpost",i:"buildFields",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse",g:"buildGateWood",y:"buildDummy"},r_build:{c:"buildCastle2",k:"buildBlacksmith2",f:"buildFarm2",n:"buildTavern2",b:"buildBarrack2",p:"buildWorkshop2",s:"buildStorage2",a:"buildStable2",l:"buildLumber2",r:"buildHarbor2",o:"buildOutpost2",u:"buildChurch2",e:"buildMosque",i:"buildFields",m:"buildMageTower2",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse2",g:"buildGateWood"},r_magicworkshop:{i:"build_item"},
a_build:{c:"buildCastle1",f:"buildFarm1",e:"buildShaolinn",n:"buildTavern1",b:"buildBarrack1",p:"buildWorkshop1",s:"buildStorage1",k:"buildBlacksmith1",a:"buildStable1",l:"buildLumber1",r:"buildHarbor1",o:"buildOutpost1",u:"buildChurch1",i:"buildFields",m:"buildMageTower1",w:"buildWoodWall",d:"buildBridge",t:"buildTower",h:"buildHouse1",g:"buildGateWood"},e_lumber:{b:"techLongbow",w:"techWoodCutting",c:"techCrossbow"},r_lumber:{w:"techWoodCutting",c:"techCrossbow"},a_lumber:{w:"techWoodCutting",c:"techCrossbow"},
e_blacksmith:{p:"techPlateArmor",t:"techTemperIron",s:"techScaleArmor",h:"techHalberd",c:"techChainMail"},r_blacksmith:{t:"techTemperIron",a:"techScaleArmor",s:"techScimitar",c:"techChainMail",h:"techHalberd"},a_blacksmith:{t:"techTemperIron",a:"techScaleArmor",r:"techArmoredChariot",c:"techChainMail"},e_outpost:{e:"emergeAllUnits"},menu_stop:{s:"stop"},tower_wood:{a:"attack",s:"stop",g:"upgradeGuildTower"},tower_wood2:{a:"attack",s:"stop",g:"upgradeStoneTower",c:"upgradeCannonTower"},tower_stone:{a:"attack",
s:"stop",c:"upgradeCannonTower"},tower_stone2:{a:"attack",r:"attack_ground",s:"stop",h:"holdfire"},tower_stone3:{a:"attack",r:"attack_ground",s:"stop",f:"fireatwill"},ownership:{h:"view_heroes",s:"view_spys",i:"view_items",q:"view_quests"},gate_wood_00:{o:"gateclose",n:"gate_subai_on",s:"to_sgate"},gate_wood_01:{o:"gateclose",f:"gate_subai_off",s:"to_sgate"},gate_wood_10:{c:"gateopen",n:"gate_subai_on",s:"to_sgate"},gate_wood_11:{c:"gateopen",f:"gate_subai_off",s:"to_sgate"},gate_stone_00:{o:"gateclose",
n:"gate_subai_on"},gate_stone_01:{o:"gateclose",f:"gate_subai_off"},gate_stone_10:{c:"gateopen",n:"gate_subai_on"},gate_stone_11:{c:"gateopen",f:"gate_subai_off"},e_harbor:{f:"createFishingBoat",x:"createXebec",h:"createHulk",g:"createGalleon",t:"te_landingtactics"},r_harbor:{f:"createFishingBoat",h:"createHulk",x:"createXebec",t:"te_landingtactics"},a_harbor:{f:"createFishingBoat",h:"createHulk",x:"createXebec"},e_boat:{m:"move",e:"explore",s:"stop",n:"stand",f:"fishing"},e_galleon:{m:"move",e:"explore",
u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship",l:"to_ship_level2"},e_galleon2:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship",l:"to_ship_level3"},e_galleon3:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship",l:"to_ship_level4"},e_galleon4:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",
t:"trade_ship",l:"to_ship_level5"},e_galleon5:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship",l:"to_ship_level6"},e_galleon6:{m:"move",e:"explore",u:"unload",a:"attack",r:"attack_ground",s:"stop",n:"stand",h:"hold_steady",t:"trade_ship"},e_carpet:{m:"move",u:"unload",a:"attack",e:"explore",s:"stop",n:"stand"},e_trader:{m:"move",t:"trade",e:"explore",s:"stop",n:"stand",u:"unload"},e_farm:{c:"createCow",f:"techCropRotation",d:"techDomestication"},
r_farm:{c:"createCow",f:"techDomestication",d:"techDomestication",p:"te_cowpoaching",r:"te_artofriding",h:"te_horsemanship"},a_farm:{f:"techDomestication",a:"te_artofriding",i:"te_irrigation"},e_storage:{g:"techGoldMining",s:"techStoneMining"},r_storage:{g:"techGoldMining",s:"techStoneMining"},a_storage:{g:"techGoldMining",s:"techStoneMining"},spy_add:{i:"impersonate",v:"reveal_self"},cathedral:{c:"createCrusaders"},magic_gateway:{o:"createOrk",d:"createDwarf",g:"createGhost",s:"createSkeleton"},
crusade_anchor:{s:"select_crusaders"}};(function(){for(var a=Object.keys(lf),b=0;b<a.length;b++)for(var d=lf[a[b]],c=Object.keys(d),e=0;e<c.length;e++)d[d[c[e]]]=c[e]})();var Xd={};v("selectUnits").onclick=function(){v("mapeditorinfoUnits").style.display="block";v("mapeditorinfoBuilds").style.display="none";v("mapeditorinfoItems").style.display="none";v("mapeditorinfoNature").style.display="none"};v("selectBuilds").onclick=function(){v("mapeditorinfoUnits").style.display="none";v("mapeditorinfoBuilds").style.display=
"block";v("mapeditorinfoItems").style.display="none";v("mapeditorinfoNature").style.display="none"};v("selectItems").onclick=function(){v("mapeditorinfoUnits").style.display="none";v("mapeditorinfoBuilds").style.display="none";v("mapeditorinfoItems").style.display="block";v("mapeditorinfoNature").style.display="none"};v("selectNature").onclick=function(){v("mapeditorinfoUnits").style.display="none";v("mapeditorinfoBuilds").style.display="none";v("mapeditorinfoItems").style.display="none";v("mapeditorinfoNature").style.display=
"block"};Xd.func=function(){P=[{color:[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],ia:0,name:"Tzar 1",race:0,team:0},{color:[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],ia:0,name:"Tzar 2",race:0,team:0},{color:[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],ia:0,name:"Tzar 3",race:0,team:0},{color:[~~(256*Math.random()),~~(256*Math.random()),~~(256*Math.random())],ia:0,name:"Tzar 4",race:0,team:0}];r.editor=1;if(Uc(0,Xd.func)){v("statButton").style.display=
"none";v("menu").style.display="none";v("resources").style.display="none";v("mapeditorinfotop").style.display="block";v("mapeditorinfo").style.display="block";var a=document.getElementById("mapeditorinfoUnits");a.style.display="block";yf();if(!Xd.preload){Xd.preload=!0;var b={},d={},c=x,e={euro:Oa[0],arab:Oa[1],asia:Oa[2],common:A.common};b[Oa[0]]=[];b[Oa[1]]=[];b[Oa[2]]=[];b[A.common]=[];d[Oa[0]]=[];d[Oa[1]]=[];d[Oa[2]]=[];d[A.common]=[];for(var h=0,l=c.length;h<l;h++){var g=c[h];!g.race||g.illegal||
7==g.type||g.item||(g.build?d[e[g.race]].put(h):b[e[g.race]].put(h))}for(g=0;2>g;g++){c=Object.keys(b);var k={};h=0;for(l=c.length;h<l;k={ul$19:k.ul$19},h++){var m=document.createElement("h1");m.innerHTML=c[h];k.ul$19=document.createElement("ul");m.onclick=function(a){return function(){Rf(a.ul$19)}}(k);k.ul$19.style.display="none";for(var q=b[c[h]],t=Object.keys(q),u={},w=0,z=t.length;w<z;u={tcreate:u.tcreate},w++)e=document.createElement("li"),e.innerHTML=x[q[t[w]]].name,u.tcreate=q[t[w]],e.onclick=
function(a){return function(){var b=a.tcreate;x[b].wall?og(b):H(b)}}(u),k.ul$19.appendChild(e);a.appendChild(m);a.appendChild(k.ul$19)}b=d;a=v("mapeditorinfoBuilds")}c=Object.keys(Mb);a=v("mapeditorinfoItems");ul=document.createElement("ul");b={};h=0;for(l=c.length;h<l;b={u$20:b.u$20},h++)e=document.createElement("li"),b.u$20=Mb[c[h]],e.onclick=function(a){return function(){Ch(a.u$20)}}(b),e.innerHTML=b.u$20.name,ul.appendChild(e);a.appendChild(ul);a=v("mapeditorinfoNature");m=document.createElement("h1");
m.innerHTML=A.trees;ul=document.createElement("ul");m.onclick=function(){Rf(ul)};ul.style.display="none";e=document.createElement("li");ul.appendChild(e);a.appendChild(m);a.appendChild(ul);e.onclick=function(){gh(kl)};e.innerHTML=A.delete;e=document.createElement("li");ul.appendChild(e);e.onclick=function(){gh(ll)};e.innerHTML=A.create;m=document.createElement("h1");m.innerHTML=A.terrain;var B=document.createElement("ul");m.onclick=function(){Rf(B)};B.style.display="none";a.appendChild(m);a.appendChild(B);
l=Sb.texturesRandomMap;a={};h=0;for(l=l.length;h<l;a={l:a.l},h++)e=document.createElement("li"),B.appendChild(e),e.innerHTML=h,a.l=h,e.onclick=function(a){return function(){gh(hh);hh.active=a.l}}(a)}}};var yf=function(){var a=v("selectKingdom");a.innerHTML="";for(var b=1,d=I.length;b<d;b++){var c=I[b];1===b&&(a.style.background="rgba("+c.color[0]+","+c.color[1]+","+c.color[2]+",1)");a.innerHTML+='<option value="'+b+'" style="background:rgba('+c.color[0]+","+c.color[1]+","+c.color[2]+',1)">'+c.name+
"</option>"}};v("selectKingdom").onchange=function(){t.kingdom=parseInt(this.value);var a=I[t.kingdom].color;this.style.background="rgba("+a[0]+","+a[1]+","+a[2]+",.8)"};var Qk=function(a){Vc();var b=document.createElement("div"),d=document.createElement("div");b.id="unitProps";var c="<table>"+('\n<tr><td>Name </td><td><input data-prop="name" type="text" value="'+a.name+'" /></td></tr>\n<tr><td>'+A.kingdom+' </td><td><select id="selectKingdom2">'+v("selectKingdom").innerHTML+"</select></td></tr>\n<tr><td>"+
A.health+' </td><td><input data-prop="health" type="number" value="'+a.health+'" /></td></tr>\n<tr><td>'+A.maxHealth+'</td> <td><input data-prop="maxHealth" type="number" value="'+a.maxHealth+'" /></td></tr>\n');a.build||(c+="\n<tr><td>"+A.attack+'</td><td><input data-prop="attack" type="number" value="'+a.attack+'" /></td></tr>\n<tr><td>'+A.defence+'</td> <td><input data-prop="defence" type="number" value="'+a.defence+'" /></td></tr>\n<tr><td>'+A.mana+' <td><input data-prop="mana" type="number" value="'+
(a.mana||0)+'" /></td></tr>\n</table>\n');d.innerHTML=c+"</table>";c=document.createElement("button");c.innerHTML=A.ok;c.onclick=function(){for(var b=v("unitProps").getElementsByTagName("input"),c=0,d=b.length;c<d;c++)if(b[c]){var f=b[c].value;"number"==b[c].type&&(f=parseInt(f));var g=b[c].dataset.prop;a.__proto__[g]!=f&&(a[g]=f)}b=parseInt(v("selectKingdom2").value);b!=a.kingdom&&a.changeKingdom(b);document.body.removeChild(v("unitProps"));kb()};d.appendChild(c);b.appendChild(d);document.body.appendChild(b);
M(a.kingdom);v("selectKingdom2").value=a.kingdom},Td=function(a){document.getElementById(a).style.display="none"},Ud=function(a){document.getElementById(a).style.display="block"},Qg,gh=function(a){Qg=!0;U=function(){};var b=G;b.img=k.blank;var d=32*id();b.wh=[d,d];Ra(b);b.active=!0;document.addEventListener("mousemove",Rb);document.addEventListener("mousedown",Hj);Rb.active=a},Hj=function(a){if(2==a.buttons||a.pageX<t.menumx||a.pageY<t.menumy)return Ij();Rb(a)},Ti=function(a){if(r.editor){var b=parseInt(v("brushSize").value)+
a;b>v("brushSize").max?v("brushSize").value=v("brushSize").max:1>b?v("brushSize").value=1:(v("brushSize").value=b,G.wh&&(G.wh[0]+=32*a,G.wh[1]+=32*a,G.active=!0))}},id=function(){return parseInt(v("brushSize").value)},hh=function(a,b,d){a=id();for(var c=a*a,e=D,f=lc,g=hh.active,k=Sb.type,n=0;n<c;n++){var m=b+n%a,q=d+~~(n/a);na(m,q)&&(m+=q*e,f[m]=g,k[g]&&(2<V[m]&&z[V[m]].die(),2<za[m]&&z[za[m]].die()))}ph(f)},ll=function(a,b,d){a=id();for(var c=a*a,e=D,f=0;f<c;f++){var g=b+f%a,k=d+~~(f/a);na(g,k)&&
(0===V[g+k*e]?.8<Math.random()&&Xc([g+k*e,7,{d:3+~~(28*Math.random())}]):(g=z[V[g+k*e]],7==g.type&&g.die()))}},kl=function(a,b,d){a=id();for(var c=a*a,e=D,f=0;f<c;f++){var g=b+f%a,k=d+~~(f/a);na(g,k)&&(g=z[V[g+k*e]],7==g.type&&g.die())}},Rb=function(a){var b=32*id();b=Nb(a.pageX-t.mx-.5*b/da,a.pageY-.5*b/da);var d=~~(.03125*b[1]);b=~~(.03125*b[0]);G.x=32*b;G.y=32*d;G.active=!0;if(0!==a.buttons){if(2==a.buttons)return Ij();Rb.last!==b+d*D&&Rb.active&&Rb.active(a,b,d);Rb.last=b+d*D}},Ij=function(){G.active=
!0;G.x=-9999;G.y=-9999;Qg=!1;if(Rb.active){var a=32*id();Nb(event.pageX-t.mx-.5*a/da,event.pageY-.5*a/da);Rb.active=!1}G.wh=void 0;document.removeEventListener("mousedown",Hj);document.removeEventListener("mousemove",Rb)};v("mapProps").onclick=function(){v("mapPropsWindow").style.display="block";Vc();if(""==v("mapPropsWindow").innerHTML){var a=document.createElement("div");v("mapPropsWindow").appendChild(a);var b=document.createElement("table"),d=document.createElement("button");d.onclick=ml;d.innerHTML=
A.accept;a.appendChild(b);a.appendChild(d)}ih()};var ih=function(){var a=v("mapPropsWindow").getElementsByTagName("table")[0];a.innerHTML="";a.innerHTML+="<tr><td>"+A.color+"</td><td>"+A.username+"</td><td>"+A.AI+"</td><td>"+A.team+"</td></tr>";for(var b=1,d=I.length;b<d;b++){var c=I[b],e=c.color;e="#"+(16777216+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1);a.innerHTML+='<tr><td><input style="background:'+e+'" type="color" value="'+e+'" /></td><td><input type="text" value="'+c.name+'"></td><td><input type="checkbox" checked="'+
!!c.ia+'"></td><td><input type="number" min="0" value="'+c.team+'"></td></tr>'}a.innerHTML+="<tr><td><button id='editorAdd'>+</button><button id='editorDelete'>-</button></td></tr>";v("editorAdd").onclick=nl;v("editorDelete").onclick=ol;a=a.getElementsByTagName("input");b=0;for(d=I.length-1;b<d;b++)c=4*b,a[c].onchange=pl,a[c+1].onchange=ql,a[c+2].onchange=rl,a[c+3].onchange=sl,a[c].team=b,a[c+1].team=b,a[c+2].team=b,a[c+3].team=b},nl=function(){new Tb("Tzar "+I.length,[~~(256*Math.random()),~~(256*
Math.random()),~~(256*Math.random())],[0],0,!0,[r.goldRes,r.woodRes,r.foodRes,r.stoneRes],2);yf();ih()},ol=function(){if(2<I.length){for(var a=I.length-1,b=3,d=z.length;b<d;b++){var c=z[b];c.kingdom==a&&c.die()}I.length--;yf();ih()}},pl=function(){var a=I[this.team],b=parseInt(this.value.substr(1),16),d=b>>16&255,c=b>>8&255;b&=255;a.color=[d,c,b];var e=this.team+1;a=hb[e];I[e].color=[d,c,b];e*=3;ua[e]=d/255;ua[e+1]=c/255;ua[e+2]=b/255;d=0;for(c=a.length;d<c;d++){b=a[d];e=0;for(var h=b.length;e<h;e++)Zb(z[b[e]])}yf()},
ql=function(){I[this.team].name=this.value},rl=function(){I[this.team].ai="on"==this.value?!0:!1},sl=function(){I[this.team].team=parseInt(this.value)},ml=function(){v("mapPropsWindow").style.display="none";kb()};Od.onchange=function(a){ea(vg,parseInt(Od.value)/100,J)};v("mapload").onchange=function(){var a=document.getElementById("mapload").files[0],b=new FileReader;b.onloadend=function(a){a=a.target.result;v("customMapcont").style.display="block";Pa=JSON.parse(a);Pa.record?(v("seeStats").style.display=
"inline-table",v("playrecord").style.display="inline-table"):(v("seeStats").style.display="none",v("playrecord").style.display="none");null===Pa.goldRes&&(Pa.goldRes=Infinity);null===Pa.stoneRes&&(Pa.stoneRes=Infinity);null===Pa.foodRes&&(Pa.foodRes=Infinity);null===Pa.woodRes&&(Pa.woodRes=Infinity);a=document.getElementById("custombody");a.innerHTML="";for(var b=Pa.kingdomStart,d=0,f=b.length;d<f;d++){var g=b[d],k=g.color;a.innerHTML+="<tr><td style='background:rgb("+k[0]+","+k[1]+","+k[2]+')\' class="ucolor1"></td><td class="username1">'+
g.name+'</td><td style="display:none" class="race1">'+g.race+'</td><td class="team1">'+g.team+"</td></tr>"}};a&&b.readAsText(a)};var Pa,tl=function(a){var b={Blue:189,Red:13506841,Green:3257600,Purple:11337925,Yellow:16768512,Cyan:46517,Orange:16751649,Gray:5921370},d=a.split(["[Player"]),c=a.split("GameDuration =")[1].split("[")[0].split(" min")[0].split(" ")[1],e=[];a=[];for(var f=1,g=d.length;f<g;f++){var k=d[f].split("\n"),n={};e[f-1]=n;for(var m=0,q=k.length;m<q;m++){var r=k[m];r=r.split(" = ");
if(r[1]&&m){r[1]=r[1].trim();"Color"==r[0]&&(r[1]=b[r[1]]);"Type"==t&&"Status"!==r[0]&&a.put("N");r[1]=encodeURIComponent(r[1]);a.put(r[1]);n[r[0]]=r[1];var t=r[0]}}}b=e[0].Name+"'s Game";var v=new XMLHttpRequest;v.open("POST","http://127.0.0.1/php/stats.php",!0);v.setRequestHeader("Content-type","application/x-www-form-urlencoded");v.onreadystatechange=function(){200===v.status&&4===v.readyState&&(location.hash="MatchX"+v.responseText)};a=a.join("<");v.send("arr="+a+"&time="+6E4*c+"&name="+b+"&players="+
e.length)},jh=function(a,b){for(var d=0,c=0,e=a.length;c<e;c++)d+=b[a[c]];return d},kh=function(a,b,d){var c=["",d];performance.now();for(var e=1,f=a.length-1;e<f;e++){var g=a[e],k=g.stats,n=k.resources,m=k.unitCountMax,q=24*(e-1)+2,r=g.color,t=g.IA;t=t?"IA":"Human";c[q]=(r[0]<<16)+(r[1]<<8)+r[2];c[q+1]=g.name;c[q+1]=g.name;c[q+2]=t;c[q+3]=g.status;c[q+4]=g.team;c[q+5]=Oa[g.race];c[q+6]=k.score;c[q+7]=n[0];c[q+8]=n[1];c[q+9]=n[2];c[q+10]=n[3];c[q+11]=k.dmgInflicted;c[q+12]=k.dmgTaken;c[q+13]=k.unitsKilled;
c[q+14]=k.unitsLosed;c[q+15]=k.buildsDestroyed;c[q+16]=k.buildsLosed;c[q+17]=jh([10,79,64],m);c[q+18]=jh([32,44],m);c[q+19]=jh([55,56],m);c[q+20]=0;c[q+21]=0;c[q+22]=0;c[q+23]=0}Jj(c,b);b&&setTimeout(function(){"block"==v("ingameStats").style.display&&kh(a,b,d)},500)},Jj=function(a,b){for(var d="<tr style='background:#000;'><td style='    padding-right: 150px;'>Name</td><td>Type</td><td>Status</td><td>Team</td><td>Race</td><td>Score</td><td>Gold</td><td>Wood</td><td>Food</td><td>Stone</td><td title='Damage Inflicted'>D.I</td><td title='Damage Taken'>D.T</td><td title='Units Killed'>U.K</td><td title='Units Losed'>U.L</td><td title='Buildings Destroyed'>B.D</td><td title='Buildings Losed'>B.L</td><td title='Maximum Peasants'>M.P</td><td title='Maximum Towers'>M.T</td><td title='Maximum Stone Towers'>M.S.T</td><td title='Gold Traded'>G.T</td><td title='Stone Traded'>S.T</td><td title='Gold Converted'>G.C</td><td title='Stone Converted'>S.C</td></tr>",
c=2,e=a.length;c<e;c++)if((c-2)%24)0!==(c-3)%24&&(f=~~((c-2)/24)%2?"style = 'background:rgba(0,0,0,0.45)'":"style = 'background:rgba(0,0,0,0.65)'"),d+="<td "+f+">"+ab(decodeURIComponent(a[c]))+"</td>";else{c-2&&(d+="</tr>");f=parseInt(ab(decodeURIComponent(a[c])));var f="style = 'background:rgba("+Math.floor(f/65536)+","+Math.floor(f/256)%256+","+f%256+",0.45)'";d+="<tr>"}d+="</tr>";b?(v("ingameStats").style.display="block",v("statsGame").innerHTML="<tbody>"+d+"</tbody>",b=v("statsGame").getElementsByTagName("td")):
(v("MatchX").style.display="block",v("returnmenu").style.display="block",v("statsTable").innerHTML="<tbody>"+d+"</tbody>",b=v("statsTable").getElementsByTagName("td"));a=[];c=0;for(e=b.length;c<e;c++)d=c%23,4<d&&23<c&&(a[d-5]||(a[d-5]=[]),a[d-5].put(b[c]));c=0;for(e=a.length;c<e;c++){b=a[c];b.sort(Tj);d=b.length;if(!b[1])break;b[0].innerHTML!=b[1].innerHTML&&(b[0].style.background="rgba(127,0,0,0.45)");b[d-1].innerHTML!=b[d-2].innerHTML&&(b[d-1].style.background="rgba(0,127,0,0.45)")}};v("statsLoad").onchange=
function(){var a=document.getElementById("statsLoad").files[0],b=new FileReader;b.onloadend=function(a){tl(a.target.result)};a&&b.readAsText(a,"ascii")};var Sj=function(a){var b=new XMLHttpRequest;b.open("POST","http://127.0.0.1/php/loadstat.php",!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");Kj(b,function(a){Jj(a.responseText.split("<"))});M(a);b.send("id="+a)},Kj=function(a,b){a.onreadystatechange=function(){4===a.readyState&&(200===a.status?b(a):alert("Error: "+a.status))}};
v("deleteUnit").onclick=function(){ea(Nd,1,J.slice(0))};v("rotatebutton").onclick=function(){for(var a=J,b=0,d=a.length;b<d;b++){var c=z[a[b]];c.build||(c.d=(c.d+1)%8,ObjectsetupIMG(c,c.img))}};v("gameMenu").onclick=th;v("menueditor").onclick=th;v("quitButton1").onclick=function(){Bh("playingMenu");r.online&&Yg();P.length=0;J=[];Va=void 0;clearInterval(le);I=[];Ug=8;kb();r={canceled:!0};P.length=0;z=[{terrain:1},{terrain:1},{terrain:1}];yc={};wc={};Ob={};hb=[];ub=[];ua=[];qb=t.kingdom=void 0;Li={euro:0,
arab:0,asia:0};Ia.stop();cc=document.getElementById("msgs");wf=document.getElementById("msginput");window.removeEventListener("mousemove",rb);window.removeEventListener("keydown",Yi);window.removeEventListener("keyup",Zi);window.removeEventListener("mousemove",$i);window.removeEventListener("mousedown",aj);window.removeEventListener("mouseup",bj);Kb();document.getElementById("playermenu").style.display="block";document.getElementById("playingMenu").style.display="none"};v("backToGame").onclick=function(){v("playingMenu").style.display=
"none";kb()};v("backToGameS").onclick=function(){Bh("ingameStats")};v("statButton").onclick=function(){kh(I,!0,r.now())};v("returnmenu1").onclick=Kb;v("returnmenu").onclick=Kb;v("refreshButton1").onclick=Qf;v("sendmsg").onclick=Ig;v("start1").onclick=zj;v("start2").onclick=Uc;v("alertok").onclick=function(){v("alert").style.display="none";kb()};v("saveGame").onclick=function(){var a=document.createElement("a");document.body.appendChild(a);a.style="display: none";var b=r,d=z,c=[];c.length=d.length-
3;for(var e=3,h=d.length;e<h;e++){var g=d[e],k=x[g.type],n={kingdom:g.kingdom,d:g.d,type:g.type,img:g.img,x32:g.x32,y32:g.y32};g.name!==k.name&&(n.name=g.name);g.iconID!==k.iconID&&(n.iconID=g.iconID);g.attack!==k.attack&&(n.attack=g.attack);g.defence!==k.defence&&(n.defence=g.defence);g.level!==k.level&&(n.level=g.level);g.health!==k.health&&(n.health=g.health);g.maxHealth!==k.maxHealth&&(n.maxHealth=g.maxHealth);g.func&&(n.func=g.func);g.funcObj&&(n.funcObj=g.funcObj);g.workers&&g.workers.length&&
(n.workers=g.workers);g.workingOn&&(n.workingOn=g.workingOn);g.inventory&&g.inventory.length&&(n.inventory=g.inventory);g.dix&&(n.dix=g.dix);g.diy&&(n.diy=g.diy);g.timestamp&&(n.timestamp=g.timestamp);g.working&&(n.working=g.working);g.rnd&&(n.rnd=g.rnd);g.techID&&(n.techID=g.techID);g.techStart&&(n.techStart=g.techStart);g.activeTech&&(n.activeTech=g.activeTech);g.levelProgress&&(n.levelProgress=g.levelProgress);g.c&&(n.c=g.c);g.mimg&&(n.mimg=g.mimg);void 0!==g.built&&(n.built=g.built);void 0!==
g.xf&&(n.xf=g.xf);void 0!==g.yf&&(n.yf=g.yf);void 0!==g.action&&(n.action=g.action);g.point&&(n.point=g.point);g.waitlist&&(n.waitlist=g.waitlist);g.mv&&(n.mv=g.mv);g.work&&(n.work=g.work);g.death&&(n.death=g.death);g.freezed&&(n.freezed=g.freezed);g.sword&&(n.sword=g.sword);g.shield&&(n.shield=g.shield);g.book&&(n.book=g.book);c[e-3]=n}b.allunits=c;r.movtable=wc;r.movtable2=yc;r.kingdomStart||(r.kingdomStart=Xg);r.terrain||(r.terrain=Array.prototype.slice.call(lc));b=JSON.stringify(r);b=new Blob([b],
{type:"application/json"});b=URL.createObjectURL(b);a.href=b;a.download="savegame.tzared";a.click();r.allunits=void 0};v("closeButton1").onclick=function(){v("mapconfiguration").style.display="none";kb()};v("createGame1").onclick=yj;v("copyButton").onclick=function(){document.getElementById("onlineID").select();document.execCommand("Copy")};v("startCustom").onclick=function(){r=Object.assign({},Pa);r.editor=!1;r.custom=!0;r.online=!1;Pa=void 0;Uc(!1,!1,!0)};v("playrecord").onclick=function(){r=Object.assign({},
Pa);r.online=!1;r.custom=!0;r.demo=!0;r.cycle=0;r.editor=!1;Pa=void 0;Uc(!1,!1,!0)};v("seeStats").onclick=function(){kh(Pa.kingdoms,!1,25*Pa.cycle);location.hash="MatchX"};var yh={MatchHistory:function(){document.getElementById("returnmenu").style.display="block";var a=new XMLHttpRequest;a.open("GET","http://127.0.0.1/php/latest.php",!0);Kj(a,function(a){a=a.responseText.split("|");for(var b=a.length-1,c="",e=0;e<b;e+=5)c+="<tr id='statList"+ab(decodeURIComponent(a[e]))+"'><td>"+ab(decodeURIComponent(a[e+
1]))+"</td><td>"+ab(decodeURIComponent(a[e+2]))+"</td><td>"+ab(decodeURIComponent(a[e+3]))+"</td><td>"+parseInt(ab(decodeURIComponent(a[e+4])))/6E4+" min</td></tr>";document.getElementById("matchtable").innerHTML="<tbody>"+c+"</tbody>";c={};for(e=0;e<b;c={l:c.l},e+=5)c.l=ab(decodeURIComponent(a[e])),v("statList"+c.l).onclick=function(a){return function(){location.hash="MatchX"+a.l}}(c)});a.send(null)},GameList:Qf,RandomMap:dc,Twitter:function(){document.getElementById("returnmenu").style.display=
"block"},Account:function(){hd.returnmenu.style.display="block";""==hd.Account.innerHTML&&(hd.Account.innerHTML='<iframe id="accountIframe"></iframe>',hd.accountIframe=document.getElementById("accountIframe"));hd.accountIframe.src="http://127.0.0.1/"+t.langCodeUrl+"account/?iframe=1"},MapEditor:Xd.func,CustomMap:function(){document.getElementById("returnmenu").style.display="block"}};wh();var xc=[Pg,Ne,Ec,Bc,Jd,Ce,We,Pe,Ge,Ee,Me,Ye,Re,xi,$e,Ie,Ke,Te,Ld,me,Yd,Rh,ne,cg,Qh,wi,ye,Bi,Di,bd,Cg,Ei,Fi,Gi,
Hi,ye,pj,ri,Ii,xd,si,mg,oi,pi,tg,qi,Bd,Yb,sg,Cc,Bc,Ed,Ec,vc,Gd,ad,T,function(a){var b=a[1],d=z[a[2]];a=B[a[0]];I[d.kingdom].technology.hidden[a.id.id]=0;Xb(d,a,b);ia.actv[a.id.id]&&Y(!1)},zd,ve,Ma,hi,Ta,we,qg,vd,Ng,Pi,Ai];(function(){for(var a=0,b=xc.length;a<b;a++)xc[a].url=a})()})();
